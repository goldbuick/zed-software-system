var AU=Object.defineProperty;var SU=(Wr,On,yn)=>On in Wr?AU(Wr,On,{enumerable:!0,configurable:!0,writable:!0,value:yn}):Wr[On]=yn;var Ct=(Wr,On,yn)=>SU(Wr,typeof On!="symbol"?On+"":On,yn);(function(){"use strict";const Wr=new Set,On={emit(e,t,n,r,i){On.invoke(bw(e,t,n,r,i))},invoke(e){switch(e.target){}Wr.forEach(t=>t.handle(e))},connect(e){Wr.add(e)},disconnect(e){Wr.delete(e)}};var yn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function po(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Fb(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var xd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(yn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(xd);var Db=xd.exports,Ad=po(Db),Sd={};(function(e){var t=yn&&yn.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var f=0,d=l.length,p;f<d;f++)(p||!(f in l))&&(p||(p=Array.prototype.slice.call(l,0,f)),p[f]=l[f]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,f=u.capitalize,d=f===void 0?!0:f,p=u.adjectiveCount,g=p===void 0?1:p,k=u.addAdverb,w=k===void 0?!1:k,T=t(t(t([],t([],Array(g),!0).map(function(A){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),w?[n(e.adverbs)]:[],!0);return d&&(T=T.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),T.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(d?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,g=p===void 0?"":p;return r(e.adjectives).length*h+h*g.length+r(e.nouns).length+g.length+r(e.verbs).length+(d?r(e.adverbs).length+g.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,g=p===void 0?"":p;return i(e.adjectives).length*h+h*g.length+i(e.nouns).length+g.length+i(e.verbs).length+(d?i(e.adverbs).length+g.length:0)}e.minLength=c,e.default=s})(Sd);var $b=po(Sd);const jb="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let zb=e=>crypto.getRandomValues(new Uint8Array(e)),Kb=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Rd=(e,t=21)=>Kb(e,t,zb),Wb=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=jb[n[e]&63];return t};var Id="abcdefghijklmnopqrstuvwxyz",Od="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Nd="0123456789",Gb="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Hb="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const Yb=Nd,Vb=Id,qb=Od;var Jb=Yb+Vb+qb,Gl={lowercase:Id,uppercase:Od,numbers:Nd,nolookalikes:Gb,nolookalikesSafe:Hb,alphanumeric:Jb};function Ie(){return`sid_${Wb(12).replaceAll("-",".")}`}Rd(Gl.numbers,4),Rd(`${Gl.numbers}${Gl.lowercase}`,16);function Ts(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function Xb(){return $b({capitalize:!1,adjectiveCount:1})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Zb=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qb=Object.prototype.hasOwnProperty;function Hl(e,t){return Qb.call(e,t)}function Yl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Hl(e,i)&&r.push(i);return r}function _n(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Vl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Hi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Cd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ql(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(ql(e[t]))return!0}else if(typeof e=="object"){for(var r=Yl(e),i=r.length,s=0;s<i;s++)if(ql(e[r[s]]))return!0}}return!1}function Ld(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Md=function(e){Zb(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Ld(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Ld(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),ve=Md,tw=_n,vs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=xa(n,this.path);r&&(r=_n(r));var i=Yi(n,{op:"remove",path:this.from}).removed;return Yi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=xa(n,this.from);return Yi(n,{op:"add",path:this.path,value:_n(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:mo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},ew={add:function(e,t,n){return Vl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:vs.move,copy:vs.copy,test:vs.test,_get:vs._get};function xa(e,t){if(t=="")return e;var n={op:"_get",path:t};return Yi(e,n),n.value}function Yi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Aa(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=xa(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=mo(e,t.value),o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=_n(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=Aa;;){if(d=c[l],d&&d.indexOf("~")!=-1&&(d=Cd(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=c.slice(0,l).join("/"):l==h-1&&(f=t.path),f!==void 0&&p(t,0,e,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!Vl(d))throw new ve("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Vl(d)&&(d=~~d)}if(l>=h){if(n&&t.op==="add"&&d>u.length)throw new ve("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=ew[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=vs[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[d],n&&l<h&&(!u||typeof u!="object"))throw new ve("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Jl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=_n(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Yi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function nw(e,t,n){var r=Yi(e,t);if(r.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Aa(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new ve("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(vs[e.op]){if(typeof e.path!="string")throw new ve("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ve('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ve("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&ql(e.value))throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ve("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new ve("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Ud([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ve("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Ud(e,t,n){try{if(!Array.isArray(e))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Jl(_n(t),_n(e),n||!0);else{n=n||Aa;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof ve)return i;throw i}}function mo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!mo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!mo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var rw=Object.freeze({__proto__:null,JsonPatchError:ve,_areEquals:mo,applyOperation:Yi,applyPatch:Jl,applyReducer:nw,deepClone:tw,getValueByPointer:xa,validate:Ud,validator:Aa});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Xl=new WeakMap,iw=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),sw=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function ow(e){return Xl.get(e)}function aw(e,t){return e.observers.get(t)}function cw(e,t){e.observers.delete(t.callback)}function lw(e,t){t.unobserve()}function uw(e,t){var n=[],r,i=ow(e);if(!i)i=new iw(e),Xl.set(e,i);else{var s=aw(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=_n(e),t){r.callback=t,r.next=null;var o=function(){Zl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Zl(r),clearTimeout(r.next),cw(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new sw(t,r)),r}function Zl(e,t){t===void 0&&(t=!1);var n=Xl.get(e.object);Ql(n.value,e.object,e.patches,"",t),e.patches.length&&Jl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Ql(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Yl(t),o=Yl(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(Hl(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Ql(l,h,n,r+"/"+Hi(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+Hi(u),value:_n(l)}),n.push({op:"replace",path:r+"/"+Hi(u),value:_n(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Hi(u),value:_n(l)}),n.push({op:"remove",path:r+"/"+Hi(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!Hl(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+Hi(u),value:_n(t[u])})}}}function Pd(e,t,n){n===void 0&&(n=!1);var r=[];return Ql(e,t,r,"",n),r}var hw=Object.freeze({__proto__:null,compare:Pd,generate:Zl,observe:uw,unobserve:lw});Object.assign({},rw,hw,{JsonPatchError:Md,deepClone:_n,escapePathComponent:Hi,unescapePathComponent:Cd});var fw=typeof Element<"u",dw=typeof Map=="function",pw=typeof Set=="function",mw=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Sa(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Sa(e[r],t[r]))return!1;return!0}var s;if(dw&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Sa(r.value[1],t.get(r.value[0])))return!1;return!0}if(pw&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(mw&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(fw&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Sa(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var gw=function(t,n){try{return Sa(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},yw=po(gw);function E(e){return e!=null}const Gr=Object.keys;function pr(e){return _n(e)}function _w(e){return typeof e=="boolean"}function Mt(e){return typeof e=="number"&&isNaN(e)===!1}function At(e){return typeof e=="string"}function re(e){return Array.isArray(e)}function tu(e){return e}var jt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(jt||{}),Gt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Gt||{}),jn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(jn||{}),_t=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(_t||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Bt(e){return e.toLowerCase().trim()}function bw(e,t,n,r,i){return{session:e,id:Ie(),target:t,sender:n,data:r,player:i}}function xs(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function As(e,t=[],n=tu,r=""){const i=Ie(),s=Bt(e),o=t.map(Bt);let a=r;const c={id(){return i},name(){return e},session(u){return E(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){On.emit(a,u,i,l,h)},reply(u,l,h,f){c.emit(`${u.sender}:${l}`,h,f)},replynext(u,l,h,f){setTimeout(()=>c.emit(`${u.sender}:${l}`,h,f),64)},handle(u){const{target:l,path:h}=xs(u.target),f=Bt(l);!a&&f==="ready"&&(a=u.session),f==="bridge"&&E(u.session)&&(a=u.session),o.findIndex(d=>d==="all"||d===f)!==-1&&n(u),(i===l||f==="all"||s===f)&&n({...u,target:h})}};return On.connect(c),c}function ww(e){return E(e)&&typeof e=="object"&&At(e.id)&&At(e.target)&&At(e.sender)}function ae(e,t,n,r){const i=r??"";return e.emit(`error:${t}`,n,i),Kw(e,n,i)}function Ew(e,t,n){e.emit("broadcast:startstream",t,n)}function kw(e,t){e.emit("broadcast:stopstream",void 0,t)}function Tw(e,t,n){e.emit("chat:connect",t,n)}function vw(e,t){e.emit("chat:disconnect",void 0,t)}function xw(e,t,n){e.emit("gadgetclient:paint",t,n)}function Aw(e,t,n){e.emit("gadgetclient:patch",t,n)}function Sw(e,t){e.emit("gadgetserver:clearscroll",void 0,t)}function Rw(e,t,n,r,i,s,o){e.emit("network:fetch",[t,n,r,i,s],o)}function Iw(e,t,n){e.emit("network:start",t,n)}function Ow(e){e.emit("ready")}function eu(e,t){e.emit("register:loginready",!0,t)}function Nw(e,t,n,r){e.emit("register:savemem",[t,n],r)}function Cw(e,t,n){e.emit("register:forkmem",[t],n)}function Lw(e,t,n){e.emit("register:copy",t,n)}function Mw(e,t){e.emit("register:dev",void 0,t)}function Uw(e,t){e.emit("register:share",void 0,t)}function Pw(e,t){e.emit("register:nuke",void 0,t)}function Bw(e,t,n){e.emit("synth:tts",[t,n])}function Fw(e,t){e.emit("synth:tta",[t])}function Dw(e,t,n){e.emit("synth:play",[t,n])}function $w(e,t){e.emit("synth:bpm",t)}function Bd(e,t){e.emit("synth:mainvolume",t)}function Fd(e,t){e.emit("synth:drumvolume",t)}function Dd(e,t){e.emit("synth:ttsvolume",t)}function nu(e,t,n,r){e.emit("synth:voice",[t,n,r])}function jw(e,t,n,r,i){e.emit("synth:voicefx",[t,n,r,i])}function mr(e,...t){return e.emit("tape:info",t),!0}function $d(e,...t){return e.emit("tape:debug",t),!0}function zw(e,t,n){e.emit("tape:inspector",t,n)}function Kw(e,...t){return e.emit("tape:error",t),!1}function jd(e,t,n,r,i,s){e.emit("tape:editor:open",[t,n,r,i],s)}function zd(e,t){e.emit("vm:logout",void 0,t)}function Ra(e,t){return`${e}:${t.join(":")}`}function Ww(e,t){e.emit("vm:restart",void 0,t)}function ru(e,t){e.emit("vm:flush",void 0,t)}function Gw(e,t){e.emit("vm:fork",void 0,t)}function Hw(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function Yw(e,t){return{filename:e,json:t}}function Vw(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function iu(e,t,n,r,i,s){let o;switch(n){case"file":o=i;break;case"text":o=Hw(r,i);break;case"json":o=Yw(r,i);break;case"binary":o=Vw(r,i);break}setTimeout(()=>{e.emit("vm:loader",[t,n,r,o],s)},1)}function qw(e){const t=new Set;function n(s){ww(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),On.invoke(s))}const r=As("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){On.disconnect(r)}return{forward:n,disconnect:i}}const su=66.666,Ia=Math.round(1e3/su),Jw=3;function Xw(e){return new Promise(t=>setTimeout(t,e))}const ou=As("clock");let au=0,Oa=0,cu=0,Kd=performance.now();function Wd(){const e=performance.now(),t=e-Kd;cu+=t,cu>=su&&(cu%=su,ou.emit("tick",Oa),ou.emit("tock",Oa),++au,++Oa,au>=Ia&&(au%=Ia,ou.emit("second",Oa))),Kd=e,setTimeout(Wd,2)}Wd();function go(){return go=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},go.apply(this,arguments)}function Zw(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,lu(e,t)}function lu(e,t){return lu=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},lu(e,t)}function Qw(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Gd=function(){function e(n){this.trigger=n,this.observing=new Map}var t=e.prototype;return t.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},t.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[De].connections.iterate.delete(r),i.byKey.forEach(function(o){s[De].connections.byKey.get(o).delete(r)})}),this.observing.clear()},e}(),Vi=[],Na=function(e){Zw(t,e);function t(r,i,s){var o;if(o=e.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){Vi.push(Qw(o));try{o.func()}finally{Vi.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=t.prototype;return n._trigger=function(){if(Vi.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},t}(Gd);function Hd(){return!!Vi.length}function Yd(){return Vi.length?Vi[Vi.length-1]:void 0}function tE(e,t,n){var r=go({name:"unnamed",fireImmediately:!0},n),i=new Na(e,r,t);return i}var Ca=0;function Vd(){return Ca>0}function uu(e){Ca++;try{return e()}finally{Ca--,Ca===0&&nE()}}var hu=!1;function qd(){return hu}function Jd(e){hu=!0;try{e()}finally{hu=!1}}function eE(e){return function(){return Jd(e)}}var fu=[];function nE(){var e=[].concat(fu);fu=[],Xd(e)}function Xd(e){var t=new Set;e.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[De].connections.iterate.forEach(function(i){t.add(i)}),(r=n.observable[De].connections.byKey.get(n.key))==null||r.forEach(function(i){t.add(i)})}),t.forEach(function(n){n.trigger()})}function La(e){if(Vd()){fu.push(e);return}Xd([e])}function Zd(e,t){if(e.type==="iterate")e.observable[De].connections.iterate.add(t);else{var n=e.observable[De].connections.byKey.get(e.key);n||(n=new Set,e.observable[De].connections.byKey.set(e.key,n)),n.add(t)}}function Ma(e,t){if(!qd()){var n=Yd();n&&(Zd(e,n),n.registerConnection(e)),t&&(Zd(e,t),t.registerConnection(e))}}var du=Symbol("$skipreactive"),De=Symbol("$reactive"),zn=Symbol("$reactiveproxy");function yo(e,t){return!!(e&&e[zn]&&e[zn].implicitObserver===t)}function pu(e){return e[du]=!0,e}function Qd(e){return!!(e&&!yo(e)&&e[De])}function mu(e,t,n){if(n===void 0&&(n=!1),e[du]||yo(e,t))return e;var r=rE(e,n);if(!t)return r;var i=r[De].proxiesWithImplicitObserver.get(t);if(!i){var s={implicitObserver:t};Object.setPrototypeOf(s,tp),i=new Proxy(r[De].raw,s),r[De].proxiesWithImplicitObserver.set(t,i)}return i}var _o=mu;function rE(e,t){if(t===void 0&&(t=!1),yo(e))return e;if(Qd(e))return e[De].proxy;if(e[De]||e[zn])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:e,proxiesWithImplicitObserver:new Map,shallow:t};Object.defineProperty(e,De,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(e,tp);return n.proxy=r,r}var tp={has:function(t,n){var r=Reflect.has(t,n);return typeof n=="symbol"||Ma({observable:t,key:n,type:"has"},this.implicitObserver),r},get:function(t,n,r){if(n===zn)return{implicitObserver:this.implicitObserver};var i=Reflect.get(t,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(t)?Ma({observable:t,type:"iterate"},this.implicitObserver):Ma({observable:t,key:n,type:"get"},this.implicitObserver),Qd(i))return mu(i,this.implicitObserver);if(t[De].shallow)return i;if(typeof i=="object"&&i!==null&&!yo(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(t,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(Hd()||this.implicitObserver))return mu(i,this.implicitObserver)}return i},ownKeys:function(t){return Ma({observable:t,type:"iterate"},this.implicitObserver),Reflect.ownKeys(t)},set:function(t,n,r,i){return uu(function(){if(typeof n=="symbol")return Reflect.set(t,n,r,i);var s=Object.hasOwnProperty.call(t,n),o=Reflect.get(t,n,i),a=Reflect.set(t,n,r,i);if(!s)La({observable:t,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(t)){if(!(o<r))for(var c=r+1;c<=o;c++)La({observable:t,key:""+(c-1),oldValue:void 0,type:"delete"})}else La({observable:t,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(t,n){return uu(function(){if(typeof n=="symbol")return Reflect.deleteProperty(t,n);var r=Object.hasOwnProperty.call(t,n),i=Reflect.get(t,n),s=Reflect.deleteProperty(t,n);return r&&La({observable:t,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(t){throw new Error("Dynamic observable objects cannot be frozen")}};function iE(e,t){var n=go({name:"unnamed",fireImmediately:!0},t),r=new Na(e,n);return r}function sE(e,t,n){var r=go({name:"unnamed",fireImmediately:!0},n),i=new Na(function(){e(t)},r);return t=_o(t,i),r.fireImmediately&&i.trigger(),i}var ep=function(){function e(){this._observable=_o({_key:1})}var t=e.prototype;return t.reportObserved=function(r){return _o(this._observable,r)._key},t.reportChanged=function(){this._observable._key++},e}();function oE(e,t,n){return new ep}var aE=Object.freeze({__proto__:null,$reactive:De,$reactiveproxy:zn,$skipreactive:du,Atom:ep,Observer:Gd,Reaction:Na,autorun:iE,autorunAsync:sE,createAtom:oE,hasRunningReaction:Hd,isActionRunning:Vd,isReactive:yo,isTrackingDisabled:qd,markRaw:pu,reaction:tE,reactive:_o,runInAction:uu,runningReaction:Yd,untracked:Jd,untrackedCB:eE});const Ss=globalThis||void 0||self,er=()=>new Map,gu=e=>{const t=er();return e.forEach((n,r)=>{t.set(r,n)}),t},wi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},cE=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},lE=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Rs=()=>new Set,yu=e=>e[e.length-1],uE=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Ei=Array.from,hE=Array.isArray;class fE{constructor(){this._observers=er()}on(t,n){return wi(this._observers,t,Rs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Ei((this._observers.get(t)||er()).values()).forEach(r=>r(...n))}destroy(){this._observers=er()}}const ki=Math.floor,Ua=Math.abs,np=(e,t)=>e<t?e:t,qi=(e,t)=>e>t?e:t,rp=e=>e!==0?e<0:1/e<0,ip=1,sp=2,_u=4,bu=8,bo=32,Hr=64,Nn=128,Pa=31,wu=63,Ji=127,dE=2147483647,op=Number.MAX_SAFE_INTEGER,pE=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&ki(e)===e),mE=e=>e.toLowerCase(),gE=/^\s*/g,yE=e=>e.replace(gE,""),_E=/([A-Z])/g,ap=(e,t)=>yE(e.replace(_E,n=>`${t}${mE(n)}`)),bE=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},wo=typeof TextEncoder<"u"?new TextEncoder:null,wE=wo?e=>wo.encode(e):bE;let Eo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Eo&&Eo.decode(new Uint8Array).length===1&&(Eo=null);class ko{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ti=()=>new ko,EE=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},nr=e=>{const t=new Uint8Array(EE(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},kE=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(qi(n,t)*2),e.cpos=0)},Ve=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Eu=Ve,Dt=(e,t)=>{for(;t>Ji;)Ve(e,Nn|Ji&t),t=ki(t/128);Ve(e,Ji&t)},ku=(e,t)=>{const n=rp(t);for(n&&(t=-t),Ve(e,(t>wu?Nn:0)|(n?Hr:0)|wu&t),t=ki(t/64);t>0;)Ve(e,(t>Ji?Nn:0)|Ji&t),t=ki(t/128)},Tu=new Uint8Array(3e4),TE=Tu.length/3,vE=(e,t)=>{if(t.length<TE){const n=wo.encodeInto(t,Tu).written||0;Dt(e,n);for(let r=0;r<n;r++)Ve(e,Tu[r])}else rn(e,wE(t))},xE=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;Dt(e,r);for(let i=0;i<r;i++)Ve(e,n.codePointAt(i))},Is=wo&&wo.encodeInto?vE:xE,Ba=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=np(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(qi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},rn=(e,t)=>{Dt(e,t.byteLength),Ba(e,t)},vu=(e,t)=>{kE(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},AE=(e,t)=>vu(e,4).setFloat32(0,t,!1),SE=(e,t)=>vu(e,8).setFloat64(0,t,!1),RE=(e,t)=>vu(e,8).setBigInt64(0,t,!1),cp=new DataView(new ArrayBuffer(4)),IE=e=>(cp.setFloat32(0,e),cp.getFloat32(0)===e),To=(e,t)=>{switch(typeof t){case"string":Ve(e,119),Is(e,t);break;case"number":pE(t)&&Ua(t)<=dE?(Ve(e,125),ku(e,t)):IE(t)?(Ve(e,124),AE(e,t)):(Ve(e,123),SE(e,t));break;case"bigint":Ve(e,122),RE(e,t);break;case"object":if(t===null)Ve(e,126);else if(hE(t)){Ve(e,117),Dt(e,t.length);for(let n=0;n<t.length;n++)To(e,t[n])}else if(t instanceof Uint8Array)Ve(e,116),rn(e,t);else{Ve(e,118);const n=Object.keys(t);Dt(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Is(e,i),To(e,t[i])}}break;case"boolean":Ve(e,t?120:121);break;default:Ve(e,127)}};class lp extends ko{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&Dt(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const up=e=>{e.count>0&&(ku(e.encoder,e.count===1?e.s:-e.s),e.count>1&&Dt(e.encoder,e.count-2))};class Fa{constructor(){this.encoder=new ko,this.s=0,this.count=0}write(t){this.s===t?this.count++:(up(this),this.count=1,this.s=t)}toUint8Array(){return up(this),nr(this.encoder)}}const hp=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);ku(e.encoder,t),e.count>1&&Dt(e.encoder,e.count-2)}};class xu{constructor(){this.encoder=new ko,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(hp(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return hp(this),nr(this.encoder)}}class OE{constructor(){this.sarr=[],this.s="",this.lensE=new Fa}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new ko;return this.sarr.push(this.s),this.s="",Is(t,this.sarr.join("")),Ba(t,this.lensE.toUint8Array()),nr(t)}}const vi=e=>new Error(e),gr=()=>{throw vi("Method unimplemented")},yr=()=>{throw vi("Unexpected case")},fp=vi("Unexpected end of array"),dp=vi("Integer out of Range");class Da{constructor(t){this.arr=t,this.pos=0}}const Xi=e=>new Da(e),NE=e=>e.pos!==e.arr.length,CE=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},cn=e=>CE(e,$t(e)),Os=e=>e.arr[e.pos++],$t=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&Ji)*n,n*=128,i<Nn)return t;if(t>op)throw dp}throw fp},Au=e=>{let t=e.arr[e.pos++],n=t&wu,r=64;const i=(t&Hr)>0?-1:1;if(!(t&Nn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&Ji)*r,r*=128,t<Nn)return i*n;if(n>op)throw dp}throw fp},Ns=Eo?e=>Eo.decode(cn(e)):e=>{let t=$t(e);if(t===0)return"";{let n=String.fromCodePoint(Os(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Os(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Su=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},LE=[e=>{},e=>null,Au,e=>Su(e,4).getFloat32(0,!1),e=>Su(e,8).getFloat64(0,!1),e=>Su(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Ns,e=>{const t=$t(e),n={};for(let r=0;r<t;r++){const i=Ns(e);n[i]=vo(e)}return n},e=>{const t=$t(e),n=[];for(let r=0;r<t;r++)n.push(vo(e));return n},cn],vo=e=>LE[127-Os(e)](e);class pp extends Da{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),NE(this)?this.count=$t(this)+1:this.count=-1),this.count--,this.s}}class $a extends Da{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Au(this);const t=rp(this.s);this.count=1,t&&(this.s=-this.s,this.count=$t(this)+2)}return this.count--,this.s}}class Ru extends Da{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Au(this),n=t&1;this.diff=ki(t/2),this.count=1,n&&(this.count=$t(this)+2)}return this.s+=this.diff,this.count--,this.s}}class ME{constructor(t){this.decoder=new $a(t),this.str=Ns(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const UE=crypto.getRandomValues.bind(crypto),mp=()=>UE(new Uint32Array(1))[0],PE="10000000-1000-4000-8000"+-1e11,BE=()=>PE.replace(/[018]/g,e=>(e^mp()&15>>e/4).toString(16)),gp=e=>new Promise(e);Promise.all.bind(Promise);var yp={},ja={};ja.byteLength=$E,ja.toByteArray=zE,ja.fromByteArray=GE;for(var _r=[],Kn=[],FE=typeof Uint8Array<"u"?Uint8Array:Array,Iu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Cs=0,DE=Iu.length;Cs<DE;++Cs)_r[Cs]=Iu[Cs],Kn[Iu.charCodeAt(Cs)]=Cs;Kn[45]=62,Kn[95]=63;function _p(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function $E(e){var t=_p(e),n=t[0],r=t[1];return(n+r)*3/4-r}function jE(e,t,n){return(t+n)*3/4-n}function zE(e){var t,n=_p(e),r=n[0],i=n[1],s=new FE(jE(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=Kn[e.charCodeAt(c)]<<18|Kn[e.charCodeAt(c+1)]<<12|Kn[e.charCodeAt(c+2)]<<6|Kn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Kn[e.charCodeAt(c)]<<2|Kn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=Kn[e.charCodeAt(c)]<<10|Kn[e.charCodeAt(c+1)]<<4|Kn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function KE(e){return _r[e>>18&63]+_r[e>>12&63]+_r[e>>6&63]+_r[e&63]}function WE(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(KE(r));return i.join("")}function GE(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(WE(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(_r[t>>2]+_r[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(_r[t>>10]+_r[t>>4&63]+_r[t<<2&63]+"=")),i.join("")}var Ou={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ou.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+e[t+h],h+=f,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(d?-1:1)*o*Math.pow(2,s-r)},Ou.write=function(e,t,n,r,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=f/c:t+=f*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+d]=o&255,d+=p,o/=256,u-=8);e[n+d-p]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=ja,n=Ou,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=P,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const x=new s(1),m={foo:function(){return 42}};return Object.setPrototypeOf(m,s.prototype),Object.setPrototypeOf(x,m),x.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(x){if(x>i)throw new RangeError('The value "'+x+'" is invalid for option "size"');const m=new s(x);return Object.setPrototypeOf(m,l.prototype),m}function l(x,m,y){if(typeof x=="number"){if(typeof m=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(x)}return h(x,m,y)}l.poolSize=8192;function h(x,m,y){if(typeof x=="string")return g(x,m);if(o.isView(x))return w(x);if(x==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof x);if(ft(x,o)||x&&ft(x.buffer,o)||typeof a<"u"&&(ft(x,a)||x&&ft(x.buffer,a)))return T(x,m,y);if(typeof x=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const R=x.valueOf&&x.valueOf();if(R!=null&&R!==x)return l.from(R,m,y);const F=A(x);if(F)return F;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof x[Symbol.toPrimitive]=="function")return l.from(x[Symbol.toPrimitive]("string"),m,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof x)}l.from=function(x,m,y){return h(x,m,y)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function f(x){if(typeof x!="number")throw new TypeError('"size" argument must be of type number');if(x<0)throw new RangeError('The value "'+x+'" is invalid for option "size"')}function d(x,m,y){return f(x),x<=0?u(x):m!==void 0?typeof y=="string"?u(x).fill(m,y):u(x).fill(m):u(x)}l.alloc=function(x,m,y){return d(x,m,y)};function p(x){return f(x),u(x<0?0:O(x)|0)}l.allocUnsafe=function(x){return p(x)},l.allocUnsafeSlow=function(x){return p(x)};function g(x,m){if((typeof m!="string"||m==="")&&(m="utf8"),!l.isEncoding(m))throw new TypeError("Unknown encoding: "+m);const y=L(x,m)|0;let R=u(y);const F=R.write(x,m);return F!==y&&(R=R.slice(0,F)),R}function k(x){const m=x.length<0?0:O(x.length)|0,y=u(m);for(let R=0;R<m;R+=1)y[R]=x[R]&255;return y}function w(x){if(ft(x,s)){const m=new s(x);return T(m.buffer,m.byteOffset,m.byteLength)}return k(x)}function T(x,m,y){if(m<0||x.byteLength<m)throw new RangeError('"offset" is outside of buffer bounds');if(x.byteLength<m+(y||0))throw new RangeError('"length" is outside of buffer bounds');let R;return m===void 0&&y===void 0?R=new s(x):y===void 0?R=new s(x,m):R=new s(x,m,y),Object.setPrototypeOf(R,l.prototype),R}function A(x){if(l.isBuffer(x)){const m=O(x.length)|0,y=u(m);return y.length===0||x.copy(y,0,0,m),y}if(x.length!==void 0)return typeof x.length!="number"||vt(x.length)?u(0):k(x);if(x.type==="Buffer"&&Array.isArray(x.data))return k(x.data)}function O(x){if(x>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return x|0}function P(x){return+x!=x&&(x=0),l.alloc(+x)}l.isBuffer=function(m){return m!=null&&m._isBuffer===!0&&m!==l.prototype},l.compare=function(m,y){if(ft(m,s)&&(m=l.from(m,m.offset,m.byteLength)),ft(y,s)&&(y=l.from(y,y.offset,y.byteLength)),!l.isBuffer(m)||!l.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(m===y)return 0;let R=m.length,F=y.length;for(let Z=0,nt=Math.min(R,F);Z<nt;++Z)if(m[Z]!==y[Z]){R=m[Z],F=y[Z];break}return R<F?-1:F<R?1:0},l.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(m,y){if(!Array.isArray(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return l.alloc(0);let R;if(y===void 0)for(y=0,R=0;R<m.length;++R)y+=m[R].length;const F=l.allocUnsafe(y);let Z=0;for(R=0;R<m.length;++R){let nt=m[R];if(ft(nt,s))Z+nt.length>F.length?(l.isBuffer(nt)||(nt=l.from(nt)),nt.copy(F,Z)):s.prototype.set.call(F,nt,Z);else if(l.isBuffer(nt))nt.copy(F,Z);else throw new TypeError('"list" argument must be an Array of Buffers');Z+=nt.length}return F};function L(x,m){if(l.isBuffer(x))return x.length;if(o.isView(x)||ft(x,o))return x.byteLength;if(typeof x!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof x);const y=x.length,R=arguments.length>2&&arguments[2]===!0;if(!R&&y===0)return 0;let F=!1;for(;;)switch(m){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ot(x).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return dt(x).length;default:if(F)return R?-1:ot(x).length;m=(""+m).toLowerCase(),F=!0}}l.byteLength=L;function C(x,m,y){let R=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,m>>>=0,y<=m))return"";for(x||(x="utf8");;)switch(x){case"hex":return $(this,m,y);case"utf8":case"utf-8":return j(this,m,y);case"ascii":return ut(this,m,y);case"latin1":case"binary":return G(this,m,y);case"base64":return X(this,m,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yt(this,m,y);default:if(R)throw new TypeError("Unknown encoding: "+x);x=(x+"").toLowerCase(),R=!0}}l.prototype._isBuffer=!0;function W(x,m,y){const R=x[m];x[m]=x[y],x[y]=R}l.prototype.swap16=function(){const m=this.length;if(m%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<m;y+=2)W(this,y,y+1);return this},l.prototype.swap32=function(){const m=this.length;if(m%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<m;y+=4)W(this,y,y+3),W(this,y+1,y+2);return this},l.prototype.swap64=function(){const m=this.length;if(m%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<m;y+=8)W(this,y,y+7),W(this,y+1,y+6),W(this,y+2,y+5),W(this,y+3,y+4);return this},l.prototype.toString=function(){const m=this.length;return m===0?"":arguments.length===0?j(this,0,m):C.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(m){if(!l.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m?!0:l.compare(this,m)===0},l.prototype.inspect=function(){let m="";const y=e.INSPECT_MAX_BYTES;return m=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(m+=" ... "),"<Buffer "+m+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(m,y,R,F,Z){if(ft(m,s)&&(m=l.from(m,m.offset,m.byteLength)),!l.isBuffer(m))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof m);if(y===void 0&&(y=0),R===void 0&&(R=m?m.length:0),F===void 0&&(F=0),Z===void 0&&(Z=this.length),y<0||R>m.length||F<0||Z>this.length)throw new RangeError("out of range index");if(F>=Z&&y>=R)return 0;if(F>=Z)return-1;if(y>=R)return 1;if(y>>>=0,R>>>=0,F>>>=0,Z>>>=0,this===m)return 0;let nt=Z-F,Ft=R-y;const ye=Math.min(nt,Ft),me=this.slice(F,Z),_e=m.slice(y,R);for(let oe=0;oe<ye;++oe)if(me[oe]!==_e[oe]){nt=me[oe],Ft=_e[oe];break}return nt<Ft?-1:Ft<nt?1:0};function M(x,m,y,R,F){if(x.length===0)return-1;if(typeof y=="string"?(R=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=F?0:x.length-1),y<0&&(y=x.length+y),y>=x.length){if(F)return-1;y=x.length-1}else if(y<0)if(F)y=0;else return-1;if(typeof m=="string"&&(m=l.from(m,R)),l.isBuffer(m))return m.length===0?-1:et(x,m,y,R,F);if(typeof m=="number")return m=m&255,typeof s.prototype.indexOf=="function"?F?s.prototype.indexOf.call(x,m,y):s.prototype.lastIndexOf.call(x,m,y):et(x,[m],y,R,F);throw new TypeError("val must be string, number or Buffer")}function et(x,m,y,R,F){let Z=1,nt=x.length,Ft=m.length;if(R!==void 0&&(R=String(R).toLowerCase(),R==="ucs2"||R==="ucs-2"||R==="utf16le"||R==="utf-16le")){if(x.length<2||m.length<2)return-1;Z=2,nt/=2,Ft/=2,y/=2}function ye(_e,oe){return Z===1?_e[oe]:_e.readUInt16BE(oe*Z)}let me;if(F){let _e=-1;for(me=y;me<nt;me++)if(ye(x,me)===ye(m,_e===-1?0:me-_e)){if(_e===-1&&(_e=me),me-_e+1===Ft)return _e*Z}else _e!==-1&&(me-=me-_e),_e=-1}else for(y+Ft>nt&&(y=nt-Ft),me=y;me>=0;me--){let _e=!0;for(let oe=0;oe<Ft;oe++)if(ye(x,me+oe)!==ye(m,oe)){_e=!1;break}if(_e)return me}return-1}l.prototype.includes=function(m,y,R){return this.indexOf(m,y,R)!==-1},l.prototype.indexOf=function(m,y,R){return M(this,m,y,R,!0)},l.prototype.lastIndexOf=function(m,y,R){return M(this,m,y,R,!1)};function pt(x,m,y,R){y=Number(y)||0;const F=x.length-y;R?(R=Number(R),R>F&&(R=F)):R=F;const Z=m.length;R>Z/2&&(R=Z/2);let nt;for(nt=0;nt<R;++nt){const Ft=parseInt(m.substr(nt*2,2),16);if(vt(Ft))return nt;x[y+nt]=Ft}return nt}function U(x,m,y,R){return bt(ot(m,x.length-y),x,y,R)}function S(x,m,y,R){return bt(lt(m),x,y,R)}function _(x,m,y,R){return bt(dt(m),x,y,R)}function B(x,m,y,R){return bt(J(m,x.length-y),x,y,R)}l.prototype.write=function(m,y,R,F){if(y===void 0)F="utf8",R=this.length,y=0;else if(R===void 0&&typeof y=="string")F=y,R=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(R)?(R=R>>>0,F===void 0&&(F="utf8")):(F=R,R=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Z=this.length-y;if((R===void 0||R>Z)&&(R=Z),m.length>0&&(R<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");F||(F="utf8");let nt=!1;for(;;)switch(F){case"hex":return pt(this,m,y,R);case"utf8":case"utf-8":return U(this,m,y,R);case"ascii":case"latin1":case"binary":return S(this,m,y,R);case"base64":return _(this,m,y,R);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,m,y,R);default:if(nt)throw new TypeError("Unknown encoding: "+F);F=(""+F).toLowerCase(),nt=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(x,m,y){return m===0&&y===x.length?t.fromByteArray(x):t.fromByteArray(x.slice(m,y))}function j(x,m,y){y=Math.min(x.length,y);const R=[];let F=m;for(;F<y;){const Z=x[F];let nt=null,Ft=Z>239?4:Z>223?3:Z>191?2:1;if(F+Ft<=y){let ye,me,_e,oe;switch(Ft){case 1:Z<128&&(nt=Z);break;case 2:ye=x[F+1],(ye&192)===128&&(oe=(Z&31)<<6|ye&63,oe>127&&(nt=oe));break;case 3:ye=x[F+1],me=x[F+2],(ye&192)===128&&(me&192)===128&&(oe=(Z&15)<<12|(ye&63)<<6|me&63,oe>2047&&(oe<55296||oe>57343)&&(nt=oe));break;case 4:ye=x[F+1],me=x[F+2],_e=x[F+3],(ye&192)===128&&(me&192)===128&&(_e&192)===128&&(oe=(Z&15)<<18|(ye&63)<<12|(me&63)<<6|_e&63,oe>65535&&oe<1114112&&(nt=oe))}}nt===null?(nt=65533,Ft=1):nt>65535&&(nt-=65536,R.push(nt>>>10&1023|55296),nt=56320|nt&1023),R.push(nt),F+=Ft}return Q(R)}const ht=4096;function Q(x){const m=x.length;if(m<=ht)return String.fromCharCode.apply(String,x);let y="",R=0;for(;R<m;)y+=String.fromCharCode.apply(String,x.slice(R,R+=ht));return y}function ut(x,m,y){let R="";y=Math.min(x.length,y);for(let F=m;F<y;++F)R+=String.fromCharCode(x[F]&127);return R}function G(x,m,y){let R="";y=Math.min(x.length,y);for(let F=m;F<y;++F)R+=String.fromCharCode(x[F]);return R}function $(x,m,y){const R=x.length;(!m||m<0)&&(m=0),(!y||y<0||y>R)&&(y=R);let F="";for(let Z=m;Z<y;++Z)F+=le[x[Z]];return F}function yt(x,m,y){const R=x.slice(m,y);let F="";for(let Z=0;Z<R.length-1;Z+=2)F+=String.fromCharCode(R[Z]+R[Z+1]*256);return F}l.prototype.slice=function(m,y){const R=this.length;m=~~m,y=y===void 0?R:~~y,m<0?(m+=R,m<0&&(m=0)):m>R&&(m=R),y<0?(y+=R,y<0&&(y=0)):y>R&&(y=R),y<m&&(y=m);const F=this.subarray(m,y);return Object.setPrototypeOf(F,l.prototype),F};function st(x,m,y){if(x%1!==0||x<0)throw new RangeError("offset is not uint");if(x+m>y)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(m,y,R){m=m>>>0,y=y>>>0,R||st(m,y,this.length);let F=this[m],Z=1,nt=0;for(;++nt<y&&(Z*=256);)F+=this[m+nt]*Z;return F},l.prototype.readUintBE=l.prototype.readUIntBE=function(m,y,R){m=m>>>0,y=y>>>0,R||st(m,y,this.length);let F=this[m+--y],Z=1;for(;y>0&&(Z*=256);)F+=this[m+--y]*Z;return F},l.prototype.readUint8=l.prototype.readUInt8=function(m,y){return m=m>>>0,y||st(m,1,this.length),this[m]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(m,y){return m=m>>>0,y||st(m,2,this.length),this[m]|this[m+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(m,y){return m=m>>>0,y||st(m,2,this.length),this[m]<<8|this[m+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(m,y){return m=m>>>0,y||st(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+this[m+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]*16777216+(this[m+1]<<16|this[m+2]<<8|this[m+3])},l.prototype.readBigUInt64LE=Pt(function(m){m=m>>>0,tt(m,"offset");const y=this[m],R=this[m+7];(y===void 0||R===void 0)&&N(m,this.length-8);const F=y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24,Z=this[++m]+this[++m]*2**8+this[++m]*2**16+R*2**24;return BigInt(F)+(BigInt(Z)<<BigInt(32))}),l.prototype.readBigUInt64BE=Pt(function(m){m=m>>>0,tt(m,"offset");const y=this[m],R=this[m+7];(y===void 0||R===void 0)&&N(m,this.length-8);const F=y*2**24+this[++m]*2**16+this[++m]*2**8+this[++m],Z=this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+R;return(BigInt(F)<<BigInt(32))+BigInt(Z)}),l.prototype.readIntLE=function(m,y,R){m=m>>>0,y=y>>>0,R||st(m,y,this.length);let F=this[m],Z=1,nt=0;for(;++nt<y&&(Z*=256);)F+=this[m+nt]*Z;return Z*=128,F>=Z&&(F-=Math.pow(2,8*y)),F},l.prototype.readIntBE=function(m,y,R){m=m>>>0,y=y>>>0,R||st(m,y,this.length);let F=y,Z=1,nt=this[m+--F];for(;F>0&&(Z*=256);)nt+=this[m+--F]*Z;return Z*=128,nt>=Z&&(nt-=Math.pow(2,8*y)),nt},l.prototype.readInt8=function(m,y){return m=m>>>0,y||st(m,1,this.length),this[m]&128?(255-this[m]+1)*-1:this[m]},l.prototype.readInt16LE=function(m,y){m=m>>>0,y||st(m,2,this.length);const R=this[m]|this[m+1]<<8;return R&32768?R|4294901760:R},l.prototype.readInt16BE=function(m,y){m=m>>>0,y||st(m,2,this.length);const R=this[m+1]|this[m]<<8;return R&32768?R|4294901760:R},l.prototype.readInt32LE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},l.prototype.readInt32BE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},l.prototype.readBigInt64LE=Pt(function(m){m=m>>>0,tt(m,"offset");const y=this[m],R=this[m+7];(y===void 0||R===void 0)&&N(m,this.length-8);const F=this[m+4]+this[m+5]*2**8+this[m+6]*2**16+(R<<24);return(BigInt(F)<<BigInt(32))+BigInt(y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24)}),l.prototype.readBigInt64BE=Pt(function(m){m=m>>>0,tt(m,"offset");const y=this[m],R=this[m+7];(y===void 0||R===void 0)&&N(m,this.length-8);const F=(y<<24)+this[++m]*2**16+this[++m]*2**8+this[++m];return(BigInt(F)<<BigInt(32))+BigInt(this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+R)}),l.prototype.readFloatLE=function(m,y){return m=m>>>0,y||st(m,4,this.length),n.read(this,m,!0,23,4)},l.prototype.readFloatBE=function(m,y){return m=m>>>0,y||st(m,4,this.length),n.read(this,m,!1,23,4)},l.prototype.readDoubleLE=function(m,y){return m=m>>>0,y||st(m,8,this.length),n.read(this,m,!0,52,8)},l.prototype.readDoubleBE=function(m,y){return m=m>>>0,y||st(m,8,this.length),n.read(this,m,!1,52,8)};function at(x,m,y,R,F,Z){if(!l.isBuffer(x))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>F||m<Z)throw new RangeError('"value" argument is out of bounds');if(y+R>x.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(m,y,R,F){if(m=+m,y=y>>>0,R=R>>>0,!F){const Ft=Math.pow(2,8*R)-1;at(this,m,y,R,Ft,0)}let Z=1,nt=0;for(this[y]=m&255;++nt<R&&(Z*=256);)this[y+nt]=m/Z&255;return y+R},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(m,y,R,F){if(m=+m,y=y>>>0,R=R>>>0,!F){const Ft=Math.pow(2,8*R)-1;at(this,m,y,R,Ft,0)}let Z=R-1,nt=1;for(this[y+Z]=m&255;--Z>=0&&(nt*=256);)this[y+Z]=m/nt&255;return y+R},l.prototype.writeUint8=l.prototype.writeUInt8=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,1,255,0),this[y]=m&255,y+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,2,65535,0),this[y]=m&255,this[y+1]=m>>>8,y+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,2,65535,0),this[y]=m>>>8,this[y+1]=m&255,y+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,4,4294967295,0),this[y+3]=m>>>24,this[y+2]=m>>>16,this[y+1]=m>>>8,this[y]=m&255,y+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,4,4294967295,0),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4};function Ut(x,m,y,R,F){rt(m,R,F,x,y,7);let Z=Number(m&BigInt(4294967295));x[y++]=Z,Z=Z>>8,x[y++]=Z,Z=Z>>8,x[y++]=Z,Z=Z>>8,x[y++]=Z;let nt=Number(m>>BigInt(32)&BigInt(4294967295));return x[y++]=nt,nt=nt>>8,x[y++]=nt,nt=nt>>8,x[y++]=nt,nt=nt>>8,x[y++]=nt,y}function Wt(x,m,y,R,F){rt(m,R,F,x,y,7);let Z=Number(m&BigInt(4294967295));x[y+7]=Z,Z=Z>>8,x[y+6]=Z,Z=Z>>8,x[y+5]=Z,Z=Z>>8,x[y+4]=Z;let nt=Number(m>>BigInt(32)&BigInt(4294967295));return x[y+3]=nt,nt=nt>>8,x[y+2]=nt,nt=nt>>8,x[y+1]=nt,nt=nt>>8,x[y]=nt,y+8}l.prototype.writeBigUInt64LE=Pt(function(m,y=0){return Ut(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Pt(function(m,y=0){return Wt(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(m,y,R,F){if(m=+m,y=y>>>0,!F){const ye=Math.pow(2,8*R-1);at(this,m,y,R,ye-1,-ye)}let Z=0,nt=1,Ft=0;for(this[y]=m&255;++Z<R&&(nt*=256);)m<0&&Ft===0&&this[y+Z-1]!==0&&(Ft=1),this[y+Z]=(m/nt>>0)-Ft&255;return y+R},l.prototype.writeIntBE=function(m,y,R,F){if(m=+m,y=y>>>0,!F){const ye=Math.pow(2,8*R-1);at(this,m,y,R,ye-1,-ye)}let Z=R-1,nt=1,Ft=0;for(this[y+Z]=m&255;--Z>=0&&(nt*=256);)m<0&&Ft===0&&this[y+Z+1]!==0&&(Ft=1),this[y+Z]=(m/nt>>0)-Ft&255;return y+R},l.prototype.writeInt8=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,1,127,-128),m<0&&(m=255+m+1),this[y]=m&255,y+1},l.prototype.writeInt16LE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,2,32767,-32768),this[y]=m&255,this[y+1]=m>>>8,y+2},l.prototype.writeInt16BE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,2,32767,-32768),this[y]=m>>>8,this[y+1]=m&255,y+2},l.prototype.writeInt32LE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,4,2147483647,-2147483648),this[y]=m&255,this[y+1]=m>>>8,this[y+2]=m>>>16,this[y+3]=m>>>24,y+4},l.prototype.writeInt32BE=function(m,y,R){return m=+m,y=y>>>0,R||at(this,m,y,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4},l.prototype.writeBigInt64LE=Pt(function(m,y=0){return Ut(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Pt(function(m,y=0){return Wt(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ot(x,m,y,R,F,Z){if(y+R>x.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function Rt(x,m,y,R,F){return m=+m,y=y>>>0,F||Ot(x,m,y,4),n.write(x,m,y,R,23,4),y+4}l.prototype.writeFloatLE=function(m,y,R){return Rt(this,m,y,!0,R)},l.prototype.writeFloatBE=function(m,y,R){return Rt(this,m,y,!1,R)};function Lt(x,m,y,R,F){return m=+m,y=y>>>0,F||Ot(x,m,y,8),n.write(x,m,y,R,52,8),y+8}l.prototype.writeDoubleLE=function(m,y,R){return Lt(this,m,y,!0,R)},l.prototype.writeDoubleBE=function(m,y,R){return Lt(this,m,y,!1,R)},l.prototype.copy=function(m,y,R,F){if(!l.isBuffer(m))throw new TypeError("argument should be a Buffer");if(R||(R=0),!F&&F!==0&&(F=this.length),y>=m.length&&(y=m.length),y||(y=0),F>0&&F<R&&(F=R),F===R||m.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(R<0||R>=this.length)throw new RangeError("Index out of range");if(F<0)throw new RangeError("sourceEnd out of bounds");F>this.length&&(F=this.length),m.length-y<F-R&&(F=m.length-y+R);const Z=F-R;return this===m&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,R,F):s.prototype.set.call(m,this.subarray(R,F),y),Z},l.prototype.fill=function(m,y,R,F){if(typeof m=="string"){if(typeof y=="string"?(F=y,y=0,R=this.length):typeof R=="string"&&(F=R,R=this.length),F!==void 0&&typeof F!="string")throw new TypeError("encoding must be a string");if(typeof F=="string"&&!l.isEncoding(F))throw new TypeError("Unknown encoding: "+F);if(m.length===1){const nt=m.charCodeAt(0);(F==="utf8"&&nt<128||F==="latin1")&&(m=nt)}}else typeof m=="number"?m=m&255:typeof m=="boolean"&&(m=Number(m));if(y<0||this.length<y||this.length<R)throw new RangeError("Out of range index");if(R<=y)return this;y=y>>>0,R=R===void 0?this.length:R>>>0,m||(m=0);let Z;if(typeof m=="number")for(Z=y;Z<R;++Z)this[Z]=m;else{const nt=l.isBuffer(m)?m:l.from(m,F),Ft=nt.length;if(Ft===0)throw new TypeError('The value "'+m+'" is invalid for argument "value"');for(Z=0;Z<R-y;++Z)this[Z+y]=nt[Z%Ft]}return this};const Nt={};function ne(x,m,y){Nt[x]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:m.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${x}]`,this.stack,delete this.name}get code(){return x}set code(F){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:F,writable:!0})}toString(){return`${this.name} [${x}]: ${this.message}`}}}ne("ERR_BUFFER_OUT_OF_BOUNDS",function(x){return x?`${x} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ne("ERR_INVALID_ARG_TYPE",function(x,m){return`The "${x}" argument must be of type number. Received type ${typeof m}`},TypeError),ne("ERR_OUT_OF_RANGE",function(x,m,y){let R=`The value of "${x}" is out of range.`,F=y;return Number.isInteger(y)&&Math.abs(y)>2**32?F=Re(String(y)):typeof y=="bigint"&&(F=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(F=Re(F)),F+="n"),R+=` It must be ${m}. Received ${F}`,R},RangeError);function Re(x){let m="",y=x.length;const R=x[0]==="-"?1:0;for(;y>=R+4;y-=3)m=`_${x.slice(y-3,y)}${m}`;return`${x.slice(0,y)}${m}`}function b(x,m,y){tt(m,"offset"),(x[m]===void 0||x[m+y]===void 0)&&N(m,x.length-(y+1))}function rt(x,m,y,R,F,Z){if(x>y||x<m){const nt=typeof m=="bigint"?"n":"";let Ft;throw m===0||m===BigInt(0)?Ft=`>= 0${nt} and < 2${nt} ** ${(Z+1)*8}${nt}`:Ft=`>= -(2${nt} ** ${(Z+1)*8-1}${nt}) and < 2 ** ${(Z+1)*8-1}${nt}`,new Nt.ERR_OUT_OF_RANGE("value",Ft,x)}b(R,F,Z)}function tt(x,m){if(typeof x!="number")throw new Nt.ERR_INVALID_ARG_TYPE(m,"number",x)}function N(x,m,y){throw Math.floor(x)!==x?(tt(x,y),new Nt.ERR_OUT_OF_RANGE("offset","an integer",x)):m<0?new Nt.ERR_BUFFER_OUT_OF_BOUNDS:new Nt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${m}`,x)}const I=/[^+/0-9A-Za-z-_]/g;function K(x){if(x=x.split("=")[0],x=x.trim().replace(I,""),x.length<2)return"";for(;x.length%4!==0;)x=x+"=";return x}function ot(x,m){m=m||1/0;let y;const R=x.length;let F=null;const Z=[];for(let nt=0;nt<R;++nt){if(y=x.charCodeAt(nt),y>55295&&y<57344){if(!F){if(y>56319){(m-=3)>-1&&Z.push(239,191,189);continue}else if(nt+1===R){(m-=3)>-1&&Z.push(239,191,189);continue}F=y;continue}if(y<56320){(m-=3)>-1&&Z.push(239,191,189),F=y;continue}y=(F-55296<<10|y-56320)+65536}else F&&(m-=3)>-1&&Z.push(239,191,189);if(F=null,y<128){if((m-=1)<0)break;Z.push(y)}else if(y<2048){if((m-=2)<0)break;Z.push(y>>6|192,y&63|128)}else if(y<65536){if((m-=3)<0)break;Z.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((m-=4)<0)break;Z.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Z}function lt(x){const m=[];for(let y=0;y<x.length;++y)m.push(x.charCodeAt(y)&255);return m}function J(x,m){let y,R,F;const Z=[];for(let nt=0;nt<x.length&&!((m-=2)<0);++nt)y=x.charCodeAt(nt),R=y>>8,F=y%256,Z.push(F),Z.push(R);return Z}function dt(x){return t.toByteArray(K(x))}function bt(x,m,y,R){let F;for(F=0;F<R&&!(F+y>=m.length||F>=x.length);++F)m[F+y]=x[F];return F}function ft(x,m){return x instanceof m||x!=null&&x.constructor!=null&&x.constructor.name!=null&&x.constructor.name===m.name}function vt(x){return x!==x}const le=function(){const x="0123456789abcdef",m=new Array(256);for(let y=0;y<16;++y){const R=y*16;for(let F=0;F<16;++F)m[R+F]=x[y]+x[F]}return m}();function Pt(x){return typeof BigInt>"u"?In:x}function In(){throw new Error("BigInt not supported")}})(yp);const tn=yp.Buffer;function HE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var bp={exports:{}},Oe=bp.exports={},br,wr;function Nu(){throw new Error("setTimeout has not been defined")}function Cu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?br=setTimeout:br=Nu}catch{br=Nu}try{typeof clearTimeout=="function"?wr=clearTimeout:wr=Cu}catch{wr=Cu}})();function wp(e){if(br===setTimeout)return setTimeout(e,0);if((br===Nu||!br)&&setTimeout)return br=setTimeout,setTimeout(e,0);try{return br(e,0)}catch{try{return br.call(null,e,0)}catch{return br.call(this,e,0)}}}function YE(e){if(wr===clearTimeout)return clearTimeout(e);if((wr===Cu||!wr)&&clearTimeout)return wr=clearTimeout,clearTimeout(e);try{return wr(e)}catch{try{return wr.call(null,e)}catch{return wr.call(this,e)}}}var Yr=[],Ls=!1,Zi,za=-1;function VE(){!Ls||!Zi||(Ls=!1,Zi.length?Yr=Zi.concat(Yr):za=-1,Yr.length&&Ep())}function Ep(){if(!Ls){var e=wp(VE);Ls=!0;for(var t=Yr.length;t;){for(Zi=Yr,Yr=[];++za<t;)Zi&&Zi[za].run();za=-1,t=Yr.length}Zi=null,Ls=!1,YE(e)}}Oe.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Yr.push(new kp(e,t)),Yr.length===1&&!Ls&&wp(Ep)};function kp(e,t){this.fun=e,this.array=t}kp.prototype.run=function(){this.fun.apply(null,this.array)},Oe.title="browser",Oe.browser=!0,Oe.env={},Oe.argv=[],Oe.version="",Oe.versions={};function Vr(){}Oe.on=Vr,Oe.addListener=Vr,Oe.once=Vr,Oe.off=Vr,Oe.removeListener=Vr,Oe.removeAllListeners=Vr,Oe.emit=Vr,Oe.prependListener=Vr,Oe.prependOnceListener=Vr,Oe.listeners=function(e){return[]},Oe.binding=function(e){throw new Error("process.binding is not supported")},Oe.cwd=function(){return"/"},Oe.chdir=function(e){throw new Error("process.chdir is not supported")},Oe.umask=function(){return 0};var qE=bp.exports;const xi=HE(qE),Tp=e=>e===void 0?null:e;class JE{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let vp=new JE,XE=!0;try{typeof localStorage<"u"&&localStorage&&(vp=localStorage,XE=!1)}catch{}const ZE=vp,QE=Object.assign,tk=Object.keys,ek=(e,t)=>{for(const n in e)t(e[n],n)},xp=e=>tk(e).length,nk=e=>{for(const t in e)return!1;return!0},rk=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},ik=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),sk=(e,t)=>e===t||xp(e)===xp(t)&&rk(e,(n,r)=>(n!==void 0||ik(t,r))&&t[r]===n),ok=Object.freeze,Ap=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&Ap(e[t])}return ok(e)},Lu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Lu(e,t,n+1)}},ak=e=>e,ck=(e,t)=>t.includes(e);var Sp={};const xo=typeof xi<"u"&&xi.release&&/node|io\.js/.test(xi.release.name)&&Object.prototype.toString.call(typeof xi<"u"?xi:0)==="[object process]";let Er;const lk=()=>{if(Er===void 0)if(xo){Er=er();const e=xi.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Er.set(t,""),t=r):t!==null&&(Er.set(t,r),t=null)}t!==null&&Er.set(t,"")}else typeof location=="object"?(Er=er(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Er.set(`--${ap(t,"-")}`,n),Er.set(`-${ap(t,"-")}`,n)}})):Er=er();return Er},Mu=e=>lk().has(e),Ka=e=>Tp(xo?Sp[e.toUpperCase().replaceAll("-","_")]:ZE.getItem(e)),Rp=e=>Mu("--"+e)||Ka(e)!==null;Rp("production");const uk=xo&&ck(Sp.FORCE_COLOR,["true","1","2"])||!Mu("--no-colors")&&!Rp("no-color")&&(!xo||xi.stdout.isTTY)&&(!xo||Mu("--color")||Ka("COLORTERM")!==null||(Ka("TERM")||"").includes("color")),hk=e=>new Uint8Array(e),fk=e=>{const t=hk(e.byteLength);return t.set(e),t};class dk{constructor(t,n){this.left=t,this.right=n}}const qr=(e,t)=>new dk(e,t);typeof DOMParser<"u"&&new DOMParser;const pk=e=>cE(e,(t,n)=>`${n}:${t};`).join(""),Jr=Symbol,Ip=Jr(),Op=Jr(),mk=Jr(),gk=Jr(),yk=Jr(),Np=Jr(),_k=Jr(),Uu=Jr(),bk=Jr(),wk=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},Ek={[Ip]:qr("font-weight","bold"),[Op]:qr("font-weight","normal"),[mk]:qr("color","blue"),[yk]:qr("color","green"),[gk]:qr("color","grey"),[Np]:qr("color","red"),[_k]:qr("color","purple"),[Uu]:qr("color","orange"),[bk]:qr("color","black")},Cp=uk?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=er();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=Ek[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=pk(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:wk,kk=(...e)=>{console.log(...Cp(e)),Lp.forEach(t=>t.print(e))},Tk=(...e)=>{console.warn(...Cp(e)),e.unshift(Uu),Lp.forEach(t=>t.print(e))},Lp=Rs(),Mp=e=>({[Symbol.iterator](){return this},next:e}),vk=(e,t)=>Mp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Pu=(e,t)=>Mp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Bu{constructor(t,n){this.clock=t,this.len=n}}class Ao{constructor(){this.clients=new Map}}const Up=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Qp(e,s,a.clock,a.len,n)}}),xk=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=ki((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},Pp=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&xk(n,t.clock)!==null},Fu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=qi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},Ak=e=>{const t=new Ao;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)uE(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Fu(t),t},Wa=(e,t,n,r)=>{wi(e.clients,t,()=>[]).push(new Bu(n,r))},Sk=()=>new Ao,Rk=e=>{const t=Sk();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new Bu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Ms=(e,t)=>{Dt(e.restEncoder,t.clients.size),Ei(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),Dt(e.restEncoder,n);const i=r.length;Dt(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Du=e=>{const t=new Ao,n=$t(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=$t(e.restDecoder),s=$t(e.restDecoder);if(s>0){const o=wi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Bu(e.readDsClock(),e.readDsLen()))}}return t},Bp=(e,t,n)=>{const r=new Ao,i=$t(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=$t(e.restDecoder),a=$t(e.restDecoder),c=n.clients.get(o)||[],u=qe(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<u){u<f&&Wa(r,o,u,f-u);let d=rr(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,rc(t,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,rc(t,p,f-p.id.clock)),p.delete(t))}else Wa(r,o,h,f-h)}}if(r.clients.size>0){const s=new Qi;return Dt(s.restEncoder,0),Ms(s,r),s.toUint8Array()}return null},Fp=mp;class Xr extends fE{constructor({guid:t=BE(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Fp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Jp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=gp(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>gp(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&ue(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ei(this.subdocs).map(t=>t.guid))}transact(t,n=null){return ue(this,t,n)}get(t,n=xe){const r=wi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==xe&&i!==n)if(i===xe){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,kr)}getText(t=""){return this.get(t,ir)}getMap(t=""){return this.get(t,Tr)}getXmlElement(t=""){return this.get(t,Zr)}getXmlFragment(t=""){return this.get(t,vr)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Ei(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Xr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,ue(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Dp{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return $t(this.restDecoder)}readDsLen(){return $t(this.restDecoder)}}class $p extends Dp{readLeftID(){return Vt($t(this.restDecoder),$t(this.restDecoder))}readRightID(){return Vt($t(this.restDecoder),$t(this.restDecoder))}readClient(){return $t(this.restDecoder)}readInfo(){return Os(this.restDecoder)}readString(){return Ns(this.restDecoder)}readParentInfo(){return $t(this.restDecoder)===1}readTypeRef(){return $t(this.restDecoder)}readLen(){return $t(this.restDecoder)}readAny(){return vo(this.restDecoder)}readBuf(){return fk(cn(this.restDecoder))}readJSON(){return JSON.parse(Ns(this.restDecoder))}readKey(){return Ns(this.restDecoder)}}class Ik{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=$t(this.restDecoder),this.dsCurrVal}readDsLen(){const t=$t(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Us extends Ik{constructor(t){super(t),this.keys=[],$t(t),this.keyClockDecoder=new Ru(cn(t)),this.clientDecoder=new $a(cn(t)),this.leftClockDecoder=new Ru(cn(t)),this.rightClockDecoder=new Ru(cn(t)),this.infoDecoder=new pp(cn(t),Os),this.stringDecoder=new ME(cn(t)),this.parentInfoDecoder=new pp(cn(t),Os),this.typeRefDecoder=new $a(cn(t)),this.lenDecoder=new $a(cn(t))}readLeftID(){return new Ps(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ps(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return vo(this.restDecoder)}readBuf(){return cn(this.restDecoder)}readJSON(){return vo(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class jp{constructor(){this.restEncoder=Ti()}toUint8Array(){return nr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){Dt(this.restEncoder,t)}writeDsLen(t){Dt(this.restEncoder,t)}}class So extends jp{writeLeftID(t){Dt(this.restEncoder,t.client),Dt(this.restEncoder,t.clock)}writeRightID(t){Dt(this.restEncoder,t.client),Dt(this.restEncoder,t.clock)}writeClient(t){Dt(this.restEncoder,t)}writeInfo(t){Eu(this.restEncoder,t)}writeString(t){Is(this.restEncoder,t)}writeParentInfo(t){Dt(this.restEncoder,t?1:0)}writeTypeRef(t){Dt(this.restEncoder,t)}writeLen(t){Dt(this.restEncoder,t)}writeAny(t){To(this.restEncoder,t)}writeBuf(t){rn(this.restEncoder,t)}writeJSON(t){Is(this.restEncoder,JSON.stringify(t))}writeKey(t){Is(this.restEncoder,t)}}class zp{constructor(){this.restEncoder=Ti(),this.dsCurrVal=0}toUint8Array(){return nr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,Dt(this.restEncoder,n)}writeDsLen(t){t===0&&yr(),Dt(this.restEncoder,t-1),this.dsCurrVal+=t}}class Qi extends zp{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new xu,this.clientEncoder=new Fa,this.leftClockEncoder=new xu,this.rightClockEncoder=new xu,this.infoEncoder=new lp(Eu),this.stringEncoder=new OE,this.parentInfoEncoder=new lp(Eu),this.typeRefEncoder=new Fa,this.lenEncoder=new Fa}toUint8Array(){const t=Ti();return Dt(t,0),rn(t,this.keyClockEncoder.toUint8Array()),rn(t,this.clientEncoder.toUint8Array()),rn(t,this.leftClockEncoder.toUint8Array()),rn(t,this.rightClockEncoder.toUint8Array()),rn(t,nr(this.infoEncoder)),rn(t,this.stringEncoder.toUint8Array()),rn(t,nr(this.parentInfoEncoder)),rn(t,this.typeRefEncoder.toUint8Array()),rn(t,this.lenEncoder.toUint8Array()),Ba(t,nr(this.restEncoder)),nr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){To(this.restEncoder,t)}writeBuf(t){rn(this.restEncoder,t)}writeJSON(t){To(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Ok=(e,t,n,r)=>{r=qi(r,t[0].id.clock);const i=rr(t,r);Dt(e.restEncoder,t.length-i),e.writeClient(n),Dt(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},$u=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{qe(t,s)>i&&r.set(s,i)}),Ha(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Dt(e.restEncoder,r.size),Ei(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Ok(e,t.clients.get(i),i,s)})},Nk=(e,t)=>{const n=er(),r=$t(e.restDecoder);for(let i=0;i<r;i++){const s=$t(e.restDecoder),o=new Array(s),a=e.readClient();let c=$t(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Pa&l){case 0:{const h=e.readLen();o[u]=new Cn(Vt(a,c),h),c+=h;break}case 10:{const h=$t(e.restDecoder);o[u]=new Wn(Vt(a,c),h),c+=h;break}default:{const h=(l&(Hr|Nn))===0,f=new je(Vt(a,c),null,(l&Nn)===Nn?e.readLeftID():null,null,(l&Hr)===Hr?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&bo)===bo?e.readString():null,v0(e,l));o[u]=f,c+=f.length}}}}return n},Ck=(e,t,n)=>{const r=[];let i=Ei(n.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=n.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=n.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new Jp,c=new Map,u=(d,p)=>{const g=c.get(d);(g==null||g>p)&&c.set(d,p)};let l=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,g=n.get(p);g?(g.i--,a.clients.set(p,g.refs.slice(g.i)),n.delete(p),g.i=0,g.refs=[]):a.clients.set(p,[d]),i=i.filter(k=>k!==p)}r.length=0};for(;;){if(l.constructor!==Wn){const p=wi(h,l.id.client,()=>qe(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{const g=l.getMissing(e,t);if(g!==null){r.push(l);const k=n.get(g)||{refs:[],i:0};if(k.refs.length===k.i)u(g,qe(t,g)),f();else{l=k.refs[k.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const d=new Qi;return $u(d,a,new Map),Dt(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},Lk=(e,t)=>$u(e,t.doc.store,t.beforeState),Mk=(e,t,n,r=new Us(e))=>ue(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=Nk(r,o),u=Ck(i,a,c),l=a.pendingStructs;if(l){for(const[f,d]of l.missing)if(d<qe(a,f)){s=!0;break}if(u){for(const[f,d]of u.missing){const p=l.missing.get(f);(p==null||p>d)&&l.missing.set(f,d)}l.update=Va([l.update,u.update])}}else a.pendingStructs=u;const h=Bp(r,i,a);if(a.pendingDs){const f=new Us(Xi(a.pendingDs));$t(f.restDecoder);const d=Bp(f,i,a);h&&d?a.pendingDs=Va([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,Kp(i.doc,f)}},n,!1),Kp=(e,t,n,r=Us)=>{const i=Xi(t);Mk(i,e,n,new r(i))},Uk=(e,t,n)=>Kp(e,t,n,$p),Pk=(e,t,n=new Map)=>{$u(e,t.store,n),Ms(e,Rk(t.store))},Bk=(e,t=new Uint8Array([0]),n=new Qi)=>{const r=Wp(t);Pk(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Zk(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===So)return Jk(i.map((s,o)=>o===0?s:tT(s)));if(n.constructor===Qi)return Va(i)}return i[0]},Fk=(e,t)=>Bk(e,t,new So),Dk=e=>{const t=new Map,n=$t(e.restDecoder);for(let r=0;r<n;r++){const i=$t(e.restDecoder),s=$t(e.restDecoder);t.set(i,s)}return t},Wp=e=>Dk(new Dp(Xi(e))),Gp=(e,t)=>(Dt(e.restEncoder,t.size),Ei(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Dt(e.restEncoder,n),Dt(e.restEncoder,r)}),e),$k=(e,t)=>Gp(e,Ha(t.store)),jk=(e,t=new zp)=>(e instanceof Map?Gp(t,e):$k(t,e),t.toUint8Array()),zk=e=>jk(e,new jp);class Kk{constructor(){this.l=[]}}const Hp=()=>new Kk,Yp=(e,t)=>e.l.push(t),Vp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},qp=(e,t,n)=>Lu(e.l,[t,n]);class Ps{constructor(t,n){this.client=t,this.clock=n}}const Ga=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Vt=(e,t)=>new Ps(e,t),Wk=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw yr()},Bs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Pp(t.ds,e.id),ju=(e,t)=>{const n=wi(e.meta,ju,Rs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<qe(r,s)&&Ai(e,Vt(s,i))}),Up(e,t.ds,i=>{}),n.add(t))};class Jp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ha=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},qe=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Xp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw yr()}n.push(t)},rr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=ki(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=ki((n+r)/2)}throw yr()},zu=(e,t)=>{const n=e.clients.get(t.client);return n[rr(n,t.clock)]},Ku=(e,t,n)=>{const r=rr(t,n),i=t[r];return i.id.clock<n&&i instanceof je?(t.splice(r+1,0,rc(e,i,n-i.id.clock)),r+1):r},Ai=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Ku(e,n,t.clock)]},Zp=(e,t,n)=>{const r=t.clients.get(n.client),i=rr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Cn&&r.splice(i+1,0,rc(e,s,n.clock-s.id.clock+1)),s},Gk=(e,t,n)=>{const r=e.clients.get(t.id.client);r[rr(r,t.id.clock)]=n},Qp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Ku(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Ku(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class Hk{constructor(t,n,r){this.doc=t,this.deleteSet=new Ao,this.beforeState=Ha(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const t0=(e,t)=>t.deleteSet.clients.size===0&&!lE(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Fu(t.deleteSet),Lk(e,t),Ms(e,t.deleteSet),!0),e0=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&wi(e.changed,t,Rs).add(n)},Ya=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof je&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},Yk=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=rr(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof je&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Vk=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=np(i.length-1,1+rr(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Ya(i,c)}})},n0=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Fu(s),n.afterState=Ha(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),qp(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Lu(a,[]),n._needFormattingCleanup&&pT(n)}finally{r.gc&&Yk(s,i,r.gcFilter),Vk(s,i),n.afterState.forEach((l,h)=>{const f=n.beforeState.get(h)||0;if(f!==l){const d=i.clients.get(h),p=qi(rr(d,f),1);for(let g=d.length-1;g>=p;)g-=1+Ya(d,g)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:f}=o[l].id,d=i.clients.get(h),p=rr(d,f);p+1<d.length&&Ya(d,p+1)>1||p>0&&Ya(d,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(kk(Uu,Ip,"[yjs] ",Op,Np,"Changed the client-id because another client seems to be using it."),r.clientID=Fp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new So;t0(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new Qi;t0(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):n0(e,t+1)}}},ue=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new Hk(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&n0(i,0)}}return o};function*qk(e){const t=$t(e.restDecoder);for(let n=0;n<t;n++){const r=$t(e.restDecoder),i=e.readClient();let s=$t(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=$t(e.restDecoder);yield new Wn(Vt(i,s),c),s+=c}else if(Pa&a){const c=(a&(Hr|Nn))===0,u=new je(Vt(i,s),null,(a&Nn)===Nn?e.readLeftID():null,null,(a&Hr)===Hr?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&bo)===bo?e.readString():null,v0(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new Cn(Vt(i,s),c),s+=c}}}}class Wu{constructor(t,n){this.gen=qk(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Wn);return this.curr}}class Gu{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Jk=e=>Va(e,$p,So),Xk=(e,t)=>{if(e.constructor===Cn){const{client:n,clock:r}=e.id;return new Cn(Vt(n,r+t),e.length-t)}else if(e.constructor===Wn){const{client:n,clock:r}=e.id;return new Wn(Vt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new je(Vt(r,i+t),null,Vt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Va=(e,t=Us,n=Qi)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(Xi(l)));let i=r.map(l=>new Wu(l,!0)),s=null;const o=new n,a=new Gu(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===Wn?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Si(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===Wn)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Si(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Wn(Vt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===Wn?s.struct.length-=p:f=Xk(f,p)),s.struct.mergeWith(f)||(Si(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==Wn;f=l.next())Si(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Si(a,s.struct,s.offset),s=null),Hu(a);const c=r.map(l=>Du(l)),u=Ak(c);return Ms(o,u),o.toUint8Array()},Zk=(e,t,n=Us,r=Qi)=>{const i=Wp(t),s=new r,o=new Gu(s),a=new n(Xi(e)),c=new Wu(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===Wn){c.next();continue}if(l.id.clock+l.length>f)for(Si(o,l,qi(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Si(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}Hu(o);const u=Du(a);return Ms(s,u),s.toUint8Array()},r0=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:nr(e.encoder.restEncoder)}),e.encoder.restEncoder=Ti(),e.written=0)},Si=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&r0(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),Dt(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Hu=e=>{r0(e);const t=e.encoder.restEncoder;Dt(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];Dt(t,r.written),Ba(t,r.restEncoder)}},Qk=(e,t,n,r)=>{const i=new n(Xi(e)),s=new Wu(i,!1),o=new r,a=new Gu(o);for(let u=s.curr;u!==null;u=s.next())Si(a,t(u),0);Hu(a);const c=Du(i);return Ms(o,c),o.toUint8Array()},tT=e=>Qk(e,ak,Us,So),i0="You must not compute changes after the event-handler fired.";class qa{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=eT(this.currentTarget,this.target))}deletes(t){return Pp(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw vi(i0);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=yu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=yu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=yu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw vi(i0);const n=this.target,r=Rs(),i=Rs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const eT=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},sn=()=>{Tk("Invalid access: Add Yjs type to a document before reading data.")},s0=80;let Yu=0;class nT{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Yu++}}const rT=e=>{e.timestamp=Yu++},o0=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Yu++},iT=(e,t,n)=>{if(e.length>=s0){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return o0(r,t,n),r}else{const r=new nT(t,n);return e.push(r),r}},Ja=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Ua(t-s.index)<Ua(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,rT(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Ua(n.index-i)<r.parent.length/s0?(o0(n,r,i),n):iT(e._searchMarker,r,i)},Ro=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=qi(t,i.index+n))}},Xa=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;wi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;qp(r._eH,n,t)};class xe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Hp(),this._dEH=Hp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw gr()}clone(){throw gr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Yp(this._eH,t)}observeDeep(t){Yp(this._dEH,t)}unobserve(t){Vp(this._eH,t)}unobserveDeep(t){Vp(this._dEH,t)}toJSON(){}}const a0=(e,t,n)=>{e.doc??sn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},c0=e=>{e.doc??sn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Io=(e,t)=>{let n=0,r=e._start;for(e.doc??sn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},l0=(e,t)=>{const n=[];return Io(e,(r,i)=>{n.push(t(r,i,e))}),n},sT=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},u0=(e,t)=>{e.doc??sn();const n=Ja(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Za=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new je(Vt(o,qe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ns(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new je(Vt(o,qe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Oo(new Uint8Array(h))),i.integrate(e,0);break;case Xr:i=new je(Vt(o,qe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Co(h)),i.integrate(e,0);break;default:if(h instanceof xe)i=new je(Vt(o,qe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Qr(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},h0=()=>vi("Length exceeded!"),f0=(e,t,n,r)=>{if(n>t._length)throw h0();if(n===0)return t._searchMarker&&Ro(t._searchMarker,n,r.length),Za(e,t,null,r);const i=n,s=Ja(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ai(e,Vt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Ro(t._searchMarker,i,r.length),Za(e,t,o,r)},oT=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Za(e,t,i,n)},d0=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=Ja(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ai(e,Vt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ai(e,Vt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw h0();t._searchMarker&&Ro(t._searchMarker,i,-s+r)},Qa=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Vu=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ns([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ns([r]);break;case Uint8Array:a=new Oo(r);break;case Xr:a=new Co(r);break;default:if(r instanceof xe)a=new Qr(r);else throw new Error("Unexpected content type")}new je(Vt(o,qe(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},qu=(e,t)=>{e.doc??sn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},p0=e=>{const t={};return e.doc??sn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},m0=(e,t)=>{e.doc??sn();const n=e._map.get(t);return n!==void 0&&!n.deleted},aT=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Bs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},tc=e=>(e.doc??sn(),vk(e._map.entries(),t=>!t[1].deleted));class cT extends qa{}class kr extends xe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new kr;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new kr}clone(){const t=new kr;return t.insert(0,this.toArray().map(n=>n instanceof xe?n.clone():n)),t}get length(){return this.doc??sn(),this._length}_callObserver(t,n){super._callObserver(t,n),Xa(this,t,new cT(this,t))}insert(t,n){this.doc!==null?ue(this.doc,r=>{f0(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?ue(this.doc,n=>{oT(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{d0(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return u0(this,t)}toArray(){return c0(this)}slice(t=0,n=this.length){return a0(this,t,n)}toJSON(){return this.map(t=>t instanceof xe?t.toJSON():t)}map(t){return l0(this,t)}forEach(t){Io(this,t)}[Symbol.iterator](){return sT(this)}_write(t){t.writeTypeRef(LT)}}const lT=e=>new kr;class uT extends qa{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Tr extends xe{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Tr}clone(){const t=new Tr;return this.forEach((n,r)=>{t.set(r,n instanceof xe?n.clone():n)}),t}_callObserver(t,n){Xa(this,t,new uT(this,t,n))}toJSON(){this.doc??sn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof xe?i.toJSON():i}}),t}get size(){return[...tc(this)].length}keys(){return Pu(tc(this),t=>t[0])}values(){return Pu(tc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Pu(tc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??sn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ue(this.doc,n=>{Qa(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?ue(this.doc,r=>{Vu(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return qu(this,t)}has(t){return m0(this,t)}clear(){this.doc!==null?ue(this.doc,t=>{this.forEach(function(n,r,i){Qa(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(MT)}}const hT=e=>new Tr,Ri=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&sk(e,t);class Ju{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&yr(),this.right.content.constructor){case $e:this.right.deleted||Fs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const g0=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case $e:t.right.deleted||Fs(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Ai(e,Vt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},ec=(e,t,n,r)=>{const i=new Map,s=r?Ja(t,n):null;if(s){const o=new Ju(s.p.left,s.p,s.index,i);return g0(e,o,n-s.index)}else{const o=new Ju(null,t._start,0,i);return g0(e,o,n)}},y0=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===$e&&Ri(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new je(Vt(s,qe(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new $e(a,o));l.integrate(e,0),n.right=l,n.forward()})},Fs=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},_0=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===$e&&Ri(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},b0=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!Ri(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new je(Vt(s,qe(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new $e(a,c)),n.right.integrate(e,0),n.forward()}}return o},Xu=(e,t,n,r,i)=>{n.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=e.doc,o=s.clientID;_0(n,i);const a=b0(e,t,n,i),c=r.constructor===String?new xr(r):r instanceof xe?new Qr(r):new es(r);let{left:u,right:l,index:h}=n;t._searchMarker&&Ro(t._searchMarker,n.index,c.getLength()),l=new je(Vt(o,qe(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),y0(e,t,n,a)},w0=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;_0(n,i);const a=b0(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===$e));){if(!n.right.deleted)switch(n.right.content.constructor){case $e:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(Ri(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Ai(e,Vt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new je(Vt(o,qe(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new xr(c)),n.right.integrate(e,0),n.forward()}y0(e,t,n,a)},E0=(e,t,n,r,i)=>{let s=t;const o=er();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===$e){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case $e:{const{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!t.deleted&&Fs(i,u);break}}}t=t.right}return a},fT=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===$e){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},dT=e=>{let t=0;return ue(e.doc,n=>{let r=e._start,i=e._start,s=er();const o=gu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case $e:Fs(o,i.content);break;default:t+=E0(n,r,i,s,o),s=gu(o),r=i;break}i=i.right}}),t},pT=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Qp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===$e&&o.constructor!==Cn&&t.add(o.parent)})}ue(n,r=>{Up(e,e.deleteSet,i=>{if(i instanceof Cn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===$e?t.add(s):fT(r,i)});for(const i of t)dT(i)})},k0=(e,t,n)=>{const r=n,i=gu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Qr:case es:case xr:n<t.right.length&&Ai(e,Vt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&E0(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Ro(o._searchMarker,t.index,-r+n),t};class mT extends qa{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];ue(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((p,g)=>{p!==null&&(d.attributes[g]=p)}))),u="";break;case"retain":l>0&&(d={retain:l},nk(c)||(d.attributes=QE({},c))),l=0;break}d&&n.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case Qr:case es:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case xr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case $e:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=i.get(d)??null;Ri(g,p)?p!==null&&o.delete(r):(a==="retain"&&f(),Ri(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const g=i.get(d)??null;Ri(g,p)||(a==="retain"&&f(),c[d]=g)}else if(!o.deleted){s.set(d,p);const g=c[d];g!==void 0&&(Ri(g,p)?g!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),Fs(i,o.content));break}}o=o.right}for(f();n.length>0;){const d=n[n.length-1];if(d.retain!==void 0&&d.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class ir extends xe{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??sn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new ir}clone(){const t=new ir;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new mT(this,t,n);Xa(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??sn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===xr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?ue(this.doc,r=>{const i=new Ju(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Xu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?w0(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&k0(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??sn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let f=!1;s.forEach((p,g)=>{f=!0,h[g]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const l=()=>{for(;c!==null;){if(Bs(c,t)||n!==void 0&&Bs(c,n))switch(c.content.constructor){case xr:{const h=s.get("ychange");t!==void 0&&!Bs(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Bs(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case Qr:case es:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case $e:Bs(c,t)&&(u(),Fs(s,c.content));break}c=c.right}u()};return t||n?ue(o,h=>{t&&ju(h,t),n&&ju(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ec(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Xu(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?ue(i,s=>{const o=ec(s,this,t,!r);Xu(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?ue(r,i=>{k0(i,ec(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ec(s,this,t,!1);o.right!==null&&w0(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{Qa(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{Vu(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return qu(this,t)}getAttributes(){return p0(this)}_write(t){t.writeTypeRef(UT)}}const gT=e=>new ir;class Zu{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??sn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Zr||n.constructor===vr)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class vr extends xe{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new vr}clone(){const t=new vr;return t.insert(0,this.toArray().map(n=>n instanceof xe?n.clone():n)),t}get length(){return this.doc??sn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Zu(this,t)}querySelector(t){t=t.toUpperCase();const r=new Zu(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Ei(new Zu(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Xa(this,t,new bT(this,n,t))}toString(){return l0(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Io(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?ue(this.doc,r=>{f0(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)ue(this.doc,r=>{const i=t&&t instanceof xe?t._item:t;Za(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw vi("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{d0(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return c0(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return u0(this,t)}slice(t=0,n=this.length){return a0(this,t,n)}forEach(t){Io(this,t)}_write(t){t.writeTypeRef(BT)}}const yT=e=>new vr;class Zr extends vr{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Zr(this.nodeName)}clone(){const t=new Zr(this.nodeName),n=this.getAttributes();return ek(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof xe?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{Qa(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{Vu(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return qu(this,t)}hasAttribute(t){return m0(this,t)}getAttributes(t){return t?aT(this,t):p0(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Io(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(PT),t.writeKey(this.nodeName)}}const _T=e=>new Zr(e.readKey());class bT extends qa{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Ds extends Tr{constructor(t){super(),this.hookName=t}_copy(){return new Ds(this.hookName)}clone(){const t=new Ds(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(FT),t.writeKey(this.hookName)}}const wT=e=>new Ds(e.readKey());class ts extends ir{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new ts}clone(){const t=new ts;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(DT)}}const ET=e=>new ts;class Qu{constructor(t,n){this.id=t,this.length=n}get deleted(){throw gr()}mergeWith(t){return!1}write(t,n,r){throw gr()}integrate(t,n){throw gr()}}const kT=0;class Cn extends Qu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Xp(t.doc.store,this)}write(t,n){t.writeInfo(kT),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Oo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Oo(this.content)}splice(t){throw gr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const TT=e=>new Oo(e.readBuf());class No{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new No(this.len)}splice(t){const n=new No(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Wa(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const vT=e=>new No(e.readLen()),T0=(e,t)=>new Xr({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Co{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Co(T0(this.doc.guid,this.opts))}splice(t){throw gr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const xT=e=>new Co(T0(e.readString(),e.readAny()));class es{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new es(this.embed)}splice(t){throw gr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const AT=e=>new es(e.readJSON());class $e{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new $e(this.key,this.value)}splice(t){throw gr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const ST=e=>new $e(e.readKey(),e.readJSON());class nc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new nc(this.arr)}splice(t){const n=new nc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const RT=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new nc(n)},IT=Ka("node_env")==="development";class ns{constructor(t){this.arr=t,IT&&Ap(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ns(this.arr)}splice(t){const n=new ns(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const OT=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ns(n)};class xr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new xr(this.str)}splice(t){const n=new xr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const NT=e=>new xr(e.readString()),CT=[lT,hT,gT,_T,yT,wT,ET],LT=0,MT=1,UT=2,PT=3,BT=4,FT=5,DT=6;class Qr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Qr(this.type._copy())}splice(t){throw gr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const $T=e=>new Qr(CT[e.readTypeRef()](e)),rc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new je(Vt(r,i+n),t,Vt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Vt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class je extends Qu{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?sp:0}set marker(t){(this.info&bu)>0!==t&&(this.info^=bu)}get marker(){return(this.info&bu)>0}get keep(){return(this.info&ip)>0}set keep(t){this.keep!==t&&(this.info^=ip)}get countable(){return(this.info&sp)>0}get deleted(){return(this.info&_u)>0}set deleted(t){this.deleted!==t&&(this.info^=_u)}markDeleted(){this.info|=_u}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=qe(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=qe(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ps&&this.id.client!==this.parent.client&&this.parent.clock>=qe(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Zp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ai(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Cn||this.right&&this.right.constructor===Cn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===je&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===je&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ps){const r=zu(n,this.parent);r.constructor===Cn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Zp(t,t.doc.store,Vt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Ga(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Ga(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(zu(t.doc.store,i.origin)))s.has(zu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Xp(t.doc.store,this),this.content.integrate(t,this),e0(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Cn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Vt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ga(t.origin,this.lastId)&&this.right===t&&Ga(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Wa(t.deleteSet,this.id.client,this.id.clock,this.length),e0(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw yr();this.content.gc(t),n?Gk(t,this,new Cn(this.id,this.length)):this.content=new No(this.length)}write(t,n){const r=n>0?Vt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Pa|(r===null?0:Nn)|(i===null?0:Hr)|(s===null?0:bo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=Wk(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Ps?(t.writeParentInfo(!1),t.writeLeftID(a)):yr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const v0=(e,t)=>jT[t&Pa](e),jT=[()=>{yr()},vT,RT,TT,NT,AT,ST,$T,OT,xT,()=>{yr()}],zT=10;class Wn extends Qu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){yr()}write(t,n){t.writeInfo(zT),Dt(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const x0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ss<"u"?Ss:{},A0="__ $YJS$ __";x0[A0]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),x0[A0]=!0;let th,eh,KT=e=>e();function WT(e,t){if(eh)return eh(e,t);KT(e)}function rs(e,t,n){if(th)return th.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function GT(e){th=function(t,n,r){const i=e.createAtom(t);return n&&n(),i},eh=(t,n)=>e.reaction(t,n,{fireImmediately:!1})}const S0=new WeakSet;function HT(e){if(S0.has(e))return e;S0.add(e);let t;const n=new Map;function r(){if(!t){const h=f=>{(f.changes.added.size||f.changes.deleted.size||f.changes.keys.size||f.changes.delta.length)&&t.reportChanged()};t=rs("map",()=>{e.observe(h)},()=>{e.unobserve(h)})}t.reportObserved(e._implicitObserver)}function i(h){let f=n.get(h);if(!f){const d=p=>{f.reportChanged()};f=rs(h+"",()=>{e.observe(d)},()=>{e.unobserve(d)}),n.set(h,f)}f.reportObserved(e._implicitObserver)}const s=e.get;e.get=function(h){if(typeof h!="number")throw new Error("unexpected");return i(h),Reflect.apply(s,this,arguments)};function o(h){const f=e[h];e[h]=function(){return r(),Reflect.apply(f,this,arguments)}}function a(h){let f=e,d=Object.getOwnPropertyDescriptor(f,h);if(d||(f=Object.getPrototypeOf(f),d=Object.getOwnPropertyDescriptor(f,h)),d||(f=Object.getPrototypeOf(f),d=Object.getOwnPropertyDescriptor(f,h)),!d)throw new Error("property not found");const p=d.get;d.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(e,h,d)}function c(h,f){let d=e,p=Object.getOwnPropertyDescriptor(d,h);if(p||(d=Object.getPrototypeOf(d),p=Object.getOwnPropertyDescriptor(d,h)),p||(d=Object.getPrototypeOf(d),p=Object.getOwnPropertyDescriptor(d,h)),!p)throw new Error("property not found");Object.defineProperty(e,f,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const u=e.push;e.push=function(h){this._disableTracking=!0;const f=u.call(this,h);return this._disableTracking=!1,f};const l=e.slice;return e.slice=function(h,f){this._disableTracking=!0;const d=l.call(this,h,f);return this._disableTracking=!1,d},e}const R0=new WeakSet;function YT(e){if(R0.has(e))return e;R0.add(e);let t;function n(){if(!t){let s=Array.from(e.share.keys());const o=a=>{const c=Array.from(e.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,t.reportChanged())};t=rs("map",()=>{e.on("beforeObserverCalls",o)},()=>{e.off("beforeObserverCalls",o)})}t.reportObserved(e._implicitObserver)}const r=e.get;e.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return ic(o),o};function i(s){const o=e[s];let a;e[s]=function(){let c,u=arguments;return n(),a&&a.removeObservers(),a=WT(()=>(c=Reflect.apply(o,e,u),c),()=>t.reportChanged()),c}}return i("toJSON"),Object.defineProperty(e,"keys",{get:()=>(n(),Object.keys(e.share))}),e}const I0=new WeakSet;function VT(e){if(I0.has(e))return e;I0.add(e);let t;const n=new Map;function r(){if(!t){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&t.reportChanged()};t=rs("map",()=>{e.observe(a)},()=>{e.unobserve(a)})}t.reportObserved(e._implicitObserver)}function i(a){let c=n.get(a);if(!c){const u=l=>{l.keysChanged.has(a)&&(l.changes.added.size||l.changes.deleted.size||l.changes.keys.size||l.changes.delta.length)&&c.reportChanged()};c=rs(a,()=>{e.observe(u)},()=>{e.unobserve(u)}),n.set(a,c)}c.reportObserved(e._implicitObserver)}const s=e.get;e.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=e[a];e[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),e}const O0=new WeakSet;function N0(e){if(O0.has(e))return e;O0.add(e);let t;const n=i=>{t.reportChanged()};t=rs("text",()=>{e.observe(n)},()=>{e.unobserve(n)});function r(i){const s=e[i];e[i]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),e}const C0=new WeakSet;function L0(e){if(C0.has(e))return e;C0.add(e);let t;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&t.reportChanged()};t=rs("xml",()=>{e.observe(n)},()=>{e.unobserve(n)});function r(s){const o=e[s];e[s]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=e,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(e,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),e}function ic(e){return e instanceof ts||e instanceof ir?N0(e):e instanceof kr?HT(e):e instanceof Tr?VT(e):e instanceof Xr||Object.prototype.hasOwnProperty.call(e,"autoLoad")?YT(e):e instanceof vr||e instanceof Zr?L0(e):e}function M0(e){e.share.forEach(t=>{t.constructor!==xe&&ic(t)})}function U0(e,t){for(let r=e.length-1;r>=t;r--){let i=e[r];if(!i.deleted){var n;if(i instanceof Cn)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof xe&&ic(s)})}}}const P0=new WeakSet;function qT(e){P0.has(e)||(P0.add(e),ic(e),e.store.clients.forEach(t=>{t&&U0(t,0)}),M0(e),e.on("beforeObserverCalls",t=>{M0(e),t.afterState.forEach((n,r)=>{const i=t.beforeState.get(r)||0;if(i!==n){const s=t.doc.store.clients.get(r);if(!s)return;const o=rr(s,i);U0(s,o)}})}))}class Lo{constructor(t){this.value=void 0,this.value=t}}function JT(e){return ArrayBuffer.isView(e)?new Lo(e):new Lo(Object.freeze(e))}function XT(e){const t=function(){var a;let c=(a=this[zn])==null?void 0:a.implicitObserver;return e._implicitObserver=c,e.slice.bind(e).apply(e,arguments).map(l=>{const h=sc(l,c);return c&&typeof h=="object"?_o(h,c):h})},n=function(a){return a.map(c=>{const u=nh(c);let l=is(u)||u;if(l instanceof Lo&&(l=l.value),l instanceof xe&&l.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return l})},r=function(){return[].findIndex.apply(t.apply(this),arguments)},i={slice:t,unshift:(...o)=>(e.unshift(n(o)),e.lengthUntracked),push:(...o)=>(e.push(n(o)),e.lengthUntracked),insert:e.insert.bind(e),toJSON:e.toJSON.bind(e),forEach:function(){return[].forEach.apply(t.apply(this),arguments)},every:function(){return[].every.apply(t.apply(this),arguments)},filter:function(){return[].filter.apply(t.apply(this),arguments)},find:function(){return[].find.apply(t.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(t.apply(this),arguments)},includes:function(){return[].includes.apply(t.apply(this),arguments)},map:function(){return[].map.apply(t.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>nv(a,o))},splice:function(){let o=arguments[0]<0?e.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),u=t.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return e.doc?e.doc.transact(()=>{e.delete(o,a),e.insert(o,n(c))}):(e.delete(o,a),e.insert(o,n(c))),u}},s=[];for(let o in i)s[o]=i[o];return s}function Mo(e){if(typeof e=="string"&&e.trim().length){const t=Number(e);if(Number.isInteger(t))return t}return e}function B0(e,t=new kr){if(t[De])throw new Error("unexpected");const n=XT(t),r=new Proxy(n,{set:(i,s,o)=>{throw typeof Mo(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=Mo(s);if(a===oc)return t;if(typeof a=="number"){let l;if(o&&o[zn]){var c;l=(c=o[zn])==null?void 0:c.implicitObserver,t._implicitObserver=l}let h=t.get(a);return h=sc(h,l),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const l=t.slice();return Reflect.get(l,a)}return a==="length"?t.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=Mo(s);if(typeof o!="number")throw new Error;return o<t.lengthUntracked&&o>=0?(t.delete(o),!0):!1},has:(i,s)=>{const o=Mo(s);return typeof o!="number"?Reflect.has(i,o):o<t.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=Mo(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<t.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<t.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,e),r}function F0(e,t=new Tr){if(t[De])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=nh(s);let a=is(o)||o;if(a instanceof Lo&&(a=a.value),a instanceof xe&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return t.set(i,a),!0},get:(r,i,s)=>{if(i===oc)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[zn]){var a;o=(a=s[zn])==null?void 0:a.implicitObserver,t._implicitObserver=o}let c=t.get(i);return c=sc(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return t.has(i)?(t.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&t.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.keys())});Uo.set(t,n);for(let r in e)n[r]=e[r];return n}function ZT(e){return e instanceof xe}const Uo=new WeakMap;function sc(e,t){if(ZT(e)){if(e._implicitObserver=t,e instanceof kr||e instanceof Tr){if(!Uo.has(e)){const n=nh(e);Uo.set(e,n)}e=Uo.get(e)}else if(e instanceof Zr||e instanceof vr||e instanceof ts||e instanceof Ds||e instanceof ir)pu(e),e.__v_skip=!0;else throw new Error("unknown YType");return e}else{if(e===null)return null;if(typeof e=="object")return JT(e)}return e}function nh(e){if(e==null)return e;if(e=is(e)||e,e instanceof kr)return B0([],e);if(e instanceof Tr)return F0({},e);if(typeof e=="string")return e;if(Array.isArray(e))return B0(e);if(e instanceof Zr||e instanceof vr||e instanceof ts||e instanceof Ds)return e;if(e instanceof ir)return e;if(typeof e=="object")return e instanceof Lo?e:F0(e);if(typeof e=="number"||typeof e=="boolean")return e;throw new Error("invalid")}function QT(e){for(let[t,n]of Object.entries(e))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function D0(e,t,n){let r=t[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?e.getXmlFragment(n):r==="text"?e.getText(n):Array.isArray(r)?e.getArray(n):e.getMap(n)}function tv(e,t){if(e[De])throw new Error("unexpected");QT(t);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===oc)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[zn]){var a;o=(a=s[zn])==null?void 0:a.implicitObserver,e._implicitObserver=o}if(i==="toJSON"){for(let l of Object.keys(t))D0(e,t,l);return Reflect.get(e,i)}let c=D0(e,t,i);return c=sc(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&e.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.share.keys())});return Uo.set(e,n),n}GT(aE);const oc=Symbol("INTERNAL_SYMBOL");function $0(e,t){const n=is(e)||e;if(!n)throw new Error("not a valid synced object");return n instanceof Xr?(n.on("update",t),()=>{n.off("update",t)}):(n.observeDeep(t),()=>{n.unobserveDeep(t)})}function ev(e){const t=is(e);if(!(t instanceof Xr))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return t}function is(e){if(typeof e!="object"||e===null)return;const t=e[oc];return t&&(pu(t),t.__v_skip=!0),t}function nv(e,t){if(e===t)return!0;if(typeof e=="object"&&typeof t=="object"){const n=is(e),r=is(t);return!n||!r?!1:n===r}return!1}function rv(e,t=new Xr){return qT(t),tv(t,e)}var Ht={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Po=Symbol.for("react.element"),iv=Symbol.for("react.portal"),sv=Symbol.for("react.fragment"),ov=Symbol.for("react.strict_mode"),av=Symbol.for("react.profiler"),cv=Symbol.for("react.provider"),lv=Symbol.for("react.context"),uv=Symbol.for("react.forward_ref"),hv=Symbol.for("react.suspense"),fv=Symbol.for("react.memo"),dv=Symbol.for("react.lazy"),j0=Symbol.iterator;function pv(e){return e===null||typeof e!="object"?null:(e=j0&&e[j0]||e["@@iterator"],typeof e=="function"?e:null)}var z0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K0=Object.assign,W0={};function $s(e,t,n){this.props=e,this.context=t,this.refs=W0,this.updater=n||z0}$s.prototype.isReactComponent={},$s.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},$s.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function G0(){}G0.prototype=$s.prototype;function rh(e,t,n){this.props=e,this.context=t,this.refs=W0,this.updater=n||z0}var ih=rh.prototype=new G0;ih.constructor=rh,K0(ih,$s.prototype),ih.isPureReactComponent=!0;var H0=Array.isArray,Y0=Object.prototype.hasOwnProperty,sh={current:null},V0={key:!0,ref:!0,__self:!0,__source:!0};function q0(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Y0.call(t,r)&&!V0.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Po,type:e,key:s,ref:o,props:i,_owner:sh.current}}function mv(e,t){return{$$typeof:Po,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function oh(e){return typeof e=="object"&&e!==null&&e.$$typeof===Po}function gv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var J0=/\/+/g;function ah(e,t){return typeof e=="object"&&e!==null&&e.key!=null?gv(""+e.key):t.toString(36)}function ac(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Po:case iv:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+ah(o,0):r,H0(i)?(n="",e!=null&&(n=e.replace(J0,"$&/")+"/"),ac(i,t,n,"",function(u){return u})):i!=null&&(oh(i)&&(i=mv(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(J0,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",H0(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+ah(s,a);o+=ac(s,t,n,c,i)}else if(c=pv(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+ah(s,a++),o+=ac(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function cc(e,t,n){if(e==null)return e;var r=[],i=0;return ac(e,r,"","",function(s){return t.call(n,s,i++)}),r}function yv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ln={current:null},lc={transition:null},_v={ReactCurrentDispatcher:ln,ReactCurrentBatchConfig:lc,ReactCurrentOwner:sh};function X0(){throw Error("act(...) is not supported in production builds of React.")}Ht.Children={map:cc,forEach:function(e,t,n){cc(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return cc(e,function(){t++}),t},toArray:function(e){return cc(e,function(t){return t})||[]},only:function(e){if(!oh(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Ht.Component=$s,Ht.Fragment=sv,Ht.Profiler=av,Ht.PureComponent=rh,Ht.StrictMode=ov,Ht.Suspense=hv,Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_v,Ht.act=X0,Ht.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=K0({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=sh.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Y0.call(t,c)&&!V0.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Po,type:e.type,key:i,ref:s,props:r,_owner:o}},Ht.createContext=function(e){return e={$$typeof:lv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:cv,_context:e},e.Consumer=e},Ht.createElement=q0,Ht.createFactory=function(e){var t=q0.bind(null,e);return t.type=e,t},Ht.createRef=function(){return{current:null}},Ht.forwardRef=function(e){return{$$typeof:uv,render:e}},Ht.isValidElement=oh,Ht.lazy=function(e){return{$$typeof:dv,_payload:{_status:-1,_result:e},_init:yv}},Ht.memo=function(e,t){return{$$typeof:fv,type:e,compare:t===void 0?null:t}},Ht.startTransition=function(e){var t=lc.transition;lc.transition={};try{e()}finally{lc.transition=t}},Ht.unstable_act=X0,Ht.useCallback=function(e,t){return ln.current.useCallback(e,t)},Ht.useContext=function(e){return ln.current.useContext(e)},Ht.useDebugValue=function(){},Ht.useDeferredValue=function(e){return ln.current.useDeferredValue(e)},Ht.useEffect=function(e,t){return ln.current.useEffect(e,t)},Ht.useId=function(){return ln.current.useId()},Ht.useImperativeHandle=function(e,t,n){return ln.current.useImperativeHandle(e,t,n)},Ht.useInsertionEffect=function(e,t){return ln.current.useInsertionEffect(e,t)},Ht.useLayoutEffect=function(e,t){return ln.current.useLayoutEffect(e,t)},Ht.useMemo=function(e,t){return ln.current.useMemo(e,t)},Ht.useReducer=function(e,t,n){return ln.current.useReducer(e,t,n)},Ht.useRef=function(e){return ln.current.useRef(e)},Ht.useState=function(e){return ln.current.useState(e)},Ht.useSyncExternalStore=function(e,t,n){return ln.current.useSyncExternalStore(e,t,n)},Ht.useTransition=function(){return ln.current.useTransition()},Ht.version="18.3.1";const ch=0,Z0=1,Q0=2,bv=(e,t)=>{Dt(e,ch);const n=zk(t);rn(e,n)},tm=(e,t,n)=>{Dt(e,Z0),rn(e,Fk(t,n))},wv=(e,t,n)=>tm(t,n,cn(e)),em=(e,t,n)=>{try{Uk(t,cn(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Ev=(e,t)=>{Dt(e,Q0),rn(e,t)},kv=em,Tv=(e,t,n,r)=>{const i=$t(e);switch(i){case ch:wv(e,t,n);break;case Z0:em(e,n,r);break;case Q0:kv(e,n,r);break;default:throw new Error("Unknown message type")}return i},ti=rv({shared:[]});function uc(e,t,n){return e.find(r=>r.key===t&&r.type===n)}function nm(e,t,n){const r=uc(ti.shared,e,t);E(r)||ti.shared.push({key:e,type:t,value:n})}function vv(e,t){nm(e,0,t)}function lh(e,t){const n=new ir(t);nm(e,1,n)}function xv(e,t){const n=uc(ti.shared,e,0);if(E(n)){n.value=t;return}ti.shared.push({key:e,type:0,value:t})}function Av(e,t){const n=new ir(t),r=uc(ti.shared,e,1);if(E(r)){r.value=n;return}ti.shared.push({key:e,type:1,value:n})}function rm(e,t,n){let r;function i(){const o=uc(ti.shared,e,t);E(o)&&(s(),r=$0(o,()=>n(o.value)))}const s=$0(ti.shared,i);return i(),()=>r==null?void 0:r()}function Sv(e,t){return rm(e,0,t)}function im(e,t){return rm(e,1,n=>t(n.toJSON()))}function hc(e){return nr(e)}let sm=!1;const Ii=ev(ti),Gn=As("modem",["second"],e=>{if(Gn.session(e))switch(e.target){case"second":!sm&&e.data%2===0&&Gn.emit("modem:join");break;case"join":if(e.sender!==Gn.id()){Gn.reply(e,"joinack");const t=Ti();bv(t,Ii),Gn.reply(e,"sync",hc(t));const n=Ti();tm(n,Ii),Gn.reply(e,"sync",hc(n))}break;case"joinack":e.sender!==Gn.id()&&(sm=!0);break;case"sync":{if(e.sender!==Gn.id()&&E(e.data))try{const t=Xi(e.data),n=Ti();Tv(t,n,Ii,Gn)===ch&&Gn.emit("modem:sync",hc(n))}catch(t){ae(Gn,"sync",t.message)}break}}});function om(e){const t=Ti();Ev(t,e),Gn.emit("modem:sync",hc(t))}Ii.on("update",om),Ii.on("destroy",()=>{Ii==null||Ii.off("update",om)});function Rv(e,t){return e%t}function Iv(e,t){return Math.floor(e/t)}function Ov(e,t){return{x:Rv(e,t),y:Iv(e,t)}}function fc(e,t){return e.x+e.y*t}function am(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function cm(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const lm="170",Nv="",dc="srgb",um="srgb-linear",hm="linear",uh="srgb";function Cv(e,t,n){return Math.max(t,Math.min(n,e))}class Bo{constructor(t=0,n=0){Bo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Cv(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Fo{constructor(t,n,r,i,s,o,a,c,u){Fo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],f=r[2],d=r[5],p=r[8],g=i[0],k=i[3],w=i[6],T=i[1],A=i[4],O=i[7],P=i[2],L=i[5],C=i[8];return s[0]=o*g+a*T+c*P,s[3]=o*k+a*A+c*L,s[6]=o*w+a*O+c*C,s[1]=u*g+l*T+h*P,s[4]=u*k+l*A+h*L,s[7]=u*w+l*O+h*C,s[2]=f*g+d*T+p*P,s[5]=f*k+d*A+p*L,s[8]=f*w+d*O+p*C,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=a*c-l*s,d=u*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return t[0]=h*g,t[1]=(i*u-l*r)*g,t[2]=(a*r-i*o)*g,t[3]=f*g,t[4]=(l*n-i*c)*g,t[5]=(i*s-a*n)*g,t[6]=d*g,t[7]=(r*c-u*n)*g,t[8]=(o*n-r*s)*g,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(hh.makeScale(t,n)),this}rotate(t){return this.premultiply(hh.makeRotation(-t)),this}translate(t,n){return this.premultiply(hh.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const hh=new Fo,Lv={enabled:!0,workingColorSpace:um,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===uh&&(e.r=fh(e.r),e.g=fh(e.g),e.b=fh(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===uh&&(e.r=dh(e.r),e.g=dh(e.g),e.b=dh(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Nv?hm:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function fh(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function dh(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const fm=[.64,.33,.3,.6,.15,.06],dm=[.2126,.7152,.0722],pm=[.3127,.329],mm=new Fo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),gm=new Fo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Lv.define({[um]:{primaries:fm,whitePoint:pm,transfer:hm,toXYZ:mm,fromXYZ:gm,luminanceCoefficients:dm,workingColorSpaceConfig:{unpackColorSpace:dc},outputColorSpaceConfig:{drawingBufferColorSpace:dc}},[dc]:{primaries:fm,whitePoint:pm,transfer:uh,toXYZ:mm,fromXYZ:gm,luminanceCoefficients:dm,outputColorSpaceConfig:{drawingBufferColorSpace:dc}}}),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:lm}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=lm),new Bo,new Bo;function Ln(e,t,n){return Math.max(t,Math.min(n,e))}function ph(e){return e*180/Math.PI}const Mv=Ad("089fad0j9awfem09wavefc09uwaef");function Uv(){return Mv()}function Pv(e){return Ad(e)()}function Oi(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Uv()*i)}function ym(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(Pv(e)*s)}function _m(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function Bv(e){return e[Oi(0,e.length-1)]}function Fv(e,t){return t[ym(e,0,t.length-1)]}function Mn(...e){return Bv(e.flat())}function bm(e,...t){return Fv(e,t.flat())}function Dv(e){return[...new Set(e)].filter(E)}var wm={exports:{}},mh={exports:{}},Em;function $v(){return Em||(Em=1,function(e,t){(function(n,r){e.exports=r()})(yn,function(){function n(g){return!isNaN(parseFloat(g))&&isFinite(g)}function r(g){return g.charAt(0).toUpperCase()+g.substring(1)}function i(g){return function(){return this[g]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(g){if(g)for(var k=0;k<l.length;k++)g[l[k]]!==void 0&&this["set"+r(l[k])](g[l[k]])}h.prototype={getArgs:function(){return this.args},setArgs:function(g){if(Object.prototype.toString.call(g)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=g},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(g){if(g instanceof h)this.evalOrigin=g;else if(g instanceof Object)this.evalOrigin=new h(g);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var g=this.getFileName()||"",k=this.getLineNumber()||"",w=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?g?"[eval] ("+g+":"+k+":"+w+")":"[eval]:"+k+":"+w:T?T+" ("+g+":"+k+":"+w+")":g+":"+k+":"+w}},h.fromString=function(k){var w=k.indexOf("("),T=k.lastIndexOf(")"),A=k.substring(0,w),O=k.substring(w+1,T).split(","),P=k.substring(T+1);if(P.indexOf("@")===0)var L=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(P,""),C=L[1],W=L[2],M=L[3];return new h({functionName:A,args:O||void 0,fileName:C,lineNumber:W||void 0,columnNumber:M||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=function(g){return function(k){this[g]=!!k}}(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=function(g){return function(k){if(!n(k))throw new TypeError(g+" must be a Number");this[g]=Number(k)}}(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(g){return function(k){this[g]=String(k)}}(a[p]);return h})}(mh)),mh.exports}(function(e,t){(function(n,r){e.exports=r($v())})(yn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,g=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:g,lineNumber:d[1],columnNumber:d[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=l.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],f=2,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],f=0,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,g;d.match(/\(([^)]*)\)/)&&(g=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var k=g===void 0||g==="[arguments not available]"?void 0:g.split(",");return new r({functionName:p,args:k,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:l})},this)}}})})(wm);var jv=wm.exports,zv=po(jv);const gh=14,pc=3,mc=8,gc=14,yc=16,Kv=16,Wv=16;function _c(e,t){return new Array(e).fill(t)}function Gv(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:_c(s,0),color:_c(s,0),bg:_c(s,i)}}function Hv(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:jt.ONCLEAR}}function Yv(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Vv(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:_c(s,i)}}function qv(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function Jv(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function km(e,t){return`${e}:${t}`}const Xv=1,Zv=16,Qv=256;var un=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(un||{});const Ar=!!JSON.parse("false"),tx=!!JSON.parse("false");JSON.parse("false");const ex=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ei={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return mc*ei.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return gc*ei.DRAW_CHAR_SCALE}},H=As("SOFTWARE");function ni(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},listcommands(){return Gr(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function be(e){return`${e??""}`}function Do(e,t){const n=parseFloat(be(e));return isNaN(n)?t:n}const nx=["echo","reverb","chorus","phaser","distortion","vibrato"];function Tm(e,t){const[n]=it(e,0,[V.NAME]);Dw(H,n,t)}function ri(e,t){const[n,r]=it(t,0,[V.NUMBER_OR_STRING]);if(Mt(n))nu(H,e,"volume",n);else if(nx.includes(Bt(n))){const[i,s]=it(t,r,[V.NUMBER_OR_STRING,V.MAYBE_NUMBER_OR_STRING]);jw(H,e,n,i,s)}else{const[i]=it(t,r,[V.MAYBE_NUMBER_OR_STRING]);if(Mt(i)){const s=t.length-r,o=new Array(s).fill(V.NUMBER),a=it(t,r,o).slice(0,s),c=a.length===1?a[0]:a;nu(H,e,n,c)}else{const[s]=it(t,r,[V.MAYBE_NUMBER_OR_STRING]);nu(H,e,n,s)}}}const rx=ni().command("tts",(e,t)=>{const[n,r]=it(t,0,[V.STRING]),i=t.slice(r).map(be).join("");return Bw(H,n,i),0}).command("tta",(e,t)=>{const n=t.map(be).join("");return Fw(H,n),0}).command("bpm",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return $w(H,n),0}).command("mainvol",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return Bd(H,n),0}).command("mainvolume",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return Bd(H,n),0}).command("drumvol",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return Fd(H,n),0}).command("drumvolume",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return Fd(H,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return Dd(H,n),0}).command("ttsvolume",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return Dd(H,n),0}).command("play",(e,t)=>(Tm(t,!1),0)).command("bgplay",(e,t)=>(Tm(t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)ri(n,t);return 0}).command("synth1",(e,t)=>(ri(0,t),0)).command("synth2",(e,t)=>(ri(1,t),0)).command("synth3",(e,t)=>(ri(2,t),0)).command("synth4",(e,t)=>(ri(3,t),0)).command("synth5",(e,t)=>(ri(4,t),0)).command("synth6",(e,t)=>(ri(5,t),0)).command("synth7",(e,t)=>(ri(6,t),0)).command("synth8",(e,t)=>(ri(7,t),0));function ix(e){return E(e)&&e<jt.ONBLACK?e:void 0}function sx(e){return E(e)&&e>jt.WHITE&&e<jt.ONCLEAR?e-jt.ONBLACK:void 0}const $o={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function bn(e){return re(e)&&xm(e[0])}function vm(e){return bn(e)&&e[0].startsWith("ON")}function xm(e){return E(jt[e])&&At(e)}function yh(e){if(At(e))return $o[Bt(e)]}function Am(e){return e.map(t=>jt[t]).find(t=>E(t)&&t<jt.ONBLACK)}function ox(e){return e.map(t=>jt[t]).find(t=>E(t)&&t>=jt.ONBLACK)}function Sm(e){if(bn(e))return e;if(xm(e))return[e];const t=yh(e);if(E(t))return[t]}function Rm(e){const t=v.words[e],n=Sm(t);if(bn(n))return[n,e+1];const[r,i]=Qe(e),s=Sm(r);return bn(s)?[s,i]:[void 0,e]}function bc(e){const t=[];let n=e;const[r,i]=Rm(e);if(bn(r)&&(t.push(...r),n=i),bn(t)&&!vm(t)){const[s,o]=Rm(i);vm(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function Im(e){const t={};return e.every(n=>{const r=jt[n];E(r)&&(r<jt.ONBLACK?t.color=r:t.bg=r-jt.ONBLACK)}),t}function js(e){return re(e)&&typeof e[0]=="string"}function Om(e){const t=v.words[e];if(js(t))return[t,e+1];const[n,r]=bc(e),[i,s]=Qe(r);return At(i)?[[i,n],s]:[void 0,e]}function wc(e){if(!js(e))return;const[t]=e;return t}function Nm(e){if(!js(e))return;const[,t]=e,n=E(t)?Am(t):void 0;return E(n)?n:void 0}function Cm(e){if(!js(e))return;const[,t]=e,n=E(t)?ox(t):void 0;return E(n)?n:void 0}const ie=60,Je=25;var kt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(kt||{});function _h(e,t){const n=e??Gt.ISWALK,r=t??Gt.ISWALK;switch(n){case Gt.ISWALK:return r!==Gt.ISWALK;case Gt.ISSWIM:return r!==Gt.ISSWIM;case Gt.ISSOLID:return!0;case Gt.ISBULLET:return r!==Gt.ISWALK&&r!==Gt.ISSWIM}}function Ec(e,t,n){const r=e==null?void 0:e.objects[n];if(E(r))return r;if(E(t)){const i=jo(e,"player"),s={x:t.x??0,y:t.y??0};Um(s,i)}}function jo(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(E)}function Lm(e,t){const n=wc(t),r=Nm(t),i=Cm(t);return e.filter(s=>{var o,a,c;return!(E(n)&&Bt((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||E(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??jt.WHITE)!==r||E(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??jt.BLACK)!==i)}).filter(E)}function Mm(e,t){return E(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(E(i))return i;const s=jo(e,Bt(n));if(s.length)return s}else if(ao(n)&&n.x>=0&&n.x<ie&&n.y>=0&&n.y<Je){const i=n.x+n.y*ie,s=(r=e.lookup)==null?void 0:r[i];return E(s)?e.objects[s]:e.terrain[i]}}).flat().filter(E):[]}function Um(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var bh;try{bh=new TextDecoder}catch{}var mt,Hn,D=0,he={},qt,Ni,Yn=0,Sr=0,Xe,ii,wn=[],Yt,Pm={useRecords:!1,mapsAsObjects:!0};class Bm{}const Fm=new Bm;Fm.name="MessagePack 0xC1";var Ci=!1,Dm=2,$m;try{new Function("")}catch{Dm=1/0}class zo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(mt)return Qm(()=>(vh(),this?this.unpack(t,n):zo.prototype.unpack.call(Pm,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof tn<"u"?tn.from(t):new Uint8Array(t)),typeof n=="object"?(Hn=n.end||t.length,D=n.start||0):(D=0,Hn=n>-1?n:t.length),Sr=0,Ni=null,Xe=null,mt=t;try{Yt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw mt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof zo){if(he=this,this.structures)return qt=this.structures,kc(n);(!qt||qt.length>0)&&(qt=[])}else he=Pm,(!qt||qt.length>0)&&(qt=[]);return kc(n)}unpackMultiple(t,n){let r,i=0;try{Ci=!0;let s=t.length,o=this?this.unpack(t,s):Tc.unpack(t,s);if(n){if(n(o,i,D)===!1)return;for(;D<s;)if(i=D,n(kc(),i,D)===!1)return}else{for(r=[o];D<s;)i=D,r.push(kc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Ci=!1,vh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function kc(e){try{if(!he.trusted&&!Ci){let n=qt.sharedLength||0;n<qt.length&&(qt.length=n)}let t;if(he.randomAccessStructure&&mt[D]<64&&mt[D]>=32&&$m?(t=$m(mt,D,Hn,he),mt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),D=Hn):t=Ne(),Xe&&(D=Xe.postBundlePosition,Xe=null),Ci&&(qt.restoreStructures=null),D==Hn)qt&&qt.restoreStructures&&jm(),qt=null,mt=null,ii&&(ii=null);else{if(D>Hn)throw new Error("Unexpected end of MessagePack data");if(!Ci){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw qt&&qt.restoreStructures&&jm(),vh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||D>Hn)&&(t.incomplete=!0),t}}function jm(){for(let e in qt.restoreStructures)qt[e]=qt.restoreStructures[e];qt.restoreStructures=null}function Ne(){let e=mt[D++];if(e<160)if(e<128){if(e<64)return e;{let t=qt[e&63]||he.getStructures&&Km()[e&63];return t?(t.read||(t.read=wh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=qm();r==="__proto__"&&(r="__proto_"),t[r]=Ne()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ne(),Ne());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ne();return he.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Sr>=D)return Ni.slice(D-Yn,(D+=t)-Yn);if(Sr==0&&Hn<140){let n=t<16?kh(t):Hm(t);if(n!=null)return n}return Eh(t)}else{let t;switch(e){case 192:return null;case 193:return Xe?(t=Ne(),t>0?Xe[1].slice(Xe.position1,Xe.position1+=t):Xe[0].slice(Xe.position0,Xe.position0-=t)):Fm;case 194:return!1;case 195:return!0;case 196:if(t=mt[D++],t===void 0)throw new Error("Unexpected end of buffer");return Th(t);case 197:return t=Yt.getUint16(D),D+=2,Th(t);case 198:return t=Yt.getUint32(D),D+=4,Th(t);case 199:return ss(mt[D++]);case 200:return t=Yt.getUint16(D),D+=2,ss(t);case 201:return t=Yt.getUint32(D),D+=4,ss(t);case 202:if(t=Yt.getFloat32(D),he.useFloat32>2){let n=xh[(mt[D]&127)<<1|mt[D+1]>>7];return D+=4,(n*t+(t>0?.5:-.5)>>0)/n}return D+=4,t;case 203:return t=Yt.getFloat64(D),D+=8,t;case 204:return mt[D++];case 205:return t=Yt.getUint16(D),D+=2,t;case 206:return t=Yt.getUint32(D),D+=4,t;case 207:return he.int64AsType==="number"?(t=Yt.getUint32(D)*4294967296,t+=Yt.getUint32(D+4)):he.int64AsType==="string"?t=Yt.getBigUint64(D).toString():he.int64AsType==="auto"?(t=Yt.getBigUint64(D),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Yt.getBigUint64(D),D+=8,t;case 208:return Yt.getInt8(D++);case 209:return t=Yt.getInt16(D),D+=2,t;case 210:return t=Yt.getInt32(D),D+=4,t;case 211:return he.int64AsType==="number"?(t=Yt.getInt32(D)*4294967296,t+=Yt.getUint32(D+4)):he.int64AsType==="string"?t=Yt.getBigInt64(D).toString():he.int64AsType==="auto"?(t=Yt.getBigInt64(D),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Yt.getBigInt64(D),D+=8,t;case 212:if(t=mt[D++],t==114)return Xm(mt[D++]&63);{let n=wn[t];if(n)return n.read?(D++,n.read(Ne())):n.noBuffer?(D++,n()):n(mt.subarray(D,++D));throw new Error("Unknown extension "+t)}case 213:return t=mt[D],t==114?(D++,Xm(mt[D++]&63,mt[D++])):ss(2);case 214:return ss(4);case 215:return ss(8);case 216:return ss(16);case 217:return t=mt[D++],Sr>=D?Ni.slice(D-Yn,(D+=t)-Yn):cx(t);case 218:return t=Yt.getUint16(D),D+=2,Sr>=D?Ni.slice(D-Yn,(D+=t)-Yn):lx(t);case 219:return t=Yt.getUint32(D),D+=4,Sr>=D?Ni.slice(D-Yn,(D+=t)-Yn):ux(t);case 220:return t=Yt.getUint16(D),D+=2,Wm(t);case 221:return t=Yt.getUint32(D),D+=4,Wm(t);case 222:return t=Yt.getUint16(D),D+=2,Gm(t);case 223:return t=Yt.getUint32(D),D+=4,Gm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const ax=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function wh(e,t){function n(){if(n.count++>Dm){let i=e.read=new Function("r","return function(){return "+(he.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":ax.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ne);return e.highByte===0&&(e.read=zm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Ne()}return he.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?zm(t,n):n}const zm=(e,t)=>function(){let n=mt[D++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=qt[r]||Km()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=wh(i,e)),i.read()};function Km(){let e=Qm(()=>(mt=null,he.getStructures()));return qt=he._mergeStructures(e,qt)}var Eh=Ko,cx=Ko,lx=Ko,ux=Ko;function Ko(e){let t;if(e<16&&(t=kh(e)))return t;if(e>64&&bh)return bh.decode(mt.subarray(D,D+=e));const n=D+e,r=[];for(t="";D<n;){const i=mt[D++];if(!(i&128))r.push(i);else if((i&224)===192){const s=mt[D++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=mt[D++]&63,o=mt[D++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=mt[D++]&63,o=mt[D++]&63,a=mt[D++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Ze.apply(String,r),r.length=0)}return r.length>0&&(t+=Ze.apply(String,r)),t}function Wm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ne();return he.freezeData?Object.freeze(t):t}function Gm(e){if(he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=qm();r==="__proto__"&&(r="__proto_"),t[r]=Ne()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ne(),Ne());return t}}var Ze=String.fromCharCode;function Hm(e){let t=D,n=new Array(e);for(let r=0;r<e;r++){const i=mt[D++];if((i&128)>0){D=t;return}n[r]=i}return Ze.apply(String,n)}function kh(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[D++];if((t&128)>1){D-=1;return}return Ze(t)}}else{let t=mt[D++],n=mt[D++];if((t&128)>0||(n&128)>0){D-=2;return}if(e<3)return Ze(t,n);let r=mt[D++];if((r&128)>0){D-=3;return}return Ze(t,n,r)}else{let t=mt[D++],n=mt[D++],r=mt[D++],i=mt[D++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){D-=4;return}if(e<6){if(e===4)return Ze(t,n,r,i);{let s=mt[D++];if((s&128)>0){D-=5;return}return Ze(t,n,r,i,s)}}else if(e<8){let s=mt[D++],o=mt[D++];if((s&128)>0||(o&128)>0){D-=6;return}if(e<7)return Ze(t,n,r,i,s,o);let a=mt[D++];if((a&128)>0){D-=7;return}return Ze(t,n,r,i,s,o,a)}else{let s=mt[D++],o=mt[D++],a=mt[D++],c=mt[D++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){D-=8;return}if(e<10){if(e===8)return Ze(t,n,r,i,s,o,a,c);{let u=mt[D++];if((u&128)>0){D-=9;return}return Ze(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=mt[D++],l=mt[D++];if((u&128)>0||(l&128)>0){D-=10;return}if(e<11)return Ze(t,n,r,i,s,o,a,c,u,l);let h=mt[D++];if((h&128)>0){D-=11;return}return Ze(t,n,r,i,s,o,a,c,u,l,h)}else{let u=mt[D++],l=mt[D++],h=mt[D++],f=mt[D++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){D-=12;return}if(e<14){if(e===12)return Ze(t,n,r,i,s,o,a,c,u,l,h,f);{let d=mt[D++];if((d&128)>0){D-=13;return}return Ze(t,n,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=mt[D++],p=mt[D++];if((d&128)>0||(p&128)>0){D-=14;return}if(e<15)return Ze(t,n,r,i,s,o,a,c,u,l,h,f,d,p);let g=mt[D++];if((g&128)>0){D-=15;return}return Ze(t,n,r,i,s,o,a,c,u,l,h,f,d,p,g)}}}}}function Ym(){let e=mt[D++],t;if(e<192)t=e-160;else switch(e){case 217:t=mt[D++];break;case 218:t=Yt.getUint16(D),D+=2;break;case 219:t=Yt.getUint32(D),D+=4;break;default:throw new Error("Expected string")}return Ko(t)}function Th(e){return he.copyBuffers?Uint8Array.prototype.slice.call(mt,D,D+=e):mt.subarray(D,D+=e)}function ss(e){let t=mt[D++];if(wn[t]){let n;return wn[t](mt.subarray(D,n=D+=e),r=>{D=r;try{return Ne()}finally{D=n}})}else throw new Error("Unknown extension type "+t)}var Vm=new Array(4096);function qm(){let e=mt[D++];if(e>=160&&e<192){if(e=e-160,Sr>=D)return Ni.slice(D-Yn,(D+=e)-Yn);if(!(Sr==0&&Hn<180))return Eh(e)}else return D--,Jm(Ne());let t=(e<<5^(e>1?Yt.getUint16(D):e>0?mt[D]:0))&4095,n=Vm[t],r=D,i=D+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Yt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=mt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return D=r,n.string;i-=3,r=D}for(n=[],Vm[t]=n,n.bytes=e;r<i;)s=Yt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=mt[r++],n.push(s);let a=e<16?kh(e):Hm(e);return a!=null?n.string=a:n.string=Eh(e)}function Jm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const Xm=(e,t)=>{let n=Ne().map(Jm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=qt[e];return i&&(i.isShared||Ci)&&((qt.restoreStructures||(qt.restoreStructures=[]))[e]=i),qt[e]=n,n.read=wh(n,r),n.read()};wn[0]=()=>{},wn[0].noBuffer=!0,wn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let hx={Error,TypeError,ReferenceError};wn[101]=()=>{let e=Ne();return(hx[e[0]]||Error)(e[1],{cause:e[2]})},wn[105]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Yt.getUint32(D-4);ii||(ii=new Map);let n=mt[D],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};ii.set(t,i);let s=Ne();return i.used?Object.assign(r,s):(i.target=s,s)},wn[112]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Yt.getUint32(D-4),n=ii.get(t);return n.used=!0,n.target},wn[115]=()=>new Set(Ne());const Zm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let fx=typeof globalThis=="object"?globalThis:window;wn[116]=e=>{let t=e[0],n=Zm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new fx[n](Uint8Array.prototype.slice.call(e,1).buffer)},wn[120]=()=>{let e=Ne();return new RegExp(e[0],e[1])};const dx=[];wn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=D;return D+=t-e.length,Xe=dx,Xe=[Ym(),Ym()],Xe.position0=0,Xe.position1=0,Xe.postBundlePosition=D,D=n,Ne()},wn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Qm(e){let t=Hn,n=D,r=Yn,i=Sr,s=Ni,o=ii,a=Xe,c=new Uint8Array(mt.slice(0,Hn)),u=qt,l=qt.slice(0,qt.length),h=he,f=Ci,d=e();return Hn=t,D=n,Yn=r,Sr=i,Ni=s,ii=o,Xe=a,mt=c,Ci=f,qt=u,qt.splice(0,qt.length,...l),he=h,Yt=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),d}function vh(){mt=null,ii=null,qt=null}const xh=new Array(147);for(let e=0;e<256;e++)xh[e]=+("1e"+Math.floor(45.15-e*.30103));var Tc=new zo({useRecords:!1});const px=Tc.unpack;Tc.unpackMultiple,Tc.unpack;let mx=new Float32Array(1);new Uint8Array(mx.buffer,0,4);let vc;try{vc=new TextEncoder}catch{}let Ah,tg;const xc=typeof tn<"u",Ac=xc?function(e){return tn.allocUnsafeSlow(e)}:Uint8Array,eg=xc?tn:Uint8Array,ng=xc?4294967296:2144337920;let q,Wo,fe,z=0,hn,we=null,gx;const yx=21760,_x=/[\u0080-\uFFFF]/,zs=Symbol("record-id");class bx extends zo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=eg.prototype.utf8Write?function(S,_){return q.utf8Write(S,_,q.byteLength-_)}:vc&&vc.encodeInto?function(S,_){return vc.encodeInto(S,q.subarray(_)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=l>32||h+l>64,d=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],k=0,w=0;this.pack=this.encode=function(S,_){if(q||(q=new Ac(8192),fe=q.dataView||(q.dataView=new DataView(q.buffer,0,8192)),z=0),hn=q.length-10,hn-z<2048?(q=new Ac(q.length),fe=q.dataView||(q.dataView=new DataView(q.buffer,0,q.length)),hn=q.length-10,z=0):z=z+7&2147483640,n=z,_&Ax&&(z+=_&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof S!="string"?(we=[],we.size=1/0):we=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let X=i.sharedLength||0;if(X>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let j=0;j<X;j++){let ht=i[j];if(!ht)continue;let Q,ut=i.transitions;for(let G=0,$=ht.length;G<$;G++){let yt=ht[G];Q=ut[yt],Q||(Q=ut[yt]=Object.create(null)),ut=Q}ut[zs]=j+64}this.lastNamedStructuresLength=X}c||(i.nextId=X+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&S&&S.constructor&&S.constructor===Object?U(S):O(S);let X=we;if(we&&sg(n,O,0),s&&s.idsToInsert){let j=s.idsToInsert.sort((G,$)=>G.offset>$.offset?1:-1),ht=j.length,Q=-1;for(;X&&ht>0;){let G=j[--ht].offset+n;G<X.stringsPosition+n&&Q===-1&&(Q=0),G>X.position+n?Q>=0&&(Q+=6):(Q>=0&&(fe.setUint32(X.position+n,fe.getUint32(X.position+n)+Q),Q=-1),X=X.previous,ht++)}Q>=0&&X&&fe.setUint32(X.position+n,fe.getUint32(X.position+n)+Q),z+=j.length*6,z>hn&&M(z),a.offset=z;let ut=Ex(q.subarray(n,z),j);return s=null,ut}return a.offset=z,_&vx?(q.start=n,q.end=z,q):q.subarray(n,z)}catch(X){throw B=X,X}finally{if(i&&(T(),r&&a.saveStructures)){let X=i.sharedLength||0,j=q.subarray(n,z),ht=kx(i,a);if(!B)return a.saveStructures(ht,ht.isCompatible)===!1?a.pack(S,_):(a.lastNamedStructuresLength=X,q.length>1073741824&&(q=null),j)}q.length>1073741824&&(q=null),_&xx&&(z=n)}};const T=()=>{w<10&&w++;let S=i.sharedLength||0;if(i.length>S&&!c&&(i.length=S),k>1e4)i.transitions=null,w=0,k=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let _=0,B=g.length;_<B;_++)g[_][zs]=0;g=[]}},A=S=>{var _=S.length;_<16?q[z++]=144|_:_<65536?(q[z++]=220,q[z++]=_>>8,q[z++]=_&255):(q[z++]=221,fe.setUint32(z,_),z+=4);for(let B=0;B<_;B++)O(S[B])},O=S=>{z>hn&&(q=M(z));var _=typeof S,B;if(_==="string"){let X=S.length;if(we&&X>=4&&X<4096){if((we.size+=X)>yx){let ut,G=(we[0]?we[0].length*3+we[1].length:0)+10;z+G>hn&&(q=M(z+G));let $;we.position?($=we,q[z]=200,z+=3,q[z++]=98,ut=z-n,z+=4,sg(n,O,0),fe.setUint16(ut+n-3,z-n-ut)):(q[z++]=214,q[z++]=98,ut=z-n,z+=4),we=["",""],we.previous=$,we.size=0,we.position=ut}let Q=_x.test(S);we[Q?0:1]+=S,q[z++]=193,O(Q?-X:X);return}let j;X<32?j=1:X<256?j=2:X<65536?j=3:j=5;let ht=X*3;if(z+ht>hn&&(q=M(z+ht)),X<64||!o){let Q,ut,G,$=z+j;for(Q=0;Q<X;Q++)ut=S.charCodeAt(Q),ut<128?q[$++]=ut:ut<2048?(q[$++]=ut>>6|192,q[$++]=ut&63|128):(ut&64512)===55296&&((G=S.charCodeAt(Q+1))&64512)===56320?(ut=65536+((ut&1023)<<10)+(G&1023),Q++,q[$++]=ut>>18|240,q[$++]=ut>>12&63|128,q[$++]=ut>>6&63|128,q[$++]=ut&63|128):(q[$++]=ut>>12|224,q[$++]=ut>>6&63|128,q[$++]=ut&63|128);B=$-z-j}else B=o(S,z+j);B<32?q[z++]=160|B:B<256?(j<2&&q.copyWithin(z+2,z+1,z+1+B),q[z++]=217,q[z++]=B):B<65536?(j<3&&q.copyWithin(z+3,z+2,z+2+B),q[z++]=218,q[z++]=B>>8,q[z++]=B&255):(j<5&&q.copyWithin(z+5,z+3,z+3+B),q[z++]=219,fe.setUint32(z,B),z+=4),z+=B}else if(_==="number")if(S>>>0===S)S<32||S<128&&this.useRecords===!1||S<64&&!this.randomAccessStructure?q[z++]=S:S<256?(q[z++]=204,q[z++]=S):S<65536?(q[z++]=205,q[z++]=S>>8,q[z++]=S&255):(q[z++]=206,fe.setUint32(z,S),z+=4);else if(S>>0===S)S>=-32?q[z++]=256+S:S>=-128?(q[z++]=208,q[z++]=S+256):S>=-32768?(q[z++]=209,fe.setInt16(z,S),z+=2):(q[z++]=210,fe.setInt32(z,S),z+=4);else{let X;if((X=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){q[z++]=202,fe.setFloat32(z,S);let j;if(X<4||(j=S*xh[(q[z]&127)<<1|q[z+1]>>7])>>0===j){z+=4;return}else z--}q[z++]=203,fe.setFloat64(z,S),z+=8}else if(_==="object"||_==="function")if(!S)q[z++]=192;else{if(s){let j=s.get(S);if(j){if(!j.id){let ht=s.idsToInsert||(s.idsToInsert=[]);j.id=ht.push(j)}q[z++]=214,q[z++]=112,fe.setUint32(z,j.id),z+=4;return}else s.set(S,{offset:z-n})}let X=S.constructor;if(X===Object)W(S);else if(X===Array)A(S);else if(X===Map)if(this.mapAsEmptyObject)q[z++]=128;else{B=S.size,B<16?q[z++]=128|B:B<65536?(q[z++]=222,q[z++]=B>>8,q[z++]=B&255):(q[z++]=223,fe.setUint32(z,B),z+=4);for(let[j,ht]of S)O(j),O(ht)}else{for(let j=0,ht=Ah.length;j<ht;j++){let Q=tg[j];if(S instanceof Q){let ut=Ah[j];if(ut.write){ut.type&&(q[z++]=212,q[z++]=ut.type,q[z++]=0);let at=ut.write.call(this,S);at===S?Array.isArray(S)?A(S):W(S):O(at);return}let G=q,$=fe,yt=z;q=null;let st;try{st=ut.pack.call(this,S,at=>(q=G,G=null,z+=at,z>hn&&M(z),{target:q,targetView:fe,position:z-at}),O)}finally{G&&(q=G,fe=$,z=yt,hn=q.length-10)}st&&(st.length+z>hn&&M(st.length+z),z=wx(st,q,z,ut.type));return}}if(Array.isArray(S))A(S);else{if(S.toJSON){const j=S.toJSON();if(j!==S)return O(j)}if(_==="function")return O(this.writeFunction&&this.writeFunction(S));W(S)}}}else if(_==="boolean")q[z++]=S?195:194;else if(_==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))q[z++]=211,fe.setBigInt64(z,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)q[z++]=207,fe.setBigUint64(z,S);else if(this.largeBigIntToFloat)q[z++]=203,fe.setFloat64(z,Number(S));else{if(this.largeBigIntToString)return O(S.toString());if(this.useBigIntExtension&&S<BigInt(2)**BigInt(1023)&&S>-(BigInt(2)**BigInt(1023))){q[z++]=199,z++,q[z++]=66;let X=[],j;do{let ht=S&BigInt(255);j=(ht&BigInt(128))===(S<BigInt(0)?BigInt(128):BigInt(0)),X.push(ht),S>>=BigInt(8)}while(!((S===BigInt(0)||S===BigInt(-1))&&j));q[z-2]=X.length;for(let ht=X.length;ht>0;)q[z++]=Number(X[--ht]);return}else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}z+=8}else if(_==="undefined")this.encodeUndefinedAsNil?q[z++]=192:(q[z++]=212,q[z++]=0,q[z++]=0);else throw new Error("Unknown type: "+_)},P=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?S=>{let _;if(this.skipValues){_=[];for(let j in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(j))&&!this.skipValues.includes(S[j])&&_.push(j)}else _=Object.keys(S);let B=_.length;B<16?q[z++]=128|B:B<65536?(q[z++]=222,q[z++]=B>>8,q[z++]=B&255):(q[z++]=223,fe.setUint32(z,B),z+=4);let X;if(this.coercibleKeyAsNumber)for(let j=0;j<B;j++){X=_[j];let ht=Number(X);O(isNaN(ht)?X:ht),O(S[X])}else for(let j=0;j<B;j++)O(X=_[j]),O(S[X])}:S=>{q[z++]=222;let _=z-n;z+=2;let B=0;for(let X in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(X))&&(O(X),O(S[X]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');q[_+++n]=B>>8,q[_+n]=B&255},L=this.useRecords===!1?P:t.progressiveRecords&&!f?S=>{let _,B=i.transitions||(i.transitions=Object.create(null)),X=z++-n,j;for(let ht in S)if(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ht)){if(_=B[ht],_)B=_;else{let Q=Object.keys(S),ut=B;B=i.transitions;let G=0;for(let $=0,yt=Q.length;$<yt;$++){let st=Q[$];_=B[st],_||(_=B[st]=Object.create(null),G++),B=_}X+n+1==z?(z--,et(B,Q,G)):pt(B,Q,X,G),j=!0,B=ut[ht]}O(S[ht])}if(!j){let ht=B[zs];ht?q[X+n]=ht:pt(B,Object.keys(S),X,0)}}:S=>{let _,B=i.transitions||(i.transitions=Object.create(null)),X=0;for(let ht in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ht))&&(_=B[ht],_||(_=B[ht]=Object.create(null),X++),B=_);let j=B[zs];j?j>=96&&f?(q[z++]=((j-=96)&31)+96,q[z++]=j>>5):q[z++]=j:et(B,B.__keys__||Object.keys(S),X);for(let ht in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ht))&&O(S[ht])},C=typeof this.useRecords=="function"&&this.useRecords,W=C?S=>{C(S)?L(S):P(S)}:L,M=S=>{let _;if(S>16777216){if(S-n>ng)throw new Error("Packed buffer would be larger than maximum buffer size");_=Math.min(ng,Math.round(Math.max((S-n)*(S>67108864?1.25:2),4194304)/4096)*4096)}else _=(Math.max(S-n<<2,q.length-1)>>12)+1<<12;let B=new Ac(_);return fe=B.dataView||(B.dataView=new DataView(B.buffer,0,_)),S=Math.min(S,q.length),q.copy?q.copy(B,0,n,S):B.set(q.slice(n,S)),z-=n,n=0,hn=B.length-10,q=B},et=(S,_,B)=>{let X=i.nextId;X||(X=64),X<d&&this.shouldShareStructure&&!this.shouldShareStructure(_)?(X=i.nextOwnId,X<p||(X=d),i.nextOwnId=X+1):(X>=p&&(X=d),i.nextId=X+1);let j=_.highByte=X>=96&&f?X-96>>5:-1;S[zs]=X,S.__keys__=_,i[X-64]=_,X<d?(_.isShared=!0,i.sharedLength=X-63,r=!0,j>=0?(q[z++]=(X&31)+96,q[z++]=j):q[z++]=X):(j>=0?(q[z++]=213,q[z++]=114,q[z++]=(X&31)+96,q[z++]=j):(q[z++]=212,q[z++]=114,q[z++]=X),B&&(k+=w*B),g.length>=h&&(g.shift()[zs]=0),g.push(S),O(_))},pt=(S,_,B,X)=>{let j=q,ht=z,Q=hn,ut=n;q=Wo,z=0,n=0,q||(Wo=q=new Ac(8192)),hn=q.length-10,et(S,_,X),Wo=q;let G=z;if(q=j,z=ht,hn=Q,n=ut,G>1){let $=z+G-1;$>hn&&M($);let yt=B+n;q.copyWithin(yt+G,yt+1,z),q.set(Wo.slice(0,G),yt),z=$}else q[B+n]=Wo[0]},U=S=>{let _=gx(S,q,n,z,i,M,(B,X,j)=>{if(j)return r=!0;z=X;let ht=q;return O(B),T(),ht!==q?{position:z,targetView:fe,target:q}:z},this);if(_===0)return W(S);z=_}}useBuffer(t){q=t,q.dataView||(q.dataView=new DataView(q.buffer,q.byteOffset,q.byteLength)),z=0}set position(t){z=t}get position(){return z}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}tg=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Bm],Ah=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?rg(e,16,t):ig(xc?tn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==eg&&this.moreTypes?rg(e,Zm.indexOf(n.name),t):ig(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function rg(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function ig(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function wx(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function Ex(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function sg(e,t,n){if(we.length>0){fe.setUint32(we.position+e,z+n-we.position-e),we.stringsPosition=z-e;let r=we;we=null,t(r[0]),t(r[1])}}function kx(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let og=new bx({useRecords:!1});const Tx=og.pack;og.pack;const vx=512,xx=1024,Ax=2048;function Ce(){return null}function Ks(e,t,n={}){if(!E(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];E(c)&&(a=c(a));const u=t[o];E(u)&&(o=u),a!==null&&r.push(o,a)}return r}function Go(e,t,n={}){if(E(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];E(a)&&(s=a);const c=n[s];E(c)&&(o=c(o)),r[s]=o}return r}catch(r){ae(H,"binary",r.message)}}function Sx(e){try{const t=pr(e);return Tx(t)}catch(t){ae(H,"binary",t.message)}}function Rx(e){try{return px(e)}catch(t){ae(H,"binary",t.message)}}function ag(){return{id:Ie()}}var Sc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(Sc||{});function Rc(e){return E(e==null?void 0:e.id)?Ks(e,Sc,{category:Ce,kinddata:Ce,stopped:Ce,removed:Ce,bucket:Ce}):Ks(e,Sc,{id:Ce,x:Ce,y:Ce,lx:Ce,ly:Ce,code:Ce,category:Ce,kinddata:Ce,stopped:Ce,removed:Ce,bucket:Ce})}function Ic(e){return Go(e,Sc)}function Sh(e){var t;return((t=e==null?void 0:e.id)==null?void 0:t.length)??!1}function Oc(e,t){if(!E(e)||!bn(t))return;const{color:n,bg:r}=Im(t);E(n)&&(e.color=n),E(r)&&(e.bg=r)}function os(e){var t;return Bt((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function cg(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function lg(e){const t=Math.floor(e.length/pc);if(t*pc!==e.length){ae(H,"size","wrong number of bytes for a palette");return}const n=cg(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function Ix(e,t){return e&1<<t?255:0}function ug(e){const t=Math.floor(e.length/gh);if(t*gh!==e.length){ae(H,"size","wrong number of bytes for a charset");return}const n=Math.ceil(t/yc),r=mc*yc,i=cg(r,gc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*gc+a,l=e[c];for(let h=0;h<mc;++h){const f=s*mc+h;i.bits[f+u*r]=Ix(l,7-h)}++a,a===gc&&(a=0,++s,s===yc&&(s=0,++o))}return i}const Ox=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Nx=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);var hg=typeof Ss=="object"&&Ss&&Ss.Object===Object&&Ss,Cx=typeof self=="object"&&self&&self.Object===Object&&self,Rr=hg||Cx||Function("return this")(),Vn=Rr.Symbol,fg=Object.prototype,Lx=fg.hasOwnProperty,Mx=fg.toString,Ho=Vn?Vn.toStringTag:void 0;function Ux(e){var t=Lx.call(e,Ho),n=e[Ho];try{e[Ho]=void 0;var r=!0}catch{}var i=Mx.call(e);return r&&(t?e[Ho]=n:delete e[Ho]),i}var Px=Object.prototype,Bx=Px.toString;function Fx(e){return Bx.call(e)}var Dx="[object Null]",$x="[object Undefined]",dg=Vn?Vn.toStringTag:void 0;function Li(e){return e==null?e===void 0?$x:Dx:dg&&dg in Object(e)?Ux(e):Fx(e)}function sr(e){return e!=null&&typeof e=="object"}var jx="[object Symbol]";function Nc(e){return typeof e=="symbol"||sr(e)&&Li(e)==jx}function Cc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var Xt=Array.isArray,zx=1/0,pg=Vn?Vn.prototype:void 0,mg=pg?pg.toString:void 0;function gg(e){if(typeof e=="string")return e;if(Xt(e))return Cc(e,gg)+"";if(Nc(e))return mg?mg.call(e):"";var t=e+"";return t=="0"&&1/e==-zx?"-0":t}var Kx=/\s/;function Wx(e){for(var t=e.length;t--&&Kx.test(e.charAt(t)););return t}var Gx=/^\s+/;function Hx(e){return e&&e.slice(0,Wx(e)+1).replace(Gx,"")}function qn(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var yg=NaN,Yx=/^[-+]0x[0-9a-f]+$/i,Vx=/^0b[01]+$/i,qx=/^0o[0-7]+$/i,Jx=parseInt;function Xx(e){if(typeof e=="number")return e;if(Nc(e))return yg;if(qn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=qn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Hx(e);var n=Vx.test(e);return n||qx.test(e)?Jx(e.slice(2),n?2:8):Yx.test(e)?yg:+e}var _g=1/0,Zx=17976931348623157e292;function Qx(e){if(!e)return e===0?e:0;if(e=Xx(e),e===_g||e===-_g){var t=e<0?-1:1;return t*Zx}return e===e?e:0}function Lc(e){var t=Qx(e),n=t%1;return t===t?n?t-n:t:0}function Ws(e){return e}var tA="[object AsyncFunction]",eA="[object Function]",nA="[object GeneratorFunction]",rA="[object Proxy]";function si(e){if(!qn(e))return!1;var t=Li(e);return t==eA||t==nA||t==tA||t==rA}var Rh=Rr["__core-js_shared__"],bg=function(){var e=/[^.]+$/.exec(Rh&&Rh.keys&&Rh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function iA(e){return!!bg&&bg in e}var sA=Function.prototype,oA=sA.toString;function as(e){if(e!=null){try{return oA.call(e)}catch{}try{return e+""}catch{}}return""}var aA=/[\\^$.*+?()[\]{}|]/g,cA=/^\[object .+?Constructor\]$/,lA=Function.prototype,uA=Object.prototype,hA=lA.toString,fA=uA.hasOwnProperty,dA=RegExp("^"+hA.call(fA).replace(aA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function pA(e){if(!qn(e)||iA(e))return!1;var t=si(e)?dA:cA;return t.test(as(e))}function mA(e,t){return e==null?void 0:e[t]}function cs(e,t){var n=mA(e,t);return pA(n)?n:void 0}var Ih=cs(Rr,"WeakMap"),wg=Object.create,gA=function(){function e(){}return function(t){if(!qn(t))return{};if(wg)return wg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function yA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function ze(){}function _A(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var bA=800,wA=16,EA=Date.now;function kA(e){var t=0,n=0;return function(){var r=EA(),i=wA-(r-n);if(n=r,i>0){if(++t>=bA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function TA(e){return function(){return e}}var Mc=function(){try{var e=cs(Object,"defineProperty");return e({},"",{}),e}catch{}}(),vA=Mc?function(e,t){return Mc(e,"toString",{configurable:!0,enumerable:!1,value:TA(t),writable:!0})}:Ws,xA=kA(vA);function Eg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function kg(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function AA(e){return e!==e}function SA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function Oh(e,t,n){return t===t?SA(e,t,n):kg(e,AA,n)}function Tg(e,t){var n=e==null?0:e.length;return!!n&&Oh(e,t,0)>-1}var RA=9007199254740991,IA=/^(?:0|[1-9]\d*)$/;function Uc(e,t){var n=typeof e;return t=t??RA,!!t&&(n=="number"||n!="symbol"&&IA.test(e))&&e>-1&&e%1==0&&e<t}function Nh(e,t,n){t=="__proto__"&&Mc?Mc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Yo(e,t){return e===t||e!==e&&t!==t}var OA=Object.prototype,NA=OA.hasOwnProperty;function Pc(e,t,n){var r=e[t];(!(NA.call(e,t)&&Yo(r,n))||n===void 0&&!(t in e))&&Nh(e,t,n)}function Ch(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Nh(n,a,c):Pc(n,a,c)}return n}var vg=Math.max;function CA(e,t,n){return t=vg(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=vg(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),yA(e,this,a)}}function Lh(e,t){return xA(CA(e,t,Ws),e+"")}var LA=9007199254740991;function Mh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=LA}function Ir(e){return e!=null&&Mh(e.length)&&!si(e)}function xg(e,t,n){if(!qn(n))return!1;var r=typeof t;return(r=="number"?Ir(n)&&Uc(t,n.length):r=="string"&&t in n)?Yo(n[t],e):!1}function MA(e){return Lh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&xg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var UA=Object.prototype;function Vo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||UA;return e===n}function PA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var BA="[object Arguments]";function Ag(e){return sr(e)&&Li(e)==BA}var Sg=Object.prototype,FA=Sg.hasOwnProperty,DA=Sg.propertyIsEnumerable,Bc=Ag(function(){return arguments}())?Ag:function(e){return sr(e)&&FA.call(e,"callee")&&!DA.call(e,"callee")};function $A(){return!1}var Rg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ig=Rg&&typeof module=="object"&&module&&!module.nodeType&&module,jA=Ig&&Ig.exports===Rg,Og=jA?Rr.Buffer:void 0,zA=Og?Og.isBuffer:void 0,qo=zA||$A,KA="[object Arguments]",WA="[object Array]",GA="[object Boolean]",HA="[object Date]",YA="[object Error]",VA="[object Function]",qA="[object Map]",JA="[object Number]",XA="[object Object]",ZA="[object RegExp]",QA="[object Set]",t2="[object String]",e2="[object WeakMap]",n2="[object ArrayBuffer]",r2="[object DataView]",i2="[object Float32Array]",s2="[object Float64Array]",o2="[object Int8Array]",a2="[object Int16Array]",c2="[object Int32Array]",l2="[object Uint8Array]",u2="[object Uint8ClampedArray]",h2="[object Uint16Array]",f2="[object Uint32Array]",ge={};ge[i2]=ge[s2]=ge[o2]=ge[a2]=ge[c2]=ge[l2]=ge[u2]=ge[h2]=ge[f2]=!0,ge[KA]=ge[WA]=ge[n2]=ge[GA]=ge[r2]=ge[HA]=ge[YA]=ge[VA]=ge[qA]=ge[JA]=ge[XA]=ge[ZA]=ge[QA]=ge[t2]=ge[e2]=!1;function d2(e){return sr(e)&&Mh(e.length)&&!!ge[Li(e)]}function Fc(e){return function(t){return e(t)}}var Ng=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Jo=Ng&&typeof module=="object"&&module&&!module.nodeType&&module,p2=Jo&&Jo.exports===Ng,Uh=p2&&hg.process,Mi=function(){try{var e=Jo&&Jo.require&&Jo.require("util").types;return e||Uh&&Uh.binding&&Uh.binding("util")}catch{}}(),Cg=Mi&&Mi.isTypedArray,Ph=Cg?Fc(Cg):d2,m2=Object.prototype,g2=m2.hasOwnProperty;function Lg(e,t){var n=Xt(e),r=!n&&Bc(e),i=!n&&!r&&qo(e),s=!n&&!r&&!i&&Ph(e),o=n||r||i||s,a=o?PA(e.length,String):[],c=a.length;for(var u in e)(t||g2.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Uc(u,c)))&&a.push(u);return a}function Mg(e,t){return function(n){return e(t(n))}}var y2=Mg(Object.keys,Object),_2=Object.prototype,b2=_2.hasOwnProperty;function Ug(e){if(!Vo(e))return y2(e);var t=[];for(var n in Object(e))b2.call(e,n)&&n!="constructor"&&t.push(n);return t}function Jn(e){return Ir(e)?Lg(e):Ug(e)}var w2=Object.prototype,E2=w2.hasOwnProperty,En=MA(function(e,t){if(Vo(t)||Ir(t)){Ch(t,Jn(t),e);return}for(var n in t)E2.call(t,n)&&Pc(e,n,t[n])});function k2(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var T2=Object.prototype,v2=T2.hasOwnProperty;function x2(e){if(!qn(e))return k2(e);var t=Vo(e),n=[];for(var r in e)r=="constructor"&&(t||!v2.call(e,r))||n.push(r);return n}function Pg(e){return Ir(e)?Lg(e,!0):x2(e)}var A2=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S2=/^\w*$/;function Bh(e,t){if(Xt(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Nc(e)?!0:S2.test(e)||!A2.test(e)||t!=null&&e in Object(t)}var Xo=cs(Object,"create");function R2(){this.__data__=Xo?Xo(null):{},this.size=0}function I2(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var O2="__lodash_hash_undefined__",N2=Object.prototype,C2=N2.hasOwnProperty;function L2(e){var t=this.__data__;if(Xo){var n=t[e];return n===O2?void 0:n}return C2.call(t,e)?t[e]:void 0}var M2=Object.prototype,U2=M2.hasOwnProperty;function P2(e){var t=this.__data__;return Xo?t[e]!==void 0:U2.call(t,e)}var B2="__lodash_hash_undefined__";function F2(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Xo&&t===void 0?B2:t,this}function ls(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ls.prototype.clear=R2,ls.prototype.delete=I2,ls.prototype.get=L2,ls.prototype.has=P2,ls.prototype.set=F2;function D2(){this.__data__=[],this.size=0}function Dc(e,t){for(var n=e.length;n--;)if(Yo(e[n][0],t))return n;return-1}var $2=Array.prototype,j2=$2.splice;function z2(e){var t=this.__data__,n=Dc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():j2.call(t,n,1),--this.size,!0}function K2(e){var t=this.__data__,n=Dc(t,e);return n<0?void 0:t[n][1]}function W2(e){return Dc(this.__data__,e)>-1}function G2(e,t){var n=this.__data__,r=Dc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function oi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}oi.prototype.clear=D2,oi.prototype.delete=z2,oi.prototype.get=K2,oi.prototype.has=W2,oi.prototype.set=G2;var Zo=cs(Rr,"Map");function H2(){this.size=0,this.__data__={hash:new ls,map:new(Zo||oi),string:new ls}}function Y2(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function $c(e,t){var n=e.__data__;return Y2(t)?n[typeof t=="string"?"string":"hash"]:n.map}function V2(e){var t=$c(this,e).delete(e);return this.size-=t?1:0,t}function q2(e){return $c(this,e).get(e)}function J2(e){return $c(this,e).has(e)}function X2(e,t){var n=$c(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function ai(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ai.prototype.clear=H2,ai.prototype.delete=V2,ai.prototype.get=q2,ai.prototype.has=J2,ai.prototype.set=X2;var Z2="Expected a function";function Fh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Z2);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Fh.Cache||ai),n}Fh.Cache=ai;var Q2=500;function tS(e){var t=Fh(e,function(r){return n.size===Q2&&n.clear(),r}),n=t.cache;return t}var eS=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nS=/\\(\\)?/g,rS=tS(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(eS,function(n,r,i,s){t.push(i?s.replace(nS,"$1"):r||n)}),t});function Bg(e){return e==null?"":gg(e)}function jc(e,t){return Xt(e)?e:Bh(e,t)?[e]:rS(Bg(e))}var iS=1/0;function Qo(e){if(typeof e=="string"||Nc(e))return e;var t=e+"";return t=="0"&&1/e==-iS?"-0":t}function Dh(e,t){t=jc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Qo(t[n++])];return n&&n==r?e:void 0}function sS(e,t,n){var r=e==null?void 0:Dh(e,t);return r===void 0?n:r}function $h(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Fg=Vn?Vn.isConcatSpreadable:void 0;function oS(e){return Xt(e)||Bc(e)||!!(Fg&&e&&e[Fg])}function jh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=oS),i||(i=[]);++s<o;){var a=e[s];n(a)?$h(i,a):r||(i[i.length]=a)}return i}function Un(e){var t=e==null?0:e.length;return t?jh(e):[]}var Dg=Mg(Object.getPrototypeOf,Object);function zh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function aS(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:zh(e,t,n)}var cS="\\ud800-\\udfff",lS="\\u0300-\\u036f",uS="\\ufe20-\\ufe2f",hS="\\u20d0-\\u20ff",fS=lS+uS+hS,dS="\\ufe0e\\ufe0f",pS="\\u200d",mS=RegExp("["+pS+cS+fS+dS+"]");function $g(e){return mS.test(e)}function gS(e){return e.split("")}var jg="\\ud800-\\udfff",yS="\\u0300-\\u036f",_S="\\ufe20-\\ufe2f",bS="\\u20d0-\\u20ff",wS=yS+_S+bS,ES="\\ufe0e\\ufe0f",kS="["+jg+"]",Kh="["+wS+"]",Wh="\\ud83c[\\udffb-\\udfff]",TS="(?:"+Kh+"|"+Wh+")",zg="[^"+jg+"]",Kg="(?:\\ud83c[\\udde6-\\uddff]){2}",Wg="[\\ud800-\\udbff][\\udc00-\\udfff]",vS="\\u200d",Gg=TS+"?",Hg="["+ES+"]?",xS="(?:"+vS+"(?:"+[zg,Kg,Wg].join("|")+")"+Hg+Gg+")*",AS=Hg+Gg+xS,SS="(?:"+[zg+Kh+"?",Kh,Kg,Wg,kS].join("|")+")",RS=RegExp(Wh+"(?="+Wh+")|"+SS+AS,"g");function IS(e){return e.match(RS)||[]}function OS(e){return $g(e)?IS(e):gS(e)}function NS(e){return function(t){t=Bg(t);var n=$g(t)?OS(t):void 0,r=n?n[0]:t.charAt(0),i=n?aS(n,1).join(""):t.slice(1);return r[e]()+i}}var Yg=NS("toUpperCase");function CS(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function LS(){this.__data__=new oi,this.size=0}function MS(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function US(e){return this.__data__.get(e)}function PS(e){return this.__data__.has(e)}var BS=200;function FS(e,t){var n=this.__data__;if(n instanceof oi){var r=n.__data__;if(!Zo||r.length<BS-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ai(r)}return n.set(e,t),this.size=n.size,this}function Or(e){var t=this.__data__=new oi(e);this.size=t.size}Or.prototype.clear=LS,Or.prototype.delete=MS,Or.prototype.get=US,Or.prototype.has=PS,Or.prototype.set=FS;function DS(e,t){return e&&Ch(t,Jn(t),e)}var Vg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,qg=Vg&&typeof module=="object"&&module&&!module.nodeType&&module,$S=qg&&qg.exports===Vg,Jg=$S?Rr.Buffer:void 0,Xg=Jg?Jg.allocUnsafe:void 0;function jS(e,t){var n=e.length,r=Xg?Xg(n):new e.constructor(n);return e.copy(r),r}function Gh(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Zg(){return[]}var zS=Object.prototype,KS=zS.propertyIsEnumerable,Qg=Object.getOwnPropertySymbols,Hh=Qg?function(e){return e==null?[]:(e=Object(e),Gh(Qg(e),function(t){return KS.call(e,t)}))}:Zg;function WS(e,t){return Ch(e,Hh(e),t)}var GS=Object.getOwnPropertySymbols,HS=GS?function(e){for(var t=[];e;)$h(t,Hh(e)),e=Dg(e);return t}:Zg;function ty(e,t,n){var r=t(e);return Xt(e)?r:$h(r,n(e))}function Yh(e){return ty(e,Jn,Hh)}function YS(e){return ty(e,Pg,HS)}var Vh=cs(Rr,"DataView"),qh=cs(Rr,"Promise"),Gs=cs(Rr,"Set"),ey="[object Map]",VS="[object Object]",ny="[object Promise]",ry="[object Set]",iy="[object WeakMap]",sy="[object DataView]",qS=as(Vh),JS=as(Zo),XS=as(qh),ZS=as(Gs),QS=as(Ih),Xn=Li;(Vh&&Xn(new Vh(new ArrayBuffer(1)))!=sy||Zo&&Xn(new Zo)!=ey||qh&&Xn(qh.resolve())!=ny||Gs&&Xn(new Gs)!=ry||Ih&&Xn(new Ih)!=iy)&&(Xn=function(e){var t=Li(e),n=t==VS?e.constructor:void 0,r=n?as(n):"";if(r)switch(r){case qS:return sy;case JS:return ey;case XS:return ny;case ZS:return ry;case QS:return iy}return t});var tR=Object.prototype,eR=tR.hasOwnProperty;function nR(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&eR.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var zc=Rr.Uint8Array;function rR(e){var t=new e.constructor(e.byteLength);return new zc(t).set(new zc(e)),t}function iR(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var sR=/\w*$/;function oR(e){var t=new e.constructor(e.source,sR.exec(e));return t.lastIndex=e.lastIndex,t}var oy=Vn?Vn.prototype:void 0,ay=oy?oy.valueOf:void 0;function aR(e){return ay?Object(ay.call(e)):{}}function cR(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var lR="[object Boolean]",uR="[object Date]",hR="[object Map]",fR="[object Number]",dR="[object RegExp]",pR="[object Set]",mR="[object String]",gR="[object Symbol]",yR="[object ArrayBuffer]",_R="[object DataView]",bR="[object Float32Array]",wR="[object Float64Array]",ER="[object Int8Array]",kR="[object Int16Array]",TR="[object Int32Array]",vR="[object Uint8Array]",xR="[object Uint8ClampedArray]",AR="[object Uint16Array]",SR="[object Uint32Array]";function RR(e,t,n){var r=e.constructor;switch(t){case yR:return rR(e);case lR:case uR:return new r(+e);case _R:return iR(e);case bR:case wR:case ER:case kR:case TR:case vR:case xR:case AR:case SR:return cR(e);case hR:return new r;case fR:case mR:return new r(e);case dR:return oR(e);case pR:return new r;case gR:return aR(e)}}function IR(e){return typeof e.constructor=="function"&&!Vo(e)?gA(Dg(e)):{}}var OR="[object Map]";function NR(e){return sr(e)&&Xn(e)==OR}var cy=Mi&&Mi.isMap,CR=cy?Fc(cy):NR,LR="[object Set]";function MR(e){return sr(e)&&Xn(e)==LR}var ly=Mi&&Mi.isSet,UR=ly?Fc(ly):MR,uy="[object Arguments]",PR="[object Array]",BR="[object Boolean]",FR="[object Date]",DR="[object Error]",hy="[object Function]",$R="[object GeneratorFunction]",jR="[object Map]",zR="[object Number]",fy="[object Object]",KR="[object RegExp]",WR="[object Set]",GR="[object String]",HR="[object Symbol]",YR="[object WeakMap]",VR="[object ArrayBuffer]",qR="[object DataView]",JR="[object Float32Array]",XR="[object Float64Array]",ZR="[object Int8Array]",QR="[object Int16Array]",tI="[object Int32Array]",eI="[object Uint8Array]",nI="[object Uint8ClampedArray]",rI="[object Uint16Array]",iI="[object Uint32Array]",de={};de[uy]=de[PR]=de[VR]=de[qR]=de[BR]=de[FR]=de[JR]=de[XR]=de[ZR]=de[QR]=de[tI]=de[jR]=de[zR]=de[fy]=de[KR]=de[WR]=de[GR]=de[HR]=de[eI]=de[nI]=de[rI]=de[iI]=!0,de[DR]=de[hy]=de[YR]=!1;function Kc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!qn(e))return e;var a=Xt(e);if(a)return o=nR(e),_A(e,o);var c=Xn(e),u=c==hy||c==$R;if(qo(e))return jS(e);if(c==fy||c==uy||u&&!i)return o=u?{}:IR(e),WS(e,DS(o,e));if(!de[c])return i?e:{};o=RR(e,c),s||(s=new Or);var l=s.get(e);if(l)return l;s.set(e,o),UR(e)?e.forEach(function(d){o.add(Kc(d,t,n,d,e,s))}):CR(e)&&e.forEach(function(d,p){o.set(p,Kc(d,t,n,p,e,s))});var h=Yh,f=a?void 0:h(e);return Eg(f||e,function(d,p){f&&(p=d,d=e[p]),Pc(o,p,Kc(d,t,n,p,e,s))}),o}var sI=4;function en(e){return Kc(e,sI)}function ta(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var oI="__lodash_hash_undefined__";function aI(e){return this.__data__.set(e,oI),this}function cI(e){return this.__data__.has(e)}function Hs(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new ai;++t<n;)this.add(e[t])}Hs.prototype.add=Hs.prototype.push=aI,Hs.prototype.has=cI;function dy(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Jh(e,t){return e.has(t)}var lI=1,uI=2;function py(e,t,n,r,i,s){var o=n&lI,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,f=!0,d=n&uI?new Hs:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],g=t[h];if(r)var k=o?r(g,p,h,t,e,s):r(p,g,h,e,t,s);if(k!==void 0){if(k)continue;f=!1;break}if(d){if(!dy(t,function(w,T){if(!Jh(d,T)&&(p===w||i(p,w,n,r,s)))return d.push(T)})){f=!1;break}}else if(!(p===g||i(p,g,n,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}function hI(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Xh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var fI=1,dI=2,pI="[object Boolean]",mI="[object Date]",gI="[object Error]",yI="[object Map]",_I="[object Number]",bI="[object RegExp]",wI="[object Set]",EI="[object String]",kI="[object Symbol]",TI="[object ArrayBuffer]",vI="[object DataView]",my=Vn?Vn.prototype:void 0,Zh=my?my.valueOf:void 0;function xI(e,t,n,r,i,s,o){switch(n){case vI:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case TI:return!(e.byteLength!=t.byteLength||!s(new zc(e),new zc(t)));case pI:case mI:case _I:return Yo(+e,+t);case gI:return e.name==t.name&&e.message==t.message;case bI:case EI:return e==t+"";case yI:var a=hI;case wI:var c=r&fI;if(a||(a=Xh),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=dI,o.set(e,t);var l=py(a(e),a(t),r,i,s,o);return o.delete(e),l;case kI:if(Zh)return Zh.call(e)==Zh.call(t)}return!1}var AI=1,SI=Object.prototype,RI=SI.hasOwnProperty;function II(e,t,n,r,i,s){var o=n&AI,a=Yh(e),c=a.length,u=Yh(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in t:RI.call(t,f)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var g=!0;s.set(e,t),s.set(t,e);for(var k=o;++h<c;){f=a[h];var w=e[f],T=t[f];if(r)var A=o?r(T,w,f,t,e,s):r(w,T,f,e,t,s);if(!(A===void 0?w===T||i(w,T,n,r,s):A)){g=!1;break}k||(k=f=="constructor")}if(g&&!k){var O=e.constructor,P=t.constructor;O!=P&&"constructor"in e&&"constructor"in t&&!(typeof O=="function"&&O instanceof O&&typeof P=="function"&&P instanceof P)&&(g=!1)}return s.delete(e),s.delete(t),g}var OI=1,gy="[object Arguments]",yy="[object Array]",Wc="[object Object]",NI=Object.prototype,_y=NI.hasOwnProperty;function CI(e,t,n,r,i,s){var o=Xt(e),a=Xt(t),c=o?yy:Xn(e),u=a?yy:Xn(t);c=c==gy?Wc:c,u=u==gy?Wc:u;var l=c==Wc,h=u==Wc,f=c==u;if(f&&qo(e)){if(!qo(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Or),o||Ph(e)?py(e,t,n,r,i,s):xI(e,t,c,n,r,i,s);if(!(n&OI)){var d=l&&_y.call(e,"__wrapped__"),p=h&&_y.call(t,"__wrapped__");if(d||p){var g=d?e.value():e,k=p?t.value():t;return s||(s=new Or),i(g,k,n,r,s)}}return f?(s||(s=new Or),II(e,t,n,r,i,s)):!1}function Qh(e,t,n,r,i){return e===t?!0:e==null||t==null||!sr(e)&&!sr(t)?e!==e&&t!==t:CI(e,t,n,r,Qh,i)}var LI=1,MI=2;function UI(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Or,h;if(!(h===void 0?Qh(u,c,LI|MI,r,l):h))return!1}}return!0}function by(e){return e===e&&!qn(e)}function PI(e){for(var t=Jn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,by(i)]}return t}function wy(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function BI(e){var t=PI(e);return t.length==1&&t[0][2]?wy(t[0][0],t[0][1]):function(n){return n===e||UI(n,e,t)}}function FI(e,t){return e!=null&&t in Object(e)}function Ey(e,t,n){t=jc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=Qo(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Mh(i)&&Uc(o,i)&&(Xt(e)||Bc(e)))}function DI(e,t){return e!=null&&Ey(e,t,FI)}var $I=1,jI=2;function zI(e,t){return Bh(e)&&by(t)?wy(Qo(e),t):function(n){var r=sS(n,e);return r===void 0&&r===t?DI(n,e):Qh(t,r,$I|jI)}}function KI(e){return function(t){return t==null?void 0:t[e]}}function WI(e){return function(t){return Dh(t,e)}}function GI(e){return Bh(e)?KI(Qo(e)):WI(e)}function Nr(e){return typeof e=="function"?e:e==null?Ws:typeof e=="object"?Xt(e)?zI(e[0],e[1]):BI(e):GI(e)}function HI(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function YI(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var VI=YI();function qI(e,t){return e&&VI(e,t,Jn)}function JI(e,t){return function(n,r){if(n==null)return n;if(!Ir(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var us=JI(qI);function XI(e,t,n,r){return us(e,function(i,s,o){t(r,i,n(i),o)}),r}function ZI(e,t){return function(n,r){var i=Xt(n)?HI:XI,s=t?t():{};return i(n,e,Nr(r),s)}}var ky=Object.prototype,QI=ky.hasOwnProperty,tf=Lh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&xg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Pg(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Yo(l,ky[u])&&!QI.call(e,u))&&(e[u]=s[u])}return e});function Ty(e){return sr(e)&&Ir(e)}var tO=200;function eO(e,t,n,r){var i=-1,s=Tg,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=tO&&(s=Jh,o=!1,t=new Hs(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var Gc=Lh(function(e,t){return Ty(e)?eO(e,jh(t,1,Ty,!0)):[]});function Ys(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function nn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Lc(t),zh(e,t<0?0:t,r)):[]}function ea(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Lc(t),t=r-t,zh(e,0,t<0?0:t)):[]}function nO(e){return typeof e=="function"?e:Ws}function St(e,t){var n=Xt(e)?Eg:us;return n(e,nO(t))}function rO(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function iO(e,t){var n=!0;return us(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function or(e,t,n){var r=Xt(e)?rO:iO;return r(e,Nr(t))}function vy(e,t){var n=[];return us(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function Zn(e,t){var n=Xt(e)?Gh:vy;return n(e,Nr(t))}function sO(e){return function(t,n,r){var i=Object(t);if(!Ir(t)){var s=Nr(n);t=Jn(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var oO=Math.max;function aO(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Lc(n);return i<0&&(i=oO(r+i,0)),kg(e,Nr(t),i)}var Vs=sO(aO);function ar(e){return e&&e.length?e[0]:void 0}function cO(e,t){var n=-1,r=Ir(e)?Array(e.length):[];return us(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function Et(e,t){var n=Xt(e)?Cc:cO;return n(e,Nr(t))}function Qn(e,t){return jh(Et(e,t))}var lO=Object.prototype,uO=lO.hasOwnProperty,xy=ZI(function(e,t,n){uO.call(e,n)?e[n].push(t):Nh(e,n,[t])}),hO=Object.prototype,fO=hO.hasOwnProperty;function dO(e,t){return e!=null&&fO.call(e,t)}function xt(e,t){return e!=null&&Ey(e,t,dO)}var pO="[object String]";function kn(e){return typeof e=="string"||!Xt(e)&&sr(e)&&Li(e)==pO}function mO(e,t){return Cc(t,function(n){return e[n]})}function Ue(e){return e==null?[]:mO(e,Jn(e))}var gO=Math.max;function fn(e,t,n,r){e=Ir(e)?e:Ue(e),n=n&&!r?Lc(n):0;var i=e.length;return n<0&&(n=gO(i+n,0)),kn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Oh(e,t,n)>-1}function Ay(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return Oh(e,t,i)}var yO="[object Map]",_O="[object Set]",bO=Object.prototype,wO=bO.hasOwnProperty;function pe(e){if(e==null)return!0;if(Ir(e)&&(Xt(e)||typeof e=="string"||typeof e.splice=="function"||qo(e)||Ph(e)||Bc(e)))return!e.length;var t=Xn(e);if(t==yO||t==_O)return!e.size;if(Vo(e))return!Ug(e).length;for(var n in e)if(wO.call(e,n))return!1;return!0}var EO="[object RegExp]";function kO(e){return sr(e)&&Li(e)==EO}var Sy=Mi&&Mi.isRegExp,ci=Sy?Fc(Sy):kO;function li(e){return e===void 0}var TO="Expected a function";function vO(e){if(typeof e!="function")throw new TypeError(TO);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function xO(e,t,n,r){if(!qn(e))return e;t=jc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Qo(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=qn(l)?l:Uc(t[i+1])?[]:{})}Pc(a,c,u),a=a[c]}return e}function AO(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Dh(e,o);n(a,o)&&xO(s,jc(o,e),a)}return s}function cr(e,t){if(e==null)return{};var n=Cc(YS(e),function(r){return[r]});return t=Nr(t),AO(e,n,function(r,i){return t(r,i[0])})}function SO(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Tn(e,t,n){var r=Xt(e)?CS:SO,i=arguments.length<3;return r(e,Nr(t),n,i,us)}function Hc(e,t){var n=Xt(e)?Gh:vy;return n(e,vO(Nr(t)))}function RO(e,t){var n;return us(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function ef(e,t,n){var r=Xt(e)?dy:RO;return r(e,Nr(t))}var IO=1/0,OO=Gs&&1/Xh(new Gs([,-0]))[1]==IO?function(e){return new Gs(e)}:ze,NO=200;function CO(e,t,n){var r=-1,i=Tg,s=e.length,o=!0,a=[],c=a;if(s>=NO){var u=OO(e);if(u)return Xh(u);o=!1,i=Jh,c=new Hs}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Yc(e){return e&&e.length?CO(e):[]}function nf(e){console&&console.error&&console.error(`Error: ${e}`)}function Ry(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Iy(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Oy(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function LO(e){return MO(e)?e.LABEL:e.name}function MO(e){return kn(e.LABEL)&&e.LABEL!==""}class Cr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),St(this.definition,n=>{n.accept(t)})}}class vn extends Cr{constructor(t){super([]),this.idx=1,En(this,cr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class qs extends Cr{constructor(t){super(t.definition),this.orgText="",En(this,cr(t,n=>n!==void 0))}}class xn extends Cr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,En(this,cr(t,n=>n!==void 0))}}class An extends Cr{constructor(t){super(t.definition),this.idx=1,En(this,cr(t,n=>n!==void 0))}}class Lr extends Cr{constructor(t){super(t.definition),this.idx=1,En(this,cr(t,n=>n!==void 0))}}class Mr extends Cr{constructor(t){super(t.definition),this.idx=1,En(this,cr(t,n=>n!==void 0))}}class Ke extends Cr{constructor(t){super(t.definition),this.idx=1,En(this,cr(t,n=>n!==void 0))}}class lr extends Cr{constructor(t){super(t.definition),this.idx=1,En(this,cr(t,n=>n!==void 0))}}class ur extends Cr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,En(this,cr(t,n=>n!==void 0))}}class Ee{constructor(t){this.idx=1,En(this,cr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function UO(e){return Et(e,Vc)}function Vc(e){function t(n){return Et(n,Vc)}if(e instanceof vn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return kn(e.label)&&(n.label=e.label),n}else{if(e instanceof xn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof An)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Lr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Mr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Vc(new Ee({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof lr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Vc(new Ee({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ke)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof ur)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ee){const n={type:"Terminal",name:e.terminalType.name,label:LO(e.terminalType),idx:e.idx};kn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=ci(r)?r.source:r),n}else{if(e instanceof qs)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class hs{visit(t){const n=t;switch(n.constructor){case vn:return this.visitNonTerminal(n);case xn:return this.visitAlternative(n);case An:return this.visitOption(n);case Lr:return this.visitRepetitionMandatory(n);case Mr:return this.visitRepetitionMandatoryWithSeparator(n);case lr:return this.visitRepetitionWithSeparator(n);case Ke:return this.visitRepetition(n);case ur:return this.visitAlternation(n);case Ee:return this.visitTerminal(n);case qs:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function PO(e){return e instanceof xn||e instanceof An||e instanceof Ke||e instanceof Lr||e instanceof Mr||e instanceof lr||e instanceof Ee||e instanceof qs}function qc(e,t=[]){return e instanceof An||e instanceof Ke||e instanceof lr?!0:e instanceof ur?ef(e.definition,r=>qc(r,t)):e instanceof vn&&fn(t,e)?!1:e instanceof Cr?(e instanceof vn&&t.push(e),or(e.definition,r=>qc(r,t))):!1}function BO(e){return e instanceof ur}function Ur(e){if(e instanceof vn)return"SUBRULE";if(e instanceof An)return"OPTION";if(e instanceof ur)return"OR";if(e instanceof Lr)return"AT_LEAST_ONE";if(e instanceof Mr)return"AT_LEAST_ONE_SEP";if(e instanceof lr)return"MANY_SEP";if(e instanceof Ke)return"MANY";if(e instanceof Ee)return"CONSUME";throw Error("non exhaustive match")}class Jc{walk(t,n=[]){St(t.definition,(r,i)=>{const s=nn(t.definition,i+1);if(r instanceof vn)this.walkProdRef(r,s,n);else if(r instanceof Ee)this.walkTerminal(r,s,n);else if(r instanceof xn)this.walkFlat(r,s,n);else if(r instanceof An)this.walkOption(r,s,n);else if(r instanceof Lr)this.walkAtLeastOne(r,s,n);else if(r instanceof Mr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof lr)this.walkManySep(r,s,n);else if(r instanceof Ke)this.walkMany(r,s,n);else if(r instanceof ur)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new An({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=Ny(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new An({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=Ny(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);St(t.definition,s=>{const o=new xn({definition:[s]});this.walk(o,i)})}}function Ny(e,t,n){return[new An({definition:[new Ee({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function na(e){if(e instanceof vn)return na(e.referencedRule);if(e instanceof Ee)return $O(e);if(PO(e))return FO(e);if(BO(e))return DO(e);throw Error("non exhaustive match")}function FO(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=qc(s),t=t.concat(na(s)),r=r+1,i=n.length>r;return Yc(t)}function DO(e){const t=Et(e.definition,n=>na(n));return Yc(Un(t))}function $O(e){return[e.terminalType]}const Cy="_~IN~_";class jO extends Jc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=KO(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new xn({definition:s}),a=na(o);this.follows[i]=a}}function zO(e){const t={};return St(e,n=>{const r=new jO(n).startWalking();En(t,r)}),t}function KO(e,t){return e.name+t+Cy}function It(e){return e.charCodeAt(0)}function rf(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ra(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function Js(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function WO(){throw Error("Internal Error - Should never get here!")}function Ly(e){return e.type==="Character"}const Xc=[];for(let e=It("0");e<=It("9");e++)Xc.push(e);const Zc=[It("_")].concat(Xc);for(let e=It("a");e<=It("z");e++)Zc.push(e);for(let e=It("A");e<=It("Z");e++)Zc.push(e);const My=[It(" "),It("\f"),It(`
`),It("\r"),It("	"),It("\v"),It("	"),It(""),It(""),It(""),It(""),It(""),It(""),It(""),It(""),It(""),It(""),It(""),It(""),It(""),It("\u2028"),It("\u2029"),It(""),It(""),It(""),It("\uFEFF")],GO=/[0-9a-fA-F]/,Qc=/[0-9]/,HO=/[1-9]/;class YO{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ra(r,"global");break;case"i":ra(r,"ignoreCase");break;case"m":ra(r,"multiLine");break;case"u":ra(r,"unicode");break;case"y":ra(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Js(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return WO()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;Js(n);break}if(!(t===!0&&n===void 0)&&Js(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),Js(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[It(`
`),It("\r"),It("\u2028"),It("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Xc;break;case"D":t=Xc,n=!0;break;case"s":t=My;break;case"S":t=My,n=!0;break;case"w":t=Zc;break;case"W":t=Zc,n=!0;break}if(Js(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=It("\f");break;case"n":t=It(`
`);break;case"r":t=It("\r");break;case"t":t=It("	");break;case"v":t=It("\v");break}if(Js(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:It("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:It(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:It(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,Ly(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,Ly(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else rf(r.value,t),t.push(It("-")),rf(i.value,t)}else rf(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:It("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(HO.test(t)===!1)throw Error("Expecting a positive integer");for(;Qc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Qc.test(t)===!1)throw Error("Expecting an integer");for(;Qc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:It(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Qc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(GO.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class sf{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let tl={};const VO=new YO;function el(e){const t=e.toString();if(tl.hasOwnProperty(t))return tl[t];{const n=VO.pattern(t);return tl[t]=n,n}}function qO(){tl={}}const Uy="Complement Sets are not supported for first char optimization",nl=`Unable to use "first char" lexer optimizations:
`;function JO(e,t=!1){try{const n=el(e);return of(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Uy)t&&Ry(`${nl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),nf(`${nl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function of(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)of(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":rl(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(Uy);St(o.value,c=>{if(typeof c=="number")rl(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)rl(l,t,n);else{for(let l=u.from;l<=u.to&&l<sa;l++)rl(l,t,n);if(u.to>=sa){const l=u.from>=sa?u.from:sa,h=u.to,f=Ui(l),d=Ui(h);for(let p=f;p<=d;p++)t[p]=p}}}});break;case"Group":of(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&af(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ue(t)}function rl(e,t,n){const r=Ui(e);t[r]=r,n===!0&&XO(e,t)}function XO(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Ui(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Ui(i.charCodeAt(0));t[s]=s}}}function Py(e,t){return Vs(e.value,n=>{if(typeof n=="number")return fn(t,n);{const r=n;return Vs(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function af(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?Xt(e.value)?or(e.value,af):af(e.value):!1}class ZO extends sf{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){fn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Py(t,this.targetCharCodes)===void 0&&(this.found=!0):Py(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function cf(e,t){if(t instanceof RegExp){const n=el(t),r=new ZO(e);return r.visit(n),r.found}else return Vs(t,n=>fn(e,n.charCodeAt(0)))!==void 0}const fs="PATTERN",ia="defaultMode",il="modes";let By=typeof new RegExp("(?:)").sticky=="boolean";function QO(e,t){t=tf(t,{useSticky:By,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,A)=>A()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{kN()});let r;n("Reject Lexer.NA",()=>{r=Hc(e,T=>T[fs]===We.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Et(r,T=>{const A=T[fs];if(ci(A)){const O=A.source;return O.length===1&&O!=="^"&&O!=="$"&&O!=="."&&!A.ignoreCase?O:O.length===2&&O[0]==="\\"&&!fn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],O[1])?O[1]:t.useSticky?Dy(A):Fy(A)}else{if(si(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const O=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),P=new RegExp(O);return t.useSticky?Dy(P):Fy(P)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=Et(r,T=>T.tokenTypeIdx),a=Et(r,T=>{const A=T.GROUP;if(A!==We.SKIPPED){if(kn(A))return A;if(li(A))return!1;throw Error("non exhaustive match")}}),c=Et(r,T=>{const A=T.LONGER_ALT;if(A)return Xt(A)?Et(A,P=>Ay(r,P)):[Ay(r,A)]}),u=Et(r,T=>T.PUSH_MODE),l=Et(r,T=>xt(T,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const T=zy(t.lineTerminatorCharacters);h=Et(r,A=>!1),t.positionTracking!=="onlyOffset"&&(h=Et(r,A=>xt(A,"LINE_BREAKS")?!!A.LINE_BREAKS:jy(A,T)===!1&&cf(T,A.PATTERN)))});let f,d,p,g;n("Misc Mapping #2",()=>{f=Et(r,$y),d=Et(s,bN),p=Tn(r,(T,A)=>{const O=A.GROUP;return kn(O)&&O!==We.SKIPPED&&(T[O]=[]),T},{}),g=Et(s,(T,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:f[A],short:d[A],group:a[A],push:u[A],pop:l[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let k=!0,w=[];return t.safeMode||n("First Char Optimization",()=>{w=Tn(r,(T,A,O)=>{if(typeof A.PATTERN=="string"){const P=A.PATTERN.charCodeAt(0),L=Ui(P);lf(T,L,g[O])}else if(Xt(A.START_CHARS_HINT)){let P;St(A.START_CHARS_HINT,L=>{const C=typeof L=="string"?L.charCodeAt(0):L,W=Ui(C);P!==W&&(P=W,lf(T,W,g[O]))})}else if(ci(A.PATTERN))if(A.PATTERN.unicode)k=!1,t.ensureOptimizations&&nf(`${nl}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const P=JO(A.PATTERN,t.ensureOptimizations);pe(P)&&(k=!1),St(P,L=>{lf(T,L,g[O])})}else t.ensureOptimizations&&nf(`${nl}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),k=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:g,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:k}}function tN(e,t){let n=[];const r=nN(e);n=n.concat(r.errors);const i=rN(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(eN(s)),n=n.concat(hN(s)),n=n.concat(fN(s,t)),n=n.concat(dN(s)),n}function eN(e){let t=[];const n=Zn(e,r=>ci(r[fs]));return t=t.concat(sN(n)),t=t.concat(cN(n)),t=t.concat(lN(n)),t=t.concat(uN(n)),t=t.concat(oN(n)),t}function nN(e){const t=Zn(e,i=>!xt(i,fs)),n=Et(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ae.MISSING_PATTERN,tokenTypes:[i]})),r=Gc(e,t);return{errors:n,valid:r}}function rN(e){const t=Zn(e,i=>{const s=i[fs];return!ci(s)&&!si(s)&&!xt(s,"exec")&&!kn(s)}),n=Et(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ae.INVALID_PATTERN,tokenTypes:[i]})),r=Gc(e,t);return{errors:n,valid:r}}const iN=/[^\\][$]/;function sN(e){class t extends sf{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Zn(e,i=>{const s=i.PATTERN;try{const o=el(s),a=new t;return a.visit(o),a.found}catch{return iN.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ae.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function oN(e){const t=Zn(e,r=>r.PATTERN.test(""));return Et(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ae.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const aN=/[^\\[][\^]|^\^/;function cN(e){class t extends sf{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Zn(e,i=>{const s=i.PATTERN;try{const o=el(s),a=new t;return a.visit(o),a.found}catch{return aN.test(s.source)}});return Et(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ae.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function lN(e){const t=Zn(e,r=>{const i=r[fs];return i instanceof RegExp&&(i.multiline||i.global)});return Et(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ae.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function uN(e){const t=[];let n=Et(e,s=>Tn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!fn(t,a)&&a.PATTERN!==We.NA&&(t.push(a),o.push(a)),o),[]));n=ta(n);const r=Zn(n,s=>s.length>1);return Et(r,s=>{const o=Et(s,c=>c.name);return{message:`The same RegExp pattern ->${ar(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ae.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function hN(e){const t=Zn(e,r=>{if(!xt(r,"GROUP"))return!1;const i=r.GROUP;return i!==We.SKIPPED&&i!==We.NA&&!kn(i)});return Et(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ae.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function fN(e,t){const n=Zn(e,i=>i.PUSH_MODE!==void 0&&!fn(t,i.PUSH_MODE));return Et(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ae.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function dN(e){const t=[],n=Tn(e,(r,i,s)=>{const o=i.PATTERN;return o===We.NA||(kn(o)?r.push({str:o,idx:s,tokenType:i}):ci(o)&&mN(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return St(e,(r,i)=>{St(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&pN(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Ae.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function pN(e,t){if(ci(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(si(t))return t(e,0,[],{});if(xt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function mN(e){return Vs([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Fy(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Dy(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function gN(e,t,n){const r=[];return xt(e,ia)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ia+`> property in its definition
`,type:Ae.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),xt(e,il)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+il+`> property in its definition
`,type:Ae.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),xt(e,il)&&xt(e,ia)&&!xt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ia}: <${e.defaultMode}>which does not exist
`,type:Ae.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),xt(e,il)&&St(e.modes,(i,s)=>{St(i,(o,a)=>{if(li(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ae.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(xt(o,"LONGER_ALT")){const c=Xt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];St(c,u=>{!li(u)&&!fn(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ae.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function yN(e,t,n){const r=[];let i=!1;const s=ta(Un(Ue(e.modes))),o=Hc(s,c=>c[fs]===We.NA),a=zy(n);return t&&St(o,c=>{const u=jy(c,a);if(u!==!1){const h={message:EN(c,u),type:u.issue,tokenType:c};r.push(h)}else xt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):cf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ae.NO_LINE_BREAKS_FLAGS}),r}function _N(e){const t={},n=Jn(e);return St(n,r=>{const i=e[r];if(Xt(i))t[r]=[];else throw Error("non exhaustive match")}),t}function $y(e){const t=e.PATTERN;if(ci(t))return!1;if(si(t))return!0;if(xt(t,"exec"))return!0;if(kn(t))return!1;throw Error("non exhaustive match")}function bN(e){return kn(e)&&e.length===1?e.charCodeAt(0):!1}const wN={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function jy(e,t){if(xt(e,"LINE_BREAKS"))return!1;if(ci(e.PATTERN)){try{cf(t,e.PATTERN)}catch(n){return{issue:Ae.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(kn(e.PATTERN))return!1;if($y(e))return{issue:Ae.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function EN(e,t){if(t.issue===Ae.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Ae.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function zy(e){return Et(e,n=>kn(n)?n.charCodeAt(0):n)}function lf(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const sa=256;let sl=[];function Ui(e){return e<sa?e:sl[e]}function kN(){if(pe(sl)){sl=new Array(65536);for(let e=0;e<65536;e++)sl[e]=e>255?255+~~(e/255):e}}function oa(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function ol(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let Ky=1;const Wy={};function aa(e){const t=TN(e);vN(t),AN(t),xN(t),St(t,n=>{n.isParent=n.categoryMatches.length>0})}function TN(e){let t=en(e),n=e,r=!0;for(;r;){n=ta(Un(Et(n,s=>s.CATEGORIES)));const i=Gc(n,t);t=t.concat(i),pe(i)?r=!1:n=i}return t}function vN(e){St(e,t=>{Hy(t)||(Wy[Ky]=t,t.tokenTypeIdx=Ky++),Yy(t)&&!Xt(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),Yy(t)||(t.CATEGORIES=[]),SN(t)||(t.categoryMatches=[]),RN(t)||(t.categoryMatchesMap={})})}function xN(e){St(e,t=>{t.categoryMatches=[],St(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(Wy[r].tokenTypeIdx)})})}function AN(e){St(e,t=>{Gy([],t)})}function Gy(e,t){St(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),St(t.CATEGORIES,n=>{const r=e.concat(t);fn(r,n)||Gy(r,n)})}function Hy(e){return xt(e,"tokenTypeIdx")}function Yy(e){return xt(e,"CATEGORIES")}function SN(e){return xt(e,"categoryMatches")}function RN(e){return xt(e,"categoryMatchesMap")}function IN(e){return xt(e,"tokenTypeIdx")}const ON={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Ae;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ae||(Ae={}));const ca={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:ON,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(ca);let We=class{constructor(t,n=ca){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Iy(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=En({},ca,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===ca.lineTerminatorsPattern)this.config.lineTerminatorsPattern=wN;else if(this.config.lineTerminatorCharacters===ca.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Xt(t)?i={modes:{defaultMode:en(t)},defaultMode:ia}:(s=!1,i=en(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(gN(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(yN(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},St(i.modes,(a,c)=>{i.modes[c]=Hc(a,u=>li(u))});const o=Jn(i.modes);if(St(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(tN(a,o))}),pe(this.lexerDefinitionErrors)){aa(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=QO(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=En({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!pe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Et(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}St(this.lexerDefinitionWarning,a=>{Ry(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(By?(this.chopInput=Ws,this.match=this.matchWithTest):(this.updateLastIndex=ze,this.match=this.matchWithExec),s&&(this.handleModes=ze),this.trackStartLines===!1&&(this.computeNewColumn=Ws),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=ze),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Tn(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!pe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{qO()}),this.TRACE_INIT("toFastProperties",()=>{Oy(this)})})}tokenize(t,n=this.defaultMode){if(!pe(this.lexerDefinitionErrors)){const i=Et(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,f,d,p,g,k,w;const T=t,A=T.length;let O=0,P=0;const L=this.hasCustom?0:Math.floor(t.length/10),C=new Array(L),W=[];let M=this.trackStartLines?1:void 0,et=this.trackStartLines?1:void 0;const pt=_N(this.emptyGroups),U=this.trackStartLines,S=this.config.lineTerminatorsPattern;let _=0,B=[],X=[];const j=[],ht=[];Object.freeze(ht);let Q;function ut(){return B}function G(Ut){const Wt=Ui(Ut),Ot=X[Wt];return Ot===void 0?ht:Ot}const $=Ut=>{if(j.length===1&&Ut.tokenType.PUSH_MODE===void 0){const Wt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ut);W.push({offset:Ut.startOffset,line:Ut.startLine,column:Ut.startColumn,length:Ut.image.length,message:Wt})}else{j.pop();const Wt=Ys(j);B=this.patternIdxToConfig[Wt],X=this.charCodeToPatternIdxToConfig[Wt],_=B.length;const Ot=this.canModeBeOptimized[Wt]&&this.config.safeMode===!1;X&&Ot?Q=G:Q=ut}};function yt(Ut){j.push(Ut),X=this.charCodeToPatternIdxToConfig[Ut],B=this.patternIdxToConfig[Ut],_=B.length,_=B.length;const Wt=this.canModeBeOptimized[Ut]&&this.config.safeMode===!1;X&&Wt?Q=G:Q=ut}yt.call(this,n);let st;const at=this.config.recoveryEnabled;for(;O<A;){c=null;const Ut=T.charCodeAt(O),Wt=Q(Ut),Ot=Wt.length;for(r=0;r<Ot;r++){st=Wt[r];const Rt=st.pattern;u=null;const Lt=st.short;if(Lt!==!1?Ut===Lt&&(c=Rt):st.isCustom===!0?(w=Rt.exec(T,O,C,pt),w!==null?(c=w[0],w.payload!==void 0&&(u=w.payload)):c=null):(this.updateLastIndex(Rt,O),c=this.match(Rt,t,O)),c!==null){if(a=st.longerAlt,a!==void 0){const Nt=a.length;for(s=0;s<Nt;s++){const ne=B[a[s]],Re=ne.pattern;if(l=null,ne.isCustom===!0?(w=Re.exec(T,O,C,pt),w!==null?(o=w[0],w.payload!==void 0&&(l=w.payload)):o=null):(this.updateLastIndex(Re,O),o=this.match(Re,t,O)),o&&o.length>c.length){c=o,u=l,st=ne;break}}}break}}if(c!==null){if(h=c.length,f=st.group,f!==void 0&&(d=st.tokenTypeIdx,p=this.createTokenInstance(c,O,d,st.tokenType,M,et,h),this.handlePayload(p,u),f===!1?P=this.addToken(C,P,p):pt[f].push(p)),t=this.chopInput(t,h),O=O+h,et=this.computeNewColumn(et,h),U===!0&&st.canLineTerminator===!0){let Rt=0,Lt,Nt;S.lastIndex=0;do Lt=S.test(c),Lt===!0&&(Nt=S.lastIndex-1,Rt++);while(Lt===!0);Rt!==0&&(M=M+Rt,et=h-Nt,this.updateTokenEndLineColumnLocation(p,f,Nt,Rt,M,et,h))}this.handleModes(st,$,yt,p)}else{const Rt=O,Lt=M,Nt=et;let ne=at===!1;for(;ne===!1&&O<A;)for(t=this.chopInput(t,1),O++,i=0;i<_;i++){const Re=B[i],b=Re.pattern,rt=Re.short;if(rt!==!1?T.charCodeAt(O)===rt&&(ne=!0):Re.isCustom===!0?ne=b.exec(T,O,C,pt)!==null:(this.updateLastIndex(b,O),ne=b.exec(t)!==null),ne===!0)break}if(g=O-Rt,et=this.computeNewColumn(et,g),k=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,Rt,g,Lt,Nt),W.push({offset:Rt,line:Lt,column:Nt,length:g,message:k}),at===!1)break}}return this.hasCustom||(C.length=P),{tokens:C,groups:pt,errors:W}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};We.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",We.NA=/NOT_APPLICABLE/;function la(e){return Vy(e)?e.LABEL:e.name}function Vy(e){return kn(e.LABEL)&&e.LABEL!==""}const NN="parent",qy="categories",Jy="label",Xy="group",Zy="push_mode",Qy="pop_mode",t_="longer_alt",e_="line_breaks",n_="start_chars_hint";function Pn(e){return CN(e)}function CN(e){const t=e.pattern,n={};if(n.name=e.name,li(t)||(n.PATTERN=t),xt(e,NN))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return xt(e,qy)&&(n.CATEGORIES=e[qy]),aa([n]),xt(e,Jy)&&(n.LABEL=e[Jy]),xt(e,Xy)&&(n.GROUP=e[Xy]),xt(e,Qy)&&(n.POP_MODE=e[Qy]),xt(e,Zy)&&(n.PUSH_MODE=e[Zy]),xt(e,t_)&&(n.LONGER_ALT=e[t_]),xt(e,e_)&&(n.LINE_BREAKS=e[e_]),xt(e,n_)&&(n.START_CHARS_HINT=e[n_]),n}const ds=Pn({name:"EOF",pattern:We.NA});aa([ds]);function al(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function LN(e,t){return oa(e,t)}const r_={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${Vy(e)?`--> ${la(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+ar(t).image+"'";if(r)return s+r+a;{const c=Tn(e,(f,d)=>f.concat(d),[]),u=Et(c,f=>`[${Et(f,d=>la(d)).join(", ")}]`),h=`one of these possible Token sequences:
${Et(u,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+ar(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Et(e,u=>`[${Et(u,l=>la(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(r_);const MN={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},ps={buildDuplicateFoundError(e,t){function n(l){return l instanceof Ee?l.terminalType.name:l instanceof vn?l.nonTerminalName:""}const r=e.name,i=ar(t),s=i.idx,o=Ur(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Et(e.prefixPath,i=>la(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Et(e.prefixPath,i=>la(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Ur(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=Et(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof qs?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function UN(e,t){const n=new PN(e,t);return n.resolveRefs(),n.errors}class PN extends hs{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){St(Ue(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:dn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class BN extends Jc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=en(this.path.ruleStack).reverse(),this.occurrenceStack=en(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){pe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class FN extends BN{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new xn({definition:i});this.possibleTokTypes=na(s),this.found=!0}}}class cl extends Jc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class DN extends cl{walkMany(t,n,r){if(t.idx===this.occurrence){const i=ar(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ee&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class i_ extends cl{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=ar(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ee&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class $N extends cl{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=ar(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ee&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class s_ extends cl{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=ar(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ee&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function uf(e,t,n=[]){n=en(n);let r=[],i=0;function s(a){return a.concat(nn(e,i+1))}function o(a){const c=uf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof xn)return o(a.definition);if(a instanceof vn)return o(a.definition);if(a instanceof An)r=o(a.definition);else if(a instanceof Lr){const c=a.definition.concat([new Ke({definition:a.definition})]);return o(c)}else if(a instanceof Mr){const c=[new xn({definition:a.definition}),new Ke({definition:[new Ee({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof lr){const c=a.definition.concat([new Ke({definition:[new Ee({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ke){const c=a.definition.concat([new Ke({definition:a.definition})]);r=o(c)}else{if(a instanceof ur)return St(a.definition,c=>{pe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ee)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:nn(e,i)}),r}function o_(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!pe(h);){const f=h.pop();if(f===o){a&&Ys(h).idx<=u&&h.pop();continue}const d=f.def,p=f.idx,g=f.ruleStack,k=f.occurrenceStack;if(pe(d))continue;const w=d[0];if(w===i){const T={idx:p,def:nn(d),ruleStack:ea(g),occurrenceStack:ea(k)};h.push(T)}else if(w instanceof Ee)if(p<c-1){const T=p+1,A=t[T];if(n(A,w.terminalType)){const O={idx:T,def:nn(d),ruleStack:g,occurrenceStack:k};h.push(O)}}else if(p===c-1)l.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:g,occurrenceStack:k}),a=!0;else throw Error("non exhaustive match");else if(w instanceof vn){const T=en(g);T.push(w.nonTerminalName);const A=en(k);A.push(w.idx);const O={idx:p,def:w.definition.concat(s,nn(d)),ruleStack:T,occurrenceStack:A};h.push(O)}else if(w instanceof An){const T={idx:p,def:nn(d),ruleStack:g,occurrenceStack:k};h.push(T),h.push(o);const A={idx:p,def:w.definition.concat(nn(d)),ruleStack:g,occurrenceStack:k};h.push(A)}else if(w instanceof Lr){const T=new Ke({definition:w.definition,idx:w.idx}),A=w.definition.concat([T],nn(d)),O={idx:p,def:A,ruleStack:g,occurrenceStack:k};h.push(O)}else if(w instanceof Mr){const T=new Ee({terminalType:w.separator}),A=new Ke({definition:[T].concat(w.definition),idx:w.idx}),O=w.definition.concat([A],nn(d)),P={idx:p,def:O,ruleStack:g,occurrenceStack:k};h.push(P)}else if(w instanceof lr){const T={idx:p,def:nn(d),ruleStack:g,occurrenceStack:k};h.push(T),h.push(o);const A=new Ee({terminalType:w.separator}),O=new Ke({definition:[A].concat(w.definition),idx:w.idx}),P=w.definition.concat([O],nn(d)),L={idx:p,def:P,ruleStack:g,occurrenceStack:k};h.push(L)}else if(w instanceof Ke){const T={idx:p,def:nn(d),ruleStack:g,occurrenceStack:k};h.push(T),h.push(o);const A=new Ke({definition:w.definition,idx:w.idx}),O=w.definition.concat([A],nn(d)),P={idx:p,def:O,ruleStack:g,occurrenceStack:k};h.push(P)}else if(w instanceof ur)for(let T=w.definition.length-1;T>=0;T--){const A=w.definition[T],O={idx:p,def:A.definition.concat(nn(d)),ruleStack:g,occurrenceStack:k};h.push(O),h.push(o)}else if(w instanceof xn)h.push({idx:p,def:w.definition.concat(nn(d)),ruleStack:g,occurrenceStack:k});else if(w instanceof qs)h.push(jN(w,p,g,k));else throw Error("non exhaustive match")}return l}function jN(e,t,n,r){const i=en(n);i.push(e.name);const s=en(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Se;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Se||(Se={}));function a_(e){if(e instanceof An||e==="Option")return Se.OPTION;if(e instanceof Ke||e==="Repetition")return Se.REPETITION;if(e instanceof Lr||e==="RepetitionMandatory")return Se.REPETITION_MANDATORY;if(e instanceof Mr||e==="RepetitionMandatoryWithSeparator")return Se.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof lr||e==="RepetitionWithSeparator")return Se.REPETITION_WITH_SEPARATOR;if(e instanceof ur||e==="Alternation")return Se.ALTERNATION;throw Error("non exhaustive match")}function zN(e,t,n,r,i,s){const o=ff(e,t,n),a=h_(o)?ol:oa;return s(o,r,a,i)}function KN(e,t,n,r,i,s){const o=df(e,t,i,n),a=h_(o)?ol:oa;return s(o[0],a,r)}function WN(e,t,n,r){const i=e.length,s=or(e,o=>or(o,a=>a.length===1));if(t)return function(o){const a=Et(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let f=0;f<l;f++){const d=u[f],p=d.length;for(let g=0;g<p;g++){const k=this.LA(g+1);if(n(k,d[g])===!1)continue t}return c}}};if(s&&!r){const o=Et(e,c=>Un(c)),a=Tn(o,(c,u,l)=>(St(u,h=>{xt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),St(h.categoryMatches,f=>{xt(c,f)||(c[f]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,l[f])===!1)continue t}return o}}}}function GN(e,t,n){const r=or(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Un(e);if(s.length===1&&pe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Tn(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,St(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class HN extends Jc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Se.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Se.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Se.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Se.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Se.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class c_ extends hs{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Se.OPTION)}visitRepetition(t){this.checkIsTarget(t,Se.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Se.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Se.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Se.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Se.ALTERNATION)}}function l_(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function hf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function YN(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function u_(e,t){const n=Et(e,o=>uf([o],1)),r=l_(n.length),i=Et(n,o=>{const a={};return St(o,c=>{const u=hf(c.partialPath);St(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=l_(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,f=u[l].suffixDef,d=hf(h);if(YN(i,d,c)||pe(f)||h.length===t){const g=r[c];if(pf(g,h)===!1){g.push(h);for(let k=0;k<d.length;k++){const w=d[k];i[c][w]=!0}}}else{const g=uf(f,o+1,h);s[c]=s[c].concat(g),St(g,k=>{const w=hf(k.partialPath);St(w,T=>{i[c][T]=!0})})}}}}return r}function ff(e,t,n,r){const i=new c_(e,Se.ALTERNATION,r);return t.accept(i),u_(i.result,n)}function df(e,t,n,r){const i=new c_(e,n);t.accept(i);const s=i.result,a=new HN(t,e,n).startWalking(),c=new xn({definition:s}),u=new xn({definition:a});return u_([c,u],r)}function pf(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function VN(e,t){return e.length<t.length&&or(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function h_(e){return or(e,t=>or(t,n=>or(n,r=>pe(r.categoryMatches))))}function qN(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Et(t,n=>Object.assign({type:dn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function JN(e,t,n,r){const i=Qn(e,c=>XN(c,n)),s=lC(e,t,n),o=Qn(e,c=>sC(c,n)),a=Qn(e,c=>tC(c,e,r,n));return i.concat(s,o,a)}function XN(e,t){const n=new QN;e.accept(n);const r=n.allProductions,i=xy(r,ZN),s=cr(i,a=>a.length>1);return Et(Ue(s),a=>{const c=ar(a),u=t.buildDuplicateFoundError(e,a),l=Ur(c),h={message:u,type:dn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},f=f_(c);return f&&(h.parameter=f),h})}function ZN(e){return`${Ur(e)}_#_${e.idx}_#_${f_(e)}`}function f_(e){return e instanceof Ee?e.terminalType.name:e instanceof vn?e.nonTerminalName:""}class QN extends hs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function tC(e,t,n,r){const i=[];if(Tn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:dn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function eC(e,t,n){const r=[];let i;return fn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:dn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function d_(e,t,n,r=[]){const i=[],s=ll(t.definition);if(pe(s))return[];{const o=e.name;fn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:dn.LEFT_RECURSION,ruleName:o});const c=Gc(s,r.concat([e])),u=Qn(c,l=>{const h=en(r);return h.push(l),d_(e,l,n,h)});return i.concat(u)}}function ll(e){let t=[];if(pe(e))return t;const n=ar(e);if(n instanceof vn)t.push(n.referencedRule);else if(n instanceof xn||n instanceof An||n instanceof Lr||n instanceof Mr||n instanceof lr||n instanceof Ke)t=t.concat(ll(n.definition));else if(n instanceof ur)t=Un(Et(n.definition,s=>ll(s.definition)));else if(!(n instanceof Ee))throw Error("non exhaustive match");const r=qc(n),i=e.length>1;if(r&&i){const s=nn(e);return t.concat(ll(s))}else return t}class mf extends hs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function nC(e,t){const n=new mf;e.accept(n);const r=n.alternations;return Qn(r,s=>{const o=ea(s.definition);return Qn(o,(a,c)=>{const u=o_([a],[],oa,1);return pe(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:dn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function rC(e,t,n){const r=new mf;e.accept(r);let i=r.alternations;return i=Hc(i,o=>o.ignoreAmbiguities===!0),Qn(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=ff(a,e,c,o),l=aC(u,o,e,n),h=cC(u,o,e,n);return l.concat(h)})}class iC extends hs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function sC(e,t){const n=new mf;e.accept(n);const r=n.alternations;return Qn(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:dn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function oC(e,t,n){const r=[];return St(e,i=>{const s=new iC;i.accept(s);const o=s.allProductions;St(o,a=>{const c=a_(a),u=a.maxLookahead||t,l=a.idx,f=df(l,i,c,u)[0];if(pe(Un(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:dn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function aC(e,t,n,r){const i=[],s=Tn(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||St(c,l=>{const h=[u];St(e,(f,d)=>{u!==d&&pf(f,l)&&t.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!pf(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return Et(s,a=>{const c=Et(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:dn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function cC(e,t,n,r){const i=Tn(e,(o,a,c)=>{const u=Et(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return ta(Qn(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=Zn(i,f=>t.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&VN(f.path,u));return Et(l,f=>{const d=[f.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:d,prefixPath:f.path}),type:dn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function lC(e,t,n){const r=[],i=Et(t,s=>s.name);return St(e,s=>{const o=s.name;if(fn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:dn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function uC(e){const t=tf(e,{errMsgProvider:MN}),n={};return St(e.rules,r=>{n[r.name]=r}),UN(n,t.errMsgProvider)}function hC(e){return e=tf(e,{errMsgProvider:ps}),JN(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const p_="MismatchedTokenException",m_="NoViableAltException",g_="EarlyExitException",y_="NotAllInputParsedException",__=[p_,m_,g_,y_];Object.freeze(__);function ul(e){return fn(__,e.name)}class hl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class b_ extends hl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=p_}}class fC extends hl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=m_}}class dC extends hl{constructor(t,n){super(t,n),this.name=y_}}class pC extends hl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=g_}}const gf={},w_="InRuleRecoveryException";class mC extends Error{constructor(t){super(t),this.name=w_}}class gC{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=xt(t,"recoveryEnabled")?t.recoveryEnabled:ui.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=yC)}getTokenToInsert(t){const n=al(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:f,ruleName:this.getCurrRuleFullName()}),p=new b_(d,u,this.LA(0));p.resyncedTokens=ea(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new mC("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||pe(n))return!1;const r=this.LA(1);return Vs(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return fn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Vs(t,s=>LN(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return gf;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Et(t,(r,i)=>i===0?gf:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Et(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Un(t)}getFollowSetFromFollowKey(t){if(t===gf)return[ds];const n=t.ruleName+t.idxInCallingRule+Cy+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,ds)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ea(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=en(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Et(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function yC(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=ds,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const _C=4,Pi=8,E_=1<<Pi,k_=2<<Pi,yf=3<<Pi,_f=4<<Pi,bf=5<<Pi,fl=6<<Pi;function wf(e,t,n){return n|t|e}class bC{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:ui.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(pe(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return Qn(t,n=>d_(n,n,ps))}validateEmptyOrAlternatives(t){return Qn(t,n=>nC(n,ps))}validateAmbiguousAlternationAlternatives(t,n){return Qn(t,r=>rC(r,n,ps))}validateSomeNonEmptyLookaheadPath(t,n){return oC(t,n,ps)}buildLookaheadForAlternation(t){return zN(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,WN)}buildLookaheadForOptional(t){return KN(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,a_(t.prodType),GN)}}class wC{initLooksAhead(t){this.dynamicTokensEnabled=xt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:ui.dynamicTokensEnabled,this.maxLookahead=xt(t,"maxLookahead")?t.maxLookahead:ui.maxLookahead,this.lookaheadStrategy=xt(t,"lookaheadStrategy")?t.lookaheadStrategy:new bC({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){St(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=kC(n);St(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Ur(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=wf(this.fullRuleNameToShort[n.name],E_,u.idx);this.setLaFuncCache(f,h)})}),St(i,u=>{this.computeLookaheadFunc(n,u.idx,yf,"Repetition",u.maxLookahead,Ur(u))}),St(s,u=>{this.computeLookaheadFunc(n,u.idx,k_,"Option",u.maxLookahead,Ur(u))}),St(o,u=>{this.computeLookaheadFunc(n,u.idx,_f,"RepetitionMandatory",u.maxLookahead,Ur(u))}),St(a,u=>{this.computeLookaheadFunc(n,u.idx,fl,"RepetitionMandatoryWithSeparator",u.maxLookahead,Ur(u))}),St(c,u=>{this.computeLookaheadFunc(n,u.idx,bf,"RepetitionWithSeparator",u.maxLookahead,Ur(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=wf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return wf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class EC extends hs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const dl=new EC;function kC(e){dl.reset(),e.accept(dl);const t=dl.dslMethods;return dl.reset(),t}function T_(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function v_(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function TC(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function vC(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const xC="name";function x_(e,t){Object.defineProperty(e,xC,{enumerable:!1,configurable:!0,writable:!1,value:t})}function AC(e,t){const n=Jn(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function SC(e,t){const n=function(){};x_(n,e+"BaseSemantics");const r={visit:function(i,s){if(Xt(i)&&(i=i[0]),!li(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=IC(this,t);if(!pe(i)){const s=Et(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function RC(e,t,n){const r=function(){};x_(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return St(t,s=>{i[s]=AC}),r.prototype=i,r.prototype.constructor=r,r}var Ef;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Ef||(Ef={}));function IC(e,t){return OC(e,t)}function OC(e,t){const n=Zn(t,i=>si(e[i])===!1),r=Et(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Ef.MISSING_METHOD,methodName:i}));return ta(r)}class NC{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=xt(t,"nodeLocationTracking")?t.nodeLocationTracking:ui.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=ze,this.cstFinallyStateUpdate=ze,this.cstPostTerminal=ze,this.cstPostNonTerminal=ze,this.cstPostRule=ze;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=v_,this.setNodeLocationFromNode=v_,this.cstPostRule=ze,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=ze,this.setNodeLocationFromNode=ze,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=T_,this.setNodeLocationFromNode=T_,this.cstPostRule=ze,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=ze,this.setNodeLocationFromNode=ze,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=ze,this.setNodeLocationFromNode=ze,this.cstPostRule=ze,this.setInitialNodeLocation=ze;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];TC(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];vC(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(li(this.baseCstVisitorConstructor)){const t=SC(this.className,Jn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(li(this.baseCstVisitorWithDefaultsConstructor)){const t=RC(this.className,Jn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class CC{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):gl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?gl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class LC{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=yl){if(fn(this.definedRulesNames,t)){const o={message:ps.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:dn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=yl){const i=eC(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(ul(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return UO(Ue(this.gastProductionsCache))}}class MC{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ol,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},xt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Xt(t)){if(pe(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Xt(t))this.tokensMap=Tn(t,(s,o)=>(s[o.name]=o,s),{});else if(xt(t,"modes")&&or(Un(Ue(t.modes)),IN)){const s=Un(Ue(t.modes)),o=Yc(s);this.tokensMap=Tn(o,(a,c)=>(a[c.name]=c,a),{})}else if(qn(t))this.tokensMap=en(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=ds;const r=xt(t,"modes")?Un(Ue(t.modes)):Ue(t),i=or(r,s=>pe(s.categoryMatches));this.tokenMatcher=i?ol:oa,aa(Ue(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=xt(r,"resyncEnabled")?r.resyncEnabled:yl.resyncEnabled,s=xt(r,"recoveryValueFunc")?r.recoveryValueFunc:yl.recoveryValueFunc,o=this.ruleShortNameIdx<<_C+Pi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(ul(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(k_,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(_f,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Se.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,_f,t,$N)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(fl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,s_],a,fl,t,s_)}else throw this.raiseEarlyExitException(t,Se.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(yf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,yf,t,DN,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(bf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,i_],a,bf,t,i_)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,fl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(E_,n),i=Xt(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new dC(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw ul(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new b_(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===w_?r:s}}else throw r}saveRecogState(){const t=this.errors,n=en(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),ds)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class UC{initErrorHandler(t){this._errors=[],this.errorMessageProvider=xt(t,"errorMessageProvider")?t.errorMessageProvider:ui.errorMessageProvider}SAVE_ERROR(t){if(ul(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:en(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return en(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=df(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new pC(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=ff(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new fC(c,this.LA(1),a))}}class PC{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(li(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return o_([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=ar(t.ruleStack),i=this.getGAstProductions()[n];return new FN(i,t).startWalking()}}const pl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(pl);const A_=!0,S_=Math.pow(2,Pi)-1,R_=Pn({name:"RECORDING_PHASE_TOKEN",pattern:We.NA});aa([R_]);const I_=al(R_,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(I_);const BC={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class FC{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return gl}topLevelRuleRecord(t,n){try{const r=new qs({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return ua.call(this,An,t,n)}atLeastOneInternalRecord(t,n){ua.call(this,Lr,n,t)}atLeastOneSepFirstInternalRecord(t,n){ua.call(this,Mr,n,t,A_)}manyInternalRecord(t,n){ua.call(this,Ke,n,t)}manySepFirstInternalRecord(t,n){ua.call(this,lr,n,t,A_)}orInternalRecord(t,n){return DC.call(this,t,n)}subruleInternalRecord(t,n,r){if(ml(n),!t||xt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${O_(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Ys(this.recordingProdStack),s=t.ruleName,o=new vn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?BC:pl}consumeInternalRecord(t,n,r){if(ml(n),!Hy(t)){const o=new Error(`<CONSUME${O_(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Ys(this.recordingProdStack),s=new Ee({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),I_}}function ua(e,t,n,r=!1){ml(n);const i=Ys(this.recordingProdStack),s=si(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),xt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),pl}function DC(e,t){ml(t);const n=Ys(this.recordingProdStack),r=Xt(e)===!1,i=r===!1?e:e.DEF,s=new ur({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});xt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=ef(i,a=>si(a.GATE));return s.hasPredicates=o,n.definition.push(s),St(i,a=>{const c=new xn({definition:[]});s.definition.push(c),xt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:xt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),pl}function O_(e){return e===0?"":`${e}`}function ml(e){if(e<0||e>S_){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${S_+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class $C{initPerformanceTracer(t){if(xt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=ui.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=Iy(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function jC(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const gl=al(ds,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(gl);const ui=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:r_,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),yl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var dn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(dn||(dn={}));let kf=class Ub{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Oy(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),St(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=uC({rules:Ue(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(pe(r)&&this.skipValidations===!1){const i=hC({rules:Ue(this.gastProductionsCache),tokenTypes:Ue(this.tokensMap),errMsgProvider:ps,grammarName:n}),s=qN({lookaheadStrategy:this.lookaheadStrategy,rules:Ue(this.gastProductionsCache),tokenTypes:Ue(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),pe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=zO(Ue(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ue(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ue(this.gastProductionsCache))})),!Ub.DEFER_DEFINITION_ERRORS_HANDLING&&!pe(this.definitionErrors))throw t=Et(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),xt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=xt(n,"skipValidations")?n.skipValidations:ui.skipValidations}};kf.DEFER_DEFINITION_ERRORS_HANDLING=!1,jC(kf,[gC,wC,NC,CC,MC,LC,UC,PC,FC,$C]);class zC extends kf{constructor(t,n=ui){const r=en(n);r.outputCst=!0,super(t,r)}}function KC(e){const t=new WC,n=Ue(e);return Et(n,r=>t.visitRule(r))}class WC extends hs{visitRule(t){const n=this.visitEach(t.definition),r=xy(n,s=>s.propertyName),i=Et(r,(s,o)=>{const a=!ef(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=Et(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:_l(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:_l(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:_l(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:_l(t)}]}visitEachAndOverrideWith(t,n){return Et(this.visitEach(t),r=>En({},r,n))}visitEach(t){return Un(Et(t,n=>this.visit(n)))}}function _l(e){return e instanceof vn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function GC(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Un(Et(e,r=>HC(r)))),t.includeVisitorInterface&&(n=n.concat(JC(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function HC(e){const t=YC(e),n=VC(e);return[t,n]}function YC(e){const t=C_(e.name),n=Tf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function VC(e){return`export type ${Tf(e.name)} = {
  ${Et(e.properties,n=>qC(n)).join(`
  `)}
};`}function qC(e){const t=ZC(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function JC(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Et(t,n=>XC(n)).join(`
  `)}
}`}function XC(e){const t=Tf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function ZC(e){if(Xt(e)){const t=Yc(Et(e,r=>N_(r)));return"("+Tn(t,(r,i)=>r+" | "+i)+")"}else return N_(e)}function N_(e){return e.kind==="token"?"IToken":C_(e.name)}function C_(e){return Yg(e)+"CstNode"}function Tf(e){return Yg(e)+"CstChildren"}const QC={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function tL(e,t){const n=Object.assign(Object.assign({},QC),t),r=KC(e);return GC(r,n)}const vf=_m(32,126).map(e=>String.fromCharCode(e));function zt(e){return Pn({...e,name:`token_${e.name}`})}function Pr(e,t=!1){return zt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on,group:We.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on})}const ha=zt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),eL=zt({name:"whitespace",pattern:/ +/,group:We.SKIPPED}),nL=zt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:We.SKIPPED}),xf=zt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Xs=zt({name:"command",pattern:/#/,start_chars_hint:["#"]});let L_=!1;function rL(e,t,n){if(!L_)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==ha)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const M_=zt({name:"text",pattern:rL,line_breaks:!1,start_chars_hint:vf.filter(e=>"@#/?':!".includes(e)===!1)}),U_=zt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),P_=zt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),B_=zt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),F_=zt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),on=zt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:vf}),D_=zt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),$_=zt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),j_=zt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:on}),z_=zt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:on}),K_=zt({name:"islessthan",pattern:/<|below/,longer_alt:on}),W_=zt({name:"isgreaterthan",pattern:/>|above/,longer_alt:on}),G_=zt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:on}),H_=zt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:on}),Af=zt({name:"or",pattern:/or/i,longer_alt:on}),Sf=zt({name:"not",pattern:/not/i,longer_alt:on}),Rf=zt({name:"and",pattern:/and/i,longer_alt:on}),If=zt({name:"plus",pattern:/\+/}),Of=zt({name:"minus",pattern:/-/}),Y_=zt({name:"power",pattern:/\*\*/}),V_=zt({name:"multiply",pattern:/\*/}),Nf=zt({name:"divide",pattern:/\//}),q_=zt({name:"moddivide",pattern:/%/}),J_=zt({name:"floordivide",pattern:/%%/}),X_=zt({name:"query",pattern:/\?/}),Z_=zt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Q_=zt({name:"rparen",pattern:/\)/,pop_mode:!0}),t1=zt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:vf,longer_alt:on}),Cf=zt({name:"if",pattern:/if|try|take|give/,longer_alt:on}),bl=Pr("do"),iL=Pr("to",!0),Lf=Pr("done"),sL=Pr("then",!0),Mf=Pr("else"),e1=Pr("while"),n1=Pr("repeat"),r1=Pr("waitfor"),i1=zt({name:"foreach",pattern:/foreach|for/,longer_alt:on}),s1=Pr("break"),o1=Pr("continue");function a1(e){return[...e,$_,j_,z_,G_,K_,H_,W_,Af,Sf,Rf,If,Of,Y_,V_,Nf,J_,q_,X_,Z_,Q_,D_,on]}const c1=a1([M_,xf,t1,Xs,U_,P_,B_,F_,ha,eL,s1,o1,Lf,bl,Mf,i1,Cf,n1,sL,iL,r1,e1]),oL=new We({defaultMode:"use_newlines",modes:{use_newlines:c1,ignore_newlines:a1([nL])}},{skipValidations:!Ar,ensureOptimizations:Ar});function l1(e){L_=!0;const t=oL.tokenize(e||` 
`),[n]=(re(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(al(ha,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function aL(e,t,n=!0){if(n){const[r,...i]=t;switch(Bt(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:i};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Bt(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function Bn(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var Uf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Uf||{});function u1(e){return Ks(e,Uf,{bits:t=>Array.from(t)})}function h1(e){return Go(e,Uf,{bits:t=>new Uint8Array(t)})}function cL(e,t){return{id:Ie(),code:e,...t}}var Pf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Pf||{});function lL(e){return Ks(e,Pf,{board:PM,object:Rc,terrain:Rc,charset:u1,palette:u1,stats:Ce})}function uL(e){return Go(e,Pf,{board:BM,object:Ic,terrain:Ic,charset:h1,palette:h1})}function wl(e){const t={...ms(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function hL(e){return E(e)?(e.stats=void 0,ms(e)):{}}function f1(e){const t=l1(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===xf){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),u=a.split(" "),l=aL(At(c)?c:"",u,r),h=Bt(l.values.join(" "));switch(r=!1,l.type){case wt.LOADER:n.type=kt.LOADER,n.name=h;break;case wt.BOARD:n.type=kt.BOARD,n.name=h;break;case wt.OBJECT:n.type=kt.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=kt.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=kt.CHARSET,n.name=h;break;case wt.PALETTE:n.type=kt.PALETTE,n.name=h;break;case wt.CONST:{const[f,d]=l.values;if(At(f)){const p=Bt(f);if(At(d)){const g=parseFloat(d);n[p]=Mt(g)?g:d}else Mt(d)?n[p]=d:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[f,...d]=l.values;if(At(f)){const p=Bt(f);n[p]=[Bn(l.type),...d]}break}}}}return n}function ms(e){var t;return E(e)?(E((t=e.stats)==null?void 0:t.type)||(e.stats=f1(e.code),E(e.stats.type)||(e.stats.type=kt.OBJECT)),e.stats):{}}function d1(e){switch(e){default:case kt.ERROR:return"error";case kt.LOADER:return Bn(wt.LOADER);case kt.BOARD:return Bn(wt.BOARD);case kt.OBJECT:return Bn(wt.OBJECT);case kt.TERRAIN:return Bn(wt.TERRAIN);case kt.CHARSET:return Bn(wt.CHARSET);case kt.PALETTE:return Bn(wt.PALETTE)}}function Bi(e){return ms(e).type??kt.ERROR}function El(e){return d1(Bi(e))}function Fn(e){return ms(e).name??""}function p1(e,t){return ms(e)[t]}function Bf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!re(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Gt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Gt.ISSWIM;break;case"issolid":t.collision=Gt.ISSOLID;break;case"isbullet":t.collision=Gt.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function hi(e){if(E(e))switch(Bi(e)){default:return;case kt.ERROR:return e.code??"";case kt.LOADER:return e.code??"";case kt.BOARD:{E(e.board)||(e.board=UM()),e.board.id=e.id;const t=wl(e);return e.board.isdark=t.isdark??e.board.isdark?1:0,e.board.startx=t.startx??e.board.startx,e.board.starty=t.starty??e.board.starty,e.board.over=t.over??e.board.over,e.board.under=t.under??e.board.under,e.board.exitnorth=t.exitnorth??e.board.exitnorth,e.board.exitsouth=t.exitsouth??e.board.exitsouth,e.board.exitwest=t.exitwest??e.board.exitwest,e.board.exiteast=t.exiteast??e.board.exiteast,e.board.timelimit=t.timelimit??e.board.timelimit,e.board.restartonzap=t.restartonzap??e.board.restartonzap,e.board.maxplayershots=t.maxplayershots??e.board.maxplayershots,e.board}case kt.OBJECT:return E(e.object)||(e.object=ag()),e.object.name=Fn(e),e.object.category=jn.ISOBJECT,Bf(wl(e),e.object),e.object;case kt.TERRAIN:return E(e.terrain)||(e.terrain=ag()),e.terrain.name=Fn(e),e.terrain.category=jn.ISTERRAIN,Bf(wl(e),e.terrain),e.terrain;case kt.PALETTE:return E(e.palette)||(e.palette=lg(Nx)),e.palette;case kt.CHARSET:return E(e.charset)||(e.charset=ug(Ox)),e.charset}}function m1(e){return{id:Ie(),name:Xb(),timestamp:0,activelist:[],pages:e,flags:{}}}var Ff=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e))(Ff||{});function fL(e){return Ks(e,Ff,{pages:t=>t.map(lL),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function dL(e){return Go(e,Ff,{pages:t=>t.map(uL)})}function Zs(e,t){if(!E(e))return;const n=Bt(t);return e.pages.find(i=>i.id===t||n===Fn(i))}function fi(e,t,n){if(!E(e))return;const r=Bt(n);return e.pages.find(s=>Bi(s)===t&&(s.id===n||r===Fn(s)))}function Df(e,t,n){let r=fi(e,t,n);if(!E(r)){const i=d1(t);r=cL(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),pL(e,r)}return r}function gs(e,t){return E(e)?e.pages.filter(n=>Bi(n)===t):[]}function Fi(e,t,n){return E(e)?e.pages.filter(r=>Bi(r)===t).filter(r=>{const i=ms(r);return E(i[n])}):[]}function pL(e,t){if(!E(e)||!E(t))return!1;const n=Zs(e,t.id);return E(n)?!1:(e.pages.push(t),!0)}function mL(e,t){const n=Zs(e,t);if(E(e)&&E(n)){const r=Bt(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Fn(i)),n}}function Di(e,t){if(E(t)&&E(t.kind))return E(t.kinddata)||(t.kinddata=E(t.id)?kl(e,t.kind):_1(e,t.kind)),t.kinddata}function g1(e,t,n){const r=Di(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function y1(e,t,n,r,i){const s=Di(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function kl(e,t){const n=t??"",r=fi(e,kt.OBJECT,n);if(E(r)){const i=hi(r);return{...pr(i),name:n,code:r.code}}}function _1(e,t){const n=t??"",r=fi(e,kt.TERRAIN,n);if(E(r)){const i=hi(r);return{...pr(i),name:n,code:r.code}}}function Qs(e,t){const n=Zs(e,t);return hi(n)}function di(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function b1(e,t){e&&delete e.flags[t]}function w1(e,t,n){const r=di(e,t);return r==null?void 0:r[n]}function gL(e,t,n,r){const i=di(e,t);return i&&(i[n]=r),r}function ys(e,t){const n=w1(e,t,"board");return Qs(e,At(n)?n:"")}function yL(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Tl(e,t,n){if(!E(e))return;gL(e,t,"board",n);const r=Qs(e,n);E(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function fa(e,t,n,r){if(!E(e))return;const i=ys(e,t);if(!E(i))return;const s=Rn(i,t);if(!Sh(s)||!(s!=null&&s.id))return;const o=Qs(e,n);if(!E(o)||(Br(e,o),jf(e,o,Gt.ISWALK,r)))return;delete i.objects[s.id];const a=jr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=jr(o,s);o.lookup&&(o.lookup[c]=s.id),Tl(e,t,o.id)}function _L(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=w1(e,r,"board");return At(i)?i:""});return Dv(n)}function $f(e){return _L(e).map(n=>Qs(e,n)).filter(E)}function jf(e,t,n,r){if(!E(e)||!E(t)||!E(t.lookup)||r.x<0||r.x>=ie||r.y<0||r.y>=Je)return!0;const i=r.x+r.y*ie,s=Rn(t,t.lookup[i]??"404");if(E(s))return!0;const o=t.terrain[i];if(E(o)){const a=Di(e,o),c=o.collision??(a==null?void 0:a.collision);return _h(n,c)}return!1}function bL(e,t,n,r){const i=Rn(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=g1(e,i,"collision");return jf(e,t,a,r)}function E1(e,t,n,r){var l,h;const i=Rn(t,(n==null?void 0:n.id)??"");if(!E(e)||!E(t)||!E(i)||!E(i.x)||!E(i.y)||!E(t.lookup)||r.x<0||r.x>=ie||r.y<0||r.y>=Je)return{name:"edge",kind:"edge",collision:Gt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=jr(t,i),o=jr(t,r),a=i.collision??((l=i==null?void 0:i.kinddata)==null?void 0:l.collision)??Gt.ISWALK,c=Rn(t,t.lookup[o]??"");if(E(c))return{...c};const u=t.terrain[o];if(E(u)){const f=u.collision??((h=u==null?void 0:u.kinddata)==null?void 0:h.collision)??Gt.ISWALK;if(_h(a,f))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,E(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function zf(e,t,n,r){var s;if(!E(e)||!E(t)||!E(t.named)||!E(n))return;const i=Bt(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function wL(e,t,n){if(!(!E(e)||!E(t)||!E(t.lookup)||!E(n==null?void 0:n.id))&&!E(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*ie]=n.id}}function Br(e,t){var a;if(!E(e)||!E(t)||E(t.lookup)&&E(t.named))return;const n=new Array(ie*Je).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const u=i[c];if(E(u.x)&&E(u.y)&&E(u.id)&&!E(u.removed)){u.category=jn.ISOBJECT,n[u.x+u.y*ie]=u.id;const l=Bt(u.name??((a=u.kinddata)==null?void 0:a.name)??"");r[l]||(r[l]=new Set),r[l].add(u.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const u=t.terrain[c];if(E(u)){u.x=s,u.y=o,u.category=jn.ISTERRAIN;const l=os(u);r[l]||(r[l]=new Set),r[l].add(c)}++s,s>=ie&&(s=0,++o)}t.lookup=n,t.named=r}function pi(e,t,n,r){return!E(n)||os(n)==="player"?!1:(n.id?(n.removed=r,Kf(e,t,n)):(bi(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),EL(e,t,n)),!0)}function EL(e,t,n){var r;if(E(e)&&E(t)&&E(n==null?void 0:n.x)&&E(n.y)){const i=os(n),s=jr(t,n);E((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function Kf(e,t,n){var r;if(E(e)&&E(t)&&E(n==null?void 0:n.id)){if(E(t.lookup)&&E(n.x)&&E(n.y)){const s=n.x+n.y*ie;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=os(n);E((r=t.named)==null?void 0:r[i])&&E(n.id)&&t.named[i].delete(n.id)}}function kL(e,t,n){const r=[];if(!E(e)||!E(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];E(o.id)&&E(o.removed)&&n-o.removed>Ia*5&&(r.push(o.id),kb(t,o.id))}return r}function TL(e,t,n){const r=[];if(!E(e)||!E(t))return r;t.lookup=void 0,Br(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!E(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Di(e,a),u=a.code??(c==null?void 0:c.code)??"";u&&r.push({id:a.id,type:kt.OBJECT,code:u,object:a,terrain:void 0})}const s=kL(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:kt.ERROR,code:"",object:void 0,terrain:void 0});return r}function vL(e,t,n,r){if(E(e)&&E(t)&&E(n)){const[i,s]=n,o=kl(e,i);if(E(o)&&E(o.name)){const a=yd(t,r,i);return Oc(a,s),a}}}function vl(e,t,n,r,i){if(E(e)&&E(t)&&E(n)){const[s,o]=n,a=_1(e,s);if(E(a)){const u=DM(t,r,s);if(E(u)){Oc(u,o);const l=fc(r,ie);return zf(e,t,u,l),u}}const c=kl(e,s);if(E(c)&&E(c.name)){const u=yd(t,r,s,i);if(E(u))return Oc(u,o),wL(e,t,u),zf(e,t,u),u}}}const xL=_m(32,126).map(e=>String.fromCharCode(e)),AL=Pn({name:"Whitespace",pattern:/ +/}),SL=Pn({name:"WhitespaceSkipped",pattern:/ +/,group:We.SKIPPED}),Wf=Pn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),k1=Pn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:xL}),Gf=Pn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Hf=Pn({name:"EscapedDollar",pattern:"$$"}),Yf=Pn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Vf=Pn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),T1=Pn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function RL(e,t=""){return Pn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const v1=Object.keys($o).map(e=>RL(`\\$(${e})`,e)),IL=[AL,Wf,...v1,Gf,k1,Vf,Hf,T1,Yf],OL=new We(IL,{skipValidations:!Ar,ensureOptimizations:Ar}),NL=new We([SL,Wf,...v1,Gf,k1,Vf,Hf,T1,Yf],{skipValidations:!Ar,ensureOptimizations:Ar});function qf(e,t=!1){return t?NL.tokenize(e):OL.tokenize(e)}function Jf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function x1(e){e.active={...e.reset}}function A1(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Hf:s("$");break;case Vf:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case Gf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Wf:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=$o[u],h=ix(jt[l]),f=sx(jt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):E(h)?t.active.color=h:E(f)?t.active.bg=f:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(E(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){x1(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;LL(l,l+u.length,t.active.color,t.active.bg,t),CL(l,u,t)}}}function S1(e,t,n){const r=qf(e);r.tokens&&(A1(r.tokens,t),n&&x1(t),t.changed())}function R1(e,t,n){const r=qf(e);if(!r.tokens)return;const i=Jf(t,n,jt.WHITE,jt.BLACK);return i.measureonly=!0,A1(r.tokens,i),i.x>0&&++i.y,i}function CL(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function LL(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function I1(e,t,n){if(!ao(v.element))return 0;const[r,i]=it(t,0,[V.DIR,V.MAYBE_KIND]),s=i??["bullet"],o=vL(v.book,v.board,s,{x:v.element.x,y:v.element.y});if(E(o)){E(n)&&(o.arg=n),o.party=v.elementid,o.collision=Gt.ISBULLET,o.destructible=1,o.stepx=r.x-v.element.x,o.stepy=r.y-v.element.y,o.bg=jt.ONCLEAR;const a=Di(v.book,o),c=o.code??(a==null?void 0:a.code)??"";gb(v.book,v.board,o,c,1)}return e.yield(),0}function xl(e,t,n,r){var c,u;if(!ao(v.element)||!E(v.book)||!E(v.board)||!E(v.element))return 0;Br(v.book,v.board);const[i,s]=it(t,0,[V.DIR,V.KIND]),o=zr(v.board,i);if((o==null?void 0:o.category)===jn.ISOBJECT&&(o!=null&&o.pushable)){const l={x:((c=v.element)==null?void 0:c.x)??0,y:((u=v.element)==null?void 0:u.y)??0},h=He(i,Gi(l,i));E1(v.book,v.board,o,h)}if(!jf(v.book,v.board,Gt.ISWALK,i)){const l=vl(v.book,v.board,s,i,n);E(l)&&E(r)&&(l.arg=r)}return 0}const ML=ni().command("board",(e,t)=>{if(!E(v.book))return 0;const[n,r,i]=it(t,0,[V.NAME,V.MAYBE_NUMBER,V.MAYBE_NUMBER]),s=Fi(v.book,kt.BOARD,n);if(s.length){const o=Mn(...s);E(o)&&fa(v.book,v.elementfocus,o.id,{x:r??Math.round(ie*.5),y:i??Math.round(Je*.5)})}return 0}).command("edge",(e,t)=>{var s,o;if(!E(v.book)||!E(v.board)||!E(v.element))return 0;const[n,r]=it(t,0,[V.DIR,V.NAME]),i=Fi(v.book,kt.BOARD,r);if(i.length){const a={x:((s=v.element)==null?void 0:s.x)??0,y:((o=v.element)==null?void 0:o.y)??0},c=Gi(a,n),u=Mn(...i);switch(c){case _t.NORTH:v.board.exitnorth=u.id;break;case _t.SOUTH:v.board.exitsouth=u.id;break;case _t.WEST:v.board.exitwest=u.id;break;case _t.EAST:v.board.exiteast=u.id;break}}return 0}).command("shove",(e,t)=>{if(!E(v.book)||!E(v.board))return 0;Br(v.book,v.board);const[n,r]=it(t,0,[V.DIR,V.DIR]),i=zr(v.board,n);return Sh(i)&&hd(v.book,v.board,i,r),0}).command("duplicate",()=>(!E(v.book)||!E(v.board),0)).command("replace",(e,t)=>{if(!E(v.book)||!E(v.board))return 0;Br(v.book,v.board);const[n,r]=it(t,0,[V.DIR,V.KIND]),i=zr(v.board,n);return Sh(i)&&pi(v.book,v.board,i,v.timestamp),vl(v.book,v.board,r,n),0}).command("write",(e,t)=>{var u;if(!E(v.book)||!E(v.board))return 0;Br(v.book,v.board);const[n,r,i]=it(t,0,[V.DIR,V.COLOR,V.STRING]),{color:s,bg:o}=Im(r),a=((u=R1(i,256,1))==null?void 0:u.measuredwidth)??1,c=Jf(256,1,s??jt.WHITE,o??jt.BLACK);S1(i,c,!1);for(let l=0;l<a;++l){const h=bi(v.board,{x:n.x+l,y:n.y,char:c.char[l],color:c.color[l],bg:c.bg[l]});if(E(h)){const f=(h.x??0)+(h.y??0)*ie;zf(v.book,v.board,h,f)}}return 0}).command("change",(e,t)=>{if(!E(v.book)||!E(v.board))return 0;Br(v.book,v.board);const[n,r]=it(t,0,[V.KIND,V.KIND]);Br(v.book,v.board);const i=wc(n)??"",s=jo(v.board,i),o=Lm(s,n),a=wc(r),c=Nm(r),u=Cm(r);return o.forEach(l=>{if(os(l)===a)E(c)&&(l.color=c),E(u)&&(l.bg=u);else{if(E(l.id)&&pi(v.book,v.board,l,v.timestamp))return 0;ao(l)&&vl(v.book,v.board,r,l)}}),0}).command("putwith",(e,t)=>{const[n,r]=it(t,0,[V.ANY]);return xl(e,t.slice(r),void 0,n)}).command("put",(e,t)=>xl(e,t)).command("oneof",(e,t)=>{const[n,r]=it(t,0,[V.ANY]);return E(v.board)&&Rn(v.board,n)?0:xl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=it(t,0,[V.ANY,V.ANY]);return E(v.board)&&Rn(v.board,r)?0:xl(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[V.ANY]);return I1(e,t.slice(r),n)}).command("shoot",I1),$i="$dkpurple",UL="$196",PL="$205";function pn(e,t){return`$${e}${t}$blue`}function O1(e,t){return`$${e}${t}$ondkblue`}function se(e,t){mr(e,t)}function BL(e,t){const n=UL.repeat(t);se(e,`${$i}${n}`)}function Xf(e,t){const n=PL.repeat(t);se(e,`${$i}${n}`)}function da(e,t){se(e,`${$i} ${" ".repeat(t.length)} `),BL(e,t.length+2),se(e,`${$i} $white${t} `),Xf(e,t.length+2)}function mi(e,t){se(e,`${$i} ${" ".repeat(t.length)} `),se(e,`${$i} $gray${t} `),Xf(e,t.length+2)}function Qt(e,t,n){se(e,`${$i} $white${t} $blue${n}`)}function te(e,t){se(e,`${$i}$blue${t}`)}function FL(e,t,n){se(e,`!openit ${t};${n}`)}function N1(e){const[t,n]=e.split(":"),r=E(n);return[r?t:"self",r?n:e]}const DL=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function pa(){ru(H,_i())}const $L=ni().command("send",(e,t)=>{const[n,r]=it(t,0,[V.NAME,V.ANY]);switch(Bt(n)){case"helpmenu":da(H,"H E L P"),FL(H,"https://github.com/goldbuick/zed-software-system/wiki","open help wiki"),se(H,""),Qt(H,"#help controls","zss controls and inputs"),se(H,"!helpcontrols;read help controls"),se(H,""),Qt(H,"#help text","text formatting"),se(H,"!helptext;read help text"),se(H,""),Qt(H,"#help developer","developer commands"),se(H,"!helpdeveloper;read help developer"),se(H,""),Qt(H,"#help player","player settings"),se(H,"!helpplayer;read help player"),mi(H,"keyboard input"),Qt(H,"?","open console"),Qt(H,"esc","close console"),Qt(H,"tab","move console"),Qt(H,"up / down arrow keys","navigate console items"),Qt(H,"left / right arrow keys","change console items"),Qt(H,"enter","interact with console items"),Qt(H,"alt + arrow keys","skip words and console lines"),Qt(H,`${DL} + up / down arrow keys`,"input history");break;case"helpcontrols":da(H,"zss controls and inputs"),mi(H,"keyboard input"),Qt(H,"arrow keys","move"),Qt(H,"shift + arrow keys","shoot"),Qt(H,"enter","ok / accept"),Qt(H,"escape","cancel / close"),Qt(H,"tab","menu / action"),mi(H,"mouse input"),te(H,"todo ???"),mi(H,"controller input"),Qt(H,"left stick","move"),Qt(H,"right stick","aim"),Qt(H,"a","ok / accept"),Qt(H,"b","cancel / close"),Qt(H,"y","menu / action"),Qt(H,"x","shoot"),Qt(H,"triggers","shoot");break;case"helptext":da(H,"text formatting"),mi(H,"typography"),te(H,"plain text"),te(H,"$centering text"),te(H,'"\\"@quoted strings for special chars\\""'),te(H,"$$0-255 for ascii chars $159$176$240"),te(H,`use color names like ${pn("red","$$red")} to change foreground color`),te(H,`use color names like ${O1("ongreen","$$ongreen")} to change background color`),te(H,`use clear ${O1("onclear","to change background to")} transparent`),mi(H,"hyperlinks"),te(H,`${pn("white",'"!hotkey"')} message shortcut;${pn("gray","Label")}`),te(H,`${pn("white",'"!range"')} flag [labelmin] [labelmax];${pn("gray","Input Label")}`),te(H,`${pn("white",'"!select"')} flag ...list of values;${pn("gray","Input Label")}`),te(H,`${pn("white",'"!number"')} flag [minvalue] [maxvalue];${pn("gray","Input Label")}`),te(H,`${pn("white",'"!text"')} flag;${pn("gray","Input Label")}`),te(H,`${pn("white",'"!copyit"')} flag;${pn("gray","Input Label")}`),te(H,`${pn("white",'"!openit"')} flag;${pn("gray","Input Label")}`);break;case"helpdeveloper":da(H,"developer commands"),Qt(H,"#books","list books in memory"),Qt(H,"#pages","list pages in opened book"),Qt(H,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),Qt(H,"#trash","list books and pages from open book you can delete"),Qt(H,"#save","flush state to register");break;case"helpplayer":da(H,"player settings"),te(H,"todo");break;default:{const[i,s]=N1(n);fd(i==="self"&&v.elementisplayer?`${v.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(be),s=i.join(" ");switch(Bt(r)){case Bn(wt.LOADER):n=Wi(Kt.CONTENT,s,kt.LOADER);break;default:n=Wi(Kt.CONTENT,[r,...i].join(" "),kt.OBJECT);break;case Bn(wt.BOARD):n=Wi(Kt.CONTENT,s,kt.BOARD);break;case Bn(wt.OBJECT):n=Wi(Kt.CONTENT,s,kt.OBJECT);break;case Bn(wt.TERRAIN):n=Wi(Kt.CONTENT,s,kt.TERRAIN);break;case Bn(wt.CHARSET):n=Wi(Kt.CONTENT,s,kt.CHARSET);break;case Bn(wt.PALETTE):n=Wi(Kt.CONTENT,s,kt.PALETTE);break}return E(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(be).join(" ");return mr(H,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n),s=r.map(be).join(" ");return mr(H,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[V.MAYBE_NAME]),r=fb(n);return E(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=Ki(n);return E(r)?(te(H,`opened [book] ${r.name}`),Fl(Kt.MAIN,r.id),e.command("pages")):ae(H,"bookopen",`book ${n} not found`,v.elementfocus),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=Te(Kt.MAIN),i=Ki(n);return E(i)&&(r===i&&Fl(Kt.MAIN,""),kM(n),te(H,`trashed [book] ${i.name}`),pa(),e.command("pages")),0}).command("pageopen",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=$n(Kt.MAIN);if(!E(r))return 0;const i=Zs(r,n);if(E(i)){const s=Fn(i),o=El(i);te(H,`opened [${o}] ${s}`),lh(Ra(r.id,[i.id]),i.code);const a=El(i);jd(H,r.id,[i.id],a,`${s} - ${r.name}`,v.elementfocus)}else ae(H,"pageopen",`page ${n} not found`,v.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=$n(Kt.MAIN),i=mL(r,n);if(E(n)){const s=Fn(i),o=El(i);te(H,`trashed [${o}] ${s}`),pa(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(be).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{mi(H,"books");const e=Te(Kt.MAIN);Qt(H,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=Te(Kt.CONTENT);Qt(H,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Xf(H,7);const n=wa();return n.length?n.forEach(r=>{se(H,`!bookopen ${r.id};${r.name}`)}):te(H,"no books found"),se(H,"!bookcreate;create a new book"),0}).command("pages",()=>{mi(H,"pages");const e=$n(Kt.MAIN);return E(e)&&(Qt(H,"main",`${e.name} $GREEN${e.id}`),e.pages.length?[...e.pages].sort((n,r)=>{const i=Bi(n),s=Bi(r);return i===s?Fn(n).localeCompare(Fn(r)):s-i}).forEach(n=>{const r=Fn(n),i=El(n);se(H,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(se(H,""),te(H,"no pages found"),te(H,"use @ to create a page"),te(H,"@board name of board"),te(H,"@object name of object"),te(H,"@terrain name of terrain"),te(H,"You can omit the type and it will default to object"),te(H,"@object name of object"),te(H,"@name of object"))),0}).command("trash",()=>{mi(H,"$REDTRASH"),te(H,"books");const e=wa();e.length&&(e.forEach(n=>{se(H,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),se(H,""));const t=Te(Kt.MAIN);return E(t)&&(te(H,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Fn(n);se(H,`!pagetrash ${n.id};$REDTRASH ${r}`)}),se(H,"")),0}).command("dev",()=>(pa(),Mw(H,v.elementfocus),0)).command("share",()=>(pa(),Uw(H,v.elementfocus),0)).command("save",()=>(pa(),0)).command("fork",()=>(Gw(H,v.elementfocus),0)).command("nuke",()=>(Pw(H,v.elementfocus),0)).command("restart",()=>(Ww(H,v.elementfocus),0)).command("gadget",()=>(zw(H,void 0,v.elementfocus),0)).command("joincode",(e,t)=>{const[n]=it(t,0,[V.MAYBE_NAME]);return Iw(H,!!n,v.elementfocus),0}).command("twitchbroadcast",(e,t)=>{const[n]=it(t,0,[V.NAME]);switch(Bt(n)){default:Ew(H,n,v.elementfocus);break;case"stop":kw(H,v.elementfocus);break}return 0}),jL=ni().command("palette",(e,t)=>{const[n,r]=it(t,0,[V.NAME]),i=db(),s=yh(Bt(n));if(E(s)){const o=Am([s]);if(!E(o))return 0;const[a,c,u]=it(t,r,[V.NUMBER,V.NUMBER,V.NUMBER]),l=Wi(Kt.MAIN,At(i.palette)?i.palette:Kt.MAIN,kt.PALETTE),h=hi(l);if(E(h)&&o>=0&&o<=16){const f=o*pc;h.bits[f+0]=Ln(a,0,63),h.bits[f+1]=Ln(c,0,63),h.bits[f+2]=Ln(u,0,63)}E(l)&&(i.palette=l.id)}else{const o=fi(v.book,kt.PALETTE,n);E(o)?(i.palette=o.id,se(H,`loaded palette ${n}`)):ae(H,"not-found",`unabled to find palette ${n}`)}return 0}).command("charset",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=db(),i=fi(v.book,kt.CHARSET,n);return E(i)?(r.charset=i.id,se(H,`loaded charset ${n}`)):ae(H,"not-found",`unabled to find charset ${n}`),0}),Zf={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Fr(e){return re(e)&&C1(e[0])}function C1(e){return E(jn[e])&&At(e)}function L1(e){if(At(e))return Zf[Bt(e)]}function M1(e){if(Fr(e))return e;if(C1(e))return[e];const t=L1(e);if(E(t))return[t]}function Al(e){const t=v.words[e],n=M1(t);if(Fr(n))return[n,e+1];const[r,i]=Qe(e),s=M1(r);return Fr(s)?[s,i]:[void 0,e]}const Qf={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Gt.ISSOLID,Gt.ISWALK,Gt.ISSWIM,Gt.ISBULLET,Gt.ISWALK,Gt.ISSWIM;function gi(e){return re(e)&&td(e[0])}function td(e){return E(Gt[e])&&At(e)}function zL(e){if(At(e))return Qf[Bt(e)]}function U1(e){const t=v.words[e];if(gi(t))return[t,e+1];if(td(t))return[[t],e+1];const[n,r]=Qe(e);return gi(n)?[n,r]:td(n)?[[n],r]:[void 0,e]}const KL=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),P1=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),WL=["NORTH","SOUTH","WEST","EAST"];function GL(e){const t=ws(e);if(Mt(t.inputcurrent)||(t.inputcurrent=0),re(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=un.NONE,i=0]=n??[un.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&Xv?1:0,t.inputctrl=i&Zv?1:0,t.inputshift=i&Qv?1:0,r){case un.MOVE_UP:case un.MOVE_DOWN:case un.MOVE_LEFT:case un.MOVE_RIGHT:t.inputmove=[WL[r-un.MOVE_UP]];break;case un.OK_BUTTON:t.inputok=1;break;case un.CANCEL_BUTTON:t.inputcancel=1;break;case un.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==un.NONE&&o!==r}),t}function HL(e){const t=Zf[e];if(E(t))return t;const n=Qf[e];if(E(n))return n;const r=$o[e];if(E(r))return r;const i=dd[e];if(E(i))return i}const YL=ni({get(e,t){var o,a,c,u,l,h,f,d,p,g,k,w,T,A,O,P,L;const n=HL(t);if(E(n))return[!0,n];if(v.elementisplayer&&KL.has(t)){const C=GL(v.elementid)[t];return[E(C),C]}const r=Ec(v.board,v.element,v.elementfocus),i=(r==null?void 0:r.id)??v.elementfocus;switch(t){case"isdark":return[!0,(o=v.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=v.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=v.board)==null?void 0:c.starty)??0];case"over":return[!0,((u=v.board)==null?void 0:u.over)??""];case"under":return[!0,((l=v.board)==null?void 0:l.under)??""];case"exitnorth":return[!0,((h=v.board)==null?void 0:h.exitnorth)??""];case"exitsouth":return[!0,((f=v.board)==null?void 0:f.exitsouth)??""];case"exitwest":return[!0,((d=v.board)==null?void 0:d.exitwest)??""];case"exiteast":return[!0,((p=v.board)==null?void 0:p.exiteast)??""];case"timelimit":return[!0,((g=v.board)==null?void 0:g.timelimit)??0];case"restartonzap":return[!0,((k=v.board)==null?void 0:k.restartonzap)??0];case"maxplayershots":return[!0,((w=v.board)==null?void 0:w.maxplayershots)??0];case"boardid":return[!0,((T=v.board)==null?void 0:T.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((A=v.element)==null?void 0:A.id)??""];case"thisx":return[!0,((O=v.element)==null?void 0:O.x)??-1];case"thisy":return[!0,((P=v.element)==null?void 0:P.y)??-1];default:{const C=(L=v.element)==null?void 0:L[t];if(P1.has(t))return[!0,C];break}}const s=ws(i)[t];return[E(s),s]},set(e,t,n){const r=Ec(v.board,v.element,v.elementfocus),i=(r==null?void 0:r.id)??v.elementfocus;switch(t){case"isdark":E(v.board)&&(v.board.isdark=n?1:0);break;case"startx":E(v.board)&&(v.board.startx=Do(n,0));break;case"starty":E(v.board)&&(v.board.starty=Do(n,0));break;case"over":E(v.board)&&(v.board.over=be(n));break;case"under":E(v.board)&&(v.board.under=be(n));break;case"exitnorth":E(v.board)&&(v.board.exitnorth=be(n));break;case"exitsouth":E(v.board)&&(v.board.exitsouth=be(n));break;case"exitwest":E(v.board)&&(v.board.exitwest=be(n));break;case"exiteast":E(v.board)&&(v.board.exiteast=be(n));break;case"timelimit":E(v.board)&&(v.board.timelimit=Do(n,0));break;case"restartonzap":E(v.board)&&(v.board.restartonzap=n?1:0);break;case"maxplayershots":E(v.board)&&(v.board.maxplayershots=Do(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(P1.has(t))return E(v.element)&&(v.element[t]=n),[!0,n];break}}const s=ws(i);return E(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r;if((e=v.element)!=null&&e.stepx||(t=v.element)!=null&&t.stepy){const i={x:((n=v.element)==null?void 0:n.x)??0,y:((r=v.element)==null?void 0:r.y)??0};hd(v.book,v.board,v.element,{x:i.x+v.element.stepx,y:i.y+v.element.stepy})===!1&&(v.element.stepx=0,v.element.stepy=0,g1(v.book,v.element,"destructible")&&pi(v.book,v.board,v.element,v.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(be(n),0)),0)).command("set",(e,t)=>{const[n,r]=it(t,0,[V.NAME,V.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=it(t,0,[V.KIND]);if(Br(v.book,v.board),Kf(v.book,v.board,v.element),pi(v.book,v.board,v.element,v.timestamp)){const s={x:((r=v.element)==null?void 0:r.x)??0,y:((i=v.element)==null?void 0:i.y)??0};vl(v.book,v.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[V.NUMBER]);return E(v.element)&&(v.element.char=n),0}).command("color",(e,t)=>{const[n]=it(t,0,[V.COLOR]);return E(v.element)&&E(n)&&Oc(v.element,n),0}).command("go",(e,t)=>{if(E(v.element)){const[n]=it(t,0,[V.DIR]);if(hd(v.book,v.board,v.element,n),e.yield(),v.element.x===n.x&&v.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!E(v.element))return 0;const[n]=it(t,0,[V.DIR]),r=v.element.x??0,i=v.element.y??0;return v.element.stepx=n.x-r,v.element.stepy=n.y-i,0}),VL=ni().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[V.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(be(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(be(t[0])),0)).command("cycle",(e,t)=>{if(E(v.element)){const[n]=it(t,0,[V.NUMBER]);v.element.cycle=Ln(Math.round(n),1,255)}return 0}).command("die",e=>(pi(v.book,v.board,v.element,v.timestamp),e.endofprogram(),0)).command("endgame",()=>(v.elementisplayer&&zd(H,v.elementid),0)).command("run",(e,t)=>{const[n]=it(t,0,[V.NAME]);return Dl(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[V.ANY,V.NAME]);return e.set("arg",n),Dl(r),0}),Sl={};function qL(e){var t;return(t=Sl[e])==null?void 0:t.arg}function JL(e){var t;return(t=Sl[e])==null?void 0:t.format}function to(e){var t;return(t=Sl[e])==null?void 0:t.content}function XL(e,t,n,r,i){const s=Te(Kt.MAIN);if(!E(s))return;const o=gs(s,kt.LOADER).filter(a=>{const c=ms(a),u=c.format,l=At(u)?new RegExp(u).test(t):!1,h=c.event,f=At(h)?new RegExp(h).test(n):!1;return At(u)&&At(h)?l&&f:At(u)?l:At(h)?f:!1});for(let a=0;a<o.length;++a){const c=`${Ie()}_loader`;Sl[c]={arg:e,format:t,content:r,player:i},SM(c,o[a].code)}}function B1(e,t){if(!E(e))return;const n=Bt(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const ZL=(e,t)=>{const n=to(e.id());if(!E(n))return 0;const[r,i]=it(t,0,[V.NAME]),s=Bt(r);switch(s){case"seek":{const[o]=it(t,i,[V.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[V.NAME]);e.set(o,B1(n,s));break}case"text":{const[o,a]=it(t,i,[V.NAME,V.NAME]),c=B1(n,o);if(Mt(c)&&At(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[V.NAME]),a=Df(v.book,kt.PALETTE,o),c=hi(a);if(E(c)){const u=Wv*pc,l=lg(new Uint8Array(n.bytes.buffer,n.cursor,u));E(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=it(t,i,[V.NAME]),a=Df(v.book,kt.CHARSET,o),c=hi(a);if(E(c)){const u=yc*Kv*gh,l=ug(new Uint8Array(n.bytes.buffer,n.cursor,u));E(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},eo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Rl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Rl(e[n],t[n]))return!1;return!0}if(eo(e)&&eo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Rl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Il=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(eo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},QL=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",F1=e=>e>="0"&&e<="9"||e==="-",t4=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var Y;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(Y||(Y={}));const D1={"(":Y.TOK_LPAREN,")":Y.TOK_RPAREN,"*":Y.TOK_STAR,",":Y.TOK_COMMA,".":Y.TOK_DOT,":":Y.TOK_COLON,"@":Y.TOK_CURRENT,$:Y.TOK_ROOT,"]":Y.TOK_RBRACKET,"{":Y.TOK_LBRACE,"}":Y.TOK_RBRACE},e4={"!":!0,"<":!0,"=":!0,">":!0},n4={"	":!0,"\n":!0,"\r":!0," ":!0};class r4{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(QL(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:Y.TOK_UNQUOTEDIDENTIFIER,value:i});else if(D1[t[this._current]]!==void 0)n.push({start:this._current,type:D1[t[this._current]],value:t[this._current]}),this._current+=1;else if(F1(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:Y.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:Y.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:Y.TOK_LITERAL,value:o})}else if(e4[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(n4[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:Y.TOK_AND,value:"&&"})):n.push({start:r,type:Y.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:Y.TOK_OR,value:"||"})):n.push({start:r,type:Y.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&t4(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;F1(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:Y.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:Y.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:Y.TOK_FLATTEN,value:"[]"}):{start:n,type:Y.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_NE,value:"!="}):{start:n,type:Y.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_LTE,value:"<="}):{start:n,type:Y.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_GTE,value:">="}):{start:n,type:Y.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:Y.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const i4=new r4,an={[Y.TOK_EOF]:0,[Y.TOK_UNQUOTEDIDENTIFIER]:0,[Y.TOK_QUOTEDIDENTIFIER]:0,[Y.TOK_RBRACKET]:0,[Y.TOK_RPAREN]:0,[Y.TOK_COMMA]:0,[Y.TOK_RBRACE]:0,[Y.TOK_NUMBER]:0,[Y.TOK_CURRENT]:0,[Y.TOK_EXPREF]:0,[Y.TOK_ROOT]:0,[Y.TOK_PIPE]:1,[Y.TOK_OR]:2,[Y.TOK_AND]:3,[Y.TOK_EQ]:5,[Y.TOK_GT]:5,[Y.TOK_LT]:5,[Y.TOK_GTE]:5,[Y.TOK_LTE]:5,[Y.TOK_NE]:5,[Y.TOK_FLATTEN]:9,[Y.TOK_STAR]:20,[Y.TOK_FILTER]:21,[Y.TOK_DOT]:40,[Y.TOK_NOT]:45,[Y.TOK_LBRACE]:50,[Y.TOK_LBRACKET]:55,[Y.TOK_LPAREN]:60};class s4{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Y.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...i4.tokenize(t),{type:Y.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<an[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case Y.TOK_LITERAL:return{type:"Literal",value:t.value};case Y.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case Y.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===Y.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Y.TOK_NOT:return r=this.expression(an.Not),{type:"NotExpression",children:[r]};case Y.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Y.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(an.Star),{type:"ValueProjection",children:[n,r]};case Y.TOK_FILTER:return this.led(t.type,{type:"Identity"});case Y.TOK_LBRACE:return this.parseMultiselectHash();case Y.TOK_FLATTEN:return n={type:Y.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(an.Flatten),{type:"Projection",children:[n,r]};case Y.TOK_LBRACKET:return this.lookahead(0)===Y.TOK_NUMBER||this.lookahead(0)===Y.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Y.TOK_STAR&&this.lookahead(1)===Y.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(an.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Y.TOK_CURRENT:return{type:Y.TOK_CURRENT};case Y.TOK_ROOT:return{type:Y.TOK_ROOT};case Y.TOK_EXPREF:return i=this.expression(an.Expref),{type:"ExpressionReference",children:[i]};case Y.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Y.TOK_RPAREN;)this.lookahead(0)===Y.TOK_CURRENT?(i={type:Y.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Y.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case Y.TOK_DOT:const i=an.Dot;return this.lookahead(0)!==Y.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Y.TOK_PIPE:return r=this.expression(an.Pipe),{type:Y.TOK_PIPE,children:[n,r]};case Y.TOK_OR:return r=this.expression(an.Or),{type:"OrExpression",children:[n,r]};case Y.TOK_AND:return r=this.expression(an.And),{type:"AndExpression",children:[n,r]};case Y.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Y.TOK_RPAREN;)this.lookahead(0)===Y.TOK_CURRENT?(a={type:Y.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Y.TOK_COMMA&&this.match(Y.TOK_COMMA),o.push(a);return this.match(Y.TOK_RPAREN),{name:s,type:"Function",children:o};case Y.TOK_FILTER:const u=this.expression(0);return this.match(Y.TOK_RBRACKET),r=this.lookahead(0)===Y.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(an.Filter),{type:"FilterProjection",children:[n,r,u]};case Y.TOK_FLATTEN:const l={type:Y.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(an.Flatten);return{type:"Projection",children:[l,h]};case Y.TOK_EQ:case Y.TOK_NE:case Y.TOK_GT:case Y.TOK_GTE:case Y.TOK_LT:case Y.TOK_LTE:return this.parseComparator(n,t);case Y.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===Y.TOK_NUMBER||f.type===Y.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Y.TOK_STAR),this.match(Y.TOK_RBRACKET),r=this.parseProjectionRHS(an.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Y.TOK_COLON||this.lookahead(1)===Y.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Y.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(an.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Y.TOK_RBRACKET&&n<3;){if(r===Y.TOK_COLON)n+=1,this.advance();else if(r===Y.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Y.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(an[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([Y.TOK_UNQUOTEDIDENTIFIER,Y.TOK_QUOTEDIDENTIFIER,Y.TOK_STAR].includes(n))return this.expression(t);if(n===Y.TOK_LBRACKET)return this.match(Y.TOK_LBRACKET),this.parseMultiselectList();if(n===Y.TOK_LBRACE)return this.match(Y.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(an[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Y.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===Y.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===Y.TOK_DOT)return this.match(Y.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==Y.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===Y.TOK_COMMA&&(this.match(Y.TOK_COMMA),this.lookahead(0)===Y.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Y.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[Y.TOK_UNQUOTEDIDENTIFIER,Y.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Y.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Y.TOK_COMMA)this.match(Y.TOK_COMMA);else if(this.lookahead(0)===Y.TOK_RBRACE){this.match(Y.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const o4=new s4;var ct;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ct||(ct={}));class a4{constructor(t){this.TYPE_NAME_TABLE={[ct.TYPE_NUMBER]:"number",[ct.TYPE_ANY]:"any",[ct.TYPE_STRING]:"string",[ct.TYPE_ARRAY]:"array",[ct.TYPE_OBJECT]:"object",[ct.TYPE_BOOLEAN]:"boolean",[ct.TYPE_EXPREF]:"expression",[ct.TYPE_NULL]:"null",[ct.TYPE_ARRAY_NUMBER]:"Array<number>",[ct.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>eo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ct.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ct.TYPE_NUMBER,ct.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ct.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ct.TYPE_NUMBER,ct.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ct.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ct.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ct.TYPE_NUMBER,ct.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ct.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ct.TYPE_NUMBER?n:r===ct.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ct.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ct.TYPE_NUMBER:return"number";case ct.TYPE_STRING:return"string";case ct.TYPE_ARRAY:return"array";case ct.TYPE_OBJECT:return"object";case ct.TYPE_BOOLEAN:return"boolean";case ct.TYPE_EXPREF:return"expref";case ct.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ct.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ct.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ct.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY]},{types:[ct.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ct.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ct.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY,ct.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ct.TYPE_EXPREF]},{types:[ct.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ct.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ct.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ct.TYPE_ARRAY_STRING,ct.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ct.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ct.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ct.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ct.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ct.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ct.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(g=>{var k;return(k=!g.optional)!==null&&k!==void 0?k:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=n.length<a,l=n.length>r.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let g=0;g<r.length;g+=1){p=!1,f=r[g].types,d=this.getTypeName(n[g]);let k;for(k=0;k<f.length;k+=1)if(d!==void 0&&this.typeMatches(d,f[k],n[g])){p=!0;break}if(!p&&d!==void 0){const w=f.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${g+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(t,n,r){if(n===ct.TYPE_ANY)return!0;if(n===ct.TYPE_ARRAY_STRING||n===ct.TYPE_ARRAY_NUMBER||n===ct.TYPE_ARRAY){if(n===ct.TYPE_ARRAY)return t===ct.TYPE_ARRAY;if(t===ct.TYPE_ARRAY){let i;n===ct.TYPE_ARRAY_NUMBER?i=ct.TYPE_NUMBER:n===ct.TYPE_ARRAY_STRING&&(i=ct.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ct.TYPE_STRING;case"[object Number]":return ct.TYPE_NUMBER;case"[object Array]":return ct.TYPE_ARRAY;case"[object Boolean]":return ct.TYPE_BOOLEAN;case"[object Null]":return ct.TYPE_NULL;case"[object Object]":return t.jmespathType===Y.TOK_EXPREF?ct.TYPE_EXPREF:ct.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class c4{constructor(){this._rootValue=null,this.runtime=new a4(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,u,l,h,f,d;switch(t.type){case"Field":return n===null?null:eo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),f=1;f<t.children.length;f+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],n),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const g=[...t.children],k=this.computeSliceParams(n.length,g),[w,T,A]=k;if(s=[],A>0)for(f=w;f<T;f+=A)s.push(n[f]);else for(f=w;f>T;f+=A)s.push(n[f]);return s;case"Projection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(t.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(t.children[0],n),!eo(d))return null;h=[];const O=Object.values(d);for(f=0;f<O.length;f+=1)i=this.visit(t.children[1],O[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;const P=[],L=[];for(f=0;f<d.length;f+=1)r=this.visit(t.children[2],d[f]),Il(r)||P.push(d[f]);for(let U=0;U<P.length;U+=1)i=this.visit(t.children[1],P[U]),i!==null&&L.push(i);return L;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case Y.TOK_EQ:s=Rl(o,a);break;case Y.TOK_NE:s=!Rl(o,a);break;case Y.TOK_GT:s=o>a;break;case Y.TOK_GTE:s=o>=a;break;case Y.TOK_LT:s=o<a;break;case Y.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case Y.TOK_FLATTEN:const C=this.visit(t.children[0],n);if(!Array.isArray(C))return null;let W=[];for(f=0;f<C.length;f+=1)i=C[f],Array.isArray(i)?W=[...W,...i]:W.push(i);return W;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<t.children.length;f+=1)h.push(this.visit(t.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let M;for(f=0;f<t.children.length;f+=1)M=t.children[f],h[M.name]=this.visit(M.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),Il(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Il(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Il(o);case"Literal":return t.value;case Y.TOK_PIPE:return u=this.visit(t.children[0],n),this.visit(t.children[1],u);case Y.TOK_CURRENT:return n;case Y.TOK_ROOT:return this._rootValue;case"Function":const et=[];for(let U=0;U<t.children.length;U+=1)et.push(this.visit(t.children[U],n));return this.runtime.callFunction(t.name,et);case"ExpressionReference":const pt=t.children[0];return pt.jmespathType=Y.TOK_EXPREF,pt;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const l4=new c4;ct.TYPE_ANY,ct.TYPE_ARRAY,ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING,ct.TYPE_BOOLEAN,ct.TYPE_EXPREF,ct.TYPE_NULL,ct.TYPE_NUMBER,ct.TYPE_OBJECT,ct.TYPE_STRING;function u4(e,t){const n=o4.parse(t);return l4.search(n,e)}const h4=(e,t)=>{const n=to(e.id());if(!E(n))return 0;const[r,i]=it(t,0,[V.NAME,V.NAME]),s=u4(n.json,r);return e.set(i,s),0},f4=(e,t)=>{const n=to(e.id());if(!E(n))return 0;const[r,i]=it(t,0,[V.NAME]);switch(Bt(r)){case"seek":{const[o]=it(t,i,[V.NUMBER]);n.cursor=Ln(o,0,n.lines.length-1);break}case"line":n.cursor=Ln(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,f]=it(t,l,[V.NAME]);e.set(h,c[u]??0),++u,l=f}break}}return 0},d4=ni({get(e,t){const n=JL(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=to(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=to(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=to(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=it(t,0,[V.NAME,V.ANY]);return fd(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(be).join(" ");return mr(H,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n),s=r.map(be).join(" ");return mr(H,"$175",`!${s};${i}`),0}).command("txt",f4).command("json",h4).command("bin",ZL).command("with",(e,t)=>{const[n]=it(t,0,[V.NAME]),r=Fi(v.book,kt.BOARD,n);if(r.length){const i=Mn(...r);E(i)&&(v.board=hi(i),v.element={x:Oi(0,ie-1),y:Oi(0,Je-1)})}return 0});function $1(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=it(i,a,[V.ANY]);re(c)&&!dr(c)&&!Fr(c)&&!gi(c)&&!bn(c)?o.push(...c):o.push(c),a=u}switch(Bt(r)){case"get":case"post:json":Rw(H,e,t,n,r,o,v.elementfocus);break}return 0}const p4=ni().command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[V.NAME,V.NAME,V.MAYBE_STRING]);return $1(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[V.ANY,V.NAME,V.NAME,V.MAYBE_STRING]);return $1(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=it(t,0,[V.ANY]);switch(Bt(n)){default:Tw(H,n,v.elementfocus);break;case"close":vw(H,v.elementfocus);break}return 0}),m4=ni({set(e,t,n){return HM(e,t,n),[!1,void 0]},everytick(){const e=Kr(v.elementid),[t]=e;if(e.length===1&&At(t)){if(E(v.element))if(t.trim().length===0){const n=gn(v.elementid);n.sidebar=[]}else v.element.tickertext=t,v.element.tickertime=v.timestamp}else if(e.length>1)if(v.elementisplayer){const n=gn(v.elementid);n.sidebar=e}else{const n=gn(v.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,u;const[n,r]=it(t,0,[V.NAME,V.ANY]),[i,s]=N1(n);function o(l){for(let h=0;h<l.length;++h){const f=l[h];E(f.id)&&e.send(f.id,s,r)}}switch(Bt(i)){case"all":for(const l of Object.keys(((c=v.board)==null?void 0:c.objects)??{}))e.send(l,s,r);break;case"self":e.message({session:H.session(),id:Ie(),sender:e.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((u=v.board)==null?void 0:u.objects)??{}))l!==e.id()&&e.send(l,s,r);break;default:{o(Mm(v.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(be).join("");return ce(v.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n);return Zt(v.elementid,e.id(),i,r,e.get,e.set),0});var ji=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(ji||{});const g4={audio:rx,board:ML,cli:$L,display:jL,element:YL,runtime:m4,lifecycle:VL,loader:d4,network:p4},ed=["audio","board","display","network","lifecycle","element"],y4={0:[],1:["cli",...ed],2:["loader",...ed],3:["runtime",...ed]},_4={0:new Map,1:new Map,2:new Map,3:new Map};function no(e){return(y4[e]??[]).map(n=>g4[n]).filter(E)}function nd(e){const t=[],n=no(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function b4(e,t){const n=_4[e];if(!n.has(t)){let r;const i=no(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!E(r));++s);n.set(t,r)}return n.get(t)}function w4(e,t,n){const r=no(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function E4(e,t,n,r){const i=no(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function k4(e,t){const n=no(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function j1(e,t){const n=no(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var z1={},K1={},W1={};const G1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");W1.encode=function(e){if(0<=e&&e<G1.length)return G1[e];throw new TypeError("Must be between 0 and 63: "+e)};const T4=W1,H1=5,Y1=1<<H1,v4=Y1-1,x4=Y1;function A4(e){return e<0?(-e<<1)+1:(e<<1)+0}K1.encode=function(t){let n="",r,i=A4(t);do r=i&v4,i>>>=H1,i>0&&(r|=x4),n+=T4.encode(r);while(i>0);return n};var ma={};(function(e){function t(L,C,W){if(C in L)return L[C];if(arguments.length===3)return W;throw new Error('"'+C+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(L){const C=L.match(n);return C?{scheme:C[1],auth:C[2],host:C[3],port:C[4],path:C[5]}:null}e.urlParse=i;function s(L){let C="";return L.scheme&&(C+=L.scheme+":"),C+="//",L.auth&&(C+=L.auth+"@"),L.host&&(C+=L.host),L.port&&(C+=":"+L.port),L.path&&(C+=L.path),C}e.urlGenerate=s;const o=32;function a(L){const C=[];return function(W){for(let et=0;et<C.length;et++)if(C[et].input===W){const pt=C[0];return C[0]=C[et],C[et]=pt,C[0].result}const M=L(W);return C.unshift({input:W,result:M}),C.length>o&&C.pop(),M}}const c=a(function(C){let W=C;const M=i(C);if(M){if(!M.path)return C;W=M.path}const et=e.isAbsolute(W),pt=[];let U=0,S=0;for(;;)if(U=S,S=W.indexOf("/",U),S===-1){pt.push(W.slice(U));break}else for(pt.push(W.slice(U,S));S<W.length&&W[S]==="/";)S++;let _=0;for(S=pt.length-1;S>=0;S--){const B=pt[S];B==="."?pt.splice(S,1):B===".."?_++:_>0&&(B===""?(pt.splice(S+1,_),_=0):(pt.splice(S,2),_--))}return W=pt.join("/"),W===""&&(W=et?"/":"."),M?(M.path=W,s(M)):W});e.normalize=c;function u(L,C){L===""&&(L="."),C===""&&(C=".");const W=i(C),M=i(L);if(M&&(L=M.path||"/"),W&&!W.scheme)return M&&(W.scheme=M.scheme),s(W);if(W||C.match(r))return C;if(M&&!M.host&&!M.path)return M.host=C,s(M);const et=C.charAt(0)==="/"?C:c(L.replace(/\/+$/,"")+"/"+C);return M?(M.path=et,s(M)):et}e.join=u,e.isAbsolute=function(L){return L.charAt(0)==="/"||n.test(L)};function l(L,C){L===""&&(L="."),L=L.replace(/\/$/,"");let W=0;for(;C.indexOf(L+"/")!==0;){const M=L.lastIndexOf("/");if(M<0||(L=L.slice(0,M),L.match(/^([^\/]+:\/)?\/*$/)))return C;++W}return Array(W+1).join("../")+C.substr(L.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function f(L){return L}function d(L){return g(L)?"$"+L:L}e.toSetString=h?f:d;function p(L){return g(L)?L.slice(1):L}e.fromSetString=h?f:p;function g(L){if(!L)return!1;const C=L.length;if(C<9||L.charCodeAt(C-1)!==95||L.charCodeAt(C-2)!==95||L.charCodeAt(C-3)!==111||L.charCodeAt(C-4)!==116||L.charCodeAt(C-5)!==111||L.charCodeAt(C-6)!==114||L.charCodeAt(C-7)!==112||L.charCodeAt(C-8)!==95||L.charCodeAt(C-9)!==95)return!1;for(let W=C-10;W>=0;W--)if(L.charCodeAt(W)!==36)return!1;return!0}function k(L,C,W){let M=T(L.source,C.source);return M!==0||(M=L.originalLine-C.originalLine,M!==0)||(M=L.originalColumn-C.originalColumn,M!==0||W)||(M=L.generatedColumn-C.generatedColumn,M!==0)||(M=L.generatedLine-C.generatedLine,M!==0)?M:T(L.name,C.name)}e.compareByOriginalPositions=k;function w(L,C,W){let M=L.generatedLine-C.generatedLine;return M!==0||(M=L.generatedColumn-C.generatedColumn,M!==0||W)||(M=T(L.source,C.source),M!==0)||(M=L.originalLine-C.originalLine,M!==0)||(M=L.originalColumn-C.originalColumn,M!==0)?M:T(L.name,C.name)}e.compareByGeneratedPositionsDeflated=w;function T(L,C){return L===C?0:L===null?1:C===null?-1:L>C?1:-1}function A(L,C){let W=L.generatedLine-C.generatedLine;return W!==0||(W=L.generatedColumn-C.generatedColumn,W!==0)||(W=T(L.source,C.source),W!==0)||(W=L.originalLine-C.originalLine,W!==0)||(W=L.originalColumn-C.originalColumn,W!==0)?W:T(L.name,C.name)}e.compareByGeneratedPositionsInflated=A;function O(L){return JSON.parse(L.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=O;function P(L,C,W){if(C=C||"",L&&(L[L.length-1]!=="/"&&C[0]!=="/"&&(L+="/"),C=L+C),W){const M=i(W);if(!M)throw new Error("sourceMapURL could not be parsed");if(M.path){const et=M.path.lastIndexOf("/");et>=0&&(M.path=M.path.substring(0,et+1))}C=u(s(M),C)}return c(C)}e.computeSourceURL=P})(ma);var rd={};let S4=class Pb{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new Pb;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};rd.ArraySet=S4;var V1={};const q1=ma;function R4(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||q1.compareByGeneratedPositionsInflated(e,t)<=0}let I4=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){R4(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(q1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};V1.MappingList=I4;const ga=K1,Pe=ma,Ol=rd.ArraySet,O4=V1.MappingList;let J1=class Bb{constructor(t){t||(t={}),this._file=Pe.getArg(t,"file",null),this._sourceRoot=Pe.getArg(t,"sourceRoot",null),this._skipValidation=Pe.getArg(t,"skipValidation",!1),this._sources=new Ol,this._names=new Ol,this._mappings=new O4,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new Bb({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Pe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Pe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Pe.getArg(t,"generated"),r=Pe.getArg(t,"original",null);let i=Pe.getArg(t,"source",null),s=Pe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Pe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Pe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Pe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Pe.relative(s,i));const o=this._mappings.toArray().length>0?new Ol:this._sources,a=new Ol;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Pe.join(r,c.source)),s!=null&&(c.source=Pe.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=Pe.join(r,c)),s!=null&&(c=Pe.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const f=this._mappings.toArray();for(let d=0,p=f.length;d<p;d++){if(u=f[d],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(d>0){if(!Pe.compareByGeneratedPositionsInflated(u,f[d-1]))continue;c+=","}c+=ga.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=ga.encode(h-o),o=h,c+=ga.encode(u.originalLine-1-i),i=u.originalLine-1,c+=ga.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=ga.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Pe.relative(n,r));const i=Pe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};J1.prototype._version=3,z1.SourceMapGenerator=J1;var X1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(X1);var ya={exports:{}},N4={},C4=Object.freeze({__proto__:null,default:N4}),Z1=Fb(C4);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;ya.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},ya.exports.initialize=t=>e=t}else{const e=Z1,t=Z1;ya.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},ya.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Q1=ya.exports;const L4=Q1;function M4(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let _a=null;var U4=function(){if(_a)return _a;const t=[];return _a=L4().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,f){const d=new M4;d.generatedLine=r+1,d.generatedColumn=i,s&&(d.lastGeneratedColumn=o-1),a&&(d.source=c,d.originalLine=u+1,d.originalColumn=l,h&&(d.name=f)),t[t.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw _a=null,n}),_a};const Tt=ma,id=X1,Nl=rd.ArraySet,P4=Q1,B4=U4,sd=Symbol("smcInternal");class Le{constructor(t,n){return t==sd?Promise.resolve(this):D4(t,n)}static initialize(t){P4.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return $4(t,n)}static async with(t,n,r){const i=await new Le(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Le.prototype._version=3,Le.GENERATED_ORDER=1,Le.ORIGINAL_ORDER=2,Le.GREATEST_LOWER_BOUND=1,Le.LEAST_UPPER_BOUND=2;class ba extends Le{constructor(t,n){return super(sd).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const u=Tt.getArg(i,"sourcesContent",null),l=Tt.getArg(i,"mappings"),h=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(f){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(f)?Tt.relative(c,f):f}),r._names=Nl.fromArray(a.map(String),!0),r._sources=Nl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return Tt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,B4().then(f=>(r._wasm=f,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new ba(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Le.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Le.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Le.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Tt.getArg(t,"source");const r=Tt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(t,"bias",Le.GREATEST_LOWER_BOUND);r==null&&(r=Le.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Tt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(t,"line"),originalColumn:Tt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(t,"bias",Le.GREATEST_LOWER_BOUND);i==null&&(i=Le.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}ba.prototype.consumer=Le;class F4 extends Le{constructor(t,n){return super(sd).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Nl,r._names=new Nl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=Tt.getArg(c,"offset"),l=Tt.getArg(u,"line"),h=Tt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new Le(Tt.getArg(c,"map"),n).then(d=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:d}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Tt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")},r=id.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const f={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(t,n,r){const i=n||null,s=r||Le.GENERATED_ORDER;let o;switch(s){case Le.GENERATED_ORDER:o=this._generatedMappings;break;case Le.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=Tt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return id.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Tt.getArg(t,"line"),r={source:Tt.getArg(t,"source"),originalLine:n,originalColumn:Tt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,id.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function D4(e,t){let n=e;typeof e=="string"&&(n=Tt.parseSourceMapInput(e));const r=n.sections!=null?new F4(n,t):new ba(n,t);return Promise.resolve(r)}function $4(e,t){return ba.fromSourceMap(e,t)}var tb={};const j4=z1.SourceMapGenerator,Cl=ma,z4=/(\r?\n)/,K4=10,ro="$$$isSourceNode$$$";let W4=class vd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[ro]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new vd,s=t.split(z4);let o=0;const a=function(){const d=g(),p=g()||"";return d+p;function g(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(d){if(l!==null)if(c<d.generatedLine)f(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,d.generatedColumn-u);s[o]=h.substr(d.generatedColumn-u),u=d.generatedColumn,f(l,p),l=d;return}for(;c<d.generatedLine;)i.add(a()),c++;u<d.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,d.generatedColumn)),s[o]=h.substr(d.generatedColumn),u=d.generatedColumn),l=d},this),o<s.length&&(l&&f(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(d){const p=n.sourceContentFor(d);p!=null&&(r!=null&&(d=Cl.join(r,d)),i.setSourceContent(d,p))}),i;function f(d,p){if(d===null||d.source===void 0)i.add(p);else{const g=r?Cl.join(r,d.source):d.source;i.add(new vd(d.originalLine,d.originalColumn,g,p,d.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[ro]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[ro]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[ro]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[ro]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Cl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][ro]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Cl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new j4(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,f=u.length;h<f;h++)u.charCodeAt(h)===K4?(n.line++,n.column=0,h+1===f?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};tb.SourceNode=W4;var G4=tb.SourceNode;let eb=0;const nb=Ar,H4=["Command","lines"];class Y4 extends zC{constructor(){super(c1,{traceInitPerf:Ar,skipValidations:!Ar,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ct(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ct(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(ha)}])}));Ct(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ct(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ct(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ct(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(P_)}));Ct(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(xf)}));Ct(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(M_)}])}));Ct(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(U_)}));Ct(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(B_),this.SUBRULE(this.words),this.CONSUME(F_)}));Ct(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Xs),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ct(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ct(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ct(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ct(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Nf),this.SUBRULE(this.words)}));Ct(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(X_),this.SUBRULE(this.words)}));Ct(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Cf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ct(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(bl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(ha)),this.CONSUME4(Xs),this.CONSUME4(Lf)}}])}));Ct(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(bl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Xs),this.CONSUME(Lf)}}])}));Ct(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(bl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ct(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Xs),this.CONSUME(Mf),this.CONSUME(Cf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ct(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Xs),this.CONSUME(Mf),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ct(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(e1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(n1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(r1),this.SUBRULE(this.words)}));Ct(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(i1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ct(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(s1)}));Ct(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(o1)}));Ct(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(t1)}));Ct(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Af),this.SUBRULE2(this.and_test)})}));Ct(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Rf),this.SUBRULE2(this.not_test)})}));Ct(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Sf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ct(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ct(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(j_)},{ALT:()=>this.CONSUME(z_)},{ALT:()=>this.CONSUME(K_)},{ALT:()=>this.CONSUME(W_)},{ALT:()=>this.CONSUME(G_)},{ALT:()=>this.CONSUME(H_)}])}));Ct(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Af),this.SUBRULE2(this.and_test_value)})}));Ct(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Rf),this.SUBRULE2(this.not_test_value)})}));Ct(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Sf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ct(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ct(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(If)},{ALT:()=>this.CONSUME(Of)}]),this.SUBRULE(this.term)}));Ct(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ct(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(V_)},{ALT:()=>this.CONSUME(Nf)},{ALT:()=>this.CONSUME(q_)},{ALT:()=>this.CONSUME(J_)}]),this.SUBRULE(this.factor)}));Ct(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(If)},{ALT:()=>this.CONSUME(Of)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ct(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Y_),this.SUBRULE(this.factor)})}));Ct(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ct(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(D_)},{ALT:()=>this.CONSUME(on)},{ALT:()=>this.CONSUME($_)},{ALT:()=>{this.CONSUME(Z_),this.SUBRULE(this.expr),this.CONSUME(Q_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=H4.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(eb++).toString().padStart(3),c=s?"font-weight: bold;":"";if(nb&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),nb&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),eb--},i)}}const io=new Y4;if(tx){const e=io.getGAstProductions(),t=tL(e);console.info(t)}const V4=io.getBaseCstVisitorConstructor();var gt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(gt||{}),_s=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(_s||{}),Dr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Dr||{}),Ll=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Ll||{});function q4(e){return!!(e!=null&&e.tokenType)}function hr(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class J4 extends V4{constructor(){super();Ct(this,"unique",0);Ar&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&q4(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():E(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:hr(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:hr(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:hr(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:hr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:hr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,hr(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Ie(),i=Ie();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Ie(),i=Ie();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,hr(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Ie(),i=Ie();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Ie(),i=Ie(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Ie(),i=Ie(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Ie();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=hr(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=hr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=hr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(hr(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const X4=new J4,Sn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Ml="zss.js";function Jt(e,t){return new G4(e.startLine??1,e.startColumn??1,Ml,t)}function od(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function ad(e){return`'${od(e)}'`}function Ul(e){if(e.startsWith('"'))return Ul(e.replaceAll(/(^"|"$)/g,""));const t=qf(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Yf?`', api.get('${od(r.image.substring(1))}'), '`:od(r.image)).join("")}'].join('')`}function so(e){return e.filter(t=>t!==void 0).map(ee)}function rb(e){return Jt(e,"")}function Z4(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function Ge(e,t,n){return Jt(e,[`api.${t}(`,...Z4(n,", "),")"])}function Q4(e){if(e.type===gt.COMPARE&&e.compare.type===gt.COMPARE_ITEM)switch(e.compare.method){case _s.IS_EQ:return Ge(e,"isEq",[ee(e.lhs),ee(e.rhs)]);case _s.IS_NOT_EQ:return Ge(e,"isNotEq",[ee(e.lhs),ee(e.rhs)]);case _s.IS_LESS_THAN:return Ge(e,"isLessThan",[ee(e.lhs),ee(e.rhs)]);case _s.IS_GREATER_THAN:return Ge(e,"isGreaterThan",[ee(e.lhs),ee(e.rhs)]);case _s.IS_LESS_THAN_OR_EQ:return Ge(e,"isLessThanOrEq",[ee(e.lhs),ee(e.rhs)]);case _s.IS_GREATER_THAN_OR_EQ:return Ge(e,"isGreaterThanOrEq",[ee(e.lhs),ee(e.rhs)])}return Jt(e,"")}function bs(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ee(n),")"])}function ib(e,t,n){return e.prepend(`api.${t}(`),e.add([ee(n),")"])}function tM(e,t){if(e.type===gt.OPERATOR_ITEM)switch(e.operator){case Dr.PLUS:return bs(t,"opPlus",e.rhs);case Dr.MINUS:return bs(t,"opMinus",e.rhs);case Dr.POWER:return bs(t,"opPower",e.rhs);case Dr.MULTIPLY:return bs(t,"opMultiply",e.rhs);case Dr.DIVIDE:return bs(t,"opDivide",e.rhs);case Dr.MOD_DIVIDE:return bs(t,"opModDivide",e.rhs);case Dr.FLOOR_DIVIDE:return bs(t,"opFloorDivide",e.rhs);case Dr.UNI_PLUS:return ib(t,"opUniPlus",e.rhs);case Dr.UNI_MINUS:return ib(t,"opUniMinus",e.rhs)}return Jt(e,"")}function eM(e){if(e.type===gt.OPERATOR){const t=e.lhs?ee(e.lhs):Jt(e,"");return e.items.forEach(n=>tM(n,t)),t}return Jt(e,"")}function Pl(e,t){return Jt(e,[Ge(e,"jump",[`${t}`]),"; continue;"])}function yi(e){return Sn.linelookup[e??""]??-1}function cd(e,t){Sn.linelookup[e]=t}function oo(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&(i.done=n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&(i.skip=n);break;case gt.LINE:oo(i.stmts,t,n);break}}}function sb(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&cd(i.done,n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&cd(i.skip,n);break;case gt.LINE:sb(i.stmts,t,n);break}}}function ee(e){var t;switch(e.type){case gt.PROGRAM:return Jt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ee).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Ml}`]);case gt.API:return Jt(e,["  ",Ge(e,e.method,so(e.words)),`;
`]);case gt.LINE:return Jt(e,[`case ${e.lineindex}:
`,...e.stmts.map(ee).flat(),`  break;
`]);case gt.MARK:return Jt(e,`  // ${e.comment}
`);case gt.GOTO:{const n=yi(e.id);return Jt(e,["  ",Pl(e,n),`
`])}case gt.COUNT:return Jt(e,`${e.index}`);case gt.LITERAL:switch(e.literal){case Ll.NUMBER:return Jt(e,`${e.value}`);case Ll.STRING:return Jt(e,ad(e.value));case Ll.TEMPLATE:return Jt(e,Ul(e.value))}return rb(e);case gt.TEXT:return Jt(e,["  ",Ge(e,"text",[Ul(e.value)]),`;
`]);case gt.STAT:if(Sn.isfirststat){Sn.isfirststat=!1;const n=e.value.trim().split(" ").map(ad);return Jt(e,["  ",Ge(e,"stat",n),`;
`])}return Jt(e,`  // skipped ${e.value}
`);case gt.LABEL:{const n=Bt(e.name),r=e.active?"label":"comment";Sn.labels[n]||(Sn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Sn.labels[n].push(i),Jt(e,`  // ${i} '${n}' ${r}
`)}case gt.HYPERLINK:return Jt(e,["  ",Ge(e,"hyperlink",[Ul(e.text),...so(e.link)]),`;
`]);case gt.MOVE:{const n=Ge(e,"command",[ad("go"),so(e.words)].flat());return e.wait?Jt(e,["  if (",n,`) { continue; };
`]):Jt(e,["  ",n,`;
`])}case gt.COMMAND:return Jt(e,["  if (",Ge(e,"command",so(e.words)),`) { continue; };
`]);case gt.IF:{const n=((t=e.block)==null?void 0:t.type)===gt.IF_BLOCK?e.block:void 0;if(E(n)){oo([e.check],gt.IF_CHECK,n.skip);const r=Jt(e,ee(e.check));return n.lines.forEach(i=>r.add(ee(i))),sb(n.altlines,gt.ELSE_IF,yi(n.done)),n.altlines.forEach(i=>r.add(ee(i))),r}return Jt(e,ee(e.check))}case gt.IF_CHECK:{const n=yi(e.skip);return n===-1?Jt(e,["  ",Ge(e,e.method,so(e.words)),`;
`]):Jt(e,["  if (!",Ge(e,e.method,so(e.words)),") { ",Pl(e,n),` }
`])}case gt.ELSE_IF:case gt.ELSE:{const n=Jt(e,"");return e.lines.forEach(r=>n.add(ee(r))),n}case gt.WHILE:{const n=yi(e.loop),r=yi(e.done),i=Jt(e,"");return oo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ee(s))}),i}case gt.REPEAT:{const n=yi(e.loop),r=yi(e.done),i=Jt(e,"");return oo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ee(s))}),i}case gt.WAITFOR:{const n=Jt(e,"");return oo(e.lines,gt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ee(r))}),n}case gt.FOREACH:{const n=yi(e.loop),r=yi(e.done),i=Jt(e,"");return oo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ee(s))}),i}case gt.BREAK:return Jt(e,["  ",Pl(e,e.goto),`
`]);case gt.CONTINUE:return Jt(e,["  ",Pl(e,e.goto),`
`]);case gt.OR:return Ge(e,"or",e.items.map(ee));case gt.AND:return Ge(e,"and",e.items.map(ee));case gt.NOT:return Ge(e,"not",e.items.map(ee));case gt.COMPARE:return Q4(e);case gt.OPERATOR:return eM(e);case gt.EXPR:return Ge(e,"expr",e.words.map(ee));default:return console.error("<unsupported node>",e.type,e),rb(e)}}function $r(e){if(E(e))switch(e.type===gt.LINE&&++Sn.lineindex,e.lineindex=Sn.lineindex,e.type){case gt.PROGRAM:e.lines.forEach($r);break;case gt.LINE:e.stmts.forEach($r);break;case gt.MARK:cd(e.id,e.lineindex);break;case gt.IF:$r(e.check),$r(e.block);break;case gt.IF_BLOCK:e.lines.forEach($r),e.altlines.forEach($r);break;case gt.ELSE_IF:e.lines.forEach($r);break;case gt.ELSE:case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.WAITFOR:e.lines.forEach($r);break;case gt.MOVE:case gt.COMMAND:case gt.IF_CHECK:e.words.forEach($r);break}}function nM(e){return Sn.labels={},Sn.internal=1,Sn.lineindex=0,Sn.isfirststat=!0,$r(e),{...ee(e).toStringWithSourceMap({file:`${Ml}.map`}),...Sn}}function ob(e){return re(e)?e.length>0?1:0:e??0}function rM(e){return`${e}_chip`}function ab(e=""){return`vm:${e??""}`}function iM(e,t,n){var u,l;const r=rM(e),i=ws(r);let s;const o=pr(Object.entries(n.labels??{}));(!re(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=n.errors)==null?void 0:u.length)??0)!==0?1:0);function a(h,f){v.words=f;const d=b4(t,h);return E(d)?d(c,f):h!=="send"?a("send",[h,...f]):0}const c={halt(){wM(r)},id(){return e},set(h,f){const[d,p]=E4(t,c,h,f);if(d)return p},get(h){const[f,d]=w4(t,c,h);if(f)return d},tick(h){const f=Mt(i.ps)?i.ps:0,d=f%h===0;if(i.ps=f+1,d===!1)return!1;if(c.shouldtick()===!1)return j1(t,c),!1;i.lc=0,i.ys=0,v.get=c.get,k4(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ae(H,"crash",p.message),i.es=1}return j1(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Mt(i.lc)?++i.lc>ei.HALT_AT_COUNT:!0},hm(){if(re(i.mg)&&re(i.lb)){const[h]=i.mg;if(E(h))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)return p.find(g=>Mt(g)&&g>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,f,d,p){H.emit(`${ab(h)}:${f}`,d,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(re(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h){const g=p.findIndex(k=>k>0);g>=0&&(p[g]*=-1)}}},restore(h){if(re(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)for(let g=0;g<p.length;g++)p[f]=Math.abs(p[f])}},getcase(){i.ec=Mt(i.ec)?i.ec:1;const h=c.hm();if(h&&re(i.mg)){const[,f,d,p]=i.mg;c.set("sender",d),E(f)&&c.set("arg",f),At(p)&&(c.set("player",p),v.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Mt(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const f=zv.parse(h),[d]=f.filter(p=>p.fileName===Ml);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[f,...d]=h;return a(Bt(be(f)),d)},if(...h){const[f,d]=it(h,0,[V.ANY]),p=ob(f);return p&&d<h.length&&c.command(...h.slice(d)),p?1:0},try(...h){const[,f]=it(h,0,[V.DIR]),d=c.command("go",...h);return d&&f<h.length&&c.command(...h.slice(f)),d?1:0},take(...h){const[f,d,p]=it(h,0,[V.NAME,V.ANY]),g=Mt(d),k=g?p:1,w=c.get(f),T=g?d:1;if(!Mt(w))return k<h.length&&c.command(...h.slice(k)),1;const A=w-T;return A<0?(k<h.length&&c.command(...h.slice(k)),1):(c.set(f,A),0)},give(...h){const[f,d,p]=it(h,0,[V.NAME,V.ANY]),g=Mt(d),k=g?p:1,w=c.get(f),T=g?d:1,A=w===void 0?1:0;return A&&k<h.length&&c.command(...h.slice(k)),c.set(f,Do(w,0)+T),A},repeatstart(h,...f){const[d,p]=it(f,0,[V.NUMBER]),g=`repeatcount${h}`,k=`repeatwords${h}`;i[g]=d,i[k]=p<f.length?f.slice(p):void 0},repeat(h){const f=`repeatcount${h}`,d=`repeatwords${h}`;if(!Mt(i[f]))return 0;const p=i[f];i[f]=p-1;const g=p>0,k=i[d];return g&&re(k)&&c.command(...k),g?1:0},foreachstart(h,...f){const[d,p,g,k]=it(f,0,[V.NAME,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER]);let w=Math.min(p,g),T=Math.max(p,g);const A=(k??0)||1;if(A<0){const O=w;w=T,T=O}return c.set(d,w-A),0},foreach(h,...f){const[d,p,g,k,w]=it(f,0,[V.NAME,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER]);let T=Math.min(p,g),A=Math.max(p,g);const O=(k??0)||1;if(O<0){const C=T;T=A,A=C}let P=c.get(d);!Mt(P)||P<T||P>A?P=T:P+=O;const L=P<=A?1:0;return L&&(c.set(d,P),w<f.length&&c.command(...f.slice(w))),L},waitfor(...h){const[f]=it(h,0,[V.ANY]),d=ob(f);return d||c.yield(),d?1:0},or(...h){let f=0;for(let d=0;d<h.length;){const[p,g]=it(h,d,[V.ANY]);if(f=p,f)break;d=g}return f},and(...h){let f=0;for(let d=0;d<h.length;){const[p,g]=it(h,d,[V.ANY]);if(f=p,!f)break;d=g}return f},not(...h){const[f]=it(h,0,[V.ANY]);return f?0:1},expr(...h){const[f]=it(h,0,[V.ANY]);return f},isEq(h,f){const[d]=it([h],0,[V.ANY]),[p]=it([f],0,[V.ANY]);return typeof d=="object"||typeof p=="object"?yw(d,p)?1:0:d===p?1:0},isNotEq(h,f){return this.isEq(h,f)?0:1},isLessThan(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d<p?1:0},isGreaterThan(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d>p?1:0},isLessThanOrEq(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d>=p?1:0},opPlus(h,f){const[d]=it([h],0,[V.ANY]),[p]=it([f],0,[V.ANY]);return d+p},opMinus(h,f){const[d]=it([h],0,[V.ANY]),[p]=it([f],0,[V.ANY]);return d-p},opPower(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return Math.pow(d,p)},opMultiply(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d*p},opDivide(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d/p},opModDivide(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return d%p},opFloorDivide(h,f){const[d]=it([h],0,[V.NUMBER]),[p]=it([f],0,[V.NUMBER]);return Math.floor(d/p)},opUniPlus(h){const[f]=it([h],0,[V.NUMBER]);return+f},opUniMinus(h){const[f]=it([h],0,[V.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,c),c}function ld(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];re(r)?r.forEach(i=>{t.push(ld(i))}):t.push(ld(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function sM(e){const t=l1(`${e}
`);if(t.errors.length>0)return t;io.input=t.tokens;const n=io.program();if(io.errors.length>0)return{tokens:t.tokens,errors:io.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=X4.go(n);return r?(ld(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const ud=Object.getPrototypeOf(function*(){}).constructor;function oM(e,t){const n=`compile-${e}`;console.time(n);const r=sM(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=nM(r.ast);if(i.code){ex&&console.info(i.code);try{return{...r,...i,source:i.code,code:new ud("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new ud("api"," ")}}}return{...r,...i,source:"",code:new ud("api"," ")}}function aM(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=oM(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return E(s)?s.isended():!0},halt(i){const s=t[i];return E(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];E(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!E(t[i])){const h=n(a,c);if(u=t[i]=iM(i,s,h),(l=h.errors)!=null&&l.length){const[f]=h.errors,d=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((w,T)=>[w,T]);p.slice(d-5,d).forEach(([w,T])=>{ae(H,"build",`$grey${T+1} $grey${w}`)});const[g,k]=p[d]??[];if(At(g)&&E(k)){const w=(f.column??1)-1,T=w+f.length,A=w<g.length?g:`${g}*`,O=A.substring(0,w),P=A.substring(w,T),L=A.substring(T);ae(H,"build",`$red${k+1} $grey${O}$red${P}$grey${L}`)}return f.message.split(`
`).forEach(w=>{ae(H,"build",w)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=xs(i.target),a=t[s];if(E(a)){const c={...i,target:o};a.message(c)}}};return r}let cb=0;function cM(){switch(cb++){case 0:return jt.BLUE;case 1:return jt.GREEN;case 2:return jt.CYAN;case 3:return jt.RED;case 4:return jt.PURPLE;case 5:return jt.YELLOW;default:return cb=0,jt.WHITE}}const Be=new Bo,mn={},Bl={};function lb(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return E(mn[s])||(mn[s]=Gv(e,t,n,r,i)),mn[s]}function lM(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return E(Bl[s])||(Bl[s]=Hv(e,t,n)),Bl[s].id=i,Bl[s]}function uM(e,t){const n=`sprites:${e}:${t}`;return E(mn[n])||(mn[n]=Yv(e,t)),mn[n]}function hM(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return E(mn[s])||(mn[s]=Vv(e,t,n,r,i)),mn[s]}function ub(e,t,n,r){const i=`media:${e}:${t}`;return E(mn[i])||(mn[i]=qv(e,t,n,r)),mn[i]}function fM(e,t){const n=`control:${e}:${t}`;return E(mn[n])||(mn[n]=Jv(e,t)),mn[n]}const zi=.4;function hb(e,t){const n=[];Be.x=e-zi,Be.y=t-zi,n.push(Be.angle()),Be.x=e+zi,Be.y=t-zi,n.push(Be.angle()),Be.x=e-zi,Be.y=t+zi,n.push(Be.angle()),Be.x=e+zi,Be.y=t+zi,n.push(Be.angle());const r=Math.round(ph(Math.min(...n))),i=Math.round(ph(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function dM(e,t,n,r,i){var L,C,W;if(!E(r)||!E(r.terrain)||!E(r.objects))return[];const s=[];let o=t;const a=o===0,c=ie,u=Je,l=a?jt.BLACK:jt.ONCLEAR,h=lb(e,o++,c,u,l);s.push(h);const f=o++,d=uM(e,f);d.sprites=[],s.push(d);const p=r.isdark?1:0,g=hM(e,o++,c,u,p);s.push(g),g.alphas.fill(p);const k=lb(e,o++,c,u,jt.ONCLEAR);s.push(k),k.char.fill(0);const w={...Jf(ie,Je,cM(),jt.ONCLEAR),...k},T=fM(e,o++);i&&s.push(T);for(let M=0;M<r.terrain.length;++M){const et=r.terrain[M],pt=y1(n,et,0,jt.BLACK,jt.ONCLEAR);h.char[M]=pt.char,h.color[M]=pt.color,h.bg[M]=pt.bg}const A=Object.values(r.objects??{});for(let M=0;M<A.length;++M){const et=A[M];if(E(et.removed))continue;const pt=et.id??"",U=y1(n,et,1,jt.WHITE,jt.BLACK),S=lM(e,f,pt,M);if(S.x=et.x??0,S.y=et.y??0,S.char=U.char,S.color=U.color,S.bg=U.bg,d.sprites.push(S),p){if(U.light>0){const _=[],B=Ln(Math.round(U.light),1,10),X=B*.5,j=jr(r,S),ht=1/X;if(g.alphas[j]=0,B>1)for(let Q=1;Q<=B;++Q)for(let ut=S.y-Q;ut<=S.y+Q;++ut)for(let G=S.x-Q;G<=S.x+Q;++G){if(G===S.x&&ut===S.y)continue;Be.x=G-S.x,Be.y=ut-S.y;const $=Be.length();if($>B)continue;const yt=jr(r,{x:G,y:ut});if(yt===-1)continue;const st=Math.round(ph(Be.angle()));let at=0;for(let Lt=0;Lt<_.length;++Lt){const Nt=_[Lt];st>=Nt[0]&&st<=Nt[1]&&(at=Math.max(at,Nt[2]))}g.alphas[yt]=Math.min(g.alphas[yt],at+($<X?0:($-X)*ht)),g.alphas[yt]=Ln(g.alphas[yt],0,1);const Ut=Rn(r,((L=r.lookup)==null?void 0:L[yt])??"");if(E(Ut)){const Lt=[...hb(Be.x,Be.y),.25];_.push(Lt)}const Wt=r.terrain[yt],Ot=Di(n,Wt),Rt=(Wt==null?void 0:Wt.collision)??(Ot==null?void 0:Ot.collision);if(_h(Gt.ISBULLET,Rt)){const Lt=[...hb(Be.x,Be.y),1];let Nt=0;for(Nt=0;Nt<_.length;++Nt){const ne=_[Nt];if(ne[1]>ne[0]&&Lt[1]>=ne[0]&&Lt[0]<=ne[1]&&Lt[2]>=1&&ne[2]>=1){_[Nt]=[Math.min(Lt[0],ne[0]),Math.max(Lt[1],ne[1]),1];break}}Nt===_.length&&_.push(Lt)}}}else if(Ts(pt)){const _=jr(r,S);g.alphas[_]=0}}if(At(et.tickertext)&&Mt(et.tickertime)&&et.tickertext.length){const _=ie,B=R1(et.tickertext,_,Je-1),X=(B==null?void 0:B.measuredwidth)??1,j=et.x??0,ht=et.y??0,Q=ht<Je*.5;w.x=j-Math.floor(X*.5),w.y=ht+(Q?1:-1),w.x+X>ie&&(w.x=ie-X),w.x<0&&(w.x=0),S1(et.tickertext,w,!0)}pt===e&&(T.focusx=S.x,T.focusy=S.y,T.focusid=pt)}const O=Te(Kt.MAIN),P=di(O,Kt.MAIN);if(At(P.palette)){const M=fi(O,kt.PALETTE,P.palette);E((C=M==null?void 0:M.palette)==null?void 0:C.bits)&&s.push(ub(e,o++,"image/palette",Array.from(M.palette.bits)))}if(At(P.charset)){const M=fi(O,kt.CHARSET,P.charset);E((W=M==null?void 0:M.charset)==null?void 0:W.bits)&&s.push(ub(e,o++,"image/charset",Array.from(M.charset.bits)))}return s}const Dn=aM();var Kt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Kt||{});const ke={halt:!1,session:Ie(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function pM(){return ke.session}function _i(){return ke.operator}function mM(e){ke.operator=e}function gM(e){ke.halt=e}function yM(){return ke.halt}function wa(){return[...ke.books.values()]}function _M(){const[e]=ke.books.values();return e}function Ki(e){const t=Bt(e);return ke.books.get(e)??wa().find(n=>n.name===t)}function Fl(e,t){E(Ki(t))&&(ke.software[e]=t)}function Te(e){return Ki(ke.software[e])}function fb(e){const t=m1([]);return At(e)&&(t.name=e),pb(t),mr(H,`created [book] ${t.name}`),t}function bM(e){let t=Ki(e);return E(t)||(t=m1([]),t.name=e),pb(t),mr(H,`created [book] ${t.name}`),t}function $n(e,t){let n=E(t)?bM(t):Te(e);return E(n)||(E(n)||(n=_M()),E(n)||(n=fb(t)),E(n)&&mr(H,`opened [book] ${n.name} for ${e}`)),Fl(e,n.id),n}function Wi(e,t,n){return Df($n(e),n,t)}function ws(e){const t=$n("main");return di(t,e)}function db(){const e=$n("main");return di(e,"main")}function wM(e){const t=$n("main");return b1(t,e)}function EM(e,t){ke.books.clear(),e.forEach(r=>{ke.books.set(r.id,r),r.name==="main"&&(ke.software.main=r.id)});const n=Ki(t);if(E(n)&&Fl("main",n.id),!ke.software.main){const r=ke.books.values().next();r.value&&(ke.software.main=r.value.id)}}function pb(e){return ke.books.set(e.id,e),e.id}function kM(e){const t=Ki(e);t&&ke.books.delete(t.id)}function TM(e){if(!At(e)||!e)return ae(H,"login",`failed for playerid ==>${e}<==`,e);const t=Te("main");if(!E(t))return ae(H,"login:main","login failed to find book 'main'",e);const n=ys(t,e);if(E(n))return!0;const r=Fi(t,kt.BOARD,"title");if(r.length===0)return ae(H,"login:title","login failed to find board with 'title' stat",e);const i=kl(t,"player");if(!E(i))return ae(H,"login:player","login failed to find object type 'player'",e);const s=bm(e,r),o=hi(s);if(E(o)){const a=p1(s,"startx"),c=p1(s,"starty"),u=Mt(a)?a:Math.round(ie*.5),l=Mt(c)?c:Math.round(Je*.5),h=i.name??"player",f=yd(o,{x:u,y:l},h,e);if(E(f==null?void 0:f.id))return f.player=e,Tl(t,e,o.id),!0}return!1}function vM(e){const t=Te("main"),n=ys(t,e);Tl(t,e,""),Kf(t,n,Rn(n,e)),kb(n,e),Dn.halt(e),b1(t,e)}function fr(e){const t=Te("main");return ys(t,e)}function xM(e){const t=Te("main"),n=yL(t,e),r=ys(t,e),i=Rn(r,e);return n&&E(i)}function AM(e){const t=Te("main"),n=$f(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Ts(c)&&E(e[c])===!1&&(e[c]=0,Tl(t,c,i.id))}}}function mb(e){Dn.message(e)}function Ea(e,t,n,r){const i=os(e);At(t.id)&&H.emit("vm:touched",[t.id,i,n],r)}function hd(e,t,n,r){if(!E(n))return!1;const i=E1(e,t,n,r);if(E(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=Fi(e,kt.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=Mn(o);fa(e,n.id??"",a.id,{x:ie-1,y:r.y})}}else if(r.x>=ie){const o=Fi(e,kt.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=Mn(o);fa(e,n.id??"",a.id,{x:0,y:r.y})}}else if(r.y<0){const o=Fi(e,kt.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=Mn(o);fa(e,n.id??"",a.id,{x:r.x,y:Je-1})}}else if(r.y>=Je){const o=Fi(e,kt.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=Mn(o);fa(e,n.id??"",a.id,{x:r.x,y:0})}}}else Ea(i,n,"thud",void 0);if(n.kind==="player")Ea(n,i,"touch",n.id);else if(n.collision===Gt.ISBULLET){const o=Ts(n.party),a=Ts(i.id);o!==a?Ea(n,i,"shot",n.party):Ea(i,n,"thud",void 0)}else Ea(n,i,"bump",void 0);const s=Di(e,i);return i.destructible??(s==null?void 0:s.destructible)?(E(i==null?void 0:i.id)?pi(v.book,v.board,i,v.timestamp):bi(t,{x:r.x,y:r.y}),!0):!1}return!0}function gb(e,t,n,r,i=Jw){var h;if(!E(e)||!E(t)||!E(n))return;const s={...v};v.book=e,v.board=t,v.element=n,v.elementid=n.id??"",v.elementisplayer=Ts(v.elementid);const o=v.element.player??ke.operator;v.elementfocus=v.elementisplayer?v.elementid:o;const a=Di(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Bt(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Dn.tick(u,ji.RUNTIME,Mt(c)?c:i,l,r),Mt(n==null?void 0:n.tickertime)&&v.timestamp-n.tickertime>Ia*5&&(n.tickertime=0,n.tickertext=""),v.elementisplayer){const f=ws(v.elementid);Mt(f.inputcurrent)&&(f.inputcurrent=0)}Gr(s).forEach(f=>{v[f]=s[f]})}function SM(e,t){ke.loaders.set(e,t)}function RM(e){Dn.halt(e)}function IM(){const e=Dn.ids();for(let n=0;n<e.length;++n)Dn.halt(e[n]);const t=Te("main");E(t)&&(t.flags={})}function OM(){const e=Te("main");if(!E(e))return;const t=e.timestamp+1,n=ei.HALT_AT_COUNT;ei.HALT_AT_COUNT=n*2,ke.loaders.forEach((i,s)=>{const o={...v};v.timestamp=e.timestamp,v.book=e,v.board=void 0,v.element=void 0,v.elementid=s,v.elementisplayer=!1,v.elementfocus=ke.operator;const a=qL(s);E(a)&&Dn.arg(s,a),Dn.tick(s,ji.LOADER,1,"loader",i),Dn.isended(s)&&(Dn.halt(s),ke.loaders.delete(s)),Gr(o).forEach(c=>{v[c]=o[c]})}),ei.HALT_AT_COUNT=n,e.timestamp=t,v.timestamp=t;const r=$f(e);for(let i=0;i<r.length;++i){const s=r[i],o=TL(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:u,code:l,object:h}=o[a];u===kt.ERROR?Dn.halt(c):gb(e,s,h,l)}}}function fd(e,t){const n=Te("main");if(!E(n))return;function r(a,c){for(let u=0;u<a.length;++u){const l=a[u];if(E(l.id)){const h=`${ab(l.id)}:${c}`;H.emit(h,t)}}}const{target:i,path:s}=xs(e),o=$f(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Bt(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(Mm(c,[i]),s);break}}}}function NM(e,t=""){var s;const n=$n("main");if(!E(n))return;const r=`${e}_cli`;v.timestamp=n.timestamp,v.book=n,v.board=ys(n,e),v.element=Rn(v.board,e),v.elementid=((s=v.element)==null?void 0:s.id)??"",v.elementisplayer=!0,v.elementfocus=v.elementid||e;const i=ei.HALT_AT_COUNT;ei.HALT_AT_COUNT=i*8,$d(H,"running",n.timestamp,r,t),Dn.once(r,ji.CLI,"cli",t),ei.HALT_AT_COUNT=i}function Dl(e){var o;const t=$n("main"),n=Zs(t,e);if(!E(t)||!E(n)||!E(v.element))return;const r=`${e}_run`,i=Bt(v.element.name??((o=v.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";Dn.once(r,ji.RUNTIME,i,s)}function CM(e){const t=Te("main"),n=ys(t,e),r=[];if(!E(t)||!E(n))return r;const i=Qs(t,n.over??""),s=Qs(t,n.under??""),o=[i,n,s];let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=dM(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}function Qe(e){var r,i,s,o,a;const t=v.words[e],n=e+1;if(L1(t)){const[c,u]=Al(e);if(E(c))return[c,u]}if(zL(t)){const[c,u]=U1(e);if(E(c))return[c,u]}if(yh(t)){const[c,u]=bc(e);if(E(c))return[c,u]}if(At(t)&&Bt(t)==="rnd"){const[c,u]=Qe(n),[l,h]=Qe(u);return Mt(c)&&Mt(l)?[Oi(c,l),h]:Mt(c)?[Oi(0,c),u]:[Oi(0,1),n]}if(_b(t)){const[c,u]=pd(e);if(E(c))return[c,u]}if(!E(t))return[void 0,e];if(Mt(t)||re(t))return[t,n];if(At(t)){const c=Bt(t),u=(r=v.get)==null?void 0:r.call(v,t);if(E(u))return[u,n];switch(c){case"aligned":case"alligned":{const l=Ec(v.board,v.element,v.elementfocus);return!E(v.element)||!E(l)?[0,n]:[v.element.x===l.x||v.element.y===l.y?1:0,n]}case"contact":{const l=Ec(v.board,v.element,v.elementfocus);if(!E(v.element)||!E(l))return[0,n];const h=(l.x??0)-(((i=v.element)==null?void 0:i.x)??0),f=(l.y??0)-(((s=v.element)==null?void 0:s.y)??0);return[h===0&&Math.abs(f)<2||f===0&&Math.abs(h)<2?1:0,n]}case"blocked":{const[l,h]=it(v.words,n,[V.DIR]);return[bL(v.book,v.board,v.element,l)?1:0,h]}case"any":{const[l,h]=it(v.words,n,[V.KIND]),f=wc(l)??"",d=jo(v.board,f);return[Lm(d,l).length?1:0,h]}case"rnd":return[Oi(0,1),n];case"abs":{const[l,h]=it(v.words,n,[V.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=it(v.words,n,[V.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=it(v.words,n,[V.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=it(v.words,n,[V.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,f,d]=it(v.words,n,[V.NUMBER,V.NUMBER,V.NUMBER]);return[Ln(l,h,f),d]}case"min":{const l=[];for(let h=n;h<v.words.length;){const[f,d]=Qe(h);re(f)&&!dr(f)&&!Fr(f)&&!gi(f)&&!bn(f)&&l.push(...f),h=d,l.push(f)}return[Math.min(...l),v.words.length]}case"max":{const l=[];for(let h=n;h<v.words.length;){const[f,d]=Qe(h);re(f)&&!dr(f)&&!Fr(f)&&!gi(f)&&!bn(f)&&l.push(...f),h=d,l.push(f)}return[Math.max(...l),v.words.length]}case"pick":{const l=[];for(let h=n;h<v.words.length;){const[f,d]=Qe(h);re(f)&&!dr(f)&&!Fr(f)&&!gi(f)&&!bn(f)&&l.push(...f),h=d,l.push(f)}return[Mn(l),v.words.length]}case"pickwith":{const l=[],[h,f]=it(v.words,n,[V.NUMBER_OR_STRING]);for(let d=f;d<v.words.length;){const[p,g]=Qe(d);re(p)&&!dr(p)&&!Fr(p)&&!gi(p)&&!bn(p)&&l.push(...p),d=g,l.push(p)}return[bm(`${h}`,l),v.words.length]}case"random":{const[l,h,f]=it(v.words,n,[V.NUMBER,V.MAYBE_NUMBER]);return[Oi(l,h??0),f]}case"randomwith":{const[l,h,f,d]=it(v.words,n,[V.NUMBER_OR_STRING,V.NUMBER,V.MAYBE_NUMBER]);return[ym(`${l}`,h,f??0),d]}case"run":{const[l,h]=it(v.words,n,[V.NAME]);return Dl(l),[(o=v.get)==null?void 0:o.call(v,"arg"),h]}case"runwith":{const[l,h,f]=it(v.words,n,[V.ANY,V.NAME]);return E(v.element)&&(v.element.arg=l),Dl(h),[(a=v.get)==null?void 0:a.call(v,"arg"),f]}}}return[t,n]}function ao(e){return E(e)&&E(e.x)&&E(e.y)}function He(e,t){switch(t){case _t.NORTH:--e.y;break;case _t.SOUTH:++e.y;break;case _t.WEST:--e.x;break;case _t.EAST:++e.x;break}return e}function Gi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return _t.WEST;if(n>0)return _t.EAST;if(r<0)return _t.NORTH;if(r>0)return _t.SOUTH}const dd={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function dr(e){return re(e)&&yb(e[0])}function yb(e){return E(_t[e])&&At(e)}function LM(e){const t=_t[e];return E(t)?t:_t.IDLE}function _b(e){if(At(e))return dd[Bt(e)]}function bb(e){if(dr(e))return e;if(yb(e))return[e];const t=_b(e);if(E(t))return[t]}function wb(e){const t=v.words[e],n=bb(t);if(dr(n))return[n,e+1];const[r,i]=Qe(e),s=bb(r);return dr(s)?[s,i]:[void 0,e]}function pd(e){const t=[];let[n,r]=wb(e);for(;dr(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=it(v.words,r,[V.NUMBER,V.NUMBER]);t.push(o,a),r=c}const[i,s]=wb(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function MM(){return new Array(ie*Je).map(()=>{})}function UM(e=tu){const t={terrain:MM(),objects:{},id:""};return e(t)}var md=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e))(md||{});function PM(e){return Ks(e,md,{terrain:t=>t.map(Rc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Rc),id:Ce,named:Ce,lookup:Ce,codepage:Ce})}function BM(e){return Go(e,md,{terrain:t=>t.map(Ic),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Ic(t[r]);E(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function jr(e,t){return!E(e)||!E(t==null?void 0:t.x)||!E(t==null?void 0:t.y)||t.x<0||t.x>=ie||t.y<0||t.y>=Je?-1:t.x+t.y*ie}function zr(e,t){const n=jr(e,t);if(n<0||!E(e==null?void 0:e.lookup))return;const r=Rn(e,e.lookup[n]??"");return E(r)?r:e.terrain[n]}function FM(e,t){const n=Rn(e,t);if(E(n))return n;const r=parseFloat(t),i=Ov(isNaN(r)?-1:r,ie);return Eb(e,i.x,i.y)}function Eb(e,t,n){return(t>=0&&t<ie)??(n>=0&&n<Je)?e==null?void 0:e.terrain[t+n*ie]:void 0}function bi(e,t){if(!E(e)||!E(t)||!E(t.x)||!E(t.y)||t.x<0||t.x>=ie||t.y<0||t.y>=Je)return;const n=pr(t),r=t.x+t.y*ie;return e.terrain[r]=n,e.terrain[r]}function gd(e,t){if(!E(e)||!E(t))return;const n=pr(t);return n.id=n.id??Ie(),e.objects[n.id]=n,e.objects[n.id]}function DM(e,t,n){return bi(e,{...t,kind:n})}function yd(e,t,n,r){return gd(e,{...t,kind:n,id:r})}function Rn(e,t){if(e)return e.objects[t]}function _d(e,t,n,r,i){if(!E(e)||!E(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=Gi(o,s),c=ie-1,u=Je-1;for(let l=0;l<r.length;++l){const h=LM(r[l]);switch(h){case _t.IDLE:break;case _t.NORTH:case _t.SOUTH:case _t.WEST:case _t.EAST:He(s,h);break;case _t.BY:{const[f,d]=r.slice(l+1);Mt(f)&&Mt(d)&&(s.x=Ln(s.x+f,0,c),s.y=Ln(s.y+d,0,u)),l+=2;break}case _t.AT:{const[f,d]=r.slice(l+1);Mt(f)&&Mt(d)&&(s.x=Ln(f,0,c),s.y=Ln(d,0,u)),l+=2;break}case _t.FLOW:He(s,a);break;case _t.SEEK:{const f=$M(e,t,n);ao(f)&&He(s,Gi(i,f));break}case _t.RNDNS:He(s,Mn(_t.NORTH,_t.SOUTH));break;case _t.RNDNE:He(s,Mn(_t.NORTH,_t.EAST));break;case _t.RND:He(s,Mn(_t.NORTH,_t.SOUTH,_t.WEST,_t.EAST));break;case _t.CW:case _t.CCW:case _t.OPP:case _t.RNDP:{const f=_d(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case _t.CW:switch(Gi(i,f)){case _t.NORTH:He(s,_t.EAST);break;case _t.SOUTH:He(s,_t.WEST);break;case _t.EAST:He(s,_t.SOUTH);break;case _t.WEST:He(s,_t.NORTH);break}break;case _t.CCW:switch(Gi(i,f)){case _t.NORTH:He(s,_t.WEST);break;case _t.SOUTH:He(s,_t.EAST);break;case _t.EAST:He(s,_t.NORTH);break;case _t.WEST:He(s,_t.SOUTH);break}break;case _t.OPP:switch(Gi(i,f)){case _t.NORTH:He(s,_t.SOUTH);break;case _t.SOUTH:He(s,_t.NORTH);break;case _t.EAST:He(s,_t.WEST);break;case _t.WEST:He(s,_t.EAST);break}break;case _t.RNDP:switch(Gi(i,f)){case _t.NORTH:case _t.SOUTH:s.x+=Mn(-1,1);break;case _t.WEST:case _t.EAST:s.y+=Mn(-1,1);break}break}break}}}return s}function kb(e,t){return E(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function $M(e,t,n){if(!E(e)||!E(t))return;const r=e.objects[n];if(E(r))return r;if(ao(t))return Um(t,jo(e,"player"))}const v={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var V=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(V||{});function Fe(e,t,n){throw console.info(n,v.element,v.elementid,v.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function it(e,t,n){var o,a,c,u;const r=v.words;v.words=e;const i=[];let s=t;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,f]=Al(s);Fr(h)||Fe("terrain or object",h,e),s=f,i.push(h);break}case 1:{const[h,f]=U1(s);gi(h)||Fe("solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 2:{const[h,f]=bc(s);bn(h)||Fe("color",h,e),s=f,i.push(h);break}case 3:{const[h,f]=Om(s);js(h)?(s=f,i.push(h)):Fe("kind",h,e);break}case 4:{const[h,f]=pd(s);if(dr(h)){const d={x:((o=v.element)==null?void 0:o.x)??0,y:((a=v.element)==null?void 0:a.y)??0},p=E(v.board)&&E(v.element)?_d(v.board,v.element,v.elementfocus,h,d):d;s=f,i.push(p)}else Fe("direction",h,e);break}case 5:{const h=v.words[s];At(h)||Fe("string",h,e),++s,i.push(h);break}case 6:{const[h,f]=Qe(s);if(At(h)){const d=parseFloat(h);Mt(d)?i.push(d):Fe("number",h,e)}else Mt(h)?i.push(h):Fe("number",h,e);s=f;break}case 7:{const[h,f]=Qe(s);At(h)||Fe("string",h,e),s=f,i.push(h);break}case 8:{const[h,f]=Qe(s);let d=h;if(At(d)){const p=parseFloat(d);Mt(p)&&(d=p)}else Mt(d)||Fe("number or string",d,e);s=f,i.push(d);break}case 9:{const[h,f]=Al(s);h!==void 0&&!Fr(h)&&Fe("optional terrain or object",h,e),s=f,i.push(h);break}case 10:{const[h,f]=Al(s);h!==void 0&&!gi(h)&&Fe("optional solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 11:{const[h,f]=bc(s);h!==void 0&&!bn(h)&&Fe("optional color",h,e),s=f,i.push(h);break}case 12:{const[h,f]=Om(s);h!==void 0&&!js(h)&&Fe("optional kind",h,e),s=f,i.push(h);break}case 13:{const[h,f]=pd(s);if(dr(h)){const d=((c=v.element)==null?void 0:c.x)??0,p=((u=v.element)==null?void 0:u.y)??0,g={x:d,y:p},k=v.board?_d(v.board,v.element,v.elementfocus,h,g):g;s=f,i.push(k)}else h===void 0?(s=f,i.push(void 0)):Fe("optional direction",h,e);break}case 14:{const h=v.words[s];h!==void 0&&!At(h)&&Fe("optional string",h,e),++s,i.push(h);break}case 15:{const[h,f]=Qe(s);if(At(h)){const d=parseFloat(h);Mt(d)?i.push(d):Fe("optional number",h,e)}else Mt(h)||h===void 0?i.push(h):Fe("optional number",h,e);s=f;break}case 16:{const[h,f]=Qe(s);h!==void 0&&!At(h)&&Fe("optional string",h,e),s=f,i.push(h);break}case 17:{const[h,f]=Qe(s);let d=h;if(At(d)){const p=parseFloat(d);Mt(p)&&(d=p)}else d!==void 0&&!Mt(d)&&Fe("number or string",d,e);s=f,i.push(d);break}case 18:{const[h,f]=Qe(s);s=f,i.push(h);break}}return v.words=r,[...i,s]}const $l={},co={};function bd(){return{id:Ie(),layers:[],scroll:[],sidebar:[]}}const jM=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),zM=new Set(["tx","text"]),KM={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Tb={};let vb=e=>{let t=Tb[e];return E(t)||(Tb[e]=t=bd()),t};function WM(e){vb=e}function gn(e){return vb(e)}function wd(e){return E($l[e])||($l[e]=[]),$l[e]}function GM(e){const t=gn(e);t.scroll=[]}function HM(e,t,n){Object.values(co).forEach(r=>{if(r[t]!==void 0){const i=km(e.id(),t);Mt(n)&&xv(i,n),At(n)&&Av(i,n)}})}function Kr(e){const t=wd(e);return $l[e]=[],t}function ce(e,t){wd(e).push(t)}function Zt(e,t,n,r,i=()=>0,s=tu){const o=[t,n,...r],a=Bt(`${o[3]}`),c={...v};function u(l,h){E(h)&&h!==i(l)&&(v.board=c.board,v.element=c.element,v.elementfocus=c.elementfocus,s(l,h))}if(jM.has(a)){const l=`${o[2]}`;co[t]=co[t]??{};const h=i(l)??KM[a];if(co[t][l]===void 0){const f=km(t,l);Mt(h)&&vv(f,h),At(h)&&lh(f,h),zM.has(a)?co[t][l]=im(f,d=>{u(l,d)}):co[t][l]=Sv(f,d=>{u(l,d)})}}wd(e).push(o)}WM(e=>{if(Ts(e)){const t=Te(Kt.MAIN),n=di(t,Kt.GADGETSTORE);let r=n[e];return E(r)||(n[e]=r=bd()),r}return bd()});const Ed=As("gadgetserver",["tock"],e=>{if(!Ed.session(e))return;const t=Te(Kt.MAIN),n=(t==null?void 0:t.activelist)??[],r=di(t,Kt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=gn(s);o.layers=CM(s);const a=r[s]??{},c=Pd(a,o);c.length&&(r[s]=pr(o),Aw(Ed,c,s))}break;case"desync":e.player&&xw(Ed,gn(e.player),e.player);break;case"clearscroll":e.player&&GM(e.player);break;case"clearplayer":if(e.player){const i=Te(Kt.MAIN),s=di(i,Kt.GADGETSTORE);delete s[e.player];const o=di(i,Kt.GADGETSYNC);delete o[e.player]}break}});function jl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xb={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof jl=="function"&&jl;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[u]={exports:{}};r[u][0].call(d.exports,function(p){var g=r[u][1][p];return o(g||p)},d,d.exports,n,r,i,s)}return i[u].exports}for(var a=typeof jl=="function"&&jl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,f,d,p,g,k=[],w=0,T=c.length,A=T,O=s.getTypeOf(c)!=="string";w<c.length;)A=T-w,h=O?(u=c[w++],l=w<T?c[w++]:0,w<T?c[w++]:0):(u=c.charCodeAt(w++),l=w<T?c.charCodeAt(w++):0,w<T?c.charCodeAt(w++):0),f=u>>2,d=(3&u)<<4|l>>4,p=1<A?(15&l)<<2|h>>6:64,g=2<A?63&h:64,k.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(g));return k.join("")},i.decode=function(c){var u,l,h,f,d,p,g=0,k=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|A):new Array(0|A);g<c.length;)u=a.indexOf(c.charAt(g++))<<2|(f=a.indexOf(c.charAt(g++)))>>4,l=(15&f)<<4|(d=a.indexOf(c.charAt(g++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(g++))),T[k++]=u,d!==64&&(T[k++]=l),p!==64&&(T[k++]=h);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,f,d,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,f){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var g=f;g<p;g++)u=u>>>8^d[255&(u^l[g])];return-1^u}(0|c,a,a.length,0):function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var g=f;g<p;g++)u=u>>>8^d[255&(u^l.charCodeAt(g))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var g,k="";for(g=0;g<p;g++)k+=String.fromCharCode(255&d),d>>>=8;return k}function o(d,p,g,k,w,T){var A,O,P=d.file,L=d.compression,C=T!==u.utf8encode,W=a.transformTo("string",T(P.name)),M=a.transformTo("string",u.utf8encode(P.name)),et=P.comment,pt=a.transformTo("string",T(et)),U=a.transformTo("string",u.utf8encode(et)),S=M.length!==P.name.length,_=U.length!==et.length,B="",X="",j="",ht=P.dir,Q=P.date,ut={crc32:0,compressedSize:0,uncompressedSize:0};p&&!g||(ut.crc32=d.crc32,ut.compressedSize=d.compressedSize,ut.uncompressedSize=d.uncompressedSize);var G=0;p&&(G|=8),C||!S&&!_||(G|=2048);var $=0,yt=0;ht&&($|=16),w==="UNIX"?(yt=798,$|=function(at,Ut){var Wt=at;return at||(Wt=Ut?16893:33204),(65535&Wt)<<16}(P.unixPermissions,ht)):(yt=20,$|=function(at){return 63&(at||0)}(P.dosPermissions)),A=Q.getUTCHours(),A<<=6,A|=Q.getUTCMinutes(),A<<=5,A|=Q.getUTCSeconds()/2,O=Q.getUTCFullYear()-1980,O<<=4,O|=Q.getUTCMonth()+1,O<<=5,O|=Q.getUTCDate(),S&&(X=s(1,1)+s(l(W),4)+M,B+="up"+s(X.length,2)+X),_&&(j=s(1,1)+s(l(pt),4)+U,B+="uc"+s(j.length,2)+j);var st="";return st+=`
\0`,st+=s(G,2),st+=L.magic,st+=s(A,2),st+=s(O,2),st+=s(ut.crc32,4),st+=s(ut.compressedSize,4),st+=s(ut.uncompressedSize,4),st+=s(W.length,2),st+=s(B.length,2),{fileRecord:h.LOCAL_FILE_HEADER+st+W+B,dirRecord:h.CENTRAL_FILE_HEADER+s(yt,2)+st+s(pt.length,2)+"\0\0\0\0"+s($,4)+s(k,4)+W+B+pt}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function f(d,p,g,k){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=g,this.encodeFileName=k,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,g=this.entriesCount,k=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:g?(p+100*(g-k-1))/g:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var g=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,g=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),p)this.push({data:function(k){return h.DATA_DESCRIPTOR+s(k.crc32,4)+s(k.compressedSize,4)+s(k.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var g=this.bytesWritten-d,k=function(w,T,A,O,P){var L=a.transformTo("string",P(O));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(T,4)+s(A,4)+s(L.length,2)+L}(this.dirRecords.length,g,d,this.zipComment,this.encodeFileName);this.push({data:k,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(g){p.processChunk(g)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(g){p.error(g)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var g=0;g<p.length;g++)try{p[g].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=function(T,A){var O=T||A,P=s[O];if(!P)throw new Error(O+" is not a valid compression method !");return P}(d.options.compression,c.compression),g=d.options.compressionOptions||c.compressionOptions||{},k=d.dir,w=d.date;d._compressWorker(p,g).withStreamInfo("file",{name:f,dir:k,date:w,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(f){l.error(f)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var g=f.decompressed.getContentWorker().pipe(new u);g.on("error",function(k){p(k)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(g){var k=new c(d);return k.load(g),k}).then(function(g){var k=[o.Promise.resolve(g)],w=g.files;if(d.checkCRC32)for(var T=0;T<w.length;T++)k.push(h(w[T]));return o.Promise.all(k)}).then(function(g){for(var k=g.shift(),w=k.files,T=0;T<w.length;T++){var A=w[T],O=A.fileNameStr,P=s.resolve(A.fileNameStr);p.file(P,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:d.createFolders}),A.dir||(p.file(P).unsafeOriginalName=O)}return k.zipComment.length&&(p.comment=k.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,f){l.push(h)||l._helper.pause(),u&&u(f)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof tn<"u",newBufferFrom:function(s,o){if(tn.from&&tn.from!==Uint8Array.from)return tn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new tn(s,o)},allocBuffer:function(s){if(tn.alloc)return tn.alloc(s);var o=new tn(s);return o.fill(0),o},isBuffer:function(s){return tn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(P,L,C){var W,M=a.getTypeOf(L),et=a.extend(C||{},l);et.date=et.date||new Date,et.compression!==null&&(et.compression=et.compression.toUpperCase()),typeof et.unixPermissions=="string"&&(et.unixPermissions=parseInt(et.unixPermissions,8)),et.unixPermissions&&16384&et.unixPermissions&&(et.dir=!0),et.dosPermissions&&16&et.dosPermissions&&(et.dir=!0),et.dir&&(P=w(P)),et.createFolders&&(W=k(P))&&T.call(this,W,!0);var pt=M==="string"&&et.binary===!1&&et.base64===!1;C&&C.binary!==void 0||(et.binary=!pt),(L instanceof h&&L.uncompressedSize===0||et.dir||!L||L.length===0)&&(et.base64=!1,et.binary=!0,L="",et.compression="STORE",M="string");var U=null;U=L instanceof h||L instanceof c?L:p.isNode&&p.isStream(L)?new g(P,L):a.prepareContent(P,L,et.binary,et.optimizedBinaryString,et.base64);var S=new f(P,U,et);this.files[P]=S}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),g=n("./nodejs/NodejsStreamInputAdapter"),k=function(P){P.slice(-1)==="/"&&(P=P.substring(0,P.length-1));var L=P.lastIndexOf("/");return 0<L?P.substring(0,L):""},w=function(P){return P.slice(-1)!=="/"&&(P+="/"),P},T=function(P,L){return L=L!==void 0?L:l.createFolders,P=w(P),this.files[P]||s.call(this,P,null,{dir:!0,createFolders:L}),this.files[P]};function A(P){return Object.prototype.toString.call(P)==="[object RegExp]"}var O={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(P){var L,C,W;for(L in this.files)W=this.files[L],(C=L.slice(this.root.length,L.length))&&L.slice(0,this.root.length)===this.root&&P(C,W)},filter:function(P){var L=[];return this.forEach(function(C,W){P(C,W)&&L.push(W)}),L},file:function(P,L,C){if(arguments.length!==1)return P=this.root+P,s.call(this,P,L,C),this;if(A(P)){var W=P;return this.filter(function(et,pt){return!pt.dir&&W.test(et)})}var M=this.files[this.root+P];return M&&!M.dir?M:null},folder:function(P){if(!P)return this;if(A(P))return this.filter(function(M,et){return et.dir&&P.test(M)});var L=this.root+P,C=T.call(this,L),W=this.clone();return W.root=C.name,W},remove:function(P){P=this.root+P;var L=this.files[P];if(L||(P.slice(-1)!=="/"&&(P+="/"),L=this.files[P]),L&&!L.dir)delete this.files[P];else for(var C=this.filter(function(M,et){return et.name.slice(0,P.length)===P}),W=0;W<C.length;W++)delete this.files[C[W].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(P){var L,C={};try{if((C=a.extend(P||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var W=C.comment||this.comment||"";L=d.generateWorker(this,C,W)}catch(M){(L=new c("error")).error(M)}return new u(L,C.type||"string",C.mimeType)},generateAsync:function(P,L){return this.generateInternalStream(P).accumulate(L)},generateNodeStream:function(P,L){return(P=P||{}).type||(P.type="nodebuffer"),this.generateInternalStream(P).toNodejsStream(L)}};r.exports=O},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===u&&this.data[f+2]===l&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&u===f[1]&&l===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,g){return new l.Promise(function(k,w){var T=[],A=p._internalType,O=p._outputType,P=p._mimeType;p.on("data",function(L,C){T.push(L),g&&g(C)}).on("error",function(L){T=[],w(L)}).on("end",function(){try{var L=function(C,W,M){switch(C){case"blob":return s.newBlob(s.transformTo("arraybuffer",W),M);case"base64":return c.encode(W);default:return s.transformTo(C,W)}}(O,function(C,W){var M,et=0,pt=null,U=0;for(M=0;M<W.length;M++)U+=W[M].length;switch(C){case"string":return W.join("");case"array":return Array.prototype.concat.apply([],W);case"uint8array":for(pt=new Uint8Array(U),M=0;M<W.length;M++)pt.set(W[M],et),et+=W[M].length;return pt;case"nodebuffer":return tn.concat(W);default:throw new Error("concat : unsupported type '"+C+"'")}}(A,T),P);k(L)}catch(C){w(C)}T=[]}).resume()})}function d(p,g,k){var w=g;switch(g){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=g,this._mimeType=k,s.checkSupport(w),this._worker=p.pipe(new o(w)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,g){var k=this;return p==="data"?this._worker.on(p,function(w){g.call(k,w.data,w.meta)}):this._worker.on(p,function(){s.delay(g,arguments,k)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof tn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(p){var g,k,w,T,A,O=p.length,P=0;for(T=0;T<O;T++)(64512&(k=p.charCodeAt(T)))==55296&&T+1<O&&(64512&(w=p.charCodeAt(T+1)))==56320&&(k=65536+(k-55296<<10)+(w-56320),T++),P+=k<128?1:k<2048?2:k<65536?3:4;for(g=o.uint8array?new Uint8Array(P):new Array(P),T=A=0;A<P;T++)(64512&(k=p.charCodeAt(T)))==55296&&T+1<O&&(64512&(w=p.charCodeAt(T+1)))==56320&&(k=65536+(k-55296<<10)+(w-56320),T++),k<128?g[A++]=k:(k<2048?g[A++]=192|k>>>6:(k<65536?g[A++]=224|k>>>12:(g[A++]=240|k>>>18,g[A++]=128|k>>>12&63),g[A++]=128|k>>>6&63),g[A++]=128|63&k);return g}(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(p){var g,k,w,T,A=p.length,O=new Array(2*A);for(g=k=0;g<A;)if((w=p[g++])<128)O[k++]=w;else if(4<(T=u[w]))O[k++]=65533,g+=T-1;else{for(w&=T===2?31:T===3?15:7;1<T&&g<A;)w=w<<6|63&p[g++],T--;1<T?O[k++]=65533:w<65536?O[k++]=w:(w-=65536,O[k++]=55296|w>>10&1023,O[k++]=56320|1023&w)}return O.length!==k&&(O.subarray?O=O.subarray(0,k):O.length=k),s.applyFromCharCode(O)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var g=p;(p=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),p.set(g,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var k=function(T,A){var O;for((A=A||T.length)>T.length&&(A=T.length),O=A-1;0<=O&&(192&T[O])==128;)O--;return O<0||O===0?A:O+u[T[O]]>A?O:A}(p),w=p;k!==p.length&&(o.uint8array?(w=p.subarray(0,k),this.leftOver=p.subarray(k,p.length)):(w=p.slice(0,k),this.leftOver=p.slice(k,p.length))),this.push({data:i.utf8decode(w),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(g){return g}function l(g,k){for(var w=0;w<g.length;++w)k[w]=255&g.charCodeAt(w);return k}n("setimmediate"),i.newBlob=function(g,k){i.checkSupport("blob");try{return new Blob([g],{type:k})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(g),w.getBlob(k)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(g,k,w){var T=[],A=0,O=g.length;if(O<=w)return String.fromCharCode.apply(null,g);for(;A<O;)k==="array"||k==="nodebuffer"?T.push(String.fromCharCode.apply(null,g.slice(A,Math.min(A+w,O)))):T.push(String.fromCharCode.apply(null,g.subarray(A,Math.min(A+w,O)))),A+=w;return T.join("")},stringifyByChar:function(g){for(var k="",w=0;w<g.length;w++)k+=String.fromCharCode(g[w]);return k},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(g){var k=65536,w=i.getTypeOf(g),T=!0;if(w==="uint8array"?T=h.applyCanBeUsed.uint8array:w==="nodebuffer"&&(T=h.applyCanBeUsed.nodebuffer),T)for(;1<k;)try{return h.stringifyByChunk(g,w,k)}catch{k=Math.floor(k/2)}return h.stringifyByChar(g)}function d(g,k){for(var w=0;w<g.length;w++)k[w]=g[w];return k}i.applyFromCharCode=f;var p={};p.string={string:u,array:function(g){return l(g,new Array(g.length))},arraybuffer:function(g){return p.string.uint8array(g).buffer},uint8array:function(g){return l(g,new Uint8Array(g.length))},nodebuffer:function(g){return l(g,a.allocBuffer(g.length))}},p.array={string:f,array:u,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},p.arraybuffer={string:function(g){return f(new Uint8Array(g))},array:function(g){return d(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:u,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},p.uint8array={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:u,nodebuffer:function(g){return a.newBufferFrom(g)}},p.nodebuffer={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return p.nodebuffer.uint8array(g).buffer},uint8array:function(g){return d(g,new Uint8Array(g.length))},nodebuffer:u},i.transformTo=function(g,k){if(k=k||"",!g)return k;i.checkSupport(g);var w=i.getTypeOf(k);return p[w][g](k)},i.resolve=function(g){for(var k=g.split("/"),w=[],T=0;T<k.length;T++){var A=k[T];A==="."||A===""&&T!==0&&T!==k.length-1||(A===".."?w.pop():w.push(A))}return w.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var k,w,T="";for(w=0;w<(g||"").length;w++)T+="\\x"+((k=g.charCodeAt(w))<16?"0":"")+k.toString(16).toUpperCase();return T},i.delay=function(g,k,w){setImmediate(function(){g.apply(w||null,k||[])})},i.inherits=function(g,k){function w(){}w.prototype=k.prototype,g.prototype=new w},i.extend=function(){var g,k,w={};for(g=0;g<arguments.length;g++)for(k in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],k)&&w[k]===void 0&&(w[k]=arguments[g][k]);return w},i.prepareContent=function(g,k,w,T,A){return c.Promise.resolve(k).then(function(O){return s.blob&&(O instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(O))!==-1)&&typeof FileReader<"u"?new c.Promise(function(P,L){var C=new FileReader;C.onload=function(W){P(W.target.result)},C.onerror=function(W){L(W.target.error)},C.readAsArrayBuffer(O)}):O}).then(function(O){var P=i.getTypeOf(O);return P?(P==="arraybuffer"?O=i.transformTo("uint8array",O):P==="string"&&(A?O=o.decode(O):w&&T!==!0&&(O=function(L){return l(L,s.uint8array?new Uint8Array(L.length):new Array(L.length))}(O))),O):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,g;if(d.skip(22),this.fileNameLength=d.readInt(2),g=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(k){for(var w in l)if(Object.prototype.hasOwnProperty.call(l,w)&&l[w].magic===k)return l[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,g,k,w=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<w;)p=d.readInt(2),g=d.readInt(2),k=d.readData(g),this.extraFields[p]={id:p,length:g,value:k};d.setIndex(w)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var g=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var k=this.findExtraFieldUnicodeComment();if(k!==null)this.fileCommentStr=k;else{var w=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,g,k){this.name=p,this.dir=k.dir,this.date=k.date,this.comment=k.comment,this.unixPermissions=k.unixPermissions,this.dosPermissions=k.dosPermissions,this._data=g,this._dataBinary=k.binary,this.options={compression:k.compression,compressionOptions:k.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var g=null,k="string";try{if(!p)throw new Error("No output type specified.");var w=(k=p.toLowerCase())==="string"||k==="text";k!=="binarystring"&&k!=="text"||(k="string"),g=this._decompressWorker();var T=!this._dataBinary;T&&!w&&(g=g.pipe(new c.Utf8EncodeWorker)),!T&&w&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(A){(g=new l("error")).error(A)}return new o(g,k,"")},async:function(p,g){return this.internalStream(p).accumulate(g)},nodeStream:function(p,g){return this.internalStream(p||"nodebuffer").toNodejsStream(g)},_compressWorker:function(p,g){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var k=this._decompressWorker();return this._dataBinary||(k=k.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(k,p,g)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){p(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var g,k;a=!0;for(var w=d.length;w;){for(k=d,d=[],g=-1;++g<w;)k[g]();w=d.length}a=!1}r.exports=function(g){d.push(g)!==1||a||o()}}).call(this,typeof yn<"u"?yn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,w!==o&&g(this,w)}function f(w,T,A){this.promise=w,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function d(w,T,A){s(function(){var O;try{O=T(A)}catch(P){return a.reject(w,P)}O===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,O)})}function p(w){var T=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof T=="function")return function(){T.apply(w,arguments)}}function g(w,T){var A=!1;function O(C){A||(A=!0,a.reject(w,C))}function P(C){A||(A=!0,a.resolve(w,C))}var L=k(function(){T(P,O)});L.status==="error"&&O(L.value)}function k(w,T){var A={};try{A.value=w(T),A.status="success"}catch(O){A.status="error",A.value=O}return A}(r.exports=h).prototype.finally=function(w){if(typeof w!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(w()).then(function(){return A})},function(A){return T.resolve(w()).then(function(){throw A})})},h.prototype.catch=function(w){return this.then(null,w)},h.prototype.then=function(w,T){if(typeof w!="function"&&this.state===u||typeof T!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==l?d(A,this.state===u?w:T,this.outcome):this.queue.push(new f(A,w,T)),A},f.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},f.prototype.otherCallFulfilled=function(w){d(this.promise,this.onFulfilled,w)},f.prototype.callRejected=function(w){a.reject(this.promise,w)},f.prototype.otherCallRejected=function(w){d(this.promise,this.onRejected,w)},a.resolve=function(w,T){var A=k(p,T);if(A.status==="error")return a.reject(w,A.value);var O=A.value;if(O)g(w,O);else{w.state=u,w.outcome=T;for(var P=-1,L=w.queue.length;++P<L;)w.queue[P].callFulfilled(T)}return w},a.reject=function(w,T){w.state=c,w.outcome=T;for(var A=-1,O=w.queue.length;++A<O;)w.queue[A].callRejected(T);return w},h.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},h.reject=function(w){var T=new this(o);return a.reject(T,w)},h.all=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=w.length,O=!1;if(!A)return this.resolve([]);for(var P=new Array(A),L=0,C=-1,W=new this(o);++C<A;)M(w[C],C);return W;function M(et,pt){T.resolve(et).then(function(U){P[pt]=U,++L!==A||O||(O=!0,a.resolve(W,P))},function(U){O||(O=!0,a.reject(W,U))})}},h.race=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=w.length,O=!1;if(!A)return this.resolve([]);for(var P=-1,L=new this(o);++P<A;)C=w[P],T.resolve(C).then(function(W){O||(O=!0,a.resolve(L,W))},function(W){O||(O=!0,a.reject(L,W))});var C;return L}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,f=-1,d=0,p=8;function g(w){if(!(this instanceof g))return new g(w);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},w||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==h)throw new Error(c[A]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var O;if(O=typeof T.dictionary=="string"?a.string2buf(T.dictionary):l.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=s.deflateSetDictionary(this.strm,O))!==h)throw new Error(c[A]);this._dict_set=!0}}function k(w,T){var A=new g(T);if(A.push(w,!0),A.err)throw A.msg||c[A.err];return A.result}g.prototype.push=function(w,T){var A,O,P=this.strm,L=this.options.chunkSize;if(this.ended)return!1;O=T===~~T?T:T===!0?4:0,typeof w=="string"?P.input=a.string2buf(w):l.call(w)==="[object ArrayBuffer]"?P.input=new Uint8Array(w):P.input=w,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new o.Buf8(L),P.next_out=0,P.avail_out=L),(A=s.deflate(P,O))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);P.avail_out!==0&&(P.avail_in!==0||O!==4&&O!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(P.output,P.next_out))):this.onData(o.shrinkBuf(P.output,P.next_out)))}while((0<P.avail_in||P.avail_out===0)&&A!==1);return O===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):O!==2||(this.onEnd(h),!(P.avail_out=0))},g.prototype.onData=function(w){this.chunks.push(w)},g.prototype.onEnd=function(w){w===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=g,i.deflate=k,i.deflateRaw=function(w,T){return(T=T||{}).raw=!0,k(w,T)},i.gzip=function(w,T){return(T=T||{}).gzip=!0,k(w,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(g){if(!(this instanceof d))return new d(g);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},g||{});var k=this.options;k.raw&&0<=k.windowBits&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15)),!(0<=k.windowBits&&k.windowBits<16)||g&&g.windowBits||(k.windowBits+=32),15<k.windowBits&&k.windowBits<48&&!(15&k.windowBits)&&(k.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,k.windowBits);if(w!==c.Z_OK)throw new Error(u[w]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(g,k){var w=new d(k);if(w.push(g,!0),w.err)throw w.msg||u[w.err];return w.result}d.prototype.push=function(g,k){var w,T,A,O,P,L,C=this.strm,W=this.options.chunkSize,M=this.options.dictionary,et=!1;if(this.ended)return!1;T=k===~~k?k:k===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?C.input=a.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?C.input=new Uint8Array(g):C.input=g,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(W),C.next_out=0,C.avail_out=W),(w=s.inflate(C,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&M&&(L=typeof M=="string"?a.string2buf(M):f.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,w=s.inflateSetDictionary(this.strm,L)),w===c.Z_BUF_ERROR&&et===!0&&(w=c.Z_OK,et=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&w!==c.Z_STREAM_END&&(C.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(C.output,C.next_out),O=C.next_out-A,P=a.buf2string(C.output,A),C.next_out=O,C.avail_out=W-O,O&&o.arraySet(C.output,C.output,A,O,0),this.onData(P)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(et=!0)}while((0<C.avail_in||C.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(C.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(g,k){return(k=k||{}).raw=!0,p(g,k)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,f){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),f);else for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){var u,l,h,f,d,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=f=0,l=c.length;u<l;u++)d=c[u],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,u,l,h,f){for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,g,k,w=h.length,T=0;for(g=0;g<w;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<w&&(64512&(p=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),g++),T+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(T),g=k=0;k<T;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<w&&(64512&(p=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),g++),d<128?f[k++]=d:(d<2048?f[k++]=192|d>>>6:(d<65536?f[k++]=224|d>>>12:(f[k++]=240|d>>>18,f[k++]=128|d>>>12&63),f[k++]=128|d>>>6&63),f[k++]=128|63&d);return f},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,g,k,w=f||h.length,T=new Array(2*w);for(d=p=0;d<w;)if((g=h[d++])<128)T[p++]=g;else if(4<(k=c[g]))T[p++]=65533,d+=k-1;else{for(g&=k===2?31:k===3?15:7;1<k&&d<w;)g=g<<6|63&h[d++],k--;1<k?T[p++]=65533:g<65536?T[p++]=g:(g-=65536,T[p++]=55296|g>>10&1023,T[p++]=56320|1023&g)}return l(T,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var f=u;f<h;f++)o=o>>>8^l[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,f=4,d=0,p=-2,g=-1,k=4,w=2,T=8,A=9,O=286,P=30,L=19,C=2*O+1,W=15,M=3,et=258,pt=et+M+1,U=42,S=113,_=1,B=2,X=3,j=4;function ht(b,rt){return b.msg=l[rt],rt}function Q(b){return(b<<1)-(4<b?9:0)}function ut(b){for(var rt=b.length;0<=--rt;)b[rt]=0}function G(b){var rt=b.state,tt=rt.pending;tt>b.avail_out&&(tt=b.avail_out),tt!==0&&(o.arraySet(b.output,rt.pending_buf,rt.pending_out,tt,b.next_out),b.next_out+=tt,rt.pending_out+=tt,b.total_out+=tt,b.avail_out-=tt,rt.pending-=tt,rt.pending===0&&(rt.pending_out=0))}function $(b,rt){a._tr_flush_block(b,0<=b.block_start?b.block_start:-1,b.strstart-b.block_start,rt),b.block_start=b.strstart,G(b.strm)}function yt(b,rt){b.pending_buf[b.pending++]=rt}function st(b,rt){b.pending_buf[b.pending++]=rt>>>8&255,b.pending_buf[b.pending++]=255&rt}function at(b,rt){var tt,N,I=b.max_chain_length,K=b.strstart,ot=b.prev_length,lt=b.nice_match,J=b.strstart>b.w_size-pt?b.strstart-(b.w_size-pt):0,dt=b.window,bt=b.w_mask,ft=b.prev,vt=b.strstart+et,le=dt[K+ot-1],Pt=dt[K+ot];b.prev_length>=b.good_match&&(I>>=2),lt>b.lookahead&&(lt=b.lookahead);do if(dt[(tt=rt)+ot]===Pt&&dt[tt+ot-1]===le&&dt[tt]===dt[K]&&dt[++tt]===dt[K+1]){K+=2,tt++;do;while(dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&dt[++K]===dt[++tt]&&K<vt);if(N=et-(vt-K),K=vt-et,ot<N){if(b.match_start=rt,lt<=(ot=N))break;le=dt[K+ot-1],Pt=dt[K+ot]}}while((rt=ft[rt&bt])>J&&--I!=0);return ot<=b.lookahead?ot:b.lookahead}function Ut(b){var rt,tt,N,I,K,ot,lt,J,dt,bt,ft=b.w_size;do{if(I=b.window_size-b.lookahead-b.strstart,b.strstart>=ft+(ft-pt)){for(o.arraySet(b.window,b.window,ft,ft,0),b.match_start-=ft,b.strstart-=ft,b.block_start-=ft,rt=tt=b.hash_size;N=b.head[--rt],b.head[rt]=ft<=N?N-ft:0,--tt;);for(rt=tt=ft;N=b.prev[--rt],b.prev[rt]=ft<=N?N-ft:0,--tt;);I+=ft}if(b.strm.avail_in===0)break;if(ot=b.strm,lt=b.window,J=b.strstart+b.lookahead,dt=I,bt=void 0,bt=ot.avail_in,dt<bt&&(bt=dt),tt=bt===0?0:(ot.avail_in-=bt,o.arraySet(lt,ot.input,ot.next_in,bt,J),ot.state.wrap===1?ot.adler=c(ot.adler,lt,bt,J):ot.state.wrap===2&&(ot.adler=u(ot.adler,lt,bt,J)),ot.next_in+=bt,ot.total_in+=bt,bt),b.lookahead+=tt,b.lookahead+b.insert>=M)for(K=b.strstart-b.insert,b.ins_h=b.window[K],b.ins_h=(b.ins_h<<b.hash_shift^b.window[K+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[K+M-1])&b.hash_mask,b.prev[K&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=K,K++,b.insert--,!(b.lookahead+b.insert<M)););}while(b.lookahead<pt&&b.strm.avail_in!==0)}function Wt(b,rt){for(var tt,N;;){if(b.lookahead<pt){if(Ut(b),b.lookahead<pt&&rt===h)return _;if(b.lookahead===0)break}if(tt=0,b.lookahead>=M&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+M-1])&b.hash_mask,tt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),tt!==0&&b.strstart-tt<=b.w_size-pt&&(b.match_length=at(b,tt)),b.match_length>=M)if(N=a._tr_tally(b,b.strstart-b.match_start,b.match_length-M),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=M){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+M-1])&b.hash_mask,tt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,--b.match_length!=0;);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else N=a._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(N&&($(b,!1),b.strm.avail_out===0))return _}return b.insert=b.strstart<M-1?b.strstart:M-1,rt===f?($(b,!0),b.strm.avail_out===0?X:j):b.last_lit&&($(b,!1),b.strm.avail_out===0)?_:B}function Ot(b,rt){for(var tt,N,I;;){if(b.lookahead<pt){if(Ut(b),b.lookahead<pt&&rt===h)return _;if(b.lookahead===0)break}if(tt=0,b.lookahead>=M&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+M-1])&b.hash_mask,tt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=M-1,tt!==0&&b.prev_length<b.max_lazy_match&&b.strstart-tt<=b.w_size-pt&&(b.match_length=at(b,tt),b.match_length<=5&&(b.strategy===1||b.match_length===M&&4096<b.strstart-b.match_start)&&(b.match_length=M-1)),b.prev_length>=M&&b.match_length<=b.prev_length){for(I=b.strstart+b.lookahead-M,N=a._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-M),b.lookahead-=b.prev_length-1,b.prev_length-=2;++b.strstart<=I&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+M-1])&b.hash_mask,tt=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),--b.prev_length!=0;);if(b.match_available=0,b.match_length=M-1,b.strstart++,N&&($(b,!1),b.strm.avail_out===0))return _}else if(b.match_available){if((N=a._tr_tally(b,0,b.window[b.strstart-1]))&&$(b,!1),b.strstart++,b.lookahead--,b.strm.avail_out===0)return _}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(N=a._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<M-1?b.strstart:M-1,rt===f?($(b,!0),b.strm.avail_out===0?X:j):b.last_lit&&($(b,!1),b.strm.avail_out===0)?_:B}function Rt(b,rt,tt,N,I){this.good_length=b,this.max_lazy=rt,this.nice_length=tt,this.max_chain=N,this.func=I}function Lt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*P+1)),this.bl_tree=new o.Buf16(2*(2*L+1)),ut(this.dyn_ltree),ut(this.dyn_dtree),ut(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(W+1),this.heap=new o.Buf16(2*O+1),ut(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*O+1),ut(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Nt(b){var rt;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=w,(rt=b.state).pending=0,rt.pending_out=0,rt.wrap<0&&(rt.wrap=-rt.wrap),rt.status=rt.wrap?U:S,b.adler=rt.wrap===2?0:1,rt.last_flush=h,a._tr_init(rt),d):ht(b,p)}function ne(b){var rt=Nt(b);return rt===d&&function(tt){tt.window_size=2*tt.w_size,ut(tt.head),tt.max_lazy_match=s[tt.level].max_lazy,tt.good_match=s[tt.level].good_length,tt.nice_match=s[tt.level].nice_length,tt.max_chain_length=s[tt.level].max_chain,tt.strstart=0,tt.block_start=0,tt.lookahead=0,tt.insert=0,tt.match_length=tt.prev_length=M-1,tt.match_available=0,tt.ins_h=0}(b.state),rt}function Re(b,rt,tt,N,I,K){if(!b)return p;var ot=1;if(rt===g&&(rt=6),N<0?(ot=0,N=-N):15<N&&(ot=2,N-=16),I<1||A<I||tt!==T||N<8||15<N||rt<0||9<rt||K<0||k<K)return ht(b,p);N===8&&(N=9);var lt=new Lt;return(b.state=lt).strm=b,lt.wrap=ot,lt.gzhead=null,lt.w_bits=N,lt.w_size=1<<lt.w_bits,lt.w_mask=lt.w_size-1,lt.hash_bits=I+7,lt.hash_size=1<<lt.hash_bits,lt.hash_mask=lt.hash_size-1,lt.hash_shift=~~((lt.hash_bits+M-1)/M),lt.window=new o.Buf8(2*lt.w_size),lt.head=new o.Buf16(lt.hash_size),lt.prev=new o.Buf16(lt.w_size),lt.lit_bufsize=1<<I+6,lt.pending_buf_size=4*lt.lit_bufsize,lt.pending_buf=new o.Buf8(lt.pending_buf_size),lt.d_buf=1*lt.lit_bufsize,lt.l_buf=3*lt.lit_bufsize,lt.level=rt,lt.strategy=K,lt.method=tt,ne(b)}s=[new Rt(0,0,0,0,function(b,rt){var tt=65535;for(tt>b.pending_buf_size-5&&(tt=b.pending_buf_size-5);;){if(b.lookahead<=1){if(Ut(b),b.lookahead===0&&rt===h)return _;if(b.lookahead===0)break}b.strstart+=b.lookahead,b.lookahead=0;var N=b.block_start+tt;if((b.strstart===0||b.strstart>=N)&&(b.lookahead=b.strstart-N,b.strstart=N,$(b,!1),b.strm.avail_out===0)||b.strstart-b.block_start>=b.w_size-pt&&($(b,!1),b.strm.avail_out===0))return _}return b.insert=0,rt===f?($(b,!0),b.strm.avail_out===0?X:j):(b.strstart>b.block_start&&($(b,!1),b.strm.avail_out),_)}),new Rt(4,4,8,4,Wt),new Rt(4,5,16,8,Wt),new Rt(4,6,32,32,Wt),new Rt(4,4,16,16,Ot),new Rt(8,16,32,32,Ot),new Rt(8,16,128,128,Ot),new Rt(8,32,128,256,Ot),new Rt(32,128,258,1024,Ot),new Rt(32,258,258,4096,Ot)],i.deflateInit=function(b,rt){return Re(b,rt,T,15,8,0)},i.deflateInit2=Re,i.deflateReset=ne,i.deflateResetKeep=Nt,i.deflateSetHeader=function(b,rt){return b&&b.state?b.state.wrap!==2?p:(b.state.gzhead=rt,d):p},i.deflate=function(b,rt){var tt,N,I,K;if(!b||!b.state||5<rt||rt<0)return b?ht(b,p):p;if(N=b.state,!b.output||!b.input&&b.avail_in!==0||N.status===666&&rt!==f)return ht(b,b.avail_out===0?-5:p);if(N.strm=b,tt=N.last_flush,N.last_flush=rt,N.status===U)if(N.wrap===2)b.adler=0,yt(N,31),yt(N,139),yt(N,8),N.gzhead?(yt(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),yt(N,255&N.gzhead.time),yt(N,N.gzhead.time>>8&255),yt(N,N.gzhead.time>>16&255),yt(N,N.gzhead.time>>24&255),yt(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),yt(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(yt(N,255&N.gzhead.extra.length),yt(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(b.adler=u(b.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(yt(N,0),yt(N,0),yt(N,0),yt(N,0),yt(N,0),yt(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),yt(N,3),N.status=S);else{var ot=T+(N.w_bits-8<<4)<<8;ot|=(2<=N.strategy||N.level<2?0:N.level<6?1:N.level===6?2:3)<<6,N.strstart!==0&&(ot|=32),ot+=31-ot%31,N.status=S,st(N,ot),N.strstart!==0&&(st(N,b.adler>>>16),st(N,65535&b.adler)),b.adler=1}if(N.status===69)if(N.gzhead.extra){for(I=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>I&&(b.adler=u(b.adler,N.pending_buf,N.pending-I,I)),G(b),I=N.pending,N.pending!==N.pending_buf_size));)yt(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>I&&(b.adler=u(b.adler,N.pending_buf,N.pending-I,I)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(N.status===73)if(N.gzhead.name){I=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>I&&(b.adler=u(b.adler,N.pending_buf,N.pending-I,I)),G(b),I=N.pending,N.pending===N.pending_buf_size)){K=1;break}K=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,yt(N,K)}while(K!==0);N.gzhead.hcrc&&N.pending>I&&(b.adler=u(b.adler,N.pending_buf,N.pending-I,I)),K===0&&(N.gzindex=0,N.status=91)}else N.status=91;if(N.status===91)if(N.gzhead.comment){I=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>I&&(b.adler=u(b.adler,N.pending_buf,N.pending-I,I)),G(b),I=N.pending,N.pending===N.pending_buf_size)){K=1;break}K=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,yt(N,K)}while(K!==0);N.gzhead.hcrc&&N.pending>I&&(b.adler=u(b.adler,N.pending_buf,N.pending-I,I)),K===0&&(N.status=103)}else N.status=103;if(N.status===103&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&G(b),N.pending+2<=N.pending_buf_size&&(yt(N,255&b.adler),yt(N,b.adler>>8&255),b.adler=0,N.status=S)):N.status=S),N.pending!==0){if(G(b),b.avail_out===0)return N.last_flush=-1,d}else if(b.avail_in===0&&Q(rt)<=Q(tt)&&rt!==f)return ht(b,-5);if(N.status===666&&b.avail_in!==0)return ht(b,-5);if(b.avail_in!==0||N.lookahead!==0||rt!==h&&N.status!==666){var lt=N.strategy===2?function(J,dt){for(var bt;;){if(J.lookahead===0&&(Ut(J),J.lookahead===0)){if(dt===h)return _;break}if(J.match_length=0,bt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,bt&&($(J,!1),J.strm.avail_out===0))return _}return J.insert=0,dt===f?($(J,!0),J.strm.avail_out===0?X:j):J.last_lit&&($(J,!1),J.strm.avail_out===0)?_:B}(N,rt):N.strategy===3?function(J,dt){for(var bt,ft,vt,le,Pt=J.window;;){if(J.lookahead<=et){if(Ut(J),J.lookahead<=et&&dt===h)return _;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=M&&0<J.strstart&&(ft=Pt[vt=J.strstart-1])===Pt[++vt]&&ft===Pt[++vt]&&ft===Pt[++vt]){le=J.strstart+et;do;while(ft===Pt[++vt]&&ft===Pt[++vt]&&ft===Pt[++vt]&&ft===Pt[++vt]&&ft===Pt[++vt]&&ft===Pt[++vt]&&ft===Pt[++vt]&&ft===Pt[++vt]&&vt<le);J.match_length=et-(le-vt),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=M?(bt=a._tr_tally(J,1,J.match_length-M),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(bt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),bt&&($(J,!1),J.strm.avail_out===0))return _}return J.insert=0,dt===f?($(J,!0),J.strm.avail_out===0?X:j):J.last_lit&&($(J,!1),J.strm.avail_out===0)?_:B}(N,rt):s[N.level].func(N,rt);if(lt!==X&&lt!==j||(N.status=666),lt===_||lt===X)return b.avail_out===0&&(N.last_flush=-1),d;if(lt===B&&(rt===1?a._tr_align(N):rt!==5&&(a._tr_stored_block(N,0,0,!1),rt===3&&(ut(N.head),N.lookahead===0&&(N.strstart=0,N.block_start=0,N.insert=0))),G(b),b.avail_out===0))return N.last_flush=-1,d}return rt!==f?d:N.wrap<=0?1:(N.wrap===2?(yt(N,255&b.adler),yt(N,b.adler>>8&255),yt(N,b.adler>>16&255),yt(N,b.adler>>24&255),yt(N,255&b.total_in),yt(N,b.total_in>>8&255),yt(N,b.total_in>>16&255),yt(N,b.total_in>>24&255)):(st(N,b.adler>>>16),st(N,65535&b.adler)),G(b),0<N.wrap&&(N.wrap=-N.wrap),N.pending!==0?d:1)},i.deflateEnd=function(b){var rt;return b&&b.state?(rt=b.state.status)!==U&&rt!==69&&rt!==73&&rt!==91&&rt!==103&&rt!==S&&rt!==666?ht(b,p):(b.state=null,rt===S?ht(b,-3):d):p},i.deflateSetDictionary=function(b,rt){var tt,N,I,K,ot,lt,J,dt,bt=rt.length;if(!b||!b.state||(K=(tt=b.state).wrap)===2||K===1&&tt.status!==U||tt.lookahead)return p;for(K===1&&(b.adler=c(b.adler,rt,bt,0)),tt.wrap=0,bt>=tt.w_size&&(K===0&&(ut(tt.head),tt.strstart=0,tt.block_start=0,tt.insert=0),dt=new o.Buf8(tt.w_size),o.arraySet(dt,rt,bt-tt.w_size,tt.w_size,0),rt=dt,bt=tt.w_size),ot=b.avail_in,lt=b.next_in,J=b.input,b.avail_in=bt,b.next_in=0,b.input=rt,Ut(tt);tt.lookahead>=M;){for(N=tt.strstart,I=tt.lookahead-(M-1);tt.ins_h=(tt.ins_h<<tt.hash_shift^tt.window[N+M-1])&tt.hash_mask,tt.prev[N&tt.w_mask]=tt.head[tt.ins_h],tt.head[tt.ins_h]=N,N++,--I;);tt.strstart=N,tt.lookahead=M-1,Ut(tt)}return tt.strstart+=tt.lookahead,tt.block_start=tt.strstart,tt.insert=tt.lookahead,tt.lookahead=0,tt.match_length=tt.prev_length=M-1,tt.match_available=0,b.next_in=lt,b.input=J,b.avail_in=ot,tt.wrap=K,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,f,d,p,g,k,w,T,A,O,P,L,C,W,M,et,pt,U,S,_,B;a=s.state,c=s.next_in,_=s.input,u=c+(s.avail_in-5),l=s.next_out,B=s.output,h=l-(o-s.avail_out),f=l+(s.avail_out-257),d=a.dmax,p=a.wsize,g=a.whave,k=a.wnext,w=a.window,T=a.hold,A=a.bits,O=a.lencode,P=a.distcode,L=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;t:do{A<15&&(T+=_[c++]<<A,A+=8,T+=_[c++]<<A,A+=8),W=O[T&L];e:for(;;){if(T>>>=M=W>>>24,A-=M,(M=W>>>16&255)===0)B[l++]=65535&W;else{if(!(16&M)){if(!(64&M)){W=O[(65535&W)+(T&(1<<M)-1)];continue e}if(32&M){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}et=65535&W,(M&=15)&&(A<M&&(T+=_[c++]<<A,A+=8),et+=T&(1<<M)-1,T>>>=M,A-=M),A<15&&(T+=_[c++]<<A,A+=8,T+=_[c++]<<A,A+=8),W=P[T&C];n:for(;;){if(T>>>=M=W>>>24,A-=M,!(16&(M=W>>>16&255))){if(!(64&M)){W=P[(65535&W)+(T&(1<<M)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(pt=65535&W,A<(M&=15)&&(T+=_[c++]<<A,(A+=8)<M&&(T+=_[c++]<<A,A+=8)),d<(pt+=T&(1<<M)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=M,A-=M,(M=l-h)<pt){if(g<(M=pt-M)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(S=w,(U=0)===k){if(U+=p-M,M<et){for(et-=M;B[l++]=w[U++],--M;);U=l-pt,S=B}}else if(k<M){if(U+=p+k-M,(M-=k)<et){for(et-=M;B[l++]=w[U++],--M;);if(U=0,k<et){for(et-=M=k;B[l++]=w[U++],--M;);U=l-pt,S=B}}}else if(U+=k-M,M<et){for(et-=M;B[l++]=w[U++],--M;);U=l-pt,S=B}for(;2<et;)B[l++]=S[U++],B[l++]=S[U++],B[l++]=S[U++],et-=3;et&&(B[l++]=S[U++],1<et&&(B[l++]=S[U++]))}else{for(U=l-pt;B[l++]=B[U++],B[l++]=B[U++],B[l++]=B[U++],2<(et-=3););et&&(B[l++]=B[U++],1<et&&(B[l++]=B[U++]))}break}}break}}while(c<u&&l<f);c-=et=A>>3,T&=(1<<(A-=et<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<f?f-l+257:257-(l-f),a.hold=T,a.bits=A}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,f=0,d=-2,p=1,g=852,k=592;function w(U){return(U>>>24&255)+(U>>>8&65280)+((65280&U)<<8)+((255&U)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(U){var S;return U&&U.state?(S=U.state,U.total_in=U.total_out=S.total=0,U.msg="",S.wrap&&(U.adler=1&S.wrap),S.mode=p,S.last=0,S.havedict=0,S.dmax=32768,S.head=null,S.hold=0,S.bits=0,S.lencode=S.lendyn=new s.Buf32(g),S.distcode=S.distdyn=new s.Buf32(k),S.sane=1,S.back=-1,f):d}function O(U){var S;return U&&U.state?((S=U.state).wsize=0,S.whave=0,S.wnext=0,A(U)):d}function P(U,S){var _,B;return U&&U.state?(B=U.state,S<0?(_=0,S=-S):(_=1+(S>>4),S<48&&(S&=15)),S&&(S<8||15<S)?d:(B.window!==null&&B.wbits!==S&&(B.window=null),B.wrap=_,B.wbits=S,O(U))):d}function L(U,S){var _,B;return U?(B=new T,(U.state=B).window=null,(_=P(U,S))!==f&&(U.state=null),_):d}var C,W,M=!0;function et(U){if(M){var S;for(C=new s.Buf32(512),W=new s.Buf32(32),S=0;S<144;)U.lens[S++]=8;for(;S<256;)U.lens[S++]=9;for(;S<280;)U.lens[S++]=7;for(;S<288;)U.lens[S++]=8;for(u(l,U.lens,0,288,C,0,U.work,{bits:9}),S=0;S<32;)U.lens[S++]=5;u(h,U.lens,0,32,W,0,U.work,{bits:5}),M=!1}U.lencode=C,U.lenbits=9,U.distcode=W,U.distbits=5}function pt(U,S,_,B){var X,j=U.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),B>=j.wsize?(s.arraySet(j.window,S,_-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(B<(X=j.wsize-j.wnext)&&(X=B),s.arraySet(j.window,S,_-B,X,j.wnext),(B-=X)?(s.arraySet(j.window,S,_-B,B,0),j.wnext=B,j.whave=j.wsize):(j.wnext+=X,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=X))),0}i.inflateReset=O,i.inflateReset2=P,i.inflateResetKeep=A,i.inflateInit=function(U){return L(U,15)},i.inflateInit2=L,i.inflate=function(U,S){var _,B,X,j,ht,Q,ut,G,$,yt,st,at,Ut,Wt,Ot,Rt,Lt,Nt,ne,Re,b,rt,tt,N,I=0,K=new s.Buf8(4),ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!U||!U.state||!U.output||!U.input&&U.avail_in!==0)return d;(_=U.state).mode===12&&(_.mode=13),ht=U.next_out,X=U.output,ut=U.avail_out,j=U.next_in,B=U.input,Q=U.avail_in,G=_.hold,$=_.bits,yt=Q,st=ut,rt=f;t:for(;;)switch(_.mode){case p:if(_.wrap===0){_.mode=13;break}for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(2&_.wrap&&G===35615){K[_.check=0]=255&G,K[1]=G>>>8&255,_.check=a(_.check,K,2,0),$=G=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&G)<<8)+(G>>8))%31){U.msg="incorrect header check",_.mode=30;break}if((15&G)!=8){U.msg="unknown compression method",_.mode=30;break}if($-=4,b=8+(15&(G>>>=4)),_.wbits===0)_.wbits=b;else if(b>_.wbits){U.msg="invalid window size",_.mode=30;break}_.dmax=1<<b,U.adler=_.check=1,_.mode=512&G?10:12,$=G=0;break;case 2:for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(_.flags=G,(255&_.flags)!=8){U.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){U.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=G>>8&1),512&_.flags&&(K[0]=255&G,K[1]=G>>>8&255,_.check=a(_.check,K,2,0)),$=G=0,_.mode=3;case 3:for(;$<32;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.head&&(_.head.time=G),512&_.flags&&(K[0]=255&G,K[1]=G>>>8&255,K[2]=G>>>16&255,K[3]=G>>>24&255,_.check=a(_.check,K,4,0)),$=G=0,_.mode=4;case 4:for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.head&&(_.head.xflags=255&G,_.head.os=G>>8),512&_.flags&&(K[0]=255&G,K[1]=G>>>8&255,_.check=a(_.check,K,2,0)),$=G=0,_.mode=5;case 5:if(1024&_.flags){for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.length=G,_.head&&(_.head.extra_len=G),512&_.flags&&(K[0]=255&G,K[1]=G>>>8&255,_.check=a(_.check,K,2,0)),$=G=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(Q<(at=_.length)&&(at=Q),at&&(_.head&&(b=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,B,j,at,b)),512&_.flags&&(_.check=a(_.check,B,at,j)),Q-=at,j+=at,_.length-=at),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(Q===0)break t;for(at=0;b=B[j+at++],_.head&&b&&_.length<65536&&(_.head.name+=String.fromCharCode(b)),b&&at<Q;);if(512&_.flags&&(_.check=a(_.check,B,at,j)),Q-=at,j+=at,b)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(Q===0)break t;for(at=0;b=B[j+at++],_.head&&b&&_.length<65536&&(_.head.comment+=String.fromCharCode(b)),b&&at<Q;);if(512&_.flags&&(_.check=a(_.check,B,at,j)),Q-=at,j+=at,b)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;$<16;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(G!==(65535&_.check)){U.msg="header crc mismatch",_.mode=30;break}$=G=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),U.adler=_.check=0,_.mode=12;break;case 10:for(;$<32;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}U.adler=_.check=w(G),$=G=0,_.mode=11;case 11:if(_.havedict===0)return U.next_out=ht,U.avail_out=ut,U.next_in=j,U.avail_in=Q,_.hold=G,_.bits=$,2;U.adler=_.check=1,_.mode=12;case 12:if(S===5||S===6)break t;case 13:if(_.last){G>>>=7&$,$-=7&$,_.mode=27;break}for(;$<3;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}switch(_.last=1&G,$-=1,3&(G>>>=1)){case 0:_.mode=14;break;case 1:if(et(_),_.mode=20,S!==6)break;G>>>=2,$-=2;break t;case 2:_.mode=17;break;case 3:U.msg="invalid block type",_.mode=30}G>>>=2,$-=2;break;case 14:for(G>>>=7&$,$-=7&$;$<32;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if((65535&G)!=(G>>>16^65535)){U.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&G,$=G=0,_.mode=15,S===6)break t;case 15:_.mode=16;case 16:if(at=_.length){if(Q<at&&(at=Q),ut<at&&(at=ut),at===0)break t;s.arraySet(X,B,j,at,ht),Q-=at,j+=at,ut-=at,ht+=at,_.length-=at;break}_.mode=12;break;case 17:for(;$<14;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(_.nlen=257+(31&G),G>>>=5,$-=5,_.ndist=1+(31&G),G>>>=5,$-=5,_.ncode=4+(15&G),G>>>=4,$-=4,286<_.nlen||30<_.ndist){U.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;$<3;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.lens[ot[_.have++]]=7&G,G>>>=3,$-=3}for(;_.have<19;)_.lens[ot[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,tt={bits:_.lenbits},rt=u(0,_.lens,0,19,_.lencode,0,_.work,tt),_.lenbits=tt.bits,rt){U.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;Rt=(I=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,Lt=65535&I,!((Ot=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(Lt<16)G>>>=Ot,$-=Ot,_.lens[_.have++]=Lt;else{if(Lt===16){for(N=Ot+2;$<N;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(G>>>=Ot,$-=Ot,_.have===0){U.msg="invalid bit length repeat",_.mode=30;break}b=_.lens[_.have-1],at=3+(3&G),G>>>=2,$-=2}else if(Lt===17){for(N=Ot+3;$<N;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}$-=Ot,b=0,at=3+(7&(G>>>=Ot)),G>>>=3,$-=3}else{for(N=Ot+7;$<N;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}$-=Ot,b=0,at=11+(127&(G>>>=Ot)),G>>>=7,$-=7}if(_.have+at>_.nlen+_.ndist){U.msg="invalid bit length repeat",_.mode=30;break}for(;at--;)_.lens[_.have++]=b}}if(_.mode===30)break;if(_.lens[256]===0){U.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,tt={bits:_.lenbits},rt=u(l,_.lens,0,_.nlen,_.lencode,0,_.work,tt),_.lenbits=tt.bits,rt){U.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,tt={bits:_.distbits},rt=u(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,tt),_.distbits=tt.bits,rt){U.msg="invalid distances set",_.mode=30;break}if(_.mode=20,S===6)break t;case 20:_.mode=21;case 21:if(6<=Q&&258<=ut){U.next_out=ht,U.avail_out=ut,U.next_in=j,U.avail_in=Q,_.hold=G,_.bits=$,c(U,st),ht=U.next_out,X=U.output,ut=U.avail_out,j=U.next_in,B=U.input,Q=U.avail_in,G=_.hold,$=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;Rt=(I=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,Lt=65535&I,!((Ot=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(Rt&&!(240&Rt)){for(Nt=Ot,ne=Rt,Re=Lt;Rt=(I=_.lencode[Re+((G&(1<<Nt+ne)-1)>>Nt)])>>>16&255,Lt=65535&I,!(Nt+(Ot=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}G>>>=Nt,$-=Nt,_.back+=Nt}if(G>>>=Ot,$-=Ot,_.back+=Ot,_.length=Lt,Rt===0){_.mode=26;break}if(32&Rt){_.back=-1,_.mode=12;break}if(64&Rt){U.msg="invalid literal/length code",_.mode=30;break}_.extra=15&Rt,_.mode=22;case 22:if(_.extra){for(N=_.extra;$<N;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.length+=G&(1<<_.extra)-1,G>>>=_.extra,$-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;Rt=(I=_.distcode[G&(1<<_.distbits)-1])>>>16&255,Lt=65535&I,!((Ot=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(!(240&Rt)){for(Nt=Ot,ne=Rt,Re=Lt;Rt=(I=_.distcode[Re+((G&(1<<Nt+ne)-1)>>Nt)])>>>16&255,Lt=65535&I,!(Nt+(Ot=I>>>24)<=$);){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}G>>>=Nt,$-=Nt,_.back+=Nt}if(G>>>=Ot,$-=Ot,_.back+=Ot,64&Rt){U.msg="invalid distance code",_.mode=30;break}_.offset=Lt,_.extra=15&Rt,_.mode=24;case 24:if(_.extra){for(N=_.extra;$<N;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}_.offset+=G&(1<<_.extra)-1,G>>>=_.extra,$-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){U.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ut===0)break t;if(at=st-ut,_.offset>at){if((at=_.offset-at)>_.whave&&_.sane){U.msg="invalid distance too far back",_.mode=30;break}Ut=at>_.wnext?(at-=_.wnext,_.wsize-at):_.wnext-at,at>_.length&&(at=_.length),Wt=_.window}else Wt=X,Ut=ht-_.offset,at=_.length;for(ut<at&&(at=ut),ut-=at,_.length-=at;X[ht++]=Wt[Ut++],--at;);_.length===0&&(_.mode=21);break;case 26:if(ut===0)break t;X[ht++]=_.length,ut--,_.mode=21;break;case 27:if(_.wrap){for(;$<32;){if(Q===0)break t;Q--,G|=B[j++]<<$,$+=8}if(st-=ut,U.total_out+=st,_.total+=st,st&&(U.adler=_.check=_.flags?a(_.check,X,st,ht-st):o(_.check,X,st,ht-st)),st=ut,(_.flags?G:w(G))!==_.check){U.msg="incorrect data check",_.mode=30;break}$=G=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;$<32;){if(Q===0)break t;Q--,G+=B[j++]<<$,$+=8}if(G!==(4294967295&_.total)){U.msg="incorrect length check",_.mode=30;break}$=G=0}_.mode=29;case 29:rt=1;break t;case 30:rt=-3;break t;case 31:return-4;case 32:default:return d}return U.next_out=ht,U.avail_out=ut,U.next_in=j,U.avail_in=Q,_.hold=G,_.bits=$,(_.wsize||st!==U.avail_out&&_.mode<30&&(_.mode<27||S!==4))&&pt(U,U.output,U.next_out,st-U.avail_out)?(_.mode=31,-4):(yt-=U.avail_in,st-=U.avail_out,U.total_in+=yt,U.total_out+=st,_.total+=st,_.wrap&&st&&(U.adler=_.check=_.flags?a(_.check,X,st,U.next_out-st):o(_.check,X,st,U.next_out-st)),U.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(yt==0&&st===0||S===4)&&rt===f&&(rt=-5),rt)},i.inflateEnd=function(U){if(!U||!U.state)return d;var S=U.state;return S.window&&(S.window=null),U.state=null,f},i.inflateGetHeader=function(U,S){var _;return U&&U.state&&2&(_=U.state).wrap?((_.head=S).done=!1,f):d},i.inflateSetDictionary=function(U,S){var _,B=S.length;return U&&U.state?(_=U.state).wrap!==0&&_.mode!==11?d:_.mode===11&&o(1,S,B,0)!==_.check?-3:pt(U,S,B,B)?(_.mode=31,-4):(_.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,f,d,p,g,k,w){var T,A,O,P,L,C,W,M,et,pt=w.bits,U=0,S=0,_=0,B=0,X=0,j=0,ht=0,Q=0,ut=0,G=0,$=null,yt=0,st=new s.Buf16(16),at=new s.Buf16(16),Ut=null,Wt=0;for(U=0;U<=15;U++)st[U]=0;for(S=0;S<d;S++)st[h[f+S]]++;for(X=pt,B=15;1<=B&&st[B]===0;B--);if(B<X&&(X=B),B===0)return p[g++]=20971520,p[g++]=20971520,w.bits=1,0;for(_=1;_<B&&st[_]===0;_++);for(X<_&&(X=_),U=Q=1;U<=15;U++)if(Q<<=1,(Q-=st[U])<0)return-1;if(0<Q&&(l===0||B!==1))return-1;for(at[1]=0,U=1;U<15;U++)at[U+1]=at[U]+st[U];for(S=0;S<d;S++)h[f+S]!==0&&(k[at[h[f+S]]++]=S);if(C=l===0?($=Ut=k,19):l===1?($=o,yt-=257,Ut=a,Wt-=257,256):($=c,Ut=u,-1),U=_,L=g,ht=S=G=0,O=-1,P=(ut=1<<(j=X))-1,l===1&&852<ut||l===2&&592<ut)return 1;for(;;){for(W=U-ht,et=k[S]<C?(M=0,k[S]):k[S]>C?(M=Ut[Wt+k[S]],$[yt+k[S]]):(M=96,0),T=1<<U-ht,_=A=1<<j;p[L+(G>>ht)+(A-=T)]=W<<24|M<<16|et|0,A!==0;);for(T=1<<U-1;G&T;)T>>=1;if(T!==0?(G&=T-1,G+=T):G=0,S++,--st[U]==0){if(U===B)break;U=h[f+k[S]]}if(X<U&&(G&P)!==O){for(ht===0&&(ht=X),L+=_,Q=1<<(j=U-ht);j+ht<B&&!((Q-=st[j+ht])<=0);)j++,Q<<=1;if(ut+=1<<j,l===1&&852<ut||l===2&&592<ut)return 1;p[O=G&P]=X<<24|j<<16|L-g|0}}return G!==0&&(p[L+G]=U-ht<<24|64<<16|0),w.bits=X,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(I){for(var K=I.length;0<=--K;)I[K]=0}var u=0,l=29,h=256,f=h+1+l,d=30,p=19,g=2*f+1,k=15,w=16,T=7,A=256,O=16,P=17,L=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pt=new Array(2*(f+2));c(pt);var U=new Array(2*d);c(U);var S=new Array(512);c(S);var _=new Array(256);c(_);var B=new Array(l);c(B);var X,j,ht,Q=new Array(d);function ut(I,K,ot,lt,J){this.static_tree=I,this.extra_bits=K,this.extra_base=ot,this.elems=lt,this.max_length=J,this.has_stree=I&&I.length}function G(I,K){this.dyn_tree=I,this.max_code=0,this.stat_desc=K}function $(I){return I<256?S[I]:S[256+(I>>>7)]}function yt(I,K){I.pending_buf[I.pending++]=255&K,I.pending_buf[I.pending++]=K>>>8&255}function st(I,K,ot){I.bi_valid>w-ot?(I.bi_buf|=K<<I.bi_valid&65535,yt(I,I.bi_buf),I.bi_buf=K>>w-I.bi_valid,I.bi_valid+=ot-w):(I.bi_buf|=K<<I.bi_valid&65535,I.bi_valid+=ot)}function at(I,K,ot){st(I,ot[2*K],ot[2*K+1])}function Ut(I,K){for(var ot=0;ot|=1&I,I>>>=1,ot<<=1,0<--K;);return ot>>>1}function Wt(I,K,ot){var lt,J,dt=new Array(k+1),bt=0;for(lt=1;lt<=k;lt++)dt[lt]=bt=bt+ot[lt-1]<<1;for(J=0;J<=K;J++){var ft=I[2*J+1];ft!==0&&(I[2*J]=Ut(dt[ft]++,ft))}}function Ot(I){var K;for(K=0;K<f;K++)I.dyn_ltree[2*K]=0;for(K=0;K<d;K++)I.dyn_dtree[2*K]=0;for(K=0;K<p;K++)I.bl_tree[2*K]=0;I.dyn_ltree[2*A]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0}function Rt(I){8<I.bi_valid?yt(I,I.bi_buf):0<I.bi_valid&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0}function Lt(I,K,ot,lt){var J=2*K,dt=2*ot;return I[J]<I[dt]||I[J]===I[dt]&&lt[K]<=lt[ot]}function Nt(I,K,ot){for(var lt=I.heap[ot],J=ot<<1;J<=I.heap_len&&(J<I.heap_len&&Lt(K,I.heap[J+1],I.heap[J],I.depth)&&J++,!Lt(K,lt,I.heap[J],I.depth));)I.heap[ot]=I.heap[J],ot=J,J<<=1;I.heap[ot]=lt}function ne(I,K,ot){var lt,J,dt,bt,ft=0;if(I.last_lit!==0)for(;lt=I.pending_buf[I.d_buf+2*ft]<<8|I.pending_buf[I.d_buf+2*ft+1],J=I.pending_buf[I.l_buf+ft],ft++,lt===0?at(I,J,K):(at(I,(dt=_[J])+h+1,K),(bt=C[dt])!==0&&st(I,J-=B[dt],bt),at(I,dt=$(--lt),ot),(bt=W[dt])!==0&&st(I,lt-=Q[dt],bt)),ft<I.last_lit;);at(I,A,K)}function Re(I,K){var ot,lt,J,dt=K.dyn_tree,bt=K.stat_desc.static_tree,ft=K.stat_desc.has_stree,vt=K.stat_desc.elems,le=-1;for(I.heap_len=0,I.heap_max=g,ot=0;ot<vt;ot++)dt[2*ot]!==0?(I.heap[++I.heap_len]=le=ot,I.depth[ot]=0):dt[2*ot+1]=0;for(;I.heap_len<2;)dt[2*(J=I.heap[++I.heap_len]=le<2?++le:0)]=1,I.depth[J]=0,I.opt_len--,ft&&(I.static_len-=bt[2*J+1]);for(K.max_code=le,ot=I.heap_len>>1;1<=ot;ot--)Nt(I,dt,ot);for(J=vt;ot=I.heap[1],I.heap[1]=I.heap[I.heap_len--],Nt(I,dt,1),lt=I.heap[1],I.heap[--I.heap_max]=ot,I.heap[--I.heap_max]=lt,dt[2*J]=dt[2*ot]+dt[2*lt],I.depth[J]=(I.depth[ot]>=I.depth[lt]?I.depth[ot]:I.depth[lt])+1,dt[2*ot+1]=dt[2*lt+1]=J,I.heap[1]=J++,Nt(I,dt,1),2<=I.heap_len;);I.heap[--I.heap_max]=I.heap[1],function(Pt,In){var x,m,y,R,F,Z,nt=In.dyn_tree,Ft=In.max_code,ye=In.stat_desc.static_tree,me=In.stat_desc.has_stree,_e=In.stat_desc.extra_bits,oe=In.stat_desc.extra_base,va=In.stat_desc.max_length,Wl=0;for(R=0;R<=k;R++)Pt.bl_count[R]=0;for(nt[2*Pt.heap[Pt.heap_max]+1]=0,x=Pt.heap_max+1;x<g;x++)va<(R=nt[2*nt[2*(m=Pt.heap[x])+1]+1]+1)&&(R=va,Wl++),nt[2*m+1]=R,Ft<m||(Pt.bl_count[R]++,F=0,oe<=m&&(F=_e[m-oe]),Z=nt[2*m],Pt.opt_len+=Z*(R+F),me&&(Pt.static_len+=Z*(ye[2*m+1]+F)));if(Wl!==0){do{for(R=va-1;Pt.bl_count[R]===0;)R--;Pt.bl_count[R]--,Pt.bl_count[R+1]+=2,Pt.bl_count[va]--,Wl-=2}while(0<Wl);for(R=va;R!==0;R--)for(m=Pt.bl_count[R];m!==0;)Ft<(y=Pt.heap[--x])||(nt[2*y+1]!==R&&(Pt.opt_len+=(R-nt[2*y+1])*nt[2*y],nt[2*y+1]=R),m--)}}(I,K),Wt(dt,le,I.bl_count)}function b(I,K,ot){var lt,J,dt=-1,bt=K[1],ft=0,vt=7,le=4;for(bt===0&&(vt=138,le=3),K[2*(ot+1)+1]=65535,lt=0;lt<=ot;lt++)J=bt,bt=K[2*(lt+1)+1],++ft<vt&&J===bt||(ft<le?I.bl_tree[2*J]+=ft:J!==0?(J!==dt&&I.bl_tree[2*J]++,I.bl_tree[2*O]++):ft<=10?I.bl_tree[2*P]++:I.bl_tree[2*L]++,dt=J,le=(ft=0)===bt?(vt=138,3):J===bt?(vt=6,3):(vt=7,4))}function rt(I,K,ot){var lt,J,dt=-1,bt=K[1],ft=0,vt=7,le=4;for(bt===0&&(vt=138,le=3),lt=0;lt<=ot;lt++)if(J=bt,bt=K[2*(lt+1)+1],!(++ft<vt&&J===bt)){if(ft<le)for(;at(I,J,I.bl_tree),--ft!=0;);else J!==0?(J!==dt&&(at(I,J,I.bl_tree),ft--),at(I,O,I.bl_tree),st(I,ft-3,2)):ft<=10?(at(I,P,I.bl_tree),st(I,ft-3,3)):(at(I,L,I.bl_tree),st(I,ft-11,7));dt=J,le=(ft=0)===bt?(vt=138,3):J===bt?(vt=6,3):(vt=7,4)}}c(Q);var tt=!1;function N(I,K,ot,lt){st(I,(u<<1)+(lt?1:0),3),function(J,dt,bt,ft){Rt(J),yt(J,bt),yt(J,~bt),s.arraySet(J.pending_buf,J.window,dt,bt,J.pending),J.pending+=bt}(I,K,ot)}i._tr_init=function(I){tt||(function(){var K,ot,lt,J,dt,bt=new Array(k+1);for(J=lt=0;J<l-1;J++)for(B[J]=lt,K=0;K<1<<C[J];K++)_[lt++]=J;for(_[lt-1]=J,J=dt=0;J<16;J++)for(Q[J]=dt,K=0;K<1<<W[J];K++)S[dt++]=J;for(dt>>=7;J<d;J++)for(Q[J]=dt<<7,K=0;K<1<<W[J]-7;K++)S[256+dt++]=J;for(ot=0;ot<=k;ot++)bt[ot]=0;for(K=0;K<=143;)pt[2*K+1]=8,K++,bt[8]++;for(;K<=255;)pt[2*K+1]=9,K++,bt[9]++;for(;K<=279;)pt[2*K+1]=7,K++,bt[7]++;for(;K<=287;)pt[2*K+1]=8,K++,bt[8]++;for(Wt(pt,f+1,bt),K=0;K<d;K++)U[2*K+1]=5,U[2*K]=Ut(K,5);X=new ut(pt,C,h+1,f,k),j=new ut(U,W,0,d,k),ht=new ut(new Array(0),M,0,p,T)}(),tt=!0),I.l_desc=new G(I.dyn_ltree,X),I.d_desc=new G(I.dyn_dtree,j),I.bl_desc=new G(I.bl_tree,ht),I.bi_buf=0,I.bi_valid=0,Ot(I)},i._tr_stored_block=N,i._tr_flush_block=function(I,K,ot,lt){var J,dt,bt=0;0<I.level?(I.strm.data_type===2&&(I.strm.data_type=function(ft){var vt,le=4093624447;for(vt=0;vt<=31;vt++,le>>>=1)if(1&le&&ft.dyn_ltree[2*vt]!==0)return o;if(ft.dyn_ltree[18]!==0||ft.dyn_ltree[20]!==0||ft.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(ft.dyn_ltree[2*vt]!==0)return a;return o}(I)),Re(I,I.l_desc),Re(I,I.d_desc),bt=function(ft){var vt;for(b(ft,ft.dyn_ltree,ft.l_desc.max_code),b(ft,ft.dyn_dtree,ft.d_desc.max_code),Re(ft,ft.bl_desc),vt=p-1;3<=vt&&ft.bl_tree[2*et[vt]+1]===0;vt--);return ft.opt_len+=3*(vt+1)+5+5+4,vt}(I),J=I.opt_len+3+7>>>3,(dt=I.static_len+3+7>>>3)<=J&&(J=dt)):J=dt=ot+5,ot+4<=J&&K!==-1?N(I,K,ot,lt):I.strategy===4||dt===J?(st(I,2+(lt?1:0),3),ne(I,pt,U)):(st(I,4+(lt?1:0),3),function(ft,vt,le,Pt){var In;for(st(ft,vt-257,5),st(ft,le-1,5),st(ft,Pt-4,4),In=0;In<Pt;In++)st(ft,ft.bl_tree[2*et[In]+1],3);rt(ft,ft.dyn_ltree,vt-1),rt(ft,ft.dyn_dtree,le-1)}(I,I.l_desc.max_code+1,I.d_desc.max_code+1,bt+1),ne(I,I.dyn_ltree,I.dyn_dtree)),Ot(I),lt&&Rt(I)},i._tr_tally=function(I,K,ot){return I.pending_buf[I.d_buf+2*I.last_lit]=K>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&K,I.pending_buf[I.l_buf+I.last_lit]=255&ot,I.last_lit++,K===0?I.dyn_ltree[2*ot]++:(I.matches++,K--,I.dyn_ltree[2*(_[ot]+h+1)]++,I.dyn_dtree[2*$(K)]++),I.last_lit===I.lit_bufsize-1},i._tr_align=function(I){st(I,2,3),at(I,A,pt),function(K){K.bi_valid===16?(yt(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):8<=K.bi_valid&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)}(I)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,f=1,d={},p=!1,g=o.document,k=Object.getPrototypeOf&&Object.getPrototypeOf(o);k=k&&k.setTimeout?k:o,c={}.toString.call(o.process)==="[object process]"?function(O){xi.nextTick(function(){T(O)})}:function(){if(o.postMessage&&!o.importScripts){var O=!0,P=o.onmessage;return o.onmessage=function(){O=!1},o.postMessage("","*"),o.onmessage=P,O}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(O){o.postMessage(h+O,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(O){T(O.data)},function(O){l.port2.postMessage(O)}):g&&"onreadystatechange"in g.createElement("script")?(u=g.documentElement,function(O){var P=g.createElement("script");P.onreadystatechange=function(){T(O),P.onreadystatechange=null,u.removeChild(P),P=null},u.appendChild(P)}):function(O){setTimeout(T,0,O)},k.setImmediate=function(O){typeof O!="function"&&(O=new Function(""+O));for(var P=new Array(arguments.length-1),L=0;L<P.length;L++)P[L]=arguments[L+1];var C={callback:O,args:P};return d[f]=C,c(f),f++},k.clearImmediate=w}function w(O){delete d[O]}function T(O){if(p)setTimeout(T,0,O);else{var P=d[O];if(P){p=!0;try{(function(L){var C=L.callback,W=L.args;switch(W.length){case 0:C();break;case 1:C(W[0]);break;case 2:C(W[0],W[1]);break;case 3:C(W[0],W[1],W[2]);break;default:C.apply(a,W)}})(P)}finally{w(O),p=!1}}}}function A(O){O.source===o&&typeof O.data=="string"&&O.data.indexOf(h)===0&&T(+O.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof yn<"u"?yn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(xb);var YM=xb.exports,kd=po(YM);const Ab={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Ab);var tr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},lo,ka,Es;class VM{constructor(...t){lo.set(this,new Map),ka.set(this,new Map),Es.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),tr(this,Es,"f").has(r)||tr(this,Es,"f").set(r,new Set);const s=tr(this,Es,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&tr(this,ka,"f").set(r,a),o=!1,c)continue;const u=tr(this,lo,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);tr(this,lo,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:tr(this,lo,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&tr(this,ka,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:tr(this,Es,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of tr(this,Es,"f").values())Object.freeze(t);return this}_getTestState(){return{types:tr(this,lo,"f"),extensions:tr(this,ka,"f")}}}lo=new WeakMap,ka=new WeakMap,Es=new WeakMap;var qM=new VM(Ab)._freeze();function Sb(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return qM.getType(e)??"application/octet-stream"}async function JM(e,t){try{mr(H,e.name);const n=await e.arrayBuffer();(await new kd().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=Sb(s,a),u=new File([a],o.name,{type:c});t(u)}).catch(a=>{ae(H,"crash",a.message)})})}catch(n){ae(H,"crash",n.message)}}async function XM(e,t){try{mr(H,e.name);const n=await e.arrayBuffer();t(new Uint8Array(n))}catch(n){ae(H,"crash",n.message)}}function Rb(e,t){function n(r){if(E(t))switch(r){case"text/plain":t.text().then(i=>iu(H,void 0,"text",`file:${t.name}`,i,e)).catch(i=>ae(H,"crash",i.message));break;case"application/json":t.text().then(i=>iu(H,void 0,"json",`file:${t.name}`,i,e)).catch(i=>ae(H,"crash",i.message));break;case"application/zip":JM(t,i=>Rb(e,i)).catch(i=>ae(H,"crash",i.message));break;case"application/octet-stream":XM(t,i=>iu(H,void 0,"binary",`file:${t.name}`,i,e)).catch(i=>ae(H,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=Sb(t.name,new Uint8Array(i));if(s)n(s);else return ae(H,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>ae(H,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function zl(e,t){function n(r){ae(e,"crash",r.message)}t().catch(n)}function ZM(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function QM(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const tU=new Date("1980/09/02");async function Ib(e){return console.info("saved",e),new Promise((t,n)=>{const r=new kd;for(let i=0;i<e.length;++i){const s=e[i],o=fL(s);if(o){const a=Sx(o);E(a)&&r.file(s.id,a,{date:tU})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(QM(i))}).catch(n)})}async function eU(e){return new Promise((t,n)=>{const r=new kd;r.loadAsync(ZM(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=dL(Rx(c));E(u)&&i.push(u)}t(i)}).catch(n)})}const Ob="$yellow$205$205$205$196";function Nb(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Ye;function nU(){return!!Ye}function rU(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let f=r;f<=s;++f){const d={x:f-r,y:h-i},p=zr(e,{x:f,y:h});(p==null?void 0:p.category)===jn.ISOBJECT?(u.push(pr(Eb(e,f,h))),E(p.x)&&E(p.y)&&l.push({...pr(p),...d})):u.push({...pr(p),...d})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}function iU(e,t,n,r){const i=fr(e);if(E(i))switch(Ye=rU(i,t,n),r){case"copyobjects":Ye.terrain=[];break;case"copyterrain":Ye.objects=[];break}}function sU(e,t,n){const r=Nb(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,Ob),Zt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Zt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Zt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=gn(e);i.scroll=Kr(e)}function oU(e,t,n,r){const i=fr(e);if(!E(i)||!E(Ye))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),u=a-s+1,l=c-o+1,h=Math.min(Ye.width,u),f=Math.min(Ye.height,l);switch(r){case"pasteall":{for(let d=0;d<f;++d)for(let p=0;p<h;++p){const g=fc({x:p,y:d},Ye.width);bi(i,{...Ye.terrain[g],x:s+p,y:o+d})}for(let d=0;d<Ye.objects.length;++d){const p=Ye.objects[d];E(p.x)&&E(p.y)&&am(p.x,p.y,0,u-1,l-1,0)&&gd(i,{...p,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let d=0;d<Ye.objects.length;++d){const p=Ye.objects[d];E(p.x)&&E(p.y)&&am(p.x,p.y,0,u-1,l-1,0)&&gd(i,{...p,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let d=0;d<f;++d)for(let p=0;p<h;++p){const g=fc({x:p,y:d},Ye.width);bi(i,{...Ye.terrain[g],x:s+p,y:o+d})}break;case"pasteterraintiled":for(let d=o;d<=c;++d)for(let p=s;p<=a;++p){const g=(p-s)%Ye.width,k=(d-o)%Ye.height,w=fc({x:g,y:k},Ye.width);bi(i,{...Ye.terrain[w],x:p,y:d})}break}}function aU(e,t,n){const r=Nb(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,Ob),Zt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Zt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Zt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Zt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=gn(e);i.scroll=Kr(e)}const uo="$yellow$205$205$205$196";function Kl(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function cU(e,t,n,r){const i=fr(e);if(!E(i))return;let s=0;function o(){return s}function a(u,l){Mt(l)&&(s=l,cm(t.x,t.y,n.x,n.y).forEach(h=>{const f=zr(i,h);E(f)&&(f[u]=l)}))}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,uo),Zt(e,`batch:${Kl(t,n)}`,"char",[r,"charedit"],o,a);const c=gn(e);c.scroll=Kr(e)}function lU(e,t,n,r){const i=fr(e);if(!E(i))return;let s=0;function o(){return s}function a(u,l){if(console.info("memoryinspectcolorarea",u,l),Mt(l)){s=l;for(let h=t.y;h<=n.y;++h)for(let f=t.x;f<=n.x;++f){const d=zr(i,{x:f,y:h});E(d)&&(d[u]=l)}}}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,uo),Zt(e,`batch:${Kl(t,n)}`,"color",[r,"coloredit"],o,a);const c=gn(e);c.scroll=Kr(e)}function uU(e,t,n,r){const i=fr(e);if(!E(i))return;let s=0;function o(){return s}function a(u,l){Mt(l)&&(s=l,cm(t.x,t.y,n.x,n.y).forEach(h=>{const f=zr(i,h);E(f)&&(f[u]=l)}))}ce(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,uo),Zt(e,`batch:${Kl(t,n)}`,"color",[r,"coloredit"],o,a);const c=gn(e);c.scroll=Kr(e)}function hU(e,t,n){const r=Kl(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,uo),Zt(e,"batch","copy elements",[`copy:${r}`,"hk","1"," 1 ","next"]),nU()&&Zt(e,"batch","paste elements",[`paste:${r}`,"hk","2"," 2 ","next"]),Zt(e,"batch","copy coords",[`copycoords:${r}`,"hk","5"," 5 "]),ce(e,uo),Zt(e,"batch","set chars:",[`chars:${r}`,"hk","a"," A ","next"]),Zt(e,"batch","set colors:",[`colors:${r}`,"hk","c"," C ","next"]),Zt(e,"batch","set bgs:",[`bgs:${r}`,"hk","b"," B ","next"]),ce(e,uo),Zt(e,"batch","make empty",[`empty:${r}`,"hk","0"," 0 ","next"])}const Ta="$yellow$205$205$205$196";function Td(e,t){return`inspect:${t!=null&&t.id?t.id:jr(e,t)}`}function fU(e,t,n){const r=$n(Kt.MAIN);if(!E(r))return;const i=fr(e);if(!E(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){E(t)&&(t[f]=d)}const a=t.category===jn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=Td(i,t);ce(e,`${a}: ${c} ${u}`),ce(e,Ta),Zt(e,l,"color",[n,"coloredit"],s,o);const h=gn(e);h.scroll=Kr(e)}function dU(e,t,n){const r=$n(Kt.MAIN);if(!E(r))return;const i=fr(e);if(!E(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){E(t)&&(t[f]=d)}const a=t.category===jn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=Td(i,t);ce(e,`${a}: ${c} ${u}`),ce(e,Ta),Zt(e,l,"char",[n,"charedit"],s,o);const h=gn(e);h.scroll=Kr(e)}function Cb(e,t,n,r,i,s){var h,f,d;function o(p){var k;const g=(r==null?void 0:r[p])??((k=r==null?void 0:r.kinddata)==null?void 0:k[p]);if(!E(g))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Gt.ISWALK;case"pushable":return 0;case"destructible":return 0}return g}function a(p,g){E(r)&&(r[p]=g)}s?ce(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ce(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ce(e,Ta);const c=Td(t,r);s?(Zt(e,c,"cycle",["cycle","number","1","255"],o,a),Zt(e,c,"collision",["collision","select","iswalking",`${Gt.ISWALK}`,"isswimming",`${Gt.ISSWIM}`],o,a)):Zt(e,c,"collision",["collision","select","iswalkable",`${Gt.ISWALK}`,"isswimable",`${Gt.ISSWIM}`,"issolid",`${Gt.ISSOLID}`],o,a),s&&Zt(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Zt(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const u=wl(n),l=Gr(u);for(let p=0;p<l.length;++p){const g=l[p];switch(g){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(re(u[g])){const[k,w,...T]=u[g];At(w)&&Zt(e,c,w||g,[g,k,...T],o,a)}break}}ce(e,Ta),Zt(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),Zt(e,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),Zt(e,c,`bg: ${r.bg??((d=r.kinddata)==null?void 0:d.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ce(e,Ta),Zt(e,c,"make empty",["empty","hk","0"],o,a)}const Lb="$yellow$205$205$205$196";function pU(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function mU(e,t,n,r){const i=$n(Kt.MAIN);if(!E(i))return;const s=fr(e);if(E(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=zr(s,{x:a,y:o});(c==null?void 0:c.category)===jn.ISOBJECT&&pi(i,s,c,i.timestamp),bi(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=zr(s,{x:a,y:o});(c==null?void 0:c.category)===jn.ISOBJECT&&pi(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)bi(s,{x:a,y:o});break}}}function gU(e,t,n){const r=pU(t,n);ce(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ce(e,Lb),Zt(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Zt(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Zt(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=gn(e);i.scroll=Kr(e)}function yU(e,t,n){const r=$n(Kt.MAIN);if(!E(r))return;const i=fr(e);if(!E(i))return;if(Br(r,i),t.x===n.x&&t.y===n.y){const o=zr(i,t);if(E(o)){const a=fi(r,kt.TERRAIN,o.kind??"");E(a)&&Cb(e,i,a,o,t,!1);const c=fi(r,kt.OBJECT,o.kind??"");E(c)&&Cb(e,i,c,o,t,!0)}else ce(e,`empty: ${t.x}, ${t.y}`),ce(e,Lb)}else hU(e,t,n);const s=gn(e);s.scroll=Kr(e)}function _U(e,t){const n=Te(Kt.MAIN);if(!E(n))return;const r=fr(t);if(!E(r))return;const i=xs(e),s=FM(r,i.target);if(E(s))switch(i.path){case"bg":case"color":fU(t,s,i.path);break;case"char":dU(t,s,i.path);break;case"empty":pi(n,r,s,n.timestamp);break;case"code":zl(H,async()=>{if(!E(t))return;const o=os(s),a="object";te(H,`opened [${a}] ${o}`);const c=[r.id,s.id??""];lh(Ra(n.id,c),s.code??""),Sw(H,t),await Xw(800),jd(H,n.id,[r.id,s.id??""],a,`${o} - ${n.name}`,t)});break;default:console.info("unknown inspect",i);break}}function bU(e,t){const n=fr(t);if(!E(n))return;const r=xs(e),[i,s,o,a]=r.path.split(",").map(l=>parseFloat(l)),c={x:i,y:s},u={x:o,y:a};switch(r.target){case"copy":sU(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":iU(t,c,u,r.target);break;case"paste":aU(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":oU(t,c,u,r.target);break;case"empty":gU(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":mU(t,c,u,r.target);break;case"chars":cU(t,c,u,"char");break;case"colors":lU(t,c,u,"color");break;case"bgs":uU(t,c,u,"bg");break;case"copycoords":{Lw(H,r.path,_i());break}default:console.info("unknown batch",r);break}}const wU=16,ks={},EU=64;let Mb=0;const ho={},fo={};async function kU(){const e=wa(),t=Te(Kt.MAIN);if(e.length&&E(t)){const n=await Ib(e),r=`${new Date().toISOString()} ${t.name} ${n.length} chars`;Nw(Me,r,n,_i())}}async function TU(){const e=wa(),t=Te(Kt.MAIN);if(e.length&&E(t)){const n=await Ib(e);Cw(Me,n,_i())}}const Me=As("vm",["tick","second"],e=>{var t;if(Me.session(e))switch(e.target){case"operator":E(e.player)&&(mM(e.player),se(Me,`operator set to ${e.player}`),Me.replynext(e,"ackoperator",!0,e.player));break;case"zsswords":if(e.player===_i()){const n=Te(Kt.MAIN);Me.replynext(e,"ackzsswords",{cli:nd(ji.CLI),loader:nd(ji.LOADER),runtime:nd(ji.RUNTIME),flags:[...Gr(ws(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...gs(n,kt.OBJECT).map(r=>Fn(r)),...Gr(Zf)],altkinds:[...gs(n,kt.TERRAIN),...gs(n,kt.BOARD),...gs(n,kt.PALETTE),...gs(n,kt.CHARSET),...gs(n,kt.LOADER)].map(r=>Fn(r)),colors:[...Gr($o)],dirs:[...Gr(dd).filter(r=>["cw","ccw","oop","rndp"].includes(r)===!1)],dirmods:["cw","ccw","oop","rndp",...Gr(Qf)]},e.player)}break;case"books":e.player===_i()&&zl(Me,async()=>{if(e.player&&re(e.data)){const[n,r]=e.data,i=await eU(n),s=i.map(o=>o.name);EM(i,r),se(Me,`loading ${s.join(", ")}`),eu(Me,e.player)}});break;case"joinack":E(e.player)&&!xM(e.player)&&eu(Me,e.player);break;case"logout":E(e.player)&&(vM(e.player),delete ks[e.player],se(Me,`player ${e.player} logout`),eu(Me,e.player));break;case"login":E(e.player)&&TM(e.player)&&(ks[e.player]=0,se(Me,`login from ${e.player}`),Me.replynext(e,"acklogin",!0,e.player));break;case"doot":E(e.player)&&(ks[e.player]=0,$d(Me,"active",e.player));break;case"input":if(E(e.player)){const n=ws(e.player),[r=un.NONE,i=0]=e.data??[un.NONE,0];re(n.inputqueue)||(n.inputqueue=[]),r!==un.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(E(e.player)&&re(e.data)){const[n,r]=e.data,i=Ra(n,r);E(fo[i])||(fo[i]=im(i,s=>{const[o,a]=r,c=Ki(n),u=Zs(c,o);if(E(u))if(Bi(u)===kt.BOARD&&E(a)){const l=hi(u),h=Rn(l,a);E(h)&&(h.code=s,Bf(f1(s),h))}else u.code=s,hL(u)})),ho[i]=ho[i]??new Set,ho[i].add(e.player)}break;case"coderelease":if(e.player&&re(e.data)){const[n,r]=e.data,[,i]=r,s=Ra(n,r);E(ho[s])&&(ho[s].delete(e.player),ho[s].size===0&&((t=fo[s])==null||t.call(fo),fo[s]=void 0,At(i)&&RM(i)))}break;case"halt":e.player===_i()&&_w(e.data)&&gM(e.data);break;case"tick":yM()||OM();break;case"synthsend":At(e.data)&&fd(e.data,void 0);break;case"second":{AM(ks);const n=Object.keys(ks);for(let r=0;r<n.length;++r)++ks[n[r]];for(let r=0;r<n.length;++r){const i=n[r];ks[i]>=wU&&zd(Me,i)}++Mb>=EU&&(Mb=0,ru(Me,_i()));break}case"fork":zl(Me,async()=>{await TU()});break;case"flush":zl(Me,async()=>{await kU()});break;case"cli":E(e.player)&&NM(e.player,e.data);break;case"restart":e.player===_i()&&(IM(),ru(Me,e.player));break;case"inspect":if(E(e.player)&&re(e.data)){const[n,r]=e.data;yU(e.player,n,r)}break;case"loader":if(E(e.player)&&re(e.data)){const[n,r,i,s]=e.data;r==="file"?Rb(e.player,s):XL(n,r,i,s,e.player)}break;default:{const{target:n,path:r}=xs(e.target);switch(Bt(n)){case"batch":E(e.player)&&bU(r,e.player);break;case"inspect":E(e.player)&&_U(r,e.player);break;case"touched":if(re(e.data)){const[i,s,o]=e.data;mb({...e,target:`${i}:${o}`,data:void 0,sender:s})}break;default:mb(e);break}break}}},pM());function vU(){Ow(Me)}const{forward:xU}=qw(e=>postMessage(e));onmessage=function(t){xU(t.data)},setTimeout(vU,100)})();

var Yne=Object.defineProperty;var Xne=(t,e,n)=>e in t?Yne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Jne=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Gn=(t,e,n)=>Xne(t,typeof e!="symbol"?e+"":e,n);var nJe=Jne((Yu,ic)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Da=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function FF(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var wG={exports:{}},KA={},xG={exports:{}},ui={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yw=Symbol.for("react.element"),Qne=Symbol.for("react.portal"),Zne=Symbol.for("react.fragment"),ere=Symbol.for("react.strict_mode"),tre=Symbol.for("react.profiler"),nre=Symbol.for("react.provider"),rre=Symbol.for("react.context"),ire=Symbol.for("react.forward_ref"),sre=Symbol.for("react.suspense"),ore=Symbol.for("react.memo"),are=Symbol.for("react.lazy"),Vj=Symbol.iterator;function cre(t){return t===null||typeof t!="object"?null:(t=Vj&&t[Vj]||t["@@iterator"],typeof t=="function"?t:null)}var CG={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},RG=Object.assign,AG={};function sS(t,e,n){this.props=t,this.context=e,this.refs=AG,this.updater=n||CG}sS.prototype.isReactComponent={};sS.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};sS.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function MG(){}MG.prototype=sS.prototype;function BF(t,e,n){this.props=t,this.context=e,this.refs=AG,this.updater=n||CG}var jF=BF.prototype=new MG;jF.constructor=BF;RG(jF,sS.prototype);jF.isPureReactComponent=!0;var zj=Array.isArray,IG=Object.prototype.hasOwnProperty,$F={current:null},OG={key:!0,ref:!0,__self:!0,__source:!0};function kG(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)IG.call(e,r)&&!OG.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:yw,type:t,key:s,ref:o,props:i,_owner:$F.current}}function lre(t,e){return{$$typeof:yw,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function HF(t){return typeof t=="object"&&t!==null&&t.$$typeof===yw}function ure(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Gj=/\/+/g;function kN(t,e){return typeof t=="object"&&t!==null&&t.key!=null?ure(""+t.key):e.toString(36)}function hC(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case yw:case Qne:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+kN(o,0):r,zj(i)?(n="",t!=null&&(n=t.replace(Gj,"$&/")+"/"),hC(i,e,n,"",function(l){return l})):i!=null&&(HF(i)&&(i=lre(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Gj,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",zj(t))for(var a=0;a<t.length;a++){s=t[a];var c=r+kN(s,a);o+=hC(s,e,n,c,i)}else if(c=cre(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=r+kN(s,a++),o+=hC(s,e,n,c,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Yx(t,e,n){if(t==null)return t;var r=[],i=0;return hC(t,r,"","",function(s){return e.call(n,s,i++)}),r}function dre(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Pl={current:null},fC={transition:null},hre={ReactCurrentDispatcher:Pl,ReactCurrentBatchConfig:fC,ReactCurrentOwner:$F};function NG(){throw Error("act(...) is not supported in production builds of React.")}ui.Children={map:Yx,forEach:function(t,e,n){Yx(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Yx(t,function(){e++}),e},toArray:function(t){return Yx(t,function(e){return e})||[]},only:function(t){if(!HF(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ui.Component=sS;ui.Fragment=Zne;ui.Profiler=tre;ui.PureComponent=BF;ui.StrictMode=ere;ui.Suspense=sre;ui.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hre;ui.act=NG;ui.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=RG({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=$F.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)IG.call(e,c)&&!OG.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:yw,type:t.type,key:i,ref:s,props:r,_owner:o}};ui.createContext=function(t){return t={$$typeof:rre,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:nre,_context:t},t.Consumer=t};ui.createElement=kG;ui.createFactory=function(t){var e=kG.bind(null,t);return e.type=t,e};ui.createRef=function(){return{current:null}};ui.forwardRef=function(t){return{$$typeof:ire,render:t}};ui.isValidElement=HF;ui.lazy=function(t){return{$$typeof:are,_payload:{_status:-1,_result:t},_init:dre}};ui.memo=function(t,e){return{$$typeof:ore,type:t,compare:e===void 0?null:e}};ui.startTransition=function(t){var e=fC.transition;fC.transition={};try{t()}finally{fC.transition=e}};ui.unstable_act=NG;ui.useCallback=function(t,e){return Pl.current.useCallback(t,e)};ui.useContext=function(t){return Pl.current.useContext(t)};ui.useDebugValue=function(){};ui.useDeferredValue=function(t){return Pl.current.useDeferredValue(t)};ui.useEffect=function(t,e){return Pl.current.useEffect(t,e)};ui.useId=function(){return Pl.current.useId()};ui.useImperativeHandle=function(t,e,n){return Pl.current.useImperativeHandle(t,e,n)};ui.useInsertionEffect=function(t,e){return Pl.current.useInsertionEffect(t,e)};ui.useLayoutEffect=function(t,e){return Pl.current.useLayoutEffect(t,e)};ui.useMemo=function(t,e){return Pl.current.useMemo(t,e)};ui.useReducer=function(t,e,n){return Pl.current.useReducer(t,e,n)};ui.useRef=function(t){return Pl.current.useRef(t)};ui.useState=function(t){return Pl.current.useState(t)};ui.useSyncExternalStore=function(t,e,n){return Pl.current.useSyncExternalStore(t,e,n)};ui.useTransition=function(){return Pl.current.useTransition()};ui.version="18.3.1";xG.exports=ui;var ft=xG.exports;const Fh=Nl(ft);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fre=ft,pre=Symbol.for("react.element"),mre=Symbol.for("react.fragment"),gre=Object.prototype.hasOwnProperty,vre=fre.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_re={key:!0,ref:!0,__self:!0,__source:!0};function PG(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)gre.call(e,r)&&!_re.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:pre,type:t,key:s,ref:o,props:i,_owner:vre.current}}KA.Fragment=mre;KA.jsx=PG;KA.jsxs=PG;wG.exports=KA;var De=wG.exports;function yre(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var DG={exports:{}},$o=DG.exports={},Yf,Xf;function vL(){throw new Error("setTimeout has not been defined")}function _L(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Yf=setTimeout:Yf=vL}catch{Yf=vL}try{typeof clearTimeout=="function"?Xf=clearTimeout:Xf=_L}catch{Xf=_L}})();function LG(t){if(Yf===setTimeout)return setTimeout(t,0);if((Yf===vL||!Yf)&&setTimeout)return Yf=setTimeout,setTimeout(t,0);try{return Yf(t,0)}catch{try{return Yf.call(null,t,0)}catch{return Yf.call(this,t,0)}}}function bre(t){if(Xf===clearTimeout)return clearTimeout(t);if((Xf===_L||!Xf)&&clearTimeout)return Xf=clearTimeout,clearTimeout(t);try{return Xf(t)}catch{try{return Xf.call(null,t)}catch{return Xf.call(this,t)}}}var Km=[],Zb=!1,A0,pC=-1;function Ere(){!Zb||!A0||(Zb=!1,A0.length?Km=A0.concat(Km):pC=-1,Km.length&&UG())}function UG(){if(!Zb){var t=LG(Ere);Zb=!0;for(var e=Km.length;e;){for(A0=Km,Km=[];++pC<e;)A0&&A0[pC].run();pC=-1,e=Km.length}A0=null,Zb=!1,bre(t)}}$o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Km.push(new FG(t,e)),Km.length===1&&!Zb&&LG(UG)};function FG(t,e){this.fun=t,this.array=e}FG.prototype.run=function(){this.fun.apply(null,this.array)};$o.title="browser";$o.browser=!0;$o.env={};$o.argv=[];$o.version="";$o.versions={};function gg(){}$o.on=gg;$o.addListener=gg;$o.once=gg;$o.off=gg;$o.removeListener=gg;$o.removeAllListeners=gg;$o.emit=gg;$o.prependListener=gg;$o.prependOnceListener=gg;$o.listeners=function(t){return[]};$o.binding=function(t){throw new Error("process.binding is not supported")};$o.cwd=function(){return"/"};$o.chdir=function(t){throw new Error("process.chdir is not supported")};$o.umask=function(){return 0};var Sre=DG.exports;const Bn=yre(Sre);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const YA="170",Tre=0,Wj=1,wre=2,xre=0,VF=1,mC=2,qf=3,ag=0,sc=1,Gu=2,Bh=0,eE=1,qj=2,Kj=3,Yj=4,Cre=5,x0=100,Rre=101,Are=102,Mre=103,Ire=104,Ore=200,kre=201,Nre=202,Pre=203,yL=204,bL=205,Dre=206,Lre=207,Ure=208,Fre=209,Bre=210,jre=211,$re=212,Hre=213,Vre=214,EL=0,SL=1,TL=2,EE=3,wL=4,xL=5,CL=6,RL=7,BG=0,zre=1,Gre=2,up=0,Wre=1,qre=2,Kre=3,jG=4,Yre=5,Xre=6,Jre=7,$G=300,SE=301,TE=302,AL=303,ML=304,XA=306,IL=1e3,M0=1001,OL=1002,jo=1003,Qre=1004,Xx=1005,ru=1006,NN=1007,I0=1008,Yc=1009,HG=1010,VG=1011,RT=1012,zF=1013,c_=1014,cp=1015,oS=1016,GF=1017,WF=1018,q0=1020,zG=35902,GG=1021,WG=1022,Od=1023,qG=1024,KG=1025,tE=1026,K0=1027,YG=1028,qF=1029,XG=1030,KF=1031,JA=1033,gC=33776,vC=33777,_C=33778,yC=33779,kL=35840,NL=35841,PL=35842,DL=35843,LL=36196,UL=37492,FL=37496,BL=37808,jL=37809,$L=37810,HL=37811,VL=37812,zL=37813,GL=37814,WL=37815,qL=37816,KL=37817,YL=37818,XL=37819,JL=37820,QL=37821,bC=36492,ZL=36494,e2=36495,JG=36283,t2=36284,n2=36285,r2=36286,py=3200,Zre=3201,QG=0,eie=1,np="",Lo="srgb",x_="srgb-linear",QA="linear",es="srgb",Yy=7680,Xj=519,tie=512,nie=513,rie=514,ZG=515,iie=516,sie=517,oie=518,aie=519,Jj=35044,Qj="300 es",Ym=2e3,yR=2001;class vg{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const Bc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Zj=1234567;const hT=Math.PI/180,AT=180/Math.PI;function aS(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Bc[t&255]+Bc[t>>8&255]+Bc[t>>16&255]+Bc[t>>24&255]+"-"+Bc[e&255]+Bc[e>>8&255]+"-"+Bc[e>>16&15|64]+Bc[e>>24&255]+"-"+Bc[n&63|128]+Bc[n>>8&255]+"-"+Bc[n>>16&255]+Bc[n>>24&255]+Bc[r&255]+Bc[r>>8&255]+Bc[r>>16&255]+Bc[r>>24&255]).toLowerCase()}function Rl(t,e,n){return Math.max(e,Math.min(n,t))}function YF(t,e){return(t%e+e)%e}function cie(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function lie(t,e,n){return t!==e?(n-t)/(e-t):0}function fT(t,e,n){return(1-n)*t+n*e}function uie(t,e,n,r){return fT(t,e,1-Math.exp(-n*r))}function die(t,e=1){return e-Math.abs(YF(t,e*2)-e)}function hie(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function fie(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function pie(t,e){return t+Math.floor(Math.random()*(e-t+1))}function mie(t,e){return t+Math.random()*(e-t)}function gie(t){return t*(.5-Math.random())}function vie(t){t!==void 0&&(Zj=t);let e=Zj+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function _ie(t){return t*hT}function yie(t){return t*AT}function bie(t){return(t&t-1)===0&&t!==0}function Eie(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Sie(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Tie(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),c=o(n/2),l=s((e+r)/2),u=o((e+r)/2),d=s((e-r)/2),h=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*u,c*d,c*h,a*l);break;case"YZY":t.set(c*h,a*u,c*d,a*l);break;case"ZXZ":t.set(c*d,c*h,a*u,a*l);break;case"XZX":t.set(a*u,c*f,c*p,a*l);break;case"YXY":t.set(c*p,a*u,c*f,a*l);break;case"ZYZ":t.set(c*f,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Rb(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function El(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const wie={DEG2RAD:hT,RAD2DEG:AT,generateUUID:aS,clamp:Rl,euclideanModulo:YF,mapLinear:cie,inverseLerp:lie,lerp:fT,damp:uie,pingpong:die,smoothstep:hie,smootherstep:fie,randInt:pie,randFloat:mie,randFloatSpread:gie,seededRandom:vie,degToRad:_ie,radToDeg:yie,isPowerOfTwo:bie,ceilPowerOfTwo:Eie,floorPowerOfTwo:Sie,setQuaternionFromProperEuler:Tie,normalize:El,denormalize:Rb};class Vn{constructor(e=0,n=0){Vn.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Rl(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Wr{constructor(e,n,r,i,s,o,a,c,l){Wr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],d=r[7],h=r[2],p=r[5],f=r[8],g=i[0],y=i[3],E=i[6],w=i[1],R=i[4],A=i[7],k=i[2],I=i[5],N=i[8];return s[0]=o*g+a*w+c*k,s[3]=o*y+a*R+c*I,s[6]=o*E+a*A+c*N,s[1]=l*g+u*w+d*k,s[4]=l*y+u*R+d*I,s[7]=l*E+u*A+d*N,s[2]=h*g+p*w+f*k,s[5]=h*y+p*R+f*I,s[8]=h*E+p*A+f*N,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,h=a*c-u*s,p=l*s-o*c,f=n*d+r*h+i*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/f;return e[0]=d*g,e[1]=(i*l-u*r)*g,e[2]=(a*r-i*o)*g,e[3]=h*g,e[4]=(u*n-i*c)*g,e[5]=(i*s-a*n)*g,e[6]=p*g,e[7]=(r*c-l*n)*g,e[8]=(o*n-r*s)*g,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(PN.makeScale(e,n)),this}rotate(e){return this.premultiply(PN.makeRotation(-e)),this}translate(e,n){return this.premultiply(PN.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const PN=new Wr;function eW(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function MT(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function xie(){const t=MT("canvas");return t.style.display="block",t}const e$={};function QS(t){t in e$||(e$[t]=!0,console.warn(t))}function Cie(t,e,n){return new Promise(function(r,i){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:i();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:r()}}setTimeout(s,n)})}function Rie(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function Aie(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const ki={enabled:!0,workingColorSpace:x_,spaces:{},convert:function(t,e,n){return this.enabled===!1||e===n||!e||!n||(this.spaces[e].transfer===es&&(t.r=eg(t.r),t.g=eg(t.g),t.b=eg(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===es&&(t.r=nE(t.r),t.g=nE(t.g),t.b=nE(t.b))),t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===np?QA:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function eg(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function nE(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const t$=[.64,.33,.3,.6,.15,.06],n$=[.2126,.7152,.0722],r$=[.3127,.329],i$=new Wr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),s$=new Wr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ki.define({[x_]:{primaries:t$,whitePoint:r$,transfer:QA,toXYZ:i$,fromXYZ:s$,luminanceCoefficients:n$,workingColorSpaceConfig:{unpackColorSpace:Lo},outputColorSpaceConfig:{drawingBufferColorSpace:Lo}},[Lo]:{primaries:t$,whitePoint:r$,transfer:es,toXYZ:i$,fromXYZ:s$,luminanceCoefficients:n$,outputColorSpaceConfig:{drawingBufferColorSpace:Lo}}});let Xy;class Mie{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Xy===void 0&&(Xy=MT("canvas")),Xy.width=e.width,Xy.height=e.height;const r=Xy.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=Xy}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=MT("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=eg(s[o]/255)*255;return r.putImageData(i,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(eg(n[r]/255)*255):n[r]=eg(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Iie=0,tW=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Iie++}),this.uuid=aS(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(DN(i[o].image)):s.push(DN(i[o]))}else s=DN(i);r.url=s}return n||(e.images[this.uuid]=r),r}};function DN(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?Mie.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Oie=0;class So extends vg{constructor(e=So.DEFAULT_IMAGE,n=So.DEFAULT_MAPPING,r=M0,i=M0,s=ru,o=I0,a=Od,c=Yc,l=So.DEFAULT_ANISOTROPY,u=np){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Oie++}),this.uuid=aS(),this.name="",this.source=new tW(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new Vn(0,0),this.repeat=new Vn(1,1),this.center=new Vn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==$G)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case IL:e.x=e.x-Math.floor(e.x);break;case M0:e.x=e.x<0?0:1;break;case OL:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case IL:e.y=e.y-Math.floor(e.y);break;case M0:e.y=e.y<0?0:1;break;case OL:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}So.DEFAULT_IMAGE=null;So.DEFAULT_MAPPING=$G;So.DEFAULT_ANISOTROPY=1;class Bo{constructor(e=0,n=0,r=0,i=1){Bo.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,i){return this.x=e,this.y=n,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*n+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*n+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*n+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*n+o[7]*r+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,i,s;const c=e.elements,l=c[0],u=c[4],d=c[8],h=c[1],p=c[5],f=c[9],g=c[2],y=c[6],E=c[10];if(Math.abs(u-h)<.01&&Math.abs(d-g)<.01&&Math.abs(f-y)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+g)<.1&&Math.abs(f+y)<.1&&Math.abs(l+p+E-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const R=(l+1)/2,A=(p+1)/2,k=(E+1)/2,I=(u+h)/4,N=(d+g)/4,U=(f+y)/4;return R>A&&R>k?R<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(R),i=I/r,s=N/r):A>k?A<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(A),r=I/i,s=U/i):k<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(k),r=N/s,i=U/s),this.set(r,i,s,n),this}let w=Math.sqrt((y-f)*(y-f)+(d-g)*(d-g)+(h-u)*(h-u));return Math.abs(w)<.001&&(w=1),this.x=(y-f)/w,this.y=(d-g)/w,this.z=(h-u)/w,this.w=Math.acos((l+p+E-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class kie extends vg{constructor(e=1,n=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new Bo(0,0,e,n),this.scissorTest=!1,this.viewport=new Bo(0,0,e,n);const i={width:e,height:n,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ru,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const s=new So(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=n,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,i=e.textures.length;r<i;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new tW(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Zu extends kie{constructor(e=1,n=1,r={}){super(e,n,r),this.isWebGLRenderTarget=!0}}class nW extends So{constructor(e=null,n=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=jo,this.minFilter=jo,this.wrapR=M0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Nie extends So{constructor(e=null,n=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=jo,this.minFilter=jo,this.wrapR=M0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bw{constructor(e=0,n=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=i}static slerpFlat(e,n,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],d=r[i+3];const h=s[o+0],p=s[o+1],f=s[o+2],g=s[o+3];if(a===0){e[n+0]=c,e[n+1]=l,e[n+2]=u,e[n+3]=d;return}if(a===1){e[n+0]=h,e[n+1]=p,e[n+2]=f,e[n+3]=g;return}if(d!==g||c!==h||l!==p||u!==f){let y=1-a;const E=c*h+l*p+u*f+d*g,w=E>=0?1:-1,R=1-E*E;if(R>Number.EPSILON){const k=Math.sqrt(R),I=Math.atan2(k,E*w);y=Math.sin(y*I)/k,a=Math.sin(a*I)/k}const A=a*w;if(c=c*y+h*A,l=l*y+p*A,u=u*y+f*A,d=d*y+g*A,y===1-a){const k=1/Math.sqrt(c*c+l*l+u*u+d*d);c*=k,l*=k,u*=k,d*=k}}e[n]=c,e[n+1]=l,e[n+2]=u,e[n+3]=d}static multiplyQuaternionsFlat(e,n,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],d=s[o],h=s[o+1],p=s[o+2],f=s[o+3];return e[n]=a*f+u*d+c*p-l*h,e[n+1]=c*f+u*h+l*d-a*p,e[n+2]=l*f+u*p+a*h-c*d,e[n+3]=u*f-a*d-c*h-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,i){return this._x=e,this._y=n,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),d=a(s/2),h=c(r/2),p=c(i/2),f=c(s/2);switch(o){case"XYZ":this._x=h*u*d+l*p*f,this._y=l*p*d-h*u*f,this._z=l*u*f+h*p*d,this._w=l*u*d-h*p*f;break;case"YXZ":this._x=h*u*d+l*p*f,this._y=l*p*d-h*u*f,this._z=l*u*f-h*p*d,this._w=l*u*d+h*p*f;break;case"ZXY":this._x=h*u*d-l*p*f,this._y=l*p*d+h*u*f,this._z=l*u*f+h*p*d,this._w=l*u*d-h*p*f;break;case"ZYX":this._x=h*u*d-l*p*f,this._y=l*p*d+h*u*f,this._z=l*u*f-h*p*d,this._w=l*u*d+h*p*f;break;case"YZX":this._x=h*u*d+l*p*f,this._y=l*p*d+h*u*f,this._z=l*u*f-h*p*d,this._w=l*u*d-h*p*f;break;case"XZY":this._x=h*u*d-l*p*f,this._y=l*p*d-h*u*f,this._z=l*u*f+h*p*d,this._w=l*u*d+h*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],i=n[4],s=n[8],o=n[1],a=n[5],c=n[9],l=n[2],u=n[6],d=n[10],h=r+a+d;if(h>0){const p=.5/Math.sqrt(h+1);this._w=.25/p,this._x=(u-c)*p,this._y=(s-l)*p,this._z=(o-i)*p}else if(r>a&&r>d){const p=2*Math.sqrt(1+r-a-d);this._w=(u-c)/p,this._x=.25*p,this._y=(i+o)/p,this._z=(s+l)/p}else if(a>d){const p=2*Math.sqrt(1+a-r-d);this._w=(s-l)/p,this._x=(i+o)/p,this._y=.25*p,this._z=(c+u)/p}else{const p=2*Math.sqrt(1+d-r-a);this._w=(o-i)/p,this._x=(s+l)/p,this._y=(c+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Rl(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,n/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,i=e._y,s=e._z,o=e._w,a=n._x,c=n._y,l=n._z,u=n._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const p=1-n;return this._w=p*o+n*this._w,this._x=p*r+n*this._x,this._y=p*i+n*this._y,this._z=p*s+n*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),d=Math.sin((1-n)*u)/l,h=Math.sin(n*u)/l;return this._w=o*d+this._w*h,this._x=r*d+this._x*h,this._y=i*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(n),s*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ht{constructor(e=0,n=0,r=0){ht.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(o$.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(o$.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[3]*r+s[6]*i,this.y=s[1]*n+s[4]*r+s[7]*i,this.z=s[2]*n+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*n+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*n+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*n+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*n+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const n=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*i-a*r),u=2*(a*n-s*i),d=2*(s*r-o*n);return this.x=n+c*l+o*d-a*u,this.y=r+c*u+a*l-s*d,this.z=i+c*d+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[4]*r+s[8]*i,this.y=s[1]*n+s[5]*r+s[9]*i,this.z=s[2]*n+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,i=e.y,s=e.z,o=n.x,a=n.y,c=n.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return LN.copy(this).projectOnVector(e),this.sub(LN)}reflect(e){return this.sub(LN.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Rl(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return n*n+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const i=Math.sin(n)*e;return this.x=i*Math.sin(r),this.y=Math.cos(n)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=i,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const LN=new ht,o$=new bw;class Ew{constructor(e=new ht(1/0,1/0,1/0),n=new ht(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(bh.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(bh.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=bh.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(n===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,bh):bh.fromBufferAttribute(s,o),bh.applyMatrix4(e.matrixWorld),this.expandByPoint(bh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Jx.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Jx.copy(r.boundingBox)),Jx.applyMatrix4(e.matrixWorld),this.union(Jx)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,bh),bh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(OS),Qx.subVectors(this.max,OS),Jy.subVectors(e.a,OS),Qy.subVectors(e.b,OS),Zy.subVectors(e.c,OS),fv.subVectors(Qy,Jy),pv.subVectors(Zy,Qy),i0.subVectors(Jy,Zy);let n=[0,-fv.z,fv.y,0,-pv.z,pv.y,0,-i0.z,i0.y,fv.z,0,-fv.x,pv.z,0,-pv.x,i0.z,0,-i0.x,-fv.y,fv.x,0,-pv.y,pv.x,0,-i0.y,i0.x,0];return!UN(n,Jy,Qy,Zy,Qx)||(n=[1,0,0,0,1,0,0,0,1],!UN(n,Jy,Qy,Zy,Qx))?!1:(Zx.crossVectors(fv,pv),n=[Zx.x,Zx.y,Zx.z],UN(n,Jy,Qy,Zy,Qx))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,bh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(bh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Am[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Am[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Am[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Am[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Am[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Am[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Am[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Am[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Am),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Am=[new ht,new ht,new ht,new ht,new ht,new ht,new ht,new ht],bh=new ht,Jx=new Ew,Jy=new ht,Qy=new ht,Zy=new ht,fv=new ht,pv=new ht,i0=new ht,OS=new ht,Qx=new ht,Zx=new ht,s0=new ht;function UN(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){s0.fromArray(t,s);const a=i.x*Math.abs(s0.x)+i.y*Math.abs(s0.y)+i.z*Math.abs(s0.z),c=e.dot(s0),l=n.dot(s0),u=r.dot(s0);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const Pie=new Ew,kS=new ht,FN=new ht;class ZA{constructor(e=new ht,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):Pie.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;kS.subVectors(e,this.center);const n=kS.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),i=(r-this.radius)*.5;this.center.addScaledVector(kS,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(FN.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(kS.copy(e.center).add(FN)),this.expandByPoint(kS.copy(e.center).sub(FN))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Mm=new ht,BN=new ht,e1=new ht,mv=new ht,jN=new ht,t1=new ht,$N=new ht;class XF{constructor(e=new ht,n=new ht(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Mm)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=Mm.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Mm.copy(this.origin).addScaledVector(this.direction,n),Mm.distanceToSquared(e))}distanceSqToSegment(e,n,r,i){BN.copy(e).add(n).multiplyScalar(.5),e1.copy(n).sub(e).normalize(),mv.copy(this.origin).sub(BN);const s=e.distanceTo(n)*.5,o=-this.direction.dot(e1),a=mv.dot(this.direction),c=-mv.dot(e1),l=mv.lengthSq(),u=Math.abs(1-o*o);let d,h,p,f;if(u>0)if(d=o*c-a,h=o*a-c,f=s*u,d>=0)if(h>=-f)if(h<=f){const g=1/u;d*=g,h*=g,p=d*(d+o*h+2*a)+h*(o*d+h+2*c)+l}else h=s,d=Math.max(0,-(o*h+a)),p=-d*d+h*(h+2*c)+l;else h=-s,d=Math.max(0,-(o*h+a)),p=-d*d+h*(h+2*c)+l;else h<=-f?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-c),s),p=-d*d+h*(h+2*c)+l):h<=f?(d=0,h=Math.min(Math.max(-s,-c),s),p=h*(h+2*c)+l):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-c),s),p=-d*d+h*(h+2*c)+l);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),p=-d*d+h*(h+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,d),i&&i.copy(BN).addScaledVector(e1,h),p}intersectSphere(e,n){Mm.subVectors(e.center,this.origin);const r=Mm.dot(this.direction),i=Mm.dot(Mm)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:a<0?this.at(c,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),d>=0?(a=(e.min.z-h.z)*d,c=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,c=(e.min.z-h.z)*d),r>c||a>i)||((a>r||r!==r)&&(r=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,n)}intersectsBox(e){return this.intersectBox(e,Mm)!==null}intersectTriangle(e,n,r,i,s){jN.subVectors(n,e),t1.subVectors(r,e),$N.crossVectors(jN,t1);let o=this.direction.dot($N),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;mv.subVectors(this.origin,e);const c=a*this.direction.dot(t1.crossVectors(mv,t1));if(c<0)return null;const l=a*this.direction.dot(jN.cross(mv));if(l<0||c+l>o)return null;const u=-a*mv.dot($N);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class To{constructor(e,n,r,i,s,o,a,c,l,u,d,h,p,f,g,y){To.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l,u,d,h,p,f,g,y)}set(e,n,r,i,s,o,a,c,l,u,d,h,p,f,g,y){const E=this.elements;return E[0]=e,E[4]=n,E[8]=r,E[12]=i,E[1]=s,E[5]=o,E[9]=a,E[13]=c,E[2]=l,E[6]=u,E[10]=d,E[14]=h,E[3]=p,E[7]=f,E[11]=g,E[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new To().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,i=1/eb.setFromMatrixColumn(e,0).length(),s=1/eb.setFromMatrixColumn(e,1).length(),o=1/eb.setFromMatrixColumn(e,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const h=o*u,p=o*d,f=a*u,g=a*d;n[0]=c*u,n[4]=-c*d,n[8]=l,n[1]=p+f*l,n[5]=h-g*l,n[9]=-a*c,n[2]=g-h*l,n[6]=f+p*l,n[10]=o*c}else if(e.order==="YXZ"){const h=c*u,p=c*d,f=l*u,g=l*d;n[0]=h+g*a,n[4]=f*a-p,n[8]=o*l,n[1]=o*d,n[5]=o*u,n[9]=-a,n[2]=p*a-f,n[6]=g+h*a,n[10]=o*c}else if(e.order==="ZXY"){const h=c*u,p=c*d,f=l*u,g=l*d;n[0]=h-g*a,n[4]=-o*d,n[8]=f+p*a,n[1]=p+f*a,n[5]=o*u,n[9]=g-h*a,n[2]=-o*l,n[6]=a,n[10]=o*c}else if(e.order==="ZYX"){const h=o*u,p=o*d,f=a*u,g=a*d;n[0]=c*u,n[4]=f*l-p,n[8]=h*l+g,n[1]=c*d,n[5]=g*l+h,n[9]=p*l-f,n[2]=-l,n[6]=a*c,n[10]=o*c}else if(e.order==="YZX"){const h=o*c,p=o*l,f=a*c,g=a*l;n[0]=c*u,n[4]=g-h*d,n[8]=f*d+p,n[1]=d,n[5]=o*u,n[9]=-a*u,n[2]=-l*u,n[6]=p*d+f,n[10]=h-g*d}else if(e.order==="XZY"){const h=o*c,p=o*l,f=a*c,g=a*l;n[0]=c*u,n[4]=-d,n[8]=l*u,n[1]=h*d+g,n[5]=o*u,n[9]=p*d-f,n[2]=f*d-p,n[6]=a*u,n[10]=g*d+h}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Die,e,Lie)}lookAt(e,n,r){const i=this.elements;return Lu.subVectors(e,n),Lu.lengthSq()===0&&(Lu.z=1),Lu.normalize(),gv.crossVectors(r,Lu),gv.lengthSq()===0&&(Math.abs(r.z)===1?Lu.x+=1e-4:Lu.z+=1e-4,Lu.normalize(),gv.crossVectors(r,Lu)),gv.normalize(),n1.crossVectors(Lu,gv),i[0]=gv.x,i[4]=n1.x,i[8]=Lu.x,i[1]=gv.y,i[5]=n1.y,i[9]=Lu.y,i[2]=gv.z,i[6]=n1.z,i[10]=Lu.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],d=r[5],h=r[9],p=r[13],f=r[2],g=r[6],y=r[10],E=r[14],w=r[3],R=r[7],A=r[11],k=r[15],I=i[0],N=i[4],U=i[8],F=i[12],$=i[1],q=i[5],K=i[9],W=i[13],X=i[2],ne=i[6],Z=i[10],ie=i[14],G=i[3],Q=i[7],se=i[11],ve=i[15];return s[0]=o*I+a*$+c*X+l*G,s[4]=o*N+a*q+c*ne+l*Q,s[8]=o*U+a*K+c*Z+l*se,s[12]=o*F+a*W+c*ie+l*ve,s[1]=u*I+d*$+h*X+p*G,s[5]=u*N+d*q+h*ne+p*Q,s[9]=u*U+d*K+h*Z+p*se,s[13]=u*F+d*W+h*ie+p*ve,s[2]=f*I+g*$+y*X+E*G,s[6]=f*N+g*q+y*ne+E*Q,s[10]=f*U+g*K+y*Z+E*se,s[14]=f*F+g*W+y*ie+E*ve,s[3]=w*I+R*$+A*X+k*G,s[7]=w*N+R*q+A*ne+k*Q,s[11]=w*U+R*K+A*Z+k*se,s[15]=w*F+R*W+A*ie+k*ve,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],d=e[6],h=e[10],p=e[14],f=e[3],g=e[7],y=e[11],E=e[15];return f*(+s*c*d-i*l*d-s*a*h+r*l*h+i*a*p-r*c*p)+g*(+n*c*p-n*l*h+s*o*h-i*o*p+i*l*u-s*c*u)+y*(+n*l*d-n*a*p-s*o*d+r*o*p+s*a*u-r*l*u)+E*(-i*a*u-n*c*d+n*a*h+i*o*d-r*o*h+r*c*u)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=n,i[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=e[9],h=e[10],p=e[11],f=e[12],g=e[13],y=e[14],E=e[15],w=d*y*l-g*h*l+g*c*p-a*y*p-d*c*E+a*h*E,R=f*h*l-u*y*l-f*c*p+o*y*p+u*c*E-o*h*E,A=u*g*l-f*d*l+f*a*p-o*g*p-u*a*E+o*d*E,k=f*d*c-u*g*c-f*a*h+o*g*h+u*a*y-o*d*y,I=n*w+r*R+i*A+s*k;if(I===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const N=1/I;return e[0]=w*N,e[1]=(g*h*s-d*y*s-g*i*p+r*y*p+d*i*E-r*h*E)*N,e[2]=(a*y*s-g*c*s+g*i*l-r*y*l-a*i*E+r*c*E)*N,e[3]=(d*c*s-a*h*s-d*i*l+r*h*l+a*i*p-r*c*p)*N,e[4]=R*N,e[5]=(u*y*s-f*h*s+f*i*p-n*y*p-u*i*E+n*h*E)*N,e[6]=(f*c*s-o*y*s-f*i*l+n*y*l+o*i*E-n*c*E)*N,e[7]=(o*h*s-u*c*s+u*i*l-n*h*l-o*i*p+n*c*p)*N,e[8]=A*N,e[9]=(f*d*s-u*g*s-f*r*p+n*g*p+u*r*E-n*d*E)*N,e[10]=(o*g*s-f*a*s+f*r*l-n*g*l-o*r*E+n*a*E)*N,e[11]=(u*a*s-o*d*s-u*r*l+n*d*l+o*r*p-n*a*p)*N,e[12]=k*N,e[13]=(u*g*i-f*d*i+f*r*h-n*g*h-u*r*y+n*d*y)*N,e[14]=(f*a*i-o*g*i-f*r*c+n*g*c+o*r*y-n*a*y)*N,e[15]=(o*d*i-u*a*i+u*r*c-n*d*c-o*r*h+n*a*h)*N,this}scale(e){const n=this.elements,r=e.x,i=e.y,s=e.z;return n[0]*=r,n[4]*=i,n[8]*=s,n[1]*=r,n[5]*=i,n[9]*=s,n[2]*=r,n[6]*=i,n[10]*=s,n[3]*=r,n[7]*=i,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,i))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),i=Math.sin(n),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,n,i,1,0,0,0,0,1),this}compose(e,n,r){const i=this.elements,s=n._x,o=n._y,a=n._z,c=n._w,l=s+s,u=o+o,d=a+a,h=s*l,p=s*u,f=s*d,g=o*u,y=o*d,E=a*d,w=c*l,R=c*u,A=c*d,k=r.x,I=r.y,N=r.z;return i[0]=(1-(g+E))*k,i[1]=(p+A)*k,i[2]=(f-R)*k,i[3]=0,i[4]=(p-A)*I,i[5]=(1-(h+E))*I,i[6]=(y+w)*I,i[7]=0,i[8]=(f+R)*N,i[9]=(y-w)*N,i[10]=(1-(h+g))*N,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,n,r){const i=this.elements;let s=eb.set(i[0],i[1],i[2]).length();const o=eb.set(i[4],i[5],i[6]).length(),a=eb.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Eh.copy(this);const l=1/s,u=1/o,d=1/a;return Eh.elements[0]*=l,Eh.elements[1]*=l,Eh.elements[2]*=l,Eh.elements[4]*=u,Eh.elements[5]*=u,Eh.elements[6]*=u,Eh.elements[8]*=d,Eh.elements[9]*=d,Eh.elements[10]*=d,n.setFromRotationMatrix(Eh),r.x=s,r.y=o,r.z=a,this}makePerspective(e,n,r,i,s,o,a=Ym){const c=this.elements,l=2*s/(n-e),u=2*s/(r-i),d=(n+e)/(n-e),h=(r+i)/(r-i);let p,f;if(a===Ym)p=-(o+s)/(o-s),f=-2*o*s/(o-s);else if(a===yR)p=-o/(o-s),f=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=h,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=f,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,n,r,i,s,o,a=Ym){const c=this.elements,l=1/(n-e),u=1/(r-i),d=1/(o-s),h=(n+e)*l,p=(r+i)*u;let f,g;if(a===Ym)f=(o+s)*d,g=-2*d;else if(a===yR)f=s*d,g=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-h,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-p,c[2]=0,c[6]=0,c[10]=g,c[14]=-f,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<16;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const eb=new ht,Eh=new To,Die=new ht(0,0,0),Lie=new ht(1,1,1),gv=new ht,n1=new ht,Lu=new ht,a$=new To,c$=new bw;class cg{constructor(e=0,n=0,r=0,i=cg.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,i=this._order){return this._x=e,this._y=n,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],d=i[2],h=i[6],p=i[10];switch(n){case"XYZ":this._y=Math.asin(Rl(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Rl(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(Rl(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Rl(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Rl(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Rl(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return a$.makeRotationFromQuaternion(e),this.setFromRotationMatrix(a$,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return c$.setFromEuler(this),this.setFromQuaternion(c$,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}cg.DEFAULT_ORDER="XYZ";class rE{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Uie=0;const l$=new ht,tb=new bw,Im=new To,r1=new ht,NS=new ht,Fie=new ht,Bie=new bw,u$=new ht(1,0,0),d$=new ht(0,1,0),h$=new ht(0,0,1),f$={type:"added"},jie={type:"removed"},nb={type:"childadded",child:null},HN={type:"childremoved",child:null};class cu extends vg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Uie++}),this.uuid=aS(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cu.DEFAULT_UP.clone();const e=new ht,n=new cg,r=new bw,i=new ht(1,1,1);function s(){r.setFromEuler(n,!1)}function o(){n.setFromQuaternion(r,void 0,!1)}n._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new To},normalMatrix:{value:new Wr}}),this.matrix=new To,this.matrixWorld=new To,this.matrixAutoUpdate=cu.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=cu.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new rE,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return tb.setFromAxisAngle(e,n),this.quaternion.multiply(tb),this}rotateOnWorldAxis(e,n){return tb.setFromAxisAngle(e,n),this.quaternion.premultiply(tb),this}rotateX(e){return this.rotateOnAxis(u$,e)}rotateY(e){return this.rotateOnAxis(d$,e)}rotateZ(e){return this.rotateOnAxis(h$,e)}translateOnAxis(e,n){return l$.copy(e).applyQuaternion(this.quaternion),this.position.add(l$.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(u$,e)}translateY(e){return this.translateOnAxis(d$,e)}translateZ(e){return this.translateOnAxis(h$,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Im.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?r1.copy(e):r1.set(e,n,r);const i=this.parent;this.updateWorldMatrix(!0,!1),NS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Im.lookAt(NS,r1,this.up):Im.lookAt(r1,NS,this.up),this.quaternion.setFromRotationMatrix(Im),i&&(Im.extractRotation(i.matrixWorld),tb.setFromRotationMatrix(Im),this.quaternion.premultiply(tb.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(f$),nb.child=e,this.dispatchEvent(nb),nb.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(jie),HN.child=e,this.dispatchEvent(HN),HN.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Im.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Im.multiply(e.parent.matrixWorld)),e.applyMatrix4(Im),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(f$),nb.child=e,this.dispatchEvent(nb),nb.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,n);if(o!==void 0)return o}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(NS,e,Fie),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(NS,Bie,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].updateMatrixWorld(e)}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const d=c[l];s(e.shapes,d)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(e.materials,this.material[c]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(e.animations,c))}}if(n){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),d=o(e.shapes),h=o(e.skeletons),p=o(e.animations),f=o(e.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),d.length>0&&(r.shapes=d),h.length>0&&(r.skeletons=h),p.length>0&&(r.animations=p),f.length>0&&(r.nodes=f)}return r.object=i,r;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}cu.DEFAULT_UP=new ht(0,1,0);cu.DEFAULT_MATRIX_AUTO_UPDATE=!0;cu.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Sh=new ht,Om=new ht,VN=new ht,km=new ht,rb=new ht,ib=new ht,p$=new ht,zN=new ht,GN=new ht,WN=new ht,qN=new Bo,KN=new Bo,YN=new Bo;class kh{constructor(e=new ht,n=new ht,r=new ht){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,i){i.subVectors(r,n),Sh.subVectors(e,n),i.cross(Sh);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,n,r,i,s){Sh.subVectors(i,n),Om.subVectors(r,n),VN.subVectors(e,n);const o=Sh.dot(Sh),a=Sh.dot(Om),c=Sh.dot(VN),l=Om.dot(Om),u=Om.dot(VN),d=o*l-a*a;if(d===0)return s.set(0,0,0),null;const h=1/d,p=(l*c-a*u)*h,f=(o*u-a*c)*h;return s.set(1-p-f,f,p)}static containsPoint(e,n,r,i){return this.getBarycoord(e,n,r,i,km)===null?!1:km.x>=0&&km.y>=0&&km.x+km.y<=1}static getInterpolation(e,n,r,i,s,o,a,c){return this.getBarycoord(e,n,r,i,km)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,km.x),c.addScaledVector(o,km.y),c.addScaledVector(a,km.z),c)}static getInterpolatedAttribute(e,n,r,i,s,o){return qN.setScalar(0),KN.setScalar(0),YN.setScalar(0),qN.fromBufferAttribute(e,n),KN.fromBufferAttribute(e,r),YN.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(qN,s.x),o.addScaledVector(KN,s.y),o.addScaledVector(YN,s.z),o}static isFrontFacing(e,n,r,i){return Sh.subVectors(r,n),Om.subVectors(e,n),Sh.cross(Om).dot(i)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,i){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,n,r,i){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Sh.subVectors(this.c,this.b),Om.subVectors(this.a,this.b),Sh.cross(Om).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return kh.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return kh.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,s){return kh.getInterpolation(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return kh.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return kh.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,i=this.b,s=this.c;let o,a;rb.subVectors(i,r),ib.subVectors(s,r),zN.subVectors(e,r);const c=rb.dot(zN),l=ib.dot(zN);if(c<=0&&l<=0)return n.copy(r);GN.subVectors(e,i);const u=rb.dot(GN),d=ib.dot(GN);if(u>=0&&d<=u)return n.copy(i);const h=c*d-u*l;if(h<=0&&c>=0&&u<=0)return o=c/(c-u),n.copy(r).addScaledVector(rb,o);WN.subVectors(e,s);const p=rb.dot(WN),f=ib.dot(WN);if(f>=0&&p<=f)return n.copy(s);const g=p*l-c*f;if(g<=0&&l>=0&&f<=0)return a=l/(l-f),n.copy(r).addScaledVector(ib,a);const y=u*f-p*d;if(y<=0&&d-u>=0&&p-f>=0)return p$.subVectors(s,i),a=(d-u)/(d-u+(p-f)),n.copy(i).addScaledVector(p$,a);const E=1/(y+g+h);return o=g*E,a=h*E,n.copy(r).addScaledVector(rb,o).addScaledVector(ib,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const rW={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vv={h:0,s:0,l:0},i1={h:0,s:0,l:0};function XN(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class Ei{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Lo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ki.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=ki.workingColorSpace){return this.r=e,this.g=n,this.b=r,ki.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=ki.workingColorSpace){if(e=YF(e,1),n=Rl(n,0,1),r=Rl(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=XN(o,s,e+1/3),this.g=XN(o,s,e),this.b=XN(o,s,e-1/3)}return ki.toWorkingColorSpace(this,i),this}setStyle(e,n=Lo){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Lo){const r=rW[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=eg(e.r),this.g=eg(e.g),this.b=eg(e.b),this}copyLinearToSRGB(e){return this.r=nE(e.r),this.g=nE(e.g),this.b=nE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Lo){return ki.fromWorkingColorSpace(jc.copy(this),e),Math.round(Rl(jc.r*255,0,255))*65536+Math.round(Rl(jc.g*255,0,255))*256+Math.round(Rl(jc.b*255,0,255))}getHexString(e=Lo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=ki.workingColorSpace){ki.fromWorkingColorSpace(jc.copy(this),n);const r=jc.r,i=jc.g,s=jc.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const d=o-a;switch(l=u<=.5?d/(o+a):d/(2-o-a),o){case r:c=(i-s)/d+(i<s?6:0);break;case i:c=(s-r)/d+2;break;case s:c=(r-i)/d+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=ki.workingColorSpace){return ki.fromWorkingColorSpace(jc.copy(this),n),e.r=jc.r,e.g=jc.g,e.b=jc.b,e}getStyle(e=Lo){ki.fromWorkingColorSpace(jc.copy(this),e);const n=jc.r,r=jc.g,i=jc.b;return e!==Lo?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(vv),this.setHSL(vv.h+e,vv.s+n,vv.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(vv),e.getHSL(i1);const r=fT(vv.h,i1.h,n),i=fT(vv.s,i1.s,n),s=fT(vv.l,i1.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const jc=new Ei;Ei.NAMES=rW;let $ie=0;class _g extends vg{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$ie++}),this.uuid=aS(),this.name="",this.blending=eE,this.side=ag,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=yL,this.blendDst=bL,this.blendEquation=x0,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ei(0,0,0),this.blendAlpha=0,this.depthFunc=EE,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Xj,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Yy,this.stencilZFail=Yy,this.stencilZPass=Yy,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const i=this[n];if(i===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==eE&&(r.blending=this.blending),this.side!==ag&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==yL&&(r.blendSrc=this.blendSrc),this.blendDst!==bL&&(r.blendDst=this.blendDst),this.blendEquation!==x0&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==EE&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Xj&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Yy&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Yy&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Yy&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(n){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const i=n.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=n[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class JF extends _g{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new Ei(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new cg,this.combine=BG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const na=new ht,s1=new Vn;class oo{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=Jj,this.updateRanges=[],this.gpuType=cp,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=n.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)s1.fromBufferAttribute(this,n),s1.applyMatrix3(e),this.setXY(n,s1.x,s1.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)na.fromBufferAttribute(this,n),na.applyMatrix3(e),this.setXYZ(n,na.x,na.y,na.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)na.fromBufferAttribute(this,n),na.applyMatrix4(e),this.setXYZ(n,na.x,na.y,na.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)na.fromBufferAttribute(this,n),na.applyNormalMatrix(e),this.setXYZ(n,na.x,na.y,na.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)na.fromBufferAttribute(this,n),na.transformDirection(e),this.setXYZ(n,na.x,na.y,na.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=Rb(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=El(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=Rb(n,this.array)),n}setX(e,n){return this.normalized&&(n=El(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=Rb(n,this.array)),n}setY(e,n){return this.normalized&&(n=El(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=Rb(n,this.array)),n}setZ(e,n){return this.normalized&&(n=El(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=Rb(n,this.array)),n}setW(e,n){return this.normalized&&(n=El(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=El(n,this.array),r=El(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,i){return e*=this.itemSize,this.normalized&&(n=El(n,this.array),r=El(r,this.array),i=El(i,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,n,r,i,s){return e*=this.itemSize,this.normalized&&(n=El(n,this.array),r=El(r,this.array),i=El(i,this.array),s=El(s,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Jj&&(e.usage=this.usage),e}}class iW extends oo{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class sW extends oo{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class L0 extends oo{constructor(e,n,r){super(new Float32Array(e),n,r)}}let Hie=0;const Sd=new To,JN=new cu,sb=new ht,Uu=new Ew,PS=new Ew,Ya=new ht;class Yh extends vg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Hie++}),this.uuid=aS(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(eW(e)?sW:iW)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Wr().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Sd.makeRotationFromQuaternion(e),this.applyMatrix4(Sd),this}rotateX(e){return Sd.makeRotationX(e),this.applyMatrix4(Sd),this}rotateY(e){return Sd.makeRotationY(e),this.applyMatrix4(Sd),this}rotateZ(e){return Sd.makeRotationZ(e),this.applyMatrix4(Sd),this}translate(e,n,r){return Sd.makeTranslation(e,n,r),this.applyMatrix4(Sd),this}scale(e,n,r){return Sd.makeScale(e,n,r),this.applyMatrix4(Sd),this}lookAt(e){return JN.lookAt(e),JN.updateMatrix(),this.applyMatrix4(JN.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(sb).negate(),this.translate(sb.x,sb.y,sb.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];r.push(o.x,o.y,o.z||0)}this.setAttribute("position",new L0(r,3))}else{for(let r=0,i=n.count;r<i;r++){const s=e[r];n.setXYZ(r,s.x,s.y,s.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ew);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ht(-1/0,-1/0,-1/0),new ht(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,i=n.length;r<i;r++){const s=n[r];Uu.setFromBufferAttribute(s),this.morphTargetsRelative?(Ya.addVectors(this.boundingBox.min,Uu.min),this.boundingBox.expandByPoint(Ya),Ya.addVectors(this.boundingBox.max,Uu.max),this.boundingBox.expandByPoint(Ya)):(this.boundingBox.expandByPoint(Uu.min),this.boundingBox.expandByPoint(Uu.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ZA);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ht,1/0);return}if(e){const r=this.boundingSphere.center;if(Uu.setFromBufferAttribute(e),n)for(let s=0,o=n.length;s<o;s++){const a=n[s];PS.setFromBufferAttribute(a),this.morphTargetsRelative?(Ya.addVectors(Uu.min,PS.min),Uu.expandByPoint(Ya),Ya.addVectors(Uu.max,PS.max),Uu.expandByPoint(Ya)):(Uu.expandByPoint(PS.min),Uu.expandByPoint(PS.max))}Uu.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)Ya.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Ya));if(n)for(let s=0,o=n.length;s<o;s++){const a=n[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Ya.fromBufferAttribute(a,l),c&&(sb.fromBufferAttribute(e,l),Ya.add(sb)),i=Math.max(i,r.distanceToSquared(Ya))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,i=n.normal,s=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new oo(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let U=0;U<r.count;U++)a[U]=new ht,c[U]=new ht;const l=new ht,u=new ht,d=new ht,h=new Vn,p=new Vn,f=new Vn,g=new ht,y=new ht;function E(U,F,$){l.fromBufferAttribute(r,U),u.fromBufferAttribute(r,F),d.fromBufferAttribute(r,$),h.fromBufferAttribute(s,U),p.fromBufferAttribute(s,F),f.fromBufferAttribute(s,$),u.sub(l),d.sub(l),p.sub(h),f.sub(h);const q=1/(p.x*f.y-f.x*p.y);isFinite(q)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-p.y).multiplyScalar(q),y.copy(d).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(q),a[U].add(g),a[F].add(g),a[$].add(g),c[U].add(y),c[F].add(y),c[$].add(y))}let w=this.groups;w.length===0&&(w=[{start:0,count:e.count}]);for(let U=0,F=w.length;U<F;++U){const $=w[U],q=$.start,K=$.count;for(let W=q,X=q+K;W<X;W+=3)E(e.getX(W+0),e.getX(W+1),e.getX(W+2))}const R=new ht,A=new ht,k=new ht,I=new ht;function N(U){k.fromBufferAttribute(i,U),I.copy(k);const F=a[U];R.copy(F),R.sub(k.multiplyScalar(k.dot(F))).normalize(),A.crossVectors(I,F);const q=A.dot(c[U])<0?-1:1;o.setXYZW(U,R.x,R.y,R.z,q)}for(let U=0,F=w.length;U<F;++U){const $=w[U],q=$.start,K=$.count;for(let W=q,X=q+K;W<X;W+=3)N(e.getX(W+0)),N(e.getX(W+1)),N(e.getX(W+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new oo(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let h=0,p=r.count;h<p;h++)r.setXYZ(h,0,0,0);const i=new ht,s=new ht,o=new ht,a=new ht,c=new ht,l=new ht,u=new ht,d=new ht;if(e)for(let h=0,p=e.count;h<p;h+=3){const f=e.getX(h+0),g=e.getX(h+1),y=e.getX(h+2);i.fromBufferAttribute(n,f),s.fromBufferAttribute(n,g),o.fromBufferAttribute(n,y),u.subVectors(o,s),d.subVectors(i,s),u.cross(d),a.fromBufferAttribute(r,f),c.fromBufferAttribute(r,g),l.fromBufferAttribute(r,y),a.add(u),c.add(u),l.add(u),r.setXYZ(f,a.x,a.y,a.z),r.setXYZ(g,c.x,c.y,c.z),r.setXYZ(y,l.x,l.y,l.z)}else for(let h=0,p=n.count;h<p;h+=3)i.fromBufferAttribute(n,h+0),s.fromBufferAttribute(n,h+1),o.fromBufferAttribute(n,h+2),u.subVectors(o,s),d.subVectors(i,s),u.cross(d),r.setXYZ(h+0,u.x,u.y,u.z),r.setXYZ(h+1,u.x,u.y,u.z),r.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)Ya.fromBufferAttribute(e,n),Ya.normalize(),e.setXYZ(n,Ya.x,Ya.y,Ya.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,d=a.normalized,h=new l.constructor(c.length*u);let p=0,f=0;for(let g=0,y=c.length;g<y;g++){a.isInterleavedBufferAttribute?p=c[g]*a.data.stride+a.offset:p=c[g]*u;for(let E=0;E<u;E++)h[f++]=l[p++]}return new oo(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new Yh,r=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=e(c,r);n.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,d=l.length;u<d;u++){const h=l[u],p=e(h,r);c.push(p)}n.morphAttributes[a]=c}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];n.addGroup(l.start,l.count,l.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const c in r){const l=r[c];e.data.attributes[c]=l.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let d=0,h=l.length;d<h;d++){const p=l[d];u.push(p.toJSON(e.data))}u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(n));const i=e.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(n))}const s=e.morphAttributes;for(const l in s){const u=[],d=s[l];for(let h=0,p=d.length;h<p;h++)u.push(d[h].clone(n));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const d=o[l];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const m$=new To,o0=new XF,o1=new ZA,g$=new ht,a1=new ht,c1=new ht,l1=new ht,QN=new ht,u1=new ht,v$=new ht,d1=new ht;class Dh extends cu{constructor(e=new Yh,n=new JF){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,n){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,o=r.morphTargetsRelative;n.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){u1.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c],d=s[c];u!==0&&(QN.fromBufferAttribute(d,e),o?u1.addScaledVector(QN,u):u1.addScaledVector(QN.sub(n),u))}n.add(u1)}return n}raycast(e,n){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),o1.copy(r.boundingSphere),o1.applyMatrix4(s),o0.copy(e.ray).recast(e.near),!(o1.containsPoint(o0.origin)===!1&&(o0.intersectSphere(o1,g$)===null||o0.origin.distanceToSquared(g$)>(e.far-e.near)**2))&&(m$.copy(s).invert(),o0.copy(e.ray).applyMatrix4(m$),!(r.boundingBox!==null&&o0.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,o0)))}_computeIntersections(e,n,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,h=s.groups,p=s.drawRange;if(a!==null)if(Array.isArray(o))for(let f=0,g=h.length;f<g;f++){const y=h[f],E=o[y.materialIndex],w=Math.max(y.start,p.start),R=Math.min(a.count,Math.min(y.start+y.count,p.start+p.count));for(let A=w,k=R;A<k;A+=3){const I=a.getX(A),N=a.getX(A+1),U=a.getX(A+2);i=h1(this,E,e,r,l,u,d,I,N,U),i&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=y.materialIndex,n.push(i))}}else{const f=Math.max(0,p.start),g=Math.min(a.count,p.start+p.count);for(let y=f,E=g;y<E;y+=3){const w=a.getX(y),R=a.getX(y+1),A=a.getX(y+2);i=h1(this,o,e,r,l,u,d,w,R,A),i&&(i.faceIndex=Math.floor(y/3),n.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let f=0,g=h.length;f<g;f++){const y=h[f],E=o[y.materialIndex],w=Math.max(y.start,p.start),R=Math.min(c.count,Math.min(y.start+y.count,p.start+p.count));for(let A=w,k=R;A<k;A+=3){const I=A,N=A+1,U=A+2;i=h1(this,E,e,r,l,u,d,I,N,U),i&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=y.materialIndex,n.push(i))}}else{const f=Math.max(0,p.start),g=Math.min(c.count,p.start+p.count);for(let y=f,E=g;y<E;y+=3){const w=y,R=y+1,A=y+2;i=h1(this,o,e,r,l,u,d,w,R,A),i&&(i.faceIndex=Math.floor(y/3),n.push(i))}}}}function Vie(t,e,n,r,i,s,o,a){let c;if(e.side===sc?c=r.intersectTriangle(o,s,i,!0,a):c=r.intersectTriangle(i,s,o,e.side===ag,a),c===null)return null;d1.copy(a),d1.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(d1);return l<n.near||l>n.far?null:{distance:l,point:d1.clone(),object:t}}function h1(t,e,n,r,i,s,o,a,c,l){t.getVertexPosition(a,a1),t.getVertexPosition(c,c1),t.getVertexPosition(l,l1);const u=Vie(t,e,n,r,a1,c1,l1,v$);if(u){const d=new ht;kh.getBarycoord(v$,a1,c1,l1,d),i&&(u.uv=kh.getInterpolatedAttribute(i,a,c,l,d,new Vn)),s&&(u.uv1=kh.getInterpolatedAttribute(s,a,c,l,d,new Vn)),o&&(u.normal=kh.getInterpolatedAttribute(o,a,c,l,d,new ht),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:c,c:l,normal:new ht,materialIndex:0};kh.getNormal(a1,c1,l1,h.normal),u.face=h,u.barycoord=d}return u}class Sw extends Yh{constructor(e=1,n=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],d=[];let h=0,p=0;f("z","y","x",-1,-1,r,n,e,o,s,0),f("z","y","x",1,-1,r,n,-e,o,s,1),f("x","z","y",1,1,e,r,n,i,o,2),f("x","z","y",1,-1,e,r,-n,i,o,3),f("x","y","z",1,-1,e,n,r,i,s,4),f("x","y","z",-1,-1,e,n,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new L0(l,3)),this.setAttribute("normal",new L0(u,3)),this.setAttribute("uv",new L0(d,2));function f(g,y,E,w,R,A,k,I,N,U,F){const $=A/N,q=k/U,K=A/2,W=k/2,X=I/2,ne=N+1,Z=U+1;let ie=0,G=0;const Q=new ht;for(let se=0;se<Z;se++){const ve=se*q-W;for(let Oe=0;Oe<ne;Oe++){const _e=Oe*$-K;Q[g]=_e*w,Q[y]=ve*R,Q[E]=X,l.push(Q.x,Q.y,Q.z),Q[g]=0,Q[y]=0,Q[E]=I>0?1:-1,u.push(Q.x,Q.y,Q.z),d.push(Oe/N),d.push(1-se/U),ie+=1}}for(let se=0;se<U;se++)for(let ve=0;ve<N;ve++){const Oe=h+ve+ne*se,_e=h+ve+ne*(se+1),le=h+(ve+1)+ne*(se+1),xe=h+(ve+1)+ne*se;c.push(Oe,_e,xe),c.push(_e,le,xe),G+=6}a.addGroup(p,G,F),p+=G,h+=ie}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sw(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function wE(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function Sl(t){const e={};for(let n=0;n<t.length;n++){const r=wE(t[n]);for(const i in r)e[i]=r[i]}return e}function zie(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function oW(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ki.workingColorSpace}const Gie={clone:wE,merge:Sl};var Wie=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,qie=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Il extends _g{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Wie,this.fragmentShader=qie,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=wE(e.uniforms),this.uniformsGroups=zie(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?n.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?n.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?n.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?n.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?n.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?n.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?n.uniforms[i]={type:"m4",value:o.toArray()}:n.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}class eM extends cu{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new To,this.projectionMatrix=new To,this.projectionMatrixInverse=new To,this.coordinateSystem=Ym}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v=new ht,_$=new Vn,y$=new Vn;class ju extends eM{constructor(e=50,n=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=AT*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(hT*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return AT*2*Math.atan(Math.tan(hT*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){_v.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(_v.x,_v.y).multiplyScalar(-e/_v.z),_v.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(_v.x,_v.y).multiplyScalar(-e/_v.z)}getViewSize(e,n){return this.getViewBounds(e,_$,y$),n.subVectors(y$,_$)}setViewOffset(e,n,r,i,s,o){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(hT*.5*this.fov)/this.zoom,r=2*n,i=this.aspect*r,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,n-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const ob=-90,ab=1;class Kie extends cu{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new ju(ob,ab,e,n);i.layers=this.layers,this.add(i);const s=new ju(ob,ab,e,n);s.layers=this.layers,this.add(s);const o=new ju(ob,ab,e,n);o.layers=this.layers,this.add(o);const a=new ju(ob,ab,e,n);a.layers=this.layers,this.add(a);const c=new ju(ob,ab,e,n);c.layers=this.layers,this.add(c);const l=new ju(ob,ab,e,n);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,i,s,o,a,c]=n;for(const l of n)this.remove(l);if(e===Ym)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===yR)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of n)this.add(l),l.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const g=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(n,s),e.setRenderTarget(r,1,i),e.render(n,o),e.setRenderTarget(r,2,i),e.render(n,a),e.setRenderTarget(r,3,i),e.render(n,c),e.setRenderTarget(r,4,i),e.render(n,l),r.texture.generateMipmaps=g,e.setRenderTarget(r,5,i),e.render(n,u),e.setRenderTarget(d,h,p),e.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class aW extends So{constructor(e,n,r,i,s,o,a,c,l,u){e=e!==void 0?e:[],n=n!==void 0?n:SE,super(e,n,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Yie extends Zu{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new aW(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:ru}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Sw(5,5,5),s=new Il({name:"CubemapFromEquirect",uniforms:wE(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:sc,blending:Bh});s.uniforms.tEquirect.value=n;const o=new Dh(i,s),a=n.minFilter;return n.minFilter===I0&&(n.minFilter=ru),new Kie(1,10,this).update(e,o),n.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,n,r,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(n,r,i);e.setRenderTarget(s)}}const ZN=new ht,Xie=new ht,Jie=new Wr;class Rh{constructor(e=new ht(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,i){return this.normal.set(e,n,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const i=ZN.subVectors(r,n).cross(Xie.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(ZN),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:n.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||Jie.getNormalMatrix(e),i=this.coplanarPoint(ZN).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const a0=new ZA,f1=new ht;class cW{constructor(e=new Rh,n=new Rh,r=new Rh,i=new Rh,s=new Rh,o=new Rh){this.planes=[e,n,r,i,s,o]}set(e,n,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=Ym){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],d=i[6],h=i[7],p=i[8],f=i[9],g=i[10],y=i[11],E=i[12],w=i[13],R=i[14],A=i[15];if(r[0].setComponents(c-s,h-l,y-p,A-E).normalize(),r[1].setComponents(c+s,h+l,y+p,A+E).normalize(),r[2].setComponents(c+o,h+u,y+f,A+w).normalize(),r[3].setComponents(c-o,h-u,y-f,A-w).normalize(),r[4].setComponents(c-a,h-d,y-g,A-R).normalize(),n===Ym)r[5].setComponents(c+a,h+d,y+g,A+R).normalize();else if(n===yR)r[5].setComponents(a,d,g,R).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),a0.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),a0.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(a0)}intersectsSprite(e){return a0.center.set(0,0,0),a0.radius=.7071067811865476,a0.applyMatrix4(e.matrixWorld),this.intersectsSphere(a0)}intersectsSphere(e){const n=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const i=n[r];if(f1.x=i.normal.x>0?e.max.x:e.min.x,f1.y=i.normal.y>0?e.max.y:e.min.y,f1.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(f1)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function lW(){let t=null,e=!1,n=null,r=null;function i(s,o){n(s,o),r=t.requestAnimationFrame(i)}return{start:function(){e!==!0&&n!==null&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function Qie(t){const e=new WeakMap;function n(a,c){const l=a.array,u=a.usage,d=l.byteLength,h=t.createBuffer();t.bindBuffer(c,h),t.bufferData(c,l,u),a.onUploadCallback();let p;if(l instanceof Float32Array)p=t.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?p=t.HALF_FLOAT:p=t.UNSIGNED_SHORT;else if(l instanceof Int16Array)p=t.SHORT;else if(l instanceof Uint32Array)p=t.UNSIGNED_INT;else if(l instanceof Int32Array)p=t.INT;else if(l instanceof Int8Array)p=t.BYTE;else if(l instanceof Uint8Array)p=t.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)p=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:h,type:p,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:d}}function r(a,c,l){const u=c.array,d=c.updateRanges;if(t.bindBuffer(l,a),d.length===0)t.bufferSubData(l,0,u);else{d.sort((p,f)=>p.start-f.start);let h=0;for(let p=1;p<d.length;p++){const f=d[h],g=d[p];g.start<=f.start+f.count+1?f.count=Math.max(f.count,g.start+g.count-f.start):(++h,d[h]=g)}d.length=h+1;for(let p=0,f=d.length;p<f;p++){const g=d[p];t.bufferSubData(l,g.start*u.BYTES_PER_ELEMENT,u,g.start,g.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(t.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=e.get(a);if(l===void 0)e.set(a,n(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}class Tw extends Yh{constructor(e=1,n=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:i};const s=e/2,o=n/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,d=e/a,h=n/c,p=[],f=[],g=[],y=[];for(let E=0;E<u;E++){const w=E*h-o;for(let R=0;R<l;R++){const A=R*d-s;f.push(A,-w,0),g.push(0,0,1),y.push(R/a),y.push(1-E/c)}}for(let E=0;E<c;E++)for(let w=0;w<a;w++){const R=w+l*E,A=w+l*(E+1),k=w+1+l*(E+1),I=w+1+l*E;p.push(R,A,I),p.push(A,k,I)}this.setIndex(p),this.setAttribute("position",new L0(f,3)),this.setAttribute("normal",new L0(g,3)),this.setAttribute("uv",new L0(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tw(e.width,e.height,e.widthSegments,e.heightSegments)}}var Zie=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,ese=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,tse=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,nse=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,rse=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,ise=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,sse=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ose=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ase=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,cse=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,lse=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,use=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,dse=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,hse=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,fse=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,pse=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,mse=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,gse=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,vse=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,_se=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,yse=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,bse=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Ese=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Sse=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Tse=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,wse=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,xse=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Cse=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Rse=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ase=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Mse="gl_FragColor = linearToOutputTexel( gl_FragColor );",Ise=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Ose=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,kse=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Nse=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Pse=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Dse=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Lse=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Use=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Fse=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Bse=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,jse=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,$se=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Hse=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Vse=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,zse=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Gse=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Wse=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,qse=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Kse=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Yse=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Xse=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Jse=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Qse=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Zse=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,eoe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,toe=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,noe=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,roe=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ioe=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,soe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,ooe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,aoe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,coe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,loe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,uoe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,doe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,hoe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,foe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,poe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,moe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,goe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,voe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,_oe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,yoe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,boe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Eoe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Soe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Toe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,woe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,xoe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Coe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Roe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Aoe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Moe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Ioe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Ooe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,koe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Noe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Poe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Doe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Loe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Uoe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Foe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Boe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,joe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,$oe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Hoe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Voe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,zoe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Goe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Woe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,qoe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Koe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Yoe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Xoe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Joe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Qoe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Zoe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,eae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,tae=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,nae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,rae=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,iae=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,sae=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,oae=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,aae=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,cae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,lae=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,uae=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,dae=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,hae=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fae=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pae=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mae=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gae=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,vae=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_ae=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,yae=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,bae=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Eae=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Sae=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Tae=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wae=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xae=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cae=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Rae=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Aae=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Mae=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Iae=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Oae=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Kr={alphahash_fragment:Zie,alphahash_pars_fragment:ese,alphamap_fragment:tse,alphamap_pars_fragment:nse,alphatest_fragment:rse,alphatest_pars_fragment:ise,aomap_fragment:sse,aomap_pars_fragment:ose,batching_pars_vertex:ase,batching_vertex:cse,begin_vertex:lse,beginnormal_vertex:use,bsdfs:dse,iridescence_fragment:hse,bumpmap_pars_fragment:fse,clipping_planes_fragment:pse,clipping_planes_pars_fragment:mse,clipping_planes_pars_vertex:gse,clipping_planes_vertex:vse,color_fragment:_se,color_pars_fragment:yse,color_pars_vertex:bse,color_vertex:Ese,common:Sse,cube_uv_reflection_fragment:Tse,defaultnormal_vertex:wse,displacementmap_pars_vertex:xse,displacementmap_vertex:Cse,emissivemap_fragment:Rse,emissivemap_pars_fragment:Ase,colorspace_fragment:Mse,colorspace_pars_fragment:Ise,envmap_fragment:Ose,envmap_common_pars_fragment:kse,envmap_pars_fragment:Nse,envmap_pars_vertex:Pse,envmap_physical_pars_fragment:Gse,envmap_vertex:Dse,fog_vertex:Lse,fog_pars_vertex:Use,fog_fragment:Fse,fog_pars_fragment:Bse,gradientmap_pars_fragment:jse,lightmap_pars_fragment:$se,lights_lambert_fragment:Hse,lights_lambert_pars_fragment:Vse,lights_pars_begin:zse,lights_toon_fragment:Wse,lights_toon_pars_fragment:qse,lights_phong_fragment:Kse,lights_phong_pars_fragment:Yse,lights_physical_fragment:Xse,lights_physical_pars_fragment:Jse,lights_fragment_begin:Qse,lights_fragment_maps:Zse,lights_fragment_end:eoe,logdepthbuf_fragment:toe,logdepthbuf_pars_fragment:noe,logdepthbuf_pars_vertex:roe,logdepthbuf_vertex:ioe,map_fragment:soe,map_pars_fragment:ooe,map_particle_fragment:aoe,map_particle_pars_fragment:coe,metalnessmap_fragment:loe,metalnessmap_pars_fragment:uoe,morphinstance_vertex:doe,morphcolor_vertex:hoe,morphnormal_vertex:foe,morphtarget_pars_vertex:poe,morphtarget_vertex:moe,normal_fragment_begin:goe,normal_fragment_maps:voe,normal_pars_fragment:_oe,normal_pars_vertex:yoe,normal_vertex:boe,normalmap_pars_fragment:Eoe,clearcoat_normal_fragment_begin:Soe,clearcoat_normal_fragment_maps:Toe,clearcoat_pars_fragment:woe,iridescence_pars_fragment:xoe,opaque_fragment:Coe,packing:Roe,premultiplied_alpha_fragment:Aoe,project_vertex:Moe,dithering_fragment:Ioe,dithering_pars_fragment:Ooe,roughnessmap_fragment:koe,roughnessmap_pars_fragment:Noe,shadowmap_pars_fragment:Poe,shadowmap_pars_vertex:Doe,shadowmap_vertex:Loe,shadowmask_pars_fragment:Uoe,skinbase_vertex:Foe,skinning_pars_vertex:Boe,skinning_vertex:joe,skinnormal_vertex:$oe,specularmap_fragment:Hoe,specularmap_pars_fragment:Voe,tonemapping_fragment:zoe,tonemapping_pars_fragment:Goe,transmission_fragment:Woe,transmission_pars_fragment:qoe,uv_pars_fragment:Koe,uv_pars_vertex:Yoe,uv_vertex:Xoe,worldpos_vertex:Joe,background_vert:Qoe,background_frag:Zoe,backgroundCube_vert:eae,backgroundCube_frag:tae,cube_vert:nae,cube_frag:rae,depth_vert:iae,depth_frag:sae,distanceRGBA_vert:oae,distanceRGBA_frag:aae,equirect_vert:cae,equirect_frag:lae,linedashed_vert:uae,linedashed_frag:dae,meshbasic_vert:hae,meshbasic_frag:fae,meshlambert_vert:pae,meshlambert_frag:mae,meshmatcap_vert:gae,meshmatcap_frag:vae,meshnormal_vert:_ae,meshnormal_frag:yae,meshphong_vert:bae,meshphong_frag:Eae,meshphysical_vert:Sae,meshphysical_frag:Tae,meshtoon_vert:wae,meshtoon_frag:xae,points_vert:Cae,points_frag:Rae,shadow_vert:Aae,shadow_frag:Mae,sprite_vert:Iae,sprite_frag:Oae},un={common:{diffuse:{value:new Ei(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Wr},alphaMap:{value:null},alphaMapTransform:{value:new Wr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Wr}},envmap:{envMap:{value:null},envMapRotation:{value:new Wr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Wr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Wr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Wr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Wr},normalScale:{value:new Vn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Wr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Wr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Wr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Wr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ei(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ei(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Wr},alphaTest:{value:0},uvTransform:{value:new Wr}},sprite:{diffuse:{value:new Ei(16777215)},opacity:{value:1},center:{value:new Vn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Wr},alphaMap:{value:null},alphaMapTransform:{value:new Wr},alphaTest:{value:0}}},Jf={basic:{uniforms:Sl([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.fog]),vertexShader:Kr.meshbasic_vert,fragmentShader:Kr.meshbasic_frag},lambert:{uniforms:Sl([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new Ei(0)}}]),vertexShader:Kr.meshlambert_vert,fragmentShader:Kr.meshlambert_frag},phong:{uniforms:Sl([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new Ei(0)},specular:{value:new Ei(1118481)},shininess:{value:30}}]),vertexShader:Kr.meshphong_vert,fragmentShader:Kr.meshphong_frag},standard:{uniforms:Sl([un.common,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.roughnessmap,un.metalnessmap,un.fog,un.lights,{emissive:{value:new Ei(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Kr.meshphysical_vert,fragmentShader:Kr.meshphysical_frag},toon:{uniforms:Sl([un.common,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.gradientmap,un.fog,un.lights,{emissive:{value:new Ei(0)}}]),vertexShader:Kr.meshtoon_vert,fragmentShader:Kr.meshtoon_frag},matcap:{uniforms:Sl([un.common,un.bumpmap,un.normalmap,un.displacementmap,un.fog,{matcap:{value:null}}]),vertexShader:Kr.meshmatcap_vert,fragmentShader:Kr.meshmatcap_frag},points:{uniforms:Sl([un.points,un.fog]),vertexShader:Kr.points_vert,fragmentShader:Kr.points_frag},dashed:{uniforms:Sl([un.common,un.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Kr.linedashed_vert,fragmentShader:Kr.linedashed_frag},depth:{uniforms:Sl([un.common,un.displacementmap]),vertexShader:Kr.depth_vert,fragmentShader:Kr.depth_frag},normal:{uniforms:Sl([un.common,un.bumpmap,un.normalmap,un.displacementmap,{opacity:{value:1}}]),vertexShader:Kr.meshnormal_vert,fragmentShader:Kr.meshnormal_frag},sprite:{uniforms:Sl([un.sprite,un.fog]),vertexShader:Kr.sprite_vert,fragmentShader:Kr.sprite_frag},background:{uniforms:{uvTransform:{value:new Wr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Kr.background_vert,fragmentShader:Kr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Wr}},vertexShader:Kr.backgroundCube_vert,fragmentShader:Kr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Kr.cube_vert,fragmentShader:Kr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Kr.equirect_vert,fragmentShader:Kr.equirect_frag},distanceRGBA:{uniforms:Sl([un.common,un.displacementmap,{referencePosition:{value:new ht},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Kr.distanceRGBA_vert,fragmentShader:Kr.distanceRGBA_frag},shadow:{uniforms:Sl([un.lights,un.fog,{color:{value:new Ei(0)},opacity:{value:1}}]),vertexShader:Kr.shadow_vert,fragmentShader:Kr.shadow_frag}};Jf.physical={uniforms:Sl([Jf.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Wr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Wr},clearcoatNormalScale:{value:new Vn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Wr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Wr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Wr},sheen:{value:0},sheenColor:{value:new Ei(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Wr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Wr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Wr},transmissionSamplerSize:{value:new Vn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Wr},attenuationDistance:{value:0},attenuationColor:{value:new Ei(0)},specularColor:{value:new Ei(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Wr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Wr},anisotropyVector:{value:new Vn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Wr}}]),vertexShader:Kr.meshphysical_vert,fragmentShader:Kr.meshphysical_frag};const p1={r:0,b:0,g:0},c0=new cg,kae=new To;function Nae(t,e,n,r,i,s,o){const a=new Ei(0);let c=s===!0?0:1,l,u,d=null,h=0,p=null;function f(w){let R=w.isScene===!0?w.background:null;return R&&R.isTexture&&(R=(w.backgroundBlurriness>0?n:e).get(R)),R}function g(w){let R=!1;const A=f(w);A===null?E(a,c):A&&A.isColor&&(E(A,1),R=!0);const k=t.xr.getEnvironmentBlendMode();k==="additive"?r.buffers.color.setClear(0,0,0,1,o):k==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,o),(t.autoClear||R)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function y(w,R){const A=f(R);A&&(A.isCubeTexture||A.mapping===XA)?(u===void 0&&(u=new Dh(new Sw(1,1,1),new Il({name:"BackgroundCubeMaterial",uniforms:wE(Jf.backgroundCube.uniforms),vertexShader:Jf.backgroundCube.vertexShader,fragmentShader:Jf.backgroundCube.fragmentShader,side:sc,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(k,I,N){this.matrixWorld.copyPosition(N.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),c0.copy(R.backgroundRotation),c0.x*=-1,c0.y*=-1,c0.z*=-1,A.isCubeTexture&&A.isRenderTargetTexture===!1&&(c0.y*=-1,c0.z*=-1),u.material.uniforms.envMap.value=A,u.material.uniforms.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=R.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=R.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(kae.makeRotationFromEuler(c0)),u.material.toneMapped=ki.getTransfer(A.colorSpace)!==es,(d!==A||h!==A.version||p!==t.toneMapping)&&(u.material.needsUpdate=!0,d=A,h=A.version,p=t.toneMapping),u.layers.enableAll(),w.unshift(u,u.geometry,u.material,0,0,null)):A&&A.isTexture&&(l===void 0&&(l=new Dh(new Tw(2,2),new Il({name:"BackgroundMaterial",uniforms:wE(Jf.background.uniforms),vertexShader:Jf.background.vertexShader,fragmentShader:Jf.background.fragmentShader,side:ag,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=A,l.material.uniforms.backgroundIntensity.value=R.backgroundIntensity,l.material.toneMapped=ki.getTransfer(A.colorSpace)!==es,A.matrixAutoUpdate===!0&&A.updateMatrix(),l.material.uniforms.uvTransform.value.copy(A.matrix),(d!==A||h!==A.version||p!==t.toneMapping)&&(l.material.needsUpdate=!0,d=A,h=A.version,p=t.toneMapping),l.layers.enableAll(),w.unshift(l,l.geometry,l.material,0,0,null))}function E(w,R){w.getRGB(p1,oW(t)),r.buffers.color.setClear(p1.r,p1.g,p1.b,R,o)}return{getClearColor:function(){return a},setClearColor:function(w,R=1){a.set(w),c=R,E(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(w){c=w,E(a,c)},render:g,addToRenderList:y}}function Pae(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=h(null);let s=i,o=!1;function a($,q,K,W,X){let ne=!1;const Z=d(W,K,q);s!==Z&&(s=Z,l(s.object)),ne=p($,W,K,X),ne&&f($,W,K,X),X!==null&&e.update(X,t.ELEMENT_ARRAY_BUFFER),(ne||o)&&(o=!1,A($,q,K,W),X!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(X).buffer))}function c(){return t.createVertexArray()}function l($){return t.bindVertexArray($)}function u($){return t.deleteVertexArray($)}function d($,q,K){const W=K.wireframe===!0;let X=r[$.id];X===void 0&&(X={},r[$.id]=X);let ne=X[q.id];ne===void 0&&(ne={},X[q.id]=ne);let Z=ne[W];return Z===void 0&&(Z=h(c()),ne[W]=Z),Z}function h($){const q=[],K=[],W=[];for(let X=0;X<n;X++)q[X]=0,K[X]=0,W[X]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:q,enabledAttributes:K,attributeDivisors:W,object:$,attributes:{},index:null}}function p($,q,K,W){const X=s.attributes,ne=q.attributes;let Z=0;const ie=K.getAttributes();for(const G in ie)if(ie[G].location>=0){const se=X[G];let ve=ne[G];if(ve===void 0&&(G==="instanceMatrix"&&$.instanceMatrix&&(ve=$.instanceMatrix),G==="instanceColor"&&$.instanceColor&&(ve=$.instanceColor)),se===void 0||se.attribute!==ve||ve&&se.data!==ve.data)return!0;Z++}return s.attributesNum!==Z||s.index!==W}function f($,q,K,W){const X={},ne=q.attributes;let Z=0;const ie=K.getAttributes();for(const G in ie)if(ie[G].location>=0){let se=ne[G];se===void 0&&(G==="instanceMatrix"&&$.instanceMatrix&&(se=$.instanceMatrix),G==="instanceColor"&&$.instanceColor&&(se=$.instanceColor));const ve={};ve.attribute=se,se&&se.data&&(ve.data=se.data),X[G]=ve,Z++}s.attributes=X,s.attributesNum=Z,s.index=W}function g(){const $=s.newAttributes;for(let q=0,K=$.length;q<K;q++)$[q]=0}function y($){E($,0)}function E($,q){const K=s.newAttributes,W=s.enabledAttributes,X=s.attributeDivisors;K[$]=1,W[$]===0&&(t.enableVertexAttribArray($),W[$]=1),X[$]!==q&&(t.vertexAttribDivisor($,q),X[$]=q)}function w(){const $=s.newAttributes,q=s.enabledAttributes;for(let K=0,W=q.length;K<W;K++)q[K]!==$[K]&&(t.disableVertexAttribArray(K),q[K]=0)}function R($,q,K,W,X,ne,Z){Z===!0?t.vertexAttribIPointer($,q,K,X,ne):t.vertexAttribPointer($,q,K,W,X,ne)}function A($,q,K,W){g();const X=W.attributes,ne=K.getAttributes(),Z=q.defaultAttributeValues;for(const ie in ne){const G=ne[ie];if(G.location>=0){let Q=X[ie];if(Q===void 0&&(ie==="instanceMatrix"&&$.instanceMatrix&&(Q=$.instanceMatrix),ie==="instanceColor"&&$.instanceColor&&(Q=$.instanceColor)),Q!==void 0){const se=Q.normalized,ve=Q.itemSize,Oe=e.get(Q);if(Oe===void 0)continue;const _e=Oe.buffer,le=Oe.type,xe=Oe.bytesPerElement,Ee=le===t.INT||le===t.UNSIGNED_INT||Q.gpuType===zF;if(Q.isInterleavedBufferAttribute){const Se=Q.data,Ie=Se.stride,Ze=Q.offset;if(Se.isInstancedInterleavedBuffer){for(let _t=0;_t<G.locationSize;_t++)E(G.location+_t,Se.meshPerAttribute);$.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=Se.meshPerAttribute*Se.count)}else for(let _t=0;_t<G.locationSize;_t++)y(G.location+_t);t.bindBuffer(t.ARRAY_BUFFER,_e);for(let _t=0;_t<G.locationSize;_t++)R(G.location+_t,ve/G.locationSize,le,se,Ie*xe,(Ze+ve/G.locationSize*_t)*xe,Ee)}else{if(Q.isInstancedBufferAttribute){for(let Se=0;Se<G.locationSize;Se++)E(G.location+Se,Q.meshPerAttribute);$.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let Se=0;Se<G.locationSize;Se++)y(G.location+Se);t.bindBuffer(t.ARRAY_BUFFER,_e);for(let Se=0;Se<G.locationSize;Se++)R(G.location+Se,ve/G.locationSize,le,se,ve*xe,ve/G.locationSize*Se*xe,Ee)}}else if(Z!==void 0){const se=Z[ie];if(se!==void 0)switch(se.length){case 2:t.vertexAttrib2fv(G.location,se);break;case 3:t.vertexAttrib3fv(G.location,se);break;case 4:t.vertexAttrib4fv(G.location,se);break;default:t.vertexAttrib1fv(G.location,se)}}}}w()}function k(){U();for(const $ in r){const q=r[$];for(const K in q){const W=q[K];for(const X in W)u(W[X].object),delete W[X];delete q[K]}delete r[$]}}function I($){if(r[$.id]===void 0)return;const q=r[$.id];for(const K in q){const W=q[K];for(const X in W)u(W[X].object),delete W[X];delete q[K]}delete r[$.id]}function N($){for(const q in r){const K=r[q];if(K[$.id]===void 0)continue;const W=K[$.id];for(const X in W)u(W[X].object),delete W[X];delete K[$.id]}}function U(){F(),o=!0,s!==i&&(s=i,l(s.object))}function F(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:U,resetDefaultState:F,dispose:k,releaseStatesOfGeometry:I,releaseStatesOfProgram:N,initAttributes:g,enableAttribute:y,disableUnusedAttributes:w}}function Dae(t,e,n){let r;function i(l){r=l}function s(l,u){t.drawArrays(r,l,u),n.update(u,r,1)}function o(l,u,d){d!==0&&(t.drawArraysInstanced(r,l,u,d),n.update(u,r,d))}function a(l,u,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,u,0,d);let p=0;for(let f=0;f<d;f++)p+=u[f];n.update(p,r,1)}function c(l,u,d,h){if(d===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let f=0;f<l.length;f++)o(l[f],u[f],h[f]);else{p.multiDrawArraysInstancedWEBGL(r,l,0,u,0,h,0,d);let f=0;for(let g=0;g<d;g++)f+=u[g]*h[g];n.update(f,r,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function Lae(t,e,n,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const N=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(N.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(N){return!(N!==Od&&r.convert(N)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(N){const U=N===oS&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(N!==Yc&&r.convert(N)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&N!==cp&&!U)}function c(N){if(N==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";N="mediump"}return N==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=n.precision!==void 0?n.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const d=n.logarithmicDepthBuffer===!0,h=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),p=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),f=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=t.getParameter(t.MAX_TEXTURE_SIZE),y=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),E=t.getParameter(t.MAX_VERTEX_ATTRIBS),w=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),R=t.getParameter(t.MAX_VARYING_VECTORS),A=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),k=f>0,I=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:d,reverseDepthBuffer:h,maxTextures:p,maxVertexTextures:f,maxTextureSize:g,maxCubemapSize:y,maxAttributes:E,maxVertexUniforms:w,maxVaryings:R,maxFragmentUniforms:A,vertexTextures:k,maxSamples:I}}function Uae(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new Rh,a=new Wr,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const p=d.length!==0||h||r!==0||i;return i=h,r=d.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,h){n=u(d,h,0)},this.setState=function(d,h,p){const f=d.clippingPlanes,g=d.clipIntersection,y=d.clipShadows,E=t.get(d);if(!i||f===null||f.length===0||s&&!y)s?u(null):l();else{const w=s?0:r,R=w*4;let A=E.clippingState||null;c.value=A,A=u(f,h,R,p);for(let k=0;k!==R;++k)A[k]=n[k];E.clippingState=A,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=w}};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(d,h,p,f){const g=d!==null?d.length:0;let y=null;if(g!==0){if(y=c.value,f!==!0||y===null){const E=p+g*4,w=h.matrixWorldInverse;a.getNormalMatrix(w),(y===null||y.length<E)&&(y=new Float32Array(E));for(let R=0,A=p;R!==g;++R,A+=4)o.copy(d[R]).applyMatrix4(w,a),o.normal.toArray(y,A),y[A+3]=o.constant}c.value=y,c.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,y}}function Fae(t){let e=new WeakMap;function n(o,a){return a===AL?o.mapping=SE:a===ML&&(o.mapping=TE),o}function r(o){if(o&&o.isTexture){const a=o.mapping;if(a===AL||a===ML)if(e.has(o)){const c=e.get(o).texture;return n(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new Yie(c.height);return l.fromEquirectangularTexture(t,o),e.set(o,l),o.addEventListener("dispose",i),n(l.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}class QF extends eM{constructor(e=-1,n=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+n,c=i-n;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const jb=4,b$=[.125,.215,.35,.446,.526,.582],C0=20,eP=new QF,E$=new Ei;let tP=null,nP=0,rP=0,iP=!1;const _0=(1+Math.sqrt(5))/2,cb=1/_0,S$=[new ht(-_0,cb,0),new ht(_0,cb,0),new ht(-cb,0,_0),new ht(cb,0,_0),new ht(0,_0,-cb),new ht(0,_0,cb),new ht(-1,1,-1),new ht(1,1,-1),new ht(-1,1,1),new ht(1,1,1)];class T${constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,r=.1,i=100){tP=this._renderer.getRenderTarget(),nP=this._renderer.getActiveCubeFace(),rP=this._renderer.getActiveMipmapLevel(),iP=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,i,s),n>0&&this._blur(s,0,0,n),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=C$(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=x$(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(tP,nP,rP),this._renderer.xr.enabled=iP,e.scissorTest=!1,m1(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===SE||e.mapping===TE?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),tP=this._renderer.getRenderTarget(),nP=this._renderer.getActiveCubeFace(),rP=this._renderer.getActiveMipmapLevel(),iP=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:ru,minFilter:ru,generateMipmaps:!1,type:oS,format:Od,colorSpace:x_,depthBuffer:!1},i=w$(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=w$(e,n,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Bae(s)),this._blurMaterial=jae(s,e,n)}return i}_compileMaterial(e){const n=new Dh(this._lodPlanes[0],e);this._renderer.compile(n,eP)}_sceneToCubeUV(e,n,r,i){const a=new ju(90,1,n,r),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(E$),u.toneMapping=up,u.autoClear=!1;const p=new JF({name:"PMREM.Background",side:sc,depthWrite:!1,depthTest:!1}),f=new Dh(new Sw,p);let g=!1;const y=e.background;y?y.isColor&&(p.color.copy(y),e.background=null,g=!0):(p.color.copy(E$),g=!0);for(let E=0;E<6;E++){const w=E%3;w===0?(a.up.set(0,c[E],0),a.lookAt(l[E],0,0)):w===1?(a.up.set(0,0,c[E]),a.lookAt(0,l[E],0)):(a.up.set(0,c[E],0),a.lookAt(0,0,l[E]));const R=this._cubeSize;m1(i,w*R,E>2?R:0,R,R),u.setRenderTarget(i),g&&u.render(f,a),u.render(e,a)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=y}_textureToCubeUV(e,n){const r=this._renderer,i=e.mapping===SE||e.mapping===TE;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=C$()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=x$());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new Dh(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;m1(n,0,0,3*c,2*c),r.setRenderTarget(n),r.render(o,eP)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=S$[(i-s-1)%S$.length];this._blur(e,s-1,s,o,a)}n.autoClear=r}_blur(e,n,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,n,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,n,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new Dh(this._lodPlanes[i],l),h=l.uniforms,p=this._sizeLods[r]-1,f=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*C0-1),g=s/f,y=isFinite(s)?1+Math.floor(u*g):C0;y>C0&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${C0}`);const E=[];let w=0;for(let N=0;N<C0;++N){const U=N/g,F=Math.exp(-U*U/2);E.push(F),N===0?w+=F:N<y&&(w+=2*F)}for(let N=0;N<E.length;N++)E[N]=E[N]/w;h.envMap.value=e.texture,h.samples.value=y,h.weights.value=E,h.latitudinal.value=o==="latitudinal",a&&(h.poleAxis.value=a);const{_lodMax:R}=this;h.dTheta.value=f,h.mipInt.value=R-r;const A=this._sizeLods[i],k=3*A*(i>R-jb?i-R+jb:0),I=4*(this._cubeSize-A);m1(n,k,I,3*A,2*A),c.setRenderTarget(n),c.render(d,eP)}}function Bae(t){const e=[],n=[],r=[];let i=t;const s=t-jb+1+b$.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);n.push(a);let c=1/a;o>t-jb?c=b$[o-t+jb-1]:o===0&&(c=0),r.push(c);const l=1/(a-2),u=-l,d=1+l,h=[u,u,d,u,d,d,u,u,d,d,u,d],p=6,f=6,g=3,y=2,E=1,w=new Float32Array(g*f*p),R=new Float32Array(y*f*p),A=new Float32Array(E*f*p);for(let I=0;I<p;I++){const N=I%3*2/3-1,U=I>2?0:-1,F=[N,U,0,N+2/3,U,0,N+2/3,U+1,0,N,U,0,N+2/3,U+1,0,N,U+1,0];w.set(F,g*f*I),R.set(h,y*f*I);const $=[I,I,I,I,I,I];A.set($,E*f*I)}const k=new Yh;k.setAttribute("position",new oo(w,g)),k.setAttribute("uv",new oo(R,y)),k.setAttribute("faceIndex",new oo(A,E)),e.push(k),i>jb&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}function w$(t,e,n){const r=new Zu(t,e,n);return r.texture.mapping=XA,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function m1(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function jae(t,e,n){const r=new Float32Array(C0),i=new ht(0,1,0);return new Il({name:"SphericalGaussianBlur",defines:{n:C0,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:ZF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Bh,depthTest:!1,depthWrite:!1})}function x$(){return new Il({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:ZF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Bh,depthTest:!1,depthWrite:!1})}function C$(){return new Il({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:ZF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Bh,depthTest:!1,depthWrite:!1})}function ZF(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function $ae(t){let e=new WeakMap,n=null;function r(a){if(a&&a.isTexture){const c=a.mapping,l=c===AL||c===ML,u=c===SE||c===TE;if(l||u){let d=e.get(a);const h=d!==void 0?d.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==h)return n===null&&(n=new T$(t)),d=l?n.fromEquirectangular(a,d):n.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(d!==void 0)return d.texture;{const p=a.image;return l&&p&&p.height>0||u&&p&&i(p)?(n===null&&(n=new T$(t)),d=l?n.fromEquirectangular(a):n.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",s),d.texture):null}}}return a}function i(a){let c=0;const l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:o}}function Hae(t){const e={};function n(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(r)}return e[r]=i,i}return{has:function(r){return n(r)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(r){const i=n(r);return i===null&&QS("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Vae(t,e,n,r){const i={},s=new WeakMap;function o(d){const h=d.target;h.index!==null&&e.remove(h.index);for(const f in h.attributes)e.remove(h.attributes[f]);for(const f in h.morphAttributes){const g=h.morphAttributes[f];for(let y=0,E=g.length;y<E;y++)e.remove(g[y])}h.removeEventListener("dispose",o),delete i[h.id];const p=s.get(h);p&&(e.remove(p),s.delete(h)),r.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,n.memory.geometries--}function a(d,h){return i[h.id]===!0||(h.addEventListener("dispose",o),i[h.id]=!0,n.memory.geometries++),h}function c(d){const h=d.attributes;for(const f in h)e.update(h[f],t.ARRAY_BUFFER);const p=d.morphAttributes;for(const f in p){const g=p[f];for(let y=0,E=g.length;y<E;y++)e.update(g[y],t.ARRAY_BUFFER)}}function l(d){const h=[],p=d.index,f=d.attributes.position;let g=0;if(p!==null){const w=p.array;g=p.version;for(let R=0,A=w.length;R<A;R+=3){const k=w[R+0],I=w[R+1],N=w[R+2];h.push(k,I,I,N,N,k)}}else if(f!==void 0){const w=f.array;g=f.version;for(let R=0,A=w.length/3-1;R<A;R+=3){const k=R+0,I=R+1,N=R+2;h.push(k,I,I,N,N,k)}}else return;const y=new(eW(h)?sW:iW)(h,1);y.version=g;const E=s.get(d);E&&e.remove(E),s.set(d,y)}function u(d){const h=s.get(d);if(h){const p=d.index;p!==null&&h.version<p.version&&l(d)}else l(d);return s.get(d)}return{get:a,update:c,getWireframeAttribute:u}}function zae(t,e,n){let r;function i(h){r=h}let s,o;function a(h){s=h.type,o=h.bytesPerElement}function c(h,p){t.drawElements(r,p,s,h*o),n.update(p,r,1)}function l(h,p,f){f!==0&&(t.drawElementsInstanced(r,p,s,h*o,f),n.update(p,r,f))}function u(h,p,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,p,0,s,h,0,f);let y=0;for(let E=0;E<f;E++)y+=p[E];n.update(y,r,1)}function d(h,p,f,g){if(f===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let E=0;E<h.length;E++)l(h[E]/o,p[E],g[E]);else{y.multiDrawElementsInstancedWEBGL(r,p,0,s,h,0,g,0,f);let E=0;for(let w=0;w<f;w++)E+=p[w]*g[w];n.update(E,r,1)}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=d}function Gae(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(n.calls++,o){case t.TRIANGLES:n.triangles+=a*(s/3);break;case t.LINES:n.lines+=a*(s/2);break;case t.LINE_STRIP:n.lines+=a*(s-1);break;case t.LINE_LOOP:n.lines+=a*s;break;case t.POINTS:n.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:i,update:r}}function Wae(t,e,n){const r=new WeakMap,i=new Bo;function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=u!==void 0?u.length:0;let h=r.get(a);if(h===void 0||h.count!==d){let $=function(){U.dispose(),r.delete(a),a.removeEventListener("dispose",$)};var p=$;h!==void 0&&h.texture.dispose();const f=a.morphAttributes.position!==void 0,g=a.morphAttributes.normal!==void 0,y=a.morphAttributes.color!==void 0,E=a.morphAttributes.position||[],w=a.morphAttributes.normal||[],R=a.morphAttributes.color||[];let A=0;f===!0&&(A=1),g===!0&&(A=2),y===!0&&(A=3);let k=a.attributes.position.count*A,I=1;k>e.maxTextureSize&&(I=Math.ceil(k/e.maxTextureSize),k=e.maxTextureSize);const N=new Float32Array(k*I*4*d),U=new nW(N,k,I,d);U.type=cp,U.needsUpdate=!0;const F=A*4;for(let q=0;q<d;q++){const K=E[q],W=w[q],X=R[q],ne=k*I*4*q;for(let Z=0;Z<K.count;Z++){const ie=Z*F;f===!0&&(i.fromBufferAttribute(K,Z),N[ne+ie+0]=i.x,N[ne+ie+1]=i.y,N[ne+ie+2]=i.z,N[ne+ie+3]=0),g===!0&&(i.fromBufferAttribute(W,Z),N[ne+ie+4]=i.x,N[ne+ie+5]=i.y,N[ne+ie+6]=i.z,N[ne+ie+7]=0),y===!0&&(i.fromBufferAttribute(X,Z),N[ne+ie+8]=i.x,N[ne+ie+9]=i.y,N[ne+ie+10]=i.z,N[ne+ie+11]=X.itemSize===4?i.w:1)}}h={count:d,texture:U,size:new Vn(k,I)},r.set(a,h),a.addEventListener("dispose",$)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(t,"morphTexture",o.morphTexture,n);else{let f=0;for(let y=0;y<l.length;y++)f+=l[y];const g=a.morphTargetsRelative?1:1-f;c.getUniforms().setValue(t,"morphTargetBaseInfluence",g),c.getUniforms().setValue(t,"morphTargetInfluences",l)}c.getUniforms().setValue(t,"morphTargetsTexture",h.texture,n),c.getUniforms().setValue(t,"morphTargetsTextureSize",h.size)}return{update:s}}function qae(t,e,n,r){let i=new WeakMap;function s(c){const l=r.render.frame,u=c.geometry,d=e.get(c,u);if(i.get(d)!==l&&(e.update(d),i.set(d,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(n.update(c.instanceMatrix,t.ARRAY_BUFFER),c.instanceColor!==null&&n.update(c.instanceColor,t.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const h=c.skeleton;i.get(h)!==l&&(h.update(),i.set(h,l))}return d}function o(){i=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),n.remove(l.instanceMatrix),l.instanceColor!==null&&n.remove(l.instanceColor)}return{update:s,dispose:o}}class eB extends So{constructor(e,n,r,i,s,o,a,c,l,u=tE){if(u!==tE&&u!==K0)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===tE&&(r=c_),r===void 0&&u===K0&&(r=q0),super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=a!==void 0?a:jo,this.minFilter=c!==void 0?c:jo,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}const uW=new So,R$=new eB(1,1),dW=new nW,hW=new Nie,fW=new aW,A$=[],M$=[],I$=new Float32Array(16),O$=new Float32Array(9),k$=new Float32Array(4);function cS(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=A$[i];if(s===void 0&&(s=new Float32Array(i),A$[i]=s),e!==0){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=n,t[o].toArray(s,a)}return s}function La(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Ua(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function tM(t,e){let n=M$[e];n===void 0&&(n=new Int32Array(e),M$[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Kae(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Yae(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(La(n,e))return;t.uniform2fv(this.addr,e),Ua(n,e)}}function Xae(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(La(n,e))return;t.uniform3fv(this.addr,e),Ua(n,e)}}function Jae(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(La(n,e))return;t.uniform4fv(this.addr,e),Ua(n,e)}}function Qae(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(La(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ua(n,e)}else{if(La(n,r))return;k$.set(r),t.uniformMatrix2fv(this.addr,!1,k$),Ua(n,r)}}function Zae(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(La(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ua(n,e)}else{if(La(n,r))return;O$.set(r),t.uniformMatrix3fv(this.addr,!1,O$),Ua(n,r)}}function ece(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(La(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ua(n,e)}else{if(La(n,r))return;I$.set(r),t.uniformMatrix4fv(this.addr,!1,I$),Ua(n,r)}}function tce(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function nce(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(La(n,e))return;t.uniform2iv(this.addr,e),Ua(n,e)}}function rce(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(La(n,e))return;t.uniform3iv(this.addr,e),Ua(n,e)}}function ice(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(La(n,e))return;t.uniform4iv(this.addr,e),Ua(n,e)}}function sce(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function oce(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(La(n,e))return;t.uniform2uiv(this.addr,e),Ua(n,e)}}function ace(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(La(n,e))return;t.uniform3uiv(this.addr,e),Ua(n,e)}}function cce(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(La(n,e))return;t.uniform4uiv(this.addr,e),Ua(n,e)}}function lce(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i);let s;this.type===t.SAMPLER_2D_SHADOW?(R$.compareFunction=ZG,s=R$):s=uW,n.setTexture2D(e||s,i)}function uce(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||hW,i)}function dce(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||fW,i)}function hce(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||dW,i)}function fce(t){switch(t){case 5126:return Kae;case 35664:return Yae;case 35665:return Xae;case 35666:return Jae;case 35674:return Qae;case 35675:return Zae;case 35676:return ece;case 5124:case 35670:return tce;case 35667:case 35671:return nce;case 35668:case 35672:return rce;case 35669:case 35673:return ice;case 5125:return sce;case 36294:return oce;case 36295:return ace;case 36296:return cce;case 35678:case 36198:case 36298:case 36306:case 35682:return lce;case 35679:case 36299:case 36307:return uce;case 35680:case 36300:case 36308:case 36293:return dce;case 36289:case 36303:case 36311:case 36292:return hce}}function pce(t,e){t.uniform1fv(this.addr,e)}function mce(t,e){const n=cS(e,this.size,2);t.uniform2fv(this.addr,n)}function gce(t,e){const n=cS(e,this.size,3);t.uniform3fv(this.addr,n)}function vce(t,e){const n=cS(e,this.size,4);t.uniform4fv(this.addr,n)}function _ce(t,e){const n=cS(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function yce(t,e){const n=cS(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function bce(t,e){const n=cS(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Ece(t,e){t.uniform1iv(this.addr,e)}function Sce(t,e){t.uniform2iv(this.addr,e)}function Tce(t,e){t.uniform3iv(this.addr,e)}function wce(t,e){t.uniform4iv(this.addr,e)}function xce(t,e){t.uniform1uiv(this.addr,e)}function Cce(t,e){t.uniform2uiv(this.addr,e)}function Rce(t,e){t.uniform3uiv(this.addr,e)}function Ace(t,e){t.uniform4uiv(this.addr,e)}function Mce(t,e,n){const r=this.cache,i=e.length,s=tM(n,i);La(r,s)||(t.uniform1iv(this.addr,s),Ua(r,s));for(let o=0;o!==i;++o)n.setTexture2D(e[o]||uW,s[o])}function Ice(t,e,n){const r=this.cache,i=e.length,s=tM(n,i);La(r,s)||(t.uniform1iv(this.addr,s),Ua(r,s));for(let o=0;o!==i;++o)n.setTexture3D(e[o]||hW,s[o])}function Oce(t,e,n){const r=this.cache,i=e.length,s=tM(n,i);La(r,s)||(t.uniform1iv(this.addr,s),Ua(r,s));for(let o=0;o!==i;++o)n.setTextureCube(e[o]||fW,s[o])}function kce(t,e,n){const r=this.cache,i=e.length,s=tM(n,i);La(r,s)||(t.uniform1iv(this.addr,s),Ua(r,s));for(let o=0;o!==i;++o)n.setTexture2DArray(e[o]||dW,s[o])}function Nce(t){switch(t){case 5126:return pce;case 35664:return mce;case 35665:return gce;case 35666:return vce;case 35674:return _ce;case 35675:return yce;case 35676:return bce;case 5124:case 35670:return Ece;case 35667:case 35671:return Sce;case 35668:case 35672:return Tce;case 35669:case 35673:return wce;case 5125:return xce;case 36294:return Cce;case 36295:return Rce;case 36296:return Ace;case 35678:case 36198:case 36298:case 36306:case 35682:return Mce;case 35679:case 36299:case 36307:return Ice;case 35680:case 36300:case 36308:case 36293:return Oce;case 36289:case 36303:case 36311:case 36292:return kce}}class Pce{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.setValue=fce(n.type)}}class Dce{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=Nce(n.type)}}class Lce{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,n[a.id],r)}}}const sP=/(\w+)(\])?(\[|\.)?/g;function N$(t,e){t.seq.push(e),t.map[e.id]=e}function Uce(t,e,n){const r=t.name,i=r.length;for(sP.lastIndex=0;;){const s=sP.exec(r),o=sP.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){N$(n,l===void 0?new Pce(a,t,e):new Dce(a,t,e));break}else{let d=n.map[a];d===void 0&&(d=new Lce(a),N$(n,d)),n=d}}}class EC{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(n,i),o=e.getUniformLocation(n,s.name);Uce(s,o,this)}}setValue(e,n,r,i){const s=this.map[n];s!==void 0&&s.setValue(e,r,i)}setOptional(e,n,r){const i=n[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,n,r,i){for(let s=0,o=n.length;s!==o;++s){const a=n[s],c=r[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,i)}}static seqWithValue(e,n){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in n&&r.push(o)}return r}}function P$(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}const Fce=37297;let Bce=0;function jce(t,e){const n=t.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${n[o]}`)}return r.join(`
`)}const D$=new Wr;function $ce(t){ki._getMatrix(D$,ki.workingColorSpace,t);const e=`mat3( ${D$.elements.map(n=>n.toFixed(4))} )`;switch(ki.getTransfer(t)){case QA:return[e,"LinearTransferOETF"];case es:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function L$(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+i+`

`+jce(t.getShaderSource(e),o)}else return i}function Hce(t,e){const n=$ce(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function Vce(t,e){let n;switch(e){case Wre:n="Linear";break;case qre:n="Reinhard";break;case Kre:n="Cineon";break;case jG:n="ACESFilmic";break;case Xre:n="AgX";break;case Jre:n="Neutral";break;case Yre:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const g1=new ht;function zce(){ki.getLuminanceCoefficients(g1);const t=g1.x.toFixed(4),e=g1.y.toFixed(4),n=g1.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Gce(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ZS).join(`
`)}function Wce(t){const e=[];for(const n in t){const r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function qce(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i),o=s.name;let a=1;s.type===t.FLOAT_MAT2&&(a=2),s.type===t.FLOAT_MAT3&&(a=3),s.type===t.FLOAT_MAT4&&(a=4),n[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}function ZS(t){return t!==""}function U$(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function F$(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Kce=/^[ \t]*#include +<([\w\d./]+)>/gm;function i2(t){return t.replace(Kce,Xce)}const Yce=new Map;function Xce(t,e){let n=Kr[e];if(n===void 0){const r=Yce.get(e);if(r!==void 0)n=Kr[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return i2(n)}const Jce=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function B$(t){return t.replace(Jce,Qce)}function Qce(t,e,n,r){let i="";for(let s=parseInt(e);s<parseInt(n);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function j$(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Zce(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===VF?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===mC?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===qf&&(e="SHADOWMAP_TYPE_VSM"),e}function ele(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case SE:case TE:e="ENVMAP_TYPE_CUBE";break;case XA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function tle(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case TE:e="ENVMAP_MODE_REFRACTION";break}return e}function nle(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case BG:e="ENVMAP_BLENDING_MULTIPLY";break;case zre:e="ENVMAP_BLENDING_MIX";break;case Gre:e="ENVMAP_BLENDING_ADD";break}return e}function rle(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:r,maxMip:n}}function ile(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const c=Zce(n),l=ele(n),u=tle(n),d=nle(n),h=rle(n),p=Gce(n),f=Wce(s),g=i.createProgram();let y,E,w=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(ZS).join(`
`),y.length>0&&(y+=`
`),E=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(ZS).join(`
`),E.length>0&&(E+=`
`)):(y=[j$(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ZS).join(`
`),E=[j$(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==up?"#define TONE_MAPPING":"",n.toneMapping!==up?Kr.tonemapping_pars_fragment:"",n.toneMapping!==up?Vce("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Kr.colorspace_pars_fragment,Hce("linearToOutputTexel",n.outputColorSpace),zce(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(ZS).join(`
`)),o=i2(o),o=U$(o,n),o=F$(o,n),a=i2(a),a=U$(a,n),a=F$(a,n),o=B$(o),a=B$(a),n.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,y=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,E=["#define varying in",n.glslVersion===Qj?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Qj?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+E);const R=w+y+o,A=w+E+a,k=P$(i,i.VERTEX_SHADER,R),I=P$(i,i.FRAGMENT_SHADER,A);i.attachShader(g,k),i.attachShader(g,I),n.index0AttributeName!==void 0?i.bindAttribLocation(g,0,n.index0AttributeName):n.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g);function N(q){if(t.debug.checkShaderErrors){const K=i.getProgramInfoLog(g).trim(),W=i.getShaderInfoLog(k).trim(),X=i.getShaderInfoLog(I).trim();let ne=!0,Z=!0;if(i.getProgramParameter(g,i.LINK_STATUS)===!1)if(ne=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(i,g,k,I);else{const ie=L$(i,k,"vertex"),G=L$(i,I,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+`

Material Name: `+q.name+`
Material Type: `+q.type+`

Program Info Log: `+K+`
`+ie+`
`+G)}else K!==""?console.warn("THREE.WebGLProgram: Program Info Log:",K):(W===""||X==="")&&(Z=!1);Z&&(q.diagnostics={runnable:ne,programLog:K,vertexShader:{log:W,prefix:y},fragmentShader:{log:X,prefix:E}})}i.deleteShader(k),i.deleteShader(I),U=new EC(i,g),F=qce(i,g)}let U;this.getUniforms=function(){return U===void 0&&N(this),U};let F;this.getAttributes=function(){return F===void 0&&N(this),F};let $=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return $===!1&&($=i.getProgramParameter(g,Fce)),$},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Bce++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=k,this.fragmentShader=I,this}let sle=0;class ole{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(n),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new ale(e),n.set(e,r)),r}}class ale{constructor(e){this.id=sle++,this.code=e,this.usedTimes=0}}function cle(t,e,n,r,i,s,o){const a=new rE,c=new ole,l=new Set,u=[],d=i.logarithmicDepthBuffer,h=i.vertexTextures;let p=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(F){return l.add(F),F===0?"uv":`uv${F}`}function y(F,$,q,K,W){const X=K.fog,ne=W.geometry,Z=F.isMeshStandardMaterial?K.environment:null,ie=(F.isMeshStandardMaterial?n:e).get(F.envMap||Z),G=ie&&ie.mapping===XA?ie.image.height:null,Q=f[F.type];F.precision!==null&&(p=i.getMaxPrecision(F.precision),p!==F.precision&&console.warn("THREE.WebGLProgram.getParameters:",F.precision,"not supported, using",p,"instead."));const se=ne.morphAttributes.position||ne.morphAttributes.normal||ne.morphAttributes.color,ve=se!==void 0?se.length:0;let Oe=0;ne.morphAttributes.position!==void 0&&(Oe=1),ne.morphAttributes.normal!==void 0&&(Oe=2),ne.morphAttributes.color!==void 0&&(Oe=3);let _e,le,xe,Ee;if(Q){const wt=Jf[Q];_e=wt.vertexShader,le=wt.fragmentShader}else _e=F.vertexShader,le=F.fragmentShader,c.update(F),xe=c.getVertexShaderID(F),Ee=c.getFragmentShaderID(F);const Se=t.getRenderTarget(),Ie=t.state.buffers.depth.getReversed(),Ze=W.isInstancedMesh===!0,_t=W.isBatchedMesh===!0,fe=!!F.map,ge=!!F.matcap,rt=!!ie,Re=!!F.aoMap,St=!!F.lightMap,Ge=!!F.bumpMap,kt=!!F.normalMap,Bt=!!F.displacementMap,He=!!F.emissiveMap,$t=!!F.metalnessMap,Ce=!!F.roughnessMap,ue=F.anisotropy>0,tt=F.clearcoat>0,yt=F.dispersion>0,We=F.iridescence>0,ze=F.sheen>0,Vt=F.transmission>0,xt=ue&&!!F.anisotropyMap,jt=tt&&!!F.clearcoatMap,ae=tt&&!!F.clearcoatNormalMap,j=tt&&!!F.clearcoatRoughnessMap,V=We&&!!F.iridescenceMap,pe=We&&!!F.iridescenceThicknessMap,Ne=ze&&!!F.sheenColorMap,Fe=ze&&!!F.sheenRoughnessMap,dt=!!F.specularMap,bt=!!F.specularColorMap,Dn=!!F.specularIntensityMap,Ue=Vt&&!!F.transmissionMap,Dt=Vt&&!!F.thicknessMap,st=!!F.gradientMap,Ct=!!F.alphaMap,sn=F.alphaTest>0,Jt=!!F.alphaHash,Le=!!F.extensions;let it=up;F.toneMapped&&(Se===null||Se.isXRRenderTarget===!0)&&(it=t.toneMapping);const Tt={shaderID:Q,shaderType:F.type,shaderName:F.name,vertexShader:_e,fragmentShader:le,defines:F.defines,customVertexShaderID:xe,customFragmentShaderID:Ee,isRawShaderMaterial:F.isRawShaderMaterial===!0,glslVersion:F.glslVersion,precision:p,batching:_t,batchingColor:_t&&W._colorsTexture!==null,instancing:Ze,instancingColor:Ze&&W.instanceColor!==null,instancingMorph:Ze&&W.morphTexture!==null,supportsVertexTextures:h,outputColorSpace:Se===null?t.outputColorSpace:Se.isXRRenderTarget===!0?Se.texture.colorSpace:x_,alphaToCoverage:!!F.alphaToCoverage,map:fe,matcap:ge,envMap:rt,envMapMode:rt&&ie.mapping,envMapCubeUVHeight:G,aoMap:Re,lightMap:St,bumpMap:Ge,normalMap:kt,displacementMap:h&&Bt,emissiveMap:He,normalMapObjectSpace:kt&&F.normalMapType===eie,normalMapTangentSpace:kt&&F.normalMapType===QG,metalnessMap:$t,roughnessMap:Ce,anisotropy:ue,anisotropyMap:xt,clearcoat:tt,clearcoatMap:jt,clearcoatNormalMap:ae,clearcoatRoughnessMap:j,dispersion:yt,iridescence:We,iridescenceMap:V,iridescenceThicknessMap:pe,sheen:ze,sheenColorMap:Ne,sheenRoughnessMap:Fe,specularMap:dt,specularColorMap:bt,specularIntensityMap:Dn,transmission:Vt,transmissionMap:Ue,thicknessMap:Dt,gradientMap:st,opaque:F.transparent===!1&&F.blending===eE&&F.alphaToCoverage===!1,alphaMap:Ct,alphaTest:sn,alphaHash:Jt,combine:F.combine,mapUv:fe&&g(F.map.channel),aoMapUv:Re&&g(F.aoMap.channel),lightMapUv:St&&g(F.lightMap.channel),bumpMapUv:Ge&&g(F.bumpMap.channel),normalMapUv:kt&&g(F.normalMap.channel),displacementMapUv:Bt&&g(F.displacementMap.channel),emissiveMapUv:He&&g(F.emissiveMap.channel),metalnessMapUv:$t&&g(F.metalnessMap.channel),roughnessMapUv:Ce&&g(F.roughnessMap.channel),anisotropyMapUv:xt&&g(F.anisotropyMap.channel),clearcoatMapUv:jt&&g(F.clearcoatMap.channel),clearcoatNormalMapUv:ae&&g(F.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:j&&g(F.clearcoatRoughnessMap.channel),iridescenceMapUv:V&&g(F.iridescenceMap.channel),iridescenceThicknessMapUv:pe&&g(F.iridescenceThicknessMap.channel),sheenColorMapUv:Ne&&g(F.sheenColorMap.channel),sheenRoughnessMapUv:Fe&&g(F.sheenRoughnessMap.channel),specularMapUv:dt&&g(F.specularMap.channel),specularColorMapUv:bt&&g(F.specularColorMap.channel),specularIntensityMapUv:Dn&&g(F.specularIntensityMap.channel),transmissionMapUv:Ue&&g(F.transmissionMap.channel),thicknessMapUv:Dt&&g(F.thicknessMap.channel),alphaMapUv:Ct&&g(F.alphaMap.channel),vertexTangents:!!ne.attributes.tangent&&(kt||ue),vertexColors:F.vertexColors,vertexAlphas:F.vertexColors===!0&&!!ne.attributes.color&&ne.attributes.color.itemSize===4,pointsUvs:W.isPoints===!0&&!!ne.attributes.uv&&(fe||Ct),fog:!!X,useFog:F.fog===!0,fogExp2:!!X&&X.isFogExp2,flatShading:F.flatShading===!0,sizeAttenuation:F.sizeAttenuation===!0,logarithmicDepthBuffer:d,reverseDepthBuffer:Ie,skinning:W.isSkinnedMesh===!0,morphTargets:ne.morphAttributes.position!==void 0,morphNormals:ne.morphAttributes.normal!==void 0,morphColors:ne.morphAttributes.color!==void 0,morphTargetsCount:ve,morphTextureStride:Oe,numDirLights:$.directional.length,numPointLights:$.point.length,numSpotLights:$.spot.length,numSpotLightMaps:$.spotLightMap.length,numRectAreaLights:$.rectArea.length,numHemiLights:$.hemi.length,numDirLightShadows:$.directionalShadowMap.length,numPointLightShadows:$.pointShadowMap.length,numSpotLightShadows:$.spotShadowMap.length,numSpotLightShadowsWithMaps:$.numSpotLightShadowsWithMaps,numLightProbes:$.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:F.dithering,shadowMapEnabled:t.shadowMap.enabled&&q.length>0,shadowMapType:t.shadowMap.type,toneMapping:it,decodeVideoTexture:fe&&F.map.isVideoTexture===!0&&ki.getTransfer(F.map.colorSpace)===es,decodeVideoTextureEmissive:He&&F.emissiveMap.isVideoTexture===!0&&ki.getTransfer(F.emissiveMap.colorSpace)===es,premultipliedAlpha:F.premultipliedAlpha,doubleSided:F.side===Gu,flipSided:F.side===sc,useDepthPacking:F.depthPacking>=0,depthPacking:F.depthPacking||0,index0AttributeName:F.index0AttributeName,extensionClipCullDistance:Le&&F.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Le&&F.extensions.multiDraw===!0||_t)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:F.customProgramCacheKey()};return Tt.vertexUv1s=l.has(1),Tt.vertexUv2s=l.has(2),Tt.vertexUv3s=l.has(3),l.clear(),Tt}function E(F){const $=[];if(F.shaderID?$.push(F.shaderID):($.push(F.customVertexShaderID),$.push(F.customFragmentShaderID)),F.defines!==void 0)for(const q in F.defines)$.push(q),$.push(F.defines[q]);return F.isRawShaderMaterial===!1&&(w($,F),R($,F),$.push(t.outputColorSpace)),$.push(F.customProgramCacheKey),$.join()}function w(F,$){F.push($.precision),F.push($.outputColorSpace),F.push($.envMapMode),F.push($.envMapCubeUVHeight),F.push($.mapUv),F.push($.alphaMapUv),F.push($.lightMapUv),F.push($.aoMapUv),F.push($.bumpMapUv),F.push($.normalMapUv),F.push($.displacementMapUv),F.push($.emissiveMapUv),F.push($.metalnessMapUv),F.push($.roughnessMapUv),F.push($.anisotropyMapUv),F.push($.clearcoatMapUv),F.push($.clearcoatNormalMapUv),F.push($.clearcoatRoughnessMapUv),F.push($.iridescenceMapUv),F.push($.iridescenceThicknessMapUv),F.push($.sheenColorMapUv),F.push($.sheenRoughnessMapUv),F.push($.specularMapUv),F.push($.specularColorMapUv),F.push($.specularIntensityMapUv),F.push($.transmissionMapUv),F.push($.thicknessMapUv),F.push($.combine),F.push($.fogExp2),F.push($.sizeAttenuation),F.push($.morphTargetsCount),F.push($.morphAttributeCount),F.push($.numDirLights),F.push($.numPointLights),F.push($.numSpotLights),F.push($.numSpotLightMaps),F.push($.numHemiLights),F.push($.numRectAreaLights),F.push($.numDirLightShadows),F.push($.numPointLightShadows),F.push($.numSpotLightShadows),F.push($.numSpotLightShadowsWithMaps),F.push($.numLightProbes),F.push($.shadowMapType),F.push($.toneMapping),F.push($.numClippingPlanes),F.push($.numClipIntersection),F.push($.depthPacking)}function R(F,$){a.disableAll(),$.supportsVertexTextures&&a.enable(0),$.instancing&&a.enable(1),$.instancingColor&&a.enable(2),$.instancingMorph&&a.enable(3),$.matcap&&a.enable(4),$.envMap&&a.enable(5),$.normalMapObjectSpace&&a.enable(6),$.normalMapTangentSpace&&a.enable(7),$.clearcoat&&a.enable(8),$.iridescence&&a.enable(9),$.alphaTest&&a.enable(10),$.vertexColors&&a.enable(11),$.vertexAlphas&&a.enable(12),$.vertexUv1s&&a.enable(13),$.vertexUv2s&&a.enable(14),$.vertexUv3s&&a.enable(15),$.vertexTangents&&a.enable(16),$.anisotropy&&a.enable(17),$.alphaHash&&a.enable(18),$.batching&&a.enable(19),$.dispersion&&a.enable(20),$.batchingColor&&a.enable(21),F.push(a.mask),a.disableAll(),$.fog&&a.enable(0),$.useFog&&a.enable(1),$.flatShading&&a.enable(2),$.logarithmicDepthBuffer&&a.enable(3),$.reverseDepthBuffer&&a.enable(4),$.skinning&&a.enable(5),$.morphTargets&&a.enable(6),$.morphNormals&&a.enable(7),$.morphColors&&a.enable(8),$.premultipliedAlpha&&a.enable(9),$.shadowMapEnabled&&a.enable(10),$.doubleSided&&a.enable(11),$.flipSided&&a.enable(12),$.useDepthPacking&&a.enable(13),$.dithering&&a.enable(14),$.transmission&&a.enable(15),$.sheen&&a.enable(16),$.opaque&&a.enable(17),$.pointsUvs&&a.enable(18),$.decodeVideoTexture&&a.enable(19),$.decodeVideoTextureEmissive&&a.enable(20),$.alphaToCoverage&&a.enable(21),F.push(a.mask)}function A(F){const $=f[F.type];let q;if($){const K=Jf[$];q=Gie.clone(K.uniforms)}else q=F.uniforms;return q}function k(F,$){let q;for(let K=0,W=u.length;K<W;K++){const X=u[K];if(X.cacheKey===$){q=X,++q.usedTimes;break}}return q===void 0&&(q=new ile(t,$,F,s),u.push(q)),q}function I(F){if(--F.usedTimes===0){const $=u.indexOf(F);u[$]=u[u.length-1],u.pop(),F.destroy()}}function N(F){c.remove(F)}function U(){c.dispose()}return{getParameters:y,getProgramCacheKey:E,getUniforms:A,acquireProgram:k,releaseProgram:I,releaseShaderCache:N,programs:u,dispose:U}}function lle(){let t=new WeakMap;function e(o){return t.has(o)}function n(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function r(o){t.delete(o)}function i(o,a,c){t.get(o)[a]=c}function s(){t=new WeakMap}return{has:e,get:n,remove:r,update:i,dispose:s}}function ule(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function $$(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function H$(){const t=[];let e=0;const n=[],r=[],i=[];function s(){e=0,n.length=0,r.length=0,i.length=0}function o(d,h,p,f,g,y){let E=t[e];return E===void 0?(E={id:d.id,object:d,geometry:h,material:p,groupOrder:f,renderOrder:d.renderOrder,z:g,group:y},t[e]=E):(E.id=d.id,E.object=d,E.geometry=h,E.material=p,E.groupOrder=f,E.renderOrder=d.renderOrder,E.z=g,E.group=y),e++,E}function a(d,h,p,f,g,y){const E=o(d,h,p,f,g,y);p.transmission>0?r.push(E):p.transparent===!0?i.push(E):n.push(E)}function c(d,h,p,f,g,y){const E=o(d,h,p,f,g,y);p.transmission>0?r.unshift(E):p.transparent===!0?i.unshift(E):n.unshift(E)}function l(d,h){n.length>1&&n.sort(d||ule),r.length>1&&r.sort(h||$$),i.length>1&&i.sort(h||$$)}function u(){for(let d=e,h=t.length;d<h;d++){const p=t[d];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:n,transmissive:r,transparent:i,init:s,push:a,unshift:c,finish:u,sort:l}}function dle(){let t=new WeakMap;function e(r,i){const s=t.get(r);let o;return s===void 0?(o=new H$,t.set(r,[o])):i>=s.length?(o=new H$,s.push(o)):o=s[i],o}function n(){t=new WeakMap}return{get:e,dispose:n}}function hle(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new ht,color:new Ei};break;case"SpotLight":n={position:new ht,direction:new ht,color:new Ei,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ht,color:new Ei,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ht,skyColor:new Ei,groundColor:new Ei};break;case"RectAreaLight":n={color:new Ei,position:new ht,halfWidth:new ht,halfHeight:new ht};break}return t[e.id]=n,n}}}function fle(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let ple=0;function mle(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function gle(t){const e=new hle,n=fle(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new ht);const i=new ht,s=new To,o=new To;function a(l){let u=0,d=0,h=0;for(let F=0;F<9;F++)r.probe[F].set(0,0,0);let p=0,f=0,g=0,y=0,E=0,w=0,R=0,A=0,k=0,I=0,N=0;l.sort(mle);for(let F=0,$=l.length;F<$;F++){const q=l[F],K=q.color,W=q.intensity,X=q.distance,ne=q.shadow&&q.shadow.map?q.shadow.map.texture:null;if(q.isAmbientLight)u+=K.r*W,d+=K.g*W,h+=K.b*W;else if(q.isLightProbe){for(let Z=0;Z<9;Z++)r.probe[Z].addScaledVector(q.sh.coefficients[Z],W);N++}else if(q.isDirectionalLight){const Z=e.get(q);if(Z.color.copy(q.color).multiplyScalar(q.intensity),q.castShadow){const ie=q.shadow,G=n.get(q);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,r.directionalShadow[p]=G,r.directionalShadowMap[p]=ne,r.directionalShadowMatrix[p]=q.shadow.matrix,w++}r.directional[p]=Z,p++}else if(q.isSpotLight){const Z=e.get(q);Z.position.setFromMatrixPosition(q.matrixWorld),Z.color.copy(K).multiplyScalar(W),Z.distance=X,Z.coneCos=Math.cos(q.angle),Z.penumbraCos=Math.cos(q.angle*(1-q.penumbra)),Z.decay=q.decay,r.spot[g]=Z;const ie=q.shadow;if(q.map&&(r.spotLightMap[k]=q.map,k++,ie.updateMatrices(q),q.castShadow&&I++),r.spotLightMatrix[g]=ie.matrix,q.castShadow){const G=n.get(q);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,r.spotShadow[g]=G,r.spotShadowMap[g]=ne,A++}g++}else if(q.isRectAreaLight){const Z=e.get(q);Z.color.copy(K).multiplyScalar(W),Z.halfWidth.set(q.width*.5,0,0),Z.halfHeight.set(0,q.height*.5,0),r.rectArea[y]=Z,y++}else if(q.isPointLight){const Z=e.get(q);if(Z.color.copy(q.color).multiplyScalar(q.intensity),Z.distance=q.distance,Z.decay=q.decay,q.castShadow){const ie=q.shadow,G=n.get(q);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,G.shadowCameraNear=ie.camera.near,G.shadowCameraFar=ie.camera.far,r.pointShadow[f]=G,r.pointShadowMap[f]=ne,r.pointShadowMatrix[f]=q.shadow.matrix,R++}r.point[f]=Z,f++}else if(q.isHemisphereLight){const Z=e.get(q);Z.skyColor.copy(q.color).multiplyScalar(W),Z.groundColor.copy(q.groundColor).multiplyScalar(W),r.hemi[E]=Z,E++}}y>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=un.LTC_FLOAT_1,r.rectAreaLTC2=un.LTC_FLOAT_2):(r.rectAreaLTC1=un.LTC_HALF_1,r.rectAreaLTC2=un.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=d,r.ambient[2]=h;const U=r.hash;(U.directionalLength!==p||U.pointLength!==f||U.spotLength!==g||U.rectAreaLength!==y||U.hemiLength!==E||U.numDirectionalShadows!==w||U.numPointShadows!==R||U.numSpotShadows!==A||U.numSpotMaps!==k||U.numLightProbes!==N)&&(r.directional.length=p,r.spot.length=g,r.rectArea.length=y,r.point.length=f,r.hemi.length=E,r.directionalShadow.length=w,r.directionalShadowMap.length=w,r.pointShadow.length=R,r.pointShadowMap.length=R,r.spotShadow.length=A,r.spotShadowMap.length=A,r.directionalShadowMatrix.length=w,r.pointShadowMatrix.length=R,r.spotLightMatrix.length=A+k-I,r.spotLightMap.length=k,r.numSpotLightShadowsWithMaps=I,r.numLightProbes=N,U.directionalLength=p,U.pointLength=f,U.spotLength=g,U.rectAreaLength=y,U.hemiLength=E,U.numDirectionalShadows=w,U.numPointShadows=R,U.numSpotShadows=A,U.numSpotMaps=k,U.numLightProbes=N,r.version=ple++)}function c(l,u){let d=0,h=0,p=0,f=0,g=0;const y=u.matrixWorldInverse;for(let E=0,w=l.length;E<w;E++){const R=l[E];if(R.isDirectionalLight){const A=r.directional[d];A.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),A.direction.sub(i),A.direction.transformDirection(y),d++}else if(R.isSpotLight){const A=r.spot[p];A.position.setFromMatrixPosition(R.matrixWorld),A.position.applyMatrix4(y),A.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),A.direction.sub(i),A.direction.transformDirection(y),p++}else if(R.isRectAreaLight){const A=r.rectArea[f];A.position.setFromMatrixPosition(R.matrixWorld),A.position.applyMatrix4(y),o.identity(),s.copy(R.matrixWorld),s.premultiply(y),o.extractRotation(s),A.halfWidth.set(R.width*.5,0,0),A.halfHeight.set(0,R.height*.5,0),A.halfWidth.applyMatrix4(o),A.halfHeight.applyMatrix4(o),f++}else if(R.isPointLight){const A=r.point[h];A.position.setFromMatrixPosition(R.matrixWorld),A.position.applyMatrix4(y),h++}else if(R.isHemisphereLight){const A=r.hemi[g];A.direction.setFromMatrixPosition(R.matrixWorld),A.direction.transformDirection(y),g++}}}return{setup:a,setupView:c,state:r}}function V$(t){const e=new gle(t),n=[],r=[];function i(u){l.camera=u,n.length=0,r.length=0}function s(u){n.push(u)}function o(u){r.push(u)}function a(){e.setup(n)}function c(u){e.setupView(n,u)}const l={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function vle(t){let e=new WeakMap;function n(i,s=0){const o=e.get(i);let a;return o===void 0?(a=new V$(t),e.set(i,[a])):s>=o.length?(a=new V$(t),o.push(a)):a=o[s],a}function r(){e=new WeakMap}return{get:n,dispose:r}}class _le extends _g{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=py,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class yle extends _g{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const ble=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Ele=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Sle(t,e,n){let r=new cW;const i=new Vn,s=new Vn,o=new Bo,a=new _le({depthPacking:Zre}),c=new yle,l={},u=n.maxTextureSize,d={[ag]:sc,[sc]:ag,[Gu]:Gu},h=new Il({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vn},radius:{value:4}},vertexShader:ble,fragmentShader:Ele}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const f=new Yh;f.setAttribute("position",new oo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Dh(f,h),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=VF;let E=this.type;this.render=function(I,N,U){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||I.length===0)return;const F=t.getRenderTarget(),$=t.getActiveCubeFace(),q=t.getActiveMipmapLevel(),K=t.state;K.setBlending(Bh),K.buffers.color.setClear(1,1,1,1),K.buffers.depth.setTest(!0),K.setScissorTest(!1);const W=E!==qf&&this.type===qf,X=E===qf&&this.type!==qf;for(let ne=0,Z=I.length;ne<Z;ne++){const ie=I[ne],G=ie.shadow;if(G===void 0){console.warn("THREE.WebGLShadowMap:",ie,"has no shadow.");continue}if(G.autoUpdate===!1&&G.needsUpdate===!1)continue;i.copy(G.mapSize);const Q=G.getFrameExtents();if(i.multiply(Q),s.copy(G.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/Q.x),i.x=s.x*Q.x,G.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/Q.y),i.y=s.y*Q.y,G.mapSize.y=s.y)),G.map===null||W===!0||X===!0){const ve=this.type!==qf?{minFilter:jo,magFilter:jo}:{};G.map!==null&&G.map.dispose(),G.map=new Zu(i.x,i.y,ve),G.map.texture.name=ie.name+".shadowMap",G.camera.updateProjectionMatrix()}t.setRenderTarget(G.map),t.clear();const se=G.getViewportCount();for(let ve=0;ve<se;ve++){const Oe=G.getViewport(ve);o.set(s.x*Oe.x,s.y*Oe.y,s.x*Oe.z,s.y*Oe.w),K.viewport(o),G.updateMatrices(ie,ve),r=G.getFrustum(),A(N,U,G.camera,ie,this.type)}G.isPointLightShadow!==!0&&this.type===qf&&w(G,U),G.needsUpdate=!1}E=this.type,y.needsUpdate=!1,t.setRenderTarget(F,$,q)};function w(I,N){const U=e.update(g);h.defines.VSM_SAMPLES!==I.blurSamples&&(h.defines.VSM_SAMPLES=I.blurSamples,p.defines.VSM_SAMPLES=I.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),I.mapPass===null&&(I.mapPass=new Zu(i.x,i.y)),h.uniforms.shadow_pass.value=I.map.texture,h.uniforms.resolution.value=I.mapSize,h.uniforms.radius.value=I.radius,t.setRenderTarget(I.mapPass),t.clear(),t.renderBufferDirect(N,null,U,h,g,null),p.uniforms.shadow_pass.value=I.mapPass.texture,p.uniforms.resolution.value=I.mapSize,p.uniforms.radius.value=I.radius,t.setRenderTarget(I.map),t.clear(),t.renderBufferDirect(N,null,U,p,g,null)}function R(I,N,U,F){let $=null;const q=U.isPointLight===!0?I.customDistanceMaterial:I.customDepthMaterial;if(q!==void 0)$=q;else if($=U.isPointLight===!0?c:a,t.localClippingEnabled&&N.clipShadows===!0&&Array.isArray(N.clippingPlanes)&&N.clippingPlanes.length!==0||N.displacementMap&&N.displacementScale!==0||N.alphaMap&&N.alphaTest>0||N.map&&N.alphaTest>0){const K=$.uuid,W=N.uuid;let X=l[K];X===void 0&&(X={},l[K]=X);let ne=X[W];ne===void 0&&(ne=$.clone(),X[W]=ne,N.addEventListener("dispose",k)),$=ne}if($.visible=N.visible,$.wireframe=N.wireframe,F===qf?$.side=N.shadowSide!==null?N.shadowSide:N.side:$.side=N.shadowSide!==null?N.shadowSide:d[N.side],$.alphaMap=N.alphaMap,$.alphaTest=N.alphaTest,$.map=N.map,$.clipShadows=N.clipShadows,$.clippingPlanes=N.clippingPlanes,$.clipIntersection=N.clipIntersection,$.displacementMap=N.displacementMap,$.displacementScale=N.displacementScale,$.displacementBias=N.displacementBias,$.wireframeLinewidth=N.wireframeLinewidth,$.linewidth=N.linewidth,U.isPointLight===!0&&$.isMeshDistanceMaterial===!0){const K=t.properties.get($);K.light=U}return $}function A(I,N,U,F,$){if(I.visible===!1)return;if(I.layers.test(N.layers)&&(I.isMesh||I.isLine||I.isPoints)&&(I.castShadow||I.receiveShadow&&$===qf)&&(!I.frustumCulled||r.intersectsObject(I))){I.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,I.matrixWorld);const W=e.update(I),X=I.material;if(Array.isArray(X)){const ne=W.groups;for(let Z=0,ie=ne.length;Z<ie;Z++){const G=ne[Z],Q=X[G.materialIndex];if(Q&&Q.visible){const se=R(I,Q,F,$);I.onBeforeShadow(t,I,N,U,W,se,G),t.renderBufferDirect(U,null,W,se,I,G),I.onAfterShadow(t,I,N,U,W,se,G)}}}else if(X.visible){const ne=R(I,X,F,$);I.onBeforeShadow(t,I,N,U,W,ne,null),t.renderBufferDirect(U,null,W,ne,I,null),I.onAfterShadow(t,I,N,U,W,ne,null)}}const K=I.children;for(let W=0,X=K.length;W<X;W++)A(K[W],N,U,F,$)}function k(I){I.target.removeEventListener("dispose",k);for(const U in l){const F=l[U],$=I.target.uuid;$ in F&&(F[$].dispose(),delete F[$])}}}const Tle={[EL]:SL,[TL]:CL,[wL]:RL,[EE]:xL,[SL]:EL,[CL]:TL,[RL]:wL,[xL]:EE};function wle(t,e){function n(){let Ue=!1;const Dt=new Bo;let st=null;const Ct=new Bo(0,0,0,0);return{setMask:function(sn){st!==sn&&!Ue&&(t.colorMask(sn,sn,sn,sn),st=sn)},setLocked:function(sn){Ue=sn},setClear:function(sn,Jt,Le,it,Tt){Tt===!0&&(sn*=it,Jt*=it,Le*=it),Dt.set(sn,Jt,Le,it),Ct.equals(Dt)===!1&&(t.clearColor(sn,Jt,Le,it),Ct.copy(Dt))},reset:function(){Ue=!1,st=null,Ct.set(-1,0,0,0)}}}function r(){let Ue=!1,Dt=!1,st=null,Ct=null,sn=null;return{setReversed:function(Jt){if(Dt!==Jt){const Le=e.get("EXT_clip_control");Dt?Le.clipControlEXT(Le.LOWER_LEFT_EXT,Le.ZERO_TO_ONE_EXT):Le.clipControlEXT(Le.LOWER_LEFT_EXT,Le.NEGATIVE_ONE_TO_ONE_EXT);const it=sn;sn=null,this.setClear(it)}Dt=Jt},getReversed:function(){return Dt},setTest:function(Jt){Jt?Se(t.DEPTH_TEST):Ie(t.DEPTH_TEST)},setMask:function(Jt){st!==Jt&&!Ue&&(t.depthMask(Jt),st=Jt)},setFunc:function(Jt){if(Dt&&(Jt=Tle[Jt]),Ct!==Jt){switch(Jt){case EL:t.depthFunc(t.NEVER);break;case SL:t.depthFunc(t.ALWAYS);break;case TL:t.depthFunc(t.LESS);break;case EE:t.depthFunc(t.LEQUAL);break;case wL:t.depthFunc(t.EQUAL);break;case xL:t.depthFunc(t.GEQUAL);break;case CL:t.depthFunc(t.GREATER);break;case RL:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Ct=Jt}},setLocked:function(Jt){Ue=Jt},setClear:function(Jt){sn!==Jt&&(Dt&&(Jt=1-Jt),t.clearDepth(Jt),sn=Jt)},reset:function(){Ue=!1,st=null,Ct=null,sn=null,Dt=!1}}}function i(){let Ue=!1,Dt=null,st=null,Ct=null,sn=null,Jt=null,Le=null,it=null,Tt=null;return{setTest:function(wt){Ue||(wt?Se(t.STENCIL_TEST):Ie(t.STENCIL_TEST))},setMask:function(wt){Dt!==wt&&!Ue&&(t.stencilMask(wt),Dt=wt)},setFunc:function(wt,Pn,Yr){(st!==wt||Ct!==Pn||sn!==Yr)&&(t.stencilFunc(wt,Pn,Yr),st=wt,Ct=Pn,sn=Yr)},setOp:function(wt,Pn,Yr){(Jt!==wt||Le!==Pn||it!==Yr)&&(t.stencilOp(wt,Pn,Yr),Jt=wt,Le=Pn,it=Yr)},setLocked:function(wt){Ue=wt},setClear:function(wt){Tt!==wt&&(t.clearStencil(wt),Tt=wt)},reset:function(){Ue=!1,Dt=null,st=null,Ct=null,sn=null,Jt=null,Le=null,it=null,Tt=null}}}const s=new n,o=new r,a=new i,c=new WeakMap,l=new WeakMap;let u={},d={},h=new WeakMap,p=[],f=null,g=!1,y=null,E=null,w=null,R=null,A=null,k=null,I=null,N=new Ei(0,0,0),U=0,F=!1,$=null,q=null,K=null,W=null,X=null;const ne=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Z=!1,ie=0;const G=t.getParameter(t.VERSION);G.indexOf("WebGL")!==-1?(ie=parseFloat(/^WebGL (\d)/.exec(G)[1]),Z=ie>=1):G.indexOf("OpenGL ES")!==-1&&(ie=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),Z=ie>=2);let Q=null,se={};const ve=t.getParameter(t.SCISSOR_BOX),Oe=t.getParameter(t.VIEWPORT),_e=new Bo().fromArray(ve),le=new Bo().fromArray(Oe);function xe(Ue,Dt,st,Ct){const sn=new Uint8Array(4),Jt=t.createTexture();t.bindTexture(Ue,Jt),t.texParameteri(Ue,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(Ue,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Le=0;Le<st;Le++)Ue===t.TEXTURE_3D||Ue===t.TEXTURE_2D_ARRAY?t.texImage3D(Dt,0,t.RGBA,1,1,Ct,0,t.RGBA,t.UNSIGNED_BYTE,sn):t.texImage2D(Dt+Le,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,sn);return Jt}const Ee={};Ee[t.TEXTURE_2D]=xe(t.TEXTURE_2D,t.TEXTURE_2D,1),Ee[t.TEXTURE_CUBE_MAP]=xe(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ee[t.TEXTURE_2D_ARRAY]=xe(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),Ee[t.TEXTURE_3D]=xe(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Se(t.DEPTH_TEST),o.setFunc(EE),Ge(!1),kt(Wj),Se(t.CULL_FACE),Re(Bh);function Se(Ue){u[Ue]!==!0&&(t.enable(Ue),u[Ue]=!0)}function Ie(Ue){u[Ue]!==!1&&(t.disable(Ue),u[Ue]=!1)}function Ze(Ue,Dt){return d[Ue]!==Dt?(t.bindFramebuffer(Ue,Dt),d[Ue]=Dt,Ue===t.DRAW_FRAMEBUFFER&&(d[t.FRAMEBUFFER]=Dt),Ue===t.FRAMEBUFFER&&(d[t.DRAW_FRAMEBUFFER]=Dt),!0):!1}function _t(Ue,Dt){let st=p,Ct=!1;if(Ue){st=h.get(Dt),st===void 0&&(st=[],h.set(Dt,st));const sn=Ue.textures;if(st.length!==sn.length||st[0]!==t.COLOR_ATTACHMENT0){for(let Jt=0,Le=sn.length;Jt<Le;Jt++)st[Jt]=t.COLOR_ATTACHMENT0+Jt;st.length=sn.length,Ct=!0}}else st[0]!==t.BACK&&(st[0]=t.BACK,Ct=!0);Ct&&t.drawBuffers(st)}function fe(Ue){return f!==Ue?(t.useProgram(Ue),f=Ue,!0):!1}const ge={[x0]:t.FUNC_ADD,[Rre]:t.FUNC_SUBTRACT,[Are]:t.FUNC_REVERSE_SUBTRACT};ge[Mre]=t.MIN,ge[Ire]=t.MAX;const rt={[Ore]:t.ZERO,[kre]:t.ONE,[Nre]:t.SRC_COLOR,[yL]:t.SRC_ALPHA,[Bre]:t.SRC_ALPHA_SATURATE,[Ure]:t.DST_COLOR,[Dre]:t.DST_ALPHA,[Pre]:t.ONE_MINUS_SRC_COLOR,[bL]:t.ONE_MINUS_SRC_ALPHA,[Fre]:t.ONE_MINUS_DST_COLOR,[Lre]:t.ONE_MINUS_DST_ALPHA,[jre]:t.CONSTANT_COLOR,[$re]:t.ONE_MINUS_CONSTANT_COLOR,[Hre]:t.CONSTANT_ALPHA,[Vre]:t.ONE_MINUS_CONSTANT_ALPHA};function Re(Ue,Dt,st,Ct,sn,Jt,Le,it,Tt,wt){if(Ue===Bh){g===!0&&(Ie(t.BLEND),g=!1);return}if(g===!1&&(Se(t.BLEND),g=!0),Ue!==Cre){if(Ue!==y||wt!==F){if((E!==x0||A!==x0)&&(t.blendEquation(t.FUNC_ADD),E=x0,A=x0),wt)switch(Ue){case eE:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case qj:t.blendFunc(t.ONE,t.ONE);break;case Kj:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Yj:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ue);break}else switch(Ue){case eE:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case qj:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case Kj:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Yj:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ue);break}w=null,R=null,k=null,I=null,N.set(0,0,0),U=0,y=Ue,F=wt}return}sn=sn||Dt,Jt=Jt||st,Le=Le||Ct,(Dt!==E||sn!==A)&&(t.blendEquationSeparate(ge[Dt],ge[sn]),E=Dt,A=sn),(st!==w||Ct!==R||Jt!==k||Le!==I)&&(t.blendFuncSeparate(rt[st],rt[Ct],rt[Jt],rt[Le]),w=st,R=Ct,k=Jt,I=Le),(it.equals(N)===!1||Tt!==U)&&(t.blendColor(it.r,it.g,it.b,Tt),N.copy(it),U=Tt),y=Ue,F=!1}function St(Ue,Dt){Ue.side===Gu?Ie(t.CULL_FACE):Se(t.CULL_FACE);let st=Ue.side===sc;Dt&&(st=!st),Ge(st),Ue.blending===eE&&Ue.transparent===!1?Re(Bh):Re(Ue.blending,Ue.blendEquation,Ue.blendSrc,Ue.blendDst,Ue.blendEquationAlpha,Ue.blendSrcAlpha,Ue.blendDstAlpha,Ue.blendColor,Ue.blendAlpha,Ue.premultipliedAlpha),o.setFunc(Ue.depthFunc),o.setTest(Ue.depthTest),o.setMask(Ue.depthWrite),s.setMask(Ue.colorWrite);const Ct=Ue.stencilWrite;a.setTest(Ct),Ct&&(a.setMask(Ue.stencilWriteMask),a.setFunc(Ue.stencilFunc,Ue.stencilRef,Ue.stencilFuncMask),a.setOp(Ue.stencilFail,Ue.stencilZFail,Ue.stencilZPass)),He(Ue.polygonOffset,Ue.polygonOffsetFactor,Ue.polygonOffsetUnits),Ue.alphaToCoverage===!0?Se(t.SAMPLE_ALPHA_TO_COVERAGE):Ie(t.SAMPLE_ALPHA_TO_COVERAGE)}function Ge(Ue){$!==Ue&&(Ue?t.frontFace(t.CW):t.frontFace(t.CCW),$=Ue)}function kt(Ue){Ue!==Tre?(Se(t.CULL_FACE),Ue!==q&&(Ue===Wj?t.cullFace(t.BACK):Ue===wre?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):Ie(t.CULL_FACE),q=Ue}function Bt(Ue){Ue!==K&&(Z&&t.lineWidth(Ue),K=Ue)}function He(Ue,Dt,st){Ue?(Se(t.POLYGON_OFFSET_FILL),(W!==Dt||X!==st)&&(t.polygonOffset(Dt,st),W=Dt,X=st)):Ie(t.POLYGON_OFFSET_FILL)}function $t(Ue){Ue?Se(t.SCISSOR_TEST):Ie(t.SCISSOR_TEST)}function Ce(Ue){Ue===void 0&&(Ue=t.TEXTURE0+ne-1),Q!==Ue&&(t.activeTexture(Ue),Q=Ue)}function ue(Ue,Dt,st){st===void 0&&(Q===null?st=t.TEXTURE0+ne-1:st=Q);let Ct=se[st];Ct===void 0&&(Ct={type:void 0,texture:void 0},se[st]=Ct),(Ct.type!==Ue||Ct.texture!==Dt)&&(Q!==st&&(t.activeTexture(st),Q=st),t.bindTexture(Ue,Dt||Ee[Ue]),Ct.type=Ue,Ct.texture=Dt)}function tt(){const Ue=se[Q];Ue!==void 0&&Ue.type!==void 0&&(t.bindTexture(Ue.type,null),Ue.type=void 0,Ue.texture=void 0)}function yt(){try{t.compressedTexImage2D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function We(){try{t.compressedTexImage3D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function ze(){try{t.texSubImage2D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function Vt(){try{t.texSubImage3D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function xt(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function jt(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function ae(){try{t.texStorage2D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function j(){try{t.texStorage3D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function V(){try{t.texImage2D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function pe(){try{t.texImage3D.apply(t,arguments)}catch(Ue){console.error("THREE.WebGLState:",Ue)}}function Ne(Ue){_e.equals(Ue)===!1&&(t.scissor(Ue.x,Ue.y,Ue.z,Ue.w),_e.copy(Ue))}function Fe(Ue){le.equals(Ue)===!1&&(t.viewport(Ue.x,Ue.y,Ue.z,Ue.w),le.copy(Ue))}function dt(Ue,Dt){let st=l.get(Dt);st===void 0&&(st=new WeakMap,l.set(Dt,st));let Ct=st.get(Ue);Ct===void 0&&(Ct=t.getUniformBlockIndex(Dt,Ue.name),st.set(Ue,Ct))}function bt(Ue,Dt){const Ct=l.get(Dt).get(Ue);c.get(Dt)!==Ct&&(t.uniformBlockBinding(Dt,Ct,Ue.__bindingPointIndex),c.set(Dt,Ct))}function Dn(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),o.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},Q=null,se={},d={},h=new WeakMap,p=[],f=null,g=!1,y=null,E=null,w=null,R=null,A=null,k=null,I=null,N=new Ei(0,0,0),U=0,F=!1,$=null,q=null,K=null,W=null,X=null,_e.set(0,0,t.canvas.width,t.canvas.height),le.set(0,0,t.canvas.width,t.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Se,disable:Ie,bindFramebuffer:Ze,drawBuffers:_t,useProgram:fe,setBlending:Re,setMaterial:St,setFlipSided:Ge,setCullFace:kt,setLineWidth:Bt,setPolygonOffset:He,setScissorTest:$t,activeTexture:Ce,bindTexture:ue,unbindTexture:tt,compressedTexImage2D:yt,compressedTexImage3D:We,texImage2D:V,texImage3D:pe,updateUBOMapping:dt,uniformBlockBinding:bt,texStorage2D:ae,texStorage3D:j,texSubImage2D:ze,texSubImage3D:Vt,compressedTexSubImage2D:xt,compressedTexSubImage3D:jt,scissor:Ne,viewport:Fe,reset:Dn}}function z$(t,e,n,r){const i=xle(r);switch(n){case GG:return t*e;case qG:return t*e;case KG:return t*e*2;case YG:return t*e/i.components*i.byteLength;case qF:return t*e/i.components*i.byteLength;case XG:return t*e*2/i.components*i.byteLength;case KF:return t*e*2/i.components*i.byteLength;case WG:return t*e*3/i.components*i.byteLength;case Od:return t*e*4/i.components*i.byteLength;case JA:return t*e*4/i.components*i.byteLength;case gC:case vC:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case _C:case yC:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case NL:case DL:return Math.max(t,16)*Math.max(e,8)/4;case kL:case PL:return Math.max(t,8)*Math.max(e,8)/2;case LL:case UL:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case FL:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case BL:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case jL:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case $L:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case HL:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case VL:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case zL:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case GL:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case WL:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case qL:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case KL:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case YL:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case XL:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case JL:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case QL:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case bC:case ZL:case e2:return Math.ceil(t/4)*Math.ceil(e/4)*16;case JG:case t2:return Math.ceil(t/4)*Math.ceil(e/4)*8;case n2:case r2:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function xle(t){switch(t){case Yc:case HG:return{byteLength:1,components:1};case RT:case VG:case oS:return{byteLength:2,components:1};case GF:case WF:return{byteLength:2,components:4};case c_:case zF:case cp:return{byteLength:4,components:1};case zG:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}function Cle(t,e,n,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Vn,u=new WeakMap;let d;const h=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(Ce,ue){return p?new OffscreenCanvas(Ce,ue):MT("canvas")}function g(Ce,ue,tt){let yt=1;const We=$t(Ce);if((We.width>tt||We.height>tt)&&(yt=tt/Math.max(We.width,We.height)),yt<1)if(typeof HTMLImageElement<"u"&&Ce instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ce instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ce instanceof ImageBitmap||typeof VideoFrame<"u"&&Ce instanceof VideoFrame){const ze=Math.floor(yt*We.width),Vt=Math.floor(yt*We.height);d===void 0&&(d=f(ze,Vt));const xt=ue?f(ze,Vt):d;return xt.width=ze,xt.height=Vt,xt.getContext("2d").drawImage(Ce,0,0,ze,Vt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+We.width+"x"+We.height+") to ("+ze+"x"+Vt+")."),xt}else return"data"in Ce&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+We.width+"x"+We.height+")."),Ce;return Ce}function y(Ce){return Ce.generateMipmaps}function E(Ce){t.generateMipmap(Ce)}function w(Ce){return Ce.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:Ce.isWebGL3DRenderTarget?t.TEXTURE_3D:Ce.isWebGLArrayRenderTarget||Ce.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function R(Ce,ue,tt,yt,We=!1){if(Ce!==null){if(t[Ce]!==void 0)return t[Ce];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ce+"'")}let ze=ue;if(ue===t.RED&&(tt===t.FLOAT&&(ze=t.R32F),tt===t.HALF_FLOAT&&(ze=t.R16F),tt===t.UNSIGNED_BYTE&&(ze=t.R8)),ue===t.RED_INTEGER&&(tt===t.UNSIGNED_BYTE&&(ze=t.R8UI),tt===t.UNSIGNED_SHORT&&(ze=t.R16UI),tt===t.UNSIGNED_INT&&(ze=t.R32UI),tt===t.BYTE&&(ze=t.R8I),tt===t.SHORT&&(ze=t.R16I),tt===t.INT&&(ze=t.R32I)),ue===t.RG&&(tt===t.FLOAT&&(ze=t.RG32F),tt===t.HALF_FLOAT&&(ze=t.RG16F),tt===t.UNSIGNED_BYTE&&(ze=t.RG8)),ue===t.RG_INTEGER&&(tt===t.UNSIGNED_BYTE&&(ze=t.RG8UI),tt===t.UNSIGNED_SHORT&&(ze=t.RG16UI),tt===t.UNSIGNED_INT&&(ze=t.RG32UI),tt===t.BYTE&&(ze=t.RG8I),tt===t.SHORT&&(ze=t.RG16I),tt===t.INT&&(ze=t.RG32I)),ue===t.RGB_INTEGER&&(tt===t.UNSIGNED_BYTE&&(ze=t.RGB8UI),tt===t.UNSIGNED_SHORT&&(ze=t.RGB16UI),tt===t.UNSIGNED_INT&&(ze=t.RGB32UI),tt===t.BYTE&&(ze=t.RGB8I),tt===t.SHORT&&(ze=t.RGB16I),tt===t.INT&&(ze=t.RGB32I)),ue===t.RGBA_INTEGER&&(tt===t.UNSIGNED_BYTE&&(ze=t.RGBA8UI),tt===t.UNSIGNED_SHORT&&(ze=t.RGBA16UI),tt===t.UNSIGNED_INT&&(ze=t.RGBA32UI),tt===t.BYTE&&(ze=t.RGBA8I),tt===t.SHORT&&(ze=t.RGBA16I),tt===t.INT&&(ze=t.RGBA32I)),ue===t.RGB&&tt===t.UNSIGNED_INT_5_9_9_9_REV&&(ze=t.RGB9_E5),ue===t.RGBA){const Vt=We?QA:ki.getTransfer(yt);tt===t.FLOAT&&(ze=t.RGBA32F),tt===t.HALF_FLOAT&&(ze=t.RGBA16F),tt===t.UNSIGNED_BYTE&&(ze=Vt===es?t.SRGB8_ALPHA8:t.RGBA8),tt===t.UNSIGNED_SHORT_4_4_4_4&&(ze=t.RGBA4),tt===t.UNSIGNED_SHORT_5_5_5_1&&(ze=t.RGB5_A1)}return(ze===t.R16F||ze===t.R32F||ze===t.RG16F||ze===t.RG32F||ze===t.RGBA16F||ze===t.RGBA32F)&&e.get("EXT_color_buffer_float"),ze}function A(Ce,ue){let tt;return Ce?ue===null||ue===c_||ue===q0?tt=t.DEPTH24_STENCIL8:ue===cp?tt=t.DEPTH32F_STENCIL8:ue===RT&&(tt=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):ue===null||ue===c_||ue===q0?tt=t.DEPTH_COMPONENT24:ue===cp?tt=t.DEPTH_COMPONENT32F:ue===RT&&(tt=t.DEPTH_COMPONENT16),tt}function k(Ce,ue){return y(Ce)===!0||Ce.isFramebufferTexture&&Ce.minFilter!==jo&&Ce.minFilter!==ru?Math.log2(Math.max(ue.width,ue.height))+1:Ce.mipmaps!==void 0&&Ce.mipmaps.length>0?Ce.mipmaps.length:Ce.isCompressedTexture&&Array.isArray(Ce.image)?ue.mipmaps.length:1}function I(Ce){const ue=Ce.target;ue.removeEventListener("dispose",I),U(ue),ue.isVideoTexture&&u.delete(ue)}function N(Ce){const ue=Ce.target;ue.removeEventListener("dispose",N),$(ue)}function U(Ce){const ue=r.get(Ce);if(ue.__webglInit===void 0)return;const tt=Ce.source,yt=h.get(tt);if(yt){const We=yt[ue.__cacheKey];We.usedTimes--,We.usedTimes===0&&F(Ce),Object.keys(yt).length===0&&h.delete(tt)}r.remove(Ce)}function F(Ce){const ue=r.get(Ce);t.deleteTexture(ue.__webglTexture);const tt=Ce.source,yt=h.get(tt);delete yt[ue.__cacheKey],o.memory.textures--}function $(Ce){const ue=r.get(Ce);if(Ce.depthTexture&&(Ce.depthTexture.dispose(),r.remove(Ce.depthTexture)),Ce.isWebGLCubeRenderTarget)for(let yt=0;yt<6;yt++){if(Array.isArray(ue.__webglFramebuffer[yt]))for(let We=0;We<ue.__webglFramebuffer[yt].length;We++)t.deleteFramebuffer(ue.__webglFramebuffer[yt][We]);else t.deleteFramebuffer(ue.__webglFramebuffer[yt]);ue.__webglDepthbuffer&&t.deleteRenderbuffer(ue.__webglDepthbuffer[yt])}else{if(Array.isArray(ue.__webglFramebuffer))for(let yt=0;yt<ue.__webglFramebuffer.length;yt++)t.deleteFramebuffer(ue.__webglFramebuffer[yt]);else t.deleteFramebuffer(ue.__webglFramebuffer);if(ue.__webglDepthbuffer&&t.deleteRenderbuffer(ue.__webglDepthbuffer),ue.__webglMultisampledFramebuffer&&t.deleteFramebuffer(ue.__webglMultisampledFramebuffer),ue.__webglColorRenderbuffer)for(let yt=0;yt<ue.__webglColorRenderbuffer.length;yt++)ue.__webglColorRenderbuffer[yt]&&t.deleteRenderbuffer(ue.__webglColorRenderbuffer[yt]);ue.__webglDepthRenderbuffer&&t.deleteRenderbuffer(ue.__webglDepthRenderbuffer)}const tt=Ce.textures;for(let yt=0,We=tt.length;yt<We;yt++){const ze=r.get(tt[yt]);ze.__webglTexture&&(t.deleteTexture(ze.__webglTexture),o.memory.textures--),r.remove(tt[yt])}r.remove(Ce)}let q=0;function K(){q=0}function W(){const Ce=q;return Ce>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Ce+" texture units while this GPU supports only "+i.maxTextures),q+=1,Ce}function X(Ce){const ue=[];return ue.push(Ce.wrapS),ue.push(Ce.wrapT),ue.push(Ce.wrapR||0),ue.push(Ce.magFilter),ue.push(Ce.minFilter),ue.push(Ce.anisotropy),ue.push(Ce.internalFormat),ue.push(Ce.format),ue.push(Ce.type),ue.push(Ce.generateMipmaps),ue.push(Ce.premultiplyAlpha),ue.push(Ce.flipY),ue.push(Ce.unpackAlignment),ue.push(Ce.colorSpace),ue.join()}function ne(Ce,ue){const tt=r.get(Ce);if(Ce.isVideoTexture&&Bt(Ce),Ce.isRenderTargetTexture===!1&&Ce.version>0&&tt.__version!==Ce.version){const yt=Ce.image;if(yt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(yt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{le(tt,Ce,ue);return}}n.bindTexture(t.TEXTURE_2D,tt.__webglTexture,t.TEXTURE0+ue)}function Z(Ce,ue){const tt=r.get(Ce);if(Ce.version>0&&tt.__version!==Ce.version){le(tt,Ce,ue);return}n.bindTexture(t.TEXTURE_2D_ARRAY,tt.__webglTexture,t.TEXTURE0+ue)}function ie(Ce,ue){const tt=r.get(Ce);if(Ce.version>0&&tt.__version!==Ce.version){le(tt,Ce,ue);return}n.bindTexture(t.TEXTURE_3D,tt.__webglTexture,t.TEXTURE0+ue)}function G(Ce,ue){const tt=r.get(Ce);if(Ce.version>0&&tt.__version!==Ce.version){xe(tt,Ce,ue);return}n.bindTexture(t.TEXTURE_CUBE_MAP,tt.__webglTexture,t.TEXTURE0+ue)}const Q={[IL]:t.REPEAT,[M0]:t.CLAMP_TO_EDGE,[OL]:t.MIRRORED_REPEAT},se={[jo]:t.NEAREST,[Qre]:t.NEAREST_MIPMAP_NEAREST,[Xx]:t.NEAREST_MIPMAP_LINEAR,[ru]:t.LINEAR,[NN]:t.LINEAR_MIPMAP_NEAREST,[I0]:t.LINEAR_MIPMAP_LINEAR},ve={[tie]:t.NEVER,[aie]:t.ALWAYS,[nie]:t.LESS,[ZG]:t.LEQUAL,[rie]:t.EQUAL,[oie]:t.GEQUAL,[iie]:t.GREATER,[sie]:t.NOTEQUAL};function Oe(Ce,ue){if(ue.type===cp&&e.has("OES_texture_float_linear")===!1&&(ue.magFilter===ru||ue.magFilter===NN||ue.magFilter===Xx||ue.magFilter===I0||ue.minFilter===ru||ue.minFilter===NN||ue.minFilter===Xx||ue.minFilter===I0)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(Ce,t.TEXTURE_WRAP_S,Q[ue.wrapS]),t.texParameteri(Ce,t.TEXTURE_WRAP_T,Q[ue.wrapT]),(Ce===t.TEXTURE_3D||Ce===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Ce,t.TEXTURE_WRAP_R,Q[ue.wrapR]),t.texParameteri(Ce,t.TEXTURE_MAG_FILTER,se[ue.magFilter]),t.texParameteri(Ce,t.TEXTURE_MIN_FILTER,se[ue.minFilter]),ue.compareFunction&&(t.texParameteri(Ce,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(Ce,t.TEXTURE_COMPARE_FUNC,ve[ue.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(ue.magFilter===jo||ue.minFilter!==Xx&&ue.minFilter!==I0||ue.type===cp&&e.has("OES_texture_float_linear")===!1)return;if(ue.anisotropy>1||r.get(ue).__currentAnisotropy){const tt=e.get("EXT_texture_filter_anisotropic");t.texParameterf(Ce,tt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ue.anisotropy,i.getMaxAnisotropy())),r.get(ue).__currentAnisotropy=ue.anisotropy}}}function _e(Ce,ue){let tt=!1;Ce.__webglInit===void 0&&(Ce.__webglInit=!0,ue.addEventListener("dispose",I));const yt=ue.source;let We=h.get(yt);We===void 0&&(We={},h.set(yt,We));const ze=X(ue);if(ze!==Ce.__cacheKey){We[ze]===void 0&&(We[ze]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,tt=!0),We[ze].usedTimes++;const Vt=We[Ce.__cacheKey];Vt!==void 0&&(We[Ce.__cacheKey].usedTimes--,Vt.usedTimes===0&&F(ue)),Ce.__cacheKey=ze,Ce.__webglTexture=We[ze].texture}return tt}function le(Ce,ue,tt){let yt=t.TEXTURE_2D;(ue.isDataArrayTexture||ue.isCompressedArrayTexture)&&(yt=t.TEXTURE_2D_ARRAY),ue.isData3DTexture&&(yt=t.TEXTURE_3D);const We=_e(Ce,ue),ze=ue.source;n.bindTexture(yt,Ce.__webglTexture,t.TEXTURE0+tt);const Vt=r.get(ze);if(ze.version!==Vt.__version||We===!0){n.activeTexture(t.TEXTURE0+tt);const xt=ki.getPrimaries(ki.workingColorSpace),jt=ue.colorSpace===np?null:ki.getPrimaries(ue.colorSpace),ae=ue.colorSpace===np||xt===jt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,ue.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ue.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,ue.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,ae);let j=g(ue.image,!1,i.maxTextureSize);j=He(ue,j);const V=s.convert(ue.format,ue.colorSpace),pe=s.convert(ue.type);let Ne=R(ue.internalFormat,V,pe,ue.colorSpace,ue.isVideoTexture);Oe(yt,ue);let Fe;const dt=ue.mipmaps,bt=ue.isVideoTexture!==!0,Dn=Vt.__version===void 0||We===!0,Ue=ze.dataReady,Dt=k(ue,j);if(ue.isDepthTexture)Ne=A(ue.format===K0,ue.type),Dn&&(bt?n.texStorage2D(t.TEXTURE_2D,1,Ne,j.width,j.height):n.texImage2D(t.TEXTURE_2D,0,Ne,j.width,j.height,0,V,pe,null));else if(ue.isDataTexture)if(dt.length>0){bt&&Dn&&n.texStorage2D(t.TEXTURE_2D,Dt,Ne,dt[0].width,dt[0].height);for(let st=0,Ct=dt.length;st<Ct;st++)Fe=dt[st],bt?Ue&&n.texSubImage2D(t.TEXTURE_2D,st,0,0,Fe.width,Fe.height,V,pe,Fe.data):n.texImage2D(t.TEXTURE_2D,st,Ne,Fe.width,Fe.height,0,V,pe,Fe.data);ue.generateMipmaps=!1}else bt?(Dn&&n.texStorage2D(t.TEXTURE_2D,Dt,Ne,j.width,j.height),Ue&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,j.width,j.height,V,pe,j.data)):n.texImage2D(t.TEXTURE_2D,0,Ne,j.width,j.height,0,V,pe,j.data);else if(ue.isCompressedTexture)if(ue.isCompressedArrayTexture){bt&&Dn&&n.texStorage3D(t.TEXTURE_2D_ARRAY,Dt,Ne,dt[0].width,dt[0].height,j.depth);for(let st=0,Ct=dt.length;st<Ct;st++)if(Fe=dt[st],ue.format!==Od)if(V!==null)if(bt){if(Ue)if(ue.layerUpdates.size>0){const sn=z$(Fe.width,Fe.height,ue.format,ue.type);for(const Jt of ue.layerUpdates){const Le=Fe.data.subarray(Jt*sn/Fe.data.BYTES_PER_ELEMENT,(Jt+1)*sn/Fe.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,st,0,0,Jt,Fe.width,Fe.height,1,V,Le)}ue.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,st,0,0,0,Fe.width,Fe.height,j.depth,V,Fe.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,st,Ne,Fe.width,Fe.height,j.depth,0,Fe.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else bt?Ue&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,st,0,0,0,Fe.width,Fe.height,j.depth,V,pe,Fe.data):n.texImage3D(t.TEXTURE_2D_ARRAY,st,Ne,Fe.width,Fe.height,j.depth,0,V,pe,Fe.data)}else{bt&&Dn&&n.texStorage2D(t.TEXTURE_2D,Dt,Ne,dt[0].width,dt[0].height);for(let st=0,Ct=dt.length;st<Ct;st++)Fe=dt[st],ue.format!==Od?V!==null?bt?Ue&&n.compressedTexSubImage2D(t.TEXTURE_2D,st,0,0,Fe.width,Fe.height,V,Fe.data):n.compressedTexImage2D(t.TEXTURE_2D,st,Ne,Fe.width,Fe.height,0,Fe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):bt?Ue&&n.texSubImage2D(t.TEXTURE_2D,st,0,0,Fe.width,Fe.height,V,pe,Fe.data):n.texImage2D(t.TEXTURE_2D,st,Ne,Fe.width,Fe.height,0,V,pe,Fe.data)}else if(ue.isDataArrayTexture)if(bt){if(Dn&&n.texStorage3D(t.TEXTURE_2D_ARRAY,Dt,Ne,j.width,j.height,j.depth),Ue)if(ue.layerUpdates.size>0){const st=z$(j.width,j.height,ue.format,ue.type);for(const Ct of ue.layerUpdates){const sn=j.data.subarray(Ct*st/j.data.BYTES_PER_ELEMENT,(Ct+1)*st/j.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,Ct,j.width,j.height,1,V,pe,sn)}ue.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,j.width,j.height,j.depth,V,pe,j.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,Ne,j.width,j.height,j.depth,0,V,pe,j.data);else if(ue.isData3DTexture)bt?(Dn&&n.texStorage3D(t.TEXTURE_3D,Dt,Ne,j.width,j.height,j.depth),Ue&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,j.width,j.height,j.depth,V,pe,j.data)):n.texImage3D(t.TEXTURE_3D,0,Ne,j.width,j.height,j.depth,0,V,pe,j.data);else if(ue.isFramebufferTexture){if(Dn)if(bt)n.texStorage2D(t.TEXTURE_2D,Dt,Ne,j.width,j.height);else{let st=j.width,Ct=j.height;for(let sn=0;sn<Dt;sn++)n.texImage2D(t.TEXTURE_2D,sn,Ne,st,Ct,0,V,pe,null),st>>=1,Ct>>=1}}else if(dt.length>0){if(bt&&Dn){const st=$t(dt[0]);n.texStorage2D(t.TEXTURE_2D,Dt,Ne,st.width,st.height)}for(let st=0,Ct=dt.length;st<Ct;st++)Fe=dt[st],bt?Ue&&n.texSubImage2D(t.TEXTURE_2D,st,0,0,V,pe,Fe):n.texImage2D(t.TEXTURE_2D,st,Ne,V,pe,Fe);ue.generateMipmaps=!1}else if(bt){if(Dn){const st=$t(j);n.texStorage2D(t.TEXTURE_2D,Dt,Ne,st.width,st.height)}Ue&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,V,pe,j)}else n.texImage2D(t.TEXTURE_2D,0,Ne,V,pe,j);y(ue)&&E(yt),Vt.__version=ze.version,ue.onUpdate&&ue.onUpdate(ue)}Ce.__version=ue.version}function xe(Ce,ue,tt){if(ue.image.length!==6)return;const yt=_e(Ce,ue),We=ue.source;n.bindTexture(t.TEXTURE_CUBE_MAP,Ce.__webglTexture,t.TEXTURE0+tt);const ze=r.get(We);if(We.version!==ze.__version||yt===!0){n.activeTexture(t.TEXTURE0+tt);const Vt=ki.getPrimaries(ki.workingColorSpace),xt=ue.colorSpace===np?null:ki.getPrimaries(ue.colorSpace),jt=ue.colorSpace===np||Vt===xt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,ue.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ue.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,ue.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,jt);const ae=ue.isCompressedTexture||ue.image[0].isCompressedTexture,j=ue.image[0]&&ue.image[0].isDataTexture,V=[];for(let Ct=0;Ct<6;Ct++)!ae&&!j?V[Ct]=g(ue.image[Ct],!0,i.maxCubemapSize):V[Ct]=j?ue.image[Ct].image:ue.image[Ct],V[Ct]=He(ue,V[Ct]);const pe=V[0],Ne=s.convert(ue.format,ue.colorSpace),Fe=s.convert(ue.type),dt=R(ue.internalFormat,Ne,Fe,ue.colorSpace),bt=ue.isVideoTexture!==!0,Dn=ze.__version===void 0||yt===!0,Ue=We.dataReady;let Dt=k(ue,pe);Oe(t.TEXTURE_CUBE_MAP,ue);let st;if(ae){bt&&Dn&&n.texStorage2D(t.TEXTURE_CUBE_MAP,Dt,dt,pe.width,pe.height);for(let Ct=0;Ct<6;Ct++){st=V[Ct].mipmaps;for(let sn=0;sn<st.length;sn++){const Jt=st[sn];ue.format!==Od?Ne!==null?bt?Ue&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,sn,0,0,Jt.width,Jt.height,Ne,Jt.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,sn,dt,Jt.width,Jt.height,0,Jt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):bt?Ue&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,sn,0,0,Jt.width,Jt.height,Ne,Fe,Jt.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,sn,dt,Jt.width,Jt.height,0,Ne,Fe,Jt.data)}}}else{if(st=ue.mipmaps,bt&&Dn){st.length>0&&Dt++;const Ct=$t(V[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,Dt,dt,Ct.width,Ct.height)}for(let Ct=0;Ct<6;Ct++)if(j){bt?Ue&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,0,0,0,V[Ct].width,V[Ct].height,Ne,Fe,V[Ct].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,0,dt,V[Ct].width,V[Ct].height,0,Ne,Fe,V[Ct].data);for(let sn=0;sn<st.length;sn++){const Le=st[sn].image[Ct].image;bt?Ue&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,sn+1,0,0,Le.width,Le.height,Ne,Fe,Le.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,sn+1,dt,Le.width,Le.height,0,Ne,Fe,Le.data)}}else{bt?Ue&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,0,0,0,Ne,Fe,V[Ct]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,0,dt,Ne,Fe,V[Ct]);for(let sn=0;sn<st.length;sn++){const Jt=st[sn];bt?Ue&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,sn+1,0,0,Ne,Fe,Jt.image[Ct]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,sn+1,dt,Ne,Fe,Jt.image[Ct])}}}y(ue)&&E(t.TEXTURE_CUBE_MAP),ze.__version=We.version,ue.onUpdate&&ue.onUpdate(ue)}Ce.__version=ue.version}function Ee(Ce,ue,tt,yt,We,ze){const Vt=s.convert(tt.format,tt.colorSpace),xt=s.convert(tt.type),jt=R(tt.internalFormat,Vt,xt,tt.colorSpace),ae=r.get(ue),j=r.get(tt);if(j.__renderTarget=ue,!ae.__hasExternalTextures){const V=Math.max(1,ue.width>>ze),pe=Math.max(1,ue.height>>ze);We===t.TEXTURE_3D||We===t.TEXTURE_2D_ARRAY?n.texImage3D(We,ze,jt,V,pe,ue.depth,0,Vt,xt,null):n.texImage2D(We,ze,jt,V,pe,0,Vt,xt,null)}n.bindFramebuffer(t.FRAMEBUFFER,Ce),kt(ue)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,yt,We,j.__webglTexture,0,Ge(ue)):(We===t.TEXTURE_2D||We>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&We<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,yt,We,j.__webglTexture,ze),n.bindFramebuffer(t.FRAMEBUFFER,null)}function Se(Ce,ue,tt){if(t.bindRenderbuffer(t.RENDERBUFFER,Ce),ue.depthBuffer){const yt=ue.depthTexture,We=yt&&yt.isDepthTexture?yt.type:null,ze=A(ue.stencilBuffer,We),Vt=ue.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,xt=Ge(ue);kt(ue)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,xt,ze,ue.width,ue.height):tt?t.renderbufferStorageMultisample(t.RENDERBUFFER,xt,ze,ue.width,ue.height):t.renderbufferStorage(t.RENDERBUFFER,ze,ue.width,ue.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Vt,t.RENDERBUFFER,Ce)}else{const yt=ue.textures;for(let We=0;We<yt.length;We++){const ze=yt[We],Vt=s.convert(ze.format,ze.colorSpace),xt=s.convert(ze.type),jt=R(ze.internalFormat,Vt,xt,ze.colorSpace),ae=Ge(ue);tt&&kt(ue)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,ae,jt,ue.width,ue.height):kt(ue)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ae,jt,ue.width,ue.height):t.renderbufferStorage(t.RENDERBUFFER,jt,ue.width,ue.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function Ie(Ce,ue){if(ue&&ue.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,Ce),!(ue.depthTexture&&ue.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const yt=r.get(ue.depthTexture);yt.__renderTarget=ue,(!yt.__webglTexture||ue.depthTexture.image.width!==ue.width||ue.depthTexture.image.height!==ue.height)&&(ue.depthTexture.image.width=ue.width,ue.depthTexture.image.height=ue.height,ue.depthTexture.needsUpdate=!0),ne(ue.depthTexture,0);const We=yt.__webglTexture,ze=Ge(ue);if(ue.depthTexture.format===tE)kt(ue)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,We,0,ze):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,We,0);else if(ue.depthTexture.format===K0)kt(ue)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,We,0,ze):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,We,0);else throw new Error("Unknown depthTexture format")}function Ze(Ce){const ue=r.get(Ce),tt=Ce.isWebGLCubeRenderTarget===!0;if(ue.__boundDepthTexture!==Ce.depthTexture){const yt=Ce.depthTexture;if(ue.__depthDisposeCallback&&ue.__depthDisposeCallback(),yt){const We=()=>{delete ue.__boundDepthTexture,delete ue.__depthDisposeCallback,yt.removeEventListener("dispose",We)};yt.addEventListener("dispose",We),ue.__depthDisposeCallback=We}ue.__boundDepthTexture=yt}if(Ce.depthTexture&&!ue.__autoAllocateDepthBuffer){if(tt)throw new Error("target.depthTexture not supported in Cube render targets");Ie(ue.__webglFramebuffer,Ce)}else if(tt){ue.__webglDepthbuffer=[];for(let yt=0;yt<6;yt++)if(n.bindFramebuffer(t.FRAMEBUFFER,ue.__webglFramebuffer[yt]),ue.__webglDepthbuffer[yt]===void 0)ue.__webglDepthbuffer[yt]=t.createRenderbuffer(),Se(ue.__webglDepthbuffer[yt],Ce,!1);else{const We=Ce.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,ze=ue.__webglDepthbuffer[yt];t.bindRenderbuffer(t.RENDERBUFFER,ze),t.framebufferRenderbuffer(t.FRAMEBUFFER,We,t.RENDERBUFFER,ze)}}else if(n.bindFramebuffer(t.FRAMEBUFFER,ue.__webglFramebuffer),ue.__webglDepthbuffer===void 0)ue.__webglDepthbuffer=t.createRenderbuffer(),Se(ue.__webglDepthbuffer,Ce,!1);else{const yt=Ce.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,We=ue.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,We),t.framebufferRenderbuffer(t.FRAMEBUFFER,yt,t.RENDERBUFFER,We)}n.bindFramebuffer(t.FRAMEBUFFER,null)}function _t(Ce,ue,tt){const yt=r.get(Ce);ue!==void 0&&Ee(yt.__webglFramebuffer,Ce,Ce.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),tt!==void 0&&Ze(Ce)}function fe(Ce){const ue=Ce.texture,tt=r.get(Ce),yt=r.get(ue);Ce.addEventListener("dispose",N);const We=Ce.textures,ze=Ce.isWebGLCubeRenderTarget===!0,Vt=We.length>1;if(Vt||(yt.__webglTexture===void 0&&(yt.__webglTexture=t.createTexture()),yt.__version=ue.version,o.memory.textures++),ze){tt.__webglFramebuffer=[];for(let xt=0;xt<6;xt++)if(ue.mipmaps&&ue.mipmaps.length>0){tt.__webglFramebuffer[xt]=[];for(let jt=0;jt<ue.mipmaps.length;jt++)tt.__webglFramebuffer[xt][jt]=t.createFramebuffer()}else tt.__webglFramebuffer[xt]=t.createFramebuffer()}else{if(ue.mipmaps&&ue.mipmaps.length>0){tt.__webglFramebuffer=[];for(let xt=0;xt<ue.mipmaps.length;xt++)tt.__webglFramebuffer[xt]=t.createFramebuffer()}else tt.__webglFramebuffer=t.createFramebuffer();if(Vt)for(let xt=0,jt=We.length;xt<jt;xt++){const ae=r.get(We[xt]);ae.__webglTexture===void 0&&(ae.__webglTexture=t.createTexture(),o.memory.textures++)}if(Ce.samples>0&&kt(Ce)===!1){tt.__webglMultisampledFramebuffer=t.createFramebuffer(),tt.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,tt.__webglMultisampledFramebuffer);for(let xt=0;xt<We.length;xt++){const jt=We[xt];tt.__webglColorRenderbuffer[xt]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,tt.__webglColorRenderbuffer[xt]);const ae=s.convert(jt.format,jt.colorSpace),j=s.convert(jt.type),V=R(jt.internalFormat,ae,j,jt.colorSpace,Ce.isXRRenderTarget===!0),pe=Ge(Ce);t.renderbufferStorageMultisample(t.RENDERBUFFER,pe,V,Ce.width,Ce.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+xt,t.RENDERBUFFER,tt.__webglColorRenderbuffer[xt])}t.bindRenderbuffer(t.RENDERBUFFER,null),Ce.depthBuffer&&(tt.__webglDepthRenderbuffer=t.createRenderbuffer(),Se(tt.__webglDepthRenderbuffer,Ce,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(ze){n.bindTexture(t.TEXTURE_CUBE_MAP,yt.__webglTexture),Oe(t.TEXTURE_CUBE_MAP,ue);for(let xt=0;xt<6;xt++)if(ue.mipmaps&&ue.mipmaps.length>0)for(let jt=0;jt<ue.mipmaps.length;jt++)Ee(tt.__webglFramebuffer[xt][jt],Ce,ue,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,jt);else Ee(tt.__webglFramebuffer[xt],Ce,ue,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,0);y(ue)&&E(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Vt){for(let xt=0,jt=We.length;xt<jt;xt++){const ae=We[xt],j=r.get(ae);n.bindTexture(t.TEXTURE_2D,j.__webglTexture),Oe(t.TEXTURE_2D,ae),Ee(tt.__webglFramebuffer,Ce,ae,t.COLOR_ATTACHMENT0+xt,t.TEXTURE_2D,0),y(ae)&&E(t.TEXTURE_2D)}n.unbindTexture()}else{let xt=t.TEXTURE_2D;if((Ce.isWebGL3DRenderTarget||Ce.isWebGLArrayRenderTarget)&&(xt=Ce.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(xt,yt.__webglTexture),Oe(xt,ue),ue.mipmaps&&ue.mipmaps.length>0)for(let jt=0;jt<ue.mipmaps.length;jt++)Ee(tt.__webglFramebuffer[jt],Ce,ue,t.COLOR_ATTACHMENT0,xt,jt);else Ee(tt.__webglFramebuffer,Ce,ue,t.COLOR_ATTACHMENT0,xt,0);y(ue)&&E(xt),n.unbindTexture()}Ce.depthBuffer&&Ze(Ce)}function ge(Ce){const ue=Ce.textures;for(let tt=0,yt=ue.length;tt<yt;tt++){const We=ue[tt];if(y(We)){const ze=w(Ce),Vt=r.get(We).__webglTexture;n.bindTexture(ze,Vt),E(ze),n.unbindTexture()}}}const rt=[],Re=[];function St(Ce){if(Ce.samples>0){if(kt(Ce)===!1){const ue=Ce.textures,tt=Ce.width,yt=Ce.height;let We=t.COLOR_BUFFER_BIT;const ze=Ce.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Vt=r.get(Ce),xt=ue.length>1;if(xt)for(let jt=0;jt<ue.length;jt++)n.bindFramebuffer(t.FRAMEBUFFER,Vt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+jt,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,Vt.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+jt,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,Vt.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Vt.__webglFramebuffer);for(let jt=0;jt<ue.length;jt++){if(Ce.resolveDepthBuffer&&(Ce.depthBuffer&&(We|=t.DEPTH_BUFFER_BIT),Ce.stencilBuffer&&Ce.resolveStencilBuffer&&(We|=t.STENCIL_BUFFER_BIT)),xt){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Vt.__webglColorRenderbuffer[jt]);const ae=r.get(ue[jt]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,ae,0)}t.blitFramebuffer(0,0,tt,yt,0,0,tt,yt,We,t.NEAREST),c===!0&&(rt.length=0,Re.length=0,rt.push(t.COLOR_ATTACHMENT0+jt),Ce.depthBuffer&&Ce.resolveDepthBuffer===!1&&(rt.push(ze),Re.push(ze),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,Re)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,rt))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),xt)for(let jt=0;jt<ue.length;jt++){n.bindFramebuffer(t.FRAMEBUFFER,Vt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+jt,t.RENDERBUFFER,Vt.__webglColorRenderbuffer[jt]);const ae=r.get(ue[jt]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,Vt.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+jt,t.TEXTURE_2D,ae,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Vt.__webglMultisampledFramebuffer)}else if(Ce.depthBuffer&&Ce.resolveDepthBuffer===!1&&c){const ue=Ce.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[ue])}}}function Ge(Ce){return Math.min(i.maxSamples,Ce.samples)}function kt(Ce){const ue=r.get(Ce);return Ce.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ue.__useRenderToTexture!==!1}function Bt(Ce){const ue=o.render.frame;u.get(Ce)!==ue&&(u.set(Ce,ue),Ce.update())}function He(Ce,ue){const tt=Ce.colorSpace,yt=Ce.format,We=Ce.type;return Ce.isCompressedTexture===!0||Ce.isVideoTexture===!0||tt!==x_&&tt!==np&&(ki.getTransfer(tt)===es?(yt!==Od||We!==Yc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",tt)),ue}function $t(Ce){return typeof HTMLImageElement<"u"&&Ce instanceof HTMLImageElement?(l.width=Ce.naturalWidth||Ce.width,l.height=Ce.naturalHeight||Ce.height):typeof VideoFrame<"u"&&Ce instanceof VideoFrame?(l.width=Ce.displayWidth,l.height=Ce.displayHeight):(l.width=Ce.width,l.height=Ce.height),l}this.allocateTextureUnit=W,this.resetTextureUnits=K,this.setTexture2D=ne,this.setTexture2DArray=Z,this.setTexture3D=ie,this.setTextureCube=G,this.rebindTextures=_t,this.setupRenderTarget=fe,this.updateRenderTargetMipmap=ge,this.updateMultisampleRenderTarget=St,this.setupDepthRenderbuffer=Ze,this.setupFrameBufferTexture=Ee,this.useMultisampledRTT=kt}function Rle(t,e){function n(r,i=np){let s;const o=ki.getTransfer(i);if(r===Yc)return t.UNSIGNED_BYTE;if(r===GF)return t.UNSIGNED_SHORT_4_4_4_4;if(r===WF)return t.UNSIGNED_SHORT_5_5_5_1;if(r===zG)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===HG)return t.BYTE;if(r===VG)return t.SHORT;if(r===RT)return t.UNSIGNED_SHORT;if(r===zF)return t.INT;if(r===c_)return t.UNSIGNED_INT;if(r===cp)return t.FLOAT;if(r===oS)return t.HALF_FLOAT;if(r===GG)return t.ALPHA;if(r===WG)return t.RGB;if(r===Od)return t.RGBA;if(r===qG)return t.LUMINANCE;if(r===KG)return t.LUMINANCE_ALPHA;if(r===tE)return t.DEPTH_COMPONENT;if(r===K0)return t.DEPTH_STENCIL;if(r===YG)return t.RED;if(r===qF)return t.RED_INTEGER;if(r===XG)return t.RG;if(r===KF)return t.RG_INTEGER;if(r===JA)return t.RGBA_INTEGER;if(r===gC||r===vC||r===_C||r===yC)if(o===es)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===gC)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===vC)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===_C)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===yC)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===gC)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===vC)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===_C)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===yC)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===kL||r===NL||r===PL||r===DL)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===kL)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===NL)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===PL)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===DL)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===LL||r===UL||r===FL)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===LL||r===UL)return o===es?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===FL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===BL||r===jL||r===$L||r===HL||r===VL||r===zL||r===GL||r===WL||r===qL||r===KL||r===YL||r===XL||r===JL||r===QL)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===BL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===jL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===$L)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===HL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===VL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===zL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===GL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===WL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===qL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===KL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===YL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===XL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===JL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===QL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===bC||r===ZL||r===e2)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===bC)return o===es?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===ZL)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===e2)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===JG||r===t2||r===n2||r===r2)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===bC)return s.COMPRESSED_RED_RGTC1_EXT;if(r===t2)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===n2)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===r2)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===q0?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:n}}class Ale extends ju{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class eT extends cu{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Mle={type:"move"};class oP{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new eT,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new eT,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ht,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ht),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new eT,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ht,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ht),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const g of e.hand.values()){const y=n.getJointPose(g,r),E=this._getHandJoint(l,g);y!==null&&(E.matrix.fromArray(y.transform.matrix),E.matrix.decompose(E.position,E.rotation,E.scale),E.matrixWorldNeedsUpdate=!0,E.jointRadius=y.radius),E.visible=y!==null}const u=l.joints["index-finger-tip"],d=l.joints["thumb-tip"],h=u.position.distanceTo(d.position),p=.02,f=.005;l.inputState.pinching&&h>p+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=p-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,r),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=n.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Mle)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new eT;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}const Ile=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Ole=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class kle{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,r){if(this.texture===null){const i=new So,s=e.properties.get(i);s.__webglTexture=n.texture,(n.depthNear!=r.depthNear||n.depthFar!=r.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,r=new Il({vertexShader:Ile,fragmentShader:Ole,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Dh(new Tw(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Nle extends vg{constructor(e,n){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,d=null,h=null,p=null,f=null;const g=new kle,y=n.getContextAttributes();let E=null,w=null;const R=[],A=[],k=new Vn;let I=null;const N=new ju;N.viewport=new Bo;const U=new ju;U.viewport=new Bo;const F=[N,U],$=new Ale;let q=null,K=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(le){let xe=R[le];return xe===void 0&&(xe=new oP,R[le]=xe),xe.getTargetRaySpace()},this.getControllerGrip=function(le){let xe=R[le];return xe===void 0&&(xe=new oP,R[le]=xe),xe.getGripSpace()},this.getHand=function(le){let xe=R[le];return xe===void 0&&(xe=new oP,R[le]=xe),xe.getHandSpace()};function W(le){const xe=A.indexOf(le.inputSource);if(xe===-1)return;const Ee=R[xe];Ee!==void 0&&(Ee.update(le.inputSource,le.frame,l||o),Ee.dispatchEvent({type:le.type,data:le.inputSource}))}function X(){i.removeEventListener("select",W),i.removeEventListener("selectstart",W),i.removeEventListener("selectend",W),i.removeEventListener("squeeze",W),i.removeEventListener("squeezestart",W),i.removeEventListener("squeezeend",W),i.removeEventListener("end",X),i.removeEventListener("inputsourceschange",ne);for(let le=0;le<R.length;le++){const xe=A[le];xe!==null&&(A[le]=null,R[le].disconnect(xe))}q=null,K=null,g.reset(),e.setRenderTarget(E),p=null,h=null,d=null,i=null,w=null,_e.stop(),r.isPresenting=!1,e.setPixelRatio(I),e.setSize(k.width,k.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(le){s=le,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(le){a=le,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(le){l=le},this.getBaseLayer=function(){return h!==null?h:p},this.getBinding=function(){return d},this.getFrame=function(){return f},this.getSession=function(){return i},this.setSession=async function(le){if(i=le,i!==null){if(E=e.getRenderTarget(),i.addEventListener("select",W),i.addEventListener("selectstart",W),i.addEventListener("selectend",W),i.addEventListener("squeeze",W),i.addEventListener("squeezestart",W),i.addEventListener("squeezeend",W),i.addEventListener("end",X),i.addEventListener("inputsourceschange",ne),y.xrCompatible!==!0&&await n.makeXRCompatible(),I=e.getPixelRatio(),e.getSize(k),i.renderState.layers===void 0){const xe={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(i,n,xe),i.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),w=new Zu(p.framebufferWidth,p.framebufferHeight,{format:Od,type:Yc,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil})}else{let xe=null,Ee=null,Se=null;y.depth&&(Se=y.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,xe=y.stencil?K0:tE,Ee=y.stencil?q0:c_);const Ie={colorFormat:n.RGBA8,depthFormat:Se,scaleFactor:s};d=new XRWebGLBinding(i,n),h=d.createProjectionLayer(Ie),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),w=new Zu(h.textureWidth,h.textureHeight,{format:Od,type:Yc,depthTexture:new eB(h.textureWidth,h.textureHeight,Ee,void 0,void 0,void 0,void 0,void 0,void 0,xe),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1})}w.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await i.requestReferenceSpace(a),_e.setContext(i),_e.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function ne(le){for(let xe=0;xe<le.removed.length;xe++){const Ee=le.removed[xe],Se=A.indexOf(Ee);Se>=0&&(A[Se]=null,R[Se].disconnect(Ee))}for(let xe=0;xe<le.added.length;xe++){const Ee=le.added[xe];let Se=A.indexOf(Ee);if(Se===-1){for(let Ze=0;Ze<R.length;Ze++)if(Ze>=A.length){A.push(Ee),Se=Ze;break}else if(A[Ze]===null){A[Ze]=Ee,Se=Ze;break}if(Se===-1)break}const Ie=R[Se];Ie&&Ie.connect(Ee)}}const Z=new ht,ie=new ht;function G(le,xe,Ee){Z.setFromMatrixPosition(xe.matrixWorld),ie.setFromMatrixPosition(Ee.matrixWorld);const Se=Z.distanceTo(ie),Ie=xe.projectionMatrix.elements,Ze=Ee.projectionMatrix.elements,_t=Ie[14]/(Ie[10]-1),fe=Ie[14]/(Ie[10]+1),ge=(Ie[9]+1)/Ie[5],rt=(Ie[9]-1)/Ie[5],Re=(Ie[8]-1)/Ie[0],St=(Ze[8]+1)/Ze[0],Ge=_t*Re,kt=_t*St,Bt=Se/(-Re+St),He=Bt*-Re;if(xe.matrixWorld.decompose(le.position,le.quaternion,le.scale),le.translateX(He),le.translateZ(Bt),le.matrixWorld.compose(le.position,le.quaternion,le.scale),le.matrixWorldInverse.copy(le.matrixWorld).invert(),Ie[10]===-1)le.projectionMatrix.copy(xe.projectionMatrix),le.projectionMatrixInverse.copy(xe.projectionMatrixInverse);else{const $t=_t+Bt,Ce=fe+Bt,ue=Ge-He,tt=kt+(Se-He),yt=ge*fe/Ce*$t,We=rt*fe/Ce*$t;le.projectionMatrix.makePerspective(ue,tt,yt,We,$t,Ce),le.projectionMatrixInverse.copy(le.projectionMatrix).invert()}}function Q(le,xe){xe===null?le.matrixWorld.copy(le.matrix):le.matrixWorld.multiplyMatrices(xe.matrixWorld,le.matrix),le.matrixWorldInverse.copy(le.matrixWorld).invert()}this.updateCamera=function(le){if(i===null)return;let xe=le.near,Ee=le.far;g.texture!==null&&(g.depthNear>0&&(xe=g.depthNear),g.depthFar>0&&(Ee=g.depthFar)),$.near=U.near=N.near=xe,$.far=U.far=N.far=Ee,(q!==$.near||K!==$.far)&&(i.updateRenderState({depthNear:$.near,depthFar:$.far}),q=$.near,K=$.far),N.layers.mask=le.layers.mask|2,U.layers.mask=le.layers.mask|4,$.layers.mask=N.layers.mask|U.layers.mask;const Se=le.parent,Ie=$.cameras;Q($,Se);for(let Ze=0;Ze<Ie.length;Ze++)Q(Ie[Ze],Se);Ie.length===2?G($,N,U):$.projectionMatrix.copy(N.projectionMatrix),se(le,$,Se)};function se(le,xe,Ee){Ee===null?le.matrix.copy(xe.matrixWorld):(le.matrix.copy(Ee.matrixWorld),le.matrix.invert(),le.matrix.multiply(xe.matrixWorld)),le.matrix.decompose(le.position,le.quaternion,le.scale),le.updateMatrixWorld(!0),le.projectionMatrix.copy(xe.projectionMatrix),le.projectionMatrixInverse.copy(xe.projectionMatrixInverse),le.isPerspectiveCamera&&(le.fov=AT*2*Math.atan(1/le.projectionMatrix.elements[5]),le.zoom=1)}this.getCamera=function(){return $},this.getFoveation=function(){if(!(h===null&&p===null))return c},this.setFoveation=function(le){c=le,h!==null&&(h.fixedFoveation=le),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=le)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh($)};let ve=null;function Oe(le,xe){if(u=xe.getViewerPose(l||o),f=xe,u!==null){const Ee=u.views;p!==null&&(e.setRenderTargetFramebuffer(w,p.framebuffer),e.setRenderTarget(w));let Se=!1;Ee.length!==$.cameras.length&&($.cameras.length=0,Se=!0);for(let Ze=0;Ze<Ee.length;Ze++){const _t=Ee[Ze];let fe=null;if(p!==null)fe=p.getViewport(_t);else{const rt=d.getViewSubImage(h,_t);fe=rt.viewport,Ze===0&&(e.setRenderTargetTextures(w,rt.colorTexture,h.ignoreDepthValues?void 0:rt.depthStencilTexture),e.setRenderTarget(w))}let ge=F[Ze];ge===void 0&&(ge=new ju,ge.layers.enable(Ze),ge.viewport=new Bo,F[Ze]=ge),ge.matrix.fromArray(_t.transform.matrix),ge.matrix.decompose(ge.position,ge.quaternion,ge.scale),ge.projectionMatrix.fromArray(_t.projectionMatrix),ge.projectionMatrixInverse.copy(ge.projectionMatrix).invert(),ge.viewport.set(fe.x,fe.y,fe.width,fe.height),Ze===0&&($.matrix.copy(ge.matrix),$.matrix.decompose($.position,$.quaternion,$.scale)),Se===!0&&$.cameras.push(ge)}const Ie=i.enabledFeatures;if(Ie&&Ie.includes("depth-sensing")){const Ze=d.getDepthInformation(Ee[0]);Ze&&Ze.isValid&&Ze.texture&&g.init(e,Ze,i.renderState)}}for(let Ee=0;Ee<R.length;Ee++){const Se=A[Ee],Ie=R[Ee];Se!==null&&Ie!==void 0&&Ie.update(Se,xe,l||o)}ve&&ve(le,xe),xe.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:xe}),f=null}const _e=new lW;_e.setAnimationLoop(Oe),this.setAnimationLoop=function(le){ve=le},this.dispose=function(){}}}const l0=new cg,Ple=new To;function Dle(t,e){function n(y,E){y.matrixAutoUpdate===!0&&y.updateMatrix(),E.value.copy(y.matrix)}function r(y,E){E.color.getRGB(y.fogColor.value,oW(t)),E.isFog?(y.fogNear.value=E.near,y.fogFar.value=E.far):E.isFogExp2&&(y.fogDensity.value=E.density)}function i(y,E,w,R,A){E.isMeshBasicMaterial||E.isMeshLambertMaterial?s(y,E):E.isMeshToonMaterial?(s(y,E),d(y,E)):E.isMeshPhongMaterial?(s(y,E),u(y,E)):E.isMeshStandardMaterial?(s(y,E),h(y,E),E.isMeshPhysicalMaterial&&p(y,E,A)):E.isMeshMatcapMaterial?(s(y,E),f(y,E)):E.isMeshDepthMaterial?s(y,E):E.isMeshDistanceMaterial?(s(y,E),g(y,E)):E.isMeshNormalMaterial?s(y,E):E.isLineBasicMaterial?(o(y,E),E.isLineDashedMaterial&&a(y,E)):E.isPointsMaterial?c(y,E,w,R):E.isSpriteMaterial?l(y,E):E.isShadowMaterial?(y.color.value.copy(E.color),y.opacity.value=E.opacity):E.isShaderMaterial&&(E.uniformsNeedUpdate=!1)}function s(y,E){y.opacity.value=E.opacity,E.color&&y.diffuse.value.copy(E.color),E.emissive&&y.emissive.value.copy(E.emissive).multiplyScalar(E.emissiveIntensity),E.map&&(y.map.value=E.map,n(E.map,y.mapTransform)),E.alphaMap&&(y.alphaMap.value=E.alphaMap,n(E.alphaMap,y.alphaMapTransform)),E.bumpMap&&(y.bumpMap.value=E.bumpMap,n(E.bumpMap,y.bumpMapTransform),y.bumpScale.value=E.bumpScale,E.side===sc&&(y.bumpScale.value*=-1)),E.normalMap&&(y.normalMap.value=E.normalMap,n(E.normalMap,y.normalMapTransform),y.normalScale.value.copy(E.normalScale),E.side===sc&&y.normalScale.value.negate()),E.displacementMap&&(y.displacementMap.value=E.displacementMap,n(E.displacementMap,y.displacementMapTransform),y.displacementScale.value=E.displacementScale,y.displacementBias.value=E.displacementBias),E.emissiveMap&&(y.emissiveMap.value=E.emissiveMap,n(E.emissiveMap,y.emissiveMapTransform)),E.specularMap&&(y.specularMap.value=E.specularMap,n(E.specularMap,y.specularMapTransform)),E.alphaTest>0&&(y.alphaTest.value=E.alphaTest);const w=e.get(E),R=w.envMap,A=w.envMapRotation;R&&(y.envMap.value=R,l0.copy(A),l0.x*=-1,l0.y*=-1,l0.z*=-1,R.isCubeTexture&&R.isRenderTargetTexture===!1&&(l0.y*=-1,l0.z*=-1),y.envMapRotation.value.setFromMatrix4(Ple.makeRotationFromEuler(l0)),y.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=E.reflectivity,y.ior.value=E.ior,y.refractionRatio.value=E.refractionRatio),E.lightMap&&(y.lightMap.value=E.lightMap,y.lightMapIntensity.value=E.lightMapIntensity,n(E.lightMap,y.lightMapTransform)),E.aoMap&&(y.aoMap.value=E.aoMap,y.aoMapIntensity.value=E.aoMapIntensity,n(E.aoMap,y.aoMapTransform))}function o(y,E){y.diffuse.value.copy(E.color),y.opacity.value=E.opacity,E.map&&(y.map.value=E.map,n(E.map,y.mapTransform))}function a(y,E){y.dashSize.value=E.dashSize,y.totalSize.value=E.dashSize+E.gapSize,y.scale.value=E.scale}function c(y,E,w,R){y.diffuse.value.copy(E.color),y.opacity.value=E.opacity,y.size.value=E.size*w,y.scale.value=R*.5,E.map&&(y.map.value=E.map,n(E.map,y.uvTransform)),E.alphaMap&&(y.alphaMap.value=E.alphaMap,n(E.alphaMap,y.alphaMapTransform)),E.alphaTest>0&&(y.alphaTest.value=E.alphaTest)}function l(y,E){y.diffuse.value.copy(E.color),y.opacity.value=E.opacity,y.rotation.value=E.rotation,E.map&&(y.map.value=E.map,n(E.map,y.mapTransform)),E.alphaMap&&(y.alphaMap.value=E.alphaMap,n(E.alphaMap,y.alphaMapTransform)),E.alphaTest>0&&(y.alphaTest.value=E.alphaTest)}function u(y,E){y.specular.value.copy(E.specular),y.shininess.value=Math.max(E.shininess,1e-4)}function d(y,E){E.gradientMap&&(y.gradientMap.value=E.gradientMap)}function h(y,E){y.metalness.value=E.metalness,E.metalnessMap&&(y.metalnessMap.value=E.metalnessMap,n(E.metalnessMap,y.metalnessMapTransform)),y.roughness.value=E.roughness,E.roughnessMap&&(y.roughnessMap.value=E.roughnessMap,n(E.roughnessMap,y.roughnessMapTransform)),E.envMap&&(y.envMapIntensity.value=E.envMapIntensity)}function p(y,E,w){y.ior.value=E.ior,E.sheen>0&&(y.sheenColor.value.copy(E.sheenColor).multiplyScalar(E.sheen),y.sheenRoughness.value=E.sheenRoughness,E.sheenColorMap&&(y.sheenColorMap.value=E.sheenColorMap,n(E.sheenColorMap,y.sheenColorMapTransform)),E.sheenRoughnessMap&&(y.sheenRoughnessMap.value=E.sheenRoughnessMap,n(E.sheenRoughnessMap,y.sheenRoughnessMapTransform))),E.clearcoat>0&&(y.clearcoat.value=E.clearcoat,y.clearcoatRoughness.value=E.clearcoatRoughness,E.clearcoatMap&&(y.clearcoatMap.value=E.clearcoatMap,n(E.clearcoatMap,y.clearcoatMapTransform)),E.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=E.clearcoatRoughnessMap,n(E.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),E.clearcoatNormalMap&&(y.clearcoatNormalMap.value=E.clearcoatNormalMap,n(E.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(E.clearcoatNormalScale),E.side===sc&&y.clearcoatNormalScale.value.negate())),E.dispersion>0&&(y.dispersion.value=E.dispersion),E.iridescence>0&&(y.iridescence.value=E.iridescence,y.iridescenceIOR.value=E.iridescenceIOR,y.iridescenceThicknessMinimum.value=E.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=E.iridescenceThicknessRange[1],E.iridescenceMap&&(y.iridescenceMap.value=E.iridescenceMap,n(E.iridescenceMap,y.iridescenceMapTransform)),E.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=E.iridescenceThicknessMap,n(E.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),E.transmission>0&&(y.transmission.value=E.transmission,y.transmissionSamplerMap.value=w.texture,y.transmissionSamplerSize.value.set(w.width,w.height),E.transmissionMap&&(y.transmissionMap.value=E.transmissionMap,n(E.transmissionMap,y.transmissionMapTransform)),y.thickness.value=E.thickness,E.thicknessMap&&(y.thicknessMap.value=E.thicknessMap,n(E.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=E.attenuationDistance,y.attenuationColor.value.copy(E.attenuationColor)),E.anisotropy>0&&(y.anisotropyVector.value.set(E.anisotropy*Math.cos(E.anisotropyRotation),E.anisotropy*Math.sin(E.anisotropyRotation)),E.anisotropyMap&&(y.anisotropyMap.value=E.anisotropyMap,n(E.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=E.specularIntensity,y.specularColor.value.copy(E.specularColor),E.specularColorMap&&(y.specularColorMap.value=E.specularColorMap,n(E.specularColorMap,y.specularColorMapTransform)),E.specularIntensityMap&&(y.specularIntensityMap.value=E.specularIntensityMap,n(E.specularIntensityMap,y.specularIntensityMapTransform))}function f(y,E){E.matcap&&(y.matcap.value=E.matcap)}function g(y,E){const w=e.get(E).light;y.referencePosition.value.setFromMatrixPosition(w.matrixWorld),y.nearDistance.value=w.shadow.camera.near,y.farDistance.value=w.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function Lle(t,e,n,r){let i={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(w,R){const A=R.program;r.uniformBlockBinding(w,A)}function l(w,R){let A=i[w.id];A===void 0&&(f(w),A=u(w),i[w.id]=A,w.addEventListener("dispose",y));const k=R.program;r.updateUBOMapping(w,k);const I=e.render.frame;s[w.id]!==I&&(h(w),s[w.id]=I)}function u(w){const R=d();w.__bindingPointIndex=R;const A=t.createBuffer(),k=w.__size,I=w.usage;return t.bindBuffer(t.UNIFORM_BUFFER,A),t.bufferData(t.UNIFORM_BUFFER,k,I),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,R,A),A}function d(){for(let w=0;w<a;w++)if(o.indexOf(w)===-1)return o.push(w),w;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(w){const R=i[w.id],A=w.uniforms,k=w.__cache;t.bindBuffer(t.UNIFORM_BUFFER,R);for(let I=0,N=A.length;I<N;I++){const U=Array.isArray(A[I])?A[I]:[A[I]];for(let F=0,$=U.length;F<$;F++){const q=U[F];if(p(q,I,F,k)===!0){const K=q.__offset,W=Array.isArray(q.value)?q.value:[q.value];let X=0;for(let ne=0;ne<W.length;ne++){const Z=W[ne],ie=g(Z);typeof Z=="number"||typeof Z=="boolean"?(q.__data[0]=Z,t.bufferSubData(t.UNIFORM_BUFFER,K+X,q.__data)):Z.isMatrix3?(q.__data[0]=Z.elements[0],q.__data[1]=Z.elements[1],q.__data[2]=Z.elements[2],q.__data[3]=0,q.__data[4]=Z.elements[3],q.__data[5]=Z.elements[4],q.__data[6]=Z.elements[5],q.__data[7]=0,q.__data[8]=Z.elements[6],q.__data[9]=Z.elements[7],q.__data[10]=Z.elements[8],q.__data[11]=0):(Z.toArray(q.__data,X),X+=ie.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,K,q.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function p(w,R,A,k){const I=w.value,N=R+"_"+A;if(k[N]===void 0)return typeof I=="number"||typeof I=="boolean"?k[N]=I:k[N]=I.clone(),!0;{const U=k[N];if(typeof I=="number"||typeof I=="boolean"){if(U!==I)return k[N]=I,!0}else if(U.equals(I)===!1)return U.copy(I),!0}return!1}function f(w){const R=w.uniforms;let A=0;const k=16;for(let N=0,U=R.length;N<U;N++){const F=Array.isArray(R[N])?R[N]:[R[N]];for(let $=0,q=F.length;$<q;$++){const K=F[$],W=Array.isArray(K.value)?K.value:[K.value];for(let X=0,ne=W.length;X<ne;X++){const Z=W[X],ie=g(Z),G=A%k,Q=G%ie.boundary,se=G+Q;A+=Q,se!==0&&k-se<ie.storage&&(A+=k-se),K.__data=new Float32Array(ie.storage/Float32Array.BYTES_PER_ELEMENT),K.__offset=A,A+=ie.storage}}}const I=A%k;return I>0&&(A+=k-I),w.__size=A,w.__cache={},this}function g(w){const R={boundary:0,storage:0};return typeof w=="number"||typeof w=="boolean"?(R.boundary=4,R.storage=4):w.isVector2?(R.boundary=8,R.storage=8):w.isVector3||w.isColor?(R.boundary=16,R.storage=12):w.isVector4?(R.boundary=16,R.storage=16):w.isMatrix3?(R.boundary=48,R.storage=48):w.isMatrix4?(R.boundary=64,R.storage=64):w.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",w),R}function y(w){const R=w.target;R.removeEventListener("dispose",y);const A=o.indexOf(R.__bindingPointIndex);o.splice(A,1),t.deleteBuffer(i[R.id]),delete i[R.id],delete s[R.id]}function E(){for(const w in i)t.deleteBuffer(i[w]);o=[],i={},s={}}return{bind:c,update:l,dispose:E}}class Ule{constructor(e={}){const{canvas:n=xie(),context:r=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1,reverseDepthBuffer:h=!1}=e;this.isWebGLRenderer=!0;let p;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=r.getContextAttributes().alpha}else p=o;const f=new Uint32Array(4),g=new Int32Array(4);let y=null,E=null;const w=[],R=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Lo,this.toneMapping=up,this.toneMappingExposure=1;const A=this;let k=!1,I=0,N=0,U=null,F=-1,$=null;const q=new Bo,K=new Bo;let W=null;const X=new Ei(0);let ne=0,Z=n.width,ie=n.height,G=1,Q=null,se=null;const ve=new Bo(0,0,Z,ie),Oe=new Bo(0,0,Z,ie);let _e=!1;const le=new cW;let xe=!1,Ee=!1;const Se=new To,Ie=new To,Ze=new ht,_t=new Bo,fe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ge=!1;function rt(){return U===null?G:1}let Re=r;function St(ye,Ke){return n.getContext(ye,Ke)}try{const ye={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${YA}`),n.addEventListener("webglcontextlost",Ct,!1),n.addEventListener("webglcontextrestored",sn,!1),n.addEventListener("webglcontextcreationerror",Jt,!1),Re===null){const Ke="webgl2";if(Re=St(Ke,ye),Re===null)throw St(Ke)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ye){throw console.error("THREE.WebGLRenderer: "+ye.message),ye}let Ge,kt,Bt,He,$t,Ce,ue,tt,yt,We,ze,Vt,xt,jt,ae,j,V,pe,Ne,Fe,dt,bt,Dn,Ue;function Dt(){Ge=new Hae(Re),Ge.init(),bt=new Rle(Re,Ge),kt=new Lae(Re,Ge,e,bt),Bt=new wle(Re,Ge),kt.reverseDepthBuffer&&h&&Bt.buffers.depth.setReversed(!0),He=new Gae(Re),$t=new lle,Ce=new Cle(Re,Ge,Bt,$t,kt,bt,He),ue=new Fae(A),tt=new $ae(A),yt=new Qie(Re),Dn=new Pae(Re,yt),We=new Vae(Re,yt,He,Dn),ze=new qae(Re,We,yt,He),Ne=new Wae(Re,kt,Ce),j=new Uae($t),Vt=new cle(A,ue,tt,Ge,kt,Dn,j),xt=new Dle(A,$t),jt=new dle,ae=new vle(Ge),pe=new Nae(A,ue,tt,Bt,ze,p,c),V=new Sle(A,ze,kt),Ue=new Lle(Re,He,kt,Bt),Fe=new Dae(Re,Ge,He),dt=new zae(Re,Ge,He),He.programs=Vt.programs,A.capabilities=kt,A.extensions=Ge,A.properties=$t,A.renderLists=jt,A.shadowMap=V,A.state=Bt,A.info=He}Dt();const st=new Nle(A,Re);this.xr=st,this.getContext=function(){return Re},this.getContextAttributes=function(){return Re.getContextAttributes()},this.forceContextLoss=function(){const ye=Ge.get("WEBGL_lose_context");ye&&ye.loseContext()},this.forceContextRestore=function(){const ye=Ge.get("WEBGL_lose_context");ye&&ye.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(ye){ye!==void 0&&(G=ye,this.setSize(Z,ie,!1))},this.getSize=function(ye){return ye.set(Z,ie)},this.setSize=function(ye,Ke,pt=!0){if(st.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Z=ye,ie=Ke,n.width=Math.floor(ye*G),n.height=Math.floor(Ke*G),pt===!0&&(n.style.width=ye+"px",n.style.height=Ke+"px"),this.setViewport(0,0,ye,Ke)},this.getDrawingBufferSize=function(ye){return ye.set(Z*G,ie*G).floor()},this.setDrawingBufferSize=function(ye,Ke,pt){Z=ye,ie=Ke,G=pt,n.width=Math.floor(ye*pt),n.height=Math.floor(Ke*pt),this.setViewport(0,0,ye,Ke)},this.getCurrentViewport=function(ye){return ye.copy(q)},this.getViewport=function(ye){return ye.copy(ve)},this.setViewport=function(ye,Ke,pt,vt){ye.isVector4?ve.set(ye.x,ye.y,ye.z,ye.w):ve.set(ye,Ke,pt,vt),Bt.viewport(q.copy(ve).multiplyScalar(G).round())},this.getScissor=function(ye){return ye.copy(Oe)},this.setScissor=function(ye,Ke,pt,vt){ye.isVector4?Oe.set(ye.x,ye.y,ye.z,ye.w):Oe.set(ye,Ke,pt,vt),Bt.scissor(K.copy(Oe).multiplyScalar(G).round())},this.getScissorTest=function(){return _e},this.setScissorTest=function(ye){Bt.setScissorTest(_e=ye)},this.setOpaqueSort=function(ye){Q=ye},this.setTransparentSort=function(ye){se=ye},this.getClearColor=function(ye){return ye.copy(pe.getClearColor())},this.setClearColor=function(){pe.setClearColor.apply(pe,arguments)},this.getClearAlpha=function(){return pe.getClearAlpha()},this.setClearAlpha=function(){pe.setClearAlpha.apply(pe,arguments)},this.clear=function(ye=!0,Ke=!0,pt=!0){let vt=0;if(ye){let Xe=!1;if(U!==null){const zt=U.texture.format;Xe=zt===JA||zt===KF||zt===qF}if(Xe){const zt=U.texture.type,Qt=zt===Yc||zt===c_||zt===RT||zt===q0||zt===GF||zt===WF,hn=pe.getClearColor(),mn=pe.getClearAlpha(),Un=hn.r,Xn=hn.g,_n=hn.b;Qt?(f[0]=Un,f[1]=Xn,f[2]=_n,f[3]=mn,Re.clearBufferuiv(Re.COLOR,0,f)):(g[0]=Un,g[1]=Xn,g[2]=_n,g[3]=mn,Re.clearBufferiv(Re.COLOR,0,g))}else vt|=Re.COLOR_BUFFER_BIT}Ke&&(vt|=Re.DEPTH_BUFFER_BIT),pt&&(vt|=Re.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Re.clear(vt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Ct,!1),n.removeEventListener("webglcontextrestored",sn,!1),n.removeEventListener("webglcontextcreationerror",Jt,!1),jt.dispose(),ae.dispose(),$t.dispose(),ue.dispose(),tt.dispose(),ze.dispose(),Dn.dispose(),Ue.dispose(),Vt.dispose(),st.dispose(),st.removeEventListener("sessionstart",cr),st.removeEventListener("sessionend",zn),dn.stop()};function Ct(ye){ye.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),k=!0}function sn(){console.log("THREE.WebGLRenderer: Context Restored."),k=!1;const ye=He.autoReset,Ke=V.enabled,pt=V.autoUpdate,vt=V.needsUpdate,Xe=V.type;Dt(),He.autoReset=ye,V.enabled=Ke,V.autoUpdate=pt,V.needsUpdate=vt,V.type=Xe}function Jt(ye){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ye.statusMessage)}function Le(ye){const Ke=ye.target;Ke.removeEventListener("dispose",Le),it(Ke)}function it(ye){Tt(ye),$t.remove(ye)}function Tt(ye){const Ke=$t.get(ye).programs;Ke!==void 0&&(Ke.forEach(function(pt){Vt.releaseProgram(pt)}),ye.isShaderMaterial&&Vt.releaseShaderCache(ye))}this.renderBufferDirect=function(ye,Ke,pt,vt,Xe,zt){Ke===null&&(Ke=fe);const Qt=Xe.isMesh&&Xe.matrixWorld.determinant()<0,hn=Kd(ye,Ke,pt,vt,Xe);Bt.setMaterial(vt,Qt);let mn=pt.index,Un=1;if(vt.wireframe===!0){if(mn=We.getWireframeAttribute(pt),mn===void 0)return;Un=2}const Xn=pt.drawRange,_n=pt.attributes.position;let yr=Xn.start*Un,Vr=(Xn.start+Xn.count)*Un;zt!==null&&(yr=Math.max(yr,zt.start*Un),Vr=Math.min(Vr,(zt.start+zt.count)*Un)),mn!==null?(yr=Math.max(yr,0),Vr=Math.min(Vr,mn.count)):_n!=null&&(yr=Math.max(yr,0),Vr=Math.min(Vr,_n.count));const En=Vr-yr;if(En<0||En===1/0)return;Dn.setup(Xe,vt,hn,pt,mn);let jn,br=Fe;if(mn!==null&&(jn=yt.get(mn),br=dt,br.setIndex(jn)),Xe.isMesh)vt.wireframe===!0?(Bt.setLineWidth(vt.wireframeLinewidth*rt()),br.setMode(Re.LINES)):br.setMode(Re.TRIANGLES);else if(Xe.isLine){let on=vt.linewidth;on===void 0&&(on=1),Bt.setLineWidth(on*rt()),Xe.isLineSegments?br.setMode(Re.LINES):Xe.isLineLoop?br.setMode(Re.LINE_LOOP):br.setMode(Re.LINE_STRIP)}else Xe.isPoints?br.setMode(Re.POINTS):Xe.isSprite&&br.setMode(Re.TRIANGLES);if(Xe.isBatchedMesh)if(Xe._multiDrawInstances!==null)br.renderMultiDrawInstances(Xe._multiDrawStarts,Xe._multiDrawCounts,Xe._multiDrawCount,Xe._multiDrawInstances);else if(Ge.get("WEBGL_multi_draw"))br.renderMultiDraw(Xe._multiDrawStarts,Xe._multiDrawCounts,Xe._multiDrawCount);else{const on=Xe._multiDrawStarts,qi=Xe._multiDrawCounts,Er=Xe._multiDrawCount,Bs=mn?yt.get(mn).bytesPerElement:1,Jn=$t.get(vt).currentProgram.getUniforms();for(let lr=0;lr<Er;lr++)Jn.setValue(Re,"_gl_DrawID",lr),br.render(on[lr]/Bs,qi[lr])}else if(Xe.isInstancedMesh)br.renderInstances(yr,En,Xe.count);else if(pt.isInstancedBufferGeometry){const on=pt._maxInstanceCount!==void 0?pt._maxInstanceCount:1/0,qi=Math.min(pt.instanceCount,on);br.renderInstances(yr,En,qi)}else br.render(yr,En)};function wt(ye,Ke,pt){ye.transparent===!0&&ye.side===Gu&&ye.forceSinglePass===!1?(ye.side=sc,ye.needsUpdate=!0,ii(ye,Ke,pt),ye.side=ag,ye.needsUpdate=!0,ii(ye,Ke,pt),ye.side=Gu):ii(ye,Ke,pt)}this.compile=function(ye,Ke,pt=null){pt===null&&(pt=ye),E=ae.get(pt),E.init(Ke),R.push(E),pt.traverseVisible(function(Xe){Xe.isLight&&Xe.layers.test(Ke.layers)&&(E.pushLight(Xe),Xe.castShadow&&E.pushShadow(Xe))}),ye!==pt&&ye.traverseVisible(function(Xe){Xe.isLight&&Xe.layers.test(Ke.layers)&&(E.pushLight(Xe),Xe.castShadow&&E.pushShadow(Xe))}),E.setupLights();const vt=new Set;return ye.traverse(function(Xe){if(!(Xe.isMesh||Xe.isPoints||Xe.isLine||Xe.isSprite))return;const zt=Xe.material;if(zt)if(Array.isArray(zt))for(let Qt=0;Qt<zt.length;Qt++){const hn=zt[Qt];wt(hn,pt,Xe),vt.add(hn)}else wt(zt,pt,Xe),vt.add(zt)}),R.pop(),E=null,vt},this.compileAsync=function(ye,Ke,pt=null){const vt=this.compile(ye,Ke,pt);return new Promise(Xe=>{function zt(){if(vt.forEach(function(Qt){$t.get(Qt).currentProgram.isReady()&&vt.delete(Qt)}),vt.size===0){Xe(ye);return}setTimeout(zt,10)}Ge.get("KHR_parallel_shader_compile")!==null?zt():setTimeout(zt,10)})};let Pn=null;function Yr(ye){Pn&&Pn(ye)}function cr(){dn.stop()}function zn(){dn.start()}const dn=new lW;dn.setAnimationLoop(Yr),typeof self<"u"&&dn.setContext(self),this.setAnimationLoop=function(ye){Pn=ye,st.setAnimationLoop(ye),ye===null?dn.stop():dn.start()},st.addEventListener("sessionstart",cr),st.addEventListener("sessionend",zn),this.render=function(ye,Ke){if(Ke!==void 0&&Ke.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(k===!0)return;if(ye.matrixWorldAutoUpdate===!0&&ye.updateMatrixWorld(),Ke.parent===null&&Ke.matrixWorldAutoUpdate===!0&&Ke.updateMatrixWorld(),st.enabled===!0&&st.isPresenting===!0&&(st.cameraAutoUpdate===!0&&st.updateCamera(Ke),Ke=st.getCamera()),ye.isScene===!0&&ye.onBeforeRender(A,ye,Ke,U),E=ae.get(ye,R.length),E.init(Ke),R.push(E),Ie.multiplyMatrices(Ke.projectionMatrix,Ke.matrixWorldInverse),le.setFromProjectionMatrix(Ie),Ee=this.localClippingEnabled,xe=j.init(this.clippingPlanes,Ee),y=jt.get(ye,w.length),y.init(),w.push(y),st.enabled===!0&&st.isPresenting===!0){const zt=A.xr.getDepthSensingMesh();zt!==null&&tn(zt,Ke,-1/0,A.sortObjects)}tn(ye,Ke,0,A.sortObjects),y.finish(),A.sortObjects===!0&&y.sort(Q,se),ge=st.enabled===!1||st.isPresenting===!1||st.hasDepthSensing()===!1,ge&&pe.addToRenderList(y,ye),this.info.render.frame++,xe===!0&&j.beginShadows();const pt=E.state.shadowsArray;V.render(pt,ye,Ke),xe===!0&&j.endShadows(),this.info.autoReset===!0&&this.info.reset();const vt=y.opaque,Xe=y.transmissive;if(E.setupLights(),Ke.isArrayCamera){const zt=Ke.cameras;if(Xe.length>0)for(let Qt=0,hn=zt.length;Qt<hn;Qt++){const mn=zt[Qt];Rn(vt,Xe,ye,mn)}ge&&pe.render(ye);for(let Qt=0,hn=zt.length;Qt<hn;Qt++){const mn=zt[Qt];Cn(y,ye,mn,mn.viewport)}}else Xe.length>0&&Rn(vt,Xe,ye,Ke),ge&&pe.render(ye),Cn(y,ye,Ke);U!==null&&(Ce.updateMultisampleRenderTarget(U),Ce.updateRenderTargetMipmap(U)),ye.isScene===!0&&ye.onAfterRender(A,ye,Ke),Dn.resetDefaultState(),F=-1,$=null,R.pop(),R.length>0?(E=R[R.length-1],xe===!0&&j.setGlobalState(A.clippingPlanes,E.state.camera)):E=null,w.pop(),w.length>0?y=w[w.length-1]:y=null};function tn(ye,Ke,pt,vt){if(ye.visible===!1)return;if(ye.layers.test(Ke.layers)){if(ye.isGroup)pt=ye.renderOrder;else if(ye.isLOD)ye.autoUpdate===!0&&ye.update(Ke);else if(ye.isLight)E.pushLight(ye),ye.castShadow&&E.pushShadow(ye);else if(ye.isSprite){if(!ye.frustumCulled||le.intersectsSprite(ye)){vt&&_t.setFromMatrixPosition(ye.matrixWorld).applyMatrix4(Ie);const Qt=ze.update(ye),hn=ye.material;hn.visible&&y.push(ye,Qt,hn,pt,_t.z,null)}}else if((ye.isMesh||ye.isLine||ye.isPoints)&&(!ye.frustumCulled||le.intersectsObject(ye))){const Qt=ze.update(ye),hn=ye.material;if(vt&&(ye.boundingSphere!==void 0?(ye.boundingSphere===null&&ye.computeBoundingSphere(),_t.copy(ye.boundingSphere.center)):(Qt.boundingSphere===null&&Qt.computeBoundingSphere(),_t.copy(Qt.boundingSphere.center)),_t.applyMatrix4(ye.matrixWorld).applyMatrix4(Ie)),Array.isArray(hn)){const mn=Qt.groups;for(let Un=0,Xn=mn.length;Un<Xn;Un++){const _n=mn[Un],yr=hn[_n.materialIndex];yr&&yr.visible&&y.push(ye,Qt,yr,pt,_t.z,_n)}}else hn.visible&&y.push(ye,Qt,hn,pt,_t.z,null)}}const zt=ye.children;for(let Qt=0,hn=zt.length;Qt<hn;Qt++)tn(zt[Qt],Ke,pt,vt)}function Cn(ye,Ke,pt,vt){const Xe=ye.opaque,zt=ye.transmissive,Qt=ye.transparent;E.setupLightsView(pt),xe===!0&&j.setGlobalState(A.clippingPlanes,pt),vt&&Bt.viewport(q.copy(vt)),Xe.length>0&&_r(Xe,Ke,pt),zt.length>0&&_r(zt,Ke,pt),Qt.length>0&&_r(Qt,Ke,pt),Bt.buffers.depth.setTest(!0),Bt.buffers.depth.setMask(!0),Bt.buffers.color.setMask(!0),Bt.setPolygonOffset(!1)}function Rn(ye,Ke,pt,vt){if((pt.isScene===!0?pt.overrideMaterial:null)!==null)return;E.state.transmissionRenderTarget[vt.id]===void 0&&(E.state.transmissionRenderTarget[vt.id]=new Zu(1,1,{generateMipmaps:!0,type:Ge.has("EXT_color_buffer_half_float")||Ge.has("EXT_color_buffer_float")?oS:Yc,minFilter:I0,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ki.workingColorSpace}));const zt=E.state.transmissionRenderTarget[vt.id],Qt=vt.viewport||q;zt.setSize(Qt.z,Qt.w);const hn=A.getRenderTarget();A.setRenderTarget(zt),A.getClearColor(X),ne=A.getClearAlpha(),ne<1&&A.setClearColor(16777215,.5),A.clear(),ge&&pe.render(pt);const mn=A.toneMapping;A.toneMapping=up;const Un=vt.viewport;if(vt.viewport!==void 0&&(vt.viewport=void 0),E.setupLightsView(vt),xe===!0&&j.setGlobalState(A.clippingPlanes,vt),_r(ye,pt,vt),Ce.updateMultisampleRenderTarget(zt),Ce.updateRenderTargetMipmap(zt),Ge.has("WEBGL_multisampled_render_to_texture")===!1){let Xn=!1;for(let _n=0,yr=Ke.length;_n<yr;_n++){const Vr=Ke[_n],En=Vr.object,jn=Vr.geometry,br=Vr.material,on=Vr.group;if(br.side===Gu&&En.layers.test(vt.layers)){const qi=br.side;br.side=sc,br.needsUpdate=!0,di(En,pt,vt,jn,br,on),br.side=qi,br.needsUpdate=!0,Xn=!0}}Xn===!0&&(Ce.updateMultisampleRenderTarget(zt),Ce.updateRenderTargetMipmap(zt))}A.setRenderTarget(hn),A.setClearColor(X,ne),Un!==void 0&&(vt.viewport=Un),A.toneMapping=mn}function _r(ye,Ke,pt){const vt=Ke.isScene===!0?Ke.overrideMaterial:null;for(let Xe=0,zt=ye.length;Xe<zt;Xe++){const Qt=ye[Xe],hn=Qt.object,mn=Qt.geometry,Un=vt===null?Qt.material:vt,Xn=Qt.group;hn.layers.test(pt.layers)&&di(hn,Ke,pt,mn,Un,Xn)}}function di(ye,Ke,pt,vt,Xe,zt){ye.onBeforeRender(A,Ke,pt,vt,Xe,zt),ye.modelViewMatrix.multiplyMatrices(pt.matrixWorldInverse,ye.matrixWorld),ye.normalMatrix.getNormalMatrix(ye.modelViewMatrix),Xe.onBeforeRender(A,Ke,pt,vt,ye,zt),Xe.transparent===!0&&Xe.side===Gu&&Xe.forceSinglePass===!1?(Xe.side=sc,Xe.needsUpdate=!0,A.renderBufferDirect(pt,Ke,vt,Xe,ye,zt),Xe.side=ag,Xe.needsUpdate=!0,A.renderBufferDirect(pt,Ke,vt,Xe,ye,zt),Xe.side=Gu):A.renderBufferDirect(pt,Ke,vt,Xe,ye,zt),ye.onAfterRender(A,Ke,pt,vt,Xe,zt)}function ii(ye,Ke,pt){Ke.isScene!==!0&&(Ke=fe);const vt=$t.get(ye),Xe=E.state.lights,zt=E.state.shadowsArray,Qt=Xe.state.version,hn=Vt.getParameters(ye,Xe.state,zt,Ke,pt),mn=Vt.getProgramCacheKey(hn);let Un=vt.programs;vt.environment=ye.isMeshStandardMaterial?Ke.environment:null,vt.fog=Ke.fog,vt.envMap=(ye.isMeshStandardMaterial?tt:ue).get(ye.envMap||vt.environment),vt.envMapRotation=vt.environment!==null&&ye.envMap===null?Ke.environmentRotation:ye.envMapRotation,Un===void 0&&(ye.addEventListener("dispose",Le),Un=new Map,vt.programs=Un);let Xn=Un.get(mn);if(Xn!==void 0){if(vt.currentProgram===Xn&&vt.lightsStateVersion===Qt)return yu(ye,hn),Xn}else hn.uniforms=Vt.getUniforms(ye),ye.onBeforeCompile(hn,A),Xn=Vt.acquireProgram(hn,mn),Un.set(mn,Xn),vt.uniforms=hn.uniforms;const _n=vt.uniforms;return(!ye.isShaderMaterial&&!ye.isRawShaderMaterial||ye.clipping===!0)&&(_n.clippingPlanes=j.uniform),yu(ye,hn),vt.needsLights=cf(ye),vt.lightsStateVersion=Qt,vt.needsLights&&(_n.ambientLightColor.value=Xe.state.ambient,_n.lightProbe.value=Xe.state.probe,_n.directionalLights.value=Xe.state.directional,_n.directionalLightShadows.value=Xe.state.directionalShadow,_n.spotLights.value=Xe.state.spot,_n.spotLightShadows.value=Xe.state.spotShadow,_n.rectAreaLights.value=Xe.state.rectArea,_n.ltc_1.value=Xe.state.rectAreaLTC1,_n.ltc_2.value=Xe.state.rectAreaLTC2,_n.pointLights.value=Xe.state.point,_n.pointLightShadows.value=Xe.state.pointShadow,_n.hemisphereLights.value=Xe.state.hemi,_n.directionalShadowMap.value=Xe.state.directionalShadowMap,_n.directionalShadowMatrix.value=Xe.state.directionalShadowMatrix,_n.spotShadowMap.value=Xe.state.spotShadowMap,_n.spotLightMatrix.value=Xe.state.spotLightMatrix,_n.spotLightMap.value=Xe.state.spotLightMap,_n.pointShadowMap.value=Xe.state.pointShadowMap,_n.pointShadowMatrix.value=Xe.state.pointShadowMatrix),vt.currentProgram=Xn,vt.uniformsList=null,Xn}function xo(ye){if(ye.uniformsList===null){const Ke=ye.currentProgram.getUniforms();ye.uniformsList=EC.seqWithValue(Ke.seq,ye.uniforms)}return ye.uniformsList}function yu(ye,Ke){const pt=$t.get(ye);pt.outputColorSpace=Ke.outputColorSpace,pt.batching=Ke.batching,pt.batchingColor=Ke.batchingColor,pt.instancing=Ke.instancing,pt.instancingColor=Ke.instancingColor,pt.instancingMorph=Ke.instancingMorph,pt.skinning=Ke.skinning,pt.morphTargets=Ke.morphTargets,pt.morphNormals=Ke.morphNormals,pt.morphColors=Ke.morphColors,pt.morphTargetsCount=Ke.morphTargetsCount,pt.numClippingPlanes=Ke.numClippingPlanes,pt.numIntersection=Ke.numClipIntersection,pt.vertexAlphas=Ke.vertexAlphas,pt.vertexTangents=Ke.vertexTangents,pt.toneMapping=Ke.toneMapping}function Kd(ye,Ke,pt,vt,Xe){Ke.isScene!==!0&&(Ke=fe),Ce.resetTextureUnits();const zt=Ke.fog,Qt=vt.isMeshStandardMaterial?Ke.environment:null,hn=U===null?A.outputColorSpace:U.isXRRenderTarget===!0?U.texture.colorSpace:x_,mn=(vt.isMeshStandardMaterial?tt:ue).get(vt.envMap||Qt),Un=vt.vertexColors===!0&&!!pt.attributes.color&&pt.attributes.color.itemSize===4,Xn=!!pt.attributes.tangent&&(!!vt.normalMap||vt.anisotropy>0),_n=!!pt.morphAttributes.position,yr=!!pt.morphAttributes.normal,Vr=!!pt.morphAttributes.color;let En=up;vt.toneMapped&&(U===null||U.isXRRenderTarget===!0)&&(En=A.toneMapping);const jn=pt.morphAttributes.position||pt.morphAttributes.normal||pt.morphAttributes.color,br=jn!==void 0?jn.length:0,on=$t.get(vt),qi=E.state.lights;if(xe===!0&&(Ee===!0||ye!==$)){const Ki=ye===$&&vt.id===F;j.setState(vt,ye,Ki)}let Er=!1;vt.version===on.__version?(on.needsLights&&on.lightsStateVersion!==qi.state.version||on.outputColorSpace!==hn||Xe.isBatchedMesh&&on.batching===!1||!Xe.isBatchedMesh&&on.batching===!0||Xe.isBatchedMesh&&on.batchingColor===!0&&Xe.colorTexture===null||Xe.isBatchedMesh&&on.batchingColor===!1&&Xe.colorTexture!==null||Xe.isInstancedMesh&&on.instancing===!1||!Xe.isInstancedMesh&&on.instancing===!0||Xe.isSkinnedMesh&&on.skinning===!1||!Xe.isSkinnedMesh&&on.skinning===!0||Xe.isInstancedMesh&&on.instancingColor===!0&&Xe.instanceColor===null||Xe.isInstancedMesh&&on.instancingColor===!1&&Xe.instanceColor!==null||Xe.isInstancedMesh&&on.instancingMorph===!0&&Xe.morphTexture===null||Xe.isInstancedMesh&&on.instancingMorph===!1&&Xe.morphTexture!==null||on.envMap!==mn||vt.fog===!0&&on.fog!==zt||on.numClippingPlanes!==void 0&&(on.numClippingPlanes!==j.numPlanes||on.numIntersection!==j.numIntersection)||on.vertexAlphas!==Un||on.vertexTangents!==Xn||on.morphTargets!==_n||on.morphNormals!==yr||on.morphColors!==Vr||on.toneMapping!==En||on.morphTargetsCount!==br)&&(Er=!0):(Er=!0,on.__version=vt.version);let Bs=on.currentProgram;Er===!0&&(Bs=ii(vt,Ke,Xe));let Jn=!1,lr=!1,Ul=!1;const Ti=Bs.getUniforms(),Co=on.uniforms;if(Bt.useProgram(Bs.program)&&(Jn=!0,lr=!0,Ul=!0),vt.id!==F&&(F=vt.id,lr=!0),Jn||$!==ye){Bt.buffers.depth.getReversed()?(Se.copy(ye.projectionMatrix),Rie(Se),Aie(Se),Ti.setValue(Re,"projectionMatrix",Se)):Ti.setValue(Re,"projectionMatrix",ye.projectionMatrix),Ti.setValue(Re,"viewMatrix",ye.matrixWorldInverse);const vn=Ti.map.cameraPosition;vn!==void 0&&vn.setValue(Re,Ze.setFromMatrixPosition(ye.matrixWorld)),kt.logarithmicDepthBuffer&&Ti.setValue(Re,"logDepthBufFC",2/(Math.log(ye.far+1)/Math.LN2)),(vt.isMeshPhongMaterial||vt.isMeshToonMaterial||vt.isMeshLambertMaterial||vt.isMeshBasicMaterial||vt.isMeshStandardMaterial||vt.isShaderMaterial)&&Ti.setValue(Re,"isOrthographic",ye.isOrthographicCamera===!0),$!==ye&&($=ye,lr=!0,Ul=!0)}if(Xe.isSkinnedMesh){Ti.setOptional(Re,Xe,"bindMatrix"),Ti.setOptional(Re,Xe,"bindMatrixInverse");const Ki=Xe.skeleton;Ki&&(Ki.boneTexture===null&&Ki.computeBoneTexture(),Ti.setValue(Re,"boneTexture",Ki.boneTexture,Ce))}Xe.isBatchedMesh&&(Ti.setOptional(Re,Xe,"batchingTexture"),Ti.setValue(Re,"batchingTexture",Xe._matricesTexture,Ce),Ti.setOptional(Re,Xe,"batchingIdTexture"),Ti.setValue(Re,"batchingIdTexture",Xe._indirectTexture,Ce),Ti.setOptional(Re,Xe,"batchingColorTexture"),Xe._colorsTexture!==null&&Ti.setValue(Re,"batchingColorTexture",Xe._colorsTexture,Ce));const Fl=pt.morphAttributes;if((Fl.position!==void 0||Fl.normal!==void 0||Fl.color!==void 0)&&Ne.update(Xe,pt,Bs),(lr||on.receiveShadow!==Xe.receiveShadow)&&(on.receiveShadow=Xe.receiveShadow,Ti.setValue(Re,"receiveShadow",Xe.receiveShadow)),vt.isMeshGouraudMaterial&&vt.envMap!==null&&(Co.envMap.value=mn,Co.flipEnvMap.value=mn.isCubeTexture&&mn.isRenderTargetTexture===!1?-1:1),vt.isMeshStandardMaterial&&vt.envMap===null&&Ke.environment!==null&&(Co.envMapIntensity.value=Ke.environmentIntensity),lr&&(Ti.setValue(Re,"toneMappingExposure",A.toneMappingExposure),on.needsLights&&af(Co,Ul),zt&&vt.fog===!0&&xt.refreshFogUniforms(Co,zt),xt.refreshMaterialUniforms(Co,vt,G,ie,E.state.transmissionRenderTarget[ye.id]),EC.upload(Re,xo(on),Co,Ce)),vt.isShaderMaterial&&vt.uniformsNeedUpdate===!0&&(EC.upload(Re,xo(on),Co,Ce),vt.uniformsNeedUpdate=!1),vt.isSpriteMaterial&&Ti.setValue(Re,"center",Xe.center),Ti.setValue(Re,"modelViewMatrix",Xe.modelViewMatrix),Ti.setValue(Re,"normalMatrix",Xe.normalMatrix),Ti.setValue(Re,"modelMatrix",Xe.matrixWorld),vt.isShaderMaterial||vt.isRawShaderMaterial){const Ki=vt.uniformsGroups;for(let vn=0,uc=Ki.length;vn<uc;vn++){const Bl=Ki[vn];Ue.update(Bl,Bs),Ue.bind(Bl,Bs)}}return Bs}function af(ye,Ke){ye.ambientLightColor.needsUpdate=Ke,ye.lightProbe.needsUpdate=Ke,ye.directionalLights.needsUpdate=Ke,ye.directionalLightShadows.needsUpdate=Ke,ye.pointLights.needsUpdate=Ke,ye.pointLightShadows.needsUpdate=Ke,ye.spotLights.needsUpdate=Ke,ye.spotLightShadows.needsUpdate=Ke,ye.rectAreaLights.needsUpdate=Ke,ye.hemisphereLights.needsUpdate=Ke}function cf(ye){return ye.isMeshLambertMaterial||ye.isMeshToonMaterial||ye.isMeshPhongMaterial||ye.isMeshStandardMaterial||ye.isShadowMaterial||ye.isShaderMaterial&&ye.lights===!0}this.getActiveCubeFace=function(){return I},this.getActiveMipmapLevel=function(){return N},this.getRenderTarget=function(){return U},this.setRenderTargetTextures=function(ye,Ke,pt){$t.get(ye.texture).__webglTexture=Ke,$t.get(ye.depthTexture).__webglTexture=pt;const vt=$t.get(ye);vt.__hasExternalTextures=!0,vt.__autoAllocateDepthBuffer=pt===void 0,vt.__autoAllocateDepthBuffer||Ge.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),vt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(ye,Ke){const pt=$t.get(ye);pt.__webglFramebuffer=Ke,pt.__useDefaultFramebuffer=Ke===void 0},this.setRenderTarget=function(ye,Ke=0,pt=0){U=ye,I=Ke,N=pt;let vt=!0,Xe=null,zt=!1,Qt=!1;if(ye){const mn=$t.get(ye);if(mn.__useDefaultFramebuffer!==void 0)Bt.bindFramebuffer(Re.FRAMEBUFFER,null),vt=!1;else if(mn.__webglFramebuffer===void 0)Ce.setupRenderTarget(ye);else if(mn.__hasExternalTextures)Ce.rebindTextures(ye,$t.get(ye.texture).__webglTexture,$t.get(ye.depthTexture).__webglTexture);else if(ye.depthBuffer){const _n=ye.depthTexture;if(mn.__boundDepthTexture!==_n){if(_n!==null&&$t.has(_n)&&(ye.width!==_n.image.width||ye.height!==_n.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ce.setupDepthRenderbuffer(ye)}}const Un=ye.texture;(Un.isData3DTexture||Un.isDataArrayTexture||Un.isCompressedArrayTexture)&&(Qt=!0);const Xn=$t.get(ye).__webglFramebuffer;ye.isWebGLCubeRenderTarget?(Array.isArray(Xn[Ke])?Xe=Xn[Ke][pt]:Xe=Xn[Ke],zt=!0):ye.samples>0&&Ce.useMultisampledRTT(ye)===!1?Xe=$t.get(ye).__webglMultisampledFramebuffer:Array.isArray(Xn)?Xe=Xn[pt]:Xe=Xn,q.copy(ye.viewport),K.copy(ye.scissor),W=ye.scissorTest}else q.copy(ve).multiplyScalar(G).floor(),K.copy(Oe).multiplyScalar(G).floor(),W=_e;if(Bt.bindFramebuffer(Re.FRAMEBUFFER,Xe)&&vt&&Bt.drawBuffers(ye,Xe),Bt.viewport(q),Bt.scissor(K),Bt.setScissorTest(W),zt){const mn=$t.get(ye.texture);Re.framebufferTexture2D(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,Re.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,mn.__webglTexture,pt)}else if(Qt){const mn=$t.get(ye.texture),Un=Ke||0;Re.framebufferTextureLayer(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,mn.__webglTexture,pt||0,Un)}F=-1},this.readRenderTargetPixels=function(ye,Ke,pt,vt,Xe,zt,Qt){if(!(ye&&ye.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let hn=$t.get(ye).__webglFramebuffer;if(ye.isWebGLCubeRenderTarget&&Qt!==void 0&&(hn=hn[Qt]),hn){Bt.bindFramebuffer(Re.FRAMEBUFFER,hn);try{const mn=ye.texture,Un=mn.format,Xn=mn.type;if(!kt.textureFormatReadable(Un)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!kt.textureTypeReadable(Xn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ke>=0&&Ke<=ye.width-vt&&pt>=0&&pt<=ye.height-Xe&&Re.readPixels(Ke,pt,vt,Xe,bt.convert(Un),bt.convert(Xn),zt)}finally{const mn=U!==null?$t.get(U).__webglFramebuffer:null;Bt.bindFramebuffer(Re.FRAMEBUFFER,mn)}}},this.readRenderTargetPixelsAsync=async function(ye,Ke,pt,vt,Xe,zt,Qt){if(!(ye&&ye.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let hn=$t.get(ye).__webglFramebuffer;if(ye.isWebGLCubeRenderTarget&&Qt!==void 0&&(hn=hn[Qt]),hn){const mn=ye.texture,Un=mn.format,Xn=mn.type;if(!kt.textureFormatReadable(Un))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!kt.textureTypeReadable(Xn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ke>=0&&Ke<=ye.width-vt&&pt>=0&&pt<=ye.height-Xe){Bt.bindFramebuffer(Re.FRAMEBUFFER,hn);const _n=Re.createBuffer();Re.bindBuffer(Re.PIXEL_PACK_BUFFER,_n),Re.bufferData(Re.PIXEL_PACK_BUFFER,zt.byteLength,Re.STREAM_READ),Re.readPixels(Ke,pt,vt,Xe,bt.convert(Un),bt.convert(Xn),0);const yr=U!==null?$t.get(U).__webglFramebuffer:null;Bt.bindFramebuffer(Re.FRAMEBUFFER,yr);const Vr=Re.fenceSync(Re.SYNC_GPU_COMMANDS_COMPLETE,0);return Re.flush(),await Cie(Re,Vr,4),Re.bindBuffer(Re.PIXEL_PACK_BUFFER,_n),Re.getBufferSubData(Re.PIXEL_PACK_BUFFER,0,zt),Re.deleteBuffer(_n),Re.deleteSync(Vr),zt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ye,Ke=null,pt=0){ye.isTexture!==!0&&(QS("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ke=arguments[0]||null,ye=arguments[1]);const vt=Math.pow(2,-pt),Xe=Math.floor(ye.image.width*vt),zt=Math.floor(ye.image.height*vt),Qt=Ke!==null?Ke.x:0,hn=Ke!==null?Ke.y:0;Ce.setTexture2D(ye,0),Re.copyTexSubImage2D(Re.TEXTURE_2D,pt,0,0,Qt,hn,Xe,zt),Bt.unbindTexture()},this.copyTextureToTexture=function(ye,Ke,pt=null,vt=null,Xe=0){ye.isTexture!==!0&&(QS("WebGLRenderer: copyTextureToTexture function signature has changed."),vt=arguments[0]||null,ye=arguments[1],Ke=arguments[2],Xe=arguments[3]||0,pt=null);let zt,Qt,hn,mn,Un,Xn,_n,yr,Vr;const En=ye.isCompressedTexture?ye.mipmaps[Xe]:ye.image;pt!==null?(zt=pt.max.x-pt.min.x,Qt=pt.max.y-pt.min.y,hn=pt.isBox3?pt.max.z-pt.min.z:1,mn=pt.min.x,Un=pt.min.y,Xn=pt.isBox3?pt.min.z:0):(zt=En.width,Qt=En.height,hn=En.depth||1,mn=0,Un=0,Xn=0),vt!==null?(_n=vt.x,yr=vt.y,Vr=vt.z):(_n=0,yr=0,Vr=0);const jn=bt.convert(Ke.format),br=bt.convert(Ke.type);let on;Ke.isData3DTexture?(Ce.setTexture3D(Ke,0),on=Re.TEXTURE_3D):Ke.isDataArrayTexture||Ke.isCompressedArrayTexture?(Ce.setTexture2DArray(Ke,0),on=Re.TEXTURE_2D_ARRAY):(Ce.setTexture2D(Ke,0),on=Re.TEXTURE_2D),Re.pixelStorei(Re.UNPACK_FLIP_Y_WEBGL,Ke.flipY),Re.pixelStorei(Re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ke.premultiplyAlpha),Re.pixelStorei(Re.UNPACK_ALIGNMENT,Ke.unpackAlignment);const qi=Re.getParameter(Re.UNPACK_ROW_LENGTH),Er=Re.getParameter(Re.UNPACK_IMAGE_HEIGHT),Bs=Re.getParameter(Re.UNPACK_SKIP_PIXELS),Jn=Re.getParameter(Re.UNPACK_SKIP_ROWS),lr=Re.getParameter(Re.UNPACK_SKIP_IMAGES);Re.pixelStorei(Re.UNPACK_ROW_LENGTH,En.width),Re.pixelStorei(Re.UNPACK_IMAGE_HEIGHT,En.height),Re.pixelStorei(Re.UNPACK_SKIP_PIXELS,mn),Re.pixelStorei(Re.UNPACK_SKIP_ROWS,Un),Re.pixelStorei(Re.UNPACK_SKIP_IMAGES,Xn);const Ul=ye.isDataArrayTexture||ye.isData3DTexture,Ti=Ke.isDataArrayTexture||Ke.isData3DTexture;if(ye.isRenderTargetTexture||ye.isDepthTexture){const Co=$t.get(ye),Fl=$t.get(Ke),Ki=$t.get(Co.__renderTarget),vn=$t.get(Fl.__renderTarget);Bt.bindFramebuffer(Re.READ_FRAMEBUFFER,Ki.__webglFramebuffer),Bt.bindFramebuffer(Re.DRAW_FRAMEBUFFER,vn.__webglFramebuffer);for(let uc=0;uc<hn;uc++)Ul&&Re.framebufferTextureLayer(Re.READ_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,$t.get(ye).__webglTexture,Xe,Xn+uc),ye.isDepthTexture?(Ti&&Re.framebufferTextureLayer(Re.DRAW_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,$t.get(Ke).__webglTexture,Xe,Vr+uc),Re.blitFramebuffer(mn,Un,zt,Qt,_n,yr,zt,Qt,Re.DEPTH_BUFFER_BIT,Re.NEAREST)):Ti?Re.copyTexSubImage3D(on,Xe,_n,yr,Vr+uc,mn,Un,zt,Qt):Re.copyTexSubImage2D(on,Xe,_n,yr,Vr+uc,mn,Un,zt,Qt);Bt.bindFramebuffer(Re.READ_FRAMEBUFFER,null),Bt.bindFramebuffer(Re.DRAW_FRAMEBUFFER,null)}else Ti?ye.isDataTexture||ye.isData3DTexture?Re.texSubImage3D(on,Xe,_n,yr,Vr,zt,Qt,hn,jn,br,En.data):Ke.isCompressedArrayTexture?Re.compressedTexSubImage3D(on,Xe,_n,yr,Vr,zt,Qt,hn,jn,En.data):Re.texSubImage3D(on,Xe,_n,yr,Vr,zt,Qt,hn,jn,br,En):ye.isDataTexture?Re.texSubImage2D(Re.TEXTURE_2D,Xe,_n,yr,zt,Qt,jn,br,En.data):ye.isCompressedTexture?Re.compressedTexSubImage2D(Re.TEXTURE_2D,Xe,_n,yr,En.width,En.height,jn,En.data):Re.texSubImage2D(Re.TEXTURE_2D,Xe,_n,yr,zt,Qt,jn,br,En);Re.pixelStorei(Re.UNPACK_ROW_LENGTH,qi),Re.pixelStorei(Re.UNPACK_IMAGE_HEIGHT,Er),Re.pixelStorei(Re.UNPACK_SKIP_PIXELS,Bs),Re.pixelStorei(Re.UNPACK_SKIP_ROWS,Jn),Re.pixelStorei(Re.UNPACK_SKIP_IMAGES,lr),Xe===0&&Ke.generateMipmaps&&Re.generateMipmap(on),Bt.unbindTexture()},this.copyTextureToTexture3D=function(ye,Ke,pt=null,vt=null,Xe=0){return ye.isTexture!==!0&&(QS("WebGLRenderer: copyTextureToTexture3D function signature has changed."),pt=arguments[0]||null,vt=arguments[1]||null,ye=arguments[2],Ke=arguments[3],Xe=arguments[4]||0),QS('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(ye,Ke,pt,vt,Xe)},this.initRenderTarget=function(ye){$t.get(ye).__webglFramebuffer===void 0&&Ce.setupRenderTarget(ye)},this.initTexture=function(ye){ye.isCubeTexture?Ce.setTextureCube(ye,0):ye.isData3DTexture?Ce.setTexture3D(ye,0):ye.isDataArrayTexture||ye.isCompressedArrayTexture?Ce.setTexture2DArray(ye,0):Ce.setTexture2D(ye,0),Bt.unbindTexture()},this.resetState=function(){I=0,N=0,U=null,Bt.reset(),Dn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ym}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorspace=ki._getDrawingBufferColorSpace(e),n.unpackColorSpace=ki._getUnpackColorSpace()}}class bR extends cu{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new cg,this.environmentIntensity=1,this.environmentRotation=new cg,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class pW extends So{constructor(e=null,n=1,r=1,i,s,o,a,c,l=jo,u=jo,d,h){super(null,o,a,c,l,u,i,s,d,h),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Fle extends _g{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new Ei(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const G$=new To,s2=new XF,v1=new ZA,_1=new ht;class Ble extends cu{constructor(e=new Yh,n=new Fle){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),v1.copy(r.boundingSphere),v1.applyMatrix4(i),v1.radius+=s,e.ray.intersectsSphere(v1)===!1)return;G$.copy(i).invert(),s2.copy(e.ray).applyMatrix4(G$);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,d=r.attributes.position;if(l!==null){const h=Math.max(0,o.start),p=Math.min(l.count,o.start+o.count);for(let f=h,g=p;f<g;f++){const y=l.getX(f);_1.fromBufferAttribute(d,y),W$(_1,y,c,i,e,n,this)}}else{const h=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let f=h,g=p;f<g;f++)_1.fromBufferAttribute(d,f),W$(_1,f,c,i,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function W$(t,e,n,r,i,s,o){const a=s2.distanceSqToPoint(t);if(a<n){const c=new ht;s2.closestPointToPoint(t,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class jle extends So{constructor(e,n,r,i,s,o,a,c,l){super(e,n,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class $le extends _g{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=QG,this.normalScale=new Vn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}const q$={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Hle{constructor(e,n,r){const i=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(u){a++,s===!1&&i.onStart!==void 0&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,d){return l.push(u,d),this},this.removeHandler=function(u){const d=l.indexOf(u);return d!==-1&&l.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=l.length;d<h;d+=2){const p=l[d],f=l[d+1];if(p.global&&(p.lastIndex=0),p.test(u))return f}return null}}}const Vle=new Hle;class tB{constructor(e){this.manager=e!==void 0?e:Vle,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(i,s){r.load(e,i,n,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}tB.DEFAULT_MATERIAL_NAME="__DEFAULT";class zle extends tB{constructor(e){super(e)}load(e,n,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=q$.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o;const a=MT("img");function c(){u(),q$.add(e,this),n&&n(this),s.manager.itemEnd(e)}function l(d){u(),i&&i(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class nB extends tB{constructor(e){super(e)}load(e,n,r,i){const s=new So,o=new zle(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,n!==void 0&&n(s)},r,i),s}}let Gle=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=K$(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=K$();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}};function K$(){return performance.now()}class Wi{constructor(e){this.value=e}clone(){return new Wi(this.value.clone===void 0?this.value:this.value.clone())}}const Y$=new To;class Wle{constructor(e,n,r=0,i=1/0){this.ray=new XF(e,n),this.near=r,this.far=i,this.camera=null,this.layers=new rE,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return Y$.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Y$),this}intersectObject(e,n=!0,r=[]){return o2(e,this,r,n),r.sort(X$),r}intersectObjects(e,n=!0,r=[]){for(let i=0,s=e.length;i<s;i++)o2(e[i],this,r,n);return r.sort(X$),r}}function X$(t,e){return t.distance-e.distance}function o2(t,e,n,r){let i=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(i=!1),i===!0&&r===!0){const s=t.children;for(let o=0,a=s.length;o<a;o++)o2(s[o],e,n,!0)}}const J$=new Vn;class qle{constructor(e=new Vn(1/0,1/0),n=new Vn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=J$.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,J$).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:YA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=YA);var mW={exports:{}},my={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */my.ConcurrentRoot=1;my.ContinuousEventPriority=4;my.DefaultEventPriority=16;my.DiscreteEventPriority=1;my.IdleEventPriority=536870912;my.LegacyRoot=0;mW.exports=my;var $b=mW.exports;function Kle(t){let e;const n=new Set,r=(l,u)=>{const d=typeof l=="function"?l(e):l;if(d!==e){const h=e;e=u?d:Object.assign({},e,d),n.forEach(p=>p(e,h))}},i=()=>e,s=(l,u=i,d=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let h=u(e);function p(){const f=u(e);if(!d(h,f)){const g=h;l(h=f,g)}}return n.add(p),()=>n.delete(p)},c={setState:r,getState:i,subscribe:(l,u,d)=>u||d?s(l,u,d):(n.add(l),()=>n.delete(l)),destroy:()=>n.clear()};return e=t(r,i,c),c}const Yle=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Q$=Yle?ft.useEffect:ft.useLayoutEffect;function Xle(t){const e=typeof t=="function"?Kle(t):t,n=(r=e.getState,i=Object.is)=>{const[,s]=ft.useReducer(y=>y+1,0),o=e.getState(),a=ft.useRef(o),c=ft.useRef(r),l=ft.useRef(i),u=ft.useRef(!1),d=ft.useRef();d.current===void 0&&(d.current=r(o));let h,p=!1;(a.current!==o||c.current!==r||l.current!==i||u.current)&&(h=r(o),p=!i(d.current,h)),Q$(()=>{p&&(d.current=h),a.current=o,c.current=r,l.current=i,u.current=!1});const f=ft.useRef(o);Q$(()=>{const y=()=>{try{const w=e.getState(),R=c.current(w);l.current(d.current,R)||(a.current=w,d.current=R,s())}catch{u.current=!0,s()}},E=e.subscribe(y);return e.getState()!==f.current&&y(),E},[]);const g=p?h:d.current;return ft.useDebugValue(g),g};return Object.assign(n,e),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[n,e];return{next(){const i=r.length<=0;return{value:r.shift(),done:i}}}},n}const Jle=t=>typeof t=="object"&&typeof t.then=="function",O0=[];function gW(t,e,n=(r,i)=>r===i){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}function vW(t,e=null,n=!1,r={}){e===null&&(e=[t]);for(const s of O0)if(gW(e,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=O0.indexOf(i);s!==-1&&O0.splice(s,1)},promise:(Jle(t)?t:t(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(O0.push(i),!n)throw i.promise}const Qle=(t,e,n)=>vW(t,e,!1,n),Zle=(t,e,n)=>void vW(t,e,!0,n),eue=t=>{if(t===void 0||t.length===0)O0.splice(0,O0.length);else{const e=O0.find(n=>gW(t,n.keys,n.equal));e&&e.remove()}};var _W={exports:{}},yW={exports:{}},bW={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(G,Q){var se=G.length;G.push(Q);e:for(;0<se;){var ve=se-1>>>1,Oe=G[ve];if(0<i(Oe,Q))G[ve]=Q,G[se]=Oe,se=ve;else break e}}function n(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var Q=G[0],se=G.pop();if(se!==Q){G[0]=se;e:for(var ve=0,Oe=G.length,_e=Oe>>>1;ve<_e;){var le=2*(ve+1)-1,xe=G[le],Ee=le+1,Se=G[Ee];if(0>i(xe,se))Ee<Oe&&0>i(Se,xe)?(G[ve]=Se,G[Ee]=se,ve=Ee):(G[ve]=xe,G[le]=se,ve=le);else if(Ee<Oe&&0>i(Se,se))G[ve]=Se,G[Ee]=se,ve=Ee;else break e}}return Q}function i(G,Q){var se=G.sortIndex-Q.sortIndex;return se!==0?se:G.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,p=!1,f=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(G){for(var Q=n(l);Q!==null;){if(Q.callback===null)r(l);else if(Q.startTime<=G)r(l),Q.sortIndex=Q.expirationTime,e(c,Q);else break;Q=n(l)}}function A(G){if(g=!1,R(G),!f)if(n(c)!==null)f=!0,Z(k);else{var Q=n(l);Q!==null&&ie(A,Q.startTime-G)}}function k(G,Q){f=!1,g&&(g=!1,E(U),U=-1),p=!0;var se=h;try{for(R(Q),d=n(c);d!==null&&(!(d.expirationTime>Q)||G&&!q());){var ve=d.callback;if(typeof ve=="function"){d.callback=null,h=d.priorityLevel;var Oe=ve(d.expirationTime<=Q);Q=t.unstable_now(),typeof Oe=="function"?d.callback=Oe:d===n(c)&&r(c),R(Q)}else r(c);d=n(c)}if(d!==null)var _e=!0;else{var le=n(l);le!==null&&ie(A,le.startTime-Q),_e=!1}return _e}finally{d=null,h=se,p=!1}}var I=!1,N=null,U=-1,F=5,$=-1;function q(){return!(t.unstable_now()-$<F)}function K(){if(N!==null){var G=t.unstable_now();$=G;var Q=!0;try{Q=N(!0,G)}finally{Q?W():(I=!1,N=null)}}else I=!1}var W;if(typeof w=="function")W=function(){w(K)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,ne=X.port2;X.port1.onmessage=K,W=function(){ne.postMessage(null)}}else W=function(){y(K,0)};function Z(G){N=G,I||(I=!0,W())}function ie(G,Q){U=y(function(){G(t.unstable_now())},Q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,Z(k))},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(G){switch(h){case 1:case 2:case 3:var Q=3;break;default:Q=h}var se=h;h=Q;try{return G()}finally{h=se}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(G,Q){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var se=h;h=G;try{return Q()}finally{h=se}},t.unstable_scheduleCallback=function(G,Q,se){var ve=t.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?ve+se:ve):se=ve,G){case 1:var Oe=-1;break;case 2:Oe=250;break;case 5:Oe=1073741823;break;case 4:Oe=1e4;break;default:Oe=5e3}return Oe=se+Oe,G={id:u++,callback:Q,priorityLevel:G,startTime:se,expirationTime:Oe,sortIndex:-1},se>ve?(G.sortIndex=se,e(l,G),n(c)===null&&G===n(l)&&(g?(E(U),U=-1):g=!0,ie(A,se-ve))):(G.sortIndex=Oe,e(c,G),f||p||(f=!0,Z(k))),G},t.unstable_shouldYield=q,t.unstable_wrapCallback=function(G){var Q=h;return function(){var se=h;h=Q;try{return G.apply(this,arguments)}finally{h=se}}}})(bW);yW.exports=bW;var a2=yW.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tue=function(e){var n={},r=ft,i=a2,s=Object.assign;function o(m){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+m,M=1;M<arguments.length;M++)_+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+m+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=Symbol.for("react.element"),l=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),A=Symbol.for("react.offscreen"),k=Symbol.iterator;function I(m){return m===null||typeof m!="object"?null:(m=k&&m[k]||m["@@iterator"],typeof m=="function"?m:null)}function N(m){if(m==null)return null;if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case u:return"Fragment";case l:return"Portal";case h:return"Profiler";case d:return"StrictMode";case y:return"Suspense";case E:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case f:return(m.displayName||"Context")+".Consumer";case p:return(m._context.displayName||"Context")+".Provider";case g:var _=m.render;return m=m.displayName,m||(m=_.displayName||_.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case w:return _=m.displayName||null,_!==null?_:N(m.type)||"Memo";case R:_=m._payload,m=m._init;try{return N(m(_))}catch{}}return null}function U(m){var _=m.type;switch(m.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return m=_.render,m=m.displayName||m.name||"",_.displayName||(m!==""?"ForwardRef("+m+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return N(_);case 8:return _===d?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function F(m){var _=m,M=m;if(m.alternate)for(;_.return;)_=_.return;else{m=_;do _=m,_.flags&4098&&(M=_.return),m=_.return;while(m)}return _.tag===3?M:null}function $(m){if(F(m)!==m)throw Error(o(188))}function q(m){var _=m.alternate;if(!_){if(_=F(m),_===null)throw Error(o(188));return _!==m?null:m}for(var M=m,L=_;;){var H=M.return;if(H===null)break;var ee=H.alternate;if(ee===null){if(L=H.return,L!==null){M=L;continue}break}if(H.child===ee.child){for(ee=H.child;ee;){if(ee===M)return $(H),m;if(ee===L)return $(H),_;ee=ee.sibling}throw Error(o(188))}if(M.return!==L.return)M=H,L=ee;else{for(var Ae=!1,je=H.child;je;){if(je===M){Ae=!0,M=H,L=ee;break}if(je===L){Ae=!0,L=H,M=ee;break}je=je.sibling}if(!Ae){for(je=ee.child;je;){if(je===M){Ae=!0,M=ee,L=H;break}if(je===L){Ae=!0,L=ee,M=H;break}je=je.sibling}if(!Ae)throw Error(o(189))}}if(M.alternate!==L)throw Error(o(190))}if(M.tag!==3)throw Error(o(188));return M.stateNode.current===M?m:_}function K(m){return m=q(m),m!==null?W(m):null}function W(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){var _=W(m);if(_!==null)return _;m=m.sibling}return null}function X(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){if(m.tag!==4){var _=X(m);if(_!==null)return _}m=m.sibling}return null}var ne=Array.isArray,Z=e.getPublicInstance,ie=e.getRootHostContext,G=e.getChildHostContext,Q=e.prepareForCommit,se=e.resetAfterCommit,ve=e.createInstance,Oe=e.appendInitialChild,_e=e.finalizeInitialChildren,le=e.prepareUpdate,xe=e.shouldSetTextContent,Ee=e.createTextInstance,Se=e.scheduleTimeout,Ie=e.cancelTimeout,Ze=e.noTimeout,_t=e.isPrimaryRenderer,fe=e.supportsMutation,ge=e.supportsPersistence,rt=e.supportsHydration,Re=e.getInstanceFromNode,St=e.preparePortalMount,Ge=e.getCurrentEventPriority,kt=e.detachDeletedInstance,Bt=e.supportsMicrotasks,He=e.scheduleMicrotask,$t=e.supportsTestSelectors,Ce=e.findFiberRoot,ue=e.getBoundingRect,tt=e.getTextContent,yt=e.isHiddenSubtree,We=e.matchAccessibilityRole,ze=e.setFocusIfFocusable,Vt=e.setupIntersectionObserver,xt=e.appendChild,jt=e.appendChildToContainer,ae=e.commitTextUpdate,j=e.commitMount,V=e.commitUpdate,pe=e.insertBefore,Ne=e.insertInContainerBefore,Fe=e.removeChild,dt=e.removeChildFromContainer,bt=e.resetTextContent,Dn=e.hideInstance,Ue=e.hideTextInstance,Dt=e.unhideInstance,st=e.unhideTextInstance,Ct=e.clearContainer,sn=e.cloneInstance,Jt=e.createContainerChildSet,Le=e.appendChildToContainerChildSet,it=e.finalizeContainerChildren,Tt=e.replaceContainerChildren,wt=e.cloneHiddenInstance,Pn=e.cloneHiddenTextInstance,Yr=e.canHydrateInstance,cr=e.canHydrateTextInstance,zn=e.canHydrateSuspenseInstance,dn=e.isSuspenseInstancePending,tn=e.isSuspenseInstanceFallback,Cn=e.registerSuspenseInstanceRetry,Rn=e.getNextHydratableSibling,_r=e.getFirstHydratableChild,di=e.getFirstHydratableChildWithinContainer,ii=e.getFirstHydratableChildWithinSuspenseInstance,xo=e.hydrateInstance,yu=e.hydrateTextInstance,Kd=e.hydrateSuspenseInstance,af=e.getNextHydratableInstanceAfterSuspenseInstance,cf=e.commitHydratedContainer,ye=e.commitHydratedSuspenseInstance,Ke=e.clearSuspenseBoundary,pt=e.clearSuspenseBoundaryFromContainer,vt=e.shouldDeleteUnhydratedTailInstances,Xe=e.didNotMatchHydratedContainerTextInstance,zt=e.didNotMatchHydratedTextInstance,Qt;function hn(m){if(Qt===void 0)try{throw Error()}catch(M){var _=M.stack.trim().match(/\n( *(at )?)/);Qt=_&&_[1]||""}return`
`+Qt+m}var mn=!1;function Un(m,_){if(!m||mn)return"";mn=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(qt){var L=qt}Reflect.construct(m,[],_)}else{try{_.call()}catch(qt){L=qt}m.call(_.prototype)}else{try{throw Error()}catch(qt){L=qt}m()}}catch(qt){if(qt&&L&&typeof qt.stack=="string"){for(var H=qt.stack.split(`
`),ee=L.stack.split(`
`),Ae=H.length-1,je=ee.length-1;1<=Ae&&0<=je&&H[Ae]!==ee[je];)je--;for(;1<=Ae&&0<=je;Ae--,je--)if(H[Ae]!==ee[je]){if(Ae!==1||je!==1)do if(Ae--,je--,0>je||H[Ae]!==ee[je]){var Et=`
`+H[Ae].replace(" at new "," at ");return m.displayName&&Et.includes("<anonymous>")&&(Et=Et.replace("<anonymous>",m.displayName)),Et}while(1<=Ae&&0<=je);break}}}finally{mn=!1,Error.prepareStackTrace=M}return(m=m?m.displayName||m.name:"")?hn(m):""}var Xn=Object.prototype.hasOwnProperty,_n=[],yr=-1;function Vr(m){return{current:m}}function En(m){0>yr||(m.current=_n[yr],_n[yr]=null,yr--)}function jn(m,_){yr++,_n[yr]=m.current,m.current=_}var br={},on=Vr(br),qi=Vr(!1),Er=br;function Bs(m,_){var M=m.type.contextTypes;if(!M)return br;var L=m.stateNode;if(L&&L.__reactInternalMemoizedUnmaskedChildContext===_)return L.__reactInternalMemoizedMaskedChildContext;var H={},ee;for(ee in M)H[ee]=_[ee];return L&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=_,m.__reactInternalMemoizedMaskedChildContext=H),H}function Jn(m){return m=m.childContextTypes,m!=null}function lr(){En(qi),En(on)}function Ul(m,_,M){if(on.current!==br)throw Error(o(168));jn(on,_),jn(qi,M)}function Ti(m,_,M){var L=m.stateNode;if(_=_.childContextTypes,typeof L.getChildContext!="function")return M;L=L.getChildContext();for(var H in L)if(!(H in _))throw Error(o(108,U(m)||"Unknown",H));return s({},M,L)}function Co(m){return m=(m=m.stateNode)&&m.__reactInternalMemoizedMergedChildContext||br,Er=on.current,jn(on,m),jn(qi,qi.current),!0}function Fl(m,_,M){var L=m.stateNode;if(!L)throw Error(o(169));M?(m=Ti(m,_,Er),L.__reactInternalMemoizedMergedChildContext=m,En(qi),En(on),jn(on,m)):En(qi),jn(qi,M)}var Ki=Math.clz32?Math.clz32:Bl,vn=Math.log,uc=Math.LN2;function Bl(m){return m>>>=0,m===0?32:31-(vn(m)/uc|0)|0}var gr=64,Yd=4194304;function Vo(m){switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return m&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return m}}function Xd(m,_){var M=m.pendingLanes;if(M===0)return 0;var L=0,H=m.suspendedLanes,ee=m.pingedLanes,Ae=M&268435455;if(Ae!==0){var je=Ae&~H;je!==0?L=Vo(je):(ee&=Ae,ee!==0&&(L=Vo(ee)))}else Ae=M&~H,Ae!==0?L=Vo(Ae):ee!==0&&(L=Vo(ee));if(L===0)return 0;if(_!==0&&_!==L&&!(_&H)&&(H=L&-L,ee=_&-_,H>=ee||H===16&&(ee&4194240)!==0))return _;if(L&4&&(L|=M&16),_=m.entangledLanes,_!==0)for(m=m.entanglements,_&=L;0<_;)M=31-Ki(_),H=1<<M,L|=m[M],_&=~H;return L}function lf(m,_){switch(m){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bu(m,_){for(var M=m.suspendedLanes,L=m.pingedLanes,H=m.expirationTimes,ee=m.pendingLanes;0<ee;){var Ae=31-Ki(ee),je=1<<Ae,Et=H[Ae];Et===-1?(!(je&M)||je&L)&&(H[Ae]=lf(je,_)):Et<=_&&(m.expiredLanes|=je),ee&=~je}}function $p(m){return m=m.pendingLanes&-1073741825,m!==0?m:m&1073741824?1073741824:0}function Hp(m){for(var _=[],M=0;31>M;M++)_.push(m);return _}function nd(m,_,M){m.pendingLanes|=_,_!==536870912&&(m.suspendedLanes=0,m.pingedLanes=0),m=m.eventTimes,_=31-Ki(_),m[_]=M}function ha(m,_){var M=m.pendingLanes&~_;m.pendingLanes=_,m.suspendedLanes=0,m.pingedLanes=0,m.expiredLanes&=_,m.mutableReadLanes&=_,m.entangledLanes&=_,_=m.entanglements;var L=m.eventTimes;for(m=m.expirationTimes;0<M;){var H=31-Ki(M),ee=1<<H;_[H]=0,L[H]=-1,m[H]=-1,M&=~ee}}function uf(m,_){var M=m.entangledLanes|=_;for(m=m.entanglements;M;){var L=31-Ki(M),H=1<<L;H&_|m[L]&_&&(m[L]|=_),M&=~H}}var ur=0;function Py(m){return m&=-m,1<m?4<m?m&268435455?16:536870912:4:1}var Pg=i.unstable_scheduleCallback,jl=i.unstable_cancelCallback,Vp=i.unstable_shouldYield,rd=i.unstable_requestPaint,wr=i.unstable_now,$l=i.unstable_ImmediatePriority,L_=i.unstable_UserBlockingPriority,Dg=i.unstable_NormalPriority,Lg=i.unstable_IdlePriority,zp=null,tl=null;function Ug(m){if(tl&&typeof tl.onCommitFiberRoot=="function")try{tl.onCommitFiberRoot(zp,m,void 0,(m.current.flags&128)===128)}catch{}}function df(m,_){return m===_&&(m!==0||1/m===1/_)||m!==m&&_!==_}var Hl=typeof Object.is=="function"?Object.is:df,Vl=null,Gp=!1,Wp=!1;function Fg(m){Vl===null?Vl=[m]:Vl.push(m)}function Dy(m){Gp=!0,Fg(m)}function dc(){if(!Wp&&Vl!==null){Wp=!0;var m=0,_=ur;try{var M=Vl;for(ur=1;m<M.length;m++){var L=M[m];do L=L(!0);while(L!==null)}Vl=null,Gp=!1}catch(H){throw Vl!==null&&(Vl=Vl.slice(m+1)),Pg($l,dc),H}finally{ur=_,Wp=!1}}return null}var U_=a.ReactCurrentBatchConfig;function qp(m,_){if(Hl(m,_))return!0;if(typeof m!="object"||m===null||typeof _!="object"||_===null)return!1;var M=Object.keys(m),L=Object.keys(_);if(M.length!==L.length)return!1;for(L=0;L<M.length;L++){var H=M[L];if(!Xn.call(_,H)||!Hl(m[H],_[H]))return!1}return!0}function hc(m){switch(m.tag){case 5:return hn(m.type);case 16:return hn("Lazy");case 13:return hn("Suspense");case 19:return hn("SuspenseList");case 0:case 2:case 15:return m=Un(m.type,!1),m;case 11:return m=Un(m.type.render,!1),m;case 1:return m=Un(m.type,!0),m;default:return""}}function si(m,_){if(m&&m.defaultProps){_=s({},_),m=m.defaultProps;for(var M in m)_[M]===void 0&&(_[M]=m[M]);return _}return _}var nl=Vr(null),Kp=null,zl=null,F_=null;function hf(){F_=zl=Kp=null}function Ly(m,_,M){_t?(jn(nl,_._currentValue),_._currentValue=M):(jn(nl,_._currentValue2),_._currentValue2=M)}function Eu(m){var _=nl.current;En(nl),_t?m._currentValue=_:m._currentValue2=_}function Jd(m,_,M){for(;m!==null;){var L=m.alternate;if((m.childLanes&_)!==_?(m.childLanes|=_,L!==null&&(L.childLanes|=_)):L!==null&&(L.childLanes&_)!==_&&(L.childLanes|=_),m===M)break;m=m.return}}function Ks(m,_){Kp=m,F_=zl=null,m=m.dependencies,m!==null&&m.firstContext!==null&&(m.lanes&_&&(za=!0),m.firstContext=null)}function Yi(m){var _=_t?m._currentValue:m._currentValue2;if(F_!==m)if(m={context:m,memoizedValue:_,next:null},zl===null){if(Kp===null)throw Error(o(308));zl=m,Kp.dependencies={lanes:0,firstContext:m}}else zl=zl.next=m;return _}var $a=null,id=!1;function Ms(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Is(m,_){m=m.updateQueue,_.updateQueue===m&&(_.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,effects:m.effects})}function rl(m,_){return{eventTime:m,lane:_,tag:0,payload:null,callback:null,next:null}}function fa(m,_){var M=m.updateQueue;M!==null&&(M=M.shared,ps!==null&&m.mode&1&&!(Cr&2)?(m=M.interleaved,m===null?(_.next=_,$a===null?$a=[M]:$a.push(M)):(_.next=m.next,m.next=_),M.interleaved=_):(m=M.pending,m===null?_.next=_:(_.next=m.next,m.next=_),M.pending=_))}function sd(m,_,M){if(_=_.updateQueue,_!==null&&(_=_.shared,(M&4194240)!==0)){var L=_.lanes;L&=m.pendingLanes,M|=L,_.lanes=M,uf(m,M)}}function ot(m,_){var M=m.updateQueue,L=m.alternate;if(L!==null&&(L=L.updateQueue,M===L)){var H=null,ee=null;if(M=M.firstBaseUpdate,M!==null){do{var Ae={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};ee===null?H=ee=Ae:ee=ee.next=Ae,M=M.next}while(M!==null);ee===null?H=ee=_:ee=ee.next=_}else H=ee=_;M={baseState:L.baseState,firstBaseUpdate:H,lastBaseUpdate:ee,shared:L.shared,effects:L.effects},m.updateQueue=M;return}m=M.lastBaseUpdate,m===null?M.firstBaseUpdate=_:m.next=_,M.lastBaseUpdate=_}function nt(m,_,M,L){var H=m.updateQueue;id=!1;var ee=H.firstBaseUpdate,Ae=H.lastBaseUpdate,je=H.shared.pending;if(je!==null){H.shared.pending=null;var Et=je,qt=Et.next;Et.next=null,Ae===null?ee=qt:Ae.next=qt,Ae=Et;var fn=m.alternate;fn!==null&&(fn=fn.updateQueue,je=fn.lastBaseUpdate,je!==Ae&&(je===null?fn.firstBaseUpdate=qt:je.next=qt,fn.lastBaseUpdate=Et))}if(ee!==null){var pr=H.baseState;Ae=0,fn=qt=Et=null,je=ee;do{var gn=je.lane,Zn=je.eventTime;if((L&gn)===gn){fn!==null&&(fn=fn.next={eventTime:Zn,lane:0,tag:je.tag,payload:je.payload,callback:je.callback,next:null});e:{var bn=m,ea=je;switch(gn=_,Zn=M,ea.tag){case 1:if(bn=ea.payload,typeof bn=="function"){pr=bn.call(Zn,pr,gn);break e}pr=bn;break e;case 3:bn.flags=bn.flags&-65537|128;case 0:if(bn=ea.payload,gn=typeof bn=="function"?bn.call(Zn,pr,gn):bn,gn==null)break e;pr=s({},pr,gn);break e;case 2:id=!0}}je.callback!==null&&je.lane!==0&&(m.flags|=64,gn=H.effects,gn===null?H.effects=[je]:gn.push(je))}else Zn={eventTime:Zn,lane:gn,tag:je.tag,payload:je.payload,callback:je.callback,next:null},fn===null?(qt=fn=Zn,Et=pr):fn=fn.next=Zn,Ae|=gn;if(je=je.next,je===null){if(je=H.shared.pending,je===null)break;gn=je,je=gn.next,gn.next=null,H.lastBaseUpdate=gn,H.shared.pending=null}}while(!0);if(fn===null&&(Et=pr),H.baseState=Et,H.firstBaseUpdate=qt,H.lastBaseUpdate=fn,_=H.shared.interleaved,_!==null){H=_;do Ae|=H.lane,H=H.next;while(H!==_)}else ee===null&&(H.shared.lanes=0);Ga|=Ae,m.lanes=Ae,m.memoizedState=pr}}function Mt(m,_,M){if(m=_.effects,_.effects=null,m!==null)for(_=0;_<m.length;_++){var L=m[_],H=L.callback;if(H!==null){if(L.callback=null,L=M,typeof H!="function")throw Error(o(191,H));H.call(L)}}}var nn=new r.Component().refs;function Gt(m,_,M,L){_=m.memoizedState,M=M(L,_),M=M==null?_:s({},_,M),m.memoizedState=M,m.lanes===0&&(m.updateQueue.baseState=M)}var zr={isMounted:function(m){return(m=m._reactInternals)?F(m)===m:!1},enqueueSetState:function(m,_,M){m=m._reactInternals;var L=Di(),H=Ec(m),ee=rl(L,H);ee.payload=_,M!=null&&(ee.callback=M),fa(m,ee),_=va(m,H,L),_!==null&&sd(_,m,H)},enqueueReplaceState:function(m,_,M){m=m._reactInternals;var L=Di(),H=Ec(m),ee=rl(L,H);ee.tag=1,ee.payload=_,M!=null&&(ee.callback=M),fa(m,ee),_=va(m,H,L),_!==null&&sd(_,m,H)},enqueueForceUpdate:function(m,_){m=m._reactInternals;var M=Di(),L=Ec(m),H=rl(M,L);H.tag=2,_!=null&&(H.callback=_),fa(m,H),_=va(m,L,M),_!==null&&sd(_,m,L)}};function js(m,_,M,L,H,ee,Ae){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(L,ee,Ae):_.prototype&&_.prototype.isPureReactComponent?!qp(M,L)||!qp(H,ee):!0}function il(m,_,M){var L=!1,H=br,ee=_.contextType;return typeof ee=="object"&&ee!==null?ee=Yi(ee):(H=Jn(_)?Er:on.current,L=_.contextTypes,ee=(L=L!=null)?Bs(m,H):br),_=new _(M,ee),m.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=zr,m.stateNode=_,_._reactInternals=m,L&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=H,m.__reactInternalMemoizedMaskedChildContext=ee),_}function Lr(m,_,M,L){m=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(M,L),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(M,L),_.state!==m&&zr.enqueueReplaceState(_,_.state,null)}function Qd(m,_,M,L){var H=m.stateNode;H.props=M,H.state=m.memoizedState,H.refs=nn,Ms(m);var ee=_.contextType;typeof ee=="object"&&ee!==null?H.context=Yi(ee):(ee=Jn(_)?Er:on.current,H.context=Bs(m,ee)),H.state=m.memoizedState,ee=_.getDerivedStateFromProps,typeof ee=="function"&&(Gt(m,_,ee,M),H.state=m.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof H.getSnapshotBeforeUpdate=="function"||typeof H.UNSAFE_componentWillMount!="function"&&typeof H.componentWillMount!="function"||(_=H.state,typeof H.componentWillMount=="function"&&H.componentWillMount(),typeof H.UNSAFE_componentWillMount=="function"&&H.UNSAFE_componentWillMount(),_!==H.state&&zr.enqueueReplaceState(H,H.state,null),nt(m,M,H,L),H.state=m.memoizedState),typeof H.componentDidMount=="function"&&(m.flags|=4194308)}var Zd=[],Ro=0,eh=null,Bg=0,Ys=[],Xs=0,Gl=null,Gr=1,kc="";function od(m,_){Zd[Ro++]=Bg,Zd[Ro++]=eh,eh=m,Bg=_}function Yp(m,_,M){Ys[Xs++]=Gr,Ys[Xs++]=kc,Ys[Xs++]=Gl,Gl=m;var L=Gr;m=kc;var H=32-Ki(L)-1;L&=~(1<<H),M+=1;var ee=32-Ki(_)+H;if(30<ee){var Ae=H-H%5;ee=(L&(1<<Ae)-1).toString(32),L>>=Ae,H-=Ae,Gr=1<<32-Ki(_)+H|M<<H|L,kc=ee+m}else Gr=1<<ee|M<<H|L,kc=m}function ad(m){m.return!==null&&(od(m,1),Yp(m,1,0))}function B_(m){for(;m===eh;)eh=Zd[--Ro],Zd[Ro]=null,Bg=Zd[--Ro],Zd[Ro]=null;for(;m===Gl;)Gl=Ys[--Xs],Ys[Xs]=null,kc=Ys[--Xs],Ys[Xs]=null,Gr=Ys[--Xs],Ys[Xs]=null}var fc=null,zo=null,gi=!1,Nc=!1,Pc=null;function ff(m,_){var M=_s(5,null,null,0);M.elementType="DELETED",M.stateNode=_,M.return=m,_=m.deletions,_===null?(m.deletions=[M],m.flags|=16):_.push(M)}function Xp(m,_){switch(m.tag){case 5:return _=Yr(_,m.type,m.pendingProps),_!==null?(m.stateNode=_,fc=m,zo=_r(_),!0):!1;case 6:return _=cr(_,m.pendingProps),_!==null?(m.stateNode=_,fc=m,zo=null,!0):!1;case 13:if(_=zn(_),_!==null){var M=Gl!==null?{id:Gr,overflow:kc}:null;return m.memoizedState={dehydrated:_,treeContext:M,retryLane:1073741824},M=_s(18,null,null,0),M.stateNode=_,M.return=m,m.child=M,fc=m,zo=null,!0}return!1;default:return!1}}function Jp(m){return(m.mode&1)!==0&&(m.flags&128)===0}function Su(m){if(gi){var _=zo;if(_){var M=_;if(!Xp(m,_)){if(Jp(m))throw Error(o(418));_=Rn(M);var L=fc;_&&Xp(m,_)?ff(L,M):(m.flags=m.flags&-4097|2,gi=!1,fc=m)}}else{if(Jp(m))throw Error(o(418));m.flags=m.flags&-4097|2,gi=!1,fc=m}}}function j_(m){for(m=m.return;m!==null&&m.tag!==5&&m.tag!==3&&m.tag!==13;)m=m.return;fc=m}function sl(m){if(!rt||m!==fc)return!1;if(!gi)return j_(m),gi=!0,!1;if(m.tag!==3&&(m.tag!==5||vt(m.type)&&!xe(m.type,m.memoizedProps))){var _=zo;if(_){if(Jp(m)){for(m=zo;m;)m=Rn(m);throw Error(o(418))}for(;_;)ff(m,_),_=Rn(_)}}if(j_(m),m.tag===13){if(!rt)throw Error(o(316));if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(o(317));zo=af(m)}else zo=fc?Rn(m.stateNode):null;return!0}function pc(){rt&&(zo=fc=null,Nc=gi=!1)}function th(m){Pc===null?Pc=[m]:Pc.push(m)}function Yt(m,_,M){if(m=M.ref,m!==null&&typeof m!="function"&&typeof m!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(o(309));var L=M.stateNode}if(!L)throw Error(o(147,m));var H=L,ee=""+m;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===ee?_.ref:(_=function(Ae){var je=H.refs;je===nn&&(je=H.refs={}),Ae===null?delete je[ee]:je[ee]=Ae},_._stringRef=ee,_)}if(typeof m!="string")throw Error(o(284));if(!M._owner)throw Error(o(290,m))}return m}function ss(m,_){throw m=Object.prototype.toString.call(_),Error(o(31,m==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":m))}function Uy(m){var _=m._init;return _(m._payload)}function Qp(m){function _(Ve,Je){if(m){var ut=Ve.deletions;ut===null?(Ve.deletions=[Je],Ve.flags|=16):ut.push(Je)}}function M(Ve,Je){if(!m)return null;for(;Je!==null;)_(Ve,Je),Je=Je.sibling;return null}function L(Ve,Je){for(Ve=new Map;Je!==null;)Je.key!==null?Ve.set(Je.key,Je):Ve.set(Je.index,Je),Je=Je.sibling;return Ve}function H(Ve,Je){return Ve=Zo(Ve,Je),Ve.index=0,Ve.sibling=null,Ve}function ee(Ve,Je,ut){return Ve.index=ut,m?(ut=Ve.alternate,ut!==null?(ut=ut.index,ut<Je?(Ve.flags|=2,Je):ut):(Ve.flags|=2,Je)):(Ve.flags|=1048576,Je)}function Ae(Ve){return m&&Ve.alternate===null&&(Ve.flags|=2),Ve}function je(Ve,Je,ut,Ht){return Je===null||Je.tag!==6?(Je=Io(ut,Ve.mode,Ht),Je.return=Ve,Je):(Je=H(Je,ut),Je.return=Ve,Je)}function Et(Ve,Je,ut,Ht){var yn=ut.type;return yn===u?fn(Ve,Je,ut.props.children,Ht,ut.key):Je!==null&&(Je.elementType===yn||typeof yn=="object"&&yn!==null&&yn.$$typeof===R&&Uy(yn)===Je.type)?(Ht=H(Je,ut.props),Ht.ref=Yt(Ve,Je,ut),Ht.return=Ve,Ht):(Ht=Jl(ut.type,ut.key,ut.props,null,Ve.mode,Ht),Ht.ref=Yt(Ve,Je,ut),Ht.return=Ve,Ht)}function qt(Ve,Je,ut,Ht){return Je===null||Je.tag!==4||Je.stateNode.containerInfo!==ut.containerInfo||Je.stateNode.implementation!==ut.implementation?(Je=Sm(ut,Ve.mode,Ht),Je.return=Ve,Je):(Je=H(Je,ut.children||[]),Je.return=Ve,Je)}function fn(Ve,Je,ut,Ht,yn){return Je===null||Je.tag!==7?(Je=ya(ut,Ve.mode,Ht,yn),Je.return=Ve,Je):(Je=H(Je,ut),Je.return=Ve,Je)}function pr(Ve,Je,ut){if(typeof Je=="string"&&Je!==""||typeof Je=="number")return Je=Io(""+Je,Ve.mode,ut),Je.return=Ve,Je;if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case c:return ut=Jl(Je.type,Je.key,Je.props,null,Ve.mode,ut),ut.ref=Yt(Ve,null,Je),ut.return=Ve,ut;case l:return Je=Sm(Je,Ve.mode,ut),Je.return=Ve,Je;case R:var Ht=Je._init;return pr(Ve,Ht(Je._payload),ut)}if(ne(Je)||I(Je))return Je=ya(Je,Ve.mode,ut,null),Je.return=Ve,Je;ss(Ve,Je)}return null}function gn(Ve,Je,ut,Ht){var yn=Je!==null?Je.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number")return yn!==null?null:je(Ve,Je,""+ut,Ht);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case c:return ut.key===yn?Et(Ve,Je,ut,Ht):null;case l:return ut.key===yn?qt(Ve,Je,ut,Ht):null;case R:return yn=ut._init,gn(Ve,Je,yn(ut._payload),Ht)}if(ne(ut)||I(ut))return yn!==null?null:fn(Ve,Je,ut,Ht,null);ss(Ve,ut)}return null}function Zn(Ve,Je,ut,Ht,yn){if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number")return Ve=Ve.get(ut)||null,je(Je,Ve,""+Ht,yn);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case c:return Ve=Ve.get(Ht.key===null?ut:Ht.key)||null,Et(Je,Ve,Ht,yn);case l:return Ve=Ve.get(Ht.key===null?ut:Ht.key)||null,qt(Je,Ve,Ht,yn);case R:var dr=Ht._init;return Zn(Ve,Je,ut,dr(Ht._payload),yn)}if(ne(Ht)||I(Ht))return Ve=Ve.get(ut)||null,fn(Je,Ve,Ht,yn,null);ss(Je,Ht)}return null}function bn(Ve,Je,ut,Ht){for(var yn=null,dr=null,hr=Je,x=Je=0,b=null;hr!==null&&x<ut.length;x++){hr.index>x?(b=hr,hr=null):b=hr.sibling;var S=gn(Ve,hr,ut[x],Ht);if(S===null){hr===null&&(hr=b);break}m&&hr&&S.alternate===null&&_(Ve,hr),Je=ee(S,Je,x),dr===null?yn=S:dr.sibling=S,dr=S,hr=b}if(x===ut.length)return M(Ve,hr),gi&&od(Ve,x),yn;if(hr===null){for(;x<ut.length;x++)hr=pr(Ve,ut[x],Ht),hr!==null&&(Je=ee(hr,Je,x),dr===null?yn=hr:dr.sibling=hr,dr=hr);return gi&&od(Ve,x),yn}for(hr=L(Ve,hr);x<ut.length;x++)b=Zn(hr,Ve,x,ut[x],Ht),b!==null&&(m&&b.alternate!==null&&hr.delete(b.key===null?x:b.key),Je=ee(b,Je,x),dr===null?yn=b:dr.sibling=b,dr=b);return m&&hr.forEach(function(C){return _(Ve,C)}),gi&&od(Ve,x),yn}function ea(Ve,Je,ut,Ht){var yn=I(ut);if(typeof yn!="function")throw Error(o(150));if(ut=yn.call(ut),ut==null)throw Error(o(151));for(var dr=yn=null,hr=Je,x=Je=0,b=null,S=ut.next();hr!==null&&!S.done;x++,S=ut.next()){hr.index>x?(b=hr,hr=null):b=hr.sibling;var C=gn(Ve,hr,S.value,Ht);if(C===null){hr===null&&(hr=b);break}m&&hr&&C.alternate===null&&_(Ve,hr),Je=ee(C,Je,x),dr===null?yn=C:dr.sibling=C,dr=C,hr=b}if(S.done)return M(Ve,hr),gi&&od(Ve,x),yn;if(hr===null){for(;!S.done;x++,S=ut.next())S=pr(Ve,S.value,Ht),S!==null&&(Je=ee(S,Je,x),dr===null?yn=S:dr.sibling=S,dr=S);return gi&&od(Ve,x),yn}for(hr=L(Ve,hr);!S.done;x++,S=ut.next())S=Zn(hr,Ve,x,S.value,Ht),S!==null&&(m&&S.alternate!==null&&hr.delete(S.key===null?x:S.key),Je=ee(S,Je,x),dr===null?yn=S:dr.sibling=S,dr=S);return m&&hr.forEach(function(O){return _(Ve,O)}),gi&&od(Ve,x),yn}function Rr(Ve,Je,ut,Ht){if(typeof ut=="object"&&ut!==null&&ut.type===u&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case c:e:{for(var yn=ut.key,dr=Je;dr!==null;){if(dr.key===yn){if(yn=ut.type,yn===u){if(dr.tag===7){M(Ve,dr.sibling),Je=H(dr,ut.props.children),Je.return=Ve,Ve=Je;break e}}else if(dr.elementType===yn||typeof yn=="object"&&yn!==null&&yn.$$typeof===R&&Uy(yn)===dr.type){M(Ve,dr.sibling),Je=H(dr,ut.props),Je.ref=Yt(Ve,dr,ut),Je.return=Ve,Ve=Je;break e}M(Ve,dr);break}else _(Ve,dr);dr=dr.sibling}ut.type===u?(Je=ya(ut.props.children,Ve.mode,Ht,ut.key),Je.return=Ve,Ve=Je):(Ht=Jl(ut.type,ut.key,ut.props,null,Ve.mode,Ht),Ht.ref=Yt(Ve,Je,ut),Ht.return=Ve,Ve=Ht)}return Ae(Ve);case l:e:{for(dr=ut.key;Je!==null;){if(Je.key===dr)if(Je.tag===4&&Je.stateNode.containerInfo===ut.containerInfo&&Je.stateNode.implementation===ut.implementation){M(Ve,Je.sibling),Je=H(Je,ut.children||[]),Je.return=Ve,Ve=Je;break e}else{M(Ve,Je);break}else _(Ve,Je);Je=Je.sibling}Je=Sm(ut,Ve.mode,Ht),Je.return=Ve,Ve=Je}return Ae(Ve);case R:return dr=ut._init,Rr(Ve,Je,dr(ut._payload),Ht)}if(ne(ut))return bn(Ve,Je,ut,Ht);if(I(ut))return ea(Ve,Je,ut,Ht);ss(Ve,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"?(ut=""+ut,Je!==null&&Je.tag===6?(M(Ve,Je.sibling),Je=H(Je,ut),Je.return=Ve,Ve=Je):(M(Ve,Je),Je=Io(ut,Ve.mode,Ht),Je.return=Ve,Ve=Je),Ae(Ve)):M(Ve,Je)}return Rr}var lo=Qp(!0),Zp=Qp(!1),em={},Js=Vr(em),pf=Vr(em),Qs=Vr(em);function oi(m){if(m===em)throw Error(o(174));return m}function hs(m,_){jn(Qs,_),jn(pf,m),jn(Js,em),m=ie(_),En(Js),jn(Js,m)}function Qn(){En(Js),En(pf),En(Qs)}function mc(m){var _=oi(Qs.current),M=oi(Js.current);_=G(M,m.type,_),M!==_&&(jn(pf,m),jn(Js,_))}function uo(m){pf.current===m&&(En(Js),En(pf))}var Ai=Vr(0);function nh(m){for(var _=m;_!==null;){if(_.tag===13){var M=_.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||dn(M)||tn(M)))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if(_.flags&128)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===m)break;for(;_.sibling===null;){if(_.return===null||_.return===m)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var ho=[];function Lt(){for(var m=0;m<ho.length;m++){var _=ho[m];_t?_._workInProgressVersionPrimary=null:_._workInProgressVersionSecondary=null}ho.length=0}var Os=a.ReactCurrentDispatcher,Go=a.ReactCurrentBatchConfig,gc=0,Pi=null,os=null,ks=null,mf=!1,tm=!1,Tu=0,Fy=0;function $s(){throw Error(o(321))}function cd(m,_){if(_===null)return!1;for(var M=0;M<_.length&&M<m.length;M++)if(!Hl(m[M],_[M]))return!1;return!0}function gf(m,_,M,L,H,ee){if(gc=ee,Pi=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,Os.current=m===null||m.memoizedState===null?$_:Wl,m=M(L,H),tm){ee=0;do{if(tm=!1,Tu=0,25<=ee)throw Error(o(301));ee+=1,ks=os=null,_.updateQueue=null,Os.current=fs,m=M(L,H)}while(tm)}if(Os.current=Va,_=os!==null&&os.next!==null,gc=0,ks=os=Pi=null,mf=!1,_)throw Error(o(300));return m}function me(){var m=Tu!==0;return Tu=0,m}function Wo(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ks===null?Pi.memoizedState=ks=m:ks=ks.next=m,ks}function Ha(){if(os===null){var m=Pi.alternate;m=m!==null?m.memoizedState:null}else m=os.next;var _=ks===null?Pi.memoizedState:ks.next;if(_!==null)ks=_,os=m;else{if(m===null)throw Error(o(310));os=m,m={memoizedState:os.memoizedState,baseState:os.baseState,baseQueue:os.baseQueue,queue:os.queue,next:null},ks===null?Pi.memoizedState=ks=m:ks=ks.next=m}return ks}function Hs(m,_){return typeof _=="function"?_(m):_}function Mr(m){var _=Ha(),M=_.queue;if(M===null)throw Error(o(311));M.lastRenderedReducer=m;var L=os,H=L.baseQueue,ee=M.pending;if(ee!==null){if(H!==null){var Ae=H.next;H.next=ee.next,ee.next=Ae}L.baseQueue=H=ee,M.pending=null}if(H!==null){ee=H.next,L=L.baseState;var je=Ae=null,Et=null,qt=ee;do{var fn=qt.lane;if((gc&fn)===fn)Et!==null&&(Et=Et.next={lane:0,action:qt.action,hasEagerState:qt.hasEagerState,eagerState:qt.eagerState,next:null}),L=qt.hasEagerState?qt.eagerState:m(L,qt.action);else{var pr={lane:fn,action:qt.action,hasEagerState:qt.hasEagerState,eagerState:qt.eagerState,next:null};Et===null?(je=Et=pr,Ae=L):Et=Et.next=pr,Pi.lanes|=fn,Ga|=fn}qt=qt.next}while(qt!==null&&qt!==ee);Et===null?Ae=L:Et.next=je,Hl(L,_.memoizedState)||(za=!0),_.memoizedState=L,_.baseState=Ae,_.baseQueue=Et,M.lastRenderedState=L}if(m=M.interleaved,m!==null){H=m;do ee=H.lane,Pi.lanes|=ee,Ga|=ee,H=H.next;while(H!==m)}else H===null&&(M.lanes=0);return[_.memoizedState,M.dispatch]}function ol(m){var _=Ha(),M=_.queue;if(M===null)throw Error(o(311));M.lastRenderedReducer=m;var L=M.dispatch,H=M.pending,ee=_.memoizedState;if(H!==null){M.pending=null;var Ae=H=H.next;do ee=m(ee,Ae.action),Ae=Ae.next;while(Ae!==H);Hl(ee,_.memoizedState)||(za=!0),_.memoizedState=ee,_.baseQueue===null&&(_.baseState=ee),M.lastRenderedState=ee}return[ee,L]}function al(){}function cl(m,_){var M=Pi,L=Ha(),H=_(),ee=!Hl(L.memoizedState,H);if(ee&&(L.memoizedState=H,za=!0),L=L.queue,vf(jg.bind(null,M,L,m),[m]),L.getSnapshot!==_||ee||ks!==null&&ks.memoizedState.tag&1){if(M.flags|=2048,rh(9,vc.bind(null,M,L,H,_),void 0,null),ps===null)throw Error(o(349));gc&30||ll(M,_,H)}return H}function ll(m,_,M){m.flags|=16384,m={getSnapshot:_,value:M},_=Pi.updateQueue,_===null?(_={lastEffect:null,stores:null},Pi.updateQueue=_,_.stores=[m]):(M=_.stores,M===null?_.stores=[m]:M.push(m))}function vc(m,_,M,L){_.value=M,_.getSnapshot=L,ul(_)&&va(m,1,-1)}function jg(m,_,M){return M(function(){ul(_)&&va(m,1,-1)})}function ul(m){var _=m.getSnapshot;m=m.value;try{var M=_();return!Hl(m,M)}catch{return!0}}function $g(m){var _=Wo();return typeof m=="function"&&(m=m()),_.memoizedState=_.baseState=m,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hs,lastRenderedState:m},_.queue=m,m=m.dispatch=im.bind(null,Pi,m),[_.memoizedState,m]}function rh(m,_,M,L){return m={tag:m,create:_,destroy:M,deps:L,next:null},_=Pi.updateQueue,_===null?(_={lastEffect:null,stores:null},Pi.updateQueue=_,_.lastEffect=m.next=m):(M=_.lastEffect,M===null?_.lastEffect=m.next=m:(L=M.next,M.next=m,m.next=L,_.lastEffect=m)),m}function nm(){return Ha().memoizedState}function wu(m,_,M,L){var H=Wo();Pi.flags|=m,H.memoizedState=rh(1|_,M,void 0,L===void 0?null:L)}function ld(m,_,M,L){var H=Ha();L=L===void 0?null:L;var ee=void 0;if(os!==null){var Ae=os.memoizedState;if(ee=Ae.destroy,L!==null&&cd(L,Ae.deps)){H.memoizedState=rh(_,M,ee,L);return}}Pi.flags|=m,H.memoizedState=rh(1|_,M,ee,L)}function Hg(m,_){return wu(8390656,8,m,_)}function vf(m,_){return ld(2048,8,m,_)}function dl(m,_){return ld(4,2,m,_)}function Vg(m,_){return ld(4,4,m,_)}function xu(m,_){if(typeof _=="function")return m=m(),_(m),function(){_(null)};if(_!=null)return m=m(),_.current=m,function(){_.current=null}}function qo(m,_,M){return M=M!=null?M.concat([m]):null,ld(4,4,xu.bind(null,_,m),M)}function Ns(){}function zg(m,_){var M=Ha();_=_===void 0?null:_;var L=M.memoizedState;return L!==null&&_!==null&&cd(_,L[1])?L[0]:(M.memoizedState=[m,_],m)}function ih(m,_){var M=Ha();_=_===void 0?null:_;var L=M.memoizedState;return L!==null&&_!==null&&cd(_,L[1])?L[0]:(m=m(),M.memoizedState=[m,_],m)}function ud(m,_){var M=ur;ur=M!==0&&4>M?M:4,m(!0);var L=Go.transition;Go.transition={};try{m(!1),_()}finally{ur=M,Go.transition=L}}function rm(){return Ha().memoizedState}function By(m,_,M){var L=Ec(m);M={lane:L,action:M,hasEagerState:!1,eagerState:null,next:null},_f(m)?fo(_,M):(Gg(m,_,M),M=Di(),m=va(m,L,M),m!==null&&Wg(m,_,L))}function im(m,_,M){var L=Ec(m),H={lane:L,action:M,hasEagerState:!1,eagerState:null,next:null};if(_f(m))fo(_,H);else{Gg(m,_,H);var ee=m.alternate;if(m.lanes===0&&(ee===null||ee.lanes===0)&&(ee=_.lastRenderedReducer,ee!==null))try{var Ae=_.lastRenderedState,je=ee(Ae,M);if(H.hasEagerState=!0,H.eagerState=je,Hl(je,Ae))return}catch{}finally{}M=Di(),m=va(m,L,M),m!==null&&Wg(m,_,L)}}function _f(m){var _=m.alternate;return m===Pi||_!==null&&_===Pi}function fo(m,_){tm=mf=!0;var M=m.pending;M===null?_.next=_:(_.next=M.next,M.next=_),m.pending=_}function Gg(m,_,M){ps!==null&&m.mode&1&&!(Cr&2)?(m=_.interleaved,m===null?(M.next=M,$a===null?$a=[_]:$a.push(_)):(M.next=m.next,m.next=M),_.interleaved=M):(m=_.pending,m===null?M.next=M:(M.next=m.next,m.next=M),_.pending=M)}function Wg(m,_,M){if(M&4194240){var L=_.lanes;L&=m.pendingLanes,M|=L,_.lanes=M,uf(m,M)}}var Va={readContext:Yi,useCallback:$s,useContext:$s,useEffect:$s,useImperativeHandle:$s,useInsertionEffect:$s,useLayoutEffect:$s,useMemo:$s,useReducer:$s,useRef:$s,useState:$s,useDebugValue:$s,useDeferredValue:$s,useTransition:$s,useMutableSource:$s,useSyncExternalStore:$s,useId:$s,unstable_isNewReconciler:!1},$_={readContext:Yi,useCallback:function(m,_){return Wo().memoizedState=[m,_===void 0?null:_],m},useContext:Yi,useEffect:Hg,useImperativeHandle:function(m,_,M){return M=M!=null?M.concat([m]):null,wu(4194308,4,xu.bind(null,_,m),M)},useLayoutEffect:function(m,_){return wu(4194308,4,m,_)},useInsertionEffect:function(m,_){return wu(4,2,m,_)},useMemo:function(m,_){var M=Wo();return _=_===void 0?null:_,m=m(),M.memoizedState=[m,_],m},useReducer:function(m,_,M){var L=Wo();return _=M!==void 0?M(_):_,L.memoizedState=L.baseState=_,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:_},L.queue=m,m=m.dispatch=By.bind(null,Pi,m),[L.memoizedState,m]},useRef:function(m){var _=Wo();return m={current:m},_.memoizedState=m},useState:$g,useDebugValue:Ns,useDeferredValue:function(m){var _=$g(m),M=_[0],L=_[1];return Hg(function(){var H=Go.transition;Go.transition={};try{L(m)}finally{Go.transition=H}},[m]),M},useTransition:function(){var m=$g(!1),_=m[0];return m=ud.bind(null,m[1]),Wo().memoizedState=m,[_,m]},useMutableSource:function(){},useSyncExternalStore:function(m,_,M){var L=Pi,H=Wo();if(gi){if(M===void 0)throw Error(o(407));M=M()}else{if(M=_(),ps===null)throw Error(o(349));gc&30||ll(L,_,M)}H.memoizedState=M;var ee={value:M,getSnapshot:_};return H.queue=ee,Hg(jg.bind(null,L,ee,m),[m]),L.flags|=2048,rh(9,vc.bind(null,L,ee,M,_),void 0,null),M},useId:function(){var m=Wo(),_=ps.identifierPrefix;if(gi){var M=kc,L=Gr;M=(L&~(1<<32-Ki(L)-1)).toString(32)+M,_=":"+_+"R"+M,M=Tu++,0<M&&(_+="H"+M.toString(32)),_+=":"}else M=Fy++,_=":"+_+"r"+M.toString(32)+":";return m.memoizedState=_},unstable_isNewReconciler:!1},Wl={readContext:Yi,useCallback:zg,useContext:Yi,useEffect:vf,useImperativeHandle:qo,useInsertionEffect:dl,useLayoutEffect:Vg,useMemo:ih,useReducer:Mr,useRef:nm,useState:function(){return Mr(Hs)},useDebugValue:Ns,useDeferredValue:function(m){var _=Mr(Hs),M=_[0],L=_[1];return vf(function(){var H=Go.transition;Go.transition={};try{L(m)}finally{Go.transition=H}},[m]),M},useTransition:function(){var m=Mr(Hs)[0],_=Ha().memoizedState;return[m,_]},useMutableSource:al,useSyncExternalStore:cl,useId:rm,unstable_isNewReconciler:!1},fs={readContext:Yi,useCallback:zg,useContext:Yi,useEffect:vf,useImperativeHandle:qo,useInsertionEffect:dl,useLayoutEffect:Vg,useMemo:ih,useReducer:ol,useRef:nm,useState:function(){return ol(Hs)},useDebugValue:Ns,useDeferredValue:function(m){var _=ol(Hs),M=_[0],L=_[1];return vf(function(){var H=Go.transition;Go.transition={};try{L(m)}finally{Go.transition=H}},[m]),M},useTransition:function(){var m=ol(Hs)[0],_=Ha().memoizedState;return[m,_]},useMutableSource:al,useSyncExternalStore:cl,useId:rm,unstable_isNewReconciler:!1};function Cu(m,_){try{var M="",L=_;do M+=hc(L),L=L.return;while(L);var H=M}catch(ee){H=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:m,source:_,stack:H}}function Vs(m,_){try{console.error(_.value)}catch(M){setTimeout(function(){throw M})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function yf(m,_,M){M=rl(-1,M),M.tag=3,M.payload={element:null};var L=_.value;return M.callback=function(){eo||(eo=!0,kf=L),Vs(m,_)},M}function sh(m,_,M){M=rl(-1,M),M.tag=3;var L=m.type.getDerivedStateFromError;if(typeof L=="function"){var H=_.value;M.payload=function(){return L(H)},M.callback=function(){Vs(m,_)}}var ee=m.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(M.callback=function(){Vs(m,_),typeof L!="function"&&(Xl===null?Xl=new Set([this]):Xl.add(this));var Ae=_.stack;this.componentDidCatch(_.value,{componentStack:Ae!==null?Ae:""})}),M}function qg(m,_,M){var L=m.pingCache;if(L===null){L=m.pingCache=new Mi;var H=new Set;L.set(_,H)}else H=L.get(_),H===void 0&&(H=new Set,L.set(_,H));H.has(M)||(H.add(M),m=AS.bind(null,m,_,M),_.then(m,m))}function ql(m){do{var _;if((_=m.tag===13)&&(_=m.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return m;m=m.return}while(m!==null);return null}function sm(m,_,M,L,H){return m.mode&1?(m.flags|=65536,m.lanes=H,m):(m===_?m.flags|=65536:(m.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(_=rl(-1,1),_.tag=2,fa(M,_))),M.lanes|=1),m)}function Ao(m){m.flags|=4}function Kg(m,_){if(m!==null&&m.child===_.child)return!0;if(_.flags&16)return!1;for(m=_.child;m!==null;){if(m.flags&12854||m.subtreeFlags&12854)return!1;m=m.sibling}return!0}var bf,Ef,Sf,om;if(fe)bf=function(m,_){for(var M=_.child;M!==null;){if(M.tag===5||M.tag===6)Oe(m,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===_)break;for(;M.sibling===null;){if(M.return===null||M.return===_)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},Ef=function(){},Sf=function(m,_,M,L,H){if(m=m.memoizedProps,m!==L){var ee=_.stateNode,Ae=oi(Js.current);M=le(ee,M,m,L,H,Ae),(_.updateQueue=M)&&Ao(_)}},om=function(m,_,M,L){M!==L&&Ao(_)};else if(ge){bf=function(m,_,M,L){for(var H=_.child;H!==null;){if(H.tag===5){var ee=H.stateNode;M&&L&&(ee=wt(ee,H.type,H.memoizedProps,H)),Oe(m,ee)}else if(H.tag===6)ee=H.stateNode,M&&L&&(ee=Pn(ee,H.memoizedProps,H)),Oe(m,ee);else if(H.tag!==4){if(H.tag===22&&H.memoizedState!==null)ee=H.child,ee!==null&&(ee.return=H),bf(m,H,!0,!0);else if(H.child!==null){H.child.return=H,H=H.child;continue}}if(H===_)break;for(;H.sibling===null;){if(H.return===null||H.return===_)return;H=H.return}H.sibling.return=H.return,H=H.sibling}};var am=function(m,_,M,L){for(var H=_.child;H!==null;){if(H.tag===5){var ee=H.stateNode;M&&L&&(ee=wt(ee,H.type,H.memoizedProps,H)),Le(m,ee)}else if(H.tag===6)ee=H.stateNode,M&&L&&(ee=Pn(ee,H.memoizedProps,H)),Le(m,ee);else if(H.tag!==4){if(H.tag===22&&H.memoizedState!==null)ee=H.child,ee!==null&&(ee.return=H),am(m,H,!0,!0);else if(H.child!==null){H.child.return=H,H=H.child;continue}}if(H===_)break;for(;H.sibling===null;){if(H.return===null||H.return===_)return;H=H.return}H.sibling.return=H.return,H=H.sibling}};Ef=function(m,_){var M=_.stateNode;if(!Kg(m,_)){m=M.containerInfo;var L=Jt(m);am(L,_,!1,!1),M.pendingChildren=L,Ao(_),it(m,L)}},Sf=function(m,_,M,L,H){var ee=m.stateNode,Ae=m.memoizedProps;if((m=Kg(m,_))&&Ae===L)_.stateNode=ee;else{var je=_.stateNode,Et=oi(Js.current),qt=null;Ae!==L&&(qt=le(je,M,Ae,L,H,Et)),m&&qt===null?_.stateNode=ee:(ee=sn(ee,qt,M,Ae,L,_,m,je),_e(ee,M,L,H,Et)&&Ao(_),_.stateNode=ee,m?Ao(_):bf(ee,_,!1,!1))}},om=function(m,_,M,L){M!==L?(m=oi(Qs.current),M=oi(Js.current),_.stateNode=Ee(L,m,M,_),Ao(_)):_.stateNode=m.stateNode}}else Ef=function(){},Sf=function(){},om=function(){};function pa(m,_){if(!gi)switch(m.tailMode){case"hidden":_=m.tail;for(var M=null;_!==null;)_.alternate!==null&&(M=_),_=_.sibling;M===null?m.tail=null:M.sibling=null;break;case"collapsed":M=m.tail;for(var L=null;M!==null;)M.alternate!==null&&(L=M),M=M.sibling;L===null?_||m.tail===null?m.tail=null:m.tail.sibling=null:L.sibling=null}}function po(m){var _=m.alternate!==null&&m.alternate.child===m.child,M=0,L=0;if(_)for(var H=m.child;H!==null;)M|=H.lanes|H.childLanes,L|=H.subtreeFlags&14680064,L|=H.flags&14680064,H.return=m,H=H.sibling;else for(H=m.child;H!==null;)M|=H.lanes|H.childLanes,L|=H.subtreeFlags,L|=H.flags,H.return=m,H=H.sibling;return m.subtreeFlags|=L,m.childLanes=M,_}function H_(m,_,M){var L=_.pendingProps;switch(B_(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return po(_),null;case 1:return Jn(_.type)&&lr(),po(_),null;case 3:return L=_.stateNode,Qn(),En(qi),En(on),Lt(),L.pendingContext&&(L.context=L.pendingContext,L.pendingContext=null),(m===null||m.child===null)&&(sl(_)?Ao(_):m===null||m.memoizedState.isDehydrated&&!(_.flags&256)||(_.flags|=1024,Pc!==null&&(Lc(Pc),Pc=null))),Ef(m,_),po(_),null;case 5:uo(_),M=oi(Qs.current);var H=_.type;if(m!==null&&_.stateNode!=null)Sf(m,_,H,L,M),m.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!L){if(_.stateNode===null)throw Error(o(166));return po(_),null}if(m=oi(Js.current),sl(_)){if(!rt)throw Error(o(175));m=xo(_.stateNode,_.type,_.memoizedProps,M,m,_,!Nc),_.updateQueue=m,m!==null&&Ao(_)}else{var ee=ve(H,L,M,m,_);bf(ee,_,!1,!1),_.stateNode=ee,_e(ee,H,L,M,m)&&Ao(_)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return po(_),null;case 6:if(m&&_.stateNode!=null)om(m,_,m.memoizedProps,L);else{if(typeof L!="string"&&_.stateNode===null)throw Error(o(166));if(m=oi(Qs.current),M=oi(Js.current),sl(_)){if(!rt)throw Error(o(176));if(m=_.stateNode,L=_.memoizedProps,(M=yu(m,L,_,!Nc))&&(H=fc,H!==null))switch(ee=(H.mode&1)!==0,H.tag){case 3:Xe(H.stateNode.containerInfo,m,L,ee);break;case 5:zt(H.type,H.memoizedProps,H.stateNode,m,L,ee)}M&&Ao(_)}else _.stateNode=Ee(L,m,M,_)}return po(_),null;case 13:if(En(Ai),L=_.memoizedState,gi&&zo!==null&&_.mode&1&&!(_.flags&128)){for(m=zo;m;)m=Rn(m);return pc(),_.flags|=98560,_}if(L!==null&&L.dehydrated!==null){if(L=sl(_),m===null){if(!L)throw Error(o(318));if(!rt)throw Error(o(344));if(m=_.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(o(317));Kd(m,_)}else pc(),!(_.flags&128)&&(_.memoizedState=null),_.flags|=4;return po(_),null}return Pc!==null&&(Lc(Pc),Pc=null),_.flags&128?(_.lanes=M,_):(L=L!==null,M=!1,m===null?sl(_):M=m.memoizedState!==null,L&&!M&&(_.child.flags|=8192,_.mode&1&&(m===null||Ai.current&1?gs===0&&(gs=3):gd())),_.updateQueue!==null&&(_.flags|=4),po(_),null);case 4:return Qn(),Ef(m,_),m===null&&St(_.stateNode.containerInfo),po(_),null;case 10:return Eu(_.type._context),po(_),null;case 17:return Jn(_.type)&&lr(),po(_),null;case 19:if(En(Ai),H=_.memoizedState,H===null)return po(_),null;if(L=(_.flags&128)!==0,ee=H.rendering,ee===null)if(L)pa(H,!1);else{if(gs!==0||m!==null&&m.flags&128)for(m=_.child;m!==null;){if(ee=nh(m),ee!==null){for(_.flags|=128,pa(H,!1),m=ee.updateQueue,m!==null&&(_.updateQueue=m,_.flags|=4),_.subtreeFlags=0,m=M,L=_.child;L!==null;)M=L,H=m,M.flags&=14680066,ee=M.alternate,ee===null?(M.childLanes=0,M.lanes=H,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=ee.childLanes,M.lanes=ee.lanes,M.child=ee.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=ee.memoizedProps,M.memoizedState=ee.memoizedState,M.updateQueue=ee.updateQueue,M.type=ee.type,H=ee.dependencies,M.dependencies=H===null?null:{lanes:H.lanes,firstContext:H.firstContext}),L=L.sibling;return jn(Ai,Ai.current&1|2),_.child}m=m.sibling}H.tail!==null&&wr()>_m&&(_.flags|=128,L=!0,pa(H,!1),_.lanes=4194304)}else{if(!L)if(m=nh(ee),m!==null){if(_.flags|=128,L=!0,m=m.updateQueue,m!==null&&(_.updateQueue=m,_.flags|=4),pa(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ee.alternate&&!gi)return po(_),null}else 2*wr()-H.renderingStartTime>_m&&M!==1073741824&&(_.flags|=128,L=!0,pa(H,!1),_.lanes=4194304);H.isBackwards?(ee.sibling=_.child,_.child=ee):(m=H.last,m!==null?m.sibling=ee:_.child=ee,H.last=ee)}return H.tail!==null?(_=H.tail,H.rendering=_,H.tail=_.sibling,H.renderingStartTime=wr(),_.sibling=null,m=Ai.current,jn(Ai,L?m&1|2:m&1),_):(po(_),null);case 22:case 23:return Uf(),L=_.memoizedState!==null,m!==null&&m.memoizedState!==null!==L&&(_.flags|=8192),L&&_.mode&1?Zs&1073741824&&(po(_),fe&&_.subtreeFlags&6&&(_.flags|=8192)):po(_),null;case 24:return null;case 25:return null}throw Error(o(156,_.tag))}var Yg=a.ReactCurrentOwner,za=!1;function Ko(m,_,M,L){_.child=m===null?Zp(_,null,M,L):lo(_,m.child,M,L)}function V_(m,_,M,L,H){M=M.render;var ee=_.ref;return Ks(_,H),L=gf(m,_,M,L,ee,H),M=me(),m!==null&&!za?(_.updateQueue=m.updateQueue,_.flags&=-2053,m.lanes&=~H,ga(m,_,H)):(gi&&M&&ad(_),_.flags|=1,Ko(m,_,L,H),_.child)}function Xg(m,_,M,L,H){if(m===null){var ee=M.type;return typeof ee=="function"&&!Sc(ee)&&ee.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(_.tag=15,_.type=ee,z_(m,_,ee,L,H)):(m=Jl(M.type,null,L,_,_.mode,H),m.ref=_.ref,m.return=_,_.child=m)}if(ee=m.child,!(m.lanes&H)){var Ae=ee.memoizedProps;if(M=M.compare,M=M!==null?M:qp,M(Ae,L)&&m.ref===_.ref)return ga(m,_,H)}return _.flags|=1,m=Zo(ee,L),m.ref=_.ref,m.return=_,_.child=m}function z_(m,_,M,L,H){if(m!==null&&qp(m.memoizedProps,L)&&m.ref===_.ref)if(za=!1,(m.lanes&H)!==0)m.flags&131072&&(za=!0);else return _.lanes=m.lanes,ga(m,_,H);return xr(m,_,M,L,H)}function Jg(m,_,M){var L=_.pendingProps,H=L.children,ee=m!==null?m.memoizedState:null;if(L.mode==="hidden")if(!(_.mode&1))_.memoizedState={baseLanes:0,cachePool:null},jn(kn,Zs),Zs|=M;else if(M&1073741824)_.memoizedState={baseLanes:0,cachePool:null},L=ee!==null?ee.baseLanes:M,jn(kn,Zs),Zs|=L;else return m=ee!==null?ee.baseLanes|M:M,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:m,cachePool:null},_.updateQueue=null,jn(kn,Zs),Zs|=m,null;else ee!==null?(L=ee.baseLanes|M,_.memoizedState=null):L=M,jn(kn,Zs),Zs|=L;return Ko(m,_,H,M),_.child}function Qg(m,_){var M=_.ref;(m===null&&M!==null||m!==null&&m.ref!==M)&&(_.flags|=512,_.flags|=2097152)}function xr(m,_,M,L,H){var ee=Jn(M)?Er:on.current;return ee=Bs(_,ee),Ks(_,H),M=gf(m,_,M,L,ee,H),L=me(),m!==null&&!za?(_.updateQueue=m.updateQueue,_.flags&=-2053,m.lanes&=~H,ga(m,_,H)):(gi&&L&&ad(_),_.flags|=1,Ko(m,_,M,H),_.child)}function cm(m,_,M,L,H){if(Jn(M)){var ee=!0;Co(_)}else ee=!1;if(Ks(_,H),_.stateNode===null)m!==null&&(m.alternate=null,_.alternate=null,_.flags|=2),il(_,M,L),Qd(_,M,L,H),L=!0;else if(m===null){var Ae=_.stateNode,je=_.memoizedProps;Ae.props=je;var Et=Ae.context,qt=M.contextType;typeof qt=="object"&&qt!==null?qt=Yi(qt):(qt=Jn(M)?Er:on.current,qt=Bs(_,qt));var fn=M.getDerivedStateFromProps,pr=typeof fn=="function"||typeof Ae.getSnapshotBeforeUpdate=="function";pr||typeof Ae.UNSAFE_componentWillReceiveProps!="function"&&typeof Ae.componentWillReceiveProps!="function"||(je!==L||Et!==qt)&&Lr(_,Ae,L,qt),id=!1;var gn=_.memoizedState;Ae.state=gn,nt(_,L,Ae,H),Et=_.memoizedState,je!==L||gn!==Et||qi.current||id?(typeof fn=="function"&&(Gt(_,M,fn,L),Et=_.memoizedState),(je=id||js(_,M,je,L,gn,Et,qt))?(pr||typeof Ae.UNSAFE_componentWillMount!="function"&&typeof Ae.componentWillMount!="function"||(typeof Ae.componentWillMount=="function"&&Ae.componentWillMount(),typeof Ae.UNSAFE_componentWillMount=="function"&&Ae.UNSAFE_componentWillMount()),typeof Ae.componentDidMount=="function"&&(_.flags|=4194308)):(typeof Ae.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=L,_.memoizedState=Et),Ae.props=L,Ae.state=Et,Ae.context=qt,L=je):(typeof Ae.componentDidMount=="function"&&(_.flags|=4194308),L=!1)}else{Ae=_.stateNode,Is(m,_),je=_.memoizedProps,qt=_.type===_.elementType?je:si(_.type,je),Ae.props=qt,pr=_.pendingProps,gn=Ae.context,Et=M.contextType,typeof Et=="object"&&Et!==null?Et=Yi(Et):(Et=Jn(M)?Er:on.current,Et=Bs(_,Et));var Zn=M.getDerivedStateFromProps;(fn=typeof Zn=="function"||typeof Ae.getSnapshotBeforeUpdate=="function")||typeof Ae.UNSAFE_componentWillReceiveProps!="function"&&typeof Ae.componentWillReceiveProps!="function"||(je!==pr||gn!==Et)&&Lr(_,Ae,L,Et),id=!1,gn=_.memoizedState,Ae.state=gn,nt(_,L,Ae,H);var bn=_.memoizedState;je!==pr||gn!==bn||qi.current||id?(typeof Zn=="function"&&(Gt(_,M,Zn,L),bn=_.memoizedState),(qt=id||js(_,M,qt,L,gn,bn,Et)||!1)?(fn||typeof Ae.UNSAFE_componentWillUpdate!="function"&&typeof Ae.componentWillUpdate!="function"||(typeof Ae.componentWillUpdate=="function"&&Ae.componentWillUpdate(L,bn,Et),typeof Ae.UNSAFE_componentWillUpdate=="function"&&Ae.UNSAFE_componentWillUpdate(L,bn,Et)),typeof Ae.componentDidUpdate=="function"&&(_.flags|=4),typeof Ae.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof Ae.componentDidUpdate!="function"||je===m.memoizedProps&&gn===m.memoizedState||(_.flags|=4),typeof Ae.getSnapshotBeforeUpdate!="function"||je===m.memoizedProps&&gn===m.memoizedState||(_.flags|=1024),_.memoizedProps=L,_.memoizedState=bn),Ae.props=L,Ae.state=bn,Ae.context=Et,L=qt):(typeof Ae.componentDidUpdate!="function"||je===m.memoizedProps&&gn===m.memoizedState||(_.flags|=4),typeof Ae.getSnapshotBeforeUpdate!="function"||je===m.memoizedProps&&gn===m.memoizedState||(_.flags|=1024),L=!1)}return G_(m,_,M,L,ee,H)}function G_(m,_,M,L,H,ee){Qg(m,_);var Ae=(_.flags&128)!==0;if(!L&&!Ae)return H&&Fl(_,M,!1),ga(m,_,ee);L=_.stateNode,Yg.current=_;var je=Ae&&typeof M.getDerivedStateFromError!="function"?null:L.render();return _.flags|=1,m!==null&&Ae?(_.child=lo(_,m.child,null,ee),_.child=lo(_,null,je,ee)):Ko(m,_,je,ee),_.memoizedState=L.state,H&&Fl(_,M,!0),_.child}function Tf(m){var _=m.stateNode;_.pendingContext?Ul(m,_.pendingContext,_.pendingContext!==_.context):_.context&&Ul(m,_.context,!1),hs(m,_.containerInfo)}function dd(m,_,M,L,H){return pc(),th(H),_.flags|=256,Ko(m,_,M,L),_.child}var Ru={dehydrated:null,treeContext:null,retryLane:0};function Kl(m){return{baseLanes:m,cachePool:null}}function Yo(m,_,M){var L=_.pendingProps,H=Ai.current,ee=!1,Ae=(_.flags&128)!==0,je;if((je=Ae)||(je=m!==null&&m.memoizedState===null?!1:(H&2)!==0),je?(ee=!0,_.flags&=-129):(m===null||m.memoizedState!==null)&&(H|=1),jn(Ai,H&1),m===null)return Su(_),m=_.memoizedState,m!==null&&(m=m.dehydrated,m!==null)?(_.mode&1?tn(m)?_.lanes=8:_.lanes=1073741824:_.lanes=1,null):(H=L.children,m=L.fallback,ee?(L=_.mode,ee=_.child,H={mode:"hidden",children:H},!(L&1)&&ee!==null?(ee.childLanes=0,ee.pendingProps=H):ee=zi(H,L,0,null),m=ya(m,L,M,null),ee.return=_,m.return=_,ee.sibling=m,_.child=ee,_.child.memoizedState=Kl(M),_.memoizedState=Ru,m):Yl(_,H));if(H=m.memoizedState,H!==null){if(je=H.dehydrated,je!==null){if(Ae)return _.flags&256?(_.flags&=-257,lm(m,_,M,Error(o(422)))):_.memoizedState!==null?(_.child=m.child,_.flags|=128,null):(ee=L.fallback,H=_.mode,L=zi({mode:"visible",children:L.children},H,0,null),ee=ya(ee,H,M,null),ee.flags|=2,L.return=_,ee.return=_,L.sibling=ee,_.child=L,_.mode&1&&lo(_,m.child,null,M),_.child.memoizedState=Kl(M),_.memoizedState=Ru,ee);if(!(_.mode&1))_=lm(m,_,M,null);else if(tn(je))_=lm(m,_,M,Error(o(419)));else if(L=(M&m.childLanes)!==0,za||L){if(L=ps,L!==null){switch(M&-M){case 4:ee=2;break;case 16:ee=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ee=32;break;case 536870912:ee=268435456;break;default:ee=0}L=ee&(L.suspendedLanes|M)?0:ee,L!==0&&L!==H.retryLane&&(H.retryLane=L,va(m,L,-1))}gd(),_=lm(m,_,M,Error(o(421)))}else dn(je)?(_.flags|=128,_.child=m.child,_=Ff.bind(null,m),Cn(je,_),_=null):(M=H.treeContext,rt&&(zo=ii(je),fc=_,gi=!0,Pc=null,Nc=!1,M!==null&&(Ys[Xs++]=Gr,Ys[Xs++]=kc,Ys[Xs++]=Gl,Gr=M.id,kc=M.overflow,Gl=_)),_=Yl(_,_.pendingProps.children),_.flags|=4096);return _}return ee?(L=Zg(m,_,L.children,L.fallback,M),ee=_.child,H=m.child.memoizedState,ee.memoizedState=H===null?Kl(M):{baseLanes:H.baseLanes|M,cachePool:null},ee.childLanes=m.childLanes&~M,_.memoizedState=Ru,L):(M=hd(m,_,L.children,M),_.memoizedState=null,M)}return ee?(L=Zg(m,_,L.children,L.fallback,M),ee=_.child,H=m.child.memoizedState,ee.memoizedState=H===null?Kl(M):{baseLanes:H.baseLanes|M,cachePool:null},ee.childLanes=m.childLanes&~M,_.memoizedState=Ru,L):(M=hd(m,_,L.children,M),_.memoizedState=null,M)}function Yl(m,_){return _=zi({mode:"visible",children:_},m.mode,0,null),_.return=m,m.child=_}function hd(m,_,M,L){var H=m.child;return m=H.sibling,M=Zo(H,{mode:"visible",children:M}),!(_.mode&1)&&(M.lanes=L),M.return=_,M.sibling=null,m!==null&&(L=_.deletions,L===null?(_.deletions=[m],_.flags|=16):L.push(m)),_.child=M}function Zg(m,_,M,L,H){var ee=_.mode;m=m.child;var Ae=m.sibling,je={mode:"hidden",children:M};return!(ee&1)&&_.child!==m?(M=_.child,M.childLanes=0,M.pendingProps=je,_.deletions=null):(M=Zo(m,je),M.subtreeFlags=m.subtreeFlags&14680064),Ae!==null?L=Zo(Ae,L):(L=ya(L,ee,H,null),L.flags|=2),L.return=_,M.return=_,M.sibling=L,_.child=M,L}function lm(m,_,M,L){return L!==null&&th(L),lo(_,m.child,null,M),m=Yl(_,_.pendingProps.children),m.flags|=2,_.memoizedState=null,m}function wf(m,_,M){m.lanes|=_;var L=m.alternate;L!==null&&(L.lanes|=_),Jd(m.return,_,M)}function ma(m,_,M,L,H){var ee=m.memoizedState;ee===null?m.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:L,tail:M,tailMode:H}:(ee.isBackwards=_,ee.rendering=null,ee.renderingStartTime=0,ee.last=L,ee.tail=M,ee.tailMode=H)}function Au(m,_,M){var L=_.pendingProps,H=L.revealOrder,ee=L.tail;if(Ko(m,_,L.children,M),L=Ai.current,L&2)L=L&1|2,_.flags|=128;else{if(m!==null&&m.flags&128)e:for(m=_.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&wf(m,M,_);else if(m.tag===19)wf(m,M,_);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===_)break e;for(;m.sibling===null;){if(m.return===null||m.return===_)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}L&=1}if(jn(Ai,L),!(_.mode&1))_.memoizedState=null;else switch(H){case"forwards":for(M=_.child,H=null;M!==null;)m=M.alternate,m!==null&&nh(m)===null&&(H=M),M=M.sibling;M=H,M===null?(H=_.child,_.child=null):(H=M.sibling,M.sibling=null),ma(_,!1,H,M,ee);break;case"backwards":for(M=null,H=_.child,_.child=null;H!==null;){if(m=H.alternate,m!==null&&nh(m)===null){_.child=H;break}m=H.sibling,H.sibling=M,M=H,H=m}ma(_,!0,M,null,ee);break;case"together":ma(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function ga(m,_,M){if(m!==null&&(_.dependencies=m.dependencies),Ga|=_.lanes,!(M&_.childLanes))return null;if(m!==null&&_.child!==m.child)throw Error(o(153));if(_.child!==null){for(m=_.child,M=Zo(m,m.pendingProps),_.child=M,M.return=_;m.sibling!==null;)m=m.sibling,M=M.sibling=Zo(m,m.pendingProps),M.return=_;M.sibling=null}return _.child}function jy(m,_,M){switch(_.tag){case 3:Tf(_),pc();break;case 5:mc(_);break;case 1:Jn(_.type)&&Co(_);break;case 4:hs(_,_.stateNode.containerInfo);break;case 10:Ly(_,_.type._context,_.memoizedProps.value);break;case 13:var L=_.memoizedState;if(L!==null)return L.dehydrated!==null?(jn(Ai,Ai.current&1),_.flags|=128,null):M&_.child.childLanes?Yo(m,_,M):(jn(Ai,Ai.current&1),m=ga(m,_,M),m!==null?m.sibling:null);jn(Ai,Ai.current&1);break;case 19:if(L=(M&_.childLanes)!==0,m.flags&128){if(L)return Au(m,_,M);_.flags|=128}var H=_.memoizedState;if(H!==null&&(H.rendering=null,H.tail=null,H.lastEffect=null),jn(Ai,Ai.current),L)break;return null;case 22:case 23:return _.lanes=0,Jg(m,_,M)}return ga(m,_,M)}function ev(m,_){switch(B_(_),_.tag){case 1:return Jn(_.type)&&lr(),m=_.flags,m&65536?(_.flags=m&-65537|128,_):null;case 3:return Qn(),En(qi),En(on),Lt(),m=_.flags,m&65536&&!(m&128)?(_.flags=m&-65537|128,_):null;case 5:return uo(_),null;case 13:if(En(Ai),m=_.memoizedState,m!==null&&m.dehydrated!==null){if(_.alternate===null)throw Error(o(340));pc()}return m=_.flags,m&65536?(_.flags=m&-65537|128,_):null;case 19:return En(Ai),null;case 4:return Qn(),null;case 10:return Eu(_.type._context),null;case 22:case 23:return Uf(),null;case 24:return null;default:return null}}var oh=!1,Mu=!1,um=typeof WeakSet=="function"?WeakSet:Set,rn=null;function ah(m,_){var M=m.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(L){Wa(m,_,L)}else M.current=null}function hl(m,_,M){try{M()}catch(L){Wa(m,_,L)}}var $y=!1;function Mo(m,_){for(Q(m.containerInfo),rn=_;rn!==null;)if(m=rn,_=m.child,(m.subtreeFlags&1028)!==0&&_!==null)_.return=m,rn=_;else for(;rn!==null;){m=rn;try{var M=m.alternate;if(m.flags&1024)switch(m.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var L=M.memoizedProps,H=M.memoizedState,ee=m.stateNode,Ae=ee.getSnapshotBeforeUpdate(m.elementType===m.type?L:si(m.type,L),H);ee.__reactInternalSnapshotBeforeUpdate=Ae}break;case 3:fe&&Ct(m.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(je){Wa(m,m.return,je)}if(_=m.sibling,_!==null){_.return=m.return,rn=_;break}rn=m.return}return M=$y,$y=!1,M}function Iu(m,_,M){var L=_.updateQueue;if(L=L!==null?L.lastEffect:null,L!==null){var H=L=L.next;do{if((H.tag&m)===m){var ee=H.destroy;H.destroy=void 0,ee!==void 0&&hl(_,M,ee)}H=H.next}while(H!==L)}}function ch(m,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var M=_=_.next;do{if((M.tag&m)===m){var L=M.create;M.destroy=L()}M=M.next}while(M!==_)}}function xf(m){var _=m.ref;if(_!==null){var M=m.stateNode;switch(m.tag){case 5:m=Z(M);break;default:m=M}typeof _=="function"?_(m):_.current=m}}function tv(m,_,M){if(tl&&typeof tl.onCommitFiberUnmount=="function")try{tl.onCommitFiberUnmount(zp,_)}catch{}switch(_.tag){case 0:case 11:case 14:case 15:if(m=_.updateQueue,m!==null&&(m=m.lastEffect,m!==null)){var L=m=m.next;do{var H=L,ee=H.destroy;H=H.tag,ee!==void 0&&(H&2||H&4)&&hl(_,M,ee),L=L.next}while(L!==m)}break;case 1:if(ah(_,M),m=_.stateNode,typeof m.componentWillUnmount=="function")try{m.props=_.memoizedProps,m.state=_.memoizedState,m.componentWillUnmount()}catch(Ae){Wa(_,M,Ae)}break;case 5:ah(_,M);break;case 4:fe?W_(m,_,M):ge&&ge&&(_=_.stateNode.containerInfo,M=Jt(_),Tt(_,M))}}function Cf(m,_,M){for(var L=_;;)if(tv(m,L,M),L.child===null||fe&&L.tag===4){if(L===_)break;for(;L.sibling===null;){if(L.return===null||L.return===_)return;L=L.return}L.sibling.return=L.return,L=L.sibling}else L.child.return=L,L=L.child}function lh(m){var _=m.alternate;_!==null&&(m.alternate=null,lh(_)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(_=m.stateNode,_!==null&&kt(_)),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function Rf(m){return m.tag===5||m.tag===3||m.tag===4}function Xo(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||Rf(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function fl(m){if(fe){e:{for(var _=m.return;_!==null;){if(Rf(_))break e;_=_.return}throw Error(o(160))}var M=_;switch(M.tag){case 5:_=M.stateNode,M.flags&32&&(bt(_),M.flags&=-33),M=Xo(m),fd(m,M,_);break;case 3:case 4:_=M.stateNode.containerInfo,M=Xo(m),Af(m,M,_);break;default:throw Error(o(161))}}}function Af(m,_,M){var L=m.tag;if(L===5||L===6)m=m.stateNode,_?Ne(M,m,_):jt(M,m);else if(L!==4&&(m=m.child,m!==null))for(Af(m,_,M),m=m.sibling;m!==null;)Af(m,_,M),m=m.sibling}function fd(m,_,M){var L=m.tag;if(L===5||L===6)m=m.stateNode,_?pe(M,m,_):xt(M,m);else if(L!==4&&(m=m.child,m!==null))for(fd(m,_,M),m=m.sibling;m!==null;)fd(m,_,M),m=m.sibling}function W_(m,_,M){for(var L=_,H=!1,ee,Ae;;){if(!H){H=L.return;e:for(;;){if(H===null)throw Error(o(160));switch(ee=H.stateNode,H.tag){case 5:Ae=!1;break e;case 3:ee=ee.containerInfo,Ae=!0;break e;case 4:ee=ee.containerInfo,Ae=!0;break e}H=H.return}H=!0}if(L.tag===5||L.tag===6)Cf(m,L,M),Ae?dt(ee,L.stateNode):Fe(ee,L.stateNode);else if(L.tag===18)Ae?pt(ee,L.stateNode):Ke(ee,L.stateNode);else if(L.tag===4){if(L.child!==null){ee=L.stateNode.containerInfo,Ae=!0,L.child.return=L,L=L.child;continue}}else if(tv(m,L,M),L.child!==null){L.child.return=L,L=L.child;continue}if(L===_)break;for(;L.sibling===null;){if(L.return===null||L.return===_)return;L=L.return,L.tag===4&&(H=!1)}L.sibling.return=L.return,L=L.sibling}}function nv(m,_){if(fe){switch(_.tag){case 0:case 11:case 14:case 15:Iu(3,_,_.return),ch(3,_),Iu(5,_,_.return);return;case 1:return;case 5:var M=_.stateNode;if(M!=null){var L=_.memoizedProps;m=m!==null?m.memoizedProps:L;var H=_.type,ee=_.updateQueue;_.updateQueue=null,ee!==null&&V(M,ee,H,m,L,_)}return;case 6:if(_.stateNode===null)throw Error(o(162));M=_.memoizedProps,ae(_.stateNode,m!==null?m.memoizedProps:M,M);return;case 3:rt&&m!==null&&m.memoizedState.isDehydrated&&cf(_.stateNode.containerInfo);return;case 12:return;case 13:dm(_);return;case 19:dm(_);return;case 17:return}throw Error(o(163))}switch(_.tag){case 0:case 11:case 14:case 15:Iu(3,_,_.return),ch(3,_),Iu(5,_,_.return);return;case 12:return;case 13:dm(_);return;case 19:dm(_);return;case 3:rt&&m!==null&&m.memoizedState.isDehydrated&&cf(_.stateNode.containerInfo);break;case 22:case 23:return}e:if(ge){switch(_.tag){case 1:case 5:case 6:break e;case 3:case 4:_=_.stateNode,Tt(_.containerInfo,_.pendingChildren);break e}throw Error(o(163))}}function dm(m){var _=m.updateQueue;if(_!==null){m.updateQueue=null;var M=m.stateNode;M===null&&(M=m.stateNode=new um),_.forEach(function(L){var H=Em.bind(null,m,L);M.has(L)||(M.add(L),L.then(H,H))})}}function uh(m,_){for(rn=_;rn!==null;){_=rn;var M=_.deletions;if(M!==null)for(var L=0;L<M.length;L++){var H=M[L];try{var ee=m;fe?W_(ee,H,_):Cf(ee,H,_);var Ae=H.alternate;Ae!==null&&(Ae.return=null),H.return=null}catch(yn){Wa(H,_,yn)}}if(M=_.child,_.subtreeFlags&12854&&M!==null)M.return=_,rn=M;else for(;rn!==null;){_=rn;try{var je=_.flags;if(je&32&&fe&&bt(_.stateNode),je&512){var Et=_.alternate;if(Et!==null){var qt=Et.ref;qt!==null&&(typeof qt=="function"?qt(null):qt.current=null)}}if(je&8192)switch(_.tag){case 13:if(_.memoizedState!==null){var fn=_.alternate;(fn===null||fn.memoizedState===null)&&(iv=wr())}break;case 22:var pr=_.memoizedState!==null,gn=_.alternate,Zn=gn!==null&&gn.memoizedState!==null;if(M=_,fe){e:if(L=M,H=pr,ee=null,fe)for(var bn=L;;){if(bn.tag===5){if(ee===null){ee=bn;var ea=bn.stateNode;H?Dn(ea):Dt(bn.stateNode,bn.memoizedProps)}}else if(bn.tag===6){if(ee===null){var Rr=bn.stateNode;H?Ue(Rr):st(Rr,bn.memoizedProps)}}else if((bn.tag!==22&&bn.tag!==23||bn.memoizedState===null||bn===L)&&bn.child!==null){bn.child.return=bn,bn=bn.child;continue}if(bn===L)break;for(;bn.sibling===null;){if(bn.return===null||bn.return===L)break e;ee===bn&&(ee=null),bn=bn.return}ee===bn&&(ee=null),bn.sibling.return=bn.return,bn=bn.sibling}}if(pr&&!Zn&&M.mode&1){rn=M;for(var Ve=M.child;Ve!==null;){for(M=rn=Ve;rn!==null;){L=rn;var Je=L.child;switch(L.tag){case 0:case 11:case 14:case 15:Iu(4,L,L.return);break;case 1:ah(L,L.return);var ut=L.stateNode;if(typeof ut.componentWillUnmount=="function"){var Ht=L.return;try{ut.props=L.memoizedProps,ut.state=L.memoizedState,ut.componentWillUnmount()}catch(yn){Wa(L,Ht,yn)}}break;case 5:ah(L,L.return);break;case 22:if(L.memoizedState!==null){fm(M);continue}}Je!==null?(Je.return=L,rn=Je):fm(M)}Ve=Ve.sibling}}}switch(je&4102){case 2:fl(_),_.flags&=-3;break;case 6:fl(_),_.flags&=-3,nv(_.alternate,_);break;case 4096:_.flags&=-4097;break;case 4100:_.flags&=-4097,nv(_.alternate,_);break;case 4:nv(_.alternate,_)}}catch(yn){Wa(_,_.return,yn)}if(M=_.sibling,M!==null){M.return=_.return,rn=M;break}rn=_.return}}}function hm(m,_,M){rn=m,q_(m)}function q_(m,_,M){for(var L=(m.mode&1)!==0;rn!==null;){var H=rn,ee=H.child;if(H.tag===22&&L){var Ae=H.memoizedState!==null||oh;if(!Ae){var je=H.alternate,Et=je!==null&&je.memoizedState!==null||Mu;je=oh;var qt=Mu;if(oh=Ae,(Mu=Et)&&!qt)for(rn=H;rn!==null;)Ae=rn,Et=Ae.child,Ae.tag===22&&Ae.memoizedState!==null?K_(H):Et!==null?(Et.return=Ae,rn=Et):K_(H);for(;ee!==null;)rn=ee,q_(ee),ee=ee.sibling;rn=H,oh=je,Mu=qt}rv(m)}else H.subtreeFlags&8772&&ee!==null?(ee.return=H,rn=ee):rv(m)}}function rv(m){for(;rn!==null;){var _=rn;if(_.flags&8772){var M=_.alternate;try{if(_.flags&8772)switch(_.tag){case 0:case 11:case 15:Mu||ch(5,_);break;case 1:var L=_.stateNode;if(_.flags&4&&!Mu)if(M===null)L.componentDidMount();else{var H=_.elementType===_.type?M.memoizedProps:si(_.type,M.memoizedProps);L.componentDidUpdate(H,M.memoizedState,L.__reactInternalSnapshotBeforeUpdate)}var ee=_.updateQueue;ee!==null&&Mt(_,ee,L);break;case 3:var Ae=_.updateQueue;if(Ae!==null){if(M=null,_.child!==null)switch(_.child.tag){case 5:M=Z(_.child.stateNode);break;case 1:M=_.child.stateNode}Mt(_,Ae,M)}break;case 5:var je=_.stateNode;M===null&&_.flags&4&&j(je,_.type,_.memoizedProps,_);break;case 6:break;case 4:break;case 12:break;case 13:if(rt&&_.memoizedState===null){var Et=_.alternate;if(Et!==null){var qt=Et.memoizedState;if(qt!==null){var fn=qt.dehydrated;fn!==null&&ye(fn)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}Mu||_.flags&512&&xf(_)}catch(pr){Wa(_,_.return,pr)}}if(_===m){rn=null;break}if(M=_.sibling,M!==null){M.return=_.return,rn=M;break}rn=_.return}}function fm(m){for(;rn!==null;){var _=rn;if(_===m){rn=null;break}var M=_.sibling;if(M!==null){M.return=_.return,rn=M;break}rn=_.return}}function K_(m){for(;rn!==null;){var _=rn;try{switch(_.tag){case 0:case 11:case 15:var M=_.return;try{ch(4,_)}catch(Et){Wa(_,M,Et)}break;case 1:var L=_.stateNode;if(typeof L.componentDidMount=="function"){var H=_.return;try{L.componentDidMount()}catch(Et){Wa(_,H,Et)}}var ee=_.return;try{xf(_)}catch(Et){Wa(_,ee,Et)}break;case 5:var Ae=_.return;try{xf(_)}catch(Et){Wa(_,Ae,Et)}}}catch(Et){Wa(_,_.return,Et)}if(_===m){rn=null;break}var je=_.sibling;if(je!==null){je.return=_.return,rn=je;break}rn=_.return}}var dh=0,Mf=1,hh=2,pm=3,fh=4;if(typeof Symbol=="function"&&Symbol.for){var If=Symbol.for;dh=If("selector.component"),Mf=If("selector.has_pseudo_class"),hh=If("selector.role"),pm=If("selector.test_id"),fh=If("selector.text")}function Of(m){var _=Re(m);if(_!=null){if(typeof _.memoizedProps["data-testname"]!="string")throw Error(o(364));return _}if(m=Ce(m),m===null)throw Error(o(362));return m.stateNode.current}function Y_(m,_){switch(_.$$typeof){case dh:if(m.type===_.value)return!0;break;case Mf:e:{_=_.value,m=[m,0];for(var M=0;M<m.length;){var L=m[M++],H=m[M++],ee=_[H];if(L.tag!==5||!yt(L)){for(;ee!=null&&Y_(L,ee);)H++,ee=_[H];if(H===_.length){_=!0;break e}else for(L=L.child;L!==null;)m.push(L,H),L=L.sibling}}_=!1}return _;case hh:if(m.tag===5&&We(m.stateNode,_.value))return!0;break;case fh:if((m.tag===5||m.tag===6)&&(m=tt(m),m!==null&&0<=m.indexOf(_.value)))return!0;break;case pm:if(m.tag===5&&(m=m.memoizedProps["data-testname"],typeof m=="string"&&m.toLowerCase()===_.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function mm(m){switch(m.$$typeof){case dh:return"<"+(N(m.value)||"Unknown")+">";case Mf:return":has("+(mm(m)||"")+")";case hh:return'[role="'+m.value+'"]';case fh:return'"'+m.value+'"';case pm:return'[data-testname="'+m.value+'"]';default:throw Error(o(365))}}function _c(m,_){var M=[];m=[m,0];for(var L=0;L<m.length;){var H=m[L++],ee=m[L++],Ae=_[ee];if(H.tag!==5||!yt(H)){for(;Ae!=null&&Y_(H,Ae);)ee++,Ae=_[ee];if(ee===_.length)M.push(H);else for(H=H.child;H!==null;)m.push(H,ee),H=H.sibling}}return M}function yc(m,_){if(!$t)throw Error(o(363));m=Of(m),m=_c(m,_),_=[],m=Array.from(m);for(var M=0;M<m.length;){var L=m[M++];if(L.tag===5)yt(L)||_.push(L.stateNode);else for(L=L.child;L!==null;)m.push(L),L=L.sibling}return _}var bc=Math.ceil,wi=a.ReactCurrentDispatcher,gm=a.ReactCurrentOwner,xi=a.ReactCurrentBatchConfig,Cr=0,ps=null,ms=null,zs=0,Zs=0,kn=Vr(0),gs=0,In=null,Ga=0,pd=0,vm=0,as=null,Jo=null,iv=0,_m=1/0;function Ii(){_m=wr()+500}var eo=!1,kf=null,Xl=null,sv=!1,Dc=null,ym=0,Nf=0,md=null,Pf=-1,ph=0;function Di(){return Cr&6?wr():Pf!==-1?Pf:Pf=wr()}function Ec(m){return m.mode&1?Cr&2&&zs!==0?zs&-zs:U_.transition!==null?(ph===0&&(m=gr,gr<<=1,!(gr&4194240)&&(gr=64),ph=m),ph):(m=ur,m!==0?m:Ge()):1}function va(m,_,M){if(50<Nf)throw Nf=0,md=null,Error(o(185));var L=vs(m,_);return L===null?null:(nd(L,_,M),(!(Cr&2)||L!==ps)&&(L===ps&&(!(Cr&2)&&(pd|=_),gs===4&&Ou(L,zs)),to(L,M),_===1&&Cr===0&&!(m.mode&1)&&(Ii(),Gp&&dc())),L)}function vs(m,_){m.lanes|=_;var M=m.alternate;for(M!==null&&(M.lanes|=_),M=m,m=m.return;m!==null;)m.childLanes|=_,M=m.alternate,M!==null&&(M.childLanes|=_),M=m,m=m.return;return M.tag===3?M.stateNode:null}function to(m,_){var M=m.callbackNode;bu(m,_);var L=Xd(m,m===ps?zs:0);if(L===0)M!==null&&jl(M),m.callbackNode=null,m.callbackPriority=0;else if(_=L&-L,m.callbackPriority!==_){if(M!=null&&jl(M),_===1)m.tag===0?Dy(Lf.bind(null,m)):Fg(Lf.bind(null,m)),Bt?He(function(){Cr===0&&dc()}):Pg($l,dc),M=null;else{switch(Py(L)){case 1:M=$l;break;case 4:M=L_;break;case 16:M=Dg;break;case 536870912:M=Lg;break;default:M=Dg}M=zy(M,Df.bind(null,m))}m.callbackPriority=_,m.callbackNode=M}}function Df(m,_){if(Pf=-1,ph=0,Cr&6)throw Error(o(327));var M=m.callbackNode;if(Ir()&&m.callbackNode!==M)return null;var L=Xd(m,m===ps?zs:0);if(L===0)return null;if(L&30||L&m.expiredLanes||_)_=gh(m,L);else{_=L;var H=Cr;Cr|=2;var ee=X_();(ps!==m||zs!==_)&&(Ii(),Vi(m,_));do try{Qo();break}catch(je){pl(m,je)}while(!0);hf(),wi.current=ee,Cr=H,ms!==null?_=0:(ps=null,zs=0,_=gs)}if(_!==0){if(_===2&&(H=$p(m),H!==0&&(L=H,_=bm(m,H))),_===1)throw M=In,Vi(m,0),Ou(m,L),to(m,wr()),M;if(_===6)Ou(m,L);else{if(H=m.current.alternate,!(L&30)&&!mh(H)&&(_=gh(m,L),_===2&&(ee=$p(m),ee!==0&&(L=ee,_=bm(m,ee))),_===1))throw M=In,Vi(m,0),Ou(m,L),to(m,wr()),M;switch(m.finishedWork=H,m.finishedLanes=L,_){case 0:case 1:throw Error(o(345));case 2:vd(m,Jo);break;case 3:if(Ou(m,L),(L&130023424)===L&&(_=iv+500-wr(),10<_)){if(Xd(m,0)!==0)break;if(H=m.suspendedLanes,(H&L)!==L){Di(),m.pingedLanes|=m.suspendedLanes&H;break}m.timeoutHandle=Se(vd.bind(null,m,Jo),_);break}vd(m,Jo);break;case 4:if(Ou(m,L),(L&4194240)===L)break;for(_=m.eventTimes,H=-1;0<L;){var Ae=31-Ki(L);ee=1<<Ae,Ae=_[Ae],Ae>H&&(H=Ae),L&=~ee}if(L=H,L=wr()-L,L=(120>L?120:480>L?480:1080>L?1080:1920>L?1920:3e3>L?3e3:4320>L?4320:1960*bc(L/1960))-L,10<L){m.timeoutHandle=Se(vd.bind(null,m,Jo),L);break}vd(m,Jo);break;case 5:vd(m,Jo);break;default:throw Error(o(329))}}}return to(m,wr()),m.callbackNode===M?Df.bind(null,m):null}function bm(m,_){var M=as;return m.current.memoizedState.isDehydrated&&(Vi(m,_).flags|=256),m=gh(m,_),m!==2&&(_=Jo,Jo=M,_!==null&&Lc(_)),m}function Lc(m){Jo===null?Jo=m:Jo.push.apply(Jo,m)}function mh(m){for(var _=m;;){if(_.flags&16384){var M=_.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var L=0;L<M.length;L++){var H=M[L],ee=H.getSnapshot;H=H.value;try{if(!Hl(ee(),H))return!1}catch{return!1}}}if(M=_.child,_.subtreeFlags&16384&&M!==null)M.return=_,_=M;else{if(_===m)break;for(;_.sibling===null;){if(_.return===null||_.return===m)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Ou(m,_){for(_&=~vm,_&=~pd,m.suspendedLanes|=_,m.pingedLanes&=~_,m=m.expirationTimes;0<_;){var M=31-Ki(_),L=1<<M;m[M]=-1,_&=~L}}function Lf(m){if(Cr&6)throw Error(o(327));Ir();var _=Xd(m,0);if(!(_&1))return to(m,wr()),null;var M=gh(m,_);if(m.tag!==0&&M===2){var L=$p(m);L!==0&&(_=L,M=bm(m,L))}if(M===1)throw M=In,Vi(m,0),Ou(m,_),to(m,wr()),M;if(M===6)throw Error(o(345));return m.finishedWork=m.current.alternate,m.finishedLanes=_,vd(m,Jo),to(m,wr()),null}function no(m){Dc!==null&&Dc.tag===0&&!(Cr&6)&&Ir();var _=Cr;Cr|=1;var M=xi.transition,L=ur;try{if(xi.transition=null,ur=1,m)return m()}finally{ur=L,xi.transition=M,Cr=_,!(Cr&6)&&dc()}}function Uf(){Zs=kn.current,En(kn)}function Vi(m,_){m.finishedWork=null,m.finishedLanes=0;var M=m.timeoutHandle;if(M!==Ze&&(m.timeoutHandle=Ze,Ie(M)),ms!==null)for(M=ms.return;M!==null;){var L=M;switch(B_(L),L.tag){case 1:L=L.type.childContextTypes,L!=null&&lr();break;case 3:Qn(),En(qi),En(on),Lt();break;case 5:uo(L);break;case 4:Qn();break;case 13:En(Ai);break;case 19:En(Ai);break;case 10:Eu(L.type._context);break;case 22:case 23:Uf()}M=M.return}if(ps=m,ms=m=Zo(m.current,null),zs=Zs=_,gs=0,In=null,vm=pd=Ga=0,Jo=as=null,$a!==null){for(_=0;_<$a.length;_++)if(M=$a[_],L=M.interleaved,L!==null){M.interleaved=null;var H=L.next,ee=M.pending;if(ee!==null){var Ae=ee.next;ee.next=H,L.next=Ae}M.pending=L}$a=null}return m}function pl(m,_){do{var M=ms;try{if(hf(),Os.current=Va,mf){for(var L=Pi.memoizedState;L!==null;){var H=L.queue;H!==null&&(H.pending=null),L=L.next}mf=!1}if(gc=0,ks=os=Pi=null,tm=!1,Tu=0,gm.current=null,M===null||M.return===null){gs=1,In=_,ms=null;break}e:{var ee=m,Ae=M.return,je=M,Et=_;if(_=zs,je.flags|=32768,Et!==null&&typeof Et=="object"&&typeof Et.then=="function"){var qt=Et,fn=je,pr=fn.tag;if(!(fn.mode&1)&&(pr===0||pr===11||pr===15)){var gn=fn.alternate;gn?(fn.updateQueue=gn.updateQueue,fn.memoizedState=gn.memoizedState,fn.lanes=gn.lanes):(fn.updateQueue=null,fn.memoizedState=null)}var Zn=ql(Ae);if(Zn!==null){Zn.flags&=-257,sm(Zn,Ae,je,ee,_),Zn.mode&1&&qg(ee,qt,_),_=Zn,Et=qt;var bn=_.updateQueue;if(bn===null){var ea=new Set;ea.add(Et),_.updateQueue=ea}else bn.add(Et);break e}else{if(!(_&1)){qg(ee,qt,_),gd();break e}Et=Error(o(426))}}else if(gi&&je.mode&1){var Rr=ql(Ae);if(Rr!==null){!(Rr.flags&65536)&&(Rr.flags|=256),sm(Rr,Ae,je,ee,_),th(Et);break e}}ee=Et,gs!==4&&(gs=2),as===null?as=[ee]:as.push(ee),Et=Cu(Et,je),je=Ae;do{switch(je.tag){case 3:je.flags|=65536,_&=-_,je.lanes|=_;var Ve=yf(je,Et,_);ot(je,Ve);break e;case 1:ee=Et;var Je=je.type,ut=je.stateNode;if(!(je.flags&128)&&(typeof Je.getDerivedStateFromError=="function"||ut!==null&&typeof ut.componentDidCatch=="function"&&(Xl===null||!Xl.has(ut)))){je.flags|=65536,_&=-_,je.lanes|=_;var Ht=sh(je,ee,_);ot(je,Ht);break e}}je=je.return}while(je!==null)}ov(M)}catch(yn){_=yn,ms===M&&M!==null&&(ms=M=M.return);continue}break}while(!0)}function X_(){var m=wi.current;return wi.current=Va,m===null?Va:m}function gd(){(gs===0||gs===3||gs===2)&&(gs=4),ps===null||!(Ga&268435455)&&!(pd&268435455)||Ou(ps,zs)}function gh(m,_){var M=Cr;Cr|=2;var L=X_();ps===m&&zs===_||Vi(m,_);do try{_a();break}catch(H){pl(m,H)}while(!0);if(hf(),Cr=M,wi.current=L,ms!==null)throw Error(o(261));return ps=null,zs=0,gs}function _a(){for(;ms!==null;)mo(ms)}function Qo(){for(;ms!==null&&!Vp();)mo(ms)}function mo(m){var _=Vy(m.alternate,m,Zs);m.memoizedProps=m.pendingProps,_===null?ov(m):ms=_,gm.current=null}function ov(m){var _=m;do{var M=_.alternate;if(m=_.return,_.flags&32768){if(M=ev(M,_),M!==null){M.flags&=32767,ms=M;return}if(m!==null)m.flags|=32768,m.subtreeFlags=0,m.deletions=null;else{gs=6,ms=null;return}}else if(M=H_(M,_,Zs),M!==null){ms=M;return}if(_=_.sibling,_!==null){ms=_;return}ms=_=m}while(_!==null);gs===0&&(gs=5)}function vd(m,_){var M=ur,L=xi.transition;try{xi.transition=null,ur=1,ku(m,_,M)}finally{xi.transition=L,ur=M}return null}function ku(m,_,M){do Ir();while(Dc!==null);if(Cr&6)throw Error(o(327));var L=m.finishedWork,H=m.finishedLanes;if(L===null)return null;if(m.finishedWork=null,m.finishedLanes=0,L===m.current)throw Error(o(177));m.callbackNode=null,m.callbackPriority=0;var ee=L.lanes|L.childLanes;if(ha(m,ee),m===ps&&(ms=ps=null,zs=0),!(L.subtreeFlags&2064)&&!(L.flags&2064)||sv||(sv=!0,zy(Dg,function(){return Ir(),null})),ee=(L.flags&15990)!==0,L.subtreeFlags&15990||ee){ee=xi.transition,xi.transition=null;var Ae=ur;ur=1;var je=Cr;Cr|=4,gm.current=null,Mo(m,L),uh(m,L),se(m.containerInfo),m.current=L,hm(L),rd(),Cr=je,ur=Ae,xi.transition=ee}else m.current=L;if(sv&&(sv=!1,Dc=m,ym=H),ee=m.pendingLanes,ee===0&&(Xl=null),Ug(L.stateNode),to(m,wr()),_!==null)for(M=m.onRecoverableError,L=0;L<_.length;L++)M(_[L]);if(eo)throw eo=!1,m=kf,kf=null,m;return ym&1&&m.tag!==0&&Ir(),ee=m.pendingLanes,ee&1?m===md?Nf++:(Nf=0,md=m):Nf=0,dc(),null}function Ir(){if(Dc!==null){var m=Py(ym),_=xi.transition,M=ur;try{if(xi.transition=null,ur=16>m?16:m,Dc===null)var L=!1;else{if(m=Dc,Dc=null,ym=0,Cr&6)throw Error(o(331));var H=Cr;for(Cr|=4,rn=m.current;rn!==null;){var ee=rn,Ae=ee.child;if(rn.flags&16){var je=ee.deletions;if(je!==null){for(var Et=0;Et<je.length;Et++){var qt=je[Et];for(rn=qt;rn!==null;){var fn=rn;switch(fn.tag){case 0:case 11:case 15:Iu(8,fn,ee)}var pr=fn.child;if(pr!==null)pr.return=fn,rn=pr;else for(;rn!==null;){fn=rn;var gn=fn.sibling,Zn=fn.return;if(lh(fn),fn===qt){rn=null;break}if(gn!==null){gn.return=Zn,rn=gn;break}rn=Zn}}}var bn=ee.alternate;if(bn!==null){var ea=bn.child;if(ea!==null){bn.child=null;do{var Rr=ea.sibling;ea.sibling=null,ea=Rr}while(ea!==null)}}rn=ee}}if(ee.subtreeFlags&2064&&Ae!==null)Ae.return=ee,rn=Ae;else e:for(;rn!==null;){if(ee=rn,ee.flags&2048)switch(ee.tag){case 0:case 11:case 15:Iu(9,ee,ee.return)}var Ve=ee.sibling;if(Ve!==null){Ve.return=ee.return,rn=Ve;break e}rn=ee.return}}var Je=m.current;for(rn=Je;rn!==null;){Ae=rn;var ut=Ae.child;if(Ae.subtreeFlags&2064&&ut!==null)ut.return=Ae,rn=ut;else e:for(Ae=Je;rn!==null;){if(je=rn,je.flags&2048)try{switch(je.tag){case 0:case 11:case 15:ch(9,je)}}catch(yn){Wa(je,je.return,yn)}if(je===Ae){rn=null;break e}var Ht=je.sibling;if(Ht!==null){Ht.return=je.return,rn=Ht;break e}rn=je.return}}if(Cr=H,dc(),tl&&typeof tl.onPostCommitFiberRoot=="function")try{tl.onPostCommitFiberRoot(zp,m)}catch{}L=!0}return L}finally{ur=M,xi.transition=_}}return!1}function Hy(m,_,M){_=Cu(M,_),_=yf(m,_,1),fa(m,_),_=Di(),m=vs(m,1),m!==null&&(nd(m,1,_),to(m,_))}function Wa(m,_,M){if(m.tag===3)Hy(m,m,M);else for(;_!==null;){if(_.tag===3){Hy(_,m,M);break}else if(_.tag===1){var L=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof L.componentDidCatch=="function"&&(Xl===null||!Xl.has(L))){m=Cu(M,m),m=sh(_,m,1),fa(_,m),m=Di(),_=vs(_,1),_!==null&&(nd(_,1,m),to(_,m));break}}_=_.return}}function AS(m,_,M){var L=m.pingCache;L!==null&&L.delete(_),_=Di(),m.pingedLanes|=m.suspendedLanes&M,ps===m&&(zs&M)===M&&(gs===4||gs===3&&(zs&130023424)===zs&&500>wr()-iv?Vi(m,0):vm|=M),to(m,_)}function vh(m,_){_===0&&(m.mode&1?(_=Yd,Yd<<=1,!(Yd&130023424)&&(Yd=4194304)):_=1);var M=Di();m=vs(m,_),m!==null&&(nd(m,_,M),to(m,M))}function Ff(m){var _=m.memoizedState,M=0;_!==null&&(M=_.retryLane),vh(m,M)}function Em(m,_){var M=0;switch(m.tag){case 13:var L=m.stateNode,H=m.memoizedState;H!==null&&(M=H.retryLane);break;case 19:L=m.stateNode;break;default:throw Error(o(314))}L!==null&&L.delete(_),vh(m,M)}var Vy;Vy=function(m,_,M){if(m!==null)if(m.memoizedProps!==_.pendingProps||qi.current)za=!0;else{if(!(m.lanes&M)&&!(_.flags&128))return za=!1,jy(m,_,M);za=!!(m.flags&131072)}else za=!1,gi&&_.flags&1048576&&Yp(_,Bg,_.index);switch(_.lanes=0,_.tag){case 2:var L=_.type;m!==null&&(m.alternate=null,_.alternate=null,_.flags|=2),m=_.pendingProps;var H=Bs(_,on.current);Ks(_,M),H=gf(null,_,L,m,H,M);var ee=me();return _.flags|=1,typeof H=="object"&&H!==null&&typeof H.render=="function"&&H.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Jn(L)?(ee=!0,Co(_)):ee=!1,_.memoizedState=H.state!==null&&H.state!==void 0?H.state:null,Ms(_),H.updater=zr,_.stateNode=H,H._reactInternals=_,Qd(_,L,m,M),_=G_(null,_,L,!0,ee,M)):(_.tag=0,gi&&ee&&ad(_),Ko(null,_,H,M),_=_.child),_;case 16:L=_.elementType;e:{switch(m!==null&&(m.alternate=null,_.alternate=null,_.flags|=2),m=_.pendingProps,H=L._init,L=H(L._payload),_.type=L,H=_.tag=_h(L),m=si(L,m),H){case 0:_=xr(null,_,L,m,M);break e;case 1:_=cm(null,_,L,m,M);break e;case 11:_=V_(null,_,L,m,M);break e;case 14:_=Xg(null,_,L,si(L.type,m),M);break e}throw Error(o(306,L,""))}return _;case 0:return L=_.type,H=_.pendingProps,H=_.elementType===L?H:si(L,H),xr(m,_,L,H,M);case 1:return L=_.type,H=_.pendingProps,H=_.elementType===L?H:si(L,H),cm(m,_,L,H,M);case 3:e:{if(Tf(_),m===null)throw Error(o(387));L=_.pendingProps,ee=_.memoizedState,H=ee.element,Is(m,_),nt(_,L,null,M);var Ae=_.memoizedState;if(L=Ae.element,rt&&ee.isDehydrated)if(ee={element:L,isDehydrated:!1,cache:Ae.cache,transitions:Ae.transitions},_.updateQueue.baseState=ee,_.memoizedState=ee,_.flags&256){H=Error(o(423)),_=dd(m,_,L,M,H);break e}else if(L!==H){H=Error(o(424)),_=dd(m,_,L,M,H);break e}else for(rt&&(zo=di(_.stateNode.containerInfo),fc=_,gi=!0,Pc=null,Nc=!1),M=Zp(_,null,L,M),_.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(pc(),L===H){_=ga(m,_,M);break e}Ko(m,_,L,M)}_=_.child}return _;case 5:return mc(_),m===null&&Su(_),L=_.type,H=_.pendingProps,ee=m!==null?m.memoizedProps:null,Ae=H.children,xe(L,H)?Ae=null:ee!==null&&xe(L,ee)&&(_.flags|=32),Qg(m,_),Ko(m,_,Ae,M),_.child;case 6:return m===null&&Su(_),null;case 13:return Yo(m,_,M);case 4:return hs(_,_.stateNode.containerInfo),L=_.pendingProps,m===null?_.child=lo(_,null,L,M):Ko(m,_,L,M),_.child;case 11:return L=_.type,H=_.pendingProps,H=_.elementType===L?H:si(L,H),V_(m,_,L,H,M);case 7:return Ko(m,_,_.pendingProps,M),_.child;case 8:return Ko(m,_,_.pendingProps.children,M),_.child;case 12:return Ko(m,_,_.pendingProps.children,M),_.child;case 10:e:{if(L=_.type._context,H=_.pendingProps,ee=_.memoizedProps,Ae=H.value,Ly(_,L,Ae),ee!==null)if(Hl(ee.value,Ae)){if(ee.children===H.children&&!qi.current){_=ga(m,_,M);break e}}else for(ee=_.child,ee!==null&&(ee.return=_);ee!==null;){var je=ee.dependencies;if(je!==null){Ae=ee.child;for(var Et=je.firstContext;Et!==null;){if(Et.context===L){if(ee.tag===1){Et=rl(-1,M&-M),Et.tag=2;var qt=ee.updateQueue;if(qt!==null){qt=qt.shared;var fn=qt.pending;fn===null?Et.next=Et:(Et.next=fn.next,fn.next=Et),qt.pending=Et}}ee.lanes|=M,Et=ee.alternate,Et!==null&&(Et.lanes|=M),Jd(ee.return,M,_),je.lanes|=M;break}Et=Et.next}}else if(ee.tag===10)Ae=ee.type===_.type?null:ee.child;else if(ee.tag===18){if(Ae=ee.return,Ae===null)throw Error(o(341));Ae.lanes|=M,je=Ae.alternate,je!==null&&(je.lanes|=M),Jd(Ae,M,_),Ae=ee.sibling}else Ae=ee.child;if(Ae!==null)Ae.return=ee;else for(Ae=ee;Ae!==null;){if(Ae===_){Ae=null;break}if(ee=Ae.sibling,ee!==null){ee.return=Ae.return,Ae=ee;break}Ae=Ae.return}ee=Ae}Ko(m,_,H.children,M),_=_.child}return _;case 9:return H=_.type,L=_.pendingProps.children,Ks(_,M),H=Yi(H),L=L(H),_.flags|=1,Ko(m,_,L,M),_.child;case 14:return L=_.type,H=si(L,_.pendingProps),H=si(L.type,H),Xg(m,_,L,H,M);case 15:return z_(m,_,_.type,_.pendingProps,M);case 17:return L=_.type,H=_.pendingProps,H=_.elementType===L?H:si(L,H),m!==null&&(m.alternate=null,_.alternate=null,_.flags|=2),_.tag=1,Jn(L)?(m=!0,Co(_)):m=!1,Ks(_,M),il(_,L,H),Qd(_,L,H,M),G_(null,_,L,!0,m,M);case 19:return Au(m,_,M);case 22:return Jg(m,_,M)}throw Error(o(156,_.tag))};function zy(m,_){return Pg(m,_)}function MS(m,_,M,L){this.tag=m,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=L,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _s(m,_,M,L){return new MS(m,_,M,L)}function Sc(m){return m=m.prototype,!(!m||!m.isReactComponent)}function _h(m){if(typeof m=="function")return Sc(m)?1:0;if(m!=null){if(m=m.$$typeof,m===g)return 11;if(m===w)return 14}return 2}function Zo(m,_){var M=m.alternate;return M===null?(M=_s(m.tag,_,m.key,m.mode),M.elementType=m.elementType,M.type=m.type,M.stateNode=m.stateNode,M.alternate=m,m.alternate=M):(M.pendingProps=_,M.type=m.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=m.flags&14680064,M.childLanes=m.childLanes,M.lanes=m.lanes,M.child=m.child,M.memoizedProps=m.memoizedProps,M.memoizedState=m.memoizedState,M.updateQueue=m.updateQueue,_=m.dependencies,M.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},M.sibling=m.sibling,M.index=m.index,M.ref=m.ref,M}function Jl(m,_,M,L,H,ee){var Ae=2;if(L=m,typeof m=="function")Sc(m)&&(Ae=1);else if(typeof m=="string")Ae=5;else e:switch(m){case u:return ya(M.children,H,ee,_);case d:Ae=8,H|=8;break;case h:return m=_s(12,M,_,H|2),m.elementType=h,m.lanes=ee,m;case y:return m=_s(13,M,_,H),m.elementType=y,m.lanes=ee,m;case E:return m=_s(19,M,_,H),m.elementType=E,m.lanes=ee,m;case A:return zi(M,H,ee,_);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case p:Ae=10;break e;case f:Ae=9;break e;case g:Ae=11;break e;case w:Ae=14;break e;case R:Ae=16,L=null;break e}throw Error(o(130,m==null?m:typeof m,""))}return _=_s(Ae,M,_,H),_.elementType=m,_.type=L,_.lanes=ee,_}function ya(m,_,M,L){return m=_s(7,m,L,_),m.lanes=M,m}function zi(m,_,M,L){return m=_s(22,m,L,_),m.elementType=A,m.lanes=M,m.stateNode={},m}function Io(m,_,M){return m=_s(6,m,null,_),m.lanes=M,m}function Sm(m,_,M){return _=_s(4,m.children!==null?m.children:[],m.key,_),_.lanes=M,_.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},_}function av(m,_,M,L,H){this.tag=_,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Ze,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Hp(0),this.expirationTimes=Hp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hp(0),this.identifierPrefix=L,this.onRecoverableError=H,rt&&(this.mutableSourceEagerHydrationData=null)}function J_(m,_,M,L,H,ee,Ae,je,Et){return m=new av(m,_,M,je,Et),_===1?(_=1,ee===!0&&(_|=8)):_=0,ee=_s(3,null,null,_),m.current=ee,ee.stateNode=m,ee.memoizedState={element:L,isDehydrated:M,cache:null,transitions:null},Ms(ee),m}function Gy(m){if(!m)return br;m=m._reactInternals;e:{if(F(m)!==m||m.tag!==1)throw Error(o(170));var _=m;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Jn(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(o(171))}if(m.tag===1){var M=m.type;if(Jn(M))return Ti(m,M,_)}return _}function Q_(m){var _=m._reactInternals;if(_===void 0)throw typeof m.render=="function"?Error(o(188)):(m=Object.keys(m).join(","),Error(o(268,m)));return m=K(_),m===null?null:m.stateNode}function Tm(m,_){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var M=m.retryLane;m.retryLane=M!==0&&M<_?M:_}}function cv(m,_){Tm(m,_),(m=m.alternate)&&Tm(m,_)}function IS(m){return m=K(m),m===null?null:m.stateNode}function wm(){return null}return n.attemptContinuousHydration=function(m){if(m.tag===13){var _=Di();va(m,134217728,_),cv(m,134217728)}},n.attemptHydrationAtCurrentPriority=function(m){if(m.tag===13){var _=Di(),M=Ec(m);va(m,M,_),cv(m,M)}},n.attemptSynchronousHydration=function(m){switch(m.tag){case 3:var _=m.stateNode;if(_.current.memoizedState.isDehydrated){var M=Vo(_.pendingLanes);M!==0&&(uf(_,M|1),to(_,wr()),!(Cr&6)&&(Ii(),dc()))}break;case 13:var L=Di();no(function(){return va(m,1,L)}),cv(m,1)}},n.batchedUpdates=function(m,_){var M=Cr;Cr|=1;try{return m(_)}finally{Cr=M,Cr===0&&(Ii(),Gp&&dc())}},n.createComponentSelector=function(m){return{$$typeof:dh,value:m}},n.createContainer=function(m,_,M,L,H,ee,Ae){return J_(m,_,!1,null,M,L,H,ee,Ae)},n.createHasPseudoClassSelector=function(m){return{$$typeof:Mf,value:m}},n.createHydrationContainer=function(m,_,M,L,H,ee,Ae,je,Et){return m=J_(M,L,!0,m,H,ee,Ae,je,Et),m.context=Gy(null),M=m.current,L=Di(),H=Ec(M),ee=rl(L,H),ee.callback=_??null,fa(M,ee),m.current.lanes=H,nd(m,H,L),to(m,L),m},n.createPortal=function(m,_,M){var L=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:L==null?null:""+L,children:m,containerInfo:_,implementation:M}},n.createRoleSelector=function(m){return{$$typeof:hh,value:m}},n.createTestNameSelector=function(m){return{$$typeof:pm,value:m}},n.createTextSelector=function(m){return{$$typeof:fh,value:m}},n.deferredUpdates=function(m){var _=ur,M=xi.transition;try{return xi.transition=null,ur=16,m()}finally{ur=_,xi.transition=M}},n.discreteUpdates=function(m,_,M,L,H){var ee=ur,Ae=xi.transition;try{return xi.transition=null,ur=1,m(_,M,L,H)}finally{ur=ee,xi.transition=Ae,Cr===0&&Ii()}},n.findAllNodes=yc,n.findBoundingRects=function(m,_){if(!$t)throw Error(o(363));_=yc(m,_),m=[];for(var M=0;M<_.length;M++)m.push(ue(_[M]));for(_=m.length-1;0<_;_--){M=m[_];for(var L=M.x,H=L+M.width,ee=M.y,Ae=ee+M.height,je=_-1;0<=je;je--)if(_!==je){var Et=m[je],qt=Et.x,fn=qt+Et.width,pr=Et.y,gn=pr+Et.height;if(L>=qt&&ee>=pr&&H<=fn&&Ae<=gn){m.splice(_,1);break}else if(L!==qt||M.width!==Et.width||gn<ee||pr>Ae){if(!(ee!==pr||M.height!==Et.height||fn<L||qt>H)){qt>L&&(Et.width+=qt-L,Et.x=L),fn<H&&(Et.width=H-qt),m.splice(_,1);break}}else{pr>ee&&(Et.height+=pr-ee,Et.y=ee),gn<Ae&&(Et.height=Ae-pr),m.splice(_,1);break}}}return m},n.findHostInstance=Q_,n.findHostInstanceWithNoPortals=function(m){return m=q(m),m=m!==null?X(m):null,m===null?null:m.stateNode},n.findHostInstanceWithWarning=function(m){return Q_(m)},n.flushControlled=function(m){var _=Cr;Cr|=1;var M=xi.transition,L=ur;try{xi.transition=null,ur=1,m()}finally{ur=L,xi.transition=M,Cr=_,Cr===0&&(Ii(),dc())}},n.flushPassiveEffects=Ir,n.flushSync=no,n.focusWithin=function(m,_){if(!$t)throw Error(o(363));for(m=Of(m),_=_c(m,_),_=Array.from(_),m=0;m<_.length;){var M=_[m++];if(!yt(M)){if(M.tag===5&&ze(M.stateNode))return!0;for(M=M.child;M!==null;)_.push(M),M=M.sibling}}return!1},n.getCurrentUpdatePriority=function(){return ur},n.getFindAllNodesFailureDescription=function(m,_){if(!$t)throw Error(o(363));var M=0,L=[];m=[Of(m),0];for(var H=0;H<m.length;){var ee=m[H++],Ae=m[H++],je=_[Ae];if((ee.tag!==5||!yt(ee))&&(Y_(ee,je)&&(L.push(mm(je)),Ae++,Ae>M&&(M=Ae)),Ae<_.length))for(ee=ee.child;ee!==null;)m.push(ee,Ae),ee=ee.sibling}if(M<_.length){for(m=[];M<_.length;M++)m.push(mm(_[M]));return`findAllNodes was able to match part of the selector:
  `+(L.join(" > ")+`

No matching component was found for:
  `)+m.join(" > ")}return null},n.getPublicRootInstance=function(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 5:return Z(m.child.stateNode);default:return m.child.stateNode}},n.injectIntoDevTools=function(m){if(m={bundleType:m.bundleType,version:m.version,rendererPackageName:m.rendererPackageName,rendererConfig:m.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:IS,findFiberByHostInstance:m.findFiberByHostInstance||wm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")m=!1;else{var _=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(_.isDisabled||!_.supportsFiber)m=!0;else{try{zp=_.inject(m),tl=_}catch{}m=!!_.checkDCE}}return m},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(m,_,M,L){if(!$t)throw Error(o(363));m=yc(m,_);var H=Vt(m,M,L).disconnect;return{disconnect:function(){H()}}},n.registerMutableSourceForHydration=function(m,_){var M=_._getVersion;M=M(_._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[_,M]:m.mutableSourceEagerHydrationData.push(_,M)},n.runWithPriority=function(m,_){var M=ur;try{return ur=m,_()}finally{ur=M}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(m,_,M,L){var H=_.current,ee=Di(),Ae=Ec(H);return M=Gy(M),_.context===null?_.context=M:_.pendingContext=M,_=rl(ee,Ae),_.payload={element:m},L=L===void 0?null:L,L!==null&&(_.callback=L),fa(H,_),m=va(H,Ae,ee),m!==null&&sd(m,H,Ae),Ae},n};_W.exports=tue;var nue=_W.exports;const rue=Nl(nue),rB={},EW=t=>void Object.assign(rB,t);function iue(t,e){function n(u,{args:d=[],attach:h,...p},f){let g=`${u[0].toUpperCase()}${u.slice(1)}`,y;if(u==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const E=p.object;y=Ab(E,{type:u,root:f,attach:h,primitive:!0})}else{const E=rB[g];if(!E)throw new Error(`R3F: ${g} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(d))throw new Error("R3F: The args prop must be an array!");y=Ab(new E(...d),{type:u,root:f,attach:h,memoizedProps:{args:d}})}return y.__r3f.attach===void 0&&(y instanceof Yh?y.__r3f.attach="geometry":y instanceof _g&&(y.__r3f.attach="material")),g!=="inject"&&lP(y,p),y}function r(u,d){let h=!1;if(d){var p,f;(p=d.__r3f)!=null&&p.attach?cP(u,d,d.__r3f.attach):d.isObject3D&&u.isObject3D&&(u.add(d),h=!0),h||(f=u.__r3f)==null||f.objects.push(d),d.__r3f||Ab(d,{}),d.__r3f.parent=u,l2(d),Mb(d)}}function i(u,d,h){let p=!1;if(d){var f,g;if((f=d.__r3f)!=null&&f.attach)cP(u,d,d.__r3f.attach);else if(d.isObject3D&&u.isObject3D){d.parent=u,d.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:d});const y=u.children.filter(w=>w!==d),E=y.indexOf(h);u.children=[...y.slice(0,E),d,...y.slice(E)],p=!0}p||(g=u.__r3f)==null||g.objects.push(d),d.__r3f||Ab(d,{}),d.__r3f.parent=u,l2(d),Mb(d)}}function s(u,d,h=!1){u&&[...u].forEach(p=>o(d,p,h))}function o(u,d,h){if(d){var p,f,g;if(d.__r3f&&(d.__r3f.parent=null),(p=u.__r3f)!=null&&p.objects&&(u.__r3f.objects=u.__r3f.objects.filter(A=>A!==d)),(f=d.__r3f)!=null&&f.attach)rH(u,d,d.__r3f.attach);else if(d.isObject3D&&u.isObject3D){var y;u.remove(d),(y=d.__r3f)!=null&&y.root&&fue(SC(d),d)}const w=(g=d.__r3f)==null?void 0:g.primitive,R=!w&&(h===void 0?d.dispose!==null:h);if(!w){var E;s((E=d.__r3f)==null?void 0:E.objects,d,R),s(d.children,d,R)}if(delete d.__r3f,R&&d.dispose&&d.type!=="Scene"){const A=()=>{try{d.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?a2.unstable_scheduleCallback(a2.unstable_IdlePriority,A):A()}Mb(u)}}function a(u,d,h,p){var f;const g=(f=u.__r3f)==null?void 0:f.parent;if(!g)return;const y=n(d,h,u.__r3f.root);if(u.children){for(const E of u.children)E.__r3f&&r(y,E);u.children=u.children.filter(E=>!E.__r3f)}u.__r3f.objects.forEach(E=>r(y,E)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||o(g,u),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),r(g,y),y.raycast&&y.__r3f.eventCount&&SC(y).getState().internal.interaction.push(y),[p,p.alternate].forEach(E=>{E!==null&&(E.stateNode=y,E.ref&&(typeof E.ref=="function"?E.ref(y):E.ref.current=y))})}const c=()=>{};return{reconciler:rue({createInstance:n,removeChild:o,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,d)=>{if(!d)return;const h=u.getState().scene;h.__r3f&&(h.__r3f.root=u,r(h,d))},removeChildFromContainer:(u,d)=>{d&&o(u.getState().scene,d)},insertInContainerBefore:(u,d,h)=>{if(!d||!h)return;const p=u.getState().scene;p.__r3f&&i(p,d,h)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var d;return!!((d=u==null?void 0:u.__r3f)!=null?d:{}).handlers},prepareUpdate(u,d,h,p){var f;if(((f=u==null?void 0:u.__r3f)!=null?f:{}).primitive&&p.object&&p.object!==u)return[!0];{const{args:y=[],children:E,...w}=p,{args:R=[],children:A,...k}=h;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((N,U)=>N!==R[U]))return[!0];const I=CW(u,w,k,!0);return I.changes.length?[!1,I]:null}},commitUpdate(u,[d,h],p,f,g,y){d?a(u,p,g,y):lP(u,h)},commitMount(u,d,h,p){var f;const g=(f=u.__r3f)!=null?f:{};u.raycast&&g.handlers&&g.eventCount&&SC(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>Ab(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var d;const{attach:h,parent:p}=(d=u.__r3f)!=null?d:{};h&&p&&rH(p,u,h),u.isObject3D&&(u.visible=!1),Mb(u)},unhideInstance(u,d){var h;const{attach:p,parent:f}=(h=u.__r3f)!=null?h:{};p&&f&&cP(f,u,p),(u.isObject3D&&d.visible==null||d.visible)&&(u.visible=!0),Mb(u)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>e?e():$b.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Ts.fun(performance.now)?performance.now:Ts.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Ts.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Ts.fun(clearTimeout)?clearTimeout:void 0}),applyProps:lP}}var Z$,eH;const aP=t=>"colorSpace"in t||"outputColorSpace"in t,SW=()=>{var t;return(t=rB.ColorManagement)!=null?t:null},TW=t=>t&&t.isOrthographicCamera,nM=typeof window<"u"&&((Z$=window.document)!=null&&Z$.createElement||((eH=window.navigator)==null?void 0:eH.product)==="ReactNative")?ft.useLayoutEffect:ft.useEffect;function sue(t){const e=ft.useRef(t);return nM(()=>void(e.current=t),[t]),e}class oue extends ft.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}oue.getDerivedStateFromError=()=>({error:!0});const wW="__default",tH=new Map,aue=t=>t&&!!t.memoized&&!!t.changes;function xW(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}const DS=t=>{var e;return(e=t.__r3f)==null?void 0:e.root.getState()};function SC(t){let e=t.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const Ts={obj:t=>t===Object(t)&&!Ts.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(Ts.str(t)||Ts.num(t)||Ts.boo(t))return t===e;const s=Ts.obj(t);if(s&&r==="reference")return t===e;const o=Ts.arr(t);if(o&&n==="reference")return t===e;if((o||s)&&t===e)return!0;let a;for(a in t)if(!(a in e))return!1;if(s&&n==="shallow"&&r==="shallow"){for(a in i?e:t)if(!Ts.equ(t[a],e[a],{strict:i,objects:"reference"}))return!1}else for(a in i?e:t)if(t[a]!==e[a])return!1;if(Ts.und(a)){if(o&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function cue(t){const e={nodes:{},materials:{}};return t&&t.traverse(n=>{n.name&&(e.nodes[n.name]=n),n.material&&!e.materials[n.material.name]&&(e.materials[n.material.name]=n.material)}),e}function lue(t){t.dispose&&t.type!=="Scene"&&t.dispose();for(const e in t)e.dispose==null||e.dispose(),delete t[e]}function Ab(t,e){const n=t;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},t}function c2(t,e){let n=t;if(e.includes("-")){const r=e.split("-"),i=r.pop();return n=r.reduce((s,o)=>s[o],t),{target:n,key:i}}else return{target:n,key:e}}const nH=/-\d+$/;function cP(t,e,n){if(Ts.str(n)){if(nH.test(n)){const s=n.replace(nH,""),{target:o,key:a}=c2(t,s);Array.isArray(o[a])||(o[a]=[])}const{target:r,key:i}=c2(t,n);e.__r3f.previousAttach=r[i],r[i]=e}else e.__r3f.previousAttach=n(t,e)}function rH(t,e,n){var r,i;if(Ts.str(n)){const{target:s,key:o}=c2(t,n),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(t,e);(i=e.__r3f)==null||delete i.previousAttach}function CW(t,{children:e,key:n,ref:r,...i},{children:s,key:o,ref:a,...c}={},l=!1){const u=t.__r3f,d=Object.entries(i),h=[];if(l){const f=Object.keys(c);for(let g=0;g<f.length;g++)i.hasOwnProperty(f[g])||d.unshift([f[g],wW+"remove"])}d.forEach(([f,g])=>{var y;if((y=t.__r3f)!=null&&y.primitive&&f==="object"||Ts.equ(g,c[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return h.push([f,g,!0,[]]);let E=[];f.includes("-")&&(E=f.split("-")),h.push([f,g,!1,E]);for(const w in i){const R=i[w];w.startsWith(`${f}-`)&&h.push([w,R,!1,w.split("-")])}});const p={...i};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(p.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(p.attach=u.memoizedProps.attach),{memoized:p,changes:h}}const uue=typeof Bn<"u"&&!1;function lP(t,e){var n;const r=t.__r3f,i=r==null?void 0:r.root,s=i==null||i.getState==null?void 0:i.getState(),{memoized:o,changes:a}=aue(e)?e:CW(t,e),c=r==null?void 0:r.eventCount;t.__r3f&&(t.__r3f.memoizedProps=o);for(let u=0;u<a.length;u++){let[d,h,p,f]=a[u];if(aP(t)){const w="srgb",R="srgb-linear";d==="encoding"?(d="colorSpace",h=h===3001?w:R):d==="outputEncoding"&&(d="outputColorSpace",h=h===3001?w:R)}let g=t,y=g[d];if(f.length&&(y=f.reduce((E,w)=>E[w],t),!(y&&y.set))){const[E,...w]=f.reverse();g=w.reverse().reduce((R,A)=>R[A],t),d=E}if(h===wW+"remove")if(g.constructor){let E=tH.get(g.constructor);E||(E=new g.constructor,tH.set(g.constructor,E)),h=E[d]}else h=0;if(p&&r)h?r.handlers[d]=h:delete r.handlers[d],r.eventCount=Object.keys(r.handlers).length;else if(y&&y.set&&(y.copy||y instanceof rE)){if(Array.isArray(h))y.fromArray?y.fromArray(h):y.set(...h);else if(y.copy&&h&&h.constructor&&(uue?y.constructor.name===h.constructor.name:y.constructor===h.constructor))y.copy(h);else if(h!==void 0){const E=y instanceof Ei;!E&&y.setScalar?y.setScalar(h):y instanceof rE&&h instanceof rE?y.mask=h.mask:y.set(h),!SW()&&s&&!s.linear&&E&&y.convertSRGBToLinear()}}else if(g[d]=h,g[d]instanceof So&&g[d].format===Od&&g[d].type===Yc&&s){const E=g[d];aP(E)&&aP(s.gl)?E.colorSpace=s.gl.outputColorSpace:E.encoding=s.gl.outputEncoding}Mb(t)}if(r&&r.parent&&t.raycast&&c!==r.eventCount){const u=SC(t).getState().internal,d=u.interaction.indexOf(t);d>-1&&u.interaction.splice(d,1),r.eventCount&&u.interaction.push(t)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(n=t.__r3f)!=null&&n.parent&&l2(t),t}function Mb(t){var e,n;const r=(e=t.__r3f)==null||(n=e.root)==null||n.getState==null?void 0:n.getState();r&&r.internal.frames===0&&r.invalidate()}function l2(t){t.onUpdate==null||t.onUpdate(t)}function due(t,e){t.manual||(TW(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function y1(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function hue(){var t;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return $b.DefaultEventPriority;switch((t=e.event)==null?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return $b.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return $b.ContinuousEventPriority;default:return $b.DefaultEventPriority}}function RW(t,e,n,r){const i=n.get(e);i&&(n.delete(e),n.size===0&&(t.delete(r),i.target.releasePointerCapture(r)))}function fue(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(r=>r!==e),n.initialHits=n.initialHits.filter(r=>r!==e),n.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&n.hovered.delete(i)}),n.capturedMap.forEach((r,i)=>{RW(n.capturedMap,e,r,i)})}function pue(t){function e(c){const{internal:l}=t.getState(),u=c.offsetX-l.initialClick[0],d=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+d*d))}function n(c){return c.filter(l=>["Move","Over","Enter","Out","Leave"].some(u=>{var d;return(d=l.__r3f)==null?void 0:d.handlers["onPointer"+u]}))}function r(c,l){const u=t.getState(),d=new Set,h=[],p=l?l(u.internal.interaction):u.internal.interaction;for(let E=0;E<p.length;E++){const w=DS(p[E]);w&&(w.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(c,u);function f(E){const w=DS(E);if(!w||!w.events.enabled||w.raycaster.camera===null)return[];if(w.raycaster.camera===void 0){var R;w.events.compute==null||w.events.compute(c,w,(R=w.previousRoot)==null?void 0:R.getState()),w.raycaster.camera===void 0&&(w.raycaster.camera=null)}return w.raycaster.camera?w.raycaster.intersectObject(E,!0):[]}let g=p.flatMap(f).sort((E,w)=>{const R=DS(E.object),A=DS(w.object);return!R||!A?E.distance-w.distance:A.events.priority-R.events.priority||E.distance-w.distance}).filter(E=>{const w=y1(E);return d.has(w)?!1:(d.add(w),!0)});u.events.filter&&(g=u.events.filter(g,u));for(const E of g){let w=E.object;for(;w;){var y;(y=w.__r3f)!=null&&y.eventCount&&h.push({...E,eventObject:w}),w=w.parent}}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(let E of u.internal.capturedMap.get(c.pointerId).values())d.has(y1(E.intersection))||h.push(E.intersection);return h}function i(c,l,u,d){const h=t.getState();if(c.length){const p={stopped:!1};for(const f of c){const g=DS(f.object)||h,{raycaster:y,pointer:E,camera:w,internal:R}=g,A=new ht(E.x,E.y,0).unproject(w),k=$=>{var q,K;return(q=(K=R.capturedMap.get($))==null?void 0:K.has(f.eventObject))!=null?q:!1},I=$=>{const q={intersection:f,target:l.target};R.capturedMap.has($)?R.capturedMap.get($).set(f.eventObject,q):R.capturedMap.set($,new Map([[f.eventObject,q]])),l.target.setPointerCapture($)},N=$=>{const q=R.capturedMap.get($);q&&RW(R.capturedMap,f.eventObject,q,$)};let U={};for(let $ in l){let q=l[$];typeof q!="function"&&(U[$]=q)}let F={...f,...U,pointer:E,intersections:c,stopped:p.stopped,delta:u,unprojectedPoint:A,ray:y.ray,camera:w,stopPropagation(){const $="pointerId"in l&&R.capturedMap.get(l.pointerId);if((!$||$.has(f.eventObject))&&(F.stopped=p.stopped=!0,R.hovered.size&&Array.from(R.hovered.values()).find(q=>q.eventObject===f.eventObject))){const q=c.slice(0,c.indexOf(f));s([...q,f])}},target:{hasPointerCapture:k,setPointerCapture:I,releasePointerCapture:N},currentTarget:{hasPointerCapture:k,setPointerCapture:I,releasePointerCapture:N},nativeEvent:l};if(d(F),p.stopped===!0)break}}return c}function s(c){const{internal:l}=t.getState();for(const u of l.hovered.values())if(!c.length||!c.find(d=>d.object===u.object&&d.index===u.index&&d.instanceId===u.instanceId)){const h=u.eventObject.__r3f,p=h==null?void 0:h.handlers;if(l.hovered.delete(y1(u)),h!=null&&h.eventCount){const f={...u,intersections:c};p.onPointerOut==null||p.onPointerOut(f),p.onPointerLeave==null||p.onPointerLeave(f)}}}function o(c,l){for(let u=0;u<l.length;u++){const d=l[u].__r3f;d==null||d.handlers.onPointerMissed==null||d.handlers.onPointerMissed(c)}}function a(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return l=>{const{internal:u}=t.getState();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))})}}return function(u){const{onPointerMissed:d,internal:h}=t.getState();h.lastEvent.current=u;const p=c==="onPointerMove",f=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",y=r(u,p?n:void 0),E=f?e(u):0;c==="onPointerDown"&&(h.initialClick=[u.offsetX,u.offsetY],h.initialHits=y.map(R=>R.eventObject)),f&&!y.length&&E<=2&&(o(u,h.interaction),d&&d(u)),p&&s(y);function w(R){const A=R.eventObject,k=A.__r3f,I=k==null?void 0:k.handlers;if(k!=null&&k.eventCount)if(p){if(I.onPointerOver||I.onPointerEnter||I.onPointerOut||I.onPointerLeave){const N=y1(R),U=h.hovered.get(N);U?U.stopped&&R.stopPropagation():(h.hovered.set(N,R),I.onPointerOver==null||I.onPointerOver(R),I.onPointerEnter==null||I.onPointerEnter(R))}I.onPointerMove==null||I.onPointerMove(R)}else{const N=I[c];N?(!f||h.initialHits.includes(A))&&(o(u,h.interaction.filter(U=>!h.initialHits.includes(U))),N(R)):f&&h.initialHits.includes(A)&&o(u,h.interaction.filter(U=>!h.initialHits.includes(U)))}}i(y,u,E,w)}}return{handlePointer:a}}const AW=t=>!!(t!=null&&t.render),MW=ft.createContext(null),mue=(t,e)=>{const n=Xle((a,c)=>{const l=new ht,u=new ht,d=new ht;function h(E=c().camera,w=u,R=c().size){const{width:A,height:k,top:I,left:N}=R,U=A/k;w instanceof ht?d.copy(w):d.set(...w);const F=E.getWorldPosition(l).distanceTo(d);if(TW(E))return{width:A/E.zoom,height:k/E.zoom,top:I,left:N,factor:1,distance:F,aspect:U};{const $=E.fov*Math.PI/180,q=2*Math.tan($/2)*F,K=q*(A/k);return{width:K,height:q,top:I,left:N,factor:A/K,distance:F,aspect:U}}}let p;const f=E=>a(w=>({performance:{...w.performance,current:E}})),g=new Vn;return{set:a,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(E=1)=>t(c(),E),advance:(E,w)=>e(E,w,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Gle,pointer:g,mouse:g,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const E=c();p&&clearTimeout(p),E.performance.current!==E.performance.min&&f(E.performance.min),p=setTimeout(()=>f(c().performance.max),E.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:h},setEvents:E=>a(w=>({...w,events:{...w.events,...E}})),setSize:(E,w,R,A,k)=>{const I=c().camera,N={width:E,height:w,top:A||0,left:k||0,updateStyle:R};a(U=>({size:N,viewport:{...U.viewport,...h(I,u,N)}}))},setDpr:E=>a(w=>{const R=xW(E);return{viewport:{...w.viewport,dpr:R,initialDpr:w.viewport.initialDpr||R}}}),setFrameloop:(E="always")=>{const w=c().clock;w.stop(),w.elapsedTime=0,E!=="never"&&(w.start(),w.elapsedTime=0),a(()=>({frameloop:E}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:ft.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(E,w,R)=>{const A=c().internal;return A.priority=A.priority+(w>0?1:0),A.subscribers.push({ref:E,priority:w,store:R}),A.subscribers=A.subscribers.sort((k,I)=>k.priority-I.priority),()=>{const k=c().internal;k!=null&&k.subscribers&&(k.priority=k.priority-(w>0?1:0),k.subscribers=k.subscribers.filter(I=>I.ref!==E))}}}}}),r=n.getState();let i=r.size,s=r.viewport.dpr,o=r.camera;return n.subscribe(()=>{const{camera:a,size:c,viewport:l,gl:u,set:d}=n.getState();if(c.width!==i.width||c.height!==i.height||l.dpr!==s){var h;i=c,s=l.dpr,due(a,c),u.setPixelRatio(l.dpr);const p=(h=c.updateStyle)!=null?h:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(c.width,c.height,p)}a!==o&&(o=a,d(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(a)}})))}),n.subscribe(a=>t(a)),n};function IW(t,e){const n={callback:t};return e.add(n),()=>void e.delete(n)}let b1,OW=new Set,kW=new Set,gue=new Set;const vue=t=>IW(t,OW),_ue=t=>IW(t,kW);function uP(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function LS(t,e){switch(t){case"before":return uP(OW,e);case"after":return uP(kW,e);case"tail":return uP(gue,e)}}let dP,hP;function fP(t,e,n){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),dP=e.internal.subscribers,b1=0;b1<dP.length;b1++)hP=dP[b1],hP.ref.current(hP.store.getState(),r,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function yue(t){let e=!1,n=!1,r,i,s;function o(l){i=requestAnimationFrame(o),e=!0,r=0,LS("before",l),n=!0;for(const d of t.values()){var u;s=d.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(r+=fP(l,s))}if(n=!1,LS("after",l),r===0)return LS("tail",l),e=!1,cancelAnimationFrame(i)}function a(l,u=1){var d;if(!l)return t.forEach(h=>a(h.store.getState(),u));(d=l.gl.xr)!=null&&d.isPresenting||!l.internal.active||l.frameloop==="never"||(u>1?l.internal.frames=Math.min(60,l.internal.frames+u):n?l.internal.frames=2:l.internal.frames=1,e||(e=!0,requestAnimationFrame(o)))}function c(l,u=!0,d,h){if(u&&LS("before",l),d)fP(l,d,h);else for(const p of t.values())fP(l,p.store.getState());u&&LS("after",l)}return{loop:o,invalidate:a,advance:c}}function bue(t){const e=ft.useRef(null);return nM(()=>void(e.current=t.current.__r3f),[t]),e}function NW(){const t=ft.useContext(MW);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function lS(t=n=>n,e){return NW()(t,e)}function ww(t,e=0){const n=NW(),r=n.getState().internal.subscribe,i=sue(t);return nM(()=>r(i,e,n),[e,r,n]),null}const iH=new WeakMap;function PW(t,e){return function(n,...r){let i=iH.get(n);return i||(i=new n,iH.set(n,i)),t&&t(i),Promise.all(r.map(s=>new Promise((o,a)=>i.load(s,c=>{c.scene&&Object.assign(c,cue(c.scene)),o(c)},e,c=>a(new Error(`Could not load ${s}: ${c==null?void 0:c.message}`))))))}}function xw(t,e,n,r){const i=Array.isArray(e)?e:[e],s=Qle(PW(n,r),[t,...i],{equal:Ts.equ});return Array.isArray(e)?s:s[0]}xw.preload=function(t,e,n){const r=Array.isArray(e)?e:[e];return Zle(PW(n),[t,...r])};xw.clear=function(t,e){const n=Array.isArray(e)?e:[e];return eue([t,...n])};const xE=new Map,{invalidate:sH,advance:oH}=yue(xE),{reconciler:ER,applyProps:lb}=iue(xE,hue),ub={objects:"shallow",strict:!1},Eue=(t,e)=>{const n=typeof t=="function"?t(e):t;return AW(n)?n:new Ule({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...t})};function Sue(t,e){const n=typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement;if(e){const{width:r,height:i,top:s,left:o,updateStyle:a=n}=e;return{width:r,height:i,top:s,left:o,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:r,height:i,top:s,left:o}=t.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:o,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Tue(t){const e=xE.get(t),n=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||mue(sH,oH),o=n||ER.createContainer(s,$b.ConcurrentRoot,null,!1,null,"",i,null);e||xE.set(t,{fiber:o,store:s});let a,c=!1,l;return{configure(u={}){let{gl:d,size:h,scene:p,events:f,onCreated:g,shadows:y=!1,linear:E=!1,flat:w=!1,legacy:R=!1,orthographic:A=!1,frameloop:k="always",dpr:I=[1,2],performance:N,raycaster:U,camera:F,onPointerMissed:$}=u,q=s.getState(),K=q.gl;q.gl||q.set({gl:K=Eue(d,t)});let W=q.raycaster;W||q.set({raycaster:W=new Wle});const{params:X,...ne}=U||{};if(Ts.equ(ne,W,ub)||lb(W,{...ne}),Ts.equ(X,W.params,ub)||lb(W,{params:{...W.params,...X}}),!q.camera||q.camera===l&&!Ts.equ(l,F,ub)){l=F;const se=F instanceof eM,ve=se?F:A?new QF(0,0,0,0,.1,1e3):new ju(75,0,.1,1e3);se||(ve.position.z=5,F&&(lb(ve,F),("aspect"in F||"left"in F||"right"in F||"bottom"in F||"top"in F)&&(ve.manual=!0,ve.updateProjectionMatrix())),!q.camera&&!(F!=null&&F.rotation)&&ve.lookAt(0,0,0)),q.set({camera:ve}),W.camera=ve}if(!q.scene){let se;p instanceof bR?se=p:(se=new bR,p&&lb(se,p)),q.set({scene:Ab(se)})}if(!q.xr){var Z;const se=(_e,le)=>{const xe=s.getState();xe.frameloop!=="never"&&oH(_e,!0,xe,le)},ve=()=>{const _e=s.getState();_e.gl.xr.enabled=_e.gl.xr.isPresenting,_e.gl.xr.setAnimationLoop(_e.gl.xr.isPresenting?se:null),_e.gl.xr.isPresenting||sH(_e)},Oe={connect(){const _e=s.getState().gl;_e.xr.addEventListener("sessionstart",ve),_e.xr.addEventListener("sessionend",ve)},disconnect(){const _e=s.getState().gl;_e.xr.removeEventListener("sessionstart",ve),_e.xr.removeEventListener("sessionend",ve)}};typeof((Z=K.xr)==null?void 0:Z.addEventListener)=="function"&&Oe.connect(),q.set({xr:Oe})}if(K.shadowMap){const se=K.shadowMap.enabled,ve=K.shadowMap.type;if(K.shadowMap.enabled=!!y,Ts.boo(y))K.shadowMap.type=mC;else if(Ts.str(y)){var ie;const Oe={basic:xre,percentage:VF,soft:mC,variance:qf};K.shadowMap.type=(ie=Oe[y])!=null?ie:mC}else Ts.obj(y)&&Object.assign(K.shadowMap,y);(se!==K.shadowMap.enabled||ve!==K.shadowMap.type)&&(K.shadowMap.needsUpdate=!0)}const G=SW();G&&("enabled"in G?G.enabled=!R:"legacyMode"in G&&(G.legacyMode=R)),c||lb(K,{outputEncoding:E?3e3:3001,toneMapping:w?up:jG}),q.legacy!==R&&q.set(()=>({legacy:R})),q.linear!==E&&q.set(()=>({linear:E})),q.flat!==w&&q.set(()=>({flat:w})),d&&!Ts.fun(d)&&!AW(d)&&!Ts.equ(d,K,ub)&&lb(K,d),f&&!q.events.handlers&&q.set({events:f(s)});const Q=Sue(t,h);return Ts.equ(Q,q.size,ub)||q.setSize(Q.width,Q.height,Q.updateStyle,Q.top,Q.left),I&&q.viewport.dpr!==xW(I)&&q.setDpr(I),q.frameloop!==k&&q.setFrameloop(k),q.onPointerMissed||q.set({onPointerMissed:$}),N&&!Ts.equ(N,q.performance,ub)&&q.set(se=>({performance:{...se.performance,...N}})),a=g,c=!0,this},render(u){return c||this.configure(),ER.updateContainer(De.jsx(wue,{store:s,children:u,onCreated:a,rootElement:t}),o,null,()=>{}),s},unmount(){xue(t)}}}function wue({store:t,children:e,onCreated:n,rootElement:r}){return nM(()=>{const i=t.getState();i.set(s=>({internal:{...s.internal,active:!0}})),n&&n(i),t.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),De.jsx(MW.Provider,{value:t,children:e})}function xue(t,e){const n=xE.get(t),r=n==null?void 0:n.fiber;if(r){const i=n==null?void 0:n.store.getState();i&&(i.internal.active=!1),ER.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,o,a,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),lue(i),xE.delete(t)}catch{}},500)})}}ER.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:ft.version});const pP={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Cue(t){const{handlePointer:e}=pue(t);return{priority:1,enabled:!0,compute(n,r,i){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(pP).reduce((n,r)=>({...n,[r]:e(r)}),{}),update:()=>{var n;const{events:r,internal:i}=t.getState();(n=i.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:n=>{var r;const{set:i,events:s}=t.getState();s.disconnect==null||s.disconnect(),i(o=>({events:{...o.events,connected:n}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([o,a])=>{const[c,l]=pP[o];n.addEventListener(c,a,{passive:l})})},disconnect:()=>{const{set:n,events:r}=t.getState();if(r.connected){var i;Object.entries((i=r.handlers)!=null?i:[]).forEach(([s,o])=>{if(r&&r.connected instanceof HTMLElement){const[a]=pP[s];r.connected.removeEventListener(a,o)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}var iB={exports:{}};function DW(t,e=100,n={}){if(typeof t!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof t}\`.`);if(e<0)throw new RangeError("`wait` must not be negative.");const{immediate:r}=typeof n=="boolean"?{immediate:n}:n;let i,s,o,a,c;function l(){const h=i,p=s;return i=void 0,s=void 0,c=t.apply(h,p),c}function u(){const h=Date.now()-a;h<e&&h>=0?o=setTimeout(u,e-h):(o=void 0,r||(c=l()))}const d=function(...h){if(i&&this!==i&&Object.getPrototypeOf(this)===Object.getPrototypeOf(i))throw new Error("Debounced method called with different contexts of the same prototype.");i=this,s=h,a=Date.now();const p=r&&!o;return o||(o=setTimeout(u,e)),p&&(c=l()),c};return Object.defineProperty(d,"isPending",{get(){return o!==void 0}}),d.clear=()=>{o&&(clearTimeout(o),o=void 0)},d.flush=()=>{o&&d.trigger()},d.trigger=()=>{c=l(),d.clear()},d}iB.exports.debounce=DW;iB.exports=DW;var Rue=iB.exports;const Aue=Nl(Rue);/*! unmute-ios-audio. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Mue=Iue;const aH=["auxclick","click","contextmenu","dblclick","keydown","keyup","mousedown","mouseup","touchend"];function Iue(){const t=window.webkitAudioContext;if(!(navigator.maxTouchPoints>0&&t!=null))return;let n="blocked",r="blocked",i,s,o;const a=new t().sampleRate,c=l(a);aH.forEach(f=>{window.addEventListener(f,u,{capture:!0,passive:!0})});function l(f){const g=new ArrayBuffer(10),y=new DataView(g);return y.setUint32(0,f,!0),y.setUint32(4,f,!0),y.setUint16(8,1,!0),`data:audio/wav;base64,UklGRisAAABXQVZFZm10IBAAAAABAAEA${window.btoa(String.fromCharCode(...new Uint8Array(g))).slice(0,13)}AgAZGF0YQcAAACAgICAgICAAAA=`}function u(f){n==="blocked"&&(n="pending",d()),r==="blocked"&&(r="pending",h())}function d(){i=document.createElement("audio"),i.setAttribute("x-webkit-airplay","deny"),i.preload="auto",i.loop=!0,i.src=c,i.load(),i.play().then(()=>{n="allowed",p()},()=>{n="blocked",i.pause(),i.removeAttribute("src"),i.load(),i=null})}function h(){s=new t,o=s.createBufferSource(),o.buffer=s.createBuffer(1,1,22050),o.connect(s.destination),o.start(),s.state==="running"?(r="allowed",p()):(r="blocked",o.disconnect(s.destination),o=null,s.close(),s=null)}function p(){n!=="allowed"||r!=="allowed"||aH.forEach(f=>{window.removeEventListener(f,u,{capture:!0,passive:!0})})}}const Oue=Nl(Mue);var LW={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Da,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var d=function(){var h=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=h-(c=h|0)};return d.next=d,d.uint32=function(){return d()*4294967296},d.fract53=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.version="Alea 0.9",d.args=i,d.exportState=function(){return[s,o,a,c]},d.importState=function(h){s=+h[0]||0,o=+h[1]||0,a=+h[2]||0,c=+h[3]||0},d}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(LW);var kue=LW.exports;const UW=Nl(kue);new Vn;new Vn;function Ci(t,e,n){return Math.max(e,Math.min(n,t))}function Nue(t){return t/180*Math.PI}function FW(t){return t*180/Math.PI}const Pue=UW("089fad0j9awfem09wavefc09uwaef");function cH(t){return 2*Math.floor(t/2)}function rM(t,e){return Math.round(t/e)*e}function Due(){return Pue()}function Lue(t){return UW(t)()}function $v(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(Due()*i)}function BW(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(Lue(t)*s)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Uue=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fue=Object.prototype.hasOwnProperty;function u2(t,e){return Fue.call(t,e)}function d2(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)u2(t,i)&&r.push(i);return r}function iu(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function h2(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function y0(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function jW(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function f2(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(f2(t[e]))return!0}else if(typeof t=="object"){for(var r=d2(t),i=r.length,s=0;s<i;s++)if(f2(t[r[s]]))return!0}}return!1}function lH(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var $W=function(t){Uue(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,lH(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=lH(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),vo=$W,Bue=iu,Hb={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=SR(n,this.path);r&&(r=iu(r));var i=U0(n,{op:"remove",path:this.from}).removed;return U0(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=SR(n,this.from);return U0(n,{op:"add",path:this.path,value:iu(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:IT(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},jue={add:function(t,e,n){return h2(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Hb.move,copy:Hb.copy,test:Hb.test,_get:Hb._get};function SR(t,e){if(e=="")return t;var n={op:"_get",path:e};return U0(t,n),n.value}function U0(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):TR(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=SR(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=IT(t,e.value),o.test===!1)throw new vo("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new vo("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=iu(t));var a=e.path||"",c=a.split("/"),l=t,u=1,d=c.length,h=void 0,p=void 0,f=void 0;for(typeof n=="function"?f=n:f=TR;;){if(p=c[u],p&&p.indexOf("~")!=-1&&(p=jW(p)),i&&(p=="__proto__"||p=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&h===void 0&&(l[p]===void 0?h=c.slice(0,u).join("/"):u==d-1&&(h=e.path),h!==void 0&&f(e,0,t,h)),u++,Array.isArray(l)){if(p==="-")p=l.length;else{if(n&&!h2(p))throw new vo("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);h2(p)&&(p=~~p)}if(u>=d){if(n&&e.op==="add"&&p>l.length)throw new vo("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=jue[e.op].call(e,l,p,t);if(o.test===!1)throw new vo("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=d){var o=Hb[e.op].call(e,l,p,t);if(o.test===!1)throw new vo("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[p],n&&u<d&&(!l||typeof l!="object"))throw new vo("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function iM(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new vo("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=iu(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=U0(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function $ue(t,e,n){var r=U0(t,e);if(r.test===!1)throw new vo("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function TR(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new vo("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Hb[t.op]){if(typeof t.path!="string")throw new vo("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new vo('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new vo("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new vo("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&f2(t.value))throw new vo("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new vo("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new vo("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=sB([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new vo("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new vo("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function sB(t,e,n){try{if(!Array.isArray(t))throw new vo("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)iM(iu(e),iu(t),n||!0);else{n=n||TR;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof vo)return i;throw i}}function IT(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!IT(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!IT(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}const Hue=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:vo,_areEquals:IT,applyOperation:U0,applyPatch:iM,applyReducer:$ue,deepClone:Bue,getValueByPointer:SR,validate:sB,validator:TR},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var oB=new WeakMap,Vue=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),zue=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function Gue(t){return oB.get(t)}function Wue(t,e){return t.observers.get(e)}function que(t,e){t.observers.delete(e.callback)}function Kue(t,e){e.unobserve()}function Yue(t,e){var n=[],r,i=Gue(t);if(!i)i=new Vue(t),oB.set(t,i);else{var s=Wue(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=iu(t),e){r.callback=e,r.next=null;var o=function(){p2(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){p2(r),clearTimeout(r.next),que(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new zue(e,r)),r}function p2(t,e){e===void 0&&(e=!1);var n=oB.get(t.object);aB(n.value,t.object,t.patches,"",e),t.patches.length&&iM(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function aB(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=d2(e),o=d2(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(u2(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var d=e[l];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?aB(u,d,n,r+"/"+y0(l),i):u!==d&&(i&&n.push({op:"test",path:r+"/"+y0(l),value:iu(u)}),n.push({op:"replace",path:r+"/"+y0(l),value:iu(d)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+y0(l),value:iu(u)}),n.push({op:"remove",path:r+"/"+y0(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!u2(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+y0(l),value:iu(e[l])})}}}function Xue(t,e,n){n===void 0&&(n=!1);var r=[];return aB(t,e,r,"",n),r}const Jue=Object.freeze(Object.defineProperty({__proto__:null,compare:Xue,generate:p2,observe:Yue,unobserve:Kue},Symbol.toStringTag,{value:"Module"}));Object.assign({},Hue,Jue,{JsonPatchError:$W,deepClone:iu,escapePathComponent:y0,unescapePathComponent:jW});var Que=typeof Element<"u",Zue=typeof Map=="function",ede=typeof Set=="function",tde=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function TC(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!TC(t[r],e[r]))return!1;return!0}var s;if(Zue&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!TC(r.value[1],e.get(r.value[0])))return!1;return!0}if(ede&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(tde&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(Que&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!TC(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var nde=function(e,n){try{return TC(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const pT=Nl(nde);function he(t){return t!=null}const rde=Object.fromEntries,HW=Object.keys;function Gc(t){return iu(t)}function ide(t){return typeof t=="boolean"}function Mn(t){return typeof t=="number"&&isNaN(t)===!1}function nr(t){return typeof t=="string"}function qr(t){return Array.isArray(t)}function xl(t){return t}function sde(t){return he(t)&&typeof t=="object"&&nr(t.id)&&nr(t.target)&&nr(t.sender)}function ai(t,e,n,r){const i=r??"";return t.emit(`error:${e}`,n,i),xde(t,n,i)}function ode(t,e,n){t.emit("broadcast:startstream",e,n)}function ade(t,e){t.emit("broadcast:stopstream",void 0,e)}function cde(t,e,n){t.emit("chat:connect",e,n)}function lde(t,e){t.emit("chat:disconnect",void 0,e)}function ude(t,e){t.emit("gadgetserver:desync",void 0,e)}function dde(t,e){t.emit("gadgetserver:clearscroll",void 0,e)}function hde(t,e,n,r,i,s,o){t.emit("network:fetch",[e,n,r,i,s],o)}function fde(t,e,n){t.emit("network:join",e,n)}function pde(t,e,n){t.emit("network:start",e,n)}function mde(t,e,n,r){t.emit("network:showjoincode",[e,n],r)}function gde(t,e){t.emit("register:dev",void 0,e)}function vde(t,e){t.emit("register:share",void 0,e)}function _de(t,e){t.emit("register:nuke",void 0,e)}function yde(t,e){t.emit("synth:audioenabled",void 0,e)}function bde(t,e,n){t.emit("synth:tts",[e,n])}function Mv(t,e,n){t.emit("synth:play",[e,n])}function Ede(t,e){t.emit("synth:bpm",e)}function uH(t,e){t.emit("synth:mainvolume",e)}function dH(t,e){t.emit("synth:drumvolume",e)}function hH(t,e){t.emit("synth:ttsvolume",e)}function mP(t,e,n,r){t.emit("synth:voice",[e,n,r])}function Sde(t,e,n,r,i){t.emit("synth:voicefx",[e,n,r,i])}function gp(t,...e){return t.emit("tape:info",e),!0}function Tde(t,...e){return t.emit("tape:debug",e),!0}function wde(t,e,n){t.emit("tape:inspector",e,n)}function xde(t,...e){return t.emit("tape:error",e),!1}function Cde(t,e){t.emit("tape:terminal:open",void 0,e)}function Rde(t,e){t.emit("tape:terminal:quickopen",void 0,e)}function wR(t,e){t.emit("tape:terminal:close",void 0,e)}function Ade(t,e){t.emit("tape:terminal:toggle",void 0,e)}function VW(t,e,n){t.emit("tape:terminal:inclayout",e,n)}function zW(t,e){t.emit("tape:crash",void 0,e)}function Mde(t,e,n,r,i,s){t.emit("tape:editor:open",[e,n,r,i],s)}function Ide(t,e){t.emit("tape:editor:close",void 0,e)}function Ode(t,e){t.emit("vm:operator",void 0,e)}function kde(t,e,n){t.emit("vm:halt",e,n)}function Nde(t,e,n,r){t.emit("vm:books",[e,n],r)}function Pde(t,e){t.emit("vm:login",void 0,e)}function Dde(t,e){t.emit("vm:logout",void 0,e)}function Lde(t,e){t.emit("vm:doot",void 0,e)}function Ude(t,e,n,r){t.emit("vm:input",[e,n],r)}function Fde(t,e,n,r){t.emit("vm:inspect",[e,n],r)}function GW(t,e){return`${t}:${e.join(":")}`}function Bde(t,e,n,r){t.emit("vm:codewatch",[e,n],r)}function jde(t,e,n,r){t.emit("vm:coderelease",[e,n],r)}function Cw(t,e,n){t.emit("vm:cli",e,n)}function $de(t,e){t.emit("vm:restart",void 0,e)}function Hde(t,e){t.emit("vm:synthsend",e)}function Vde(t,e,n){t.emit("vm:flush",e,n)}function zde(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function Gde(t,e){return{filename:t,json:e}}function Wde(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function tg(t,e,n,r,i,s){let o;switch(n){case"file":o=i;break;case"text":o=zde(r,i);break;case"json":o=Gde(r,i);break;case"binary":o=Wde(r,i);break}setTimeout(()=>{t.emit("vm:loader",[e,n,r,o],s)},1)}function cB(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function qde(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=cB(n);return(i,s)=>r.then(o=>s(o.transaction(e,i).objectStore(e)))}let gP;function WW(){return gP||(gP=qde("keyval-store","keyval")),gP}function Kde(t,e=WW()){return e("readonly",n=>cB(n.get(t)))}function Yde(t,e,n=WW()){return n("readwrite",r=>new Promise((i,s)=>{r.get(t).onsuccess=function(){try{r.put(e(this.result),t),i(cB(r.transaction))}catch(o){s(o)}}}))}const vP=new Set,OT={emit(t,e,n,r,i){OT.invoke(ZW(t,e,n,r,i))},invoke(t){switch(t.target){}vP.forEach(e=>e.handle(t))},connect(t){vP.add(t)},disconnect(t){vP.delete(t)}};var qW={};(function(t){var e=Da&&Da.__spreadArray||function(l,u,d){if(d||arguments.length===2)for(var h=0,p=u.length,f;h<p;h++)(f||!(h in u))&&(f||(f=Array.prototype.slice.call(u,0,h)),f[h]=u[h]);return l.concat(f||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,d){return u.length>d.length?u:d})}function i(l){return l.reduce(function(u,d){return u.length<d.length?u:d})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,d=u===void 0?"":u,h=l.capitalize,p=h===void 0?!0:h,f=l.adjectiveCount,g=f===void 0?1:f,y=l.addAdverb,E=y===void 0?!1:y,w=e(e(e([],e([],Array(g),!0).map(function(R){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),E?[n(t.adverbs)]:[],!0);return p&&(w=w.map(function(R){return R.charAt(0).toUpperCase()+R.substr(1)})),w.join(d)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,h=l.addAdverb,p=h===void 0?!1:h;return t.adjectives.length*d*t.nouns.length*t.verbs.length*(p?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,h=l.addAdverb,p=h===void 0?!1:h,f=l.separator,g=f===void 0?"":f;return r(t.adjectives).length*d+d*g.length+r(t.nouns).length+g.length+r(t.verbs).length+(p?r(t.adverbs).length+g.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,h=l.addAdverb,p=h===void 0?!1:h,f=l.separator,g=f===void 0?"":f;return i(t.adjectives).length*d+d*g.length+i(t.nouns).length+g.length+i(t.verbs).length+(p?i(t.adverbs).length+g.length:0)}t.minLength=c,t.default=s})(qW);const Xde=Nl(qW),Jde="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Qde=t=>crypto.getRandomValues(new Uint8Array(t)),Zde=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},KW=(t,e=21)=>Zde(t,e,Qde),ehe=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Jde[n[t]&63];return e};var YW="abcdefghijklmnopqrstuvwxyz",XW="ABCDEFGHIJKLMNOPQRSTUVWXYZ",JW="0123456789",the="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",nhe="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const rhe=JW,ihe=YW,she=XW;var ohe=rhe+ihe+she,m2={lowercase:YW,uppercase:XW,numbers:JW,nolookalikes:the,nolookalikesSafe:nhe,alphanumeric:ohe};function Po(){return`sid_${ehe(12).replaceAll("-",".")}`}const ahe=KW(m2.numbers,4),che=KW(`${m2.numbers}${m2.lowercase}`,16);function lhe(){return`pid_${ahe()}_${che()}`}function QW(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function uhe(){return Xde({capitalize:!1,adjectiveCount:1})}var Tr=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Tr||{}),Gi=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Gi||{}),Y0=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Y0||{}),pn=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t))(pn||{}),Tn=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.LINK=11]="LINK",t[t.HOTKEY=12]="HOTKEY",t[t.COPYIT=13]="COPYIT",t[t.OPENIT=14]="OPENIT",t[t.ZSSEDIT=15]="ZSSEDIT",t[t.CHAREDIT=16]="CHAREDIT",t[t.COLOREDIT=17]="COLOREDIT",t))(Tn||{});function rr(t){return t.toLowerCase().trim()}function ZW(t,e,n,r,i){return{session:t,id:Po(),target:e,sender:n,data:r,player:i}}function sM(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function Xh(t,e=[],n=xl,r=""){const i=Po(),s=rr(t),o=e.map(rr);let a=r;const c={id(){return i},name(){return t},session(l){return he(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,d){OT.emit(a,l,i,u,d)},reply(l,u,d,h){c.emit(`${l.sender}:${u}`,d,h)},replynext(l,u,d,h){setTimeout(()=>c.emit(`${l.sender}:${u}`,d,h),64)},handle(l){const{target:u,path:d}=sM(l.target),h=rr(u);!a&&h==="ready"&&(a=l.session),h==="bridge"&&he(l.session)&&(a=l.session),o.findIndex(p=>p==="all"||p===h)!==-1&&n(l),(i===u||h==="all"||s===h)&&n({...l,target:d})}};return OT.connect(c),c}const oM=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),aM=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]),Xm=globalThis||void 0||self;var eq=typeof Xm=="object"&&Xm&&Xm.Object===Object&&Xm,dhe=typeof self=="object"&&self&&self.Object===Object&&self,Ap=eq||dhe||Function("return this")(),Ld=Ap.Symbol,tq=Object.prototype,hhe=tq.hasOwnProperty,fhe=tq.toString,US=Ld?Ld.toStringTag:void 0;function phe(t){var e=hhe.call(t,US),n=t[US];try{t[US]=void 0;var r=!0}catch{}var i=fhe.call(t);return r&&(e?t[US]=n:delete t[US]),i}var mhe=Object.prototype,ghe=mhe.toString;function vhe(t){return ghe.call(t)}var _he="[object Null]",yhe="[object Undefined]",fH=Ld?Ld.toStringTag:void 0;function C_(t){return t==null?t===void 0?yhe:_he:fH&&fH in Object(t)?phe(t):vhe(t)}function Hh(t){return t!=null&&typeof t=="object"}var bhe="[object Symbol]";function cM(t){return typeof t=="symbol"||Hh(t)&&C_(t)==bhe}function lM(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Ri=Array.isArray,Ehe=1/0,pH=Ld?Ld.prototype:void 0,mH=pH?pH.toString:void 0;function nq(t){if(typeof t=="string")return t;if(Ri(t))return lM(t,nq)+"";if(cM(t))return mH?mH.call(t):"";var e=t+"";return e=="0"&&1/t==-Ehe?"-0":e}var She=/\s/;function The(t){for(var e=t.length;e--&&She.test(t.charAt(e)););return e}var whe=/^\s+/;function xhe(t){return t&&t.slice(0,The(t)+1).replace(whe,"")}function Ud(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var gH=NaN,Che=/^[-+]0x[0-9a-f]+$/i,Rhe=/^0b[01]+$/i,Ahe=/^0o[0-7]+$/i,Mhe=parseInt;function Ihe(t){if(typeof t=="number")return t;if(cM(t))return gH;if(Ud(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Ud(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=xhe(t);var n=Rhe.test(t);return n||Ahe.test(t)?Mhe(t.slice(2),n?2:8):Che.test(t)?gH:+t}var vH=1/0,Ohe=17976931348623157e292;function khe(t){if(!t)return t===0?t:0;if(t=Ihe(t),t===vH||t===-vH){var e=t<0?-1:1;return e*Ohe}return t===t?t:0}function uM(t){var e=khe(t),n=e%1;return e===e?n?e-n:e:0}function CE(t){return t}var Nhe="[object AsyncFunction]",Phe="[object Function]",Dhe="[object GeneratorFunction]",Lhe="[object Proxy]";function yg(t){if(!Ud(t))return!1;var e=C_(t);return e==Phe||e==Dhe||e==Nhe||e==Lhe}var _P=Ap["__core-js_shared__"],_H=function(){var t=/[^.]+$/.exec(_P&&_P.keys&&_P.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Uhe(t){return!!_H&&_H in t}var Fhe=Function.prototype,Bhe=Fhe.toString;function gy(t){if(t!=null){try{return Bhe.call(t)}catch{}try{return t+""}catch{}}return""}var jhe=/[\\^$.*+?()[\]{}|]/g,$he=/^\[object .+?Constructor\]$/,Hhe=Function.prototype,Vhe=Object.prototype,zhe=Hhe.toString,Ghe=Vhe.hasOwnProperty,Whe=RegExp("^"+zhe.call(Ghe).replace(jhe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function qhe(t){if(!Ud(t)||Uhe(t))return!1;var e=yg(t)?Whe:$he;return e.test(gy(t))}function Khe(t,e){return t==null?void 0:t[e]}function vy(t,e){var n=Khe(t,e);return qhe(n)?n:void 0}var g2=vy(Ap,"WeakMap"),yH=Object.create,Yhe=function(){function t(){}return function(e){if(!Ud(e))return{};if(yH)return yH(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function Xhe(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ra(){}function Jhe(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Qhe=800,Zhe=16,efe=Date.now;function tfe(t){var e=0,n=0;return function(){var r=efe(),i=Zhe-(r-n);if(n=r,i>0){if(++e>=Qhe)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function nfe(t){return function(){return t}}var xR=function(){try{var t=vy(Object,"defineProperty");return t({},"",{}),t}catch{}}(),rfe=xR?function(t,e){return xR(t,"toString",{configurable:!0,enumerable:!1,value:nfe(e),writable:!0})}:CE,ife=tfe(rfe);function rq(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function iq(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function sfe(t){return t!==t}function ofe(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function lB(t,e,n){return e===e?ofe(t,e,n):iq(t,sfe,n)}function sq(t,e){var n=t==null?0:t.length;return!!n&&lB(t,e,0)>-1}var afe=9007199254740991,cfe=/^(?:0|[1-9]\d*)$/;function dM(t,e){var n=typeof t;return e=e??afe,!!e&&(n=="number"||n!="symbol"&&cfe.test(t))&&t>-1&&t%1==0&&t<e}function uB(t,e,n){e=="__proto__"&&xR?xR(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Rw(t,e){return t===e||t!==t&&e!==e}var lfe=Object.prototype,ufe=lfe.hasOwnProperty;function hM(t,e,n){var r=t[e];(!(ufe.call(t,e)&&Rw(r,n))||n===void 0&&!(e in t))&&uB(t,e,n)}function dB(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?uB(n,a,c):hM(n,a,c)}return n}var bH=Math.max;function dfe(t,e,n){return e=bH(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=bH(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),Xhe(t,this,a)}}function hB(t,e){return ife(dfe(t,e,CE),t+"")}var hfe=9007199254740991;function fB(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=hfe}function Mp(t){return t!=null&&fB(t.length)&&!yg(t)}function oq(t,e,n){if(!Ud(n))return!1;var r=typeof e;return(r=="number"?Mp(n)&&dM(e,n.length):r=="string"&&e in n)?Rw(n[e],t):!1}function ffe(t){return hB(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&oq(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var pfe=Object.prototype;function Aw(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||pfe;return t===n}function mfe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var gfe="[object Arguments]";function EH(t){return Hh(t)&&C_(t)==gfe}var aq=Object.prototype,vfe=aq.hasOwnProperty,_fe=aq.propertyIsEnumerable,fM=EH(function(){return arguments}())?EH:function(t){return Hh(t)&&vfe.call(t,"callee")&&!_fe.call(t,"callee")};function yfe(){return!1}var cq=typeof Yu=="object"&&Yu&&!Yu.nodeType&&Yu,SH=cq&&typeof ic=="object"&&ic&&!ic.nodeType&&ic,bfe=SH&&SH.exports===cq,TH=bfe?Ap.Buffer:void 0,Efe=TH?TH.isBuffer:void 0,kT=Efe||yfe,Sfe="[object Arguments]",Tfe="[object Array]",wfe="[object Boolean]",xfe="[object Date]",Cfe="[object Error]",Rfe="[object Function]",Afe="[object Map]",Mfe="[object Number]",Ife="[object Object]",Ofe="[object RegExp]",kfe="[object Set]",Nfe="[object String]",Pfe="[object WeakMap]",Dfe="[object ArrayBuffer]",Lfe="[object DataView]",Ufe="[object Float32Array]",Ffe="[object Float64Array]",Bfe="[object Int8Array]",jfe="[object Int16Array]",$fe="[object Int32Array]",Hfe="[object Uint8Array]",Vfe="[object Uint8ClampedArray]",zfe="[object Uint16Array]",Gfe="[object Uint32Array]",Ls={};Ls[Ufe]=Ls[Ffe]=Ls[Bfe]=Ls[jfe]=Ls[$fe]=Ls[Hfe]=Ls[Vfe]=Ls[zfe]=Ls[Gfe]=!0;Ls[Sfe]=Ls[Tfe]=Ls[Dfe]=Ls[wfe]=Ls[Lfe]=Ls[xfe]=Ls[Cfe]=Ls[Rfe]=Ls[Afe]=Ls[Mfe]=Ls[Ife]=Ls[Ofe]=Ls[kfe]=Ls[Nfe]=Ls[Pfe]=!1;function Wfe(t){return Hh(t)&&fB(t.length)&&!!Ls[C_(t)]}function pM(t){return function(e){return t(e)}}var lq=typeof Yu=="object"&&Yu&&!Yu.nodeType&&Yu,mT=lq&&typeof ic=="object"&&ic&&!ic.nodeType&&ic,qfe=mT&&mT.exports===lq,yP=qfe&&eq.process,l_=function(){try{var t=mT&&mT.require&&mT.require("util").types;return t||yP&&yP.binding&&yP.binding("util")}catch{}}(),wH=l_&&l_.isTypedArray,pB=wH?pM(wH):Wfe,Kfe=Object.prototype,Yfe=Kfe.hasOwnProperty;function uq(t,e){var n=Ri(t),r=!n&&fM(t),i=!n&&!r&&kT(t),s=!n&&!r&&!i&&pB(t),o=n||r||i||s,a=o?mfe(t.length,String):[],c=a.length;for(var l in t)(e||Yfe.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||dM(l,c)))&&a.push(l);return a}function dq(t,e){return function(n){return t(e(n))}}var Xfe=dq(Object.keys,Object),Jfe=Object.prototype,Qfe=Jfe.hasOwnProperty;function hq(t){if(!Aw(t))return Xfe(t);var e=[];for(var n in Object(t))Qfe.call(t,n)&&n!="constructor"&&e.push(n);return e}function Fd(t){return Mp(t)?uq(t):hq(t)}var Zfe=Object.prototype,epe=Zfe.hasOwnProperty,hu=ffe(function(t,e){if(Aw(e)||Mp(e)){dB(e,Fd(e),t);return}for(var n in e)epe.call(e,n)&&hM(t,n,e[n])});function tpe(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var npe=Object.prototype,rpe=npe.hasOwnProperty;function ipe(t){if(!Ud(t))return tpe(t);var e=Aw(t),n=[];for(var r in t)r=="constructor"&&(e||!rpe.call(t,r))||n.push(r);return n}function fq(t){return Mp(t)?uq(t,!0):ipe(t)}var spe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ope=/^\w*$/;function mB(t,e){if(Ri(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||cM(t)?!0:ope.test(t)||!spe.test(t)||e!=null&&t in Object(e)}var NT=vy(Object,"create");function ape(){this.__data__=NT?NT(null):{},this.size=0}function cpe(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var lpe="__lodash_hash_undefined__",upe=Object.prototype,dpe=upe.hasOwnProperty;function hpe(t){var e=this.__data__;if(NT){var n=e[t];return n===lpe?void 0:n}return dpe.call(e,t)?e[t]:void 0}var fpe=Object.prototype,ppe=fpe.hasOwnProperty;function mpe(t){var e=this.__data__;return NT?e[t]!==void 0:ppe.call(e,t)}var gpe="__lodash_hash_undefined__";function vpe(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=NT&&e===void 0?gpe:e,this}function X0(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}X0.prototype.clear=ape;X0.prototype.delete=cpe;X0.prototype.get=hpe;X0.prototype.has=mpe;X0.prototype.set=vpe;function _pe(){this.__data__=[],this.size=0}function mM(t,e){for(var n=t.length;n--;)if(Rw(t[n][0],e))return n;return-1}var ype=Array.prototype,bpe=ype.splice;function Epe(t){var e=this.__data__,n=mM(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():bpe.call(e,n,1),--this.size,!0}function Spe(t){var e=this.__data__,n=mM(e,t);return n<0?void 0:e[n][1]}function Tpe(t){return mM(this.__data__,t)>-1}function wpe(t,e){var n=this.__data__,r=mM(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function bg(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}bg.prototype.clear=_pe;bg.prototype.delete=Epe;bg.prototype.get=Spe;bg.prototype.has=Tpe;bg.prototype.set=wpe;var PT=vy(Ap,"Map");function xpe(){this.size=0,this.__data__={hash:new X0,map:new(PT||bg),string:new X0}}function Cpe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function gM(t,e){var n=t.__data__;return Cpe(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Rpe(t){var e=gM(this,t).delete(t);return this.size-=e?1:0,e}function Ape(t){return gM(this,t).get(t)}function Mpe(t){return gM(this,t).has(t)}function Ipe(t,e){var n=gM(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Eg(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Eg.prototype.clear=xpe;Eg.prototype.delete=Rpe;Eg.prototype.get=Ape;Eg.prototype.has=Mpe;Eg.prototype.set=Ipe;var Ope="Expected a function";function gB(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ope);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(gB.Cache||Eg),n}gB.Cache=Eg;var kpe=500;function Npe(t){var e=gB(t,function(r){return n.size===kpe&&n.clear(),r}),n=e.cache;return e}var Ppe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Dpe=/\\(\\)?/g,Lpe=Npe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Ppe,function(n,r,i,s){e.push(i?s.replace(Dpe,"$1"):r||n)}),e});function pq(t){return t==null?"":nq(t)}function vM(t,e){return Ri(t)?t:mB(t,e)?[t]:Lpe(pq(t))}var Upe=1/0;function Mw(t){if(typeof t=="string"||cM(t))return t;var e=t+"";return e=="0"&&1/t==-Upe?"-0":e}function vB(t,e){e=vM(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[Mw(e[n++])];return n&&n==r?t:void 0}function Fpe(t,e,n){var r=t==null?void 0:vB(t,e);return r===void 0?n:r}function _B(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var xH=Ld?Ld.isConcatSpreadable:void 0;function Bpe(t){return Ri(t)||fM(t)||!!(xH&&t&&t[xH])}function yB(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=Bpe),i||(i=[]);++s<o;){var a=t[s];n(a)?_B(i,a):r||(i[i.length]=a)}return i}function lu(t){var e=t==null?0:t.length;return e?yB(t):[]}var mq=dq(Object.getPrototypeOf,Object);function bB(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function jpe(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:bB(t,e,n)}var $pe="\\ud800-\\udfff",Hpe="\\u0300-\\u036f",Vpe="\\ufe20-\\ufe2f",zpe="\\u20d0-\\u20ff",Gpe=Hpe+Vpe+zpe,Wpe="\\ufe0e\\ufe0f",qpe="\\u200d",Kpe=RegExp("["+qpe+$pe+Gpe+Wpe+"]");function gq(t){return Kpe.test(t)}function Ype(t){return t.split("")}var vq="\\ud800-\\udfff",Xpe="\\u0300-\\u036f",Jpe="\\ufe20-\\ufe2f",Qpe="\\u20d0-\\u20ff",Zpe=Xpe+Jpe+Qpe,eme="\\ufe0e\\ufe0f",tme="["+vq+"]",v2="["+Zpe+"]",_2="\\ud83c[\\udffb-\\udfff]",nme="(?:"+v2+"|"+_2+")",_q="[^"+vq+"]",yq="(?:\\ud83c[\\udde6-\\uddff]){2}",bq="[\\ud800-\\udbff][\\udc00-\\udfff]",rme="\\u200d",Eq=nme+"?",Sq="["+eme+"]?",ime="(?:"+rme+"(?:"+[_q,yq,bq].join("|")+")"+Sq+Eq+")*",sme=Sq+Eq+ime,ome="(?:"+[_q+v2+"?",v2,yq,bq,tme].join("|")+")",ame=RegExp(_2+"(?="+_2+")|"+ome+sme,"g");function cme(t){return t.match(ame)||[]}function lme(t){return gq(t)?cme(t):Ype(t)}function ume(t){return function(e){e=pq(e);var n=gq(e)?lme(e):void 0,r=n?n[0]:e.charAt(0),i=n?jpe(n,1).join(""):e.slice(1);return r[t]()+i}}var Tq=ume("toUpperCase");function dme(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function hme(){this.__data__=new bg,this.size=0}function fme(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function pme(t){return this.__data__.get(t)}function mme(t){return this.__data__.has(t)}var gme=200;function vme(t,e){var n=this.__data__;if(n instanceof bg){var r=n.__data__;if(!PT||r.length<gme-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Eg(r)}return n.set(t,e),this.size=n.size,this}function dp(t){var e=this.__data__=new bg(t);this.size=e.size}dp.prototype.clear=hme;dp.prototype.delete=fme;dp.prototype.get=pme;dp.prototype.has=mme;dp.prototype.set=vme;function _me(t,e){return t&&dB(e,Fd(e),t)}var wq=typeof Yu=="object"&&Yu&&!Yu.nodeType&&Yu,CH=wq&&typeof ic=="object"&&ic&&!ic.nodeType&&ic,yme=CH&&CH.exports===wq,RH=yme?Ap.Buffer:void 0,AH=RH?RH.allocUnsafe:void 0;function bme(t,e){var n=t.length,r=AH?AH(n):new t.constructor(n);return t.copy(r),r}function EB(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function xq(){return[]}var Eme=Object.prototype,Sme=Eme.propertyIsEnumerable,MH=Object.getOwnPropertySymbols,SB=MH?function(t){return t==null?[]:(t=Object(t),EB(MH(t),function(e){return Sme.call(t,e)}))}:xq;function Tme(t,e){return dB(t,SB(t),e)}var wme=Object.getOwnPropertySymbols,xme=wme?function(t){for(var e=[];t;)_B(e,SB(t)),t=mq(t);return e}:xq;function Cq(t,e,n){var r=e(t);return Ri(t)?r:_B(r,n(t))}function y2(t){return Cq(t,Fd,SB)}function Cme(t){return Cq(t,fq,xme)}var b2=vy(Ap,"DataView"),E2=vy(Ap,"Promise"),iE=vy(Ap,"Set"),IH="[object Map]",Rme="[object Object]",OH="[object Promise]",kH="[object Set]",NH="[object WeakMap]",PH="[object DataView]",Ame=gy(b2),Mme=gy(PT),Ime=gy(E2),Ome=gy(iE),kme=gy(g2),Cd=C_;(b2&&Cd(new b2(new ArrayBuffer(1)))!=PH||PT&&Cd(new PT)!=IH||E2&&Cd(E2.resolve())!=OH||iE&&Cd(new iE)!=kH||g2&&Cd(new g2)!=NH)&&(Cd=function(t){var e=C_(t),n=e==Rme?t.constructor:void 0,r=n?gy(n):"";if(r)switch(r){case Ame:return PH;case Mme:return IH;case Ime:return OH;case Ome:return kH;case kme:return NH}return e});var Nme=Object.prototype,Pme=Nme.hasOwnProperty;function Dme(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Pme.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var CR=Ap.Uint8Array;function Lme(t){var e=new t.constructor(t.byteLength);return new CR(e).set(new CR(t)),e}function Ume(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Fme=/\w*$/;function Bme(t){var e=new t.constructor(t.source,Fme.exec(t));return e.lastIndex=t.lastIndex,e}var DH=Ld?Ld.prototype:void 0,LH=DH?DH.valueOf:void 0;function jme(t){return LH?Object(LH.call(t)):{}}function $me(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var Hme="[object Boolean]",Vme="[object Date]",zme="[object Map]",Gme="[object Number]",Wme="[object RegExp]",qme="[object Set]",Kme="[object String]",Yme="[object Symbol]",Xme="[object ArrayBuffer]",Jme="[object DataView]",Qme="[object Float32Array]",Zme="[object Float64Array]",ege="[object Int8Array]",tge="[object Int16Array]",nge="[object Int32Array]",rge="[object Uint8Array]",ige="[object Uint8ClampedArray]",sge="[object Uint16Array]",oge="[object Uint32Array]";function age(t,e,n){var r=t.constructor;switch(e){case Xme:return Lme(t);case Hme:case Vme:return new r(+t);case Jme:return Ume(t);case Qme:case Zme:case ege:case tge:case nge:case rge:case ige:case sge:case oge:return $me(t);case zme:return new r;case Gme:case Kme:return new r(t);case Wme:return Bme(t);case qme:return new r;case Yme:return jme(t)}}function cge(t){return typeof t.constructor=="function"&&!Aw(t)?Yhe(mq(t)):{}}var lge="[object Map]";function uge(t){return Hh(t)&&Cd(t)==lge}var UH=l_&&l_.isMap,dge=UH?pM(UH):uge,hge="[object Set]";function fge(t){return Hh(t)&&Cd(t)==hge}var FH=l_&&l_.isSet,pge=FH?pM(FH):fge,Rq="[object Arguments]",mge="[object Array]",gge="[object Boolean]",vge="[object Date]",_ge="[object Error]",Aq="[object Function]",yge="[object GeneratorFunction]",bge="[object Map]",Ege="[object Number]",Mq="[object Object]",Sge="[object RegExp]",Tge="[object Set]",wge="[object String]",xge="[object Symbol]",Cge="[object WeakMap]",Rge="[object ArrayBuffer]",Age="[object DataView]",Mge="[object Float32Array]",Ige="[object Float64Array]",Oge="[object Int8Array]",kge="[object Int16Array]",Nge="[object Int32Array]",Pge="[object Uint8Array]",Dge="[object Uint8ClampedArray]",Lge="[object Uint16Array]",Uge="[object Uint32Array]",Ss={};Ss[Rq]=Ss[mge]=Ss[Rge]=Ss[Age]=Ss[gge]=Ss[vge]=Ss[Mge]=Ss[Ige]=Ss[Oge]=Ss[kge]=Ss[Nge]=Ss[bge]=Ss[Ege]=Ss[Mq]=Ss[Sge]=Ss[Tge]=Ss[wge]=Ss[xge]=Ss[Pge]=Ss[Dge]=Ss[Lge]=Ss[Uge]=!0;Ss[_ge]=Ss[Aq]=Ss[Cge]=!1;function wC(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!Ud(t))return t;var a=Ri(t);if(a)return o=Dme(t),Jhe(t,o);var c=Cd(t),l=c==Aq||c==yge;if(kT(t))return bme(t);if(c==Mq||c==Rq||l&&!i)return o=l?{}:cge(t),Tme(t,_me(o,t));if(!Ss[c])return i?t:{};o=age(t,c),s||(s=new dp);var u=s.get(t);if(u)return u;s.set(t,o),pge(t)?t.forEach(function(p){o.add(wC(p,e,n,p,t,s))}):dge(t)&&t.forEach(function(p,f){o.set(f,wC(p,e,n,f,t,s))});var d=y2,h=a?void 0:d(t);return rq(h||t,function(p,f){h&&(f=p,p=t[f]),hM(o,f,wC(p,e,n,f,t,s))}),o}var Fge=4;function Ic(t){return wC(t,Fge)}function Iw(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var Bge="__lodash_hash_undefined__";function jge(t){return this.__data__.set(t,Bge),this}function $ge(t){return this.__data__.has(t)}function RE(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Eg;++e<n;)this.add(t[e])}RE.prototype.add=RE.prototype.push=jge;RE.prototype.has=$ge;function Iq(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function TB(t,e){return t.has(e)}var Hge=1,Vge=2;function Oq(t,e,n,r,i,s){var o=n&Hge,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var d=-1,h=!0,p=n&Vge?new RE:void 0;for(s.set(t,e),s.set(e,t);++d<a;){var f=t[d],g=e[d];if(r)var y=o?r(g,f,d,e,t,s):r(f,g,d,t,e,s);if(y!==void 0){if(y)continue;h=!1;break}if(p){if(!Iq(e,function(E,w){if(!TB(p,w)&&(f===E||i(f,E,n,r,s)))return p.push(w)})){h=!1;break}}else if(!(f===g||i(f,g,n,r,s))){h=!1;break}}return s.delete(t),s.delete(e),h}function zge(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function wB(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var Gge=1,Wge=2,qge="[object Boolean]",Kge="[object Date]",Yge="[object Error]",Xge="[object Map]",Jge="[object Number]",Qge="[object RegExp]",Zge="[object Set]",eve="[object String]",tve="[object Symbol]",nve="[object ArrayBuffer]",rve="[object DataView]",BH=Ld?Ld.prototype:void 0,bP=BH?BH.valueOf:void 0;function ive(t,e,n,r,i,s,o){switch(n){case rve:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case nve:return!(t.byteLength!=e.byteLength||!s(new CR(t),new CR(e)));case qge:case Kge:case Jge:return Rw(+t,+e);case Yge:return t.name==e.name&&t.message==e.message;case Qge:case eve:return t==e+"";case Xge:var a=zge;case Zge:var c=r&Gge;if(a||(a=wB),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=Wge,o.set(t,e);var u=Oq(a(t),a(e),r,i,s,o);return o.delete(t),u;case tve:if(bP)return bP.call(t)==bP.call(e)}return!1}var sve=1,ove=Object.prototype,ave=ove.hasOwnProperty;function cve(t,e,n,r,i,s){var o=n&sve,a=y2(t),c=a.length,l=y2(e),u=l.length;if(c!=u&&!o)return!1;for(var d=c;d--;){var h=a[d];if(!(o?h in e:ave.call(e,h)))return!1}var p=s.get(t),f=s.get(e);if(p&&f)return p==e&&f==t;var g=!0;s.set(t,e),s.set(e,t);for(var y=o;++d<c;){h=a[d];var E=t[h],w=e[h];if(r)var R=o?r(w,E,h,e,t,s):r(E,w,h,t,e,s);if(!(R===void 0?E===w||i(E,w,n,r,s):R)){g=!1;break}y||(y=h=="constructor")}if(g&&!y){var A=t.constructor,k=e.constructor;A!=k&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof k=="function"&&k instanceof k)&&(g=!1)}return s.delete(t),s.delete(e),g}var lve=1,jH="[object Arguments]",$H="[object Array]",E1="[object Object]",uve=Object.prototype,HH=uve.hasOwnProperty;function dve(t,e,n,r,i,s){var o=Ri(t),a=Ri(e),c=o?$H:Cd(t),l=a?$H:Cd(e);c=c==jH?E1:c,l=l==jH?E1:l;var u=c==E1,d=l==E1,h=c==l;if(h&&kT(t)){if(!kT(e))return!1;o=!0,u=!1}if(h&&!u)return s||(s=new dp),o||pB(t)?Oq(t,e,n,r,i,s):ive(t,e,c,n,r,i,s);if(!(n&lve)){var p=u&&HH.call(t,"__wrapped__"),f=d&&HH.call(e,"__wrapped__");if(p||f){var g=p?t.value():t,y=f?e.value():e;return s||(s=new dp),i(g,y,n,r,s)}}return h?(s||(s=new dp),cve(t,e,n,r,i,s)):!1}function xB(t,e,n,r,i){return t===e?!0:t==null||e==null||!Hh(t)&&!Hh(e)?t!==t&&e!==e:dve(t,e,n,r,xB,i)}var hve=1,fve=2;function pve(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new dp,d;if(!(d===void 0?xB(l,c,hve|fve,r,u):d))return!1}}return!0}function kq(t){return t===t&&!Ud(t)}function mve(t){for(var e=Fd(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,kq(i)]}return e}function Nq(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function gve(t){var e=mve(t);return e.length==1&&e[0][2]?Nq(e[0][0],e[0][1]):function(n){return n===t||pve(n,t,e)}}function vve(t,e){return t!=null&&e in Object(t)}function Pq(t,e,n){e=vM(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=Mw(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&fB(i)&&dM(o,i)&&(Ri(t)||fM(t)))}function _ve(t,e){return t!=null&&Pq(t,e,vve)}var yve=1,bve=2;function Eve(t,e){return mB(t)&&kq(e)?Nq(Mw(t),e):function(n){var r=Fpe(n,t);return r===void 0&&r===e?_ve(n,t):xB(e,r,yve|bve)}}function Sve(t){return function(e){return e==null?void 0:e[t]}}function Tve(t){return function(e){return vB(e,t)}}function wve(t){return mB(t)?Sve(Mw(t)):Tve(t)}function Ip(t){return typeof t=="function"?t:t==null?CE:typeof t=="object"?Ri(t)?Eve(t[0],t[1]):gve(t):wve(t)}function xve(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Cve(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var Rve=Cve();function Ave(t,e){return t&&Rve(t,e,Fd)}function Mve(t,e){return function(n,r){if(n==null)return n;if(!Mp(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var _y=Mve(Ave);function Ive(t,e,n,r){return _y(t,function(i,s,o){e(r,i,n(i),o)}),r}function Ove(t,e){return function(n,r){var i=Ri(n)?xve:Ive,s=e?e():{};return i(n,t,Ip(r),s)}}var Dq=Object.prototype,kve=Dq.hasOwnProperty,CB=hB(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&oq(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=fq(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||Rw(u,Dq[l])&&!kve.call(t,l))&&(t[l]=s[l])}return t});function VH(t){return Hh(t)&&Mp(t)}var Nve=200;function Pve(t,e,n,r){var i=-1,s=sq,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=Nve&&(s=TB,o=!1,e=new RE(e));e:for(;++i<a;){var u=t[i],d=u;if(u=u!==0?u:0,o&&d===d){for(var h=l;h--;)if(e[h]===d)continue e;c.push(u)}else s(e,d,r)||c.push(u)}return c}var _M=hB(function(t,e){return VH(t)?Pve(t,yB(e,1,VH,!0)):[]});function AE(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Rc(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:uM(e),bB(t,e<0?0:e,r)):[]}function DT(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:uM(e),e=r-e,bB(t,0,e<0?0:e)):[]}function Dve(t){return typeof t=="function"?t:CE}function fr(t,e){var n=Ri(t)?rq:_y;return n(t,Dve(e))}function Lve(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Uve(t,e){var n=!0;return _y(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function jh(t,e,n){var r=Ri(t)?Lve:Uve;return r(t,Ip(e))}function Lq(t,e){var n=[];return _y(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Hd(t,e){var n=Ri(t)?EB:Lq;return n(t,Ip(e))}function Fve(t){return function(e,n,r){var i=Object(e);if(!Mp(e)){var s=Ip(n);e=Fd(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var Bve=Math.max;function jve(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:uM(n);return i<0&&(i=Bve(r+i,0)),iq(t,Ip(e),i)}var ME=Fve(jve);function Vh(t){return t&&t.length?t[0]:void 0}function $ve(t,e){var n=-1,r=Mp(t)?Array(t.length):[];return _y(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function wn(t,e){var n=Ri(t)?lM:$ve;return n(t,Ip(e))}function Pd(t,e){return yB(wn(t,e))}var Hve=Object.prototype,Vve=Hve.hasOwnProperty,Uq=Ove(function(t,e,n){Vve.call(t,n)?t[n].push(e):uB(t,n,[e])}),zve=Object.prototype,Gve=zve.hasOwnProperty;function Wve(t,e){return t!=null&&Gve.call(t,e)}function tr(t,e){return t!=null&&Pq(t,e,Wve)}var qve="[object String]";function fu(t){return typeof t=="string"||!Ri(t)&&Hh(t)&&C_(t)==qve}function Kve(t,e){return lM(e,function(n){return t[n]})}function la(t){return t==null?[]:Kve(t,Fd(t))}var Yve=Math.max;function Dl(t,e,n,r){t=Mp(t)?t:la(t),n=n&&!r?uM(n):0;var i=t.length;return n<0&&(n=Yve(i+n,0)),fu(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&lB(t,e,n)>-1}function zH(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return lB(t,e,i)}var Xve="[object Map]",Jve="[object Set]",Qve=Object.prototype,Zve=Qve.hasOwnProperty;function Cs(t){if(t==null)return!0;if(Mp(t)&&(Ri(t)||typeof t=="string"||typeof t.splice=="function"||kT(t)||pB(t)||fM(t)))return!t.length;var e=Cd(t);if(e==Xve||e==Jve)return!t.size;if(Aw(t))return!hq(t).length;for(var n in t)if(Zve.call(t,n))return!1;return!0}var e_e="[object RegExp]";function t_e(t){return Hh(t)&&C_(t)==e_e}var GH=l_&&l_.isRegExp,lg=GH?pM(GH):t_e;function ug(t){return t===void 0}var n_e="Expected a function";function r_e(t){if(typeof t!="function")throw new TypeError(n_e);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function i_e(t,e,n,r){if(!Ud(t))return t;e=vM(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=Mw(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=Ud(u)?u:dM(e[i+1])?[]:{})}hM(a,c,l),a=a[c]}return t}function s_e(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=vB(t,o);n(a,o)&&i_e(s,vM(o,t),a)}return s}function Jh(t,e){if(t==null)return{};var n=lM(Cme(t),function(r){return[r]});return e=Ip(e),s_e(t,n,function(r,i){return e(r,i[0])})}function o_e(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function pu(t,e,n){var r=Ri(t)?dme:o_e,i=arguments.length<3;return r(t,Ip(e),n,i,_y)}function yM(t,e){var n=Ri(t)?EB:Lq;return n(t,r_e(Ip(e)))}function a_e(t,e){var n;return _y(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function RB(t,e,n){var r=Ri(t)?Iq:a_e;return r(t,Ip(e))}var c_e=1/0,l_e=iE&&1/wB(new iE([,-0]))[1]==c_e?function(t){return new iE(t)}:Ra,u_e=200;function d_e(t,e,n){var r=-1,i=sq,s=t.length,o=!0,a=[],c=a;if(s>=u_e){var l=l_e(t);if(l)return wB(l);o=!1,i=TB,c=new RE}else c=a;e:for(;++r<s;){var u=t[r],d=u;if(u=u!==0?u:0,o&&d===d){for(var h=c.length;h--;)if(c[h]===d)continue e;a.push(u)}else i(c,d,n)||(c!==a&&c.push(d),a.push(u))}return a}function bM(t){return t&&t.length?d_e(t):[]}function S2(t){console&&console.error&&console.error(`Error: ${t}`)}function Fq(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function Bq(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function jq(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function h_e(t){return f_e(t)?t.LABEL:t.name}function f_e(t){return fu(t.LABEL)&&t.LABEL!==""}class Op{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),fr(this.definition,n=>{n.accept(e)})}}class mu extends Op{constructor(e){super([]),this.idx=1,hu(this,Jh(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class uS extends Op{constructor(e){super(e.definition),this.orgText="",hu(this,Jh(e,n=>n!==void 0))}}class gu extends Op{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,hu(this,Jh(e,n=>n!==void 0))}}class uu extends Op{constructor(e){super(e.definition),this.idx=1,hu(this,Jh(e,n=>n!==void 0))}}class kp extends Op{constructor(e){super(e.definition),this.idx=1,hu(this,Jh(e,n=>n!==void 0))}}class Np extends Op{constructor(e){super(e.definition),this.idx=1,hu(this,Jh(e,n=>n!==void 0))}}class Oa extends Op{constructor(e){super(e.definition),this.idx=1,hu(this,Jh(e,n=>n!==void 0))}}class Qh extends Op{constructor(e){super(e.definition),this.idx=1,hu(this,Jh(e,n=>n!==void 0))}}class Zh extends Op{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,hu(this,Jh(e,n=>n!==void 0))}}class co{constructor(e){this.idx=1,hu(this,Jh(e,n=>n!==void 0))}accept(e){e.visit(this)}}function p_e(t){return wn(t,xC)}function xC(t){function e(n){return wn(n,xC)}if(t instanceof mu){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return fu(t.label)&&(n.label=t.label),n}else{if(t instanceof gu)return{type:"Alternative",definition:e(t.definition)};if(t instanceof uu)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof kp)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Np)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:xC(new co({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Qh)return{type:"RepetitionWithSeparator",idx:t.idx,separator:xC(new co({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Oa)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Zh)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof co){const n={type:"Terminal",name:t.terminalType.name,label:h_e(t.terminalType),idx:t.idx};fu(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=lg(r)?r.source:r),n}else{if(t instanceof uS)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class yy{visit(e){const n=e;switch(n.constructor){case mu:return this.visitNonTerminal(n);case gu:return this.visitAlternative(n);case uu:return this.visitOption(n);case kp:return this.visitRepetitionMandatory(n);case Np:return this.visitRepetitionMandatoryWithSeparator(n);case Qh:return this.visitRepetitionWithSeparator(n);case Oa:return this.visitRepetition(n);case Zh:return this.visitAlternation(n);case co:return this.visitTerminal(n);case uS:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function m_e(t){return t instanceof gu||t instanceof uu||t instanceof Oa||t instanceof kp||t instanceof Np||t instanceof Qh||t instanceof co||t instanceof uS}function RR(t,e=[]){return t instanceof uu||t instanceof Oa||t instanceof Qh?!0:t instanceof Zh?RB(t.definition,r=>RR(r,e)):t instanceof mu&&Dl(e,t)?!1:t instanceof Op?(t instanceof mu&&e.push(t),jh(t.definition,r=>RR(r,e))):!1}function g_e(t){return t instanceof Zh}function Qf(t){if(t instanceof mu)return"SUBRULE";if(t instanceof uu)return"OPTION";if(t instanceof Zh)return"OR";if(t instanceof kp)return"AT_LEAST_ONE";if(t instanceof Np)return"AT_LEAST_ONE_SEP";if(t instanceof Qh)return"MANY_SEP";if(t instanceof Oa)return"MANY";if(t instanceof co)return"CONSUME";throw Error("non exhaustive match")}class EM{walk(e,n=[]){fr(e.definition,(r,i)=>{const s=Rc(e.definition,i+1);if(r instanceof mu)this.walkProdRef(r,s,n);else if(r instanceof co)this.walkTerminal(r,s,n);else if(r instanceof gu)this.walkFlat(r,s,n);else if(r instanceof uu)this.walkOption(r,s,n);else if(r instanceof kp)this.walkAtLeastOne(r,s,n);else if(r instanceof Np)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Qh)this.walkManySep(r,s,n);else if(r instanceof Oa)this.walkMany(r,s,n);else if(r instanceof Zh)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new uu({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=WH(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new uu({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=WH(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);fr(e.definition,s=>{const o=new gu({definition:[s]});this.walk(o,i)})}}function WH(t,e,n){return[new uu({definition:[new co({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function Ow(t){if(t instanceof mu)return Ow(t.referencedRule);if(t instanceof co)return y_e(t);if(m_e(t))return v_e(t);if(g_e(t))return __e(t);throw Error("non exhaustive match")}function v_e(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=RR(s),e=e.concat(Ow(s)),r=r+1,i=n.length>r;return bM(e)}function __e(t){const e=wn(t.definition,n=>Ow(n));return bM(lu(e))}function y_e(t){return[t.terminalType]}const $q="_~IN~_";class b_e extends EM{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=S_e(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new gu({definition:s}),a=Ow(o);this.follows[i]=a}}function E_e(t){const e={};return fr(t,n=>{const r=new b_e(n).startWalking();hu(e,r)}),e}function S_e(t,e){return t.name+e+$q}function mr(t){return t.charCodeAt(0)}function EP(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function FS(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function db(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function T_e(){throw Error("Internal Error - Should never get here!")}function qH(t){return t.type==="Character"}const AR=[];for(let t=mr("0");t<=mr("9");t++)AR.push(t);const MR=[mr("_")].concat(AR);for(let t=mr("a");t<=mr("z");t++)MR.push(t);for(let t=mr("A");t<=mr("Z");t++)MR.push(t);const KH=[mr(" "),mr("\f"),mr(`
`),mr("\r"),mr("	"),mr("\v"),mr("	"),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr(" "),mr("\u2028"),mr("\u2029"),mr(" "),mr(" "),mr("　"),mr("\uFEFF")],w_e=/[0-9a-fA-F]/,S1=/[0-9]/,x_e=/[1-9]/;class C_e{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":FS(r,"global");break;case"i":FS(r,"ignoreCase");break;case"m":FS(r,"multiLine");break;case"u":FS(r,"unicode");break;case"y":FS(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}db(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return T_e()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;db(n);break}if(!(e===!0&&n===void 0)&&db(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),db(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[mr(`
`),mr("\r"),mr("\u2028"),mr("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=AR;break;case"D":e=AR,n=!0;break;case"s":e=KH;break;case"S":e=KH,n=!0;break;case"w":e=MR;break;case"W":e=MR,n=!0;break}if(db(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=mr("\f");break;case"n":e=mr(`
`);break;case"r":e=mr("\r");break;case"t":e=mr("	");break;case"v":e=mr("\v");break}if(db(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:mr("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:mr(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:mr(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,qH(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,qH(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else EP(r.value,e),e.push(mr("-")),EP(i.value,e)}else EP(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:mr("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(x_e.test(e)===!1)throw Error("Expecting a positive integer");for(;S1.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(S1.test(e)===!1)throw Error("Expecting an integer");for(;S1.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:mr(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return S1.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(w_e.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class AB{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let CC={};const R_e=new C_e;function SM(t){const e=t.toString();if(CC.hasOwnProperty(e))return CC[e];{const n=R_e.pattern(e);return CC[e]=n,n}}function A_e(){CC={}}const Hq="Complement Sets are not supported for first char optimization",IR=`Unable to use "first char" lexer optimizations:
`;function M_e(t,e=!1){try{const n=SM(t);return T2(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Hq)e&&Fq(`${IR}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),S2(`${IR}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function T2(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)T2(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":T1(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(Hq);fr(o.value,c=>{if(typeof c=="number")T1(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)T1(u,e,n);else{for(let u=l.from;u<=l.to&&u<nT;u++)T1(u,e,n);if(l.to>=nT){const u=l.from>=nT?l.from:nT,d=l.to,h=u_(u),p=u_(d);for(let f=h;f<=p;f++)e[f]=f}}}});break;case"Group":T2(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&w2(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return la(e)}function T1(t,e,n){const r=u_(t);e[r]=r,n===!0&&I_e(t,e)}function I_e(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=u_(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=u_(i.charCodeAt(0));e[s]=s}}}function YH(t,e){return ME(t.value,n=>{if(typeof n=="number")return Dl(e,n);{const r=n;return ME(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function w2(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Ri(t.value)?jh(t.value,w2):w2(t.value):!1}class O_e extends AB{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Dl(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?YH(e,this.targetCharCodes)===void 0&&(this.found=!0):YH(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function MB(t,e){if(e instanceof RegExp){const n=SM(e),r=new O_e(t);return r.visit(n),r.found}else return ME(e,n=>Dl(t,n.charCodeAt(0)))!==void 0}const J0="PATTERN",tT="defaultMode",w1="modes";let Vq=typeof new RegExp("(?:)").sticky=="boolean";function k_e(t,e){e=CB(e,{useSticky:Vq,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(w,R)=>R()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{t0e()});let r;n("Reject Lexer.NA",()=>{r=yM(t,w=>w[J0]===Na.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=wn(r,w=>{const R=w[J0];if(lg(R)){const A=R.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!R.ignoreCase?A:A.length===2&&A[0]==="\\"&&!Dl(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?JH(R):XH(R)}else{if(yg(R))return i=!0,{exec:R};if(typeof R=="object")return i=!0,R;if(typeof R=="string"){if(R.length===1)return R;{const A=R.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),k=new RegExp(A);return e.useSticky?JH(k):XH(k)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=wn(r,w=>w.tokenTypeIdx),a=wn(r,w=>{const R=w.GROUP;if(R!==Na.SKIPPED){if(fu(R))return R;if(ug(R))return!1;throw Error("non exhaustive match")}}),c=wn(r,w=>{const R=w.LONGER_ALT;if(R)return Ri(R)?wn(R,k=>zH(r,k)):[zH(r,R)]}),l=wn(r,w=>w.PUSH_MODE),u=wn(r,w=>tr(w,"POP_MODE"))});let d;n("Line Terminator Handling",()=>{const w=Wq(e.lineTerminatorCharacters);d=wn(r,R=>!1),e.positionTracking!=="onlyOffset"&&(d=wn(r,R=>tr(R,"LINE_BREAKS")?!!R.LINE_BREAKS:Gq(R,w)===!1&&MB(w,R.PATTERN)))});let h,p,f,g;n("Misc Mapping #2",()=>{h=wn(r,zq),p=wn(s,Q_e),f=pu(r,(w,R)=>{const A=R.GROUP;return fu(A)&&A!==Na.SKIPPED&&(w[A]=[]),w},{}),g=wn(s,(w,R)=>({pattern:s[R],longerAlt:c[R],canLineTerminator:d[R],isCustom:h[R],short:p[R],group:a[R],push:l[R],pop:u[R],tokenTypeIdx:o[R],tokenType:r[R]}))});let y=!0,E=[];return e.safeMode||n("First Char Optimization",()=>{E=pu(r,(w,R,A)=>{if(typeof R.PATTERN=="string"){const k=R.PATTERN.charCodeAt(0),I=u_(k);SP(w,I,g[A])}else if(Ri(R.START_CHARS_HINT)){let k;fr(R.START_CHARS_HINT,I=>{const N=typeof I=="string"?I.charCodeAt(0):I,U=u_(N);k!==U&&(k=U,SP(w,U,g[A]))})}else if(lg(R.PATTERN))if(R.PATTERN.unicode)y=!1,e.ensureOptimizations&&S2(`${IR}	Unable to analyze < ${R.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const k=M_e(R.PATTERN,e.ensureOptimizations);Cs(k)&&(y=!1),fr(k,I=>{SP(w,I,g[A])})}else e.ensureOptimizations&&S2(`${IR}	TokenType: <${R.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),y=!1;return w},[])}),{emptyGroups:f,patternIdxToConfig:g,charCodeToPatternIdxToConfig:E,hasCustom:i,canBeOptimized:y}}function N_e(t,e){let n=[];const r=D_e(t);n=n.concat(r.errors);const i=L_e(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(P_e(s)),n=n.concat(z_e(s)),n=n.concat(G_e(s,e)),n=n.concat(W_e(s)),n}function P_e(t){let e=[];const n=Hd(t,r=>lg(r[J0]));return e=e.concat(F_e(n)),e=e.concat($_e(n)),e=e.concat(H_e(n)),e=e.concat(V_e(n)),e=e.concat(B_e(n)),e}function D_e(t){const e=Hd(t,i=>!tr(i,J0)),n=wn(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Eo.MISSING_PATTERN,tokenTypes:[i]})),r=_M(t,e);return{errors:n,valid:r}}function L_e(t){const e=Hd(t,i=>{const s=i[J0];return!lg(s)&&!yg(s)&&!tr(s,"exec")&&!fu(s)}),n=wn(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Eo.INVALID_PATTERN,tokenTypes:[i]})),r=_M(t,e);return{errors:n,valid:r}}const U_e=/[^\\][$]/;function F_e(t){class e extends AB{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Hd(t,i=>{const s=i.PATTERN;try{const o=SM(s),a=new e;return a.visit(o),a.found}catch{return U_e.test(s.source)}});return wn(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Eo.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function B_e(t){const e=Hd(t,r=>r.PATTERN.test(""));return wn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Eo.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const j_e=/[^\\[][\^]|^\^/;function $_e(t){class e extends AB{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Hd(t,i=>{const s=i.PATTERN;try{const o=SM(s),a=new e;return a.visit(o),a.found}catch{return j_e.test(s.source)}});return wn(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Eo.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function H_e(t){const e=Hd(t,r=>{const i=r[J0];return i instanceof RegExp&&(i.multiline||i.global)});return wn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Eo.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function V_e(t){const e=[];let n=wn(t,s=>pu(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Dl(e,a)&&a.PATTERN!==Na.NA&&(e.push(a),o.push(a)),o),[]));n=Iw(n);const r=Hd(n,s=>s.length>1);return wn(r,s=>{const o=wn(s,c=>c.name);return{message:`The same RegExp pattern ->${Vh(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Eo.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function z_e(t){const e=Hd(t,r=>{if(!tr(r,"GROUP"))return!1;const i=r.GROUP;return i!==Na.SKIPPED&&i!==Na.NA&&!fu(i)});return wn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Eo.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function G_e(t,e){const n=Hd(t,i=>i.PUSH_MODE!==void 0&&!Dl(e,i.PUSH_MODE));return wn(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Eo.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function W_e(t){const e=[],n=pu(t,(r,i,s)=>{const o=i.PATTERN;return o===Na.NA||(fu(o)?r.push({str:o,idx:s,tokenType:i}):lg(o)&&K_e(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return fr(t,(r,i)=>{fr(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&q_e(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Eo.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function q_e(t,e){if(lg(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(yg(e))return e(t,0,[],{});if(tr(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function K_e(t){return ME([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function XH(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function JH(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function Y_e(t,e,n){const r=[];return tr(t,tT)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+tT+`> property in its definition
`,type:Eo.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),tr(t,w1)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+w1+`> property in its definition
`,type:Eo.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),tr(t,w1)&&tr(t,tT)&&!tr(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${tT}: <${t.defaultMode}>which does not exist
`,type:Eo.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),tr(t,w1)&&fr(t.modes,(i,s)=>{fr(i,(o,a)=>{if(ug(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Eo.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(tr(o,"LONGER_ALT")){const c=Ri(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];fr(c,l=>{!ug(l)&&!Dl(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Eo.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function X_e(t,e,n){const r=[];let i=!1;const s=Iw(lu(la(t.modes))),o=yM(s,c=>c[J0]===Na.NA),a=Wq(n);return e&&fr(o,c=>{const l=Gq(c,a);if(l!==!1){const d={message:e0e(c,l),type:l.issue,tokenType:c};r.push(d)}else tr(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):MB(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Eo.NO_LINE_BREAKS_FLAGS}),r}function J_e(t){const e={},n=Fd(t);return fr(n,r=>{const i=t[r];if(Ri(i))e[r]=[];else throw Error("non exhaustive match")}),e}function zq(t){const e=t.PATTERN;if(lg(e))return!1;if(yg(e))return!0;if(tr(e,"exec"))return!0;if(fu(e))return!1;throw Error("non exhaustive match")}function Q_e(t){return fu(t)&&t.length===1?t.charCodeAt(0):!1}const Z_e={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Gq(t,e){if(tr(t,"LINE_BREAKS"))return!1;if(lg(t.PATTERN)){try{MB(e,t.PATTERN)}catch(n){return{issue:Eo.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(fu(t.PATTERN))return!1;if(zq(t))return{issue:Eo.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function e0e(t,e){if(e.issue===Eo.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Eo.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Wq(t){return wn(t,n=>fu(n)?n.charCodeAt(0):n)}function SP(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const nT=256;let RC=[];function u_(t){return t<nT?t:RC[t]}function t0e(){if(Cs(RC)){RC=new Array(65536);for(let t=0;t<65536;t++)RC[t]=t>255?255+~~(t/255):t}}function kw(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function OR(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let QH=1;const qq={};function Nw(t){const e=n0e(t);r0e(e),s0e(e),i0e(e),fr(e,n=>{n.isParent=n.categoryMatches.length>0})}function n0e(t){let e=Ic(t),n=t,r=!0;for(;r;){n=Iw(lu(wn(n,s=>s.CATEGORIES)));const i=_M(n,e);e=e.concat(i),Cs(i)?r=!1:n=i}return e}function r0e(t){fr(t,e=>{Yq(e)||(qq[QH]=e,e.tokenTypeIdx=QH++),ZH(e)&&!Ri(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),ZH(e)||(e.CATEGORIES=[]),o0e(e)||(e.categoryMatches=[]),a0e(e)||(e.categoryMatchesMap={})})}function i0e(t){fr(t,e=>{e.categoryMatches=[],fr(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(qq[r].tokenTypeIdx)})})}function s0e(t){fr(t,e=>{Kq([],e)})}function Kq(t,e){fr(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),fr(e.CATEGORIES,n=>{const r=t.concat(e);Dl(r,n)||Kq(r,n)})}function Yq(t){return tr(t,"tokenTypeIdx")}function ZH(t){return tr(t,"CATEGORIES")}function o0e(t){return tr(t,"categoryMatches")}function a0e(t){return tr(t,"categoryMatchesMap")}function c0e(t){return tr(t,"tokenTypeIdx")}const l0e={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var Eo;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Eo||(Eo={}));const rT={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:l0e,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(rT);let Na=class{constructor(e,n=rT){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Bq(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=hu({},rT,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===rT.lineTerminatorsPattern)this.config.lineTerminatorsPattern=Z_e;else if(this.config.lineTerminatorCharacters===rT.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Ri(e)?i={modes:{defaultMode:Ic(e)},defaultMode:tT}:(s=!1,i=Ic(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Y_e(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(X_e(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},fr(i.modes,(a,c)=>{i.modes[c]=yM(a,l=>ug(l))});const o=Fd(i.modes);if(fr(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(N_e(a,o))}),Cs(this.lexerDefinitionErrors)){Nw(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=k_e(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=hu({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Cs(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=wn(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}fr(this.lexerDefinitionWarning,a=>{Fq(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Vq?(this.chopInput=CE,this.match=this.matchWithTest):(this.updateLastIndex=Ra,this.match=this.matchWithExec),s&&(this.handleModes=Ra),this.trackStartLines===!1&&(this.computeNewColumn=CE),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Ra),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=pu(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!Cs(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{A_e()}),this.TRACE_INIT("toFastProperties",()=>{jq(this)})})}tokenize(e,n=this.defaultMode){if(!Cs(this.lexerDefinitionErrors)){const i=wn(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,d,h,p,f,g,y,E;const w=e,R=w.length;let A=0,k=0;const I=this.hasCustom?0:Math.floor(e.length/10),N=new Array(I),U=[];let F=this.trackStartLines?1:void 0,$=this.trackStartLines?1:void 0;const q=J_e(this.emptyGroups),K=this.trackStartLines,W=this.config.lineTerminatorsPattern;let X=0,ne=[],Z=[];const ie=[],G=[];Object.freeze(G);let Q;function se(){return ne}function ve(Ee){const Se=u_(Ee),Ie=Z[Se];return Ie===void 0?G:Ie}const Oe=Ee=>{if(ie.length===1&&Ee.tokenType.PUSH_MODE===void 0){const Se=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ee);U.push({offset:Ee.startOffset,line:Ee.startLine,column:Ee.startColumn,length:Ee.image.length,message:Se})}else{ie.pop();const Se=AE(ie);ne=this.patternIdxToConfig[Se],Z=this.charCodeToPatternIdxToConfig[Se],X=ne.length;const Ie=this.canModeBeOptimized[Se]&&this.config.safeMode===!1;Z&&Ie?Q=ve:Q=se}};function _e(Ee){ie.push(Ee),Z=this.charCodeToPatternIdxToConfig[Ee],ne=this.patternIdxToConfig[Ee],X=ne.length,X=ne.length;const Se=this.canModeBeOptimized[Ee]&&this.config.safeMode===!1;Z&&Se?Q=ve:Q=se}_e.call(this,n);let le;const xe=this.config.recoveryEnabled;for(;A<R;){c=null;const Ee=w.charCodeAt(A),Se=Q(Ee),Ie=Se.length;for(r=0;r<Ie;r++){le=Se[r];const Ze=le.pattern;l=null;const _t=le.short;if(_t!==!1?Ee===_t&&(c=Ze):le.isCustom===!0?(E=Ze.exec(w,A,N,q),E!==null?(c=E[0],E.payload!==void 0&&(l=E.payload)):c=null):(this.updateLastIndex(Ze,A),c=this.match(Ze,e,A)),c!==null){if(a=le.longerAlt,a!==void 0){const fe=a.length;for(s=0;s<fe;s++){const ge=ne[a[s]],rt=ge.pattern;if(u=null,ge.isCustom===!0?(E=rt.exec(w,A,N,q),E!==null?(o=E[0],E.payload!==void 0&&(u=E.payload)):o=null):(this.updateLastIndex(rt,A),o=this.match(rt,e,A)),o&&o.length>c.length){c=o,l=u,le=ge;break}}}break}}if(c!==null){if(d=c.length,h=le.group,h!==void 0&&(p=le.tokenTypeIdx,f=this.createTokenInstance(c,A,p,le.tokenType,F,$,d),this.handlePayload(f,l),h===!1?k=this.addToken(N,k,f):q[h].push(f)),e=this.chopInput(e,d),A=A+d,$=this.computeNewColumn($,d),K===!0&&le.canLineTerminator===!0){let Ze=0,_t,fe;W.lastIndex=0;do _t=W.test(c),_t===!0&&(fe=W.lastIndex-1,Ze++);while(_t===!0);Ze!==0&&(F=F+Ze,$=d-fe,this.updateTokenEndLineColumnLocation(f,h,fe,Ze,F,$,d))}this.handleModes(le,Oe,_e,f)}else{const Ze=A,_t=F,fe=$;let ge=xe===!1;for(;ge===!1&&A<R;)for(e=this.chopInput(e,1),A++,i=0;i<X;i++){const rt=ne[i],Re=rt.pattern,St=rt.short;if(St!==!1?w.charCodeAt(A)===St&&(ge=!0):rt.isCustom===!0?ge=Re.exec(w,A,N,q)!==null:(this.updateLastIndex(Re,A),ge=Re.exec(e)!==null),ge===!0)break}if(g=A-Ze,$=this.computeNewColumn($,g),y=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(w,Ze,g,_t,fe),U.push({offset:Ze,line:_t,column:fe,length:g,message:y}),xe===!1)break}}return this.hasCustom||(N.length=k),{tokens:N,groups:q,errors:U}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};Na.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";Na.NA=/NOT_APPLICABLE/;function gT(t){return Xq(t)?t.LABEL:t.name}function Xq(t){return fu(t.LABEL)&&t.LABEL!==""}const u0e="parent",e5="categories",t5="label",n5="group",r5="push_mode",i5="pop_mode",s5="longer_alt",o5="line_breaks",a5="start_chars_hint";function ed(t){return d0e(t)}function d0e(t){const e=t.pattern,n={};if(n.name=t.name,ug(e)||(n.PATTERN=e),tr(t,u0e))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return tr(t,e5)&&(n.CATEGORIES=t[e5]),Nw([n]),tr(t,t5)&&(n.LABEL=t[t5]),tr(t,n5)&&(n.GROUP=t[n5]),tr(t,i5)&&(n.POP_MODE=t[i5]),tr(t,r5)&&(n.PUSH_MODE=t[r5]),tr(t,s5)&&(n.LONGER_ALT=t[s5]),tr(t,o5)&&(n.LINE_BREAKS=t[o5]),tr(t,a5)&&(n.START_CHARS_HINT=t[a5]),n}const Q0=ed({name:"EOF",pattern:Na.NA});Nw([Q0]);function Pw(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function h0e(t,e){return kw(t,e)}const Jq={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Xq(t)?`--> ${gT(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Vh(e).image+"'";if(r)return s+r+a;{const c=pu(t,(h,p)=>h.concat(p),[]),l=wn(c,h=>`[${wn(h,p=>gT(p)).join(", ")}]`),d=`one of these possible Token sequences:
${wn(l,(h,p)=>`  ${p+1}. ${h}`).join(`
`)}`;return s+d+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Vh(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${wn(t,l=>`[${wn(l,u=>gT(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Jq);const f0e={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},k0={buildDuplicateFoundError(t,e){function n(u){return u instanceof co?u.terminalType.name:u instanceof mu?u.nonTerminalName:""}const r=t.name,i=Vh(e),s=i.idx,o=Qf(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=wn(t.prefixPath,i=>gT(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=wn(t.prefixPath,i=>gT(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Qf(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=wn(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof uS?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function p0e(t,e){const n=new m0e(t,e);return n.resolveRefs(),n.errors}class m0e extends yy{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){fr(la(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Ol.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class g0e extends EM{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ic(this.path.ruleStack).reverse(),this.occurrenceStack=Ic(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Cs(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class v0e extends g0e{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new gu({definition:i});this.possibleTokTypes=Ow(s),this.found=!0}}}class TM extends EM{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class _0e extends TM{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Vh(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof co&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class c5 extends TM{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Vh(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof co&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class y0e extends TM{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Vh(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof co&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class l5 extends TM{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Vh(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof co&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function x2(t,e,n=[]){n=Ic(n);let r=[],i=0;function s(a){return a.concat(Rc(t,i+1))}function o(a){const c=x2(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof gu)return o(a.definition);if(a instanceof mu)return o(a.definition);if(a instanceof uu)r=o(a.definition);else if(a instanceof kp){const c=a.definition.concat([new Oa({definition:a.definition})]);return o(c)}else if(a instanceof Np){const c=[new gu({definition:a.definition}),new Oa({definition:[new co({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Qh){const c=a.definition.concat([new Oa({definition:[new co({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Oa){const c=a.definition.concat([new Oa({definition:a.definition})]);r=o(c)}else{if(a instanceof Zh)return fr(a.definition,c=>{Cs(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof co)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Rc(t,i)}),r}function Qq(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],d=[];for(d.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Cs(d);){const h=d.pop();if(h===o){a&&AE(d).idx<=l&&d.pop();continue}const p=h.def,f=h.idx,g=h.ruleStack,y=h.occurrenceStack;if(Cs(p))continue;const E=p[0];if(E===i){const w={idx:f,def:Rc(p),ruleStack:DT(g),occurrenceStack:DT(y)};d.push(w)}else if(E instanceof co)if(f<c-1){const w=f+1,R=e[w];if(n(R,E.terminalType)){const A={idx:w,def:Rc(p),ruleStack:g,occurrenceStack:y};d.push(A)}}else if(f===c-1)u.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:g,occurrenceStack:y}),a=!0;else throw Error("non exhaustive match");else if(E instanceof mu){const w=Ic(g);w.push(E.nonTerminalName);const R=Ic(y);R.push(E.idx);const A={idx:f,def:E.definition.concat(s,Rc(p)),ruleStack:w,occurrenceStack:R};d.push(A)}else if(E instanceof uu){const w={idx:f,def:Rc(p),ruleStack:g,occurrenceStack:y};d.push(w),d.push(o);const R={idx:f,def:E.definition.concat(Rc(p)),ruleStack:g,occurrenceStack:y};d.push(R)}else if(E instanceof kp){const w=new Oa({definition:E.definition,idx:E.idx}),R=E.definition.concat([w],Rc(p)),A={idx:f,def:R,ruleStack:g,occurrenceStack:y};d.push(A)}else if(E instanceof Np){const w=new co({terminalType:E.separator}),R=new Oa({definition:[w].concat(E.definition),idx:E.idx}),A=E.definition.concat([R],Rc(p)),k={idx:f,def:A,ruleStack:g,occurrenceStack:y};d.push(k)}else if(E instanceof Qh){const w={idx:f,def:Rc(p),ruleStack:g,occurrenceStack:y};d.push(w),d.push(o);const R=new co({terminalType:E.separator}),A=new Oa({definition:[R].concat(E.definition),idx:E.idx}),k=E.definition.concat([A],Rc(p)),I={idx:f,def:k,ruleStack:g,occurrenceStack:y};d.push(I)}else if(E instanceof Oa){const w={idx:f,def:Rc(p),ruleStack:g,occurrenceStack:y};d.push(w),d.push(o);const R=new Oa({definition:E.definition,idx:E.idx}),A=E.definition.concat([R],Rc(p)),k={idx:f,def:A,ruleStack:g,occurrenceStack:y};d.push(k)}else if(E instanceof Zh)for(let w=E.definition.length-1;w>=0;w--){const R=E.definition[w],A={idx:f,def:R.definition.concat(Rc(p)),ruleStack:g,occurrenceStack:y};d.push(A),d.push(o)}else if(E instanceof gu)d.push({idx:f,def:E.definition.concat(Rc(p)),ruleStack:g,occurrenceStack:y});else if(E instanceof uS)d.push(b0e(E,f,g,y));else throw Error("non exhaustive match")}return u}function b0e(t,e,n,r){const i=Ic(n);i.push(t.name);const s=Ic(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var _o;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(_o||(_o={}));function Zq(t){if(t instanceof uu||t==="Option")return _o.OPTION;if(t instanceof Oa||t==="Repetition")return _o.REPETITION;if(t instanceof kp||t==="RepetitionMandatory")return _o.REPETITION_MANDATORY;if(t instanceof Np||t==="RepetitionMandatoryWithSeparator")return _o.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Qh||t==="RepetitionWithSeparator")return _o.REPETITION_WITH_SEPARATOR;if(t instanceof Zh||t==="Alternation")return _o.ALTERNATION;throw Error("non exhaustive match")}function E0e(t,e,n,r,i,s){const o=IB(t,e,n),a=n9(o)?OR:kw;return s(o,r,a,i)}function S0e(t,e,n,r,i,s){const o=OB(t,e,i,n),a=n9(o)?OR:kw;return s(o[0],a,r)}function T0e(t,e,n,r){const i=t.length,s=jh(t,o=>jh(o,a=>a.length===1));if(e)return function(o){const a=wn(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,d=a[c];if(!(d!==void 0&&d.call(this)===!1))e:for(let h=0;h<u;h++){const p=l[h],f=p.length;for(let g=0;g<f;g++){const y=this.LA(g+1);if(n(y,p[g])===!1)continue e}return c}}};if(s&&!r){const o=wn(t,c=>lu(c)),a=pu(o,(c,l,u)=>(fr(l,d=>{tr(c,d.tokenTypeIdx)||(c[d.tokenTypeIdx]=u),fr(d.categoryMatches,h=>{tr(c,h)||(c[h]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],d=u.length;for(let h=0;h<d;h++){const p=this.LA(h+1);if(n(p,u[h])===!1)continue e}return o}}}}function w0e(t,e,n){const r=jh(t,s=>s.length===1),i=t.length;if(r&&!n){const s=lu(t);if(s.length===1&&Cs(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=pu(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,fr(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class x0e extends EM{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,_o.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,_o.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,_o.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,_o.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,_o.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class e9 extends yy{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,_o.OPTION)}visitRepetition(e){this.checkIsTarget(e,_o.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,_o.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,_o.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,_o.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,_o.ALTERNATION)}}function u5(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function TP(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function C0e(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function t9(t,e){const n=wn(t,o=>x2([o],1)),r=u5(n.length),i=wn(n,o=>{const a={};return fr(o,c=>{const l=TP(c.partialPath);fr(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=u5(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const d=l[u].partialPath,h=l[u].suffixDef,p=TP(d);if(C0e(i,p,c)||Cs(h)||d.length===e){const g=r[c];if(C2(g,d)===!1){g.push(d);for(let y=0;y<p.length;y++){const E=p[y];i[c][E]=!0}}}else{const g=x2(h,o+1,d);s[c]=s[c].concat(g),fr(g,y=>{const E=TP(y.partialPath);fr(E,w=>{i[c][w]=!0})})}}}}return r}function IB(t,e,n,r){const i=new e9(t,_o.ALTERNATION,r);return e.accept(i),t9(i.result,n)}function OB(t,e,n,r){const i=new e9(t,n);e.accept(i);const s=i.result,a=new x0e(e,t,n).startWalking(),c=new gu({definition:s}),l=new gu({definition:a});return t9([c,l],r)}function C2(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function R0e(t,e){return t.length<e.length&&jh(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function n9(t){return jh(t,e=>jh(e,n=>jh(n,r=>Cs(r.categoryMatches))))}function A0e(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return wn(e,n=>Object.assign({type:Ol.CUSTOM_LOOKAHEAD_VALIDATION},n))}function M0e(t,e,n,r){const i=Pd(t,c=>I0e(c,n)),s=H0e(t,e,n),o=Pd(t,c=>F0e(c,n)),a=Pd(t,c=>N0e(c,t,r,n));return i.concat(s,o,a)}function I0e(t,e){const n=new k0e;t.accept(n);const r=n.allProductions,i=Uq(r,O0e),s=Jh(i,a=>a.length>1);return wn(la(s),a=>{const c=Vh(a),l=e.buildDuplicateFoundError(t,a),u=Qf(c),d={message:l,type:Ol.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},h=r9(c);return h&&(d.parameter=h),d})}function O0e(t){return`${Qf(t)}_#_${t.idx}_#_${r9(t)}`}function r9(t){return t instanceof co?t.terminalType.name:t instanceof mu?t.nonTerminalName:""}class k0e extends yy{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function N0e(t,e,n,r){const i=[];if(pu(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:Ol.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function P0e(t,e,n){const r=[];let i;return Dl(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Ol.INVALID_RULE_OVERRIDE,ruleName:t})),r}function i9(t,e,n,r=[]){const i=[],s=AC(e.definition);if(Cs(s))return[];{const o=t.name;Dl(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Ol.LEFT_RECURSION,ruleName:o});const c=_M(s,r.concat([t])),l=Pd(c,u=>{const d=Ic(r);return d.push(u),i9(t,u,n,d)});return i.concat(l)}}function AC(t){let e=[];if(Cs(t))return e;const n=Vh(t);if(n instanceof mu)e.push(n.referencedRule);else if(n instanceof gu||n instanceof uu||n instanceof kp||n instanceof Np||n instanceof Qh||n instanceof Oa)e=e.concat(AC(n.definition));else if(n instanceof Zh)e=lu(wn(n.definition,s=>AC(s.definition)));else if(!(n instanceof co))throw Error("non exhaustive match");const r=RR(n),i=t.length>1;if(r&&i){const s=Rc(t);return e.concat(AC(s))}else return e}class kB extends yy{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function D0e(t,e){const n=new kB;t.accept(n);const r=n.alternations;return Pd(r,s=>{const o=DT(s.definition);return Pd(o,(a,c)=>{const l=Qq([a],[],kw,1);return Cs(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Ol.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function L0e(t,e,n){const r=new kB;t.accept(r);let i=r.alternations;return i=yM(i,o=>o.ignoreAmbiguities===!0),Pd(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=IB(a,t,c,o),u=j0e(l,o,t,n),d=$0e(l,o,t,n);return u.concat(d)})}class U0e extends yy{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function F0e(t,e){const n=new kB;t.accept(n);const r=n.alternations;return Pd(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Ol.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function B0e(t,e,n){const r=[];return fr(t,i=>{const s=new U0e;i.accept(s);const o=s.allProductions;fr(o,a=>{const c=Zq(a),l=a.maxLookahead||e,u=a.idx,h=OB(u,i,c,l)[0];if(Cs(lu(h))){const p=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:p,type:Ol.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function j0e(t,e,n,r){const i=[],s=pu(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||fr(c,u=>{const d=[l];fr(t,(h,p)=>{l!==p&&C2(h,u)&&e.definition[p].ignoreAmbiguities!==!0&&d.push(p)}),d.length>1&&!C2(i,u)&&(i.push(u),a.push({alts:d,path:u}))}),a),[]);return wn(s,a=>{const c=wn(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Ol.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function $0e(t,e,n,r){const i=pu(t,(o,a,c)=>{const l=wn(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Iw(Pd(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Hd(i,h=>e.definition[h.idx].ignoreAmbiguities!==!0&&h.idx<c&&R0e(h.path,l));return wn(u,h=>{const p=[h.idx+1,c+1],f=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:p,prefixPath:h.path}),type:Ol.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:f,alternatives:p}})}))}function H0e(t,e,n){const r=[],i=wn(e,s=>s.name);return fr(t,s=>{const o=s.name;if(Dl(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Ol.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function V0e(t){const e=CB(t,{errMsgProvider:f0e}),n={};return fr(t.rules,r=>{n[r.name]=r}),p0e(n,e.errMsgProvider)}function z0e(t){return t=CB(t,{errMsgProvider:k0}),M0e(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const s9="MismatchedTokenException",o9="NoViableAltException",a9="EarlyExitException",c9="NotAllInputParsedException",l9=[s9,o9,a9,c9];Object.freeze(l9);function kR(t){return Dl(l9,t.name)}class wM extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class u9 extends wM{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=s9}}class G0e extends wM{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=o9}}class W0e extends wM{constructor(e,n){super(e,n),this.name=c9}}class q0e extends wM{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=a9}}const wP={},d9="InRuleRecoveryException";class K0e extends Error{constructor(e){super(e),this.name=d9}}class Y0e{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=tr(e,"recoveryEnabled")?e.recoveryEnabled:dg.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=X0e)}getTokenToInsert(e){const n=Pw(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const d=()=>{const h=this.LA(0),p=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:h,ruleName:this.getCurrRuleFullName()}),f=new u9(p,l,this.LA(0));f.resyncedTokens=DT(a),this.SAVE_ERROR(f)};for(;!c;)if(this.tokenMatcher(u,i)){d();return}else if(r.call(this)){d(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new K0e("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||Cs(n))return!1;const r=this.LA(1);return ME(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Dl(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=ME(e,s=>h0e(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return wP;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return wn(e,(r,i)=>i===0?wP:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=wn(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return lu(e)}getFollowSetFromFollowKey(e){if(e===wP)return[Q0];const n=e.ruleName+e.idxInCallingRule+$q+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Q0)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return DT(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Ic(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return wn(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function X0e(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const h=this.getCurrRuleFullName(),p=this.getGAstProductions()[h];c=new s(p,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const d=c.isEndOfRule;this.RULE_STACK.length===1&&d&&l===void 0&&(l=Q0,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const J0e=4,R_=8,h9=1<<R_,f9=2<<R_,R2=3<<R_,A2=4<<R_,M2=5<<R_,MC=6<<R_;function xP(t,e,n){return n|e|t}class Q0e{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:dg.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(Cs(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Pd(e,n=>i9(n,n,k0))}validateEmptyOrAlternatives(e){return Pd(e,n=>D0e(n,k0))}validateAmbiguousAlternationAlternatives(e,n){return Pd(e,r=>L0e(r,n,k0))}validateSomeNonEmptyLookaheadPath(e,n){return B0e(e,n,k0)}buildLookaheadForAlternation(e){return E0e(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,T0e)}buildLookaheadForOptional(e){return S0e(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Zq(e.prodType),w0e)}}class Z0e{initLooksAhead(e){this.dynamicTokensEnabled=tr(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:dg.dynamicTokensEnabled,this.maxLookahead=tr(e,"maxLookahead")?e.maxLookahead:dg.maxLookahead,this.lookaheadStrategy=tr(e,"lookaheadStrategy")?e.lookaheadStrategy:new Q0e({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){fr(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=tye(n);fr(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Qf(l)}${u}`,()=>{const d=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),h=xP(this.fullRuleNameToShort[n.name],h9,l.idx);this.setLaFuncCache(h,d)})}),fr(i,l=>{this.computeLookaheadFunc(n,l.idx,R2,"Repetition",l.maxLookahead,Qf(l))}),fr(s,l=>{this.computeLookaheadFunc(n,l.idx,f9,"Option",l.maxLookahead,Qf(l))}),fr(o,l=>{this.computeLookaheadFunc(n,l.idx,A2,"RepetitionMandatory",l.maxLookahead,Qf(l))}),fr(a,l=>{this.computeLookaheadFunc(n,l.idx,MC,"RepetitionMandatoryWithSeparator",l.maxLookahead,Qf(l))}),fr(c,l=>{this.computeLookaheadFunc(n,l.idx,M2,"RepetitionWithSeparator",l.maxLookahead,Qf(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=xP(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return xP(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class eye extends yy{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const x1=new eye;function tye(t){x1.reset(),t.accept(x1);const e=x1.dslMethods;return x1.reset(),e}function d5(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function h5(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function nye(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function rye(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const iye="name";function p9(t,e){Object.defineProperty(t,iye,{enumerable:!1,configurable:!0,writable:!1,value:e})}function sye(t,e){const n=Fd(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function oye(t,e){const n=function(){};p9(n,t+"BaseSemantics");const r={visit:function(i,s){if(Ri(i)&&(i=i[0]),!ug(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=cye(this,e);if(!Cs(i)){const s=wn(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function aye(t,e,n){const r=function(){};p9(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return fr(e,s=>{i[s]=sye}),r.prototype=i,r.prototype.constructor=r,r}var I2;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(I2||(I2={}));function cye(t,e){return lye(t,e)}function lye(t,e){const n=Hd(e,i=>yg(t[i])===!1),r=wn(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:I2.MISSING_METHOD,methodName:i}));return Iw(r)}class uye{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=tr(e,"nodeLocationTracking")?e.nodeLocationTracking:dg.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Ra,this.cstFinallyStateUpdate=Ra,this.cstPostTerminal=Ra,this.cstPostNonTerminal=Ra,this.cstPostRule=Ra;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=h5,this.setNodeLocationFromNode=h5,this.cstPostRule=Ra,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Ra,this.setNodeLocationFromNode=Ra,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=d5,this.setNodeLocationFromNode=d5,this.cstPostRule=Ra,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Ra,this.setNodeLocationFromNode=Ra,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Ra,this.setNodeLocationFromNode=Ra,this.cstPostRule=Ra,this.setInitialNodeLocation=Ra;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];nye(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];rye(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(ug(this.baseCstVisitorConstructor)){const e=oye(this.className,Fd(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ug(this.baseCstVisitorWithDefaultsConstructor)){const e=aye(this.className,Fd(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class dye{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):PR}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?PR:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class hye{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=DR){if(Dl(this.definedRulesNames,e)){const o={message:k0.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Ol.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=DR){const i=P0e(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(kR(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return p_e(la(this.gastProductionsCache))}}class fye{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=OR,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},tr(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Ri(e)){if(Cs(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Ri(e))this.tokensMap=pu(e,(s,o)=>(s[o.name]=o,s),{});else if(tr(e,"modes")&&jh(lu(la(e.modes)),c0e)){const s=lu(la(e.modes)),o=bM(s);this.tokensMap=pu(o,(a,c)=>(a[c.name]=c,a),{})}else if(Ud(e))this.tokensMap=Ic(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Q0;const r=tr(e,"modes")?lu(la(e.modes)):la(e),i=jh(r,s=>Cs(s.categoryMatches));this.tokenMatcher=i?OR:kw,Nw(la(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=tr(r,"resyncEnabled")?r.resyncEnabled:DR.resyncEnabled,s=tr(r,"recoveryValueFunc")?r.recoveryValueFunc:DR.recoveryValueFunc,o=this.ruleShortNameIdx<<J0e+R_;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const d=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(d),d}catch(d){return this.invokeRuleCatch(d,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(d){return this.invokeRuleCatch(d,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(kR(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(f9,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(A2,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,_o.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,A2,e,y0e)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(MC,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,l5],a,MC,e,l5)}else throw this.raiseEarlyExitException(e,_o.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(R2,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,R2,e,_0e,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(M2,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,c5],a,M2,e,c5)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,MC,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(h9,n),i=Ri(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new W0e(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw kR(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new u9(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===d9?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Ic(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Q0)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class pye{initErrorHandler(e){this._errors=[],this.errorMessageProvider=tr(e,"errorMessageProvider")?e.errorMessageProvider:dg.errorMessageProvider}SAVE_ERROR(e){if(kR(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ic(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ic(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=OB(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new q0e(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=IB(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new G0e(c,this.LA(1),a))}}class mye{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(ug(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Qq([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Vh(e.ruleStack),i=this.getGAstProductions()[n];return new v0e(i,e).startWalking()}}const xM={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(xM);const f5=!0,p5=Math.pow(2,R_)-1,m9=ed({name:"RECORDING_PHASE_TOKEN",pattern:Na.NA});Nw([m9]);const g9=Pw(m9,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(g9);const gye={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class vye{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return PR}topLevelRuleRecord(e,n){try{const r=new uS({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return BS.call(this,uu,e,n)}atLeastOneInternalRecord(e,n){BS.call(this,kp,n,e)}atLeastOneSepFirstInternalRecord(e,n){BS.call(this,Np,n,e,f5)}manyInternalRecord(e,n){BS.call(this,Oa,n,e)}manySepFirstInternalRecord(e,n){BS.call(this,Qh,n,e,f5)}orInternalRecord(e,n){return _ye.call(this,e,n)}subruleInternalRecord(e,n,r){if(NR(n),!e||tr(e,"ruleName")===!1){const a=new Error(`<SUBRULE${m5(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=AE(this.recordingProdStack),s=e.ruleName,o=new mu({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?gye:xM}consumeInternalRecord(e,n,r){if(NR(n),!Yq(e)){const o=new Error(`<CONSUME${m5(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=AE(this.recordingProdStack),s=new co({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),g9}}function BS(t,e,n,r=!1){NR(n);const i=AE(this.recordingProdStack),s=yg(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),tr(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),xM}function _ye(t,e){NR(e);const n=AE(this.recordingProdStack),r=Ri(t)===!1,i=r===!1?t:t.DEF,s=new Zh({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});tr(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=RB(i,a=>yg(a.GATE));return s.hasPredicates=o,n.definition.push(s),fr(i,a=>{const c=new gu({definition:[]});s.definition.push(c),tr(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:tr(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),xM}function m5(t){return t===0?"":`${t}`}function NR(t){if(t<0||t>p5){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${p5+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class yye{initPerformanceTracer(e){if(tr(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=dg.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=Bq(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function bye(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const PR=Pw(Q0,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(PR);const dg=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Jq,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),DR=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Ol;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Ol||(Ol={}));let NB=class v9{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{jq(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),fr(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=V0e({rules:la(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(Cs(r)&&this.skipValidations===!1){const i=z0e({rules:la(this.gastProductionsCache),tokenTypes:la(this.tokensMap),errMsgProvider:k0,grammarName:n}),s=A0e({lookaheadStrategy:this.lookaheadStrategy,rules:la(this.gastProductionsCache),tokenTypes:la(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Cs(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=E_e(la(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:la(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(la(this.gastProductionsCache))})),!v9.DEFER_DEFINITION_ERRORS_HANDLING&&!Cs(this.definitionErrors))throw e=wn(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),tr(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=tr(n,"skipValidations")?n.skipValidations:dg.skipValidations}};NB.DEFER_DEFINITION_ERRORS_HANDLING=!1;bye(NB,[Y0e,Z0e,uye,dye,fye,hye,pye,mye,vye,yye]);class Eye extends NB{constructor(e,n=dg){const r=Ic(n);r.outputCst=!0,super(e,r)}}function Sye(t){const e=new Tye,n=la(t);return wn(n,r=>e.visitRule(r))}class Tye extends yy{visitRule(e){const n=this.visitEach(e.definition),r=Uq(n,s=>s.propertyName),i=wn(r,(s,o)=>{const a=!RB(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=wn(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:C1(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:C1(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:C1(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:C1(e)}]}visitEachAndOverrideWith(e,n){return wn(this.visitEach(e),r=>hu({},r,n))}visitEach(e){return lu(wn(e,n=>this.visit(n)))}}function C1(t){return t instanceof mu?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function wye(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(lu(wn(t,r=>xye(r)))),e.includeVisitorInterface&&(n=n.concat(Mye(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function xye(t){const e=Cye(t),n=Rye(t);return[e,n]}function Cye(t){const e=_9(t.name),n=PB(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function Rye(t){return`export type ${PB(t.name)} = {
  ${wn(t.properties,n=>Aye(n)).join(`
  `)}
};`}function Aye(t){const e=Oye(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function Mye(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${wn(e,n=>Iye(n)).join(`
  `)}
}`}function Iye(t){const e=PB(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function Oye(t){if(Ri(t)){const e=bM(wn(t,r=>g5(r)));return"("+pu(e,(r,i)=>r+" | "+i)+")"}else return g5(t)}function g5(t){return t.kind==="token"?"IToken":_9(t.name)}function _9(t){return Tq(t)+"CstNode"}function PB(t){return Tq(t)+"CstChildren"}const kye={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function Nye(t,e){const n=Object.assign(Object.assign({},kye),e),r=Sye(t);return wye(r,n)}const O2=14,IE=3,Kv=8,Yv=14,kd=16,k2=16,y9=16;var b0=(t=>(t[t.BLANK=0]="BLANK",t[t.TILES=1]="TILES",t[t.SPRITES=2]="SPRITES",t[t.DITHER=3]="DITHER",t[t.MEDIA=4]="MEDIA",t[t.CONTROL=5]="CONTROL",t))(b0||{});function Pye(t){let e=0,n=0,r=0,i=0,s=1;return t.forEach(o=>{switch(o.type){case 1:e=Math.max(e,o.width),n=Math.max(n,o.height);break;case 3:e=Math.max(e,o.width),n=Math.max(n,o.height);break;case 5:r=o.focusx,i=o.focusy,s=o.viewscale;break}}),{width:e,height:n,focusx:r,focusy:i,viewscale:s}}function A_(t,e){return`${t}:${e}`}const b9=1,E9=16,S9=256;var Kt=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Kt||{});const vp=!!JSON.parse("false"),Dye=!!JSON.parse("false"),Lye=!!JSON.parse("false"),Uye=!!JSON.parse("false");JSON.parse("false");const Fye=!!JSON.parse("false"),Bye=!!JSON.parse("false"),jye=!!JSON.parse("false"),ar={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Kv*ar.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Yv*ar.DRAW_CHAR_SCALE}};function DB(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function $ye(t){return t[$v(0,t.length-1)]}function Hye(t,e){return e[BW(t,0,e.length-1)]}function Wu(...t){return $ye(t.flat())}function T9(t,...e){return Hye(t,e.flat())}function Vye(t){return[...new Set(t)].filter(he)}var w9={exports:{}},CP={exports:{}},v5;function zye(){return v5||(v5=1,function(t,e){(function(n,r){t.exports=r()})(Da,function(){function n(g){return!isNaN(parseFloat(g))&&isFinite(g)}function r(g){return g.charAt(0).toUpperCase()+g.substring(1)}function i(g){return function(){return this[g]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function d(g){if(g)for(var y=0;y<u.length;y++)g[u[y]]!==void 0&&this["set"+r(u[y])](g[u[y]])}d.prototype={getArgs:function(){return this.args},setArgs:function(g){if(Object.prototype.toString.call(g)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=g},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(g){if(g instanceof d)this.evalOrigin=g;else if(g instanceof Object)this.evalOrigin=new d(g);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var g=this.getFileName()||"",y=this.getLineNumber()||"",E=this.getColumnNumber()||"",w=this.getFunctionName()||"";return this.getIsEval()?g?"[eval] ("+g+":"+y+":"+E+")":"[eval]:"+y+":"+E:w?w+" ("+g+":"+y+":"+E+")":g+":"+y+":"+E}},d.fromString=function(y){var E=y.indexOf("("),w=y.lastIndexOf(")"),R=y.substring(0,E),A=y.substring(E+1,w).split(","),k=y.substring(w+1);if(k.indexOf("@")===0)var I=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(k,""),N=I[1],U=I[2],F=I[3];return new d({functionName:R,args:A||void 0,fileName:N,lineNumber:U||void 0,columnNumber:F||void 0})};for(var h=0;h<s.length;h++)d.prototype["get"+r(s[h])]=i(s[h]),d.prototype["set"+r(s[h])]=function(g){return function(y){this[g]=!!y}}(s[h]);for(var p=0;p<o.length;p++)d.prototype["get"+r(o[p])]=i(o[p]),d.prototype["set"+r(o[p])]=function(g){return function(y){if(!n(y))throw new TypeError(g+" must be a Number");this[g]=Number(y)}}(o[p]);for(var f=0;f<a.length;f++)d.prototype["get"+r(a[f])]=i(a[f]),d.prototype["set"+r(a[f])]=function(g){return function(y){this[g]=String(y)}}(a[f]);return d})}(CP)),CP.exports}(function(t,e){(function(n,r){t.exports=r(zye())})(Da,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var d=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),h=d.match(/ (\(.+\)$)/);d=h?d.replace(h[0],""):d;var p=this.extractLocation(h?h[1]:d),f=h&&d||void 0,g=["eval","<anonymous>"].indexOf(p[0])>-1?void 0:p[0];return new r({functionName:f,fileName:g,lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var d=/((.*".+"[^@]*)?[^@]*)(?:@)/,h=u.match(d),p=h&&h[1]?h[1]:void 0,f=this.extractLocation(u.replace(d,""));return new r({functionName:p,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),d=[],h=2,p=u.length;h<p;h+=2){var f=l.exec(u[h]);f&&d.push(new r({fileName:f[2],lineNumber:f[1],source:u[h]}))}return d},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),d=[],h=0,p=u.length;h<p;h+=2){var f=l.exec(u[h]);f&&d.push(new r({functionName:f[3]||void 0,fileName:f[2],lineNumber:f[1],source:u[h]}))}return d},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var d=u.split("@"),h=this.extractLocation(d.pop()),p=d.shift()||"",f=p.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,g;p.match(/\(([^)]*)\)/)&&(g=p.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var y=g===void 0||g==="[arguments not available]"?void 0:g.split(",");return new r({functionName:f,args:y,fileName:h[0],lineNumber:h[1],columnNumber:h[2],source:u})},this)}}})})(w9);var Gye=w9.exports;const Wye=Nl(Gye),qe=Xh("SOFTWARE");function Sg(t){const e={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function qye(t,e){return t%e}function Kye(t,e){return Math.floor(t/e)}function _5(t,e){return{x:qye(t,e),y:Kye(t,e)}}function LT(t,e){return t.x+t.y*e}function u0(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function dS(t){return he(t)&&he(t.x)&&he(t.y)}function Ta(t,e){switch(e){case pn.NORTH:--t.y;break;case pn.SOUTH:++t.y;break;case pn.WEST:--t.x;break;case pn.EAST:++t.x;break}return t}function Nv(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return pn.WEST;if(n>0)return pn.EAST;if(r<0)return pn.NORTH;if(r>0)return pn.SOUTH}const x9={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function Lh(t){return qr(t)&&C9(t[0])}function C9(t){return he(pn[t])&&nr(t)}function Yye(t){const e=pn[t];return he(e)?e:pn.IDLE}function R9(t){if(nr(t))return x9[rr(t)]}function y5(t){if(Lh(t))return t;if(C9(t))return[t];const e=R9(t);if(he(e))return[e]}function b5(t){const e=be.words[t],n=y5(e);if(Lh(n))return[n,t+1];const[r,i]=nc(t),s=y5(r);return Lh(s)?[s,i]:[void 0,t]}function N2(t){const e=[];let[n,r]=b5(t);for(;Lh(n);){if(e.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=Rt(be.words,r,[lt.NUMBER,lt.NUMBER]);e.push(o,a),r=c}const[i,s]=b5(r);n=i,r=s}return e.length?[e,r]:[void 0,t]}function OE(t){return qr(t)&&typeof t[0]=="string"}function E5(t){const e=be.words[t];if(OE(e))return[e,t+1];const[n,r]=JR(t),[i,s]=nc(r);return nr(i)?[[i,n],s]:[void 0,t]}function LR(t){if(!OE(t))return;const[e]=t;return e}function A9(t){if(!OE(t))return;const[,e]=t,n=he(e)?OY(e):void 0;return he(n)?n:void 0}function M9(t){if(!OE(t))return;const[,e]=t,n=he(e)?K1e(e):void 0;return he(n)?n:void 0}const ns=60,kl=25;var Dr=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Dr||{});function I9(t,e){const n=t??Gi.ISWALK,r=e??Gi.ISWALK;switch(n){case Gi.ISWALK:return r!==Gi.ISWALK;case Gi.ISSWIM:return r!==Gi.ISSWIM;case Gi.ISSOLID:return!0;case Gi.ISBULLET:return r!==Gi.ISWALK&&r!==Gi.ISSWIM}}function UR(t,e,n){const r=t==null?void 0:t.objects[n];if(he(r))return r;if(he(e)){const i=Dw(t,"player"),s={x:e.x??0,y:e.y??0};N9(s,i)}}function Dw(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(he)}function O9(t,e){const n=LR(e),r=A9(e),i=M9(e);return t.filter(s=>{var o,a,c;return!(he(n)&&rr((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||he(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Tr.WHITE)!==r||he(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Tr.BLACK)!==i)}).filter(he)}function k9(t,e){return he(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(he(i))return i;const s=Dw(t,rr(n));if(s.length)return s}else if(dS(n)&&n.x>=0&&n.x<ns&&n.y>=0&&n.y<kl){const i=n.x+n.y*ns,s=(r=t.lookup)==null?void 0:r[i];return he(s)?t.objects[s]:t.terrain[i]}}).flat().filter(he):[]}function N9(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var ja={},CM={};CM.byteLength=Qye;CM.toByteArray=ebe;CM.fromByteArray=rbe;var rp=[],wd=[],Xye=typeof Uint8Array<"u"?Uint8Array:Array,RP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var hb=0,Jye=RP.length;hb<Jye;++hb)rp[hb]=RP[hb],wd[RP.charCodeAt(hb)]=hb;wd[45]=62;wd[95]=63;function P9(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function Qye(t){var e=P9(t),n=e[0],r=e[1];return(n+r)*3/4-r}function Zye(t,e,n){return(e+n)*3/4-n}function ebe(t){var e,n=P9(t),r=n[0],i=n[1],s=new Xye(Zye(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=wd[t.charCodeAt(c)]<<18|wd[t.charCodeAt(c+1)]<<12|wd[t.charCodeAt(c+2)]<<6|wd[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=wd[t.charCodeAt(c)]<<2|wd[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=wd[t.charCodeAt(c)]<<10|wd[t.charCodeAt(c+1)]<<4|wd[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function tbe(t){return rp[t>>18&63]+rp[t>>12&63]+rp[t>>6&63]+rp[t&63]}function nbe(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(tbe(r));return i.join("")}function rbe(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(nbe(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(rp[e>>2]+rp[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(rp[e>>10]+rp[e>>4&63]+rp[e<<2&63]+"=")),i.join("")}var LB={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */LB.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,d=n?i-1:0,h=n?-1:1,p=t[e+d];for(d+=h,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=s*256+t[e+d],d+=h,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+d],d+=h,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(p?-1:1)*o*Math.pow(2,s-r)};LB.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,d=u>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,f=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+d>=1?e+=h/c:e+=h*Math.pow(2,1-d),e*c>=2&&(o++,c/=2),o+d>=u?(a=0,o=u):o+d>=1?(a=(e*c-1)*Math.pow(2,i),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;t[n+p]=a&255,p+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+p]=o&255,p+=f,o/=256,l-=8);t[n+p-f]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=CM,n=LB,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=k,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const ae=new s(1),j={foo:function(){return 42}};return Object.setPrototypeOf(j,s.prototype),Object.setPrototypeOf(ae,j),ae.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(ae){if(ae>i)throw new RangeError('The value "'+ae+'" is invalid for option "size"');const j=new s(ae);return Object.setPrototypeOf(j,u.prototype),j}function u(ae,j,V){if(typeof ae=="number"){if(typeof j=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(ae)}return d(ae,j,V)}u.poolSize=8192;function d(ae,j,V){if(typeof ae=="string")return g(ae,j);if(o.isView(ae))return E(ae);if(ae==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ae);if(We(ae,o)||ae&&We(ae.buffer,o)||typeof a<"u"&&(We(ae,a)||ae&&We(ae.buffer,a)))return w(ae,j,V);if(typeof ae=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const pe=ae.valueOf&&ae.valueOf();if(pe!=null&&pe!==ae)return u.from(pe,j,V);const Ne=R(ae);if(Ne)return Ne;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ae[Symbol.toPrimitive]=="function")return u.from(ae[Symbol.toPrimitive]("string"),j,V);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ae)}u.from=function(ae,j,V){return d(ae,j,V)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function h(ae){if(typeof ae!="number")throw new TypeError('"size" argument must be of type number');if(ae<0)throw new RangeError('The value "'+ae+'" is invalid for option "size"')}function p(ae,j,V){return h(ae),ae<=0?l(ae):j!==void 0?typeof V=="string"?l(ae).fill(j,V):l(ae).fill(j):l(ae)}u.alloc=function(ae,j,V){return p(ae,j,V)};function f(ae){return h(ae),l(ae<0?0:A(ae)|0)}u.allocUnsafe=function(ae){return f(ae)},u.allocUnsafeSlow=function(ae){return f(ae)};function g(ae,j){if((typeof j!="string"||j==="")&&(j="utf8"),!u.isEncoding(j))throw new TypeError("Unknown encoding: "+j);const V=I(ae,j)|0;let pe=l(V);const Ne=pe.write(ae,j);return Ne!==V&&(pe=pe.slice(0,Ne)),pe}function y(ae){const j=ae.length<0?0:A(ae.length)|0,V=l(j);for(let pe=0;pe<j;pe+=1)V[pe]=ae[pe]&255;return V}function E(ae){if(We(ae,s)){const j=new s(ae);return w(j.buffer,j.byteOffset,j.byteLength)}return y(ae)}function w(ae,j,V){if(j<0||ae.byteLength<j)throw new RangeError('"offset" is outside of buffer bounds');if(ae.byteLength<j+(V||0))throw new RangeError('"length" is outside of buffer bounds');let pe;return j===void 0&&V===void 0?pe=new s(ae):V===void 0?pe=new s(ae,j):pe=new s(ae,j,V),Object.setPrototypeOf(pe,u.prototype),pe}function R(ae){if(u.isBuffer(ae)){const j=A(ae.length)|0,V=l(j);return V.length===0||ae.copy(V,0,0,j),V}if(ae.length!==void 0)return typeof ae.length!="number"||ze(ae.length)?l(0):y(ae);if(ae.type==="Buffer"&&Array.isArray(ae.data))return y(ae.data)}function A(ae){if(ae>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return ae|0}function k(ae){return+ae!=ae&&(ae=0),u.alloc(+ae)}u.isBuffer=function(j){return j!=null&&j._isBuffer===!0&&j!==u.prototype},u.compare=function(j,V){if(We(j,s)&&(j=u.from(j,j.offset,j.byteLength)),We(V,s)&&(V=u.from(V,V.offset,V.byteLength)),!u.isBuffer(j)||!u.isBuffer(V))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(j===V)return 0;let pe=j.length,Ne=V.length;for(let Fe=0,dt=Math.min(pe,Ne);Fe<dt;++Fe)if(j[Fe]!==V[Fe]){pe=j[Fe],Ne=V[Fe];break}return pe<Ne?-1:Ne<pe?1:0},u.isEncoding=function(j){switch(String(j).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(j,V){if(!Array.isArray(j))throw new TypeError('"list" argument must be an Array of Buffers');if(j.length===0)return u.alloc(0);let pe;if(V===void 0)for(V=0,pe=0;pe<j.length;++pe)V+=j[pe].length;const Ne=u.allocUnsafe(V);let Fe=0;for(pe=0;pe<j.length;++pe){let dt=j[pe];if(We(dt,s))Fe+dt.length>Ne.length?(u.isBuffer(dt)||(dt=u.from(dt)),dt.copy(Ne,Fe)):s.prototype.set.call(Ne,dt,Fe);else if(u.isBuffer(dt))dt.copy(Ne,Fe);else throw new TypeError('"list" argument must be an Array of Buffers');Fe+=dt.length}return Ne};function I(ae,j){if(u.isBuffer(ae))return ae.length;if(o.isView(ae)||We(ae,o))return ae.byteLength;if(typeof ae!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ae);const V=ae.length,pe=arguments.length>2&&arguments[2]===!0;if(!pe&&V===0)return 0;let Ne=!1;for(;;)switch(j){case"ascii":case"latin1":case"binary":return V;case"utf8":case"utf-8":return $t(ae).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V*2;case"hex":return V>>>1;case"base64":return tt(ae).length;default:if(Ne)return pe?-1:$t(ae).length;j=(""+j).toLowerCase(),Ne=!0}}u.byteLength=I;function N(ae,j,V){let pe=!1;if((j===void 0||j<0)&&(j=0),j>this.length||((V===void 0||V>this.length)&&(V=this.length),V<=0)||(V>>>=0,j>>>=0,V<=j))return"";for(ae||(ae="utf8");;)switch(ae){case"hex":return Oe(this,j,V);case"utf8":case"utf-8":return ie(this,j,V);case"ascii":return se(this,j,V);case"latin1":case"binary":return ve(this,j,V);case"base64":return Z(this,j,V);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _e(this,j,V);default:if(pe)throw new TypeError("Unknown encoding: "+ae);ae=(ae+"").toLowerCase(),pe=!0}}u.prototype._isBuffer=!0;function U(ae,j,V){const pe=ae[j];ae[j]=ae[V],ae[V]=pe}u.prototype.swap16=function(){const j=this.length;if(j%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let V=0;V<j;V+=2)U(this,V,V+1);return this},u.prototype.swap32=function(){const j=this.length;if(j%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let V=0;V<j;V+=4)U(this,V,V+3),U(this,V+1,V+2);return this},u.prototype.swap64=function(){const j=this.length;if(j%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let V=0;V<j;V+=8)U(this,V,V+7),U(this,V+1,V+6),U(this,V+2,V+5),U(this,V+3,V+4);return this},u.prototype.toString=function(){const j=this.length;return j===0?"":arguments.length===0?ie(this,0,j):N.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(j){if(!u.isBuffer(j))throw new TypeError("Argument must be a Buffer");return this===j?!0:u.compare(this,j)===0},u.prototype.inspect=function(){let j="";const V=t.INSPECT_MAX_BYTES;return j=this.toString("hex",0,V).replace(/(.{2})/g,"$1 ").trim(),this.length>V&&(j+=" ... "),"<Buffer "+j+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(j,V,pe,Ne,Fe){if(We(j,s)&&(j=u.from(j,j.offset,j.byteLength)),!u.isBuffer(j))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof j);if(V===void 0&&(V=0),pe===void 0&&(pe=j?j.length:0),Ne===void 0&&(Ne=0),Fe===void 0&&(Fe=this.length),V<0||pe>j.length||Ne<0||Fe>this.length)throw new RangeError("out of range index");if(Ne>=Fe&&V>=pe)return 0;if(Ne>=Fe)return-1;if(V>=pe)return 1;if(V>>>=0,pe>>>=0,Ne>>>=0,Fe>>>=0,this===j)return 0;let dt=Fe-Ne,bt=pe-V;const Dn=Math.min(dt,bt),Ue=this.slice(Ne,Fe),Dt=j.slice(V,pe);for(let st=0;st<Dn;++st)if(Ue[st]!==Dt[st]){dt=Ue[st],bt=Dt[st];break}return dt<bt?-1:bt<dt?1:0};function F(ae,j,V,pe,Ne){if(ae.length===0)return-1;if(typeof V=="string"?(pe=V,V=0):V>2147483647?V=2147483647:V<-2147483648&&(V=-2147483648),V=+V,ze(V)&&(V=Ne?0:ae.length-1),V<0&&(V=ae.length+V),V>=ae.length){if(Ne)return-1;V=ae.length-1}else if(V<0)if(Ne)V=0;else return-1;if(typeof j=="string"&&(j=u.from(j,pe)),u.isBuffer(j))return j.length===0?-1:$(ae,j,V,pe,Ne);if(typeof j=="number")return j=j&255,typeof s.prototype.indexOf=="function"?Ne?s.prototype.indexOf.call(ae,j,V):s.prototype.lastIndexOf.call(ae,j,V):$(ae,[j],V,pe,Ne);throw new TypeError("val must be string, number or Buffer")}function $(ae,j,V,pe,Ne){let Fe=1,dt=ae.length,bt=j.length;if(pe!==void 0&&(pe=String(pe).toLowerCase(),pe==="ucs2"||pe==="ucs-2"||pe==="utf16le"||pe==="utf-16le")){if(ae.length<2||j.length<2)return-1;Fe=2,dt/=2,bt/=2,V/=2}function Dn(Dt,st){return Fe===1?Dt[st]:Dt.readUInt16BE(st*Fe)}let Ue;if(Ne){let Dt=-1;for(Ue=V;Ue<dt;Ue++)if(Dn(ae,Ue)===Dn(j,Dt===-1?0:Ue-Dt)){if(Dt===-1&&(Dt=Ue),Ue-Dt+1===bt)return Dt*Fe}else Dt!==-1&&(Ue-=Ue-Dt),Dt=-1}else for(V+bt>dt&&(V=dt-bt),Ue=V;Ue>=0;Ue--){let Dt=!0;for(let st=0;st<bt;st++)if(Dn(ae,Ue+st)!==Dn(j,st)){Dt=!1;break}if(Dt)return Ue}return-1}u.prototype.includes=function(j,V,pe){return this.indexOf(j,V,pe)!==-1},u.prototype.indexOf=function(j,V,pe){return F(this,j,V,pe,!0)},u.prototype.lastIndexOf=function(j,V,pe){return F(this,j,V,pe,!1)};function q(ae,j,V,pe){V=Number(V)||0;const Ne=ae.length-V;pe?(pe=Number(pe),pe>Ne&&(pe=Ne)):pe=Ne;const Fe=j.length;pe>Fe/2&&(pe=Fe/2);let dt;for(dt=0;dt<pe;++dt){const bt=parseInt(j.substr(dt*2,2),16);if(ze(bt))return dt;ae[V+dt]=bt}return dt}function K(ae,j,V,pe){return yt($t(j,ae.length-V),ae,V,pe)}function W(ae,j,V,pe){return yt(Ce(j),ae,V,pe)}function X(ae,j,V,pe){return yt(tt(j),ae,V,pe)}function ne(ae,j,V,pe){return yt(ue(j,ae.length-V),ae,V,pe)}u.prototype.write=function(j,V,pe,Ne){if(V===void 0)Ne="utf8",pe=this.length,V=0;else if(pe===void 0&&typeof V=="string")Ne=V,pe=this.length,V=0;else if(isFinite(V))V=V>>>0,isFinite(pe)?(pe=pe>>>0,Ne===void 0&&(Ne="utf8")):(Ne=pe,pe=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Fe=this.length-V;if((pe===void 0||pe>Fe)&&(pe=Fe),j.length>0&&(pe<0||V<0)||V>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ne||(Ne="utf8");let dt=!1;for(;;)switch(Ne){case"hex":return q(this,j,V,pe);case"utf8":case"utf-8":return K(this,j,V,pe);case"ascii":case"latin1":case"binary":return W(this,j,V,pe);case"base64":return X(this,j,V,pe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ne(this,j,V,pe);default:if(dt)throw new TypeError("Unknown encoding: "+Ne);Ne=(""+Ne).toLowerCase(),dt=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(ae,j,V){return j===0&&V===ae.length?e.fromByteArray(ae):e.fromByteArray(ae.slice(j,V))}function ie(ae,j,V){V=Math.min(ae.length,V);const pe=[];let Ne=j;for(;Ne<V;){const Fe=ae[Ne];let dt=null,bt=Fe>239?4:Fe>223?3:Fe>191?2:1;if(Ne+bt<=V){let Dn,Ue,Dt,st;switch(bt){case 1:Fe<128&&(dt=Fe);break;case 2:Dn=ae[Ne+1],(Dn&192)===128&&(st=(Fe&31)<<6|Dn&63,st>127&&(dt=st));break;case 3:Dn=ae[Ne+1],Ue=ae[Ne+2],(Dn&192)===128&&(Ue&192)===128&&(st=(Fe&15)<<12|(Dn&63)<<6|Ue&63,st>2047&&(st<55296||st>57343)&&(dt=st));break;case 4:Dn=ae[Ne+1],Ue=ae[Ne+2],Dt=ae[Ne+3],(Dn&192)===128&&(Ue&192)===128&&(Dt&192)===128&&(st=(Fe&15)<<18|(Dn&63)<<12|(Ue&63)<<6|Dt&63,st>65535&&st<1114112&&(dt=st))}}dt===null?(dt=65533,bt=1):dt>65535&&(dt-=65536,pe.push(dt>>>10&1023|55296),dt=56320|dt&1023),pe.push(dt),Ne+=bt}return Q(pe)}const G=4096;function Q(ae){const j=ae.length;if(j<=G)return String.fromCharCode.apply(String,ae);let V="",pe=0;for(;pe<j;)V+=String.fromCharCode.apply(String,ae.slice(pe,pe+=G));return V}function se(ae,j,V){let pe="";V=Math.min(ae.length,V);for(let Ne=j;Ne<V;++Ne)pe+=String.fromCharCode(ae[Ne]&127);return pe}function ve(ae,j,V){let pe="";V=Math.min(ae.length,V);for(let Ne=j;Ne<V;++Ne)pe+=String.fromCharCode(ae[Ne]);return pe}function Oe(ae,j,V){const pe=ae.length;(!j||j<0)&&(j=0),(!V||V<0||V>pe)&&(V=pe);let Ne="";for(let Fe=j;Fe<V;++Fe)Ne+=Vt[ae[Fe]];return Ne}function _e(ae,j,V){const pe=ae.slice(j,V);let Ne="";for(let Fe=0;Fe<pe.length-1;Fe+=2)Ne+=String.fromCharCode(pe[Fe]+pe[Fe+1]*256);return Ne}u.prototype.slice=function(j,V){const pe=this.length;j=~~j,V=V===void 0?pe:~~V,j<0?(j+=pe,j<0&&(j=0)):j>pe&&(j=pe),V<0?(V+=pe,V<0&&(V=0)):V>pe&&(V=pe),V<j&&(V=j);const Ne=this.subarray(j,V);return Object.setPrototypeOf(Ne,u.prototype),Ne};function le(ae,j,V){if(ae%1!==0||ae<0)throw new RangeError("offset is not uint");if(ae+j>V)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(j,V,pe){j=j>>>0,V=V>>>0,pe||le(j,V,this.length);let Ne=this[j],Fe=1,dt=0;for(;++dt<V&&(Fe*=256);)Ne+=this[j+dt]*Fe;return Ne},u.prototype.readUintBE=u.prototype.readUIntBE=function(j,V,pe){j=j>>>0,V=V>>>0,pe||le(j,V,this.length);let Ne=this[j+--V],Fe=1;for(;V>0&&(Fe*=256);)Ne+=this[j+--V]*Fe;return Ne},u.prototype.readUint8=u.prototype.readUInt8=function(j,V){return j=j>>>0,V||le(j,1,this.length),this[j]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(j,V){return j=j>>>0,V||le(j,2,this.length),this[j]|this[j+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(j,V){return j=j>>>0,V||le(j,2,this.length),this[j]<<8|this[j+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(j,V){return j=j>>>0,V||le(j,4,this.length),(this[j]|this[j+1]<<8|this[j+2]<<16)+this[j+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(j,V){return j=j>>>0,V||le(j,4,this.length),this[j]*16777216+(this[j+1]<<16|this[j+2]<<8|this[j+3])},u.prototype.readBigUInt64LE=xt(function(j){j=j>>>0,Ge(j,"offset");const V=this[j],pe=this[j+7];(V===void 0||pe===void 0)&&kt(j,this.length-8);const Ne=V+this[++j]*2**8+this[++j]*2**16+this[++j]*2**24,Fe=this[++j]+this[++j]*2**8+this[++j]*2**16+pe*2**24;return BigInt(Ne)+(BigInt(Fe)<<BigInt(32))}),u.prototype.readBigUInt64BE=xt(function(j){j=j>>>0,Ge(j,"offset");const V=this[j],pe=this[j+7];(V===void 0||pe===void 0)&&kt(j,this.length-8);const Ne=V*2**24+this[++j]*2**16+this[++j]*2**8+this[++j],Fe=this[++j]*2**24+this[++j]*2**16+this[++j]*2**8+pe;return(BigInt(Ne)<<BigInt(32))+BigInt(Fe)}),u.prototype.readIntLE=function(j,V,pe){j=j>>>0,V=V>>>0,pe||le(j,V,this.length);let Ne=this[j],Fe=1,dt=0;for(;++dt<V&&(Fe*=256);)Ne+=this[j+dt]*Fe;return Fe*=128,Ne>=Fe&&(Ne-=Math.pow(2,8*V)),Ne},u.prototype.readIntBE=function(j,V,pe){j=j>>>0,V=V>>>0,pe||le(j,V,this.length);let Ne=V,Fe=1,dt=this[j+--Ne];for(;Ne>0&&(Fe*=256);)dt+=this[j+--Ne]*Fe;return Fe*=128,dt>=Fe&&(dt-=Math.pow(2,8*V)),dt},u.prototype.readInt8=function(j,V){return j=j>>>0,V||le(j,1,this.length),this[j]&128?(255-this[j]+1)*-1:this[j]},u.prototype.readInt16LE=function(j,V){j=j>>>0,V||le(j,2,this.length);const pe=this[j]|this[j+1]<<8;return pe&32768?pe|4294901760:pe},u.prototype.readInt16BE=function(j,V){j=j>>>0,V||le(j,2,this.length);const pe=this[j+1]|this[j]<<8;return pe&32768?pe|4294901760:pe},u.prototype.readInt32LE=function(j,V){return j=j>>>0,V||le(j,4,this.length),this[j]|this[j+1]<<8|this[j+2]<<16|this[j+3]<<24},u.prototype.readInt32BE=function(j,V){return j=j>>>0,V||le(j,4,this.length),this[j]<<24|this[j+1]<<16|this[j+2]<<8|this[j+3]},u.prototype.readBigInt64LE=xt(function(j){j=j>>>0,Ge(j,"offset");const V=this[j],pe=this[j+7];(V===void 0||pe===void 0)&&kt(j,this.length-8);const Ne=this[j+4]+this[j+5]*2**8+this[j+6]*2**16+(pe<<24);return(BigInt(Ne)<<BigInt(32))+BigInt(V+this[++j]*2**8+this[++j]*2**16+this[++j]*2**24)}),u.prototype.readBigInt64BE=xt(function(j){j=j>>>0,Ge(j,"offset");const V=this[j],pe=this[j+7];(V===void 0||pe===void 0)&&kt(j,this.length-8);const Ne=(V<<24)+this[++j]*2**16+this[++j]*2**8+this[++j];return(BigInt(Ne)<<BigInt(32))+BigInt(this[++j]*2**24+this[++j]*2**16+this[++j]*2**8+pe)}),u.prototype.readFloatLE=function(j,V){return j=j>>>0,V||le(j,4,this.length),n.read(this,j,!0,23,4)},u.prototype.readFloatBE=function(j,V){return j=j>>>0,V||le(j,4,this.length),n.read(this,j,!1,23,4)},u.prototype.readDoubleLE=function(j,V){return j=j>>>0,V||le(j,8,this.length),n.read(this,j,!0,52,8)},u.prototype.readDoubleBE=function(j,V){return j=j>>>0,V||le(j,8,this.length),n.read(this,j,!1,52,8)};function xe(ae,j,V,pe,Ne,Fe){if(!u.isBuffer(ae))throw new TypeError('"buffer" argument must be a Buffer instance');if(j>Ne||j<Fe)throw new RangeError('"value" argument is out of bounds');if(V+pe>ae.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(j,V,pe,Ne){if(j=+j,V=V>>>0,pe=pe>>>0,!Ne){const bt=Math.pow(2,8*pe)-1;xe(this,j,V,pe,bt,0)}let Fe=1,dt=0;for(this[V]=j&255;++dt<pe&&(Fe*=256);)this[V+dt]=j/Fe&255;return V+pe},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(j,V,pe,Ne){if(j=+j,V=V>>>0,pe=pe>>>0,!Ne){const bt=Math.pow(2,8*pe)-1;xe(this,j,V,pe,bt,0)}let Fe=pe-1,dt=1;for(this[V+Fe]=j&255;--Fe>=0&&(dt*=256);)this[V+Fe]=j/dt&255;return V+pe},u.prototype.writeUint8=u.prototype.writeUInt8=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,1,255,0),this[V]=j&255,V+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,2,65535,0),this[V]=j&255,this[V+1]=j>>>8,V+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,2,65535,0),this[V]=j>>>8,this[V+1]=j&255,V+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,4,4294967295,0),this[V+3]=j>>>24,this[V+2]=j>>>16,this[V+1]=j>>>8,this[V]=j&255,V+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,4,4294967295,0),this[V]=j>>>24,this[V+1]=j>>>16,this[V+2]=j>>>8,this[V+3]=j&255,V+4};function Ee(ae,j,V,pe,Ne){St(j,pe,Ne,ae,V,7);let Fe=Number(j&BigInt(4294967295));ae[V++]=Fe,Fe=Fe>>8,ae[V++]=Fe,Fe=Fe>>8,ae[V++]=Fe,Fe=Fe>>8,ae[V++]=Fe;let dt=Number(j>>BigInt(32)&BigInt(4294967295));return ae[V++]=dt,dt=dt>>8,ae[V++]=dt,dt=dt>>8,ae[V++]=dt,dt=dt>>8,ae[V++]=dt,V}function Se(ae,j,V,pe,Ne){St(j,pe,Ne,ae,V,7);let Fe=Number(j&BigInt(4294967295));ae[V+7]=Fe,Fe=Fe>>8,ae[V+6]=Fe,Fe=Fe>>8,ae[V+5]=Fe,Fe=Fe>>8,ae[V+4]=Fe;let dt=Number(j>>BigInt(32)&BigInt(4294967295));return ae[V+3]=dt,dt=dt>>8,ae[V+2]=dt,dt=dt>>8,ae[V+1]=dt,dt=dt>>8,ae[V]=dt,V+8}u.prototype.writeBigUInt64LE=xt(function(j,V=0){return Ee(this,j,V,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=xt(function(j,V=0){return Se(this,j,V,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(j,V,pe,Ne){if(j=+j,V=V>>>0,!Ne){const Dn=Math.pow(2,8*pe-1);xe(this,j,V,pe,Dn-1,-Dn)}let Fe=0,dt=1,bt=0;for(this[V]=j&255;++Fe<pe&&(dt*=256);)j<0&&bt===0&&this[V+Fe-1]!==0&&(bt=1),this[V+Fe]=(j/dt>>0)-bt&255;return V+pe},u.prototype.writeIntBE=function(j,V,pe,Ne){if(j=+j,V=V>>>0,!Ne){const Dn=Math.pow(2,8*pe-1);xe(this,j,V,pe,Dn-1,-Dn)}let Fe=pe-1,dt=1,bt=0;for(this[V+Fe]=j&255;--Fe>=0&&(dt*=256);)j<0&&bt===0&&this[V+Fe+1]!==0&&(bt=1),this[V+Fe]=(j/dt>>0)-bt&255;return V+pe},u.prototype.writeInt8=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,1,127,-128),j<0&&(j=255+j+1),this[V]=j&255,V+1},u.prototype.writeInt16LE=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,2,32767,-32768),this[V]=j&255,this[V+1]=j>>>8,V+2},u.prototype.writeInt16BE=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,2,32767,-32768),this[V]=j>>>8,this[V+1]=j&255,V+2},u.prototype.writeInt32LE=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,4,2147483647,-2147483648),this[V]=j&255,this[V+1]=j>>>8,this[V+2]=j>>>16,this[V+3]=j>>>24,V+4},u.prototype.writeInt32BE=function(j,V,pe){return j=+j,V=V>>>0,pe||xe(this,j,V,4,2147483647,-2147483648),j<0&&(j=4294967295+j+1),this[V]=j>>>24,this[V+1]=j>>>16,this[V+2]=j>>>8,this[V+3]=j&255,V+4},u.prototype.writeBigInt64LE=xt(function(j,V=0){return Ee(this,j,V,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=xt(function(j,V=0){return Se(this,j,V,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ie(ae,j,V,pe,Ne,Fe){if(V+pe>ae.length)throw new RangeError("Index out of range");if(V<0)throw new RangeError("Index out of range")}function Ze(ae,j,V,pe,Ne){return j=+j,V=V>>>0,Ne||Ie(ae,j,V,4),n.write(ae,j,V,pe,23,4),V+4}u.prototype.writeFloatLE=function(j,V,pe){return Ze(this,j,V,!0,pe)},u.prototype.writeFloatBE=function(j,V,pe){return Ze(this,j,V,!1,pe)};function _t(ae,j,V,pe,Ne){return j=+j,V=V>>>0,Ne||Ie(ae,j,V,8),n.write(ae,j,V,pe,52,8),V+8}u.prototype.writeDoubleLE=function(j,V,pe){return _t(this,j,V,!0,pe)},u.prototype.writeDoubleBE=function(j,V,pe){return _t(this,j,V,!1,pe)},u.prototype.copy=function(j,V,pe,Ne){if(!u.isBuffer(j))throw new TypeError("argument should be a Buffer");if(pe||(pe=0),!Ne&&Ne!==0&&(Ne=this.length),V>=j.length&&(V=j.length),V||(V=0),Ne>0&&Ne<pe&&(Ne=pe),Ne===pe||j.length===0||this.length===0)return 0;if(V<0)throw new RangeError("targetStart out of bounds");if(pe<0||pe>=this.length)throw new RangeError("Index out of range");if(Ne<0)throw new RangeError("sourceEnd out of bounds");Ne>this.length&&(Ne=this.length),j.length-V<Ne-pe&&(Ne=j.length-V+pe);const Fe=Ne-pe;return this===j&&typeof s.prototype.copyWithin=="function"?this.copyWithin(V,pe,Ne):s.prototype.set.call(j,this.subarray(pe,Ne),V),Fe},u.prototype.fill=function(j,V,pe,Ne){if(typeof j=="string"){if(typeof V=="string"?(Ne=V,V=0,pe=this.length):typeof pe=="string"&&(Ne=pe,pe=this.length),Ne!==void 0&&typeof Ne!="string")throw new TypeError("encoding must be a string");if(typeof Ne=="string"&&!u.isEncoding(Ne))throw new TypeError("Unknown encoding: "+Ne);if(j.length===1){const dt=j.charCodeAt(0);(Ne==="utf8"&&dt<128||Ne==="latin1")&&(j=dt)}}else typeof j=="number"?j=j&255:typeof j=="boolean"&&(j=Number(j));if(V<0||this.length<V||this.length<pe)throw new RangeError("Out of range index");if(pe<=V)return this;V=V>>>0,pe=pe===void 0?this.length:pe>>>0,j||(j=0);let Fe;if(typeof j=="number")for(Fe=V;Fe<pe;++Fe)this[Fe]=j;else{const dt=u.isBuffer(j)?j:u.from(j,Ne),bt=dt.length;if(bt===0)throw new TypeError('The value "'+j+'" is invalid for argument "value"');for(Fe=0;Fe<pe-V;++Fe)this[Fe+V]=dt[Fe%bt]}return this};const fe={};function ge(ae,j,V){fe[ae]=class extends V{constructor(){super(),Object.defineProperty(this,"message",{value:j.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${ae}]`,this.stack,delete this.name}get code(){return ae}set code(Ne){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Ne,writable:!0})}toString(){return`${this.name} [${ae}]: ${this.message}`}}}ge("ERR_BUFFER_OUT_OF_BOUNDS",function(ae){return ae?`${ae} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ge("ERR_INVALID_ARG_TYPE",function(ae,j){return`The "${ae}" argument must be of type number. Received type ${typeof j}`},TypeError),ge("ERR_OUT_OF_RANGE",function(ae,j,V){let pe=`The value of "${ae}" is out of range.`,Ne=V;return Number.isInteger(V)&&Math.abs(V)>2**32?Ne=rt(String(V)):typeof V=="bigint"&&(Ne=String(V),(V>BigInt(2)**BigInt(32)||V<-(BigInt(2)**BigInt(32)))&&(Ne=rt(Ne)),Ne+="n"),pe+=` It must be ${j}. Received ${Ne}`,pe},RangeError);function rt(ae){let j="",V=ae.length;const pe=ae[0]==="-"?1:0;for(;V>=pe+4;V-=3)j=`_${ae.slice(V-3,V)}${j}`;return`${ae.slice(0,V)}${j}`}function Re(ae,j,V){Ge(j,"offset"),(ae[j]===void 0||ae[j+V]===void 0)&&kt(j,ae.length-(V+1))}function St(ae,j,V,pe,Ne,Fe){if(ae>V||ae<j){const dt=typeof j=="bigint"?"n":"";let bt;throw j===0||j===BigInt(0)?bt=`>= 0${dt} and < 2${dt} ** ${(Fe+1)*8}${dt}`:bt=`>= -(2${dt} ** ${(Fe+1)*8-1}${dt}) and < 2 ** ${(Fe+1)*8-1}${dt}`,new fe.ERR_OUT_OF_RANGE("value",bt,ae)}Re(pe,Ne,Fe)}function Ge(ae,j){if(typeof ae!="number")throw new fe.ERR_INVALID_ARG_TYPE(j,"number",ae)}function kt(ae,j,V){throw Math.floor(ae)!==ae?(Ge(ae,V),new fe.ERR_OUT_OF_RANGE("offset","an integer",ae)):j<0?new fe.ERR_BUFFER_OUT_OF_BOUNDS:new fe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${j}`,ae)}const Bt=/[^+/0-9A-Za-z-_]/g;function He(ae){if(ae=ae.split("=")[0],ae=ae.trim().replace(Bt,""),ae.length<2)return"";for(;ae.length%4!==0;)ae=ae+"=";return ae}function $t(ae,j){j=j||1/0;let V;const pe=ae.length;let Ne=null;const Fe=[];for(let dt=0;dt<pe;++dt){if(V=ae.charCodeAt(dt),V>55295&&V<57344){if(!Ne){if(V>56319){(j-=3)>-1&&Fe.push(239,191,189);continue}else if(dt+1===pe){(j-=3)>-1&&Fe.push(239,191,189);continue}Ne=V;continue}if(V<56320){(j-=3)>-1&&Fe.push(239,191,189),Ne=V;continue}V=(Ne-55296<<10|V-56320)+65536}else Ne&&(j-=3)>-1&&Fe.push(239,191,189);if(Ne=null,V<128){if((j-=1)<0)break;Fe.push(V)}else if(V<2048){if((j-=2)<0)break;Fe.push(V>>6|192,V&63|128)}else if(V<65536){if((j-=3)<0)break;Fe.push(V>>12|224,V>>6&63|128,V&63|128)}else if(V<1114112){if((j-=4)<0)break;Fe.push(V>>18|240,V>>12&63|128,V>>6&63|128,V&63|128)}else throw new Error("Invalid code point")}return Fe}function Ce(ae){const j=[];for(let V=0;V<ae.length;++V)j.push(ae.charCodeAt(V)&255);return j}function ue(ae,j){let V,pe,Ne;const Fe=[];for(let dt=0;dt<ae.length&&!((j-=2)<0);++dt)V=ae.charCodeAt(dt),pe=V>>8,Ne=V%256,Fe.push(Ne),Fe.push(pe);return Fe}function tt(ae){return e.toByteArray(He(ae))}function yt(ae,j,V,pe){let Ne;for(Ne=0;Ne<pe&&!(Ne+V>=j.length||Ne>=ae.length);++Ne)j[Ne+V]=ae[Ne];return Ne}function We(ae,j){return ae instanceof j||ae!=null&&ae.constructor!=null&&ae.constructor.name!=null&&ae.constructor.name===j.name}function ze(ae){return ae!==ae}const Vt=function(){const ae="0123456789abcdef",j=new Array(256);for(let V=0;V<16;++V){const pe=V*16;for(let Ne=0;Ne<16;++Ne)j[pe+Ne]=ae[V]+ae[Ne]}return j}();function xt(ae){return typeof BigInt>"u"?jt:ae}function jt(){throw new Error("BigInt not supported")}})(ja);const Mc=ja.Buffer,ibe=ja.Blob,sbe=ja.BlobOptions,obe=ja.Buffer,abe=ja.File,cbe=ja.FileOptions,lbe=ja.INSPECT_MAX_BYTES,ube=ja.SlowBuffer,dbe=ja.TranscodeEncoding,hbe=ja.atob,fbe=ja.btoa,pbe=ja.constants,mbe=ja.isAscii,gbe=ja.isUtf8,vbe=ja.kMaxLength,_be=ja.kStringMaxLength,ybe=ja.resolveObjectURL,bbe=ja.transcode,Ebe=Object.freeze(Object.defineProperty({__proto__:null,Blob:ibe,BlobOptions:sbe,Buffer:obe,File:abe,FileOptions:cbe,INSPECT_MAX_BYTES:lbe,SlowBuffer:ube,TranscodeEncoding:dbe,atob:hbe,btoa:fbe,constants:pbe,default:Mc,isAscii:mbe,isUtf8:gbe,kMaxLength:vbe,kStringMaxLength:_be,resolveObjectURL:ybe,transcode:bbe},Symbol.toStringTag,{value:"Module"}));var P2;try{P2=new TextDecoder}catch{}var cn,Md,Ye=0,ws={},bi,zv,xd=0,ip=0,tc,ng,vu=[],mi,S5={useRecords:!1,mapsAsObjects:!0};class D9{}const L9=new D9;L9.name="MessagePack 0xC1";var Xv=!1,U9=2,T5;try{new Function("")}catch{U9=1/0}class UT{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(cn)return V9(()=>(L2(),this?this.unpack(e,n):UT.prototype.unpack.call(S5,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Mc<"u"?Mc.from(e):new Uint8Array(e)),typeof n=="object"?(Md=n.end||e.length,Ye=n.start||0):(Ye=0,Md=n>-1?n:e.length),ip=0,zv=null,tc=null,cn=e;try{mi=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw cn=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof UT){if(ws=this,this.structures)return bi=this.structures,R1(n);(!bi||bi.length>0)&&(bi=[])}else ws=S5,(!bi||bi.length>0)&&(bi=[]);return R1(n)}unpackMultiple(e,n){let r,i=0;try{Xv=!0;let s=e.length,o=this?this.unpack(e,s):RM.unpack(e,s);if(n){if(n(o,i,Ye)===!1)return;for(;Ye<s;)if(i=Ye,n(R1(),i,Ye)===!1)return}else{for(r=[o];Ye<s;)i=Ye,r.push(R1());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Xv=!1,L2()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function R1(t){try{if(!ws.trusted&&!Xv){let n=bi.sharedLength||0;n<bi.length&&(bi.length=n)}let e;if(ws.randomAccessStructure&&cn[Ye]<64&&cn[Ye]>=32&&T5?(e=T5(cn,Ye,Md,ws),cn=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),Ye=Md):e=Fo(),tc&&(Ye=tc.postBundlePosition,tc=null),Xv&&(bi.restoreStructures=null),Ye==Md)bi&&bi.restoreStructures&&w5(),bi=null,cn=null,ng&&(ng=null);else{if(Ye>Md)throw new Error("Unexpected end of MessagePack data");if(!Xv){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw bi&&bi.restoreStructures&&w5(),L2(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||Ye>Md)&&(e.incomplete=!0),e}}function w5(){for(let t in bi.restoreStructures)bi[t]=bi.restoreStructures[t];bi.restoreStructures=null}function Fo(){let t=cn[Ye++];if(t<160)if(t<128){if(t<64)return t;{let e=bi[t&63]||ws.getStructures&&F9()[t&63];return e?(e.read||(e.read=UB(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,ws.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=j9();r==="__proto__"&&(r="__proto_"),e[r]=Fo()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(Fo(),Fo());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=Fo();return ws.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(ip>=Ye)return zv.slice(Ye-xd,(Ye+=e)-xd);if(ip==0&&Md<140){let n=e<16?FB(e):B9(e);if(n!=null)return n}return D2(e)}else{let e;switch(t){case 192:return null;case 193:return tc?(e=Fo(),e>0?tc[1].slice(tc.position1,tc.position1+=e):tc[0].slice(tc.position0,tc.position0-=e)):L9;case 194:return!1;case 195:return!0;case 196:if(e=cn[Ye++],e===void 0)throw new Error("Unexpected end of buffer");return AP(e);case 197:return e=mi.getUint16(Ye),Ye+=2,AP(e);case 198:return e=mi.getUint32(Ye),Ye+=4,AP(e);case 199:return d0(cn[Ye++]);case 200:return e=mi.getUint16(Ye),Ye+=2,d0(e);case 201:return e=mi.getUint32(Ye),Ye+=4,d0(e);case 202:if(e=mi.getFloat32(Ye),ws.useFloat32>2){let n=BB[(cn[Ye]&127)<<1|cn[Ye+1]>>7];return Ye+=4,(n*e+(e>0?.5:-.5)>>0)/n}return Ye+=4,e;case 203:return e=mi.getFloat64(Ye),Ye+=8,e;case 204:return cn[Ye++];case 205:return e=mi.getUint16(Ye),Ye+=2,e;case 206:return e=mi.getUint32(Ye),Ye+=4,e;case 207:return ws.int64AsType==="number"?(e=mi.getUint32(Ye)*4294967296,e+=mi.getUint32(Ye+4)):ws.int64AsType==="string"?e=mi.getBigUint64(Ye).toString():ws.int64AsType==="auto"?(e=mi.getBigUint64(Ye),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=mi.getBigUint64(Ye),Ye+=8,e;case 208:return mi.getInt8(Ye++);case 209:return e=mi.getInt16(Ye),Ye+=2,e;case 210:return e=mi.getInt32(Ye),Ye+=4,e;case 211:return ws.int64AsType==="number"?(e=mi.getInt32(Ye)*4294967296,e+=mi.getUint32(Ye+4)):ws.int64AsType==="string"?e=mi.getBigInt64(Ye).toString():ws.int64AsType==="auto"?(e=mi.getBigInt64(Ye),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=mi.getBigInt64(Ye),Ye+=8,e;case 212:if(e=cn[Ye++],e==114)return I5(cn[Ye++]&63);{let n=vu[e];if(n)return n.read?(Ye++,n.read(Fo())):n.noBuffer?(Ye++,n()):n(cn.subarray(Ye,++Ye));throw new Error("Unknown extension "+e)}case 213:return e=cn[Ye],e==114?(Ye++,I5(cn[Ye++]&63,cn[Ye++])):d0(2);case 214:return d0(4);case 215:return d0(8);case 216:return d0(16);case 217:return e=cn[Ye++],ip>=Ye?zv.slice(Ye-xd,(Ye+=e)-xd):Tbe(e);case 218:return e=mi.getUint16(Ye),Ye+=2,ip>=Ye?zv.slice(Ye-xd,(Ye+=e)-xd):wbe(e);case 219:return e=mi.getUint32(Ye),Ye+=4,ip>=Ye?zv.slice(Ye-xd,(Ye+=e)-xd):xbe(e);case 220:return e=mi.getUint16(Ye),Ye+=2,C5(e);case 221:return e=mi.getUint32(Ye),Ye+=4,C5(e);case 222:return e=mi.getUint16(Ye),Ye+=2,R5(e);case 223:return e=mi.getUint32(Ye),Ye+=4,R5(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const Sbe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function UB(t,e){function n(){if(n.count++>U9){let i=t.read=new Function("r","return function(){return "+(ws.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":Sbe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Fo);return t.highByte===0&&(t.read=x5(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=Fo()}return ws.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?x5(e,n):n}const x5=(t,e)=>function(){let n=cn[Ye++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=bi[r]||F9()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=UB(i,t)),i.read()};function F9(){let t=V9(()=>(cn=null,ws.getStructures()));return bi=ws._mergeStructures(t,bi)}var D2=Lw,Tbe=Lw,wbe=Lw,xbe=Lw;function Lw(t){let e;if(t<16&&(e=FB(t)))return e;if(t>64&&P2)return P2.decode(cn.subarray(Ye,Ye+=t));const n=Ye+t,r=[];for(e="";Ye<n;){const i=cn[Ye++];if(!(i&128))r.push(i);else if((i&224)===192){const s=cn[Ye++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=cn[Ye++]&63,o=cn[Ye++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=cn[Ye++]&63,o=cn[Ye++]&63,a=cn[Ye++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Xa.apply(String,r),r.length=0)}return r.length>0&&(e+=Xa.apply(String,r)),e}function C5(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=Fo();return ws.freezeData?Object.freeze(e):e}function R5(t){if(ws.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=j9();r==="__proto__"&&(r="__proto_"),e[r]=Fo()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(Fo(),Fo());return e}}var Xa=String.fromCharCode;function B9(t){let e=Ye,n=new Array(t);for(let r=0;r<t;r++){const i=cn[Ye++];if((i&128)>0){Ye=e;return}n[r]=i}return Xa.apply(String,n)}function FB(t){if(t<4)if(t<2){if(t===0)return"";{let e=cn[Ye++];if((e&128)>1){Ye-=1;return}return Xa(e)}}else{let e=cn[Ye++],n=cn[Ye++];if((e&128)>0||(n&128)>0){Ye-=2;return}if(t<3)return Xa(e,n);let r=cn[Ye++];if((r&128)>0){Ye-=3;return}return Xa(e,n,r)}else{let e=cn[Ye++],n=cn[Ye++],r=cn[Ye++],i=cn[Ye++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){Ye-=4;return}if(t<6){if(t===4)return Xa(e,n,r,i);{let s=cn[Ye++];if((s&128)>0){Ye-=5;return}return Xa(e,n,r,i,s)}}else if(t<8){let s=cn[Ye++],o=cn[Ye++];if((s&128)>0||(o&128)>0){Ye-=6;return}if(t<7)return Xa(e,n,r,i,s,o);let a=cn[Ye++];if((a&128)>0){Ye-=7;return}return Xa(e,n,r,i,s,o,a)}else{let s=cn[Ye++],o=cn[Ye++],a=cn[Ye++],c=cn[Ye++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){Ye-=8;return}if(t<10){if(t===8)return Xa(e,n,r,i,s,o,a,c);{let l=cn[Ye++];if((l&128)>0){Ye-=9;return}return Xa(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=cn[Ye++],u=cn[Ye++];if((l&128)>0||(u&128)>0){Ye-=10;return}if(t<11)return Xa(e,n,r,i,s,o,a,c,l,u);let d=cn[Ye++];if((d&128)>0){Ye-=11;return}return Xa(e,n,r,i,s,o,a,c,l,u,d)}else{let l=cn[Ye++],u=cn[Ye++],d=cn[Ye++],h=cn[Ye++];if((l&128)>0||(u&128)>0||(d&128)>0||(h&128)>0){Ye-=12;return}if(t<14){if(t===12)return Xa(e,n,r,i,s,o,a,c,l,u,d,h);{let p=cn[Ye++];if((p&128)>0){Ye-=13;return}return Xa(e,n,r,i,s,o,a,c,l,u,d,h,p)}}else{let p=cn[Ye++],f=cn[Ye++];if((p&128)>0||(f&128)>0){Ye-=14;return}if(t<15)return Xa(e,n,r,i,s,o,a,c,l,u,d,h,p,f);let g=cn[Ye++];if((g&128)>0){Ye-=15;return}return Xa(e,n,r,i,s,o,a,c,l,u,d,h,p,f,g)}}}}}function A5(){let t=cn[Ye++],e;if(t<192)e=t-160;else switch(t){case 217:e=cn[Ye++];break;case 218:e=mi.getUint16(Ye),Ye+=2;break;case 219:e=mi.getUint32(Ye),Ye+=4;break;default:throw new Error("Expected string")}return Lw(e)}function AP(t){return ws.copyBuffers?Uint8Array.prototype.slice.call(cn,Ye,Ye+=t):cn.subarray(Ye,Ye+=t)}function d0(t){let e=cn[Ye++];if(vu[e]){let n;return vu[e](cn.subarray(Ye,n=Ye+=t),r=>{Ye=r;try{return Fo()}finally{Ye=n}})}else throw new Error("Unknown extension type "+e)}var M5=new Array(4096);function j9(){let t=cn[Ye++];if(t>=160&&t<192){if(t=t-160,ip>=Ye)return zv.slice(Ye-xd,(Ye+=t)-xd);if(!(ip==0&&Md<180))return D2(t)}else return Ye--,$9(Fo());let e=(t<<5^(t>1?mi.getUint16(Ye):t>0?cn[Ye]:0))&4095,n=M5[e],r=Ye,i=Ye+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=mi.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=cn[r++],s!=n[o++]){r=1879048192;break}if(r===i)return Ye=r,n.string;i-=3,r=Ye}for(n=[],M5[e]=n,n.bytes=t;r<i;)s=mi.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=cn[r++],n.push(s);let a=t<16?FB(t):B9(t);return a!=null?n.string=a:n.string=D2(t)}function $9(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const I5=(t,e)=>{let n=Fo().map($9),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=bi[t];return i&&(i.isShared||Xv)&&((bi.restoreStructures||(bi.restoreStructures=[]))[t]=i),bi[t]=n,n.read=UB(n,r),n.read()};vu[0]=()=>{};vu[0].noBuffer=!0;vu[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let Cbe={Error,TypeError,ReferenceError};vu[101]=()=>{let t=Fo();return(Cbe[t[0]]||Error)(t[1],{cause:t[2]})};vu[105]=t=>{if(ws.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=mi.getUint32(Ye-4);ng||(ng=new Map);let n=cn[Ye],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};ng.set(e,i);let s=Fo();return i.used?Object.assign(r,s):(i.target=s,s)};vu[112]=t=>{if(ws.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=mi.getUint32(Ye-4),n=ng.get(e);return n.used=!0,n.target};vu[115]=()=>new Set(Fo());const H9=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let Rbe=typeof globalThis=="object"?globalThis:window;vu[116]=t=>{let e=t[0],n=H9[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new Rbe[n](Uint8Array.prototype.slice.call(t,1).buffer)};vu[120]=()=>{let t=Fo();return new RegExp(t[0],t[1])};const Abe=[];vu[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=Ye;return Ye+=e-t.length,tc=Abe,tc=[A5(),A5()],tc.position0=0,tc.position1=0,tc.postBundlePosition=Ye,Ye=n,Fo()};vu[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function V9(t){let e=Md,n=Ye,r=xd,i=ip,s=zv,o=ng,a=tc,c=new Uint8Array(cn.slice(0,Md)),l=bi,u=bi.slice(0,bi.length),d=ws,h=Xv,p=t();return Md=e,Ye=n,xd=r,ip=i,zv=s,ng=o,tc=a,cn=c,Xv=h,bi=l,bi.splice(0,bi.length,...u),ws=d,mi=new DataView(cn.buffer,cn.byteOffset,cn.byteLength),p}function L2(){cn=null,ng=null,bi=null}const BB=new Array(147);for(let t=0;t<256;t++)BB[t]=+("1e"+Math.floor(45.15-t*.30103));var RM=new UT({useRecords:!1});RM.unpack;RM.unpackMultiple;RM.unpack;let Mbe=new Float32Array(1);new Uint8Array(Mbe.buffer,0,4);let IC;try{IC=new TextEncoder}catch{}let U2,z9;const AM=typeof Mc<"u",A1=AM?function(t){return Mc.allocUnsafeSlow(t)}:Uint8Array,G9=AM?Mc:Uint8Array,O5=AM?4294967296:2144337920;let mt,jS,Es,et=0,_l,so=null,Ibe;const Obe=21760,kbe=/[\u0080-\uFFFF]/,fb=Symbol("record-id");class Nbe extends UT{constructor(e){super(e),this.offset=0;let n,r,i,s,o=G9.prototype.utf8Write?function(W,X){return mt.utf8Write(W,X,mt.byteLength-X)}:IC&&IC.encodeInto?function(W,X){return IC.encodeInto(W,mt.subarray(X)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let d=e.maxOwnStructures;d==null&&(d=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let h=u>32||d+u>64,p=u+64,f=u+d+64;if(f>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],y=0,E=0;this.pack=this.encode=function(W,X){if(mt||(mt=new A1(8192),Es=mt.dataView||(mt.dataView=new DataView(mt.buffer,0,8192)),et=0),_l=mt.length-10,_l-et<2048?(mt=new A1(mt.length),Es=mt.dataView||(mt.dataView=new DataView(mt.buffer,0,mt.length)),_l=mt.length-10,et=0):et=et+7&2147483640,n=et,X&Bbe&&(et+=X&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof W!="string"?(so=[],so.size=1/0):so=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Z=i.sharedLength||0;if(Z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let ie=0;ie<Z;ie++){let G=i[ie];if(!G)continue;let Q,se=i.transitions;for(let ve=0,Oe=G.length;ve<Oe;ve++){let _e=G[ve];Q=se[_e],Q||(Q=se[_e]=Object.create(null)),se=Q}se[fb]=ie+64}this.lastNamedStructuresLength=Z}c||(i.nextId=Z+64)}r&&(r=!1);let ne;try{a.randomAccessStructure&&W&&W.constructor&&W.constructor===Object?K(W):A(W);let Z=so;if(so&&P5(n,A,0),s&&s.idsToInsert){let ie=s.idsToInsert.sort((ve,Oe)=>ve.offset>Oe.offset?1:-1),G=ie.length,Q=-1;for(;Z&&G>0;){let ve=ie[--G].offset+n;ve<Z.stringsPosition+n&&Q===-1&&(Q=0),ve>Z.position+n?Q>=0&&(Q+=6):(Q>=0&&(Es.setUint32(Z.position+n,Es.getUint32(Z.position+n)+Q),Q=-1),Z=Z.previous,G++)}Q>=0&&Z&&Es.setUint32(Z.position+n,Es.getUint32(Z.position+n)+Q),et+=ie.length*6,et>_l&&F(et),a.offset=et;let se=Dbe(mt.subarray(n,et),ie);return s=null,se}return a.offset=et,X&Ube?(mt.start=n,mt.end=et,mt):mt.subarray(n,et)}catch(Z){throw ne=Z,Z}finally{if(i&&(w(),r&&a.saveStructures)){let Z=i.sharedLength||0,ie=mt.subarray(n,et),G=Lbe(i,a);if(!ne)return a.saveStructures(G,G.isCompatible)===!1?a.pack(W,X):(a.lastNamedStructuresLength=Z,mt.length>1073741824&&(mt=null),ie)}mt.length>1073741824&&(mt=null),X&Fbe&&(et=n)}};const w=()=>{E<10&&E++;let W=i.sharedLength||0;if(i.length>W&&!c&&(i.length=W),y>1e4)i.transitions=null,E=0,y=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let X=0,ne=g.length;X<ne;X++)g[X][fb]=0;g=[]}},R=W=>{var X=W.length;X<16?mt[et++]=144|X:X<65536?(mt[et++]=220,mt[et++]=X>>8,mt[et++]=X&255):(mt[et++]=221,Es.setUint32(et,X),et+=4);for(let ne=0;ne<X;ne++)A(W[ne])},A=W=>{et>_l&&(mt=F(et));var X=typeof W,ne;if(X==="string"){let Z=W.length;if(so&&Z>=4&&Z<4096){if((so.size+=Z)>Obe){let se,ve=(so[0]?so[0].length*3+so[1].length:0)+10;et+ve>_l&&(mt=F(et+ve));let Oe;so.position?(Oe=so,mt[et]=200,et+=3,mt[et++]=98,se=et-n,et+=4,P5(n,A,0),Es.setUint16(se+n-3,et-n-se)):(mt[et++]=214,mt[et++]=98,se=et-n,et+=4),so=["",""],so.previous=Oe,so.size=0,so.position=se}let Q=kbe.test(W);so[Q?0:1]+=W,mt[et++]=193,A(Q?-Z:Z);return}let ie;Z<32?ie=1:Z<256?ie=2:Z<65536?ie=3:ie=5;let G=Z*3;if(et+G>_l&&(mt=F(et+G)),Z<64||!o){let Q,se,ve,Oe=et+ie;for(Q=0;Q<Z;Q++)se=W.charCodeAt(Q),se<128?mt[Oe++]=se:se<2048?(mt[Oe++]=se>>6|192,mt[Oe++]=se&63|128):(se&64512)===55296&&((ve=W.charCodeAt(Q+1))&64512)===56320?(se=65536+((se&1023)<<10)+(ve&1023),Q++,mt[Oe++]=se>>18|240,mt[Oe++]=se>>12&63|128,mt[Oe++]=se>>6&63|128,mt[Oe++]=se&63|128):(mt[Oe++]=se>>12|224,mt[Oe++]=se>>6&63|128,mt[Oe++]=se&63|128);ne=Oe-et-ie}else ne=o(W,et+ie);ne<32?mt[et++]=160|ne:ne<256?(ie<2&&mt.copyWithin(et+2,et+1,et+1+ne),mt[et++]=217,mt[et++]=ne):ne<65536?(ie<3&&mt.copyWithin(et+3,et+2,et+2+ne),mt[et++]=218,mt[et++]=ne>>8,mt[et++]=ne&255):(ie<5&&mt.copyWithin(et+5,et+3,et+3+ne),mt[et++]=219,Es.setUint32(et,ne),et+=4),et+=ne}else if(X==="number")if(W>>>0===W)W<32||W<128&&this.useRecords===!1||W<64&&!this.randomAccessStructure?mt[et++]=W:W<256?(mt[et++]=204,mt[et++]=W):W<65536?(mt[et++]=205,mt[et++]=W>>8,mt[et++]=W&255):(mt[et++]=206,Es.setUint32(et,W),et+=4);else if(W>>0===W)W>=-32?mt[et++]=256+W:W>=-128?(mt[et++]=208,mt[et++]=W+256):W>=-32768?(mt[et++]=209,Es.setInt16(et,W),et+=2):(mt[et++]=210,Es.setInt32(et,W),et+=4);else{let Z;if((Z=this.useFloat32)>0&&W<4294967296&&W>=-2147483648){mt[et++]=202,Es.setFloat32(et,W);let ie;if(Z<4||(ie=W*BB[(mt[et]&127)<<1|mt[et+1]>>7])>>0===ie){et+=4;return}else et--}mt[et++]=203,Es.setFloat64(et,W),et+=8}else if(X==="object"||X==="function")if(!W)mt[et++]=192;else{if(s){let ie=s.get(W);if(ie){if(!ie.id){let G=s.idsToInsert||(s.idsToInsert=[]);ie.id=G.push(ie)}mt[et++]=214,mt[et++]=112,Es.setUint32(et,ie.id),et+=4;return}else s.set(W,{offset:et-n})}let Z=W.constructor;if(Z===Object)U(W);else if(Z===Array)R(W);else if(Z===Map)if(this.mapAsEmptyObject)mt[et++]=128;else{ne=W.size,ne<16?mt[et++]=128|ne:ne<65536?(mt[et++]=222,mt[et++]=ne>>8,mt[et++]=ne&255):(mt[et++]=223,Es.setUint32(et,ne),et+=4);for(let[ie,G]of W)A(ie),A(G)}else{for(let ie=0,G=U2.length;ie<G;ie++){let Q=z9[ie];if(W instanceof Q){let se=U2[ie];if(se.write){se.type&&(mt[et++]=212,mt[et++]=se.type,mt[et++]=0);let xe=se.write.call(this,W);xe===W?Array.isArray(W)?R(W):U(W):A(xe);return}let ve=mt,Oe=Es,_e=et;mt=null;let le;try{le=se.pack.call(this,W,xe=>(mt=ve,ve=null,et+=xe,et>_l&&F(et),{target:mt,targetView:Es,position:et-xe}),A)}finally{ve&&(mt=ve,Es=Oe,et=_e,_l=mt.length-10)}le&&(le.length+et>_l&&F(le.length+et),et=Pbe(le,mt,et,se.type));return}}if(Array.isArray(W))R(W);else{if(W.toJSON){const ie=W.toJSON();if(ie!==W)return A(ie)}if(X==="function")return A(this.writeFunction&&this.writeFunction(W));U(W)}}}else if(X==="boolean")mt[et++]=W?195:194;else if(X==="bigint"){if(W<BigInt(1)<<BigInt(63)&&W>=-(BigInt(1)<<BigInt(63)))mt[et++]=211,Es.setBigInt64(et,W);else if(W<BigInt(1)<<BigInt(64)&&W>0)mt[et++]=207,Es.setBigUint64(et,W);else if(this.largeBigIntToFloat)mt[et++]=203,Es.setFloat64(et,Number(W));else{if(this.largeBigIntToString)return A(W.toString());if(this.useBigIntExtension&&W<BigInt(2)**BigInt(1023)&&W>-(BigInt(2)**BigInt(1023))){mt[et++]=199,et++,mt[et++]=66;let Z=[],ie;do{let G=W&BigInt(255);ie=(G&BigInt(128))===(W<BigInt(0)?BigInt(128):BigInt(0)),Z.push(G),W>>=BigInt(8)}while(!((W===BigInt(0)||W===BigInt(-1))&&ie));mt[et-2]=Z.length;for(let G=Z.length;G>0;)mt[et++]=Number(Z[--G]);return}else throw new RangeError(W+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}et+=8}else if(X==="undefined")this.encodeUndefinedAsNil?mt[et++]=192:(mt[et++]=212,mt[et++]=0,mt[et++]=0);else throw new Error("Unknown type: "+X)},k=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?W=>{let X;if(this.skipValues){X=[];for(let ie in W)(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(ie))&&!this.skipValues.includes(W[ie])&&X.push(ie)}else X=Object.keys(W);let ne=X.length;ne<16?mt[et++]=128|ne:ne<65536?(mt[et++]=222,mt[et++]=ne>>8,mt[et++]=ne&255):(mt[et++]=223,Es.setUint32(et,ne),et+=4);let Z;if(this.coercibleKeyAsNumber)for(let ie=0;ie<ne;ie++){Z=X[ie];let G=Number(Z);A(isNaN(G)?Z:G),A(W[Z])}else for(let ie=0;ie<ne;ie++)A(Z=X[ie]),A(W[Z])}:W=>{mt[et++]=222;let X=et-n;et+=2;let ne=0;for(let Z in W)(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(Z))&&(A(Z),A(W[Z]),ne++);if(ne>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');mt[X+++n]=ne>>8,mt[X+n]=ne&255},I=this.useRecords===!1?k:e.progressiveRecords&&!h?W=>{let X,ne=i.transitions||(i.transitions=Object.create(null)),Z=et++-n,ie;for(let G in W)if(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(G)){if(X=ne[G],X)ne=X;else{let Q=Object.keys(W),se=ne;ne=i.transitions;let ve=0;for(let Oe=0,_e=Q.length;Oe<_e;Oe++){let le=Q[Oe];X=ne[le],X||(X=ne[le]=Object.create(null),ve++),ne=X}Z+n+1==et?(et--,$(ne,Q,ve)):q(ne,Q,Z,ve),ie=!0,ne=se[G]}A(W[G])}if(!ie){let G=ne[fb];G?mt[Z+n]=G:q(ne,Object.keys(W),Z,0)}}:W=>{let X,ne=i.transitions||(i.transitions=Object.create(null)),Z=0;for(let G in W)(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(G))&&(X=ne[G],X||(X=ne[G]=Object.create(null),Z++),ne=X);let ie=ne[fb];ie?ie>=96&&h?(mt[et++]=((ie-=96)&31)+96,mt[et++]=ie>>5):mt[et++]=ie:$(ne,ne.__keys__||Object.keys(W),Z);for(let G in W)(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(G))&&A(W[G])},N=typeof this.useRecords=="function"&&this.useRecords,U=N?W=>{N(W)?I(W):k(W)}:I,F=W=>{let X;if(W>16777216){if(W-n>O5)throw new Error("Packed buffer would be larger than maximum buffer size");X=Math.min(O5,Math.round(Math.max((W-n)*(W>67108864?1.25:2),4194304)/4096)*4096)}else X=(Math.max(W-n<<2,mt.length-1)>>12)+1<<12;let ne=new A1(X);return Es=ne.dataView||(ne.dataView=new DataView(ne.buffer,0,X)),W=Math.min(W,mt.length),mt.copy?mt.copy(ne,0,n,W):ne.set(mt.slice(n,W)),et-=n,n=0,_l=ne.length-10,mt=ne},$=(W,X,ne)=>{let Z=i.nextId;Z||(Z=64),Z<p&&this.shouldShareStructure&&!this.shouldShareStructure(X)?(Z=i.nextOwnId,Z<f||(Z=p),i.nextOwnId=Z+1):(Z>=f&&(Z=p),i.nextId=Z+1);let ie=X.highByte=Z>=96&&h?Z-96>>5:-1;W[fb]=Z,W.__keys__=X,i[Z-64]=X,Z<p?(X.isShared=!0,i.sharedLength=Z-63,r=!0,ie>=0?(mt[et++]=(Z&31)+96,mt[et++]=ie):mt[et++]=Z):(ie>=0?(mt[et++]=213,mt[et++]=114,mt[et++]=(Z&31)+96,mt[et++]=ie):(mt[et++]=212,mt[et++]=114,mt[et++]=Z),ne&&(y+=E*ne),g.length>=d&&(g.shift()[fb]=0),g.push(W),A(X))},q=(W,X,ne,Z)=>{let ie=mt,G=et,Q=_l,se=n;mt=jS,et=0,n=0,mt||(jS=mt=new A1(8192)),_l=mt.length-10,$(W,X,Z),jS=mt;let ve=et;if(mt=ie,et=G,_l=Q,n=se,ve>1){let Oe=et+ve-1;Oe>_l&&F(Oe);let _e=ne+n;mt.copyWithin(_e+ve,_e+1,et),mt.set(jS.slice(0,ve),_e),et=Oe}else mt[ne+n]=jS[0]},K=W=>{let X=Ibe(W,mt,n,et,i,F,(ne,Z,ie)=>{if(ie)return r=!0;et=Z;let G=mt;return A(ne),w(),G!==mt?{position:et,targetView:Es,target:mt}:et},this);if(X===0)return U(W);et=X}}useBuffer(e){mt=e,mt.dataView||(mt.dataView=new DataView(mt.buffer,mt.byteOffset,mt.byteLength)),et=0}set position(e){et=e}get position(){return et}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}z9=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,D9];U2=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?k5(t,16,e):N5(AM?Mc.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==G9&&this.moreTypes?k5(t,H9.indexOf(n.name),e):N5(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function k5(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function N5(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function Pbe(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function Dbe(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function P5(t,e,n){if(so.length>0){Es.setUint32(so.position+t,et+n-so.position-t),so.stringsPosition=et-t;let r=so;so=null,e(r[0]),e(r[1])}}function Lbe(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let W9=new Nbe({useRecords:!1});W9.pack;W9.pack;const Ube=512,Fbe=1024,Bbe=2048;function D5(){return{id:Po()}}function F2(t){var e;return((e=t==null?void 0:t.id)==null?void 0:e.length)??!1}function FR(t,e){if(!he(t)||!su(e))return;const{color:n,bg:r}=kY(e);he(n)&&(t.color=n),he(r)&&(t.bg=r)}function Uw(t){var e;return rr((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}function jbe(){return new Array(ns*kl).map(()=>{})}function $be(t=xl){const e={terrain:jbe(),objects:{},id:""};return t(e)}function FT(t,e){return!he(t)||!he(e==null?void 0:e.x)||!he(e==null?void 0:e.y)||e.x<0||e.x>=ns||e.y<0||e.y>=kl?-1:e.x+e.y*ns}function B2(t,e){const n=FT(t,e);if(n<0||!he(t==null?void 0:t.lookup))return;const r=d_(t,t.lookup[n]??"");return he(r)?r:t.terrain[n]}function MM(t,e){if(!he(t)||!he(e)||!he(e.x)||!he(e.y)||e.x<0||e.x>=ns||e.y<0||e.y>=kl)return;const n=Gc(e),r=e.x+e.y*ns;return t.terrain[r]=n,t.terrain[r]}function Hbe(t,e){if(!he(t)||!he(e))return;const n=Gc(e);return n.id=n.id??Po(),t.objects[n.id]=n,t.objects[n.id]}function Vbe(t,e,n){return MM(t,{...e,kind:n})}function q9(t,e,n,r){return Hbe(t,{...e,kind:n,id:r})}function d_(t,e){if(t)return t.objects[e]}function j2(t,e,n,r,i){if(!he(t)||!he(e))return{x:0,y:0};const s={x:e.x??0,y:e.y??0},o={x:e.lx??s.x,y:e.ly??s.y},a=Nv(o,s),c=ns-1,l=kl-1;for(let u=0;u<r.length;++u){const d=Yye(r[u]);switch(d){case pn.IDLE:break;case pn.NORTH:case pn.SOUTH:case pn.WEST:case pn.EAST:Ta(s,d);break;case pn.BY:{const[h,p]=r.slice(u+1);Mn(h)&&Mn(p)&&(s.x=Ci(s.x+h,0,c),s.y=Ci(s.y+p,0,l)),u+=2;break}case pn.AT:{const[h,p]=r.slice(u+1);Mn(h)&&Mn(p)&&(s.x=Ci(h,0,c),s.y=Ci(p,0,l)),u+=2;break}case pn.FLOW:Ta(s,a);break;case pn.SEEK:{const h=zbe(t,e,n);dS(h)&&Ta(s,Nv(i,h));break}case pn.RNDNS:Ta(s,Wu(pn.NORTH,pn.SOUTH));break;case pn.RNDNE:Ta(s,Wu(pn.NORTH,pn.EAST));break;case pn.RND:Ta(s,Wu(pn.NORTH,pn.SOUTH,pn.WEST,pn.EAST));break;case pn.CW:case pn.CCW:case pn.OPP:case pn.RNDP:{const h=j2(t,e,n,r.slice(u+1),i);switch(s.x=i.x,s.y=i.y,d){case pn.CW:switch(Nv(i,h)){case pn.NORTH:Ta(s,pn.EAST);break;case pn.SOUTH:Ta(s,pn.WEST);break;case pn.EAST:Ta(s,pn.SOUTH);break;case pn.WEST:Ta(s,pn.NORTH);break}break;case pn.CCW:switch(Nv(i,h)){case pn.NORTH:Ta(s,pn.WEST);break;case pn.SOUTH:Ta(s,pn.EAST);break;case pn.EAST:Ta(s,pn.NORTH);break;case pn.WEST:Ta(s,pn.SOUTH);break}break;case pn.OPP:switch(Nv(i,h)){case pn.NORTH:Ta(s,pn.SOUTH);break;case pn.SOUTH:Ta(s,pn.NORTH);break;case pn.EAST:Ta(s,pn.WEST);break;case pn.WEST:Ta(s,pn.EAST);break}break;case pn.RNDP:switch(Nv(i,h)){case pn.NORTH:case pn.SOUTH:s.x+=Wu(-1,1);break;case pn.WEST:case pn.EAST:s.y+=Wu(-1,1);break}break}break}}}return s}function zbe(t,e,n){if(!he(t)||!he(e))return;const r=t.objects[n];if(he(r))return r;if(dS(e))return N9(e,Dw(t,"player"))}const K9={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function lp(t){return qr(t)&&Y9(t[0])}function Y9(t){return he(Y0[t])&&nr(t)}function X9(t){if(nr(t))return K9[rr(t)]}function L5(t){if(lp(t))return t;if(Y9(t))return[t];const e=X9(t);if(he(e))return[e]}function OC(t){const e=be.words[t],n=L5(e);if(lp(n))return[n,t+1];const[r,i]=nc(t),s=L5(r);return lp(s)?[s,i]:[void 0,t]}const J9={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};Gi.ISSOLID,Gi.ISWALK,Gi.ISSWIM,Gi.ISBULLET,Gi.ISWALK,Gi.ISSWIM;function Jm(t){return qr(t)&&$2(t[0])}function $2(t){return he(Gi[t])&&nr(t)}function Gbe(t){if(nr(t))return J9[rr(t)]}function Q9(t){const e=be.words[t];if(Jm(e))return[e,t+1];if($2(e))return[[e],t+1];const[n,r]=nc(t);return Jm(n)?[n,r]:$2(n)?[[n],r]:[void 0,t]}const be={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var lt=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NAME=5]="NAME",t[t.NUMBER=6]="NUMBER",t[t.STRING=7]="STRING",t[t.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=10]="MAYBE_COLLISION",t[t.MAYBE_COLOR=11]="MAYBE_COLOR",t[t.MAYBE_KIND=12]="MAYBE_KIND",t[t.MAYBE_DIR=13]="MAYBE_DIR",t[t.MAYBE_NAME=14]="MAYBE_NAME",t[t.MAYBE_NUMBER=15]="MAYBE_NUMBER",t[t.MAYBE_STRING=16]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",t[t.ANY=18]="ANY",t))(lt||{});function ra(t,e,n){throw console.info(n,be.element,be.elementid,be.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function Rt(t,e,n){var o,a,c,l;const r=be.words;be.words=t;const i=[];let s=e;for(let u=0;u<n.length;++u)switch(n[u]){case 0:{const[d,h]=OC(s);lp(d)||ra("terrain or object",d,t),s=h,i.push(d);break}case 1:{const[d,h]=Q9(s);Jm(d)||ra("solid, walk, swim, bullet, walkable or swimmable",d,t),s=h,i.push(d);break}case 2:{const[d,h]=JR(s);su(d)||ra("color",d,t),s=h,i.push(d);break}case 3:{const[d,h]=E5(s);OE(d)?(s=h,i.push(d)):ra("kind",d,t);break}case 4:{const[d,h]=N2(s);if(Lh(d)){const p={x:((o=be.element)==null?void 0:o.x)??0,y:((a=be.element)==null?void 0:a.y)??0},f=he(be.board)&&he(be.element)?j2(be.board,be.element,be.elementfocus,d,p):p;s=h,i.push(f)}else ra("direction",d,t);break}case 5:{const d=be.words[s];nr(d)||ra("string",d,t),++s,i.push(d);break}case 6:{const[d,h]=nc(s);if(nr(d)){const p=parseFloat(d);Mn(p)?i.push(p):ra("number",d,t)}else Mn(d)?i.push(d):ra("number",d,t);s=h;break}case 7:{const[d,h]=nc(s);nr(d)||ra("string",d,t),s=h,i.push(d);break}case 8:{const[d,h]=nc(s);let p=d;if(nr(p)){const f=parseFloat(p);Mn(f)&&(p=f)}else Mn(p)||ra("number or string",p,t);s=h,i.push(p);break}case 9:{const[d,h]=OC(s);d!==void 0&&!lp(d)&&ra("optional terrain or object",d,t),s=h,i.push(d);break}case 10:{const[d,h]=OC(s);d!==void 0&&!Jm(d)&&ra("optional solid, walk, swim, bullet, walkable or swimmable",d,t),s=h,i.push(d);break}case 11:{const[d,h]=JR(s);d!==void 0&&!su(d)&&ra("optional color",d,t),s=h,i.push(d);break}case 12:{const[d,h]=E5(s);d!==void 0&&!OE(d)&&ra("optional kind",d,t),s=h,i.push(d);break}case 13:{const[d,h]=N2(s);if(Lh(d)){const p=((c=be.element)==null?void 0:c.x)??0,f=((l=be.element)==null?void 0:l.y)??0,g={x:p,y:f},y=be.board?j2(be.board,be.element,be.elementfocus,d,g):g;s=h,i.push(y)}else d===void 0?(s=h,i.push(void 0)):ra("optional direction",d,t);break}case 14:{const d=be.words[s];d!==void 0&&!nr(d)&&ra("optional string",d,t),++s,i.push(d);break}case 15:{const[d,h]=nc(s);if(nr(d)){const p=parseFloat(d);Mn(p)?i.push(p):ra("optional number",d,t)}else Mn(d)||d===void 0?i.push(d):ra("optional number",d,t);s=h;break}case 16:{const[d,h]=nc(s);d!==void 0&&!nr(d)&&ra("optional string",d,t),s=h,i.push(d);break}case 17:{const[d,h]=nc(s);let p=d;if(nr(p)){const f=parseFloat(p);Mn(f)&&(p=f)}else p!==void 0&&!Mn(p)&&ra("number or string",p,t);s=h,i.push(p);break}case 18:{const[d,h]=nc(s);s=h,i.push(d);break}}return be.words=r,[...i,s]}const Wbe=["echo","reverb","chorus","phaser","distortion","vibrato"];function U5(t,e){const[n]=Rt(t,0,[lt.NAME]);Mv(qe,n,e)}function Nm(t,e){const[n,r]=Rt(e,0,[lt.NUMBER_OR_STRING]);if(Mn(n))mP(qe,t,"volume",n);else if(Wbe.includes(rr(n))){const[i,s]=Rt(e,r,[lt.NUMBER_OR_STRING,lt.MAYBE_NUMBER_OR_STRING]);Sde(qe,t,n,i,s)}else{const[i]=Rt(e,r,[lt.MAYBE_NUMBER_OR_STRING]);if(Mn(i)){const s=e.length-r,o=new Array(s).fill(lt.NUMBER),a=Rt(e,r,o).slice(0,s),c=a.length===1?a[0]:a;mP(qe,t,n,c)}else{const[s]=Rt(e,r,[lt.MAYBE_NUMBER_OR_STRING]);mP(qe,t,n,s)}}}const qbe=Sg().command("bpm",(t,e)=>{const[n]=Rt(e,0,[lt.NUMBER]);return Ede(qe,n),0}).command("mainvol",(t,e)=>{const[n]=Rt(e,0,[lt.NUMBER]);return uH(qe,n),0}).command("mainvolume",(t,e)=>{const[n]=Rt(e,0,[lt.NUMBER]);return uH(qe,n),0}).command("drumvol",(t,e)=>{const[n]=Rt(e,0,[lt.NUMBER]);return dH(qe,n),0}).command("drumvolume",(t,e)=>{const[n]=Rt(e,0,[lt.NUMBER]);return dH(qe,n),0}).command("ttsvol",(t,e)=>{const[n]=Rt(e,0,[lt.NUMBER]);return hH(qe,n),0}).command("ttsvolume",(t,e)=>{const[n]=Rt(e,0,[lt.NUMBER]);return hH(qe,n),0}).command("play",(t,e)=>(U5(e,!1),0)).command("bgplay",(t,e)=>(U5(e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)Nm(n,e);return 0}).command("synth1",(t,e)=>(Nm(0,e),0)).command("synth2",(t,e)=>(Nm(1,e),0)).command("synth3",(t,e)=>(Nm(2,e),0)).command("synth4",(t,e)=>(Nm(3,e),0)).command("synth5",(t,e)=>(Nm(4,e),0)).command("synth6",(t,e)=>(Nm(5,e),0)).command("synth7",(t,e)=>(Nm(6,e),0)).command("synth8",(t,e)=>(Nm(7,e),0)),Kbe=66.666,Z9=Math.round(1e3/Kbe),Ybe=3;function Zf(t){return new Promise(e=>setTimeout(e,t))}function Xbe(t){const e=document.createElement("canvas");if(e.width=(t==null?void 0:t.width)||1,e.height=(t==null?void 0:t.height)||1,t){const n=e.getContext("2d"),r=n==null?void 0:n.getImageData(0,0,t.width,t.height);if(r&&n){let i=0;const{data:s}=r;for(let o=0;o<s.length;o+=4){const a=t.bits[i];s[o]=a,s[o+1]=a,s[o+2]=a,s[o+3]=255,i+=1}n.putImageData(r,0,0)}}return e}function e7(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}function MP(t,e,n){return{width:t,height:e,size:t*e,bits:new Uint8Array(n)}}function Fw(t){const e=Math.floor(t.length/IE);if(e*IE!==t.length){ai(qe,"size","wrong number of bytes for a palette");return}const n=e7(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function Jbe(t,e){return t&1<<e?255:0}function Bw(t){const e=Math.floor(t.length/O2);if(e*O2!==t.length){ai(qe,"size","wrong number of bytes for a charset");return}const n=Math.ceil(e/kd),r=Kv*kd,i=e7(r,Yv*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*Yv+a,u=t[c];for(let d=0;d<Kv;++d){const h=s*Kv+d;i.bits[h+l*r]=Jbe(u,7-d)}++a,a===Yv&&(a=0,++s,s===kd&&(s=0,++o))}return i}const jB=DB(32,126).map(t=>String.fromCharCode(t));function ci(t){return ed({...t,name:`token_${t.name}`})}function Pp(t,e=!1){return ci(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:Xc,group:Na.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:Xc})}const BT=ci({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Qbe=ci({name:"whitespace",pattern:/ +/,group:Na.SKIPPED}),Zbe=ci({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Na.SKIPPED}),$B=ci({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Ib=ci({name:"command",pattern:/#/,start_chars_hint:["#"]});let t7=!1;function eEe(t,e,n){if(!t7)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==BT)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const n7=ci({name:"text",pattern:eEe,line_breaks:!1,start_chars_hint:jB.filter(t=>"@#/?':!".includes(t)===!1)}),r7=ci({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),i7=ci({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),s7=ci({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),o7=ci({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Xc=ci({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:jB}),a7=ci({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),c7=ci({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),l7=ci({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:Xc}),u7=ci({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:Xc}),d7=ci({name:"islessthan",pattern:/<|below/,longer_alt:Xc}),h7=ci({name:"isgreaterthan",pattern:/>|above/,longer_alt:Xc}),f7=ci({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:Xc}),p7=ci({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:Xc}),H2=ci({name:"or",pattern:/or/i,longer_alt:Xc}),V2=ci({name:"not",pattern:/not/i,longer_alt:Xc}),z2=ci({name:"and",pattern:/and/i,longer_alt:Xc}),G2=ci({name:"plus",pattern:/\+/}),W2=ci({name:"minus",pattern:/-/}),m7=ci({name:"power",pattern:/\*\*/}),g7=ci({name:"multiply",pattern:/\*/}),q2=ci({name:"divide",pattern:/\//}),v7=ci({name:"moddivide",pattern:/%/}),_7=ci({name:"floordivide",pattern:/%%/}),y7=ci({name:"query",pattern:/\?/}),b7=ci({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),E7=ci({name:"rparen",pattern:/\)/,pop_mode:!0}),S7=ci({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:jB,longer_alt:Xc}),K2=ci({name:"if",pattern:/if|try|take|give/,longer_alt:Xc}),kC=Pp("do"),tEe=Pp("to",!0),Y2=Pp("done"),nEe=Pp("then",!0),X2=Pp("else"),T7=Pp("while"),w7=Pp("repeat"),x7=Pp("waitfor"),C7=ci({name:"foreach",pattern:/foreach|for/,longer_alt:Xc}),R7=Pp("break"),A7=Pp("continue");function M7(t){return[...t,c7,l7,u7,f7,d7,p7,h7,H2,V2,z2,G2,W2,m7,g7,q2,_7,v7,y7,b7,E7,a7,Xc]}const I7=M7([n7,$B,S7,Ib,r7,i7,s7,o7,BT,Qbe,R7,A7,Y2,kC,X2,C7,K2,w7,nEe,tEe,x7,T7]),rEe=new Na({defaultMode:"use_newlines",modes:{use_newlines:I7,ignore_newlines:M7([Zbe])}},{skipValidations:!vp,ensureOptimizations:vp});function O7(t){t7=!0;const e=rEe.tokenize(t||` 
`),[n]=(qr(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Pw(BT,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function iEe(t,e,n=!0){if(n){const[r,...i]=e;switch(rr(r??"")){default:return{type:Tn.OBJECT,values:e};case"loader":return{type:Tn.LOADER,values:i};case"board":return{type:Tn.BOARD,values:i};case"object":return{type:Tn.OBJECT,values:i};case"terrain":return{type:Tn.TERRAIN,values:i};case"charset":return{type:Tn.CHARSET,values:i};case"palette":return{type:Tn.PALETTE,values:i}}}else{const[r,i,...s]=e,o=rr(i??""),a=[r,t,...s];switch(o){default:return{type:Tn.CONST,values:e};case"rn":case"range":return{type:Tn.RANGE,values:a};case"sl":case"select":return{type:Tn.SELECT,values:a};case"nm":case"number":return{type:Tn.NUMBER,values:a};case"tx":case"text":return{type:Tn.TEXT,values:a};case"ln":case"link":return{type:Tn.LINK,values:a};case"hk":case"hotkey":return{type:Tn.HOTKEY,values:a};case"copyit":return{type:Tn.COPYIT,values:a};case"openit":return{type:Tn.OPENIT,values:a};case"zssedit":return{type:Tn.ZSSEDIT,values:a};case"charedit":return{type:Tn.CHAREDIT,values:a};case"coloredit":return{type:Tn.COLOREDIT,values:a}}}}function $u(t){switch(t){case Tn.LOADER:return"loader";case Tn.BOARD:return"board";case Tn.OBJECT:return"object";case Tn.TERRAIN:return"terrain";case Tn.CHARSET:return"charset";case Tn.PALETTE:return"palette";case Tn.CONST:return"const";case Tn.RANGE:return"range";case Tn.SELECT:return"select";case Tn.NUMBER:return"number";case Tn.TEXT:return"text";case Tn.LINK:return"link";case Tn.HOTKEY:return"hotkey";case Tn.COPYIT:return"copyit";case Tn.OPENIT:return"openit";case Tn.ZSSEDIT:return"zssedit";case Tn.CHAREDIT:return"charedit";case Tn.COLOREDIT:return"coloredit"}}function sEe(t,e){return{id:Po(),code:t,...e}}function IP(t){const e={...IM(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function oEe(t){const e=O7(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===$B){const o=s.image.slice(1),[a,c]=o.split(";").map(h=>h.trim()),l=a.split(" "),u=iEe(nr(c)?c:"",l,r),d=rr(u.values.join(" "));switch(r=!1,u.type){case Tn.LOADER:n.type=Dr.LOADER,n.name=d;break;case Tn.BOARD:n.type=Dr.BOARD,n.name=d;break;case Tn.OBJECT:n.type=Dr.OBJECT,n.name=d||"object";break;case Tn.TERRAIN:n.type=Dr.TERRAIN,n.name=d;break;case Tn.CHARSET:n.type=Dr.CHARSET,n.name=d;break;case Tn.PALETTE:n.type=Dr.PALETTE,n.name=d;break;case Tn.CONST:{const[h,p]=u.values;if(nr(h)){const f=rr(h);if(nr(p)){const g=parseFloat(p);n[f]=Mn(g)?g:p}else Mn(p)?n[f]=p:n[f]=1}break}case Tn.RANGE:case Tn.SELECT:case Tn.NUMBER:case Tn.TEXT:case Tn.LINK:case Tn.HOTKEY:case Tn.ZSSEDIT:case Tn.CHAREDIT:case Tn.COLOREDIT:{const[h,...p]=u.values;if(nr(h)){const f=rr(h);n[f]=[$u(u.type),...p]}break}}}}return n}function IM(t){var e;return he(t)?(he((e=t.stats)==null?void 0:e.type)||(t.stats=oEe(t.code),he(t.stats.type)||(t.stats.type=Dr.OBJECT)),t.stats):{}}function k7(t){switch(t){default:case Dr.ERROR:return"error";case Dr.LOADER:return $u(Tn.LOADER);case Dr.BOARD:return $u(Tn.BOARD);case Dr.OBJECT:return $u(Tn.OBJECT);case Dr.TERRAIN:return $u(Tn.TERRAIN);case Dr.CHARSET:return $u(Tn.CHARSET);case Dr.PALETTE:return $u(Tn.PALETTE)}}function kE(t){return IM(t).type??Dr.ERROR}function M1(t){return k7(kE(t))}function Ah(t){return IM(t).name??""}function F5(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!qr(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"ispushable":e.pushable=1;break;case"iswalk":case"iswalkable":e.collision=Gi.ISWALK;break;case"isswim":case"isswimable":e.collision=Gi.ISSWIM;break;case"issolid":e.collision=Gi.ISSOLID;break;case"isbullet":e.collision=Gi.ISBULLET;break;case"isdestructible":e.destructible=1;break}}}function Z0(t){if(he(t))switch(kE(t)){default:return;case Dr.ERROR:return t.code??"";case Dr.LOADER:return t.code??"";case Dr.BOARD:{he(t.board)||(t.board=$be()),t.board.id=t.id;const e=IP(t);return t.board.isdark=e.isdark??t.board.isdark?1:0,t.board.startx=e.startx??t.board.startx,t.board.starty=e.starty??t.board.starty,t.board.over=e.over??t.board.over,t.board.under=e.under??t.board.under,t.board.exitnorth=e.exitnorth??t.board.exitnorth,t.board.exitsouth=e.exitsouth??t.board.exitsouth,t.board.exitwest=e.exitwest??t.board.exitwest,t.board.exiteast=e.exiteast??t.board.exiteast,t.board.timelimit=e.timelimit??t.board.timelimit,t.board.restartonzap=e.restartonzap??t.board.restartonzap,t.board.maxplayershots=e.maxplayershots??t.board.maxplayershots,t.board}case Dr.OBJECT:return he(t.object)||(t.object=D5()),t.object.name=Ah(t),t.object.category=Y0.ISOBJECT,F5(IP(t),t.object),t.object;case Dr.TERRAIN:return he(t.terrain)||(t.terrain=D5()),t.terrain.name=Ah(t),t.terrain.category=Y0.ISTERRAIN,F5(IP(t),t.terrain),t.terrain;case Dr.PALETTE:return he(t.palette)||(t.palette=Fw(aM)),t.palette;case Dr.CHARSET:return he(t.charset)||(t.charset=Bw(oM)),t.charset}}function N7(t){return{id:Po(),name:uhe(),timestamp:0,activelist:[],pages:t,flags:{}}}function jw(t,e){if(!he(t))return;const n=rr(e);return t.pages.find(i=>i.id===e||n===Ah(i))}function jT(t,e,n){if(!he(t))return;const r=rr(n);return t.pages.find(s=>kE(s)===e&&(s.id===n||r===Ah(s)))}function J2(t,e,n){let r=jT(t,e,n);if(!he(r)){const i=k7(e);r=sEe(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),aEe(t,r)}return r}function N0(t,e,n){return he(t)?t.pages.filter(r=>kE(r)===e).filter(r=>{const i=IM(r);return he(i[n])}):[]}function aEe(t,e){if(!he(t)||!he(e))return!1;const n=jw(t,e.id);return he(n)?!1:(t.pages.push(e),!0)}function cEe(t,e){const n=jw(t,e);if(he(t)&&he(n)){const r=rr(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==Ah(i)),n}}function $w(t,e){if(he(e)&&he(e.kind))return he(e.kinddata)||(e.kinddata=he(e.id)?HB(t,e.kind):D7(t,e.kind)),e.kinddata}function P7(t,e,n){const r=$w(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function HB(t,e){const n=e??"",r=jT(t,Dr.OBJECT,n);if(he(r)){const i=Z0(r);return{...Gc(i),name:n,code:r.code}}}function D7(t,e){const n=e??"",r=jT(t,Dr.TERRAIN,n);if(he(r)){const i=Z0(r);return{...Gc(i),name:n,code:r.code}}}function OM(t,e){const n=jw(t,e);return Z0(n)}function kM(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function lEe(t,e){t&&delete t.flags[e]}function L7(t,e,n){const r=kM(t,e);return r==null?void 0:r[n]}function uEe(t,e,n,r){const i=kM(t,e);return i&&(i[n]=r),r}function dEe(t,e){const n=L7(t,e,"board");return OM(t,nr(n)?n:"")}function hEe(t,e,n){if(!he(t))return;uEe(t,e,"board",n);const r=OM(t,n);he(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function iT(t,e,n,r){if(!he(t))return;const i=dEe(t,e);if(!he(i))return;const s=d_(i,e);if(!F2(s)||!(s!=null&&s.id))return;const o=OM(t,n);if(!he(o)||(Hv(t,o),VB(t,o,Gi.ISWALK,r)))return;delete i.objects[s.id];const a=FT(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=FT(o,s);o.lookup&&(o.lookup[c]=s.id),hEe(t,e,o.id)}function fEe(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=L7(t,r,"board");return nr(i)?i:""});return Vye(n)}function pEe(t){return fEe(t).map(n=>OM(t,n)).filter(he)}function VB(t,e,n,r){if(!he(t)||!he(e)||!he(e.lookup)||r.x<0||r.x>=ns||r.y<0||r.y>=kl)return!0;const i=r.x+r.y*ns,s=d_(e,e.lookup[i]??"404");if(he(s))return!0;const o=e.terrain[i];if(he(o)){const a=$w(t,o),c=o.collision??(a==null?void 0:a.collision);return I9(n,c)}return!1}function mEe(t,e,n,r){const i=d_(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=P7(t,i,"collision");return VB(t,e,a,r)}function U7(t,e,n,r){var u,d;const i=d_(e,(n==null?void 0:n.id)??"");if(!he(t)||!he(e)||!he(i)||!he(i.x)||!he(i.y)||!he(e.lookup)||r.x<0||r.x>=ns||r.y<0||r.y>=kl)return{name:"edge",kind:"edge",collision:Gi.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=FT(e,i),o=FT(e,r),a=i.collision??((u=i==null?void 0:i.kinddata)==null?void 0:u.collision)??Gi.ISWALK,c=d_(e,e.lookup[o]??"");if(he(c))return{...c};const l=e.terrain[o];if(he(l)){const h=l.collision??((d=l==null?void 0:l.kinddata)==null?void 0:d.collision)??Gi.ISWALK;if(I9(a,h))return{...l,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,he(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function Q2(t,e,n,r){var s;if(!he(t)||!he(e)||!he(e.named)||!he(n))return;const i=rr(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function gEe(t,e,n){if(!(!he(t)||!he(e)||!he(e.lookup)||!he(n==null?void 0:n.id))&&!he(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*ns]=n.id}}function Hv(t,e){var a;if(!he(t)||!he(e)||he(e.lookup)&&he(e.named))return;const n=new Array(ns*kl).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(he(l.x)&&he(l.y)&&he(l.id)&&!he(l.removed)){l.category=Y0.ISOBJECT,n[l.x+l.y*ns]=l.id;const u=rr(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(he(l)){l.x=s,l.y=o,l.category=Y0.ISTERRAIN;const u=Uw(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=ns&&(s=0,++o)}e.lookup=n,e.named=r}function NE(t,e,n,r){if(!he(n)||Uw(n)==="player")return!1;const i=n.id??"",s=n.x??0,o=n.y??0;return i?(n.removed=r,F7(t,e,n)):MM(e,{x:s,y:o}),!0}function F7(t,e,n){var r;if(he(t)&&he(e)&&he(n==null?void 0:n.id)){if(he(e.lookup)&&he(n.x)&&he(n.y)){const s=n.x+n.y*ns;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=Uw(n);he((r=e.named)==null?void 0:r[i])&&he(n.id)&&e.named[i].delete(n.id)}}function vEe(t,e,n,r){if(he(t)&&he(e)&&he(n)){const[i,s]=n,o=HB(t,i);if(he(o)&&he(o.name)){const a=q9(e,r,i);return FR(a,s),a}}}function BR(t,e,n,r,i){if(he(t)&&he(e)&&he(n)){const[s,o]=n,a=D7(t,s);if(he(a)){const l=Vbe(e,r,s);if(he(l)){FR(l,o);const u=LT(r,ns);return Q2(t,e,l,u),l}}const c=HB(t,s);if(he(c)&&he(c.name)){const l=q9(e,r,s,i);if(he(l))return FR(l,o),gEe(t,e,l),Q2(t,e,l),l}}}function B5(t,e,n){if(!dS(be.element))return 0;const[r,i]=Rt(e,0,[lt.DIR,lt.MAYBE_KIND]),s=i??["bullet"],o=vEe(be.book,be.board,s,{x:be.element.x,y:be.element.y});if(he(o)){o.arg=n,o.collision=Gi.ISBULLET,o.destructible=1,o.stepx=r.x-be.element.x,o.stepy=r.y-be.element.y,o.bg=Tr.ONCLEAR;const a=$w(be.book,o),c=o.code??(a==null?void 0:a.code)??"";G1e(be.book,be.board,o,c,1)}return t.yield(),0}function I1(t,e,n,r){var c,l;if(!dS(be.element)||!he(be.book)||!he(be.board)||!he(be.element))return 0;Hv(be.book,be.board);const[i,s]=Rt(e,0,[lt.DIR,lt.KIND]),o=B2(be.board,i);if((o==null?void 0:o.category)===Y0.ISOBJECT&&(o!=null&&o.pushable)){const u={x:((c=be.element)==null?void 0:c.x)??0,y:((l=be.element)==null?void 0:l.y)??0},d=Ta(i,Nv(u,i));U7(be.book,be.board,o,d)}if(!VB(be.book,be.board,Gi.ISWALK,i)){const u=BR(be.book,be.board,s,i,n);he(u)&&he(r)&&(u.arg=r)}return 0}const _Ee=Sg().command("board",(t,e)=>{if(!he(be.book))return 0;const[n,r,i]=Rt(e,0,[lt.NAME,lt.MAYBE_NUMBER,lt.MAYBE_NUMBER]),s=N0(be.book,Dr.BOARD,n);if(s.length){const o=Wu(...s);he(o)&&iT(be.book,be.elementfocus,o.id,{x:r??Math.round(ns*.5),y:i??Math.round(kl*.5)})}return 0}).command("edge",(t,e)=>{var s,o;if(!he(be.book)||!he(be.board)||!he(be.element))return 0;const[n,r]=Rt(e,0,[lt.DIR,lt.NAME]),i=N0(be.book,Dr.BOARD,r);if(i.length){const a={x:((s=be.element)==null?void 0:s.x)??0,y:((o=be.element)==null?void 0:o.y)??0},c=Nv(a,n),l=Wu(...i);switch(c){case pn.NORTH:be.board.exitnorth=l.id;break;case pn.SOUTH:be.board.exitsouth=l.id;break;case pn.WEST:be.board.exitwest=l.id;break;case pn.EAST:be.board.exiteast=l.id;break}}return 0}).command("shove",(t,e)=>{if(!he(be.book)||!he(be.board))return 0;Hv(be.book,be.board);const[n,r]=Rt(e,0,[lt.DIR,lt.DIR]),i=B2(be.board,n);return F2(i)&&SU(be.book,be.board,i,r),0}).command("duplicate",()=>(!he(be.book)||!he(be.board),0)).command("replace",(t,e)=>{if(!he(be.book)||!he(be.board))return 0;Hv(be.book,be.board);const[n,r]=Rt(e,0,[lt.DIR,lt.KIND]),i=B2(be.board,n);return F2(i)&&NE(be.book,be.board,i,be.timestamp),BR(be.book,be.board,r,n),0}).command("write",(t,e)=>{var l;if(!he(be.book)||!he(be.board))return 0;Hv(be.book,be.board);const[n,r,i]=Rt(e,0,[lt.DIR,lt.COLOR,lt.STRING]),{color:s,bg:o}=kY(r),a=((l=KM(i,256,1))==null?void 0:l.measuredwidth)??1,c=Ty(256,1,s??Tr.WHITE,o??Tr.BLACK);Wn(i,c,!1);for(let u=0;u<a;++u){const d=MM(be.board,{x:n.x+u,y:n.y,char:c.char[u],color:c.color[u],bg:c.bg[u]});if(he(d)){const h=(d.x??0)+(d.y??0)*ns;Q2(be.book,be.board,d,h)}}return 0}).command("change",(t,e)=>{if(!he(be.book)||!he(be.board))return 0;Hv(be.book,be.board);const[n,r]=Rt(e,0,[lt.KIND,lt.KIND]);Hv(be.book,be.board);const i=LR(n)??"",s=Dw(be.board,i),o=O9(s,n),a=LR(r),c=A9(r),l=M9(r);return o.forEach(u=>{if(Uw(u)===a)he(c)&&(u.color=c),he(l)&&(u.bg=l);else{if(he(u.id)&&NE(be.book,be.board,u,be.timestamp))return 0;dS(u)&&BR(be.book,be.board,r,u)}}),0}).command("putwith",(t,e)=>{const[n,r]=Rt(e,0,[lt.ANY]);return I1(t,e.slice(r),n)}).command("put",(t,e)=>I1(t,e)).command("oneof",(t,e)=>{const[n,r]=Rt(e,0,[lt.ANY]);return he(be.board)&&d_(be.board,n)?0:I1(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=Rt(e,0,[lt.ANY,lt.ANY]);return he(be.board)&&d_(be.board,r)?0:I1(t,e.slice(i),r,n)}).command("shootwith",(t,e)=>{const[n,r]=Rt(e,0,[lt.ANY]);return B5(t,e.slice(r),n)}).command("shoot",B5);function $T(){return $T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},$T.apply(this,arguments)}function yEe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Z2(t,e)}function Z2(t,e){return Z2=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Z2(t,e)}function bEe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var zB=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[Pa].connections.iterate.delete(r),i.byKey.forEach(function(o){s[Pa].connections.byKey.get(o).delete(r)})}),this.observing.clear()},t}(),F0=[],NM=function(t){yEe(e,t);function e(r,i,s){var o;if(o=t.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){F0.push(bEe(o));try{o.func()}finally{F0.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=e.prototype;return n._trigger=function(){if(F0.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(zB);function B7(){return!!F0.length}function j7(){return F0.length?F0[F0.length-1]:void 0}function EEe(t,e,n){var r=$T({name:"unnamed",fireImmediately:!0},n),i=new NM(t,r,e);return i}var NC=0;function $7(){return NC>0}function eU(t){NC++;try{return t()}finally{NC--,NC===0&&TEe()}}var tU=!1;function H7(){return tU}function V7(t){tU=!0;try{t()}finally{tU=!1}}function SEe(t){return function(){return V7(t)}}var nU=[];function TEe(){var t=[].concat(nU);nU=[],z7(t)}function z7(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[Pa].connections.iterate.forEach(function(i){e.add(i)}),(r=n.observable[Pa].connections.byKey.get(n.key))==null||r.forEach(function(i){e.add(i)})}),e.forEach(function(n){n.trigger()})}function O1(t){if($7()){nU.push(t);return}z7([t])}function j5(t,e){if(t.type==="iterate")t.observable[Pa].connections.iterate.add(e);else{var n=t.observable[Pa].connections.byKey.get(t.key);n||(n=new Set,t.observable[Pa].connections.byKey.set(t.key,n)),n.add(e)}}function k1(t,e){if(!H7()){var n=j7();n&&(j5(t,n),n.registerConnection(t)),e&&(j5(t,e),e.registerConnection(t))}}var GB=Symbol("$skipreactive"),Pa=Symbol("$reactive"),Bd=Symbol("$reactiveproxy");function Hw(t,e){return!!(t&&t[Bd]&&t[Bd].implicitObserver===e)}function WB(t){return t[GB]=!0,t}function G7(t){return!!(t&&!Hw(t)&&t[Pa])}function rU(t,e,n){if(n===void 0&&(n=!1),t[GB]||Hw(t,e))return t;var r=wEe(t,n);if(!e)return r;var i=r[Pa].proxiesWithImplicitObserver.get(e);if(!i){var s={implicitObserver:e};Object.setPrototypeOf(s,W7),i=new Proxy(r[Pa].raw,s),r[Pa].proxiesWithImplicitObserver.set(e,i)}return i}var PE=rU;function wEe(t,e){if(e===void 0&&(e=!1),Hw(t))return t;if(G7(t))return t[Pa].proxy;if(t[Pa]||t[Bd])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,Pa,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,W7);return n.proxy=r,r}var W7={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||k1({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===Bd)return{implicitObserver:this.implicitObserver};var i=Reflect.get(e,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(e)?k1({observable:e,type:"iterate"},this.implicitObserver):k1({observable:e,key:n,type:"get"},this.implicitObserver),G7(i))return rU(i,this.implicitObserver);if(e[Pa].shallow)return i;if(typeof i=="object"&&i!==null&&!Hw(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(e,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(B7()||this.implicitObserver))return rU(i,this.implicitObserver)}return i},ownKeys:function(e){return k1({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,i){return eU(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,i);var s=Object.hasOwnProperty.call(e,n),o=Reflect.get(e,n,i),a=Reflect.set(e,n,r,i);if(!s)O1({observable:e,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)O1({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else O1({observable:e,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,n){return eU(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),i=Reflect.get(e,n),s=Reflect.deleteProperty(e,n);return r&&O1({observable:e,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function xEe(t,e){var n=$T({name:"unnamed",fireImmediately:!0},e),r=new NM(t,n);return r}function CEe(t,e,n){var r=$T({name:"unnamed",fireImmediately:!0},n),i=new NM(function(){t(e)},r);return e=PE(e,i),r.fireImmediately&&i.trigger(),i}var q7=function(){function t(){this._observable=PE({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return PE(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function REe(t,e,n){return new q7}const AEe=Object.freeze(Object.defineProperty({__proto__:null,$reactive:Pa,$reactiveproxy:Bd,$skipreactive:GB,Atom:q7,Observer:zB,Reaction:NM,autorun:xEe,autorunAsync:CEe,createAtom:REe,hasRunningReaction:B7,isActionRunning:$7,isReactive:Hw,isTrackingDisabled:H7,markRaw:WB,reaction:EEe,reactive:PE,runInAction:eU,runningReaction:j7,untracked:V7,untrackedCB:SEe},Symbol.toStringTag,{value:"Module"})),$h=()=>new Map,iU=t=>{const e=$h();return t.forEach((n,r)=>{e.set(r,n)}),e},M_=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},MEe=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},IEe=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},DE=()=>new Set,OP=t=>t[t.length-1],OEe=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},h_=Array.from,kEe=Array.isArray;class NEe{constructor(){this._observers=$h()}on(e,n){return M_(this._observers,e,DE).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return h_((this._observers.get(e)||$h()).values()).forEach(r=>r(...n))}destroy(){this._observers=$h()}}const f_=Math.floor,PC=Math.abs,K7=(t,e)=>t<e?t:e,by=(t,e)=>t>e?t:e,Y7=t=>t!==0?t<0:1/t<0,$5=1,H5=2,kP=4,NP=8,HT=32,rg=64,Xu=128,PM=31,sU=63,B0=127,PEe=2147483647,X7=Number.MAX_SAFE_INTEGER,DEe=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&f_(t)===t),LEe=t=>t.toLowerCase(),UEe=/^\s*/g,FEe=t=>t.replace(UEe,""),BEe=/([A-Z])/g,V5=(t,e)=>FEe(t.replace(BEe,n=>`${e}${LEe(n)}`)),jEe=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},VT=typeof TextEncoder<"u"?new TextEncoder:null,$Ee=t=>VT.encode(t),HEe=VT?$Ee:jEe;let vT=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});vT&&vT.decode(new Uint8Array).length===1&&(vT=null);class Vw{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Jv=()=>new Vw,VEe=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Uh=t=>{const e=new Uint8Array(VEe(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},zEe=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(by(n,e)*2),t.cpos=0)},Qa=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},oU=Qa,Xr=(t,e)=>{for(;e>B0;)Qa(t,Xu|B0&e),e=f_(e/128);Qa(t,B0&e)},qB=(t,e)=>{const n=Y7(e);for(n&&(e=-e),Qa(t,(e>sU?Xu:0)|(n?rg:0)|sU&e),e=f_(e/64);e>0;)Qa(t,(e>B0?Xu:0)|B0&e),e=f_(e/128)},aU=new Uint8Array(3e4),GEe=aU.length/3,WEe=(t,e)=>{if(e.length<GEe){const n=VT.encodeInto(e,aU).written||0;Xr(t,n);for(let r=0;r<n;r++)Qa(t,aU[r])}else zc(t,HEe(e))},qEe=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;Xr(t,r);for(let i=0;i<r;i++)Qa(t,n.codePointAt(i))},sE=VT&&VT.encodeInto?WEe:qEe,DM=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=K7(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(by(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},zc=(t,e)=>{Xr(t,e.byteLength),DM(t,e)},KB=(t,e)=>{zEe(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},KEe=(t,e)=>KB(t,4).setFloat32(0,e,!1),YEe=(t,e)=>KB(t,8).setFloat64(0,e,!1),XEe=(t,e)=>KB(t,8).setBigInt64(0,e,!1),z5=new DataView(new ArrayBuffer(4)),JEe=t=>(z5.setFloat32(0,t),z5.getFloat32(0)===t),zT=(t,e)=>{switch(typeof e){case"string":Qa(t,119),sE(t,e);break;case"number":DEe(e)&&PC(e)<=PEe?(Qa(t,125),qB(t,e)):JEe(e)?(Qa(t,124),KEe(t,e)):(Qa(t,123),YEe(t,e));break;case"bigint":Qa(t,122),XEe(t,e);break;case"object":if(e===null)Qa(t,126);else if(kEe(e)){Qa(t,117),Xr(t,e.length);for(let n=0;n<e.length;n++)zT(t,e[n])}else if(e instanceof Uint8Array)Qa(t,116),zc(t,e);else{Qa(t,118);const n=Object.keys(e);Xr(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];sE(t,i),zT(t,e[i])}}break;case"boolean":Qa(t,e?120:121);break;default:Qa(t,127)}};class G5 extends Vw{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Xr(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const W5=t=>{t.count>0&&(qB(t.encoder,t.count===1?t.s:-t.s),t.count>1&&Xr(t.encoder,t.count-2))};class DC{constructor(){this.encoder=new Vw,this.s=0,this.count=0}write(e){this.s===e?this.count++:(W5(this),this.count=1,this.s=e)}toUint8Array(){return W5(this),Uh(this.encoder)}}const q5=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);qB(t.encoder,e),t.count>1&&Xr(t.encoder,t.count-2)}};class PP{constructor(){this.encoder=new Vw,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(q5(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return q5(this),Uh(this.encoder)}}class QEe{constructor(){this.sarr=[],this.s="",this.lensE=new DC}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Vw;return this.sarr.push(this.s),this.s="",sE(e,this.sarr.join("")),DM(e,this.lensE.toUint8Array()),Uh(e)}}const p_=t=>new Error(t),hp=()=>{throw p_("Method unimplemented")},_p=()=>{throw p_("Unexpected case")},J7=p_("Unexpected end of array"),Q7=p_("Integer out of Range");class LM{constructor(e){this.arr=e,this.pos=0}}const Ey=t=>new LM(t),ZEe=t=>t.pos!==t.arr.length,eSe=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Tl=t=>eSe(t,Jr(t)),LE=t=>t.arr[t.pos++],Jr=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&B0)*n,n*=128,i<Xu)return e;if(e>X7)throw Q7}throw J7},YB=t=>{let e=t.arr[t.pos++],n=e&sU,r=64;const i=(e&rg)>0?-1:1;if(!(e&Xu))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&B0)*r,r*=128,e<Xu)return i*n;if(n>X7)throw Q7}throw J7},tSe=t=>{let e=Jr(t);if(e===0)return"";{let n=String.fromCodePoint(LE(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(LE(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},nSe=t=>vT.decode(Tl(t)),oE=vT?nSe:tSe,XB=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},rSe=t=>XB(t,4).getFloat32(0,!1),iSe=t=>XB(t,8).getFloat64(0,!1),sSe=t=>XB(t,8).getBigInt64(0,!1),oSe=[t=>{},t=>null,YB,rSe,iSe,sSe,t=>!1,t=>!0,oE,t=>{const e=Jr(t),n={};for(let r=0;r<e;r++){const i=oE(t);n[i]=GT(t)}return n},t=>{const e=Jr(t),n=[];for(let r=0;r<e;r++)n.push(GT(t));return n},Tl],GT=t=>oSe[127-LE(t)](t);class K5 extends LM{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),ZEe(this)?this.count=Jr(this)+1:this.count=-1),this.count--,this.s}}class LC extends LM{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=YB(this);const e=Y7(this.s);this.count=1,e&&(this.s=-this.s,this.count=Jr(this)+2)}return this.count--,this.s}}class DP extends LM{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=YB(this),n=e&1;this.diff=f_(e/2),this.count=1,n&&(this.count=Jr(this)+2)}return this.s+=this.diff,this.count--,this.s}}class aSe{constructor(e){this.decoder=new LC(e),this.str=oE(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const cSe=crypto.getRandomValues.bind(crypto),Z7=()=>cSe(new Uint32Array(1))[0],lSe="10000000-1000-4000-8000"+-1e11,uSe=()=>lSe.replace(/[018]/g,t=>(t^Z7()&15>>t/4).toString(16)),Y5=t=>new Promise(t);Promise.all.bind(Promise);const X5=t=>t===void 0?null:t;class dSe{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let eK=new dSe,hSe=!0;try{typeof localStorage<"u"&&localStorage&&(eK=localStorage,hSe=!1)}catch{}const fSe=eK,pSe=Object.assign,mSe=Object.keys,gSe=(t,e)=>{for(const n in t)e(t[n],n)},J5=t=>mSe(t).length,vSe=t=>{for(const e in t)return!1;return!0},_Se=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},ySe=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),bSe=(t,e)=>t===e||J5(t)===J5(e)&&_Se(t,(n,r)=>(n!==void 0||ySe(e,r))&&e[r]===n),ESe=Object.freeze,tK=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&tK(t[e])}return ESe(t)},JB=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&JB(t,e,n+1)}},SSe=t=>t,TSe=(t,e)=>e.includes(t);var nK={};const WT=typeof Bn<"u"&&Bn.release&&/node|io\.js/.test(Bn.release.name)&&Object.prototype.toString.call(typeof Bn<"u"?Bn:0)==="[object process]";let $f;const wSe=()=>{if($f===void 0)if(WT){$f=$h();const t=Bn.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&$f.set(e,""),e=r):e!==null&&($f.set(e,r),e=null)}e!==null&&$f.set(e,"")}else typeof location=="object"?($f=$h(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");$f.set(`--${V5(e,"-")}`,n),$f.set(`-${V5(e,"-")}`,n)}})):$f=$h();return $f},cU=t=>wSe().has(t),jR=t=>X5(WT?nK[t.toUpperCase().replaceAll("-","_")]:fSe.getItem(t)),rK=t=>cU("--"+t)||jR(t)!==null;rK("production");const xSe=WT&&TSe(nK.FORCE_COLOR,["true","1","2"]),CSe=xSe||!cU("--no-colors")&&!rK("no-color")&&(!WT||Bn.stdout.isTTY)&&(!WT||cU("--color")||jR("COLORTERM")!==null||(jR("TERM")||"").includes("color")),RSe=t=>new Uint8Array(t),ASe=t=>{const e=RSe(t.byteLength);return e.set(t),e};class MSe{constructor(e,n){this.left=e,this.right=n}}const Pm=(t,e)=>new MSe(t,e);typeof DOMParser<"u"&&new DOMParser;const ISe=t=>MEe(t,(e,n)=>`${n}:${e};`).join(""),Tg=Symbol,iK=Tg(),sK=Tg(),OSe=Tg(),kSe=Tg(),NSe=Tg(),oK=Tg(),PSe=Tg(),QB=Tg(),DSe=Tg(),LSe=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},USe={[iK]:Pm("font-weight","bold"),[sK]:Pm("font-weight","normal"),[OSe]:Pm("color","blue"),[NSe]:Pm("color","green"),[kSe]:Pm("color","grey"),[oK]:Pm("color","red"),[PSe]:Pm("color","purple"),[QB]:Pm("color","orange"),[DSe]:Pm("color","black")},FSe=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=$h();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=USe[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=ISe(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i},aK=CSe?FSe:LSe,BSe=(...t)=>{console.log(...aK(t)),cK.forEach(e=>e.print(t))},jSe=(...t)=>{console.warn(...aK(t)),t.unshift(QB),cK.forEach(e=>e.print(t))},cK=DE(),lK=t=>({[Symbol.iterator](){return this},next:t}),$Se=(t,e)=>lK(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),LP=(t,e)=>lK(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class ZB{constructor(e,n){this.clock=e,this.len=n}}class zw{constructor(){this.clients=new Map}}const uK=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];TK(t,s,a.clock,a.len,n)}}),HSe=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=f_((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},dK=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&HSe(n,e.clock)!==null},e3=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=by(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},VSe=t=>{const e=new zw;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)OEe(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return e3(e),e},$R=(t,e,n,r)=>{M_(t.clients,e,()=>[]).push(new ZB(n,r))},zSe=()=>new zw,GSe=t=>{const e=zSe();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new ZB(a,c))}}i.length>0&&e.clients.set(r,i)}),e},hS=(t,e)=>{Xr(t.restEncoder,e.clients.size),h_(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),Xr(t.restEncoder,n);const i=r.length;Xr(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},t3=t=>{const e=new zw,n=Jr(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Jr(t.restDecoder),s=Jr(t.restDecoder);if(s>0){const o=M_(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new ZB(t.readDsClock(),t.readDsLen()))}}return e},Q5=(t,e,n)=>{const r=new zw,i=Jr(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Jr(t.restDecoder),a=Jr(t.restDecoder),c=n.clients.get(o)||[],l=oc(n,o);for(let u=0;u<a;u++){const d=t.readDsClock(),h=d+t.readDsLen();if(d<l){l<h&&$R(r,o,l,h-l);let p=zh(c,d),f=c[p];for(!f.deleted&&f.id.clock<d&&(c.splice(p+1,0,WR(e,f,d-f.id.clock)),p++);p<c.length&&(f=c[p++],f.id.clock<h);)f.deleted||(h<f.id.clock+f.length&&c.splice(p,0,WR(e,f,h-f.id.clock)),f.delete(e))}else $R(r,o,d,h-d)}}if(r.clients.size>0){const s=new ey;return Xr(s.restEncoder,0),hS(s,r),s.toUint8Array()}return null},hK=Z7;class wg extends NEe{constructor({guid:e=uSe(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=hK(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new EK,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Y5(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Y5(l=>{const u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&xs(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(h_(this.subdocs).map(e=>e.guid))}transact(e,n=null){return xs(this,e,n)}get(e,n=wo){const r=M_(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==wo&&i!==n)if(i===wo){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,fp)}getText(e=""){return this.get(e,Gh)}getMap(e=""){return this.get(e,yp)}getXmlElement(e=""){return this.get(e,hg)}getXmlFragment(e=""){return this.get(e,bp)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,h_(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new wg({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,xs(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class fK{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Jr(this.restDecoder)}readDsLen(){return Jr(this.restDecoder)}}class pK extends fK{readLeftID(){return Si(Jr(this.restDecoder),Jr(this.restDecoder))}readRightID(){return Si(Jr(this.restDecoder),Jr(this.restDecoder))}readClient(){return Jr(this.restDecoder)}readInfo(){return LE(this.restDecoder)}readString(){return oE(this.restDecoder)}readParentInfo(){return Jr(this.restDecoder)===1}readTypeRef(){return Jr(this.restDecoder)}readLen(){return Jr(this.restDecoder)}readAny(){return GT(this.restDecoder)}readBuf(){return ASe(Tl(this.restDecoder))}readJSON(){return JSON.parse(oE(this.restDecoder))}readKey(){return oE(this.restDecoder)}}class WSe{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Jr(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Jr(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class UE extends WSe{constructor(e){super(e),this.keys=[],Jr(e),this.keyClockDecoder=new DP(Tl(e)),this.clientDecoder=new LC(Tl(e)),this.leftClockDecoder=new DP(Tl(e)),this.rightClockDecoder=new DP(Tl(e)),this.infoDecoder=new K5(Tl(e),LE),this.stringDecoder=new aSe(Tl(e)),this.parentInfoDecoder=new K5(Tl(e),LE),this.typeRefDecoder=new LC(Tl(e)),this.lenDecoder=new LC(Tl(e))}readLeftID(){return new aE(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new aE(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return GT(this.restDecoder)}readBuf(){return Tl(this.restDecoder)}readJSON(){return GT(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class mK{constructor(){this.restEncoder=Jv()}toUint8Array(){return Uh(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Xr(this.restEncoder,e)}writeDsLen(e){Xr(this.restEncoder,e)}}class Gw extends mK{writeLeftID(e){Xr(this.restEncoder,e.client),Xr(this.restEncoder,e.clock)}writeRightID(e){Xr(this.restEncoder,e.client),Xr(this.restEncoder,e.clock)}writeClient(e){Xr(this.restEncoder,e)}writeInfo(e){oU(this.restEncoder,e)}writeString(e){sE(this.restEncoder,e)}writeParentInfo(e){Xr(this.restEncoder,e?1:0)}writeTypeRef(e){Xr(this.restEncoder,e)}writeLen(e){Xr(this.restEncoder,e)}writeAny(e){zT(this.restEncoder,e)}writeBuf(e){zc(this.restEncoder,e)}writeJSON(e){sE(this.restEncoder,JSON.stringify(e))}writeKey(e){sE(this.restEncoder,e)}}class gK{constructor(){this.restEncoder=Jv(),this.dsCurrVal=0}toUint8Array(){return Uh(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,Xr(this.restEncoder,n)}writeDsLen(e){e===0&&_p(),Xr(this.restEncoder,e-1),this.dsCurrVal+=e}}class ey extends gK{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new PP,this.clientEncoder=new DC,this.leftClockEncoder=new PP,this.rightClockEncoder=new PP,this.infoEncoder=new G5(oU),this.stringEncoder=new QEe,this.parentInfoEncoder=new G5(oU),this.typeRefEncoder=new DC,this.lenEncoder=new DC}toUint8Array(){const e=Jv();return Xr(e,0),zc(e,this.keyClockEncoder.toUint8Array()),zc(e,this.clientEncoder.toUint8Array()),zc(e,this.leftClockEncoder.toUint8Array()),zc(e,this.rightClockEncoder.toUint8Array()),zc(e,Uh(this.infoEncoder)),zc(e,this.stringEncoder.toUint8Array()),zc(e,Uh(this.parentInfoEncoder)),zc(e,this.typeRefEncoder.toUint8Array()),zc(e,this.lenEncoder.toUint8Array()),DM(e,Uh(this.restEncoder)),Uh(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){zT(this.restEncoder,e)}writeBuf(e){zc(this.restEncoder,e)}writeJSON(e){zT(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const qSe=(t,e,n,r)=>{r=by(r,e[0].id.clock);const i=zh(e,r);Xr(t.restEncoder,e.length-i),t.writeClient(n),Xr(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},n3=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{oc(e,s)>i&&r.set(s,i)}),UM(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Xr(t.restEncoder,r.size),h_(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{qSe(t,e.clients.get(i),i,s)})},KSe=(t,e)=>{const n=$h(),r=Jr(t.restDecoder);for(let i=0;i<r;i++){const s=Jr(t.restDecoder),o=new Array(s),a=t.readClient();let c=Jr(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(PM&u){case 0:{const d=t.readLen();o[l]=new qu(Si(a,c),d),c+=d;break}case 10:{const d=Jr(t.restDecoder);o[l]=new Id(Si(a,c),d),c+=d;break}default:{const d=(u&(rg|Xu))===0,h=new ka(Si(a,c),null,(u&Xu)===Xu?t.readLeftID():null,null,(u&rg)===rg?t.readRightID():null,d?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,d&&(u&HT)===HT?t.readString():null,HK(t,u));o[l]=h,c+=h.length}}}}return n},YSe=(t,e,n)=>{const r=[];let i=h_(n.keys()).sort((p,f)=>p-f);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let p=n.get(i[i.length-1]);for(;p.refs.length===p.i;)if(i.pop(),i.length>0)p=n.get(i[i.length-1]);else return null;return p};let o=s();if(o===null)return null;const a=new EK,c=new Map,l=(p,f)=>{const g=c.get(p);(g==null||g>f)&&c.set(p,f)};let u=o.refs[o.i++];const d=new Map,h=()=>{for(const p of r){const f=p.id.client,g=n.get(f);g?(g.i--,a.clients.set(f,g.refs.slice(g.i)),n.delete(f),g.i=0,g.refs=[]):a.clients.set(f,[p]),i=i.filter(y=>y!==f)}r.length=0};for(;;){if(u.constructor!==Id){const f=M_(d,u.id.client,()=>oc(e,u.id.client))-u.id.clock;if(f<0)r.push(u),l(u.id.client,u.id.clock-1),h();else{const g=u.getMissing(t,e);if(g!==null){r.push(u);const y=n.get(g)||{refs:[],i:0};if(y.refs.length===y.i)l(g,oc(e,g)),h();else{u=y.refs[y.i++];continue}}else(f===0||f<u.length)&&(u.integrate(t,f),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const p=new ey;return n3(p,a,new Map),Xr(p.restEncoder,0),{missing:c,update:p.toUint8Array()}}return null},XSe=(t,e)=>n3(t,e.doc.store,e.beforeState),JSe=(t,e,n,r=new UE(t))=>xs(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=KSe(r,o),l=YSe(i,a,c),u=a.pendingStructs;if(u){for(const[h,p]of u.missing)if(p<oc(a,h)){s=!0;break}if(l){for(const[h,p]of l.missing){const f=u.missing.get(h);(f==null||f>p)&&u.missing.set(h,p)}u.update=HR([u.update,l.update])}}else a.pendingStructs=l;const d=Q5(r,i,a);if(a.pendingDs){const h=new UE(Ey(a.pendingDs));Jr(h.restDecoder);const p=Q5(h,i,a);d&&p?a.pendingDs=HR([d,p]):a.pendingDs=d||p}else a.pendingDs=d;if(s){const h=a.pendingStructs.update;a.pendingStructs=null,vK(i.doc,h)}},n,!1),vK=(t,e,n,r=UE)=>{const i=Ey(e);JSe(i,t,n,new r(i))},QSe=(t,e,n)=>vK(t,e,n,pK),ZSe=(t,e,n=new Map)=>{n3(t,e.store,n),hS(t,GSe(e.store))},eTe=(t,e=new Uint8Array([0]),n=new ey)=>{const r=_K(e);ZSe(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(gTe(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Gw)return pTe(i.map((s,o)=>o===0?s:_Te(s)));if(n.constructor===ey)return HR(i)}return i[0]},tTe=(t,e)=>eTe(t,e,new Gw),nTe=t=>{const e=new Map,n=Jr(t.restDecoder);for(let r=0;r<n;r++){const i=Jr(t.restDecoder),s=Jr(t.restDecoder);e.set(i,s)}return e},_K=t=>nTe(new fK(Ey(t))),yK=(t,e)=>(Xr(t.restEncoder,e.size),h_(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Xr(t.restEncoder,n),Xr(t.restEncoder,r)}),t),rTe=(t,e)=>yK(t,UM(e.store)),iTe=(t,e=new gK)=>(t instanceof Map?yK(e,t):rTe(e,t),e.toUint8Array()),sTe=t=>iTe(t,new mK);class oTe{constructor(){this.l=[]}}const Z5=()=>new oTe,e6=(t,e)=>t.l.push(e),t6=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},bK=(t,e,n)=>JB(t.l,[e,n]);class aE{constructor(e,n){this.client=e,this.clock=n}}const N1=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Si=(t,e)=>new aE(t,e),aTe=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw _p()},Ob=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!dK(e.ds,t.id),lU=(t,e)=>{const n=M_(t.meta,lU,DE),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<oc(r,s)&&m_(t,Si(s,i))}),uK(t,e.ds,i=>{}),n.add(e))};class EK{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const UM=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},oc=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},SK=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw _p()}n.push(e)},zh=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=f_(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=f_((n+r)/2)}throw _p()},cTe=(t,e)=>{const n=t.clients.get(e.client);return n[zh(n,e.clock)]},UP=cTe,uU=(t,e,n)=>{const r=zh(e,n),i=e[r];return i.id.clock<n&&i instanceof ka?(e.splice(r+1,0,WR(t,i,n-i.id.clock)),r+1):r},m_=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[uU(t,n,e.clock)]},n6=(t,e,n)=>{const r=e.clients.get(n.client),i=zh(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==qu&&r.splice(i+1,0,WR(t,s,n.clock-s.id.clock+1)),s},lTe=(t,e,n)=>{const r=t.clients.get(e.id.client);r[zh(r,e.id.clock)]=n},TK=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=uU(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&uU(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class uTe{constructor(e,n,r){this.doc=e,this.deleteSet=new zw,this.beforeState=UM(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const r6=(t,e)=>e.deleteSet.clients.size===0&&!IEe(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(e3(e.deleteSet),XSe(t,e),hS(t,e.deleteSet),!0),i6=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&M_(t.changed,e,DE).add(n)},UC=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ka&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},dTe=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=zh(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const d=s[l];if(a.clock+a.len<=d.id.clock)break;d instanceof ka&&d.deleted&&!d.keep&&n(d)&&d.gc(e,!1)}}}},hTe=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=K7(i.length-1,1+zh(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+UC(i,c)}})},wK=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{e3(s),n.afterState=UM(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,d)=>u.path.length-d.path.length),bK(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),JB(a,[]),n._needFormattingCleanup&&kTe(n)}finally{r.gc&&dTe(s,i,r.gcFilter),hTe(s,i),n.afterState.forEach((u,d)=>{const h=n.beforeState.get(d)||0;if(h!==u){const p=i.clients.get(d),f=by(zh(p,h),1);for(let g=p.length-1;g>=f;)g-=1+UC(p,g)}});for(let u=o.length-1;u>=0;u--){const{client:d,clock:h}=o[u].id,p=i.clients.get(d),f=zh(p,h);f+1<p.length&&UC(p,f+1)>1||f>0&&UC(p,f)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(BSe(QB,iK,"[yjs] ",sK,oK,"Changed the client-id because another client seems to be using it."),r.clientID=hK()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Gw;r6(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new ey;r6(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):wK(t,e+1)}}},xs=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new uTe(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&wK(i,0)}}return o};function*fTe(t){const e=Jr(t.restDecoder);for(let n=0;n<e;n++){const r=Jr(t.restDecoder),i=t.readClient();let s=Jr(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Jr(t.restDecoder);yield new Id(Si(i,s),c),s+=c}else if(PM&a){const c=(a&(rg|Xu))===0,l=new ka(Si(i,s),null,(a&Xu)===Xu?t.readLeftID():null,null,(a&rg)===rg?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&HT)===HT?t.readString():null,HK(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new qu(Si(i,s),c),s+=c}}}}class r3{constructor(e,n){this.gen=fTe(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Id);return this.curr}}class i3{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const pTe=t=>HR(t,pK,Gw),mTe=(t,e)=>{if(t.constructor===qu){const{client:n,clock:r}=t.id;return new qu(Si(n,r+e),t.length-e)}else if(t.constructor===Id){const{client:n,clock:r}=t.id;return new Id(Si(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new ka(Si(r,i+e),null,Si(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},HR=(t,e=UE,n=ey)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Ey(u)));let i=r.map(u=>new r3(u,!0)),s=null;const o=new n,a=new i3(o);for(;i=i.filter(h=>h.curr!==null),i.sort((h,p)=>{if(h.curr.id.client===p.curr.id.client){const f=h.curr.id.clock-p.curr.id.clock;return f===0?h.curr.constructor===p.curr.constructor?0:h.curr.constructor===Id?1:-1:f}else return p.curr.id.client-h.curr.id.client}),i.length!==0;){const u=i[0],d=u.curr.id.client;if(s!==null){let h=u.curr,p=!1;for(;h!==null&&h.id.clock+h.length<=s.struct.id.clock+s.struct.length&&h.id.client>=s.struct.id.client;)h=u.next(),p=!0;if(h===null||h.id.client!==d||p&&h.id.clock>s.struct.id.clock+s.struct.length)continue;if(d!==s.struct.id.client)Vv(a,s.struct,s.offset),s={struct:h,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<h.id.clock)if(s.struct.constructor===Id)s.struct.length=h.id.clock+h.length-s.struct.id.clock;else{Vv(a,s.struct,s.offset);const f=h.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Id(Si(d,s.struct.id.clock+s.struct.length),f),offset:0}}else{const f=s.struct.id.clock+s.struct.length-h.id.clock;f>0&&(s.struct.constructor===Id?s.struct.length-=f:h=mTe(h,f)),s.struct.mergeWith(h)||(Vv(a,s.struct,s.offset),s={struct:h,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let h=u.curr;h!==null&&h.id.client===d&&h.id.clock===s.struct.id.clock+s.struct.length&&h.constructor!==Id;h=u.next())Vv(a,s.struct,s.offset),s={struct:h,offset:0}}s!==null&&(Vv(a,s.struct,s.offset),s=null),s3(a);const c=r.map(u=>t3(u)),l=VSe(c);return hS(o,l),o.toUint8Array()},gTe=(t,e,n=UE,r=ey)=>{const i=_K(e),s=new r,o=new i3(s),a=new n(Ey(t)),c=new r3(a,!1);for(;c.curr;){const u=c.curr,d=u.id.client,h=i.get(d)||0;if(c.curr.constructor===Id){c.next();continue}if(u.id.clock+u.length>h)for(Vv(o,u,by(h-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===d;)Vv(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===d&&c.curr.id.clock+c.curr.length<=h;)c.next()}s3(o);const l=t3(a);return hS(s,l),s.toUint8Array()},xK=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Uh(t.encoder.restEncoder)}),t.encoder.restEncoder=Jv(),t.written=0)},Vv=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&xK(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Xr(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},s3=t=>{xK(t);const e=t.encoder.restEncoder;Xr(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];Xr(e,r.written),DM(e,r.restEncoder)}},vTe=(t,e,n,r)=>{const i=new n(Ey(t)),s=new r3(i,!1),o=new r,a=new i3(o);for(let l=s.curr;l!==null;l=s.next())Vv(a,e(l),0);s3(a);const c=t3(i);return hS(o,c),o.toUint8Array()},_Te=t=>vTe(t,SSe,UE,Gw),s6="You must not compute changes after the event-handler fired.";class FM{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=yTe(this.currentTarget,this.target))}deletes(e){return dK(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw p_(s6);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=OP(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=OP(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=OP(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw p_(s6);const n=this.target,r=DE(),i=DE(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const yTe=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},qc=()=>{jSe("Invalid access: Add Yjs type to a document before reading data.")},CK=80;let o3=0;class bTe{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=o3++}}const ETe=t=>{t.timestamp=o3++},RK=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=o3++},STe=(t,e,n)=>{if(t.length>=CK){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return RK(r,e,n),r}else{const r=new bTe(e,n);return t.push(r),r}},BM=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>PC(e-s.index)<PC(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,ETe(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&PC(n.index-i)<r.parent.length/CK?(RK(n,r,i),n):STe(t._searchMarker,r,i)},qT=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=by(e,i.index+n))}},jM=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;M_(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;bK(r._eH,n,e)};class wo{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Z5(),this._dEH=Z5(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw hp()}clone(){throw hp()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){e6(this._eH,e)}observeDeep(e){e6(this._dEH,e)}unobserve(e){t6(this._eH,e)}unobserveDeep(e){t6(this._dEH,e)}toJSON(){}}const AK=(t,e,n)=>{t.doc??qc(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},MK=t=>{t.doc??qc();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},KT=(t,e)=>{let n=0,r=t._start;for(t.doc??qc();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},IK=(t,e)=>{const n=[];return KT(t,(r,i)=>{n.push(e(r,i,t))}),n},TTe=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},OK=(t,e)=>{t.doc??qc();const n=BM(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},VR=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new ka(Si(o,oc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ny(l)),i.integrate(t,0),l=[])};r.forEach(d=>{if(d===null)l.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:i=new ka(Si(o,oc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ww(new Uint8Array(d))),i.integrate(t,0);break;case wg:i=new ka(Si(o,oc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new qw(d)),i.integrate(t,0);break;default:if(d instanceof wo)i=new ka(Si(o,oc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new xg(d)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},kK=()=>p_("Length exceeded!"),NK=(t,e,n,r)=>{if(n>e._length)throw kK();if(n===0)return e._searchMarker&&qT(e._searchMarker,n,r.length),VR(t,e,null,r);const i=n,s=BM(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&m_(t,Si(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&qT(e._searchMarker,i,r.length),VR(t,e,o,r)},wTe=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return VR(t,e,i,n)},PK=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=BM(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&m_(t,Si(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&m_(t,Si(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw kK();e._searchMarker&&qT(e._searchMarker,i,-s+r)},zR=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},a3=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new ny([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ny([r]);break;case Uint8Array:a=new Ww(r);break;case wg:a=new qw(r);break;default:if(r instanceof wo)a=new xg(r);else throw new Error("Unexpected content type")}new ka(Si(o,oc(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},c3=(t,e)=>{t.doc??qc();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},DK=t=>{const e={};return t.doc??qc(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},LK=(t,e)=>{t.doc??qc();const n=t._map.get(e);return n!==void 0&&!n.deleted},xTe=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Ob(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},P1=t=>(t.doc??qc(),$Se(t._map.entries(),e=>!e[1].deleted));class CTe extends FM{}class fp extends wo{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new fp;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new fp}clone(){const e=new fp;return e.insert(0,this.toArray().map(n=>n instanceof wo?n.clone():n)),e}get length(){return this.doc??qc(),this._length}_callObserver(e,n){super._callObserver(e,n),jM(this,e,new CTe(this,e))}insert(e,n){this.doc!==null?xs(this.doc,r=>{NK(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?xs(this.doc,n=>{wTe(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?xs(this.doc,r=>{PK(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return OK(this,e)}toArray(){return MK(this)}slice(e=0,n=this.length){return AK(this,e,n)}toJSON(){return this.map(e=>e instanceof wo?e.toJSON():e)}map(e){return IK(this,e)}forEach(e){KT(this,e)}[Symbol.iterator](){return TTe(this)}_write(e){e.writeTypeRef(JTe)}}const RTe=t=>new fp;class ATe extends FM{constructor(e,n,r){super(e,n),this.keysChanged=r}}class yp extends wo{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new yp}clone(){const e=new yp;return this.forEach((n,r)=>{e.set(r,n instanceof wo?n.clone():n)}),e}_callObserver(e,n){jM(this,e,new ATe(this,e,n))}toJSON(){this.doc??qc();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof wo?i.toJSON():i}}),e}get size(){return[...P1(this)].length}keys(){return LP(P1(this),e=>e[0])}values(){return LP(P1(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return LP(P1(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??qc(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?xs(this.doc,n=>{zR(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?xs(this.doc,r=>{a3(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return c3(this,e)}has(e){return LK(this,e)}clear(){this.doc!==null?xs(this.doc,e=>{this.forEach(function(n,r,i){zR(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(QTe)}}const MTe=t=>new yp,Gv=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&bSe(t,e);class dU{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&_p(),this.right.content.constructor){case Fa:this.right.deleted||fS(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const o6=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Fa:e.right.deleted||fS(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&m_(t,Si(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},D1=(t,e,n,r)=>{const i=new Map,s=r?BM(e,n):null;if(s){const o=new dU(s.p.left,s.p,s.index,i);return o6(t,o,n-s.index)}else{const o=new dU(null,e._start,0,i);return o6(t,o,n)}},UK=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Fa&&Gv(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new ka(Si(s,oc(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Fa(a,o));u.integrate(t,0),n.right=u,n.forward()})},fS=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},FK=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Fa&&Gv(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},BK=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Gv(l,c)){o.set(a,l);const{left:u,right:d}=n;n.right=new ka(Si(s,oc(i.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new Fa(a,c)),n.right.integrate(t,0),n.forward()}}return o},FP=(t,e,n,r,i)=>{n.currentAttributes.forEach((h,p)=>{i[p]===void 0&&(i[p]=null)});const s=t.doc,o=s.clientID;FK(n,i);const a=BK(t,e,n,i),c=r.constructor===String?new Ep(r):r instanceof wo?new xg(r):new Sy(r);let{left:l,right:u,index:d}=n;e._searchMarker&&qT(e._searchMarker,n.index,c.getLength()),u=new ka(Si(o,oc(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=d,n.forward(),UK(t,e,n,a)},a6=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;FK(n,i);const a=BK(t,e,n,i);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Fa));){if(!n.right.deleted)switch(n.right.content.constructor){case Fa:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Gv(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&m_(t,Si(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ka(Si(o,oc(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Ep(c)),n.right.integrate(t,0),n.forward()}UK(t,e,n,a)},jK=(t,e,n,r,i)=>{let s=e;const o=$h();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Fa){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Fa:{const{key:u,value:d}=l,h=r.get(u)??null;(o.get(u)!==l||h===d)&&(e.delete(t),a++,!c&&(i.get(u)??null)===d&&h!==d&&(h===null?i.delete(u):i.set(u,h))),!c&&!e.deleted&&fS(i,l);break}}}e=e.right}return a},ITe=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Fa){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},OTe=t=>{let e=0;return xs(t.doc,n=>{let r=t._start,i=t._start,s=$h();const o=iU(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Fa:fS(o,i.content);break;default:e+=jK(n,r,i,s,o),s=iU(o),r=i;break}i=i.right}}),e},kTe=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&TK(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Fa&&o.constructor!==qu&&e.add(o.parent)})}xs(n,r=>{uK(t,t.deleteSet,i=>{if(i instanceof qu||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Fa?e.add(s):ITe(r,i)});for(const i of e)OTe(i)})},c6=(t,e,n)=>{const r=n,i=iU(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case xg:case Sy:case Ep:n<e.right.length&&m_(t,Si(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&jK(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&qT(o._searchMarker,e.index,-r+n),e};class NTe extends FM{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];xs(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,d=0;const h=()=>{if(a!==null){let p=null;switch(a){case"delete":d>0&&(p={delete:d}),d=0;break;case"insert":(typeof l=="object"||l.length>0)&&(p={insert:l},i.size>0&&(p.attributes={},i.forEach((f,g)=>{f!==null&&(p.attributes[g]=f)}))),l="";break;case"retain":u>0&&(p={retain:u},vSe(c)||(p.attributes=pSe({},c))),u=0;break}p&&n.push(p),a=null}};for(;o!==null;){switch(o.content.constructor){case xg:case Sy:this.adds(o)?this.deletes(o)||(h(),a="insert",l=o.content.getContent()[0],h()):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),d+=1):o.deleted||(a!=="retain"&&(h(),a="retain"),u+=1);break;case Ep:this.adds(o)?this.deletes(o)||(a!=="insert"&&(h(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),d+=o.length):o.deleted||(a!=="retain"&&(h(),a="retain"),u+=o.length);break;case Fa:{const{key:p,value:f}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=i.get(p)??null;Gv(g,f)?f!==null&&o.delete(r):(a==="retain"&&h(),Gv(f,s.get(p)??null)?delete c[p]:c[p]=f)}}else if(this.deletes(o)){s.set(p,f);const g=i.get(p)??null;Gv(g,f)||(a==="retain"&&h(),c[p]=g)}else if(!o.deleted){s.set(p,f);const g=c[p];g!==void 0&&(Gv(g,f)?g!==null&&o.delete(r):(a==="retain"&&h(),f===null?delete c[p]:c[p]=f))}o.deleted||(a==="insert"&&h(),fS(i,o.content));break}}o=o.right}for(h();n.length>0;){const p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Gh extends wo{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??qc(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Gh}clone(){const e=new Gh;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new NTe(this,e,n);jM(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??qc();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ep&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?xs(this.doc,r=>{const i=new dU(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&FP(r,this,i,a,o.attributes||{})}else o.retain!==void 0?a6(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&c6(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??qc();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const d={};let h=!1;s.forEach((f,g)=>{h=!0,d[g]=f});const p={insert:a};h&&(p.attributes=d),i.push(p),a=""}}const u=()=>{for(;c!==null;){if(Ob(c,e)||n!==void 0&&Ob(c,n))switch(c.content.constructor){case Ep:{const d=s.get("ychange");e!==void 0&&!Ob(c,e)?(d===void 0||d.user!==c.id.client||d.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Ob(c,n)?(d===void 0||d.user!==c.id.client||d.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):d!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case xg:case Sy:{l();const d={insert:c.content.getContent()[0]};if(s.size>0){const h={};d.attributes=h,s.forEach((p,f)=>{h[f]=p})}i.push(d);break}case Fa:Ob(c,e)&&(l(),fS(s,c.content));break}c=c.right}l()};return e||n?xs(o,d=>{e&&lU(d,e),n&&lU(d,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?xs(i,s=>{const o=D1(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),FP(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?xs(i,s=>{const o=D1(s,this,e,!r);FP(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?xs(r,i=>{c6(i,D1(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?xs(i,s=>{const o=D1(s,this,e,!1);o.right!==null&&a6(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?xs(this.doc,n=>{zR(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?xs(this.doc,r=>{a3(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return c3(this,e)}getAttributes(){return DK(this)}_write(e){e.writeTypeRef(ZTe)}}const PTe=t=>new Gh;class BP{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??qc()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===hg||n.constructor===bp)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class bp extends wo{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new bp}clone(){const e=new bp;return e.insert(0,this.toArray().map(n=>n instanceof wo?n.clone():n)),e}get length(){return this.doc??qc(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new BP(this,e)}querySelector(e){e=e.toUpperCase();const r=new BP(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),h_(new BP(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){jM(this,e,new UTe(this,n,e))}toString(){return IK(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),KT(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?xs(this.doc,r=>{NK(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)xs(this.doc,r=>{const i=e&&e instanceof wo?e._item:e;VR(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw p_("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?xs(this.doc,r=>{PK(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return MK(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return OK(this,e)}slice(e=0,n=this.length){return AK(this,e,n)}forEach(e){KT(this,e)}_write(e){e.writeTypeRef(twe)}}const DTe=t=>new bp;class hg extends bp{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new hg(this.nodeName)}clone(){const e=new hg(this.nodeName),n=this.getAttributes();return gSe(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof wo?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?xs(this.doc,n=>{zR(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?xs(this.doc,r=>{a3(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return c3(this,e)}hasAttribute(e){return LK(this,e)}getAttributes(e){return e?xTe(this,e):DK(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return KT(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(ewe),e.writeKey(this.nodeName)}}const LTe=t=>new hg(t.readKey());class UTe extends FM{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class FE extends yp{constructor(e){super(),this.hookName=e}_copy(){return new FE(this.hookName)}clone(){const e=new FE(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(nwe),e.writeKey(this.hookName)}}const FTe=t=>new FE(t.readKey());class ty extends Gh{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ty}clone(){const e=new ty;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(rwe)}}const BTe=t=>new ty;class l3{constructor(e,n){this.id=e,this.length=n}get deleted(){throw hp()}mergeWith(e){return!1}write(e,n,r){throw hp()}integrate(e,n){throw hp()}}const jTe=0;class qu extends l3{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),SK(e.doc.store,this)}write(e,n){e.writeInfo(jTe),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Ww{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ww(this.content)}splice(e){throw hp()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const $Te=t=>new Ww(t.readBuf());class YT{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new YT(this.len)}splice(e){const n=new YT(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){$R(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const HTe=t=>new YT(t.readLen()),$K=(t,e)=>new wg({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class qw{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new qw($K(this.doc.guid,this.opts))}splice(e){throw hp()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const VTe=t=>new qw($K(t.readString(),t.readAny()));class Sy{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Sy(this.embed)}splice(e){throw hp()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const zTe=t=>new Sy(t.readJSON());class Fa{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Fa(this.key,this.value)}splice(e){throw hp()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const GTe=t=>new Fa(t.readKey(),t.readJSON());class GR{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new GR(this.arr)}splice(e){const n=new GR(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const WTe=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new GR(n)},qTe=jR("node_env")==="development";class ny{constructor(e){this.arr=e,qTe&&tK(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ny(this.arr)}splice(e){const n=new ny(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const KTe=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new ny(n)};class Ep{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ep(this.str)}splice(e){const n=new Ep(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const YTe=t=>new Ep(t.readString()),XTe=[RTe,MTe,PTe,LTe,DTe,FTe,BTe],JTe=0,QTe=1,ZTe=2,ewe=3,twe=4,nwe=5,rwe=6;class xg{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new xg(this.type._copy())}splice(e){throw hp()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const iwe=t=>new xg(XTe[t.readTypeRef()](t)),WR=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new ka(Si(r,i+n),e,Si(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Si(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class ka extends l3{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?H5:0}set marker(e){(this.info&NP)>0!==e&&(this.info^=NP)}get marker(){return(this.info&NP)>0}get keep(){return(this.info&$5)>0}set keep(e){this.keep!==e&&(this.info^=$5)}get countable(){return(this.info&H5)>0}get deleted(){return(this.info&kP)>0}set deleted(e){this.deleted!==e&&(this.info^=kP)}markDeleted(){this.info|=kP}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=oc(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=oc(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===aE&&this.id.client!==this.parent.client&&this.parent.clock>=oc(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=n6(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=m_(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===qu||this.right&&this.right.constructor===qu)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ka&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ka&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===aE){const r=UP(n,this.parent);r.constructor===qu?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=n6(e,e.doc.store,Si(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),N1(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(N1(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(UP(e.doc.store,i.origin)))s.has(UP(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),SK(e.doc.store,this),this.content.integrate(e,this),i6(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new qu(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Si(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&N1(e.origin,this.lastId)&&this.right===e&&N1(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),$R(e.deleteSet,this.id.client,this.id.clock,this.length),i6(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw _p();this.content.gc(e),n?lTe(e,this,new qu(this.id,this.length)):this.content=new YT(this.length)}write(e,n){const r=n>0?Si(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&PM|(r===null?0:Xu)|(i===null?0:rg)|(s===null?0:HT);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=aTe(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===aE?(e.writeParentInfo(!1),e.writeLeftID(a)):_p();s!==null&&e.writeString(s)}this.content.write(e,n)}}const HK=(t,e)=>swe[e&PM](t),swe=[()=>{_p()},HTe,WTe,$Te,YTe,zTe,GTe,iwe,KTe,VTe,()=>{_p()}],owe=10;class Id extends l3{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){_p()}write(e,n){e.writeInfo(owe),Xr(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const VK=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Xm<"u"?Xm:{},zK="__ $YJS$ __";VK[zK]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");VK[zK]=!0;let hU,fU,awe=t=>t();function cwe(t,e){if(fU)return fU(t,e);awe(t)}function ry(t,e,n){if(hU)return hU.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function lwe(t){hU=function(e,n,r){const i=t.createAtom(e);return n&&n(),i},fU=(e,n)=>t.reaction(e,n,{fireImmediately:!1})}const l6=new WeakSet;function uwe(t){if(l6.has(t))return t;l6.add(t);let e;const n=new Map;function r(){if(!e){const d=h=>{(h.changes.added.size||h.changes.deleted.size||h.changes.keys.size||h.changes.delta.length)&&e.reportChanged()};e=ry("map",()=>{t.observe(d)},()=>{t.unobserve(d)})}e.reportObserved(t._implicitObserver)}function i(d){let h=n.get(d);if(!h){const p=f=>{h.reportChanged()};h=ry(d+"",()=>{t.observe(p)},()=>{t.unobserve(p)}),n.set(d,h)}h.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(d){if(typeof d!="number")throw new Error("unexpected");return i(d),Reflect.apply(s,this,arguments)};function o(d){const h=t[d];t[d]=function(){return r(),Reflect.apply(h,this,arguments)}}function a(d){let h=t,p=Object.getOwnPropertyDescriptor(h,d);if(p||(h=Object.getPrototypeOf(h),p=Object.getOwnPropertyDescriptor(h,d)),p||(h=Object.getPrototypeOf(h),p=Object.getOwnPropertyDescriptor(h,d)),!p)throw new Error("property not found");const f=p.get;p.get=function(){return this._disableTracking||r(),Reflect.apply(f,this,arguments)},Object.defineProperty(t,d,p)}function c(d,h){let p=t,f=Object.getOwnPropertyDescriptor(p,d);if(f||(p=Object.getPrototypeOf(p),f=Object.getOwnPropertyDescriptor(p,d)),f||(p=Object.getPrototypeOf(p),f=Object.getOwnPropertyDescriptor(p,d)),!f)throw new Error("property not found");Object.defineProperty(t,h,f)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=t.push;t.push=function(d){this._disableTracking=!0;const h=l.call(this,d);return this._disableTracking=!1,h};const u=t.slice;return t.slice=function(d,h){this._disableTracking=!0;const p=u.call(this,d,h);return this._disableTracking=!1,p},t}const u6=new WeakSet;function dwe(t){if(u6.has(t))return t;u6.add(t);let e;function n(){if(!e){let s=Array.from(t.share.keys());const o=a=>{const c=Array.from(t.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,e.reportChanged())};e=ry("map",()=>{t.on("beforeObserverCalls",o)},()=>{t.off("beforeObserverCalls",o)})}e.reportObserved(t._implicitObserver)}const r=t.get;t.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return $M(o),o};function i(s){const o=t[s];let a;t[s]=function(){let c,l=arguments;return n(),a&&a.removeObservers(),a=cwe(()=>(c=Reflect.apply(o,t,l),c),()=>e.reportChanged()),c}}return i("toJSON"),Object.defineProperty(t,"keys",{get:()=>(n(),Object.keys(t.share))}),t}const d6=new WeakSet;function hwe(t){if(d6.has(t))return t;d6.add(t);let e;const n=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=ry("map",()=>{t.observe(a)},()=>{t.unobserve(a)})}e.reportObserved(t._implicitObserver)}function i(a){let c=n.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=ry(a,()=>{t.observe(l)},()=>{t.unobserve(l)}),n.set(a,c)}c.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=t[a];t[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),t}const h6=new WeakSet;function f6(t){if(h6.has(t))return t;h6.add(t);let e;const n=i=>{e.reportChanged()};e=ry("text",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(i){const s=t[i];t[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),t}const p6=new WeakSet;function m6(t){if(p6.has(t))return t;p6.add(t);let e;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&e.reportChanged()};e=ry("xml",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(s){const o=t[s];t[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=t,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(t,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),t}function $M(t){return t instanceof ty||t instanceof Gh?f6(t):t instanceof fp?uwe(t):t instanceof yp?hwe(t):t instanceof wg||Object.prototype.hasOwnProperty.call(t,"autoLoad")?dwe(t):t instanceof bp||t instanceof hg?m6(t):t}function g6(t){t.share.forEach(e=>{e.constructor!==wo&&$M(e)})}function v6(t,e){for(let r=t.length-1;r>=e;r--){let i=t[r];if(!i.deleted){var n;if(i instanceof qu)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof wo&&$M(s)})}}}const _6=new WeakSet;function fwe(t){_6.has(t)||(_6.add(t),$M(t),t.store.clients.forEach(e=>{e&&v6(e,0)}),g6(t),t.on("beforeObserverCalls",e=>{g6(t),e.afterState.forEach((n,r)=>{const i=e.beforeState.get(r)||0;if(i!==n){const s=e.doc.store.clients.get(r);if(!s)return;const o=zh(s,i);v6(s,o)}})}))}class XT{constructor(e){this.value=void 0,this.value=e}}function pwe(t){return ArrayBuffer.isView(t)?new XT(t):new XT(Object.freeze(t))}function mwe(t){const e=function(){var a;let c=(a=this[Bd])==null?void 0:a.implicitObserver;return t._implicitObserver=c,t.slice.bind(t).apply(t,arguments).map(u=>{const d=HM(u,c);return c&&typeof d=="object"?PE(d,c):d})},n=function(a){return a.map(c=>{const l=u3(c);let u=g_(l)||l;if(u instanceof XT&&(u=u.value),u instanceof wo&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},i={slice:e,unshift:(...o)=>(t.unshift(n(o)),t.lengthUntracked),push:(...o)=>(t.push(n(o)),t.lengthUntracked),insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>bwe(a,o))},splice:function(){let o=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return t.doc?t.doc.transact(()=>{t.delete(o,a),t.insert(o,n(c))}):(t.delete(o,a),t.insert(o,n(c))),l}},s=[];for(let o in i)s[o]=i[o];return s}function $S(t){if(typeof t=="string"&&t.trim().length){const e=Number(t);if(Number.isInteger(e))return e}return t}function y6(t,e=new fp){if(e[Pa])throw new Error("unexpected");const n=mwe(e),r=new Proxy(n,{set:(i,s,o)=>{throw typeof $S(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=$S(s);if(a===VM)return e;if(typeof a=="number"){let u;if(o&&o[Bd]){var c;u=(c=o[Bd])==null?void 0:c.implicitObserver,e._implicitObserver=u}let d=e.get(a);return d=HM(d,u),d}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=e.slice();return Reflect.get(u,a)}return a==="length"?e.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=$S(s);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(i,s)=>{const o=$S(s);return typeof o!="number"?Reflect.has(i,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=$S(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<e.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,t),r}function b6(t,e=new yp){if(e[Pa])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=u3(s);let a=g_(o)||o;if(a instanceof XT&&(a=a.value),a instanceof wo&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(i,a),!0},get:(r,i,s)=>{if(i===VM)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[Bd]){var a;o=(a=s[Bd])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(i);return c=HM(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return e.has(i)?(e.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&e.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});_T.set(e,n);for(let r in t)n[r]=t[r];return n}function gwe(t){return t instanceof wo}const _T=new WeakMap;function HM(t,e){if(gwe(t)){if(t._implicitObserver=e,t instanceof fp||t instanceof yp){if(!_T.has(t)){const n=u3(t);_T.set(t,n)}t=_T.get(t)}else if(t instanceof hg||t instanceof bp||t instanceof ty||t instanceof FE||t instanceof Gh)WB(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return pwe(t)}return t}function u3(t){if(t==null)return t;if(t=g_(t)||t,t instanceof fp)return y6([],t);if(t instanceof yp)return b6({},t);if(typeof t=="string")return t;if(Array.isArray(t))return y6(t);if(t instanceof hg||t instanceof bp||t instanceof ty||t instanceof FE)return t;if(t instanceof Gh)return t;if(typeof t=="object")return t instanceof XT?t:b6(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function vwe(t){for(let[e,n]of Object.entries(t))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function E6(t,e,n){let r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function _we(t,e){if(t[Pa])throw new Error("unexpected");vwe(e);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===VM)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[Bd]){var a;o=(a=s[Bd])==null?void 0:a.implicitObserver,t._implicitObserver=o}if(i==="toJSON"){for(let u of Object.keys(e))E6(t,e,u);return Reflect.get(t,i)}let c=E6(t,e,i);return c=HM(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&t.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.share.keys())});return _T.set(t,n),n}lwe(AEe);const VM=Symbol("INTERNAL_SYMBOL");function S6(t,e){const n=g_(t)||t;if(!n)throw new Error("not a valid synced object");return n instanceof wg?(n.on("update",e),()=>{n.off("update",e)}):(n.observeDeep(e),()=>{n.unobserveDeep(e)})}function ywe(t){const e=g_(t);if(!(e instanceof wg))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function g_(t){if(typeof t!="object"||t===null)return;const e=t[VM];return e&&(WB(e),e.__v_skip=!0),e}function bwe(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){const n=g_(t),r=g_(e);return!n||!r?!1:n===r}return!1}function Ewe(t,e=new wg){return fwe(e),_we(e,t)}function Swe(t,e){var n=ft.useReducer(function(a){return a+1},0),r=n[1],i=ft.useRef(),s=ft.useRef(!1);i.current||(i.current=new zB(function(){s.current&&r()}));var o=ft.useMemo(function(){var a;return(a=i.current)==null||a.removeObservers(),PE(t,i.current)},[]);return ft.useEffect(function(){return s.current=!0,i.current||r(),function(){var a;s.current=!1,(a=i.current)==null||a.removeObservers(),i.current=null}},[]),o}function Twe(t,e){if(!g_(t))throw new Error("syncedObject passed to useSyncedStore is not a SyncedStore Store or internal data type.");return Swe(t)}const d3=0,GK=1,WK=2,wwe=(t,e)=>{Xr(t,d3);const n=sTe(e);zc(t,n)},qK=(t,e,n)=>{Xr(t,GK),zc(t,tTe(e,n))},xwe=(t,e,n)=>qK(e,n,Tl(t)),KK=(t,e,n)=>{try{QSe(e,Tl(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Cwe=(t,e)=>{Xr(t,WK),zc(t,e)},Rwe=KK,Awe=(t,e,n,r)=>{const i=Jr(t);switch(i){case d3:xwe(t,e,n);break;case GK:KK(t,n,r);break;case WK:Rwe(t,n,r);break;default:throw new Error("Unknown message type")}return i},Sp=Ewe({shared:[]});function Kw(t,e,n){return t.find(r=>r.key===e&&r.type===n)}function Mwe(){return Twe(Sp)}function YK(t,e){const n=Mwe(),r=Kw(n.shared,t,e);return he(r)?r:void 0}function Yw(t){return YK(t,0)}function XK(t){return YK(t,1)}function JK(t,e,n){const r=Kw(Sp.shared,t,e);he(r)||Sp.shared.push({key:t,type:e,value:n})}function Iwe(t,e){JK(t,0,e)}function QK(t,e){const n=new Gh(e);JK(t,1,n)}function rc(t,e){const n=Kw(Sp.shared,t,0);if(he(n)){n.value=e;return}Sp.shared.push({key:t,type:0,value:e})}function Owe(t,e){const n=new Gh(e),r=Kw(Sp.shared,t,1);if(he(r)){r.value=n;return}Sp.shared.push({key:t,type:1,value:n})}function ZK(t,e,n){let r;function i(){const o=Kw(Sp.shared,t,e);he(o)&&(s(),r=S6(o,()=>n(o.value)))}const s=S6(Sp.shared,i);return i(),()=>r==null?void 0:r()}function kwe(t,e){return ZK(t,0,e)}function Nwe(t,e){return ZK(t,1,n=>e(n.toJSON()))}function FC(t){return Uh(t)}let T6=!1;const Wv=ywe(Sp),Td=Xh("modem",["second"],t=>{if(Td.session(t))switch(t.target){case"second":!T6&&t.data%2===0&&Td.emit("modem:join");break;case"join":if(t.sender!==Td.id()){Td.reply(t,"joinack");const e=Jv();wwe(e,Wv),Td.reply(t,"sync",FC(e));const n=Jv();qK(n,Wv),Td.reply(t,"sync",FC(n))}break;case"joinack":t.sender!==Td.id()&&(T6=!0);break;case"sync":{if(t.sender!==Td.id()&&he(t.data))try{const e=Ey(t.data),n=Jv();Awe(e,n,Wv,Td)===d3&&Td.emit("modem:sync",FC(n))}catch(e){ai(Td,"sync",e.message)}break}}});function eY(t){const e=Jv();Cwe(e,t),Td.emit("modem:sync",FC(e))}Wv.on("update",eY);Wv.on("destroy",()=>{Wv==null||Wv.off("update",eY)});function Uo(t){return`${t??""}`}function sT(t,e){const n=parseFloat(Uo(t));return isNaN(n)?e:n}function ac(t,e){return typeof t==typeof e?t:e}const Xw=navigator.userAgent.includes("Mac"),Pwe=Xw?"cmd":"ctrl";var R0=(t=>(t[t.Border=-1]="Border",t[t.Data=0]="Data",t[t.Function=1]="Function",t[t.Position=2]="Position",t[t.Timing=3]="Timing",t[t.Alignment=4]="Alignment",t))(R0||{}),Dwe=Object.defineProperty,Lwe=(t,e,n)=>e in t?Dwe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,L1=(t,e,n)=>(Lwe(t,typeof e!="symbol"?e+"":e,n),n);const Uwe=[0,1],tY=[1,0],nY=[2,3],rY=[3,2],Fwe={L:Uwe,M:tY,Q:nY,H:rY},Bwe=/^[0-9]*$/,jwe=/^[A-Z0-9 $%*+.\/:-]*$/,jP="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",h3=1,f3=40,w6=3,$we=3,U1=40,Hwe=10,iY=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],sY=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class Vwe{constructor(e,n,r,i){if(this.version=e,this.ecc=n,L1(this,"size"),L1(this,"mask"),L1(this,"modules",[]),L1(this,"types",[]),e<h3||e>f3)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,n){return e>=0&&e<this.size&&n>=0&&n<this.size&&this.modules[n][e]}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2===0,R0.Timing),this.setFunctionModule(r,6,r%2===0,R0.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),n=e.length;for(let r=0;r<n;r++)for(let i=0;i<n;i++)r===0&&i===0||r===0&&i===n-1||r===n-1&&i===0||this.drawAlignmentPattern(e[r],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const n=this.ecc[1]<<3|e;let r=n;for(let s=0;s<10;s++)r=r<<1^(r>>>9)*1335;const i=(n<<10|r)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Dm(i,s));this.setFunctionModule(8,7,Dm(i,6)),this.setFunctionModule(8,8,Dm(i,7)),this.setFunctionModule(7,8,Dm(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Dm(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Dm(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Dm(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let r=0;r<12;r++)e=e<<1^(e>>>11)*7973;const n=this.version<<12|e;for(let r=0;r<18;r++){const i=Dm(n,r),s=this.size-11+r%3,o=Math.floor(r/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,n){for(let r=-4;r<=4;r++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(r)),o=e+i,a=n+r;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,R0.Position)}}drawAlignmentPattern(e,n){for(let r=-2;r<=2;r++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,n+r,Math.max(Math.abs(i),Math.abs(r))!==1,R0.Alignment)}setFunctionModule(e,n,r,i=R0.Function){this.modules[n][e]=r,this.types[n][e]=i}addEccAndInterleave(e){const n=this.version,r=this.ecc;if(e.length!==BC(n,r))throw new RangeError("Invalid argument");const i=sY[r[0]][n],s=iY[r[0]][n],o=Math.floor(pU(n)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=Qwe(s);for(let h=0,p=0;h<i;h++){const f=e.slice(p,p+c-s+(h<a?0:1));p+=f.length;const g=Zwe(f,u);h<a&&f.push(0),l.push(f.concat(g))}const d=[];for(let h=0;h<l[0].length;h++)l.forEach((p,f)=>{(h!==c-s||f>=a)&&d.push(p[h])});return d}drawCodewords(e){if(e.length!==Math.floor(pU(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let r=this.size-1;r>=1;r-=2){r===6&&(r=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=r-s,c=(r+1&2)===0?this.size-1-i:i;!this.types[c][o]&&n<e.length*8&&(this.modules[c][o]=Dm(e[n>>>3],7-(n&7)),n++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let n=0;n<this.size;n++)for(let r=0;r<this.size;r++){let i;switch(e){case 0:i=(r+n)%2===0;break;case 1:i=n%2===0;break;case 2:i=r%3===0;break;case 3:i=(r+n)%3===0;break;case 4:i=(Math.floor(r/3)+Math.floor(n/2))%2===0;break;case 5:i=r*n%2+r*n%3===0;break;case 6:i=(r*n%2+r*n%3)%2===0;break;case 7:i=((r+n)%2+r*n%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[n][r]&&i&&(this.modules[n][r]=!this.modules[n][r])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=w6:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*U1),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*U1}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=w6:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*U1),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*U1}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=$we)}let n=0;for(const s of this.modules)n=s.reduce((o,a)=>o+(a?1:0),n);const r=this.size*this.size,i=Math.ceil(Math.abs(n*20-r*10)/r)-1;return e+=i*Hwe,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,n=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,r=[6];for(let i=this.size-7;r.length<e;i-=n)r.splice(1,0,i);return r}}finderPenaltyCountPatterns(e){const n=e[1],r=n>0&&e[2]===n&&e[3]===n*3&&e[4]===n&&e[5]===n;return(r&&e[0]>=n*4&&e[6]>=n?1:0)+(r&&e[6]>=n*4&&e[0]>=n?1:0)}finderPenaltyTerminateAndCount(e,n,r){return e&&(this.finderPenaltyAddHistory(n,r),n=0),n+=this.size,this.finderPenaltyAddHistory(n,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(e,n){n[0]===0&&(e+=this.size),n.pop(),n.unshift(e)}}function qm(t,e,n){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let r=e-1;r>=0;r--)n.push(t>>>r&1)}function Dm(t,e){return(t>>>e&1)!==0}class p3{constructor(e,n,r){if(this.mode=e,this.numChars=n,this.bitData=r,n<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}getData(){return this.bitData.slice()}}const zwe=[1,10,12,14],Gwe=[2,9,11,13],Wwe=[4,8,16,16];function oY(t,e){return t[Math.floor((e+7)/17)+1]}function aY(t){const e=[];for(const n of t)qm(n,8,e);return new p3(Wwe,t.length,e)}function qwe(t){if(!cY(t))throw new RangeError("String contains non-numeric characters");const e=[];for(let n=0;n<t.length;){const r=Math.min(t.length-n,3);qm(Number.parseInt(t.substring(n,n+r),10),r*3+1,e),n+=r}return new p3(zwe,t.length,e)}function Kwe(t){if(!lY(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let n;for(n=0;n+2<=t.length;n+=2){let r=jP.indexOf(t.charAt(n))*45;r+=jP.indexOf(t.charAt(n+1)),qm(r,11,e)}return n<t.length&&qm(jP.indexOf(t.charAt(n)),6,e),new p3(Gwe,t.length,e)}function Ywe(t){return t===""?[]:cY(t)?[qwe(t)]:lY(t)?[Kwe(t)]:[aY(Jwe(t))]}function cY(t){return Bwe.test(t)}function lY(t){return jwe.test(t)}function Xwe(t,e){let n=0;for(const r of t){const i=oY(r.mode,e);if(r.numChars>=1<<i)return Number.POSITIVE_INFINITY;n+=4+i+r.bitData.length}return n}function Jwe(t){t=encodeURI(t);const e=[];for(let n=0;n<t.length;n++)t.charAt(n)!=="%"?e.push(t.charCodeAt(n)):(e.push(Number.parseInt(t.substring(n+1,n+3),16)),n+=2);return e}function pU(t){if(t<h3||t>f3)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const n=Math.floor(t/7)+2;e-=(25*n-10)*n-55,t>=7&&(e-=36)}return e}function BC(t,e){return Math.floor(pU(t)/8)-iY[e[0]][t]*sY[e[0]][t]}function Qwe(t){if(t<1||t>255)throw new RangeError("Degree out of range");const e=[];for(let r=0;r<t-1;r++)e.push(0);e.push(1);let n=1;for(let r=0;r<t;r++){for(let i=0;i<e.length;i++)e[i]=mU(e[i],n),i+1<e.length&&(e[i]^=e[i+1]);n=mU(n,2)}return e}function Zwe(t,e){const n=e.map(r=>0);for(const r of t){const i=r^n.shift();n.push(0),e.forEach((s,o)=>n[o]^=mU(s,i))}return n}function mU(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let n=0;for(let r=7;r>=0;r--)n=n<<1^(n>>>7)*285,n^=(e>>>r&1)*t;return n}function exe(t,e,n=1,r=40,i=-1,s=!0){if(!(h3<=n&&n<=r&&r<=f3)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=n;;o++){const d=BC(o,e)*8,h=Xwe(t,o);if(h<=d){a=h;break}if(o>=r)throw new RangeError("Data too long")}for(const d of[tY,nY,rY])s&&a<=BC(o,d)*8&&(e=d);const c=[];for(const d of t){qm(d.mode[0],4,c),qm(d.numChars,oY(d.mode,o),c);for(const h of d.getData())c.push(h)}const l=BC(o,e)*8;qm(0,Math.min(4,l-c.length),c),qm(0,(8-c.length%8)%8,c);for(let d=236;c.length<l;d^=253)qm(d,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((d,h)=>u[h>>>3]|=d<<7-(h&7)),new Vwe(o,e,u,i)}function txe(t,e){var d;const{ecc:n="L",boostEcc:r=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof t=="string"?Ywe(t):Array.isArray(t)?[aY(t)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof t}`);const l=exe(c,Fwe[n],i,s,o,r),u=nxe({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e!=null&&e.invert&&(u.data=u.data.map(h=>h.map(p=>!p))),(d=e==null?void 0:e.onEncoded)==null||d.call(e,u),u}function nxe(t,e=1){if(!e)return t;const{size:n}=t,r=n+e*2;t.size=r,t.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)t.data.unshift(Array.from({length:r},o=>!1)),t.data.push(Array.from({length:r},o=>!1));const i=R0.Border;t.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)t.types.unshift(Array.from({length:r},o=>i)),t.types.push(Array.from({length:r},o=>i));return t}function rxe(t,e,n,r=!1){return e<0||n<0||e>=t.length||n>=t.length?r:t[n][e]}function ixe(t,e={}){const n={WHITE_ALL:"█",WHITE_BLACK:"▀",BLACK_WHITE:"▄",BLACK_ALL:" "},r=txe(t,e),i=!1,s=!0,o=(l,u)=>rxe(r.data,l,u,!0),a=[];let c="";for(let l=0;l<r.size;l+=2){for(let u=0;u<r.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=n.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=n.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=n.BLACK_WHITE:c+=n.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const v_="$dkpurple",sxe="$196",oxe="$205";function yl(t,e){return`$${t}${e}$blue`}function x6(t,e){return`$${t}${e}$ondkblue`}function Ar(t,e){gp(t,e)}function axe(t,e){const n=sxe.repeat(e);Ar(t,`${v_}${n}`)}function m3(t,e){const n=oxe.repeat(e);Ar(t,`${v_}${n}`)}function sp(t,e){Ar(t,`${v_} ${" ".repeat(e.length)} `),axe(t,e.length+2),Ar(t,`${v_} $white${e} `),m3(t,e.length+2)}function Lm(t,e){Ar(t,`${v_} ${" ".repeat(e.length)} `),Ar(t,`${v_} $gray${e} `),m3(t,e.length+2)}function ti(t,e,n){Ar(t,`${v_} $white${e} $blue${n}`)}function Oi(t,e){Ar(t,`${v_}$blue${e}`)}function qR(t,e,n,r=!0){if(r){const i=ixe(e).split(`
`),s={32:32,9600:223,9604:220,9608:219};for(let o=0;o<i.length;o++){const a=[...i[o]].map(c=>`$${s[c.charCodeAt(0)]}`).join("");Ar(t,a)}}Ar(t,`!copyit ${e};${n}`)}function cxe(t,e,n){Ar(t,`!openit ${e};${n}`)}function pb(t=""){Vde(qe,t,j1e())}const lxe=Sg().command("send",(t,e)=>{const[n,r]=Rt(e,0,[lt.NAME,lt.ANY]);switch(rr(n)){case"helpmenu":sp(qe,"H E L P"),cxe(qe,"https://github.com/goldbuick/zed-software-system/wiki","open help wiki"),Ar(qe,""),ti(qe,"#help controls","zss controls and inputs"),Ar(qe,"!helpcontrols;read help controls"),Ar(qe,""),ti(qe,"#help text","text formatting"),Ar(qe,"!helptext;read help text"),Ar(qe,""),ti(qe,"#help developer","developer commands"),Ar(qe,"!helpdeveloper;read help developer"),Ar(qe,""),ti(qe,"#help player","player settings"),Ar(qe,"!helpplayer;read help player"),Lm(qe,"keyboard input"),ti(qe,"?","open console"),ti(qe,"esc","close console"),ti(qe,"tab","move console"),ti(qe,"up / down arrow keys","navigate console items"),ti(qe,"left / right arrow keys","change console items"),ti(qe,"enter","interact with console items"),ti(qe,"alt + arrow keys","skip words and console lines"),ti(qe,`${Pwe} + up / down arrow keys`,"input history");break;case"helpcontrols":sp(qe,"zss controls and inputs"),Lm(qe,"keyboard input"),ti(qe,"arrow keys","move"),ti(qe,"shift + arrow keys","shoot"),ti(qe,"enter","ok / accept"),ti(qe,"escape","cancel / close"),ti(qe,"tab","menu / action"),Lm(qe,"mouse input"),Oi(qe,"todo ???"),Lm(qe,"controller input"),ti(qe,"left stick","move"),ti(qe,"right stick","aim"),ti(qe,"a","ok / accept"),ti(qe,"b","cancel / close"),ti(qe,"y","menu / action"),ti(qe,"x","shoot"),ti(qe,"triggers","shoot");break;case"helptext":sp(qe,"text formatting"),Lm(qe,"typography"),Oi(qe,"plain text"),Oi(qe,"$centering text"),Oi(qe,'"\\"@quoted strings for special chars\\""'),Oi(qe,"$$0-255 for ascii chars $159$176$240"),Oi(qe,`use color names like ${yl("red","$$red")} to change foreground color`),Oi(qe,`use color names like ${x6("ongreen","$$ongreen")} to change background color`),Oi(qe,`use clear ${x6("onclear","to change background to")} transparent`),Lm(qe,"hyperlinks"),Oi(qe,`${yl("white",'"!hotkey"')} message shortcut;${yl("gray","Label")}`),Oi(qe,`${yl("white",'"!range"')} flag [labelmin] [labelmax];${yl("gray","Input Label")}`),Oi(qe,`${yl("white",'"!select"')} flag ...list of values;${yl("gray","Input Label")}`),Oi(qe,`${yl("white",'"!number"')} flag [minvalue] [maxvalue];${yl("gray","Input Label")}`),Oi(qe,`${yl("white",'"!text"')} flag;${yl("gray","Input Label")}`),Oi(qe,`${yl("white",'"!copyit"')} flag;${yl("gray","Input Label")}`),Oi(qe,`${yl("white",'"!openit"')} flag;${yl("gray","Input Label")}`);break;case"helpdeveloper":sp(qe,"developer commands"),ti(qe,"#books","list books in memory"),ti(qe,"#pages","list pages in opened book"),ti(qe,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ti(qe,"#trash","list books and pages from open book you can delete"),ti(qe,"#save","flush state to register");break;case"helpplayer":sp(qe,"player settings"),Oi(qe,"todo");break;default:{MY(n,r);break}}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(Uo),s=i.join(" ");switch(rr(r)){case $u(Tn.LOADER):n=Iv(xa.CONTENT,s,Dr.LOADER);break;default:n=Iv(xa.CONTENT,[r,...i].join(" "),Dr.OBJECT);break;case $u(Tn.BOARD):n=Iv(xa.CONTENT,s,Dr.BOARD);break;case $u(Tn.OBJECT):n=Iv(xa.CONTENT,s,Dr.OBJECT);break;case $u(Tn.TERRAIN):n=Iv(xa.CONTENT,s,Dr.TERRAIN);break;case $u(Tn.CHARSET):n=Iv(xa.CONTENT,s,Dr.CHARSET);break;case $u(Tn.PALETTE):n=Iv(xa.CONTENT,s,Dr.PALETTE);break}return he(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(Uo).join(" ");return gp(qe,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Uo(n),s=r.map(Uo).join(" ");return gp(qe,`!${s};${i}`),0}).command("bookcreate",(t,e)=>{const[n]=Rt(e,0,[lt.MAYBE_NAME]),r=RY(n);return he(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]),r=jE(n);return he(r)?(Oi(qe,`opened [book] ${r.name}`),EU(xa.MAIN,r.id),t.command("pages")):ai(qe,"bookopen",`book ${n} not found`,be.elementfocus),0}).command("booktrash",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]),r=zb(xa.MAIN),i=jE(n);return he(i)&&(r===i&&EU(xa.MAIN,""),z1e(n),Oi(qe,`trashed [book] ${i.name}`),pb(),t.command("pages")),0}).command("pageopen",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]),r=Qv(xa.MAIN);if(!he(r))return 0;const i=jw(r,n);if(he(i)){const s=Ah(i),o=M1(i);Oi(qe,`opened [${o}] ${s}`),QK(GW(r.id,[i.id]),i.code);const a=M1(i);Mde(qe,r.id,[i.id],a,`${s} - ${r.name}`,be.elementfocus)}else ai(qe,"pageopen",`page ${n} not found`,be.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]),r=Qv(xa.MAIN),i=cEe(r,n);if(he(n)){const s=Ah(i),o=M1(i);Oi(qe,`trashed [${o}] ${s}`),pb(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(Uo).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{Lm(qe,"books");const t=zb(xa.MAIN);ti(qe,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=zb(xa.CONTENT);ti(qe,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),m3(qe,7);const n=bU();return n.length?n.forEach(r=>{Ar(qe,`!bookopen ${r.id};${r.name}`)}):Oi(qe,"no books found"),Ar(qe,"!bookcreate;create a new book"),0}).command("pages",()=>{Lm(qe,"pages");const t=Qv(xa.MAIN);return he(t)&&(ti(qe,"main",`${t.name} $GREEN${t.id}`),t.pages.length?[...t.pages].sort((n,r)=>{const i=kE(n),s=kE(r);return i===s?Ah(n).localeCompare(Ah(r)):s-i}).forEach(n=>{const r=Ah(n),i=M1(n);Ar(qe,`!pageopen ${n.id};[${i}] ${r}`)}):(Ar(qe,""),Oi(qe,"no pages found"),Oi(qe,"use @ to create a page"),Oi(qe,"@board name of board"),Oi(qe,"@object name of object"),Oi(qe,"@terrain name of terrain"),Oi(qe,"You can omit the type and it will default to object"),Oi(qe,"@object name of object"),Oi(qe,"@name of object"))),0}).command("trash",()=>{Lm(qe,"$REDTRASH"),Oi(qe,"books");const t=bU();t.length&&(t.forEach(n=>{Ar(qe,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Ar(qe,""));const e=zb(xa.MAIN);return he(e)&&(Oi(qe,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=Ah(n);Ar(qe,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Ar(qe,"")),0}).command("dev",()=>(pb(),gde(qe,be.elementfocus),0)).command("share",()=>(pb(),vde(qe,be.elementfocus),0)).command("save",()=>(pb(),0)).command("savewith",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]);return pb(n),0}).command("nuke",()=>(_de(qe,be.elementfocus),0)).command("restart",()=>($de(qe,be.elementfocus),0)).command("gadget",()=>(wde(qe,void 0,be.elementfocus),0)).command("joincode",(t,e)=>{const[n]=Rt(e,0,[lt.MAYBE_NAME]);return pde(qe,!!n,be.elementfocus),0}).command("twitchbroadcast",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]);switch(rr(n)){default:ode(qe,n,be.elementfocus);break;case"stop":ade(qe,be.elementfocus);break}return 0}),uxe=Sg().command("palette",(t,e)=>{const[n,r]=Rt(e,0,[lt.NAME]),i=j6(),s=b3(rr(n));if(he(s)){const o=OY([s]);if(!he(o))return 0;const[a,c,l]=Rt(e,r,[lt.NUMBER,lt.NUMBER,lt.NUMBER]),u=Iv(xa.MAIN,nr(i.palette)?i.palette:xa.MAIN,Dr.PALETTE),d=Z0(u);if(he(d)&&o>=0&&o<=16){const h=o*IE;d.bits[h+0]=Ci(a,0,63),d.bits[h+1]=Ci(c,0,63),d.bits[h+2]=Ci(l,0,63)}he(u)&&(i.palette=u.id)}else{const o=jT(be.book,Dr.PALETTE,n);he(o)?(i.palette=o.id,Ar(qe,`loaded palette ${n}`)):ai(qe,"not-found",`unabled to find palette ${n}`)}return 0}).command("charset",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]),r=j6(),i=jT(be.book,Dr.CHARSET,n);return he(i)?(r.charset=i.id,Ar(qe,`loaded charset ${n}`)):ai(qe,"not-found",`unabled to find charset ${n}`),0}),dxe=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),C6=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),hxe=["NORTH","SOUTH","WEST","EAST"];function fxe(t){const e=JT(t);if(Mn(e.inputcurrent)||(e.inputcurrent=0),qr(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Kt.NONE,i=0]=n??[Kt.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&b9?1:0,e.inputctrl=i&E9?1:0,e.inputshift=i&S9?1:0,r){case Kt.MOVE_UP:case Kt.MOVE_DOWN:case Kt.MOVE_LEFT:case Kt.MOVE_RIGHT:e.inputmove=[hxe[r-Kt.MOVE_UP]];break;case Kt.OK_BUTTON:e.inputok=1;break;case Kt.CANCEL_BUTTON:e.inputcancel=1;break;case Kt.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Kt.NONE&&o!==r}),e}function pxe(t){const e=K9[t];if(he(e))return e;const n=J9[t];if(he(n))return n;const r=GM[t];if(he(r))return r;const i=x9[t];if(he(i))return i}const mxe=Sg({get(t,e){var o,a,c,l,u,d,h,p,f,g,y,E,w,R,A,k,I;const n=pxe(e);if(he(n))return[!0,n];if(be.elementisplayer&&dxe.has(e)){const N=fxe(be.elementid)[e];return[he(N),N]}const r=UR(be.board,be.element,be.elementfocus),i=(r==null?void 0:r.id)??be.elementfocus;switch(e){case"isdark":return[!0,(o=be.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=be.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=be.board)==null?void 0:c.starty)??0];case"over":return[!0,((l=be.board)==null?void 0:l.over)??""];case"under":return[!0,((u=be.board)==null?void 0:u.under)??""];case"exitnorth":return[!0,((d=be.board)==null?void 0:d.exitnorth)??""];case"exitsouth":return[!0,((h=be.board)==null?void 0:h.exitsouth)??""];case"exitwest":return[!0,((p=be.board)==null?void 0:p.exitwest)??""];case"exiteast":return[!0,((f=be.board)==null?void 0:f.exiteast)??""];case"timelimit":return[!0,((g=be.board)==null?void 0:g.timelimit)??0];case"restartonzap":return[!0,((y=be.board)==null?void 0:y.restartonzap)??0];case"maxplayershots":return[!0,((E=be.board)==null?void 0:E.maxplayershots)??0];case"boardid":return[!0,((w=be.board)==null?void 0:w.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((R=be.element)==null?void 0:R.id)??""];case"thisx":return[!0,((A=be.element)==null?void 0:A.x)??-1];case"thisy":return[!0,((k=be.element)==null?void 0:k.y)??-1];default:{const N=(I=be.element)==null?void 0:I[e];if(he(N)||C6.has(e))return[!0,N];break}}const s=JT(i)[e];return[he(s),s]},set(t,e,n){var o;const r=UR(be.board,be.element,be.elementfocus),i=(r==null?void 0:r.id)??be.elementfocus;switch(e){case"isdark":he(be.board)&&(be.board.isdark=n?1:0);break;case"startx":he(be.board)&&(be.board.startx=sT(n,0));break;case"starty":he(be.board)&&(be.board.starty=sT(n,0));break;case"over":he(be.board)&&(be.board.over=Uo(n));break;case"under":he(be.board)&&(be.board.under=Uo(n));break;case"exitnorth":he(be.board)&&(be.board.exitnorth=Uo(n));break;case"exitsouth":he(be.board)&&(be.board.exitsouth=Uo(n));break;case"exitwest":he(be.board)&&(be.board.exitwest=Uo(n));break;case"exiteast":he(be.board)&&(be.board.exiteast=Uo(n));break;case"timelimit":he(be.board)&&(be.board.timelimit=sT(n,0));break;case"restartonzap":he(be.board)&&(be.board.restartonzap=n?1:0);break;case"maxplayershots":he(be.board)&&(be.board.maxplayershots=sT(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{const a=(o=be.element)==null?void 0:o[e];if(he(a)||C6.has(e))return he(be.element)&&(be.element[e]=n),[!0,n];break}}const s=JT(i);return he(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n;if(he((t=be.element)==null?void 0:t.stepx)&&he(be.element.stepy)){const r={x:((e=be.element)==null?void 0:e.x)??0,y:((n=be.element)==null?void 0:n.y)??0};SU(be.book,be.board,be.element,{x:r.x+be.element.stepx,y:r.y+be.element.stepy})===!1&&(be.element.stepx=0,be.element.stepy=0,P7(be.book,be.element,"destructible")&&NE(be.book,be.board,be.element,be.timestamp))}}}).command("clear",(t,e)=>(e.forEach(n=>t.set(Uo(n),0)),0)).command("set",(t,e)=>{const[n,r]=Rt(e,0,[lt.NAME,lt.ANY]);return t.set(n,r),0}).command("become",(t,e)=>{var r,i;const[n]=Rt(e,0,[lt.KIND]);if(Hv(be.book,be.board),F7(be.book,be.board,be.element),NE(be.book,be.board,be.element,be.timestamp)){const s={x:((r=be.element)==null?void 0:r.x)??0,y:((i=be.element)==null?void 0:i.y)??0};BR(be.book,be.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=Rt(e,0,[lt.NUMBER]);return he(be.element)&&(be.element.char=n),0}).command("color",(t,e)=>{const[n]=Rt(e,0,[lt.COLOR]);return he(be.element)&&he(n)&&FR(be.element,n),0}).command("go",(t,e)=>{if(he(be.element)){const[n]=Rt(e,0,[lt.DIR]);if(SU(be.book,be.board,be.element,n),t.yield(),be.element.x===n.x&&be.element.y===n.y)return 0}return 1}).command("walk",(t,e)=>{if(!he(be.element))return 0;const[n]=Rt(e,0,[lt.DIR]),r=be.element.x??0,i=be.element.y??0;return be.element.stepx=n.x-r,be.element.stepy=n.y-i,0}),gxe=Sg().command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=Rt(e,0,[lt.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Uo(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Uo(e[0])),0)).command("cycle",(t,e)=>{if(he(be.element)){const[n]=Rt(e,0,[lt.NUMBER]);be.element.cycle=Ci(Math.round(n),1,255)}return 0}).command("die",t=>(NE(be.book,be.board,be.element,be.timestamp),t.endofprogram(),0)).command("endgame",()=>(be.elementisplayer&&Dde(qe,be.elementid),0)).command("run",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]);return XR(n),0}).command("runwith",(t,e)=>{const[n,r]=Rt(e,0,[lt.ANY,lt.NAME]);return t.set("arg",n),XR(r),0}),uY={};function vxe(t){var e;return(e=uY[t])==null?void 0:e.format}function cE(t){var e;return(e=uY[t])==null?void 0:e.content}function R6(t,e){if(!he(t))return;const n=rr(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const _xe=(t,e)=>{const n=cE(t.id());if(!he(n))return 0;const[r,i]=Rt(e,0,[lt.NAME]),s=rr(r);switch(s){case"seek":{const[o]=Rt(e,i,[lt.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=Rt(e,i,[lt.NAME]);t.set(o,R6(n,s));break}case"text":{const[o,a]=Rt(e,i,[lt.NAME,lt.NAME]),c=R6(n,o);if(Mn(c)&&nr(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),d=new TextDecoder("utf-8").decode(l);t.set(a,d),n.cursor+=c}break}case"palette":{const[o]=Rt(e,i,[lt.NAME]),a=J2(be.book,Dr.PALETTE,o),c=Z0(a);if(he(c)){const l=y9*IE,u=Fw(new Uint8Array(n.bytes.buffer,n.cursor,l));he(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=Rt(e,i,[lt.NAME]),a=J2(be.book,Dr.CHARSET,o),c=Z0(a);if(he(c)){const l=kd*k2*O2,u=Bw(new Uint8Array(n.bytes.buffer,n.cursor,l));he(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},BE=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",KR=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!KR(t[n],e[n]))return!1;return!0}if(BE(t)&&BE(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!KR(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},F1=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(BE(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},yxe=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",A6=t=>t>="0"&&t<="9"||t==="-",bxe=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var ct;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(ct||(ct={}));const M6={"(":ct.TOK_LPAREN,")":ct.TOK_RPAREN,"*":ct.TOK_STAR,",":ct.TOK_COMMA,".":ct.TOK_DOT,":":ct.TOK_COLON,"@":ct.TOK_CURRENT,$:ct.TOK_ROOT,"]":ct.TOK_RBRACKET,"{":ct.TOK_LBRACE,"}":ct.TOK_RBRACE},Exe={"!":!0,"<":!0,"=":!0,">":!0},Sxe={"	":!0,"\n":!0,"\r":!0," ":!0};class Txe{constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(yxe(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:ct.TOK_UNQUOTEDIDENTIFIER,value:i});else if(M6[e[this._current]]!==void 0)n.push({start:this._current,type:M6[e[this._current]],value:e[this._current]}),this._current+=1;else if(A6(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:ct.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:ct.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:ct.TOK_LITERAL,value:o})}else if(Exe[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(Sxe[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:ct.TOK_AND,value:"&&"})):n.push({start:r,type:ct.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:ct.TOK_OR,value:"||"})):n.push({start:r,type:ct.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&bxe(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;A6(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:ct.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:ct.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:ct.TOK_FLATTEN,value:"[]"}):{start:n,type:ct.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:ct.TOK_NE,value:"!="}):{start:n,type:ct.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:ct.TOK_LTE,value:"<="}):{start:n,type:ct.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:ct.TOK_GTE,value:">="}):{start:n,type:ct.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:ct.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const wxe=new Txe,$c={[ct.TOK_EOF]:0,[ct.TOK_UNQUOTEDIDENTIFIER]:0,[ct.TOK_QUOTEDIDENTIFIER]:0,[ct.TOK_RBRACKET]:0,[ct.TOK_RPAREN]:0,[ct.TOK_COMMA]:0,[ct.TOK_RBRACE]:0,[ct.TOK_NUMBER]:0,[ct.TOK_CURRENT]:0,[ct.TOK_EXPREF]:0,[ct.TOK_ROOT]:0,[ct.TOK_PIPE]:1,[ct.TOK_OR]:2,[ct.TOK_AND]:3,[ct.TOK_EQ]:5,[ct.TOK_GT]:5,[ct.TOK_LT]:5,[ct.TOK_GTE]:5,[ct.TOK_LTE]:5,[ct.TOK_NE]:5,[ct.TOK_FLATTEN]:9,[ct.TOK_STAR]:20,[ct.TOK_FILTER]:21,[ct.TOK_DOT]:40,[ct.TOK_NOT]:45,[ct.TOK_LBRACE]:50,[ct.TOK_LBRACKET]:55,[ct.TOK_LPAREN]:60};class xxe{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==ct.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...wxe.tokenize(e),{type:ct.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<$c[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case ct.TOK_LITERAL:return{type:"Literal",value:e.value};case ct.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case ct.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===ct.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case ct.TOK_NOT:return r=this.expression($c.Not),{type:"NotExpression",children:[r]};case ct.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===ct.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS($c.Star),{type:"ValueProjection",children:[n,r]};case ct.TOK_FILTER:return this.led(e.type,{type:"Identity"});case ct.TOK_LBRACE:return this.parseMultiselectHash();case ct.TOK_FLATTEN:return n={type:ct.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS($c.Flatten),{type:"Projection",children:[n,r]};case ct.TOK_LBRACKET:return this.lookahead(0)===ct.TOK_NUMBER||this.lookahead(0)===ct.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===ct.TOK_STAR&&this.lookahead(1)===ct.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS($c.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case ct.TOK_CURRENT:return{type:ct.TOK_CURRENT};case ct.TOK_ROOT:return{type:ct.TOK_ROOT};case ct.TOK_EXPREF:return i=this.expression($c.Expref),{type:"ExpressionReference",children:[i]};case ct.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==ct.TOK_RPAREN;)this.lookahead(0)===ct.TOK_CURRENT?(i={type:ct.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(ct.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case ct.TOK_DOT:const i=$c.Dot;return this.lookahead(0)!==ct.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case ct.TOK_PIPE:return r=this.expression($c.Pipe),{type:ct.TOK_PIPE,children:[n,r]};case ct.TOK_OR:return r=this.expression($c.Or),{type:"OrExpression",children:[n,r]};case ct.TOK_AND:return r=this.expression($c.And),{type:"AndExpression",children:[n,r]};case ct.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==ct.TOK_RPAREN;)this.lookahead(0)===ct.TOK_CURRENT?(a={type:ct.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===ct.TOK_COMMA&&this.match(ct.TOK_COMMA),o.push(a);return this.match(ct.TOK_RPAREN),{name:s,type:"Function",children:o};case ct.TOK_FILTER:const l=this.expression(0);return this.match(ct.TOK_RBRACKET),r=this.lookahead(0)===ct.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS($c.Filter),{type:"FilterProjection",children:[n,r,l]};case ct.TOK_FLATTEN:const u={type:ct.TOK_FLATTEN,children:[n]},d=this.parseProjectionRHS($c.Flatten);return{type:"Projection",children:[u,d]};case ct.TOK_EQ:case ct.TOK_NE:case ct.TOK_GT:case ct.TOK_GTE:case ct.TOK_LT:case ct.TOK_LTE:return this.parseComparator(n,e);case ct.TOK_LBRACKET:const h=this.lookaheadToken(0);return h.type===ct.TOK_NUMBER||h.type===ct.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(ct.TOK_STAR),this.match(ct.TOK_RBRACKET),r=this.parseProjectionRHS($c.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===ct.TOK_COLON||this.lookahead(1)===ct.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(ct.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS($c.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==ct.TOK_RBRACKET&&n<3;){if(r===ct.TOK_COLON)n+=1,this.advance();else if(r===ct.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(ct.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression($c[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([ct.TOK_UNQUOTEDIDENTIFIER,ct.TOK_QUOTEDIDENTIFIER,ct.TOK_STAR].includes(n))return this.expression(e);if(n===ct.TOK_LBRACKET)return this.match(ct.TOK_LBRACKET),this.parseMultiselectList();if(n===ct.TOK_LBRACE)return this.match(ct.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if($c[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===ct.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===ct.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===ct.TOK_DOT)return this.match(ct.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==ct.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===ct.TOK_COMMA&&(this.match(ct.TOK_COMMA),this.lookahead(0)===ct.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(ct.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[ct.TOK_UNQUOTEDIDENTIFIER,ct.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(ct.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===ct.TOK_COMMA)this.match(ct.TOK_COMMA);else if(this.lookahead(0)===ct.TOK_RBRACE){this.match(ct.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const Cxe=new xxe;var Ft;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(Ft||(Ft={}));class Rxe{constructor(e){this.TYPE_NAME_TABLE={[Ft.TYPE_NUMBER]:"number",[Ft.TYPE_ANY]:"any",[Ft.TYPE_STRING]:"string",[Ft.TYPE_ARRAY]:"array",[Ft.TYPE_OBJECT]:"object",[Ft.TYPE_BOOLEAN]:"boolean",[Ft.TYPE_EXPREF]:"expression",[Ft.TYPE_NULL]:"null",[Ft.TYPE_ARRAY_NUMBER]:"Array<number>",[Ft.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>BE(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===Ft.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[Ft.TYPE_NUMBER,Ft.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===Ft.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[Ft.TYPE_NUMBER,Ft.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==Ft.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===Ft.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![Ft.TYPE_NUMBER,Ft.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),d=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(d)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(d)]}`);return u>d?1:u<d?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===Ft.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===Ft.TYPE_NUMBER?n:r===Ft.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===Ft.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case Ft.TYPE_NUMBER:return"number";case Ft.TYPE_STRING:return"string";case Ft.TYPE_ARRAY:return"array";case Ft.TYPE_OBJECT:return"object";case Ft.TYPE_BOOLEAN:return"boolean";case Ft.TYPE_EXPREF:return"expref";case Ft.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[Ft.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[Ft.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[Ft.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[Ft.TYPE_STRING,Ft.TYPE_ARRAY]},{types:[Ft.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[Ft.TYPE_STRING]},{types:[Ft.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[Ft.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[Ft.TYPE_STRING]},{types:[Ft.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[Ft.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[Ft.TYPE_STRING,Ft.TYPE_ARRAY,Ft.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[Ft.TYPE_EXPREF]},{types:[Ft.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[Ft.TYPE_ARRAY_NUMBER,Ft.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[Ft.TYPE_ARRAY]},{types:[Ft.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[Ft.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[Ft.TYPE_ARRAY_NUMBER,Ft.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[Ft.TYPE_ARRAY]},{types:[Ft.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[Ft.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[Ft.TYPE_STRING,Ft.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[Ft.TYPE_ARRAY_STRING,Ft.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[Ft.TYPE_ARRAY]},{types:[Ft.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[Ft.TYPE_STRING]},{types:[Ft.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[Ft.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[Ft.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[Ft.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[Ft.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[Ft.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[Ft.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(g=>{var y;return(y=!g.optional)!==null&&y!==void 0?y:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,d=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${d}${a} argument${o&&"s"||""} but received ${n.length}`);let h,p,f;for(let g=0;g<r.length;g+=1){f=!1,h=r[g].types,p=this.getTypeName(n[g]);let y;for(y=0;y<h.length;y+=1)if(p!==void 0&&this.typeMatches(p,h[y],n[g])){f=!0;break}if(!f&&p!==void 0){const E=h.map(w=>this.TYPE_NAME_TABLE[w]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${g+1} to be type (${E}) but received type ${this.TYPE_NAME_TABLE[p]} instead.`)}}}typeMatches(e,n,r){if(n===Ft.TYPE_ANY)return!0;if(n===Ft.TYPE_ARRAY_STRING||n===Ft.TYPE_ARRAY_NUMBER||n===Ft.TYPE_ARRAY){if(n===Ft.TYPE_ARRAY)return e===Ft.TYPE_ARRAY;if(e===Ft.TYPE_ARRAY){let i;n===Ft.TYPE_ARRAY_NUMBER?i=Ft.TYPE_NUMBER:n===Ft.TYPE_ARRAY_STRING&&(i=Ft.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return Ft.TYPE_STRING;case"[object Number]":return Ft.TYPE_NUMBER;case"[object Array]":return Ft.TYPE_ARRAY;case"[object Boolean]":return Ft.TYPE_BOOLEAN;case"[object Null]":return Ft.TYPE_NULL;case"[object Object]":return e.jmespathType===ct.TOK_EXPREF?Ft.TYPE_EXPREF:Ft.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class Axe{constructor(){this._rootValue=null,this.runtime=new Rxe(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,d,h,p;switch(e.type){case"Field":return n===null?null:BE(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),h=1;h<e.children.length;h+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let f=e.value;return f<0&&(f=n.length+f),s=n[f],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const g=[...e.children],y=this.computeSliceParams(n.length,g),[E,w,R]=y;if(s=[],R>0)for(h=E;h<w;h+=R)s.push(n[h]);else for(h=E;h>w;h+=R)s.push(n[h]);return s;case"Projection":if(p=this.visit(e.children[0],n),!Array.isArray(p))return null;for(d=[],h=0;h<p.length;h+=1)i=this.visit(e.children[1],p[h]),i!==null&&d.push(i);return d;case"ValueProjection":if(p=this.visit(e.children[0],n),!BE(p))return null;d=[];const A=Object.values(p);for(h=0;h<A.length;h+=1)i=this.visit(e.children[1],A[h]),i!==null&&d.push(i);return d;case"FilterProjection":if(p=this.visit(e.children[0],n),!Array.isArray(p))return null;const k=[],I=[];for(h=0;h<p.length;h+=1)r=this.visit(e.children[2],p[h]),F1(r)||k.push(p[h]);for(let K=0;K<k.length;K+=1)i=this.visit(e.children[1],k[K]),i!==null&&I.push(i);return I;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case ct.TOK_EQ:s=KR(o,a);break;case ct.TOK_NE:s=!KR(o,a);break;case ct.TOK_GT:s=o>a;break;case ct.TOK_GTE:s=o>=a;break;case ct.TOK_LT:s=o<a;break;case ct.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case ct.TOK_FLATTEN:const N=this.visit(e.children[0],n);if(!Array.isArray(N))return null;let U=[];for(h=0;h<N.length;h+=1)i=N[h],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(d=[],h=0;h<e.children.length;h+=1)d.push(this.visit(e.children[h],n));return d;case"MultiSelectHash":if(n===null)return null;d={};let F;for(h=0;h<e.children.length;h+=1)F=e.children[h],d[F.name]=this.visit(F.value,n);return d;case"OrExpression":return r=this.visit(e.children[0],n),F1(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),F1(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),F1(o);case"Literal":return e.value;case ct.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case ct.TOK_CURRENT:return n;case ct.TOK_ROOT:return this._rootValue;case"Function":const $=[];for(let K=0;K<e.children.length;K+=1)$.push(this.visit(e.children[K],n));return this.runtime.callFunction(e.name,$);case"ExpressionReference":const q=e.children[0];return q.jmespathType=ct.TOK_EXPREF,q;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const Mxe=new Axe;Ft.TYPE_ANY;Ft.TYPE_ARRAY;Ft.TYPE_ARRAY_NUMBER;Ft.TYPE_ARRAY_STRING;Ft.TYPE_BOOLEAN;Ft.TYPE_EXPREF;Ft.TYPE_NULL;Ft.TYPE_NUMBER;Ft.TYPE_OBJECT;Ft.TYPE_STRING;function Ixe(t,e){const n=Cxe.parse(e);return Mxe.search(n,t)}const Oxe=(t,e)=>{const n=cE(t.id());if(!he(n))return 0;const[r,i]=Rt(e,0,[lt.NAME,lt.NAME]),s=Ixe(n.json,r);return t.set(i,s),0},kxe=(t,e)=>{const n=cE(t.id());if(!he(n))return 0;const[r,i]=Rt(e,0,[lt.NAME]);switch(rr(r)){case"seek":{const[o]=Rt(e,i,[lt.NUMBER]);n.cursor=Ci(o,0,n.lines.length-1);break}case"line":n.cursor=Ci(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[d,h]=Rt(e,u,[lt.NAME]);t.set(d,c[l]??0),++l,u=h}break}}return 0},Nxe=Sg({get(t,e){const n=vxe(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const r=cE(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=cE(t.id());switch(e){case"filename":return[!0,r.filename]}break}case"binary":{const r=cE(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=Rt(e,0,[lt.NAME,lt.ANY]);return MY(n,r),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(Uo).join(" ");return gp(qe,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Uo(n),s=r.map(Uo).join(" ");return gp(qe,"$175",`!${s};${i}`),0}).command("txt",kxe).command("json",Oxe).command("bin",_xe).command("with",(t,e)=>{const[n]=Rt(e,0,[lt.NAME]),r=N0(be.book,Dr.BOARD,n);if(r.length){const i=Wu(...r);he(i)&&(be.board=Z0(i),be.element={x:$v(0,ns-1),y:$v(0,kl-1)})}return 0});function I6(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=Rt(i,a,[lt.ANY]);qr(c)&&!Lh(c)&&!lp(c)&&!Jm(c)&&!su(c)?o.push(...c):o.push(c),a=l}switch(rr(r)){case"get":case"post:json":hde(qe,t,e,n,r,o,be.elementfocus);break}return 0}const Pxe=Sg().command("tts",(t,e)=>{const[n,r]=Rt(e,0,[lt.STRING,lt.MAYBE_STRING]);return bde(qe,r??"",n),0}).command("fetch",(t,e)=>{const[n,r,i="get",s]=Rt(e,0,[lt.NAME,lt.NAME,lt.MAYBE_STRING]);return I6(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=Rt(e,0,[lt.ANY,lt.NAME,lt.NAME,lt.MAYBE_STRING]);return I6(n,r,i,s,e,o),0}).command("twitchchat",(t,e)=>{const[n]=Rt(e,0,[lt.ANY]);switch(rr(n)){default:cde(qe,n,be.elementfocus);break;case"close":lde(qe,be.elementfocus);break}return 0}),jC={},kb={};function Dxe(){return{id:Po(),layers:[],scroll:[],sidebar:[]}}const Lxe=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),Uxe=new Set(["tx","text"]),Fxe={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},O6={};let Bxe=t=>{let e=O6[t];return he(e)||(O6[t]=e=Dxe()),e};function $P(t){return Bxe(t)}function g3(t){return he(jC[t])||(jC[t]=[]),jC[t]}function jxe(t,e,n){Object.values(kb).forEach(r=>{if(r[e]!==void 0){const i=A_(t.id(),e);Mn(n)&&rc(i,n),nr(n)&&Owe(i,n)}})}function $xe(t){const e=g3(t);return jC[t]=[],e}function Hxe(t,e){g3(t).push(e)}function Vxe(t,e,n,r,i=()=>0,s=xl){const o=[e,n,...r],a=rr(`${o[3]}`),c={...be};function l(u,d){he(d)&&d!==i(u)&&(be.board=c.board,be.element=c.element,be.elementfocus=c.elementfocus,s(u,d))}if(Lxe.has(a)){const u=`${o[2]}`;kb[e]=kb[e]??{};const d=i(u)??Fxe[a];if(kb[e][u]===void 0){const h=A_(e,u);Mn(d)&&Iwe(h,d),nr(d)&&QK(h,d),Uxe.has(a)?kb[e][u]=Nwe(h,p=>{l(u,p)}):kb[e][u]=kwe(h,p=>{l(u,p)})}}g3(t).push(o)}const zxe=Sg({set(t,e,n){return jxe(t,e,n),[!1,void 0]},everytick(){const t=$xe(be.elementid),[e]=t;if(t.length===1&&nr(e)){if(he(be.element))if(e.trim().length===0){const n=$P(be.elementid);n.sidebar=[]}else be.element.tickertext=e,be.element.tickertime=be.timestamp}else if(t.length>1)if(be.elementisplayer){const n=$P(be.elementid);n.sidebar=t}else{const n=$P(be.elementfocus);n.scroll=t}}}).command("send",(t,e)=>{var u,d;const[n,r]=Rt(e,0,[lt.NAME,lt.ANY]),[i,s]=n.split(":"),o=he(s)?i:"self",a=s??i;function c(h){for(let p=0;p<h.length;++p){const f=h[p];he(f.id)&&t.send(f.id,a,r)}}switch(rr(o)){case"all":for(const h of Object.keys(((u=be.board)==null?void 0:u.objects)??{}))t.send(h,a,r);break;case"self":t.message({session:qe.session(),id:Po(),sender:t.id(),target:a,data:r});break;case"others":for(const h of Object.keys(((d=be.board)==null?void 0:d.objects)??{}))h!==t.id()&&t.send(h,a,r);break;default:{c(k9(be.board,[o]));break}}return 0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(Uo).join("");return Hxe(be.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=Uo(n);return Vxe(be.elementid,t.id(),i,r,t.get,t.set),0});var v3=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(v3||{});const Gxe={audio:qbe,board:_Ee,cli:lxe,display:uxe,element:mxe,runtime:zxe,lifecycle:gxe,loader:Nxe,network:Pxe},HP=["audio","board","display","network","lifecycle","element"],Wxe={0:[],1:["cli",...HP],2:["loader",...HP],3:["runtime",...HP]},qxe={0:new Map,1:new Map,2:new Map,3:new Map};function Jw(t){return(Wxe[t]??[]).map(n=>Gxe[n]).filter(he)}function Kxe(t,e){const n=qxe[t];if(!n.has(e)){let r;const i=Jw(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!he(r));++s);n.set(e,r)}return n.get(e)}function Yxe(t,e,n){const r=Jw(t);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(e,n);if(s)return[s,o]}return[!1,void 0]}function Xxe(t,e,n,r){const i=Jw(t);for(let s=0;s<i.length;++s){const[o]=i[s].set(e,n,r);if(o)return[o,r]}return[!1,void 0]}function Jxe(t,e){const n=Jw(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function k6(t,e){const n=Jw(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var dY={},hY={},fY={};const N6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");fY.encode=function(t){if(0<=t&&t<N6.length)return N6[t];throw new TypeError("Must be between 0 and 63: "+t)};const Qxe=fY,pY=5,mY=1<<pY,Zxe=mY-1,e1e=mY;function t1e(t){return t<0?(-t<<1)+1:(t<<1)+0}hY.encode=function(e){let n="",r,i=t1e(e);do r=i&Zxe,i>>>=pY,i>0&&(r|=e1e),n+=Qxe.encode(r);while(i>0);return n};var Qw={};(function(t){function e(I,N,U){if(N in I)return I[N];if(arguments.length===3)return U;throw new Error('"'+N+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(I){const N=I.match(n);return N?{scheme:N[1],auth:N[2],host:N[3],port:N[4],path:N[5]}:null}t.urlParse=i;function s(I){let N="";return I.scheme&&(N+=I.scheme+":"),N+="//",I.auth&&(N+=I.auth+"@"),I.host&&(N+=I.host),I.port&&(N+=":"+I.port),I.path&&(N+=I.path),N}t.urlGenerate=s;const o=32;function a(I){const N=[];return function(U){for(let $=0;$<N.length;$++)if(N[$].input===U){const q=N[0];return N[0]=N[$],N[$]=q,N[0].result}const F=I(U);return N.unshift({input:U,result:F}),N.length>o&&N.pop(),F}}const c=a(function(N){let U=N;const F=i(N);if(F){if(!F.path)return N;U=F.path}const $=t.isAbsolute(U),q=[];let K=0,W=0;for(;;)if(K=W,W=U.indexOf("/",K),W===-1){q.push(U.slice(K));break}else for(q.push(U.slice(K,W));W<U.length&&U[W]==="/";)W++;let X=0;for(W=q.length-1;W>=0;W--){const ne=q[W];ne==="."?q.splice(W,1):ne===".."?X++:X>0&&(ne===""?(q.splice(W+1,X),X=0):(q.splice(W,2),X--))}return U=q.join("/"),U===""&&(U=$?"/":"."),F?(F.path=U,s(F)):U});t.normalize=c;function l(I,N){I===""&&(I="."),N===""&&(N=".");const U=i(N),F=i(I);if(F&&(I=F.path||"/"),U&&!U.scheme)return F&&(U.scheme=F.scheme),s(U);if(U||N.match(r))return N;if(F&&!F.host&&!F.path)return F.host=N,s(F);const $=N.charAt(0)==="/"?N:c(I.replace(/\/+$/,"")+"/"+N);return F?(F.path=$,s(F)):$}t.join=l,t.isAbsolute=function(I){return I.charAt(0)==="/"||n.test(I)};function u(I,N){I===""&&(I="."),I=I.replace(/\/$/,"");let U=0;for(;N.indexOf(I+"/")!==0;){const F=I.lastIndexOf("/");if(F<0||(I=I.slice(0,F),I.match(/^([^\/]+:\/)?\/*$/)))return N;++U}return Array(U+1).join("../")+N.substr(I.length+1)}t.relative=u;const d=function(){return!("__proto__"in Object.create(null))}();function h(I){return I}function p(I){return g(I)?"$"+I:I}t.toSetString=d?h:p;function f(I){return g(I)?I.slice(1):I}t.fromSetString=d?h:f;function g(I){if(!I)return!1;const N=I.length;if(N<9||I.charCodeAt(N-1)!==95||I.charCodeAt(N-2)!==95||I.charCodeAt(N-3)!==111||I.charCodeAt(N-4)!==116||I.charCodeAt(N-5)!==111||I.charCodeAt(N-6)!==114||I.charCodeAt(N-7)!==112||I.charCodeAt(N-8)!==95||I.charCodeAt(N-9)!==95)return!1;for(let U=N-10;U>=0;U--)if(I.charCodeAt(U)!==36)return!1;return!0}function y(I,N,U){let F=w(I.source,N.source);return F!==0||(F=I.originalLine-N.originalLine,F!==0)||(F=I.originalColumn-N.originalColumn,F!==0||U)||(F=I.generatedColumn-N.generatedColumn,F!==0)||(F=I.generatedLine-N.generatedLine,F!==0)?F:w(I.name,N.name)}t.compareByOriginalPositions=y;function E(I,N,U){let F=I.generatedLine-N.generatedLine;return F!==0||(F=I.generatedColumn-N.generatedColumn,F!==0||U)||(F=w(I.source,N.source),F!==0)||(F=I.originalLine-N.originalLine,F!==0)||(F=I.originalColumn-N.originalColumn,F!==0)?F:w(I.name,N.name)}t.compareByGeneratedPositionsDeflated=E;function w(I,N){return I===N?0:I===null?1:N===null?-1:I>N?1:-1}function R(I,N){let U=I.generatedLine-N.generatedLine;return U!==0||(U=I.generatedColumn-N.generatedColumn,U!==0)||(U=w(I.source,N.source),U!==0)||(U=I.originalLine-N.originalLine,U!==0)||(U=I.originalColumn-N.originalColumn,U!==0)?U:w(I.name,N.name)}t.compareByGeneratedPositionsInflated=R;function A(I){return JSON.parse(I.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function k(I,N,U){if(N=N||"",I&&(I[I.length-1]!=="/"&&N[0]!=="/"&&(I+="/"),N=I+N),U){const F=i(U);if(!F)throw new Error("sourceMapURL could not be parsed");if(F.path){const $=F.path.lastIndexOf("/");$>=0&&(F.path=F.path.substring(0,$+1))}N=l(s(F),N)}return c(N)}t.computeSourceURL=k})(Qw);var _3={};let n1e=class gY{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new gY;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};_3.ArraySet=n1e;var vY={};const _Y=Qw;function r1e(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||_Y.compareByGeneratedPositionsInflated(t,e)<=0}let i1e=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){r1e(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(_Y.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};vY.MappingList=i1e;const HS=hY,ia=Qw,B1=_3.ArraySet,s1e=vY.MappingList;let yY=class bY{constructor(e){e||(e={}),this._file=ia.getArg(e,"file",null),this._sourceRoot=ia.getArg(e,"sourceRoot",null),this._skipValidation=ia.getArg(e,"skipValidation",!1),this._sources=new B1,this._names=new B1,this._mappings=new s1e,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new bY({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=ia.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=ia.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=ia.getArg(e,"generated"),r=ia.getArg(e,"original",null);let i=ia.getArg(e,"source",null),s=ia.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=ia.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ia.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[ia.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=ia.relative(s,i));const o=this._mappings.toArray().length>0?new B1:this._sources,a=new B1;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const d=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});d.source!=null&&(c.source=d.source,r!=null&&(c.source=ia.join(r,c.source)),s!=null&&(c.source=ia.relative(s,c.source)),c.originalLine=d.line,c.originalColumn=d.column,d.name!=null&&(c.name=d.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=ia.join(r,c)),s!=null&&(c=ia.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,d;const h=this._mappings.toArray();for(let p=0,f=h.length;p<f;p++){if(l=h[p],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(p>0){if(!ia.compareByGeneratedPositionsInflated(l,h[p-1]))continue;c+=","}c+=HS.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(d=this._sources.indexOf(l.source),c+=HS.encode(d-o),o=d,c+=HS.encode(l.originalLine-1-i),i=l.originalLine-1,c+=HS.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=HS.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=ia.relative(n,r));const i=ia.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};yY.prototype._version=3;dY.SourceMapGenerator=yY;var EY={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(EY);var oT={exports:{}},o1e=null;const a1e=Object.freeze(Object.defineProperty({__proto__:null,default:o1e},Symbol.toStringTag,{value:"Module"})),c1e=FF(a1e);var VP,P6;function l1e(){if(P6)return VP;P6=1;function t(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function e(i,s){for(var o="",a=0,c=-1,l=0,u,d=0;d<=i.length;++d){if(d<i.length)u=i.charCodeAt(d);else{if(u===47)break;u=47}if(u===47){if(!(c===d-1||l===1))if(c!==d-1&&l===2){if(o.length<2||a!==2||o.charCodeAt(o.length-1)!==46||o.charCodeAt(o.length-2)!==46){if(o.length>2){var h=o.lastIndexOf("/");if(h!==o.length-1){h===-1?(o="",a=0):(o=o.slice(0,h),a=o.length-1-o.lastIndexOf("/")),c=d,l=0;continue}}else if(o.length===2||o.length===1){o="",a=0,c=d,l=0;continue}}s&&(o.length>0?o+="/..":o="..",a=2)}else o.length>0?o+="/"+i.slice(c+1,d):o=i.slice(c+1,d),a=d-c-1;c=d,l=0}else u===46&&l!==-1?++l:l=-1}return o}function n(i,s){var o=s.dir||s.root,a=s.base||(s.name||"")+(s.ext||"");return o?o===s.root?o+a:o+i+a:a}var r={resolve:function(){for(var s="",o=!1,a,c=arguments.length-1;c>=-1&&!o;c--){var l;c>=0?l=arguments[c]:(a===void 0&&(a=Bn.cwd()),l=a),t(l),l.length!==0&&(s=l+"/"+s,o=l.charCodeAt(0)===47)}return s=e(s,!o),o?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(t(s),s.length===0)return".";var o=s.charCodeAt(0)===47,a=s.charCodeAt(s.length-1)===47;return s=e(s,!o),s.length===0&&!o&&(s="."),s.length>0&&a&&(s+="/"),o?"/"+s:s},isAbsolute:function(s){return t(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,o=0;o<arguments.length;++o){var a=arguments[o];t(a),a.length>0&&(s===void 0?s=a:s+="/"+a)}return s===void 0?".":r.normalize(s)},relative:function(s,o){if(t(s),t(o),s===o||(s=r.resolve(s),o=r.resolve(o),s===o))return"";for(var a=1;a<s.length&&s.charCodeAt(a)===47;++a);for(var c=s.length,l=c-a,u=1;u<o.length&&o.charCodeAt(u)===47;++u);for(var d=o.length,h=d-u,p=l<h?l:h,f=-1,g=0;g<=p;++g){if(g===p){if(h>p){if(o.charCodeAt(u+g)===47)return o.slice(u+g+1);if(g===0)return o.slice(u+g)}else l>p&&(s.charCodeAt(a+g)===47?f=g:g===0&&(f=0));break}var y=s.charCodeAt(a+g),E=o.charCodeAt(u+g);if(y!==E)break;y===47&&(f=g)}var w="";for(g=a+f+1;g<=c;++g)(g===c||s.charCodeAt(g)===47)&&(w.length===0?w+="..":w+="/..");return w.length>0?w+o.slice(u+f):(u+=f,o.charCodeAt(u)===47&&++u,o.slice(u))},_makeLong:function(s){return s},dirname:function(s){if(t(s),s.length===0)return".";for(var o=s.charCodeAt(0),a=o===47,c=-1,l=!0,u=s.length-1;u>=1;--u)if(o=s.charCodeAt(u),o===47){if(!l){c=u;break}}else l=!1;return c===-1?a?"/":".":a&&c===1?"//":s.slice(0,c)},basename:function(s,o){if(o!==void 0&&typeof o!="string")throw new TypeError('"ext" argument must be a string');t(s);var a=0,c=-1,l=!0,u;if(o!==void 0&&o.length>0&&o.length<=s.length){if(o.length===s.length&&o===s)return"";var d=o.length-1,h=-1;for(u=s.length-1;u>=0;--u){var p=s.charCodeAt(u);if(p===47){if(!l){a=u+1;break}}else h===-1&&(l=!1,h=u+1),d>=0&&(p===o.charCodeAt(d)?--d===-1&&(c=u):(d=-1,c=h))}return a===c?c=h:c===-1&&(c=s.length),s.slice(a,c)}else{for(u=s.length-1;u>=0;--u)if(s.charCodeAt(u)===47){if(!l){a=u+1;break}}else c===-1&&(l=!1,c=u+1);return c===-1?"":s.slice(a,c)}},extname:function(s){t(s);for(var o=-1,a=0,c=-1,l=!0,u=0,d=s.length-1;d>=0;--d){var h=s.charCodeAt(d);if(h===47){if(!l){a=d+1;break}continue}c===-1&&(l=!1,c=d+1),h===46?o===-1?o=d:u!==1&&(u=1):o!==-1&&(u=-1)}return o===-1||c===-1||u===0||u===1&&o===c-1&&o===a+1?"":s.slice(o,c)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return n("/",s)},parse:function(s){t(s);var o={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return o;var a=s.charCodeAt(0),c=a===47,l;c?(o.root="/",l=1):l=0;for(var u=-1,d=0,h=-1,p=!0,f=s.length-1,g=0;f>=l;--f){if(a=s.charCodeAt(f),a===47){if(!p){d=f+1;break}continue}h===-1&&(p=!1,h=f+1),a===46?u===-1?u=f:g!==1&&(g=1):u!==-1&&(g=-1)}return u===-1||h===-1||g===0||g===1&&u===h-1&&u===d+1?h!==-1&&(d===0&&c?o.base=o.name=s.slice(1,h):o.base=o.name=s.slice(d,h)):(d===0&&c?(o.name=s.slice(1,u),o.base=s.slice(1,h)):(o.name=s.slice(d,u),o.base=s.slice(d,h)),o.ext=s.slice(u,h)),d>0?o.dir=s.slice(0,d-1):c&&(o.dir="/"),o},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,VP=r,VP}const u1e=(function(){return typeof window<"u"&&this===window}).call();if(u1e){let t=null;oT.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},oT.exports.initialize=e=>t=e}else{const t=c1e,e=l1e();oT.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},oT.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var SY=oT.exports;const d1e=SY;function h1e(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let VS=null;var f1e=function(){if(VS)return VS;const e=[];return VS=d1e().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,d,h){const p=new h1e;p.generatedLine=r+1,p.generatedColumn=i,s&&(p.lastGeneratedColumn=o-1),a&&(p.source=c,p.originalLine=l+1,p.originalColumn=u,d&&(p.name=h)),e[e.length-1](p)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw VS=null,n}),VS};const Fn=Qw,zP=EY,YR=_3.ArraySet,p1e=SY,m1e=f1e,y3=Symbol("smcInternal");class Do{constructor(e,n){return e==y3?Promise.resolve(this):v1e(e,n)}static initialize(e){p1e.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return _1e(e,n)}static async with(e,n,r){const i=await new Do(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Do.prototype._version=3;Do.GENERATED_ORDER=1;Do.ORIGINAL_ORDER=2;Do.GREATEST_LOWER_BOUND=1;Do.LEAST_UPPER_BOUND=2;class Zw extends Do{constructor(e,n){return super(y3).then(r=>{let i=e;typeof e=="string"&&(i=Fn.parseSourceMapInput(e));const s=Fn.getArg(i,"version");let o=Fn.getArg(i,"sources");const a=Fn.getArg(i,"names",[]);let c=Fn.getArg(i,"sourceRoot",null);const l=Fn.getArg(i,"sourcesContent",null),u=Fn.getArg(i,"mappings"),d=Fn.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Fn.normalize(c)),o=o.map(String).map(Fn.normalize).map(function(h){return c&&Fn.isAbsolute(c)&&Fn.isAbsolute(h)?Fn.relative(c,h):h}),r._names=YR.fromArray(a.map(String),!0),r._sources=YR.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(h){return Fn.computeSourceURL(c,h,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=d,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,m1e().then(h=>(r._wasm=h,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=Fn.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Zw(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||Do.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Fn.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case Do.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Do.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=Fn.getArg(e,"source");const r=Fn.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:Fn.getArg(e,"line"),generatedColumn:Fn.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Fn.getArg(e,"bias",Do.GREATEST_LOWER_BOUND);r==null&&(r=Do.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Fn.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Fn.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Fn.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Fn.getArg(i,"originalLine",null),column:Fn.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=Fn.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Fn.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=Fn.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Fn.getArg(e,"line"),originalColumn:Fn.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Fn.getArg(e,"bias",Do.GREATEST_LOWER_BOUND);i==null&&(i=Do.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Fn.getArg(s,"generatedLine",null),column:Fn.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Zw.prototype.consumer=Do;class g1e extends Do{constructor(e,n){return super(y3).then(r=>{let i=e;typeof e=="string"&&(i=Fn.parseSourceMapInput(e));const s=Fn.getArg(i,"version"),o=Fn.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new YR,r._names=new YR,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Fn.getArg(c,"offset"),u=Fn.getArg(l,"line"),d=Fn.getArg(l,"column");if(u<a.line||u===a.line&&d<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Do(Fn.getArg(c,"map"),n).then(p=>({generatedOffset:{generatedLine:u+1,generatedColumn:d+1},consumer:p}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(Fn.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(Fn.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:Fn.getArg(e,"line"),generatedColumn:Fn.getArg(e,"column")},r=zP.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Fn.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Fn.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let d=null;l.name&&(this._names.add(l.name),d=this._names.indexOf(l.name));const h={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:d};r.push(h),typeof h.originalLine=="number"&&i.push(h)}}}eachMapping(e,n,r){const i=n||null,s=r||Do.GENERATED_ORDER;let o;switch(s){case Do.GENERATED_ORDER:o=this._generatedMappings;break;case Do.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Fn.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return zP.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=Fn.getArg(e,"line"),r={source:Fn.getArg(e,"source"),originalLine:n,originalColumn:Fn.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Fn.compareByOriginalPositions,zP.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Fn.getArg(o,"generatedLine",null),column:Fn.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Fn.getArg(o,"generatedLine",null),column:Fn.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function v1e(t,e){let n=t;typeof t=="string"&&(n=Fn.parseSourceMapInput(t));const r=n.sections!=null?new g1e(n,e):new Zw(n,e);return Promise.resolve(r)}function _1e(t,e){return Zw.fromSourceMap(t,e)}var TY={};const y1e=dY.SourceMapGenerator,j1=Qw,b1e=/(\r?\n)/,E1e=10,mb="$$$isSourceNode$$$";let S1e=class gU{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[mb]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new gU,s=e.split(b1e);let o=0;const a=function(){const p=g(),f=g()||"";return p+f;function g(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,d;return n.eachMapping(function(p){if(u!==null)if(c<p.generatedLine)h(u,a()),c++,l=0;else{d=s[o]||"";const f=d.substr(0,p.generatedColumn-l);s[o]=d.substr(p.generatedColumn-l),l=p.generatedColumn,h(u,f),u=p;return}for(;c<p.generatedLine;)i.add(a()),c++;l<p.generatedColumn&&(d=s[o]||"",i.add(d.substr(0,p.generatedColumn)),s[o]=d.substr(p.generatedColumn),l=p.generatedColumn),u=p},this),o<s.length&&(u&&h(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(p){const f=n.sourceContentFor(p);f!=null&&(r!=null&&(p=j1.join(r,p)),i.setSourceContent(p,f))}),i;function h(p,f){if(p===null||p.source===void 0)i.add(f);else{const g=r?j1.join(r,p.source):p.source;i.add(new gU(p.originalLine,p.originalColumn,g,f,p.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[mb]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[mb]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[mb]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[mb]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[j1.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][mb]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(j1.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new y1e(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let d=0,h=l.length;d<h;d++)l.charCodeAt(d)===E1e?(n.line++,n.column=0,d+1===h?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};TY.SourceNode=S1e;var T1e=TY.SourceNode;let D6=0;const L6=vp,w1e=["Command","lines"];class x1e extends Eye{constructor(){super(I7,{traceInitPerf:vp,skipValidations:!vp,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Gn(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Gn(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(BT)}])}));Gn(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Gn(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Gn(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Gn(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(i7)}));Gn(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME($B)}));Gn(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(n7)}])}));Gn(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(r7)}));Gn(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(s7),this.SUBRULE(this.words),this.CONSUME(o7)}));Gn(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Ib),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Gn(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Gn(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Gn(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Gn(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(q2),this.SUBRULE(this.words)}));Gn(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(y7),this.SUBRULE(this.words)}));Gn(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(K2),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Gn(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(kC),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(BT)),this.CONSUME4(Ib),this.CONSUME4(Y2)}}])}));Gn(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(kC),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Ib),this.CONSUME(Y2)}}])}));Gn(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(kC),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Gn(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Ib),this.CONSUME(X2),this.CONSUME(K2),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Gn(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Ib),this.CONSUME(X2),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Gn(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(T7),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Gn(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(w7),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Gn(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(x7),this.SUBRULE(this.words)}));Gn(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(C7),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Gn(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(R7)}));Gn(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(A7)}));Gn(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(S7)}));Gn(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(H2),this.SUBRULE2(this.and_test)})}));Gn(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(z2),this.SUBRULE2(this.not_test)})}));Gn(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(V2),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Gn(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Gn(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(l7)},{ALT:()=>this.CONSUME(u7)},{ALT:()=>this.CONSUME(d7)},{ALT:()=>this.CONSUME(h7)},{ALT:()=>this.CONSUME(f7)},{ALT:()=>this.CONSUME(p7)}])}));Gn(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(H2),this.SUBRULE2(this.and_test_value)})}));Gn(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(z2),this.SUBRULE2(this.not_test_value)})}));Gn(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(V2),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Gn(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Gn(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(G2)},{ALT:()=>this.CONSUME(W2)}]),this.SUBRULE(this.term)}));Gn(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Gn(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(g7)},{ALT:()=>this.CONSUME(q2)},{ALT:()=>this.CONSUME(v7)},{ALT:()=>this.CONSUME(_7)}]),this.SUBRULE(this.factor)}));Gn(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(G2)},{ALT:()=>this.CONSUME(W2)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Gn(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(m7),this.SUBRULE(this.factor)})}));Gn(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Gn(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(a7)},{ALT:()=>this.CONSUME(Xc)},{ALT:()=>this.CONSUME(c7)},{ALT:()=>{this.CONSUME(b7),this.SUBRULE(this.expr),this.CONSUME(E7)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=w1e.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(D6++).toString().padStart(3),c=s?"font-weight: bold;":"";if(L6&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),L6&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),D6--},i)}}const Vb=new x1e;if(Dye){const t=Vb.getGAstProductions(),e=Nye(t);console.info(e)}const C1e=Vb.getBaseCstVisitorConstructor();var ln=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(ln||{}),E0=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(E0||{}),Gf=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(Gf||{}),$C=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))($C||{});function R1e(t){return!!(t!=null&&t.tokenType)}function Th(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class A1e extends C1e{constructor(){super();Gn(this,"unique",0);vp&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&R1e(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():he(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Th(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Th(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:Th(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Th(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:Th(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,Th(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Po(),i=Po();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Po(),i=Po();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,Th(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Po(),i=Po();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Po(),i=Po(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Po(),i=Po(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Po();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=Th(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=Th(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=Th(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(Th(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const M1e=new A1e,nu={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},zM="zss.js";function yi(t,e){return new T1e(t.startLine??1,t.startColumn??1,zM,e)}function vU(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function GP(t){return`'${vU(t)}'`}function HC(t){if(t.startsWith('"'))return HC(t.replaceAll(/(^"|"$)/g,""));const e=WM(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===x3?`', api.get('${vU(r.image.substring(1))}'), '`:vU(r.image)).join("")}'].join('')`}function gb(t){return t.filter(e=>e!==void 0).map(Fi)}function U6(t){return yi(t,"")}function I1e(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function Ma(t,e,n){return yi(t,[`api.${e}(`,...I1e(n,", "),")"])}function O1e(t){if(t.type===ln.COMPARE&&t.compare.type===ln.COMPARE_ITEM)switch(t.compare.method){case E0.IS_EQ:return Ma(t,"isEq",[Fi(t.lhs),Fi(t.rhs)]);case E0.IS_NOT_EQ:return Ma(t,"isNotEq",[Fi(t.lhs),Fi(t.rhs)]);case E0.IS_LESS_THAN:return Ma(t,"isLessThan",[Fi(t.lhs),Fi(t.rhs)]);case E0.IS_GREATER_THAN:return Ma(t,"isGreaterThan",[Fi(t.lhs),Fi(t.rhs)]);case E0.IS_LESS_THAN_OR_EQ:return Ma(t,"isLessThanOrEq",[Fi(t.lhs),Fi(t.rhs)]);case E0.IS_GREATER_THAN_OR_EQ:return Ma(t,"isGreaterThanOrEq",[Fi(t.lhs),Fi(t.rhs)])}return yi(t,"")}function h0(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",Fi(n),")"])}function F6(t,e,n){return t.prepend(`api.${e}(`),t.add([Fi(n),")"])}function k1e(t,e){if(t.type===ln.OPERATOR_ITEM)switch(t.operator){case Gf.PLUS:return h0(e,"opPlus",t.rhs);case Gf.MINUS:return h0(e,"opMinus",t.rhs);case Gf.POWER:return h0(e,"opPower",t.rhs);case Gf.MULTIPLY:return h0(e,"opMultiply",t.rhs);case Gf.DIVIDE:return h0(e,"opDivide",t.rhs);case Gf.MOD_DIVIDE:return h0(e,"opModDivide",t.rhs);case Gf.FLOOR_DIVIDE:return h0(e,"opFloorDivide",t.rhs);case Gf.UNI_PLUS:return F6(e,"opUniPlus",t.rhs);case Gf.UNI_MINUS:return F6(e,"opUniMinus",t.rhs)}return yi(t,"")}function N1e(t){if(t.type===ln.OPERATOR){const e=t.lhs?Fi(t.lhs):yi(t,"");return t.items.forEach(n=>k1e(n,e)),e}return yi(t,"")}function $1(t,e){return yi(t,[Ma(t,"jump",[`${e}`]),"; continue;"])}function Um(t){return nu.linelookup[t??""]??-1}function _U(t,e){nu.linelookup[t]=e}function Nb(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case ln.WHILE:case ln.REPEAT:case ln.FOREACH:case ln.ELSE_IF:i.type===e&&(i.done=n);break;case ln.IF_BLOCK:case ln.IF_CHECK:i.type===e&&(i.skip=n);break;case ln.LINE:Nb(i.stmts,e,n);break}}}function wY(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case ln.WHILE:case ln.REPEAT:case ln.FOREACH:case ln.ELSE_IF:i.type===e&&_U(i.done,n);break;case ln.IF_BLOCK:case ln.IF_CHECK:i.type===e&&_U(i.skip,n);break;case ln.LINE:wY(i.stmts,e,n);break}}}function Fi(t){var e;switch(t.type){case ln.PROGRAM:return yi(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(Fi).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${zM}`]);case ln.API:return yi(t,["  ",Ma(t,t.method,gb(t.words)),`;
`]);case ln.LINE:return yi(t,[`case ${t.lineindex}:
`,...t.stmts.map(Fi).flat(),`  break;
`]);case ln.MARK:return yi(t,`  // ${t.comment}
`);case ln.GOTO:{const n=Um(t.id);return yi(t,["  ",$1(t,n),`
`])}case ln.COUNT:return yi(t,`${t.index}`);case ln.LITERAL:switch(t.literal){case $C.NUMBER:return yi(t,`${t.value}`);case $C.STRING:return yi(t,GP(t.value));case $C.TEMPLATE:return yi(t,HC(t.value))}return U6(t);case ln.TEXT:return yi(t,["  ",Ma(t,"text",[HC(t.value)]),`;
`]);case ln.STAT:if(nu.isfirststat){nu.isfirststat=!1;const n=t.value.trim().split(" ").map(GP);return yi(t,["  ",Ma(t,"stat",n),`;
`])}return yi(t,`  // skipped ${t.value}
`);case ln.LABEL:{const n=rr(t.name),r=t.active?"label":"comment";nu.labels[n]||(nu.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return nu.labels[n].push(i),yi(t,`  // ${i} '${n}' ${r}
`)}case ln.HYPERLINK:return yi(t,["  ",Ma(t,"hyperlink",[HC(t.text),...gb(t.link)]),`;
`]);case ln.MOVE:{const n=Ma(t,"command",[GP("go"),gb(t.words)].flat());return t.wait?yi(t,["  if (",n,`) { continue; };
`]):yi(t,["  ",n,`;
`])}case ln.COMMAND:return yi(t,["  if (",Ma(t,"command",gb(t.words)),`) { continue; };
`]);case ln.IF:{const n=((e=t.block)==null?void 0:e.type)===ln.IF_BLOCK?t.block:void 0;if(he(n)){Nb([t.check],ln.IF_CHECK,n.skip);const r=yi(t,Fi(t.check));return n.lines.forEach(i=>r.add(Fi(i))),wY(n.altlines,ln.ELSE_IF,Um(n.done)),n.altlines.forEach(i=>r.add(Fi(i))),r}return yi(t,Fi(t.check))}case ln.IF_CHECK:{const n=Um(t.skip);return n===-1?yi(t,["  ",Ma(t,t.method,gb(t.words)),`;
`]):yi(t,["  if (!",Ma(t,t.method,gb(t.words)),") { ",$1(t,n),` }
`])}case ln.ELSE_IF:case ln.ELSE:{const n=yi(t,"");return t.lines.forEach(r=>n.add(Fi(r))),n}case ln.WHILE:{const n=Um(t.loop),r=Um(t.done),i=yi(t,"");return Nb(t.lines,ln.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case ln.BREAK:s.goto=r;break;case ln.CONTINUE:s.goto=n;break}i.add(Fi(s))}),i}case ln.REPEAT:{const n=Um(t.loop),r=Um(t.done),i=yi(t,"");return Nb(t.lines,ln.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case ln.BREAK:s.goto=r;break;case ln.CONTINUE:s.goto=n;break}i.add(Fi(s))}),i}case ln.WAITFOR:{const n=yi(t,"");return Nb(t.lines,ln.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(Fi(r))}),n}case ln.FOREACH:{const n=Um(t.loop),r=Um(t.done),i=yi(t,"");return Nb(t.lines,ln.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case ln.BREAK:s.goto=r;break;case ln.CONTINUE:s.goto=n;break}i.add(Fi(s))}),i}case ln.BREAK:return yi(t,["  ",$1(t,t.goto),`
`]);case ln.CONTINUE:return yi(t,["  ",$1(t,t.goto),`
`]);case ln.OR:return Ma(t,"or",t.items.map(Fi));case ln.AND:return Ma(t,"and",t.items.map(Fi));case ln.NOT:return Ma(t,"not",t.items.map(Fi));case ln.COMPARE:return O1e(t);case ln.OPERATOR:return N1e(t);case ln.EXPR:return Ma(t,"expr",t.words.map(Fi));default:return console.error("<unsupported node>",t.type,t),U6(t)}}function Wf(t){if(he(t))switch(t.type===ln.LINE&&++nu.lineindex,t.lineindex=nu.lineindex,t.type){case ln.PROGRAM:t.lines.forEach(Wf);break;case ln.LINE:t.stmts.forEach(Wf);break;case ln.MARK:_U(t.id,t.lineindex);break;case ln.IF:Wf(t.check),Wf(t.block);break;case ln.IF_BLOCK:t.lines.forEach(Wf),t.altlines.forEach(Wf);break;case ln.ELSE_IF:t.lines.forEach(Wf);break;case ln.ELSE:case ln.WHILE:case ln.REPEAT:case ln.FOREACH:case ln.WAITFOR:t.lines.forEach(Wf);break;case ln.MOVE:case ln.COMMAND:case ln.IF_CHECK:t.words.forEach(Wf);break}}function P1e(t){return nu.labels={},nu.internal=1,nu.lineindex=0,nu.isfirststat=!0,Wf(t),{...Fi(t).toStringWithSourceMap({file:`${zM}.map`}),...nu}}function B6(t){return qr(t)?t.length>0?1:0:t??0}function D1e(t){return`${t}_chip`}function xY(t=""){return`vm:${t??""}`}function L1e(t,e,n){var l,u;const r=D1e(t),i=JT(r);let s;const o=Gc(Object.entries(n.labels??{}));(!qr(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(d,h){be.words=h;const p=Kxe(e,d);return he(p)?p(c,h):d!=="send"?a("send",[d,...h]):0}const c={halt(){V1e(r)},id(){return t},set(d,h){const[p,f]=Xxe(e,c,d,h);if(p)return f},get(d){const[h,p]=Yxe(e,c,d);if(h)return p},tick(d){const h=Mn(i.ps)?i.ps:0,p=h%d===0;if(i.ps=h+1,p===!1)return!1;if(c.shouldtick()===!1)return k6(e,c),!1;i.lc=0,i.ys=0,be.get=c.get,Jxe(e,c);try{const f=s==null?void 0:s.next();f!=null&&f.done&&(i.es=1)}catch(f){ai(qe,"crash",f.message),i.es=1}return k6(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Mn(i.lc)?++i.lc>ar.HALT_AT_COUNT:!0},hm(){if(qr(i.mg)&&qr(i.lb)){const[d]=i.mg;if(he(d))for(let h=0;h<i.lb.length;++h){const[p,f]=i.lb[h];if(p===d)return f.find(g=>Mn(g)&&g>0)??0}}return 0},yield(){i.ys=1},jump(d){i.ec=d},sy(){return!!i.ys||c.shouldhalt()},send(d,h,p,f){qe.emit(`${xY(d)}:${h}`,p,f)},lock(d){i.lk=d},unlock(){i.lk=""},message(d){i.lk&&d.sender!==i.lk||(i.mg=[d.target,d.data,d.sender,d.player])},zap(d){if(qr(i.lb))for(let h=0;h<i.lb.length;++h){const[p,f]=i.lb[h];if(p===d){const g=f.findIndex(y=>y>0);g>=0&&(f[g]*=-1)}}},restore(d){if(qr(i.lb))for(let h=0;h<i.lb.length;++h){const[p,f]=i.lb[h];if(p===d)for(let g=0;g<f.length;g++)f[h]=Math.abs(f[h])}},getcase(){i.ec=Mn(i.ec)?i.ec:1;const d=c.hm();if(d&&qr(i.mg)){const[,h,p,f]=i.mg;c.set("sender",p),he(h)&&c.set("arg",h),nr(f)&&(c.set("player",f),be.elementfocus=f),i.mg=void 0,i.ys=0,i.es=0,i.ec=d}return i.ec},nextcase(){const d=Mn(i.ec)?i.ec:1;return i.ec=d+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(d){const h=Wye.parse(d),[p]=h.filter(f=>f.fileName===zM);return{line:(p==null?void 0:p.lineNumber)??0,column:(p==null?void 0:p.columnNumber)??0}},text(d){return a("text",[d])},stat(...d){return a("stat",d)},hyperlink(...d){return a("hyperlink",d)},command(...d){if(d.length===0)return 0;const[h,...p]=d;return a(rr(Uo(h)),p)},if(...d){const[h,p]=Rt(d,0,[lt.ANY]),f=B6(h);return f&&p<d.length&&c.command(...d.slice(p)),f?1:0},try(...d){const[,h]=Rt(d,0,[lt.DIR]),p=c.command("go",...d);return p&&h<d.length&&c.command(...d.slice(h)),p?1:0},take(...d){const[h,p,f]=Rt(d,0,[lt.NAME,lt.ANY]),g=Mn(p),y=g?f:1,E=c.get(h),w=g?p:1;if(!Mn(E))return y<d.length&&c.command(...d.slice(y)),1;const R=E-w;return R<0?(y<d.length&&c.command(...d.slice(y)),1):(c.set(h,R),0)},give(...d){const[h,p,f]=Rt(d,0,[lt.NAME,lt.ANY]),g=Mn(p),y=g?f:1,E=c.get(h),w=g?p:1,R=E===void 0?1:0;return R&&y<d.length&&c.command(...d.slice(y)),c.set(h,sT(E,0)+w),R},repeatstart(d,...h){const[p,f]=Rt(h,0,[lt.NUMBER]),g=`repeatcount${d}`,y=`repeatwords${d}`;i[g]=p,i[y]=f<h.length?h.slice(f):void 0},repeat(d){const h=`repeatcount${d}`,p=`repeatwords${d}`;if(!Mn(i[h]))return 0;const f=i[h];i[h]=f-1;const g=f>0,y=i[p];return g&&qr(y)&&c.command(...y),g?1:0},foreachstart(d,...h){const[p,f,g,y]=Rt(h,0,[lt.STRING,lt.NUMBER,lt.NUMBER,lt.MAYBE_NUMBER]);let E=Math.min(f,g),w=Math.max(f,g);const R=(y??0)||1;if(R<0){const A=E;E=w,w=A}return c.set(p,E-R),0},foreach(d,...h){const[p,f,g,y,E]=Rt(h,0,[lt.STRING,lt.NUMBER,lt.NUMBER,lt.MAYBE_NUMBER]);let w=Math.min(f,g),R=Math.max(f,g);const A=(y??0)||1;if(A<0){const N=w;w=R,R=N}let k=c.get(p);!Mn(k)||k<w||k>R?k=w:k+=A;const I=k<=R?1:0;return I&&(c.set(p,k),E<h.length&&c.command(...h.slice(E))),I},waitfor(...d){const[h]=Rt(d,0,[lt.ANY]),p=B6(h);return p||c.yield(),p?1:0},or(...d){let h=0;for(let p=0;p<d.length;){const[f,g]=Rt(d,p,[lt.ANY]);if(h=f,h)break;p=g}return h},and(...d){let h=0;for(let p=0;p<d.length;){const[f,g]=Rt(d,p,[lt.ANY]);if(h=f,!h)break;p=g}return h},not(...d){const[h]=Rt(d,0,[lt.ANY]);return h?0:1},expr(...d){const[h]=Rt(d,0,[lt.ANY]);return h},isEq(d,h){const[p]=Rt([d],0,[lt.ANY]),[f]=Rt([h],0,[lt.ANY]);return typeof p=="object"||typeof f=="object"?pT(p,f)?1:0:p===f?1:0},isNotEq(d,h){return this.isEq(d,h)?0:1},isLessThan(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return p<f?1:0},isGreaterThan(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return p>f?1:0},isLessThanOrEq(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return p<=f?1:0},isGreaterThanOrEq(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return p>=f?1:0},opPlus(d,h){const[p]=Rt([d],0,[lt.ANY]),[f]=Rt([h],0,[lt.ANY]);return p+f},opMinus(d,h){const[p]=Rt([d],0,[lt.ANY]),[f]=Rt([h],0,[lt.ANY]);return p-f},opPower(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return Math.pow(p,f)},opMultiply(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return p*f},opDivide(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return p/f},opModDivide(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return p%f},opFloorDivide(d,h){const[p]=Rt([d],0,[lt.NUMBER]),[f]=Rt([h],0,[lt.NUMBER]);return Math.floor(p/f)},opUniPlus(d){const[h]=Rt([d],0,[lt.NUMBER]);return+h},opUniMinus(d){const[h]=Rt([d],0,[lt.NUMBER]);return-h}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function yU(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];qr(r)?r.forEach(i=>{e.push(yU(i))}):e.push(yU(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function U1e(t){const e=O7(`${t}
`);if(e.errors.length>0)return e;Vb.input=e.tokens;const n=Vb.program();if(Vb.errors.length>0)return{tokens:e.tokens,errors:Vb.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=M1e.go(n);return r?(yU(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const WP=Object.getPrototypeOf(function*(){}).constructor;function F1e(t,e){const n=`compile-${t}`;console.time(n);const r=U1e(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=P1e(r.ast);if(i.code){Uye&&console.info(i.code);try{return{...r,...i,source:i.code,code:new WP("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new WP("api"," ")}}}return{...r,...i,source:"",code:new WP("api"," ")}}function B1e(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=F1e(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return he(s)?s.isended():!0},halt(i){const s=e[i];return he(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];he(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!he(e[i])){const d=n(a,c);if(l=e[i]=L1e(i,s,d),(u=d.errors)!=null&&u.length){const[h]=d.errors,p=((h==null?void 0:h.line)??2)-1,f=c.replaceAll(`\r
`,"").split(`
`).map((E,w)=>[E,w]);f.slice(p-5,p).forEach(([E,w])=>{ai(qe,"build",`$grey${w+1} $grey${E}`)});const[g,y]=f[p]??[];if(nr(g)&&he(y)){const E=(h.column??1)-1,w=E+h.length,R=E<g.length?g:`${g}*`,A=R.substring(0,E),k=R.substring(E,w),I=R.substring(w);ai(qe,"build",`$red${y+1} $grey${A}$red${k}$grey${I}`)}return h.message.split(`
`).forEach(E=>{ai(qe,"build",E)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=sM(i.target),a=e[s];if(he(a)){const c={...i,target:o};a.message(c)}}};return r}new Vn;const CY=B1e();var xa=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(xa||{});const Cg={halt:!1,session:Po(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function j1e(){return Cg.operator}function bU(){return[...Cg.books.values()]}function $1e(){const[t]=Cg.books.values();return t}function jE(t){const e=rr(t);return Cg.books.get(t)??bU().find(n=>n.name===e)}function EU(t,e){he(jE(e))&&(Cg.software[t]=e)}function zb(t){return jE(Cg.software[t])}function RY(t){const e=N7([]);return nr(t)&&(e.name=t),AY(e),gp(qe,`created [book] ${e.name}`),e}function H1e(t){let e=jE(t);return he(e)||(e=N7([]),e.name=t),AY(e),gp(qe,`created [book] ${e.name}`),e}function Qv(t,e){let n=he(e)?H1e(e):zb(t);return he(n)||(he(n)||(n=$1e()),he(n)||(n=RY(e)),he(n)&&gp(qe,`opened [book] ${n.name} for ${t}`)),EU(t,n.id),n}function Iv(t,e,n){return J2(Qv(t),n,e)}function JT(t){const e=Qv("main");return kM(e,t)}function j6(){const t=Qv("main");return kM(t,"main")}function V1e(t){const e=Qv("main");return lEe(e,t)}function AY(t){return Cg.books.set(t.id,t),t.id}function z1e(t){const e=jE(t);e&&Cg.books.delete(e.id)}function H1(t,e,n,r){const i=Uw(t);nr(e.id)&&qe.emit("vm:touched",[e.id,i,n],r)}function SU(t,e,n,r){if(!he(n))return!1;const i=U7(t,e,n,r);if(he(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=N0(t,Dr.BOARD,(e==null?void 0:e.exitwest)??"");if(o.length){const a=Wu(o);iT(t,n.id??"",a.id,{x:ns-1,y:r.y})}}else if(r.x>=ns){const o=N0(t,Dr.BOARD,(e==null?void 0:e.exiteast)??"");if(o.length){const a=Wu(o);iT(t,n.id??"",a.id,{x:0,y:r.y})}}else if(r.y<0){const o=N0(t,Dr.BOARD,(e==null?void 0:e.exitnorth)??"");if(o.length){const a=Wu(o);iT(t,n.id??"",a.id,{x:r.x,y:kl-1})}}else if(r.y>=kl){const o=N0(t,Dr.BOARD,(e==null?void 0:e.exitsouth)??"");if(o.length){const a=Wu(o);iT(t,n.id??"",a.id,{x:r.x,y:0})}}}else H1(i,n,"thud",void 0);n.kind==="player"?H1(n,i,"touch",n.id):n.collision===Gi.ISBULLET?H1(n,i,"shot",void 0):H1(n,i,"bump",void 0);const s=$w(t,i);return i.destructible??(s==null?void 0:s.destructible)?(he(i==null?void 0:i.id)?NE(be.book,be.board,i,be.timestamp):MM(e,{x:r.x,y:r.y}),!0):!1}return!0}function G1e(t,e,n,r,i=Ybe){var d;if(!he(t)||!he(e)||!he(n))return;const s={...be};be.book=t,be.board=e,be.element=n,be.elementid=n.id??"",be.elementisplayer=QW(be.elementid);const o=be.element.player??Cg.operator;be.elementfocus=be.elementisplayer?be.elementid:o;const a=$w(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=rr(n.name??((d=n.kinddata)==null?void 0:d.name)??"");if(CY.tick(l,v3.RUNTIME,Mn(c)?c:i,u,r),Mn(n==null?void 0:n.tickertime)&&be.timestamp-n.tickertime>Z9*5&&(n.tickertime=0,n.tickertext=""),be.elementisplayer){const h=JT(be.elementid);Mn(h.inputcurrent)&&(h.inputcurrent=0)}HW(s).forEach(h=>{be[h]=s[h]})}function MY(t,e){const n=zb("main");if(!he(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(he(u.id)){const d=`${xY(u.id)}:${c}`;qe.emit(d,e)}}}const{target:i,path:s}=sM(t),o=pEe(n);for(let a=0;a<o.length;++a){const c=o[a];switch(rr(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(k9(c,[i]),s);break}}}}function XR(t){var o;const e=Qv("main"),n=jw(e,t);if(!he(e)||!he(n)||!he(be.element))return;const r=`${t}_run`,i=rr(be.element.name??((o=be.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";CY.once(r,v3.RUNTIME,i,s)}function nc(t){var r,i,s,o,a;const e=be.words[t],n=t+1;if(X9(e)){const[c,l]=OC(t);if(he(c))return[c,l]}if(Gbe(e)){const[c,l]=Q9(t);if(he(c))return[c,l]}if(b3(e)){const[c,l]=JR(t);if(he(c))return[c,l]}if(nr(e)&&rr(e)==="rnd"){const[c,l]=nc(n),[u,d]=nc(l);return Mn(c)&&Mn(u)?[$v(c,u),d]:Mn(c)?[$v(0,c),l]:[$v(0,1),n]}if(R9(e)){const[c,l]=N2(t);if(he(c))return[c,l]}if(!he(e))return[void 0,t];if(Mn(e)||qr(e))return[e,n];if(nr(e)){const c=rr(e),l=(r=be.get)==null?void 0:r.call(be,e);if(he(l))return[l,n];switch(c){case"aligned":case"alligned":{const u=UR(be.board,be.element,be.elementfocus);return!he(be.element)||!he(u)?[0,n]:[be.element.x===u.x||be.element.y===u.y?1:0,n]}case"contact":{const u=UR(be.board,be.element,be.elementfocus);if(!he(be.element)||!he(u))return[0,n];const d=(u.x??0)-(((i=be.element)==null?void 0:i.x)??0),h=(u.y??0)-(((s=be.element)==null?void 0:s.y)??0);return[d===0&&Math.abs(h)<2||h===0&&Math.abs(d)<2?1:0,n]}case"blocked":{const[u,d]=Rt(be.words,n,[lt.DIR]);return[mEe(be.book,be.board,be.element,u)?1:0,d]}case"any":{const[u,d]=Rt(be.words,n,[lt.KIND]),h=LR(u)??"",p=Dw(be.board,h);return[O9(p,u).length?1:0,d]}case"rnd":return[$v(0,1),n];case"abs":{const[u,d]=Rt(be.words,n,[lt.NUMBER]);return[Math.abs(u),d]}case"ceil":{const[u,d]=Rt(be.words,n,[lt.NUMBER]);return[Math.ceil(u),d]}case"floor":{const[u,d]=Rt(be.words,n,[lt.NUMBER]);return[Math.floor(u),d]}case"round":{const[u,d]=Rt(be.words,n,[lt.NUMBER]);return[Math.round(u),d]}case"clamp":{const[u,d,h,p]=Rt(be.words,n,[lt.NUMBER,lt.NUMBER,lt.NUMBER]);return[Ci(u,d,h),p]}case"min":{const u=[];for(let d=n;d<be.words.length;){const[h,p]=nc(d);qr(h)&&!Lh(h)&&!lp(h)&&!Jm(h)&&!su(h)&&u.push(...h),d=p,u.push(h)}return[Math.min(...u),be.words.length]}case"max":{const u=[];for(let d=n;d<be.words.length;){const[h,p]=nc(d);qr(h)&&!Lh(h)&&!lp(h)&&!Jm(h)&&!su(h)&&u.push(...h),d=p,u.push(h)}return[Math.max(...u),be.words.length]}case"pick":{const u=[];for(let d=n;d<be.words.length;){const[h,p]=nc(d);qr(h)&&!Lh(h)&&!lp(h)&&!Jm(h)&&!su(h)&&u.push(...h),d=p,u.push(h)}return[Wu(u),be.words.length]}case"pickwith":{const u=[],[d,h]=Rt(be.words,n,[lt.NUMBER_OR_STRING]);for(let p=h;p<be.words.length;){const[f,g]=nc(p);qr(f)&&!Lh(f)&&!lp(f)&&!Jm(f)&&!su(f)&&u.push(...f),p=g,u.push(f)}return[T9(`${d}`,u),be.words.length]}case"random":{const[u,d,h]=Rt(be.words,n,[lt.NUMBER,lt.MAYBE_NUMBER]);return[$v(u,d??0),h]}case"randomwith":{const[u,d,h,p]=Rt(be.words,n,[lt.NUMBER_OR_STRING,lt.NUMBER,lt.MAYBE_NUMBER]);return[BW(`${u}`,d,h??0),p]}case"run":{const[u,d]=Rt(be.words,n,[lt.NAME]);return XR(u),[(o=be.get)==null?void 0:o.call(be,"arg"),d]}case"runwith":{const[u,d,h]=Rt(be.words,n,[lt.ANY,lt.NAME]);return he(be.element)&&(be.element.arg=u),XR(d),[(a=be.get)==null?void 0:a.call(be,"arg"),h]}}}return[e,n]}function W1e(t){return he(t)&&t<Tr.ONBLACK?t:void 0}function q1e(t){return he(t)&&t>Tr.WHITE&&t<Tr.ONCLEAR?t-Tr.ONBLACK:void 0}const GM={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function su(t){return qr(t)&&IY(t[0])}function $6(t){return su(t)&&t[0].startsWith("ON")}function IY(t){return he(Tr[t])&&nr(t)}function b3(t){if(nr(t))return GM[rr(t)]}function OY(t){return t.map(e=>Tr[e]).find(e=>he(e)&&e<Tr.ONBLACK)}function K1e(t){return t.map(e=>Tr[e]).find(e=>he(e)&&e>=Tr.ONBLACK)}function H6(t){if(su(t))return t;if(IY(t))return[t];const e=b3(t);if(he(e))return[e]}function V6(t){const e=be.words[t],n=H6(e);if(su(n))return[n,t+1];const[r,i]=nc(t),s=H6(r);return su(s)?[s,i]:[void 0,t]}function JR(t){const e=[];let n=t;const[r,i]=V6(t);if(su(r)&&(e.push(...r),n=i),su(e)&&!$6(e)){const[s,o]=V6(i);$6(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function kY(t){const e={};return t.every(n=>{const r=Tr[n];he(r)&&(r<Tr.ONBLACK?e.color=r:e.bg=r-Tr.ONBLACK)}),e}const Y1e=DB(32,126).map(t=>String.fromCharCode(t)),X1e=ed({name:"Whitespace",pattern:/ +/}),J1e=ed({name:"WhitespaceSkipped",pattern:/ +/,group:Na.SKIPPED}),E3=ed({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),S3=ed({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:Y1e}),T3=ed({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),w3=ed({name:"EscapedDollar",pattern:"$$"}),x3=ed({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),C3=ed({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),R3=ed({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function Q1e(t,e=""){return ed({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const Z1e=Object.keys(GM),NY=Z1e.map(t=>Q1e(`\\$(${t})`,t)),eCe=[X1e,E3,...NY,T3,S3,C3,w3,R3,x3],tCe=new Na(eCe,{skipValidations:!vp,ensureOptimizations:vp}),nCe=new Na([J1e,E3,...NY,T3,S3,C3,w3,R3,x3],{skipValidations:!vp,ensureOptimizations:vp});function WM(t,e=!1){return e?nCe.tokenize(t):tCe.tokenize(t)}function Ty(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function qM(t){t.active={...t.reset}}function A3(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case w3:s("$");break;case C3:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case T3:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case E3:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=GM[l],d=W1e(Tr[u]),h=q1e(Tr[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):he(d)?e.active.color=d:he(h)?e.active.bg=h:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(he(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){qM(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;XM(u,u+l.length,e.active.color,e.active.bg,e),YM(u,l,e)}}}function Wn(t,e,n){const r=WM(t);r.tokens&&(A3(r.tokens,e),n&&qM(e),e.changed())}function KM(t,e,n){const r=WM(t);if(!r.tokens)return;const i=Ty(e,n,Tr.WHITE,Tr.BLACK);return i.measureonly=!0,A3(r.tokens,i),i.x>0&&++i.y,i}function YM(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function XM(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function PY(t,e,n){const r=Pw(S3,t,0,0,0,0,0,0);A3([r],e),n&&qM(e),e.changed()}function rCe(t,e,n,r,i){i.active.topedge=t,i.active.leftedge=e,i.active.rightedge=n,i.active.bottomedge=r}function ef(t){const e=t.reset.leftedge??0,n=t.reset.rightedge??t.width-1,r=t.reset.topedge??0,i=t.reset.bottomedge??t.height-1,s=n-e+1,o=i-r+1;return{left:e,right:n,top:r,bottom:i,width:s,height:o}}const z6=t=>{let e;const n=new Set,r=(l,u)=>{const d=typeof l=="function"?l(e):l;if(!Object.is(d,e)){const h=e;e=u??(typeof d!="object"||d===null)?d:Object.assign({},e,d),n.forEach(p=>p(e,h))}},i=()=>e,a={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(n.add(l),()=>n.delete(l))},c=e=t(r,i,a);return a},M3=t=>t?z6(t):z6,iCe=t=>t;function I3(t,e=iCe){const n=Fh.useSyncExternalStore(t.subscribe,()=>e(t.getState()),()=>e(t.getInitialState()));return Fh.useDebugValue(n),n}const G6=t=>{const e=M3(t),n=r=>I3(e,r);return Object.assign(n,e),n},I_=t=>t?G6(t):G6;function QR(t,e=16){return t?DB(e-1).map(n=>{const r=n*IE;return new Ei(t.bits[r]/63,t.bits[r+1]/63,t.bits[r+2]/63)}):[]}function sCe(t){return t.generateMipmaps=!1,t.minFilter=jo,t.magFilter=jo,t.needsUpdate=!0,t}function yT(t){if(he(t))return sCe(new jle(Xbe(t)))}const Pv=ft.createContext(Ty(1,1,15,1));function tf(){return ft.useContext(Pv)}const DY=I_(()=>({blink:!1}));setInterval(()=>{DY.setState(t=>({blink:!t.blink}))},333);function Vd(){return DY(t=>t.blink)}function LY(){return M3(t=>{function e(){t(n=>({render:n.render+1}))}return{dither:[],render:0,changed(){queueMicrotask(e)}}})}function oCe(t){t.fill(0)}function qP(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return-1;t[r+i*e]=s}const UY=ft.createContext(LY());function aCe(t,e,n){const[r]=ft.useState(()=>LY()),i=t*e,s=r.getState();return s.dither.length!==i&&(s.dither=new Array(i).fill(n),s.render=0),r}function FY(){return M3(t=>{function e(){t(n=>({render:n.render+1}))}return{width:0,height:0,char:[],color:[],bg:[],render:0,changed(){queueMicrotask(e)}}})}function BY(t,e,n,r){t.char.fill(e),t.color.fill(n),t.bg.fill(r)}function ca(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return;const o=r+i*e;HW(s).forEach(a=>{const c=s[a];he(c)&&(t[a][o]=c)})}const O3=ft.createContext(FY());function JM(t,e,n,r,i){const[s]=ft.useState(()=>FY()),o=t*e,a=s.getState();return a.char.length!==o&&(a.width=t,a.height=e,a.char=new Array(o).fill(n),a.color=new Array(o).fill(r),a.bg=new Array(o).fill(i),a.render=0),s}function jY(){return ft.useContext(O3).getState()}const W6=Fw(aM),q6=Bw(oM),j0=I_(t=>({palette:W6,charset:q6,palettedata:QR(W6),charsetdata:yT(q6),setpalette(e){t(n=>pT(n.palette,e)?n:{...n,palette:e,palettedata:QR(e)})},setcharset(e){t(n=>pT(n.charset,e)?n:{...n,charset:e,charsetdata:yT(e)})},setaltcharset(e){t(n=>pT(n.altcharset,e)?n:{...n,altcharset:e,altcharsetdata:yT(e)})}})),ou=I_(()=>({insetcols:20,insetrows:20,islowrez:!1,islandscape:!0,sidebaropen:!0,showkeyboard:!1,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!1,showtouchcontrols:!1}));function eu(t,e){function n(r){ai(t,"crash",r.message)}e().catch(n)}function Qr(t,e,n){return t.namespaceURI&&t.namespaceURI!=="http://www.w3.org/1999/xhtml"||(e=Array.isArray(e)?e:[e],!e.includes(t.tagName.toLowerCase()))?!1:n?Object.entries(n).every(([r,i])=>t[r]===i):!0}function zd(t){var e;if(cCe(t)&&t.defaultView)return t.defaultView;if(!((e=t.ownerDocument)===null||e===void 0)&&e.defaultView)return t.ownerDocument.defaultView;throw new Error(`Could not determine window of node. Node was ${lCe(t)}`)}function cCe(t){return t.nodeType===9}function lCe(t){return typeof t=="function"?`function ${t.name}`:t===null?"null":String(t)}function $Y(t,e){return new Promise((n,r)=>{const i=new e;i.onerror=r,i.onabort=r,i.onload=()=>{n(String(i.result))},i.readAsText(t)})}function k3(t,e){const n={...e,length:e.length,item:r=>n[r],[Symbol.iterator]:function*(){for(let i=0;i<n.length;i++)yield n[i]}};return n.constructor=t.FileList,t.FileList&&Object.setPrototypeOf(n,t.FileList.prototype),Object.freeze(n),n}function qv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class HY{getAsFile(){return this.file}getAsString(e){typeof this.data=="string"&&e(this.data)}webkitGetAsEntry(){throw new Error("not implemented")}constructor(e,n){qv(this,"kind",void 0),qv(this,"type",void 0),qv(this,"file",null),qv(this,"data",void 0),typeof e=="string"?(this.kind="string",this.type=String(n),this.data=e):(this.kind="file",this.type=e.type,this.file=e)}}class uCe extends Array{add(...e){const n=new HY(e[0],e[1]);return this.push(n),n}clear(){this.splice(0,this.length)}remove(e){this.splice(e,1)}}function V1(t,e){const[n,r]=t.split("/"),i=!r||r==="*";return s=>e?s.type===(i?n:t):i?s.type.startsWith(`${n}/`):s.type===n}function dCe(t){return new class{getData(n){var r;const i=(r=this.items.find(V1(n,!0)))!==null&&r!==void 0?r:this.items.find(V1(n,!1));let s="";return i==null||i.getAsString(o=>{s=o}),s}setData(n,r){const i=this.items.findIndex(V1(n,!0)),s=new HY(r,n);i>=0?this.items.splice(i,1,s):this.items.push(s)}clearData(n){if(n){const r=this.items.findIndex(V1(n,!0));r>=0&&this.items.remove(r)}else this.items.clear()}get types(){const n=[];return this.files.length&&n.push("Files"),this.items.forEach(r=>n.push(r.type)),Object.freeze(n),n}setDragImage(){}constructor(){qv(this,"dropEffect","none"),qv(this,"effectAllowed","uninitialized"),qv(this,"items",new uCe),qv(this,"files",k3(t,[]))}}}function N3(t,e=[]){const n=typeof t.DataTransfer>"u"?dCe(t):new t.DataTransfer;return Object.defineProperty(n,"files",{get:()=>k3(t,e)}),n}async function hCe(t,e){return e.kind==="file"?e.getAsFile():new t.Blob([await new Promise(n=>e.getAsString(n))],{type:e.type})}function VY(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zY(t,...e){const n=Object.fromEntries(e.map(r=>[typeof r=="string"?"text/plain":r.type,Promise.resolve(r)]));return typeof t.ClipboardItem<"u"?new t.ClipboardItem(n):new class{get types(){return Array.from(Object.keys(this.data))}async getType(i){const s=await this.data[i];if(!s)throw new Error(`${i} is not one of the available MIME types on this item.`);return s instanceof t.Blob?s:new t.Blob([s],{type:i})}constructor(i){VY(this,"data",void 0),this.data=i}}(n)}const $E=Symbol("Manage ClipboardSub");function K6(t,e){return Object.assign(new class extends t.EventTarget{async read(){return Array.from(this.items)}async readText(){let r="";for(const i of this.items){const s=i.types.includes("text/plain")?"text/plain":i.types.find(o=>o.startsWith("text/"));s&&(r+=await i.getType(s).then(o=>$Y(o,t.FileReader)))}return r}async write(r){this.items=r}async writeText(r){this.items=[zY(t,r)]}constructor(...r){super(...r),VY(this,"items",[])}},{[$E]:e})}function P3(t){return!!(t!=null&&t[$E])}function fCe(t){if(P3(t.navigator.clipboard))return t.navigator.clipboard[$E];const e=Object.getOwnPropertyDescriptor(t.navigator,"clipboard");let n;const r={resetClipboardStub:()=>{n=K6(t,r)},detachClipboardStub:()=>{e?Object.defineProperty(t.navigator,"clipboard",e):Object.defineProperty(t.navigator,"clipboard",{value:void 0,configurable:!0})}};return n=K6(t,r),Object.defineProperty(t.navigator,"clipboard",{get:()=>n,configurable:!0}),n[$E]}function pCe(t){P3(t.navigator.clipboard)&&t.navigator.clipboard[$E].resetClipboardStub()}function mCe(t){P3(t.navigator.clipboard)&&t.navigator.clipboard[$E].detachClipboardStub()}async function gCe(t){const e=t.defaultView,n=e==null?void 0:e.navigator.clipboard,r=n&&await n.read();if(!r)throw new Error("The Clipboard API is unavailable.");const i=N3(e);for(const s of r)for(const o of s.types)i.setData(o,await s.getType(o).then(a=>$Y(a,e.FileReader)));return i}async function GY(t,e){const n=zd(t),r=n.navigator.clipboard,i=[];for(let o=0;o<e.items.length;o++){const a=e.items[o],c=await hCe(n,a);i.push(zY(n,c))}if(!(r&&await r.write(i).then(()=>!0,()=>!1)))throw new Error("The Clipboard API is unavailable.")}const ZR=globalThis;typeof ZR.afterEach=="function"&&ZR.afterEach(()=>pCe(globalThis.window));typeof ZR.afterAll=="function"&&ZR.afterAll(()=>mCe(globalThis.window));const WY=["input:not([type=hidden]):not([disabled])","button:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[contenteditable=""]','[contenteditable="true"]',"a[href]","[tabindex]:not([disabled])"].join(", ");function D3(t){return t.matches(WY)}function vCe(t){return new t.constructor(t.type,t)}function fg(t){for(let n=t;n;n=n.parentElement)if(Qr(n,["button","input","select","textarea","optgroup","option"])){if(n.hasAttribute("disabled"))return!0}else if(Qr(n,"fieldset")){var e;if(n.hasAttribute("disabled")&&!(!((e=n.querySelector(":scope > legend"))===null||e===void 0)&&e.contains(t)))return!0}else if(n.tagName.includes("-")&&n.constructor.formAssociated&&n.hasAttribute("disabled"))return!0;return!1}function ex(t){const e=t.activeElement;return e!=null&&e.shadowRoot?ex(e.shadowRoot):fg(e)?t.ownerDocument?t.ownerDocument.body:t.body:e}function KP(t){var e;return(e=ex(t))!==null&&e!==void 0?e:t.body}function _Ce(t,e){let n=t;do{if(e(n))return n;n=n.parentElement}while(n&&n!==t.ownerDocument.body)}function iy(t){return t.hasAttribute("contenteditable")&&(t.getAttribute("contenteditable")=="true"||t.getAttribute("contenteditable")=="")}function QT(t){const e=yCe(t);return e&&(e.closest('[contenteditable=""]')||e.closest('[contenteditable="true"]'))}function yCe(t){return t.nodeType===1?t:t.parentElement}var qY=function(t){return t.button="button",t.color="color",t.file="file",t.image="image",t.reset="reset",t.submit="submit",t.checkbox="checkbox",t.radio="radio",t}(qY||{});function KY(t){return Qr(t,"button")||Qr(t,"input")&&t.type in qY}function HE(t){return XY(t)&&!t.readOnly||iy(t)}var YY=function(t){return t.text="text",t.date="date",t["datetime-local"]="datetime-local",t.email="email",t.month="month",t.number="number",t.password="password",t.search="search",t.tel="tel",t.time="time",t.url="url",t.week="week",t}(YY||{});function XY(t){return Qr(t,"textarea")||Qr(t,"input")&&t.type in YY}function Dp(t){return JY(t)&&XY(t)}function bCe(t){return JY(t)&&KY(t)}function JY(t){return t.nodeType===1}function ECe(t){const e=t.ownerDocument.getSelection();if(e!=null&&e.focusNode&&Dp(t)){const r=QT(e.focusNode);if(r){if(!e.isCollapsed){var n;const i=((n=r.firstChild)===null||n===void 0?void 0:n.nodeType)===3?r.firstChild:r;e.setBaseAndExtent(i,0,i,0)}}else e.setBaseAndExtent(t,0,t,0)}}var __={},L3={exports:{}};L3.exports;(function(t){const n=(s=0)=>o=>`\x1B[${38+s};5;${o}m`,r=(s=0)=>(o,a,c)=>`\x1B[${38+s};2;${o};${a};${c}m`;function i(){const s=new Map,o={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};o.color.gray=o.color.blackBright,o.bgColor.bgGray=o.bgColor.bgBlackBright,o.color.grey=o.color.blackBright,o.bgColor.bgGrey=o.bgColor.bgBlackBright;for(const[a,c]of Object.entries(o)){for(const[l,u]of Object.entries(c))o[l]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},c[l]=o[l],s.set(u[0],u[1]);Object.defineProperty(o,a,{value:c,enumerable:!1})}return Object.defineProperty(o,"codes",{value:s,enumerable:!1}),o.color.close="\x1B[39m",o.bgColor.close="\x1B[49m",o.color.ansi256=n(),o.color.ansi16m=r(),o.bgColor.ansi256=n(10),o.bgColor.ansi16m=r(10),Object.defineProperties(o,{rgbToAnsi256:{value:(a,c,l)=>a===c&&c===l?a<8?16:a>248?231:Math.round((a-8)/247*24)+232:16+36*Math.round(a/255*5)+6*Math.round(c/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:a=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(a.toString(16));if(!c)return[0,0,0];let{colorString:l}=c.groups;l.length===3&&(l=l.split("").map(d=>d+d).join(""));const u=Number.parseInt(l,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:a=>o.rgbToAnsi256(...o.hexToRgb(a)),enumerable:!1}}),o}Object.defineProperty(t,"exports",{enumerable:!0,get:i})})(L3);var QY=L3.exports,Rg={};Object.defineProperty(Rg,"__esModule",{value:!0});Rg.printIteratorEntries=TCe;Rg.printIteratorValues=wCe;Rg.printListItems=xCe;Rg.printObjectProperties=CCe;const SCe=(t,e)=>{const n=Object.keys(t).sort(e);return Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r=>{Object.getOwnPropertyDescriptor(t,r).enumerable&&n.push(r)}),n};function TCe(t,e,n,r,i,s,o=": "){let a="",c=t.next();if(!c.done){a+=e.spacingOuter;const l=n+e.indent;for(;!c.done;){const u=s(c.value[0],e,l,r,i),d=s(c.value[1],e,l,r,i);a+=l+u+o+d,c=t.next(),c.done?e.min||(a+=","):a+=","+e.spacingInner}a+=e.spacingOuter+n}return a}function wCe(t,e,n,r,i,s){let o="",a=t.next();if(!a.done){o+=e.spacingOuter;const c=n+e.indent;for(;!a.done;)o+=c+s(a.value,e,c,r,i),a=t.next(),a.done?e.min||(o+=","):o+=","+e.spacingInner;o+=e.spacingOuter+n}return o}function xCe(t,e,n,r,i,s){let o="";if(t.length){o+=e.spacingOuter;const a=n+e.indent;for(let c=0;c<t.length;c++)o+=a,c in t&&(o+=s(t[c],e,a,r,i)),c<t.length-1?o+=","+e.spacingInner:e.min||(o+=",");o+=e.spacingOuter+n}return o}function CCe(t,e,n,r,i,s){let o="";const a=SCe(t,e.compareKeys);if(a.length){o+=e.spacingOuter;const c=n+e.indent;for(let l=0;l<a.length;l++){const u=a[l],d=s(u,e,c,r,i),h=s(t[u],e,c,r,i);o+=c+d+": "+h,l<a.length-1?o+=","+e.spacingInner:e.min||(o+=",")}o+=e.spacingOuter+n}return o}var Zv={};Object.defineProperty(Zv,"__esModule",{value:!0});Zv.test=Zv.serialize=Zv.default=void 0;var Y6=Rg,eA=function(){return typeof globalThis<"u"?globalThis:typeof eA<"u"?eA:typeof self<"u"?self:typeof window<"u"?window:Function("return this")()}(),YP=eA["jest-symbol-do-not-touch"]||eA.Symbol;const RCe=typeof YP=="function"&&YP.for?YP.for("jest.asymmetricMatcher"):1267621,z1=" ",ZY=(t,e,n,r,i,s)=>{const o=t.toString();return o==="ArrayContaining"||o==="ArrayNotContaining"?++r>e.maxDepth?"["+o+"]":o+z1+"["+(0,Y6.printListItems)(t.sample,e,n,r,i,s)+"]":o==="ObjectContaining"||o==="ObjectNotContaining"?++r>e.maxDepth?"["+o+"]":o+z1+"{"+(0,Y6.printObjectProperties)(t.sample,e,n,r,i,s)+"}":o==="StringMatching"||o==="StringNotMatching"||o==="StringContaining"||o==="StringNotContaining"?o+z1+s(t.sample,e,n,r,i):t.toAsymmetricMatcher()};Zv.serialize=ZY;const eX=t=>t&&t.$$typeof===RCe;Zv.test=eX;const ACe={serialize:ZY,test:eX};var MCe=ACe;Zv.default=MCe;var e_={},ICe=({onlyFirst:t=!1}={})=>{const e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,t?void 0:"g")};Object.defineProperty(e_,"__esModule",{value:!0});e_.test=e_.serialize=e_.default=void 0;var tX=nX(ICe),bs=nX(QY);function nX(t){return t&&t.__esModule?t:{default:t}}const OCe=t=>t.replace((0,tX.default)(),e=>{switch(e){case bs.default.red.close:case bs.default.green.close:case bs.default.cyan.close:case bs.default.gray.close:case bs.default.white.close:case bs.default.yellow.close:case bs.default.bgRed.close:case bs.default.bgGreen.close:case bs.default.bgYellow.close:case bs.default.inverse.close:case bs.default.dim.close:case bs.default.bold.close:case bs.default.reset.open:case bs.default.reset.close:return"</>";case bs.default.red.open:return"<red>";case bs.default.green.open:return"<green>";case bs.default.cyan.open:return"<cyan>";case bs.default.gray.open:return"<gray>";case bs.default.white.open:return"<white>";case bs.default.yellow.open:return"<yellow>";case bs.default.bgRed.open:return"<bgRed>";case bs.default.bgGreen.open:return"<bgGreen>";case bs.default.bgYellow.open:return"<bgYellow>";case bs.default.inverse.open:return"<inverse>";case bs.default.dim.open:return"<dim>";case bs.default.bold.open:return"<bold>";default:return""}}),rX=t=>typeof t=="string"&&!!t.match((0,tX.default)());e_.test=rX;const iX=(t,e,n,r,i,s)=>s(OCe(t),e,n,r,i);e_.serialize=iX;const kCe={serialize:iX,test:rX};var NCe=kCe;e_.default=NCe;var t_={};Object.defineProperty(t_,"__esModule",{value:!0});t_.test=t_.serialize=t_.default=void 0;var X6=Rg;const PCe=" ",sX=["DOMStringMap","NamedNodeMap"],DCe=/^(HTML\w*Collection|NodeList)$/,LCe=t=>sX.indexOf(t)!==-1||DCe.test(t),oX=t=>t&&t.constructor&&!!t.constructor.name&&LCe(t.constructor.name);t_.test=oX;const UCe=t=>t.constructor.name==="NamedNodeMap",aX=(t,e,n,r,i,s)=>{const o=t.constructor.name;return++r>e.maxDepth?"["+o+"]":(e.min?"":o+PCe)+(sX.indexOf(o)!==-1?"{"+(0,X6.printObjectProperties)(UCe(t)?Array.from(t).reduce((a,c)=>(a[c.name]=c.value,a),{}):{...t},e,n,r,i,s)+"}":"["+(0,X6.printListItems)(Array.from(t),e,n,r,i,s)+"]")};t_.serialize=aX;const FCe={serialize:aX,test:oX};var BCe=FCe;t_.default=BCe;var n_={},Wc={},U3={};Object.defineProperty(U3,"__esModule",{value:!0});U3.default=jCe;function jCe(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}Object.defineProperty(Wc,"__esModule",{value:!0});Wc.printText=Wc.printProps=Wc.printElementAsLeaf=Wc.printElement=Wc.printComment=Wc.printChildren=void 0;var cX=$Ce(U3);function $Ce(t){return t&&t.__esModule?t:{default:t}}const HCe=(t,e,n,r,i,s,o)=>{const a=r+n.indent,c=n.colors;return t.map(l=>{const u=e[l];let d=o(u,n,a,i,s);return typeof u!="string"&&(d.indexOf(`
`)!==-1&&(d=n.spacingOuter+a+d+n.spacingOuter+r),d="{"+d+"}"),n.spacingInner+r+c.prop.open+l+c.prop.close+"="+c.value.open+d+c.value.close}).join("")};Wc.printProps=HCe;const VCe=(t,e,n,r,i,s)=>t.map(o=>e.spacingOuter+n+(typeof o=="string"?lX(o,e):s(o,e,n,r,i))).join("");Wc.printChildren=VCe;const lX=(t,e)=>{const n=e.colors.content;return n.open+(0,cX.default)(t)+n.close};Wc.printText=lX;const zCe=(t,e)=>{const n=e.colors.comment;return n.open+"<!--"+(0,cX.default)(t)+"-->"+n.close};Wc.printComment=zCe;const GCe=(t,e,n,r,i)=>{const s=r.colors.tag;return s.open+"<"+t+(e&&s.close+e+r.spacingOuter+i+s.open)+(n?">"+s.close+n+r.spacingOuter+i+s.open+"</"+t:(e&&!r.min?"":" ")+"/")+">"+s.close};Wc.printElement=GCe;const WCe=(t,e)=>{const n=e.colors.tag;return n.open+"<"+t+n.close+" …"+n.open+" />"+n.close};Wc.printElementAsLeaf=WCe;Object.defineProperty(n_,"__esModule",{value:!0});n_.test=n_.serialize=n_.default=void 0;var vb=Wc;const qCe=1,uX=3,dX=8,hX=11,KCe=/^((HTML|SVG)\w*)?Element$/,YCe=t=>{try{return typeof t.hasAttribute=="function"&&t.hasAttribute("is")}catch{return!1}},XCe=t=>{const e=t.constructor.name,{nodeType:n,tagName:r}=t,i=typeof r=="string"&&r.includes("-")||YCe(t);return n===qCe&&(KCe.test(e)||i)||n===uX&&e==="Text"||n===dX&&e==="Comment"||n===hX&&e==="DocumentFragment"},fX=t=>{var e;return(t==null||(e=t.constructor)===null||e===void 0?void 0:e.name)&&XCe(t)};n_.test=fX;function JCe(t){return t.nodeType===uX}function QCe(t){return t.nodeType===dX}function XP(t){return t.nodeType===hX}const pX=(t,e,n,r,i,s)=>{if(JCe(t))return(0,vb.printText)(t.data,e);if(QCe(t))return(0,vb.printComment)(t.data,e);const o=XP(t)?"DocumentFragment":t.tagName.toLowerCase();return++r>e.maxDepth?(0,vb.printElementAsLeaf)(o,e):(0,vb.printElement)(o,(0,vb.printProps)(XP(t)?[]:Array.from(t.attributes).map(a=>a.name).sort(),XP(t)?{}:Array.from(t.attributes).reduce((a,c)=>(a[c.name]=c.value,a),{}),e,n+e.indent,r,i,s),(0,vb.printChildren)(Array.prototype.slice.call(t.childNodes||t.children),e,n+e.indent,r,i,s),e,n)};n_.serialize=pX;const ZCe={serialize:pX,test:fX};var eRe=ZCe;n_.default=eRe;var r_={};Object.defineProperty(r_,"__esModule",{value:!0});r_.test=r_.serialize=r_.default=void 0;var ZT=Rg;const tRe="@@__IMMUTABLE_ITERABLE__@@",nRe="@@__IMMUTABLE_LIST__@@",rRe="@@__IMMUTABLE_KEYED__@@",iRe="@@__IMMUTABLE_MAP__@@",J6="@@__IMMUTABLE_ORDERED__@@",sRe="@@__IMMUTABLE_RECORD__@@",oRe="@@__IMMUTABLE_SEQ__@@",aRe="@@__IMMUTABLE_SET__@@",cRe="@@__IMMUTABLE_STACK__@@",VE=t=>"Immutable."+t,QM=t=>"["+t+"]",ew=" ",Q6="…",lRe=(t,e,n,r,i,s,o)=>++r>e.maxDepth?QM(VE(o)):VE(o)+ew+"{"+(0,ZT.printIteratorEntries)(t.entries(),e,n,r,i,s)+"}";function uRe(t){let e=0;return{next(){if(e<t._keys.length){const n=t._keys[e++];return{done:!1,value:[n,t.get(n)]}}return{done:!0,value:void 0}}}}const dRe=(t,e,n,r,i,s)=>{const o=VE(t._name||"Record");return++r>e.maxDepth?QM(o):o+ew+"{"+(0,ZT.printIteratorEntries)(uRe(t),e,n,r,i,s)+"}"},hRe=(t,e,n,r,i,s)=>{const o=VE("Seq");return++r>e.maxDepth?QM(o):t[rRe]?o+ew+"{"+(t._iter||t._object?(0,ZT.printIteratorEntries)(t.entries(),e,n,r,i,s):Q6)+"}":o+ew+"["+(t._iter||t._array||t._collection||t._iterable?(0,ZT.printIteratorValues)(t.values(),e,n,r,i,s):Q6)+"]"},JP=(t,e,n,r,i,s,o)=>++r>e.maxDepth?QM(VE(o)):VE(o)+ew+"["+(0,ZT.printIteratorValues)(t.values(),e,n,r,i,s)+"]",mX=(t,e,n,r,i,s)=>t[iRe]?lRe(t,e,n,r,i,s,t[J6]?"OrderedMap":"Map"):t[nRe]?JP(t,e,n,r,i,s,"List"):t[aRe]?JP(t,e,n,r,i,s,t[J6]?"OrderedSet":"Set"):t[cRe]?JP(t,e,n,r,i,s,"Stack"):t[oRe]?hRe(t,e,n,r,i,s):dRe(t,e,n,r,i,s);r_.serialize=mX;const gX=t=>t&&(t[tRe]===!0||t[sRe]===!0);r_.test=gX;const fRe={serialize:mX,test:gX};var pRe=fRe;r_.default=pRe;var i_={},vX={exports:{}},ds={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZM=60103,eI=60106,tx=60107,nx=60108,rx=60114,ix=60109,sx=60110,ox=60112,ax=60113,F3=60120,cx=60115,lx=60116,_X=60121,yX=60122,bX=60117,EX=60129,SX=60131;if(typeof Symbol=="function"&&Symbol.for){var xc=Symbol.for;ZM=xc("react.element"),eI=xc("react.portal"),tx=xc("react.fragment"),nx=xc("react.strict_mode"),rx=xc("react.profiler"),ix=xc("react.provider"),sx=xc("react.context"),ox=xc("react.forward_ref"),ax=xc("react.suspense"),F3=xc("react.suspense_list"),cx=xc("react.memo"),lx=xc("react.lazy"),_X=xc("react.block"),yX=xc("react.server.block"),bX=xc("react.fundamental"),EX=xc("react.debug_trace_mode"),SX=xc("react.legacy_hidden")}function nf(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case ZM:switch(t=t.type,t){case tx:case rx:case nx:case ax:case F3:return t;default:switch(t=t&&t.$$typeof,t){case sx:case ox:case lx:case cx:case ix:return t;default:return e}}case eI:return e}}}var mRe=ix,gRe=ZM,vRe=ox,_Re=tx,yRe=lx,bRe=cx,ERe=eI,SRe=rx,TRe=nx,wRe=ax;ds.ContextConsumer=sx;ds.ContextProvider=mRe;ds.Element=gRe;ds.ForwardRef=vRe;ds.Fragment=_Re;ds.Lazy=yRe;ds.Memo=bRe;ds.Portal=ERe;ds.Profiler=SRe;ds.StrictMode=TRe;ds.Suspense=wRe;ds.isAsyncMode=function(){return!1};ds.isConcurrentMode=function(){return!1};ds.isContextConsumer=function(t){return nf(t)===sx};ds.isContextProvider=function(t){return nf(t)===ix};ds.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===ZM};ds.isForwardRef=function(t){return nf(t)===ox};ds.isFragment=function(t){return nf(t)===tx};ds.isLazy=function(t){return nf(t)===lx};ds.isMemo=function(t){return nf(t)===cx};ds.isPortal=function(t){return nf(t)===eI};ds.isProfiler=function(t){return nf(t)===rx};ds.isStrictMode=function(t){return nf(t)===nx};ds.isSuspense=function(t){return nf(t)===ax};ds.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===tx||t===rx||t===EX||t===nx||t===ax||t===F3||t===SX||typeof t=="object"&&t!==null&&(t.$$typeof===lx||t.$$typeof===cx||t.$$typeof===ix||t.$$typeof===sx||t.$$typeof===ox||t.$$typeof===bX||t.$$typeof===_X||t[0]===yX)};ds.typeOf=nf;vX.exports=ds;var xRe=vX.exports;Object.defineProperty(i_,"__esModule",{value:!0});i_.test=i_.serialize=i_.default=void 0;var S0=CRe(xRe),G1=Wc;function TX(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(TX=function(r){return r?n:e})(t)}function CRe(t,e){if(t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var n=TX(e);if(n&&n.has(t))return n.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var o=i?Object.getOwnPropertyDescriptor(t,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=t[s]}return r.default=t,n&&n.set(t,r),r}const wX=(t,e=[])=>(Array.isArray(t)?t.forEach(n=>{wX(n,e)}):t!=null&&t!==!1&&e.push(t),e),Z6=t=>{const e=t.type;if(typeof e=="string")return e;if(typeof e=="function")return e.displayName||e.name||"Unknown";if(S0.isFragment(t))return"React.Fragment";if(S0.isSuspense(t))return"React.Suspense";if(typeof e=="object"&&e!==null){if(S0.isContextProvider(t))return"Context.Provider";if(S0.isContextConsumer(t))return"Context.Consumer";if(S0.isForwardRef(t)){if(e.displayName)return e.displayName;const n=e.render.displayName||e.render.name||"";return n!==""?"ForwardRef("+n+")":"ForwardRef"}if(S0.isMemo(t)){const n=e.displayName||e.type.displayName||e.type.name||"";return n!==""?"Memo("+n+")":"Memo"}}return"UNDEFINED"},RRe=t=>{const{props:e}=t;return Object.keys(e).filter(n=>n!=="children"&&e[n]!==void 0).sort()},xX=(t,e,n,r,i,s)=>++r>e.maxDepth?(0,G1.printElementAsLeaf)(Z6(t),e):(0,G1.printElement)(Z6(t),(0,G1.printProps)(RRe(t),t.props,e,n+e.indent,r,i,s),(0,G1.printChildren)(wX(t.props.children),e,n+e.indent,r,i,s),e,n);i_.serialize=xX;const CX=t=>t!=null&&S0.isElement(t);i_.test=CX;const ARe={serialize:xX,test:CX};var MRe=ARe;i_.default=MRe;var s_={};Object.defineProperty(s_,"__esModule",{value:!0});s_.test=s_.serialize=s_.default=void 0;var W1=Wc,tA=function(){return typeof globalThis<"u"?globalThis:typeof tA<"u"?tA:typeof self<"u"?self:typeof window<"u"?window:Function("return this")()}(),QP=tA["jest-symbol-do-not-touch"]||tA.Symbol;const IRe=typeof QP=="function"&&QP.for?QP.for("react.test.json"):245830487,ORe=t=>{const{props:e}=t;return e?Object.keys(e).filter(n=>e[n]!==void 0).sort():[]},RX=(t,e,n,r,i,s)=>++r>e.maxDepth?(0,W1.printElementAsLeaf)(t.type,e):(0,W1.printElement)(t.type,t.props?(0,W1.printProps)(ORe(t),t.props,e,n+e.indent,r,i,s):"",t.children?(0,W1.printChildren)(t.children,e,n+e.indent,r,i,s):"",e,n);s_.serialize=RX;const AX=t=>t&&t.$$typeof===IRe;s_.test=AX;const kRe={serialize:RX,test:AX};var NRe=kRe;s_.default=NRe;Object.defineProperty(__,"__esModule",{value:!0});__.default=__.DEFAULT_OPTIONS=void 0;var PRe=__.format=jX,MX=__.plugins=void 0,DRe=O_(QY),zS=Rg,LRe=O_(Zv),URe=O_(e_),FRe=O_(t_),BRe=O_(n_),jRe=O_(r_),$Re=O_(i_),HRe=O_(s_);function O_(t){return t&&t.__esModule?t:{default:t}}const IX=Object.prototype.toString,VRe=Date.prototype.toISOString,zRe=Error.prototype.toString,eV=RegExp.prototype.toString,ZP=t=>typeof t.constructor=="function"&&t.constructor.name||"Object",GRe=t=>typeof window<"u"&&t===window,WRe=/^Symbol\((.*)\)(.*)$/,qRe=/\n/gi;class OX extends Error{constructor(e,n){super(e),this.stack=n,this.name=this.constructor.name}}function KRe(t){return t==="[object Array]"||t==="[object ArrayBuffer]"||t==="[object DataView]"||t==="[object Float32Array]"||t==="[object Float64Array]"||t==="[object Int8Array]"||t==="[object Int16Array]"||t==="[object Int32Array]"||t==="[object Uint8Array]"||t==="[object Uint8ClampedArray]"||t==="[object Uint16Array]"||t==="[object Uint32Array]"}function YRe(t){return Object.is(t,-0)?"-0":String(t)}function XRe(t){return`${t}n`}function tV(t,e){return e?"[Function "+(t.name||"anonymous")+"]":"[Function]"}function nV(t){return String(t).replace(WRe,"Symbol($1)")}function rV(t){return"["+zRe.call(t)+"]"}function kX(t,e,n,r){if(t===!0||t===!1)return""+t;if(t===void 0)return"undefined";if(t===null)return"null";const i=typeof t;if(i==="number")return YRe(t);if(i==="bigint")return XRe(t);if(i==="string")return r?'"'+t.replace(/"|\\/g,"\\$&")+'"':'"'+t+'"';if(i==="function")return tV(t,e);if(i==="symbol")return nV(t);const s=IX.call(t);return s==="[object WeakMap]"?"WeakMap {}":s==="[object WeakSet]"?"WeakSet {}":s==="[object Function]"||s==="[object GeneratorFunction]"?tV(t,e):s==="[object Symbol]"?nV(t):s==="[object Date]"?isNaN(+t)?"Date { NaN }":VRe.call(t):s==="[object Error]"?rV(t):s==="[object RegExp]"?n?eV.call(t).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"):eV.call(t):t instanceof Error?rV(t):null}function NX(t,e,n,r,i,s){if(i.indexOf(t)!==-1)return"[Circular]";i=i.slice(),i.push(t);const o=++r>e.maxDepth,a=e.min;if(e.callToJSON&&!o&&t.toJSON&&typeof t.toJSON=="function"&&!s)return Dv(t.toJSON(),e,n,r,i,!0);const c=IX.call(t);return c==="[object Arguments]"?o?"[Arguments]":(a?"":"Arguments ")+"["+(0,zS.printListItems)(t,e,n,r,i,Dv)+"]":KRe(c)?o?"["+t.constructor.name+"]":(a||!e.printBasicPrototype&&t.constructor.name==="Array"?"":t.constructor.name+" ")+"["+(0,zS.printListItems)(t,e,n,r,i,Dv)+"]":c==="[object Map]"?o?"[Map]":"Map {"+(0,zS.printIteratorEntries)(t.entries(),e,n,r,i,Dv," => ")+"}":c==="[object Set]"?o?"[Set]":"Set {"+(0,zS.printIteratorValues)(t.values(),e,n,r,i,Dv)+"}":o||GRe(t)?"["+ZP(t)+"]":(a||!e.printBasicPrototype&&ZP(t)==="Object"?"":ZP(t)+" ")+"{"+(0,zS.printObjectProperties)(t,e,n,r,i,Dv)+"}"}function JRe(t){return t.serialize!=null}function PX(t,e,n,r,i,s){let o;try{o=JRe(t)?t.serialize(e,n,r,i,s,Dv):t.print(e,a=>Dv(a,n,r,i,s),a=>{const c=r+n.indent;return c+a.replace(qRe,`
`+c)},{edgeSpacing:n.spacingOuter,min:n.min,spacing:n.spacingInner},n.colors)}catch(a){throw new OX(a.message,a.stack)}if(typeof o!="string")throw new Error(`pretty-format: Plugin must return type "string" but instead returned "${typeof o}".`);return o}function DX(t,e){for(let n=0;n<t.length;n++)try{if(t[n].test(e))return t[n]}catch(r){throw new OX(r.message,r.stack)}return null}function Dv(t,e,n,r,i,s){const o=DX(e.plugins,t);if(o!==null)return PX(o,t,e,n,r,i);const a=kX(t,e.printFunctionName,e.escapeRegex,e.escapeString);return a!==null?a:NX(t,e,n,r,i,s)}const B3={comment:"gray",content:"reset",prop:"yellow",tag:"cyan",value:"green"},LX=Object.keys(B3),Mh={callToJSON:!0,compareKeys:void 0,escapeRegex:!1,escapeString:!0,highlight:!1,indent:2,maxDepth:1/0,min:!1,plugins:[],printBasicPrototype:!0,printFunctionName:!0,theme:B3};__.DEFAULT_OPTIONS=Mh;function QRe(t){if(Object.keys(t).forEach(e=>{if(!Mh.hasOwnProperty(e))throw new Error(`pretty-format: Unknown option "${e}".`)}),t.min&&t.indent!==void 0&&t.indent!==0)throw new Error('pretty-format: Options "min" and "indent" cannot be used together.');if(t.theme!==void 0){if(t.theme===null)throw new Error('pretty-format: Option "theme" must not be null.');if(typeof t.theme!="object")throw new Error(`pretty-format: Option "theme" must be of type "object" but instead received "${typeof t.theme}".`)}}const ZRe=t=>LX.reduce((e,n)=>{const r=t.theme&&t.theme[n]!==void 0?t.theme[n]:B3[n],i=r&&DRe.default[r];if(i&&typeof i.close=="string"&&typeof i.open=="string")e[n]=i;else throw new Error(`pretty-format: Option "theme" has a key "${n}" whose value "${r}" is undefined in ansi-styles.`);return e},Object.create(null)),eAe=()=>LX.reduce((t,e)=>(t[e]={close:"",open:""},t),Object.create(null)),UX=t=>t&&t.printFunctionName!==void 0?t.printFunctionName:Mh.printFunctionName,FX=t=>t&&t.escapeRegex!==void 0?t.escapeRegex:Mh.escapeRegex,BX=t=>t&&t.escapeString!==void 0?t.escapeString:Mh.escapeString,iV=t=>{var e;return{callToJSON:t&&t.callToJSON!==void 0?t.callToJSON:Mh.callToJSON,colors:t&&t.highlight?ZRe(t):eAe(),compareKeys:t&&typeof t.compareKeys=="function"?t.compareKeys:Mh.compareKeys,escapeRegex:FX(t),escapeString:BX(t),indent:t&&t.min?"":tAe(t&&t.indent!==void 0?t.indent:Mh.indent),maxDepth:t&&t.maxDepth!==void 0?t.maxDepth:Mh.maxDepth,min:t&&t.min!==void 0?t.min:Mh.min,plugins:t&&t.plugins!==void 0?t.plugins:Mh.plugins,printBasicPrototype:(e=t==null?void 0:t.printBasicPrototype)!==null&&e!==void 0?e:!0,printFunctionName:UX(t),spacingInner:t&&t.min?" ":`
`,spacingOuter:t&&t.min?"":`
`}};function tAe(t){return new Array(t+1).join(" ")}function jX(t,e){if(e&&(QRe(e),e.plugins)){const r=DX(e.plugins,t);if(r!==null)return PX(r,t,iV(e),"",0,[])}const n=kX(t,UX(e),FX(e),BX(e));return n!==null?n:NX(t,iV(e),"",0,[])}const nAe={AsymmetricMatcher:LRe.default,ConvertAnsi:URe.default,DOMCollection:FRe.default,DOMElement:BRe.default,Immutable:jRe.default,ReactElement:$Re.default,ReactTestComponent:HRe.default};MX=__.plugins=nAe;var rAe=jX;__.default=rAe;var iAe=Object.prototype.toString;function sAe(t){return typeof t=="function"||iAe.call(t)==="[object Function]"}function oAe(t){var e=Number(t);return isNaN(e)?0:e===0||!isFinite(e)?e:(e>0?1:-1)*Math.floor(Math.abs(e))}var aAe=Math.pow(2,53)-1;function cAe(t){var e=oAe(t);return Math.min(Math.max(e,0),aAe)}function Ih(t,e){var n=Array,r=Object(t);if(t==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");for(var i=cAe(r.length),s=sAe(n)?Object(new n(i)):new Array(i),o=0,a;o<i;)a=r[o],s[o]=a,o+=1;return s.length=i,s}function tw(t){"@babel/helpers - typeof";return tw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tw(t)}function lAe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function uAe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$X(r.key),r)}}function dAe(t,e,n){return e&&uAe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function hAe(t,e,n){return e=$X(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $X(t){var e=fAe(t,"string");return tw(e)==="symbol"?e:String(e)}function fAe(t,e){if(tw(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(tw(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var pAe=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];lAe(this,t),hAe(this,"items",void 0),this.items=e}return dAe(t,[{key:"add",value:function(n){return this.has(n)===!1&&this.items.push(n),this}},{key:"clear",value:function(){this.items=[]}},{key:"delete",value:function(n){var r=this.items.length;return this.items=this.items.filter(function(i){return i!==n}),r!==this.items.length}},{key:"forEach",value:function(n){var r=this;this.items.forEach(function(i){n(i,i,r)})}},{key:"has",value:function(n){return this.items.indexOf(n)!==-1}},{key:"size",get:function(){return this.items.length}}]),t}();const mAe=typeof Set>"u"?Set:pAe;function Jc(t){var e;return(e=t.localName)!==null&&e!==void 0?e:t.tagName.toLowerCase()}var gAe={article:"article",aside:"complementary",button:"button",datalist:"listbox",dd:"definition",details:"group",dialog:"dialog",dt:"term",fieldset:"group",figure:"figure",form:"form",footer:"contentinfo",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading",header:"banner",hr:"separator",html:"document",legend:"legend",li:"listitem",math:"math",main:"main",menu:"list",nav:"navigation",ol:"list",optgroup:"group",option:"option",output:"status",progress:"progressbar",section:"region",summary:"button",table:"table",tbody:"rowgroup",textarea:"textbox",tfoot:"rowgroup",td:"cell",th:"columnheader",thead:"rowgroup",tr:"row",ul:"list"},vAe={caption:new Set(["aria-label","aria-labelledby"]),code:new Set(["aria-label","aria-labelledby"]),deletion:new Set(["aria-label","aria-labelledby"]),emphasis:new Set(["aria-label","aria-labelledby"]),generic:new Set(["aria-label","aria-labelledby","aria-roledescription"]),insertion:new Set(["aria-label","aria-labelledby"]),paragraph:new Set(["aria-label","aria-labelledby"]),presentation:new Set(["aria-label","aria-labelledby"]),strong:new Set(["aria-label","aria-labelledby"]),subscript:new Set(["aria-label","aria-labelledby"]),superscript:new Set(["aria-label","aria-labelledby"])};function _Ae(t,e){return["aria-atomic","aria-busy","aria-controls","aria-current","aria-describedby","aria-details","aria-dropeffect","aria-flowto","aria-grabbed","aria-hidden","aria-keyshortcuts","aria-label","aria-labelledby","aria-live","aria-owns","aria-relevant","aria-roledescription"].some(function(n){var r;return t.hasAttribute(n)&&!((r=vAe[e])!==null&&r!==void 0&&r.has(n))})}function HX(t,e){return _Ae(t,e)}function yAe(t){var e=EAe(t);if(e===null||e==="presentation"){var n=bAe(t);if(e!=="presentation"||HX(t,n||""))return n}return e}function bAe(t){var e=gAe[Jc(t)];if(e!==void 0)return e;switch(Jc(t)){case"a":case"area":case"link":if(t.hasAttribute("href"))return"link";break;case"img":return t.getAttribute("alt")===""&&!HX(t,"img")?"presentation":"img";case"input":{var n=t,r=n.type;switch(r){case"button":case"image":case"reset":case"submit":return"button";case"checkbox":case"radio":return r;case"range":return"slider";case"email":case"tel":case"text":case"url":return t.hasAttribute("list")?"combobox":"textbox";case"search":return t.hasAttribute("list")?"combobox":"searchbox";case"number":return"spinbutton";default:return null}}case"select":return t.hasAttribute("multiple")||t.size>1?"listbox":"combobox"}return null}function EAe(t){var e=t.getAttribute("role");if(e!==null){var n=e.trim().split(" ")[0];if(n.length>0)return n}return null}function Ws(t){return t!==null&&t.nodeType===t.ELEMENT_NODE}function VX(t){return Ws(t)&&Jc(t)==="caption"}function VC(t){return Ws(t)&&Jc(t)==="input"}function SAe(t){return Ws(t)&&Jc(t)==="optgroup"}function TAe(t){return Ws(t)&&Jc(t)==="select"}function wAe(t){return Ws(t)&&Jc(t)==="table"}function xAe(t){return Ws(t)&&Jc(t)==="textarea"}function CAe(t){var e=t.ownerDocument===null?t:t.ownerDocument,n=e.defaultView;if(n===null)throw new TypeError("no window available");return n}function RAe(t){return Ws(t)&&Jc(t)==="fieldset"}function AAe(t){return Ws(t)&&Jc(t)==="legend"}function MAe(t){return Ws(t)&&Jc(t)==="slot"}function IAe(t){return Ws(t)&&t.ownerSVGElement!==void 0}function OAe(t){return Ws(t)&&Jc(t)==="svg"}function kAe(t){return IAe(t)&&Jc(t)==="title"}function nA(t,e){if(Ws(t)&&t.hasAttribute(e)){var n=t.getAttribute(e).split(" "),r=t.getRootNode?t.getRootNode():t.ownerDocument;return n.map(function(i){return r.getElementById(i)}).filter(function(i){return i!==null})}return[]}function Qm(t,e){return Ws(t)?e.indexOf(yAe(t))!==-1:!1}function NAe(t){return t.trim().replace(/\s\s+/g," ")}function PAe(t,e){if(!Ws(t))return!1;if(t.hasAttribute("hidden")||t.getAttribute("aria-hidden")==="true")return!0;var n=e(t);return n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"}function DAe(t){return Qm(t,["button","combobox","listbox","textbox"])||zX(t,"range")}function zX(t,e){if(!Ws(t))return!1;switch(e){case"range":return Qm(t,["meter","progressbar","scrollbar","slider","spinbutton"]);default:throw new TypeError("No knowledge about abstract role '".concat(e,"'. This is likely a bug :("))}}function sV(t,e){var n=Ih(t.querySelectorAll(e));return nA(t,"aria-owns").forEach(function(r){n.push.apply(n,Ih(r.querySelectorAll(e)))}),n}function LAe(t){return TAe(t)?t.selectedOptions||sV(t,"[selected]"):sV(t,'[aria-selected="true"]')}function UAe(t){return Qm(t,["none","presentation"])}function FAe(t){return VX(t)}function BAe(t){return Qm(t,["button","cell","checkbox","columnheader","gridcell","heading","label","legend","link","menuitem","menuitemcheckbox","menuitemradio","option","radio","row","rowheader","switch","tab","tooltip","treeitem"])}function jAe(t){return!1}function $Ae(t){return VC(t)||xAe(t)?t.value:t.textContent||""}function oV(t){var e=t.getPropertyValue("content");return/^["'].*["']$/.test(e)?e.slice(1,-1):""}function GX(t){var e=Jc(t);return e==="button"||e==="input"&&t.getAttribute("type")!=="hidden"||e==="meter"||e==="output"||e==="progress"||e==="select"||e==="textarea"}function WX(t){if(GX(t))return t;var e=null;return t.childNodes.forEach(function(n){if(e===null&&Ws(n)){var r=WX(n);r!==null&&(e=r)}}),e}function HAe(t){if(t.control!==void 0)return t.control;var e=t.getAttribute("for");return e!==null?t.ownerDocument.getElementById(e):WX(t)}function VAe(t){var e=t.labels;if(e===null)return e;if(e!==void 0)return Ih(e);if(!GX(t))return null;var n=t.ownerDocument;return Ih(n.querySelectorAll("label")).filter(function(r){return HAe(r)===t})}function zAe(t){var e=t.assignedNodes();return e.length===0?Ih(t.childNodes):e}function qX(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new mAe,r=CAe(t),i=e.compute,s=i===void 0?"name":i,o=e.computedStyleSupportsPseudoElements,a=o===void 0?e.getComputedStyle!==void 0:o,c=e.getComputedStyle,l=c===void 0?r.getComputedStyle.bind(r):c,u=e.hidden,d=u===void 0?!1:u;function h(E,w){var R="";if(Ws(E)&&a){var A=l(E,"::before"),k=oV(A);R="".concat(k," ").concat(R)}var I=MAe(E)?zAe(E):Ih(E.childNodes).concat(nA(E,"aria-owns"));if(I.forEach(function(F){var $=y(F,{isEmbeddedInLabel:w.isEmbeddedInLabel,isReferenced:!1,recursion:!0}),q=Ws(F)?l(F).getPropertyValue("display"):"inline",K=q!=="inline"?" ":"";R+="".concat(K).concat($).concat(K)}),Ws(E)&&a){var N=l(E,"::after"),U=oV(N);R="".concat(R," ").concat(U)}return R.trim()}function p(E,w){var R=E.getAttributeNode(w);return R!==null&&!n.has(R)&&R.value.trim()!==""?(n.add(R),R.value):null}function f(E){return Ws(E)?p(E,"title"):null}function g(E){if(!Ws(E))return null;if(RAe(E)){n.add(E);for(var w=Ih(E.childNodes),R=0;R<w.length;R+=1){var A=w[R];if(AAe(A))return y(A,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(wAe(E)){n.add(E);for(var k=Ih(E.childNodes),I=0;I<k.length;I+=1){var N=k[I];if(VX(N))return y(N,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(OAe(E)){n.add(E);for(var U=Ih(E.childNodes),F=0;F<U.length;F+=1){var $=U[F];if(kAe($))return $.textContent}return null}else if(Jc(E)==="img"||Jc(E)==="area"){var q=p(E,"alt");if(q!==null)return q}else if(SAe(E)){var K=p(E,"label");if(K!==null)return K}if(VC(E)&&(E.type==="button"||E.type==="submit"||E.type==="reset")){var W=p(E,"value");if(W!==null)return W;if(E.type==="submit")return"Submit";if(E.type==="reset")return"Reset"}var X=VAe(E);if(X!==null&&X.length!==0)return n.add(E),Ih(X).map(function(G){return y(G,{isEmbeddedInLabel:!0,isReferenced:!1,recursion:!0})}).filter(function(G){return G.length>0}).join(" ");if(VC(E)&&E.type==="image"){var ne=p(E,"alt");if(ne!==null)return ne;var Z=p(E,"title");return Z!==null?Z:"Submit Query"}if(Qm(E,["button"])){var ie=h(E,{isEmbeddedInLabel:!1,isReferenced:!1});if(ie!=="")return ie}return null}function y(E,w){if(n.has(E))return"";if(!d&&PAe(E,l)&&!w.isReferenced)return n.add(E),"";var R=Ws(E)?E.getAttributeNode("aria-labelledby"):null,A=R!==null&&!n.has(R)?nA(E,"aria-labelledby"):[];if(s==="name"&&!w.isReferenced&&A.length>0)return n.add(R),A.map(function(q){return y(q,{isEmbeddedInLabel:w.isEmbeddedInLabel,isReferenced:!0,recursion:!1})}).join(" ");var k=w.recursion&&DAe(E)&&s==="name";if(!k){var I=(Ws(E)&&E.getAttribute("aria-label")||"").trim();if(I!==""&&s==="name")return n.add(E),I;if(!UAe(E)){var N=g(E);if(N!==null)return n.add(E),N}}if(Qm(E,["menu"]))return n.add(E),"";if(k||w.isEmbeddedInLabel||w.isReferenced){if(Qm(E,["combobox","listbox"])){n.add(E);var U=LAe(E);return U.length===0?VC(E)?E.value:"":Ih(U).map(function(q){return y(q,{isEmbeddedInLabel:w.isEmbeddedInLabel,isReferenced:!1,recursion:!0})}).join(" ")}if(zX(E,"range"))return n.add(E),E.hasAttribute("aria-valuetext")?E.getAttribute("aria-valuetext"):E.hasAttribute("aria-valuenow")?E.getAttribute("aria-valuenow"):E.getAttribute("value")||"";if(Qm(E,["textbox"]))return n.add(E),$Ae(E)}if(BAe(E)||Ws(E)&&w.isReferenced||FAe(E)||jAe()){var F=h(E,{isEmbeddedInLabel:w.isEmbeddedInLabel,isReferenced:!1});if(F!=="")return n.add(E),F}if(E.nodeType===E.TEXT_NODE)return n.add(E),E.textContent||"";if(w.recursion)return n.add(E),h(E,{isEmbeddedInLabel:w.isEmbeddedInLabel,isReferenced:!1});var $=f(E);return $!==null?(n.add(E),$):(n.add(E),"")}return NAe(y(t,{isEmbeddedInLabel:!1,isReferenced:s==="description",recursion:!1}))}function nw(t){"@babel/helpers - typeof";return nw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nw(t)}function aV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function cV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?aV(Object(n),!0).forEach(function(r){GAe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function GAe(t,e,n){return e=WAe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function WAe(t){var e=qAe(t,"string");return nw(e)==="symbol"?e:String(e)}function qAe(t,e){if(nw(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(nw(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function KX(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=nA(t,"aria-describedby").map(function(i){return qX(i,cV(cV({},e),{},{compute:"description"}))}).join(" ");if(n===""){var r=t.getAttribute("title");n=r===null?"":r}return n}function KAe(t){return Qm(t,["caption","code","deletion","emphasis","generic","insertion","paragraph","presentation","strong","subscript","superscript"])}function j3(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return KAe(t)?"":qX(t,e)}var Nh={},tI={},wy={},nI={};Object.defineProperty(nI,"__esModule",{value:!0});nI.default=void 0;function YAe(){var t=this,e=0,n={"@@iterator":function(){return n},next:function(){if(e<t.length){var i=t[e];return e=e+1,{done:!1,value:i}}else return{done:!0}}};return n}var XAe=YAe;nI.default=XAe;Object.defineProperty(wy,"__esModule",{value:!0});wy.default=ZAe;var JAe=QAe(nI);function QAe(t){return t&&t.__esModule?t:{default:t}}function TU(t){"@babel/helpers - typeof";return TU=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},TU(t)}function ZAe(t,e){return typeof Symbol=="function"&&TU(Symbol.iterator)==="symbol"&&Object.defineProperty(t,Symbol.iterator,{value:JAe.default.bind(e)}),t}Object.defineProperty(tI,"__esModule",{value:!0});tI.default=void 0;var eMe=tMe(wy);function tMe(t){return t&&t.__esModule?t:{default:t}}function eD(t,e){return iMe(t)||rMe(t,e)||YX(t,e)||nMe()}function nMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rMe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function iMe(t){if(Array.isArray(t))return t}function sMe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=YX(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function YX(t,e){if(t){if(typeof t=="string")return lV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lV(t,e)}}function lV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _b=[["aria-activedescendant",{type:"id"}],["aria-atomic",{type:"boolean"}],["aria-autocomplete",{type:"token",values:["inline","list","both","none"]}],["aria-braillelabel",{type:"string"}],["aria-brailleroledescription",{type:"string"}],["aria-busy",{type:"boolean"}],["aria-checked",{type:"tristate"}],["aria-colcount",{type:"integer"}],["aria-colindex",{type:"integer"}],["aria-colspan",{type:"integer"}],["aria-controls",{type:"idlist"}],["aria-current",{type:"token",values:["page","step","location","date","time",!0,!1]}],["aria-describedby",{type:"idlist"}],["aria-description",{type:"string"}],["aria-details",{type:"id"}],["aria-disabled",{type:"boolean"}],["aria-dropeffect",{type:"tokenlist",values:["copy","execute","link","move","none","popup"]}],["aria-errormessage",{type:"id"}],["aria-expanded",{type:"boolean",allowundefined:!0}],["aria-flowto",{type:"idlist"}],["aria-grabbed",{type:"boolean",allowundefined:!0}],["aria-haspopup",{type:"token",values:[!1,!0,"menu","listbox","tree","grid","dialog"]}],["aria-hidden",{type:"boolean",allowundefined:!0}],["aria-invalid",{type:"token",values:["grammar",!1,"spelling",!0]}],["aria-keyshortcuts",{type:"string"}],["aria-label",{type:"string"}],["aria-labelledby",{type:"idlist"}],["aria-level",{type:"integer"}],["aria-live",{type:"token",values:["assertive","off","polite"]}],["aria-modal",{type:"boolean"}],["aria-multiline",{type:"boolean"}],["aria-multiselectable",{type:"boolean"}],["aria-orientation",{type:"token",values:["vertical","undefined","horizontal"]}],["aria-owns",{type:"idlist"}],["aria-placeholder",{type:"string"}],["aria-posinset",{type:"integer"}],["aria-pressed",{type:"tristate"}],["aria-readonly",{type:"boolean"}],["aria-relevant",{type:"tokenlist",values:["additions","all","removals","text"]}],["aria-required",{type:"boolean"}],["aria-roledescription",{type:"string"}],["aria-rowcount",{type:"integer"}],["aria-rowindex",{type:"integer"}],["aria-rowspan",{type:"integer"}],["aria-selected",{type:"boolean",allowundefined:!0}],["aria-setsize",{type:"integer"}],["aria-sort",{type:"token",values:["ascending","descending","none","other"]}],["aria-valuemax",{type:"number"}],["aria-valuemin",{type:"number"}],["aria-valuenow",{type:"number"}],["aria-valuetext",{type:"string"}]],wU={entries:function(){return _b},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=sMe(_b),i;try{for(r.s();!(i=r.n()).done;){var s=eD(i.value,2),o=s[0],a=s[1];e.call(n,a,o,_b)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=_b.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!wU.get(e)},keys:function(){return _b.map(function(e){var n=eD(e,1),r=n[0];return r})},values:function(){return _b.map(function(e){var n=eD(e,2),r=n[1];return r})}},oMe=(0,eMe.default)(wU,wU.entries());tI.default=oMe;var rI={};Object.defineProperty(rI,"__esModule",{value:!0});rI.default=void 0;var aMe=cMe(wy);function cMe(t){return t&&t.__esModule?t:{default:t}}function tD(t,e){return dMe(t)||uMe(t,e)||XX(t,e)||lMe()}function lMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uMe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function dMe(t){if(Array.isArray(t))return t}function hMe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=XX(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function XX(t,e){if(t){if(typeof t=="string")return uV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uV(t,e)}}function uV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var yb=[["a",{reserved:!1}],["abbr",{reserved:!1}],["acronym",{reserved:!1}],["address",{reserved:!1}],["applet",{reserved:!1}],["area",{reserved:!1}],["article",{reserved:!1}],["aside",{reserved:!1}],["audio",{reserved:!1}],["b",{reserved:!1}],["base",{reserved:!0}],["bdi",{reserved:!1}],["bdo",{reserved:!1}],["big",{reserved:!1}],["blink",{reserved:!1}],["blockquote",{reserved:!1}],["body",{reserved:!1}],["br",{reserved:!1}],["button",{reserved:!1}],["canvas",{reserved:!1}],["caption",{reserved:!1}],["center",{reserved:!1}],["cite",{reserved:!1}],["code",{reserved:!1}],["col",{reserved:!0}],["colgroup",{reserved:!0}],["content",{reserved:!1}],["data",{reserved:!1}],["datalist",{reserved:!1}],["dd",{reserved:!1}],["del",{reserved:!1}],["details",{reserved:!1}],["dfn",{reserved:!1}],["dialog",{reserved:!1}],["dir",{reserved:!1}],["div",{reserved:!1}],["dl",{reserved:!1}],["dt",{reserved:!1}],["em",{reserved:!1}],["embed",{reserved:!1}],["fieldset",{reserved:!1}],["figcaption",{reserved:!1}],["figure",{reserved:!1}],["font",{reserved:!1}],["footer",{reserved:!1}],["form",{reserved:!1}],["frame",{reserved:!1}],["frameset",{reserved:!1}],["h1",{reserved:!1}],["h2",{reserved:!1}],["h3",{reserved:!1}],["h4",{reserved:!1}],["h5",{reserved:!1}],["h6",{reserved:!1}],["head",{reserved:!0}],["header",{reserved:!1}],["hgroup",{reserved:!1}],["hr",{reserved:!1}],["html",{reserved:!0}],["i",{reserved:!1}],["iframe",{reserved:!1}],["img",{reserved:!1}],["input",{reserved:!1}],["ins",{reserved:!1}],["kbd",{reserved:!1}],["keygen",{reserved:!1}],["label",{reserved:!1}],["legend",{reserved:!1}],["li",{reserved:!1}],["link",{reserved:!0}],["main",{reserved:!1}],["map",{reserved:!1}],["mark",{reserved:!1}],["marquee",{reserved:!1}],["menu",{reserved:!1}],["menuitem",{reserved:!1}],["meta",{reserved:!0}],["meter",{reserved:!1}],["nav",{reserved:!1}],["noembed",{reserved:!0}],["noscript",{reserved:!0}],["object",{reserved:!1}],["ol",{reserved:!1}],["optgroup",{reserved:!1}],["option",{reserved:!1}],["output",{reserved:!1}],["p",{reserved:!1}],["param",{reserved:!0}],["picture",{reserved:!0}],["pre",{reserved:!1}],["progress",{reserved:!1}],["q",{reserved:!1}],["rp",{reserved:!1}],["rt",{reserved:!1}],["rtc",{reserved:!1}],["ruby",{reserved:!1}],["s",{reserved:!1}],["samp",{reserved:!1}],["script",{reserved:!0}],["section",{reserved:!1}],["select",{reserved:!1}],["small",{reserved:!1}],["source",{reserved:!0}],["spacer",{reserved:!1}],["span",{reserved:!1}],["strike",{reserved:!1}],["strong",{reserved:!1}],["style",{reserved:!0}],["sub",{reserved:!1}],["summary",{reserved:!1}],["sup",{reserved:!1}],["table",{reserved:!1}],["tbody",{reserved:!1}],["td",{reserved:!1}],["textarea",{reserved:!1}],["tfoot",{reserved:!1}],["th",{reserved:!1}],["thead",{reserved:!1}],["time",{reserved:!1}],["title",{reserved:!0}],["tr",{reserved:!1}],["track",{reserved:!0}],["tt",{reserved:!1}],["u",{reserved:!1}],["ul",{reserved:!1}],["var",{reserved:!1}],["video",{reserved:!1}],["wbr",{reserved:!1}],["xmp",{reserved:!1}]],xU={entries:function(){return yb},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=hMe(yb),i;try{for(r.s();!(i=r.n()).done;){var s=tD(i.value,2),o=s[0],a=s[1];e.call(n,a,o,yb)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=yb.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!xU.get(e)},keys:function(){return yb.map(function(e){var n=tD(e,1),r=n[0];return r})},values:function(){return yb.map(function(e){var n=tD(e,2),r=n[1];return r})}},fMe=(0,aMe.default)(xU,xU.entries());rI.default=fMe;var pS={},iI={},sI={};Object.defineProperty(sI,"__esModule",{value:!0});sI.default=void 0;var pMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},mMe=pMe;sI.default=mMe;var oI={};Object.defineProperty(oI,"__esModule",{value:!0});oI.default=void 0;var gMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},vMe=gMe;oI.default=vMe;var aI={};Object.defineProperty(aI,"__esModule",{value:!0});aI.default=void 0;var _Me={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null},relatedConcepts:[{concept:{name:"input"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},yMe=_Me;aI.default=yMe;var cI={};Object.defineProperty(cI,"__esModule",{value:!0});cI.default=void 0;var bMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},EMe=bMe;cI.default=EMe;var lI={};Object.defineProperty(lI,"__esModule",{value:!0});lI.default=void 0;var SMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},TMe=SMe;lI.default=TMe;var uI={};Object.defineProperty(uI,"__esModule",{value:!0});uI.default=void 0;var wMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{"aria-atomic":null,"aria-busy":null,"aria-controls":null,"aria-current":null,"aria-describedby":null,"aria-details":null,"aria-dropeffect":null,"aria-flowto":null,"aria-grabbed":null,"aria-hidden":null,"aria-keyshortcuts":null,"aria-label":null,"aria-labelledby":null,"aria-live":null,"aria-owns":null,"aria-relevant":null,"aria-roledescription":null},relatedConcepts:[{concept:{name:"role"},module:"XHTML"},{concept:{name:"type"},module:"Dublin Core"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]},xMe=wMe;uI.default=xMe;var dI={};Object.defineProperty(dI,"__esModule",{value:!0});dI.default=void 0;var CMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"frontmatter"},module:"DTB"},{concept:{name:"level"},module:"DTB"},{concept:{name:"level"},module:"SMIL"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},RMe=CMe;dI.default=RMe;var hI={};Object.defineProperty(hI,"__esModule",{value:!0});hI.default=void 0;var AMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},MMe=AMe;hI.default=MMe;var fI={};Object.defineProperty(fI,"__esModule",{value:!0});fI.default=void 0;var IMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","group"]]},OMe=IMe;fI.default=OMe;var pI={};Object.defineProperty(pI,"__esModule",{value:!0});pI.default=void 0;var kMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},NMe=kMe;pI.default=NMe;var mI={};Object.defineProperty(mI,"__esModule",{value:!0});mI.default=void 0;var PMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},DMe=PMe;mI.default=DMe;var gI={};Object.defineProperty(gI,"__esModule",{value:!0});gI.default=void 0;var LMe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-modal":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},UMe=LMe;gI.default=UMe;Object.defineProperty(iI,"__esModule",{value:!0});iI.default=void 0;var FMe=Gd(sI),BMe=Gd(oI),jMe=Gd(aI),$Me=Gd(cI),HMe=Gd(lI),VMe=Gd(uI),zMe=Gd(dI),GMe=Gd(hI),WMe=Gd(fI),qMe=Gd(pI),KMe=Gd(mI),YMe=Gd(gI);function Gd(t){return t&&t.__esModule?t:{default:t}}var XMe=[["command",FMe.default],["composite",BMe.default],["input",jMe.default],["landmark",$Me.default],["range",HMe.default],["roletype",VMe.default],["section",zMe.default],["sectionhead",GMe.default],["select",WMe.default],["structure",qMe.default],["widget",KMe.default],["window",YMe.default]],JMe=XMe;iI.default=JMe;var vI={},_I={};Object.defineProperty(_I,"__esModule",{value:!0});_I.default=void 0;var QMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"assertive"},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},ZMe=QMe;_I.default=ZMe;var yI={};Object.defineProperty(yI,"__esModule",{value:!0});yI.default=void 0;var eIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","alert"],["roletype","window","dialog"]]},tIe=eIe;yI.default=tIe;var bI={};Object.defineProperty(bI,"__esModule",{value:!0});bI.default=void 0;var nIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},rIe=nIe;bI.default=rIe;var EI={};Object.defineProperty(EI,"__esModule",{value:!0});EI.default=void 0;var iIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"article"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]},sIe=iIe;EI.default=sIe;var SI={};Object.defineProperty(SI,"__esModule",{value:!0});SI.default=void 0;var oIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"header"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},aIe=oIe;SI.default=aIe;var TI={};Object.defineProperty(TI,"__esModule",{value:!0});TI.default=void 0;var cIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"blockquote"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},lIe=cIe;TI.default=lIe;var wI={};Object.defineProperty(wI,"__esModule",{value:!0});wI.default=void 0;var uIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-pressed":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"button"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"image"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"reset"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"submit"}],name:"input"},module:"HTML"},{concept:{name:"button"},module:"HTML"},{concept:{name:"trigger"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},dIe=uIe;wI.default=dIe;var xI={};Object.defineProperty(xI,"__esModule",{value:!0});xI.default=void 0;var hIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"caption"},module:"HTML"}],requireContextRole:["figure","grid","table"],requiredContextRole:["figure","grid","table"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},fIe=hIe;xI.default=fIe;var CI={};Object.defineProperty(CI,"__esModule",{value:!0});CI.default=void 0;var pIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-colspan":null,"aria-rowindex":null,"aria-rowspan":null},relatedConcepts:[{concept:{constraints:["ancestor table element has table role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},mIe=pIe;CI.default=mIe;var RI={};Object.defineProperty(RI,"__esModule",{value:!0});RI.default=void 0;var gIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"checkbox"}],name:"input"},module:"HTML"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]},vIe=gIe;RI.default=vIe;var AI={};Object.defineProperty(AI,"__esModule",{value:!0});AI.default=void 0;var _Ie={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"code"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},yIe=_Ie;AI.default=yIe;var MI={};Object.defineProperty(MI,"__esModule",{value:!0});MI.default=void 0;var bIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"col"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"colgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]},EIe=bIe;MI.default=EIe;var II={};Object.defineProperty(II,"__esModule",{value:!0});II.default=void 0;var SIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-expanded":"false","aria-haspopup":"listbox"},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"email"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"search"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"tel"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"text"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"multiple"},{constraints:["undefined"],name:"size"}],constraints:["the multiple attribute is not set and the size attribute does not have a value greater than 1"],name:"select"},module:"HTML"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-expanded":"false"},superClass:[["roletype","widget","input"]]},TIe=SIe;II.default=TIe;var OI={};Object.defineProperty(OI,"__esModule",{value:!0});OI.default=void 0;var wIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-label"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},xIe=wIe;OI.default=xIe;var kI={};Object.defineProperty(kI,"__esModule",{value:!0});kI.default=void 0;var CIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"footer"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},RIe=CIe;kI.default=RIe;var NI={};Object.defineProperty(NI,"__esModule",{value:!0});NI.default=void 0;var AIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dd"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},MIe=AIe;NI.default=MIe;var PI={};Object.defineProperty(PI,"__esModule",{value:!0});PI.default=void 0;var IIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"del"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},OIe=IIe;PI.default=OIe;var DI={};Object.defineProperty(DI,"__esModule",{value:!0});DI.default=void 0;var kIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dialog"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","window"]]},NIe=kIe;DI.default=NIe;var LI={};Object.defineProperty(LI,"__esModule",{value:!0});LI.default=void 0;var PIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{module:"DAISY Guide"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","list"]]},DIe=PIe;LI.default=DIe;var UI={};Object.defineProperty(UI,"__esModule",{value:!0});UI.default=void 0;var LIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}},{concept:{name:"html"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},UIe=LIe;UI.default=UIe;var FI={};Object.defineProperty(FI,"__esModule",{value:!0});FI.default=void 0;var FIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"em"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},BIe=FIe;FI.default=BIe;var BI={};Object.defineProperty(BI,"__esModule",{value:!0});BI.default=void 0;var jIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["article"]],requiredProps:{},superClass:[["roletype","structure","section","list"]]},$Ie=jIe;BI.default=$Ie;var jI={};Object.defineProperty(jI,"__esModule",{value:!0});jI.default=void 0;var HIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"figure"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},VIe=HIe;jI.default=VIe;var $I={};Object.defineProperty($I,"__esModule",{value:!0});$I.default=void 0;var zIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"name"}],name:"form"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},GIe=zIe;$I.default=GIe;var HI={};Object.defineProperty(HI,"__esModule",{value:!0});HI.default=void 0;var WIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"a"},module:"HTML"},{concept:{name:"area"},module:"HTML"},{concept:{name:"aside"},module:"HTML"},{concept:{name:"b"},module:"HTML"},{concept:{name:"bdo"},module:"HTML"},{concept:{name:"body"},module:"HTML"},{concept:{name:"data"},module:"HTML"},{concept:{name:"div"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"footer"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"header"},module:"HTML"},{concept:{name:"hgroup"},module:"HTML"},{concept:{name:"i"},module:"HTML"},{concept:{name:"pre"},module:"HTML"},{concept:{name:"q"},module:"HTML"},{concept:{name:"samp"},module:"HTML"},{concept:{name:"section"},module:"HTML"},{concept:{name:"small"},module:"HTML"},{concept:{name:"span"},module:"HTML"},{concept:{name:"u"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},qIe=WIe;HI.default=qIe;var VI={};Object.defineProperty(VI,"__esModule",{value:!0});VI.default=void 0;var KIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-multiselectable":null,"aria-readonly":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","table"]]},YIe=KIe;VI.default=YIe;var zI={};Object.defineProperty(zI,"__esModule",{value:!0});zI.default=void 0;var XIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-selected":null},relatedConcepts:[{concept:{constraints:["ancestor table element has grid role","ancestor table element has treegrid role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","widget"]]},JIe=XIe;zI.default=JIe;var GI={};Object.defineProperty(GI,"__esModule",{value:!0});GI.default=void 0;var QIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[{concept:{name:"details"},module:"HTML"},{concept:{name:"fieldset"},module:"HTML"},{concept:{name:"optgroup"},module:"HTML"},{concept:{name:"address"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},ZIe=QIe;GI.default=ZIe;var WI={};Object.defineProperty(WI,"__esModule",{value:!0});WI.default=void 0;var eOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-level":"2"},relatedConcepts:[{concept:{name:"h1"},module:"HTML"},{concept:{name:"h2"},module:"HTML"},{concept:{name:"h3"},module:"HTML"},{concept:{name:"h4"},module:"HTML"},{concept:{name:"h5"},module:"HTML"},{concept:{name:"h6"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-level":"2"},superClass:[["roletype","structure","sectionhead"]]},tOe=eOe;WI.default=tOe;var qI={};Object.defineProperty(qI,"__esModule",{value:!0});qI.default=void 0;var nOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"alt"}],name:"img"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"alt"}],name:"img"},module:"HTML"},{concept:{name:"imggroup"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},rOe=nOe;qI.default=rOe;var KI={};Object.defineProperty(KI,"__esModule",{value:!0});KI.default=void 0;var iOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"ins"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},sOe=iOe;KI.default=sOe;var YI={};Object.defineProperty(YI,"__esModule",{value:!0});YI.default=void 0;var oOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"href"}],name:"a"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"href"}],name:"area"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},aOe=oOe;YI.default=aOe;var XI={};Object.defineProperty(XI,"__esModule",{value:!0});XI.default=void 0;var cOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menu"},module:"HTML"},{concept:{name:"ol"},module:"HTML"},{concept:{name:"ul"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["listitem"]],requiredProps:{},superClass:[["roletype","structure","section"]]},lOe=cOe;XI.default=lOe;var JI={};Object.defineProperty(JI,"__esModule",{value:!0});JI.default=void 0;var uOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-multiselectable":null,"aria-readonly":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[{concept:{attributes:[{constraints:[">1"],name:"size"}],constraints:["the size attribute value is greater than 1"],name:"select"},module:"HTML"},{concept:{attributes:[{name:"multiple"}],name:"select"},module:"HTML"},{concept:{name:"datalist"},module:"HTML"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["option","group"],["option"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},dOe=uOe;JI.default=dOe;var QI={};Object.defineProperty(QI,"__esModule",{value:!0});QI.default=void 0;var hOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{constraints:["direct descendant of ol","direct descendant of ul","direct descendant of menu"],name:"li"},module:"HTML"},{concept:{name:"item"},module:"XForms"}],requireContextRole:["directory","list"],requiredContextRole:["directory","list"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},fOe=hOe;QI.default=fOe;var ZI={};Object.defineProperty(ZI,"__esModule",{value:!0});ZI.default=void 0;var pOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-live":"polite"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},mOe=pOe;ZI.default=mOe;var eO={};Object.defineProperty(eO,"__esModule",{value:!0});eO.default=void 0;var gOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"main"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},vOe=gOe;eO.default=vOe;var tO={};Object.defineProperty(tO,"__esModule",{value:!0});tO.default=void 0;var _Oe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:[],props:{"aria-braillelabel":null,"aria-brailleroledescription":null,"aria-description":null},relatedConcepts:[{concept:{name:"mark"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},yOe=_Oe;tO.default=yOe;var nO={};Object.defineProperty(nO,"__esModule",{value:!0});nO.default=void 0;var bOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},EOe=bOe;nO.default=EOe;var rO={};Object.defineProperty(rO,"__esModule",{value:!0});rO.default=void 0;var SOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"math"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},TOe=SOe;rO.default=TOe;var iO={};Object.defineProperty(iO,"__esModule",{value:!0});iO.default=void 0;var wOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"vertical"},relatedConcepts:[{concept:{name:"MENU"},module:"JAPI"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"},{concept:{name:"sidebar"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},xOe=wOe;iO.default=xOe;var sO={};Object.defineProperty(sO,"__esModule",{value:!0});sO.default=void 0;var COe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"toolbar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select","menu"],["roletype","structure","section","group","select","menu"]]},ROe=COe;sO.default=ROe;var oO={};Object.defineProperty(oO,"__esModule",{value:!0});oO.default=void 0;var AOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"MENU_ITEM"},module:"JAPI"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},MOe=AOe;oO.default=MOe;var aO={};Object.defineProperty(aO,"__esModule",{value:!0});aO.default=void 0;var IOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"],["roletype","widget","command","menuitem"]]},OOe=IOe;aO.default=OOe;var cO={};Object.defineProperty(cO,"__esModule",{value:!0});cO.default=void 0;var kOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox","menuitemcheckbox"],["roletype","widget","command","menuitem","menuitemcheckbox"],["roletype","widget","input","radio"]]},NOe=kOe;cO.default=NOe;var lO={};Object.defineProperty(lO,"__esModule",{value:!0});lO.default=void 0;var POe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null,"aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{name:"meter"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","structure","range"]]},DOe=POe;lO.default=DOe;var uO={};Object.defineProperty(uO,"__esModule",{value:!0});uO.default=void 0;var LOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"nav"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},UOe=LOe;uO.default=UOe;var dO={};Object.defineProperty(dO,"__esModule",{value:!0});dO.default=void 0;var FOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]},BOe=FOe;dO.default=BOe;var hO={};Object.defineProperty(hO,"__esModule",{value:!0});hO.default=void 0;var jOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},$Oe=jOe;hO.default=$Oe;var fO={};Object.defineProperty(fO,"__esModule",{value:!0});fO.default=void 0;var HOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[{concept:{name:"item"},module:"XForms"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-selected":"false"},superClass:[["roletype","widget","input"]]},VOe=HOe;fO.default=VOe;var pO={};Object.defineProperty(pO,"__esModule",{value:!0});pO.default=void 0;var zOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"p"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},GOe=zOe;pO.default=GOe;var mO={};Object.defineProperty(mO,"__esModule",{value:!0});mO.default=void 0;var WOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{attributes:[{name:"alt",value:""}],name:"img"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},qOe=WOe;mO.default=qOe;var gO={};Object.defineProperty(gO,"__esModule",{value:!0});gO.default=void 0;var KOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null},relatedConcepts:[{concept:{name:"progress"},module:"HTML"},{concept:{name:"status"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","range"],["roletype","widget"]]},YOe=KOe;gO.default=YOe;var vO={};Object.defineProperty(vO,"__esModule",{value:!0});vO.default=void 0;var XOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"radio"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]},JOe=XOe;vO.default=JOe;var _O={};Object.defineProperty(_O,"__esModule",{value:!0});_O.default=void 0;var QOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{name:"list"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["radio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},ZOe=QOe;_O.default=ZOe;var yO={};Object.defineProperty(yO,"__esModule",{value:!0});yO.default=void 0;var eke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"section"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"section"},module:"HTML"},{concept:{name:"Device Independence Glossart perceivable unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},tke=eke;yO.default=tke;var bO={};Object.defineProperty(bO,"__esModule",{value:!0});bO.default=void 0;var nke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-expanded":null,"aria-level":null,"aria-posinset":null,"aria-rowindex":null,"aria-selected":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"tr"},module:"HTML"}],requireContextRole:["grid","rowgroup","table","treegrid"],requiredContextRole:["grid","rowgroup","table","treegrid"],requiredOwnedElements:[["cell"],["columnheader"],["gridcell"],["rowheader"]],requiredProps:{},superClass:[["roletype","structure","section","group"],["roletype","widget"]]},rke=nke;bO.default=rke;var EO={};Object.defineProperty(EO,"__esModule",{value:!0});EO.default=void 0;var ike={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"tbody"},module:"HTML"},{concept:{name:"tfoot"},module:"HTML"},{concept:{name:"thead"},module:"HTML"}],requireContextRole:["grid","table","treegrid"],requiredContextRole:["grid","table","treegrid"],requiredOwnedElements:[["row"]],requiredProps:{},superClass:[["roletype","structure"]]},ske=ike;EO.default=ske;var SO={};Object.defineProperty(SO,"__esModule",{value:!0});SO.default=void 0;var oke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{attributes:[{name:"scope",value:"row"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"rowgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row","rowgroup"],requiredContextRole:["row","rowgroup"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]},ake=oke;SO.default=ake;var TO={};Object.defineProperty(TO,"__esModule",{value:!0});TO.default=void 0;var cke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-valuetext":null,"aria-orientation":"vertical","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-valuenow":null},superClass:[["roletype","structure","range"],["roletype","widget"]]},lke=cke;TO.default=lke;var wO={};Object.defineProperty(wO,"__esModule",{value:!0});wO.default=void 0;var uke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},dke=uke;wO.default=dke;var xO={};Object.defineProperty(xO,"__esModule",{value:!0});xO.default=void 0;var hke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"search"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input","textbox"]]},fke=hke;xO.default=fke;var CO={};Object.defineProperty(CO,"__esModule",{value:!0});CO.default=void 0;var pke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":null,"aria-valuetext":null},relatedConcepts:[{concept:{name:"hr"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},mke=pke;CO.default=mke;var RO={};Object.defineProperty(RO,"__esModule",{value:!0});RO.default=void 0;var gke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-valuetext":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"range"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","widget","input"],["roletype","structure","range"]]},vke=gke;RO.default=vke;var AO={};Object.defineProperty(AO,"__esModule",{value:!0});AO.default=void 0;var _ke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-valuetext":null,"aria-valuenow":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"number"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","widget","input"],["roletype","structure","range"]]},yke=_ke;AO.default=yke;var MO={};Object.defineProperty(MO,"__esModule",{value:!0});MO.default=void 0;var bke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"polite"},relatedConcepts:[{concept:{name:"output"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},Eke=bke;MO.default=Eke;var IO={};Object.defineProperty(IO,"__esModule",{value:!0});IO.default=void 0;var Ske={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"strong"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},Tke=Ske;IO.default=Tke;var OO={};Object.defineProperty(OO,"__esModule",{value:!0});OO.default=void 0;var wke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sub"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},xke=wke;OO.default=xke;var kO={};Object.defineProperty(kO,"__esModule",{value:!0});kO.default=void 0;var Cke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sup"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},Rke=Cke;kO.default=Rke;var NO={};Object.defineProperty(NO,"__esModule",{value:!0});NO.default=void 0;var Ake={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"button"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"]]},Mke=Ake;NO.default=Mke;var PO={};Object.defineProperty(PO,"__esModule",{value:!0});PO.default=void 0;var Ike={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[],requireContextRole:["tablist"],requiredContextRole:["tablist"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"],["roletype","widget"]]},Oke=Ike;PO.default=Oke;var DO={};Object.defineProperty(DO,"__esModule",{value:!0});DO.default=void 0;var kke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-colcount":null,"aria-rowcount":null},relatedConcepts:[{concept:{name:"table"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","structure","section"]]},Nke=kke;DO.default=Nke;var LO={};Object.defineProperty(LO,"__esModule",{value:!0});LO.default=void 0;var Pke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-multiselectable":null,"aria-orientation":"horizontal"},relatedConcepts:[{module:"DAISY",concept:{name:"guide"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["tab"]],requiredProps:{},superClass:[["roletype","widget","composite"]]},Dke=Pke;LO.default=Dke;var UO={};Object.defineProperty(UO,"__esModule",{value:!0});UO.default=void 0;var Lke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},Uke=Lke;UO.default=Uke;var FO={};Object.defineProperty(FO,"__esModule",{value:!0});FO.default=void 0;var Fke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dfn"},module:"HTML"},{concept:{name:"dt"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},Bke=Fke;FO.default=Bke;var BO={};Object.defineProperty(BO,"__esModule",{value:!0});BO.default=void 0;var jke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-multiline":null,"aria-placeholder":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"type"},{constraints:["undefined"],name:"list"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"email"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"tel"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"text"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"url"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{name:"input"},module:"XForms"},{concept:{name:"textarea"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input"]]},$ke=jke;BO.default=$ke;var jO={};Object.defineProperty(jO,"__esModule",{value:!0});jO.default=void 0;var Hke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"time"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},Vke=Hke;jO.default=Vke;var $O={};Object.defineProperty($O,"__esModule",{value:!0});$O.default=void 0;var zke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","status"]]},Gke=zke;$O.default=Gke;var HO={};Object.defineProperty(HO,"__esModule",{value:!0});HO.default=void 0;var Wke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"menubar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]},qke=Wke;HO.default=qke;var VO={};Object.defineProperty(VO,"__esModule",{value:!0});VO.default=void 0;var Kke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},Yke=Kke;VO.default=Yke;var zO={};Object.defineProperty(zO,"__esModule",{value:!0});zO.default=void 0;var Xke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-multiselectable":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["treeitem","group"],["treeitem"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},Jke=Xke;zO.default=Jke;var GO={};Object.defineProperty(GO,"__esModule",{value:!0});GO.default=void 0;var Qke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite","grid"],["roletype","structure","section","table","grid"],["roletype","widget","composite","select","tree"],["roletype","structure","section","group","select","tree"]]},Zke=Qke;GO.default=Zke;var WO={};Object.defineProperty(WO,"__esModule",{value:!0});WO.default=void 0;var eNe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[],requireContextRole:["group","tree"],requiredContextRole:["group","tree"],requiredOwnedElements:[],requiredProps:{"aria-selected":null},superClass:[["roletype","structure","section","listitem"],["roletype","widget","input","option"]]},tNe=eNe;WO.default=tNe;Object.defineProperty(vI,"__esModule",{value:!0});vI.default=void 0;var nNe=Zt(_I),rNe=Zt(yI),iNe=Zt(bI),sNe=Zt(EI),oNe=Zt(SI),aNe=Zt(TI),cNe=Zt(wI),lNe=Zt(xI),uNe=Zt(CI),dNe=Zt(RI),hNe=Zt(AI),fNe=Zt(MI),pNe=Zt(II),mNe=Zt(OI),gNe=Zt(kI),vNe=Zt(NI),_Ne=Zt(PI),yNe=Zt(DI),bNe=Zt(LI),ENe=Zt(UI),SNe=Zt(FI),TNe=Zt(BI),wNe=Zt(jI),xNe=Zt($I),CNe=Zt(HI),RNe=Zt(VI),ANe=Zt(zI),MNe=Zt(GI),INe=Zt(WI),ONe=Zt(qI),kNe=Zt(KI),NNe=Zt(YI),PNe=Zt(XI),DNe=Zt(JI),LNe=Zt(QI),UNe=Zt(ZI),FNe=Zt(eO),BNe=Zt(tO),jNe=Zt(nO),$Ne=Zt(rO),HNe=Zt(iO),VNe=Zt(sO),zNe=Zt(oO),GNe=Zt(aO),WNe=Zt(cO),qNe=Zt(lO),KNe=Zt(uO),YNe=Zt(dO),XNe=Zt(hO),JNe=Zt(fO),QNe=Zt(pO),ZNe=Zt(mO),ePe=Zt(gO),tPe=Zt(vO),nPe=Zt(_O),rPe=Zt(yO),iPe=Zt(bO),sPe=Zt(EO),oPe=Zt(SO),aPe=Zt(TO),cPe=Zt(wO),lPe=Zt(xO),uPe=Zt(CO),dPe=Zt(RO),hPe=Zt(AO),fPe=Zt(MO),pPe=Zt(IO),mPe=Zt(OO),gPe=Zt(kO),vPe=Zt(NO),_Pe=Zt(PO),yPe=Zt(DO),bPe=Zt(LO),EPe=Zt(UO),SPe=Zt(FO),TPe=Zt(BO),wPe=Zt(jO),xPe=Zt($O),CPe=Zt(HO),RPe=Zt(VO),APe=Zt(zO),MPe=Zt(GO),IPe=Zt(WO);function Zt(t){return t&&t.__esModule?t:{default:t}}var OPe=[["alert",nNe.default],["alertdialog",rNe.default],["application",iNe.default],["article",sNe.default],["banner",oNe.default],["blockquote",aNe.default],["button",cNe.default],["caption",lNe.default],["cell",uNe.default],["checkbox",dNe.default],["code",hNe.default],["columnheader",fNe.default],["combobox",pNe.default],["complementary",mNe.default],["contentinfo",gNe.default],["definition",vNe.default],["deletion",_Ne.default],["dialog",yNe.default],["directory",bNe.default],["document",ENe.default],["emphasis",SNe.default],["feed",TNe.default],["figure",wNe.default],["form",xNe.default],["generic",CNe.default],["grid",RNe.default],["gridcell",ANe.default],["group",MNe.default],["heading",INe.default],["img",ONe.default],["insertion",kNe.default],["link",NNe.default],["list",PNe.default],["listbox",DNe.default],["listitem",LNe.default],["log",UNe.default],["main",FNe.default],["mark",BNe.default],["marquee",jNe.default],["math",$Ne.default],["menu",HNe.default],["menubar",VNe.default],["menuitem",zNe.default],["menuitemcheckbox",GNe.default],["menuitemradio",WNe.default],["meter",qNe.default],["navigation",KNe.default],["none",YNe.default],["note",XNe.default],["option",JNe.default],["paragraph",QNe.default],["presentation",ZNe.default],["progressbar",ePe.default],["radio",tPe.default],["radiogroup",nPe.default],["region",rPe.default],["row",iPe.default],["rowgroup",sPe.default],["rowheader",oPe.default],["scrollbar",aPe.default],["search",cPe.default],["searchbox",lPe.default],["separator",uPe.default],["slider",dPe.default],["spinbutton",hPe.default],["status",fPe.default],["strong",pPe.default],["subscript",mPe.default],["superscript",gPe.default],["switch",vPe.default],["tab",_Pe.default],["table",yPe.default],["tablist",bPe.default],["tabpanel",EPe.default],["term",SPe.default],["textbox",TPe.default],["time",wPe.default],["timer",xPe.default],["toolbar",CPe.default],["tooltip",RPe.default],["tree",APe.default],["treegrid",MPe.default],["treeitem",IPe.default]],kPe=OPe;vI.default=kPe;var qO={},KO={};Object.defineProperty(KO,"__esModule",{value:!0});KO.default=void 0;var NPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"abstract [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},PPe=NPe;KO.default=PPe;var YO={};Object.defineProperty(YO,"__esModule",{value:!0});YO.default=void 0;var DPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"acknowledgments [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},LPe=DPe;YO.default=LPe;var XO={};Object.defineProperty(XO,"__esModule",{value:!0});XO.default=void 0;var UPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"afterword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},FPe=UPe;XO.default=FPe;var JO={};Object.defineProperty(JO,"__esModule",{value:!0});JO.default=void 0;var BPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"appendix [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},jPe=BPe;JO.default=jPe;var QO={};Object.defineProperty(QO,"__esModule",{value:!0});QO.default=void 0;var $Pe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"referrer [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},HPe=$Pe;QO.default=HPe;var ZO={};Object.defineProperty(ZO,"__esModule",{value:!0});ZO.default=void 0;var VPe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"EPUB biblioentry [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-bibliography"],requiredContextRole:["doc-bibliography"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]},zPe=VPe;ZO.default=zPe;var ek={};Object.defineProperty(ek,"__esModule",{value:!0});ek.default=void 0;var GPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"bibliography [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-biblioentry"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},WPe=GPe;ek.default=WPe;var tk={};Object.defineProperty(tk,"__esModule",{value:!0});tk.default=void 0;var qPe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"biblioref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},KPe=qPe;tk.default=KPe;var nk={};Object.defineProperty(nk,"__esModule",{value:!0});nk.default=void 0;var YPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"chapter [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},XPe=YPe;nk.default=XPe;var rk={};Object.defineProperty(rk,"__esModule",{value:!0});rk.default=void 0;var JPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"colophon [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},QPe=JPe;rk.default=QPe;var ik={};Object.defineProperty(ik,"__esModule",{value:!0});ik.default=void 0;var ZPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"conclusion [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},eDe=ZPe;ik.default=eDe;var sk={};Object.defineProperty(sk,"__esModule",{value:!0});sk.default=void 0;var tDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"cover [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]},nDe=tDe;sk.default=nDe;var ok={};Object.defineProperty(ok,"__esModule",{value:!0});ok.default=void 0;var rDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credit [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},iDe=rDe;ok.default=iDe;var ak={};Object.defineProperty(ak,"__esModule",{value:!0});ak.default=void 0;var sDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credits [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},oDe=sDe;ak.default=oDe;var ck={};Object.defineProperty(ck,"__esModule",{value:!0});ck.default=void 0;var aDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"dedication [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},cDe=aDe;ck.default=cDe;var lk={};Object.defineProperty(lk,"__esModule",{value:!0});lk.default=void 0;var lDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-endnotes"],requiredContextRole:["doc-endnotes"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]},uDe=lDe;lk.default=uDe;var uk={};Object.defineProperty(uk,"__esModule",{value:!0});uk.default=void 0;var dDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnotes [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-endnote"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},hDe=dDe;uk.default=hDe;var dk={};Object.defineProperty(dk,"__esModule",{value:!0});dk.default=void 0;var fDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epigraph [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},pDe=fDe;dk.default=pDe;var hk={};Object.defineProperty(hk,"__esModule",{value:!0});hk.default=void 0;var mDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epilogue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},gDe=mDe;hk.default=gDe;var fk={};Object.defineProperty(fk,"__esModule",{value:!0});fk.default=void 0;var vDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"errata [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},_De=vDe;fk.default=_De;var pk={};Object.defineProperty(pk,"__esModule",{value:!0});pk.default=void 0;var yDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},bDe=yDe;pk.default=bDe;var mk={};Object.defineProperty(mk,"__esModule",{value:!0});mk.default=void 0;var EDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"footnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},SDe=EDe;mk.default=SDe;var gk={};Object.defineProperty(gk,"__esModule",{value:!0});gk.default=void 0;var TDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"foreword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},wDe=TDe;gk.default=wDe;var vk={};Object.defineProperty(vk,"__esModule",{value:!0});vk.default=void 0;var xDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossary [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["definition"],["term"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},CDe=xDe;vk.default=CDe;var _k={};Object.defineProperty(_k,"__esModule",{value:!0});_k.default=void 0;var RDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},ADe=RDe;_k.default=ADe;var yk={};Object.defineProperty(yk,"__esModule",{value:!0});yk.default=void 0;var MDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"index [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},IDe=MDe;yk.default=IDe;var bk={};Object.defineProperty(bk,"__esModule",{value:!0});bk.default=void 0;var ODe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"introduction [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},kDe=ODe;bk.default=kDe;var Ek={};Object.defineProperty(Ek,"__esModule",{value:!0});Ek.default=void 0;var NDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"noteref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},PDe=NDe;Ek.default=PDe;var Sk={};Object.defineProperty(Sk,"__esModule",{value:!0});Sk.default=void 0;var DDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"notice [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]},LDe=DDe;Sk.default=LDe;var Tk={};Object.defineProperty(Tk,"__esModule",{value:!0});Tk.default=void 0;var UDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"pagebreak [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","separator"]]},FDe=UDe;Tk.default=FDe;var wk={};Object.defineProperty(wk,"__esModule",{value:!0});wk.default=void 0;var BDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"page-list [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},jDe=BDe;wk.default=jDe;var xk={};Object.defineProperty(xk,"__esModule",{value:!0});xk.default=void 0;var $De={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"part [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},HDe=$De;xk.default=HDe;var Ck={};Object.defineProperty(Ck,"__esModule",{value:!0});Ck.default=void 0;var VDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"preface [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},zDe=VDe;Ck.default=zDe;var Rk={};Object.defineProperty(Rk,"__esModule",{value:!0});Rk.default=void 0;var GDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"prologue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},WDe=GDe;Rk.default=WDe;var Ak={};Object.defineProperty(Ak,"__esModule",{value:!0});Ak.default=void 0;var qDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"pullquote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["none"]]},KDe=qDe;Ak.default=KDe;var Mk={};Object.defineProperty(Mk,"__esModule",{value:!0});Mk.default=void 0;var YDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"qna [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},XDe=YDe;Mk.default=XDe;var Ik={};Object.defineProperty(Ik,"__esModule",{value:!0});Ik.default=void 0;var JDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"subtitle [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"]]},QDe=JDe;Ik.default=QDe;var Ok={};Object.defineProperty(Ok,"__esModule",{value:!0});Ok.default=void 0;var ZDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"help [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]},eLe=ZDe;Ok.default=eLe;var kk={};Object.defineProperty(kk,"__esModule",{value:!0});kk.default=void 0;var tLe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"toc [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},nLe=tLe;kk.default=nLe;Object.defineProperty(qO,"__esModule",{value:!0});qO.default=void 0;var rLe=ei(KO),iLe=ei(YO),sLe=ei(XO),oLe=ei(JO),aLe=ei(QO),cLe=ei(ZO),lLe=ei(ek),uLe=ei(tk),dLe=ei(nk),hLe=ei(rk),fLe=ei(ik),pLe=ei(sk),mLe=ei(ok),gLe=ei(ak),vLe=ei(ck),_Le=ei(lk),yLe=ei(uk),bLe=ei(dk),ELe=ei(hk),SLe=ei(fk),TLe=ei(pk),wLe=ei(mk),xLe=ei(gk),CLe=ei(vk),RLe=ei(_k),ALe=ei(yk),MLe=ei(bk),ILe=ei(Ek),OLe=ei(Sk),kLe=ei(Tk),NLe=ei(wk),PLe=ei(xk),DLe=ei(Ck),LLe=ei(Rk),ULe=ei(Ak),FLe=ei(Mk),BLe=ei(Ik),jLe=ei(Ok),$Le=ei(kk);function ei(t){return t&&t.__esModule?t:{default:t}}var HLe=[["doc-abstract",rLe.default],["doc-acknowledgments",iLe.default],["doc-afterword",sLe.default],["doc-appendix",oLe.default],["doc-backlink",aLe.default],["doc-biblioentry",cLe.default],["doc-bibliography",lLe.default],["doc-biblioref",uLe.default],["doc-chapter",dLe.default],["doc-colophon",hLe.default],["doc-conclusion",fLe.default],["doc-cover",pLe.default],["doc-credit",mLe.default],["doc-credits",gLe.default],["doc-dedication",vLe.default],["doc-endnote",_Le.default],["doc-endnotes",yLe.default],["doc-epigraph",bLe.default],["doc-epilogue",ELe.default],["doc-errata",SLe.default],["doc-example",TLe.default],["doc-footnote",wLe.default],["doc-foreword",xLe.default],["doc-glossary",CLe.default],["doc-glossref",RLe.default],["doc-index",ALe.default],["doc-introduction",MLe.default],["doc-noteref",ILe.default],["doc-notice",OLe.default],["doc-pagebreak",kLe.default],["doc-pagelist",NLe.default],["doc-part",PLe.default],["doc-preface",DLe.default],["doc-prologue",LLe.default],["doc-pullquote",ULe.default],["doc-qna",FLe.default],["doc-subtitle",BLe.default],["doc-tip",jLe.default],["doc-toc",$Le.default]],VLe=HLe;qO.default=VLe;var Nk={},Pk={};Object.defineProperty(Pk,"__esModule",{value:!0});Pk.default=void 0;var zLe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-object"}},{module:"ARIA",concept:{name:"img"}},{module:"ARIA",concept:{name:"article"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]},GLe=zLe;Pk.default=GLe;var Dk={};Object.defineProperty(Dk,"__esModule",{value:!0});Dk.default=void 0;var WLe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-document"}},{module:"ARIA",concept:{name:"group"}},{module:"ARIA",concept:{name:"img"}},{module:"GRAPHICS",concept:{name:"graphics-symbol"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]},qLe=WLe;Dk.default=qLe;var Lk={};Object.defineProperty(Lk,"__esModule",{value:!0});Lk.default=void 0;var KLe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]},YLe=KLe;Lk.default=YLe;Object.defineProperty(Nk,"__esModule",{value:!0});Nk.default=void 0;var XLe=$3(Pk),JLe=$3(Dk),QLe=$3(Lk);function $3(t){return t&&t.__esModule?t:{default:t}}var ZLe=[["graphics-document",XLe.default],["graphics-object",JLe.default],["graphics-symbol",QLe.default]],e2e=ZLe;Nk.default=e2e;Object.defineProperty(pS,"__esModule",{value:!0});pS.default=void 0;var t2e=ux(iI),n2e=ux(vI),r2e=ux(qO),i2e=ux(Nk),s2e=ux(wy);function ux(t){return t&&t.__esModule?t:{default:t}}function o2e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function CU(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=JX(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function bT(t,e){return l2e(t)||c2e(t,e)||JX(t,e)||a2e()}function a2e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JX(t,e){if(t){if(typeof t=="string")return dV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dV(t,e)}}function dV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c2e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function l2e(t){if(Array.isArray(t))return t}var Lv=[].concat(t2e.default,n2e.default,r2e.default,i2e.default);Lv.forEach(function(t){var e=bT(t,2),n=e[1],r=CU(n.superClass),i;try{for(r.s();!(i=r.n()).done;){var s=i.value,o=CU(s),a;try{var c=function(){var u=a.value,d=Lv.find(function(y){var E=bT(y,1),w=E[0];return w===u});if(d)for(var h=d[1],p=0,f=Object.keys(h.props);p<f.length;p++){var g=f[p];Object.prototype.hasOwnProperty.call(n.props,g)||Object.assign(n.props,o2e({},g,h.props[g]))}};for(o.s();!(a=o.n()).done;)c()}catch(l){o.e(l)}finally{o.f()}}}catch(l){r.e(l)}finally{r.f()}});var RU={entries:function(){return Lv},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=CU(Lv),i;try{for(r.s();!(i=r.n()).done;){var s=bT(i.value,2),o=s[0],a=s[1];e.call(n,a,o,Lv)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=Lv.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!RU.get(e)},keys:function(){return Lv.map(function(e){var n=bT(e,1),r=n[0];return r})},values:function(){return Lv.map(function(e){var n=bT(e,2),r=n[1];return r})}},u2e=(0,s2e.default)(RU,RU.entries());pS.default=u2e;var Uk={},QX={},hV=Object.prototype.hasOwnProperty;function AU(t,e){var n,r;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&AU(t[r],e[r]););return r===-1}if(!n||typeof t=="object"){r=0;for(n in t)if(hV.call(t,n)&&++r&&!hV.call(e,n)||!(n in e)||!AU(t[n],e[n]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}QX.dequal=AU;Object.defineProperty(Uk,"__esModule",{value:!0});Uk.default=void 0;var ZX=QX,d2e=tJ(wy),eJ=tJ(pS);function tJ(t){return t&&t.__esModule?t:{default:t}}function nD(t,e){return p2e(t)||f2e(t,e)||nJ(t,e)||h2e()}function h2e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f2e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function p2e(t){if(Array.isArray(t))return t}function m2e(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=nJ(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function nJ(t,e){if(t){if(typeof t=="string")return fV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fV(t,e)}}function fV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Uv=[],pV=eJ.default.keys();for(var rD=0;rD<pV.length;rD++){var iD=pV[rD],sD=eJ.default.get(iD);if(sD)for(var mV=[].concat(sD.baseConcepts,sD.relatedConcepts),oD=0;oD<mV.length;oD++){var gV=mV[oD];gV.module==="HTML"&&function(){var t=gV.concept;if(t){var e=Uv.find(function(s){return(0,ZX.dequal)(s,t)}),n;e?n=e[1]:n=[];for(var r=!0,i=0;i<n.length;i++)if(n[i]===iD){r=!1;break}r&&n.push(iD),Uv.push([t,n])}}()}}var MU={entries:function(){return Uv},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=m2e(Uv),i;try{for(r.s();!(i=r.n()).done;){var s=nD(i.value,2),o=s[0],a=s[1];e.call(n,a,o,Uv)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=Uv.find(function(r){return e.name===r[0].name&&(0,ZX.dequal)(e.attributes,r[0].attributes)});return n&&n[1]},has:function(e){return!!MU.get(e)},keys:function(){return Uv.map(function(e){var n=nD(e,1),r=n[0];return r})},values:function(){return Uv.map(function(e){var n=nD(e,2),r=n[1];return r})}},g2e=(0,d2e.default)(MU,MU.entries());Uk.default=g2e;var Fk={};Object.defineProperty(Fk,"__esModule",{value:!0});Fk.default=void 0;var v2e=iJ(wy),rJ=iJ(pS);function iJ(t){return t&&t.__esModule?t:{default:t}}function aD(t,e){return b2e(t)||y2e(t,e)||sJ(t,e)||_2e()}function _2e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y2e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function b2e(t){if(Array.isArray(t))return t}function E2e(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=sJ(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function sJ(t,e){if(t){if(typeof t=="string")return vV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vV(t,e)}}function vV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var T0=[],_V=rJ.default.keys();for(var cD=0;cD<_V.length;cD++){var yV=_V[cD],lD=rJ.default.get(yV),uD=[];if(lD){for(var bV=[].concat(lD.baseConcepts,lD.relatedConcepts),dD=0;dD<bV.length;dD++){var EV=bV[dD];if(EV.module==="HTML"){var SV=EV.concept;SV!=null&&uD.push(SV)}}uD.length>0&&T0.push([yV,uD])}}var IU={entries:function(){return T0},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=E2e(T0),i;try{for(r.s();!(i=r.n()).done;){var s=aD(i.value,2),o=s[0],a=s[1];e.call(n,a,o,T0)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=T0.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!IU.get(e)},keys:function(){return T0.map(function(e){var n=aD(e,1),r=n[0];return r})},values:function(){return T0.map(function(e){var n=aD(e,2),r=n[1];return r})}},S2e=(0,v2e.default)(IU,IU.entries());Fk.default=S2e;Object.defineProperty(Nh,"__esModule",{value:!0});var xh=Nh.roles=aJ=Nh.roleElements=oJ=Nh.elementRoles=Nh.dom=Nh.aria=void 0,T2e=dx(tI),w2e=dx(rI),x2e=dx(pS),C2e=dx(Uk),R2e=dx(Fk);function dx(t){return t&&t.__esModule?t:{default:t}}var A2e=T2e.default;Nh.aria=A2e;var M2e=w2e.default;Nh.dom=M2e;var I2e=x2e.default;xh=Nh.roles=I2e;var O2e=C2e.default,oJ=Nh.elementRoles=O2e,k2e=R2e.default,aJ=Nh.roleElements=k2e,H3={exports:{}};H3.exports;(function(t){var e=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(c,l){if(!s[c]){s[c]={};for(var u=0;u<c.length;u++)s[c][c.charAt(u)]=u}return s[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(u){return r.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return o(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),u=new Uint8Array(l.length*2),d=0,h=l.length;d<h;d++){var p=l.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),u=0,d=l.length;u<d;u++)l[u]=c[u*2]*256+c[u*2+1];var h=[];return l.forEach(function(p){h.push(n(p))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return i.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return o(i,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return n(l)})},_compress:function(c,l,u){if(c==null)return"";var d,h,p={},f={},g="",y="",E="",w=2,R=3,A=2,k=[],I=0,N=0,U;for(U=0;U<c.length;U+=1)if(g=c.charAt(U),Object.prototype.hasOwnProperty.call(p,g)||(p[g]=R++,f[g]=!0),y=E+g,Object.prototype.hasOwnProperty.call(p,y))E=y;else{if(Object.prototype.hasOwnProperty.call(f,E)){if(E.charCodeAt(0)<256){for(d=0;d<A;d++)I=I<<1,N==l-1?(N=0,k.push(u(I)),I=0):N++;for(h=E.charCodeAt(0),d=0;d<8;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1}else{for(h=1,d=0;d<A;d++)I=I<<1|h,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=0;for(h=E.charCodeAt(0),d=0;d<16;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1}w--,w==0&&(w=Math.pow(2,A),A++),delete f[E]}else for(h=p[E],d=0;d<A;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1;w--,w==0&&(w=Math.pow(2,A),A++),p[y]=R++,E=String(g)}if(E!==""){if(Object.prototype.hasOwnProperty.call(f,E)){if(E.charCodeAt(0)<256){for(d=0;d<A;d++)I=I<<1,N==l-1?(N=0,k.push(u(I)),I=0):N++;for(h=E.charCodeAt(0),d=0;d<8;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1}else{for(h=1,d=0;d<A;d++)I=I<<1|h,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=0;for(h=E.charCodeAt(0),d=0;d<16;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1}w--,w==0&&(w=Math.pow(2,A),A++),delete f[E]}else for(h=p[E],d=0;d<A;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1;w--,w==0&&(w=Math.pow(2,A),A++)}for(h=2,d=0;d<A;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1;for(;;)if(I=I<<1,N==l-1){k.push(u(I));break}else N++;return k.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var d=[],h=4,p=4,f=3,g="",y=[],E,w,R,A,k,I,N,U={val:u(0),position:l,index:1};for(E=0;E<3;E+=1)d[E]=E;for(R=0,k=Math.pow(2,2),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),R|=(A>0?1:0)*I,I<<=1;switch(R){case 0:for(R=0,k=Math.pow(2,8),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),R|=(A>0?1:0)*I,I<<=1;N=n(R);break;case 1:for(R=0,k=Math.pow(2,16),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),R|=(A>0?1:0)*I,I<<=1;N=n(R);break;case 2:return""}for(d[3]=N,w=N,y.push(N);;){if(U.index>c)return"";for(R=0,k=Math.pow(2,f),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),R|=(A>0?1:0)*I,I<<=1;switch(N=R){case 0:for(R=0,k=Math.pow(2,8),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),R|=(A>0?1:0)*I,I<<=1;d[p++]=n(R),N=p-1,h--;break;case 1:for(R=0,k=Math.pow(2,16),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),R|=(A>0?1:0)*I,I<<=1;d[p++]=n(R),N=p-1,h--;break;case 2:return y.join("")}if(h==0&&(h=Math.pow(2,f),f++),d[N])g=d[N];else if(N===p)g=w+w.charAt(0);else return null;y.push(g),d[p++]=w+g.charAt(0),h--,w=g,h==0&&(h=Math.pow(2,f),f++)}}};return a}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(H3);var N2e=H3.exports;const P2e=Nl(N2e);var OU={};function cJ(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}const D2e=(t,e,n,r,i,s,o)=>{const a=r+n.indent,c=n.colors;return t.map(l=>{const u=e[l];let d=o(u,n,a,i,s);return typeof u!="string"&&(d.indexOf(`
`)!==-1&&(d=n.spacingOuter+a+d+n.spacingOuter+r),d="{"+d+"}"),n.spacingInner+r+c.prop.open+l+c.prop.close+"="+c.value.open+d+c.value.close}).join("")},L2e=3,U2e=(t,e,n,r,i,s)=>t.map(o=>{const a=typeof o=="string"?lJ(o,e):s(o,e,n,r,i);return a===""&&typeof o=="object"&&o!==null&&o.nodeType!==L2e?"":e.spacingOuter+n+a}).join(""),lJ=(t,e)=>{const n=e.colors.content;return n.open+cJ(t)+n.close},F2e=(t,e)=>{const n=e.colors.comment;return n.open+"<!--"+cJ(t)+"-->"+n.close},B2e=(t,e,n,r,i)=>{const s=r.colors.tag;return s.open+"<"+t+(e&&s.close+e+r.spacingOuter+i+s.open)+(n?">"+s.close+n+r.spacingOuter+i+s.open+"</"+t:(e&&!r.min?"":" ")+"/")+">"+s.close},j2e=(t,e)=>{const n=e.colors.tag;return n.open+"<"+t+n.close+" …"+n.open+" />"+n.close},$2e=1,uJ=3,dJ=8,hJ=11,H2e=/^((HTML|SVG)\w*)?Element$/,fJ=t=>{const{tagName:e}=t;return!!(typeof e=="string"&&e.includes("-")||typeof t.hasAttribute=="function"&&t.hasAttribute("is"))},V2e=t=>{const e=t.constructor.name,{nodeType:n}=t;return n===$2e&&(H2e.test(e)||fJ(t))||n===uJ&&e==="Text"||n===dJ&&e==="Comment"||n===hJ&&e==="DocumentFragment"};function z2e(t){return t.nodeType===uJ}function G2e(t){return t.nodeType===dJ}function hD(t){return t.nodeType===hJ}function W2e(t){return{test:e=>{var n;return((e==null||(n=e.constructor)==null?void 0:n.name)||fJ(e))&&V2e(e)},serialize:(e,n,r,i,s,o)=>{if(z2e(e))return lJ(e.data,n);if(G2e(e))return F2e(e.data,n);const a=hD(e)?"DocumentFragment":e.tagName.toLowerCase();return++i>n.maxDepth?j2e(a,n):B2e(a,D2e(hD(e)?[]:Array.from(e.attributes).map(c=>c.name).sort(),hD(e)?{}:Array.from(e.attributes).reduce((c,l)=>(c[l.name]=l.value,c),{}),n,r+n.indent,i,s,o),U2e(Array.prototype.slice.call(e.childNodes||e.children).filter(t),n,r+n.indent,i,s,o),n,r)}}}let pJ=null,V3=null,z3=null;try{const t=ic&&ic.require;V3=t.call(ic,"fs").readFileSync,z3=t.call(ic,"@babel/code-frame").codeFrameColumns,pJ=t.call(ic,"chalk")}catch{}function q2e(t){const e=t.indexOf("(")+1,n=t.indexOf(")"),r=t.slice(e,n),i=r.split(":"),[s,o,a]=[i[0],parseInt(i[1],10),parseInt(i[2],10)];let c="";try{c=V3(s,"utf-8")}catch{return""}const l=z3(c,{start:{line:o,column:a}},{highlightCode:!0,linesBelow:0});return pJ.dim(r)+`
`+l+`
`}function K2e(){if(!V3||!z3)return"";const e=new Error().stack.split(`
`).slice(1).find(n=>!n.includes("node_modules/"));return q2e(e)}const mJ=3;function fD(){return typeof jest<"u"&&jest!==null?setTimeout._isMockFunction===!0||Object.prototype.hasOwnProperty.call(setTimeout,"clock"):!1}function G3(){if(typeof window>"u")throw new Error("Could not find default container");return window.document}function Y2e(t){if(t.defaultView)return t.defaultView;if(t.ownerDocument&&t.ownerDocument.defaultView)return t.ownerDocument.defaultView;if(t.window)return t.window;throw t.ownerDocument&&t.ownerDocument.defaultView===null?new Error("It looks like the window object is not available for the provided node."):t.then instanceof Function?new Error("It looks like you passed a Promise object instead of a DOM node. Did you do something like `fireEvent.click(screen.findBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`, or await the findBy query `fireEvent.click(await screen.findBy...`?"):Array.isArray(t)?new Error("It looks like you passed an Array instead of a DOM node. Did you do something like `fireEvent.click(screen.getAllBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`?"):typeof t.debug=="function"&&typeof t.logTestingPlaygroundURL=="function"?new Error("It looks like you passed a `screen` object. Did you do something like `fireEvent.click(screen, ...` when you meant to use a query, e.g. `fireEvent.click(screen.getBy..., `?"):new Error("The given node is not an Element, the node type is: "+typeof t+".")}function Ag(t){if(!t||typeof t.querySelector!="function"||typeof t.querySelectorAll!="function")throw new TypeError("Expected container to be an Element, a Document or a DocumentFragment but got "+e(t)+".");function e(n){return typeof n=="object"?n===null?"null":n.constructor.name:typeof n}}const X2e=()=>{if(typeof Bn>"u")return!1;let t;try{var e;const n=(e=OU)==null?void 0:e.COLORS;n&&(t=JSON.parse(n))}catch{}return typeof t=="boolean"?t:Bn.versions!==void 0&&Bn.versions.node!==void 0},{DOMCollection:J2e}=MX,Q2e=1,Z2e=8;function eUe(t){return t.nodeType!==Z2e&&(t.nodeType!==Q2e||!t.matches(ji().defaultIgnore))}function rA(t,e,n){if(n===void 0&&(n={}),t||(t=G3().body),typeof e!="number"&&(e=typeof Bn<"u"&&typeof OU<"u"&&OU.DEBUG_PRINT_LIMIT||7e3),e===0)return"";t.documentElement&&(t=t.documentElement);let r=typeof t;if(r==="object"?r=t.constructor.name:t={},!("outerHTML"in t))throw new TypeError("Expected an element or document but got "+r);const{filterNode:i=eUe,...s}=n,o=PRe(t,{plugins:[W2e(i),J2e],printFunctionName:!1,highlight:X2e(),...s});return e!==void 0&&t.outerHTML.length>e?o.slice(0,e)+"...":o}const TV=function(){const t=K2e();console.log(t?rA(...arguments)+`

`+t:rA(...arguments))};let iA={testIdAttribute:"data-testid",asyncUtilTimeout:1e3,asyncWrapper:t=>t(),unstable_advanceTimersWrapper:t=>t(),eventWrapper:t=>t(),defaultHidden:!1,defaultIgnore:"script, style",showOriginalStackTrace:!1,throwSuggestions:!1,getElementError(t,e){const n=rA(e),r=new Error([t,"Ignored nodes: comments, "+iA.defaultIgnore+`
`+n].filter(Boolean).join(`

`));return r.name="TestingLibraryElementError",r},_disableExpensiveErrorDiagnostics:!1,computedStyleSupportsPseudoElements:!1};function tUe(t){try{return iA._disableExpensiveErrorDiagnostics=!0,t()}finally{iA._disableExpensiveErrorDiagnostics=!1}}function ji(){return iA}const nUe=["button","meter","output","progress","select","textarea","input"];function gJ(t){return nUe.includes(t.nodeName.toLowerCase())?"":t.nodeType===mJ?t.textContent:Array.from(t.childNodes).map(e=>gJ(e)).join("")}function kU(t){let e;return t.tagName.toLowerCase()==="label"?e=gJ(t):e=t.value||t.textContent,e}function vJ(t){if(t.labels!==void 0){var e;return(e=t.labels)!=null?e:[]}if(!rUe(t))return[];const n=t.ownerDocument.querySelectorAll("label");return Array.from(n).filter(r=>r.control===t)}function rUe(t){return/BUTTON|METER|OUTPUT|PROGRESS|SELECT|TEXTAREA/.test(t.tagName)||t.tagName==="INPUT"&&t.getAttribute("type")!=="hidden"}function _J(t,e,n){let{selector:r="*"}=n===void 0?{}:n;const i=e.getAttribute("aria-labelledby"),s=i?i.split(" "):[];return s.length?s.map(o=>{const a=t.querySelector('[id="'+o+'"]');return a?{content:kU(a),formControl:null}:{content:"",formControl:null}}):Array.from(vJ(e)).map(o=>{const a=kU(o),l=Array.from(o.querySelectorAll("button, input, meter, output, progress, select, textarea")).filter(u=>u.matches(r))[0];return{content:a,formControl:l}})}function yJ(t){if(t==null)throw new Error("It looks like "+t+" was passed instead of a matcher. Did you do something like getByText("+t+")?")}function mS(t,e,n,r){if(typeof t!="string")return!1;yJ(n);const i=r(t);return typeof n=="string"||typeof n=="number"?i.toLowerCase().includes(n.toString().toLowerCase()):typeof n=="function"?n(i,e):EJ(n,i)}function ig(t,e,n,r){if(typeof t!="string")return!1;yJ(n);const i=r(t);return n instanceof Function?n(i,e):n instanceof RegExp?EJ(n,i):i===String(n)}function bJ(t){let{trim:e=!0,collapseWhitespace:n=!0}=t===void 0?{}:t;return r=>{let i=r;return i=e?i.trim():i,i=n?i.replace(/\s+/g," "):i,i}}function xy(t){let{trim:e,collapseWhitespace:n,normalizer:r}=t;if(!r)return bJ({trim:e,collapseWhitespace:n});if(typeof e<"u"||typeof n<"u")throw new Error('trim and collapseWhitespace are not supported with a normalizer. If you want to use the default trim and collapseWhitespace logic in your normalizer, use "getDefaultNormalizer({trim, collapseWhitespace})" and compose that into your normalizer');return r}function EJ(t,e){const n=t.test(e);return t.global&&t.lastIndex!==0&&(console.warn("To match all elements we had to reset the lastIndex of the RegExp because the global flag is enabled. We encourage to remove the global flag from the RegExp."),t.lastIndex=0),n}function Bk(t){return t.matches("input[type=submit], input[type=button], input[type=reset]")?t.value:Array.from(t.childNodes).filter(e=>e.nodeType===mJ&&!!e.textContent).map(e=>e.textContent).join("")}const iUe=sUe(oJ);function SJ(t){return t.hidden===!0||t.getAttribute("aria-hidden")==="true"||t.ownerDocument.defaultView.getComputedStyle(t).display==="none"}function W3(t,e){e===void 0&&(e={});const{isSubtreeInaccessible:n=SJ}=e;if(t.ownerDocument.defaultView.getComputedStyle(t).visibility==="hidden")return!0;let i=t;for(;i;){if(n(i))return!0;i=i.parentElement}return!1}function q3(t){for(const{match:e,roles:n}of iUe)if(e(t))return[...n];return[]}function sUe(t){function e(o){let{name:a,attributes:c}=o;return""+a+c.map(l=>{let{name:u,value:d,constraints:h=[]}=l;const p=h.indexOf("undefined")!==-1,f=h.indexOf("set")!==-1;return typeof d<"u"?"["+u+'="'+d+'"]':p?":not(["+u+"])":f?"["+u+"]:not(["+u+'=""])':"["+u+"]"}).join("")}function n(o){let{attributes:a=[]}=o;return a.length}function r(o,a){let{specificity:c}=o,{specificity:l}=a;return l-c}function i(o){let{attributes:a=[]}=o;const c=a.findIndex(u=>u.value&&u.name==="type"&&u.value==="text");c>=0&&(a=[...a.slice(0,c),...a.slice(c+1)]);const l=e({...o,attributes:a});return u=>c>=0&&u.type!=="text"?!1:u.matches(l)}let s=[];for(const[o,a]of t.entries())s=[...s,{match:i(o),roles:Array.from(a),specificity:n(o)}];return s.sort(r)}function oUe(t,e){let{hidden:n=!1}=e===void 0?{}:e;function r(i){return[i,...Array.from(i.children).reduce((s,o)=>[...s,...r(o)],[])]}return r(t).filter(i=>n===!1?W3(i)===!1:!0).reduce((i,s)=>{let o=[];return s.hasAttribute("role")?o=s.getAttribute("role").split(" ").slice(0,1):o=q3(s),o.reduce((a,c)=>Array.isArray(a[c])?{...a,[c]:[...a[c],s]}:{...a,[c]:[s]},i)},{})}function aUe(t,e){let{hidden:n,includeDescription:r}=e;const i=oUe(t,{hidden:n});return Object.entries(i).filter(s=>{let[o]=s;return o!=="generic"}).map(s=>{let[o,a]=s;const c="-".repeat(50),l=a.map(u=>{const d='Name "'+j3(u,{computedStyleSupportsPseudoElements:ji().computedStyleSupportsPseudoElements})+`":
`,h=rA(u.cloneNode(!1));if(r){const p='Description "'+KX(u,{computedStyleSupportsPseudoElements:ji().computedStyleSupportsPseudoElements})+`":
`;return""+d+p+h}return""+d+h}).join(`

`);return o+`:

`+l+`

`+c}).join(`
`)}function cUe(t){return t.tagName==="OPTION"?t.selected:hx(t,"aria-selected")}function lUe(t){return t.getAttribute("aria-busy")==="true"}function uUe(t){if(!("indeterminate"in t&&t.indeterminate))return"checked"in t?t.checked:hx(t,"aria-checked")}function dUe(t){return hx(t,"aria-pressed")}function hUe(t){var e,n;return(e=(n=hx(t,"aria-current"))!=null?n:t.getAttribute("aria-current"))!=null?e:!1}function fUe(t){return hx(t,"aria-expanded")}function hx(t,e){const n=t.getAttribute(e);if(n==="true")return!0;if(n==="false")return!1}function pUe(t){const e={H1:1,H2:2,H3:3,H4:4,H5:5,H6:6};return t.getAttribute("aria-level")&&Number(t.getAttribute("aria-level"))||e[t.tagName]}function mUe(t){const e=t.getAttribute("aria-valuenow");return e===null?void 0:+e}function gUe(t){const e=t.getAttribute("aria-valuemax");return e===null?void 0:+e}function vUe(t){const e=t.getAttribute("aria-valuemin");return e===null?void 0:+e}function _Ue(t){const e=t.getAttribute("aria-valuetext");return e===null?void 0:e}const wV=bJ();function yUe(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function xV(t){return new RegExp(yUe(t.toLowerCase()),"i")}function yv(t,e,n,r){let{variant:i,name:s}=r,o="";const a={},c=[["Role","TestId"].includes(t)?n:xV(n)];s&&(a.name=xV(s)),t==="Role"&&W3(e)&&(a.hidden=!0,o=`Element is inaccessible. This means that the element and all its children are invisible to screen readers.
    If you are using the aria-hidden prop, make sure this is the right choice for your case.
    `),Object.keys(a).length>0&&c.push(a);const l=i+"By"+t;return{queryName:t,queryMethod:l,queryArgs:c,variant:i,warning:o,toString(){o&&console.warn(o);let[u,d]=c;return u=typeof u=="string"?"'"+u+"'":u,d=d?", { "+Object.entries(d).map(h=>{let[p,f]=h;return p+": "+f}).join(", ")+" }":"",l+"("+u+d+")"}}}function bv(t,e,n){return n&&!e}function NU(t,e,n){var r,i;if(e===void 0&&(e="get"),t.matches(ji().defaultIgnore))return;const s=(r=t.getAttribute("role"))!=null?r:(i=q3(t))==null?void 0:i[0];if(s!=="generic"&&bv("Role",n,s))return yv("Role",t,s,{variant:e,name:j3(t,{computedStyleSupportsPseudoElements:ji().computedStyleSupportsPseudoElements})});const o=_J(document,t).map(h=>h.content).join(" ");if(bv("LabelText",n,o))return yv("LabelText",t,o,{variant:e});const a=t.getAttribute("placeholder");if(bv("PlaceholderText",n,a))return yv("PlaceholderText",t,a,{variant:e});const c=wV(Bk(t));if(bv("Text",n,c))return yv("Text",t,c,{variant:e});if(bv("DisplayValue",n,t.value))return yv("DisplayValue",t,wV(t.value),{variant:e});const l=t.getAttribute("alt");if(bv("AltText",n,l))return yv("AltText",t,l,{variant:e});const u=t.getAttribute("title");if(bv("Title",n,u))return yv("Title",t,u,{variant:e});const d=t.getAttribute(ji().testIdAttribute);if(bv("TestId",n,d))return yv("TestId",t,d,{variant:e})}function q1(t,e){t.stack=e.stack.replace(e.message,t.message)}function bUe(t,e){let{container:n=G3(),timeout:r=ji().asyncUtilTimeout,showOriginalStackTrace:i=ji().showOriginalStackTrace,stackTraceError:s,interval:o=50,onTimeout:a=l=>(Object.defineProperty(l,"message",{value:ji().getElementError(l.message,n).message}),l),mutationObserverOptions:c={subtree:!0,childList:!0,attributes:!0,characterData:!0}}=e;if(typeof t!="function")throw new TypeError("Received `callback` arg must be a function");return new Promise(async(l,u)=>{let d,h,p,f=!1,g="idle";const y=setTimeout(k,r),E=fD();if(E){const{unstable_advanceTimersWrapper:I}=ji();for(A();!f;){if(!fD()){const N=new Error("Changed from using fake timers to real timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to real timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");i||q1(N,s),u(N);return}if(await I(async()=>{jest.advanceTimersByTime(o)}),f)break;A()}}else{try{Ag(n)}catch(N){u(N);return}h=setInterval(R,o);const{MutationObserver:I}=Y2e(n);p=new I(R),p.observe(n,c),A()}function w(I,N){f=!0,clearTimeout(y),E||(clearInterval(h),p.disconnect()),I?u(I):l(N)}function R(){if(fD()){const I=new Error("Changed from using real timers to fake timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to fake timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");return i||q1(I,s),u(I)}else return A()}function A(){if(g!=="pending")try{const I=tUe(t);typeof(I==null?void 0:I.then)=="function"?(g="pending",I.then(N=>{g="resolved",w(null,N)},N=>{g="rejected",d=N})):w(null,I)}catch(I){d=I}}function k(){let I;d?(I=d,!i&&I.name==="TestingLibraryElementError"&&q1(I,s)):(I=new Error("Timed out in waitFor."),i||q1(I,s)),w(a(I),null)}})}function EUe(t,e){const n=new Error("STACK_TRACE_MESSAGE");return ji().asyncWrapper(()=>bUe(t,{stackTraceError:n,...e}))}function TJ(t,e){return ji().getElementError(t,e)}function SUe(t,e){return TJ(t+"\n\n(If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).",e)}function jk(t,e,n,r){let{exact:i=!0,collapseWhitespace:s,trim:o,normalizer:a}=r===void 0?{}:r;const c=i?ig:mS,l=xy({collapseWhitespace:s,trim:o,normalizer:a});return Array.from(e.querySelectorAll("["+t+"]")).filter(u=>c(u.getAttribute(t),u,n,l))}function sA(t,e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];const o=t(n,...i);if(o.length>1){const a=o.map(c=>TJ(null,c).message).join(`

`);throw SUe(e(n,...i)+`

Here are the matching elements:

`+a,n)}return o[0]||null}}function wJ(t,e){return ji().getElementError(`A better query is available, try this:
`+t.toString()+`
`,e)}function TUe(t,e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];const o=t(n,...i);if(!o.length)throw ji().getElementError(e(n,...i),n);return o}}function oA(t){return(e,n,r,i)=>EUe(()=>t(e,n,r),{container:e,...i})}const lE=(t,e,n)=>function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];const a=t(r,...s),[{suggest:c=ji().throwSuggestions}={}]=s.slice(-1);if(a&&c){const l=NU(a,n);if(l&&!e.endsWith(l.queryName))throw wJ(l.toString(),r)}return a},jd=(t,e,n)=>function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];const a=t(r,...s),[{suggest:c=ji().throwSuggestions}={}]=s.slice(-1);if(a.length&&c){const l=[...new Set(a.map(u=>{var d;return(d=NU(u,n))==null?void 0:d.toString()}))];if(l.length===1&&!e.endsWith(NU(a[0],n).queryName))throw wJ(l[0],r)}return a};function Cy(t,e,n){const r=lE(sA(t,e),t.name,"query"),i=TUe(t,n),s=sA(i,e),o=lE(s,t.name,"get"),a=jd(i,t.name.replace("query","get"),"getAll"),c=oA(jd(i,t.name,"findAll")),l=oA(lE(s,t.name,"find"));return[r,a,o,c,l]}function wUe(t){return Array.from(t.querySelectorAll("label,input")).map(e=>({node:e,textToMatch:kU(e)})).filter(e=>{let{textToMatch:n}=e;return n!==null})}const xUe=function(t,e,n){let{exact:r=!0,trim:i,collapseWhitespace:s,normalizer:o}=n===void 0?{}:n;const a=r?ig:mS,c=xy({collapseWhitespace:s,trim:i,normalizer:o});return wUe(t).filter(u=>{let{node:d,textToMatch:h}=u;return a(h,d,e,c)}).map(u=>{let{node:d}=u;return d})},rw=function(t,e,n){let{selector:r="*",exact:i=!0,collapseWhitespace:s,trim:o,normalizer:a}=n===void 0?{}:n;Ag(t);const c=i?ig:mS,l=xy({collapseWhitespace:s,trim:o,normalizer:a}),u=Array.from(t.querySelectorAll("*")).filter(d=>vJ(d).length||d.hasAttribute("aria-labelledby")).reduce((d,h)=>{const p=_J(t,h,{selector:r});p.filter(g=>!!g.formControl).forEach(g=>{c(g.content,g.formControl,e,l)&&g.formControl&&d.push(g.formControl)});const f=p.filter(g=>!!g.content).map(g=>g.content);return c(f.join(" "),h,e,l)&&d.push(h),f.length>1&&f.forEach((g,y)=>{c(g,h,e,l)&&d.push(h);const E=[...f];E.splice(y,1),E.length>1&&c(E.join(" "),h,e,l)&&d.push(h)}),d},[]).concat(jk("aria-label",t,e,{exact:i,normalizer:l}));return Array.from(new Set(u)).filter(d=>d.matches(r))},sy=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const s=rw(t,e,...r);if(!s.length){const o=xUe(t,e,...r);if(o.length){const a=o.map(c=>CUe(t,c)).filter(c=>!!c);throw a.length?ji().getElementError(a.map(c=>"Found a label with the text of: "+e+", however the element associated with this label (<"+c+" />) is non-labellable [https://html.spec.whatwg.org/multipage/forms.html#category-label]. If you really need to label a <"+c+" />, you can use aria-label or aria-labelledby instead.").join(`

`),t):ji().getElementError("Found a label with the text of: "+e+`, however no form control was found associated to that label. Make sure you're using the "for" attribute or "aria-labelledby" attribute correctly.`,t)}else throw ji().getElementError("Unable to find a label with the text of: "+e,t)}return s};function CUe(t,e){const n=e.getAttribute("for");if(!n)return null;const r=t.querySelector('[id="'+n+'"]');return r?r.tagName.toLowerCase():null}const xJ=(t,e)=>"Found multiple elements with the text of: "+e,RUe=lE(sA(rw,xJ),rw.name,"query"),CJ=sA(sy,xJ),AUe=oA(jd(sy,sy.name,"findAll")),MUe=oA(lE(CJ,sy.name,"find")),IUe=jd(sy,sy.name,"getAll"),OUe=lE(CJ,sy.name,"get"),kUe=jd(rw,rw.name,"queryAll"),PU=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Ag(e[0]),jk("placeholder",...e)},NUe=(t,e)=>"Found multiple elements with the placeholder text of: "+e,PUe=(t,e)=>"Unable to find an element with the placeholder text of: "+e,DUe=jd(PU,PU.name,"queryAll"),[LUe,UUe,FUe,BUe,jUe]=Cy(PU,NUe,PUe),DU=function(t,e,n){let{selector:r="*",exact:i=!0,collapseWhitespace:s,trim:o,ignore:a=ji().defaultIgnore,normalizer:c}=n===void 0?{}:n;Ag(t);const l=i?ig:mS,u=xy({collapseWhitespace:s,trim:o,normalizer:c});let d=[];return typeof t.matches=="function"&&t.matches(r)&&(d=[t]),[...d,...Array.from(t.querySelectorAll(r))].filter(h=>!a||!h.matches(a)).filter(h=>l(Bk(h),h,e,u))},$Ue=(t,e)=>"Found multiple elements with the text: "+e,HUe=function(t,e,n){n===void 0&&(n={});const{collapseWhitespace:r,trim:i,normalizer:s,selector:o}=n,c=xy({collapseWhitespace:r,trim:i,normalizer:s})(e.toString()),l=c!==e.toString(),u=(o??"*")!=="*";return"Unable to find an element with the text: "+(l?c+" (normalized from '"+e+"')":e)+(u?", which matches selector '"+o+"'":"")+". This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible."},VUe=jd(DU,DU.name,"queryAll"),[zUe,GUe,WUe,qUe,KUe]=Cy(DU,$Ue,HUe),LU=function(t,e,n){let{exact:r=!0,collapseWhitespace:i,trim:s,normalizer:o}=n===void 0?{}:n;Ag(t);const a=r?ig:mS,c=xy({collapseWhitespace:i,trim:s,normalizer:o});return Array.from(t.querySelectorAll("input,textarea,select")).filter(l=>l.tagName==="SELECT"?Array.from(l.options).filter(d=>d.selected).some(d=>a(Bk(d),d,e,c)):a(l.value,l,e,c))},YUe=(t,e)=>"Found multiple elements with the display value: "+e+".",XUe=(t,e)=>"Unable to find an element with the display value: "+e+".",JUe=jd(LU,LU.name,"queryAll"),[QUe,ZUe,eFe,tFe,nFe]=Cy(LU,YUe,XUe),rFe=/^(img|input|area|.+-.+)$/i,UU=function(t,e,n){return n===void 0&&(n={}),Ag(t),jk("alt",t,e,n).filter(r=>rFe.test(r.tagName))},iFe=(t,e)=>"Found multiple elements with the alt text: "+e,sFe=(t,e)=>"Unable to find an element with the alt text: "+e,oFe=jd(UU,UU.name,"queryAll"),[aFe,cFe,lFe,uFe,dFe]=Cy(UU,iFe,sFe),hFe=t=>{var e;return t.tagName.toLowerCase()==="title"&&((e=t.parentElement)==null?void 0:e.tagName.toLowerCase())==="svg"},FU=function(t,e,n){let{exact:r=!0,collapseWhitespace:i,trim:s,normalizer:o}=n===void 0?{}:n;Ag(t);const a=r?ig:mS,c=xy({collapseWhitespace:i,trim:s,normalizer:o});return Array.from(t.querySelectorAll("[title], svg > title")).filter(l=>a(l.getAttribute("title"),l,e,c)||hFe(l)&&a(Bk(l),l,e,c))},fFe=(t,e)=>"Found multiple elements with the title: "+e+".",pFe=(t,e)=>"Unable to find an element with the title: "+e+".",mFe=jd(FU,FU.name,"queryAll"),[gFe,vFe,_Fe,yFe,bFe]=Cy(FU,fFe,pFe),BU=function(t,e,n){let{hidden:r=ji().defaultHidden,name:i,description:s,queryFallbacks:o=!1,selected:a,busy:c,checked:l,pressed:u,current:d,level:h,expanded:p,value:{now:f,min:g,max:y,text:E}={}}=n===void 0?{}:n;if(Ag(t),a!==void 0){var w;if(((w=xh.get(e))==null?void 0:w.props["aria-selected"])===void 0)throw new Error('"aria-selected" is not supported on role "'+e+'".')}if(c!==void 0){var R;if(((R=xh.get(e))==null?void 0:R.props["aria-busy"])===void 0)throw new Error('"aria-busy" is not supported on role "'+e+'".')}if(l!==void 0){var A;if(((A=xh.get(e))==null?void 0:A.props["aria-checked"])===void 0)throw new Error('"aria-checked" is not supported on role "'+e+'".')}if(u!==void 0){var k;if(((k=xh.get(e))==null?void 0:k.props["aria-pressed"])===void 0)throw new Error('"aria-pressed" is not supported on role "'+e+'".')}if(d!==void 0){var I;if(((I=xh.get(e))==null?void 0:I.props["aria-current"])===void 0)throw new Error('"aria-current" is not supported on role "'+e+'".')}if(h!==void 0&&e!=="heading")throw new Error('Role "'+e+'" cannot have "level" property.');if(f!==void 0){var N;if(((N=xh.get(e))==null?void 0:N.props["aria-valuenow"])===void 0)throw new Error('"aria-valuenow" is not supported on role "'+e+'".')}if(y!==void 0){var U;if(((U=xh.get(e))==null?void 0:U.props["aria-valuemax"])===void 0)throw new Error('"aria-valuemax" is not supported on role "'+e+'".')}if(g!==void 0){var F;if(((F=xh.get(e))==null?void 0:F.props["aria-valuemin"])===void 0)throw new Error('"aria-valuemin" is not supported on role "'+e+'".')}if(E!==void 0){var $;if((($=xh.get(e))==null?void 0:$.props["aria-valuetext"])===void 0)throw new Error('"aria-valuetext" is not supported on role "'+e+'".')}if(p!==void 0){var q;if(((q=xh.get(e))==null?void 0:q.props["aria-expanded"])===void 0)throw new Error('"aria-expanded" is not supported on role "'+e+'".')}const K=new WeakMap;function W(X){return K.has(X)||K.set(X,SJ(X)),K.get(X)}return Array.from(t.querySelectorAll(EFe(e))).filter(X=>{if(X.hasAttribute("role")){const ie=X.getAttribute("role");if(o)return ie.split(" ").filter(Boolean).some(Q=>Q===e);const[G]=ie.split(" ");return G===e}return q3(X).some(ie=>ie===e)}).filter(X=>{if(a!==void 0)return a===cUe(X);if(c!==void 0)return c===lUe(X);if(l!==void 0)return l===uUe(X);if(u!==void 0)return u===dUe(X);if(d!==void 0)return d===hUe(X);if(p!==void 0)return p===fUe(X);if(h!==void 0)return h===pUe(X);if(f!==void 0||y!==void 0||g!==void 0||E!==void 0){let Z=!0;if(f!==void 0&&Z&&(Z=f===mUe(X)),y!==void 0&&Z&&(Z=y===gUe(X)),g!==void 0&&Z&&(Z=g===vUe(X)),E!==void 0){var ne;Z&&(Z=ig((ne=_Ue(X))!=null?ne:null,X,E,ie=>ie))}return Z}return!0}).filter(X=>i===void 0?!0:ig(j3(X,{computedStyleSupportsPseudoElements:ji().computedStyleSupportsPseudoElements}),X,i,ne=>ne)).filter(X=>s===void 0?!0:ig(KX(X,{computedStyleSupportsPseudoElements:ji().computedStyleSupportsPseudoElements}),X,s,ne=>ne)).filter(X=>r===!1?W3(X,{isSubtreeInaccessible:W})===!1:!0)};function EFe(t){var e;const n='*[role~="'+t+'"]',r=(e=aJ.get(t))!=null?e:new Set,i=new Set(Array.from(r).map(s=>{let{name:o}=s;return o}));return[n].concat(Array.from(i)).join(",")}const RJ=t=>{let e="";return t===void 0?e="":typeof t=="string"?e=' and name "'+t+'"':e=" and name `"+t+"`",e},SFe=function(t,e,n){let{name:r}=n===void 0?{}:n;return'Found multiple elements with the role "'+e+'"'+RJ(r)},TFe=function(t,e,n){let{hidden:r=ji().defaultHidden,name:i,description:s}=n===void 0?{}:n;if(ji()._disableExpensiveErrorDiagnostics)return'Unable to find role="'+e+'"'+RJ(i);let o="";Array.from(t.children).forEach(u=>{o+=aUe(u,{hidden:r,includeDescription:s!==void 0})});let a;o.length===0?r===!1?a="There are no accessible roles. But there might be some inaccessible roles. If you wish to access them, then set the `hidden` option to `true`. Learn more about this here: https://testing-library.com/docs/dom-testing-library/api-queries#byrole":a="There are no available roles.":a=(`
Here are the `+(r===!1?"accessible":"available")+` roles:

  `+o.replace(/\n/g,`
  `).replace(/\n\s\s\n/g,`

`)+`
`).trim();let c="";i===void 0?c="":typeof i=="string"?c=' and name "'+i+'"':c=" and name `"+i+"`";let l="";return s===void 0?l="":typeof s=="string"?l=' and description "'+s+'"':l=" and description `"+s+"`",(`
Unable to find an `+(r===!1?"accessible ":"")+'element with the role "'+e+'"'+c+l+`

`+a).trim()},wFe=jd(BU,BU.name,"queryAll"),[xFe,CFe,RFe,AFe,MFe]=Cy(BU,SFe,TFe),K3=()=>ji().testIdAttribute,jU=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Ag(e[0]),jk(K3(),...e)},IFe=(t,e)=>"Found multiple elements by: ["+K3()+'="'+e+'"]',OFe=(t,e)=>"Unable to find an element by: ["+K3()+'="'+e+'"]',kFe=jd(jU,jU.name,"queryAll"),[NFe,PFe,DFe,LFe,UFe]=Cy(jU,IFe,OFe);var $U=Object.freeze({__proto__:null,queryAllByLabelText:kUe,queryByLabelText:RUe,getAllByLabelText:IUe,getByLabelText:OUe,findAllByLabelText:AUe,findByLabelText:MUe,queryByPlaceholderText:LUe,queryAllByPlaceholderText:DUe,getByPlaceholderText:FUe,getAllByPlaceholderText:UUe,findAllByPlaceholderText:BUe,findByPlaceholderText:jUe,queryByText:zUe,queryAllByText:VUe,getByText:WUe,getAllByText:GUe,findAllByText:qUe,findByText:KUe,queryByDisplayValue:QUe,queryAllByDisplayValue:JUe,getByDisplayValue:eFe,getAllByDisplayValue:ZUe,findAllByDisplayValue:tFe,findByDisplayValue:nFe,queryByAltText:aFe,queryAllByAltText:oFe,getByAltText:lFe,getAllByAltText:cFe,findAllByAltText:uFe,findByAltText:dFe,queryByTitle:gFe,queryAllByTitle:mFe,getByTitle:_Fe,getAllByTitle:vFe,findAllByTitle:yFe,findByTitle:bFe,queryByRole:xFe,queryAllByRole:wFe,getAllByRole:CFe,getByRole:RFe,findAllByRole:AFe,findByRole:MFe,queryByTestId:NFe,queryAllByTestId:kFe,getByTestId:DFe,getAllByTestId:PFe,findAllByTestId:LFe,findByTestId:UFe});function FFe(t,e,n){return e===void 0&&(e=$U),n===void 0&&(n={}),Object.keys(e).reduce((r,i)=>{const s=e[i];return r[i]=s.bind(null,t),r},n)}const BFe={copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionEnd:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionStart:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionUpdate:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyDown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyPress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyUp:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusIn:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusOut:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},invalid:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!0}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},reset:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},click:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,button:0,composed:!0}},contextMenu:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblClick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drag:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragEnd:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragEnter:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragExit:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragLeave:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragOver:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragStart:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drop:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseDown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseEnter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseLeave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseMove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOut:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOver:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseUp:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},select:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},touchCancel:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},touchEnd:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchMove:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchStart:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},resize:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},scroll:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},wheel:{EventType:"WheelEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},abort:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlay:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlayThrough:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},durationChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},emptied:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},encrypted:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},ended:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedData:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedMetadata:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadStart:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},pause:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},play:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},playing:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},progress:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},rateChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeked:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeking:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},stalled:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},suspend:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},timeUpdate:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},volumeChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},waiting:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},load:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},error:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},animationStart:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationEnd:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationIteration:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionCancel:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionEnd:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},transitionRun:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionStart:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},pointerOver:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerEnter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerDown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerMove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerUp:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerCancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerOut:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerLeave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},gotPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},lostPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},popState:{EventType:"PopStateEvent",defaultInit:{bubbles:!0,cancelable:!1}},offline:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},online:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},pageHide:{EventType:"PageTransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},pageShow:{EventType:"PageTransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}}},jFe={doubleClick:"dblClick"};Object.keys(BFe).forEach(t=>{t.toLowerCase()});Object.keys(jFe).forEach(t=>{});function $Fe(t){return t.replace(/[ \t]*[\n][ \t]*/g,`
`)}function HFe(t){return P2e.compressToEncodedURIComponent($Fe(t))}function VFe(t){return"https://testing-playground.com/#markup="+HFe(t)}const zFe=(t,e,n)=>Array.isArray(t)?t.forEach(r=>TV(r,e,n)):TV(t,e,n),GFe=function(t){if(t===void 0&&(t=G3().body),!t||!("innerHTML"in t)){console.log("The element you're providing isn't a valid DOM element.");return}if(!t.innerHTML){console.log("The provided element doesn't have any children.");return}const e=VFe(t.innerHTML);return console.log(`Open this URL in your browser

`+e),e},CV={debug:zFe,logTestingPlaygroundURL:GFe};typeof document<"u"&&document.body?FFe(document.body,$U,CV):Object.keys($U).reduce((t,e)=>(t[e]=()=>{throw new TypeError("For queries bound to document.body a global document has to be available... Learn more: https://testing-library.com/s/screen-global-error")},t),CV);function zE(t,e){return ji().eventWrapper(t)}function y_(t){const e=_Ce(t,D3),n=ex(t.ownerDocument);(e??t.ownerDocument.body)!==n&&(zE(e?()=>e.focus():()=>n==null?void 0:n.blur()),ECe(e??t.ownerDocument.body))}function WFe(t){!D3(t)||!(ex(t.ownerDocument)===t)||zE(()=>t.blur())}const b_={};b_.click=(t,e,n)=>{const r=e.closest("button,input,label,select,textarea"),i=r&&Qr(r,"label")&&r.control;if(i&&i!==e)return()=>{D3(i)&&(y_(i),n.dispatchEvent(i,vCe(t)))};if(Qr(e,"input",{type:"file"}))return()=>{WFe(e),e.dispatchEvent(new(zd(e)).Event("fileDialog")),y_(e)}};const GE=Symbol("Displayed value in UI"),Zm=Symbol("Displayed selection in UI"),aA=Symbol("Initial value to compare on blur");function qFe(t){return typeof t=="object"&&GE in t}function KFe(t){return!!t&&typeof t=="object"&&Zm in t}function YFe(t,e){t[aA]===void 0&&(t[aA]=t.value),t[GE]=e,t.value=Object.assign(new String(e),{[GE]:!0})}function Lp(t){return t[GE]===void 0?t.value:String(t[GE])}function Y3(t){t[GE]=void 0}function AJ(t){t[aA]=void 0}function XFe(t){return t[aA]}function JFe(t,e){t[Zm]=e}function gS(t,{focusOffset:e,anchorOffset:n=e},r="replace"){const i=Lp(t).length,s=d=>Math.max(0,Math.min(i,d)),o=r==="replace"||t[Zm]===void 0?s(n):t[Zm].anchorOffset,a=s(e),c=Math.min(o,a),l=Math.max(o,a);if(t[Zm]={anchorOffset:o,focusOffset:a},t.selectionStart===c&&t.selectionEnd===l)return;const u=Object.assign(new Number(c),{[Zm]:!0});try{t.setSelectionRange(u,l)}catch{}}function iw(t){var e,n,r;const i=(r=t[Zm])!==null&&r!==void 0?r:{anchorOffset:(e=t.selectionStart)!==null&&e!==void 0?e:0,focusOffset:(n=t.selectionEnd)!==null&&n!==void 0?n:0};return{...i,startOffset:Math.min(i.anchorOffset,i.focusOffset),endOffset:Math.max(i.anchorOffset,i.focusOffset)}}function QFe(t){return!!t[Zm]}function zC(t){t[Zm]=void 0}const cA=globalThis.parseInt;function ZFe(t){const e=t.replace(/\D/g,"");if(e.length<2)return t;const n=cA(e[0],10),r=cA(e[1],10);if(n>=3||n===2&&r>=4){let i;return n>=3?i=1:i=2,RV(e,i)}return t.length===2?t:RV(e,2)}function RV(t,e){const n=t.slice(0,e),r=Math.min(cA(n,10),23),i=t.slice(e),s=cA(i,10),o=Math.min(s,59);return`${r.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function MJ(t,e){const n=t.cloneNode();return n.value=e,n.value===e}var IJ=function(t){return t.email="email",t.password="password",t.search="search",t.telephone="telephone",t.text="text",t.url="url",t}(IJ||{});function eBe(t){var e;const n=(e=t.getAttribute("maxlength"))!==null&&e!==void 0?e:"";return/^\d+$/.test(n)&&Number(n)>=0?Number(n):void 0}function tBe(t){return Qr(t,"textarea")||Qr(t,"input")&&t.type in IJ}function OJ(t,e,n,r){if(GC(t)&&e+n>=0&&e+n<=t.nodeValue.length)return{node:t,offset:e+n};const i=AV(t,e,n);if(i){if(GC(i))return{node:i,offset:n>0?Math.min(1,i.nodeValue.length):Math.max(i.nodeValue.length-1,0)};if(Qr(i,"br")){const s=AV(i,void 0,n);return s?GC(s)?{node:s,offset:n>0?0:s.nodeValue.length}:n<0&&Qr(s,"br")?{node:i.parentNode,offset:K1(i)}:{node:s.parentNode,offset:K1(s)+(n>0?0:1)}:n<0&&r==="deleteContentBackward"?{node:i.parentNode,offset:K1(i)}:void 0}else return{node:i.parentNode,offset:K1(i)+(n>0?1:0)}}}function AV(t,e,n){const r=Number(e)+(n<0?-1:0);return e!==void 0&&X3(t)&&r>=0&&r<t.children.length&&(t=t.children[r]),rBe(t,n===1?"next":"previous",nBe)}function nBe(t){if(GC(t))return!0;if(X3(t)){if(Qr(t,["input","textarea"]))return t.type!=="hidden";if(Qr(t,"br"))return!0}return!1}function K1(t){let e=0;for(;t.previousSibling;)e++,t=t.previousSibling;return e}function X3(t){return t.nodeType===1}function GC(t){return t.nodeType===3}function rBe(t,e,n){for(;;){var r;const i=t[`${e}Sibling`];if(i){if(t=iBe(i,e==="next"?"first":"last"),n(t))return t}else if(t.parentNode&&(!X3(t.parentNode)||!iy(t.parentNode)&&t.parentNode!==((r=t.ownerDocument)===null||r===void 0?void 0:r.body)))t=t.parentNode;else break}}function iBe(t,e){for(;t.hasChildNodes();)t=t[`${e}Child`];return t}const sw=Symbol("Track programmatic changes for React workaround");function sBe(t){return Object.getOwnPropertyNames(t).some(e=>e.startsWith("__react"))&&zd(t).REACT_VERSION===17}function oBe(t){sBe(t)&&(t[sw]={previousValue:String(t.value),tracked:[]})}function aBe(t,e){var n,r;(r=t[sw])===null||r===void 0||(n=r.tracked)===null||n===void 0||n.push(e),t[sw]||(Y3(t),gS(t,{focusOffset:e.length}))}function cBe(t,e){var n;const r=t[sw];if(t[sw]=void 0,!(!(r==null||(n=r.tracked)===null||n===void 0)&&n.length))return;const i=r.tracked.length===2&&r.tracked[0]===r.previousValue&&r.tracked[1]===t.value;i||Y3(t),QFe(t)&&gS(t,{focusOffset:i?e:t.value.length})}function kJ(t){const e=lBe(t);if(e&&Dp(e))return{type:"input",selection:iw(e)};const n=e==null?void 0:e.ownerDocument.getSelection();return{type:QT(t)&&(n==null?void 0:n.anchorNode)&&QT(n.anchorNode)?"contenteditable":"default",selection:n}}function lBe(t){return t.nodeType===1?t:t.parentElement}function uBe(t){const e=kJ(t);if(e.type==="input")return e.selection;if(e.type==="contenteditable"){var n;return(n=e.selection)===null||n===void 0?void 0:n.getRangeAt(0)}}function oy({focusNode:t,focusOffset:e,anchorNode:n=t,anchorOffset:r=e}){var i,s;if(kJ(t).type==="input")return gS(t,{anchorOffset:r,focusOffset:e});(s=n.ownerDocument)===null||s===void 0||(i=s.getSelection())===null||i===void 0||i.setBaseAndExtent(n,r,t,e)}function NJ(t){return Qr(t,"input")&&["date","time"].includes(t.type)}function WE(t,e,n,r="insertText"){const i=uBe(e);i&&(!NJ(e)&&!t.dispatchUIEvent(e,"beforeinput",{inputType:r,data:n})||("startContainer"in i?dBe(t,e,i,n,r):hBe(t,e,i,n,r)))}function dBe(t,e,n,r,i){let s=!1;if(!n.collapsed)s=!0,n.deleteContents();else if(["deleteContentBackward","deleteContentForward"].includes(i)){const o=OJ(n.startContainer,n.startOffset,i==="deleteContentBackward"?-1:1,i);if(o){s=!0;const a=n.cloneRange();a.comparePoint(o.node,o.offset)<0?a.setStart(o.node,o.offset):a.setEnd(o.node,o.offset),a.deleteContents()}}if(r)if(n.endContainer.nodeType===3){const o=n.endOffset;n.endContainer.insertData(o,r),n.setStart(n.endContainer,o+r.length),n.setEnd(n.endContainer,o+r.length)}else{const o=e.ownerDocument.createTextNode(r);n.insertNode(o),n.setStart(o,r.length),n.setEnd(o,r.length)}(s||r)&&t.dispatchUIEvent(e,"input",{inputType:i})}function hBe(t,e,n,r,i){let s=r;if(tBe(e)){const l=eBe(e);if(l!==void 0&&r.length>0){const u=l-e.value.length;if(u>0)s=r.substring(0,u);else return}}const{newValue:o,newOffset:a,oldValue:c}=fBe(s,e,n,i);o===c&&a===n.startOffset&&a===n.endOffset||Qr(e,"input",{type:"number"})&&!pBe(o)||(YFe(e,o),oy({focusNode:e,anchorOffset:a,focusOffset:a}),NJ(e)?MJ(e,o)&&(MV(t,e,a,{}),t.dispatchUIEvent(e,"change"),AJ(e)):MV(t,e,a,{data:r,inputType:i}))}function fBe(t,e,{startOffset:n,endOffset:r},i){const s=Lp(e),o=Math.max(0,n===r&&i==="deleteContentBackward"?n-1:n),a=s.substring(0,o),c=Math.min(s.length,n===r&&i==="deleteContentForward"?n+1:r),l=s.substring(c,s.length);let u=`${a}${t}${l}`,d=o+t.length;if(Qr(e,"input",{type:"time"})){const h=ZFe(u);h!==""&&MJ(e,h)&&(u=h,d=h.length)}return{oldValue:s,newValue:u,newOffset:d}}function MV(t,e,n,r){t.dispatchUIEvent(e,"input",r),cBe(e,n)}function pBe(t){var e,n;const r=t.split("e",2);return!(/[^\d.\-e]/.test(t)||Number((e=t.match(/-/g))===null||e===void 0?void 0:e.length)>2||Number((n=t.match(/\./g))===null||n===void 0?void 0:n.length)>1||r[1]&&!/^-?\d*$/.test(r[1]))}b_.cut=(t,e,n)=>()=>{HE(e)&&WE(n,e,"","deleteByCut")};function mBe(t){return t?iy(t)?t.textContent:Lp(t):null}function gBe(t){const e=zd(t);for(let n=t;n!=null&&n.ownerDocument;n=n.parentElement){const{display:r,visibility:i}=e.getComputedStyle(n);if(r==="none"||i==="hidden")return!1}return!0}function vBe(t,e){const n=t.ownerDocument,r=n.querySelectorAll(WY),i=Array.from(r).filter(c=>c===t||!(Number(c.getAttribute("tabindex"))<0||fg(c)));Number(t.getAttribute("tabindex"))>=0&&i.sort((c,l)=>{const u=Number(c.getAttribute("tabindex")),d=Number(l.getAttribute("tabindex"));return u===d?0:u===0?1:d===0?-1:u-d});const s={};let o=[n.body];const a=Qr(t,"input",{type:"radio"})?t.name:void 0;i.forEach(c=>{const l=c;if(Qr(l,"input",{type:"radio"})&&l.name){if(l===t){o.push(l);return}else if(l.name===a)return;if(l.checked){o=o.filter(u=>!Qr(u,"input",{type:"radio",name:l.name})),o.push(l),s[l.name]=l;return}if(typeof s[l.name]<"u")return}o.push(l)});for(let c=o.findIndex(l=>l===t);;)if(c+=e?-1:1,c===o.length?c=0:c===-1&&(c=o.length-1),o[c]===t||o[c]===n.body||gBe(o[c]))return o[c]}function IV(t,e){if(Dp(t)){const n=iw(t);oy({focusNode:t,focusOffset:n.startOffset===n.endOffset?n.focusOffset+e:e<0?n.startOffset:n.endOffset})}else{const n=t.ownerDocument.getSelection();if(!(n!=null&&n.focusNode))return;if(n.isCollapsed){const r=OJ(n.focusNode,n.focusOffset,e);r&&oy({focusNode:r.node,focusOffset:r.offset})}else n[e<0?"collapseToStart":"collapseToEnd"]()}}function PJ(t){if(Dp(t))return oy({focusNode:t,anchorOffset:0,focusOffset:Lp(t).length});var e;const n=(e=QT(t))!==null&&e!==void 0?e:t.ownerDocument.body;oy({focusNode:n,anchorOffset:0,focusOffset:n.childNodes.length})}function _Be(t){if(Dp(t))return iw(t).startOffset===0&&iw(t).endOffset===Lp(t).length;var e;const n=(e=QT(t))!==null&&e!==void 0?e:t.ownerDocument.body,r=t.ownerDocument.getSelection();return(r==null?void 0:r.anchorNode)===n&&r.focusNode===n&&r.anchorOffset===0&&r.focusOffset===n.childNodes.length}function aT(t,e,n){var r;if(Dp(t))return oy({focusNode:t,anchorOffset:e,focusOffset:n});if(iy(t)&&((r=t.firstChild)===null||r===void 0?void 0:r.nodeType)===3)return oy({focusNode:t.firstChild,anchorOffset:e,focusOffset:n});throw new Error("Not implemented. The result of this interaction is unreliable.")}function Y1(t,e,n){const r=zd(e),i=Array.from(e.ownerDocument.querySelectorAll(e.name?`input[type="radio"][name="${r.CSS.escape(e.name)}"]`:'input[type="radio"][name=""], input[type="radio"]:not([name])'));for(let s=i.findIndex(o=>o===e)+n;;s+=n){if(i[s]||(s=n>0?0:i.length-1),i[s]===e)return;if(!fg(i[s])){y_(i[s]),t.dispatchUIEvent(i[s],"click");return}}}b_.keydown=(t,e,n)=>{var r,i;return(i=(r=OV[t.key])===null||r===void 0?void 0:r.call(OV,t,e,n))!==null&&i!==void 0?i:yBe(t,e,n)};const OV={ArrowDown:(t,e,n)=>{if(Qr(e,"input",{type:"radio"}))return()=>Y1(n,e,1)},ArrowLeft:(t,e,n)=>Qr(e,"input",{type:"radio"})?()=>Y1(n,e,-1):()=>IV(e,-1),ArrowRight:(t,e,n)=>Qr(e,"input",{type:"radio"})?()=>Y1(n,e,1):()=>IV(e,1),ArrowUp:(t,e,n)=>{if(Qr(e,"input",{type:"radio"}))return()=>Y1(n,e,-1)},Backspace:(t,e,n)=>{if(HE(e))return()=>{WE(n,e,"","deleteContentBackward")}},Delete:(t,e,n)=>{if(HE(e))return()=>{WE(n,e,"","deleteContentForward")}},End:(t,e)=>{if(Qr(e,["input","textarea"])||iy(e))return()=>{var n,r;const i=(r=(n=mBe(e))===null||n===void 0?void 0:n.length)!==null&&r!==void 0?r:0;aT(e,i,i)}},Home:(t,e)=>{if(Qr(e,["input","textarea"])||iy(e))return()=>{aT(e,0,0)}},PageDown:(t,e)=>{if(Qr(e,["input"]))return()=>{const n=Lp(e).length;aT(e,n,n)}},PageUp:(t,e)=>{if(Qr(e,["input"]))return()=>{aT(e,0,0)}},Tab:(t,e,n)=>()=>{const r=vBe(e,n.system.keyboard.modifiers.Shift);y_(r),Dp(r)&&gS(r,{anchorOffset:0,focusOffset:r.value.length})}},yBe=(t,e,n)=>{if(t.code==="KeyA"&&n.system.keyboard.modifiers.Control)return()=>PJ(e)};b_.keypress=(t,e,n)=>{if(t.key==="Enter"){if(Qr(e,"button")||Qr(e,"input")&&bBe.includes(e.type)||Qr(e,"a")&&e.href)return()=>{n.dispatchUIEvent(e,"click")};if(Qr(e,"input")){const r=e.form,i=r==null?void 0:r.querySelector('input[type="submit"], button:not([type]), button[type="submit"]');return i?()=>n.dispatchUIEvent(i,"click"):r&&EBe.includes(e.type)&&r.querySelectorAll("input").length===1?()=>n.dispatchUIEvent(r,"submit"):void 0}}if(HE(e)){const r=t.key==="Enter"?iy(e)&&!n.system.keyboard.modifiers.Shift?"insertParagraph":"insertLineBreak":"insertText",i=t.key==="Enter"?`
`:t.key;return()=>WE(n,e,i,r)}};const bBe=["button","color","file","image","reset","submit"],EBe=["email","month","password","search","tel","text","url","week"];b_.keyup=(t,e,n)=>{var r;return(r=kV[t.key])===null||r===void 0?void 0:r.call(kV,t,e,n)};const kV={" ":(t,e,n)=>{if(KY(e))return()=>n.dispatchUIEvent(e,"click")}};b_.paste=(t,e,n)=>{if(HE(e))return()=>{var r;const i=(r=t.clipboardData)===null||r===void 0?void 0:r.getData("text");i&&WE(n,e,i,"insertFromPaste")}};const DJ={auxclick:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},beforeinput:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},click:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},contextmenu:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblclick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusin:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusout:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},keydown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keypress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyup:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},mousedown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseenter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseleave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mousemove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseout:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseover:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseup:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerover:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerenter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerdown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointermove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerup:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointercancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerout:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerleave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}}};function LJ(t){return DJ[t].EventType}const SBe=["MouseEvent","PointerEvent"];function TBe(t){return SBe.includes(LJ(t))}function wBe(t){return LJ(t)==="KeyboardEvent"}const xBe={ClipboardEvent:[RBe],Event:[],FocusEvent:[GS,ABe],InputEvent:[GS,MBe],MouseEvent:[GS,pD,NV],PointerEvent:[GS,pD,NV,OBe],KeyboardEvent:[GS,pD,IBe]};function UJ(t,e,n){const r=zd(e),{EventType:i,defaultInit:s}=DJ[t],o=new(CBe(r))[i](t,s);return xBe[i].forEach(a=>a(o,n??{})),o}function CBe(t){var e;const n=(e=t.Event)!==null&&e!==void 0?e:class{};var r;const i=(r=t.AnimationEvent)!==null&&r!==void 0?r:class extends n{};var s;const o=(s=t.ClipboardEvent)!==null&&s!==void 0?s:class extends n{};var a;const c=(a=t.PopStateEvent)!==null&&a!==void 0?a:class extends n{};var l;const u=(l=t.ProgressEvent)!==null&&l!==void 0?l:class extends n{};var d;const h=(d=t.TransitionEvent)!==null&&d!==void 0?d:class extends n{};var p;const f=(p=t.UIEvent)!==null&&p!==void 0?p:class extends n{};var g;const y=(g=t.CompositionEvent)!==null&&g!==void 0?g:class extends f{};var E;const w=(E=t.FocusEvent)!==null&&E!==void 0?E:class extends f{};var R;const A=(R=t.InputEvent)!==null&&R!==void 0?R:class extends f{};var k;const I=(k=t.KeyboardEvent)!==null&&k!==void 0?k:class extends f{};var N;const U=(N=t.MouseEvent)!==null&&N!==void 0?N:class extends f{};var F;const $=(F=t.DragEvent)!==null&&F!==void 0?F:class extends U{};var q;const K=(q=t.PointerEvent)!==null&&q!==void 0?q:class extends U{};var W;const X=(W=t.TouchEvent)!==null&&W!==void 0?W:class extends f{};return{Event:n,AnimationEvent:i,ClipboardEvent:o,PopStateEvent:c,ProgressEvent:u,TransitionEvent:h,UIEvent:f,CompositionEvent:y,FocusEvent:w,InputEvent:A,KeyboardEvent:I,MouseEvent:U,DragEvent:$,PointerEvent:K,TouchEvent:X}}function k_(t,e){for(const[n,r]of Object.entries(e))Object.defineProperty(t,n,{get:()=>r??null})}function go(t){return Number(t??0)}function RBe(t,{clipboardData:e}){k_(t,{clipboardData:e})}function ABe(t,{relatedTarget:e}){k_(t,{relatedTarget:e})}function MBe(t,{data:e,inputType:n,isComposing:r}){k_(t,{data:e,isComposing:!!r,inputType:String(n)})}function GS(t,{view:e,detail:n}){k_(t,{view:e,detail:go(n??0)})}function pD(t,{altKey:e,ctrlKey:n,metaKey:r,shiftKey:i,modifierAltGraph:s,modifierCapsLock:o,modifierFn:a,modifierFnLock:c,modifierNumLock:l,modifierScrollLock:u,modifierSymbol:d,modifierSymbolLock:h}){k_(t,{altKey:!!e,ctrlKey:!!n,metaKey:!!r,shiftKey:!!i,getModifierState(p){return!!{Alt:e,AltGraph:s,CapsLock:o,Control:n,Fn:a,FnLock:c,Meta:r,NumLock:l,ScrollLock:u,Shift:i,Symbol:d,SymbolLock:h}[p]}})}function IBe(t,{key:e,code:n,location:r,repeat:i,isComposing:s,charCode:o}){k_(t,{key:String(e),code:String(n),location:go(r),repeat:!!i,isComposing:!!s,charCode:o})}function NV(t,{x:e,y:n,screenX:r,screenY:i,clientX:s=e,clientY:o=n,button:a,buttons:c,relatedTarget:l,offsetX:u,offsetY:d,pageX:h,pageY:p}){k_(t,{screenX:go(r),screenY:go(i),clientX:go(s),x:go(s),clientY:go(o),y:go(o),button:go(a),buttons:go(c),relatedTarget:l,offsetX:go(u),offsetY:go(d),pageX:go(h),pageY:go(p)})}function OBe(t,{pointerId:e,width:n,height:r,pressure:i,tangentialPressure:s,tiltX:o,tiltY:a,twist:c,pointerType:l,isPrimary:u}){k_(t,{pointerId:go(e),width:go(n??1),height:go(r??1),pressure:go(i),tangentialPressure:go(s),tiltX:go(o),tiltY:go(a),twist:go(c),pointerType:String(l),isPrimary:!!u})}function kBe(t,e,n,r=!1){(TBe(e)||wBe(e))&&(n={...n,...this.system.getUIEventModifiers()});const i=UJ(e,t,n);return FJ.call(this,t,i,r)}function FJ(t,e,n=!1){var r;const i=e.type,s=n?()=>{}:(r=b_[i])===null||r===void 0?void 0:r.call(b_,e,t,this);if(s){e.preventDefault();let o=!1;return Object.defineProperty(e,"defaultPrevented",{get:()=>o}),Object.defineProperty(e,"preventDefault",{value:()=>{o=e.cancelable}}),zE(()=>t.dispatchEvent(e)),o||s(),!o}return zE(()=>t.dispatchEvent(e))}function w0(t,e,n){const r=UJ(e,t,n);zE(()=>t.dispatchEvent(r))}const PV=Symbol("patched focus/blur methods");function BJ(t){if(t.prototype[PV])return;const{focus:e,blur:n}=t.prototype;Object.defineProperties(t.prototype,{focus:{configurable:!0,get:()=>i},blur:{configurable:!0,get:()=>s},[PV]:{configurable:!0,get:()=>({focus:e,blur:n})}});let r;function i(o){if(this.ownerDocument.visibilityState!=="hidden")return e.call(this,o);const a=DV(this.ownerDocument);if(a===this)return;const c=Symbol("focus call");r=c,a&&(n.call(a),w0(a,"blur",{relatedTarget:this}),w0(a,"focusout",{relatedTarget:r===c?this:null})),r===c&&(e.call(this,o),w0(this,"focus",{relatedTarget:a})),r===c&&w0(this,"focusin",{relatedTarget:a})}function s(){if(this.ownerDocument.visibilityState!=="hidden")return n.call(this);const o=DV(this.ownerDocument);if(o!==this)return;r=Symbol("blur call"),n.call(this),w0(o,"blur",{relatedTarget:null}),w0(o,"focusout",{relatedTarget:null})}}function DV(t){const e=ex(t);return(e==null?void 0:e.tagName)==="BODY"?null:e}const mD=Symbol("Interceptor for programmatical calls");function Gb(t,e,n){const r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=Object.getOwnPropertyDescriptor(t,e),s=r!=null&&r.set?"set":"value";if(typeof(r==null?void 0:r[s])!="function"||r[s][mD])throw new Error(`Element ${t.tagName} does not implement "${String(e)}".`);function o(...a){const{applyNative:c=!1,realArgs:l,then:u}=n.call(this,...a),d=(!c&&i||r)[s];s==="set"?d.call(this,l):d.call(this,...l),u==null||u()}o[mD]=mD,Object.defineProperty(t,e,{...i??r,[s]:o})}function NBe(t){Gb(t,"value",function(n){const r=qFe(n);return r&&oBe(this),{applyNative:!!r,realArgs:PBe(this,n),then:r?void 0:()=>aBe(this,String(n))}})}function PBe(t,e){return Qr(t,"input",{type:"number"})&&String(e)!==""&&!Number.isNaN(Number(e))?String(Number(e)):String(e)}function DBe(t){Gb(t,"setSelectionRange",function(n,...r){const i=KFe(n);return{applyNative:!!i,realArgs:[Number(n),...r],then:()=>i?void 0:zC(t)}}),Gb(t,"selectionStart",function(n){return{realArgs:n,then:()=>zC(t)}}),Gb(t,"selectionEnd",function(n){return{realArgs:n,then:()=>zC(t)}}),Gb(t,"select",function(){return{realArgs:[],then:()=>JFe(t,{anchorOffset:0,focusOffset:Lp(t).length})}})}function LBe(t){Gb(t,"setRangeText",function(...n){return{realArgs:n,then:()=>{Y3(t),zC(t)}}})}const uE=Symbol("Node prepared with document state workarounds");function jJ(t){t[uE]||(t.addEventListener("focus",e=>{const n=e.target;LV(n)},{capture:!0,passive:!0}),t.activeElement&&LV(t.activeElement),t.addEventListener("blur",e=>{const n=e.target,r=XFe(n);r!==void 0&&(n.value!==r&&w0(n,"change"),AJ(n))},{capture:!0,passive:!0}),t[uE]=uE)}function LV(t){t[uE]||(Qr(t,["input","textarea"])&&(NBe(t),DBe(t),LBe(t)),t[uE]=uE)}function UBe(t){return FBe(t)?t:t.ownerDocument}function FBe(t){return t.nodeType===9}var Bu=function(t){return t[t.Trigger=2]="Trigger",t[t.Call=1]="Call",t}({});function cT(t,e){t.levelRefs[e]={}}function X1(t,e){return t.levelRefs[e]}function qE(t){const e=t.delay;if(typeof e=="number")return Promise.all([new Promise(n=>globalThis.setTimeout(()=>n(),e)),t.advanceTimers(e)])}var WC=function(t){return t[t.EachTrigger=4]="EachTrigger",t[t.EachApiCall=2]="EachApiCall",t[t.EachTarget=1]="EachTarget",t[t.Never=0]="Never",t}({});function f0(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Hf=function(t){return t[t.STANDARD=0]="STANDARD",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.NUMPAD=3]="NUMPAD",t}({});const BBe=["Alt","AltGraph","Control","Fn","Meta","Shift","Symbol"];function UV(t){return BBe.includes(t)}const jBe=["CapsLock","FnLock","NumLock","ScrollLock","SymbolLock"];function FV(t){return jBe.includes(t)}class $Be{isKeyPressed(e){return this.pressed.has(String(e.code))}getPressedKeys(){return this.pressed.values().map(e=>e.keyDef)}async keydown(e,n){const r=String(n.key),i=String(n.code),s=KP(e.config.document);this.setKeydownTarget(s),this.pressed.add(i,n),UV(r)&&(this.modifiers[r]=!0);const o=e.dispatchUIEvent(s,"keydown",{key:r,code:i});FV(r)&&!this.modifiers[r]&&(this.modifiers[r]=!0,this.modifierLockStart[r]=!0),o&&this.pressed.setUnprevented(i),o&&this.hasKeyPress(r)&&e.dispatchUIEvent(KP(e.config.document),"keypress",{key:r,code:i,charCode:n.key==="Enter"?13:String(n.key).charCodeAt(0)})}async keyup(e,n){const r=String(n.key),i=String(n.code),s=this.pressed.isUnprevented(i);this.pressed.delete(i),UV(r)&&!this.pressed.values().find(o=>o.keyDef.key===r)&&(this.modifiers[r]=!1),e.dispatchUIEvent(KP(e.config.document),"keyup",{key:r,code:i},!s),FV(r)&&this.modifiers[r]&&(this.modifierLockStart[r]?this.modifierLockStart[r]=!1:this.modifiers[r]=!1)}setKeydownTarget(e){e!==this.lastKeydownTarget&&(this.carryChar=""),this.lastKeydownTarget=e}hasKeyPress(e){return(e.length===1||e==="Enter")&&!this.modifiers.Control&&!this.modifiers.Alt}constructor(e){f0(this,"system",void 0),f0(this,"modifiers",{Alt:!1,AltGraph:!1,CapsLock:!1,Control:!1,Fn:!1,FnLock:!1,Meta:!1,NumLock:!1,ScrollLock:!1,Shift:!1,Symbol:!1,SymbolLock:!1}),f0(this,"pressed",new class{add(n,r){var i,s,o;(o=(i=this.registry)[s=n])!==null&&o!==void 0||(i[s]={keyDef:r,unpreventedDefault:!1})}has(n){return!!this.registry[n]}setUnprevented(n){const r=this.registry[n];r&&(r.unpreventedDefault=!0)}isUnprevented(n){var r;return!!(!((r=this.registry[n])===null||r===void 0)&&r.unpreventedDefault)}delete(n){delete this.registry[n]}values(){return Object.values(this.registry)}constructor(){f0(this,"registry",{})}}),f0(this,"carryChar",""),f0(this,"lastKeydownTarget",void 0),f0(this,"modifierLockStart",{}),this.system=e}}const HBe=[..."0123456789".split("").map(t=>({code:`Digit${t}`,key:t})),...")!@#$%^&*(".split("").map((t,e)=>({code:`Digit${e}`,key:t,shiftKey:!0})),..."abcdefghijklmnopqrstuvwxyz".split("").map(t=>({code:`Key${t.toUpperCase()}`,key:t})),..."ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map(t=>({code:`Key${t}`,key:t,shiftKey:!0})),{code:"BracketLeft",key:"["},{code:"BracketLeft",key:"{",shiftKey:!0},{code:"BracketRight",key:"]"},{code:"BracketRight",key:"}",shiftKey:!0},{code:"Space",key:" "},{code:"AltLeft",key:"Alt",location:Hf.LEFT},{code:"AltRight",key:"Alt",location:Hf.RIGHT},{code:"ShiftLeft",key:"Shift",location:Hf.LEFT},{code:"ShiftRight",key:"Shift",location:Hf.RIGHT},{code:"ControlLeft",key:"Control",location:Hf.LEFT},{code:"ControlRight",key:"Control",location:Hf.RIGHT},{code:"MetaLeft",key:"Meta",location:Hf.LEFT},{code:"MetaRight",key:"Meta",location:Hf.RIGHT},{code:"OSLeft",key:"OS",location:Hf.LEFT},{code:"OSRight",key:"OS",location:Hf.RIGHT},{code:"ContextMenu",key:"ContextMenu"},{code:"Tab",key:"Tab"},{code:"CapsLock",key:"CapsLock"},{code:"Backspace",key:"Backspace"},{code:"Enter",key:"Enter"},{code:"Escape",key:"Escape"},{code:"ArrowUp",key:"ArrowUp"},{code:"ArrowDown",key:"ArrowDown"},{code:"ArrowLeft",key:"ArrowLeft"},{code:"ArrowRight",key:"ArrowRight"},{code:"Home",key:"Home"},{code:"End",key:"End"},{code:"Delete",key:"Delete"},{code:"PageUp",key:"PageUp"},{code:"PageDown",key:"PageDown"},{code:"Fn",key:"Fn"},{code:"Symbol",key:"Symbol"},{code:"AltRight",key:"AltGraph"}],VBe=[{name:"MouseLeft",pointerType:"mouse",button:"primary"},{name:"MouseRight",pointerType:"mouse",button:"secondary"},{name:"MouseMiddle",pointerType:"mouse",button:"auxiliary"},{name:"TouchA",pointerType:"touch"},{name:"TouchB",pointerType:"touch"},{name:"TouchC",pointerType:"touch"}];function zBe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class $J{getButtons(){let e=0;for(const n of Object.keys(this.pressed))e|=2**Number(n);return e}down(e){const n=HU(e.button);if(n in this.pressed){this.pressed[n].push(e);return}return this.pressed[n]=[e],n}up(e){const n=HU(e.button);if(n in this.pressed&&(this.pressed[n]=this.pressed[n].filter(r=>r.name!==e.name),this.pressed[n].length===0))return delete this.pressed[n],n}constructor(){zBe(this,"pressed",{})}}const BV={primary:0,secondary:1,auxiliary:2,back:3,X1:3,forward:4,X2:4};function HU(t=0){return t in BV?BV[t]:Number(t)}const jV={1:2,2:1};function VU(t){return t=HU(t),t in jV?jV[t]:t}function GBe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class WBe{get countPressed(){return this.pressedKeys.size}isPressed(e){return this.pressedKeys.has(e.name)}addPressed(e){return this.pressedKeys.add(e.name)}removePressed(e){return this.pressedKeys.delete(e.name)}constructor(){GBe(this,"pressedKeys",new Set)}}function ET(t,e){const n=[];for(let s=t;s;s=s.parentElement)n.push(s);const r=[];for(let s=e;s;s=s.parentElement)r.push(s);let i=0;for(;!(i>=n.length||i>=r.length||n[n.length-1-i]!==r[r.length-1-i]);i++);return[n.slice(0,n.length-i),r.slice(0,r.length-i),r.slice(r.length-i)]}function zU({target:t,node:e,offset:n}){return Dp(t)?{node:t,offset:n??Lp(t).length}:e?{node:e,offset:n??(e.nodeType===3?e.nodeValue.length:e.childNodes.length)}:HJ(t,n)}function HJ(t,e,n=!0){let r=e===void 0?t.childNodes.length-1:0;const i=e===void 0?-1:1;for(;e===void 0?r>=(n?Math.max(t.childNodes.length-1,0):0):r<=t.childNodes.length;){if(e&&r===t.childNodes.length)throw new Error("The given offset is out of bounds.");const s=t.childNodes.item(r),o=String(s.textContent);if(o.length)if(e!==void 0&&o.length<e)e-=o.length;else{if(s.nodeType===1)return HJ(s,e,!1);if(s.nodeType===3)return{node:s,offset:e??s.nodeValue.length}}r+=i}return{node:t,offset:t.childNodes.length}}function qBe({document:t,target:e,clickCount:n,node:r,offset:i}){if(bCe(e))return;const s=Dp(e),o=String(s?Lp(e):e.textContent),[a,c]=r?[i,i]:KBe(o,i,n);if(s)return gS(e,{anchorOffset:a??o.length,focusOffset:c??o.length}),{node:e,start:a??0,end:c??o.length};{const{node:l,offset:u}=zU({target:e,node:r,offset:a}),{node:d,offset:h}=zU({target:e,node:r,offset:c}),p=e.ownerDocument.createRange();try{p.setStart(l,u),p.setEnd(d,h)}catch{throw new Error("The given offset is out of bounds.")}const f=t.getSelection();return f==null||f.removeAllRanges(),f==null||f.addRange(p.cloneRange()),p}}function KBe(t,e,n){if(n%3===1||t.length===0)return[e,e];const r=e??t.length;return n%3===2?[r-t.substr(0,e).match(/(\w+|\s+|\W)?$/)[0].length,e===void 0?e:e+t.substr(e).match(/^(\w+|\s+|\W)?/)[0].length]:[r-t.substr(0,e).match(/[^\r\n]*$/)[0].length,e===void 0?e:e+t.substr(e).match(/^[^\r\n]*/)[0].length]}function YBe(t,{document:e,target:n,node:r,offset:i}){const s=zU({target:n,node:r,offset:i});if("node"in t){if(s.node===t.node){const o=s.offset<t.start?t.end:t.start,a=s.offset>t.end||s.offset<t.start?s.offset:t.end;gS(t.node,{anchorOffset:o,focusOffset:a})}}else{const o=t.cloneRange(),a=o.comparePoint(s.node,s.offset);a<0?o.setStart(s.node,s.offset):a>0&&o.setEnd(s.node,s.offset);const c=e.getSelection();c==null||c.removeAllRanges(),c==null||c.addRange(o.cloneRange())}}function VJ(t,e){var n,r,i,s,o,a,c,l,u,d,h,p,f,g,y,E,w,R,A,k,I,N,U,F;return t.target!==e.target||((n=t.coords)===null||n===void 0?void 0:n.x)!==((r=e.coords)===null||r===void 0?void 0:r.x)||((i=t.coords)===null||i===void 0?void 0:i.y)!==((s=e.coords)===null||s===void 0?void 0:s.y)||((o=t.coords)===null||o===void 0?void 0:o.clientX)!==((a=e.coords)===null||a===void 0?void 0:a.clientX)||((c=t.coords)===null||c===void 0?void 0:c.clientY)!==((l=e.coords)===null||l===void 0?void 0:l.clientY)||((u=t.coords)===null||u===void 0?void 0:u.offsetX)!==((d=e.coords)===null||d===void 0?void 0:d.offsetX)||((h=t.coords)===null||h===void 0?void 0:h.offsetY)!==((p=e.coords)===null||p===void 0?void 0:p.offsetY)||((f=t.coords)===null||f===void 0?void 0:f.pageX)!==((g=e.coords)===null||g===void 0?void 0:g.pageX)||((y=t.coords)===null||y===void 0?void 0:y.pageY)!==((E=e.coords)===null||E===void 0?void 0:E.pageY)||((w=t.coords)===null||w===void 0?void 0:w.screenX)!==((R=e.coords)===null||R===void 0?void 0:R.screenX)||((A=t.coords)===null||A===void 0?void 0:A.screenY)!==((k=e.coords)===null||k===void 0?void 0:k.screenY)||((I=t.caret)===null||I===void 0?void 0:I.node)!==((N=e.caret)===null||N===void 0?void 0:N.node)||((U=t.caret)===null||U===void 0?void 0:U.offset)!==((F=e.caret)===null||F===void 0?void 0:F.offset)}function p0(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class XBe{move(e,n,r){const i=this.position,s=this.getTarget(e);if(this.position=n,!VJ(i,n))return;const o=this.getTarget(e),a=this.getEventInit("mousemove"),[c,l]=ET(s,o);return{leave:()=>{s!==o&&(e.dispatchUIEvent(s,"mouseout",a),c.forEach(u=>e.dispatchUIEvent(u,"mouseleave",a)))},enter:()=>{s!==o&&(e.dispatchUIEvent(o,"mouseover",a),l.forEach(u=>e.dispatchUIEvent(u,"mouseenter",a)))},move:()=>{r||(e.dispatchUIEvent(o,"mousemove",a),this.modifySelecting(e))}}}down(e,n,r){const i=this.buttons.down(n);if(i===void 0)return;const s=this.getTarget(e);this.buttonDownTarget[i]=s;const o=this.getEventInit("mousedown",n.button),a=fg(s);!r&&(a||e.dispatchUIEvent(s,"mousedown",o))&&(this.startSelecting(e,o.detail),y_(s)),!a&&VU(n.button)===2&&e.dispatchUIEvent(s,"contextmenu",this.getEventInit("contextmenu",n.button))}up(e,n,r){const i=this.buttons.up(n);if(i===void 0)return;const s=this.getTarget(e);if(!fg(s)){if(!r){const a=this.getEventInit("mouseup",n.button);e.dispatchUIEvent(s,"mouseup",a),this.endSelecting()}const o=ET(this.buttonDownTarget[i],s)[2][0];if(o){const a=this.getEventInit("click",n.button);a.detail&&(e.dispatchUIEvent(o,a.button===0?"click":"auxclick",a),a.button===0&&a.detail===2&&e.dispatchUIEvent(o,"dblclick",{...this.getEventInit("dblclick",n.button),detail:a.detail}))}}}resetClickCount(){this.clickCount.reset()}getEventInit(e,n){const r={...this.position.coords};return r.button=VU(n),r.buttons=this.buttons.getButtons(),e==="mousedown"?r.detail=this.clickCount.getOnDown(r.button):e==="mouseup"?r.detail=this.clickCount.getOnUp(r.button):(e==="click"||e==="auxclick")&&(r.detail=this.clickCount.incOnClick(r.button)),r}getTarget(e){var n;return(n=this.position.target)!==null&&n!==void 0?n:e.config.document.body}startSelecting(e,n){var r,i;this.selecting=qBe({document:e.config.document,target:this.getTarget(e),node:(r=this.position.caret)===null||r===void 0?void 0:r.node,offset:(i=this.position.caret)===null||i===void 0?void 0:i.offset,clickCount:n})}modifySelecting(e){var n,r;this.selecting&&YBe(this.selecting,{document:e.config.document,target:this.getTarget(e),node:(n=this.position.caret)===null||n===void 0?void 0:n.node,offset:(r=this.position.caret)===null||r===void 0?void 0:r.offset})}endSelecting(){this.selecting=void 0}constructor(){p0(this,"position",{}),p0(this,"buttons",new $J),p0(this,"selecting",void 0),p0(this,"buttonDownTarget",{}),p0(this,"clickCount",new class{incOnClick(e){const n=this.down[e]===void 0?void 0:Number(this.down[e])+1;return this.count=this.count[e]===void 0?{}:{[e]:Number(this.count[e])+1},n}getOnDown(e){var n;this.down={[e]:(n=this.count[e])!==null&&n!==void 0?n:0};var r;return this.count={[e]:(r=this.count[e])!==null&&r!==void 0?r:0},Number(this.count[e])+1}getOnUp(e){return this.down[e]===void 0?void 0:Number(this.down[e])+1}reset(){this.count={}}constructor(){p0(this,"down",{}),p0(this,"count",{})}})}}function lA(t,e){var n;return((n=zJ(t,e))===null||n===void 0?void 0:n.pointerEvents)!=="none"}function JBe(t){const e=zd(t);for(let n=t,r=[];n!=null&&n.ownerDocument;n=n.parentElement){r.push(n);const i=e.getComputedStyle(n).pointerEvents;if(i&&!["inherit","unset"].includes(i))return{pointerEvents:i,tree:r}}}const $V=Symbol("Last check for pointer-events");function zJ(t,e){const n=e[$V];if(!(t.config.pointerEventsCheck!==WC.Never&&(!n||HV(t.config.pointerEventsCheck,WC.EachApiCall)&&n[Bu.Call]!==X1(t,Bu.Call)||HV(t.config.pointerEventsCheck,WC.EachTrigger)&&n[Bu.Trigger]!==X1(t,Bu.Trigger))))return n==null?void 0:n.result;const i=JBe(e);return e[$V]={[Bu.Call]:X1(t,Bu.Call),[Bu.Trigger]:X1(t,Bu.Trigger),result:i},i}function lT(t,e){const n=zJ(t,e);if((n==null?void 0:n.pointerEvents)==="none")throw new Error([`Unable to perform pointer interaction as the element ${n.tree.length>1?"inherits":"has"} \`pointer-events: none\`:`,"",QBe(n.tree)].join(`
`))}function QBe(t){return t.reverse().map((e,n)=>["".padEnd(n),e.tagName,e.id&&`#${e.id}`,e.hasAttribute("data-testid")&&`(testId=${e.getAttribute("data-testid")})`,ZBe(e),t.length>1&&n===0&&"  <-- This element declared `pointer-events: none`",t.length>1&&n===t.length-1&&"  <-- Asserted pointer events here"].filter(Boolean).join("")).join(`
`)}function ZBe(t){var e;let n;if(t.hasAttribute("aria-label"))n=t.getAttribute("aria-label");else if(t.hasAttribute("aria-labelledby")){var r,i;n=(i=t.ownerDocument.getElementById(t.getAttribute("aria-labelledby")))===null||i===void 0||(r=i.textContent)===null||r===void 0?void 0:r.trim()}else if(Qr(t,["button","input","meter","output","progress","select","textarea"])&&(!((e=t.labels)===null||e===void 0)&&e.length))n=Array.from(t.labels).map(o=>{var a;return(a=o.textContent)===null||a===void 0?void 0:a.trim()}).join("|");else if(Qr(t,"button")){var s;n=(s=t.textContent)===null||s===void 0?void 0:s.trim()}return n=n==null?void 0:n.replace(/\n/g,"  "),Number(n==null?void 0:n.length)>30&&(n=`${n==null?void 0:n.substring(0,29)}…`),n?`(label=${n})`:""}function HV(t,e){return(t&e)>0}function Fm(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class e3e{init(e){const n=this.getTarget(e),[,r]=ET(null,n),i=this.getEventInit();return lT(e,n),e.dispatchUIEvent(n,"pointerover",i),r.forEach(s=>e.dispatchUIEvent(s,"pointerenter",i)),this}move(e,n){const r=this.position,i=this.getTarget(e);if(this.position=n,!VJ(r,n))return;const s=this.getTarget(e),o=this.getEventInit(-1),[a,c]=ET(i,s);return{leave:()=>{lA(e,i)&&i!==s&&(e.dispatchUIEvent(i,"pointerout",o),a.forEach(l=>e.dispatchUIEvent(l,"pointerleave",o)))},enter:()=>{lT(e,s),i!==s&&(e.dispatchUIEvent(s,"pointerover",o),c.forEach(l=>e.dispatchUIEvent(l,"pointerenter",o)))},move:()=>{e.dispatchUIEvent(s,"pointermove",o)}}}down(e,n=0){if(this.isDown)return;const r=this.getTarget(e);lT(e,r),this.isDown=!0,this.isPrevented=!e.dispatchUIEvent(r,"pointerdown",this.getEventInit(n))}up(e,n=0){if(!this.isDown)return;const r=this.getTarget(e);lT(e,r),this.isPrevented=!1,this.isDown=!1,e.dispatchUIEvent(r,"pointerup",this.getEventInit(n))}release(e){const n=this.getTarget(e),[r]=ET(n,null),i=this.getEventInit();lA(e,n)&&(e.dispatchUIEvent(n,"pointerout",i),r.forEach(s=>e.dispatchUIEvent(s,"pointerleave",i))),this.isCancelled=!0}getTarget(e){var n;return(n=this.position.target)!==null&&n!==void 0?n:e.config.document.body}getEventInit(e){return{...this.position.coords,pointerId:this.pointerId,pointerType:this.pointerType,isPrimary:this.isPrimary,button:VU(e),buttons:this.buttons.getButtons()}}constructor({pointerId:e,pointerType:n,isPrimary:r},i){Fm(this,"pointerId",void 0),Fm(this,"pointerType",void 0),Fm(this,"isPrimary",void 0),Fm(this,"buttons",void 0),Fm(this,"isMultitouch",!1),Fm(this,"isCancelled",!1),Fm(this,"isDown",!1),Fm(this,"isPrevented",!1),Fm(this,"position",{}),this.pointerId=e,this.pointerType=n,this.isPrimary=r,this.isMultitouch=!r,this.buttons=i}}function Ev(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class t3e{isKeyPressed(e){return this.devices.get(e.pointerType).isPressed(e)}async press(e,n,r){this.devices.get(n.pointerType).addPressed(n),this.buttons.down(n);const i=this.getPointerName(n),s=n.pointerType==="touch"?this.pointers.new(i,n.pointerType,this.buttons):this.pointers.get(i);s.position=r,s.pointerType!=="touch"&&(this.mouse.position=r),s.pointerType==="touch"&&s.init(e),s.down(e,n.button),s.pointerType!=="touch"&&this.mouse.down(e,n,s.isPrevented)}async move(e,n,r){const i=this.pointers.get(n),s=i.move(e,r),o=i.pointerType==="touch"?void 0:this.mouse.move(e,r,i.isPrevented);s==null||s.leave(),o==null||o.leave(),s==null||s.enter(),o==null||o.enter(),s==null||s.move(),o==null||o.move()}async release(e,n,r){const i=this.devices.get(n.pointerType);i.removePressed(n),this.buttons.up(n);const s=this.pointers.get(this.getPointerName(n)),o=s.isPrevented;if(s.position=r,s.pointerType!=="touch"&&(this.mouse.position=r),i.countPressed===0&&s.up(e,n.button),s.pointerType==="touch"&&s.release(e),s.pointerType==="touch"&&!s.isMultitouch){const a=this.mouse.move(e,r,o);a==null||a.leave(),a==null||a.enter(),a==null||a.move(),this.mouse.down(e,n,o)}if(!s.isMultitouch){const a=this.mouse.move(e,r,o);a==null||a.leave(),a==null||a.enter(),a==null||a.move(),this.mouse.up(e,n,o)}}getPointerName(e){return e.pointerType==="touch"?e.name:e.pointerType}getPreviousPosition(e){return this.pointers.has(e)?this.pointers.get(e).position:void 0}resetClickCount(){this.mouse.resetClickCount()}getMouseTarget(e){var n;return(n=this.mouse.position.target)!==null&&n!==void 0?n:e.config.document.body}setMousePosition(e){this.mouse.position=e,this.pointers.get("mouse").position=e}constructor(e){Ev(this,"system",void 0),Ev(this,"mouse",void 0),Ev(this,"buttons",void 0),Ev(this,"devices",new class{get(n){var r,i,s;return(s=(r=this.registry)[i=n])!==null&&s!==void 0?s:r[i]=new WBe}constructor(){Ev(this,"registry",{})}}),Ev(this,"pointers",new class{new(n,r,i){const s=r!=="touch"||!Object.values(this.registry).some(o=>o.pointerType==="touch"&&!o.isCancelled);return s||Object.values(this.registry).forEach(o=>{o.pointerType===r&&!o.isCancelled&&(o.isMultitouch=!0)}),this.registry[n]=new e3e({pointerId:this.nextId++,pointerType:r,isPrimary:s},i),this.registry[n]}get(n){if(!this.has(n))throw new Error(`Trying to access pointer "${n}" which does not exist.`);return this.registry[n]}has(n){return n in this.registry}constructor(){Ev(this,"registry",{}),Ev(this,"nextId",1)}}),this.system=e,this.buttons=new $J,this.mouse=new XBe,this.pointers.new("mouse","mouse",this.buttons)}}function VV(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class GJ{getUIEventModifiers(){return{altKey:this.keyboard.modifiers.Alt,ctrlKey:this.keyboard.modifiers.Control,metaKey:this.keyboard.modifiers.Meta,shiftKey:this.keyboard.modifiers.Shift,modifierAltGraph:this.keyboard.modifiers.AltGraph,modifierCapsLock:this.keyboard.modifiers.CapsLock,modifierFn:this.keyboard.modifiers.Fn,modifierFnLock:this.keyboard.modifiers.FnLock,modifierNumLock:this.keyboard.modifiers.NumLock,modifierScrollLock:this.keyboard.modifiers.ScrollLock,modifierSymbol:this.keyboard.modifiers.Symbol,modifierSymbolLock:this.keyboard.modifiers.SymbolLock}}constructor(){VV(this,"keyboard",new $Be(this)),VV(this,"pointer",new t3e(this))}}async function n3e(t){const e=[];return this.config.skipHover||e.push({target:t}),e.push({keys:"[MouseLeft]",target:t}),this.pointer(e)}async function r3e(t){return this.pointer([{target:t},"[MouseLeft][MouseLeft]"])}async function i3e(t){return this.pointer([{target:t},"[MouseLeft][MouseLeft][MouseLeft]"])}async function s3e(t){return this.pointer({target:t})}async function o3e(t){return lT(this,this.system.pointer.getMouseTarget(this)),this.pointer({target:t.ownerDocument.body})}async function a3e({shift:t}={}){return this.keyboard(t===!0?"{Shift>}{Tab}{/Shift}":t===!1?"[/ShiftLeft][/ShiftRight]{Tab}":"{Tab}")}var J3=function(t){return t["{"]="}",t["["]="]",t}(J3||{});function WJ(t,e){let n=0;const r=t[n]in J3?t[n]:"";n+=r.length;const s=new RegExp(`^\\${r}{2}`).test(t)?"":r;return{type:s,...s===""?c3e(t,n,e):l3e(t,n,s,e)}}function c3e(t,e,n){const r=t[e];return qJ(r,t,e,n),e+=r.length,{consumedLength:e,descriptor:r,releasePrevious:!1,releaseSelf:!0,repeat:1}}function l3e(t,e,n,r){var i,s;const o=t[e]==="/"?"/":"";e+=o.length;const a=n==="{"&&t[e]==="\\";e+=Number(a);const c=a?t[e]:(i=t.slice(e).match(n==="{"?/^\w+|^[^}>/]/:/^\w+/))===null||i===void 0?void 0:i[0];qJ(c,t,e,r),e+=c.length;var l;const u=(l=(s=t.slice(e).match(/^>\d+/))===null||s===void 0?void 0:s[0])!==null&&l!==void 0?l:"";e+=u.length;const d=t[e]==="/"||!u&&t[e]===">"?t[e]:"";e+=d.length;const h=J3[n],p=t[e]===h?h:"";if(!p)throw new Error(KJ([!u&&"repeat modifier",!d&&"release modifier",`"${h}"`].filter(Boolean).join(" or "),t[e],t,r));return e+=p.length,{consumedLength:e,descriptor:c,releasePrevious:!!o,repeat:u?Math.max(Number(u.substr(1)),1):1,releaseSelf:u3e(d,u)}}function qJ(t,e,n,r){if(!t)throw new Error(KJ("key descriptor",e[n],e,r))}function u3e(t,e){if(t)return t==="/";if(e)return!1}function KJ(t,e,n,r){return`Expected ${t} but found "${e??""}" in "${n}"
    See ${r==="pointer"?"https://testing-library.com/docs/user-event/pointer#pressing-a-button-or-touching-the-screen":"https://testing-library.com/docs/user-event/keyboard"}
    for more information about how userEvent parses your input.`}function d3e(t,e){const n=[];do{const{type:i,descriptor:s,consumedLength:o,releasePrevious:a,releaseSelf:c=!0,repeat:l}=WJ(e,"keyboard");var r;const u=(r=t.find(d=>{if(i==="["){var h;return((h=d.code)===null||h===void 0?void 0:h.toLowerCase())===s.toLowerCase()}else if(i==="{"){var p;return((p=d.key)===null||p===void 0?void 0:p.toLowerCase())===s.toLowerCase()}return d.key===s}))!==null&&r!==void 0?r:{key:"Unknown",code:"Unknown",[i==="["?"code":"key"]:s};n.push({keyDef:u,releasePrevious:a,releaseSelf:c,repeat:l}),e=e.slice(o)}while(e);return n}async function h3e(t){const e=d3e(this.config.keyboardMap,t);for(let n=0;n<e.length;n++)await qE(this.config),await f3e(this,e[n])}async function f3e(t,{keyDef:e,releasePrevious:n,releaseSelf:r,repeat:i}){const{system:s}=t;if(s.keyboard.isKeyPressed(e)&&await s.keyboard.keyup(t,e),!n){for(let o=1;o<=i;o++)await s.keyboard.keydown(t,e),o<i&&await qE(t.config);r&&await s.keyboard.keyup(t,e)}}async function p3e(t){for(const e of t.system.keyboard.getPressedKeys())await t.system.keyboard.keyup(t,e)}function YJ(t){const e=Dp(t)?{"text/plain":m3e(t)}:{"text/plain":String(t.ownerDocument.getSelection())},n=N3(zd(t));for(const r in e)e[r]&&n.setData(r,e[r]);return n}function m3e(t){const e=iw(t);return Lp(t).substring(e.startOffset,e.endOffset)}async function g3e(){const t=this.config.document;var e;const n=(e=t.activeElement)!==null&&e!==void 0?e:t.body,r=YJ(n);if(r.items.length!==0)return this.dispatchUIEvent(n,"copy",{clipboardData:r})&&this.config.writeToClipboard&&await GY(t,r),r}async function v3e(){const t=this.config.document;var e;const n=(e=t.activeElement)!==null&&e!==void 0?e:t.body,r=YJ(n);if(r.items.length!==0)return this.dispatchUIEvent(n,"cut",{clipboardData:r})&&this.config.writeToClipboard&&await GY(n.ownerDocument,r),r}async function _3e(t){const e=this.config.document;var n;const r=(n=e.activeElement)!==null&&n!==void 0?n:e.body;var i;const s=(i=typeof t=="string"?y3e(e,t):t)!==null&&i!==void 0?i:await gCe(e).catch(()=>{throw new Error("`userEvent.paste()` without `clipboardData` requires the `ClipboardAPI` to be available.")});this.dispatchUIEvent(r,"paste",{clipboardData:s})}function y3e(t,e){const n=N3(zd(t));return n.setData("text",e),n}function zV(t,e){const n=[];do{const{descriptor:r,consumedLength:i,releasePrevious:s,releaseSelf:o=!0}=WJ(e,"pointer"),a=t.find(c=>c.name===r);a&&n.push({keyDef:a,releasePrevious:s,releaseSelf:o}),e=e.slice(i)}while(e);return n}async function b3e(t){const{pointerMap:e}=this.config,n=[];(Array.isArray(t)?t:[t]).forEach(r=>{typeof r=="string"?n.push(...zV(e,r)):"keys"in r?n.push(...zV(e,r.keys).map(i=>({...r,...i}))):n.push(r)});for(let r=0;r<n.length;r++)await qE(this.config),await E3e(this,n[r]);this.system.pointer.resetClickCount()}async function E3e(t,e){var n,r;const i="pointerName"in e&&e.pointerName?e.pointerName:"keyDef"in e?t.system.pointer.getPointerName(e.keyDef):"mouse",s=t.system.pointer.getPreviousPosition(i);var o,a,c,l;const u={target:(o=e.target)!==null&&o!==void 0?o:S3e(t,s),coords:(a=e.coords)!==null&&a!==void 0?a:s==null?void 0:s.coords,caret:{node:(c=e.node)!==null&&c!==void 0?c:GV(e)||s==null||(n=s.caret)===null||n===void 0?void 0:n.node,offset:(l=e.offset)!==null&&l!==void 0?l:GV(e)||s==null||(r=s.caret)===null||r===void 0?void 0:r.offset}};"keyDef"in e?(t.system.pointer.isKeyPressed(e.keyDef)&&(cT(t,Bu.Trigger),await t.system.pointer.release(t,e.keyDef,u)),e.releasePrevious||(cT(t,Bu.Trigger),await t.system.pointer.press(t,e.keyDef,u),e.releaseSelf&&(cT(t,Bu.Trigger),await t.system.pointer.release(t,e.keyDef,u)))):(cT(t,Bu.Trigger),await t.system.pointer.move(t,i,u))}function GV(t){var e,n;return!!((n=(e=t.target)!==null&&e!==void 0?e:t.node)!==null&&n!==void 0?n:t.offset!==void 0)}function S3e(t,e){if(!e)throw new Error("This pointer has no previous position. Provide a target property!");var n;return(n=e.target)!==null&&n!==void 0?n:t.config.document.body}async function T3e(t){if(!HE(t)||fg(t))throw new Error("clear()` is only supported on editable elements.");if(y_(t),t.ownerDocument.activeElement!==t)throw new Error("The element to be cleared could not be focused.");if(PJ(t),!_Be(t))throw new Error("The element content to be cleared could not be selected.");WE(this,t,"","deleteContentBackward")}async function w3e(t,e){return XJ.call(this,!0,t,e)}async function x3e(t,e){return XJ.call(this,!1,t,e)}async function XJ(t,e,n){if(!t&&!e.multiple)throw ji().getElementError("Unable to deselect an option in a non-multiple select. Use selectOptions to change the selection instead.",e);const r=Array.isArray(n)?n:[n],i=Array.from(e.querySelectorAll('option, [role="option"]')),s=r.map(a=>{if(typeof a!="string"&&i.includes(a))return a;{const c=i.find(l=>l.value===a||l.innerHTML===a);if(c)return c;throw ji().getElementError(`Value "${String(a)}" not found in options`,e)}}).filter(a=>!fg(a));if(fg(e)||!s.length)return;const o=a=>{a.selected=t,this.dispatchUIEvent(e,"input",{bubbles:!0,cancelable:!1,composed:!0}),this.dispatchUIEvent(e,"change")};if(Qr(e,"select"))if(e.multiple)for(const a of s){const c=this.config.pointerEventsCheck===0?!0:lA(this,a);c&&(this.dispatchUIEvent(a,"pointerover"),this.dispatchUIEvent(e,"pointerenter"),this.dispatchUIEvent(a,"mouseover"),this.dispatchUIEvent(e,"mouseenter"),this.dispatchUIEvent(a,"pointermove"),this.dispatchUIEvent(a,"mousemove"),this.dispatchUIEvent(a,"pointerdown"),this.dispatchUIEvent(a,"mousedown")),y_(e),c&&(this.dispatchUIEvent(a,"pointerup"),this.dispatchUIEvent(a,"mouseup")),o(a),c&&this.dispatchUIEvent(a,"click"),await qE(this.config)}else if(s.length===1){const a=this.config.pointerEventsCheck===0?!0:lA(this,e);a?await this.click(e):y_(e),o(s[0]),a&&(this.dispatchUIEvent(e,"pointerover"),this.dispatchUIEvent(e,"pointerenter"),this.dispatchUIEvent(e,"mouseover"),this.dispatchUIEvent(e,"mouseenter"),this.dispatchUIEvent(e,"pointerup"),this.dispatchUIEvent(e,"mouseup"),this.dispatchUIEvent(e,"click")),await qE(this.config)}else throw ji().getElementError("Cannot select multiple options on a non-multiple select",e);else if(e.getAttribute("role")==="listbox")for(const a of s)await this.click(a),await this.unhover(a);else throw ji().getElementError("Cannot select options on elements that are neither select nor listbox elements",e)}async function C3e(t,e,{skipClick:n=this.config.skipClick,skipAutoClose:r=this.config.skipAutoClose,initialSelectionStart:i,initialSelectionEnd:s}={}){t.disabled||(n||await this.click(t),i!==void 0&&aT(t,i,s??i),await this.keyboard(e),r||await p3e(this))}const WV=Symbol("files and value properties are mocked");function gD(t,e,n){n?Object.defineProperty(t,e,n):delete t[e]}function R3e(t,e){var n;(n=t[WV])===null||n===void 0||n.restore();const r=Object.getOwnPropertyDescriptor(t,"type"),i=Object.getOwnPropertyDescriptor(t,"value"),s=Object.getOwnPropertyDescriptor(t,"files");function o(){gD(t,"type",r),gD(t,"value",i),gD(t,"files",s)}t[WV]={restore:o},Object.defineProperties(t,{files:{configurable:!0,get:()=>e},value:{configurable:!0,get:()=>e.length?`C:\\fakepath\\${e[0].name}`:"",set(a){if(a==="")o();else{var c;i==null||(c=i.set)===null||c===void 0||c.call(t,a)}}},type:{configurable:!0,get:()=>"file",set(a){a!=="file"&&(o(),t.type=a)}}})}async function A3e(t,e){const n=Qr(t,"label")?t.control:t;if(!n||!Qr(n,"input",{type:"file"}))throw new TypeError(`The ${n===t?"given":"associated"} ${n==null?void 0:n.tagName} element does not accept file uploads`);if(fg(t))return;const r=(Array.isArray(e)?e:[e]).filter(s=>!this.config.applyAccept||M3e(s,n.accept)).slice(0,n.multiple?void 0:1),i=()=>{var s;r.length===((s=n.files)===null||s===void 0?void 0:s.length)&&r.every((o,a)=>{var c;return o===((c=n.files)===null||c===void 0?void 0:c.item(a))})||(R3e(n,k3(zd(t),r)),this.dispatchUIEvent(n,"input"),this.dispatchUIEvent(n,"change"))};n.addEventListener("fileDialog",i),await this.click(t),n.removeEventListener("fileDialog",i)}function J1(t){return t.toLowerCase().replace(/(\.|\/)jpg\b/g,"$1jpeg")}function M3e(t,e){if(!e)return!0;const n=["audio/*","image/*","video/*"];return J1(e).trim().split(/\s*,\s*/).some(r=>r.startsWith(".")?J1(t.name).endsWith(r):n.includes(r)?J1(t.type).startsWith(r.replace("*","")):J1(t.type)===r)}const qV={click:n3e,dblClick:r3e,tripleClick:i3e,hover:s3e,unhover:o3e,tab:a3e,keyboard:h3e,copy:g3e,cut:v3e,paste:_3e,pointer:b3e,clear:T3e,deselectOptions:x3e,selectOptions:w3e,type:C3e,upload:A3e};function I3e(t){return ji().asyncWrapper(t)}const JJ={applyAccept:!0,autoModify:!0,delay:0,document:globalThis.document,keyboardMap:HBe,pointerMap:VBe,pointerEventsCheck:WC.EachApiCall,skipAutoClose:!1,skipClick:!1,skipHover:!1,writeToClipboard:!1,advanceTimers:()=>Promise.resolve()},O3e={...JJ,writeToClipboard:!0};function QJ(t={},e=O3e,n){const r=D3e(t,n,e);return{...e,...t,document:r}}function k3e(t={}){const e=QJ(t);jJ(e.document),BJ(zd(e.document).HTMLElement);var n;const r=(n=e.document.defaultView)!==null&&n!==void 0?n:globalThis.window;return fCe(r),Q3(e).api}function Zc({keyboardState:t,pointerState:e,...n}={},r){const i=QJ(n,JJ,r);jJ(i.document),BJ(zd(i.document).HTMLElement);var s;const o=(s=e??t)!==null&&s!==void 0?s:new GJ;return{api:Q3(i,o).api,system:o}}function N3e(t){return Q3({...this.config,...t},this.system).api}function P3e(t,e){function n(...r){return cT(t,Bu.Call),I3e(()=>e.apply(t,r).then(async i=>(await qE(t.config),i)))}return Object.defineProperty(n,"name",{get:()=>e.name}),n}function Q3(t,e=new GJ){const n={};return Object.assign(n,{config:t,dispatchEvent:FJ.bind(n),dispatchUIEvent:kBe.bind(n),system:e,levelRefs:{},...qV}),{instance:n,api:{...Object.fromEntries(Object.entries(qV).map(([r,i])=>[r,P3e(n,i)])),setup:N3e.bind(n)}}}function D3e(t,e,n){var r,i;return(i=(r=t.document)!==null&&r!==void 0?r:e&&UBe(e))!==null&&i!==void 0?i:n.document}function L3e(t){return Zc().api.clear(t)}function U3e(t,e={}){return Zc(e,t).api.click(t)}function F3e(t={}){return Zc(t).api.copy()}function B3e(t={}){return Zc(t).api.cut()}function j3e(t,e={}){return Zc(e).api.dblClick(t)}function $3e(t,e,n={}){return Zc(n).api.deselectOptions(t,e)}function H3e(t,e={}){return Zc(e).api.hover(t)}async function V3e(t,e={}){const{api:n,system:r}=Zc(e);return n.keyboard(t).then(()=>r)}async function z3e(t,e={}){const{api:n,system:r}=Zc(e);return n.pointer(t).then(()=>r)}function G3e(t,e){return Zc(e).api.paste(t)}function W3e(t,e,n={}){return Zc(n).api.selectOptions(t,e)}function q3e(t,e={}){return Zc(e).api.tripleClick(t)}function K3e(t,e,n={}){return Zc(n,t).api.type(t,e,n)}function Y3e(t,e={}){const{api:n,system:r}=Zc(e);return r.pointer.setMousePosition({target:t}),n.unhover(t)}function X3e(t,e,n={}){return Zc(n).api.upload(t,e)}function J3e(t={}){return Zc().api.tab(t)}const Q3e=Object.freeze(Object.defineProperty({__proto__:null,clear:L3e,click:U3e,copy:F3e,cut:B3e,dblClick:j3e,deselectOptions:$3e,hover:H3e,keyboard:V3e,paste:G3e,pointer:z3e,selectOptions:W3e,tab:J3e,tripleClick:q3e,type:K3e,unhover:Y3e,upload:X3e},Symbol.toStringTag,{value:"Module"})),Z3e={...Q3e,setup:k3e},Fu=Z3e.setup({delay:null});function ua(){return window.sysclipboard}async function GU(t){const e=new FormData;e.append("url",t);const n=new Request("https://bytes.zed.cafe",{method:"POST",body:e});return await(await fetch(n)).text()}function ZJ(){return window.location.href.includes("/join/")}function WU(){return window.location.href.includes("/locked/")}function Z3(t){const e=new Set;function n(s){sde(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),OT.invoke(s))}const r=Xh("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){OT.disconnect(r)}return{forward:n,disconnect:i}}function e4e(t){return new Worker("/assets/simspace-D6Oshdub.js",{name:t==null?void 0:t.name})}function t4e(t){return new Worker("/assets/stubspace-C7v-KsMS.js",{name:t==null?void 0:t.name})}let Q1;function n4e(t=!1){if(!he(Q1)){Q1=t?new t4e:new e4e;const{forward:e}=Z3(n=>Q1.postMessage(n));Q1.addEventListener("message",n=>e(n.data))}}async function r4e(t){return Kde(t)}async function i4e(t,e){return Yde(t,e)}function s4e(t){try{return sessionStorage.getItem(t)??void 0}catch(e){ai(Hr,`readsession ${t}`,e.message)}}function o4e(t,e){try{he(e)?sessionStorage.setItem(t,e):sessionStorage.removeItem(t)}catch(n){ai(Hr,`writesession ${t} <- ${e}`,n.message)}}function qU(){try{const t=location.hash.slice(1);if(t.length)return t}catch(t){ai(Hr,"crash",t.message)}return""}async function KU(t){if(t.length===0){ai(Hr,"content","no content found"),zW(Hr,io);return}const e=await c4e()??"";Nde(Hr,t,e,io)}let uA="";window.addEventListener("hashchange",()=>{eu(Hr,async()=>{const t=qU();uA!==t&&(uA=t,await KU(t))})});function a4e(t,e){const n=`#${t}`;if(location.hash!==n){uA=t,location.hash=n;const r=`wrote ${(t==null?void 0:t.length)??0} chars [${t.slice(0,8)}...${t.slice(-8)}]`;e.includes("autosave")?Tde(Hr,r):(e.length&&(document.title=e),gp(Hr,r))}}async function c4e(){return r4e("SELECTED")}async function l4e(t){return i4e("SELECTED",()=>t)}let vD=0;const KV=1,io=s4e("PLAYER")??lhe();o4e("PLAYER",io);function Ni(){return io}const Hr=Xh("register",["ready","second","error"],function(t){if(Hr.session(t))switch(t.target){case"ready":{eu(Hr,async()=>{await Zf(256),Ar(Hr,`myplayerid ${io}`),Ode(Hr,io)});break}case"error:login:main":case"error:login:title":case"error:login:player":t.player===io&&(zW(Hr,io),Cw(Hr,"#pages",io));break;case"ackoperator":{t.player===io&&eu(Hr,async()=>{const e=qU();ZJ()?fde(Hr,e,io):(kde(Hr,WU(),io),await KU(e))});break}case"loginready":t.player===io&&Pde(Hr,io);break;case"acklogin":t.player===io&&(wR(Hr,io),ude(Hr,io));break;case"dev":t.player===io&&eu(Hr,async function(){if(WU()){const e=await GU(location.href);qR(Hr,e,e)}else sp(Hr,"creating locked terminal"),await Zf(100),location.href=location.href.replace("/#","/locked/#")});break;case"share":t.player===io&&eu(Hr,async function(){const e=await GU(location.href.replace(/cafe.*locked/,"cafe"));qR(Hr,e,e)});break;case"nuke":t.player===io&&eu(Hr,async function(){sp(Hr,"nuke in"),ti(Hr,"3","..."),await Zf(1e3),ti(Hr,"2","..."),await Zf(1e3),ti(Hr,"1","..."),await Zf(1e3),sp(Hr,"BYE"),await Zf(100),location.hash="",uA=location.hash,location.reload()});break;case"savemem":if(t.player===io&&qr(t.data)){const[e,n]=t.data;nr(e)&&nr(n)&&a4e(n,e)}break;case"select":t.player===io&&eu(Hr,async()=>{nr(t.player)&&nr(t.data)&&(await l4e(t.data),await KU(qU()))});break;case"second":++vD,vD>=KV&&(vD-=KV,Lde(Hr,Ni()));break;default:if(t.player===io){const{target:e,path:n}=sM(t.target);switch(e){case"touchkey":eu(Hr,async()=>{switch(n){case"[Alt]":Mv(Hr,"-c",!0),ou.setState(r=>({...r,keyboardalt:!r.keyboardalt,keyboardctrl:!1,keyboardshift:!1}));break;case"[Ctrl]":Mv(Hr,"-e",!0),ou.setState(r=>({...r,keyboardalt:!1,keyboardctrl:!r.keyboardctrl,keyboardshift:!1}));break;case"[Shift]":Mv(Hr,"-g",!0),ou.setState(r=>({...r,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!r.keyboardshift}));break;default:{const r=!isNaN(parseInt(n,10)),i=ou.getState(),s=[],o=Xw?"Meta":"Ctrl";i.keyboardshift?(Mv(Hr,r?"+c":"+f",!0),s.push("{Shift>}")):i.keyboardalt?(Mv(Hr,r?"+c!":"+f!",!0),s.push("{Alt>}")):i.keyboardctrl?(Mv(Hr,r?"+c#":"+f#",!0),s.push(`{${o}>}`)):Mv(Hr,r?"-c":"-f",!0),s.push(n),i.keyboardshift?s.push("{/Shift}"):i.keyboardalt?s.push("{/Alt}"):i.keyboardctrl&&s.push(`{/${o}}`);const a=s.join("");await Fu.keyboard(a);break}}});break}}break}});setTimeout(function(){n4e(ZJ())},100);function ay(t){"@babel/helpers - typeof";return ay=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ay(t)}function Hu(){Hu=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(Z,ie,G){Z[ie]=G.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(Z,ie,G){return Object.defineProperty(Z,ie,{value:G,enumerable:!0,configurable:!0,writable:!0}),Z[ie]}try{l({},"")}catch{l=function(G,Q,se){return G[Q]=se}}function u(Z,ie,G,Q){var se=ie&&ie.prototype instanceof E?ie:E,ve=Object.create(se.prototype),Oe=new X(Q||[]);return i(ve,"_invoke",{value:$(Z,G,Oe)}),ve}function d(Z,ie,G){try{return{type:"normal",arg:Z.call(ie,G)}}catch(Q){return{type:"throw",arg:Q}}}e.wrap=u;var h="suspendedStart",p="suspendedYield",f="executing",g="completed",y={};function E(){}function w(){}function R(){}var A={};l(A,o,function(){return this});var k=Object.getPrototypeOf,I=k&&k(k(ne([])));I&&I!==n&&r.call(I,o)&&(A=I);var N=R.prototype=E.prototype=Object.create(A);function U(Z){["next","throw","return"].forEach(function(ie){l(Z,ie,function(G){return this._invoke(ie,G)})})}function F(Z,ie){function G(se,ve,Oe,_e){var le=d(Z[se],Z,ve);if(le.type!=="throw"){var xe=le.arg,Ee=xe.value;return Ee&&ay(Ee)=="object"&&r.call(Ee,"__await")?ie.resolve(Ee.__await).then(function(Se){G("next",Se,Oe,_e)},function(Se){G("throw",Se,Oe,_e)}):ie.resolve(Ee).then(function(Se){xe.value=Se,Oe(xe)},function(Se){return G("throw",Se,Oe,_e)})}_e(le.arg)}var Q;i(this,"_invoke",{value:function(ve,Oe){function _e(){return new ie(function(le,xe){G(ve,Oe,le,xe)})}return Q=Q?Q.then(_e,_e):_e()}})}function $(Z,ie,G){var Q=h;return function(se,ve){if(Q===f)throw Error("Generator is already running");if(Q===g){if(se==="throw")throw ve;return{value:t,done:!0}}for(G.method=se,G.arg=ve;;){var Oe=G.delegate;if(Oe){var _e=q(Oe,G);if(_e){if(_e===y)continue;return _e}}if(G.method==="next")G.sent=G._sent=G.arg;else if(G.method==="throw"){if(Q===h)throw Q=g,G.arg;G.dispatchException(G.arg)}else G.method==="return"&&G.abrupt("return",G.arg);Q=f;var le=d(Z,ie,G);if(le.type==="normal"){if(Q=G.done?g:p,le.arg===y)continue;return{value:le.arg,done:G.done}}le.type==="throw"&&(Q=g,G.method="throw",G.arg=le.arg)}}}function q(Z,ie){var G=ie.method,Q=Z.iterator[G];if(Q===t)return ie.delegate=null,G==="throw"&&Z.iterator.return&&(ie.method="return",ie.arg=t,q(Z,ie),ie.method==="throw")||G!=="return"&&(ie.method="throw",ie.arg=new TypeError("The iterator does not provide a '"+G+"' method")),y;var se=d(Q,Z.iterator,ie.arg);if(se.type==="throw")return ie.method="throw",ie.arg=se.arg,ie.delegate=null,y;var ve=se.arg;return ve?ve.done?(ie[Z.resultName]=ve.value,ie.next=Z.nextLoc,ie.method!=="return"&&(ie.method="next",ie.arg=t),ie.delegate=null,y):ve:(ie.method="throw",ie.arg=new TypeError("iterator result is not an object"),ie.delegate=null,y)}function K(Z){var ie={tryLoc:Z[0]};1 in Z&&(ie.catchLoc=Z[1]),2 in Z&&(ie.finallyLoc=Z[2],ie.afterLoc=Z[3]),this.tryEntries.push(ie)}function W(Z){var ie=Z.completion||{};ie.type="normal",delete ie.arg,Z.completion=ie}function X(Z){this.tryEntries=[{tryLoc:"root"}],Z.forEach(K,this),this.reset(!0)}function ne(Z){if(Z||Z===""){var ie=Z[o];if(ie)return ie.call(Z);if(typeof Z.next=="function")return Z;if(!isNaN(Z.length)){var G=-1,Q=function se(){for(;++G<Z.length;)if(r.call(Z,G))return se.value=Z[G],se.done=!1,se;return se.value=t,se.done=!0,se};return Q.next=Q}}throw new TypeError(ay(Z)+" is not iterable")}return w.prototype=R,i(N,"constructor",{value:R,configurable:!0}),i(R,"constructor",{value:w,configurable:!0}),w.displayName=l(R,c,"GeneratorFunction"),e.isGeneratorFunction=function(Z){var ie=typeof Z=="function"&&Z.constructor;return!!ie&&(ie===w||(ie.displayName||ie.name)==="GeneratorFunction")},e.mark=function(Z){return Object.setPrototypeOf?Object.setPrototypeOf(Z,R):(Z.__proto__=R,l(Z,c,"GeneratorFunction")),Z.prototype=Object.create(N),Z},e.awrap=function(Z){return{__await:Z}},U(F.prototype),l(F.prototype,a,function(){return this}),e.AsyncIterator=F,e.async=function(Z,ie,G,Q,se){se===void 0&&(se=Promise);var ve=new F(u(Z,ie,G,Q),se);return e.isGeneratorFunction(ie)?ve:ve.next().then(function(Oe){return Oe.done?Oe.value:ve.next()})},U(N),l(N,c,"Generator"),l(N,o,function(){return this}),l(N,"toString",function(){return"[object Generator]"}),e.keys=function(Z){var ie=Object(Z),G=[];for(var Q in ie)G.push(Q);return G.reverse(),function se(){for(;G.length;){var ve=G.pop();if(ve in ie)return se.value=ve,se.done=!1,se}return se.done=!0,se}},e.values=ne,X.prototype={constructor:X,reset:function(ie){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(W),!ie)for(var G in this)G.charAt(0)==="t"&&r.call(this,G)&&!isNaN(+G.slice(1))&&(this[G]=t)},stop:function(){this.done=!0;var ie=this.tryEntries[0].completion;if(ie.type==="throw")throw ie.arg;return this.rval},dispatchException:function(ie){if(this.done)throw ie;var G=this;function Q(xe,Ee){return Oe.type="throw",Oe.arg=ie,G.next=xe,Ee&&(G.method="next",G.arg=t),!!Ee}for(var se=this.tryEntries.length-1;se>=0;--se){var ve=this.tryEntries[se],Oe=ve.completion;if(ve.tryLoc==="root")return Q("end");if(ve.tryLoc<=this.prev){var _e=r.call(ve,"catchLoc"),le=r.call(ve,"finallyLoc");if(_e&&le){if(this.prev<ve.catchLoc)return Q(ve.catchLoc,!0);if(this.prev<ve.finallyLoc)return Q(ve.finallyLoc)}else if(_e){if(this.prev<ve.catchLoc)return Q(ve.catchLoc,!0)}else{if(!le)throw Error("try statement without catch or finally");if(this.prev<ve.finallyLoc)return Q(ve.finallyLoc)}}}},abrupt:function(ie,G){for(var Q=this.tryEntries.length-1;Q>=0;--Q){var se=this.tryEntries[Q];if(se.tryLoc<=this.prev&&r.call(se,"finallyLoc")&&this.prev<se.finallyLoc){var ve=se;break}}ve&&(ie==="break"||ie==="continue")&&ve.tryLoc<=G&&G<=ve.finallyLoc&&(ve=null);var Oe=ve?ve.completion:{};return Oe.type=ie,Oe.arg=G,ve?(this.method="next",this.next=ve.finallyLoc,y):this.complete(Oe)},complete:function(ie,G){if(ie.type==="throw")throw ie.arg;return ie.type==="break"||ie.type==="continue"?this.next=ie.arg:ie.type==="return"?(this.rval=this.arg=ie.arg,this.method="return",this.next="end"):ie.type==="normal"&&G&&(this.next=G),y},finish:function(ie){for(var G=this.tryEntries.length-1;G>=0;--G){var Q=this.tryEntries[G];if(Q.finallyLoc===ie)return this.complete(Q.completion,Q.afterLoc),W(Q),y}},catch:function(ie){for(var G=this.tryEntries.length-1;G>=0;--G){var Q=this.tryEntries[G];if(Q.tryLoc===ie){var se=Q.completion;if(se.type==="throw"){var ve=se.arg;W(Q)}return ve}}throw Error("illegal catch attempt")},delegateYield:function(ie,G,Q){return this.delegate={iterator:ne(ie),resultName:G,nextLoc:Q},this.method==="next"&&(this.arg=t),y}},e}function YV(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(l){return void n(l)}a.done?e(c):Promise.resolve(c).then(r,i)}function dE(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(c){YV(s,r,i,o,a,"next",c)}function a(c){YV(s,r,i,o,a,"throw",c)}o(void 0)})}}function u4e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d4e(t,e){if(ay(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ay(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function eQ(t){var e=d4e(t,"string");return ay(e)=="symbol"?e:e+""}function h4e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,eQ(r.key),r)}}function f4e(t,e,n){return e&&h4e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ep(t,e,n){return(e=eQ(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const qC={"ar-SA":["ar-SA-HamedNeural","ar-SA-ZariyahNeural"],"de-DE":["de-DE-AmalaNeural","de-DE-ConradNeural","de-DE-KatjaNeural","de-DE-KillianNeural"],"en-US":["en-US-AriaNeural","en-US-AnaNeural","en-US-ChristopherNeural","en-US-EricNeural","en-US-GuyNeural","en-US-JennyNeural","en-US-MichelleNeural","en-US-RogerNeural","en-US-SteffanNeural"],"es-ES":["es-ES-AlvaroNeural","es-ES-ElviraNeural"],"fr-FR":["fr-FR-DeniseNeural","fr-FR-EloiseNeural","fr-FR-HenriNeural"],"ja-JP":["ja-JP-KeitaNeural","ja-JP-NanamiNeural"],"ko-KR":["ko-KR-InJoonNeural","ko-KR-SunHiNeural"],"pt-BR":["pt-BR-AntonioNeural","pt-BR-FranciscaNeural"],"ru-RU":["ru-RU-DmitryNeural","ru-RU-SvetlanaNeural"],"zh-CN":["zh-CN-XiaoxiaoNeural","zh-CN-XiaoyiNeural","zh-CN-YunjianNeural","zh-CN-liaoning-XiaobeiNeural","zh-CN-shaanxi-XiaoniNeural","zh-CN-YunxiNeural","zh-CN-YunxiaNeural","zh-CN-YunyangNeural"],"zh-TW":["zh-TW-HsiaoChenNeural","zh-TW-YunJheNeural","zh-TW-HsiaoYuNeural"]},KC={"ar-SA-HamedNeural":"حامد","ar-SA-ZariyahNeural":"زارية","de-DE-AmalaNeural":"Amala","de-DE-BerndNeural":"Bernd","de-DE-ChristophNeural":"Christoph","de-DE-ConradNeural":"Conrad","de-DE-ElkeNeural":"Elke","de-DE-GiselaNeural":"Gisela","de-DE-KasperNeural":"Kasper","de-DE-KatjaNeural":"Katja","de-DE-KillianNeural":"Killian","de-DE-KlarissaNeural":"Klarissa","de-DE-KlausNeural":"Klaus","de-DE-LouisaNeural":"Louisa","de-DE-MajaNeural":"Maja","de-DE-RalfNeural":"Ralf","de-DE-TanjaNeural":"Tanja","en-US-AIGenerate1Neural":"AIGenerate1","en-US-AIGenerate2Neural":"AIGenerate2","en-US-AmberNeural":"Amber","en-US-AnaNeural":"Ana","en-US-AndrewNeural":"Andrew","en-US-AriaNeural":"Aria","en-US-AshleyNeural":"Ashley","en-US-BlueNeural":"Blue","en-US-BrandonNeural":"Brandon","en-US-BrianNeural":"Brian","en-US-ChristopherNeural":"Christopher","en-US-CoraNeural":"Cora","en-US-DavisNeural":"Davis","en-US-ElizabethNeural":"Elizabeth","en-US-EmmaNeural":"Emma","en-US-EricNeural":"Eric","en-US-GuyNeural":"Guy","en-US-JacobNeural":"Jacob","en-US-JaneNeural":"Jane","en-US-JasonNeural":"Jason","en-US-JennyMultilingualNeural":"Jenny Multilingual","en-US-JennyMultilingualV2Neural":"Jenny Multilingual V2","en-US-JennyNeural":"Jenny","en-US-MichelleNeural":"Michelle","en-US-MonicaNeural":"Monica","en-US-NancyNeural":"Nancy","en-US-RogerNeural":"Roger","en-US-RyanMultilingualNeural":"Ryan Multilingual","en-US-SaraNeural":"Sara","en-US-SteffanNeural":"Steffan","en-US-TonyNeural":"Tony","es-ES-AbrilNeural":"Abril","es-ES-AlvaroNeural":"Álvaro","es-ES-ArnauNeural":"Arnau","es-ES-DarioNeural":"Dario","es-ES-EliasNeural":"Elias","es-ES-ElviraNeural":"Elvira","es-ES-EstrellaNeural":"Estrella","es-ES-IreneNeural":"Irene","es-ES-LaiaNeural":"Laia","es-ES-LiaNeural":"Lia","es-ES-NilNeural":"Nil","es-ES-SaulNeural":"Saul","es-ES-TeoNeural":"Teo","es-ES-TrianaNeural":"Triana","es-ES-VeraNeural":"Vera","fr-FR-AlainNeural":"Alain","fr-FR-BrigitteNeural":"Brigitte","fr-FR-CelesteNeural":"Celeste","fr-FR-ClaudeNeural":"Claude","fr-FR-CoralieNeural":"Coralie","fr-FR-DeniseNeural":"Denise","fr-FR-EloiseNeural":"Eloise","fr-FR-HenriNeural":"Henri","fr-FR-JacquelineNeural":"Jacqueline","fr-FR-JeromeNeural":"Jerome","fr-FR-JosephineNeural":"Josephine","fr-FR-MauriceNeural":"Maurice","fr-FR-YvesNeural":"Yves","fr-FR-YvetteNeural":"Yvette","ja-JP-AoiNeural":"碧衣","ja-JP-DaichiNeural":"大智","ja-JP-KeitaNeural":"圭太","ja-JP-MayuNeural":"真夕","ja-JP-NanamiNeural":"七海","ja-JP-NaokiNeural":"直紀","ja-JP-ShioriNeural":"志織","ko-KR-BongJinNeural":"봉진","ko-KR-GookMinNeural":"국민","ko-KR-InJoonNeural":"인준","ko-KR-JiMinNeural":"지민","ko-KR-SeoHyeonNeural":"서현","ko-KR-SoonBokNeural":"순복","ko-KR-SunHiNeural":"선히","ko-KR-YuJinNeural":"유진","pt-BR-AntonioNeural":"Antônio","pt-BR-BrendaNeural":"Brenda","pt-BR-DonatoNeural":"Donato","pt-BR-ElzaNeural":"Elza","pt-BR-FabioNeural":"Fabio","pt-BR-FranciscaNeural":"Francisca","pt-BR-GiovannaNeural":"Giovanna","pt-BR-HumbertoNeural":"Humberto","pt-BR-JulioNeural":"Julio","pt-BR-LeilaNeural":"Leila","pt-BR-LeticiaNeural":"Leticia","pt-BR-ManuelaNeural":"Manuela","pt-BR-NicolauNeural":"Nicolau","pt-BR-ValerioNeural":"Valerio","pt-BR-YaraNeural":"Yara","ru-RU-DariyaNeural":"Дария","ru-RU-DmitryNeural":"Дмитрий","ru-RU-SvetlanaNeural":"Светлана","wuu-CN-XiaotongNeural":"晓彤","wuu-CN-YunzheNeural":"云哲","yue-CN-XiaoMinNeural":"晓敏","yue-CN-YunSongNeural":"云松","zh-CN-XiaochenNeural":"晓辰","zh-CN-XiaohanNeural":"晓涵","zh-CN-XiaomengNeural":"晓梦","zh-CN-XiaomoNeural":"晓墨","zh-CN-XiaoqiuNeural":"晓秋","zh-CN-XiaorouNeural":"晓柔","zh-CN-XiaoruiNeural":"晓睿","zh-CN-XiaoshuangNeural":"晓双","zh-CN-XiaoxiaoNeural":"晓晓","zh-CN-XiaoxuanNeural":"晓萱","zh-CN-XiaoyanNeural":"晓颜","zh-CN-XiaoyiNeural":"晓伊","zh-CN-XiaoyouNeural":"晓悠","zh-CN-XiaozhenNeural":"晓甄","zh-CN-YunfengNeural":"云枫","zh-CN-YunhaoNeural":"云皓","zh-CN-YunjianNeural":"云健","zh-CN-YunjieNeural":"云杰","zh-CN-YunxiNeural":"云希","zh-CN-YunxiaNeural":"云夏","zh-CN-YunyangNeural":"云扬","zh-CN-YunyeNeural":"云野","zh-CN-YunzeNeural":"云泽","zh-CN-guangxi-YunqiNeural":"云奇","zh-CN-henan-YundengNeural":"云登","zh-CN-liaoning-XiaobeiNeural":"晓北","zh-CN-liaoning-YunbiaoNeural":"云彪","zh-CN-shaanxi-XiaoniNeural":"晓妮","zh-CN-shandong-YunxiangNeural":"云翔","zh-CN-sichuan-YunxiNeural":"云希","zh-TW-HsiaoChenNeural":"曉臻","zh-TW-HsiaoYuNeural":"曉雨","zh-TW-YunJheNeural":"雲哲"};var p4e=function(){var t=dE(Hu().mark(function e(n){var r;return Hu().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=new AudioContext,s.next=3,r.decodeAudioData(n);case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}},e)}));return function(n){return t.apply(this,arguments)}}();function m4e(t){if(Array.isArray(t))return t}function g4e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(n=n.call(t)).next,e!==0)for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function XV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function tQ(t,e){if(t){if(typeof t=="string")return XV(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?XV(t,e):void 0}}function v4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e4(t,e){return m4e(t)||g4e(t,e)||tQ(t,e)||v4e()}const _4e={"ar-SA":"العربية","de-DE":"Deutsch","en-US":"English","es-ES":"Español","fr-FR":"Français","ja-JP":"日本語","ko-KR":"한국어","pt-BR":"Português","ru-RU":"Русский","zh-CN":"简体中文","zh-TW":"繁體中文"};var y4e=function(){return Object.entries(_4e).map(function(e){var n=e4(e,2),r=n[0],i=n[1];return{label:i,value:r}})};const nQ="%[a-f0-9]{2}",JV=new RegExp("("+nQ+")|([^%]+?)","gi"),QV=new RegExp("("+nQ+")+","gi");function YU(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;const n=t.slice(0,e),r=t.slice(e);return Array.prototype.concat.call([],YU(n),YU(r))}function b4e(t){try{return decodeURIComponent(t)}catch{let e=t.match(JV)||[];for(let n=1;n<e.length;n++)t=YU(e,n).join(""),e=t.match(JV)||[];return t}}function E4e(t){const e={"%FE%FF":"��","%FF%FE":"��"};let n=QV.exec(t);for(;n;){try{e[n[0]]=decodeURIComponent(n[0])}catch{const i=b4e(n[0]);i!==n[0]&&(e[n[0]]=i)}n=QV.exec(t)}e["%C2"]="�";const r=Object.keys(e);for(const i of r)t=t.replace(new RegExp(i,"g"),e[i]);return t}function S4e(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return decodeURIComponent(t)}catch{return E4e(t)}}function T4e(t,e){const n={};if(Array.isArray(e))for(const r of e){const i=Object.getOwnPropertyDescriptor(t,r);i!=null&&i.enumerable&&Object.defineProperty(n,r,i)}else for(const r of Reflect.ownKeys(t)){const i=Object.getOwnPropertyDescriptor(t,r);if(i.enumerable){const s=t[r];e(r,s,t)&&Object.defineProperty(n,r,i)}}return n}function rQ(t,e){if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t===""||e==="")return[];const n=t.indexOf(e);return n===-1?[]:[t.slice(0,n),t.slice(n+e.length)]}const w4e=t=>t==null,x4e=t=>encodeURIComponent(t).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),XU=Symbol("encodeFragmentIdentifier");function C4e(t){switch(t.arrayFormat){case"index":return e=>(n,r)=>{const i=n.length;return r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[oa(e,t),"[",i,"]"].join("")]:[...n,[oa(e,t),"[",oa(i,t),"]=",oa(r,t)].join("")]};case"bracket":return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[oa(e,t),"[]"].join("")]:[...n,[oa(e,t),"[]=",oa(r,t)].join("")];case"colon-list-separator":return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[oa(e,t),":list="].join("")]:[...n,[oa(e,t),":list=",oa(r,t)].join("")];case"comma":case"separator":case"bracket-separator":{const e=t.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(r,i)=>i===void 0||t.skipNull&&i===null||t.skipEmptyString&&i===""?r:(i=i===null?"":i,r.length===0?[[oa(n,t),e,oa(i,t)].join("")]:[[r,oa(i,t)].join(t.arrayFormatSeparator)])}default:return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,oa(e,t)]:[...n,[oa(e,t),"=",oa(r,t)].join("")]}}function R4e(t){let e;switch(t.arrayFormat){case"index":return(n,r,i)=>{if(e=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!e){i[n]=r;return}i[n]===void 0&&(i[n]={}),i[n][e[1]]=r};case"bracket":return(n,r,i)=>{if(e=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!e){i[n]=r;return}if(i[n]===void 0){i[n]=[r];return}i[n]=[...i[n],r]};case"colon-list-separator":return(n,r,i)=>{if(e=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!e){i[n]=r;return}if(i[n]===void 0){i[n]=[r];return}i[n]=[...i[n],r]};case"comma":case"separator":return(n,r,i)=>{const s=typeof r=="string"&&r.includes(t.arrayFormatSeparator),o=typeof r=="string"&&!s&&Wm(r,t).includes(t.arrayFormatSeparator);r=o?Wm(r,t):r;const a=s||o?r.split(t.arrayFormatSeparator).map(c=>Wm(c,t)):r===null?r:Wm(r,t);i[n]=a};case"bracket-separator":return(n,r,i)=>{const s=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!s){i[n]=r&&Wm(r,t);return}const o=r===null?[]:Wm(r,t).split(t.arrayFormatSeparator);if(i[n]===void 0){i[n]=o;return}i[n]=[...i[n],...o]};default:return(n,r,i)=>{if(i[n]===void 0){i[n]=r;return}i[n]=[...[i[n]].flat(),r]}}}function iQ(t){if(typeof t!="string"||t.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function oa(t,e){return e.encode?e.strict?x4e(t):encodeURIComponent(t):t}function Wm(t,e){return e.decode?S4e(t):t}function sQ(t){return Array.isArray(t)?t.sort():typeof t=="object"?sQ(Object.keys(t)).sort((e,n)=>Number(e)-Number(n)).map(e=>t[e]):t}function oQ(t){const e=t.indexOf("#");return e!==-1&&(t=t.slice(0,e)),t}function A4e(t){let e="";const n=t.indexOf("#");return n!==-1&&(e=t.slice(n)),e}function ZV(t,e,n){return n==="string"&&typeof t=="string"?t:typeof n=="function"&&typeof t=="string"?n(t):e.parseBooleans&&t!==null&&(t.toLowerCase()==="true"||t.toLowerCase()==="false")?t.toLowerCase()==="true":n==="number"&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""||e.parseNumbers&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""?Number(t):t}function t4(t){t=oQ(t);const e=t.indexOf("?");return e===-1?"":t.slice(e+1)}function n4(t,e){e={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null),...e},iQ(e.arrayFormatSeparator);const n=R4e(e),r=Object.create(null);if(typeof t!="string"||(t=t.trim().replace(/^[?#&]/,""),!t))return r;for(const i of t.split("&")){if(i==="")continue;const s=e.decode?i.replaceAll("+"," "):i;let[o,a]=rQ(s,"=");o===void 0&&(o=s),a=a===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?a:Wm(a,e),n(Wm(o,e),a,r)}for(const[i,s]of Object.entries(r))if(typeof s=="object"&&s!==null&&e.types[i]!=="string")for(const[o,a]of Object.entries(s)){const c=e.types[i]?e.types[i].replace("[]",""):void 0;s[o]=ZV(a,e,c)}else typeof s=="object"&&s!==null&&e.types[i]==="string"?r[i]=Object.values(s).join(e.arrayFormatSeparator):r[i]=ZV(s,e,e.types[i]);return e.sort===!1?r:(e.sort===!0?Object.keys(r).sort():Object.keys(r).sort(e.sort)).reduce((i,s)=>{const o=r[s];return i[s]=o&&typeof o=="object"&&!Array.isArray(o)?sQ(o):o,i},Object.create(null))}function aQ(t,e){if(!t)return"";e={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...e},iQ(e.arrayFormatSeparator);const n=o=>e.skipNull&&w4e(t[o])||e.skipEmptyString&&t[o]==="",r=C4e(e),i={};for(const[o,a]of Object.entries(t))n(o)||(i[o]=a);const s=Object.keys(i);return e.sort!==!1&&s.sort(e.sort),s.map(o=>{const a=t[o];return a===void 0?"":a===null?oa(o,e):Array.isArray(a)?a.length===0&&e.arrayFormat==="bracket-separator"?oa(o,e)+"[]":a.reduce(r(o),[]).join("&"):oa(o,e)+"="+oa(a,e)}).filter(o=>o.length>0).join("&")}function cQ(t,e){var i;e={decode:!0,...e};let[n,r]=rQ(t,"#");return n===void 0&&(n=t),{url:((i=n==null?void 0:n.split("?"))==null?void 0:i[0])??"",query:n4(t4(t),e),...e&&e.parseFragmentIdentifier&&r?{fragmentIdentifier:Wm(r,e)}:{}}}function lQ(t,e){e={encode:!0,strict:!0,[XU]:!0,...e};const n=oQ(t.url).split("?")[0]||"",r=t4(t.url),i={...n4(r,{sort:!1}),...t.query};let s=aQ(i,e);s&&(s=`?${s}`);let o=A4e(t.url);if(typeof t.fragmentIdentifier=="string"){const a=new URL(n);a.hash=t.fragmentIdentifier,o=e[XU]?a.hash:`#${t.fragmentIdentifier}`}return`${n}${s}${o}`}function uQ(t,e,n){n={parseFragmentIdentifier:!0,[XU]:!1,...n};const{url:r,query:i,fragmentIdentifier:s}=cQ(t,n);return lQ({url:r,query:T4e(i,e),fragmentIdentifier:s},n)}function M4e(t,e,n){const r=Array.isArray(e)?i=>!e.includes(i):(i,s)=>!e(i,s);return uQ(t,r,n)}const I4e=Object.freeze(Object.defineProperty({__proto__:null,exclude:M4e,extract:t4,parse:n4,parseUrl:cQ,pick:uQ,stringify:aQ,stringifyUrl:lQ},Symbol.toStringTag,{value:"Module"}));var Cc=[];for(var _D=0;_D<256;++_D)Cc.push((_D+256).toString(16).slice(1));function O4e(t,e=0){return(Cc[t[e+0]]+Cc[t[e+1]]+Cc[t[e+2]]+Cc[t[e+3]]+"-"+Cc[t[e+4]]+Cc[t[e+5]]+"-"+Cc[t[e+6]]+Cc[t[e+7]]+"-"+Cc[t[e+8]]+Cc[t[e+9]]+"-"+Cc[t[e+10]]+Cc[t[e+11]]+Cc[t[e+12]]+Cc[t[e+13]]+Cc[t[e+14]]+Cc[t[e+15]]).toLowerCase()}var Z1,k4e=new Uint8Array(16);function N4e(){if(!Z1&&(Z1=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Z1))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Z1(k4e)}var P4e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const e8={randomUUID:P4e};function D4e(t,e,n){if(e8.randomUUID&&!e&&!t)return e8.randomUUID();t=t||{};var r=t.random||(t.rng||N4e)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,O4e(r)}var L4e=function(e,n){var r=n.voice;return'<voice name="'.concat(r,'">').concat(e,"</voice>")},U4e=function(e,n){var r=n.style;return r?'<mstts:express-as style="'.concat(r,'">').concat(e,"</mstts:express-as>"):e},F4e=function(e,n){var r=n.pitch,i=n.rate;return!r&&!i?e:'<prosody pitch="'.concat(Math.floor((r||1)*100),'%" rate="').concat(Math.floor((i||1)*100),'%">').concat(e,"</prosody>")},B4e=function(e){return'<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="https://www.w3.org/2001/mstts" xml:lang="en-US">'.concat(e,"</speak>")},j4e=function(e,n){var r=F4e(e,n);return r=U4e(r,n),r=L4e(r,n),r=B4e(r),r},t8=function(e,n){for(var r=[],i=0,s=Object.entries(e);i<s.length;i++){var o=e4(s[i],2),a=o[0],c=o[1];r.push("".concat(a,":").concat(c))}return r.push("",n),r.join(`\r
`)};function $4e(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=tQ(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}var H4e=function(e){var n={},r=$4e(e.slice(0,e.indexOf(`\r
\r
`)).split(`\r
`)),i;try{for(r.s();!(i=r.n()).done;){var s=i.value,o=s.split(":",2),a=e4(o,2),c=a[0],l=a[1];n[c]=l}}catch(u){r.e(u)}finally{r.f()}return{data:e.slice(e.indexOf(`\r
\r
`)+4),headers:n}},V4e="wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1",z4e="6A5AA1D4EAFF4E9FB37E23D68491D6F4",G4e=JSON.stringify({context:{synthesis:{audio:{metadataoptions:{sentenceBoundaryEnabled:!1,wordBoundaryEnabled:!0},outputFormat:"audio-24khz-48kbitrate-mono-mp3"}}}}),W4e=function(e){var n=new Date().toString(),r={"Content-Type":"application/json; charset=utf-8",Path:"speech.config","X-Timestamp":n},i={"Content-Type":"application/ssml+xml",Path:"ssml","X-RequestId":e,"X-Timestamp":n};return{configHeader:r,contentHeader:i}},dQ=function(){var t=dE(Hu().mark(function e(n){var r,i,s,o,a,c,l,u,d,h,p,f,g,y=arguments;return Hu().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return r=n.payload,i=y.length>1&&y[1]!==void 0?y[1]:{},s=i.proxyUrl,o=i.token,a=r.input,c=r.options,l=D4e().replaceAll("-",""),u=I4e.stringifyUrl({query:{ConnectionId:l,TrustedClientToken:o||z4e},url:s||V4e}),d=W4e(l),h=d.configHeader,p=d.contentHeader,f=t8(h,G4e),g=t8(p,j4e(a,c)),w.abrupt("return",new Promise(function(R,A){var k=new WebSocket(u);k.binaryType="arraybuffer";var I=function(){k.send(f),k.send(g)},N=new ArrayBuffer(0),U=function(){var $=dE(Hu().mark(function q(K){var W,X,ne,Z,ie,G,Q,se;return Hu().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if(typeof K.data!="string"){Oe.next=13;break}W=H4e(K.data),X=W.headers,Oe.t0=X.Path,Oe.next=Oe.t0==="turn.end"?5:11;break;case 5:if(k.close(),N.byteLength){Oe.next=8;break}return Oe.abrupt("return");case 8:return ne=new Response(N),R(ne),Oe.abrupt("break",11);case 11:Oe.next=14;break;case 13:K.data instanceof ArrayBuffer&&(Z=new DataView(K.data),ie=Z.getInt16(0),K.data.byteLength>ie+2&&(G=K.data.slice(2+ie),Q=new ArrayBuffer(N.byteLength+G.byteLength),se=new Uint8Array(Q),se.set(new Uint8Array(N),0),se.set(new Uint8Array(G),N.byteLength),N=Q));case 14:case"end":return Oe.stop()}},q)}));return function(K){return $.apply(this,arguments)}}(),F=function(){A(new Error("WebSocket error occurred.")),k.close()};k.addEventListener("open",I),k.addEventListener("message",U),k.addEventListener("error",F)}));case 9:case"end":return w.stop()}},e)}));return function(n){return t.apply(this,arguments)}}(),q4e=function(e){var n=e&&qC[e]?qC[e]||[]:lu(Object.values(qC));return n.map(function(r){return{label:(KC==null?void 0:KC[r])||r,value:r}})},fx=function(){function t(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.serviceUrl,i=n.locale,s=n.headers;u4e(this,t),ep(this,"locale",void 0),ep(this,"serviceUrl",void 0),ep(this,"headers",void 0),ep(this,"fetch",function(){var o=dE(Hu().mark(function a(c){var l;return Hu().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,e.serviceUrl?fetch(e.serviceUrl,{body:JSON.stringify(c),headers:e.headers,method:"POST"}):dQ({payload:c});case 2:return l=d.sent,d.abrupt("return",l);case 4:case"end":return d.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),ep(this,"create",function(){var o=dE(Hu().mark(function a(c){return Hu().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",e.fetch(c));case 1:case"end":return u.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),ep(this,"createAudio",function(){var o=dE(Hu().mark(function a(c){var l,u;return Hu().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,e.create(c);case 2:return l=h.sent,h.next=5,l.arrayBuffer();case 5:return u=h.sent,h.abrupt("return",p4e(u));case 7:case"end":return h.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),this.locale=i,this.serviceUrl=r,this.headers=s}return f4e(t,[{key:"voiceOptions",get:function(){return q4e(this.locale)}}]),t}();ep(fx,"localeOptions",y4e());ep(fx,"voiceList",qC);ep(fx,"voiceName",KC);ep(fx,"createRequest",dQ);const hQ="15.0.4",n8=(t,e,n)=>({endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}),r8=(t,e,n)=>({endTime:e,insertTime:n,type:"linearRampToValue",value:t}),JU=(t,e)=>({startTime:e,type:"setValue",value:t}),fQ=(t,e,n)=>({duration:n,startTime:e,type:"setValueCurve",values:t}),pQ=(t,e,{startTime:n,target:r,timeConstant:i})=>r+(e-r)*Math.exp((n-t)/i),Wb=t=>t.type==="exponentialRampToValue",dA=t=>t.type==="linearRampToValue",Fv=t=>Wb(t)||dA(t),r4=t=>t.type==="setValue",Gm=t=>t.type==="setValueCurve",hA=(t,e,n,r)=>{const i=t[e];return i===void 0?r:Fv(i)||r4(i)?i.value:Gm(i)?i.values[i.values.length-1]:pQ(n,hA(t,e-1,i.startTime,r),i)},i8=(t,e,n,r,i)=>n===void 0?[r.insertTime,i]:Fv(n)?[n.endTime,n.value]:r4(n)?[n.startTime,n.value]:Gm(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,hA(t,e-1,n.startTime,i)],QU=t=>t.type==="cancelAndHold",ZU=t=>t.type==="cancelScheduledValues",Sv=t=>QU(t)||ZU(t)?t.cancelTime:Wb(t)||dA(t)?t.endTime:t.startTime,s8=(t,e,n,{endTime:r,value:i})=>n===i?i:0<n&&0<i||n<0&&i<0?n*(i/n)**((t-e)/(r-e)):0,o8=(t,e,n,{endTime:r,value:i})=>n+(t-e)/(r-e)*(i-n),K4e=(t,e)=>{const n=Math.floor(e),r=Math.ceil(e);return n===r?t[n]:(1-(e-n))*t[n]+(1-(r-e))*t[r]},Y4e=(t,{duration:e,startTime:n,values:r})=>{const i=(t-n)/e*(r.length-1);return K4e(r,i)},eC=t=>t.type==="setTarget";class X4e{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const n=Sv(e);if(QU(e)||ZU(e)){const r=this._automationEvents.findIndex(s=>ZU(e)&&Gm(s)?s.startTime+s.duration>=n:Sv(s)>=n),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),QU(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Fv(i)){if(s!==void 0&&eC(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:Gm(s)?s.startTime+s.duration:Sv(s),a=s===void 0?this._defaultValue:Gm(s)?s.values[s.values.length-1]:s.value,c=Wb(i)?s8(n,o,a,i):o8(n,o,a,i),l=Wb(i)?n8(c,n,this._currenTime):r8(c,n,this._currenTime);this._automationEvents.push(l)}if(s!==void 0&&eC(s)&&this._automationEvents.push(JU(this.getValue(n),n)),s!==void 0&&Gm(s)&&s.startTime+s.duration>n){const o=n-s.startTime,a=(s.values.length-1)/s.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=s.values.slice(0,c);if(l<1)for(let d=1;d<c;d+=1){const h=l*d%1;u[d]=s.values[d-1]*(1-h)+s.values[d]*h}this._automationEvents[this._automationEvents.length-1]=fQ(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>Sv(o)>n),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&Gm(i)&&Sv(i)+i.duration>n)return!1;const s=Wb(e)?n8(e.value,e.endTime,this._currenTime):dA(e)?r8(e.value,n,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if(Gm(e)&&n+e.duration>Sv(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const n=this._automationEvents.findIndex(r=>Sv(r)>e);if(n>1){const r=this._automationEvents.slice(n-1),i=r[0];eC(i)&&r.unshift(JU(hA(this._automationEvents,n-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const n=this._automationEvents.findIndex(o=>Sv(o)>e),r=this._automationEvents[n],i=(n===-1?this._automationEvents.length:n)-1,s=this._automationEvents[i];if(s!==void 0&&eC(s)&&(r===void 0||!Fv(r)||r.insertTime>e))return pQ(e,hA(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&r4(s)&&(r===void 0||!Fv(r)))return s.value;if(s!==void 0&&Gm(s)&&(r===void 0||!Fv(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?Y4e(e,s):s.values[s.values.length-1];if(s!==void 0&&Fv(s)&&(r===void 0||!Fv(r)))return s.value;if(r!==void 0&&Wb(r)){const[o,a]=i8(this._automationEvents,i,s,r,this._defaultValue);return s8(e,o,a,r)}if(r!==void 0&&dA(r)){const[o,a]=i8(this._automationEvents,i,s,r,this._defaultValue);return o8(e,o,a,r)}return this._defaultValue}}const J4e=t=>({cancelTime:t,type:"cancelAndHold"}),Q4e=t=>({cancelTime:t,type:"cancelScheduledValues"}),Z4e=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),eje=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),tje=(t,e,n)=>({startTime:e,target:t,timeConstant:n,type:"setTarget"}),nje=()=>new DOMException("","AbortError"),rje=t=>(e,n,[r,i,s],o)=>{t(e[i],[n,r,s],a=>a[0]===n&&a[1]===r,o)},ije=t=>(e,n,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:n})},sje=t=>(e,n)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})},KE=new WeakSet,mQ=new WeakMap,i4=new WeakMap,gQ=new WeakMap,s4=new WeakMap,$k=new WeakMap,vQ=new WeakMap,eF=new WeakMap,tF=new WeakMap,nF=new WeakMap,_Q={construct(){return _Q}},oje=t=>{try{const e=new Proxy(t,_Q);new e}catch{return!1}return!0},a8=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,c8=(t,e)=>{const n=[];let r=t.replace(/^[\s]+/,""),i=r.match(a8);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());n.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(a8)}return[n.join(";"),r]},l8=t=>{if(t!==void 0&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},u8=t=>{if(!oje(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(t.prototype===null||typeof t.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},aje=(t,e,n,r,i,s,o,a,c,l,u,d,h)=>{let p=0;return(f,g,y={credentials:"omit"})=>{const E=u.get(f);if(E!==void 0&&E.has(g))return Promise.resolve();const w=l.get(f);if(w!==void 0){const k=w.get(g);if(k!==void 0)return k}const R=s(f),A=R.audioWorklet===void 0?i(g).then(([k,I])=>{const[N,U]=c8(k,I),F=`${N};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${U}
})})(window,'_AWGS')`;return n(F)}).then(()=>{const k=h._AWGS.pop();if(k===void 0)throw new SyntaxError;r(R.currentTime,R.sampleRate,()=>k(class{},void 0,(I,N)=>{if(I.trim()==="")throw e();const U=tF.get(R);if(U!==void 0){if(U.has(I))throw e();u8(N),l8(N.parameterDescriptors),U.set(I,N)}else u8(N),l8(N.parameterDescriptors),tF.set(R,new Map([[I,N]]))},R.sampleRate,void 0,void 0))}):Promise.all([i(g),Promise.resolve(t(d,d))]).then(([[k,I],N])=>{const U=p+1;p=U;const[F,$]=c8(k,I),X=`${F};((AudioWorkletProcessor,registerProcessor)=>{${$}
})(${N?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${N?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${N?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${U}',class extends AudioWorkletProcessor{process(){return !1}})`,ne=new Blob([X],{type:"application/javascript; charset=utf-8"}),Z=URL.createObjectURL(ne);return R.audioWorklet.addModule(Z,y).then(()=>{if(a(R))return R;const ie=o(R);return ie.audioWorklet.addModule(Z,y).then(()=>ie)}).then(ie=>{if(c===null)throw new SyntaxError;try{new c(ie,`__sac${U}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(Z))});return w===void 0?l.set(f,new Map([[g,A]])):w.set(g,A),A.then(()=>{const k=u.get(f);k===void 0?u.set(f,new Set([g])):k.add(g)}).finally(()=>{const k=l.get(f);k!==void 0&&k.delete(g)}),A}},Wh=(t,e)=>{const n=t.get(e);if(n===void 0)throw new Error("A value with the given key could not be found.");return n},Hk=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(n.length===0)throw Error("No element was found.");const[r]=n;return t.delete(r),r},yQ=(t,e,n,r)=>{const i=Wh(t,e),s=Hk(i,o=>o[0]===n&&o[1]===r);return i.size===0&&t.delete(e),s},px=t=>Wh(vQ,t),YE=t=>{if(KE.has(t))throw new Error("The AudioNode is already stored.");KE.add(t),px(t).forEach(e=>e(!0))},bQ=t=>"port"in t,mx=t=>{if(!KE.has(t))throw new Error("The AudioNode is not stored.");KE.delete(t),px(t).forEach(e=>e(!1))},rF=(t,e)=>{!bQ(t)&&e.every(n=>n.size===0)&&mx(t)},cje=(t,e,n,r,i,s,o,a,c,l,u,d,h)=>{const p=new WeakMap;return(f,g,y,E,w)=>{const{activeInputs:R,passiveInputs:A}=s(g),{outputs:k}=s(f),I=a(f),N=U=>{const F=c(g),$=c(f);if(U){const q=yQ(A,f,y,E);t(R,f,q,!1),!w&&!d(f)&&n($,F,y,E),h(g)&&YE(g)}else{const q=r(R,f,y,E);e(A,E,q,!1),!w&&!d(f)&&i($,F,y,E);const K=o(g);if(K===0)u(g)&&rF(g,R);else{const W=p.get(g);W!==void 0&&clearTimeout(W),p.set(g,setTimeout(()=>{u(g)&&rF(g,R)},K*1e3))}}};return l(k,[g,y,E],U=>U[0]===g&&U[1]===y&&U[2]===E,!0)?(I.add(N),u(f)?t(R,f,[y,E,N],!0):e(A,E,[f,y,N],!0),!0):!1}},lje=t=>(e,n,[r,i,s],o)=>{const a=e.get(r);a===void 0?e.set(r,new Set([[i,n,s]])):t(a,[i,n,s],c=>c[0]===i&&c[1]===n,o)},uje=t=>(e,n)=>{const r=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(r).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(r),r.disconnect()};n.addEventListener("ended",i)},dje=t=>(e,n)=>{t(e).add(n)},hje={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},fje=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...hje,...c},d=r(l,u),h=s(l)?e():null;super(a,!1,d,h),this._nativeAnalyserNode=d}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},el=(t,e)=>t.context===e,pje=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!el(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},fA=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Up=()=>new DOMException("","IndexSizeError"),o4=t=>{t.getChannelData=(e=>n=>{try{return e.call(t,n)}catch(r){throw r.code===12?Up():r}})(t.getChannelData)},mje={numberOfChannels:1},gje=(t,e,n,r,i,s,o,a)=>{let c=null;return class EQ{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:d,numberOfChannels:h,sampleRate:p}={...mje,...u};c===null&&(c=new i(1,1,44100));const f=r!==null&&e(s,s)?new r({length:d,numberOfChannels:h,sampleRate:p}):c.createBuffer(h,d,p);if(f.numberOfChannels===0)throw n();return typeof f.copyFromChannel!="function"?(o(f),o4(f)):e(fA,()=>fA(f))||a(f),t.add(f),f}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===EQ.prototype||t.has(u)}}},tu=-34028234663852886e22,Al=-tu,sg=t=>KE.has(t),vje={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},_je=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const d=s(l),h={...vje,...u},p=i(d,h),f=o(d),g=f?e():null;super(l,!1,p,g),this._audioBufferSourceNodeRenderer=g,this._isBufferNullified=!1,this._isBufferSet=h.buffer!==null,this._nativeAudioBufferSourceNode=p,this._onended=null,this._playbackRate=n(this,f,p.playbackRate,Al,tu)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const d=this._nativeAudioBufferSourceNode.onended;this._onended=d!==null&&d===u?l:d}get playbackRate(){return this._playbackRate}start(l=0,u=0,d){if(this._nativeAudioBufferSourceNode.start(l,u,d),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=d===void 0?[l,u]:[l,u,d]),this.context.state!=="closed"){YE(this);const h=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",h),sg(this)&&mx(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",h)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},yje=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let d=n(l);const h=el(d,u);if(!h){const p={buffer:d.buffer,channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,loop:d.loop,loopEnd:d.loopEnd,loopStart:d.loopStart,playbackRate:d.playbackRate.value};d=e(u,p),o!==null&&d.start(...o),a!==null&&d.stop(a)}return s.set(u,d),h?await t(u,l.playbackRate,d.playbackRate):await r(u,l.playbackRate,d.playbackRate),await i(l,u,d),d};return{set start(l){o=l},set stop(l){a=l},render(l,u){const d=s.get(u);return d!==void 0?Promise.resolve(d):c(l,u)}}},bje=t=>"playbackRate"in t,Eje=t=>"frequency"in t&&"gain"in t,Sje=t=>"offset"in t,Tje=t=>!("frequency"in t)&&"gain"in t,wje=t=>"detune"in t&&"frequency"in t&&!("gain"in t),xje=t=>"pan"in t,Ml=t=>Wh(mQ,t),gx=t=>Wh(gQ,t),iF=(t,e)=>{const{activeInputs:n}=Ml(t);n.forEach(i=>i.forEach(([s])=>{e.includes(t)||iF(s,[...e,t])}));const r=bje(t)?[t.playbackRate]:bQ(t)?Array.from(t.parameters.values()):Eje(t)?[t.Q,t.detune,t.frequency,t.gain]:Sje(t)?[t.offset]:Tje(t)?[t.gain]:wje(t)?[t.detune,t.frequency]:xje(t)?[t.pan]:[];for(const i of r){const s=gx(i);s!==void 0&&s.activeInputs.forEach(([o])=>iF(o,e))}sg(t)&&mx(t)},SQ=t=>{iF(t.destination,[])},Cje=t=>t===void 0||typeof t=="number"||typeof t=="string"&&(t==="balanced"||t==="interactive"||t==="playback"),Rje=(t,e,n,r,i,s,o,a,c)=>class extends t{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let d;try{d=new c(u)}catch(f){throw f.code===12&&f.message==="sampleRate is not in range"?n():f}if(d===null)throw r();if(!Cje(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&d.sampleRate!==u.sampleRate)throw n();super(d,2);const{latencyHint:h}=u,{sampleRate:p}=d;if(this._baseLatency=typeof d.baseLatency=="number"?d.baseLatency:h==="balanced"?512/p:h==="interactive"||h===void 0?256/p:h==="playback"?1024/p:Math.max(2,Math.min(128,Math.round(h*p/128)))*128/p,this._nativeAudioContext=d,c.name==="webkitAudioContext"?(this._nativeGainNode=d.createGain(),this._nativeOscillatorNode=d.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(d.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,d.state==="running"){this._state="suspended";const f=()=>{this._state==="suspended"&&(this._state=null),d.removeEventListener("statechange",f)};d.addEventListener("statechange",f)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),SQ(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,d)=>{const h=()=>{this._nativeAudioContext.removeEventListener("statechange",h),this._nativeAudioContext.state==="running"?u():this.resume().then(u,d)};this._nativeAudioContext.addEventListener("statechange",h)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},Aje=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const d=s(l),h=o(d),p=i(d,u,h),f=h?e(a):null;super(l,!1,p,f),this._isNodeOfNativeOfflineAudioContext=h,this._nativeAudioDestinationNode=p}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},Mje=t=>{const e=new WeakMap,n=async(r,i)=>{const s=i.destination;return e.set(i,s),await t(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):n(r,i)}}},Ije=(t,e,n,r,i,s,o,a)=>(c,l)=>{const u=l.listener,d=()=>{const k=new Float32Array(1),I=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),N=o(l);let U=!1,F=[0,0,-1,0,1,0],$=[0,0,0];const q=()=>{if(U)return;U=!0;const ne=r(l,256,9,0);ne.onaudioprocess=({inputBuffer:Z})=>{const ie=[s(Z,k,0),s(Z,k,1),s(Z,k,2),s(Z,k,3),s(Z,k,4),s(Z,k,5)];ie.some((Q,se)=>Q!==F[se])&&(u.setOrientation(...ie),F=ie);const G=[s(Z,k,6),s(Z,k,7),s(Z,k,8)];G.some((Q,se)=>Q!==$[se])&&(u.setPosition(...G),$=G)},I.connect(ne)},K=ne=>Z=>{Z!==F[ne]&&(F[ne]=Z,u.setOrientation(...F))},W=ne=>Z=>{Z!==$[ne]&&($[ne]=Z,u.setPosition(...$))},X=(ne,Z,ie)=>{const G=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Z});G.connect(I,0,ne),G.start(),Object.defineProperty(G.offset,"defaultValue",{get(){return Z}});const Q=t({context:c},N,G.offset,Al,tu);return a(Q,"value",se=>()=>se.call(Q),se=>ve=>{try{se.call(Q,ve)}catch(Oe){if(Oe.code!==9)throw Oe}q(),N&&ie(ve)}),Q.cancelAndHoldAtTime=(se=>N?()=>{throw i()}:(...ve)=>{const Oe=se.apply(Q,ve);return q(),Oe})(Q.cancelAndHoldAtTime),Q.cancelScheduledValues=(se=>N?()=>{throw i()}:(...ve)=>{const Oe=se.apply(Q,ve);return q(),Oe})(Q.cancelScheduledValues),Q.exponentialRampToValueAtTime=(se=>N?()=>{throw i()}:(...ve)=>{const Oe=se.apply(Q,ve);return q(),Oe})(Q.exponentialRampToValueAtTime),Q.linearRampToValueAtTime=(se=>N?()=>{throw i()}:(...ve)=>{const Oe=se.apply(Q,ve);return q(),Oe})(Q.linearRampToValueAtTime),Q.setTargetAtTime=(se=>N?()=>{throw i()}:(...ve)=>{const Oe=se.apply(Q,ve);return q(),Oe})(Q.setTargetAtTime),Q.setValueAtTime=(se=>N?()=>{throw i()}:(...ve)=>{const Oe=se.apply(Q,ve);return q(),Oe})(Q.setValueAtTime),Q.setValueCurveAtTime=(se=>N?()=>{throw i()}:(...ve)=>{const Oe=se.apply(Q,ve);return q(),Oe})(Q.setValueCurveAtTime),Q};return{forwardX:X(0,0,K(0)),forwardY:X(1,0,K(1)),forwardZ:X(2,-1,K(2)),positionX:X(6,0,W(0)),positionY:X(7,0,W(1)),positionZ:X(8,0,W(2)),upX:X(3,0,K(3)),upY:X(4,1,K(4)),upZ:X(5,0,K(5))}},{forwardX:h,forwardY:p,forwardZ:f,positionX:g,positionY:y,positionZ:E,upX:w,upY:R,upZ:A}=u.forwardX===void 0?d():u;return{get forwardX(){return h},get forwardY(){return p},get forwardZ(){return f},get positionX(){return g},get positionY(){return y},get positionZ(){return E},get upX(){return w},get upY(){return R},get upZ(){return A}}},pA=t=>"context"in t,vx=t=>pA(t[0]),Ry=(t,e,n,r)=>{for(const i of t)if(n(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},d8=(t,e,[n,r],i)=>{Ry(t,[e,n,r],s=>s[0]===e&&s[1]===n,i)},h8=(t,[e,n,r],i)=>{const s=t.get(e);s===void 0?t.set(e,new Set([[n,r]])):Ry(s,[n,r],o=>o[0]===n,i)},vS=t=>"inputs"in t,mA=(t,e,n,r)=>{if(vS(e)){const i=e.inputs[r];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,r),[e,n,r]},TQ=(t,e,n)=>{for(const r of t)if(r[0]===e&&r[1]===n)return t.delete(r),r;return null},Oje=(t,e,n)=>Hk(t,r=>r[0]===e&&r[1]===n),wQ=(t,e)=>{if(!px(t).delete(e))throw new Error("Missing the expected event listener.")},xQ=(t,e,n)=>{const r=Wh(t,e),i=Hk(r,s=>s[0]===n);return r.size===0&&t.delete(e),i},gA=(t,e,n,r)=>{vS(e)?t.disconnect(e.inputs[r],n,0):t.disconnect(e,n,r)},Fs=t=>Wh(i4,t),ow=t=>Wh(s4,t),cy=t=>eF.has(t),YC=t=>!KE.has(t),f8=(t,e)=>new Promise(n=>{if(e!==null)n(!0);else{const r=t.createScriptProcessor(256,1,1),i=t.createGain(),s=t.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=t.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(t.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?n(!0):n(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(t.destination)},a.start()}}),yD=(t,e)=>{const n=new Map;for(const r of t)for(const i of r){const s=n.get(i);n.set(i,s===void 0?1:s+1)}n.forEach((r,i)=>e(i,r))},vA=t=>"context"in t,kje=t=>{const e=new Map;t.connect=(n=>(r,i=0,s=0)=>{const o=vA(r)?n(r,i,s):n(r,i),a=e.get(r);return a===void 0?e.set(r,[{input:s,output:i}]):a.every(c=>c.input!==s||c.output!==i)&&a.push({input:s,output:i}),o})(t.connect.bind(t)),t.disconnect=(n=>(r,i,s)=>{if(n.apply(t),r===void 0)e.clear();else if(typeof r=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==r);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(r))if(i===void 0)e.delete(r);else{const o=e.get(r);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==s||s===void 0));a.length===0?e.delete(r):e.set(r,a)}}for(const[o,a]of e)a.forEach(c=>{vA(o)?t.connect(o,c.output,c.input):t.connect(o,c.output)})})(t.disconnect)},Nje=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=gx(e),{outputs:o}=Ml(t),a=px(t),c=l=>{const u=Fs(t),d=ow(e);if(l){const h=xQ(s,t,n);d8(i,t,h,!1),!r&&!cy(t)&&u.connect(d,n)}else{const h=Oje(i,t,n);h8(s,h,!1),!r&&!cy(t)&&u.disconnect(d,n)}};return Ry(o,[e,n],l=>l[0]===e&&l[1]===n,!0)?(a.add(c),sg(t)?d8(i,t,[n,c],!0):h8(s,[t,n,c],!0),!0):!1},Pje=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=Ml(e),o=TQ(i[r],t,n);return o===null?[yQ(s,t,n,r)[2],!1]:[o[2],!0]},Dje=(t,e,n)=>{const{activeInputs:r,passiveInputs:i}=gx(e),s=TQ(r,t,n);return s===null?[xQ(i,t,n)[1],!1]:[s[2],!0]},a4=(t,e,n,r,i)=>{const[s,o]=Pje(t,n,r,i);if(s!==null&&(wQ(t,s),o&&!e&&!cy(t)&&gA(Fs(t),Fs(n),r,i)),sg(n)){const{activeInputs:a}=Ml(n);rF(n,a)}},c4=(t,e,n,r)=>{const[i,s]=Dje(t,n,r);i!==null&&(wQ(t,i),s&&!e&&!cy(t)&&Fs(t).disconnect(ow(n),r))},Lje=(t,e)=>{const n=Ml(t),r=[];for(const i of n.outputs)vx(i)?a4(t,e,...i):c4(t,e,...i),r.push(i[0]);return n.outputs.clear(),r},Uje=(t,e,n)=>{const r=Ml(t),i=[];for(const s of r.outputs)s[1]===n&&(vx(s)?a4(t,e,...s):c4(t,e,...s),i.push(s[0]),r.outputs.delete(s));return i},Fje=(t,e,n,r,i)=>{const s=Ml(t);return Array.from(s.outputs).filter(o=>o[0]===n&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(vx(o)?a4(t,e,...o):c4(t,e,...o),s.outputs.delete(o),o[0]))},Bje=(t,e,n,r,i,s,o,a,c,l,u,d,h,p,f,g)=>class extends l{constructor(E,w,R,A){super(R),this._context=E,this._nativeAudioNode=R;const k=u(E);d(k)&&n(f8,()=>f8(k,g))!==!0&&kje(R),i4.set(this,R),vQ.set(this,new Set),E.state!=="closed"&&w&&YE(this),t(this,A,R)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(E){this._nativeAudioNode.channelCount=E}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(E){this._nativeAudioNode.channelCountMode=E}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(E){this._nativeAudioNode.channelInterpretation=E}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(E,w=0,R=0){if(w<0||w>=this._nativeAudioNode.numberOfOutputs)throw i();const A=u(this._context),k=f(A);if(h(E)||p(E))throw s();if(pA(E)){const U=Fs(E);try{const $=mA(this._nativeAudioNode,U,w,R),q=YC(this);(k||q)&&this._nativeAudioNode.disconnect(...$),this.context.state!=="closed"&&!q&&YC(E)&&YE(E)}catch($){throw $.code===12?s():$}if(e(this,E,w,R,k)){const $=c([this],E);yD($,r(k))}return E}const I=ow(E);if(I.name==="playbackRate"&&I.maxValue===1024)throw o();try{this._nativeAudioNode.connect(I,w),(k||YC(this))&&this._nativeAudioNode.disconnect(I,w)}catch(U){throw U.code===12?s():U}if(Nje(this,E,w,k)){const U=c([this],E);yD(U,r(k))}}disconnect(E,w,R){let A;const k=u(this._context),I=f(k);if(E===void 0)A=Lje(this,I);else if(typeof E=="number"){if(E<0||E>=this.numberOfOutputs)throw i();A=Uje(this,I,E)}else{if(w!==void 0&&(w<0||w>=this.numberOfOutputs)||pA(E)&&R!==void 0&&(R<0||R>=E.numberOfInputs))throw i();if(A=Fje(this,I,E,w,R),A.length===0)throw s()}for(const N of A){const U=c([this],N);yD(U,a)}}},jje=(t,e,n,r,i,s,o,a,c,l,u,d,h)=>(p,f,g,y=null,E=null)=>{const w=g.value,R=new X4e(w),A=f?r(R):null,k={get defaultValue(){return w},get maxValue(){return y===null?g.maxValue:y},get minValue(){return E===null?g.minValue:E},get value(){return g.value},set value(I){g.value=I,k.setValueAtTime(I,p.context.currentTime)},cancelAndHoldAtTime(I){if(typeof g.cancelAndHoldAtTime=="function")A===null&&R.flush(p.context.currentTime),R.add(i(I)),g.cancelAndHoldAtTime(I);else{const N=Array.from(R).pop();A===null&&R.flush(p.context.currentTime),R.add(i(I));const U=Array.from(R).pop();g.cancelScheduledValues(I),N!==U&&U!==void 0&&(U.type==="exponentialRampToValue"?g.exponentialRampToValueAtTime(U.value,U.endTime):U.type==="linearRampToValue"?g.linearRampToValueAtTime(U.value,U.endTime):U.type==="setValue"?g.setValueAtTime(U.value,U.startTime):U.type==="setValueCurve"&&g.setValueCurveAtTime(U.values,U.startTime,U.duration))}return k},cancelScheduledValues(I){return A===null&&R.flush(p.context.currentTime),R.add(s(I)),g.cancelScheduledValues(I),k},exponentialRampToValueAtTime(I,N){if(I===0)throw new RangeError;if(!Number.isFinite(N)||N<0)throw new RangeError;const U=p.context.currentTime;return A===null&&R.flush(U),Array.from(R).length===0&&(R.add(l(w,U)),g.setValueAtTime(w,U)),R.add(o(I,N)),g.exponentialRampToValueAtTime(I,N),k},linearRampToValueAtTime(I,N){const U=p.context.currentTime;return A===null&&R.flush(U),Array.from(R).length===0&&(R.add(l(w,U)),g.setValueAtTime(w,U)),R.add(a(I,N)),g.linearRampToValueAtTime(I,N),k},setTargetAtTime(I,N,U){return A===null&&R.flush(p.context.currentTime),R.add(c(I,N,U)),g.setTargetAtTime(I,N,U),k},setValueAtTime(I,N){return A===null&&R.flush(p.context.currentTime),R.add(l(I,N)),g.setValueAtTime(I,N),k},setValueCurveAtTime(I,N,U){const F=I instanceof Float32Array?I:new Float32Array(I);if(d!==null&&d.name==="webkitAudioContext"){const $=N+U,q=p.context.sampleRate,K=Math.ceil(N*q),W=Math.floor($*q),X=W-K,ne=new Float32Array(X);for(let ie=0;ie<X;ie+=1){const G=(F.length-1)/U*((K+ie)/q-N),Q=Math.floor(G),se=Math.ceil(G);ne[ie]=Q===se?F[Q]:(1-(G-Q))*F[Q]+(1-(se-G))*F[se]}A===null&&R.flush(p.context.currentTime),R.add(u(ne,N,U)),g.setValueCurveAtTime(ne,N,U);const Z=W/q;Z<$&&h(k,ne[ne.length-1],Z),h(k,F[F.length-1],$)}else A===null&&R.flush(p.context.currentTime),R.add(u(F,N,U)),g.setValueCurveAtTime(F,N,U);return k}};return n.set(k,g),e.set(k,p),t(k,A),k},$je=t=>({replay(e){for(const n of t)if(n.type==="exponentialRampToValue"){const{endTime:r,value:i}=n;e.exponentialRampToValueAtTime(i,r)}else if(n.type==="linearRampToValue"){const{endTime:r,value:i}=n;e.linearRampToValueAtTime(i,r)}else if(n.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=n;e.setTargetAtTime(i,r,s)}else if(n.type==="setValue"){const{startTime:r,value:i}=n;e.setValueAtTime(i,r)}else if(n.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=n;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class CQ{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,n=null){return this._map.forEach((r,i)=>e.call(n,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const Hje={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},Vje=(t,e,n,r,i,s,o,a,c,l,u,d,h,p)=>class extends e{constructor(g,y,E){var w;const R=a(g),A=c(R),k=u({...Hje,...E});h(k);const I=tF.get(R),N=I==null?void 0:I.get(y),U=A||R.state!=="closed"?R:(w=o(R))!==null&&w!==void 0?w:R,F=i(U,A?null:g.baseLatency,l,y,N,k),$=A?r(y,k,N):null;super(g,!0,F,$);const q=[];F.parameters.forEach((W,X)=>{const ne=n(this,A,W);q.push([X,ne])}),this._nativeAudioWorkletNode=F,this._onprocessorerror=null,this._parameters=new CQ(q),A&&t(R,this);const{activeInputs:K}=s(this);d(F,K)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(g){const y=typeof g=="function"?p(this,g):null;this._nativeAudioWorkletNode.onprocessorerror=y;const E=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=E!==null&&E===y?g:E}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function _A(t,e,n,r,i){if(typeof t.copyFromChannel=="function")e[n].byteLength===0&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],r,i);else{const s=t.getChannelData(r);if(e[n].byteLength===0)e[n]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(o)}}}const RQ=(t,e,n,r,i)=>{typeof t.copyToChannel=="function"?e[n].byteLength!==0&&t.copyToChannel(e[n],r,i):e[n].byteLength!==0&&t.getChannelData(r).set(e[n],i)},yA=(t,e)=>{const n=[];for(let r=0;r<t;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));n.push(i)}return n},zje=(t,e)=>{const n=Wh(nF,t),r=Fs(e);return Wh(n,r)},Gje=async(t,e,n,r,i,s,o)=>{const a=e===null?Math.ceil(t.context.length/128)*128:e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce((y,E)=>y+E,0),u=l===0?null:n.createBuffer(l,a,n.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const d=Ml(t),h=await zje(n,t),p=yA(r.numberOfInputs,r.channelCount),f=yA(r.numberOfOutputs,i),g=Array.from(t.parameters.keys()).reduce((y,E)=>({...y,[E]:new Float32Array(128)}),{});for(let y=0;y<a;y+=128){if(r.numberOfInputs>0&&e!==null)for(let E=0;E<r.numberOfInputs;E+=1)for(let w=0;w<r.channelCount;w+=1)_A(e,p[E],w,w,y);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:E},w)=>{_A(e,g,E,c+w,y)});for(let E=0;E<r.numberOfInputs;E+=1)for(let w=0;w<i[E];w+=1)f[E][w].byteLength===0&&(f[E][w]=new Float32Array(128));try{const E=p.map((R,A)=>d.activeInputs[A].size===0?[]:R),w=o(y/n.sampleRate,n.sampleRate,()=>h.process(E,f,g));if(u!==null)for(let R=0,A=0;R<r.numberOfOutputs;R+=1){for(let k=0;k<i[R];k+=1)RQ(u,f[R],k,A+k,y);A+=i[R]}if(!w)break}catch(E){t.dispatchEvent(new ErrorEvent("processorerror",{colno:E.colno,filename:E.filename,lineno:E.lineno,message:E.message}));break}}return u},Wje=(t,e,n,r,i,s,o,a,c,l,u,d,h,p,f,g)=>(y,E,w)=>{const R=new WeakMap;let A=null;const k=async(I,N)=>{let U=u(I),F=null;const $=el(U,N),q=Array.isArray(E.outputChannelCount)?E.outputChannelCount:Array.from(E.outputChannelCount);if(d===null){const K=q.reduce((Z,ie)=>Z+ie,0),W=i(N,{channelCount:Math.max(1,K),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,K)}),X=[];for(let Z=0;Z<I.numberOfOutputs;Z+=1)X.push(r(N,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:q[Z]}));const ne=o(N,{channelCount:E.channelCount,channelCountMode:E.channelCountMode,channelInterpretation:E.channelInterpretation,gain:1});ne.connect=e.bind(null,X),ne.disconnect=c.bind(null,X),F=[W,X,ne]}else $||(U=new d(N,y));if(R.set(N,F===null?U:F[2]),F!==null){if(A===null){if(w===void 0)throw new Error("Missing the processor constructor.");if(h===null)throw new Error("Missing the native OfflineAudioContext constructor.");const ie=I.channelCount*I.numberOfInputs,G=w.parameterDescriptors===void 0?0:w.parameterDescriptors.length,Q=ie+G;A=Gje(I,Q===0?null:await(async()=>{const ve=new h(Q,Math.ceil(I.context.length/128)*128,N.sampleRate),Oe=[],_e=[];for(let Ee=0;Ee<E.numberOfInputs;Ee+=1)Oe.push(o(ve,{channelCount:E.channelCount,channelCountMode:E.channelCountMode,channelInterpretation:E.channelInterpretation,gain:1})),_e.push(i(ve,{channelCount:E.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:E.channelCount}));const le=await Promise.all(Array.from(I.parameters.values()).map(async Ee=>{const Se=s(ve,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Ee.value});return await p(ve,Ee,Se.offset),Se})),xe=r(ve,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,ie+G)});for(let Ee=0;Ee<E.numberOfInputs;Ee+=1){Oe[Ee].connect(_e[Ee]);for(let Se=0;Se<E.channelCount;Se+=1)_e[Ee].connect(xe,Se,Ee*E.channelCount+Se)}for(const[Ee,Se]of le.entries())Se.connect(xe,0,ie+Ee),Se.start(0);return xe.connect(ve.destination),await Promise.all(Oe.map(Ee=>f(I,ve,Ee))),g(ve)})(),N,E,q,w,l)}const K=await A,W=n(N,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[X,ne,Z]=F;K!==null&&(W.buffer=K,W.start(0)),W.connect(X);for(let ie=0,G=0;ie<I.numberOfOutputs;ie+=1){const Q=ne[ie];for(let se=0;se<q[ie];se+=1)X.connect(Q,G+se,se);G+=q[ie]}return Z}if($)for(const[K,W]of I.parameters.entries())await t(N,W,U.parameters.get(K));else for(const[K,W]of I.parameters.entries())await p(N,W,U.parameters.get(K));return await f(I,N,U),U};return{render(I,N){a(N,I);const U=R.get(N);return U!==void 0?Promise.resolve(U):k(I,N)}}},qje=(t,e,n,r,i,s,o,a,c,l,u,d,h,p,f,g,y,E,w,R)=>class extends f{constructor(k,I){super(k,I),this._nativeContext=k,this._audioWorklet=t===void 0?void 0:{addModule:(N,U)=>t(this,N,U)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(k,I,N){return new n({length:I,numberOfChannels:k,sampleRate:N})}createBufferSource(){return new r(this)}createChannelMerger(k=6){return new s(this,{numberOfInputs:k})}createChannelSplitter(k=6){return new o(this,{numberOfOutputs:k})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(k=1){return new u(this,{maxDelayTime:k})}createDynamicsCompressor(){return new d(this)}createGain(){return new h(this)}createIIRFilter(k,I){return new p(this,{feedback:I,feedforward:k})}createOscillator(){return new g(this)}createPanner(){return new y(this)}createPeriodicWave(k,I,N={disableNormalization:!1}){return new E(this,{...N,imag:I,real:k})}createStereoPanner(){return new w(this)}createWaveShaper(){return new R(this)}decodeAudioData(k,I,N){return l(this._nativeContext,k).then(U=>(typeof I=="function"&&I(U),U),U=>{throw typeof N=="function"&&N(U),U})}},Kje={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Yje=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const d=s(l),h={...Kje,...u},p=i(d,h),f=o(d),g=f?n():null;super(l,!1,p,g),this._Q=e(this,f,p.Q,Al,tu),this._detune=e(this,f,p.detune,1200*Math.log2(Al),-1200*Math.log2(Al)),this._frequency=e(this,f,p.frequency,l.sampleRate/2,0),this._gain=e(this,f,p.gain,40*Math.log10(Al),tu),this._nativeBiquadFilterNode=p,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,d){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,d)}catch(h){throw h.code===11?r():h}if(l.length!==u.length||u.length!==d.length)throw r()}},Xje=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=el(l,c);if(!u){const d={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,d)}return s.set(c,l),u?(await t(c,a.Q,l.Q),await t(c,a.detune,l.detune),await t(c,a.frequency,l.frequency),await t(c,a.gain,l.gain)):(await r(c,a.Q,l.Q),await r(c,a.detune,l.detune),await r(c,a.frequency,l.frequency),await r(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Jje=(t,e)=>(n,r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t.get(n);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(t.set(n,o),o.catch(()=>!1).then(a=>(t.delete(n),e.set(n,a),a))):(e.set(n,o),o)}catch{return e.set(n,!1),!1}},Qje={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Zje=(t,e,n,r,i)=>class extends t{constructor(o,a){const c=r(o),l={...Qje,...a},u=n(c,l),d=i(c)?e():null;super(o,!1,u,d)}},e$e=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!el(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},t$e={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},n$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u=s({...t$e,...c}),d=n(l,u),h=i(l)?e():null;super(a,!1,d,h)}},r$e=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!el(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},i$e=t=>(e,n,r)=>t(n,e,r),s$e=t=>(e,n,r=0,i=0)=>{const s=e[r];if(s===void 0)throw t();return vA(n)?s.connect(n,0,i):s.connect(n,0)},o$e=t=>(e,n)=>{const r=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return r.buffer=i,r.loop=!0,r.connect(n),r.start(),()=>{r.stop(),r.disconnect(n)}},a$e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},c$e=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={...a$e,...l},h=r(u,d),p=s(u),f=p?n():null;super(c,!1,h,f),this._constantSourceNodeRenderer=f,this._nativeConstantSourceNode=h,this._offset=e(this,p,h.offset,Al,tu),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){YE(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),sg(this)&&mx(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},l$e=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let d=n(l);const h=el(d,u);if(!h){const p={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,offset:d.offset.value};d=e(u,p),o!==null&&d.start(o),a!==null&&d.stop(a)}return s.set(u,d),h?await t(u,l.offset,d.offset):await r(u,l.offset,d.offset),await i(l,u,d),d};return{set start(l){o=l},set stop(l){a=l},render(l,u){const d=s.get(u);return d!==void 0?Promise.resolve(d):c(l,u)}}},u$e=t=>e=>(t[0]=e,t[0]),d$e={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},h$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u={...d$e,...c},d=n(l,u),p=i(l)?e():null;super(a,!1,d,p),this._isBufferNullified=!1,this._nativeConvolverNode=d,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},f$e=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!el(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(o,l)}return r.set(o,a),vS(a)?await n(s,o,a.inputs[0]):await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},p$e=(t,e)=>(n,r,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,r,i)}catch(s){throw s.name==="SyntaxError"?t():s}},m$e=()=>new DOMException("","DataCloneError"),p8=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise(r=>{const i=()=>{n.onmessage=null,e.close(),n.close(),r()};n.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}})},g$e=(t,e,n,r,i,s,o,a,c,l,u)=>(d,h)=>{const p=o(d)?d:s(d);if(i.has(h)){const f=n();return Promise.reject(f)}try{i.add(h)}catch{}return e(c,()=>c(p))?p.decodeAudioData(h).then(f=>(p8(h).catch(()=>{}),e(a,()=>a(f))||u(f),t.add(f),f)):new Promise((f,g)=>{const y=async()=>{try{await p8(h)}catch{}},E=w=>{g(w),y()};try{p.decodeAudioData(h,w=>{typeof w.copyFromChannel!="function"&&(l(w),o4(w)),t.add(w),y().then(()=>f(w))},w=>{E(w===null?r():w)})}catch(w){E(w)}})},v$e=(t,e,n,r,i,s,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const d=s(c.context),h=a(d);if(u===l){if(e.delete(c),!h&&o(c)){const p=r(c),{outputs:f}=n(c);for(const g of f)if(vx(g)){const y=r(g[0]);t(p,y,g[1],g[2])}else{const y=i(g[0]);p.connect(y,g[1])}}}else e.set(c,u-l)},_$e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},y$e=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={..._$e,...l},h=r(u,d),p=s(u),f=p?n(d.maxDelayTime):null;super(c,!1,h,f),this._delayTime=e(this,p,h.delayTime),o(this,d.maxDelayTime)}get delayTime(){return this._delayTime}},b$e=(t,e,n,r,i)=>s=>{const o=new WeakMap,a=async(c,l)=>{let u=n(c);const d=el(u,l);if(!d){const h={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,h)}return o.set(l,u),d?await t(l,c.delayTime,u.delayTime):await r(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},E$e=t=>(e,n,r,i)=>t(e[i],s=>s[0]===n&&s[1]===r),S$e=t=>(e,n)=>{t(e).delete(n)},T$e=t=>"delayTime"in t,w$e=(t,e,n)=>function r(i,s){const o=pA(s)?s:n(t,s);if(T$e(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>r([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},tC=(t,e,n)=>{const r=e[n];if(r===void 0)throw t();return r},x$e=t=>(e,n=void 0,r=void 0,i=0)=>n===void 0?e.forEach(s=>s.disconnect()):typeof n=="number"?tC(t,e,n).disconnect():vA(n)?r===void 0?e.forEach(s=>s.disconnect(n)):i===void 0?tC(t,e,r).disconnect(n,0):tC(t,e,r).disconnect(n,0,i):r===void 0?e.forEach(s=>s.disconnect(n)):tC(t,e,r).disconnect(n,0),C$e={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},R$e=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const d=s(l),h={...C$e,...u},p=r(d,h),f=o(d),g=f?n():null;super(l,!1,p,g),this._attack=e(this,f,p.attack),this._knee=e(this,f,p.knee),this._nativeDynamicsCompressorNode=p,this._ratio=e(this,f,p.ratio),this._release=e(this,f,p.release),this._threshold=e(this,f,p.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},A$e=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=el(l,c);if(!u){const d={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,d)}return s.set(c,l),u?(await t(c,a.attack,l.attack),await t(c,a.knee,l.knee),await t(c,a.ratio,l.ratio),await t(c,a.release,l.release),await t(c,a.threshold,l.threshold)):(await r(c,a.attack,l.attack),await r(c,a.knee,l.knee),await r(c,a.ratio,l.ratio),await r(c,a.release,l.release),await r(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},M$e=()=>new DOMException("","EncodingError"),I$e=t=>e=>new Promise((n,r)=>{if(t===null){r(new SyntaxError);return}const i=t.document.head;if(i===null)r(new SyntaxError);else{const s=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,l=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(u,d,h,p,f)=>{if(d===a||d===t.location.href&&h===1&&p===1)return l(),r(f),!1;if(c!==null)return c(u,d,h,p,f)},s.onerror=()=>{l(),r(new SyntaxError)},s.onload=()=>{l(),n()},s.src=a,s.type="module",i.appendChild(s)}}),O$e=t=>class{constructor(n){this._nativeEventTarget=n,this._listeners=new WeakMap}addEventListener(n,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=t(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(n,s,i)}}dispatchEvent(n){return this._nativeEventTarget.dispatchEvent(n)}removeEventListener(n,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(n,s===void 0?null:s,i)}},k$e=t=>(e,n,r)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*n)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{t!==null&&(delete t.currentFrame,delete t.currentTime)}},N$e=t=>async e=>{try{const n=await fetch(e);if(n.ok)return[await n.text(),n.url]}catch{}throw t()},P$e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},D$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...P$e,...c},d=r(l,u),h=s(l),p=h?n():null;super(a,!1,d,p),this._gain=e(this,h,d.gain,Al,tu)}get gain(){return this._gain}},L$e=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=el(l,c);if(!u){const d={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,d)}return s.set(c,l),u?await t(c,a.gain,l.gain):await r(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},U$e=(t,e)=>n=>e(t,n),F$e=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer},B$e=t=>e=>{var n;return(n=t.get(e))!==null&&n!==void 0?n:0},j$e=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer},$$e=t=>e=>t.get(e),lc=()=>new DOMException("","InvalidStateError"),H$e=t=>e=>{const n=t.get(e);if(n===void 0)throw lc();return n},V$e=(t,e)=>n=>{let r=t.get(n);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),t.set(n,r),r},z$e=t=>e=>{const n=t.get(e);if(n===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return n},Vk=()=>new DOMException("","InvalidAccessError"),G$e=t=>{t.getFrequencyResponse=(e=>(n,r,i)=>{if(n.length!==r.length||r.length!==i.length)throw Vk();return e.call(t,n,r,i)})(t.getFrequencyResponse)},W$e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},q$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u=i(l),d={...W$e,...c},h=e(l,u?null:a.baseLatency,d),p=u?n(d.feedback,d.feedforward):null;super(a,!1,h,p),G$e(h),this._nativeIIRFilterNode=h,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},AQ=(t,e,n,r,i,s,o,a,c,l,u)=>{const d=l.length;let h=a;for(let p=0;p<d;p+=1){let f=n[0]*l[p];for(let g=1;g<i;g+=1){const y=h-g&c-1;f+=n[g]*s[y],f-=t[g]*o[y]}for(let g=i;g<r;g+=1)f+=n[g]*s[h-g&c-1];for(let g=i;g<e;g+=1)f-=t[g]*o[h-g&c-1];s[h]=l[p],o[h]=f,h=h+1&c-1,u[p]=f}return h},K$e=(t,e,n,r)=>{const i=n instanceof Float64Array?n:new Float64Array(n),s=r instanceof Float64Array?r:new Float64Array(r),o=i.length,a=s.length,c=Math.min(o,a);if(i[0]!==1){for(let f=0;f<o;f+=1)s[f]/=i[0];for(let f=1;f<a;f+=1)i[f]/=i[0]}const l=32,u=new Float32Array(l),d=new Float32Array(l),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),p=t.numberOfChannels;for(let f=0;f<p;f+=1){const g=t.getChannelData(f),y=h.getChannelData(f);u.fill(0),d.fill(0),AQ(i,o,s,a,c,u,d,0,l,g,y)}return h},Y$e=(t,e,n,r,i)=>(s,o)=>{const a=new WeakMap;let c=null;const l=async(u,d)=>{let h=null,p=e(u);const f=el(p,d);if(d.createIIRFilter===void 0?h=t(d,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(p=d.createIIRFilter(o,s)),a.set(d,h===null?p:h),h!==null){if(c===null){if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");const y=new n(u.context.destination.channelCount,u.context.length,d.sampleRate);c=(async()=>{await r(u,y,y.destination);const E=await i(y);return K$e(E,d,s,o)})()}const g=await c;return h.buffer=g,h.start(0),h}return await r(u,d,p),p};return{render(u,d){const h=a.get(d);return h!==void 0?Promise.resolve(h):l(u,d)}}},X$e=(t,e,n,r,i,s)=>o=>(a,c)=>{const l=t.get(a);if(l===void 0){if(!o&&s(a)){const u=r(a),{outputs:d}=n(a);for(const h of d)if(vx(h)){const p=r(h[0]);e(u,p,h[1],h[2])}else{const p=i(h[0]);u.disconnect(p,h[1])}}t.set(a,c)}else t.set(a,l+c)},J$e=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},Q$e=(t,e)=>n=>t.has(n)||e(n),Z$e=(t,e)=>n=>t.has(n)||e(n),eHe=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},tHe=t=>e=>t!==null&&e instanceof t,nHe=t=>e=>t!==null&&typeof t.AudioNode=="function"&&e instanceof t.AudioNode,rHe=t=>e=>t!==null&&typeof t.AudioParam=="function"&&e instanceof t.AudioParam,iHe=(t,e)=>n=>t(n)||e(n),sHe=t=>e=>t!==null&&e instanceof t,oHe=t=>t!==null&&t.isSecureContext,aHe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),c=e(a,o);if(r(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},cHe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},lHe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s);if(r(a))throw new TypeError;const c={...cHe,...o},l=e(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},uHe=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),c=e(a,o);if(r(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},dHe=(t,e,n)=>class extends t{constructor(i,s){const o=n(i),a=e(o,s);super(i,!0,a,null)}},hHe=(t,e,n,r,i,s)=>class extends n{constructor(a,c){super(a),this._nativeContext=a,$k.set(this,a),r(a)&&i.set(a,new Set),this._destination=new t(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},aw=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return n===void 0?!1:(n.catch(()=>{}),!0)}catch{}return!1},fHe=(t,e)=>(n,r,i)=>{const s=new Set;return n.connect=(o=>(a,c=0,l=0)=>{const u=s.size===0;if(e(a))return o.call(n,a,c,l),t(s,[a,c,l],d=>d[0]===a&&d[1]===c&&d[2]===l,!0),u&&r(),a;o.call(n,a,c),t(s,[a,c],d=>d[0]===a&&d[1]===c,!0),u&&r()})(n.connect),n.disconnect=(o=>(a,c,l)=>{const u=s.size>0;if(a===void 0)o.apply(n),s.clear();else if(typeof a=="number"){o.call(n,a);for(const h of s)h[1]===a&&s.delete(h)}else{e(a)?o.call(n,a,c,l):o.call(n,a,c);for(const h of s)h[0]===a&&(c===void 0||h[1]===c)&&(l===void 0||h[2]===l)&&s.delete(h)}const d=s.size===0;u&&d&&i()})(n.disconnect),n},qs=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n]&&(t[n]=r)},Ba=(t,e)=>{qs(t,e,"channelCount"),qs(t,e,"channelCountMode"),qs(t,e,"channelInterpretation")},m8=t=>typeof t.getFloatTimeDomainData=="function",pHe=t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const r=Math.max(n.length,t.fftSize);for(let i=0;i<r;i+=1)e[i]=(n[i]-128)*.0078125;return e}},mHe=(t,e)=>(n,r)=>{const i=n.createAnalyser();if(Ba(i,r),!(r.maxDecibels>r.minDecibels))throw e();return qs(i,r,"fftSize"),qs(i,r,"maxDecibels"),qs(i,r,"minDecibels"),qs(i,r,"smoothingTimeConstant"),t(m8,()=>m8(i))||pHe(i),i},gHe=t=>t===null?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,yo=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n].value&&(t[n].value=r)},vHe=t=>{t.start=(e=>{let n=!1;return(r=0,i=0,s)=>{if(n)throw lc();e.call(t,r,i,s),n=!0}})(t.start)},l4=t=>{t.start=(e=>(n=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,r,i)})(t.start)},u4=t=>{t.stop=(e=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})(t.stop)},_He=(t,e,n,r,i,s,o,a,c,l,u)=>(d,h)=>{const p=d.createBufferSource();return Ba(p,h),yo(p,h,"playbackRate"),qs(p,h,"buffer"),qs(p,h,"loop"),qs(p,h,"loopEnd"),qs(p,h,"loopStart"),e(n,()=>n(d))||vHe(p),e(r,()=>r(d))||c(p),e(i,()=>i(d))||l(p,d),e(s,()=>s(d))||l4(p),e(o,()=>o(d))||u(p,d),e(a,()=>a(d))||u4(p),t(d,p),p},yHe=t=>t===null?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,bHe=(t,e)=>(n,r,i)=>{const s=n.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=t(n,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},EHe=t=>t===null?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,SHe=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},THe=(t,e,n,r,i)=>(s,o,a,c,l,u)=>{if(a!==null)try{const d=new a(s,c,u),h=new Map;let p=null;if(Object.defineProperties(d,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>p,set:f=>{typeof p=="function"&&d.removeEventListener("processorerror",p),p=typeof f=="function"?f:null,typeof p=="function"&&d.addEventListener("processorerror",p)}}}),d.addEventListener=(f=>(...g)=>{if(g[0]==="processorerror"){const y=typeof g[1]=="function"?g[1]:typeof g[1]=="object"&&g[1]!==null&&typeof g[1].handleEvent=="function"?g[1].handleEvent:null;if(y!==null){const E=h.get(g[1]);E!==void 0?g[1]=E:(g[1]=w=>{w.type==="error"?(Object.defineProperties(w,{type:{value:"processorerror"}}),y(w)):y(new ErrorEvent(g[0],{...w}))},h.set(y,g[1]))}}return f.call(d,"error",g[1],g[2]),f.call(d,...g)})(d.addEventListener),d.removeEventListener=(f=>(...g)=>{if(g[0]==="processorerror"){const y=h.get(g[1]);y!==void 0&&(h.delete(g[1]),g[1]=y)}return f.call(d,"error",g[1],g[2]),f.call(d,g[0],g[1],g[2])})(d.removeEventListener),u.numberOfOutputs!==0){const f=n(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return d.connect(f).connect(s.destination),i(d,()=>f.disconnect(),()=>f.connect(s.destination))}return d}catch(d){throw d.code===11?r():d}if(l===void 0)throw r();return SHe(u),e(s,o,l,u)},MQ=(t,e)=>t===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),wHe=t=>new Promise((e,n)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),n(s)},i.postMessage(t)}),xHe=async(t,e)=>{const n=await wHe(e);return new t(n)},CHe=(t,e,n,r)=>{let i=nF.get(t);i===void 0&&(i=new WeakMap,nF.set(t,i));const s=xHe(n,r);return i.set(e,s),s},RHe=(t,e,n,r,i,s,o,a,c,l,u,d,h)=>(p,f,g,y)=>{if(y.numberOfInputs===0&&y.numberOfOutputs===0)throw c();const E=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(E.some(St=>St<1))throw c();if(E.length!==y.numberOfOutputs)throw e();if(y.channelCountMode!=="explicit")throw c();const w=y.channelCount*y.numberOfInputs,R=E.reduce((St,Ge)=>St+Ge,0),A=g.parameterDescriptors===void 0?0:g.parameterDescriptors.length;if(w+A>6||R>6)throw c();const k=new MessageChannel,I=[],N=[];for(let St=0;St<y.numberOfInputs;St+=1)I.push(o(p,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),N.push(i(p,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const U=[];if(g.parameterDescriptors!==void 0)for(const{defaultValue:St,maxValue:Ge,minValue:kt,name:Bt}of g.parameterDescriptors){const He=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:y.parameterData[Bt]!==void 0?y.parameterData[Bt]:St===void 0?0:St});Object.defineProperties(He.offset,{defaultValue:{get:()=>St===void 0?0:St},maxValue:{get:()=>Ge===void 0?Al:Ge},minValue:{get:()=>kt===void 0?tu:kt}}),U.push(He)}const F=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,w+A)}),$=MQ(f,p.sampleRate),q=a(p,$,w+A,Math.max(1,R)),K=i(p,{channelCount:Math.max(1,R),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,R)}),W=[];for(let St=0;St<y.numberOfOutputs;St+=1)W.push(r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:E[St]}));for(let St=0;St<y.numberOfInputs;St+=1){I[St].connect(N[St]);for(let Ge=0;Ge<y.channelCount;Ge+=1)N[St].connect(F,Ge,St*y.channelCount+Ge)}const X=new CQ(g.parameterDescriptors===void 0?[]:g.parameterDescriptors.map(({name:St},Ge)=>{const kt=U[Ge];return kt.connect(F,0,w+Ge),kt.start(0),[St,kt.offset]}));F.connect(q);let ne=y.channelInterpretation,Z=null;const ie=y.numberOfOutputs===0?[q]:W,G={get bufferSize(){return $},get channelCount(){return y.channelCount},set channelCount(St){throw n()},get channelCountMode(){return y.channelCountMode},set channelCountMode(St){throw n()},get channelInterpretation(){return ne},set channelInterpretation(St){for(const Ge of I)Ge.channelInterpretation=St;ne=St},get context(){return q.context},get inputs(){return I},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},get onprocessorerror(){return Z},set onprocessorerror(St){typeof Z=="function"&&G.removeEventListener("processorerror",Z),Z=typeof St=="function"?St:null,typeof Z=="function"&&G.addEventListener("processorerror",Z)},get parameters(){return X},get port(){return k.port2},addEventListener(...St){return q.addEventListener(St[0],St[1],St[2])},connect:t.bind(null,ie),disconnect:l.bind(null,ie),dispatchEvent(...St){return q.dispatchEvent(St[0])},removeEventListener(...St){return q.removeEventListener(St[0],St[1],St[2])}},Q=new Map;k.port1.addEventListener=(St=>(...Ge)=>{if(Ge[0]==="message"){const kt=typeof Ge[1]=="function"?Ge[1]:typeof Ge[1]=="object"&&Ge[1]!==null&&typeof Ge[1].handleEvent=="function"?Ge[1].handleEvent:null;if(kt!==null){const Bt=Q.get(Ge[1]);Bt!==void 0?Ge[1]=Bt:(Ge[1]=He=>{u(p.currentTime,p.sampleRate,()=>kt(He))},Q.set(kt,Ge[1]))}}return St.call(k.port1,Ge[0],Ge[1],Ge[2])})(k.port1.addEventListener),k.port1.removeEventListener=(St=>(...Ge)=>{if(Ge[0]==="message"){const kt=Q.get(Ge[1]);kt!==void 0&&(Q.delete(Ge[1]),Ge[1]=kt)}return St.call(k.port1,Ge[0],Ge[1],Ge[2])})(k.port1.removeEventListener);let se=null;Object.defineProperty(k.port1,"onmessage",{get:()=>se,set:St=>{typeof se=="function"&&k.port1.removeEventListener("message",se),se=typeof St=="function"?St:null,typeof se=="function"&&(k.port1.addEventListener("message",se),k.port1.start())}}),g.prototype.port=k.port1;let ve=null;CHe(p,G,g,y).then(St=>ve=St);const _e=yA(y.numberOfInputs,y.channelCount),le=yA(y.numberOfOutputs,E),xe=g.parameterDescriptors===void 0?[]:g.parameterDescriptors.reduce((St,{name:Ge})=>({...St,[Ge]:new Float32Array(128)}),{});let Ee=!0;const Se=()=>{y.numberOfOutputs>0&&q.disconnect(K);for(let St=0,Ge=0;St<y.numberOfOutputs;St+=1){const kt=W[St];for(let Bt=0;Bt<E[St];Bt+=1)K.disconnect(kt,Ge+Bt,Bt);Ge+=E[St]}},Ie=new Map;q.onaudioprocess=({inputBuffer:St,outputBuffer:Ge})=>{if(ve!==null){const kt=d(G);for(let Bt=0;Bt<$;Bt+=128){for(let He=0;He<y.numberOfInputs;He+=1)for(let $t=0;$t<y.channelCount;$t+=1)_A(St,_e[He],$t,$t,Bt);g.parameterDescriptors!==void 0&&g.parameterDescriptors.forEach(({name:He},$t)=>{_A(St,xe,He,w+$t,Bt)});for(let He=0;He<y.numberOfInputs;He+=1)for(let $t=0;$t<E[He];$t+=1)le[He][$t].byteLength===0&&(le[He][$t]=new Float32Array(128));try{const He=_e.map((Ce,ue)=>{if(kt[ue].size>0)return Ie.set(ue,$/128),Ce;const yt=Ie.get(ue);return yt===void 0?[]:(Ce.every(We=>We.every(ze=>ze===0))&&(yt===1?Ie.delete(ue):Ie.set(ue,yt-1)),Ce)});Ee=u(p.currentTime+Bt/p.sampleRate,p.sampleRate,()=>ve.process(He,le,xe));for(let Ce=0,ue=0;Ce<y.numberOfOutputs;Ce+=1){for(let tt=0;tt<E[Ce];tt+=1)RQ(Ge,le[Ce],tt,ue+tt,Bt);ue+=E[Ce]}}catch(He){Ee=!1,G.dispatchEvent(new ErrorEvent("processorerror",{colno:He.colno,filename:He.filename,lineno:He.lineno,message:He.message}))}if(!Ee){for(let He=0;He<y.numberOfInputs;He+=1){I[He].disconnect(N[He]);for(let $t=0;$t<y.channelCount;$t+=1)N[Bt].disconnect(F,$t,He*y.channelCount+$t)}if(g.parameterDescriptors!==void 0){const He=g.parameterDescriptors.length;for(let $t=0;$t<He;$t+=1){const Ce=U[$t];Ce.disconnect(F,0,w+$t),Ce.stop()}}F.disconnect(q),q.onaudioprocess=null,Ze?Se():ge();break}}}};let Ze=!1;const _t=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),fe=()=>q.connect(_t).connect(p.destination),ge=()=>{q.disconnect(_t),_t.disconnect()},rt=()=>{if(Ee){ge(),y.numberOfOutputs>0&&q.connect(K);for(let St=0,Ge=0;St<y.numberOfOutputs;St+=1){const kt=W[St];for(let Bt=0;Bt<E[St];Bt+=1)K.connect(kt,Ge+Bt,Bt);Ge+=E[St]}}Ze=!0},Re=()=>{Ee&&(fe(),Se()),Ze=!1};return fe(),h(G,rt,Re)},IQ=(t,e)=>{const n=t.createBiquadFilter();return Ba(n,e),yo(n,e,"Q"),yo(n,e,"detune"),yo(n,e,"frequency"),yo(n,e,"gain"),qs(n,e,"type"),n},AHe=(t,e)=>(n,r)=>{const i=n.createChannelMerger(r.numberOfInputs);return t!==null&&t.name==="webkitAudioContext"&&e(n,i),Ba(i,r),i},MHe=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:n=>{if(n!==e)throw lc()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:n=>{if(n!=="explicit")throw lc()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:n=>{if(n!=="discrete")throw lc()}})},_x=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Ba(n,e),MHe(n),n},IHe=(t,e,n,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return n(s,o);const a=s.createConstantSource();return Ba(a,o),yo(a,o,"offset"),e(r,()=>r(s))||l4(a),e(i,()=>i(s))||u4(a),t(s,a),a},_S=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),OHe=(t,e,n,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=n(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const d={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(f){l.channelCount=f},get channelCountMode(){return l.channelCountMode},set channelCountMode(f){l.channelCountMode=f},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(f){l.channelInterpretation=f},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(f){c.onended=f},addEventListener(...f){return c.addEventListener(f[0],f[1],f[2])},dispatchEvent(...f){return c.dispatchEvent(f[0])},removeEventListener(...f){return c.removeEventListener(f[0],f[1],f[2])},start(f=0){c.start.call(c,f)},stop(f=0){c.stop.call(c,f)}},h=()=>c.connect(l),p=()=>c.disconnect(l);return t(i,c),r(_S(d,l),h,p)},kHe=(t,e)=>(n,r)=>{const i=n.createConvolver();if(Ba(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),qs(i,r,"buffer"),r.channelCount>2||(e(i,"channelCount",s=>()=>s.call(i),s=>o=>{if(o>2)throw t();return s.call(i,o)}),r.channelCountMode==="max"))throw t();return e(i,"channelCountMode",s=>()=>s.call(i),s=>o=>{if(o==="max")throw t();return s.call(i,o)}),i},OQ=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Ba(n,e),yo(n,e,"delayTime"),n},NHe=t=>(e,n)=>{const r=e.createDynamicsCompressor();if(Ba(r,n),n.channelCount>2||n.channelCountMode==="max")throw t();return yo(r,n,"attack"),yo(r,n,"knee"),yo(r,n,"ratio"),yo(r,n,"release"),yo(r,n,"threshold"),r},_u=(t,e)=>{const n=t.createGain();return Ba(n,e),yo(n,e,"gain"),n},PHe=t=>(e,n,r)=>{if(e.createIIRFilter===void 0)return t(e,n,r);const i=e.createIIRFilter(r.feedforward,r.feedback);return Ba(i,r),i};function DHe(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function LHe(t,e){return[t[0]*e[0]-t[1]*e[1],t[0]*e[1]+t[1]*e[0]]}function g8(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)n=LHe(n,e),n[0]+=t[r];return n}const UHe=(t,e,n,r)=>(i,s,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const d=MQ(s,i.sampleRate),h=l instanceof Float64Array?l:new Float64Array(l),p=u instanceof Float64Array?u:new Float64Array(u),f=h.length,g=p.length,y=Math.min(f,g);if(f===0||f>20)throw r();if(h[0]===0)throw e();if(g===0||g>20)throw r();if(p[0]===0)throw e();if(h[0]!==1){for(let U=0;U<g;U+=1)p[U]/=h[0];for(let U=1;U<f;U+=1)h[U]/=h[0]}const E=n(i,d,o,o);E.channelCount=o,E.channelCountMode=a,E.channelInterpretation=c;const w=32,R=[],A=[],k=[];for(let U=0;U<o;U+=1){R.push(0);const F=new Float32Array(w),$=new Float32Array(w);F.fill(0),$.fill(0),A.push(F),k.push($)}E.onaudioprocess=U=>{const F=U.inputBuffer,$=U.outputBuffer,q=F.numberOfChannels;for(let K=0;K<q;K+=1){const W=F.getChannelData(K),X=$.getChannelData(K);R[K]=AQ(h,f,p,g,y,A[K],k[K],R[K],w,W,X)}};const I=i.sampleRate/2;return _S({get bufferSize(){return d},get channelCount(){return E.channelCount},set channelCount(U){E.channelCount=U},get channelCountMode(){return E.channelCountMode},set channelCountMode(U){E.channelCountMode=U},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(U){E.channelInterpretation=U},get context(){return E.context},get inputs(){return[E]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},addEventListener(...U){return E.addEventListener(U[0],U[1],U[2])},dispatchEvent(...U){return E.dispatchEvent(U[0])},getFrequencyResponse(U,F,$){if(U.length!==F.length||F.length!==$.length)throw t();const q=U.length;for(let K=0;K<q;K+=1){const W=-Math.PI*(U[K]/I),X=[Math.cos(W),Math.sin(W)],ne=g8(p,X),Z=g8(h,X),ie=DHe(ne,Z);F[K]=Math.sqrt(ie[0]*ie[0]+ie[1]*ie[1]),$[K]=Math.atan2(ie[1],ie[0])}},removeEventListener(...U){return E.removeEventListener(U[0],U[1],U[2])}},E)},FHe=(t,e)=>t.createMediaElementSource(e.mediaElement),BHe=(t,e)=>{const n=t.createMediaStreamDestination();return Ba(n,e),n.numberOfOutputs===1&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},jHe=(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},$He=(t,e)=>(n,{mediaStreamTrack:r})=>{if(typeof n.createMediaStreamTrackSource=="function")return n.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=n.createMediaStreamSource(i);if(r.kind!=="audio")throw t();if(e(n))throw new TypeError;return s},HHe=t=>t===null?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,VHe=(t,e,n,r,i,s)=>(o,a)=>{const c=o.createOscillator();return Ba(c,a),yo(c,a,"detune"),yo(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):qs(c,a,"type"),e(n,()=>n(o))||l4(c),e(r,()=>r(o))||s(c,o),e(i,()=>i(o))||u4(c),t(o,c),c},zHe=t=>(e,n)=>{const r=e.createPanner();return r.orientationX===void 0?t(e,n):(Ba(r,n),yo(r,n,"orientationX"),yo(r,n,"orientationY"),yo(r,n,"orientationZ"),yo(r,n,"positionX"),yo(r,n,"positionY"),yo(r,n,"positionZ"),qs(r,n,"coneInnerAngle"),qs(r,n,"coneOuterAngle"),qs(r,n,"coneOuterGain"),qs(r,n,"distanceModel"),qs(r,n,"maxDistance"),qs(r,n,"panningModel"),qs(r,n,"refDistance"),qs(r,n,"rolloffFactor"),r)},GHe=(t,e,n,r,i,s,o,a,c,l)=>(u,{coneInnerAngle:d,coneOuterAngle:h,coneOuterGain:p,distanceModel:f,maxDistance:g,orientationX:y,orientationY:E,orientationZ:w,panningModel:R,positionX:A,positionY:k,positionZ:I,refDistance:N,rolloffFactor:U,...F})=>{const $=u.createPanner();if(F.channelCount>2||F.channelCountMode==="max")throw o();Ba($,F);const q={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},K=n(u,{...q,channelInterpretation:"speakers",numberOfInputs:6}),W=r(u,{...F,gain:1}),X=r(u,{...q,gain:1}),ne=r(u,{...q,gain:0}),Z=r(u,{...q,gain:0}),ie=r(u,{...q,gain:0}),G=r(u,{...q,gain:0}),Q=r(u,{...q,gain:0}),se=i(u,256,6,1),ve=s(u,{...q,curve:new Float32Array([1,1]),oversample:"none"});let Oe=[y,E,w],_e=[A,k,I];const le=new Float32Array(1);se.onaudioprocess=({inputBuffer:Ie})=>{const Ze=[c(Ie,le,0),c(Ie,le,1),c(Ie,le,2)];Ze.some((fe,ge)=>fe!==Oe[ge])&&($.setOrientation(...Ze),Oe=Ze);const _t=[c(Ie,le,3),c(Ie,le,4),c(Ie,le,5)];_t.some((fe,ge)=>fe!==_e[ge])&&($.setPosition(..._t),_e=_t)},Object.defineProperty(ne.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Z.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ie.gain,"defaultValue",{get:()=>0}),Object.defineProperty(G.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Q.gain,"defaultValue",{get:()=>0});const xe={get bufferSize(){},get channelCount(){return $.channelCount},set channelCount(Ie){if(Ie>2)throw o();W.channelCount=Ie,$.channelCount=Ie},get channelCountMode(){return $.channelCountMode},set channelCountMode(Ie){if(Ie==="max")throw o();W.channelCountMode=Ie,$.channelCountMode=Ie},get channelInterpretation(){return $.channelInterpretation},set channelInterpretation(Ie){W.channelInterpretation=Ie,$.channelInterpretation=Ie},get coneInnerAngle(){return $.coneInnerAngle},set coneInnerAngle(Ie){$.coneInnerAngle=Ie},get coneOuterAngle(){return $.coneOuterAngle},set coneOuterAngle(Ie){$.coneOuterAngle=Ie},get coneOuterGain(){return $.coneOuterGain},set coneOuterGain(Ie){if(Ie<0||Ie>1)throw e();$.coneOuterGain=Ie},get context(){return $.context},get distanceModel(){return $.distanceModel},set distanceModel(Ie){$.distanceModel=Ie},get inputs(){return[W]},get maxDistance(){return $.maxDistance},set maxDistance(Ie){if(Ie<0)throw new RangeError;$.maxDistance=Ie},get numberOfInputs(){return $.numberOfInputs},get numberOfOutputs(){return $.numberOfOutputs},get orientationX(){return X.gain},get orientationY(){return ne.gain},get orientationZ(){return Z.gain},get panningModel(){return $.panningModel},set panningModel(Ie){$.panningModel=Ie},get positionX(){return ie.gain},get positionY(){return G.gain},get positionZ(){return Q.gain},get refDistance(){return $.refDistance},set refDistance(Ie){if(Ie<0)throw new RangeError;$.refDistance=Ie},get rolloffFactor(){return $.rolloffFactor},set rolloffFactor(Ie){if(Ie<0)throw new RangeError;$.rolloffFactor=Ie},addEventListener(...Ie){return W.addEventListener(Ie[0],Ie[1],Ie[2])},dispatchEvent(...Ie){return W.dispatchEvent(Ie[0])},removeEventListener(...Ie){return W.removeEventListener(Ie[0],Ie[1],Ie[2])}};d!==xe.coneInnerAngle&&(xe.coneInnerAngle=d),h!==xe.coneOuterAngle&&(xe.coneOuterAngle=h),p!==xe.coneOuterGain&&(xe.coneOuterGain=p),f!==xe.distanceModel&&(xe.distanceModel=f),g!==xe.maxDistance&&(xe.maxDistance=g),y!==xe.orientationX.value&&(xe.orientationX.value=y),E!==xe.orientationY.value&&(xe.orientationY.value=E),w!==xe.orientationZ.value&&(xe.orientationZ.value=w),R!==xe.panningModel&&(xe.panningModel=R),A!==xe.positionX.value&&(xe.positionX.value=A),k!==xe.positionY.value&&(xe.positionY.value=k),I!==xe.positionZ.value&&(xe.positionZ.value=I),N!==xe.refDistance&&(xe.refDistance=N),U!==xe.rolloffFactor&&(xe.rolloffFactor=U),(Oe[0]!==1||Oe[1]!==0||Oe[2]!==0)&&$.setOrientation(...Oe),(_e[0]!==0||_e[1]!==0||_e[2]!==0)&&$.setPosition(..._e);const Ee=()=>{W.connect($),t(W,ve,0,0),ve.connect(X).connect(K,0,0),ve.connect(ne).connect(K,0,1),ve.connect(Z).connect(K,0,2),ve.connect(ie).connect(K,0,3),ve.connect(G).connect(K,0,4),ve.connect(Q).connect(K,0,5),K.connect(se).connect(u.destination)},Se=()=>{W.disconnect($),a(W,ve,0,0),ve.disconnect(X),X.disconnect(K),ve.disconnect(ne),ne.disconnect(K),ve.disconnect(Z),Z.disconnect(K),ve.disconnect(ie),ie.disconnect(K),ve.disconnect(G),G.disconnect(K),ve.disconnect(Q),Q.disconnect(K),K.disconnect(se),se.disconnect(u.destination)};return l(_S(xe,$),Ee,Se)},WHe=t=>(e,{disableNormalization:n,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,s,{disableNormalization:n});if(Array.from(r).length<2)throw t();return a},yx=(t,e,n,r)=>t.createScriptProcessor(e,n,r),qHe=(t,e)=>(n,r)=>{const i=r.channelCountMode;if(i==="clamped-max")throw e();if(n.createStereoPanner===void 0)return t(n,r);const s=n.createStereoPanner();return Ba(s,r),yo(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),s},KHe=(t,e,n,r,i,s)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},d=(f,g,y,E)=>{const w=new Float32Array(16385),R=new Float32Array(16385);for(let F=0;F<16385;F+=1){const $=F/16384*c;w[F]=Math.cos($),R[F]=Math.sin($)}const A=n(f,{...l,gain:0}),k=r(f,{...u,curve:w}),I=r(f,{...u,curve:a}),N=n(f,{...l,gain:0}),U=r(f,{...u,curve:R});return{connectGraph(){g.connect(A),g.connect(I.inputs===void 0?I:I.inputs[0]),g.connect(N),I.connect(y),y.connect(k.inputs===void 0?k:k.inputs[0]),y.connect(U.inputs===void 0?U:U.inputs[0]),k.connect(A.gain),U.connect(N.gain),A.connect(E,0,0),N.connect(E,0,1)},disconnectGraph(){g.disconnect(A),g.disconnect(I.inputs===void 0?I:I.inputs[0]),g.disconnect(N),I.disconnect(y),y.disconnect(k.inputs===void 0?k:k.inputs[0]),y.disconnect(U.inputs===void 0?U:U.inputs[0]),k.disconnect(A.gain),U.disconnect(N.gain),A.disconnect(E,0,0),N.disconnect(E,0,1)}}},h=(f,g,y,E)=>{const w=new Float32Array(16385),R=new Float32Array(16385),A=new Float32Array(16385),k=new Float32Array(16385),I=Math.floor(16385/2);for(let ie=0;ie<16385;ie+=1)if(ie>I){const G=(ie-I)/(16384-I)*c;w[ie]=Math.cos(G),R[ie]=Math.sin(G),A[ie]=0,k[ie]=1}else{const G=ie/(16384-I)*c;w[ie]=1,R[ie]=0,A[ie]=Math.cos(G),k[ie]=Math.sin(G)}const N=e(f,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),U=n(f,{...l,gain:0}),F=r(f,{...u,curve:w}),$=n(f,{...l,gain:0}),q=r(f,{...u,curve:R}),K=r(f,{...u,curve:a}),W=n(f,{...l,gain:0}),X=r(f,{...u,curve:A}),ne=n(f,{...l,gain:0}),Z=r(f,{...u,curve:k});return{connectGraph(){g.connect(N),g.connect(K.inputs===void 0?K:K.inputs[0]),N.connect(U,0),N.connect($,0),N.connect(W,1),N.connect(ne,1),K.connect(y),y.connect(F.inputs===void 0?F:F.inputs[0]),y.connect(q.inputs===void 0?q:q.inputs[0]),y.connect(X.inputs===void 0?X:X.inputs[0]),y.connect(Z.inputs===void 0?Z:Z.inputs[0]),F.connect(U.gain),q.connect($.gain),X.connect(W.gain),Z.connect(ne.gain),U.connect(E,0,0),W.connect(E,0,0),$.connect(E,0,1),ne.connect(E,0,1)},disconnectGraph(){g.disconnect(N),g.disconnect(K.inputs===void 0?K:K.inputs[0]),N.disconnect(U,0),N.disconnect($,0),N.disconnect(W,1),N.disconnect(ne,1),K.disconnect(y),y.disconnect(F.inputs===void 0?F:F.inputs[0]),y.disconnect(q.inputs===void 0?q:q.inputs[0]),y.disconnect(X.inputs===void 0?X:X.inputs[0]),y.disconnect(Z.inputs===void 0?Z:Z.inputs[0]),F.disconnect(U.gain),q.disconnect($.gain),X.disconnect(W.gain),Z.disconnect(ne.gain),U.disconnect(E,0,0),W.disconnect(E,0,0),$.disconnect(E,0,1),ne.disconnect(E,0,1)}}},p=(f,g,y,E,w)=>{if(g===1)return d(f,y,E,w);if(g===2)return h(f,y,E,w);throw i()};return(f,{channelCount:g,channelCountMode:y,pan:E,...w})=>{if(y==="max")throw i();const R=t(f,{...w,channelCount:1,channelCountMode:y,numberOfInputs:2}),A=n(f,{...w,channelCount:g,channelCountMode:y,gain:1}),k=n(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:E});let{connectGraph:I,disconnectGraph:N}=p(f,g,A,k,R);Object.defineProperty(k.gain,"defaultValue",{get:()=>0}),Object.defineProperty(k.gain,"maxValue",{get:()=>1}),Object.defineProperty(k.gain,"minValue",{get:()=>-1});const U={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(K){A.channelCount!==K&&(F&&N(),{connectGraph:I,disconnectGraph:N}=p(f,K,A,k,R),F&&I()),A.channelCount=K},get channelCountMode(){return A.channelCountMode},set channelCountMode(K){if(K==="clamped-max"||K==="max")throw i();A.channelCountMode=K},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(K){A.channelInterpretation=K},get context(){return A.context},get inputs(){return[A]},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get pan(){return k.gain},addEventListener(...K){return A.addEventListener(K[0],K[1],K[2])},dispatchEvent(...K){return A.dispatchEvent(K[0])},removeEventListener(...K){return A.removeEventListener(K[0],K[1],K[2])}};let F=!1;const $=()=>{I(),F=!0},q=()=>{N(),F=!1};return s(_S(U,R),$,q)}},YHe=(t,e,n,r,i,s,o)=>(a,c)=>{const l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return n(a,c);Ba(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();qs(l,{curve:u},"curve"),qs(l,c,"oversample");let d=null,h=!1;return o(l,"curve",g=>()=>g.call(l),g=>y=>(g.call(l,y),h&&(r(y)&&d===null?d=t(a,l):!r(y)&&d!==null&&(d(),d=null)),y)),i(l,()=>{h=!0,r(l.curve)&&(d=t(a,l))},()=>{h=!1,d!==null&&(d(),d=null)})},XHe=(t,e,n,r,i)=>(s,{curve:o,oversample:a,...c})=>{const l=s.createWaveShaper(),u=s.createWaveShaper();Ba(l,c),Ba(u,c);const d=n(s,{...c,gain:1}),h=n(s,{...c,gain:-1}),p=n(s,{...c,gain:1}),f=n(s,{...c,gain:-1});let g=null,y=!1,E=null;const w={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(k){d.channelCount=k,h.channelCount=k,l.channelCount=k,p.channelCount=k,u.channelCount=k,f.channelCount=k},get channelCountMode(){return l.channelCountMode},set channelCountMode(k){d.channelCountMode=k,h.channelCountMode=k,l.channelCountMode=k,p.channelCountMode=k,u.channelCountMode=k,f.channelCountMode=k},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(k){d.channelInterpretation=k,h.channelInterpretation=k,l.channelInterpretation=k,p.channelInterpretation=k,u.channelInterpretation=k,f.channelInterpretation=k},get context(){return l.context},get curve(){return E},set curve(k){if(k!==null&&k.length<2)throw e();if(k===null)l.curve=k,u.curve=k;else{const I=k.length,N=new Float32Array(I+2-I%2),U=new Float32Array(I+2-I%2);N[0]=k[0],U[0]=-k[I-1];const F=Math.ceil((I+1)/2),$=(I+1)/2-1;for(let q=1;q<F;q+=1){const K=q/F*$,W=Math.floor(K),X=Math.ceil(K);N[q]=W===X?k[W]:(1-(K-W))*k[W]+(1-(X-K))*k[X],U[q]=W===X?-k[I-1-W]:-((1-(K-W))*k[I-1-W])-(1-(X-K))*k[I-1-X]}N[F]=I%2===1?k[F-1]:(k[F-2]+k[F-1])/2,l.curve=N,u.curve=U}E=k,y&&(r(E)&&g===null?g=t(s,d):g!==null&&(g(),g=null))},get inputs(){return[d]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(k){l.oversample=k,u.oversample=k},addEventListener(...k){return d.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return d.dispatchEvent(k[0])},removeEventListener(...k){return d.removeEventListener(k[0],k[1],k[2])}};o!==null&&(w.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==w.oversample&&(w.oversample=a);const R=()=>{d.connect(l).connect(p),d.connect(h).connect(u).connect(f).connect(p),y=!0,r(E)&&(g=t(s,d))},A=()=>{d.disconnect(l),l.disconnect(p),d.disconnect(h),h.disconnect(u),u.disconnect(f),f.disconnect(p),y=!1,g!==null&&(g(),g=null)};return i(_S(w,p),R,A)},Ll=()=>new DOMException("","NotSupportedError"),JHe={numberOfChannels:1},QHe=(t,e,n,r,i)=>class extends t{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:d,sampleRate:h}={...JHe,...l},p=r(d,u,h);e(aw,()=>aw(p))||p.addEventListener("statechange",(()=>{let f=0;const g=y=>{this._state==="running"&&(f>0?(p.removeEventListener("statechange",g),y.stopImmediatePropagation(),this._waitForThePromiseToSettle(y)):f+=1)};return g})()),super(p,d),this._length=u,this._nativeOfflineAudioContext=p,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,SQ(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},ZHe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},e5e=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={...ZHe,...l},h=n(u,d),p=s(u),f=p?r():null,g=c.sampleRate/2;super(c,!1,h,f),this._detune=e(this,p,h.detune,153600,-153600),this._frequency=e(this,p,h.frequency,g,-g),this._nativeOscillatorNode=h,this._onended=null,this._oscillatorNodeRenderer=f,this._oscillatorNodeRenderer!==null&&d.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=d.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){YE(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),sg(this)&&mx(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},t5e=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null,c=null;const l=async(u,d)=>{let h=n(u);const p=el(h,d);if(!p){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:o===null?void 0:o,type:h.type};h=e(d,f),a!==null&&h.start(a),c!==null&&h.stop(c)}return s.set(d,h),p?(await t(d,u.detune,h.detune),await t(d,u.frequency,h.frequency)):(await r(d,u.detune,h.detune),await r(d,u.frequency,h.frequency)),await i(u,d,h),h};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,d){const h=s.get(d);return h!==void 0?Promise.resolve(h):l(u,d)}}},n5e={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},r5e=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={...n5e,...l},h=n(u,d),p=s(u),f=p?r():null;super(c,!1,h,f),this._nativePannerNode=h,this._orientationX=e(this,p,h.orientationX,Al,tu),this._orientationY=e(this,p,h.orientationY,Al,tu),this._orientationZ=e(this,p,h.orientationZ,Al,tu),this._positionX=e(this,p,h.positionX,Al,tu),this._positionY=e(this,p,h.positionY,Al,tu),this._positionZ=e(this,p,h.positionZ,Al,tu),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},i5e=(t,e,n,r,i,s,o,a,c,l)=>()=>{const u=new WeakMap;let d=null;const h=async(p,f)=>{let g=null,y=s(p);const E={channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation},w={...E,coneInnerAngle:y.coneInnerAngle,coneOuterAngle:y.coneOuterAngle,coneOuterGain:y.coneOuterGain,distanceModel:y.distanceModel,maxDistance:y.maxDistance,panningModel:y.panningModel,refDistance:y.refDistance,rolloffFactor:y.rolloffFactor},R=el(y,f);if("bufferSize"in y)g=r(f,{...E,gain:1});else if(!R){const A={...w,orientationX:y.orientationX.value,orientationY:y.orientationY.value,orientationZ:y.orientationZ.value,positionX:y.positionX.value,positionY:y.positionY.value,positionZ:y.positionZ.value};y=i(f,A)}if(u.set(f,g===null?y:g),g!==null){if(d===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const q=new o(6,p.context.length,f.sampleRate),K=e(q,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});K.connect(q.destination),d=(async()=>{const W=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map(async(X,ne)=>{const Z=n(q,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ne===0?1:0});return await a(q,X,Z.offset),Z}));for(let X=0;X<6;X+=1)W[X].connect(K,0,X),W[X].start(0);return l(q)})()}const A=await d,k=r(f,{...E,gain:1});await c(p,f,k);const I=[];for(let q=0;q<A.numberOfChannels;q+=1)I.push(A.getChannelData(q));let N=[I[0][0],I[1][0],I[2][0]],U=[I[3][0],I[4][0],I[5][0]],F=r(f,{...E,gain:1}),$=i(f,{...w,orientationX:N[0],orientationY:N[1],orientationZ:N[2],positionX:U[0],positionY:U[1],positionZ:U[2]});k.connect(F).connect($.inputs[0]),$.connect(g);for(let q=128;q<A.length;q+=128){const K=[I[0][q],I[1][q],I[2][q]],W=[I[3][q],I[4][q],I[5][q]];if(K.some((X,ne)=>X!==N[ne])||W.some((X,ne)=>X!==U[ne])){N=K,U=W;const X=q/f.sampleRate;F.gain.setValueAtTime(0,X),F=r(f,{...E,gain:0}),$=i(f,{...w,orientationX:N[0],orientationY:N[1],orientationZ:N[2],positionX:U[0],positionY:U[1],positionZ:U[2]}),F.gain.setValueAtTime(1,X),k.connect(F).connect($.inputs[0]),$.connect(g)}}return g}return R?(await t(f,p.orientationX,y.orientationX),await t(f,p.orientationY,y.orientationY),await t(f,p.orientationZ,y.orientationZ),await t(f,p.positionX,y.positionX),await t(f,p.positionY,y.positionY),await t(f,p.positionZ,y.positionZ)):(await a(f,p.orientationX,y.orientationX),await a(f,p.orientationY,y.orientationY),await a(f,p.orientationZ,y.orientationZ),await a(f,p.positionX,y.positionX),await a(f,p.positionY,y.positionY),await a(f,p.positionZ,y.positionZ)),vS(y)?await c(p,f,y.inputs[0]):await c(p,f,y),y};return{render(p,f){const g=u.get(f);return g!==void 0?Promise.resolve(g):h(p,f)}}},s5e={disableNormalization:!1},o5e=(t,e,n,r)=>class kQ{constructor(s,o){const a=e(s),c=r({...s5e,...o}),l=t(a,c);return n.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===kQ.prototype||n.has(s)}},a5e=(t,e)=>(n,r,i)=>(t(r).replay(i),e(r,n,i)),c5e=(t,e,n)=>async(r,i,s)=>{const o=t(r);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const h=await e(l).render(l,i),p=r.context.destination;!n(l)&&(r!==p||!n(r))&&h.connect(s,u,c)})).reduce((a,c)=>[...a,...c],[]))},l5e=(t,e,n)=>async(r,i,s)=>{const o=e(r);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await t(a).render(a,i);n(a)||u.connect(s,c)}))},u5e=(t,e,n,r)=>i=>t(aw,()=>aw(i))?Promise.resolve(t(r,r)).then(s=>{if(!s){const o=n(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),d5e=t=>(e,n)=>{t.set(e,n)},h5e=t=>(e,n)=>t.set(e,n),f5e=(t,e,n,r,i,s,o,a)=>(c,l)=>n(c).render(c,l).then(()=>Promise.all(Array.from(r(l)).map(u=>n(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),o4(u)):e(s,()=>s(u))||a(u),t.add(u),u)),p5e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},m5e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...p5e,...c},d=n(l,u),h=s(l),p=h?r():null;super(a,!1,d,p),this._pan=e(this,h,d.pan)}get pan(){return this._pan}},g5e=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=el(l,c);if(!u){const d={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,d)}return s.set(c,l),u?await t(c,a.pan,l.pan):await r(c,a.pan,l.pan),vS(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},v5e=t=>()=>{if(t===null)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},_5e=(t,e)=>async()=>{if(t===null)return!0;if(e===null)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(n);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new t(r,"a",{numberOfOutputs:0}),c=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await r.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},y5e=(t,e)=>()=>{if(e===null)return Promise.resolve(!1);const n=new e(1,1,44100),r=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{n.oncomplete=()=>{r.disconnect(),i(n.currentTime!==0)},n.startRendering()})},b5e=()=>new DOMException("","UnknownError"),E5e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},S5e=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={...E5e,...l},h=n(u,d),f=s(u)?r():null;super(c,!0,h,f),this._isCurveNullified=!1,this._nativeWaveShaperNode=h,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},T5e=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!el(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(o,l)}return r.set(o,a),vS(a)?await n(s,o,a.inputs[0]):await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},w5e=()=>typeof window>"u"?null:window,x5e=(t,e)=>n=>{n.copyFromChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(a),u=r.length;for(let d=o<0?-o:0;d+o<c&&d<u;d+=1)r[d]=l[d+o]},n.copyToChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(a),u=r.length;for(let d=o<0?-o:0;d+o<c&&d<u;d+=1)l[d+o]=r[d]}},C5e=t=>e=>{e.copyFromChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyToChannel)},R5e=t=>(e,n)=>{const r=n.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),t(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},A5e=(t,e)=>(n,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(r,()=>{const a=r.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(r,0,c)},()=>i.disconnect(r))},NQ=(t,e,n)=>t.copyFromChannel===void 0?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),PQ=t=>{if(t===null)return!1;const e=t.length;return e%2!==0?t[Math.floor(e/2)]!==0:t[e/2-1]+t[e/2]!==0},bx=(t,e,n,r)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(s),set:r(o)})},M5e=t=>({...t,outputChannelCount:t.outputChannelCount!==void 0?t.outputChannelCount:t.numberOfInputs===1&&t.numberOfOutputs===1?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),I5e=t=>({...t,channelCount:t.numberOfOutputs}),O5e=t=>{const{imag:e,real:n}=t;return e===void 0?n===void 0?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:n===void 0?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}},DQ=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(r){if(r.code!==9)throw r;DQ(t,e,n+1e-7)}},k5e=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},N5e=t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},P5e=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},d4=t=>{const e=t.createOscillator();try{e.start(-1)}catch(n){return n instanceof RangeError}return!1},LQ=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},h4=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(n){return n instanceof RangeError}return!1},D5e=t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}},L5e=t=>{t.start=(e=>(n=0,r=0,i)=>{const s=t.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})(t.start)},UQ=(t,e)=>{const n=e.createGain();t.connect(n);const r=(i=>()=>{i.call(t,n),t.removeEventListener("ended",r)})(t.disconnect);t.addEventListener("ended",r),_S(t,n),t.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(t,o)}catch{n.gain.setValueAtTime(0,o)}else i.call(t,o),s=!0}})(t.stop)},yS=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),typeof e=="function"?e.call(t,n):e.handleEvent.call(t,n)},U5e=rje(Ry),F5e=lje(Ry),B5e=E$e(Hk),FQ=new WeakMap,j5e=B$e(FQ),rf=Jje(new Map,new WeakMap),Tp=w5e(),BQ=mHe(rf,Up),f4=F$e(Ml),Oc=c5e(Ml,f4,cy),$5e=pje(BQ,Fs,Oc),Rs=H$e($k),Mg=HHe(Tp),rs=sHe(Mg),jQ=new WeakMap,$Q=O$e(yS),Ex=yHe(Tp),p4=tHe(Ex),m4=nHe(Tp),HQ=rHe(Tp),cw=EHe(Tp),Ho=Bje(ije(mQ),cje(U5e,F5e,mA,B5e,gA,Ml,j5e,px,Fs,Ry,sg,cy,YC),rf,X$e(eF,gA,Ml,Fs,ow,sg),Up,Vk,Ll,v$e(mA,eF,Ml,Fs,ow,Rs,sg,rs),w$e(jQ,Ml,Wh),$Q,Rs,p4,m4,HQ,rs,cw),H5e=fje(Ho,$5e,Up,BQ,Rs,rs),g4=new WeakSet,v8=gHe(Tp),VQ=u$e(new Uint32Array(1)),v4=x5e(VQ,Up),_4=C5e(VQ),zQ=gje(g4,rf,Ll,v8,Mg,v5e(v8),v4,_4),zk=uje(_u),GQ=l5e(f4,gx,cy),Fp=i$e(GQ),bS=_He(zk,rf,k5e,N5e,P5e,d4,LQ,h4,L5e,R5e(bx),UQ),Bp=a5e(j$e(gx),GQ),V5e=yje(Fp,bS,Fs,Bp,Oc),sf=jje(sje(gQ),jQ,s4,$je,J4e,Q4e,Z4e,eje,tje,JU,fQ,Ex,DQ),z5e=_je(Ho,V5e,sf,lc,bS,Rs,rs,yS),G5e=Aje(Ho,Mje,Up,lc,bHe(_u,bx),Rs,rs,Oc),W5e=Xje(Fp,IQ,Fs,Bp,Oc),Ay=h5e(FQ),q5e=Yje(Ho,sf,W5e,Vk,IQ,Rs,rs,Ay),N_=fHe(Ry,m4),K5e=A5e(lc,N_),P_=AHe(Ex,K5e),Y5e=e$e(P_,Fs,Oc),X5e=Zje(Ho,Y5e,P_,Rs,rs),J5e=r$e(_x,Fs,Oc),Q5e=n$e(Ho,J5e,_x,Rs,rs,I5e),Z5e=OHe(zk,bS,_u,N_),ES=IHe(zk,rf,Z5e,d4,h4),e6e=l$e(Fp,ES,Fs,Bp,Oc),t6e=c$e(Ho,sf,e6e,ES,Rs,rs,yS),WQ=kHe(Ll,bx),n6e=f$e(WQ,Fs,Oc),r6e=h$e(Ho,n6e,WQ,Rs,rs,Ay),i6e=b$e(Fp,OQ,Fs,Bp,Oc),s6e=y$e(Ho,sf,i6e,OQ,Rs,rs,Ay),qQ=NHe(Ll),o6e=A$e(Fp,qQ,Fs,Bp,Oc),a6e=R$e(Ho,sf,o6e,qQ,Ll,Rs,rs,Ay),c6e=L$e(Fp,_u,Fs,Bp,Oc),l6e=D$e(Ho,sf,c6e,_u,Rs,rs),u6e=UHe(Vk,lc,yx,Ll),Gk=u5e(rf,_u,yx,y5e(_u,Mg)),d6e=Y$e(bS,Fs,Mg,Oc,Gk),h6e=PHe(u6e),f6e=q$e(Ho,h6e,d6e,Rs,rs,Ay),p6e=Ije(sf,P_,ES,yx,Ll,NQ,rs,bx),KQ=new WeakMap,m6e=hHe(G5e,p6e,$Q,rs,KQ,yS),YQ=VHe(zk,rf,d4,LQ,h4,UQ),g6e=t5e(Fp,YQ,Fs,Bp,Oc),v6e=e5e(Ho,sf,YQ,g6e,Rs,rs,yS),XQ=o$e(bS),_6e=XHe(XQ,lc,_u,PQ,N_),Wk=YHe(XQ,lc,_6e,PQ,N_,Ex,bx),y6e=GHe(mA,lc,P_,_u,yx,Wk,Ll,gA,NQ,N_),JQ=zHe(y6e),b6e=i5e(Fp,P_,ES,_u,JQ,Fs,Mg,Bp,Oc,Gk),E6e=r5e(Ho,sf,JQ,b6e,Rs,rs,Ay),S6e=WHe(Up),T6e=o5e(S6e,Rs,new WeakSet,O5e),w6e=KHe(P_,_x,_u,Wk,Ll,N_),QQ=qHe(w6e,Ll),x6e=g5e(Fp,QQ,Fs,Bp,Oc),C6e=m5e(Ho,sf,QQ,x6e,Rs,rs),R6e=T5e(Wk,Fs,Oc),A6e=S5e(Ho,lc,Wk,R6e,Rs,rs,Ay),ZQ=oHe(Tp),y4=k$e(Tp),eZ=new WeakMap,M6e=V$e(eZ,Mg),I6e=ZQ?aje(rf,Ll,I$e(Tp),y4,N$e(nje),Rs,M6e,rs,cw,new WeakMap,new WeakMap,_5e(cw,Mg),Tp):void 0,O6e=iHe(p4,rs),k6e=g$e(g4,rf,m$e,M$e,new WeakSet,Rs,O6e,fA,aw,v4,_4),tZ=qje(I6e,H5e,zQ,z5e,q5e,X5e,Q5e,t6e,r6e,k6e,s6e,a6e,l6e,f6e,m6e,v6e,E6e,T6e,C6e,A6e),N6e=aHe(Ho,FHe,Rs,rs),P6e=lHe(Ho,BHe,Rs,rs),D6e=uHe(Ho,jHe,Rs,rs),L6e=$He(lc,rs),U6e=dHe(Ho,L6e,Rs),F6e=Rje(tZ,lc,Ll,b5e,N6e,P6e,D6e,U6e,Ex),b4=z$e(KQ),B6e=dje(b4),nZ=s$e(Up),j6e=S$e(b4),rZ=x$e(Up),iZ=new WeakMap,$6e=U$e(iZ,Wh),H6e=RHe(nZ,Up,lc,P_,_x,ES,_u,yx,Ll,rZ,y4,$6e,N_),V6e=THe(lc,H6e,_u,Ll,N_),z6e=Wje(Fp,nZ,bS,P_,_x,ES,_u,j6e,rZ,y4,Fs,cw,Mg,Bp,Oc,Gk),G6e=$$e(eZ),W6e=d5e(iZ),_8=ZQ?Vje(B6e,Ho,sf,z6e,V6e,Ml,G6e,Rs,rs,cw,M5e,W6e,D5e,yS):void 0,q6e=p$e(Ll,Mg),K6e=f5e(g4,rf,f4,b4,Gk,fA,v4,_4),Y6e=QHe(tZ,rf,lc,q6e,K6e),X6e=J$e($k,p4),J6e=Q$e(i4,m4),Q6e=Z$e(s4,HQ),Z6e=eHe($k,rs);function Ju(t){return t===void 0}function Zr(t){return t!==void 0}function eVe(t){return typeof t=="function"}function qh(t){return typeof t=="number"}function o_(t){return Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object}function sZ(t){return typeof t=="boolean"}function du(t){return Array.isArray(t)}function pg(t){return typeof t=="string"}function nC(t){return pg(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function or(t,e){if(!t)throw new Error(e)}function wp(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function oZ(t){!t.isOffline&&t.state!=="running"&&qk('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let aZ=!1,y8=!1;function b8(t){aZ=t}function tVe(t){Ju(t)&&aZ&&!y8&&(y8=!0,qk("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let cZ=console;function nVe(...t){cZ.log(...t)}function qk(...t){cZ.warn(...t)}function rVe(t){return new F6e(t)}function iVe(t,e,n){return new Y6e(t,e,n)}const Vu=typeof self=="object"?self:null,sVe=Vu&&(Vu.hasOwnProperty("AudioContext")||Vu.hasOwnProperty("webkitAudioContext"));function oVe(t,e,n){return or(Zr(_8),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof(Vu==null?void 0:Vu.BaseAudioContext)?Vu==null?void 0:Vu.AudioWorkletNode:_8)(t,e,n)}var sF=function(t,e){return sF=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},sF(t,e)};function lZ(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");sF(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function As(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function ao(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function E4(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Kk(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function oF(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}class aVe{constructor(e,n,r,i){this._callback=e,this._type=n,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);r.onmessage=this._callback.bind(this),this._worker=r}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var n;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((n=this._worker)===null||n===void 0||n.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function ly(t){return Q6e(t)}function a_(t){return J6e(t)}function XC(t){return Z6e(t)}function Pb(t){return X6e(t)}function cVe(t){return t instanceof zQ}function lVe(t,e){return t==="value"||ly(e)||a_(e)||cVe(e)}function $0(t,...e){if(!e.length)return t;const n=e.shift();if(o_(t)&&o_(n))for(const r in n)lVe(r,n[r])?t[r]=n[r]:o_(n[r])?(t[r]||Object.assign(t,{[r]:{}}),$0(t[r],n[r])):Object.assign(t,{[r]:n[r]});return $0(t,...e)}function uVe(t,e){return t.length===e.length&&t.every((n,r)=>e[r]===n)}function xn(t,e,n=[],r){const i={},s=Array.from(e);if(o_(s[0])&&r&&!Reflect.has(s[0],r)&&(Object.keys(s[0]).some(a=>Reflect.has(t,a))||($0(i,{[r]:s[0]}),n.splice(n.indexOf(r),1),s.shift())),s.length===1&&o_(s[0]))$0(i,s[0]);else for(let o=0;o<n.length;o++)Zr(s[o])&&(i[n[o]]=s[o]);return $0(t,i)}function dVe(t){return t.constructor.getDefaults()}function pp(t,e){return Ju(t)?e:t}function lw(t,e){return e.forEach(n=>{Reflect.has(t,n)&&delete t[n]}),t}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class Ig{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Vu&&this.toString()===Vu.TONE_DEBUG_CLASS)&&nVe(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Ig.version=hQ;const S4=1e-6;function XE(t,e){return t>e+S4}function aF(t,e){return XE(t,e)||Oh(t,e)}function bA(t,e){return t+S4<e}function Oh(t,e){return Math.abs(t-e)<S4}function hVe(t,e,n){return Math.max(Math.min(t,n),e)}class Dd extends Ig{constructor(){super(),this.name="Timeline",this._timeline=[];const e=xn(Dd.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(or(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const n=this._timeline[this.length-1];or(aF(e.time,n.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const n=this._search(e.time);this._timeline.splice(n+1,0,e)}if(this.length>this.memory){const n=this.length-this.memory;this._timeline.splice(0,n)}return this}remove(e){const n=this._timeline.indexOf(e);return n!==-1&&this._timeline.splice(n,1),this}get(e,n="time"){const r=this._search(e,n);return r!==-1?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,n="time"){const r=this._search(e,n);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(e){const n=this._timeline.length;if(n>0&&this._timeline[n-1].time<e)return this._timeline[n-1];const r=this._search(e);return r-1>=0?this._timeline[r-1]:null}cancel(e){if(this._timeline.length>1){let n=this._search(e);if(n>=0)if(Oh(this._timeline[n].time,e)){for(let r=n;r>=0&&Oh(this._timeline[r].time,e);r--)n=r;this._timeline=this._timeline.slice(0,n)}else this._timeline=this._timeline.slice(0,n+1);else this._timeline=[]}else this._timeline.length===1&&aF(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const n=this._search(e);return n>=0&&(this._timeline=this._timeline.slice(n+1)),this}previousEvent(e){const n=this._timeline.indexOf(e);return n>0?this._timeline[n-1]:null}_search(e,n="time"){if(this._timeline.length===0)return-1;let r=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][n]<=e)return i-1;for(;r<s;){let o=Math.floor(r+(s-r)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Oh(a[n],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(Oh(u[n],e))o=l;else break}return o}else{if(bA(a[n],e)&&XE(c[n],e))return o;XE(a[n],e)?s=o:r=o+1}}return-1}_iterate(e,n=0,r=this._timeline.length-1){this._timeline.slice(n,r+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,n){const r=this._search(e);return r!==-1&&this._iterate(n,0,r),this}forEachAfter(e,n){const r=this._search(e);return this._iterate(n,r+1),this}forEachBetween(e,n,r){let i=this._search(e),s=this._search(n);return i!==-1&&s!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[s].time===n&&(s-=1),this._iterate(r,i,s)):i===-1&&this._iterate(r,0,s),this}forEachFrom(e,n){let r=this._search(e);for(;r>=0&&this._timeline[r].time>=e;)r--;return this._iterate(n,r+1),this}forEachAtTime(e,n){const r=this._search(e);if(r!==-1&&Oh(this._timeline[r].time,e)){let i=r;for(let s=r;s>=0&&Oh(this._timeline[s].time,e);s--)i=s;this._iterate(s=>{n(s)},i,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const uZ=[];function Yk(t){uZ.push(t)}function fVe(t){uZ.forEach(e=>e(t))}const dZ=[];function Xk(t){dZ.push(t)}function pVe(t){dZ.forEach(e=>e(t))}class Sx extends Ig{constructor(){super(...arguments),this.name="Emitter"}on(e,n){return e.split(/\W+/).forEach(i=>{Ju(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(n)}),this}once(e,n){const r=(...i)=>{n(...i),this.off(e,r)};return this.on(e,r),this}off(e,n){return e.split(/\W+/).forEach(i=>{if(Ju(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(Ju(n))this._events[i]=[];else{const s=this._events[i];for(let o=s.length-1;o>=0;o--)s[o]===n&&s.splice(o,1)}}),this}emit(e,...n){if(this._events&&this._events.hasOwnProperty(e)){const r=this._events[e].slice(0);for(let i=0,s=r.length;i<s;i++)r[i].apply(this,n)}return this}static mixin(e){["on","once","off","emit"].forEach(n=>{const r=Object.getOwnPropertyDescriptor(Sx.prototype,n);Object.defineProperty(e.prototype,n,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class hZ extends Sx{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Tx extends hZ{constructor(){var e,n;super(),this.name="Context",this._constants=new Map,this._timeouts=new Dd,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const r=xn(Tx.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=rVe({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new aVe(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((n=arguments[0])===null||n===void 0)&&n.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(fVe(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,n,r){return this._context.createBuffer(e,n,r)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,n){return this._context.createIIRFilter(e,n)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,n,r){return this._context.createPeriodicWave(e,n,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return or(Pb(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return or(Pb(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return or(Pb(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){or(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){or(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){or(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){or(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,n){return oVe(this.rawContext,e,n)}addAudioWorkletModule(e){return ao(this,void 0,void 0,function*(){or(Zr(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return ao(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Pb(this._context)?this._context.resume():Promise.resolve()}close(){return ao(this,void 0,void 0,function*(){Pb(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&pVe(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const n=this._context.createBuffer(1,128,this._context.sampleRate),r=n.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=n,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let n=this._timeouts.peek();for(;this._timeouts.length&&n&&n.time<=e;)n.callback(),this._timeouts.shift(),n=this._timeouts.peek()}setTimeout(e,n){this._timeoutIds++;const r=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:r+n}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(n=>{n.id===e&&this._timeouts.remove(n)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,n){const r=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),i()},id:r,time:s+n})};return i(),r}}class mVe extends hZ{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,n,r){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,n){return{}}createPanner(){return{}}createPeriodicWave(e,n,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,n){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return ao(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,n){return 0}clearTimeout(e){return this}setInterval(e,n){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function li(t,e){du(e)?e.forEach(n=>li(t,n)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function wx(t,e){du(e)?e.forEach(n=>wx(t,n)):Object.defineProperty(t,e,{writable:!0})}const Hi=()=>{};class ts extends Ig{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Hi;const e=xn(ts.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,pg(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:Hi,onload:Hi,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:cc().sampleRate}set(e){return e instanceof ts?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return ao(this,void 0,void 0,function*(){const n=ts.load(e).then(r=>{this.set(r),this.onload(this)});ts.downloads.push(n);try{yield n}finally{const r=ts.downloads.indexOf(n);ts.downloads.splice(r,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const n=du(e)&&e[0].length>0,r=n?e.length:1,i=n?e[0].length:e.length,s=cc(),o=s.createBuffer(r,i,s.sampleRate),a=!n&&r===1?[e]:e;for(let c=0;c<r;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(qh(e))this.fromArray(this.toArray(e));else{let n=new Float32Array(this.length);const r=this.numberOfChannels;for(let i=0;i<r;i++){const s=this.toArray(i);for(let o=0;o<s.length;o++)n[o]+=s[o]}n=n.map(i=>i/r),this.fromArray(n)}return this}toArray(e){if(qh(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const n=[];for(let r=0;r<this.numberOfChannels;r++)n[r]=this.getChannelData(r);return n}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,n=this.duration){or(this.loaded,"Buffer is not loaded");const r=Math.floor(e*this.sampleRate),i=Math.floor(n*this.sampleRate);or(r<i,"The start time must be less than the end time");const s=i-r,o=cc().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(r,i),a);return new ts(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new ts().fromArray(e)}static fromUrl(e){return ao(this,void 0,void 0,function*(){return yield new ts().load(e)})}static load(e){return ao(this,void 0,void 0,function*(){const n=e.match(/\[([^\]\[]+\|.+)\]$/);if(n){const c=n[1].split("|");let l=c[0];for(const u of c)if(ts.supportsType(u)){l=u;break}e=e.replace(n[0],l)}const r=ts.baseUrl===""||ts.baseUrl.endsWith("/")?ts.baseUrl:ts.baseUrl+"/",i=document.createElement("a");i.href=r+e,i.pathname=(i.pathname+i.hash).split("/").map(encodeURIComponent).join("/");const s=yield fetch(i.href);if(!s.ok)throw new Error(`could not load url: ${e}`);const o=yield s.arrayBuffer();return yield cc().decodeAudioData(o)})}static supportsType(e){const n=e.split("."),r=n[n.length-1];return document.createElement("audio").canPlayType("audio/"+r)!==""}static loaded(){return ao(this,void 0,void 0,function*(){for(yield Promise.resolve();ts.downloads.length;)yield ts.downloads[0]})}}ts.baseUrl="";ts.downloads=[];class Jk extends Tx{constructor(){super({clockSource:"offline",context:XC(arguments[0])?arguments[0]:iVe(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:XC(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=XC(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return ao(this,void 0,void 0,function*(){let n=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,n++;const r=Math.floor(this.sampleRate/128);e&&n%r===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return ao(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const n=yield this._context.startRendering();return new ts(n)})}close(){return Promise.resolve()}}const fZ=new mVe;let P0=fZ;function cc(){return P0===fZ&&sVe&&gVe(new Tx),P0}function gVe(t,e=!1){e&&P0.dispose(),Pb(t)?P0=new Tx(t):XC(t)?P0=new Jk(t):P0=t}function vVe(){return P0.resume()}if(Vu&&!Vu.TONE_SILENCE_LOGGING){const e=` * Tone.js v${hQ} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function _Ve(t){return Math.pow(10,t/20)}function yVe(t){return 20*(Math.log(t)/Math.LN10)}function pZ(t){return Math.pow(2,t/12)}let Qk=440;function bVe(){return Qk}function EVe(t){Qk=t}function D0(t){return Math.round(mZ(t))}function mZ(t){return 69+12*Math.log2(t/Qk)}function gZ(t){return Qk*Math.pow(2,(t-69)/12)}class T4 extends Ig{constructor(e,n,r){super(),this.defaultUnits="s",this._val=n,this._units=r,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,n)=>{const r=parseInt(e,10),i=n==="."?1.5:1;return r===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/r)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const n=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(n)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,n,r)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i+=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i+=this._beatsToUnits(parseFloat(r)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof T4&&this.fromType(this._val),Ju(this._val))return this._noArg();if(pg(this._val)&&Ju(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(o_(this._val)){let e=0;for(const n in this._val)if(Zr(this._val[n])){const r=this._val[n],i=new this.constructor(this.context,n).valueOf()*r;e+=i}return e}if(Zr(this._units)){const e=this._expressions[this._units],n=this._val.toString().trim().match(e.regexp);return n?e.method.apply(this,n.slice(1)):e.method.call(this,this._val)}else return pg(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Nd extends T4{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const n=new Nd(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(n))},regexp:/^@(.+)/}})}quantize(e,n=1){const r=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/r)*r-i;return i+a*n}toNotation(){const e=this.toSeconds(),n=["1m"];for(let s=1;s<9;s++){const o=Math.pow(2,s);n.push(o+"n."),n.push(o+"n"),n.push(o+"t")}n.push("0");let r=n[0],i=new Nd(this.context,n[0]).toSeconds();return n.forEach(s=>{const o=new Nd(this.context,s).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(r=s,i=o)}),r}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let n=this.valueOf()/e;n=parseFloat(n.toFixed(4));const r=Math.floor(n/this._getTimeSignature());let i=n%1*4;n=Math.floor(n)%this._getTimeSignature();const s=i.toString();return s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3))),[r,n,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return D0(this.toFrequency())}_now(){return this.context.now()}}function Ca(t,e){return new Nd(cc(),t,e)}class au extends Nd{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return bVe()}static set A4(e){EVe(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:au.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,n){const i=SVe[e.toLowerCase()]+(parseInt(n,10)+1)*12;return this.defaultUnits==="midi"?i:au.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,n,r){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i*=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i*=this._beatsToUnits(parseFloat(r)/4)),i}}})}transpose(e){return new au(this.context,this.valueOf()*pZ(e))}harmonize(e){return e.map(n=>this.transpose(n))}toMidi(){return D0(this.valueOf())}toNote(){const e=this.toFrequency(),n=Math.log2(e/au.A4);let r=Math.round(12*n)+57;const i=Math.floor(r/12);return i<0&&(r+=-12*i),TVe[r%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),n=this.valueOf()/e;return Math.floor(n*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return gZ(e)}static ftom(e){return D0(e)}}const SVe={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},TVe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function E8(t,e){return new au(cc(),t,e)}class hE extends Nd{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Kc extends Ig{constructor(){super();const e=xn(Kc.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:cc()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return tVe(e),new Nd(this.context,e).toSeconds()}toFrequency(e){return new au(this.context,e).toFrequency()}toTicks(e){return new hE(this.context,e).toTicks()}_getPartialProperties(e){const n=this.get();return Object.keys(n).forEach(r=>{Ju(e[r])&&delete n[r]}),n}get(){const e=dVe(this);return Object.keys(e).forEach(n=>{if(Reflect.has(this,n)){const r=this[n];Zr(r)&&Zr(r.value)&&Zr(r.setValueAtTime)?e[n]=r.value:r instanceof Kc?e[n]=r._getPartialProperties(e[n]):du(r)||qh(r)||pg(r)||sZ(r)?e[n]=r:delete e[n]}}),e}set(e){return Object.keys(e).forEach(n=>{Reflect.has(this,n)&&Zr(this[n])&&(this[n]&&Zr(this[n].value)&&Zr(this[n].setValueAtTime)?this[n].value!==e[n]&&(this[n].value=e[n]):this[n]instanceof Kc?this[n].set(e[n]):this[n]=e[n])}),this}}class xx extends Dd{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const n=this.get(e);return n!==null?n.state:this._initial}setStateAtTime(e,n,r){return wp(n,0),this.add(Object.assign({},r,{state:e,time:n})),this}getLastState(e,n){const r=this._search(n);for(let i=r;i>=0;i--){const s=this._timeline[i];if(s.state===e)return s}}getNextState(e,n){const r=this._search(n);if(r!==-1)for(let i=r;i<this._timeline.length;i++){const s=this._timeline[i];if(s.state===e)return s}}}class ni extends Kc{constructor(){const e=xn(ni.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,or(Zr(e.param)&&(ly(e.param)||e.param instanceof ni),"param must be an AudioParam");!ly(e.param);)e.param=e.param._param;this._swappable=Zr(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Dd(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,Zr(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Kc.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return Zr(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Zr(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,n){return this.units===n}_assertRange(e){return Zr(this.maxValue)&&Zr(this.minValue)&&wp(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?_Ve(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?yVe(e):e}setValueAtTime(e,n){const r=this.toSeconds(n),i=this._fromType(e);return or(isFinite(i)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,r),this._events.add({time:r,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,r),this}getValueAtTime(e){const n=Math.max(this.toSeconds(e),0),r=this._events.getAfter(n),i=this._events.get(n);let s=this._initialValue;if(i===null)s=this._initialValue;else if(i.type==="setTargetAtTime"&&(r===null||r.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(s=this._exponentialApproach(i.time,a,i.value,i.constant,n))}else if(r===null)s=i.value;else if(r.type==="linearRampToValueAtTime"||r.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}r.type==="linearRampToValueAtTime"?s=this._linearInterpolate(i.time,o,r.time,r.value,n):s=this._exponentialInterpolate(i.time,o,r.time,r.value,n)}else s=i.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let n=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(n)===0&&(n=this._toType(this._minOutput)),this.setValueAtTime(n,e),this}linearRampToValueAtTime(e,n){const r=this._fromType(e),i=this.toSeconds(n);return or(isFinite(r)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(r),this._events.add({time:i,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(r,i),this}exponentialRampToValueAtTime(e,n){let r=this._fromType(e);r=Oh(r,0)?this._minOutput:r,this._assertRange(r);const i=this.toSeconds(n);return or(isFinite(r)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(r,i),this}exponentialRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(e,r+this.toSeconds(n)),this}linearRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(e,r+this.toSeconds(n)),this}targetRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(e,r,n),this}exponentialApproachValueAtTime(e,n,r){n=this.toSeconds(n),r=this.toSeconds(r);const i=Math.log(r+1)/Math.log(200);return this.setTargetAtTime(e,n,i),this.cancelAndHoldAtTime(n+r*.9),this.linearRampToValueAtTime(e,n+r),this}setTargetAtTime(e,n,r){const i=this._fromType(e);or(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(n);return this._assertRange(i),or(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({constant:r,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,s,r),this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(e,n,r,i=1){r=this.toSeconds(r),n=this.toSeconds(n);const s=this._fromType(e[0])*i;this.setValueAtTime(this._toType(s),n);const o=r/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),n+a*o)}return this}cancelScheduledValues(e){const n=this.toSeconds(e);return or(isFinite(n),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(n),this._param.cancelScheduledValues(n),this.log(this.units,"cancelScheduledValues",n),this}cancelAndHoldAtTime(e){const n=this.toSeconds(e),r=this._fromType(this.getValueAtTime(n));or(isFinite(n),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",n,"value="+r);const i=this._events.get(n),s=this._events.getAfter(n);return i&&Oh(i.time,n)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(n),this._events.cancel(n+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(r),n):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(r),n)),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}rampTo(e,n=.1,r){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,n,r):this.linearRampTo(e,n,r),this}apply(e){const n=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(n),n);const r=this._events.get(n);if(r&&r.type==="setTargetAtTime"){const i=this._events.getAfter(r.time),s=i?i.time:n+2,o=(s-n)/10;for(let a=n;a<s;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){or(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const n=this.input;return n.disconnect(this._param),this.apply(e),this._param=e,n.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,n,r,i,s){return r+(n-r)*Math.exp(-(s-e)/i)}_linearInterpolate(e,n,r,i,s){return n+(i-n)*((s-e)/(r-e))}_exponentialInterpolate(e,n,r,i,s){return n*Math.pow(i/n,(s-e)/(r-e))}}class On extends Kc{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Zr(this.input)?ly(this.input)||this.input instanceof ni?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Zr(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return Zr(e)&&(e instanceof On||a_(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(r=>{r.channelCount=e.channelCount,r.channelCountMode=e.channelCountMode,r.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();or(e.length>0,"ToneAudioNode does not have any internal nodes");const n=e[0];return{channelCount:n.channelCount,channelCountMode:n.channelCountMode,channelInterpretation:n.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelInterpretation:e}))}connect(e,n=0,r=0){return Kh(this,e,n,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return qk("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,n=0,r=0){return vZ(this,e,n,r),this}chain(...e){return uy(this,...e),this}fan(...e){return e.forEach(n=>this.connect(n)),this}dispose(){return super.dispose(),Zr(this.input)&&(this.input instanceof On?this.input.dispose():a_(this.input)&&this.input.disconnect()),Zr(this.output)&&(this.output instanceof On?this.output.dispose():a_(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function uy(...t){const e=t.shift();t.reduce((n,r)=>(n instanceof On?n.connect(r):a_(n)&&Kh(n,r),r),e)}function Kh(t,e,n=0,r=0){for(or(Zr(t),"Cannot connect from undefined node"),or(Zr(e),"Cannot connect to undefined node"),(e instanceof On||a_(e))&&or(e.numberOfInputs>0,"Cannot connect to node with no inputs"),or(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof On||e instanceof ni;)Zr(e.input)&&(e=e.input);for(;t instanceof On;)Zr(t.output)&&(t=t.output);ly(e)?t.connect(e,n):t.connect(e,n,r)}function vZ(t,e,n=0,r=0){if(Zr(e))for(;e instanceof On;)e=e.input;for(;!a_(t);)Zr(t.output)&&(t=t.output);ly(e)?t.disconnect(e,n):a_(e)?t.disconnect(e,n,r):t.disconnect()}class ri extends On{constructor(){const e=xn(ri.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new ni({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),li(this,"gain")}static getDefaults(){return Object.assign(On.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class JE extends On{constructor(e){super(e),this.onended=Hi,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ri({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(n){const r=this.toSeconds(n);return this._startTime!==-1&&r>=this._startTime&&(this._stopTime===-1||r<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(On.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Hi})}_startGain(e,n=1){or(this._startTime===-1,"Source cannot be started more than once");const r=this.toSeconds(this._fadeIn);return this._startTime=e+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(n,e+r):this._gainNode.gain.exponentialApproachValueAtTime(n,e,r)):this._gainNode.gain.setValueAtTime(n,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){or(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const n=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+n,this._stopTime=Math.max(this._stopTime,this.now()),n>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,n,e):this._gainNode.gain.targetRampTo(0,n,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const r=this._curve==="exponential"?n*2:0;this._stopSource(this.now()+r),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Hi&&(this.onended(this),this.onended=Hi,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),or(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Hi,this}}class w4 extends JE{constructor(){const e=xn(w4.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Kh(this._source,this._gainNode),this.offset=new ni({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(JE.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._source.start(n),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class $i extends On{constructor(){const e=xn($i.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new w4({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(On.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,n=0,r=0){return Zk(this,e,n,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,n){return this._param.setValueAtTime(e,n),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,n){return this._param.linearRampToValueAtTime(e,n),this}exponentialRampToValueAtTime(e,n){return this._param.exponentialRampToValueAtTime(e,n),this}exponentialRampTo(e,n,r){return this._param.exponentialRampTo(e,n,r),this}linearRampTo(e,n,r){return this._param.linearRampTo(e,n,r),this}targetRampTo(e,n,r){return this._param.targetRampTo(e,n,r),this}exponentialApproachValueAtTime(e,n,r){return this._param.exponentialApproachValueAtTime(e,n,r),this}setTargetAtTime(e,n,r){return this._param.setTargetAtTime(e,n,r),this}setValueCurveAtTime(e,n,r,i){return this._param.setValueCurveAtTime(e,n,r,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,n,r){return this._param.rampTo(e,n,r),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Zk(t,e,n,r){(e instanceof ni||ly(e)||e instanceof $i&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof $i&&(e.overridden=!0)),Kh(t,e,n,r)}class x4 extends ni{constructor(){const e=xn(x4.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Dd(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ni.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,n,r){n=this.toSeconds(n),this.setRampPoint(n);const i=this._fromType(e),s=this._events.get(n),o=Math.round(Math.max(1/r,1));for(let a=0;a<=o;a++){const c=r*a+n,l=this._exponentialApproach(s.time,s.value,i,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,n){const r=this.toSeconds(n);super.setValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,n){const r=this.toSeconds(n);super.linearRampToValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,n){n=this.toSeconds(n);const r=this._fromType(e),i=this._events.get(n),s=Math.round(Math.max((n-i.time)*10,1)),o=(n-i.time)/s;for(let a=0;a<=s;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,n,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,n){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Ju(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const r=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(n));const s=this._events.get(n);return s&&s.time===n&&s.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(n-this.sampleTime))),.5*(n-e.time)*(r+i)+e.ticks}getTicksAtTime(e){const n=this.toSeconds(e),r=this._events.get(n);return Math.max(this._getTicksUntilEvent(r,n),0)}getDurationOfTicks(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(n);return this.getTimeOfTick(i+e)-r}getTimeOfTick(e){const n=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(n&&n.ticks===e)return n.time;if(n&&r&&r.type==="linearRampToValueAtTime"&&n.value!==r.value){const i=this._fromType(this.getValueAtTime(n.time)),o=(this._fromType(this.getValueAtTime(r.time))-i)/(r.time-n.time),a=Math.sqrt(Math.pow(i,2)-2*o*(n.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+n.time}else return n?n.value===0?1/0:n.time+(e-n.ticks)/n.value:e/this._initialValue}ticksToTime(e,n){return this.getDurationOfTicks(e,n)}timeToTicks(e,n){const r=this.toSeconds(n),i=this.toSeconds(e),s=this.getTicksAtTime(r);return this.getTicksAtTime(r+i)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const n=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(n,0)}}class C4 extends $i{constructor(){const e=xn(C4.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new x4({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign($i.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,n){return this._param.ticksToTime(e,n)}timeToTicks(e,n){return this._param.timeToTicks(e,n)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,n){return this._param.getDurationOfTicks(e,n)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class R4 extends Kc{constructor(){const e=xn(R4.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new xx,this._tickOffset=new Dd,this._ticksAtTime=new Dd,this._secondsAtTime=new Dd,this.frequency=new C4({context:this.context,units:e.units,value:e.frequency}),li(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Kc.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,n){const r=this.toSeconds(e);return this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),Zr(n)&&this.setTicksAtTime(n,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(e){const n=this.toSeconds(e);if(this._state.getValueAtTime(n)==="stopped"){const r=this._state.get(n);r&&r.time>0&&(this._tickOffset.cancel(r.time),this._state.cancel(r.time))}return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this.setTicksAtTime(0,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const n=this.toSeconds(e),r=this._state.getLastState("stopped",n),i=this._ticksAtTime.get(n),s={state:"paused",time:n};this._state.add(s);let o=i||r,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,n+this.sampleTime,l=>{let u=o.time;const d=this._tickOffset.get(l.time);d&&d.time>=o.time&&(a=d.ticks,u=d.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const n=this.now(),r=this.frequency.timeToTicks(e,n);this.setTicksAtTime(r,n)}getSecondsAtTime(e){e=this.toSeconds(e);const n=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);const i=this._secondsAtTime.get(e);let s=i||n,o=i?i.seconds:0,a=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time;const u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(o=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==r.time&&(a={state:c.state,time:c.time,seconds:o})),s=c}),this._state.remove(r),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,n){return n=this.toSeconds(n),this._tickOffset.cancel(n),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,n),ticks:e,time:n}),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,n=this.now()){const r=this._tickOffset.get(n),i=this._state.get(n),s=Math.max(r.time,i.time),o=this.frequency.getTicksAtTime(s)+e-r.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,n,r){let i=this._state.get(e);this._state.forEachBetween(e,n,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,r),i=o});let s=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=Oh(u,1)?0:u;let d=this.frequency.getTimeOfTick(a+u);for(;d<n;){try{r(d,Math.round(this.getTicksAtTime(d)))}catch(h){s=h;break}d+=this.frequency.getDurationOfTicks(1,d)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class eN extends Kc{constructor(){const e=xn(eN.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=Hi,this._lastUpdate=0,this._state=new xx("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new R4({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,li(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Kc.getDefaults(),{callback:Hi,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,n){oZ(this.context);const r=this.toSeconds(e);return this.log("start",r),this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,n),r<this._lastUpdate&&this.emit("start",r,n)),this}stop(e){const n=this.toSeconds(e);return this.log("stop",n),this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._tickSource.stop(n),n<this._lastUpdate&&this.emit("stop",n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._tickSource.pause(n),n<this._lastUpdate&&this.emit("pause",n)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,n){return this._tickSource.setTicksAtTime(e,n),this}getTimeOfTick(e,n=this.now()){return this._tickSource.getTimeOfTick(e,n)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(i+e,r)}_loop(){const e=this._lastUpdate,n=this.now();this._lastUpdate=n,this.log("loop",e,n),e!==n&&(this._state.forEachBetween(e,n,r=>{switch(r.state){case"started":const i=this._tickSource.getTicksAtTime(r.time);this.emit("start",r.time,i);break;case"stopped":r.time!==0&&this.emit("stop",r.time);break;case"paused":this.emit("pause",r.time);break}}),this._tickSource.forEachTickBetween(e,n,(r,i)=>{this.callback(r,i)}))}getStateAtTime(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Sx.mixin(eN);class QE extends On{constructor(){const e=xn(QE.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const n=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(n,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(n),this.delayTime=new ni({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),li(this,"delayTime")}static getDefaults(){return Object.assign(On.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Ph extends On{constructor(){const e=xn(Ph.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new ri({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,li(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(On.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class A4 extends On{constructor(){const e=xn(A4.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Ph({context:this.context}),this.output=new ri({context:this.context}),this.volume=this.input.volume,uy(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(On.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),uy(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Yk(t=>{t.destination=new A4({context:t})});Xk(t=>{t.destination.dispose()});class wVe extends On{constructor(){super(...arguments),this.name="Listener",this.positionX=new ni({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ni({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ni({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ni({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ni({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ni({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ni({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ni({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ni({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(On.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Yk(t=>{t.listener=new wVe({context:t})});Xk(t=>{t.listener.dispose()});class M4 extends Ig{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=xn(M4.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(n=>{this._loadingCount++;const r=e.urls[n];this.add(n,r,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Hi,onload:Hi,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return or(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,n])=>n.loaded)}add(e,n,r=Hi,i=Hi){return pg(n)?(this.baseUrl&&n.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new ts(this.baseUrl+n,r,i))):this._buffers.set(e.toString(),new ts(n,r,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class EA extends au{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return D0(super._frequencyToUnits(e))}_ticksToUnits(e){return D0(super._ticksToUnits(e))}_beatsToUnits(e){return D0(super._beatsToUnits(e))}_secondsToUnits(e){return D0(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return gZ(this.toMidi())}transpose(e){return new EA(this.context,this.toMidi()+e)}}class Ia extends hE{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class xVe extends Kc{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Dd,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,n){return this._events.add({callback:e,time:this.toSeconds(n)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const n=this._events.shift();n&&e-n.time<=this.expiration&&n.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Yk(t=>{t.draw=new xVe({context:t})});Xk(t=>{t.draw.dispose()});class CVe extends Ig{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){or(Zr(e.time),"Events must have a time property"),or(Zr(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let n=new RVe(e.time,e.time+e.duration,e);for(this._root===null?this._root=n:this._root.insert(n),this._length++;n!==null;)n.updateHeight(),n.updateMax(),this._rebalance(n),n=n.parent;return this}remove(e){if(this._root!==null){const n=[];this._root.search(e.time,n);for(const r of n)if(r.event===e){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,n=>this.remove(n)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,n){e.parent!==null?(e.isLeftChild()?e.parent.left=n:e.parent.right=n,this._rebalance(e.parent)):this._setRoot(n)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const n=e.getBalance();let r,i=null;if(n>0)if(e.left.right===null)r=e.left,r.right=e.right,i=r;else{for(r=e.left.right;r.right!==null;)r=r.right;r.parent&&(r.parent.right=r.left,i=r.parent,r.left=e.left,r.right=e.right)}else if(e.right.left===null)r=e.right,r.left=e.left,i=r;else{for(r=e.right.left;r.left!==null;)r=r.left;r.parent&&(r.parent.left=r.right,i=r.parent,r.left=e.left,r.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=r:e.parent.right=r:this._setRoot(r),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const n=e.parent,r=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rotateRight(e){const n=e.parent,r=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rebalance(e){const n=e.getBalance();n>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):n<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const n=[];if(this._root.search(e,n),n.length>0){let r=n[0];for(let i=1;i<n.length;i++)n[i].low>r.low&&(r=n[i]);return r.event}}return null}forEach(e){if(this._root!==null){const n=[];this._root.traverse(r=>n.push(r)),n.forEach(r=>{r.event&&e(r.event)})}return this}forEachAtTime(e,n){if(this._root!==null){const r=[];this._root.search(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}forEachFrom(e,n){if(this._root!==null){const r=[];this._root.searchAfter(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class RVe{constructor(e,n,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=e,this.high=n,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,n){e>this.max||(this.left!==null&&this.left.search(e,n),this.low<=e&&this.high>e&&n.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,n))}searchAfter(e,n){this.low>=e&&(n.push(this),this.left!==null&&this.left.searchAfter(e,n)),this.right!==null&&this.right.searchAfter(e,n)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class AVe extends Ig{constructor(e){super(),this.name="TimelineValue",this._timeline=new Dd({memory:10}),this._initialValue=e}set(e,n){return this._timeline.add({value:e,time:n}),this}get(e){const n=this._timeline.get(e);return n?n.value:this._initialValue}}class xp extends On{constructor(){super(xn(xp.getDefaults(),arguments,["context"]))}connect(e,n=0,r=0){return Zk(this,e,n,r),this}}class My extends xp{constructor(){const e=xn(My.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,du(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):eVe(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign($i.getDefaults(),{length:1024})}setMap(e,n=1024){const r=new Float32Array(n);for(let i=0,s=n;i<s;i++){const o=i/(s-1)*2-1;r[i]=e(o,i)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const n=["none","2x","4x"].some(r=>r.includes(e));or(n,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class I4 extends xp{constructor(){const e=xn(I4.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new My({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(xp.getDefaults(),{value:1})}_expFunc(e){return n=>Math.pow(Math.abs(n),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class E_{constructor(e,n){this.id=E_._eventId++,this._remainderTime=0;const r=Object.assign(E_.getDefaults(),n);this.transport=e,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:Hi,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const n=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*n),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}E_._eventId=0;class O4 extends E_{constructor(e,n){super(e,n),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const r=Object.assign(O4.getDefaults(),n);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},E_.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return bA(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Ia(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){bA(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ia(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const n=this.transport.getTicksAtTime(e);XE(n,this.time)&&(this._nextTick=this.floatTime+Math.ceil((n-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class tN extends Kc{constructor(){const e=xn(tN.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new AVe(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Dd,this._repeatedEvents=new CVe,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new eN({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),li(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Kc.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,n){if(this._loop.get(e)&&n>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),n=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&n%this._ppq!==0&&n%(this._swingTicks*2)!==0){const r=n%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(r*Math.PI)*this._swingAmount;e+=new Ia(this.context,this._swingTicks*2/3).toSeconds()*i}b8(!0),this._timeline.forEachAtTime(n,r=>r.invoke(e)),b8(!1)}schedule(e,n){const r=new E_(this,{callback:e,time:new hE(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(e,n,r,i=1/0){const s=new O4(this,{callback:e,duration:new Nd(this.context,i).toTicks(),interval:new Nd(this.context,n).toTicks(),time:new hE(this.context,r).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,n){const r=new E_(this,{callback:e,once:!0,time:new hE(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const n=this._scheduledEvents[e.toString()];n.timeline.remove(n.event),n.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,n){return this._scheduledEvents[e.id.toString()]={event:e,timeline:n},n.add(e),e.id}cancel(e=0){const n=this.toTicks(e);return this._timeline.forEachFrom(n,r=>this.clear(r.id)),this._repeatedEvents.forEachFrom(n,r=>this.clear(r.id)),this}_bindClockEvents(){this._clock.on("start",(e,n)=>{n=new Ia(this.context,n).toSeconds(),this.emit("start",e,n)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,n){this.context.resume();let r;return Zr(n)&&(r=this.toTicks(n)),this._clock.start(e,r),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){du(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Nd(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Nd(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Ia(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),n=this._clock.getTicksAtTime(e);return new Ia(this.context,n).toBarsBeatsSixteenths()}set position(e){const n=this.toTicks(e);this.ticks=n}get seconds(){return this._clock.seconds}set seconds(e){const n=this.now(),r=this._clock.frequency.timeToTicks(e,n);this.ticks=r}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const n=this.now();if(this.state==="started"){const r=this._clock.getTicksAtTime(n),i=this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,n),s=n+i;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",n),this._clock.setTicksAtTime(e,n)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const n=this.now(),r=this.getTicksAtTime(n),i=e-r%e;return this._clock.nextTickTime(i,n)}}syncSignal(e,n){const r=this.now();let i=this.bpm,s=1/(60/i.getValueAtTime(r)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/s,l=new ri(c),u=new I4(-1),d=new ri(c);i.chain(l,u,d),i=d,s=1/s,o=[l,u,d]}n||(e.getValueAtTime(r)!==0?n=e.getValueAtTime(r)/s:n=0);const a=new ri(n);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let n=this._syncedSignals.length-1;n>=0;n--){const r=this._syncedSignals[n];r.signal===e&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(n,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),wx(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Sx.mixin(tN);Yk(t=>{t.transport=new tN({context:t})});Xk(t=>{t.transport.dispose()});class Qc extends On{constructor(e){super(e),this.input=void 0,this._state=new xx("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Hi,this._syncedStop=Hi,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Ph({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,li(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(On.getDefaults(),{mute:!1,onstop:Hi,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,n,r){let i=Ju(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")or(XE(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,n,r);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const s=this._state.get(i);s&&(s.offset=this.toSeconds(pp(n,0)),s.duration=r?this.toSeconds(r):void 0);const o=this.context.transport.schedule(a=>{this._start(a,n,r)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else oZ(this.context),this._start(i,n,r);return this}stop(e){let n=Ju(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(n=this._clampToCurrentTime(n),this._state.getValueAtTime(n)==="started"||Zr(this._state.getNextState("started",n))){if(this.log("stop",n),!this._synced)this._stop(n);else{const r=this.context.transport.schedule(this._stop.bind(this),n);this._scheduled.push(r)}this._state.cancel(n),this._state.setStateAtTime("stopped",n)}return this}restart(e,n,r){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,n,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,n)=>{if(XE(n,0)){const r=this._state.get(n);if(r&&r.state==="started"&&r.time!==n){const i=n-this.toSeconds(r.time);let s;r.duration&&(s=this.toSeconds(r.duration)-i),this._start(e,this.toSeconds(r.offset)+i,s)}}},this._syncedStop=e=>{const n=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(n)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Hi,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Cx extends JE{constructor(){const e=xn(Cx.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Kh(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ni({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ts(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(JE.getDefaults(),{url:new ts,loop:!1,loopEnd:0,loopStart:0,onload:Hi,onerror:Hi,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,n,r,i=1){or(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,i),this.loop?n=pp(n,this.loopStart):n=pp(n,0);let o=Math.max(this.toSeconds(n),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;aF(o,a)&&(o=(o-c)%l+c),Oh(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,bA(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,o)),Zr(r)){let a=this.toSeconds(r);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class ZE extends Qc{constructor(){const e=xn(ZE.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Qc.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(or(e in S8,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const n=this.now();this._stop(n),this._start(n)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const n=S8[this._type];this._source=new Cx({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const bb=44100*5,bD=2,Bm={brown:null,pink:null,white:null},S8={get brown(){if(!Bm.brown){const t=[];for(let e=0;e<bD;e++){const n=new Float32Array(bb);t[e]=n;let r=0;for(let i=0;i<bb;i++){const s=Math.random()*2-1;n[i]=(r+.02*s)/1.02,r=n[i],n[i]*=3.5}}Bm.brown=new ts().fromArray(t)}return Bm.brown},get pink(){if(!Bm.pink){const t=[];for(let e=0;e<bD;e++){const n=new Float32Array(bb);t[e]=n;let r,i,s,o,a,c,l;r=i=s=o=a=c=l=0;for(let u=0;u<bb;u++){const d=Math.random()*2-1;r=.99886*r+d*.0555179,i=.99332*i+d*.0750759,s=.969*s+d*.153852,o=.8665*o+d*.3104856,a=.55*a+d*.5329522,c=-.7616*c-d*.016898,n[u]=r+i+s+o+a+c+l+d*.5362,n[u]*=.11,l=d*.115926}}Bm.pink=new ts().fromArray(t)}return Bm.pink},get white(){if(!Bm.white){const t=[];for(let e=0;e<bD;e++){const n=new Float32Array(bb);t[e]=n;for(let r=0;r<bb;r++)n[r]=Math.random()*2-1}Bm.white=new ts().fromArray(t)}return Bm.white}};function Iy(t,e){return ao(this,void 0,void 0,function*(){const n=e/t.context.sampleRate,r=new Jk(1,n,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:r})).toDestination().start(0),(yield r.render()).getChannelData(0)})}class k4 extends JE{constructor(){const e=xn(k4.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Kh(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new ni({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new ni({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),li(this,["frequency","detune"])}static getDefaults(){return Object.assign(JE.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._oscillator.start(n),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class bo extends Qc{constructor(){const e=xn(bo.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new $i({context:this.context,units:"frequency",value:e.frequency}),li(this,"frequency"),this.detune=new $i({context:this.context,units:"cents",value:e.detune}),li(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Qc.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const n=this.toSeconds(e),r=new k4({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}_stop(e){const n=this.toSeconds(e);this._oscillator&&this._oscillator.stop(n)}_restart(e){const n=this.toSeconds(e);return this.log("restart",n),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(n),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return bo._periodicWaveCache.find(n=>n.phase===this._phase&&uVe(n.partials,this._partials));{const e=bo._periodicWaveCache.find(n=>n.type===this._type&&n.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const n=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&n)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const r=this._getCachedPeriodicWave();if(Zr(r)){const{partials:i,wave:s}=r;this._wave=s,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,s]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,s);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),bo._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),bo._periodicWaveCache.length>100&&bo._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){wp(e,0);let n=this._type;const r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(n=r[1]),this._type!=="custom")e===0?this.type=n:this.type=n+e.toString();else{const i=new Float32Array(e);this._partials.forEach((s,o)=>i[o]=s),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,n){let i=2048;const s=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[s,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(s[c]=-u*Math.sin(n*c),o[c]=u*Math.cos(n*c)):(s[c]=0,o[c]=0)}return[s,o]}_inverseFFT(e,n,r){let i=0;const s=e.length;for(let o=0;o<s;o++)i+=e[o]*Math.cos(o*r)+n[o]*Math.sin(o*r);return i}getInitialValue(){const[e,n]=this._getRealImaginary(this._type,0);let r=0;const i=Math.PI*2,s=32;for(let o=0;o<s;o++)r=Math.max(this._inverseFFT(e,n,o/s*i),r);return hVe(-this._inverseFFT(e,n,this._phase)/r,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return ao(this,arguments,void 0,function*(e=1024){return Iy(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}bo._periodicWaveCache=[];class _Z extends xp{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new My({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class dy extends $i{constructor(){const e=xn(dy.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new ri({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign($i.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class nN extends Qc{constructor(){const e=xn(nN.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new _Z({context:this.context}),this._modulationNode=new ri({context:this.context}),this._carrier=new bo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new bo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new dy({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),li(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(bo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return ao(this,arguments,void 0,function*(e=1024){return Iy(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class rN extends Qc{constructor(){const e=xn(rN.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new ri({context:this.context,gain:0}),this._carrier=new bo({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new $i({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new bo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new dy({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new dy({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),li(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(bo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return ao(this,arguments,void 0,function*(e=1024){return Iy(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Rx extends Qc{constructor(){const e=xn(Rx.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new ri({context:this.context,gain:0}),this._thresh=new My({context:this.context,mapping:n=>n<=0?-1:1}),this.width=new $i({context:this.context,units:"audioRange",value:e.width}),this._triangle=new bo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),li(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Qc.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return ao(this,arguments,void 0,function*(e=1024){return Iy(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class iN extends Qc{constructor(){const e=xn(iN.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new $i({context:this.context,units:"frequency",value:e.frequency}),this.detune=new $i({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,li(this,["frequency","detune"])}static getDefaults(){return Object.assign(bo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(n=>n.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(n=>n.stop(e))}_restart(e){this._forEach(n=>n.restart(e))}_forEach(e){for(let n=0;n<this._oscillators.length;n++)e(this._oscillators[n],n)}get type(){return this._type}set type(e){this._type=e,this._forEach(n=>n.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const n=-e/2,r=e/(this._oscillators.length-1);this._forEach((i,s)=>i.detune.value=n+r*s)}}get count(){return this._oscillators.length}set count(e){if(wp(e,1),this._oscillators.length!==e){this._forEach(n=>n.dispose()),this._oscillators=[];for(let n=0;n<e;n++){const r=new bo({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+n/e*360,partialCount:this._partialCount,onstop:n===0?()=>this.onstop(this):Hi});this.type==="custom"&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state==="started"&&this._forEach(n=>n.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((n,r)=>n.phase=this._phase+r/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(n=>n.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(n=>n.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(n=>n.partialCount=e),this._type=this._oscillators[0].type}asArray(){return ao(this,arguments,void 0,function*(e=1024){return Iy(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class sN extends Qc{constructor(){const e=xn(sN.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new dy({context:this.context,value:2}),this._pulse=new Rx({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new bo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),li(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Qc.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return ao(this,arguments,void 0,function*(e=1024){return Iy(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const T8={am:nN,fat:iN,fm:rN,oscillator:bo,pulse:Rx,pwm:sN};class SA extends Qc{constructor(){const e=xn(SA.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new $i({context:this.context,units:"frequency",value:e.frequency}),this.detune=new $i({context:this.context,units:"cents",value:e.detune}),li(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(bo.getDefaults(),rN.getDefaults(),nN.getDefaults(),iN.getDefaults(),Rx.getDefaults(),sN.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(n=>this._sourceType===n)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const n=T8[e],r=this.now();if(this._oscillator){const i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new n({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let n="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(n=this._oscillator.type),e==="fm"?this.type="fm"+n:e==="am"?this.type="am"+n:e==="fat"?this.type="fat"+n:e==="oscillator"?this.type=n:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,n){return e instanceof T8[n]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&qh(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&qh(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&pg(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return ao(this,arguments,void 0,function*(e=1024){return Iy(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class N4 extends $i{constructor(){super(xn(N4.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new ri({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,uy(this._constantSource,this._sum)}static getDefaults(){return Object.assign($i.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class P4 extends xp{constructor(){const e=xn(P4.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new dy({context:this.context,value:e.max-e.min}),this._add=this.output=new N4({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(xp.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class D4 extends xp{constructor(){super(xn(D4.getDefaults(),arguments)),this.name="Zero",this._gain=new ri({context:this.context}),this.output=this._gain,this.input=void 0,Kh(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),vZ(this.context.getConstant(0),this._gain),this}}class hy extends On{constructor(){const e=xn(hy.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=ni.prototype._fromType,this._toType=ni.prototype._toType,this._is=ni.prototype._is,this._clampValue=ni.prototype._clampValue,this._oscillator=new bo(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new ri({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new $i({context:this.context,units:"audioRange",value:0}),this._zeros=new D4({context:this.context}),this._a2g=new _Z({context:this.context}),this._scaler=this.output=new P4({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),li(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(bo.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const n=this.min,r=this.max;this._units=e,this.min=n,this.max=r}get state(){return this._oscillator.state}connect(e,n,r){return(e instanceof ni||e instanceof $i)&&(this.convert=e.convert,this.units=e.units),Zk(this,e,n,r),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function yZ(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){wp(s,t,e),n.set(this,s)}})}}function Og(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){wp(this.toSeconds(s),t,e),n.set(this,s)}})}}class Ax extends Qc{constructor(){const e=xn(Ax.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new ts({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Qc.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Hi,onerror:Hi,playbackRate:1,reverse:!1})}load(e){return ao(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=Hi){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,n,r){return super.start(e,n,r),this}_start(e,n,r){this._loop?n=pp(n,this._loopStart):n=pp(n,0);const i=this.toSeconds(n),s=r;r=pp(r,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(r);o=o/this._playbackRate,e=this.toSeconds(e);const a=new Cx({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&Ju(s)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const n=this.toSeconds(e);this._activeSources.forEach(r=>r.stop(n))}restart(e,n,r){return super.restart(e,n,r),this}_restart(e,n,r){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,n,r)}seek(e,n){const r=this.toSeconds(n);if(this._state.getValueAtTime(r)==="started"){const i=this.toSeconds(e);this._stop(r),this._start(r,i)}return this}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&wp(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&wp(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(n=>{n.loop=e}),e)){const n=this._state.getNextState("stopped",this.now());n&&this._state.cancel(n.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const n=this.now(),r=this._state.getNextState("stopped",n);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,n)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}As([Og(0)],Ax.prototype,"fadeIn",void 0);As([Og(0)],Ax.prototype,"fadeOut",void 0);class MVe extends xp{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new My({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class kg extends On{constructor(){const e=xn(kg.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new $i({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(On.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,n){if(pg(e))return e;{let r;for(r in rC)if(rC[r][n]===e)return r;return e}}_setCurve(e,n,r){if(pg(r)&&Reflect.has(rC,r)){const i=rC[r];o_(i)?e!=="_decayCurve"&&(this[e]=i[n]):this[e]=i}else if(du(r)&&e!=="_decayCurve")this[e]=r;else throw new Error("Envelope: invalid curve: "+r)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,n=1){this.log("triggerAttack",e,n),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(n,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(n,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(n,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,n)}if(s&&this.sustain<1){const a=n*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const n=this.getValueAtTime(e);if(n>0){const r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,r,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,r,e):(or(du(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,r,n))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),this.triggerAttack(n,r),this.triggerRelease(n+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,n=0,r=0){return Zk(this,e,n,r),this}asArray(){return ao(this,arguments,void 0,function*(e=1024){const n=e/this.context.sampleRate,r=new Jk(1,n,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),o=s*.1,a=s+o,c=new this.constructor(Object.assign(this.get(),{attack:n*this.toSeconds(this.attack)/a,decay:n*this.toSeconds(this.decay)/a,release:n*this.toSeconds(this.release)/a,context:r}));return c._sig.toDestination(),c.triggerAttackRelease(n*(i+o)/a,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}As([Og(0)],kg.prototype,"attack",void 0);As([Og(0)],kg.prototype,"decay",void 0);As([yZ(0,1)],kg.prototype,"sustain",void 0);As([Og(0)],kg.prototype,"release",void 0);const rC=(()=>{let e,n;const r=[];for(e=0;e<128;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[],s=6.4;for(e=0;e<127;e++){n=e/127;const h=Math.sin(n*(Math.PI*2)*s-Math.PI/2)+1;i[e]=h/10+n*.83}i[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)n=e/127,c[e]=.5*(1-Math.cos(Math.PI*n));const l=[];for(e=0;e<128;e++){n=e/127;const h=Math.pow(n,3)*4+.2,p=Math.cos(h*Math.PI*2*n);l[e]=Math.abs(p*(1-n))}function u(h){const p=new Array(h.length);for(let f=0;f<h.length;f++)p[f]=1-h[f];return p}function d(h){return h.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:r,Out:d(r)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class Cp extends On{constructor(){const e=xn(Cp.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=n=>this._original_triggerRelease(n),this._volume=this.output=new Ph({context:this.context,volume:e.volume}),this.volume=this._volume.volume,li(this,"volume")}static getDefaults(){return Object.assign(On.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,n){const r=this["_original_"+e]=this[e];this[e]=(...i)=>{const s=i[n],o=this.context.transport.schedule(a=>{i[n]=a,r.apply(this,i)},s);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r),o=this.toSeconds(n);return this.triggerAttack(e,s,i),this.triggerRelease(s+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class fy extends Cp{constructor(){const e=xn(fy.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Cp.getDefaults(),{detune:0,onsilence:Hi,portamento:0})}triggerAttack(e,n,r=1){this.log("triggerAttack",e,n,r);const i=this.toSeconds(n);return this._triggerEnvelopeAttack(i,r),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const n=this.toSeconds(e);return this._triggerEnvelopeRelease(n),this}setNote(e,n){const r=this.toSeconds(n),i=e instanceof au?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(r)>.05){const s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,s,r)}else this.frequency.setValueAtTime(i,r);return this}}As([Og(0)],fy.prototype,"portamento",void 0);class oN extends kg{constructor(){super(xn(oN.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ri({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Cl extends fy{constructor(){const e=xn(Cl.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new SA(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new oN(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),li(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(fy.getDefaults(),{envelope:Object.assign(lw(kg.getDefaults(),Object.keys(On.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(lw(SA.getDefaults(),[...Object.keys(Qc.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,n){if(this.envelope.triggerAttack(e,n),this.oscillator.start(e),this.envelope.sustain===0){const r=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+r+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class TA extends On{constructor(){const e=xn(TA.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new ni({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new ni({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new ni({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new ni({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(On.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){or(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const n=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*19980+20;n[o]=c}const r=new Float32Array(e),i=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(n,r,i),r}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Rd extends On{constructor(){const e=xn(Rd.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new ri({context:this.context}),this.output=new ri({context:this.context}),this._filters=[],this._filters=[],this.Q=new $i({context:this.context,units:"positive",value:e.Q}),this.frequency=new $i({context:this.context,units:"frequency",value:e.frequency}),this.detune=new $i({context:this.context,units:"cents",value:e.detune}),this.gain=new $i({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,li(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(On.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){or(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(r=>r.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const n=qh(e)?e:parseInt(e,10),r=[-12,-24,-48,-96];let i=r.indexOf(n);or(i!==-1,`rolloff can only be ${r.join(", ")}`),i+=1,this._rolloff=n,this.input.disconnect(),this._filters.forEach(s=>s.disconnect()),this._filters=new Array(i);for(let s=0;s<i;s++){const o=new TA({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[s]=o}this._internalChannels=this._filters,uy(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const n=new TA({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),r=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{n.getFrequencyResponse(e).forEach((s,o)=>r[o]*=s)}),n.dispose(),r}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),wx(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Mx extends Cl{constructor(){const e=xn(Mx.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,li(this,["oscillator","envelope"])}static getDefaults(){return $0(fy.getDefaults(),Cl.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,n){const r=this.toSeconds(n),i=this.toFrequency(e instanceof au?e.toFrequency():e),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,r),this.oscillator.frequency.exponentialRampToValueAtTime(i,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}As([yZ(0)],Mx.prototype,"octaves",void 0);As([Og(0)],Mx.prototype,"pitchDecay",void 0);class qb extends Cp{constructor(){const e=xn(qb.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new ZE(Object.assign({context:this.context},e.noise)),this.envelope=new oN(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Cp.getDefaults(),{envelope:Object.assign(lw(kg.getDefaults(),Object.keys(On.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(lw(ZE.getDefaults(),Object.keys(Qc.getDefaults())),{type:"white"})})}triggerAttack(e,n=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,n),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(n,r),this.triggerRelease(n+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const bZ=new Set;function L4(t){bZ.add(t)}function EZ(t,e){const n=`registerProcessor("${t}", ${e})`;bZ.add(n)}const IVe=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;L4(IVe);const OVe=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;L4(OVe);const kVe=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;L4(kVe);const NVe="feedback-comb-filter",PVe=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;EZ(NVe,PVe);class wA extends Cp{constructor(){const e=xn(wA.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),or(!qh(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const n=e.voice.getDefaults();this.options=Object.assign(n,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const r=this._voices.indexOf(this._dummyVoice);this._voices.splice(r,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Cp.getDefaults(),{maxPolyphony:32,options:{},voice:Cl})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const n=this._activeVoices.findIndex(r=>r.voice===e);this._activeVoices.splice(n,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return or(e instanceof fy,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else qk("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),n=this._voices.indexOf(e);this._voices.splice(n,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,n,r){e.forEach(i=>{const s=new EA(this.context,i).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(i,n,r),this._activeVoices.push({midi:s,voice:o,released:!1}),this.log("triggerAttack",i,n))})}_triggerRelease(e,n){e.forEach(r=>{const i=new EA(this.context,r).toMidi(),s=this._activeVoices.find(({midi:o,released:a})=>o===i&&!a);s&&(s.voice.triggerRelease(n),s.released=!0,this.log("triggerRelease",r,n))})}_scheduleEvent(e,n,r,i){or(!this.disposed,"Synth was already disposed"),r<=this.now()?e==="attack"?this._triggerAttack(n,r,i):this._triggerRelease(n,r):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,n,r,i)},r-this.now())}triggerAttack(e,n,r){Array.isArray(e)||(e=[e]);const i=this.toSeconds(n);return this._scheduleEvent("attack",e,i,r),this}triggerRelease(e,n){Array.isArray(e)||(e=[e]);const r=this.toSeconds(n);return this._scheduleEvent("release",e,r),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r);if(this.triggerAttack(e,s,i),du(n)){or(du(e),"If the duration is an array, the notes must also be an array"),e=e;for(let o=0;o<e.length;o++){const a=n[Math.min(o,n.length-1)],c=this.toSeconds(a);or(c>0,"The duration must be greater than 0"),this.triggerRelease(e[o],s+c)}}else{const o=this.toSeconds(n);or(o>0,"The duration must be greater than 0"),this.triggerRelease(e,s+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const n=lw(e,["onsilence","context"]);return this.options=$0(this.options,n),this._voices.forEach(r=>r.set(n)),this._dummyVoice.set(n),this}get(){return this._dummyVoice.get()}releaseAll(e){const n=this.toSeconds(e);return this._activeVoices.forEach(({voice:r})=>{r.triggerRelease(n)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Ix extends Cp{constructor(){const e=xn(Ix.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const n={};Object.keys(e.urls).forEach(r=>{const i=parseInt(r,10);if(or(nC(r)||qh(i)&&isFinite(i),`url key is neither a note or midi pitch: ${r}`),nC(r)){const s=new au(this.context,r).toMidi();n[s]=e.urls[r]}else qh(i)&&isFinite(i)&&(n[i]=e.urls[i])}),this._buffers=new M4({urls:n,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Cp.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Hi,onerror:Hi,release:.1,urls:{}})}_findClosest(e){let r=0;for(;r<96;){if(this._buffers.has(e+r))return-r;if(this._buffers.has(e-r))return r;r++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,n,r=1){return this.log("triggerAttack",e,n,r),Array.isArray(e)||(e=[e]),e.forEach(i=>{const s=mZ(new au(this.context,i).toFrequency()),o=Math.round(s),a=s-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),d=pZ(c+a),h=new Cx({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:d}).connect(this.output);h.start(n,0,u.duration/d,r),du(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(h),h.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const p=this._activeSources.get(o),f=p.indexOf(h);f!==-1&&p.splice(f,1)}}}),this}triggerRelease(e,n){return this.log("triggerRelease",e,n),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=new au(this.context,r).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const s=this._activeSources.get(i);n=this.toSeconds(n),s.forEach(o=>{o.stop(n)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const n=this.toSeconds(e);return this._activeSources.forEach(r=>{for(;r.length;)r.shift().stop(n)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,n,r,i=1){const s=this.toSeconds(r);return this.triggerAttack(e,s,i),du(n)?(or(du(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=n[Math.min(a,n.length-1)];this.triggerRelease(o,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(n)),this}add(e,n,r){if(or(nC(e)||isFinite(e),`note must be a pitch or midi: ${e}`),nC(e)){const i=new au(this.context,e).toMidi();this._buffers.add(i,n,r)}else this._buffers.add(e,n,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(n=>n.dispose())}),this._activeSources.clear(),this}}As([Og(0)],Ix.prototype,"attack",void 0);As([Og(0)],Ix.prototype,"release",void 0);class Kb extends Kc{constructor(){const e=xn(Kb.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new xx("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(Kc.getDefaults(),{callback:Hi,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,n=>{let r;if(n.state==="started"){n.id!==-1&&this.context.transport.clear(n.id);const i=n.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||qh(this._loop)&&this._loop>1){r=1/0,qh(this._loop)&&(r=this._loop*this._getLoopDuration());const s=this._state.getAfter(i);s!==null&&(r=Math.min(r,s.time-i)),r!==1/0&&(r=new Ia(this.context,r));const o=new Ia(this.context,this._getLoopDuration());n.id=this.context.transport.scheduleRepeat(this._tick.bind(this),o,new Ia(this.context,i),r)}else n.id=this.context.transport.schedule(this._tick.bind(this),new Ia(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const n=this.toTicks(e);return this._state.getValueAtTime(n)==="stopped"&&(this._state.add({id:-1,state:"started",time:n}),this._rescheduleEvents(n)),this}stop(e){this.cancel(e);const n=this.toTicks(e);if(this._state.getValueAtTime(n)==="started"){this._state.setStateAtTime("stopped",n,{id:-1});const r=this._state.getBefore(n);let i=n;r!==null&&(i=r.time),this._rescheduleEvents(i)}return this}cancel(e){e=pp(e,-1/0);const n=this.toTicks(e);return this._state.forEachFrom(n,r=>{this.context.transport.clear(r.id)}),this._state.cancel(n),this}_tick(e){const n=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(n)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let r=.02;sZ(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*r}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new Ia(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new Ia(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,n=this._state.get(e);if(n!==null&&n.state==="started"){const r=this._getLoopDuration();return(e-n.time)%r/r}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class xA extends Kb{constructor(){const e=xn(xA.getDefaults(),arguments,["callback","events"]);super(e),this.name="Part",this._state=new xx("stopped"),this._events=new Set,this._state.increasing=!0,e.events.forEach(n=>{du(n)?this.add(n[0],n[1]):this.add(n)})}static getDefaults(){return Object.assign(Kb.getDefaults(),{events:[]})}start(e,n){const r=this.toTicks(e);if(this._state.getValueAtTime(r)!=="started"){n=pp(n,this._loop?this._loopStart:0),this._loop?n=pp(n,this._loopStart):n=pp(n,0);const i=this.toTicks(n);this._state.add({id:-1,offset:i,state:"started",time:r}),this._forEach(s=>{this._startNote(s,r,i)})}return this}_startNote(e,n,r){n-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(n+=this._getLoopDuration()),e.start(new Ia(this.context,n))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(new Ia(this.context,n))):e.startOffset>=r&&e.start(new Ia(this.context,n))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(n=>{n.startOffset+=this._startOffset})}stop(e){const n=this.toTicks(e);return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._forEach(r=>{r.stop(e)}),this}at(e,n){const r=new hE(this.context,e).toTicks(),i=new Ia(this.context,1).toSeconds(),s=this._events.values();let o=s.next();for(;!o.done;){const a=o.value;if(Math.abs(r-a.startOffset)<i)return Zr(n)&&(a.value=n),a;o=s.next()}return Zr(n)?(this.add(e,n),this.at(e)):null}add(e,n){e instanceof Object&&Reflect.has(e,"time")&&(n=e,e=n.time);const r=this.toTicks(e);let i;return n instanceof Kb?(i=n,i.callback=this._tick.bind(this)):i=new Kb({callback:this._tick.bind(this),context:this.context,value:n}),i.startOffset=r,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(e){this._state.forEach(n=>{n.state==="started"?this._startNote(e,n.time,n.offset):e.stop(new Ia(this.context,n.time))})}remove(e,n){return o_(e)&&e.hasOwnProperty("time")&&(n=e,e=n.time),e=this.toTicks(e),this._events.forEach(r=>{r.startOffset===e&&(Ju(n)||Zr(n)&&r.value===n)&&(this._events.delete(r),r.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(n=>n.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(n=>{n instanceof xA?n._forEach(e):e(n)}),this}_setAll(e,n){this._forEach(r=>{r[e]=n})}_tick(e,n){this.mute||this.callback(e,n)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(n=>{n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.loop=e,this._testLoopBoundries(n)})}get loopEnd(){return new Ia(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopEnd=e,this._testLoopBoundries(n)})}get loopStart(){return new Ia(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopStart=this.loopStart,this._testLoopBoundries(n)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class aN extends On{constructor(){const e=xn(aN.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new MVe({context:this.context}),this.a=new ri({context:this.context,gain:0}),this.b=new ri({context:this.context,gain:0}),this.output=new ri({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new $i({context:this.context,units:"normalRange",value:e.fade}),li(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Kh(this._split,this.a.gain,0),Kh(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(On.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}let S_=class extends On{constructor(e){super(e),this.name="Effect",this._dryWet=new aN({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ri({context:this.context}),this.effectReturn=new ri({context:this.context}),this.input=new ri({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],li(this,"wet")}static getDefaults(){return Object.assign(On.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};class U4 extends On{constructor(){const e=xn(U4.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new ni({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",li(this,"pan")}static getDefaults(){return Object.assign(On.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const DVe="bit-crusher",LVe=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;EZ(DVe,LVe);class cN extends On{constructor(){const e=xn(cN.getDefaults(),arguments,["channels"]);super(e),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(On.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Ox extends On{constructor(){const e=xn(Ox.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(On.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class CA extends On{constructor(e){super(e),this.name="StereoEffect",this.input=new ri({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new aN({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new cN({context:this.context,channels:2}),this._merge=new Ox({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),li(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),uy(...e),Kh(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),uy(...e),Kh(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(On.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class w8 extends CA{constructor(e){super(e),this.feedback=new $i({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new ri({context:this.context}),this._feedbackR=new ri({context:this.context}),this._feedbackSplit=new cN({context:this.context,channels:2}),this._feedbackMerge=new Ox({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),li(this,["feedback"])}static getDefaults(){return Object.assign(CA.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class F4 extends w8{constructor(){const e=xn(F4.getDefaults(),arguments,["frequency","delayTime","depth"]);super(e),this.name="Chorus",this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new hy({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new hy({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new QE({context:this.context}),this._delayNodeR=new QE({context:this.context}),this.frequency=this._lfoL.frequency,li(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(w8.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;const n=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-n,0),this._lfoL.max=this._delayTime+n,this._lfoR.min=Math.max(this._delayTime-n,0),this._lfoR.max=this._delayTime+n}get delayTime(){return this._delayTime*1e3}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class uw extends S_{constructor(){const e=xn(uw.getDefaults(),arguments,["distortion"]);super(e),this.name="Distortion",this._shaper=new My({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(S_.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;const n=e*100,r=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+n)*i*20*r/(Math.PI+n*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class x8 extends S_{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new ri({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,li(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(S_.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class lN extends x8{constructor(){const e=xn(lN.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new QE({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),li(this,"delayTime")}static getDefaults(){return Object.assign(x8.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class B4 extends CA{constructor(){const e=xn(B4.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(e),this.name="Phaser",this._lfoL=new hy({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new hy({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this.Q=new $i({context:this.context,value:e.Q,units:"positive"}),this._filtersL=this._makeFilters(e.stages,this._lfoL),this._filtersR=this._makeFilters(e.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),li(this,["frequency","Q"])}static getDefaults(){return Object.assign(CA.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(e,n){const r=[];for(let i=0;i<e;i++){const s=this.context.createBiquadFilter();s.type="allpass",this.Q.connect(s.Q),n.connect(s.frequency),r.push(s)}return r}get octaves(){return this._octaves}set octaves(e){this._octaves=e;const n=this._baseFrequency*Math.pow(2,e);this._lfoL.max=n,this._lfoR.max=n}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(e=>e.disconnect()),this._filtersR.forEach(e=>e.disconnect()),this.frequency.dispose(),this}}class j4 extends S_{constructor(){const e=xn(j4.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve(),this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(S_.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),wp(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),wp(e,0),this._preDelay=e,this.generate()}generate(){return ao(this,void 0,void 0,function*(){const e=this.ready,n=new Jk(2,this._decay+this._preDelay,this.context.sampleRate),r=new ZE({context:n}),i=new ZE({context:n}),s=new Ox({context:n});r.connect(s,0,0),i.connect(s,0,1);const o=new ri({context:n}).toDestination();s.connect(o),r.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=n.render();return this.ready=a.then(Hi),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class $4 extends S_{constructor(){const e=xn($4.getDefaults(),arguments,["frequency","depth"]);super(e),this.name="Vibrato",this._delayNode=new QE({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new hy({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,li(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(S_.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class aa extends On{constructor(){const e=xn(aa.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new ri({context:this.context}),aa._allSolos.has(this.context)||aa._allSolos.set(this.context,new Set),aa._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(On.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),aa._allSolos.get(this.context).forEach(n=>n._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){aa._soloed.has(this.context)||aa._soloed.set(this.context,new Set),aa._soloed.get(this.context).add(this)}_removeSolo(){aa._soloed.has(this.context)&&aa._soloed.get(this.context).delete(this)}_isSoloed(){return aa._soloed.has(this.context)&&aa._soloed.get(this.context).has(this)}_noSolos(){return!aa._soloed.has(this.context)||aa._soloed.has(this.context)&&aa._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),aa._allSolos.get(this.context).delete(this),this._removeSolo(),this}}aa._allSolos=new Map;aa._soloed=new Map;class H4 extends On{constructor(){const e=xn(H4.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new U4({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Ph({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,li(this,["pan","volume"])}static getDefaults(){return Object.assign(On.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Yb extends On{constructor(){const e=xn(Yb.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new aa({solo:e.solo,context:this.context}),this._panVol=this.output=new H4({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),li(this,["pan","volume"])}static getDefaults(){return Object.assign(On.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Yb.buses.has(e)||Yb.buses.set(e,new ri({context:this.context})),Yb.buses.get(e)}send(e,n=0){const r=this._getBus(e),i=new ri({context:this.context,units:"decibels",gain:n});return this.connect(i),i.connect(r),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Yb.buses=new Map;class V4 extends On{constructor(){const e=xn(V4.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(e),this.name="MultibandSplit",this.input=new ri({context:this.context}),this.output=void 0,this.low=new Rd({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Rd({context:this.context,frequency:0,type:"highpass"}),this.mid=new Rd({context:this.context,frequency:0,type:"lowpass"}),this.high=new Rd({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new $i({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new $i({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new $i({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),li(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(On.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),wx(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class z4 extends On{constructor(){const e=xn(z4.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new ni({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new ni({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new ni({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new ni({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new ni({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),li(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(On.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class G4 extends On{constructor(){const e=xn(G4.getDefaults(),arguments,["low","mid","high"]);super(e),this.name="EQ3",this.output=new ri({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new V4({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new ri({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new ri({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new ri({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),li(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(On.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),wx(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}cc().transport;function W4(){return cc().transport}cc().destination;cc().destination;function UVe(){return cc().destination}cc().listener;cc().draw;cc();const cF=Ca("256n").toSeconds(),FVe=Ca("8n").toSeconds();function ED(){const t=new j4,e=Gc(t.get()),n=new lN,r=Gc(n.get()),i=new F4,s=Gc(i.get()),o=new B4,a=Gc(o.get()),c=new uw,l=Gc(c.get()),u=new $4,d=Gc(u.get());function h(){t.set({...e,wet:0}),n.set({...r,wet:0,delayTime:cF,maxDelay:"1n",feedback:.666}),i.set({...s,wet:0,depth:.999,frequency:7,feedback:.666}),o.set({...a,wet:0,Q:10}),c.set({...l,wet:0,distortion:.9}),u.set({...d,wet:0,depth:.2})}return h(),{reverb:t,echo:n,chorus:i,phaser:o,distortion:c,vibrato:u,applyreset:h}}const C8=4,BVe={a:1,b:2,c:3,d:4,e:5,f:6,g:7,x:8,"#":9,"!":10,y:13,t:14,s:15,i:16,q:17,h:18,w:19,3:20,".":21,"+":11,"-":12,0:22,1:23,2:24,p:25,4:26,5:27,6:29,7:28,8:30,9:31};function jVe(t,e,n,r=!0){let i=e,s=3,o="32n",a="",c="";const l=[];function u(){c="",a="",i+=Ca(o).toSeconds()}function d(){c===null?(l.push([i,[t,o,c]]),u()):Mn(c)?(l.push([i,[t,o,c]]),u()):c.startsWith("#")?(l.push([i,[t,o,c]]),u()):c!==""&&(l.push([i,[t,o,`${c}${a}${s}`]]),u())}if(nr(n))c=n;else for(let h=0;h<n.length;++h){switch(n[h]){case 9:case 10:break;default:d();break}switch(n[h]){case 1:c="A";break;case 2:c="B";break;case 3:c="C";break;case 4:c="D";break;case 5:c="E";break;case 6:c="F";break;case 7:c="G";break;case 8:c=null;break;case 9:a+="#";break;case 10:a+="b";break;case 11:++s;break;case 12:--s;break;case 13:o="64n";break;case 14:o="32n";break;case 15:o="16n";break;case 16:o="8n";break;case 17:o="4n";break;case 18:o="2n";break;case 19:o="1n";break;case 20:o=o.replace("n","t");break;case 21:o+=".";break;case 22:c=0;break;case 23:c=1;break;case 24:c=2;break;case 25:c=3;break;case 26:c=4;break;case 27:c=5;break;case 29:c=6;break;case 28:c=7;break;case 30:c=8;break;case 31:c=9;break}}return d(),r&&l.push([i,[t,"8n",-1]]),l}function $Ve(t){const e=[],n=t.split(";");for(let r=0;r<n.length;++r){const i=[],s=n[r];if(s.startsWith("#"))e.push(s);else{for(let o=0;o<s.length;++o){const a=BVe[s[o]];he(a)&&i.push(a)}e.push(i)}}return e}var Ac=(t=>(t[t.SYNTH=0]="SYNTH",t[t.RETRO_NOISE=1]="RETRO_NOISE",t[t.BUZZ_NOISE=2]="BUZZ_NOISE",t[t.CLANG_NOISE=3]="CLANG_NOISE",t[t.METALLIC_NOISE=4]="METALLIC_NOISE",t))(Ac||{});const R8=32768;function HVe(t){const e=cc().createBuffer(1,R8,cc().sampleRate);let n=1;const r=e.getChannelData(0);for(let i=0;i<R8;i++){t===4?r[i]=(n&1)*4*(Math.random()*14+1)-8:r[i]=(n&1)*2-1;let s=n>>1;if((n+s&1)==1)switch(t){default:case 1:s+=16384;break;case 3:s+=32768;break;case 2:s+=40;break;case 4:s+=60;break}n=s}return e}function jm(t){let e,n;function r(){switch(e==null?void 0:e.type){case 0:{e.synth.set({...n,envelope:{...n.envelope,attack:.01,decay:.01,sustain:.5,release:.01},oscillator:{...n.oscillator,type:"square"}});break}case 1:e.synth.set({...n,release:"8n"})}}switch(t){case 0:return e={type:t,synth:new Cl},n=Gc(e.synth.get()),r(),{source:e,applyreset:r};case 1:case 2:case 3:case 4:return e={type:t,synth:new Ix({attack:.001,release:.75,urls:{C4:HVe(t)}})},n=Gc(e.synth.get()),r(),{source:e,applyreset:r}}}const VVe=Date.now(),Ch={get value(){return(Date.now()-VVe)/1e3%1e6}},zVe=120;let SZ=0;function q4(t){SZ=zVe/t,W4().bpm.value=t}q4(150);const K4={get value(){return SZ}};function Y4(t){const e=t.clone();return e.uniforms.time=Ch,e.uniforms.interval=K4,e}let JC=!1;function SS(){JC||vVe().then(()=>{if(!JC){const t=W4();JC=!0,t.start(),gp(Ja,"audio is enabled!"),q4(107);try{const e=navigator;he(e.audioSession)&&(e.audioSession.type="playback")}catch{}yde(Ja,Ni())}}).catch(t=>{ai(Ja,"audio",t.message)})}function GVe(){const t=UVe(),e=cc().createMediaStreamDestination(),n=new Ph(-10);n.connect(t),n.connect(e);const r=new z4({threshold:-24,ratio:4,attack:.003,release:.25,knee:30});r.connect(n);const i=new Ph(-5);i.connect(r),new Ph(0).connect(r);const o=new Ph(-4);o.connect(r);const a=new Ph(0);a.connect(r);const c=[jm(Ac.SYNTH),jm(Ac.SYNTH),jm(Ac.SYNTH),jm(Ac.SYNTH),jm(Ac.SYNTH),jm(Ac.SYNTH),jm(Ac.SYNTH),jm(Ac.SYNTH)],l=[ED(),ED(),ED()];function u(We){return We<4?Math.floor(We/2):2}function d(We){const ze=u(We);c[We].source.synth.chain(l[ze].vibrato,l[ze].chorus,l[ze].phaser,l[ze].distortion,l[ze].echo,l[ze].reverb,i)}for(let We=0;We<c.length;++We)d(We);function h(We,ze){c[We].source.type!==ze&&(c[We].source.synth.dispose(),c[We]=jm(ze),d(We))}const p=new wA().connect(o);p.maxPolyphony=8,p.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"square"}});function f(We){p.triggerAttackRelease("C6","1i",We)}const g=new Cl().connect(o);p.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"square"}});function y(We){const ze=Ca("64n").toSeconds();g.triggerAttackRelease("C6","8n",We),g.frequency.exponentialRampToValueAtTime("C11",ze+We)}const E=new Rd(350,"bandpass").connect(o),w=new ri().connect(E);w.gain.value=0;const R=new wA().connect(w);R.maxPolyphony=8,R.set({envelope:{attack:.001,decay:.01,sustain:.1,release:.1},oscillator:{type:"square"}});function A(We,ze){const Vt=Ca("64n").toSeconds()+Ca(We).toSeconds();w.gain.setValueAtTime(.5,ze),w.gain.exponentialRampToValueAtTime(.01,Vt+ze),R.triggerAttackRelease([800,540],We,ze)}const k=new G4(-10,10,-1).connect(o),I=new Rd(800,"highpass",-12);I.connect(k);const N=new qb;N.set({envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),N.connect(I);function U(We,ze){N.triggerAttackRelease(We,ze)}const F=new uw().connect(o);F.set({distortion:.666});const $=new Cl;$.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),$.connect(F);const q=new Rd;q.set({type:"highpass",frequency:1e4}),q.connect(F);const K=new qb;K.set({envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),K.connect(q);function W(We,ze){const Vt=Ca("512n").toSeconds(),xt=Ca("32n").toSeconds();$.triggerAttackRelease(1e4,We,ze,1),$.frequency.exponentialRampToValueAtTime(300,ze+Vt),$.frequency.exponentialRampToValueAtTime(100,ze+xt),K.triggerAttackRelease("8n",ze,.333),K.volume.setValueAtTime(1,ze),K.volume.exponentialRampToValueAtTime(0,ze+Ca("32n").toSeconds())}const X=new Rd;X.set({type:"bandpass",frequency:256,Q:.17}),X.connect(o);const ne=new Cl;ne.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),ne.connect(X);const Z=new Cl;Z.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),Z.connect(X);function ie(We,ze){ne.triggerAttackRelease(2e3,We,ze),ne.frequency.exponentialRampToValueAtTime(1e3,ze+Ca("32n").toSeconds()),Z.triggerAttackRelease(999,We,ze),Z.frequency.exponentialRampToValueAtTime(888,ze+Ca("256n").toSeconds())}const G=new uw().connect(o);G.set({distortion:.876});const Q=new Cl;Q.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),Q.connect(G);const se=new Rd;se.set({type:"highpass",frequency:1e4}),se.connect(G);const ve=new qb;ve.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),ve.connect(se);function Oe(We,ze){const Vt=Ca("512n").toSeconds(),xt=Ca("32n").toSeconds();Q.triggerAttackRelease(1e4,We,ze,1),Q.frequency.exponentialRampToValueAtTime(150,ze+Vt),Q.frequency.exponentialRampToValueAtTime(100,ze+xt),ve.triggerAttackRelease("8n",ze,.25),ve.volume.setValueAtTime(1,ze),ve.volume.exponentialRampToValueAtTime(0,ze+Ca("32n").toSeconds())}const _e=new Cl().connect(o);_e.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"sawtooth"}});const le=new Cl().connect(o);_e.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"triangle"}});const xe=new qb().connect(o);xe.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}});function Ee(We,ze){const Vt=Ca("256n").toSeconds(),xt=Ca(We).toSeconds()-Vt;_e.triggerAttackRelease("C4",xt,ze,1),_e.frequency.exponentialRampToValueAtTime(E8("C0").toFrequency(),ze+xt),le.triggerAttackRelease("C5",xt,ze,.5),le.frequency.exponentialRampToValueAtTime(E8("C0").toFrequency(),ze+xt);const jt=Ca("4n").toSeconds();xe.triggerAttackRelease("8n",ze),xe.volume.setValueAtTime(1,ze),xe.volume.exponentialRampToValueAtTime(0,ze+jt)}const Se=new Rd;Se.set({type:"bandpass",frequency:256,Q:.17}),Se.connect(o);const Ie=new Cl;Ie.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),Ie.connect(Se);const Ze=new Cl;Ze.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),Ze.connect(Se);function _t(We,ze){Ie.triggerAttackRelease(2e3,We,ze),Ie.frequency.exponentialRampToValueAtTime(100,ze+Ca("32n").toSeconds()),Ze.triggerAttackRelease(699,We,ze),Ze.frequency.exponentialRampToValueAtTime(399,ze+Ca("256n").toSeconds())}const fe=new Mx().connect(o);fe.set({octaves:8});function ge(We){fe.triggerAttackRelease("C1","8n",We)}const rt=new xA(Re);function Re(We,ze){if(ze===null)return;const[Vt,xt,jt]=ze;if(nr(jt)&&he(c[Vt])&&(jt.startsWith("#")?Hde(Ja,jt.slice(1)):c[Vt].source.synth.triggerAttackRelease(jt,xt,We)),Mn(jt))switch(jt){case 0:f(We);break;case 1:y(We);break;case 2:A(xt,We);break;case 3:U(xt,We);break;case 4:W(xt,We);break;case 5:ie(xt,We);break;case 6:Oe(xt,We);break;case 7:Ee(xt,We);break;case 8:_t(xt,We);break;case 9:ge(We);break;case-1:--kt,kt===0&&(rt.clear(),Ge=-1);break}}function St(We,ze,Vt,xt=!0){let jt=ze;const ae=jVe(We,ze,Vt,xt),j=ae[ae.length-1];he(j)&&(jt=Math.max(jt,j[0]));for(let V=0;V<ae.length;++V){const[pe,Ne]=ae[V];rt.add(pe,Ne)}return jt}let Ge=-1,kt=0,Bt=C8;function He(We,ze){const Vt=$Ve(We),xt=W4().seconds+.01;if(ze)for(let jt=0;jt<Vt.length;++jt)St(Bt++,xt,Vt[jt],!1),Bt>=c.length&&(Bt=C8);else{Ge===-1&&(Ge=xt),kt+=Vt.length;const jt=Ge;for(let ae=0;ae<Vt.length&&ae<c.length;++ae){const j=St(ae,jt,Vt[ae]);Ge=Math.max(Ge,j)}}}rt.start(0);function $t(){rt.clear(),Ge=-1,kt=0}function Ce(We){n.volume.value=We}function ue(We){o.volume.value=We}function tt(We){new Ax(We).connect(a).start(0)}function yt(We){a.volume.value=We}return{broadcastdestination:e,addplay:He,stopplay:$t,addttsaudiobuffer:tt,setmainvolume:Ce,setdrumvolume:ue,setttsvolume:yt,SOURCE:c,FX:l,changesource:h,mapindextofx:u}}const WVe=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]+/,qVe=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]*/;function KVe(t,e){if(nr(t)){const n=rr(t);if(WVe.test(n))return qr(e);switch(n){case"pwm":case"pulse":case"retro":case"buzz":case"clang":case"metallic":return!0;default:return qVe.test(n)}}return!1}let SD,ko;function YVe(){return ko==null?void 0:ko.broadcastdestination}const Ja=Xh("synth",[],t=>{if(Ja.session(t)&&(JC&&!he(ko)&&(ko=GVe()),!!he(ko)))switch(t.target){case"audioenabled":eu(Ja,async()=>{await Zf(1e3),tg(Ja,void 0,"text","audioenabled","",Ni())});break;case"bpm":Mn(t.data)&&q4(t.data);break;case"mainvolume":Mn(t.data)&&ko.setmainvolume(t.data);break;case"drumvolume":Mn(t.data)&&ko.setdrumvolume(t.data);break;case"ttsvolume":Mn(t.data)&&ko.setttsvolume(t.data);break;case"play":if(qr(t.data)){const[e,n]=t.data;e===""?ko.stopplay():ko.addplay(e,n)}break;case"voice":if(qr(t.data)){const[e,n,r]=t.data,i=ko.SOURCE[e];if(!he(i)){ai(Ja,t.target,`unknown voice ${e}`);return}switch(n){case"reset":case"restart":i.applyreset();return;case"vol":case"volume":Mn(r)&&(i.source.synth.volume.value=r);return;case"port":case"portamento":if(Mn(r))switch(i.source.type){case Ac.SYNTH:i.source.synth.portamento=r;break;case Ac.RETRO_NOISE:ai(Ja,t.target,"portamento for retro synth not supported");break}return;case"env":case"envelope":if(qr(r)){const[s,o,a,c]=r;i.source.synth.set({envelope:{attack:s,decay:o,sustain:a,release:c}})}return;default:if(nr(n)){if(KVe(n,r)){switch(n){case"retro":ko.changesource(e,Ac.RETRO_NOISE);break;case"buzz":ko.changesource(e,Ac.BUZZ_NOISE);break;case"clang":ko.changesource(e,Ac.CLANG_NOISE);break;case"metallic":ko.changesource(e,Ac.METALLIC_NOISE);break;default:ko.changesource(e,Ac.SYNTH),i.source.synth.set({oscillator:{type:n}}),qr(r)&&i.source.synth.set({oscillator:{type:n,partials:r,partialCount:r.length}}),Mn(r)&&i.source.synth.set({oscillator:{type:n,partials:[r],partialCount:1}});break}return}switch(i.source.type){case Ac.SYNTH:{switch(i.source.synth.get().oscillator.type){case"pwm":switch(n){case"modfreq":case"modulationfrequency":Mn(r)&&i.source.synth.set({oscillator:{modulationFrequency:r}});return}break;case"pulse":switch(n){case"width":Mn(r)&&i.source.synth.set({oscillator:{width:r}});return}break;case"custom":case"sine":case"square":case"triangle":case"sawtooth":switch(n){case"phase":Mn(r)&&i.source.synth.set({oscillator:{phase:r}});return}break;case"amcustom":case"amsine":case"amsquare":case"amtriangle":case"amsawtooth":switch(n){case"harmonicity":Mn(r)&&i.source.synth.set({oscillator:{harmonicity:r}});return;case"modtype":case"modulationtype":nr(r)&&i.source.synth.set({oscillator:{modulationType:r}});return;case"modenv":case"modulationenvelope":if(qr(r)){const[o,a,c,l]=r;i.source.synth.set({oscillator:{modulationEnvelope:{attack:o,decay:a,sustain:c,release:l}}});return}break}break;case"fmcustom":case"fmsine":case"fmsquare":case"fmtriangle":case"fmsawtooth":switch(n){case"harmonicity":if(Mn(r)){i.source.synth.set({oscillator:{harmonicity:r}});return}break;case"modindex":if(Mn(r)){i.source.synth.set({oscillator:{modulationIndex:r}});return}break;case"modtype":if(nr(r)){i.source.synth.set({oscillator:{modulationType:r}});return}break;case"modenv":if(qr(r)){const[o,a,c,l]=r;i.source.synth.set({oscillator:{modulationEnvelope:{attack:o,decay:a,sustain:c,release:l}}});return}break}break;case"fatcustom":case"fatsine":case"fatsquare":case"fattriangle":case"fatsawtooth":switch(n){case"count":if(Mn(r)){i.source.synth.set({oscillator:{count:r}});return}break;case"phase":if(Mn(r)){i.source.synth.set({oscillator:{phase:r}});return}break;case"spread":if(Mn(r)){i.source.synth.set({oscillator:{spread:r}});return}break}break}return}}ai(Ja,t.target,`unknown config ${n}`)}break}}break;case"voicefx":if(qr(t.data)){const[e,n,r,i]=t.data,s=ko.mapindextofx(e),o=ko.FX[s][n];if(he(o)){switch(r){case"on":o.wet.value=.2;break;case"off":o.wet.value=0;break;default:if(Mn(r))o.wet.value=Ci(.01*r,0,1);else switch(n){case"vibrato":{switch(r){default:ai(Ja,t.target,`unknown ${n} config ${r}`);break}break}case"chorus":{switch(r){default:ai(Ja,t.target,`unknown ${n} config ${r}`);break}break}case"phaser":{const a=o;switch(r){case"q":Mn(i)&&(a.Q.value=i);break;case"octaves":Mn(i)&&(a.octaves=i);break;case"basefrequency":Mn(i)&&(a.baseFrequency=i);break;default:ai(Ja,t.target,`unknown ${n} config ${r}`);break}break}case"distortion":{const a=o;switch(r){case"distortion":Mn(i)&&(a.distortion=i);break;case"oversample":switch(i){case"2x":case"4x":case"none":a.oversample=i;break}break;default:ai(Ja,t.target,`unknown ${n} config ${r}`);break}break}case"echo":{const a=o;switch(r){case"delaytime":a.delayTime.value=i;break;default:ai(Ja,t.target,`unknown ${n} config ${r}`);break}break}case"reverb":{const a=o;switch(r){case"decay":a.decay=i;break;case"predelay":a.preDelay=i;break;default:ai(Ja,t.target,`unknown ${n} config ${r}`);break}break}}break}o instanceof lN&&(o.wet.value===0?o.set({delayTime:cF}):o.get().delayTime===cF&&o.set({delayTime:FVe}));return}ai(Ja,t.target,`unknown fx ${n}`)}break;case"tts":eu(Ja,async()=>{if(he(SD)||(SD=new fx({locale:"en-US"})),he(ko)&&qr(t.data)){const[e,n]=t.data,r=await SD.createAudio({input:n,options:{voice:e||"en-US-GuyNeural"}});ko.addttsaudiobuffer(r)}});break}});/**
 * postprocessing v6.36.4 build Tue Nov 05 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var TD=1/1e3,XVe=1e3,JVe=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(t){typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=t)}get delta(){return this._delta*TD}get fixedDelta(){return this._fixedDelta*TD}set fixedDelta(t){this._fixedDelta=t*XVe}get elapsed(){return this._elapsed*TD}update(t){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(t!==void 0?t:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(t){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},QVe=(()=>{const t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),n=new Yh;return n.setAttribute("position",new oo(t,3)),n.setAttribute("uv",new oo(e,2)),n})(),of=class lF{static get fullscreenGeometry(){return QVe}constructor(e="Pass",n=new bR,r=new eM){this.name=e,this.renderer=null,this.scene=n,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const n=this.fullscreenMaterial;n!==null&&(n.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let n=this.screen;n!==null?n.material=e:(n=new Dh(lF.fullscreenGeometry,e),n.frustumCulled=!1,this.scene===null&&(this.scene=new bR),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,n=py){}render(e,n,r,i,s){throw new Error("Render method not implemented!")}setSize(e,n){}initialize(e,n,r){}dispose(){for(const e of Object.keys(this)){const n=this[e];(n instanceof Zu||n instanceof _g||n instanceof So||n instanceof lF)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},ZVe=class extends of{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,n,r,i){const s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},e8e=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,t8e="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",n8e=class extends Il{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Wi(null),opacity:new Wi(1)},blending:Bh,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:e8e,vertexShader:t8e})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},r8e=class extends of{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new n8e,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new Zu(1,1,{minFilter:ru,magFilter:ru,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,n,r,i){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,n){n!==void 0&&(this.renderTarget.texture.type=n,n!==Yc?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t!==null&&t.outputColorSpace===Lo&&(this.renderTarget.texture.colorSpace=Lo))}},A8=new Ei,TZ=class extends of{constructor(t=!0,e=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,n){this.color=t,this.depth=e,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,n,r,i){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=t.getClearAlpha(),c=s!==null,l=o>=0;c?(t.getClearColor(A8),t.setClearColor(s,l?o:a)):l&&t.setClearAlpha(o),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),c?t.setClearColor(A8,a):l&&t.setClearAlpha(a)}},i8e=class extends of{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new TZ(!1,!1,!0),this.inverse=!1}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,n,r,i){const s=t.getContext(),o=t.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,d=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,u,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(t,null):(l.render(t,e),l.render(t,n))),this.renderToScreen?(t.setRenderTarget(null),t.render(a,c)):(t.setRenderTarget(e),t.render(a,c),t.setRenderTarget(n),t.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},s8e=class{constructor(e=null,{depthBuffer:n=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(n,r,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new r8e,this.depthTexture=null,this.passes=[],this.timer=new JVe,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const n=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(n.depthBuffer,n.stencilBuffer,n.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const n=e.getSize(new Vn),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===Yc&&e.outputColorSpace===Lo&&(this.inputBuffer.texture.colorSpace=Lo,this.outputBuffer.texture.colorSpace=Lo,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(n.width,n.height);for(const s of this.passes)s.initialize(e,r,i)}}replaceRenderer(e,n=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),n&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new eB;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=K0,e.type=q0):e.type=c_,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,n,r,i){const s=this.renderer,o=s===null?new Vn:s.getDrawingBufferSize(new Vn),a={minFilter:ru,magFilter:ru,stencilBuffer:n,depthBuffer:e,type:r},c=new Zu(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),r===Yc&&s!==null&&s.outputColorSpace===Lo&&(c.texture.colorSpace=Lo),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const n of this.passes)n.mainScene=e}setMainCamera(e){for(const n of this.passes)n.mainCamera=e}addPass(e,n){const r=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new Vn),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(s.width,s.height),e.initialize(i,o,a),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),n!==void 0?r.splice(n,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of r)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const n=this.passes,r=n.indexOf(e);if(r!==-1&&n.splice(r,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;n.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===n.length&&(e.renderToScreen=!1,n.length>0&&(n[n.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const n=this.renderer,r=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(n,i,s,e,o),u.needsSwap&&(o&&(r.renderToScreen=u.renderToScreen,a=n.getContext(),c=n.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),r.render(n,i,s,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=s,s=l),u instanceof i8e?o=!0:u instanceof ZVe&&(o=!1))}setSize(e,n,r){const i=this.renderer,s=i.getSize(new Vn);(e===void 0||n===void 0)&&(e=s.width,n=s.height),(s.width!==e||s.height!==n)&&i.setSize(e,n,r);const o=i.getDrawingBufferSize(new Vn);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),of.fullscreenGeometry.dispose()}},mp={NONE:0,DEPTH:1,CONVOLUTION:2},Bi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},o8e=class{constructor(){this.shaderParts=new Map([[Bi.FRAGMENT_HEAD,null],[Bi.FRAGMENT_MAIN_UV,null],[Bi.FRAGMENT_MAIN_IMAGE,null],[Bi.VERTEX_HEAD,null],[Bi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=mp.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=x_}},wD=!1,M8=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let n;if(e.material.flatShading)switch(e.material.side){case Gu:n=this.materialsFlatShadedDoubleSide;break;case sc:n=this.materialsFlatShadedBackSide;break;default:n=this.materialsFlatShaded;break}else switch(e.material.side){case Gu:n=this.materialsDoubleSide;break;case sc:n=this.materialsBackSide;break;default:n=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=n[2]:e.isInstancedMesh?e.material=n[1]:e.material=n[0],++this.meshCount}}}cloneMaterial(t){if(!(t instanceof Il))return t.clone();const e=t.uniforms,n=new Map;for(const i in e){const s=e[i].value;s.isRenderTargetTexture&&(e[i].value=null,n.set(i,s))}const r=t.clone();for(const i of n)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){const e=this.materials=[this.cloneMaterial(t),this.cloneMaterial(t),this.cloneMaterial(t)];for(const n of e)n.uniforms=Object.assign({},t.uniforms),n.side=ag;e[2].skinning=!0,this.materialsBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=sc,r}),this.materialsDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=Gu,r}),this.materialsFlatShaded=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=sc,r}),this.materialsFlatShadedDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=Gu,r})}}render(t,e,n){const r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,wD){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,n);for(const s of i)s[0].material=s[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,n),e.overrideMaterial=i}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return wD}static set workaroundEnabled(t){wD=t}},Tv=-1,fE=class extends vg{constructor(t,e=Tv,n=Tv,r=1){super(),this.resizable=t,this.baseSize=new Vn(1,1),this.preferredSize=new Vn(e,n),this.target=this.preferredSize,this.s=r,this.effectiveSize=new Vn,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const t=this.baseSize,e=this.preferredSize,n=this.effectiveSize,r=this.scale;e.width!==Tv?n.width=e.width:e.height!==Tv?n.width=Math.round(e.height*(t.width/Math.max(t.height,1))):n.width=Math.round(t.width*r),e.height!==Tv?n.height=e.height:e.width!==Tv?n.height=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):n.height=Math.round(t.height*r)}get width(){return this.effectiveSize.width}set width(t){this.preferredWidth=t}get height(){return this.effectiveSize.height}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferredSize.setScalar(Tv),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.baseSize.width}set baseWidth(t){this.baseSize.width!==t&&(this.baseSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(t){this.baseWidth=t}get baseHeight(){return this.baseSize.height}set baseHeight(t){this.baseSize.height!==t&&(this.baseSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.baseSize.width!==t||this.baseSize.height!==e)&&(this.baseSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(t){this.preferredSize.width!==t&&(this.preferredSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferredSize.height}set preferredHeight(t){this.preferredSize.height!==t&&(this.preferredSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferredSize.width!==t||this.preferredSize.height!==e)&&(this.preferredSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(t){this.s=t.scale,this.baseSize.set(t.baseWidth,t.baseHeight),this.preferredSize.set(t.preferredWidth,t.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Tv}},pi={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},a8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",c8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",l8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",u8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",d8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",h8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",f8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",p8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",m8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",g8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",v8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",_8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",y8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",b8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",E8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",S8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",T8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",w8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",x8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",C8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",R8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",A8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",M8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",I8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",O8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",k8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",N8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",P8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",D8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",L8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",U8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",F8e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",B8e=new Map([[pi.ADD,a8e],[pi.ALPHA,c8e],[pi.AVERAGE,l8e],[pi.COLOR,u8e],[pi.COLOR_BURN,d8e],[pi.COLOR_DODGE,h8e],[pi.DARKEN,f8e],[pi.DIFFERENCE,p8e],[pi.DIVIDE,m8e],[pi.DST,null],[pi.EXCLUSION,g8e],[pi.HARD_LIGHT,v8e],[pi.HARD_MIX,_8e],[pi.HUE,y8e],[pi.INVERT,b8e],[pi.INVERT_RGB,E8e],[pi.LIGHTEN,S8e],[pi.LINEAR_BURN,T8e],[pi.LINEAR_DODGE,w8e],[pi.LINEAR_LIGHT,x8e],[pi.LUMINOSITY,C8e],[pi.MULTIPLY,R8e],[pi.NEGATION,A8e],[pi.NORMAL,M8e],[pi.OVERLAY,I8e],[pi.PIN_LIGHT,O8e],[pi.REFLECT,k8e],[pi.SATURATION,N8e],[pi.SCREEN,P8e],[pi.SOFT_LIGHT,D8e],[pi.SRC,L8e],[pi.SUBTRACT,U8e],[pi.VIVID_LIGHT,F8e]]),j8e=class extends vg{constructor(t,e=1){super(),this._blendFunction=t,this.opacity=new Wi(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this._blendFunction}set blendFunction(t){this._blendFunction=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return B8e.get(this.blendFunction)}},uF=class extends vg{constructor(t,e,{attributes:n=mp.NONE,blendFunction:r=pi.NORMAL,defines:i=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=t,this.renderer=null,this.attributes=n,this.fragmentShader=e,this.vertexShader=a,this.defines=i,this.uniforms=s,this.extensions=o,this.blendMode=new j8e(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=x_,this._outputColorSpace=np}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(t){this._inputColorSpace=t,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t,this.setChanged()}set mainScene(t){}set mainCamera(t){}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=py){}update(t,e,n){}setSize(t,e){}initialize(t,e,n){}dispose(){for(const t of Object.keys(this)){const e=this[t];(e instanceof Zu||e instanceof _g||e instanceof So||e instanceof of)&&this[t].dispose()}}},iC={RED:0,GREEN:1,BLUE:2,ALPHA:3},wZ=class extends of{constructor(t,e,n=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new TZ,this.overrideMaterialManager=n===null?null:new M8(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){const t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){const e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new M8(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,n,r,i){const s=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=s.background,u=t.shadowMap.autoUpdate,d=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,s,o):t.render(s,o),o.layers.mask=c,s.background=l,t.shadowMap.autoUpdate=u}},$8e=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,H8e="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",V8e=class extends Il{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Wi(null),normalBuffer:new Wi(null),texelSize:new Wi(new Vn)},blending:Bh,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:$8e,vertexShader:H8e})}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=py){this.depthBuffer=t,this.depthPacking=e}set normalBuffer(t){this.uniforms.normalBuffer.value=t,t!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(t){this.normalBuffer=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},z8e=class extends of{constructor({normalBuffer:t=null,resolutionScale:e=.5,width:n=fE.AUTO_SIZE,height:r=fE.AUTO_SIZE,resolutionX:i=n,resolutionY:s=r}={}){super("DepthDownsamplingPass");const o=new V8e;o.normalBuffer=t,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Zu(1,1,{minFilter:jo,magFilter:jo,depthBuffer:!1,type:cp}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new fE(this,i,s,e);a.addEventListener("change",c=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(t,e=py){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e}render(t,e,n,r,i){t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height),this.fullscreenMaterial.setSize(t,e)}initialize(t,e,n){const r=t.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},G8e=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,W8e="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",q8e=class extends Il{constructor(t,e,n,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:YA.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Wi(null),depthBuffer:new Wi(null),resolution:new Wi(new Vn),texelSize:new Wi(new Vn),cameraNear:new Wi(.3),cameraFar:new Wi(1e3),aspect:new Wi(1),time:new Wi(0)},blending:Bh,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),t&&this.setShaderParts(t),e&&this.setDefines(e),n&&this.setUniforms(n),this.copyCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=py){this.depthBuffer=t,this.depthPacking=e}setShaderData(t){this.setShaderParts(t.shaderParts),this.setDefines(t.defines),this.setUniforms(t.uniforms),this.setExtensions(t.extensions)}setShaderParts(t){return this.fragmentShader=G8e.replace(Bi.FRAGMENT_HEAD,t.get(Bi.FRAGMENT_HEAD)||"").replace(Bi.FRAGMENT_MAIN_UV,t.get(Bi.FRAGMENT_MAIN_UV)||"").replace(Bi.FRAGMENT_MAIN_IMAGE,t.get(Bi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=W8e.replace(Bi.VERTEX_HEAD,t.get(Bi.VERTEX_HEAD)||"").replace(Bi.VERTEX_MAIN_SUPPORT,t.get(Bi.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(t){for(const e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(const e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(const e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof ju?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){const n=this.uniforms;n.resolution.value.set(t,e),n.texelSize.value.set(1/t,1/e),n.aspect.value=t/e}static get Section(){return Bi}};function I8(t,e,n){for(const r of e){const i="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const o of n.entries())o[1]!==null&&n.set(o[0],o[1].replace(s,i))}}function K8e(t,e,n){let r=e.getFragmentShader(),i=e.getVertexShader();const s=r!==void 0&&/mainImage/.test(r),o=r!==void 0&&/mainUv/.test(r);if(n.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&n.attributes&mp.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=n.shaderParts;let l=c.get(Bi.FRAGMENT_HEAD)||"",u=c.get(Bi.FRAGMENT_MAIN_UV)||"",d=c.get(Bi.FRAGMENT_MAIN_IMAGE)||"",h=c.get(Bi.VERTEX_HEAD)||"",p=c.get(Bi.VERTEX_MAIN_SUPPORT)||"";const f=new Set,g=new Set;if(o&&(u+=`	${t}MainUv(UV);
`,n.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const w=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);p+=`	${t}MainSupport(`,p+=w?`vUv);
`:`);
`;for(const R of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const A of R[1].split(/\s*,\s*/))n.varyings.add(A),f.add(A),g.add(A);for(const R of i.matchAll(a))g.add(R[1])}for(const w of r.matchAll(a))g.add(w[1]);for(const w of e.defines.keys())g.add(w.replace(/\([\w\s,]*\)/g,""));for(const w of e.uniforms.keys())g.add(w);g.delete("while"),g.delete("for"),g.delete("if"),e.uniforms.forEach((w,R)=>n.uniforms.set(t+R.charAt(0).toUpperCase()+R.slice(1),w)),e.defines.forEach((w,R)=>n.defines.set(t+R.charAt(0).toUpperCase()+R.slice(1),w));const y=new Map([["fragment",r],["vertex",i]]);I8(t,g,n.defines),I8(t,g,y),r=y.get("fragment"),i=y.get("vertex");const E=e.blendMode;if(n.blendModes.set(E.blendFunction,E),s){e.inputColorSpace!==null&&e.inputColorSpace!==n.colorSpace&&(d+=e.inputColorSpace===Lo?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==np?n.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(n.colorSpace=e.inputColorSpace);const w=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${t}MainImage(color0, UV, `,n.attributes&mp.DEPTH&&w.test(r)&&(d+="depth, ",n.readDepth=!0),d+=`color1);
	`;const R=t+"BlendOpacity";n.uniforms.set(R,E.opacity),d+=`color0 = blend${E.blendFunction}(color0, color1, ${R});

	`,l+=`uniform float ${R};

`}if(l+=r+`
`,i!==null&&(h+=i+`
`),c.set(Bi.FRAGMENT_HEAD,l),c.set(Bi.FRAGMENT_MAIN_UV,u),c.set(Bi.FRAGMENT_MAIN_IMAGE,d),c.set(Bi.VERTEX_HEAD,h),c.set(Bi.VERTEX_MAIN_SUPPORT,p),e.extensions!==null)for(const w of e.extensions)n.extensions.add(w)}}var Y8e=class extends of{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new q8e(null,null,null,t),this.listener=n=>this.handleEvent(n),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(t){for(const e of this.effects)e.mainScene=t}set mainCamera(t){this.fullscreenMaterial.copyCameraSettings(t);for(const e of this.effects)e.mainCamera=t}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){const e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}setEffects(t){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=t.sort((e,n)=>n.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const t=new o8e;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===pi.DST)t.attributes|=o.getAttributes()&mp.DEPTH;else{if(t.attributes&o.getAttributes()&mp.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);K8e("e"+e++,o,t)}let n=t.shaderParts.get(Bi.FRAGMENT_HEAD),r=t.shaderParts.get(Bi.FRAGMENT_MAIN_IMAGE),i=t.shaderParts.get(Bi.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of t.blendModes.values())n+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;t.attributes&mp.DEPTH?(t.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,t.colorSpace===Lo&&(r+=`color0 = sRGBToLinear(color0);
	`),t.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,t.defines.set("UV","transformedUv")):t.defines.set("UV","vUv"),t.shaderParts.set(Bi.FRAGMENT_HEAD,n),t.shaderParts.set(Bi.FRAGMENT_MAIN_IMAGE,r),t.shaderParts.set(Bi.FRAGMENT_MAIN_UV,i);for(const[o,a]of t.shaderParts)a!==null&&t.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(t)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=py){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(const n of this.effects)n.setDepthTexture(t,e)}render(t,e,n,r,i){for(const s of this.effects)s.update(t,e,r);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r*this.timeScale,t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(const n of this.effects)n.setSize(t,e)}initialize(t,e,n){this.renderer=t;for(const r of this.effects)r.initialize(t,e,n);this.updateMaterial(),n!==void 0&&n!==Yc&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const t of this.effects)t.removeEventListener("change",this.listener),t.dispose()}handleEvent(t){switch(t.type){case"change":this.recompile();break}}},X8e=class extends of{constructor(t,e,{renderTarget:n,resolutionScale:r=1,width:i=fE.AUTO_SIZE,height:s=fE.AUTO_SIZE,resolutionX:o=i,resolutionY:a=s}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new wZ(t,e,new $le);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new Ei(7829503),l.overrideClearAlpha=1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Zu(1,1,{minFilter:jo,magFilter:jo}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new fE(this,o,a,r);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(t){this.renderPass.mainScene=t}set mainCamera(t){this.renderPass.mainCamera=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,n,r,i){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,s,s)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height)}};let WS;function J8e(){var t;if(WS!==void 0)return WS;try{let e;const n=document.createElement("canvas");return WS=!!(window.WebGL2RenderingContext&&(e=n.getContext("webgl2"))),e&&((t=e.getExtension("WEBGL_lose_context"))==null||t.loseContext()),WS}catch{return WS=!1}}const Q8e=ft.createContext(null),O8=t=>(t.getAttributes()&mp.CONVOLUTION)===mp.CONVOLUTION,Z8e=Fh.memo(ft.forwardRef(({children:t,camera:e,scene:n,resolutionScale:r,enabled:i=!0,renderPriority:s=1,autoClear:o=!0,depthBuffer:a,enableNormalPass:c,stencilBuffer:l,multisampling:u=8,frameBufferType:d=oS},h)=>{const{gl:p,scene:f,camera:g,size:y}=lS(),E=n||f,w=e||g,[R,A,k]=ft.useMemo(()=>{const F=J8e(),$=new s8e(p,{depthBuffer:a,stencilBuffer:l,multisampling:u>0&&F?u:0,frameBufferType:d});$.addPass(new wZ(E,w));let q=null,K=null;return c&&(K=new X8e(E,w),K.enabled=!1,$.addPass(K),r!==void 0&&F&&(q=new z8e({normalBuffer:K.texture,resolutionScale:r}),q.enabled=!1,$.addPass(q))),[$,K,q]},[w,p,a,l,u,d,E,c,r]);ft.useEffect(()=>R==null?void 0:R.setSize(y.width,y.height),[R,y]),ww((F,$)=>{if(i){const q=p.autoClear;p.autoClear=o,l&&!o&&p.clearStencil(),R.render($),p.autoClear=q}},i?s:0);const I=ft.useRef(null),N=bue(I);ft.useLayoutEffect(()=>{const F=[];if(I.current&&N.current&&R){const $=N.current.objects;for(let q=0;q<$.length;q++){const K=$[q];if(K instanceof uF){const W=[K];if(!O8(K)){let ne=null;for(;(ne=$[q+1])instanceof uF&&!O8(ne);)W.push(ne),q++}const X=new Y8e(w,...W);F.push(X)}else K instanceof of&&F.push(K)}for(const q of F)R==null||R.addPass(q);A&&(A.enabled=!0),k&&(k.enabled=!0)}return()=>{for(const $ of F)R==null||R.removePass($);A&&(A.enabled=!1),k&&(k.enabled=!1)}},[R,t,w,A,k,N]),ft.useEffect(()=>{const F=p.toneMapping;return p.toneMapping=up,()=>{p.toneMapping=F}},[]);const U=ft.useMemo(()=>({composer:R,normalPass:A,downSamplingPass:k,resolutionScale:r,camera:w,scene:E}),[R,A,k,r,w,E]);return ft.useImperativeHandle(h,()=>R,[R]),De.jsx(Q8e.Provider,{value:U,children:De.jsx("group",{ref:I,children:t})})}));let eze=0;const k8=new WeakMap,tze=(t,e)=>Fh.forwardRef(function({blendFunction:r=void 0,opacity:i=void 0,...s},o){let a=k8.get(t);if(!a){const u=`@react-three/postprocessing/${t.name}-${eze++}`;EW({[u]:t}),k8.set(t,a=u)}const c=lS(u=>u.camera),l=Fh.useMemo(()=>{var u,d;return[...(u=void 0)!=null?u:[],...(d=s.args)!=null?d:[{...e,...s}]]},[JSON.stringify(s)]);return De.jsx(a,{camera:c,"blendMode-blendFunction":r,"blendMode-opacity-value":i,...s,ref:o,args:l})});function xD(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{c(r.next(l))}catch(u){s(u)}}function a(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof n?u:new n(function(d){d(u)})).then(o,a)}c((r=r.apply(t,[])).next())})}const nze=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function N8(t){return t=t.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const xZ=typeof window>"u",Kf=(()=>{if(xZ)return;const{userAgent:t,platform:e,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(t),i=e==="iPad"||e==="MacIntel"&&n>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(t)||r||i,isSafari12:/Version\/12.+Safari/.test(t),isFirefox:/Firefox/.test(t)}})();function rze(t,e,n){if(!n)return[e];const r=function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,d=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,h=l.createShader(35633),p=l.createShader(35632),f=l.createProgram();if(!(p&&h&&f))return;l.shaderSource(h,u),l.shaderSource(p,d),l.compileShader(h),l.compileShader(p),l.attachShader(f,h),l.attachShader(f,p),l.linkProgram(f),l.detachShader(f,h),l.detachShader(f,p),l.deleteShader(h),l.deleteShader(p),l.useProgram(f);const g=l.createBuffer();l.bindBuffer(34962,g),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const y=l.getAttribLocation(f,"aPosition");l.vertexAttribPointer(y,3,5126,!1,0,0),l.enableVertexAttribArray(y),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const E=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,E),l.deleteProgram(f),l.deleteBuffer(g),E.join("")}(t),i="801621810",s="8016218135",o="80162181161",a=Kf!=null&&Kf.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return r==="80162181255"?c=a.filter(([,,l])=>l>=14):(c=a.filter(([,l])=>l===r),c.length||(c=a)),c.map(([l])=>`apple ${l} gpu`)}let P8=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};const CD=[],D8=[];function ize(t,e){if(t===e)return 0;const n=t;t.length>e.length&&(t=e,e=n);let r=t.length,i=e.length;for(;r>0&&t.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let s,o=0;for(;o<r&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,i-=o,r===0)return i;let a,c,l=0,u=0,d=0;for(;u<r;)D8[u]=t.charCodeAt(o+u),CD[u]=++u;for(;d<i;)for(s=e.charCodeAt(o+d),a=d++,l=d,u=0;u<r;u++)c=s===D8[u]?a:a+1,a=CD[u],l=CD[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function sze(t){return t!=null}const oze=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.56/dist/benchmarks"}={})=>xD(void 0,void 0,void 0,function*(){const o={};if(xZ)return{tier:0,type:"SSR"};const{isIpad:a=!!(Kf!=null&&Kf.isIpad),isMobile:c=!!(Kf!=null&&Kf.isMobile),screenSize:l=window.screen,loadBenchmarks:u=k=>xD(void 0,void 0,void 0,function*(){const I=yield fetch(`${s}/${k}`).then(N=>N.json());if(parseInt(I.shift().split(".")[0],10)<4)throw new P8("Detect GPU benchmark data is out of date. Please update to version 4x");return I})}=n;let{renderer:d}=n;const h=(k,I,N,U,F)=>({device:F,fps:U,gpu:N,isMobile:c,tier:k,type:I});let p,f="";if(d)d=N8(d),p=[d];else{const k=r||function(N,U=!1){const F={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:U,powerPreference:"high-performance",stencil:!1};N&&delete F.powerPreference;const $=window.document.createElement("canvas"),q=$.getContext("webgl",F)||$.getContext("experimental-webgl",F);return q??void 0}(Kf==null?void 0:Kf.isSafari12,i);if(!k)return h(0,"WEBGL_UNSUPPORTED");const I=Kf!=null&&Kf.isFirefox?null:k.getExtension("WEBGL_debug_renderer_info");if(d=I?k.getParameter(I.UNMASKED_RENDERER_WEBGL):k.getParameter(k.RENDERER),!d)return h(1,"FALLBACK");f=d,d=N8(d),p=function(N,U,F){return U==="apple gpu"?rze(N,U,F):[U]}(k,d,c)}const g=(yield Promise.all(p.map(function(k){var I;return xD(this,void 0,void 0,function*(){const N=(_e=>{const le=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const xe of le)if(_e.includes(xe))return xe})(k);if(!N)return;const U=`${c?"m":"d"}-${N}${a?"-ipad":""}.json`,F=o[U]=(I=o[U])!==null&&I!==void 0?I:u(U);let $;try{$=yield F}catch(_e){if(_e instanceof P8)throw _e;return}const q=function(_e){var le;const xe=(_e=_e.replace(/\([^)]+\)/,"")).match(/\d+/)||_e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(le=xe==null?void 0:xe.join("").replace(/\W|amd/g,""))!==null&&le!==void 0?le:""}(k);let K=$.filter(([,_e])=>_e===q);K.length||(K=$.filter(([_e])=>_e.includes(k)));const W=K.length;if(W===0)return;const X=k.split(/[.,()\[\]/\s]/g).sort().filter((_e,le,xe)=>le===0||_e!==xe[le-1]).join(" ");let ne,[Z,,,,ie]=W>1?K.map(_e=>[_e,ize(X,_e[2])]).sort(([,_e],[,le])=>_e-le)[0][0]:K[0],G=Number.MAX_VALUE;const{devicePixelRatio:Q}=window,se=l.width*Q*l.height*Q;for(const _e of ie){const[le,xe]=_e,Ee=le*xe,Se=Math.abs(se-Ee);Se<G&&(G=Se,ne=_e)}if(!ne)return;const[,,ve,Oe]=ne;return[G,ve,Z,Oe]})}))).filter(sze).sort(([k=Number.MAX_VALUE,I],[N=Number.MAX_VALUE,U])=>k===N?I-U:k-N);if(!g.length){const k=nze.find(I=>d.includes(I));return k?h(0,"BLOCKLISTED",k):h(1,"FALLBACK",`${d} (${f})`)}const[,y,E,w]=g[0];if(y===-1)return h(0,"BLOCKLISTED",E,y,w);const R=c?t:e;let A=0;for(let k=0;k<R.length;k++)y>=R[k]&&(A=k);return h(A,"BENCHMARK",E,y,w)});var $d=typeof window<"u"?window:{screen:{},navigator:{}},eS=($d.matchMedia||function(){return{matches:!1}}).bind($d),aze={get passive(){return!0}},CZ=function(){};$d.addEventListener&&$d.addEventListener("p",CZ,aze);$d.removeEventListener&&$d.removeEventListener("p",CZ,!1);var X4="ontouchstart"in $d,cze="TouchEvent"in $d,lze=X4||cze&&eS("(any-pointer: coarse)").matches,L8=($d.navigator.maxTouchPoints||0)>0||lze,RZ=$d.navigator.userAgent||"",uze=eS("(pointer: coarse)").matches&&/iPad|Macintosh/.test(RZ)&&Math.min($d.screen.width||0,$d.screen.height||0)>=768,AZ=(eS("(pointer: coarse)").matches||!eS("(pointer: fine)").matches&&X4)&&!/Windows.*Firefox/.test(RZ),dze=eS("(any-pointer: fine)").matches||eS("(any-hover: hover)").matches||uze||!X4,dF=L8&&(dze||!AZ)?"hybrid":L8?"touchOnly":"mouseOnly",hze=dF==="mouseOnly"?"mouse":dF==="touchOnly"||AZ?"touch":"mouse",MZ={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Da,function(){var n=function(){function r(p){return o.appendChild(p.dom),p}function i(p){for(var f=0;f<o.children.length;f++)o.children[f].style.display=f===p?"block":"none";s=p}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(p){p.preventDefault(),i(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,l=0,u=r(new n.Panel("FPS","#0ff","#002")),d=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=r(new n.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:r,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){l++;var p=(performance||Date).now();if(d.update(p-a,200),p>c+1e3&&(u.update(1e3*l/(p-c),100),c=p,l=0,h)){var f=performance.memory;h.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return p},update:function(){a=this.end()},domElement:o,setMode:i}};return n.Panel=function(r,i,s){var o=1/0,a=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,d=48*l,h=3*l,p=2*l,f=3*l,g=15*l,y=74*l,E=30*l,w=document.createElement("canvas");w.width=u,w.height=d,w.style.cssText="width:80px;height:48px";var R=w.getContext("2d");return R.font="bold "+9*l+"px Helvetica,Arial,sans-serif",R.textBaseline="top",R.fillStyle=s,R.fillRect(0,0,u,d),R.fillStyle=i,R.fillText(r,h,p),R.fillRect(f,g,y,E),R.fillStyle=s,R.globalAlpha=.9,R.fillRect(f,g,y,E),{dom:w,update:function(A,k){o=Math.min(o,A),a=Math.max(a,A),R.fillStyle=s,R.globalAlpha=1,R.fillRect(0,0,u,g),R.fillStyle=i,R.fillText(c(A)+" "+r+" ("+c(o)+"-"+c(a)+")",h,p),R.drawImage(w,f+l,g,y-l,E,f,g,y-l,E),R.fillRect(f+y-l,g,l,E),R.fillStyle=s,R.globalAlpha=.9,R.fillRect(f+y-l,g,l,c((1-A/k)*E))}}},n})})(MZ);var fze=MZ.exports;const pze=Nl(fze),mze=`  
vec3 halftone(vec3 texcolor, vec2 st, float frequency) {
  float n = 0.1 * snoise(st * 200.0); // Fractal noise
  n += 0.05 * snoise(st * 400.0);
  n += 0.025 * snoise(st * 800.0);

  // Perform a rough RGB-to-CMYK conversion
  vec4 cmyk;
  // CMY = 1-RGB
  cmyk.xyz = 1.0 - texcolor;
  // Black generation: K = min(C,M,Y)
  cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); 
  // Grey component replacement: subtract K from CMY
  cmyk.xyz -= cmyk.w; 

  // K based modifier
  float flex = pow(cmyk.w, 3.11);

  // Distance to nearest point in a grid of
  // (frequency x frequency) points over the unit square
  
  float t = 0.1 + 0.1 * n + 0.11 * flex + 0.1 * cmyk.y;

  // K component: 45 degrees screen angle
  vec2 Kst = frequency * mat2(0.707, -0.707, 0.707, 0.707) * st;
  vec2 Kuv = 2.0 * fract(Kst) - 1.0; 
  float k = aastep(0.0, sqrt(cmyk.w) + t - length(Kuv) + n);
  
  // C component: 15 degrees screen angle
  vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966) * st;
  vec2 Cuv = 2.0 * fract(Cst) - 1.0;
  float c = aastep(0.0, sqrt(cmyk.x) + t - length(Cuv) + n);
  
  // M component: -15 degrees screen angle
  vec2 Mst = frequency * mat2(0.966, 0.259, -0.259, 0.966) * st;
  vec2 Muv = 2.0 * fract(Mst) - 1.0;
  float m = aastep(0.0, sqrt(cmyk.y) + t - length(Muv) + n);

  // Y component: 0 degrees screen angle
  vec2 Yst = frequency * st; // 0 deg 
  vec2 Yuv = 2.0 * fract(Yst) - 1.0;
  float y = aastep(0.0, sqrt(cmyk.z) + t - length(Yuv) + n);

  // CMY screen in RGB
  vec3 black = vec3(n + 0.01);
  vec3 rgbscreen = 1.0 - vec3(c,m,y) + n;
  
  // Blend in K for final color
  vec3 factor = mix(rgbscreen, black, 1.1 * k + 0.3 * n);

  // Blend with og color
  return mix(factor, texcolor, 0.777);
}

vec3 halftone(vec3 texcolor, vec2 st) {
  return halftone(texcolor, st, 412.321);
}
`,gze=`
float blendLighten(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten(vec3 base, vec3 blend) {
	return vec3(blendLighten(base.r,blend.r),blendLighten(base.g,blend.g),blendLighten(base.b,blend.b));
}

vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
	return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken(vec3 base, vec3 blend) {
	return vec3(blendDarken(base.r,blend.r),blendDarken(base.g,blend.g),blendDarken(base.b,blend.b));
}

vec3 blendDarken(vec3 base, vec3 blend, float opacity) {
	return (blendDarken(base, blend) * opacity + base * (1.0 - opacity));
}
`,vze=`
float aastep(float threshold, float value) {
  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;
  return smoothstep(threshold-afwidth, threshold+afwidth, value);
}
`,_ze=`
//
// Description : Array and textureless GLSL 2D simplex noise function.
//      Author : Ian McEwan, Ashima Arts.
//  Maintainer : ijm
//     Lastmod : 20110822 (ijm)
//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
//               Distributed under the MIT License. See LICENSE file.
//               https://github.com/ashima/webgl-noise
//

vec3 mod289(vec3 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec2 mod289(vec2 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec3 permute(vec3 x) {
  return mod289(((x*34.0)+1.0)*x);
}

float snoise(vec2 v) {
  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)
                     -0.577350269189626,  // -1.0 + 2.0 * C.x
                      0.024390243902439); // 1.0 / 41.0
// First corner
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);

// Other corners
  vec2 i1;
  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0
  //i1.y = 1.0 - i1.x;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  // x0 = x0 - 0.0 + 0.0 * C.xx ;
  // x1 = x0 - i1 + 1.0 * C.xx ;
  // x2 = x0 - 1.0 + 2.0 * C.xx ;
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;

// Permutations
  i = mod289(i); // Avoid truncation effects in permutation
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
    + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;

// Gradients: 41 points uniformly over a line, mapped onto a diamond.
// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

// Normalise gradients implicitly by scaling m
// Approximation of: m *= inversesqrt( a0*a0 + h*h );
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );

// Compute final noise value at P
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}
`,yze=`
#ifdef ASPECT_CORRECTION
	uniform float scale;
#else
	uniform mat3 uvTransform;
#endif

varying vec2 vUv2;

void mainSupport(const in vec2 uv) {
	#ifdef ASPECT_CORRECTION
		vUv2 = uv * vec2(aspect, 1.0) * scale;
	#else
		vUv2 = (uvTransform * vec3(uv, 1.0)).xy;
	#endif
}
`,bze=`
uniform float viewheight;
uniform sampler2D splat;

${gze}
${vze}
${_ze}
${mze}

float rectdistance(vec2 uv) {
  vec2 tl = vec2(-1.0);
  vec2 br = vec2(1.0);
  vec2 d = max(tl - uv, uv - br);
  return abs(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)));
}

vec2 bendy(const in vec2 xn, float dn, float sn) {
  // config
  float distortion = 0.0173 + dn; // 0.0173, 0.511
  float scale = 0.991 + sn; // 1.0, 0.7
  // calc
  vec3 xDistorted = vec3((1.0 + vec2(distortion, distortion) * dot(xn, xn)) * xn, 1.0);
  mat3 kk = mat3(
    vec3(1.0, 0.0, 0.0),
    vec3(0.0, 1.0, 0.0),
    vec3(0.0, 0.0, 1.0)
  );
  return (kk * xDistorted).xy * scale;
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
	#ifdef UV_TRANSFORM
		vec4 bright = texture2D(splat, vUv2);
		vec4 dark = texture2D(splat, 1.0 - vUv2);
	#else
		vec4 bright = texture2D(splat, uv);
		vec4 dark = texture2D(splat, 1.0 - uv);
	#endif
  
  float n = 0.1 * snoise(uv.st * 200.0); // Fractal noise
  n += 0.05 * snoise(uv.st * 400.0);
  n += 0.025 * snoise(uv.st * 800.0);

  vec2 xn = 2.0 * (uv.st - 0.5);
  float fz = 0.005;
  vec2 edge = bendy(xn, fz * n, -fz * n);
  vec2 bent = edge.xy * 0.5 + 0.5;
  
  float dx = rectdistance(xn);
  float bx = rectdistance(edge);

  // apply shape
  float doot = max(abs(edge.x), abs(edge.y));
  if (doot < 1.0) {
    // display
    outputColor = texture2D(inputBuffer, bent);

    // apply scratches
    outputColor.rgb = blendLighten(outputColor.rgb, bright.rgb, 0.079);
    outputColor.rgb = blendDarken(outputColor.rgb, dark.rgb, 0.0666);

    // apply halftones
    outputColor.rgb = halftone(outputColor.rgb, uv.st);
  
  } else if (doot > 1.004) {
    // display shell
    // rbgb 205 205 193
    vec3 matte = vec3(205.0 / 255.0, 205.0 / 255.0, 193.0 / 255.0);
    vec3 dkmatte = mix(matte, vec3(0.0), 0.5);
    float mx = pow(1.0 - bx, 16.0) + n;
    outputColor = vec4(mix(matte, dkmatte, mx), inputColor.a);

  } else {
    // border
    outputColor = vec4(mix(vec3(0.0), outputColor.rgb, 0.5), inputColor.a);
  }

  // apply inner shade
  if (doot >= 0.5 && doot < 1.0) {
    float sh = clamp(0.0, 1.0, 1.0 - bx - 0.7);
    vec3 shade = mix(outputColor.rgb, vec3(0.0), pow(sh, 4.0));
    outputColor = vec4(shade, inputColor.a);
  }

  // apply outer shade
  if (doot >= 0.97) {
    float sh = clamp(0.0, 1.0, bx * 24.0);
    vec3 dkout = mix(vec3(0.0), outputColor.rgb, 0.81);
    vec3 shade = mix(dkout, outputColor.rgb, sh);
    outputColor = vec4(shade, inputColor.a);
  }
}
`;class Eze extends uF{constructor({splat:e,viewheight:n}={}){super("CRTShapeEffect",bze,{blendFunction:pi.NORMAL,attributes:mp.CONVOLUTION,defines:new Map([["TEXEL","texel"],["TEXTURE_PRECISION_HIGH","1"]]),uniforms:new Map([["splat",new Wi(e)],["viewheight",new Wi(n??128)]])})}get splat(){var e;return(e=this.uniforms.get("splat"))==null?void 0:e.value}set splat(e){const{splat:n,uniforms:r,defines:i}=this,s=r.get("splat"),o=r.get("uvTransform");n!==e&&s&&o&&(s.value=e,o.value=e.matrix,i.delete("TEXTURE_PRECISION_HIGH"),e!==null&&(e.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(yze)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==Yc&&i.set("TEXTURE_PRECISION_HIGH","1"),(n===null||(n==null?void 0:n.type)!==e.type)&&this.setChanged()))}getTexture(){return this.splat}setTexture(e){this.splat=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){const e=this.splat;return!!(e!=null&&e.matrixAutoUpdate)}set uvTransform(e){const n=this.splat;he(n)&&(n.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,n=e,r=e,i=e){const s="rgba";let o="";(e!==iC.RED||n!==iC.GREEN||r!==iC.BLUE||i!==iC.ALPHA)&&(o=[".",s[e],s[n],s[r],s[i]].join("")),this.defines.set("TEXEL","texel"+o),this.setChanged()}update(){var e;(e=this.splat)!=null&&e.matrixAutoUpdate&&this.splat.updateMatrix()}}const Sze=tze(Eze),Tze="data:image/gif;base64,R0lGODdhQAAgALMAAIuVpAgMEKy6xRgkIEFQUmJxe73GzZyltDFEWgAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQICgAAACwAAAAAQAAgAAAE/zDISc9EpSAhENBZhmAIQYwFcWgnEojEFFP0VNSupB1nYCCHTypVynBWgFNBGFxpajZoSSANYEyhAhIxCGFDJJDpZDDlrNAaAK2jGK/awUG+4mUIybG2VIoZJDlnaRdRgIQ9S0YEAklEGAUdjU9WGQEzhoM0k5c6lxoAADw8cosrZWEeMwaVnVCcmRN/N5SgH3x1lkB8LwQaIzEWAQOwxDI2JaAjljezRZR/nDkmxS8UgWezay4YazNnPAB8JS8CMdI3f9LUaRszkil/AsE3wC83LimWmuvsULPVgxAYYHSFEEBr/Cj0SHPHoJVeGk4dwCDhVcJ+xNQZEgTtoscAVIL0HXQI0NNHYvQqvpr1r+I2LOZqsNLxh5+gTEu2gZTRy8rNdRZPsnnSJ4YZoRd/4jjWoSLSi0FF7sOh9OkafySLVf1XNVNUrf66Pp1Kw5vQrwmvArokdixSQS3ZuB37aK4ruzPQIo3rMZpTu4AxtQk8dxphvX3HZSUsNAnjwBQNM44AADs=",RD=t=>t===Object(t)&&!Array.isArray(t)&&typeof t!="function";function J4(t,e){const{gl:n}=lS(),r=xw(nB,RD(t)?Object.values(t):t);return ft.useLayoutEffect(()=>{e==null||e(r)},[e,r]),ft.useEffect(()=>{if("initTexture"in n){let s=[];Array.isArray(r)?s=r:r instanceof So?s=[r]:RD(r)&&(s=Object.values(r)),s.forEach(o=>{o instanceof So&&n.initTexture(o)})}},[n,r]),ft.useMemo(()=>{if(RD(t)){const s={};let o=0;for(const a in t)s[a]=r[o++];return s}else return r},[t,r])}J4.preload=t=>xw.preload(nB,t);J4.clear=t=>xw.clear(nB,t);function U8(t){const e=ft.useRef();return n=>{const r=t(n);return(e.current===void 0||r===void 0?e.current===r:pT(e.current,r))?e.current:e.current=r}}const og=I_(()=>({desync:!1,gadget:{id:"",layers:[],scroll:[],sidebar:[]}}));var QC=(t=>(t[t.OFF=0]="OFF",t[t.INFO=1]="INFO",t[t.DEBUG=2]="DEBUG",t))(QC||{});const F8=128;var zu=(t=>(t[t.TOP=0]="TOP",t[t.FULL=1]="FULL",t[t.BOTTOM=2]="BOTTOM",t[t.SPLIT_Y=3]="SPLIT_Y",t[t.SPLIT_Y_ALT=4]="SPLIT_Y_ALT",t[t.MAX=5]="MAX",t))(zu||{});const Us=I_(()=>({layout:0,inspector:WU(),quickterminal:!1,terminal:{open:!0,level:1,logs:[]},editor:{open:!1,player:"",book:"",path:[],type:"",title:""}})),sa=I_(()=>({scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""]})),No=I_(()=>({id:"",xscroll:0,yscroll:0,cursor:0,select:void 0})),Eb=I_(()=>({cursor:void 0,select:void 0})),wze=new ht,IZ=ft.createContext([]);function uN(){return ft.useContext(IZ)}function xze({width:t=0,height:e=0,children:n,...r}){const i=ft.useRef(null),[s]=ft.useState(()=>{const a=[];return t&&a.push(new Rh,new Rh),e&&a.push(new Rh,new Rh),a}),[o]=ft.useState(()=>[new ht(0,0,0),new ht(0,0,0),new ht(0,0,0),new ht(0,0,0),new ht(0,0,0)]);return ww(()=>{if(i.current){const a=i.current.localToWorld(o[0].set(0,0,0)),c=[];if(t){const l=t*.5;c.push(i.current.localToWorld(o[3].set(l,0,0)),i.current.localToWorld(o[4].set(-l,0,0)))}if(e){const l=e*.5;c.push(i.current.localToWorld(o[1].set(0,l,0)),i.current.localToWorld(o[2].set(0,-l,0)))}for(let l=0;l<s.length;l+=1)s[l].setFromNormalAndCoplanarPoint(wze.subVectors(a,c[l]).normalize(),c[l])}}),De.jsx(IZ.Provider,{value:s,children:De.jsx("group",{position:[t*.5,e*.5,0],children:De.jsx("group",{ref:i,...r,children:De.jsx("group",{position:[t*-.5,e*-.5,0],children:n})})})})}const B8=t=>Symbol.iterator in t,j8=t=>"entries"in t,$8=(t,e)=>{const n=t instanceof Map?t:new Map(t.entries()),r=e instanceof Map?e:new Map(e.entries());if(n.size!==r.size)return!1;for(const[i,s]of n)if(!Object.is(s,r.get(i)))return!1;return!0},Cze=(t,e)=>{const n=t[Symbol.iterator](),r=e[Symbol.iterator]();let i=n.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=n.next(),s=r.next()}return!!i.done&&!!s.done};function Rze(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!B8(t)||!B8(e)?$8({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):j8(t)&&j8(e)?$8(t,e):Cze(t,e)}function Rp(t){const e=Fh.useRef();return n=>{const r=t(n);return Rze(e.current,r)?e.current:e.current=r}}function Aze(t,e,n,r){const i=e*n*4;for(let s=0,o=0;s<i;++o)t.image.data[s]=r[o]*255,s+=4;return t.needsUpdate=!0,t}function Mze(t,e){const n=new Uint8Array(4*t*e);return new pW(n,t,e)}const Ize=new Il({transparent:!1,uniforms:{color:{value:new Ei(0,0,0)},data:{value:null}},vertexShader:`
      #include <clipping_planes_pars_vertex>
  
      varying vec2 vUv;
    
      void main() {
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * mvPosition;
        
        vUv = uv;
        
        #include <clipping_planes_vertex>
      }
    `,fragmentShader:`
      #include <clipping_planes_pars_fragment>
  
      uniform vec3 color;
      uniform sampler2D data;
  
      varying vec2 vUv;

      // adapted from https://www.shadertoy.com/view/Mlt3z8
      float bayerDither2x2( vec2 v ) {
        return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
      }

      float bayerDither4x4( vec2 v ) {
        vec2 P1 = mod( v, 2.0 );
        vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
        return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
      }

      void main() {
        #include <clipping_planes_fragment>
  
        float alpha = texture2D(data, vUv).r;
        if (alpha < 1.0) {
          vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
          if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
            discard;
          }
        }

        gl_FragColor.rgba = vec4(color.xyz, 1.0);
      }
    `});function Oze(){return Y4(Ize)}const RA=[0,1,0],OZ=[1,1,0],AA=[1,0,0],kZ=[0,0,0],kze=new Float32Array([...RA,...AA,...OZ,...RA,...kZ,...AA]),Nze=new Float32Array([...RA.slice(0,2),...AA.slice(0,2),...OZ.slice(0,2),...RA.slice(0,2),...kZ.slice(0,2),...AA.slice(0,2)]);function Pze(t,e,n,r,i,s){const o=e*n*4;for(let a=0,c=0;a<o;++c){const l=r[c]??0;t.image.data[a++]=l%kd,t.image.data[a++]=Math.floor(l/kd),t.image.data[a++]=i[c]??16,t.image.data[a++]=s[c]??16}return t.needsUpdate=!0,t}function Dze(t,e){const n=new Uint8Array(4*t*e),r=new pW(n,t,e,JA,Yc);return r.internalFormat="RGBA8UI",r}function NZ(t,e,n){const r=e*ar.DRAW_CHAR_WIDTH(),i=n*ar.DRAW_CHAR_HEIGHT(),s=kze.map((o,a)=>{switch(a%3){case 0:return o*r;case 1:return o*i;default:return o}});t.setAttribute("position",new oo(s,3)),t.setAttribute("uv",new oo(Nze,2)),t.computeBoundingBox(),t.computeBoundingSphere()}const Lze=QR(Fw(aM)),H8=yT(Bw(oM)),Uze=new Il({transparent:!1,uniforms:{time:Ch,interval:K4,palette:new Wi(Lze),map:new Wi(H8),alt:new Wi(H8),data:new Wi(null),size:{value:new Vn},step:{value:new Vn}},vertexShader:`
    #include <clipping_planes_pars_vertex>
    varying vec2 vUv;
    void main() {
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      gl_Position = projectionMatrix * mvPosition;
      vUv = uv;
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform usampler2D data;
    uniform vec3 palette[16];
    uniform vec2 size;
    uniform vec2 step;
    varying vec2 vUv;

    void main() {
      #include <clipping_planes_fragment>

      uvec4 tiledata = texture(data, vUv);
      int colori = int(tiledata.z);
      int bgi = int(tiledata.w);

      vec2 charPosition = mod(vUv, size) / size;
      vec2 uv = vec2(charPosition.x * step.x, charPosition.y * step.y);
      vec3 color = palette[colori];

      uv.x += step.x * float(tiledata.x);
      uv.y += step.y * float(tiledata.y);
      uv.y = 1.0 - uv.y;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Tr.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function Fze(){return Y4(Uze)}function dN({width:t,height:e,alphas:n}){const r=uN(),i=ft.useRef(null),[s]=ft.useState(()=>Oze());return ft.useEffect(()=>{s.uniforms.data.value=Mze(t,e)},[s.uniforms.data,t,e]),ft.useEffect(()=>{Aze(s.uniforms.data.value,t,e,n)},[s.uniforms.data.value,t,e,n]),ft.useEffect(()=>{i.current&&(NZ(i.current,t,e),s.clipping=r.length>0,s.clippingPlanes=r,s.needsUpdate=!0)},[s,r,t,e]),De.jsx("mesh",{material:s,children:De.jsx("bufferGeometry",{ref:i})})}function Bze({width:t,height:e,alpha:n}){const r=ft.useMemo(()=>new Array(t*e).fill(n),[t,e,n]);return De.jsx(dN,{width:t,height:e,alphas:r})}const qS=new qle,m0=new Vn;function MA({width:t,height:e,top:n,left:r,right:i,bottom:s,scale:o=.125,alpha:a=.25}){const c=ft.useMemo(()=>{const l=new Array(t*e);qS.min.x=r,qS.min.y=n,qS.max.x=i,qS.max.y=s,m0.x=0,m0.y=0;for(let u=0;u<l.length;++u)l[u]=wie.smootherstep(1-qS.distanceToPoint(m0)*o,0,1)*a,++m0.x,m0.x>=t&&(m0.x=0,++m0.y);return l},[t,e,n,r,i,s,o,a]);return De.jsx(dN,{width:t,height:e,alphas:c})}const jze=Z9,$ze=QR(Fw(aM)),V8=yT(Bw(oM)),Hze=new Il({transparent:!1,uniforms:{time:Ch,interval:K4,smoothrate:new Wi(jze),palette:new Wi($ze),map:new Wi(V8),alt:new Wi(V8),dpr:new Wi(1),pointSize:{value:new Vn(1,1)},rows:new Wi(1),step:new Wi(new Vn)},vertexShader:`
    #include <clipping_planes_pars_vertex>

    attribute float visible;
    attribute vec4 charData;
    attribute vec3 lastPosition;
    attribute vec2 lastColor;
    attribute vec2 lastBg;
    attribute vec2 animShake;
    attribute vec2 animBounce;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float tindex;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    float rand(float co) {
      return fract(sin(co*(91.3458)) * 47453.5453);
    }

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    void main() {
      vVisible = visible;

      float deltaPosition = clamp((time - lastPosition.z) * smoothrate, 0.0, 1.0);
      vec2 animPosition = mix(lastPosition.xy, position.xy, deltaPosition);

      float deltaShake = 1.0 - animDelta(animShake.y, smoothrate * 0.5, 1.0); 
      animPosition += vec2(
        deltaShake - rand(cos(time) + animShake.x) * deltaShake * 2.0,
        deltaShake - rand(sin(time) + animShake.x) * deltaShake * 2.0
      ) * 0.5;

      float deltaBounce = 1.0 - abs(1.0 - animDelta(animBounce.y, smoothrate, 2.0));
      animPosition.y -= smoothstep(0.0, 1.0, deltaBounce);

      float deltaColor = animDelta(lastColor.y, smoothrate, 1.0);
      vec3 sourceColor = colorFromIndex(lastColor.x);
      vec3 destColor = colorFromIndex(charData.z);
      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastBg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastBg.x);
      vec4 destBg = bgFromIndex(charData.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      vCharData.xy = charData.xy;

      animPosition = animPosition * pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x += (pointSize.y - pointSize.x) * 0.5;

      vec4 mvPosition = modelViewMatrix * vec4(animPosition, 0.0, 1.0);
      gl_Position = projectionMatrix * mvPosition;      

      // this handles things being scaled
      gl_PointSize = pointSize.y * modelViewMatrix[0][0] * dpr;
      
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 pointSize;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      #include <clipping_planes_fragment>

      float xscale = pointSize.y / pointSize.x;
      float px = gl_PointCoord.x * xscale;
      
      if (vVisible == 0.0 || px >= 1.0) {
        discard;
      }

      vec2 lookup = vec2(vCharData.x, vCharData.y);

      vec2 idx = vec2(px, 1.0 - gl_PointCoord.y);
      vec2 char = vec2(lookup.x * step.x, (rows - lookup.y) * step.y);
      vec2 uv = idx * step + char;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 1.0) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function Vze(){return Y4(Hze)}const z8=2048;function zze({sprites:t}){const e=j0(u=>u.palettedata),n=j0(u=>u.charsetdata),r=j0(u=>u.altcharsetdata),i=uN(),s=ft.useRef(null),o=ft.useRef([]),[a]=ft.useState(()=>Vze()),{width:c=0,height:l=0}=(n==null?void 0:n.image)??{};return ft.useMemo(()=>{var p;o.current.length===0&&(o.current=Array.from({length:z8},()=>({id:"",x:0,y:0,char:0,color:0,bg:0})));const u={};for(let f=0;f<t.length;++f)u[t[f].id]=t[f];const d=new Set(o.current.map(f=>f.id));let h=0;for(let f=0;f<z8;++f)if(o.current[f].id){const g=u[o.current[f].id];he(g)?o.current[f]={...g}:o.current[f].id=""}else if(h<t.length){for(;d.has((p=t[h])==null?void 0:p.id)===!0;)++h;h<t.length&&(o.current[f]={...t[h++]})}},[t]),ft.useEffect(()=>{const{current:u}=s,{current:d}=o;if(!u||!d)return;let h=u.getAttribute("visible"),p=u.getAttribute("lastVisible"),f=u.getAttribute("position"),g=u.getAttribute("charData"),y=u.getAttribute("lastPosition"),E=u.getAttribute("lastColor"),w=u.getAttribute("lastBg"),R=u.getAttribute("animShake"),A=u.getAttribute("animBounce");if(!h||h.count!==d.length){h=new oo(new Float32Array(d.length),1),p=new oo(new Float32Array(d.length),1),f=new oo(new Float32Array(d.length*3),3),g=new oo(new Float32Array(d.length*4),4),y=new oo(new Float32Array(d.length*3),3),E=new oo(new Float32Array(d.length*2),2),w=new oo(new Float32Array(d.length*2),2),R=new oo(new Float32Array(d.length*2),2),A=new oo(new Float32Array(d.length*2),2);for(let k=0;k<d.length;++k){const I=d[k],N=I.id?1:0;h.setX(k,N),p.setX(k,N),f.setXY(k,I.x,I.y),g.setXYZW(k,I.char%kd,Math.floor(I.char/kd),I.color,I.bg),y.setXYZ(k,I.x,I.y,Ch.value),E.setXY(k,I.color,Ch.value),w.setXY(k,I.bg,Ch.value),R.setXY(k,0,Ch.value-1e6),A.setXY(k,0,Ch.value-1e6)}u.setAttribute("visible",h),u.setAttribute("lastVisible",p),u.setAttribute("position",f),u.setAttribute("charData",g),u.setAttribute("lastPosition",y),u.setAttribute("lastColor",E),u.setAttribute("lastBg",w),u.setAttribute("animShake",R),u.setAttribute("animBounce",A)}else for(let k=0;k<d.length;++k){const I=d[k],N=f.getX(k),U=f.getY(k),F=g.getX(k),$=g.getY(k),q=g.getZ(k),K=g.getW(k);p.setX(k,h.getX(k)),p.needsUpdate=!0,h.setX(k,I.id?1:0),h.needsUpdate=!0;const W=p.getX(k)===0&&h.getX(k)===1;(W||N!==I.x||U!==I.y)&&(y.setXYZ(k,W?I.x:N,W?I.y:U,Ch.value),y.needsUpdate=!0,f.setXY(k,I.x,I.y),f.needsUpdate=!0),(W||q!==I.color)&&(E.setXY(k,W?I.color:q,Ch.value),E.needsUpdate=!0,g.setZ(k,I.color),g.needsUpdate=!0),(W||K!==I.bg)&&(w.setXY(k,W?I.bg:K,Ch.value),w.needsUpdate=!0,g.setW(k,I.bg),g.needsUpdate=!0);const X=I.char%kd,ne=Math.floor(I.char/kd);(F!==X||$!==ne)&&(g.setXY(k,X,ne),g.needsUpdate=!0)}u.computeBoundingBox(),u.computeBoundingSphere()},[t]),ft.useEffect(()=>{if(!n||!s.current)return;const u=Math.round(c/Kv),d=Math.round(l/Yv);a.uniforms.palette.value=e,a.uniforms.map.value=n,a.uniforms.alt.value=r??n,a.uniforms.dpr.value=window.devicePixelRatio,a.uniforms.pointSize.value.x=ar.DRAW_CHAR_WIDTH(),a.uniforms.pointSize.value.y=ar.DRAW_CHAR_HEIGHT(),a.uniforms.rows.value=d-1,a.uniforms.step.value.x=1/u,a.uniforms.step.value.y=1/d,a.clipping=i.length>0,a.clippingPlanes=i,a.needsUpdate=!0},[e,n,r,a,c,l,i]),De.jsx("points",{frustumCulled:!1,material:a,children:De.jsx("bufferGeometry",{ref:s})})}function PZ({width:t,height:e,char:n,color:r,bg:i}){const s=j0(p=>p.palettedata),o=j0(p=>p.charsetdata),a=j0(p=>p.altcharsetdata),c=uN(),[l]=ft.useState(()=>Fze()),u=ft.useRef(null),{width:d=0,height:h=0}=(o==null?void 0:o.image)??{};return ft.useEffect(()=>{t===0||e===0||(l.uniforms.data.value=Dze(t,e))},[l.uniforms.data,t,e]),ft.useEffect(()=>{t===0||e===0||Pze(l.uniforms.data.value,t,e,n,r,i)},[l.uniforms.data.value,t,e,n,r,i]),ft.useEffect(()=>{t===0||e===0||!u.current||!o||(NZ(u.current,t,e),l.uniforms.map.value=o,l.uniforms.alt.value=a??o,l.uniforms.palette.value=s,l.uniforms.size.value.x=1/t,l.uniforms.size.value.y=1/e,l.uniforms.step.value.x=1/Math.round(d/Kv),l.uniforms.step.value.y=1/Math.round(h/Yv),l.clipping=c.length>0,l.clippingPlanes=c,l.needsUpdate=!0)},[s,o,a,l,t,e,d,h,c]),De.jsx("mesh",{material:l,children:De.jsx("bufferGeometry",{ref:u})})}function Gze({id:t,z:e}){const n=j0(),r=og(Rp(s=>{var o;return(o=s.gadget.layers)==null?void 0:o.find(a=>a.id===t)})),i=(r==null?void 0:r.type)===b0.MEDIA?r:void 0;switch(ft.useEffect(()=>{switch(i==null?void 0:i.mime){case"image/palette":qr(i.media)&&n.setpalette(MP(IE,y9,i.media));break;case"image/charset":qr(i.media)&&n.setcharset(MP(kd*Kv,k2*Yv,i.media));break;case"image/altcharset":qr(i.media)&&n.setaltcharset(MP(kd*Kv,k2*Yv,i.media));break}},[n,i]),r==null?void 0:r.type){default:case b0.BLANK:case b0.MEDIA:return null;case b0.TILES:return De.jsx("group",{position:[0,0,e],children:De.jsx(PZ,{width:r.width,height:r.height,char:[...r.char],color:[...r.color],bg:[...r.bg]})},r.id);case b0.SPRITES:return De.jsx("group",{position:[0,0,e],children:De.jsx(zze,{sprites:[...r.sprites]})},r.id);case b0.DITHER:return De.jsx("group",{position:[0,0,e],children:De.jsx(dN,{width:r.width,height:r.height,alphas:[...r.alphas]})},r.id)}}function G8(){}const Wze=Fh.forwardRef(function({args:e,children:n,...r},i){const s=Fh.useRef(null);return Fh.useImperativeHandle(i,()=>s.current),De.jsxs("mesh",{ref:s,...r,children:[De.jsx("planeGeometry",{attach:"geometry",args:e}),n]})}),Ku=Fh.forwardRef(function({blocking:e=!1,cursor:n="default",x:r=0,y:i=0,z:s=0,width:o=1,height:a=1,opacity:c=1,visible:l=!0,color:u="white",...d},h){const p=o*.5,f=a*.5,g=[(r+p)*ar.DRAW_CHAR_WIDTH(),(i+f)*ar.DRAW_CHAR_HEIGHT(),s],y=uN();return De.jsx(Wze,{ref:h,args:[o*ar.DRAW_CHAR_WIDTH(),a*ar.DRAW_CHAR_HEIGHT()],userData:{blocking:e,cursor:n,clippingPlanes:y},onClick:e?G8:void 0,onPointerMove:e?G8:void 0,position:g,...d,children:De.jsx("meshBasicMaterial",{color:u,opacity:c,visible:l,transparent:c!==1,clippingPlanes:y})})}),IA=new ht;function W8(){const t=ar.DRAW_CHAR_WIDTH(),e=ar.DRAW_CHAR_HEIGHT(),n=Math.floor(IA.x/t),r=Math.floor((IA.y+e*.5)/e);return{x:n,y:kl*.5+r}}function qze(){const t=Us(u=>u.inspector),[e,n]=Eb(Rp(u=>[u.cursor,u.select])),r=_5(e??0,ns),i=_5(n??e??0,ns),s={x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},o={x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)},a=o.x-s.x+1,c=o.y-s.y+1;function l(){Eb.getState().cursor&&Fde(qe,s,o,Ni()),Eb.setState(()=>({cursor:void 0,select:void 0}))}return De.jsxs(De.Fragment,{children:[t?De.jsx(Ku,{visible:!0,x:0,y:0,z:-1,width:ns,height:kl,color:"black",cursor:"pointer",onPointerDown:u=>{u.intersections[0].object.worldToLocal(IA.copy(u.intersections[0].point));const d=W8();Eb.setState(()=>({cursor:LT(d,ns)}))},onPointerMove:u=>{if(he(Eb.getState().cursor)){u.intersections[0].object.worldToLocal(IA.copy(u.intersections[0].point));const d=W8();Eb.setState(()=>({select:LT(d,ns)}))}},onPointerUp:l,onPointerOut:l,onPointerCancel:l}):De.jsx(Ku,{visible:!0,x:0,y:0,z:-1,width:ns,height:kl,color:"black"}),he(e)&&De.jsxs(De.Fragment,{children:[De.jsx(Ku,{x:s.x+.25,y:s.y+.25,z:100,width:a-.5,height:c-.5,color:"black",opacity:.3}),De.jsx(Ku,{x:s.x,y:s.y,z:101,width:a,height:c,color:"white",opacity:.25})]})]})}var Q4={};Object.defineProperty(Q4,"__esModule",{value:!0});var DZ=Q4.GamepadHelper=void 0;const ro=class ro{static getButtonValue(e,n){var r,i;return(i=(r=ro.gamepads[e])==null?void 0:r.buttons[n])==null?void 0:i.value}static getAxisValue(e,n){var r;return(r=ro.gamepads[e])==null?void 0:r.axes[n]}static update(){ro.checkForNewGamepads(),!(!ro.gamepads||Object.keys(ro.gamepads).length<1)&&(ro.gamepadsLastUpdate&&Object.keys(ro.gamepadsLastUpdate).length>0&&Object.values(ro.gamepads).forEach(e=>{var n;for(let r=0;r<e.buttons.length;r++){const i=(n=ro.gamepadsLastUpdate[e.index])==null?void 0:n.buttons[r],s=e.buttons[r];(s==null?void 0:s.value)==1&&(i==null?void 0:i.value)==0?ro.dispatchButtonDownEvent(e.index,r):(s==null?void 0:s.value)==0&&(i==null?void 0:i.value)==1&&ro.dispatchButtonUpEvent(e.index,r)}}),ro.gamepadsLastUpdate=Object.assign({},ro.gamepads))}static checkForNewGamepads(){const e=navigator.getGamepads();for(const n of e)n&&(ro.gamepads[n.index]||ro.logOutput&&console.log("gamepad "+n.index+" connected"),ro.gamepads[n.index]=n)}static dispatchButtonDownEvent(e,n){ro.logOutput&&console.log(`gamepad ${e}: button ${n} is down`),document.dispatchEvent(new CustomEvent("gamepadbuttondown",{detail:{gamepad:e,button:n}}))}static dispatchButtonUpEvent(e,n){ro.logOutput&&console.log(`gamepad ${e}: button ${n} is up`),document.dispatchEvent(new CustomEvent("gamepadbuttonup",{detail:{gamepad:e,button:n}}))}};Gn(ro,"gamepads",{}),Gn(ro,"gamepadsLastUpdate"),Gn(ro,"logOutput",!1);let hF=ro;DZ=Q4.GamepadHelper=hF;var Ng={};Object.defineProperty(Ng,"__esModule",{value:!0});var Kze=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),AD={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},LZ={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:Kze?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},Z4={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(var sC=1;sC<20;sC++)Z4["f"+sC]=111+sC;function hN(t,e,n){e&&!("byKey"in e)&&(n=e,e=null),Array.isArray(t)||(t=[t]);var r=t.map(function(o){return UZ(o,e)}),i=function(a){return r.some(function(c){return FZ(c,a)})},s=n==null?i:i(n);return s}function Yze(t,e){return hN(t,e)}function Xze(t,e){return hN(t,{byKey:!0},e)}function UZ(t,e){var n=e&&e.byKey,r={};t=t.replace("++","+add");var i=t.split("+"),s=i.length;for(var o in AD)r[AD[o]]=!1;var a=!0,c=!1,l=void 0;try{for(var u=i[Symbol.iterator](),d;!(a=(d=u.next()).done);a=!0){var h=d.value,p=h.endsWith("?")&&h.length>1;p&&(h=h.slice(0,-1));var f=ej(h),g=AD[f];if(h.length>1&&!g&&!LZ[h]&&!Z4[f])throw new TypeError('Unknown modifier: "'+h+'"');(s===1||!g)&&(n?r.key=f:r.which=BZ(h)),g&&(r[g]=p?null:!0)}}catch(y){c=!0,l=y}finally{try{!a&&u.return&&u.return()}finally{if(c)throw l}}return r}function FZ(t,e){for(var n in t){var r=t[n],i=void 0;if(r!=null&&(n==="key"&&e.key!=null?i=e.key.toLowerCase():n==="which"?i=r===91&&e.which===93?91:e.which:i=e[n],!(i==null&&r===!1)&&i!==r))return!1}return!0}function BZ(t){t=ej(t);var e=Z4[t]||t.toUpperCase().charCodeAt(0);return e}function ej(t){return t=t.toLowerCase(),t=LZ[t]||t,t}var Jze=Ng.default=hN;Ng.isHotkey=hN;Ng.isCodeHotkey=Yze;Ng.isKeyHotkey=Xze;Ng.parseHotkey=UZ;Ng.compareHotkey=FZ;Ng.toKeyCode=BZ;Ng.toKeyName=ej;function jZ(t){return{all:t=t||new Map,on:function(e,n){var r=t.get(e);r?r.push(n):t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&(n?r.splice(r.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var r=t.get(e);r&&r.slice().map(function(i){i(n)}),(r=t.get("*"))&&r.slice().map(function(i){i(e,n)})}}}const op={[Kt.NONE]:!1,[Kt.ALT]:!1,[Kt.CTRL]:!1,[Kt.SHIFT]:!1,[Kt.MOVE_UP]:!1,[Kt.MOVE_DOWN]:!1,[Kt.MOVE_LEFT]:!1,[Kt.MOVE_RIGHT]:!1,[Kt.OK_BUTTON]:!1,[Kt.CANCEL_BUTTON]:!1,[Kt.MENU_BUTTON]:!1};let ZC=0,q8=performance.now();const dw=200;function $Z(){const t=performance.now(),e=t-q8;if(ZC+=e,ZC>=dw){ZC%=dw;const n={alt:!!op[Kt.ALT],ctrl:!!op[Kt.CTRL],shift:!!op[Kt.SHIFT]};[Kt.MOVE_UP,Kt.MOVE_DOWN,Kt.MOVE_LEFT,Kt.MOVE_RIGHT,Kt.OK_BUTTON,Kt.CANCEL_BUTTON,Kt.MENU_BUTTON].forEach(i=>{op[i]&&VZ(i,n)})}q8=t,DZ.update(),setTimeout($Z,100)}$Z();function wl(t){op[t]||(ZC=0,VZ(t,{alt:op[Kt.ALT],ctrl:op[Kt.CTRL],shift:op[Kt.SHIFT]})),op[t]=!0}function Aa(t){op[t]=!1}const tp={root:jZ(),ignorehotkeys:!1},HZ=ft.createContext(tp.root);function fN(t){return{alt:t.altKey,ctrl:Xw?t.metaKey:t.ctrlKey,shift:t.shiftKey}}function VZ(t,e){tp.root.emit(Kt[t],e)}document.addEventListener("keydown",t=>{const e=rr(t.key),n=fN(t);switch(e){case"p":case"s":case"arrowleft":case"arrowright":case"arrowup":case"arrowdown":n.ctrl&&t.preventDefault();break;case"tab":t.preventDefault();break}switch(n.alt?wl(Kt.ALT):Aa(Kt.ALT),n.ctrl?wl(Kt.CTRL):Aa(Kt.CTRL),n.shift?wl(Kt.SHIFT):Aa(Kt.SHIFT),e){case"arrowleft":wl(Kt.MOVE_LEFT);break;case"arrowright":wl(Kt.MOVE_RIGHT);break;case"arrowup":wl(Kt.MOVE_UP);break;case"arrowdown":wl(Kt.MOVE_DOWN);break;case"enter":wl(Kt.OK_BUTTON);break;case"esc":case"escape":wl(Kt.CANCEL_BUTTON);break;case"tab":wl(Kt.MENU_BUTTON);break;case"s":n.ctrl&&Cw(qe,"#save",Ni());break}tp.root.emit("keydown",t)},{capture:!0});document.addEventListener("keyup",t=>{const e=rr(t.key),n=fN(t);switch(n.alt?wl(Kt.ALT):Aa(Kt.ALT),n.ctrl?wl(Kt.CTRL):Aa(Kt.CTRL),n.shift?wl(Kt.SHIFT):Aa(Kt.SHIFT),e){case"meta":Aa(Kt.MOVE_LEFT),Aa(Kt.MOVE_RIGHT),Aa(Kt.MOVE_UP),Aa(Kt.MOVE_DOWN);break;case"arrowleft":Aa(Kt.MOVE_LEFT);break;case"arrowright":Aa(Kt.MOVE_RIGHT);break;case"arrowup":Aa(Kt.MOVE_UP);break;case"arrowdown":Aa(Kt.MOVE_DOWN);break;case"enter":Aa(Kt.OK_BUTTON);break;case"esc":case"escape":Aa(Kt.CANCEL_BUTTON);break;case"tab":Aa(Kt.MENU_BUTTON);break}},{capture:!0});Xh("userinput",["tock"],t=>{switch(t.target){case"up":Mn(t.data)&&Aa(t.data);break;case"down":Mn(t.data)&&wl(t.data);break}});const Qze=0,Zze=1,eGe=2,tGe=3,nGe=4,rGe=5,iGe=6,sGe=7,oGe=9,aGe=12,cGe=13,lGe=14,uGe=15,zZ={[Qze]:Kt.OK_BUTTON,[Zze]:Kt.CANCEL_BUTTON,[eGe]:Kt.OK_BUTTON,[tGe]:Kt.CANCEL_BUTTON,[nGe]:Kt.ALT,[rGe]:Kt.CTRL,[iGe]:Kt.SHIFT,[sGe]:Kt.SHIFT,[oGe]:Kt.MENU_BUTTON,[aGe]:Kt.MOVE_UP,[cGe]:Kt.MOVE_DOWN,[lGe]:Kt.MOVE_LEFT,[uGe]:Kt.MOVE_RIGHT};document.addEventListener("gamepadbuttondown",t=>{wl(zZ[t.detail.button])});document.addEventListener("gamepadbuttonup",t=>{Aa(zZ[t.detail.button])});const K8="keyup";function pE({hotkey:t,children:e}){return ft.useEffect(()=>{const n=Jze(t,{byKey:!0});function r(i){tp.ignorehotkeys===!1&&n(i)&&e()}return document.addEventListener(K8,r,!1),()=>document.removeEventListener(K8,r,!1)},[t,e]),null}function da(t){const e=ft.useContext(HZ);return ft.useEffect(()=>{const n=Object.entries(t);return n.forEach(([r,i])=>e.on(r,i)),()=>{n.forEach(([r,i])=>e.off(r,i))}},[e,t]),null}function Oy({blockhotkeys:t,children:e}){const[n]=ft.useState(()=>jZ());return ft.useEffect(()=>{const r=tp.root,i=tp.ignorehotkeys;return tp.root=n,tp.ignorehotkeys=!!t,()=>{tp.root=r,tp.ignorehotkeys=i}},[n,t]),De.jsx(HZ.Provider,{value:n,children:e})}const dGe=new Vn(0,0);function g0(t,e,n){let r=0;n.alt&&(r|=b9),n.ctrl&&(r|=E9),n.shift&&(r|=S9),QW(t)&&Ude(qe,e,r,t)}function hGe({width:t,height:e}){const n=t*ar.DRAW_CHAR_WIDTH(),r=e*ar.DRAW_CHAR_HEIGHT(),i=ft.useRef(null);ww((a,c)=>{const{current:l}=i;if(!l)return;const u=Pye(og.getState().gadget.layers??[]),d=u.width*ar.DRAW_CHAR_WIDTH()*u.viewscale,h=d-n,p=u.height*ar.DRAW_CHAR_HEIGHT()*u.viewscale,f=p-r,g=Math.round(Math.min(n,r)*.3333),y=-u.focusx*ar.DRAW_CHAR_WIDTH()*u.viewscale,E=n*.5+y,w=-u.focusy*ar.DRAW_CHAR_HEIGHT()*u.viewscale,R=r*.5+w,A=d<n?h*-.5:E,k=p<r?f*-.5:R;if(he(l.userData.focus)||(l.position.x=A,l.position.y=k,l.userData.focus=dGe,l.userData.focus.x=A,l.userData.focus.y=k),l.scale.setScalar(u.viewscale),h<0)l.userData.focus.x=A;else{const N=l.position.x-A;if(Math.abs(N)>=g){const U=N<0?-g:g;l.userData.focus.x=Math.round(A-U)}}if(f<0)l.userData.focus.y=k;else{const N=l.position.y-k;if(Math.abs(N)>=g){const U=N<0?-g:g;l.userData.focus.y=Math.round(k-U*.5)}}const I=6;l.position.x+=(l.userData.focus.x-l.position.x)*c*I,l.position.y+=(l.userData.focus.y-l.position.y)*c*I,h>=0&&(l.position.x=Ci(l.position.x,-h,0)),f>=0&&(l.position.y=Ci(l.position.y,-f,0))});const s=Ni();og(a=>{var c;return((c=a.gadget.layers)==null?void 0:c.length)??0});const{layers:o=[]}=og.getState().gadget;return De.jsxs(De.Fragment,{children:[De.jsx(da,{MOVE_LEFT:a=>g0(s,Kt.MOVE_LEFT,a),MOVE_RIGHT:a=>g0(s,Kt.MOVE_RIGHT,a),MOVE_UP:a=>g0(s,Kt.MOVE_UP,a),MOVE_DOWN:a=>g0(s,Kt.MOVE_DOWN,a),OK_BUTTON:a=>g0(s,Kt.OK_BUTTON,a),CANCEL_BUTTON:a=>g0(s,Kt.CANCEL_BUTTON,a),MENU_BUTTON:a=>g0(s,Kt.MENU_BUTTON,a),keydown:a=>{const{key:c}=a;switch(rr(c)){case"t":Rde(qe,Ni());break}}}),o.length>0&&De.jsx(Ku,{visible:!0,color:new Ei(.076,.076,0),width:t,height:e,z:-2}),De.jsx(xze,{width:n,height:r,children:De.jsxs("group",{ref:i,children:[De.jsx(qze,{}),o.map((a,c)=>De.jsx(Gze,{id:a.id,z:c*2},a.id))]})})]})}const jp=ft.createContext({sendmessage(){},sendclose(){},didclose(){}}),Y8={input:{color:"$white",active:"$yellow"}};function Wd(t){return t?Y8.input.active:Y8.input.color}function kx(t,e){switch(t){case"touchkey":return`register:${t}:${e}`}return`vm:${t}:${e}`}function uT(t,e,n=0,r=""){return`${t.substring(0,e)}${r}${t.substring(e+n)}`}function td(t,e){he(t)&&(e.x=1,e.y=t)}const Ov=32,GZ=8,fF=new ht;function fGe(){const t=ar.DRAW_CHAR_WIDTH(),e=ar.DRAW_CHAR_HEIGHT(),n=Math.floor(fF.x/t),r=Math.floor(fF.y/e);return{x:Ov*.5+n,y:GZ*.5+r}}function pGe({chip:t,row:e,label:n,args:r,context:i}){td(e,i);const[s]=[ac(r[0],"")],o=A_(t,s),a=Yw(o),l=(a==null?void 0:a.value)??0,u=Vd(),[d,h]=ft.useState(!1);ft.useLayoutEffect(()=>{h(!0)},[]);const p=`${l}`.padStart(3,"0"),f=n.trim(),g=i.x-1,y=i.y+2,E=[`$green${f} ${p}
$white`];for(let F=0;F<256;++F)if(F%Ov===0&&E.push(`
`),F===l){const $=u?"$green$onwhite":"$white$ongreen";E.push(`${$}$${F}$white$ondkblue`)}else E.push(`$${F}`);const w=E.join("");Wn(w,i,!0);const R=ft.useContext(jp),A=ft.useCallback(()=>{l>=Ov&&rc(o,l-Ov)},[o,l]),k=ft.useCallback(()=>{l>0&&rc(o,l-1)},[o,l]),I=ft.useCallback(()=>{l<255&&rc(o,l+1)},[o,l]),N=ft.useCallback(()=>{l<=255-Ov&&rc(o,l+Ov)},[o,l]),U=ft.useCallback(()=>{R.sendclose()},[R]);return De.jsx("group",{position:[g*ar.DRAW_CHAR_WIDTH(),y*ar.DRAW_CHAR_HEIGHT(),1],children:d&&De.jsxs(Oy,{blockhotkeys:!0,children:[De.jsx(Ku,{blocking:!0,visible:!1,width:Ov,height:GZ,onClick:F=>{F.intersections[0].object.worldToLocal(fF.copy(F.intersections[0].point));const $=LT(fGe(),Ov);$>=0&&$<=255&&(rc(o,$),R.sendclose())}}),De.jsx(da,{MOVE_LEFT:k,MOVE_UP:A,MOVE_RIGHT:I,MOVE_DOWN:N,OK_BUTTON:U,CANCEL_BUTTON:U})]})})}const kv=8,WZ=2,pF=new ht;function mGe(){const t=ar.DRAW_CHAR_WIDTH(),e=ar.DRAW_CHAR_HEIGHT(),n=Math.floor(pF.x/t),r=Math.floor(pF.y/e);return{x:kv*.5+n,y:WZ*.5+r}}function gGe({chip:t,row:e,label:n,args:r,context:i}){td(e,i);const[s]=[ac(r[0],"")],o=A_(t,s),a=Yw(o),l=(a==null?void 0:a.value)??0,u=Vd(),[d,h]=ft.useState(!1);ft.useLayoutEffect(()=>{h(!0)},[]);const p=`${l}`.padStart(2,"0"),f=n.trim(),g=(Tr[l]||Tr[Tr.BLACK]).padEnd(12," ").toLowerCase(),y=i.x-1,E=i.y+2,w=[`$green${f} ${p} ${g}
$white`];for(let F=0;F<16;++F)if(F%kv===0&&w.push(`
`),F===l){const $=F<8?"$white":"$black",q=u?$:`$${Tr[F]}`;w.push(`${q}$219`)}else w.push(`$${Tr[F]}$219`);w.push("$white"),Wn(w.join(""),i,!0);const R=ft.useContext(jp),A=ft.useCallback(()=>{l>=kv&&rc(o,l-kv)},[o,l]),k=ft.useCallback(()=>{l>0&&rc(o,l-1)},[o,l]),I=ft.useCallback(()=>{l<15&&rc(o,l+1)},[o,l]),N=ft.useCallback(()=>{l<=15-kv&&rc(o,l+kv)},[o,l]),U=ft.useCallback(()=>{R.sendclose()},[R]);return De.jsx("group",{position:[y*ar.DRAW_CHAR_WIDTH(),E*ar.DRAW_CHAR_HEIGHT(),1],children:d&&De.jsxs(Oy,{blockhotkeys:!0,children:[De.jsx(Ku,{blocking:!0,visible:!1,width:kv,height:WZ,onClick:F=>{F.intersections[0].object.worldToLocal(pF.copy(F.intersections[0].point));const $=mGe(),q=LT($,kv);q>=0&&q<=16&&(rc(o,q),R.sendclose())}}),De.jsx(da,{MOVE_LEFT:k,MOVE_UP:A,MOVE_RIGHT:I,MOVE_DOWN:N,OK_BUTTON:U,CANCEL_BUTTON:U})]})})}function vGe({item:t,row:e,context:n}){return td(e,n),Wn(`${t}${he(e)?`
`:""}`,n,!0),null}function _Ge({chip:t,row:e,active:n,label:r,args:i,context:s}){td(e,s);const[o,a]=[ac(i[0],""),i[1]],c=Wd(n);Wn(`  $purple$16 ${c}${r}
`,s,!0);const l=ft.useContext(jp),u=ft.useCallback(()=>{l.sendmessage(kx(t,o),a),l.sendclose()},[l,t,o,a]);return n&&De.jsx(da,{OK_BUTTON:u})}function yGe({chip:t,row:e,active:n,label:r,args:i,context:s}){var y;td(e,s);const[o,a,c,l]=[ac(i[0],""),ac(i[1],((y=i[1])==null?void 0:y.toString())??""),ac(i[2],""),ac(i[3],"")],u=c||` ${a.toUpperCase()} `,d=Wd(n),h=s.x-.25,p=s.y-.25;Wn(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${u}${d}$onclear ${r}${he(e)?`
`:""}`,s,!0);const f=ft.useContext(jp),g=ft.useCallback(()=>{f.sendmessage(kx(t,o)),l||f.sendclose()},[t,f,o,l]);return De.jsxs("group",{position:[h*ar.DRAW_CHAR_WIDTH(),p*ar.DRAW_CHAR_HEIGHT(),1],children:[De.jsx(Ku,{visible:!1,width:u.length+.5,height:1.5,blocking:!0,onClick:g}),n&&De.jsx(da,{OK_BUTTON:g}),a&&De.jsx(pE,{hotkey:a,children:g})]})}function bGe({chip:t,row:e,active:n,label:r,args:i,context:s}){td(e,s);const[o,a]=[ac(i[0],""),i[1]],c=Wd(n);Wn(`  $purple$16 ${c}${r}
`,s,!0);const l=ft.useContext(jp),u=ft.useCallback(()=>{l.sendmessage(kx(t,o),a),l.sendclose()},[l,t,o,a]);return n&&De.jsx(da,{OK_BUTTON:u})}function EGe({chip:t,row:e,active:n,label:r,args:i,context:s}){td(e,s);const[o,a]=[ac(i[0],""),i[1]],c=Wd(n);Wn(`  $purple$16 ${c}${r}
`,s,!0);const l=ft.useContext(jp),u=ft.useCallback(()=>{l.sendmessage(kx(t,o),a),l.sendclose()},[l,t,o,a]);return n&&De.jsx(da,{OK_BUTTON:u})}function SGe({chip:t,row:e,active:n,label:r,args:i,context:s}){td(e,s);const[o,a,c]=[ac(i[0],""),ac(i[1],-1),ac(i[2],-1)];let l,u;a===-1?(l=0,u=31):c===-1?(l=0,u=a):(l=a,u=c);const d=A_(t,o),h=Yw(d),p=h==null?void 0:h.value,f=p??0,g=Vd(),[y,E]=ft.useState(""),[w,R]=ft.useState(0),[A,k]=ft.useState(!1);let I=`${f}`;const N=r.trim(),U=Wd(n);A&&(I=g?uT(y,w,1,"$219+"):y),s.writefullwidth=32,Wn(`  # ${U}${N} $green${I}`,s,!1),s.writefullwidth=void 0,Wn(`
`,s,!1);const F=ft.useCallback(K=>{const W=K.alt?10:1;rc(d,Math.min(u,f+W))},[u,f,d]),$=ft.useCallback(K=>{const W=K.alt?10:1;rc(d,Math.max(l,f-W))},[l,f,d]),q=ft.useCallback(()=>{k(K=>{const W=!K;if(W){const X=`${p}`;E(X),R(X.length)}else{const X=parseFloat(y),ne=isNaN(X)?0:X;rc(o,Math.min(u,Math.max(l,ne)))}return W})},[u,l,y,o,p]);return p!==void 0&&De.jsxs(De.Fragment,{children:[n&&!A&&De.jsx(da,{MOVE_LEFT:$,MOVE_RIGHT:F,OK_BUTTON:q}),A&&De.jsxs(Oy,{blockhotkeys:!0,children:[De.jsx(pE,{hotkey:"ctrl+c",children:()=>{console.info("copy")}}),De.jsx(pE,{hotkey:"ctrl+v",children:()=>{console.info("paste")}}),De.jsx(pE,{hotkey:"ctrl+a",children:()=>{console.info("select all")}}),De.jsx(da,{MOVE_LEFT:()=>{R(K=>Math.max(0,K-1))},MOVE_RIGHT:()=>{R(K=>Math.min(y.length,K+1))},CANCEL_BUTTON:q,OK_BUTTON:q,keydown:K=>{switch(rr(K.key)){case"delete":y.length>0&&E(W=>uT(W,w,1));break;case"backspace":w>0&&(E(W=>uT(W,w-1,1)),R(W=>Math.max(0,W-1)));break}K.key.length===1&&y.length<s.width*.5&&(E(W=>uT(W,w,0,K.key)),R(W=>W+1))}})]})]})}function TGe({chip:t,row:e,active:n,label:r,args:i,context:s}){td(e,s);const[o,a,c]=[ac(i[0],""),ac(i[1],""),ac(i[2],"")];let l,u;a===""?(l="L ",u=" H"):c===""?(l="L ",u=` ${a}`):(l=`${a} `,u=` ${c}`);const d=0,h=8,p=A_(t,o),f=Yw(p),g=(f==null?void 0:f.value)??0,y=Vd(),E=r.trim(),w=Wd(n);Wn(` $red $29 ${w}${E} `,s,!1);const A=uT("----:----",g,1,`$green${n?y?"$26":"$27":"$4"}${w}`).replaceAll("-","$7").replaceAll(":","$9");Wn(`${w}${l}${A}${u} $green${g+1}
`,s,!1);const k=ft.useCallback(N=>{const U=N.alt?10:1;rc(p,Math.min(h,g+U))},[h,g,p]),I=ft.useCallback(N=>{const U=N.alt?10:1;rc(p,Math.max(d,g-U))},[d,g,p]);return De.jsx(De.Fragment,{children:n&&De.jsx(da,{MOVE_LEFT:I,MOVE_RIGHT:k})})}function wGe({chip:t,row:e,active:n,label:r,args:i,context:s}){td(e,s);const[o,...a]=[ac(i[0],""),...i.slice(1)],c=[],l=[];for(let I=0;I<a.length;I+=2)c.push(a[I]),l.push(a[I+1]);const u=0,d=l.length-1,h=A_(t,o),p=Yw(h),f=(p==null?void 0:p.value)??0,g=Vd(),y=`${c[f]}`,E=r.trim(),w=Wd(n);Wn(` $dkred ? ${w}${E} `,s,!1);const R=n?g?"$26":"$27":"/";Wn(`${f+1}$green${R}${w}${d+1}`,s,!1),s.writefullwidth=32,Wn(` $green${y}`,s,!1),s.writefullwidth=void 0,Wn(`
`,s,!1);const A=ft.useCallback(I=>{const N=I.alt?10:1;rc(h,Math.min(d,f+N))},[d,f,h]),k=ft.useCallback(I=>{const N=I.alt?10:1;rc(h,Math.max(u,f-N))},[u,f,h]);return De.jsx(De.Fragment,{children:n&&De.jsx(da,{MOVE_LEFT:k,MOVE_RIGHT:A})})}function xGe({chip:t,row:e,active:n,label:r,args:i,context:s}){td(e,s);const o=ac(i[0],""),a=A_(t,o),c=XK(a),l=c==null?void 0:c.value,u=(l==null?void 0:l.toJSON())??"",d=Vd(),[h,p]=ft.useState(0),[f,g]=ft.useState(!1),[y,E]=ft.useState(void 0),w=`${u} `,R=r.trim(),A=Wd(n);Wn(`$green  $20 ${A}${R} $green`,s,!1);const k=s.x,N=s.y*s.width;s.writefullwidth=32,Wn(`${w}`,s,!1),s.writefullwidth=void 0,Wn(`
`,s,!1);const U=he(y),F=s.width-k-2,$=U?Math.min(y,h):h;let q=U?Math.max(y,h):h;U&&(q!==$&&q===h&&--q,XM(k+$+N,k+q+N,15,8,s)),f&&d&&YM(k+h+N,"Û",s);function K(){he(l)&&(p($),E(void 0),l.delete($,q-$+1))}return De.jsxs(De.Fragment,{children:[n&&De.jsx(da,{OK_BUTTON:()=>{l&&(g(!0),p(l.length),E(void 0))}}),f&&De.jsx(Oy,{blockhotkeys:!0,children:De.jsx(da,{MOVE_LEFT:W=>{W.shift?he(y)||E(Ci(h-1,0,u.length)):E(void 0),p(X=>Ci(X-1,0,u.length))},MOVE_RIGHT:W=>{W.shift?he(y)||E(h):E(void 0),p(X=>Ci(X+1,0,u.length))},CANCEL_BUTTON:()=>{g(!1),p(u.length),E(void 0)},OK_BUTTON:()=>g(!1),keydown:W=>{if(!l)return;const{key:X}=W,ne=rr(X),Z={alt:W.altKey,ctrl:Xw?W.metaKey:W.ctrlKey,shift:W.shiftKey},ie=l.toJSON();switch(ne){case"delete":U?K():ie.length>0&&l.delete(h,1);break;case"backspace":U?K():h>0&&(l.delete(h-1,1),p(G=>Math.max(0,G-1)));break;default:if(Z.ctrl)switch(ne){case"a":E(0),p(ie.length);break;case"c":he(ua())&&ua().writeText(l.toJSON()).catch(G=>console.error(G));break;case"v":he(ua())&&ua().readText().then(G=>{U&&K(),l.insert(h,G),p(h+G.length)}).catch(G=>console.error(G));break;case"x":he(ua())&&ua().writeText(l.toJSON()).then(()=>K()).catch(G=>console.error(G));break}else Z.alt||X.length===1&&ie.length<F&&(l.insert(h,X),p(G=>G+1));break}}})})]})}function CGe({chip:t,row:e,active:n,label:r,args:i,context:s}){td(e,s);const[o]=[ac(i[0],"")],a="z",c=` ${a.toUpperCase()} `,l=Wd(n),u=s.x-.25,d=s.y-.25;Wn(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${c}${l}$onclear ${r}${he(e)?`
`:""}`,s,!0);const h=ft.useContext(jp),p=ft.useCallback(()=>{h.sendmessage(kx(t,o),void 0)},[h,t,o]);return De.jsxs("group",{position:[u*ar.DRAW_CHAR_WIDTH(),d*ar.DRAW_CHAR_HEIGHT(),1],children:[De.jsx(Ku,{visible:!1,width:c.length+.5,height:1.5,blocking:!0,onClick:p}),n&&De.jsx(da,{OK_BUTTON:p}),De.jsx(pE,{hotkey:a,children:p})]})}function RGe({row:t,item:e,active:n}){const r=Ni(),i=tf();if(td(t,i),i.iseven=i.y%2===0,typeof e=="string")return De.jsx(vGe,{player:r,item:e,row:t,context:i});if(qr(e)){const[s,o,a,c,...l]=e;if(typeof s!="string"||typeof o!="string"||typeof a!="string")return null;const u={player:r,chip:s,row:t,active:n,label:o,args:[a,...l],context:i},d=nr(c)?c:"";switch(rr(d)){default:case"hyperlink":return De.jsx(bGe,{...u});case"hk":case"hotkey":return De.jsx(yGe,{...u});case"rn":case"range":return De.jsx(TGe,{...u});case"sl":case"select":return De.jsx(wGe,{...u});case"nm":case"number":return De.jsx(SGe,{...u});case"tx":case"text":return De.jsx(xGe,{...u});case"copyit":return De.jsx(_Ge,{...u});case"linkit":return De.jsx(EGe,{...u});case"zssedit":return De.jsx(CGe,{...u});case"charedit":return De.jsx(pGe,{...u});case"coloredit":return De.jsx(gGe,{...u})}qM(i)}return null}function pN({store:t,children:e}){return De.jsx(O3.Provider,{value:t,children:e})}function mN({width:t,height:e}){const n=ft.useContext(O3),[r,i,s]=I3(n,Rp(o=>[o.char,o.color,o.bg,o.render]));return t>0&&e>0&&De.jsx(PZ,{char:r.slice(),color:i.slice(),bg:s.slice(),width:t,height:e})}function tj({inline:t=!1,xmargin:e=1,ymargin:n=1,selected:r=-1,width:i,height:s,color:o,bg:a,text:c}){const l=JM(i,s,0,o,a),u=l.getState(),d={...Ty(i,s,o,a,n,e,i-e,s-n),...l.getState(),x:e,y:n};return BY(u,0,o,a),De.jsxs(pN,{store:l,children:[De.jsx(mN,{width:i,height:s}),De.jsx(Pv.Provider,{value:d,children:c.map((h,p)=>De.jsx(RGe,{row:t?void 0:p,item:h,active:p===r},p))})]})}var AGe=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/n)*Math.atan(Math.sin(2*Math.PI*e*i)/n)},MGe=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function IGe(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:MGe,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(t.__damp===void 0&&(t.__damp={}),t.__damp[c]===void 0&&(t.__damp[c]=0),Math.abs(t[e]-n)<=a)return t[e]=n,!1;r=Math.max(1e-4,r);var l=2/r,u=o(l*i),d=t[e]-n,h=n,p=s*r;d=Math.min(Math.max(d,-p),p),n=t[e]-d;var f=(t.__damp[c]+l*d)*i;t.__damp[c]=(t.__damp[c]-l*f)*u;var g=n+(d+f)*u;return h-t[e]>0==g>h&&(g=h,t.__damp[c]=(g-h)/i),t[e]=g,!0}const OGe=2,kGe=14,qZ=kGe*OGe;function NGe(t){return rM(t,qZ*.5)}function PGe(t,e,n,r,i=1.235){function s(a){return AGe(a,r)}IGe(t.userData,e,n,i,r,qZ*12,s),t.position[e]=NGe(t.userData[e]);const o=n-t.position.y;return Math.abs(o)<.1}function DGe({name:t,width:e,height:n,context:r}){const i=jY();for(let c=1;c<e-1;++c)ca(i,e,n,c,0,{char:196,color:15}),c>2&&c<e-1&&ca(i,e,n,c,1,{char:205,color:15}),ca(i,e,n,c,n-1,{char:205,color:15});ca(i,e,n,1,0,{char:205,color:15}),ca(i,e,n,2,0,{char:187,color:15}),ca(i,e,n,2,1,{char:200,color:15});for(let c=1;c<n-1;++c)ca(i,e,n,0,c,{char:179,color:15}),ca(i,e,n,e-1,c,{char:179,color:15});for(let c=2;c<n-1;++c)ca(i,e,n,1,c,{char:0,color:15}),ca(i,e,n,e-2,c,{char:0,color:15});ca(i,e,n,0,0,{char:213,color:15}),ca(i,e,n,e-1,0,{char:191,color:15}),ca(i,e,n,e-1,1,{char:181,color:15}),ca(i,e,n,0,n-1,{char:212,color:15}),ca(i,e,n,e-1,n-1,{char:190,color:15});const s=` ${t} `,o=KM(s,e,n),a=(o==null?void 0:o.x)??s.length;return r.x=Math.round(e*.5)-Math.round(a*.5),Wn(s,r,!0),null}function X8({x:t,y:e,color:n,on:r=232,off:i=7,alt:s}){const o=Vd(),a=jY(),c=ft.useRef(0),l=he(s)?c.current%2===0?r:s:r;return ca(a,a.width,a.height,t,e,{char:o?l:i,color:n}),a.changed(),o&&++c.current,null}function LGe({store:t,children:e}){return De.jsx(UY.Provider,{value:t,children:e})}function UGe({width:t,height:e}){const n=ft.useContext(UY),[r]=I3(n,Rp(i=>[i.dither,i.render]));return t>0&&e>0&&De.jsx(dN,{alphas:r.slice(),width:t,height:e})}function FGe({row:t,width:e,height:n,panelwidth:r,panelheight:i,children:s}){const o=aCe(r,i,0),a=[.001,.05,.1,.2],c=.4,{dither:l}=o.getState();oCe(l);for(let u=0;u<r;++u){qP(l,r,i,u,t,c);for(let d=0;d<a.length;++d){const h=a.length-d;qP(l,r,i,u,t-h,a[d]),qP(l,r,i,u,t+h,a[d])}}return De.jsxs(De.Fragment,{children:[De.jsx(mN,{width:e,height:n}),De.jsxs("group",{position:[2*ar.DRAW_CHAR_WIDTH(),2*ar.DRAW_CHAR_HEIGHT(),0],children:[De.jsx(LGe,{store:o,children:De.jsx(UGe,{width:r,height:i})}),s,De.jsx(X8,{x:1,y:1}),De.jsx(X8,{x:1,y:2+t,on:26,alt:27,off:45,color:12})]})]})}function BGe({name:t,width:e,height:n,color:r,bg:i,text:s,shouldclose:o}){const{viewport:a}=lS(),c=e-3,l=n-3,u=JM(e,n,0,r,i),d=ft.useContext(jp),h={...Ty(e,n,r,i,0,0,e,n),...u.getState()},[p,f]=ft.useState(0);let g=p-Math.floor(l*.5);g=Math.min(s.length-l,g),g=Math.max(0,g);const y=s.slice(g,g+l),E=p-g,w=ft.useRef(null),R=ft.useCallback(()=>{o&&d.didclose()},[o,d]),A=ft.useCallback(I=>{const N=I.alt?10:1;f(U=>Math.max(0,U-N))},[f]),k=ft.useCallback(I=>{const N=I.alt?10:1;f(U=>Math.min(s.length,U+N))},[f,s.length]);return ft.useEffect(()=>{if(w.current&&!o){const I=a.height;w.current.position.y=I,w.current.userData.y=I,w.current.userData.vy=0}},[o]),ww(ft.useCallback((I,N)=>{if(he(w.current)){const U=o?n*2*-ar.DRAW_CHAR_HEIGHT():0;PGe(w.current,"y",U,N)&&R()}},[o,R,n])),De.jsx("group",{ref:w,"position-y":1e6,children:De.jsxs(Oy,{children:[De.jsx(da,{MOVE_UP:A,MOVE_DOWN:k,CANCEL_BUTTON:d.sendclose}),De.jsxs(pN,{store:u,children:[De.jsx(DGe,{name:t,width:e,height:n,context:h}),De.jsx(FGe,{row:E,width:e,height:n,panelwidth:c,panelheight:l,children:De.jsx(tj,{name:t,width:c,height:l,xmargin:0,ymargin:0,color:r,bg:Tr.ONCLEAR,text:y,selected:E})})]})]})})}const J8=new Vn,Q8=[153,5,42,94,24,25,26,27,16,17,30,31,234,227,227].map((t,e)=>[t,e%3===0?176:177,e%3===0?178:176]).flat();function jGe({context:t,width:e,height:n,drawstick:r}){const{islandscape:i,sidebaropen:s,showkeyboard:o}=ou();if(BY(t,0,Tr.WHITE,Tr.ONCLEAR),!i){const a=e*n;for(let c=4*e;c<a;++c)t.char[c]=s?Q8[c%Q8.length]:0,t.color[c]=s?Tr.DKPURPLE:Tr.ONCLEAR}t.y=3;for(let a=0;a<3;++a)t.x=t.active.leftedge=1,Wn("$YELLOW$176$176$176$176$176",t,!1),t.x=t.active.leftedge=e-7,Wn(`$WHITE$176$176$176$176$176
`,t,!1);t.y=n-5;for(let a=0;a<3;++a)t.x=t.active.leftedge=1,Wn("$GREEN$176$176$176$176$176",t,!1),t.x=t.active.leftedge=e-7,Wn(`$RED$176$176$176$176$176
`,t,!1);if(t.y=n-5,t.active.leftedge=1,t.active.bg=Tr.ONCLEAR,o?(++t.y,t.x=Math.round((e-8)*.5),Wn("$GREY$221",t,!1),t.x+=5,Wn(`$GREY$222
`,t,!1),t.x=Math.round((e-6)*.5),Wn("$GREY$221",t,!1),t.x+=3,Wn(`$GREY$222
`,t,!1),t.x=Math.round((e-4)*.5),Wn("$GREY$221",t,!1),++t.x,Wn(`$GREY$222
`,t,!1)):(t.x=Math.round((e-4)*.5),Wn("$GREY$221",t,!1),++t.x,Wn(`$GREY$222
`,t,!1),t.x=Math.round((e-6)*.5),Wn("$GREY$221",t,!1),t.x+=3,Wn(`$GREY$222
`,t,!1),t.x=Math.round((e-8)*.5),Wn("$GREY$221",t,!1),t.x+=5,Wn(`$GREY$222
`,t,!1)),r.startx!==-1){t.active.leftedge=0,t.x=t.active.leftedge=r.startx-4,t.y=r.starty-3;for(let c=0;c<5;++c)Wn(`$BLUE$176$176$176$176$176$176$176$176
`,t,!1);J8.set(r.tipx-r.startx,r.tipy-r.starty);const a=Nue(rM(FW(J8.angle()),45));t.x=t.active.leftedge=Math.round(r.startx+Math.cos(a)*4)-2,t.y=Math.round(r.starty+Math.sin(a)*3)-2;for(let c=0;c<3;++c)Wn(`$BLUE$177$177$177$177
`,t,!1)}return i||(t.active.leftedge=1,t.y=4,t.x=2,Wn("$YELLOW?",t,!1),t.x=e-7,Wn("$WHITEMENU",t,!1),t.y=n-4,t.x=2,Wn("$GREENOKAY",t,!1),t.x=e-9,Wn("$REDCANCEL",t,!1)),null}function $Ge(t,e){switch(t){case 0:Fu.keyboard(e?"{Shift>}[ArrowLeft]{/Shift}":"[ArrowLeft]").catch(xl);break;case 45:Fu.keyboard(e?"{Shift>}[ArrowLeft][ArrowUp]{/Shift}":"[ArrowLeft][ArrowUp]").catch(xl);break;case 90:Fu.keyboard(e?"{Shift>}[ArrowUp]{/Shift}":"[ArrowUp]").catch(xl);break;case 135:Fu.keyboard(e?"{Shift>}[ArrowRight][ArrowUp]{/Shift}":"[ArrowRight][ArrowUp]").catch(xl);break;case 180:Fu.keyboard(e?"{Shift>}[ArrowRight]{/Shift}":"[ArrowRight]").catch(xl);break;case 225:Fu.keyboard(e?"{Shift>}[ArrowRight][ArrowDown]{/Shift}":"[ArrowRight][ArrowDown]").catch(xl);break;case 270:Fu.keyboard(e?"{Shift>}[ArrowDown]{/Shift}":"[ArrowDown]").catch(xl);break;case 315:Fu.keyboard(e?"{Shift>}[ArrowLeft][ArrowDown]{/Shift}":"[ArrowLeft][ArrowDown]").catch(xl);break;case 360:Fu.keyboard(e?"{Shift>}[ArrowLeft]{/Shift}":"[ArrowLeft]").catch(xl);break}}const HGe=dw/1e3,KS=new Vn,Xb=new ht;function YS(t,e){const n=ar.DRAW_CHAR_WIDTH(),r=ar.DRAW_CHAR_HEIGHT(),i=Xb.x+n*.5,s=Xb.y+r*.5;return{cx:Math.floor(t*.5)+Math.floor(i/n),cy:Math.floor(e*.5)+Math.floor(s/r)}}function VGe({width:t,height:e,player:n,onDrawStick:r}){const{islandscape:i}=ou(),[s]=ft.useState({startx:-1,starty:-1,tipx:-1,tipy:-1,pointerid:-1,presscount:0,inputacc:dw});function o(a,c){s.tipx===-1&&(u0(a,c,3,6,6,1)?Ade(qe,n):u0(a,c,3,t-2,6,t-6)?Fu.keyboard("[Tab]").catch(xl):u0(a,c,e-5,6,e-2,1)?Fu.keyboard("[Enter]").catch(xl):u0(a,c,e-5,t-2,e-2,t-6)?Fu.keyboard("[Escape]").catch(xl):i&&u0(a,c,6,t,e-6,t-5)||!i&&u0(a,c,0,t-12,3,12)?ou.setState(l=>({...l,sidebaropen:!l.sidebaropen})):u0(a,c,e-4,t-12,e-2,12)&&ou.setState({showkeyboard:!0})),s.startx=-1,s.starty=-1,s.tipx=-1,s.tipy=-1,s.pointerid=-1,r(s.startx,s.starty,s.tipx,s.tipy)}return ww((a,c)=>{if(s.inputacc+=c,s.inputacc>=HGe&&s.presscount>0){s.inputacc=0;const{cx:l,cy:u}=YS(t,e);if(KS.set(s.startx-l,s.starty-u),s.tipx!==-1||KS.length()>3){const d=rM(FW(KS.angle()),45);$Ge(d,s.presscount>1)}}}),De.jsx(Ku,{width:t,height:e,visible:!1,onPointerDown:a=>{if(++s.presscount,s.startx===-1){a.intersections[0].object.worldToLocal(Xb.copy(a.intersections[0].point));const{cx:c,cy:l}=YS(t,e);s.startx=c,s.starty=l,s.tipx=-1,s.tipy=-1,s.pointerid=a.pointerId,s.inputacc=dw}},onPointerMove:a=>{if(a.pointerId===s.pointerid){a.intersections[0].object.worldToLocal(Xb.copy(a.intersections[0].point));const{cx:c,cy:l}=YS(t,e);KS.set(s.startx-c,s.starty-l),(s.tipx!==-1||KS.length()>3)&&(s.tipx=c,s.tipy=l,r(s.startx,s.starty,s.tipx,s.tipy))}},onPointerCancel:a=>{if(--s.presscount,a.pointerId===s.pointerid){a.intersections[0].object.worldToLocal(Xb.copy(a.intersections[0].point));const{cx:c,cy:l}=YS(t,e);o(c,l)}},onPointerUp:a=>{if(--s.presscount,a.pointerId===s.pointerid){a.intersections[0].object.worldToLocal(Xb.copy(a.intersections[0].point));const{cx:c,cy:l}=YS(t,e);o(c,l)}}})}function zGe({width:t,height:e}){const n=Ni(),[r,i]=ft.useState({startx:-1,starty:-1,tipx:-1,tipy:-1}),s=JM(t,e,0,Tr.WHITE,Tr.ONCLEAR),o={...Ty(t,e,Tr.WHITE,Tr.ONCLEAR),...s.getState()};return rCe(1,1,t-2,e-2,o),De.jsxs(pN,{store:s,children:[De.jsx(jGe,{context:o,width:t,height:e,drawstick:r}),De.jsx(VGe,{width:t,height:e,player:n,onDrawStick:(a,c,l,u)=>i({startx:a,starty:c,tipx:l,tipy:u})}),De.jsx(MA,{width:t,height:e,top:5,left:0,right:5,bottom:e-6,alpha:.47135}),De.jsx(MA,{width:t,height:e,top:5,left:t-6,right:t-1,bottom:e-6,alpha:.47135}),De.jsx(mN,{width:t,height:e})]})}const Z8=1.5,ez=56,GGe=16,WGe=[[`
`],["[Escape]","$","1","2","3","4","5","6","7","8","9","0","&",`
`],[" ","Q","W","E","R","T","Y","U","I","O","P","-","+","*",`
`,`
`],["A","S","D","F","G","H","J","K","L","[Backspace]","_","=","%",`
`],[" ","Z","X","C","V","B","N","M","!","[Enter]","(",")","|",`
`],["                                          ","<",">","`",`
`],["[Space]","#","/","?",":","'",";",'"',"  ","[ArrowUp]",`
`],["         ","[Shift]","[Ctrl]","[Alt]","@","[ArrowLeft]","    ","[ArrowRight]",`
`],["                                      ","[ArrowDown]",`
`],["$greenz s s k e y s"]].flat();function qGe(t){return t.replaceAll("{","").replaceAll("}","").replaceAll("[","").replaceAll("]","")}function KGe(t,e,n,r){let i=t,s=qGe(t);switch(t){case"$":s=" $$ ";break;case";":s=" $59 ";break;case"[Escape]":s=" esc ";break;case"[ArrowUp]":s=" $30 ";break;case"[ArrowDown]":s=" $31 ";break;case"[ArrowRight]":s=" $16 ";break;case"[ArrowLeft]":s=" $17 ";break;case"[Backspace]":s=" del ";break;case"[Shift]":s=r?" SHIFT ":" shift ";break;case"[Ctrl]":s=n?" CTRL ":" ctrl ";break;case"[Alt]":s=e?" ALT ":" alt ";break;default:if(!r)i=i.toLowerCase(),s=s.toLowerCase();else switch(s){case"(":s="[";break;case")":s="]";break;case"<":s="{";break;case">":s="}";break;case"`":s="~";break}s=` ${s} `;break}return["touchkey","",i,"hk","",s]}function YGe({width:t,height:e}){const n=Ni(),{showkeyboard:r,keyboardalt:i,keyboardctrl:s,keyboardshift:o}=ou(),a=ft.useRef(null),[c]=ft.useState({}),l=16;return r&&De.jsxs(De.Fragment,{children:[De.jsx(Ku,{blocking:!0,width:t,height:e,visible:!1,onPointerDown:u=>{c[u.pointerId]=u.point.x,he(a.current)&&(a.current.userData.x=a.current.position.x)},onPointerMove:u=>{const d=c[u.pointerId],h=u.point.x;if(he(d)&&a.current){const p=ar.DRAW_CHAR_WIDTH()*Z8,f=Math.round(rM(h-d,p)/p);a.current.position.x=Ci(a.current.userData.x+f*p,ez*-p+t*ar.DRAW_CHAR_WIDTH(),0)}},onPointerUp:u=>{delete c[u.pointerId]}}),De.jsx(MA,{width:t,height:e,top:5,left:0,right:t-1,bottom:e-1,alpha:.753718}),De.jsx("group",{position:[0,0,1],children:De.jsx(Ku,{visible:!1,x:t*.5-l*.5,y:e-3.5,width:l,height:4,onClick:()=>{ou.setState({showkeyboard:!1})}})}),De.jsx("group",{ref:a,scale:Z8,children:De.jsx(jp.Provider,{value:{sendmessage(u,d){qe.emit(u,d,n)},sendclose(){},didclose(){}},children:De.jsx(tj,{name:"keyboard",inline:!0,ymargin:1,color:Tr.WHITE,bg:Tr.ONCLEAR,width:ez,height:GGe,text:WGe.map(u=>{switch(u){case`
`:return u;default:if(u.includes(" "))return u}return KGe(u,i,s,o)})})})})]})}function XGe({width:t,height:e}){const n=nj();return n.cols<10||n.rows<10?null:De.jsxs(De.Fragment,{children:[De.jsx("group",{position:[0,0,800],children:De.jsx(zGe,{width:t,height:e})}),De.jsx("group",{position:[0,0,850],children:De.jsx(YGe,{width:t,height:e})})]})}const KZ=ft.createContext({cols:1,rows:1});function nj(){return ft.useContext(KZ)}function JGe({children:t}){const{viewport:e,set:n,size:r,camera:i}=lS(),s=ft.useRef(null),{width:o,height:a}=e.getCurrentViewport(),{islandscape:c,showtouchcontrols:l}=ou();ft.useLayoutEffect(()=>{const A=i;return i.updateProjectionMatrix(),n(()=>({camera:s.current})),()=>n(()=>({camera:A}))},[n,i,s]);const u=o/ar.DRAW_CHAR_WIDTH();let d=Math.floor(u);const h=a/ar.DRAW_CHAR_HEIGHT();let p=Math.floor(h);const f=(o-d*ar.DRAW_CHAR_WIDTH())*.5,g=(a-p*ar.DRAW_CHAR_HEIGHT())*.5;let y=0,E=0;const w=Math.round(u);let R=Math.round(h);if(l)if(c)y=5*ar.DRAW_CHAR_WIDTH(),d-=5*2;else{p=Math.round(p*.666);const A=p-4;R-=A,E=A*ar.DRAW_CHAR_HEIGHT()}return ft.useEffect(()=>{ou.setState(A=>({...A,insetcols:w,insetrows:R}))},[w,R]),De.jsxs(KZ.Provider,{value:{cols:d,rows:p},children:[De.jsx("orthographicCamera",{ref:s,left:r.width/-2,right:r.width/2,top:r.height/2,bottom:r.height/-2,near:1,far:2e3,position:[0,0,1e3]}),d>=10&&p>=10&&De.jsx("group",{"scale-x":-1,"rotation-z":Math.PI,children:De.jsxs("group",{position:[o*-.5+f,a*-.5+g,0],children:[De.jsx("group",{position:[y,0,0],children:t}),l&&De.jsx("group",{position:[0,E,0],children:De.jsx(XGe,{width:w,height:R},w*R)})]})})]})}function tz({rect:t,islandscape:e=!0,sidebaropen:n=!0,shouldclose:r=!1}){switch(t.type){case 0:return De.jsx(tj,{name:t.name,width:t.width,height:t.height,color:14,bg:1,text:t.text,xmargin:e?1:n?3:10,ymargin:e&&!n?6:0});case 1:return De.jsx(BGe,{name:t.name,width:t.width,height:t.height,color:14,bg:1,text:t.text,shouldclose:r});case 2:return De.jsx(hGe,{width:t.width,height:t.height})}return null}const Sb=20;function QGe(){const t=nj(),{islandscape:e,sidebaropen:n,insetrows:r,showtouchcontrols:i}=ou(),s=og(U8(f=>f.gadget.scroll??[])),o=s.length===0,[a,c]=ft.useState(!1),l=og(U8(f=>f.gadget.sidebar??[]));if(t.cols<10||t.rows<10)return null;const u={name:"main",type:2,x:0,y:0,text:[],width:t.cols,height:t.rows},d=[];if(l.length)if(i)if(e){const f=n?Sb+5:Sb,g=n?Sb:4,y={name:"sidebar",type:0,x:u.x+u.width-g,y:u.y,width:f,height:u.height,text:l};u.width-=g,d.push(y)}else{const f=n?r-7:r,g=n?f:4,y={name:"sidebar",type:0,x:0,y:u.y+u.height-g,width:u.width,height:f,text:l};u.height-=g,d.push(y)}else{const f={name:"sidebar",type:0,x:u.x+u.width-Sb,y:u.y,width:Sb,height:u.height,text:l};u.width-=Sb,d.push(f)}const h={name:"scroll",type:1,x:0,y:0,width:Ci(50,24,u.width-2),height:Ci(18,8,u.height-8),text:s};h.x=u.x+Math.floor((u.width-h.width)*.5),h.y=u.y+Math.floor((u.height-h.height)*.5),!o&&!a&&c(!0),d.unshift(u);const p=Ni();return De.jsx(jp.Provider,{value:{sendmessage(f,g){qe.emit(f,g,p)},sendclose(){dde(qe,p)},didclose(){c(!1)}},children:De.jsxs("group",{position:[0,0,-512],children:[d.map(f=>De.jsx("group",{position:[f.x*ar.DRAW_CHAR_WIDTH(),f.y*ar.DRAW_CHAR_HEIGHT(),0],children:De.jsx(tz,{islandscape:!i||e,sidebaropen:!i||n,rect:f})},f.name)),a&&De.jsxs(Fh.Fragment,{children:[De.jsx("group",{position:[0,0,800],children:De.jsx(Bze,{width:t.cols,height:t.rows,alpha:.14})}),De.jsx("group",{position:[h.x*ar.DRAW_CHAR_WIDTH(),h.y*ar.DRAW_CHAR_HEIGHT(),900],children:De.jsx(tz,{rect:h,shouldclose:o})})]},"scroll")]})})}const ZGe=250,eWe=249,tS=Tr.BLUE,tWe=Tr.WHITE,nWe=Tr.DKGRAY,rj=Tr.BLACK;function TS(t){return t?Tr.ONCLEAR:Tr.DKBLUE}const YZ=ft.createContext({sendmessage(){}});function H0(t,e,n,r,i){const s=ef(i);i.iseven=i.y%2===0,i.active.bg=e&&!t?rj:i.reset.bg,i.active.leftedge=s.left,i.active.rightedge=s.right,i.active.topedge=s.top,i.active.bottomedge=s.bottom,i.x=i.active.leftedge+n,i.y=i.active.topedge+r}function Jb(t,e,n,r,i,s,o,a){const c=ef(i);i.iseven=i.y%2===0,i.active.bg=i.reset.bg,i.active.leftedge=c.left+s,i.active.rightedge=c.right-s,i.active.topedge=c.top+o,i.active.bottomedge=c.bottom-a,i.x=i.active.leftedge+n,i.y=i.active.topedge+r}function rWe(t){let e=0;return t.split(/\r?\n/).map(r=>{const i=e,s=`${r}
`;return e+=s.length,{start:i,code:s,end:i+r.length}})}function iWe(t){return t.reduce((e,n)=>{const r=n.code.length;return r>e?r:e},0)}function sWe(t,e){for(let n=0;n<e.length;++n)if(t<=e[n].end)return n;return 0}function XZ(t){return he(t)?t.value:void 0}function ij({context:t}){const e=ef(t),{quickterminal:n}=Us(),r=TS(n);if(n){for(let i=e.top;i<=e.bottom;++i)for(let s=e.left;s<=e.right;++s)ca(t,t.width,t.height,s,i,{char:0,color:tS,bg:r});return null}for(let i=e.top;i<=e.bottom;++i)for(let s=e.left;s<=e.right;++s){let o=0;(s+i)%2===0&&(o=Math.abs(Math.round(Math.cos(s*i*.01)))?ZGe:eWe),ca(t,t.width,t.height,s,i,{char:o,color:tS,bg:r})}return null}function oWe(){const t=tf(),e=ef(t),[n,r,i]=Us(Rp(g=>[g.quickterminal,g.editor.type,g.editor.title])),s=TS(n);for(let g=e.top;g<e.bottom;++g)ca(t,t.width,t.height,e.left,g,{char:179,color:tS,bg:s}),ca(t,t.width,t.height,e.right,g,{char:179,color:tS,bg:s});const o="$196".repeat(e.width-4);Jb(!1,!1,0,0,t,0,0,0),Wn(`$213$205$187${o}$191`,t,!0);const a="$205".repeat(e.width-2);Jb(!1,!1,0,e.height-1,t,0,0,0),Wn(`$212${a}$190`,t,!0);const c=Vd(),l="$205".repeat(e.width-4);Jb(!1,!1,0,1,t,0,0,0),Wn(`$179$${c?"7":"232"}$200${l}$181`,t,!0);const d=` ${`[${r}] `}${i} `,h=KM(d,e.width,e.height),p=(h==null?void 0:h.measuredwidth)??1,f=Math.round(e.width*.5)-Math.round(p*.5);return Jb(!1,!1,f,0,t,0,0,0),Wn(d,t,!0),null}const aWe=t=>{const e="nativeEvent"in t?t.nativeEvent:t;return{deltaX:e.deltaX||0,deltaY:e.deltaY||0,deltaZ:e.deltaZ||0,timeStamp:e.timeStamp}},cWe=t=>[t.deltaX,t.deltaY,t.deltaZ],oC=t=>{const e=cWe(t).map(Math.abs);return Math.max(...e)};var Bv;(function(t){t.ALL_OTHER_CHECKS_FAILED="ALL_OTHER_CHECKS_FAILED",t.NO_PREVIOUS_EVENT_TO_COMPARE="NO_PREVIOUS_EVENT_TO_COMPARE",t.PAST_TIMESTAMP_EVENT="PAST_TIMESTAMP_EVENT",t.ENOUGH_TIME_PASSED="ENOUGH_TIME_PASSED",t.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN="NON_DECREASING_DELTAS_OF_KNOWN_HUMAN",t.DELTA_MODULE_HAS_BEEN_INCREASING="DELTA_MODULE_HAS_BEEN_INCREASING"})(Bv||(Bv={}));class lWe{constructor({sensitivity:e=2,delay:n=100,increasingDeltasThreshold:r=3}={}){Gn(this,"sensitivity");Gn(this,"delay");Gn(this,"increasingDeltasThreshold");Gn(this,"previousEvents");this.sensitivity=Math.max(1,e),this.delay=Math.max(1,n),this.increasingDeltasThreshold=Math.max(2,r),this.previousEvents=[]}check(e){var s;if(!(("nativeEvent"in e?e.nativeEvent:e)instanceof Event))throw new Error(`"${e}" is not a valid event`);const r=aWe(e);if(oC(r)<this.sensitivity)return!1;const{isHuman:i}=this.isHuman(r);return i?this.previousEvents=[r]:r.timeStamp>(((s=this.previousEvents.at(-1))==null?void 0:s.timeStamp)||0)&&this.previousEvents.push(r),i}isHuman(e){const n=this.previousEvents.at(-1);if(!n)return{isHuman:!0,reason:Bv.NO_PREVIOUS_EVENT_TO_COMPARE};if(e.timeStamp<n.timeStamp)return{isHuman:!1,reason:Bv.PAST_TIMESTAMP_EVENT};if(e.timeStamp>n.timeStamp+this.delay)return{isHuman:!0,reason:Bv.ENOUGH_TIME_PASSED};const s=oC(e),o=oC(n);if(s>=o){if(this.previousEvents.length===1)return{isHuman:!0,reason:Bv.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN};if(this.increasingDeltasThreshold<=2||this.previousEvents.length>=this.increasingDeltasThreshold&&this.previousEvents.slice(-this.increasingDeltasThreshold).map(oC).every((u,d,h)=>d===0||u>h[d-1]))return{isHuman:!0,reason:Bv.DELTA_MODULE_HAS_BEEN_INCREASING}}return{isHuman:!1,reason:Bv.ALL_OTHER_CHECKS_FAILED}}}const uWe=new lWe({sensitivity:Xw?7:2}),nz=4,dWe=.75;function hWe(t){const e=Ci(t,-nz,nz);return Math.round(e*dWe)}function JZ({debug:t=!1,disabled:e=!1,blocking:n=!0,cursor:r="pointer",x:i=0,y:s=0,width:o=30,height:a=10,children:c,onScroll:l,...u}){return De.jsxs("group",{...u,children:[De.jsx(Ku,{blocking:n,cursor:r,visible:t,x:i,y:s,width:o,height:a,onWheel:d=>{e||!uWe.check(d)||l==null||l(hWe(d.deltaY))}}),c]})}function fWe({xcursor:t,ycursor:e,xoffset:n,yoffset:r,rows:i,codepage:s}){var W,X;const o=Vd(),a=tf(),c=ft.useRef(),l=No(),u=ef(a),d=Us(ne=>ne.editor.player),h=XZ(s),p=he(h)?h.toJSON():"",f=i.length-1,g=t+1-n,y=e+2-r;if(he(s)){const ne=((W=c.current)==null?void 0:W.x)!==g||((X=c.current)==null?void 0:X.y)!==y;if(o||ne){const Z=u.left+g,ie=u.top+y;ie>u.top+1&&ie<u.bottom&&Z>u.left&&Z<u.right&&YM(Z+ie*a.width,"Ý",a)}}c.current={x:g,y};const E=i[f].end,w=i[e];let R=l.cursor,A=l.cursor,k=!1;he(l.select)&&(k=!0,R=Math.min(l.cursor,l.select),A=Math.max(l.cursor,l.select),l.cursor!==l.select&&--A);const I=A-R+1,N=k?p.substring(R,A+1):p;function U(ne){ne?he(l.select)||No.setState({select:l.cursor}):No.setState({select:void 0})}function F(ne,Z,ie){Z>0&&(h==null||h.delete(ne,Z)),he(ie)&&(h==null||h.insert(ne,ie)),No.setState({cursor:ne+(ie??"").length,select:void 0})}function $(){he(l.select)&&(No.setState({cursor:R}),F(R,I))}function q(){No.setState({cursor:E,select:void 0})}const K=ft.useCallback(function(Z){const ie=Math.round(e+Z);if(ie<0)No.setState({cursor:0});else if(ie>f)No.setState({cursor:E});else{const G=i[ie];No.setState({cursor:G.start+Math.min(t,G.code.length-1)})}},[E,i,f,t,e]);return De.jsxs(De.Fragment,{children:[De.jsx(JZ,{blocking:!0,x:u.left,y:u.top,width:u.width,height:u.height,onScroll:ne=>K(ne*.75)}),De.jsx(da,{keydown:ne=>{if(!he(h))return;const{key:Z}=ne,ie=rr(Z),G=fN(ne);switch(ie){case"arrowleft":if(U(G.shift),G.ctrl)No.setState({cursor:w.start});else{const Q=l.cursor-(G.alt?10:1);No.setState({cursor:Ci(Q,0,E)})}break;case"arrowright":if(U(G.shift),G.ctrl)No.setState({cursor:w.end});else{const Q=l.cursor+(G.alt?10:1);No.setState({cursor:Ci(Q,0,E)})}break;case"arrowup":U(G.shift),G.ctrl?No.setState({cursor:0}):K(G.alt?-10:-1);break;case"arrowdown":U(G.shift),G.ctrl?No.setState({cursor:E}):K(G.alt?10:1);break;case"enter":he(h)&&(h.insert(l.cursor,`
`),No.setState({cursor:l.cursor+1}));break;case"esc":case"escape":G.shift||G.alt||G.ctrl?wR(qe,d):Ide(qe,d);break;case"tab":VW(qe,!G.shift,d);break;case"delete":k?$():F(l.cursor,1);break;case"backspace":k?$():p.length>0&&F(Math.max(l.cursor-1,0),1);break;default:if(G.ctrl)switch(ie){case"a":No.setState({cursor:E,select:0});break;case"c":he(ua())?ua().writeText(N).catch(Q=>ai(qe,"clipboard",Q)):q();break;case"v":he(ua())?ua().readText().then(Q=>{const se=Q.replaceAll("\r","");k?F(R,I,se):F(l.cursor,0,se)}).catch(Q=>ai(qe,"clipboard",Q)):q();break;case"x":he(ua())?ua().writeText(N).then(()=>$()).catch(Q=>ai(qe,"clipboard",Q)):q();break;case"p":Cw(qe,N,d),Oi(qe,`running: ${N.substring(0,18)}`);break}else if(!G.alt){if(Z.length===1)if(k)F(R,I,Z);else{const Q=l.cursor+Z.length;h.insert(l.cursor,Z),No.setState({cursor:Q})}}break}}})]})}function pWe({ycursor:t,xoffset:e,yoffset:n,rows:r,codepage:i}){const s=Vd(),o=tf(),a=No(),{quickterminal:c}=Us(),l=ef(o);if(!he(i)){const f=(s?"|":"-").repeat(3);return Jb(!1,!1,0,0,o,1,2,1),Wn(` ${f} LOADING ${f}`,o,!0),null}let u=a.cursor,d=a.cursor,h=!1;he(a.select)&&(h=!0,u=Math.min(a.cursor,a.select),d=Math.max(a.cursor,a.select),a.cursor!==a.select&&--d);const p=l.left+1;Jb(!1,!1,-e,-n,o,1,2,1);for(let f=0;f<r.length;++f){if(o.y<=l.top+1){++o.y;continue}const g=r[f],y=f===t,E=g.code.replaceAll(`
`,"");if(o.x=p-e,o.iseven=o.y%2===0,o.active.bg=y?rj:TS(c),o.disablewrap=!0,PY(`${E} `,o,!1),h&&g.start<=d&&g.end>=u){const w=Math.max(g.start,u)-g.start-e,R=Math.min(g.end,d)-g.start-e,A=l.width-3,k=1+o.y*o.width,I=Math.max(0,w),N=Math.min(A,R);I<=A&&N>=p&&XM(k+I,k+N,tWe,nWe,o)}if(++o.y,o.y>=l.bottom)break}return o.disablewrap=!1,null}function MD(){const[t]=Us(Rp(g=>[g.editor])),e=tf(),n=No(),r=XK(GW(t.book,t.path)),i=ef(e);ft.useEffect(()=>(Bde(qe,t.book,t.path,t.player),()=>{jde(qe,t.book,t.path,t.player)}),[t.book,t.path,t.player]);const s=XZ(r),o=he(s)?s.toJSON():"",a=rWe(o),c=sWe(n.cursor,a),l=n.cursor-a[c].start,u=iWe(a),d={rows:a,xcursor:l,ycursor:c,codepage:r,xoffset:n.xscroll,yoffset:n.yscroll},h=32,p=(Math.round(u/h)+1)*h,f=a.length;return ft.useEffect(()=>{let g=n.xscroll;const y=l-g,E=i.width-3;let w=Math.round(Ci(Math.abs(y)*.5,1,h));w<8&&(w=1),y>E-8&&(g+=w),y<8&&(g-=w);let R=n.yscroll;const A=c-R,k=i.height-4,I=Math.round(k*.5);let N=Math.round(Ci(Math.abs(A)*.25,1,I));N<8&&(N=1),A>k-4&&(R+=N),A<4&&(R-=N),setTimeout(()=>No.setState({xscroll:Math.round(Ci(g,0,p)),yscroll:Math.round(Ci(R,0,f))}),16)},[l,p,n.xscroll,c,f,n.yscroll,i.width,i.height]),De.jsxs(De.Fragment,{children:[De.jsx(ij,{context:e}),De.jsx(oWe,{}),De.jsx(pWe,{...d}),De.jsx(fWe,{...d})]})}function mWe(t,e,n,r){const i=t.slice(0,e),s=t.slice(e+n);return`${i}${r??""}${s}`}function gWe(t){const[e,n]=t.split(":"),r=he(n)?e:"self",i=he(n)?n:t;return[r,i]}function vWe({tapeycursor:t,logrowtotalheight:e}){const n=Vd(),r=tf(),{quickterminal:i}=Us(),s=sa(),o=Ni(),a=ef(r),c=s.buffer[s.bufferindex];let l=s.xcursor,u=s.xcursor,d=!1;he(s.xselect)&&he(s.yselect)&&(d=!0,l=Math.min(s.xcursor,s.xselect),u=Math.max(s.xcursor,s.xselect),s.xcursor!==s.xselect&&--u);const h=u-l+1,p=s.ycursor===0,f=d?c.substring(l,u+1):c;function g(U,F,$){s.bufferindex>0&&sa.setState({bufferindex:0}),s.buffer[0]=mWe(c,U,F,$),sa.setState({buffer:s.buffer,xselect:void 0,xcursor:U+($??"").length})}function y(U){const F=s.buffer.length-1,$=Ci(U,0,F);sa.setState({bufferindex:$,xcursor:s.buffer[$].length,ycursor:0,xselect:void 0,yselect:void 0})}function E(U){U?he(s.xselect)||sa.setState({xselect:s.xcursor,yselect:s.ycursor}):sa.setState({xselect:void 0,yselect:void 0})}function w(){he(s.xselect)&&(sa.setState({xcursor:l,xselect:void 0,yselect:void 0}),g(l,h))}function R(){sa.setState({xcursor:c.length,ycursor:0,xselect:void 0,yselect:void 0})}if(r.reset.bg=TS(i),!i){H0(!1,!1,0,0,r);const U="main:0.32.35 - if lost try #help";r.x=a.right-U.length,Wn(`$dkcyan${U}`,r,!0)}const A="$196",I="$205".repeat(a.width-6);H0(!1,!1,0,a.height-2,r),Wn(`  ${A}${I}${A}  `,r,!0);const N=c.padEnd(a.width," ");if(H0(!1,!1,0,a.height-1,r),PY(N,r,!0),he(s.xselect)&&he(s.yselect)&&s.xcursor!==s.xselect){const U=Math.min(s.xcursor,s.xselect),F=Math.min(s.ycursor,s.yselect),$=Math.max(s.xcursor,s.xselect)-1,q=Math.max(s.ycursor,s.yselect);for(let K=F;K<=q;++K){const W=U+(a.bottom-K)*a.width,X=$+(a.bottom-K)*a.width;XM(W,X,15,8,r)}}if(n){const U=a.left+s.xcursor,F=a.top+t;YM(U+F*r.width,"Ý",r)}return ft.useEffect(()=>{let U=s.scroll;t<4&&U++,t>a.bottom-4&&U--,sa.setState({scroll:Math.round(Ci(U,0,e))})},[s.scroll,t,e,a.bottom]),De.jsxs(De.Fragment,{children:[De.jsx(JZ,{blocking:!0,x:a.left,y:a.top,width:a.width,height:a.height,onScroll:U=>{E(!1),sa.setState({ycursor:Ci(Math.round(s.ycursor-U),0,e)})}}),De.jsx(da,{keydown:U=>{const{key:F}=U,$=rr(F),q=fN(U);switch($){case"arrowleft":E(q.shift),q.ctrl?sa.setState({xcursor:0}):sa.setState({xcursor:Ci(s.xcursor-(q.alt?10:1),0,a.right)});break;case"arrowright":E(q.shift),q.ctrl?sa.setState({xcursor:p?c.length:a.right}):sa.setState({xcursor:Ci(s.xcursor+(q.alt?10:1),0,a.right)});break;case"arrowup":q.ctrl?y(s.bufferindex+1):(E(q.shift),sa.setState({ycursor:Ci(Math.round(s.ycursor+(q.alt?10:1)),0,e)}));break;case"arrowdown":q.ctrl?y(s.bufferindex-1):(E(q.shift),sa.setState({ycursor:Ci(Math.round(s.ycursor-(q.alt?10:1)),0,e)}));break;case"enter":{const K=d?f:c;K.length&&(p?(sa.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:["",K,...s.buffer.slice(1).filter(W=>W!==K)]}),Cw(qe,K,o),i&&wR(qe,o)):R());break}case"esc":case"escape":wR(qe,o);break;case"tab":VW(qe,!q.shift,o);break;case"delete":p?d?w():c.length>0&&g(s.xcursor,1):R();break;case"backspace":p?d?w():s.xcursor>0&&g(s.xcursor-1,1):R();break;default:if(q.ctrl)switch($){case"a":sa.setState({xselect:0,yselect:0,xcursor:c.length,ycursor:0});break;case"c":p&&he(ua())?ua().writeText(f).catch(K=>console.error(K)):R();break;case"v":p&&he(ua())?ua().readText().then(K=>{const W=K.replaceAll("\r","");d?g(l,h,W):g(s.xcursor,0,W)}).catch(K=>console.error(K)):R();break;case"x":p&&he(ua())?ua().writeText(f).then(()=>w()).catch(K=>console.error(K)):R();break}else q.alt||F.length===1&&(p&&s.xcursor<=c.length?d?(g(l,h,F),sa.setState({xselect:void 0})):g(s.xcursor,0,F):R());break}}})]})}function _We({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const o=tf(),a=ft.useCallback(()=>{if(he(ua())){const[,...l]=i,u=l.join(" ");ua().writeText(u).then(()=>Oi(qe,"copied!")).catch(d=>console.error(d))}},[i]),c=Wd(!!e);return H0(!!t,!!e,0,s,o),Wn(`${n} $purple$16 $yellowCOPYIT ${c}${r}`,o,!0),e&&De.jsx(da,{OK_BUTTON:a})}function yWe({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const o=tf(),a=ft.useContext(YZ),c=ft.useCallback(()=>{const[u,d]=i;a.sendmessage(u,d)},[i,a]),l=Wd(!!e);return H0(!!t,!!e,0,s,o),Wn(`${n} $purple$16 ${l}${r}`,o,!0),e&&De.jsx(da,{OK_BUTTON:c})}function bWe({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const o=tf(),a=ft.useCallback(()=>{const[,...l]=i,u=l.join(" ");window.open(u,"_blank")},[i]),c=Wd(!!e);return H0(!!t,!!e,0,s,o),Wn(`${n} $purple$16 $yellowOPENIT ${c}${r}`,o,!0),e&&De.jsx(da,{OK_BUTTON:a})}function QZ({blink:t,active:e,text:n,y:r}){const i=tf(),{quickterminal:s}=Us(),o=ef(i),a=n.startsWith("!");if(H0(!!t,!!e,0,r,i),i.reset.bg=e?rj:TS(s),i.active.bottomedge=o.bottom,Wn(a?"":n,i,!0),a){const[c,...l]=n.slice(1).split("!"),u=`${l.join("!")}`;let d="PRESS ME";const h=[];WM(u,!0).tokens.forEach(E=>{switch(E.tokenType){case R3:d=E.image.slice(1);break;default:h.push(E.image);break}});const[f,...g]=h,y={blink:t,active:e,prefix:c,label:d,words:g,y:r};switch(rr(f)){case"copyit":return De.jsx(_We,{...y,words:h});case"openit":return De.jsx(bWe,{...y,words:h});default:case"hyperlink":return De.jsx(yWe,{...y,words:h});case"hk":case"hotkey":return null;case"rn":case"range":return null;case"sl":case"select":return null;case"nm":case"number":return null;case"tx":case"text":return null;case"zssedit":return null;case"charedit":return null;case"coloredit":return null}}return null}function EWe(t){const e=Vd();return De.jsx(QZ,{active:!0,blink:e,...t})}function ID(){const t=Ni(),[e]=Us(Rp(p=>[p.editor.open])),n=Us(Rp(p=>p.terminal.logs)),r=tf(),i=sa(),s=ef(r),o=n.map(p=>{const[,f,g,...y]=p;let E="$white";switch(f){case"debug":E="$yellow";break;case"error":E="$red";break}const w=y.map(k=>`${k}`).join(" "),R=w.startsWith("!"),A=`$onclear$blue${E}${g}$blue$180$blue`;return`${R?"!":""}${A}${w}`}),a=o.map(p=>{if(p.startsWith("!"))return 1;const f=KM(p,s.width,s.height);return(f==null?void 0:f.y)??1}),c=s.bottom-s.top-(e?0:2);let l=0,u=c+1;const d=a.map(p=>(u-=p,l+=p,u));++l;const h=s.bottom-i.ycursor+i.scroll;return De.jsxs(De.Fragment,{children:[De.jsx(ij,{context:r}),De.jsxs(YZ.Provider,{value:{sendmessage(p,f){const[g,y]=gWe(p);if(g==="self"){const E=`#${y} ${f??""}`;Cw(qe,E,t)}else qe.emit(`${g}:${y}`,f,t)}},children:[o.map((p,f)=>{const g=d[f]+i.scroll,y=a[f],E=g+y;return E<0||g>c?null:!e&&h>=g&&h<E?De.jsx(EWe,{text:p,y:g},f):De.jsx(QZ,{text:p,y:g},f)}),!e&&De.jsx(vWe,{tapeycursor:h,logrowtotalheight:l})]})]})}function rz(t,e,n,r,i){return{...i,x:t,y:e,reset:{...Gc(i.reset),topedge:e,leftedge:t,rightedge:n,bottomedge:r},active:{...Gc(i.active),topedge:e,leftedge:t,rightedge:n,bottomedge:r}}}function SWe({context:t}){const[e,n]=Us(Rp(d=>[d.layout,d.editor.open])),r=0,i=0,s=t.width-1,o=t.height-1,a=ef(t),c=Math.floor(a.height*.5),l=ft.useMemo(()=>rz(i,r,s,c-1,t),[c,s,t]),u=ft.useMemo(()=>rz(i,c,s,o,t),[c,s,o,t]);if(n)switch(e){case zu.SPLIT_Y:return De.jsxs(De.Fragment,{children:[De.jsx(Pv.Provider,{value:l,children:De.jsx(ID,{})}),De.jsx(Pv.Provider,{value:u,children:De.jsx(MD,{})})]});case zu.SPLIT_Y_ALT:return De.jsxs(De.Fragment,{children:[De.jsx(Pv.Provider,{value:l,children:De.jsx(MD,{})}),De.jsx(Pv.Provider,{value:u,children:De.jsx(ID,{})})]});default:return De.jsx(Pv.Provider,{value:t,children:De.jsx(MD,{})})}return De.jsx(Pv.Provider,{value:t,children:De.jsx(ID,{})},"single")}function TWe(){const t=nj();let e=0,n=t.rows-2;const[r,i,s,o]=Us(Rp(h=>[h.layout,h.quickterminal,h.terminal.open,h.editor.open]));switch(r){case zu.TOP:n=Math.floor(t.rows*.5);break;case zu.BOTTOM:n=Math.ceil(t.rows*.5),e=t.rows-n;break;default:case zu.FULL:break}const a=TS(i),c=JM(t.cols,n,0,tS,a),l={...Ty(t.cols,n,tS,a),...c.getState()};if(t.cols<10||t.rows<10)return null;const u=Ni(),d=i||s||o;return De.jsxs(pN,{store:c,children:[d&&De.jsx(MA,{width:t.cols,height:t.rows,top:e,left:0,right:t.cols-1,bottom:e+n-1}),d?De.jsxs(Oy,{blockhotkeys:!0,children:[De.jsx(ij,{context:l}),De.jsx(SWe,{context:l}),De.jsx("group",{position:[0,e*ar.DRAW_CHAR_HEIGHT(),0],children:De.jsx(mN,{width:t.cols,height:n})})]}):De.jsx(pE,{hotkey:"Shift+?",children:()=>Cde(qe,u)})]})}var ZZ={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(self,()=>(()=>{var n={9669:(o,a,c)=>{o.exports=c(1609)},5448:(o,a,c)=>{var l=c(4867),u=c(6026),d=c(4372),h=c(5327),p=c(4097),f=c(4109),g=c(7985),y=c(7874),E=c(2648),w=c(644),R=c(205);o.exports=function(A){return new Promise(function(k,I){var N,U=A.data,F=A.headers,$=A.responseType;function q(){A.cancelToken&&A.cancelToken.unsubscribe(N),A.signal&&A.signal.removeEventListener("abort",N)}l.isFormData(U)&&l.isStandardBrowserEnv()&&delete F["Content-Type"];var K=new XMLHttpRequest;if(A.auth){var W=A.auth.username||"",X=A.auth.password?unescape(encodeURIComponent(A.auth.password)):"";F.Authorization="Basic "+btoa(W+":"+X)}var ne=p(A.baseURL,A.url);function Z(){if(K){var Q="getAllResponseHeaders"in K?f(K.getAllResponseHeaders()):null,se={data:$&&$!=="text"&&$!=="json"?K.response:K.responseText,status:K.status,statusText:K.statusText,headers:Q,config:A,request:K};u(function(ve){k(ve),q()},function(ve){I(ve),q()},se),K=null}}if(K.open(A.method.toUpperCase(),h(ne,A.params,A.paramsSerializer),!0),K.timeout=A.timeout,"onloadend"in K?K.onloadend=Z:K.onreadystatechange=function(){K&&K.readyState===4&&(K.status!==0||K.responseURL&&K.responseURL.indexOf("file:")===0)&&setTimeout(Z)},K.onabort=function(){K&&(I(new E("Request aborted",E.ECONNABORTED,A,K)),K=null)},K.onerror=function(){I(new E("Network Error",E.ERR_NETWORK,A,K,K)),K=null},K.ontimeout=function(){var Q=A.timeout?"timeout of "+A.timeout+"ms exceeded":"timeout exceeded",se=A.transitional||y;A.timeoutErrorMessage&&(Q=A.timeoutErrorMessage),I(new E(Q,se.clarifyTimeoutError?E.ETIMEDOUT:E.ECONNABORTED,A,K)),K=null},l.isStandardBrowserEnv()){var ie=(A.withCredentials||g(ne))&&A.xsrfCookieName?d.read(A.xsrfCookieName):void 0;ie&&(F[A.xsrfHeaderName]=ie)}"setRequestHeader"in K&&l.forEach(F,function(Q,se){U===void 0&&se.toLowerCase()==="content-type"?delete F[se]:K.setRequestHeader(se,Q)}),l.isUndefined(A.withCredentials)||(K.withCredentials=!!A.withCredentials),$&&$!=="json"&&(K.responseType=A.responseType),typeof A.onDownloadProgress=="function"&&K.addEventListener("progress",A.onDownloadProgress),typeof A.onUploadProgress=="function"&&K.upload&&K.upload.addEventListener("progress",A.onUploadProgress),(A.cancelToken||A.signal)&&(N=function(Q){K&&(I(!Q||Q&&Q.type?new w:Q),K.abort(),K=null)},A.cancelToken&&A.cancelToken.subscribe(N),A.signal&&(A.signal.aborted?N():A.signal.addEventListener("abort",N))),U||(U=null);var G=R(ne);G&&["http","https","file"].indexOf(G)===-1?I(new E("Unsupported protocol "+G+":",E.ERR_BAD_REQUEST,A)):K.send(U)})}},1609:(o,a,c)=>{var l=c(4867),u=c(1849),d=c(321),h=c(7185),p=function f(g){var y=new d(g),E=u(d.prototype.request,y);return l.extend(E,d.prototype,y),l.extend(E,y),E.create=function(w){return f(h(g,w))},E}(c(5546));p.Axios=d,p.CanceledError=c(644),p.CancelToken=c(4972),p.isCancel=c(6502),p.VERSION=c(7288).version,p.toFormData=c(7675),p.AxiosError=c(2648),p.Cancel=p.CanceledError,p.all=function(f){return Promise.all(f)},p.spread=c(8713),p.isAxiosError=c(6268),o.exports=p,o.exports.default=p},4972:(o,a,c)=>{var l=c(644);function u(d){if(typeof d!="function")throw new TypeError("executor must be a function.");var h;this.promise=new Promise(function(f){h=f});var p=this;this.promise.then(function(f){if(p._listeners){var g,y=p._listeners.length;for(g=0;g<y;g++)p._listeners[g](f);p._listeners=null}}),this.promise.then=function(f){var g,y=new Promise(function(E){p.subscribe(E),g=E}).then(f);return y.cancel=function(){p.unsubscribe(g)},y},d(function(f){p.reason||(p.reason=new l(f),h(p.reason))})}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.prototype.subscribe=function(d){this.reason?d(this.reason):this._listeners?this._listeners.push(d):this._listeners=[d]},u.prototype.unsubscribe=function(d){if(this._listeners){var h=this._listeners.indexOf(d);h!==-1&&this._listeners.splice(h,1)}},u.source=function(){var d;return{token:new u(function(h){d=h}),cancel:d}},o.exports=u},644:(o,a,c)=>{var l=c(2648);function u(d){l.call(this,d??"canceled",l.ERR_CANCELED),this.name="CanceledError"}c(4867).inherits(u,l,{__CANCEL__:!0}),o.exports=u},6502:o=>{o.exports=function(a){return!(!a||!a.__CANCEL__)}},321:(o,a,c)=>{var l=c(4867),u=c(5327),d=c(782),h=c(3572),p=c(7185),f=c(4097),g=c(4875),y=g.validators;function E(w){this.defaults=w,this.interceptors={request:new d,response:new d}}E.prototype.request=function(w,R){typeof w=="string"?(R=R||{}).url=w:R=w||{},(R=p(this.defaults,R)).method?R.method=R.method.toLowerCase():this.defaults.method?R.method=this.defaults.method.toLowerCase():R.method="get";var A=R.transitional;A!==void 0&&g.assertOptions(A,{silentJSONParsing:y.transitional(y.boolean),forcedJSONParsing:y.transitional(y.boolean),clarifyTimeoutError:y.transitional(y.boolean)},!1);var k=[],I=!0;this.interceptors.request.forEach(function(W){typeof W.runWhen=="function"&&W.runWhen(R)===!1||(I=I&&W.synchronous,k.unshift(W.fulfilled,W.rejected))});var N,U=[];if(this.interceptors.response.forEach(function(W){U.push(W.fulfilled,W.rejected)}),!I){var F=[h,void 0];for(Array.prototype.unshift.apply(F,k),F=F.concat(U),N=Promise.resolve(R);F.length;)N=N.then(F.shift(),F.shift());return N}for(var $=R;k.length;){var q=k.shift(),K=k.shift();try{$=q($)}catch(W){K(W);break}}try{N=h($)}catch(W){return Promise.reject(W)}for(;U.length;)N=N.then(U.shift(),U.shift());return N},E.prototype.getUri=function(w){w=p(this.defaults,w);var R=f(w.baseURL,w.url);return u(R,w.params,w.paramsSerializer)},l.forEach(["delete","get","head","options"],function(w){E.prototype[w]=function(R,A){return this.request(p(A||{},{method:w,url:R,data:(A||{}).data}))}}),l.forEach(["post","put","patch"],function(w){function R(A){return function(k,I,N){return this.request(p(N||{},{method:w,headers:A?{"Content-Type":"multipart/form-data"}:{},url:k,data:I}))}}E.prototype[w]=R(),E.prototype[w+"Form"]=R(!0)}),o.exports=E},2648:(o,a,c)=>{var l=c(4867);function u(p,f,g,y,E){Error.call(this),this.message=p,this.name="AxiosError",f&&(this.code=f),g&&(this.config=g),y&&(this.request=y),E&&(this.response=E)}l.inherits(u,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var d=u.prototype,h={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(p){h[p]={value:p}}),Object.defineProperties(u,h),Object.defineProperty(d,"isAxiosError",{value:!0}),u.from=function(p,f,g,y,E,w){var R=Object.create(d);return l.toFlatObject(p,R,function(A){return A!==Error.prototype}),u.call(R,p.message,f,g,y,E),R.name=p.name,w&&Object.assign(R,w),R},o.exports=u},782:(o,a,c)=>{var l=c(4867);function u(){this.handlers=[]}u.prototype.use=function(d,h,p){return this.handlers.push({fulfilled:d,rejected:h,synchronous:!!p&&p.synchronous,runWhen:p?p.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(d){this.handlers[d]&&(this.handlers[d]=null)},u.prototype.forEach=function(d){l.forEach(this.handlers,function(h){h!==null&&d(h)})},o.exports=u},4097:(o,a,c)=>{var l=c(1793),u=c(7303);o.exports=function(d,h){return d&&!l(h)?u(d,h):h}},3572:(o,a,c)=>{var l=c(4867),u=c(8527),d=c(6502),h=c(5546),p=c(644);function f(g){if(g.cancelToken&&g.cancelToken.throwIfRequested(),g.signal&&g.signal.aborted)throw new p}o.exports=function(g){return f(g),g.headers=g.headers||{},g.data=u.call(g,g.data,g.headers,g.transformRequest),g.headers=l.merge(g.headers.common||{},g.headers[g.method]||{},g.headers),l.forEach(["delete","get","head","post","put","patch","common"],function(y){delete g.headers[y]}),(g.adapter||h.adapter)(g).then(function(y){return f(g),y.data=u.call(g,y.data,y.headers,g.transformResponse),y},function(y){return d(y)||(f(g),y&&y.response&&(y.response.data=u.call(g,y.response.data,y.response.headers,g.transformResponse))),Promise.reject(y)})}},7185:(o,a,c)=>{var l=c(4867);o.exports=function(u,d){d=d||{};var h={};function p(R,A){return l.isPlainObject(R)&&l.isPlainObject(A)?l.merge(R,A):l.isPlainObject(A)?l.merge({},A):l.isArray(A)?A.slice():A}function f(R){return l.isUndefined(d[R])?l.isUndefined(u[R])?void 0:p(void 0,u[R]):p(u[R],d[R])}function g(R){if(!l.isUndefined(d[R]))return p(void 0,d[R])}function y(R){return l.isUndefined(d[R])?l.isUndefined(u[R])?void 0:p(void 0,u[R]):p(void 0,d[R])}function E(R){return R in d?p(u[R],d[R]):R in u?p(void 0,u[R]):void 0}var w={url:g,method:g,data:g,baseURL:y,transformRequest:y,transformResponse:y,paramsSerializer:y,timeout:y,timeoutMessage:y,withCredentials:y,adapter:y,responseType:y,xsrfCookieName:y,xsrfHeaderName:y,onUploadProgress:y,onDownloadProgress:y,decompress:y,maxContentLength:y,maxBodyLength:y,beforeRedirect:y,transport:y,httpAgent:y,httpsAgent:y,cancelToken:y,socketPath:y,responseEncoding:y,validateStatus:E};return l.forEach(Object.keys(u).concat(Object.keys(d)),function(R){var A=w[R]||f,k=A(R);l.isUndefined(k)&&A!==E||(h[R]=k)}),h}},6026:(o,a,c)=>{var l=c(2648);o.exports=function(u,d,h){var p=h.config.validateStatus;h.status&&p&&!p(h.status)?d(new l("Request failed with status code "+h.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(h.status/100)-4],h.config,h.request,h)):u(h)}},8527:(o,a,c)=>{var l=c(4867),u=c(5546);o.exports=function(d,h,p){var f=this||u;return l.forEach(p,function(g){d=g.call(f,d,h)}),d}},5546:(o,a,c)=>{var l=c(4867),u=c(6016),d=c(2648),h=c(7874),p=c(7675),f={"Content-Type":"application/x-www-form-urlencoded"};function g(w,R){!l.isUndefined(w)&&l.isUndefined(w["Content-Type"])&&(w["Content-Type"]=R)}var y,E={transitional:h,adapter:((typeof XMLHttpRequest<"u"||typeof Bn<"u"&&Object.prototype.toString.call(Bn)==="[object process]")&&(y=c(5448)),y),transformRequest:[function(w,R){if(u(R,"Accept"),u(R,"Content-Type"),l.isFormData(w)||l.isArrayBuffer(w)||l.isBuffer(w)||l.isStream(w)||l.isFile(w)||l.isBlob(w))return w;if(l.isArrayBufferView(w))return w.buffer;if(l.isURLSearchParams(w))return g(R,"application/x-www-form-urlencoded;charset=utf-8"),w.toString();var A,k=l.isObject(w),I=R&&R["Content-Type"];if((A=l.isFileList(w))||k&&I==="multipart/form-data"){var N=this.env&&this.env.FormData;return p(A?{"files[]":w}:w,N&&new N)}return k||I==="application/json"?(g(R,"application/json"),function(U,F,$){if(l.isString(U))try{return(F||JSON.parse)(U),l.trim(U)}catch(q){if(q.name!=="SyntaxError")throw q}return(0,JSON.stringify)(U)}(w)):w}],transformResponse:[function(w){var R=this.transitional||E.transitional,A=R&&R.silentJSONParsing,k=R&&R.forcedJSONParsing,I=!A&&this.responseType==="json";if(I||k&&l.isString(w)&&w.length)try{return JSON.parse(w)}catch(N){if(I)throw N.name==="SyntaxError"?d.from(N,d.ERR_BAD_RESPONSE,this,null,this.response):N}return w}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c(1623)},validateStatus:function(w){return w>=200&&w<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],function(w){E.headers[w]={}}),l.forEach(["post","put","patch"],function(w){E.headers[w]=l.merge(f)}),o.exports=E},7874:o=>{o.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},7288:o=>{o.exports={version:"0.27.2"}},1849:o=>{o.exports=function(a,c){return function(){for(var l=new Array(arguments.length),u=0;u<l.length;u++)l[u]=arguments[u];return a.apply(c,l)}}},5327:(o,a,c)=>{var l=c(4867);function u(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}o.exports=function(d,h,p){if(!h)return d;var f;if(p)f=p(h);else if(l.isURLSearchParams(h))f=h.toString();else{var g=[];l.forEach(h,function(E,w){E!=null&&(l.isArray(E)?w+="[]":E=[E],l.forEach(E,function(R){l.isDate(R)?R=R.toISOString():l.isObject(R)&&(R=JSON.stringify(R)),g.push(u(w)+"="+u(R))}))}),f=g.join("&")}if(f){var y=d.indexOf("#");y!==-1&&(d=d.slice(0,y)),d+=(d.indexOf("?")===-1?"?":"&")+f}return d}},7303:o=>{o.exports=function(a,c){return c?a.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):a}},4372:(o,a,c)=>{var l=c(4867);o.exports=l.isStandardBrowserEnv()?{write:function(u,d,h,p,f,g){var y=[];y.push(u+"="+encodeURIComponent(d)),l.isNumber(h)&&y.push("expires="+new Date(h).toGMTString()),l.isString(p)&&y.push("path="+p),l.isString(f)&&y.push("domain="+f),g===!0&&y.push("secure"),document.cookie=y.join("; ")},read:function(u){var d=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:o=>{o.exports=function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}},6268:(o,a,c)=>{var l=c(4867);o.exports=function(u){return l.isObject(u)&&u.isAxiosError===!0}},7985:(o,a,c)=>{var l=c(4867);o.exports=l.isStandardBrowserEnv()?function(){var u,d=/(msie|trident)/i.test(navigator.userAgent),h=document.createElement("a");function p(f){var g=f;return d&&(h.setAttribute("href",g),g=h.href),h.setAttribute("href",g),{href:h.href,protocol:h.protocol?h.protocol.replace(/:$/,""):"",host:h.host,search:h.search?h.search.replace(/^\?/,""):"",hash:h.hash?h.hash.replace(/^#/,""):"",hostname:h.hostname,port:h.port,pathname:h.pathname.charAt(0)==="/"?h.pathname:"/"+h.pathname}}return u=p(window.location.href),function(f){var g=l.isString(f)?p(f):f;return g.protocol===u.protocol&&g.host===u.host}}():function(){return!0}},6016:(o,a,c)=>{var l=c(4867);o.exports=function(u,d){l.forEach(u,function(h,p){p!==d&&p.toUpperCase()===d.toUpperCase()&&(u[d]=h,delete u[p])})}},1623:o=>{o.exports=null},4109:(o,a,c)=>{var l=c(4867),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];o.exports=function(d){var h,p,f,g={};return d&&l.forEach(d.split(`
`),function(y){if(f=y.indexOf(":"),h=l.trim(y.substr(0,f)).toLowerCase(),p=l.trim(y.substr(f+1)),h){if(g[h]&&u.indexOf(h)>=0)return;g[h]=h==="set-cookie"?(g[h]?g[h]:[]).concat([p]):g[h]?g[h]+", "+p:p}}),g}},205:o=>{o.exports=function(a){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return c&&c[1]||""}},8713:o=>{o.exports=function(a){return function(c){return a.apply(null,c)}}},7675:(o,a,c)=>{var l=c(4867);o.exports=function(u,d){d=d||new FormData;var h=[];function p(f){return f===null?"":l.isDate(f)?f.toISOString():l.isArrayBuffer(f)||l.isTypedArray(f)?typeof Blob=="function"?new Blob([f]):Mc.from(f):f}return function f(g,y){if(l.isPlainObject(g)||l.isArray(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+y);h.push(g),l.forEach(g,function(E,w){if(!l.isUndefined(E)){var R,A=y?y+"."+w:w;if(E&&!y&&typeof E=="object"){if(l.endsWith(w,"{}"))E=JSON.stringify(E);else if(l.endsWith(w,"[]")&&(R=l.toArray(E)))return void R.forEach(function(k){!l.isUndefined(k)&&d.append(A,p(k))})}f(E,A)}}),h.pop()}else d.append(y,p(g))}(u),d}},4875:(o,a,c)=>{var l=c(7288).version,u=c(2648),d={};["object","boolean","number","function","string","symbol"].forEach(function(p,f){d[p]=function(g){return typeof g===p||"a"+(f<1?"n ":" ")+p}});var h={};d.transitional=function(p,f,g){function y(E,w){return"[Axios v"+l+"] Transitional option '"+E+"'"+w+(g?". "+g:"")}return function(E,w,R){if(p===!1)throw new u(y(w," has been removed"+(f?" in "+f:"")),u.ERR_DEPRECATED);return f&&!h[w]&&(h[w]=!0,console.warn(y(w," has been deprecated since v"+f+" and will be removed in the near future"))),!p||p(E,w,R)}},o.exports={assertOptions:function(p,f,g){if(typeof p!="object")throw new u("options must be an object",u.ERR_BAD_OPTION_VALUE);for(var y=Object.keys(p),E=y.length;E-- >0;){var w=y[E],R=f[w];if(R){var A=p[w],k=A===void 0||R(A,w,p);if(k!==!0)throw new u("option "+w+" must be "+k,u.ERR_BAD_OPTION_VALUE)}else if(g!==!0)throw new u("Unknown option "+w,u.ERR_BAD_OPTION)}},validators:d}},4867:(o,a,c)=>{var l,u=c(1849),d=Object.prototype.toString,h=(l=Object.create(null),function(K){var W=d.call(K);return l[W]||(l[W]=W.slice(8,-1).toLowerCase())});function p(K){return K=K.toLowerCase(),function(W){return h(W)===K}}function f(K){return Array.isArray(K)}function g(K){return K===void 0}var y=p("ArrayBuffer");function E(K){return K!==null&&typeof K=="object"}function w(K){if(h(K)!=="object")return!1;var W=Object.getPrototypeOf(K);return W===null||W===Object.prototype}var R=p("Date"),A=p("File"),k=p("Blob"),I=p("FileList");function N(K){return d.call(K)==="[object Function]"}var U=p("URLSearchParams");function F(K,W){if(K!=null)if(typeof K!="object"&&(K=[K]),f(K))for(var X=0,ne=K.length;X<ne;X++)W.call(null,K[X],X,K);else for(var Z in K)Object.prototype.hasOwnProperty.call(K,Z)&&W.call(null,K[Z],Z,K)}var $,q=($=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(K){return $&&K instanceof $});o.exports={isArray:f,isArrayBuffer:y,isBuffer:function(K){return K!==null&&!g(K)&&K.constructor!==null&&!g(K.constructor)&&typeof K.constructor.isBuffer=="function"&&K.constructor.isBuffer(K)},isFormData:function(K){var W="[object FormData]";return K&&(typeof FormData=="function"&&K instanceof FormData||d.call(K)===W||N(K.toString)&&K.toString()===W)},isArrayBufferView:function(K){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(K):K&&K.buffer&&y(K.buffer)},isString:function(K){return typeof K=="string"},isNumber:function(K){return typeof K=="number"},isObject:E,isPlainObject:w,isUndefined:g,isDate:R,isFile:A,isBlob:k,isFunction:N,isStream:function(K){return E(K)&&N(K.pipe)},isURLSearchParams:U,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:F,merge:function K(){var W={};function X(ie,G){w(W[G])&&w(ie)?W[G]=K(W[G],ie):w(ie)?W[G]=K({},ie):f(ie)?W[G]=ie.slice():W[G]=ie}for(var ne=0,Z=arguments.length;ne<Z;ne++)F(arguments[ne],X);return W},extend:function(K,W,X){return F(W,function(ne,Z){K[Z]=X&&typeof ne=="function"?u(ne,X):ne}),K},trim:function(K){return K.trim?K.trim():K.replace(/^\s+|\s+$/g,"")},stripBOM:function(K){return K.charCodeAt(0)===65279&&(K=K.slice(1)),K},inherits:function(K,W,X,ne){K.prototype=Object.create(W.prototype,ne),K.prototype.constructor=K,X&&Object.assign(K.prototype,X)},toFlatObject:function(K,W,X){var ne,Z,ie,G={};W=W||{};do{for(Z=(ne=Object.getOwnPropertyNames(K)).length;Z-- >0;)G[ie=ne[Z]]||(W[ie]=K[ie],G[ie]=!0);K=Object.getPrototypeOf(K)}while(K&&(!X||X(K,W))&&K!==Object.prototype);return W},kindOf:h,kindOfTest:p,endsWith:function(K,W,X){K=String(K),(X===void 0||X>K.length)&&(X=K.length),X-=W.length;var ne=K.indexOf(W,X);return ne!==-1&&ne===X},toArray:function(K){if(!K)return null;var W=K.length;if(g(W))return null;for(var X=new Array(W);W-- >0;)X[W]=K[W];return X},isTypedArray:q,isFileList:I}},1206:function(o){o.exports=function(a){var c={};function l(u){if(c[u])return c[u].exports;var d=c[u]={i:u,l:!1,exports:{}};return a[u].call(d.exports,d,d.exports,l),d.l=!0,d.exports}return l.m=a,l.c=c,l.d=function(u,d,h){l.o(u,d)||Object.defineProperty(u,d,{enumerable:!0,get:h})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,d){if(1&d&&(u=l(u)),8&d||4&d&&typeof u=="object"&&u&&u.__esModule)return u;var h=Object.create(null);if(l.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:u}),2&d&&typeof u!="string")for(var p in u)l.d(h,p,(function(f){return u[f]}).bind(null,p));return h},l.n=function(u){var d=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(d,"a",d),d},l.o=function(u,d){return Object.prototype.hasOwnProperty.call(u,d)},l.p="",l(l.s=90)}({17:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=l(18),d=function(){function h(){}return h.getFirstMatch=function(p,f){var g=f.match(p);return g&&g.length>0&&g[1]||""},h.getSecondMatch=function(p,f){var g=f.match(p);return g&&g.length>1&&g[2]||""},h.matchAndReturnConst=function(p,f,g){if(p.test(f))return g},h.getWindowsVersionName=function(p){switch(p){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},h.getMacOSVersionName=function(p){var f=p.split(".").splice(0,2).map(function(g){return parseInt(g,10)||0});if(f.push(0),f[0]===10)switch(f[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},h.getAndroidVersionName=function(p){var f=p.split(".").splice(0,2).map(function(g){return parseInt(g,10)||0});if(f.push(0),!(f[0]===1&&f[1]<5))return f[0]===1&&f[1]<6?"Cupcake":f[0]===1&&f[1]>=6?"Donut":f[0]===2&&f[1]<2?"Eclair":f[0]===2&&f[1]===2?"Froyo":f[0]===2&&f[1]>2?"Gingerbread":f[0]===3?"Honeycomb":f[0]===4&&f[1]<1?"Ice Cream Sandwich":f[0]===4&&f[1]<4?"Jelly Bean":f[0]===4&&f[1]>=4?"KitKat":f[0]===5?"Lollipop":f[0]===6?"Marshmallow":f[0]===7?"Nougat":f[0]===8?"Oreo":f[0]===9?"Pie":void 0},h.getVersionPrecision=function(p){return p.split(".").length},h.compareVersions=function(p,f,g){g===void 0&&(g=!1);var y=h.getVersionPrecision(p),E=h.getVersionPrecision(f),w=Math.max(y,E),R=0,A=h.map([p,f],function(k){var I=w-h.getVersionPrecision(k),N=k+new Array(I+1).join(".0");return h.map(N.split("."),function(U){return new Array(20-U.length).join("0")+U}).reverse()});for(g&&(R=w-Math.min(y,E)),w-=1;w>=R;){if(A[0][w]>A[1][w])return 1;if(A[0][w]===A[1][w]){if(w===R)return 0;w-=1}else if(A[0][w]<A[1][w])return-1}},h.map=function(p,f){var g,y=[];if(Array.prototype.map)return Array.prototype.map.call(p,f);for(g=0;g<p.length;g+=1)y.push(f(p[g]));return y},h.find=function(p,f){var g,y;if(Array.prototype.find)return Array.prototype.find.call(p,f);for(g=0,y=p.length;g<y;g+=1){var E=p[g];if(f(E,g))return E}},h.assign=function(p){for(var f,g,y=p,E=arguments.length,w=new Array(E>1?E-1:0),R=1;R<E;R++)w[R-1]=arguments[R];if(Object.assign)return Object.assign.apply(Object,[p].concat(w));var A=function(){var k=w[f];typeof k=="object"&&k!==null&&Object.keys(k).forEach(function(I){y[I]=k[I]})};for(f=0,g=w.length;f<g;f+=1)A();return p},h.getBrowserAlias=function(p){return u.BROWSER_ALIASES_MAP[p]},h.getBrowserTypeByAlias=function(p){return u.BROWSER_MAP[p]||""},h}();c.default=d,a.exports=c.default},18:function(a,c,l){c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(91))&&u.__esModule?u:{default:u},h=l(18);function p(g,y){for(var E=0;E<y.length;E++){var w=y[E];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(g,w.key,w)}}var f=function(){function g(){}var y,E,w;return g.getParser=function(R,A){if(A===void 0&&(A=!1),typeof R!="string")throw new Error("UserAgent should be a string");return new d.default(R,A)},g.parse=function(R){return new d.default(R).getResult()},y=g,w=[{key:"BROWSER_MAP",get:function(){return h.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return h.ENGINE_MAP}},{key:"OS_MAP",get:function(){return h.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return h.PLATFORMS_MAP}}],(E=null)&&p(y.prototype,E),w&&p(y,w),g}();c.default=f,a.exports=c.default},91:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=g(l(92)),d=g(l(93)),h=g(l(94)),p=g(l(95)),f=g(l(17));function g(E){return E&&E.__esModule?E:{default:E}}var y=function(){function E(R,A){if(A===void 0&&(A=!1),R==null||R==="")throw new Error("UserAgent parameter can't be empty");this._ua=R,this.parsedResult={},A!==!0&&this.parse()}var w=E.prototype;return w.getUA=function(){return this._ua},w.test=function(R){return R.test(this._ua)},w.parseBrowser=function(){var R=this;this.parsedResult.browser={};var A=f.default.find(u.default,function(k){if(typeof k.test=="function")return k.test(R);if(k.test instanceof Array)return k.test.some(function(I){return R.test(I)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.browser=A.describe(this.getUA())),this.parsedResult.browser},w.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},w.getBrowserName=function(R){return R?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},w.getBrowserVersion=function(){return this.getBrowser().version},w.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},w.parseOS=function(){var R=this;this.parsedResult.os={};var A=f.default.find(d.default,function(k){if(typeof k.test=="function")return k.test(R);if(k.test instanceof Array)return k.test.some(function(I){return R.test(I)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.os=A.describe(this.getUA())),this.parsedResult.os},w.getOSName=function(R){var A=this.getOS().name;return R?String(A).toLowerCase()||"":A||""},w.getOSVersion=function(){return this.getOS().version},w.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},w.getPlatformType=function(R){R===void 0&&(R=!1);var A=this.getPlatform().type;return R?String(A).toLowerCase()||"":A||""},w.parsePlatform=function(){var R=this;this.parsedResult.platform={};var A=f.default.find(h.default,function(k){if(typeof k.test=="function")return k.test(R);if(k.test instanceof Array)return k.test.some(function(I){return R.test(I)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.platform=A.describe(this.getUA())),this.parsedResult.platform},w.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},w.getEngineName=function(R){return R?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},w.parseEngine=function(){var R=this;this.parsedResult.engine={};var A=f.default.find(p.default,function(k){if(typeof k.test=="function")return k.test(R);if(k.test instanceof Array)return k.test.some(function(I){return R.test(I)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.engine=A.describe(this.getUA())),this.parsedResult.engine},w.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},w.getResult=function(){return f.default.assign({},this.parsedResult)},w.satisfies=function(R){var A=this,k={},I=0,N={},U=0;if(Object.keys(R).forEach(function(Z){var ie=R[Z];typeof ie=="string"?(N[Z]=ie,U+=1):typeof ie=="object"&&(k[Z]=ie,I+=1)}),I>0){var F=Object.keys(k),$=f.default.find(F,function(Z){return A.isOS(Z)});if($){var q=this.satisfies(k[$]);if(q!==void 0)return q}var K=f.default.find(F,function(Z){return A.isPlatform(Z)});if(K){var W=this.satisfies(k[K]);if(W!==void 0)return W}}if(U>0){var X=Object.keys(N),ne=f.default.find(X,function(Z){return A.isBrowser(Z,!0)});if(ne!==void 0)return this.compareVersion(N[ne])}},w.isBrowser=function(R,A){A===void 0&&(A=!1);var k=this.getBrowserName().toLowerCase(),I=R.toLowerCase(),N=f.default.getBrowserTypeByAlias(I);return A&&N&&(I=N.toLowerCase()),I===k},w.compareVersion=function(R){var A=[0],k=R,I=!1,N=this.getBrowserVersion();if(typeof N=="string")return R[0]===">"||R[0]==="<"?(k=R.substr(1),R[1]==="="?(I=!0,k=R.substr(2)):A=[],R[0]===">"?A.push(1):A.push(-1)):R[0]==="="?k=R.substr(1):R[0]==="~"&&(I=!0,k=R.substr(1)),A.indexOf(f.default.compareVersions(N,k,I))>-1},w.isOS=function(R){return this.getOSName(!0)===String(R).toLowerCase()},w.isPlatform=function(R){return this.getPlatformType(!0)===String(R).toLowerCase()},w.isEngine=function(R){return this.getEngineName(!0)===String(R).toLowerCase()},w.is=function(R,A){return A===void 0&&(A=!1),this.isBrowser(R,A)||this.isOS(R)||this.isPlatform(R)},w.some=function(R){var A=this;return R===void 0&&(R=[]),R.some(function(k){return A.is(k)})},E}();c.default=y,a.exports=c.default},92:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(17))&&u.__esModule?u:{default:u},h=/version\/(\d+(\.?_?\d+)+)/i,p=[{test:[/googlebot/i],describe:function(f){var g={name:"Googlebot"},y=d.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/opera/i],describe:function(f){var g={name:"Opera"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/opr\/|opios/i],describe:function(f){var g={name:"Opera"},y=d.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/SamsungBrowser/i],describe:function(f){var g={name:"Samsung Internet for Android"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/Whale/i],describe:function(f){var g={name:"NAVER Whale Browser"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/MZBrowser/i],describe:function(f){var g={name:"MZ Browser"},y=d.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/focus/i],describe:function(f){var g={name:"Focus"},y=d.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/swing/i],describe:function(f){var g={name:"Swing"},y=d.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/coast/i],describe:function(f){var g={name:"Opera Coast"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(f){var g={name:"Opera Touch"},y=d.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/yabrowser/i],describe:function(f){var g={name:"Yandex Browser"},y=d.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/ucbrowser/i],describe:function(f){var g={name:"UC Browser"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/Maxthon|mxios/i],describe:function(f){var g={name:"Maxthon"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/epiphany/i],describe:function(f){var g={name:"Epiphany"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/puffin/i],describe:function(f){var g={name:"Puffin"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/sleipnir/i],describe:function(f){var g={name:"Sleipnir"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/k-meleon/i],describe:function(f){var g={name:"K-Meleon"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/micromessenger/i],describe:function(f){var g={name:"WeChat"},y=d.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/qqbrowser/i],describe:function(f){var g={name:/qqbrowserlite/i.test(f)?"QQ Browser Lite":"QQ Browser"},y=d.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/msie|trident/i],describe:function(f){var g={name:"Internet Explorer"},y=d.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/\sedg\//i],describe:function(f){var g={name:"Microsoft Edge"},y=d.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/edg([ea]|ios)/i],describe:function(f){var g={name:"Microsoft Edge"},y=d.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/vivaldi/i],describe:function(f){var g={name:"Vivaldi"},y=d.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/seamonkey/i],describe:function(f){var g={name:"SeaMonkey"},y=d.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/sailfish/i],describe:function(f){var g={name:"Sailfish"},y=d.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,f);return y&&(g.version=y),g}},{test:[/silk/i],describe:function(f){var g={name:"Amazon Silk"},y=d.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/phantom/i],describe:function(f){var g={name:"PhantomJS"},y=d.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/slimerjs/i],describe:function(f){var g={name:"SlimerJS"},y=d.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(f){var g={name:"BlackBerry"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/(web|hpw)[o0]s/i],describe:function(f){var g={name:"WebOS Browser"},y=d.default.getFirstMatch(h,f)||d.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/bada/i],describe:function(f){var g={name:"Bada"},y=d.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/tizen/i],describe:function(f){var g={name:"Tizen"},y=d.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/qupzilla/i],describe:function(f){var g={name:"QupZilla"},y=d.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/firefox|iceweasel|fxios/i],describe:function(f){var g={name:"Firefox"},y=d.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/electron/i],describe:function(f){var g={name:"Electron"},y=d.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/MiuiBrowser/i],describe:function(f){var g={name:"Miui"},y=d.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/chromium/i],describe:function(f){var g={name:"Chromium"},y=d.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,f)||d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/chrome|crios|crmo/i],describe:function(f){var g={name:"Chrome"},y=d.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/GSA/i],describe:function(f){var g={name:"Google Search"},y=d.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:function(f){var g=!f.test(/like android/i),y=f.test(/android/i);return g&&y},describe:function(f){var g={name:"Android Browser"},y=d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/playstation 4/i],describe:function(f){var g={name:"PlayStation 4"},y=d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/safari|applewebkit/i],describe:function(f){var g={name:"Safari"},y=d.default.getFirstMatch(h,f);return y&&(g.version=y),g}},{test:[/.*/i],describe:function(f){var g=f.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:d.default.getFirstMatch(g,f),version:d.default.getSecondMatch(g,f)}}}];c.default=p,a.exports=c.default},93:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(17))&&u.__esModule?u:{default:u},h=l(18),p=[{test:[/Roku\/DVP/],describe:function(f){var g=d.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,f);return{name:h.OS_MAP.Roku,version:g}}},{test:[/windows phone/i],describe:function(f){var g=d.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,f);return{name:h.OS_MAP.WindowsPhone,version:g}}},{test:[/windows /i],describe:function(f){var g=d.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,f),y=d.default.getWindowsVersionName(g);return{name:h.OS_MAP.Windows,version:g,versionName:y}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(f){var g={name:h.OS_MAP.iOS},y=d.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,f);return y&&(g.version=y),g}},{test:[/macintosh/i],describe:function(f){var g=d.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,f).replace(/[_\s]/g,"."),y=d.default.getMacOSVersionName(g),E={name:h.OS_MAP.MacOS,version:g};return y&&(E.versionName=y),E}},{test:[/(ipod|iphone|ipad)/i],describe:function(f){var g=d.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,f).replace(/[_\s]/g,".");return{name:h.OS_MAP.iOS,version:g}}},{test:function(f){var g=!f.test(/like android/i),y=f.test(/android/i);return g&&y},describe:function(f){var g=d.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,f),y=d.default.getAndroidVersionName(g),E={name:h.OS_MAP.Android,version:g};return y&&(E.versionName=y),E}},{test:[/(web|hpw)[o0]s/i],describe:function(f){var g=d.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,f),y={name:h.OS_MAP.WebOS};return g&&g.length&&(y.version=g),y}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(f){var g=d.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,f)||d.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,f)||d.default.getFirstMatch(/\bbb(\d+)/i,f);return{name:h.OS_MAP.BlackBerry,version:g}}},{test:[/bada/i],describe:function(f){var g=d.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,f);return{name:h.OS_MAP.Bada,version:g}}},{test:[/tizen/i],describe:function(f){var g=d.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,f);return{name:h.OS_MAP.Tizen,version:g}}},{test:[/linux/i],describe:function(){return{name:h.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:h.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(f){var g=d.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,f);return{name:h.OS_MAP.PlayStation4,version:g}}}];c.default=p,a.exports=c.default},94:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(17))&&u.__esModule?u:{default:u},h=l(18),p=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(f){var g=d.default.getFirstMatch(/(can-l01)/i,f)&&"Nova",y={type:h.PLATFORMS_MAP.mobile,vendor:"Huawei"};return g&&(y.model=g),y}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet}}},{test:function(f){var g=f.test(/ipod|iphone/i),y=f.test(/like (ipod|iphone)/i);return g&&!y},describe:function(f){var g=d.default.getFirstMatch(/(ipod|iphone)/i,f);return{type:h.PLATFORMS_MAP.mobile,vendor:"Apple",model:g}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:h.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:h.PLATFORMS_MAP.mobile}}},{test:function(f){return f.getBrowserName(!0)==="blackberry"},describe:function(){return{type:h.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(f){return f.getBrowserName(!0)==="bada"},describe:function(){return{type:h.PLATFORMS_MAP.mobile}}},{test:function(f){return f.getBrowserName()==="windows phone"},describe:function(){return{type:h.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(f){var g=Number(String(f.getOSVersion()).split(".")[0]);return f.getOSName(!0)==="android"&&g>=3},describe:function(){return{type:h.PLATFORMS_MAP.tablet}}},{test:function(f){return f.getOSName(!0)==="android"},describe:function(){return{type:h.PLATFORMS_MAP.mobile}}},{test:function(f){return f.getOSName(!0)==="macos"},describe:function(){return{type:h.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(f){return f.getOSName(!0)==="windows"},describe:function(){return{type:h.PLATFORMS_MAP.desktop}}},{test:function(f){return f.getOSName(!0)==="linux"},describe:function(){return{type:h.PLATFORMS_MAP.desktop}}},{test:function(f){return f.getOSName(!0)==="playstation 4"},describe:function(){return{type:h.PLATFORMS_MAP.tv}}},{test:function(f){return f.getOSName(!0)==="roku"},describe:function(){return{type:h.PLATFORMS_MAP.tv}}}];c.default=p,a.exports=c.default},95:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(17))&&u.__esModule?u:{default:u},h=l(18),p=[{test:function(f){return f.getBrowserName(!0)==="microsoft edge"},describe:function(f){if(/\sedg\//i.test(f))return{name:h.ENGINE_MAP.Blink};var g=d.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,f);return{name:h.ENGINE_MAP.EdgeHTML,version:g}}},{test:[/trident/i],describe:function(f){var g={name:h.ENGINE_MAP.Trident},y=d.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:function(f){return f.test(/presto/i)},describe:function(f){var g={name:h.ENGINE_MAP.Presto},y=d.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:function(f){var g=f.test(/gecko/i),y=f.test(/like gecko/i);return g&&!y},describe:function(f){var g={name:h.ENGINE_MAP.Gecko},y=d.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:h.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(f){var g={name:h.ENGINE_MAP.WebKit},y=d.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,f);return y&&(g.version=y),g}}];c.default=p,a.exports=c.default}})},6729:o=>{var a=Object.prototype.hasOwnProperty,c="~";function l(){}function u(f,g,y){this.fn=f,this.context=g,this.once=y||!1}function d(f,g,y,E,w){if(typeof y!="function")throw new TypeError("The listener must be a function");var R=new u(y,E||f,w),A=c?c+g:g;return f._events[A]?f._events[A].fn?f._events[A]=[f._events[A],R]:f._events[A].push(R):(f._events[A]=R,f._eventsCount++),f}function h(f,g){--f._eventsCount==0?f._events=new l:delete f._events[g]}function p(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(c=!1)),p.prototype.eventNames=function(){var f,g,y=[];if(this._eventsCount===0)return y;for(g in f=this._events)a.call(f,g)&&y.push(c?g.slice(1):g);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(f)):y},p.prototype.listeners=function(f){var g=c?c+f:f,y=this._events[g];if(!y)return[];if(y.fn)return[y.fn];for(var E=0,w=y.length,R=new Array(w);E<w;E++)R[E]=y[E].fn;return R},p.prototype.listenerCount=function(f){var g=c?c+f:f,y=this._events[g];return y?y.fn?1:y.length:0},p.prototype.emit=function(f,g,y,E,w,R){var A=c?c+f:f;if(!this._events[A])return!1;var k,I,N=this._events[A],U=arguments.length;if(N.fn){switch(N.once&&this.removeListener(f,N.fn,void 0,!0),U){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,g),!0;case 3:return N.fn.call(N.context,g,y),!0;case 4:return N.fn.call(N.context,g,y,E),!0;case 5:return N.fn.call(N.context,g,y,E,w),!0;case 6:return N.fn.call(N.context,g,y,E,w,R),!0}for(I=1,k=new Array(U-1);I<U;I++)k[I-1]=arguments[I];N.fn.apply(N.context,k)}else{var F,$=N.length;for(I=0;I<$;I++)switch(N[I].once&&this.removeListener(f,N[I].fn,void 0,!0),U){case 1:N[I].fn.call(N[I].context);break;case 2:N[I].fn.call(N[I].context,g);break;case 3:N[I].fn.call(N[I].context,g,y);break;case 4:N[I].fn.call(N[I].context,g,y,E);break;default:if(!k)for(F=1,k=new Array(U-1);F<U;F++)k[F-1]=arguments[F];N[I].fn.apply(N[I].context,k)}}return!0},p.prototype.on=function(f,g,y){return d(this,f,g,y,!1)},p.prototype.once=function(f,g,y){return d(this,f,g,y,!0)},p.prototype.removeListener=function(f,g,y,E){var w=c?c+f:f;if(!this._events[w])return this;if(!g)return h(this,w),this;var R=this._events[w];if(R.fn)R.fn!==g||E&&!R.once||y&&R.context!==y||h(this,w);else{for(var A=0,k=[],I=R.length;A<I;A++)(R[A].fn!==g||E&&!R[A].once||y&&R[A].context!==y)&&k.push(R[A]);k.length?this._events[w]=k.length===1?k[0]:k:h(this,w)}return this},p.prototype.removeAllListeners=function(f){var g;return f?(g=c?c+f:f,this._events[g]&&h(this,g)):(this._events=new l,this._eventsCount=0),this},p.prototype.off=p.prototype.removeListener,p.prototype.addListener=p.prototype.on,p.prefixed=c,p.EventEmitter=p,o.exports=p},1564:o=>{var a;a=()=>(()=>{var c={228:u=>{var d=Object.prototype.hasOwnProperty,h="~";function p(){}function f(w,R,A){this.fn=w,this.context=R,this.once=A||!1}function g(w,R,A,k,I){if(typeof A!="function")throw new TypeError("The listener must be a function");var N=new f(A,k||w,I),U=h?h+R:R;return w._events[U]?w._events[U].fn?w._events[U]=[w._events[U],N]:w._events[U].push(N):(w._events[U]=N,w._eventsCount++),w}function y(w,R){--w._eventsCount==0?w._events=new p:delete w._events[R]}function E(){this._events=new p,this._eventsCount=0}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(h=!1)),E.prototype.eventNames=function(){var w,R,A=[];if(this._eventsCount===0)return A;for(R in w=this._events)d.call(w,R)&&A.push(h?R.slice(1):R);return Object.getOwnPropertySymbols?A.concat(Object.getOwnPropertySymbols(w)):A},E.prototype.listeners=function(w){var R=h?h+w:w,A=this._events[R];if(!A)return[];if(A.fn)return[A.fn];for(var k=0,I=A.length,N=new Array(I);k<I;k++)N[k]=A[k].fn;return N},E.prototype.listenerCount=function(w){var R=h?h+w:w,A=this._events[R];return A?A.fn?1:A.length:0},E.prototype.emit=function(w,R,A,k,I,N){var U=h?h+w:w;if(!this._events[U])return!1;var F,$,q=this._events[U],K=arguments.length;if(q.fn){switch(q.once&&this.removeListener(w,q.fn,void 0,!0),K){case 1:return q.fn.call(q.context),!0;case 2:return q.fn.call(q.context,R),!0;case 3:return q.fn.call(q.context,R,A),!0;case 4:return q.fn.call(q.context,R,A,k),!0;case 5:return q.fn.call(q.context,R,A,k,I),!0;case 6:return q.fn.call(q.context,R,A,k,I,N),!0}for($=1,F=new Array(K-1);$<K;$++)F[$-1]=arguments[$];q.fn.apply(q.context,F)}else{var W,X=q.length;for($=0;$<X;$++)switch(q[$].once&&this.removeListener(w,q[$].fn,void 0,!0),K){case 1:q[$].fn.call(q[$].context);break;case 2:q[$].fn.call(q[$].context,R);break;case 3:q[$].fn.call(q[$].context,R,A);break;case 4:q[$].fn.call(q[$].context,R,A,k);break;default:if(!F)for(W=1,F=new Array(K-1);W<K;W++)F[W-1]=arguments[W];q[$].fn.apply(q[$].context,F)}}return!0},E.prototype.on=function(w,R,A){return g(this,w,R,A,!1)},E.prototype.once=function(w,R,A){return g(this,w,R,A,!0)},E.prototype.removeListener=function(w,R,A,k){var I=h?h+w:w;if(!this._events[I])return this;if(!R)return y(this,I),this;var N=this._events[I];if(N.fn)N.fn!==R||k&&!N.once||A&&N.context!==A||y(this,I);else{for(var U=0,F=[],$=N.length;U<$;U++)(N[U].fn!==R||k&&!N[U].once||A&&N[U].context!==A)&&F.push(N[U]);F.length?this._events[I]=F.length===1?F[0]:F:y(this,I)}return this},E.prototype.removeAllListeners=function(w){var R;return w?(R=h?h+w:w,this._events[R]&&y(this,R)):(this._events=new p,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=h,E.EventEmitter=E,u.exports=E},815:function(u,d){var h,p,f=this&&this.__extends||(h=function(G,Q){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(se,ve){se.__proto__=ve}||function(se,ve){for(var Oe in ve)Object.prototype.hasOwnProperty.call(ve,Oe)&&(se[Oe]=ve[Oe])},h(G,Q)},function(G,Q){if(typeof Q!="function"&&Q!==null)throw new TypeError("Class extends value "+String(Q)+" is not a constructor or null");function se(){this.constructor=G}h(G,Q),G.prototype=Q===null?Object.create(Q):(se.prototype=Q.prototype,new se)});function g(G){return 60*G*60}function y(G){return 60*G*60*24}Object.defineProperty(d,"__esModule",{value:!0}),d.daysToSeconds=d.hoursToSeconds=d.ConfigurationHolder=d.ConfigurationManager=d.Env=void 0,function(G){G.BETA="beta",G.PROD="prod",G.CUSTOM="custom"}(p||(d.Env=p={})),d.hoursToSeconds=g,d.daysToSeconds=y;var E=function(G){function Q(se){return G.call(this,se)||this}return f(Q,G),Q}(Error),w="data",R="metrics",A=g(1),k=y(3),I=g(2),N="base64",U=function(){function G(Q,se){var ve,Oe,_e,le,xe,Ee,Se,Ie;if(!se.fileKey)throw new Error("options.fileKey cannot be empty");var Ze=(ve=se.clock)!==null&&ve!==void 0?ve:new ne,_t=Ze.getMillis();switch(this.context=Q,this.fileKey=se.fileKey,this.env=se.standardEnv,se.standardEnv){case p.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case p.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case p.CUSTOM:if(!se.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=se.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(se.standardEnv))}this.trace=(Oe=se.trace)!==null&&Oe!==void 0?Oe:new K(this.env),this.fetch=(_e=se.fetch)!==null&&_e!==void 0?_e:new q(Q),this.storage=new X("amazon_ivs_device_config_v1_"+se.fileKey,Q.localStorage),this.state=new ie(this.storage,"state"),this.refresh={refreshIntervalSeconds:(le=se.refresh.refreshIntervalSeconds)!==null&&le!==void 0?le:A,retryCount:(xe=se.refresh.retryCount)!==null&&xe!==void 0?xe:3,retryIntervalSeconds:(Ee=se.refresh.retryIntervalSeconds)!==null&&Ee!==void 0?Ee:10,maxCacheAgeSeconds:(Se=se.refresh.maxCacheAgeSeconds)!==null&&Se!==void 0?Se:k,stopRefreshAfterSeconds:(Ie=se.refresh.stopRefreshAfterSeconds)!==null&&Ie!==void 0?Ie:I,canRefreshNow:se.refresh.canRefreshNow},this.clock=Ze,this.isInitialRefreshDone=!1;var fe=0,ge=this.state.getState();ge&&ge.fetchServer===this.fetchServer&&ge.lastFetchWhenMs&&(fe=ge.lastFetchWhenMs);var rt=Ze.getMillis(),Re=(rt-fe)/1e3;if(Re<=this.refresh.maxCacheAgeSeconds){var St=this.storage.getJson(w);St&&St.fetchServer===this.fetchServer&&this.setData(St.json)}if(this.lastUseMs=rt,Re>=this.refresh.refreshIntervalSeconds||fe==0)this.trace.onTrace("Will start refresh right now"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),0);else{var Ge=Math.round(this.refresh.refreshIntervalSeconds-Re);this.trace.onTrace("Will start refresh in "+Ge+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*Ge),this.isInitialRefreshDone=!0}var kt=Ze.getMillis();this.initialLoadTime=kt-_t}return G.getInstance=function(Q,se){try{if(!(Q.fetch&&Q.setTimeout&&Q.clearTimeout&&Q.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(ve){return void console.error("Error checking for context properties "+ve)}if(this.gInstance){if(this.gInstance.fileKey!=se.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(se.fileKey));return this.gInstance}return this.gInstance=new G(Q,se),this.gInstance},G.prototype.getConfigurationHolder=function(Q){var se,ve=this,Oe=this.clock.getMillis();this.lastUseMs=Oe;var _e=(se=Q.analytics)!==null&&se!==void 0?se:new W(this.env);this.context.setTimeout(function(){ve.emitMetrics(_e)});var le=0,xe=this.state.getState();return xe&&xe.fetchServer===this.fetchServer&&xe.lastFetchWhenMs&&(le=xe.lastFetchWhenMs),(Oe-le)/1e3<=this.refresh.maxCacheAgeSeconds?new F(_e,this.properties):new F(_e,void 0)},G.prototype.getFetchUrl=function(){var Q="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),se=new URL(Q);return se.searchParams.set("version","1.0"),se},G.clearInstance=function(){var Q;(Q=this.gInstance)===null||Q===void 0||Q.clearInstanceImpl(),this.gInstance=void 0},G.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},G.prototype.startRefresh=function(){var Q=this;this.trace.onTrace("Starting refresh request..."),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0);var se=this.clock.getMillis();return(se-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds?(this.trace.onTrace("Actually will not refresh due to refresh timeout"),void(this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds))):this.isInitialRefreshDone&&!this.refresh.canRefreshNow()?(this.trace.onTrace("Will not refresh due to callback having returned false"),void(this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds))):void this.fetchData().then(function(ve){Q.processResponse(ve,se)}).catch(function(ve){Q.exceptionMetrics(ve),Q.trace.onTrace("Fetch error: "+ve),Q.refresh.retryCount>0&&Q.scheduleRetry(1)}).finally(function(){Q.isInitialRefreshDone=!0,Q.fetchTask=Q.context.setTimeout(Q.startRefresh.bind(Q),1e3*Q.refresh.refreshIntervalSeconds)})},G.prototype.fetchData=function(){var Q=this.getFetchUrl(),se=new Headers,ve=this.state.getState();return ve.fetchServer===this.fetchServer&&(ve.lastFetchWhenFullMs&&this.clock.getMillis()-ve.lastFetchWhenFullMs>1e3*g(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&ve.lastFetchEtagHeader&&se.set("If-None-Match",ve.lastFetchEtagHeader)),this.incrementMetrics("fetch_attempt_count"),this.fetch.fetchUrl(Q,se)},G.prototype.processResponse=function(Q,se){var ve={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},Oe=Q.headers.get("etag");Oe&&(ve.lastFetchEtagHeader=Oe);try{if(Q.status<300&&Q.json)if(this.setData(Q.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(w,{fetchServer:this.fetchServer,json:Q.json});var _e=this.clock.getMillis();ve.lastFetchWhenFullMs=_e,this.incrementMetricsWithDuration("success_new_data_count",_e-se)}else this.incrementMetrics("fail_invalid_data_count");else{if(Q.status!==304){var le="Unexpected http fetch status: "+Q.status;throw this.trace.onTrace(le),new E(le)}this.trace.onTrace("Server said no change in data"),_e=this.clock.getMillis(),this.incrementMetricsWithDuration("success_no_change_count",_e-se)}}finally{this.state.setState(ve)}},G.prototype.scheduleRetry=function(Q){var se=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var ve=Q*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout(function(){se.retryTask=void 0,se.fetchRetry(Q)},1e3*ve)},G.prototype.fetchRetry=function(Q){var se=this;this.trace.onTrace("Starting retry request ".concat(Q,"..."));var ve=this.clock.getMillis();this.fetchData().then(function(Oe){se.processResponse(Oe,ve)}).catch(function(Oe){se.exceptionMetrics(Oe),se.trace.onTrace("Fetch error: "+Oe),se.refresh.retryCount>Q&&se.scheduleRetry(Q+1)})},G.prototype.setData=function(Q){if(!Q)return!1;if(Q.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var se=Q.properties;if(!se||!Array.isArray(se))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var ve=new Map,Oe=0,_e=se;Oe<_e.length;Oe++){var le=_e[Oe];if(le.name&&le.type&&this.isValidValueType(le.type)){if(le.value_string&&typeof le.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof le.value_string);continue}if(le.value_number&&typeof le.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof le.value_number);continue}if(le.value_boolean&&typeof le.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof le.value_boolean);continue}if(le.value_json&&typeof le.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof le.value_json);continue}if(le.value_analytics&&typeof le.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof le.value_analytics);continue}var xe=new Z(le.name,this.parseValueType(le.type),le.value_string,le.value_number,le.value_boolean,le.value_json,le.value_analytics,le.encoding);ve.set(xe.name,xe)}}return ve.size!=0&&(this.properties=ve,!0)},G.prototype.isValidValueType=function(Q){return Q==="string"||Q==="number"||Q==="boolean"||Q=="json"},G.prototype.parseValueType=function(Q){switch(Q){case"string":return $.STRING;case"number":return $.NUMBER;case"boolean":return $.BOOLEAN;case"json":return $.JSON;default:throw new Error("Unsupported value type ".concat(Q))}},G.prototype.emitMetrics=function(Q){var se,ve,Oe,_e,le,xe,Ee,Se,Ie=(se=this.storage.getJson(R))!==null&&se!==void 0?se:{},Ze={initial_load_time:this.initialLoadTime,fetch_attempt_count:(ve=Ie.fetch_attempt_count)!==null&&ve!==void 0?ve:0,fetch_duration_average:(Oe=Ie.fetch_duration_average)!==null&&Oe!==void 0?Oe:0,success_no_change_count:(_e=Ie.success_no_change_count)!==null&&_e!==void 0?_e:0,success_new_data_count:(le=Ie.success_new_data_count)!==null&&le!==void 0?le:0,fail_exception_count:(xe=Ie.fail_exception_count)!==null&&xe!==void 0?xe:0,fail_http_error_count:(Ee=Ie.fail_http_error_count)!==null&&Ee!==void 0?Ee:0,fail_invalid_data_count:(Se=Ie.fail_invalid_data_count)!==null&&Se!==void 0?Se:0};Q.onMetrics(Ze),Ie.fetch_attempt_count=0,Ie.success_no_change_count=0,Ie.success_new_data_count=0,Ie.fail_exception_count=0,Ie.fail_http_error_count=0,Ie.fail_invalid_data_count=0,this.storage.setJson(R,Ie)},G.prototype.exceptionMetrics=function(Q){Q instanceof E||Q.message.startsWith("http error")?this.incrementMetrics("fail_http_error_count"):this.incrementMetrics("fail_exception_count")},G.prototype.incrementMetrics=function(Q){var se,ve,Oe=(se=this.storage.getJson(R))!==null&&se!==void 0?se:{};Oe[Q]=((ve=Oe[Q])!==null&&ve!==void 0?ve:0)+1,this.storage.setJson(R,Oe)},G.prototype.incrementMetricsWithDuration=function(Q,se){var ve,Oe,_e=(ve=this.storage.getJson(R))!==null&&ve!==void 0?ve:{};_e[Q]=((Oe=_e[Q])!==null&&Oe!==void 0?Oe:0)+1,se>0&&(_e.fetch_duration_average!==void 0?_e.fetch_duration_average=.9*_e.fetch_duration_average+.1*se|0:_e.fetch_duration_average=se),this.storage.setJson(R,_e)},G}();d.ConfigurationManager=U;var F=function(){function G(Q,se){this.analytics=Q,this.properties=se}return G.prototype.getSize=function(){return this.properties?this.properties.size:-1},G.prototype.getStringValue=function(Q){var se,ve;if(this.properties){var Oe=this.properties.get(Q);if(Oe){if(Oe.type===$.STRING){var _e=(se=Oe.valueString)!==null&&se!==void 0?se:"";return this.analytics.onValue(Q,(ve=Oe.valueAnalytics)!==null&&ve!==void 0?ve:_e),_e}this.analytics.onError(Q,"Type is not string")}}else this.analytics.onTrace(Q,"Configuration is not available")},G.prototype.getNumberValue=function(Q){var se,ve;if(this.properties){var Oe=this.properties.get(Q);if(Oe){if(Oe.type===$.NUMBER){var _e=(se=Oe.valueNumber)!==null&&se!==void 0?se:0;return this.analytics.onValue(Q,(ve=Oe.valueAnalytics)!==null&&ve!==void 0?ve:_e.toString()),_e}this.analytics.onError(Q,"Type is not number")}}else this.analytics.onTrace(Q,"Configuration is not available")},G.prototype.getBooleanValue=function(Q){var se,ve;if(this.properties){var Oe=this.properties.get(Q);if(Oe){if(Oe.type===$.BOOLEAN){var _e=(se=Oe.valueBoolean)!==null&&se!==void 0&&se;return this.analytics.onValue(Q,(ve=Oe.valueAnalytics)!==null&&ve!==void 0?ve:_e.toString()),_e}this.analytics.onError(Q,"Type is not boolean")}}else this.analytics.onTrace(Q,"Configuration is not available")},G.prototype.getJsonValue=function(Q){var se,ve;if(this.properties){var Oe=this.properties.get(Q);if(Oe){if(Oe.type===$.JSON){var _e=Oe.valueJson;if(!_e)return this.analytics.onValue(Q,(se=Oe.valueAnalytics)!==null&&se!==void 0?se:""),null;try{var le=JSON.parse(_e);return this.analytics.onValue(Q,(ve=Oe.valueAnalytics)!==null&&ve!==void 0?ve:_e),le}catch{return void this.analytics.onError(Q,"Json parse error")}}this.analytics.onError(Q,"Type is not json")}}else this.analytics.onTrace(Q,"Configuration is not available")},G}();d.ConfigurationHolder=F;var $,q=function(){function G(Q){this.context=Q}return G.prototype.fetchUrl=function(Q,se){var ve=this;return new Promise(function(Oe,_e){ve.context.fetch(Q,{headers:se,cache:"no-store"}).then(function(le){if(le.status>=400)_e(new E("http error ".concat(le.status,", ").concat(le.statusText)));else{var xe={status:le.status,headers:le.headers};le.json().then(function(Ee){xe.json=Ee}).catch(function(){}).finally(function(){Oe(xe)})}}).catch(function(le){_e(le)})})},G}(),K=function(){function G(Q){this.env=Q}return G.prototype.onTrace=function(Q){this.env!=p.PROD&&console.log("Configuration: "+Q)},G}(),W=function(){function G(Q){this.env=Q}return G.prototype.onMetrics=function(Q){this.env!=p.PROD&&console.log("Metrics",Q)},G.prototype.onValue=function(Q,se){this.env!=p.PROD&&console.log("Configuration for ".concat(Q,": value = ").concat(se))},G.prototype.onError=function(Q,se){this.env!=p.PROD&&console.error("Configuration for ".concat(Q,": error = ").concat(se))},G.prototype.onTrace=function(Q,se){this.env!=p.PROD&&console.log("Configuration for ".concat(Q,": trace = ").concat(se))},G}(),X=function(){function G(Q,se){this.prefix=Q,this.storage=se}return G.prototype.getJson=function(Q){var se=this.prefix+"_"+Q;try{var ve=this.storage.getItem(se);if(ve)return JSON.parse(ve)}catch(Oe){console.error("Error getting local storage key ".concat(se)+Oe)}return null},G.prototype.setJson=function(Q,se){var ve=this.prefix+"_"+Q;try{this.storage.setItem(ve,JSON.stringify(se))}catch(Oe){console.error("Error setting local storage key ".concat(ve,": ")+Oe)}},G}(),ne=function(){function G(){}return G.prototype.getMillis=function(){return Date.now()},G}();(function(G){G[G.STRING=0]="STRING",G[G.NUMBER=1]="NUMBER",G[G.BOOLEAN=2]="BOOLEAN",G[G.JSON=3]="JSON"})($||($={}));var Z=function(G,Q,se,ve,Oe,_e,le,xe){switch(this.name=G,this.type=Q,this.valueString=se,this.valueNumber=ve,this.valueBoolean=Oe,this.valueJson=_e,this.valueAnalytics=le,this.type){case $.STRING:xe===N&&se&&(this.valueString=atob(se));break;case $.JSON:xe===N&&_e&&(this.valueJson=atob(_e))}},ie=function(){function G(Q,se){var ve;this.storage=Q,this.key=se,this.state=(ve=Q.getJson(se))!==null&&ve!==void 0?ve:{}}return G.prototype.getState=function(){return this.state},G.prototype.setState=function(Q){Object.assign(this.state,Q),this.storage.setJson(this.key,this.state)},G}()},456:function(u,d,h){var p=this&&this.__createBinding||(Object.create?function(g,y,E,w){w===void 0&&(w=E);var R=Object.getOwnPropertyDescriptor(y,E);R&&!("get"in R?!y.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return y[E]}}),Object.defineProperty(g,w,R)}:function(g,y,E,w){w===void 0&&(w=E),g[w]=y[E]}),f=this&&this.__exportStar||function(g,y){for(var E in g)E==="default"||Object.prototype.hasOwnProperty.call(y,E)||p(y,g,E)};Object.defineProperty(d,"__esModule",{value:!0}),f(h(903),d)},903:function(u,d,h){var p=this&&this.__spreadArray||function(y,E,w){if(w||arguments.length===2)for(var R,A=0,k=E.length;A<k;A++)!R&&A in E||(R||(R=Array.prototype.slice.call(E,0,A)),R[A]=E[A]);return y.concat(R||Array.prototype.slice.call(E))};Object.defineProperty(d,"__esModule",{value:!0}),d.TypedEmitter=void 0;var f=h(228),g=function(){function y(E){var w=E.propagateErrors;this.emitter=new f.EventEmitter,this.propagateErrors=w!=null&&w}return y.prototype.on=function(E,w){w.call=this.wrapCall(E,w),this.emitter.on(E,w)},y.prototype.off=function(E,w){this.emitter.off(E,w)},y.prototype.emit=function(E){for(var w,R=[],A=1;A<arguments.length;A++)R[A-1]=arguments[A];(w=this.emitter).emit.apply(w,p([E],R,!1))},y.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},y.prototype.wrapCall=function(E,w){var R=this;return function(A){for(var k=[],I=1;I<arguments.length;I++)k[I-1]=arguments[I];if(R.propagateErrors)w.apply(A,k);else try{w.apply(A,k)}catch(F){var N="Error in callback for ".concat(E),U=w.name;return U&&(N+=" for function ".concat(U)),void console.error(N,F)}}},y}();d.TypedEmitter=g},987:function(u,d,h){var p,f=this&&this.__extends||(p=function(k,I){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,U){N.__proto__=U}||function(N,U){for(var F in U)Object.prototype.hasOwnProperty.call(U,F)&&(N[F]=U[F])},p(k,I)},function(k,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function N(){this.constructor=k}p(k,I),k.prototype=I===null?Object.create(I):(N.prototype=I.prototype,new N)}),g=this&&this.__createBinding||(Object.create?function(k,I,N,U){U===void 0&&(U=N);var F=Object.getOwnPropertyDescriptor(I,N);F&&!("get"in F?!I.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return I[N]}}),Object.defineProperty(k,U,F)}:function(k,I,N,U){U===void 0&&(U=N),k[U]=I[N]}),y=this&&this.__setModuleDefault||(Object.create?function(k,I){Object.defineProperty(k,"default",{enumerable:!0,value:I})}:function(k,I){k.default=I}),E=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var I={};if(k!=null)for(var N in k)N!=="default"&&Object.prototype.hasOwnProperty.call(k,N)&&g(I,k,N);return y(I,k),I};Object.defineProperty(d,"__esModule",{value:!0}),d.createFsm=d.FsmWildcardState=d.RejectedTransitionError=d.InvalidStateTransitionError=void 0;var w=E(h(293)),R=function(k){function I(N,U){var F=k.call(this,"Invalid transition from '".concat(U,"' via event '").concat(N,"'"))||this;return F.name="InvalidStateTransitionError",F}return f(I,k),I}(Error);d.InvalidStateTransitionError=R;var A=function(k){function I(N,U,F){var $=k.call(this,"Transition from '".concat(U,"' via event '").concat(N,"' was rejected for: ").concat(F))||this;return $.name="RejectedTransitionError",$}return f(I,k),I}(Error);d.RejectedTransitionError=A,d.FsmWildcardState="*",d.createFsm=function(k){var I,N=k.transitions,U=k.callbacks,F=k.initialState,$=function(q){var K,W=(K=N[q])===null||K===void 0?void 0:K.from;return!!W&&(typeof W=="string"?W===d.FsmWildcardState:W.includes(F))};return{canTransition:$,transition:function(q,K){var W,X,ne,Z,ie,G;if(!$(q))return w.err(new R(String(F),String(q)));var Q=N[q];return Q.shouldTransition===void 0||Q.shouldTransition(F)?((X=(W=U==null?void 0:U[F])===null||W===void 0?void 0:W.onExiting)===null||X===void 0||X.call(W),(ne=U==null?void 0:U.onStateExiting)===null||ne===void 0||ne.call(U,F),I=F,F=Q.to,(ie=(Z=U==null?void 0:U[F])===null||Z===void 0?void 0:Z.onChanged)===null||ie===void 0||ie.call(Z,I,K),(G=U==null?void 0:U.onStateChanged)===null||G===void 0||G.call(U,I,F,K),w.ok(F)):w.err(new A(String(F),String(q),"shouldTransition returned false"))},previousState:function(){return I},currentState:function(){return F}}}},156:function(u,d,h){var p=this&&this.__createBinding||(Object.create?function(g,y,E,w){w===void 0&&(w=E);var R=Object.getOwnPropertyDescriptor(y,E);R&&!("get"in R?!y.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return y[E]}}),Object.defineProperty(g,w,R)}:function(g,y,E,w){w===void 0&&(w=E),g[w]=y[E]}),f=this&&this.__exportStar||function(g,y){for(var E in g)E==="default"||Object.prototype.hasOwnProperty.call(y,E)||p(y,g,E)};Object.defineProperty(d,"__esModule",{value:!0}),d.VERSION=void 0,d.VERSION="0.2.0",f(h(815),d),f(h(456),d),f(h(987),d),f(h(293),d)},293:(u,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.getErr=d.getOk_or=d.getOk=d.isNotOk=d.isOk=d.err=d.ok=void 0,d.ok=function(h){return{ok:!0,value:h}},d.err=function(h){return{ok:!1,error:h}},d.isOk=function(h){return h.ok===!0},d.isNotOk=function(h){return!(0,d.isOk)(h)},d.getOk=function(h){return h.ok===!0?h.value:void 0},d.getOk_or=function(h,p){return h.ok===!0?h.value:p},d.getErr=function(h){return h.ok===!0?void 0:h.error}}},l={};return function u(d){var h=l[d];if(h!==void 0)return h.exports;var p=l[d]={exports:{}};return c[d].call(p.exports,p,p.exports,u),p.exports}(156)})(),o.exports=a()},1989:(o,a,c)=>{var l=c(1789),u=c(401),d=c(7667),h=c(1327),p=c(1866);function f(g){var y=-1,E=g==null?0:g.length;for(this.clear();++y<E;){var w=g[y];this.set(w[0],w[1])}}f.prototype.clear=l,f.prototype.delete=u,f.prototype.get=d,f.prototype.has=h,f.prototype.set=p,o.exports=f},8407:(o,a,c)=>{var l=c(7040),u=c(4125),d=c(2117),h=c(7518),p=c(4705);function f(g){var y=-1,E=g==null?0:g.length;for(this.clear();++y<E;){var w=g[y];this.set(w[0],w[1])}}f.prototype.clear=l,f.prototype.delete=u,f.prototype.get=d,f.prototype.has=h,f.prototype.set=p,o.exports=f},7071:(o,a,c)=>{var l=c(852)(c(5639),"Map");o.exports=l},3369:(o,a,c)=>{var l=c(4785),u=c(1285),d=c(6e3),h=c(9916),p=c(5265);function f(g){var y=-1,E=g==null?0:g.length;for(this.clear();++y<E;){var w=g[y];this.set(w[0],w[1])}}f.prototype.clear=l,f.prototype.delete=u,f.prototype.get=d,f.prototype.has=h,f.prototype.set=p,o.exports=f},6384:(o,a,c)=>{var l=c(8407),u=c(7465),d=c(3779),h=c(7599),p=c(4758),f=c(4309);function g(y){var E=this.__data__=new l(y);this.size=E.size}g.prototype.clear=u,g.prototype.delete=d,g.prototype.get=h,g.prototype.has=p,g.prototype.set=f,o.exports=g},2705:(o,a,c)=>{var l=c(5639).Symbol;o.exports=l},1149:(o,a,c)=>{var l=c(5639).Uint8Array;o.exports=l},6874:o=>{o.exports=function(a,c,l){switch(l.length){case 0:return a.call(c);case 1:return a.call(c,l[0]);case 2:return a.call(c,l[0],l[1]);case 3:return a.call(c,l[0],l[1],l[2])}return a.apply(c,l)}},4636:(o,a,c)=>{var l=c(2545),u=c(5694),d=c(1469),h=c(4144),p=c(5776),f=c(6719),g=Object.prototype.hasOwnProperty;o.exports=function(y,E){var w=d(y),R=!w&&u(y),A=!w&&!R&&h(y),k=!w&&!R&&!A&&f(y),I=w||R||A||k,N=I?l(y.length,String):[],U=N.length;for(var F in y)!E&&!g.call(y,F)||I&&(F=="length"||A&&(F=="offset"||F=="parent")||k&&(F=="buffer"||F=="byteLength"||F=="byteOffset")||p(F,U))||N.push(F);return N}},6556:(o,a,c)=>{var l=c(9465),u=c(7813);o.exports=function(d,h,p){(p!==void 0&&!u(d[h],p)||p===void 0&&!(h in d))&&l(d,h,p)}},4865:(o,a,c)=>{var l=c(9465),u=c(7813),d=Object.prototype.hasOwnProperty;o.exports=function(h,p,f){var g=h[p];d.call(h,p)&&u(g,f)&&(f!==void 0||p in h)||l(h,p,f)}},8470:(o,a,c)=>{var l=c(7813);o.exports=function(u,d){for(var h=u.length;h--;)if(l(u[h][0],d))return h;return-1}},9465:(o,a,c)=>{var l=c(8777);o.exports=function(u,d,h){d=="__proto__"&&l?l(u,d,{configurable:!0,enumerable:!0,value:h,writable:!0}):u[d]=h}},3118:(o,a,c)=>{var l=c(3218),u=Object.create,d=function(){function h(){}return function(p){if(!l(p))return{};if(u)return u(p);h.prototype=p;var f=new h;return h.prototype=void 0,f}}();o.exports=d},8483:(o,a,c)=>{var l=c(5063)();o.exports=l},4239:(o,a,c)=>{var l=c(2705),u=c(9607),d=c(2333),h="[object Null]",p="[object Undefined]",f=l?l.toStringTag:void 0;o.exports=function(g){return g==null?g===void 0?p:h:f&&f in Object(g)?u(g):d(g)}},9454:(o,a,c)=>{var l=c(4239),u=c(7005),d="[object Arguments]";o.exports=function(h){return u(h)&&l(h)==d}},8458:(o,a,c)=>{var l=c(3560),u=c(5346),d=c(3218),h=c(346),p=/^\[object .+?Constructor\]$/,f=Function.prototype,g=Object.prototype,y=f.toString,E=g.hasOwnProperty,w=RegExp("^"+y.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(R){return!(!d(R)||u(R))&&(l(R)?w:p).test(h(R))}},8749:(o,a,c)=>{var l=c(4239),u=c(1780),d=c(7005),h={};h["[object Float32Array]"]=h["[object Float64Array]"]=h["[object Int8Array]"]=h["[object Int16Array]"]=h["[object Int32Array]"]=h["[object Uint8Array]"]=h["[object Uint8ClampedArray]"]=h["[object Uint16Array]"]=h["[object Uint32Array]"]=!0,h["[object Arguments]"]=h["[object Array]"]=h["[object ArrayBuffer]"]=h["[object Boolean]"]=h["[object DataView]"]=h["[object Date]"]=h["[object Error]"]=h["[object Function]"]=h["[object Map]"]=h["[object Number]"]=h["[object Object]"]=h["[object RegExp]"]=h["[object Set]"]=h["[object String]"]=h["[object WeakMap]"]=!1,o.exports=function(p){return d(p)&&u(p.length)&&!!h[l(p)]}},313:(o,a,c)=>{var l=c(3218),u=c(5726),d=c(3498),h=Object.prototype.hasOwnProperty;o.exports=function(p){if(!l(p))return d(p);var f=u(p),g=[];for(var y in p)(y!="constructor"||!f&&h.call(p,y))&&g.push(y);return g}},2980:(o,a,c)=>{var l=c(6384),u=c(6556),d=c(8483),h=c(9783),p=c(3218),f=c(1704),g=c(6390);o.exports=function y(E,w,R,A,k){E!==w&&d(w,function(I,N){if(k||(k=new l),p(I))h(E,w,N,R,y,A,k);else{var U=A?A(g(E,N),I,N+"",E,w,k):void 0;U===void 0&&(U=I),u(E,N,U)}},f)}},9783:(o,a,c)=>{var l=c(6556),u=c(4626),d=c(7133),h=c(278),p=c(8517),f=c(5694),g=c(1469),y=c(9246),E=c(4144),w=c(3560),R=c(3218),A=c(8630),k=c(6719),I=c(6390),N=c(9881);o.exports=function(U,F,$,q,K,W,X){var ne=I(U,$),Z=I(F,$),ie=X.get(Z);if(ie)l(U,$,ie);else{var G=W?W(ne,Z,$+"",U,F,X):void 0,Q=G===void 0;if(Q){var se=g(Z),ve=!se&&E(Z),Oe=!se&&!ve&&k(Z);G=Z,se||ve||Oe?g(ne)?G=ne:y(ne)?G=h(ne):ve?(Q=!1,G=u(Z,!0)):Oe?(Q=!1,G=d(Z,!0)):G=[]:A(Z)||f(Z)?(G=ne,f(ne)?G=N(ne):R(ne)&&!w(ne)||(G=p(Z))):Q=!1}Q&&(X.set(Z,G),K(G,Z,q,W,X),X.delete(Z)),l(U,$,G)}}},5976:(o,a,c)=>{var l=c(6557),u=c(5357),d=c(61);o.exports=function(h,p){return d(u(h,p,l),h+"")}},6560:(o,a,c)=>{var l=c(5703),u=c(8777),d=c(6557),h=u?function(p,f){return u(p,"toString",{configurable:!0,enumerable:!1,value:l(f),writable:!0})}:d;o.exports=h},2545:o=>{o.exports=function(a,c){for(var l=-1,u=Array(a);++l<a;)u[l]=c(l);return u}},1717:o=>{o.exports=function(a){return function(c){return a(c)}}},4318:(o,a,c)=>{var l=c(1149);o.exports=function(u){var d=new u.constructor(u.byteLength);return new l(d).set(new l(u)),d}},4626:(o,a,c)=>{o=c.nmd(o);var l=c(5639),u=a&&!a.nodeType&&a,d=u&&o&&!o.nodeType&&o,h=d&&d.exports===u?l.Buffer:void 0,p=h?h.allocUnsafe:void 0;o.exports=function(f,g){if(g)return f.slice();var y=f.length,E=p?p(y):new f.constructor(y);return f.copy(E),E}},7133:(o,a,c)=>{var l=c(4318);o.exports=function(u,d){var h=d?l(u.buffer):u.buffer;return new u.constructor(h,u.byteOffset,u.length)}},278:o=>{o.exports=function(a,c){var l=-1,u=a.length;for(c||(c=Array(u));++l<u;)c[l]=a[l];return c}},8363:(o,a,c)=>{var l=c(4865),u=c(9465);o.exports=function(d,h,p,f){var g=!p;p||(p={});for(var y=-1,E=h.length;++y<E;){var w=h[y],R=f?f(p[w],d[w],w,p,d):void 0;R===void 0&&(R=d[w]),g?u(p,w,R):l(p,w,R)}return p}},4429:(o,a,c)=>{var l=c(5639)["__core-js_shared__"];o.exports=l},1463:(o,a,c)=>{var l=c(5976),u=c(6612);o.exports=function(d){return l(function(h,p){var f=-1,g=p.length,y=g>1?p[g-1]:void 0,E=g>2?p[2]:void 0;for(y=d.length>3&&typeof y=="function"?(g--,y):void 0,E&&u(p[0],p[1],E)&&(y=g<3?void 0:y,g=1),h=Object(h);++f<g;){var w=p[f];w&&d(h,w,f,y)}return h})}},5063:o=>{o.exports=function(a){return function(c,l,u){for(var d=-1,h=Object(c),p=u(c),f=p.length;f--;){var g=p[a?f:++d];if(l(h[g],g,h)===!1)break}return c}}},8777:(o,a,c)=>{var l=c(852),u=function(){try{var d=l(Object,"defineProperty");return d({},"",{}),d}catch{}}();o.exports=u},1957:(o,a,c)=>{var l=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;o.exports=l},5050:(o,a,c)=>{var l=c(7019);o.exports=function(u,d){var h=u.__data__;return l(d)?h[typeof d=="string"?"string":"hash"]:h.map}},852:(o,a,c)=>{var l=c(8458),u=c(7801);o.exports=function(d,h){var p=u(d,h);return l(p)?p:void 0}},5924:(o,a,c)=>{var l=c(5569)(Object.getPrototypeOf,Object);o.exports=l},9607:(o,a,c)=>{var l=c(2705),u=Object.prototype,d=u.hasOwnProperty,h=u.toString,p=l?l.toStringTag:void 0;o.exports=function(f){var g=d.call(f,p),y=f[p];try{f[p]=void 0;var E=!0}catch{}var w=h.call(f);return E&&(g?f[p]=y:delete f[p]),w}},7801:o=>{o.exports=function(a,c){return a==null?void 0:a[c]}},1789:(o,a,c)=>{var l=c(4536);o.exports=function(){this.__data__=l?l(null):{},this.size=0}},401:o=>{o.exports=function(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}},7667:(o,a,c)=>{var l=c(4536),u="__lodash_hash_undefined__",d=Object.prototype.hasOwnProperty;o.exports=function(h){var p=this.__data__;if(l){var f=p[h];return f===u?void 0:f}return d.call(p,h)?p[h]:void 0}},1327:(o,a,c)=>{var l=c(4536),u=Object.prototype.hasOwnProperty;o.exports=function(d){var h=this.__data__;return l?h[d]!==void 0:u.call(h,d)}},1866:(o,a,c)=>{var l=c(4536),u="__lodash_hash_undefined__";o.exports=function(d,h){var p=this.__data__;return this.size+=this.has(d)?0:1,p[d]=l&&h===void 0?u:h,this}},8517:(o,a,c)=>{var l=c(3118),u=c(5924),d=c(5726);o.exports=function(h){return typeof h.constructor!="function"||d(h)?{}:l(u(h))}},5776:o=>{var a=9007199254740991,c=/^(?:0|[1-9]\d*)$/;o.exports=function(l,u){var d=typeof l;return!!(u=u??a)&&(d=="number"||d!="symbol"&&c.test(l))&&l>-1&&l%1==0&&l<u}},6612:(o,a,c)=>{var l=c(7813),u=c(8612),d=c(5776),h=c(3218);o.exports=function(p,f,g){if(!h(g))return!1;var y=typeof f;return!!(y=="number"?u(g)&&d(f,g.length):y=="string"&&f in g)&&l(g[f],p)}},7019:o=>{o.exports=function(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}},5346:(o,a,c)=>{var l,u=c(4429),d=(l=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";o.exports=function(h){return!!d&&d in h}},5726:o=>{var a=Object.prototype;o.exports=function(c){var l=c&&c.constructor;return c===(typeof l=="function"&&l.prototype||a)}},7040:o=>{o.exports=function(){this.__data__=[],this.size=0}},4125:(o,a,c)=>{var l=c(8470),u=Array.prototype.splice;o.exports=function(d){var h=this.__data__,p=l(h,d);return!(p<0)&&(p==h.length-1?h.pop():u.call(h,p,1),--this.size,!0)}},2117:(o,a,c)=>{var l=c(8470);o.exports=function(u){var d=this.__data__,h=l(d,u);return h<0?void 0:d[h][1]}},7518:(o,a,c)=>{var l=c(8470);o.exports=function(u){return l(this.__data__,u)>-1}},4705:(o,a,c)=>{var l=c(8470);o.exports=function(u,d){var h=this.__data__,p=l(h,u);return p<0?(++this.size,h.push([u,d])):h[p][1]=d,this}},4785:(o,a,c)=>{var l=c(1989),u=c(8407),d=c(7071);o.exports=function(){this.size=0,this.__data__={hash:new l,map:new(d||u),string:new l}}},1285:(o,a,c)=>{var l=c(5050);o.exports=function(u){var d=l(this,u).delete(u);return this.size-=d?1:0,d}},6e3:(o,a,c)=>{var l=c(5050);o.exports=function(u){return l(this,u).get(u)}},9916:(o,a,c)=>{var l=c(5050);o.exports=function(u){return l(this,u).has(u)}},5265:(o,a,c)=>{var l=c(5050);o.exports=function(u,d){var h=l(this,u),p=h.size;return h.set(u,d),this.size+=h.size==p?0:1,this}},4536:(o,a,c)=>{var l=c(852)(Object,"create");o.exports=l},3498:o=>{o.exports=function(a){var c=[];if(a!=null)for(var l in Object(a))c.push(l);return c}},1167:(o,a,c)=>{o=c.nmd(o);var l=c(1957),u=a&&!a.nodeType&&a,d=u&&o&&!o.nodeType&&o,h=d&&d.exports===u&&l.process,p=function(){try{var f=d&&d.require&&d.require("util").types;return f||h&&h.binding&&h.binding("util")}catch{}}();o.exports=p},2333:o=>{var a=Object.prototype.toString;o.exports=function(c){return a.call(c)}},5569:o=>{o.exports=function(a,c){return function(l){return a(c(l))}}},5357:(o,a,c)=>{var l=c(6874),u=Math.max;o.exports=function(d,h,p){return h=u(h===void 0?d.length-1:h,0),function(){for(var f=arguments,g=-1,y=u(f.length-h,0),E=Array(y);++g<y;)E[g]=f[h+g];g=-1;for(var w=Array(h+1);++g<h;)w[g]=f[g];return w[h]=p(E),l(d,this,w)}}},5639:(o,a,c)=>{var l=c(1957),u=typeof self=="object"&&self&&self.Object===Object&&self,d=l||u||Function("return this")();o.exports=d},6390:o=>{o.exports=function(a,c){if((c!=="constructor"||typeof a[c]!="function")&&c!="__proto__")return a[c]}},61:(o,a,c)=>{var l=c(6560),u=c(1275)(l);o.exports=u},1275:o=>{var a=800,c=16,l=Date.now;o.exports=function(u){var d=0,h=0;return function(){var p=l(),f=c-(p-h);if(h=p,f>0){if(++d>=a)return arguments[0]}else d=0;return u.apply(void 0,arguments)}}},7465:(o,a,c)=>{var l=c(8407);o.exports=function(){this.__data__=new l,this.size=0}},3779:o=>{o.exports=function(a){var c=this.__data__,l=c.delete(a);return this.size=c.size,l}},7599:o=>{o.exports=function(a){return this.__data__.get(a)}},4758:o=>{o.exports=function(a){return this.__data__.has(a)}},4309:(o,a,c)=>{var l=c(8407),u=c(7071),d=c(3369),h=200;o.exports=function(p,f){var g=this.__data__;if(g instanceof l){var y=g.__data__;if(!u||y.length<h-1)return y.push([p,f]),this.size=++g.size,this;g=this.__data__=new d(y)}return g.set(p,f),this.size=g.size,this}},346:o=>{var a=Function.prototype.toString;o.exports=function(c){if(c!=null){try{return a.call(c)}catch{}try{return c+""}catch{}}return""}},5703:o=>{o.exports=function(a){return function(){return a}}},7813:o=>{o.exports=function(a,c){return a===c||a!=a&&c!=c}},6557:o=>{o.exports=function(a){return a}},5694:(o,a,c)=>{var l=c(9454),u=c(7005),d=Object.prototype,h=d.hasOwnProperty,p=d.propertyIsEnumerable,f=l(function(){return arguments}())?l:function(g){return u(g)&&h.call(g,"callee")&&!p.call(g,"callee")};o.exports=f},1469:o=>{var a=Array.isArray;o.exports=a},8612:(o,a,c)=>{var l=c(3560),u=c(1780);o.exports=function(d){return d!=null&&u(d.length)&&!l(d)}},9246:(o,a,c)=>{var l=c(8612),u=c(7005);o.exports=function(d){return u(d)&&l(d)}},4144:(o,a,c)=>{o=c.nmd(o);var l=c(5639),u=c(5062),d=a&&!a.nodeType&&a,h=d&&o&&!o.nodeType&&o,p=h&&h.exports===d?l.Buffer:void 0,f=(p?p.isBuffer:void 0)||u;o.exports=f},3560:(o,a,c)=>{var l=c(4239),u=c(3218),d="[object AsyncFunction]",h="[object Function]",p="[object GeneratorFunction]",f="[object Proxy]";o.exports=function(g){if(!u(g))return!1;var y=l(g);return y==h||y==p||y==d||y==f}},1780:o=>{var a=9007199254740991;o.exports=function(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=a}},3218:o=>{o.exports=function(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}},7005:o=>{o.exports=function(a){return a!=null&&typeof a=="object"}},8630:(o,a,c)=>{var l=c(4239),u=c(5924),d=c(7005),h="[object Object]",p=Function.prototype,f=Object.prototype,g=p.toString,y=f.hasOwnProperty,E=g.call(Object);o.exports=function(w){if(!d(w)||l(w)!=h)return!1;var R=u(w);if(R===null)return!0;var A=y.call(R,"constructor")&&R.constructor;return typeof A=="function"&&A instanceof A&&g.call(A)==E}},6719:(o,a,c)=>{var l=c(8749),u=c(1717),d=c(1167),h=d&&d.isTypedArray,p=h?u(h):l;o.exports=p},1704:(o,a,c)=>{var l=c(4636),u=c(313),d=c(8612);o.exports=function(h){return d(h)?l(h,!0):u(h)}},6486:function(o,a,c){var l;o=c.nmd(o),(function(){var u,d="Expected a function",h="__lodash_hash_undefined__",p="__lodash_placeholder__",f=16,g=32,y=64,E=128,w=256,R=1/0,A=9007199254740991,k=NaN,I=4294967295,N=[["ary",E],["bind",1],["bindKey",2],["curry",8],["curryRight",f],["flip",512],["partial",g],["partialRight",y],["rearg",w]],U="[object Arguments]",F="[object Array]",$="[object Boolean]",q="[object Date]",K="[object Error]",W="[object Function]",X="[object GeneratorFunction]",ne="[object Map]",Z="[object Number]",ie="[object Object]",G="[object Promise]",Q="[object RegExp]",se="[object Set]",ve="[object String]",Oe="[object Symbol]",_e="[object WeakMap]",le="[object ArrayBuffer]",xe="[object DataView]",Ee="[object Float32Array]",Se="[object Float64Array]",Ie="[object Int8Array]",Ze="[object Int16Array]",_t="[object Int32Array]",fe="[object Uint8Array]",ge="[object Uint8ClampedArray]",rt="[object Uint16Array]",Re="[object Uint32Array]",St=/\b__p \+= '';/g,Ge=/\b(__p \+=) '' \+/g,kt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Bt=/&(?:amp|lt|gt|quot|#39);/g,He=/[&<>"']/g,$t=RegExp(Bt.source),Ce=RegExp(He.source),ue=/<%-([\s\S]+?)%>/g,tt=/<%([\s\S]+?)%>/g,yt=/<%=([\s\S]+?)%>/g,We=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ze=/^\w*$/,Vt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xt=/[\\^$.*+?()[\]{}|]/g,jt=RegExp(xt.source),ae=/^\s+/,j=/\s/,V=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,pe=/\{\n\/\* \[wrapped with (.+)\] \*/,Ne=/,? & /,Fe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dt=/[()=,{}\[\]\/\s]/,bt=/\\(\\)?/g,Dn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ue=/\w*$/,Dt=/^[-+]0x[0-9a-f]+$/i,st=/^0b[01]+$/i,Ct=/^\[object .+?Constructor\]$/,sn=/^0o[0-7]+$/i,Jt=/^(?:0|[1-9]\d*)$/,Le=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,it=/($^)/,Tt=/['\n\r\u2028\u2029\\]/g,wt="\\ud800-\\udfff",Pn="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Yr="\\u2700-\\u27bf",cr="a-z\\xdf-\\xf6\\xf8-\\xff",zn="A-Z\\xc0-\\xd6\\xd8-\\xde",dn="\\ufe0e\\ufe0f",tn="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Cn="['’]",Rn="["+wt+"]",_r="["+tn+"]",di="["+Pn+"]",ii="\\d+",xo="["+Yr+"]",yu="["+cr+"]",Kd="[^"+wt+tn+ii+Yr+cr+zn+"]",af="\\ud83c[\\udffb-\\udfff]",cf="[^"+wt+"]",ye="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",pt="["+zn+"]",vt="\\u200d",Xe="(?:"+yu+"|"+Kd+")",zt="(?:"+pt+"|"+Kd+")",Qt="(?:['’](?:d|ll|m|re|s|t|ve))?",hn="(?:['’](?:D|LL|M|RE|S|T|VE))?",mn="(?:"+di+"|"+af+")?",Un="["+dn+"]?",Xn=Un+mn+("(?:"+vt+"(?:"+[cf,ye,Ke].join("|")+")"+Un+mn+")*"),_n="(?:"+[xo,ye,Ke].join("|")+")"+Xn,yr="(?:"+[cf+di+"?",di,ye,Ke,Rn].join("|")+")",Vr=RegExp(Cn,"g"),En=RegExp(di,"g"),jn=RegExp(af+"(?="+af+")|"+yr+Xn,"g"),br=RegExp([pt+"?"+yu+"+"+Qt+"(?="+[_r,pt,"$"].join("|")+")",zt+"+"+hn+"(?="+[_r,pt+Xe,"$"].join("|")+")",pt+"?"+Xe+"+"+Qt,pt+"+"+hn,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ii,_n].join("|"),"g"),on=RegExp("["+vt+wt+Pn+dn+"]"),qi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Er=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Bs=-1,Jn={};Jn[Ee]=Jn[Se]=Jn[Ie]=Jn[Ze]=Jn[_t]=Jn[fe]=Jn[ge]=Jn[rt]=Jn[Re]=!0,Jn[U]=Jn[F]=Jn[le]=Jn[$]=Jn[xe]=Jn[q]=Jn[K]=Jn[W]=Jn[ne]=Jn[Z]=Jn[ie]=Jn[Q]=Jn[se]=Jn[ve]=Jn[_e]=!1;var lr={};lr[U]=lr[F]=lr[le]=lr[xe]=lr[$]=lr[q]=lr[Ee]=lr[Se]=lr[Ie]=lr[Ze]=lr[_t]=lr[ne]=lr[Z]=lr[ie]=lr[Q]=lr[se]=lr[ve]=lr[Oe]=lr[fe]=lr[ge]=lr[rt]=lr[Re]=!0,lr[K]=lr[W]=lr[_e]=!1;var Ul={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ti=parseFloat,Co=parseInt,Fl=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g,Ki=typeof self=="object"&&self&&self.Object===Object&&self,vn=Fl||Ki||Function("return this")(),uc=a&&!a.nodeType&&a,Bl=uc&&o&&!o.nodeType&&o,gr=Bl&&Bl.exports===uc,Yd=gr&&Fl.process,Vo=function(){try{var ot=Bl&&Bl.require&&Bl.require("util").types;return ot||Yd&&Yd.binding&&Yd.binding("util")}catch{}}(),Xd=Vo&&Vo.isArrayBuffer,lf=Vo&&Vo.isDate,bu=Vo&&Vo.isMap,$p=Vo&&Vo.isRegExp,Hp=Vo&&Vo.isSet,nd=Vo&&Vo.isTypedArray;function ha(ot,nt,Mt){switch(Mt.length){case 0:return ot.call(nt);case 1:return ot.call(nt,Mt[0]);case 2:return ot.call(nt,Mt[0],Mt[1]);case 3:return ot.call(nt,Mt[0],Mt[1],Mt[2])}return ot.apply(nt,Mt)}function uf(ot,nt,Mt,nn){for(var Gt=-1,zr=ot==null?0:ot.length;++Gt<zr;){var js=ot[Gt];nt(nn,js,Mt(js),ot)}return nn}function ur(ot,nt){for(var Mt=-1,nn=ot==null?0:ot.length;++Mt<nn&&nt(ot[Mt],Mt,ot)!==!1;);return ot}function Py(ot,nt){for(var Mt=ot==null?0:ot.length;Mt--&&nt(ot[Mt],Mt,ot)!==!1;);return ot}function Pg(ot,nt){for(var Mt=-1,nn=ot==null?0:ot.length;++Mt<nn;)if(!nt(ot[Mt],Mt,ot))return!1;return!0}function jl(ot,nt){for(var Mt=-1,nn=ot==null?0:ot.length,Gt=0,zr=[];++Mt<nn;){var js=ot[Mt];nt(js,Mt,ot)&&(zr[Gt++]=js)}return zr}function Vp(ot,nt){return!!(ot!=null&&ot.length)&&df(ot,nt,0)>-1}function rd(ot,nt,Mt){for(var nn=-1,Gt=ot==null?0:ot.length;++nn<Gt;)if(Mt(nt,ot[nn]))return!0;return!1}function wr(ot,nt){for(var Mt=-1,nn=ot==null?0:ot.length,Gt=Array(nn);++Mt<nn;)Gt[Mt]=nt(ot[Mt],Mt,ot);return Gt}function $l(ot,nt){for(var Mt=-1,nn=nt.length,Gt=ot.length;++Mt<nn;)ot[Gt+Mt]=nt[Mt];return ot}function L_(ot,nt,Mt,nn){var Gt=-1,zr=ot==null?0:ot.length;for(nn&&zr&&(Mt=ot[++Gt]);++Gt<zr;)Mt=nt(Mt,ot[Gt],Gt,ot);return Mt}function Dg(ot,nt,Mt,nn){var Gt=ot==null?0:ot.length;for(nn&&Gt&&(Mt=ot[--Gt]);Gt--;)Mt=nt(Mt,ot[Gt],Gt,ot);return Mt}function Lg(ot,nt){for(var Mt=-1,nn=ot==null?0:ot.length;++Mt<nn;)if(nt(ot[Mt],Mt,ot))return!0;return!1}var zp=Wp("length");function tl(ot,nt,Mt){var nn;return Mt(ot,function(Gt,zr,js){if(nt(Gt,zr,js))return nn=zr,!1}),nn}function Ug(ot,nt,Mt,nn){for(var Gt=ot.length,zr=Mt+(nn?1:-1);nn?zr--:++zr<Gt;)if(nt(ot[zr],zr,ot))return zr;return-1}function df(ot,nt,Mt){return nt==nt?function(nn,Gt,zr){for(var js=zr-1,il=nn.length;++js<il;)if(nn[js]===Gt)return js;return-1}(ot,nt,Mt):Ug(ot,Vl,Mt)}function Hl(ot,nt,Mt,nn){for(var Gt=Mt-1,zr=ot.length;++Gt<zr;)if(nn(ot[Gt],nt))return Gt;return-1}function Vl(ot){return ot!=ot}function Gp(ot,nt){var Mt=ot==null?0:ot.length;return Mt?dc(ot,nt)/Mt:k}function Wp(ot){return function(nt){return nt==null?u:nt[ot]}}function Fg(ot){return function(nt){return ot==null?u:ot[nt]}}function Dy(ot,nt,Mt,nn,Gt){return Gt(ot,function(zr,js,il){Mt=nn?(nn=!1,zr):nt(Mt,zr,js,il)}),Mt}function dc(ot,nt){for(var Mt,nn=-1,Gt=ot.length;++nn<Gt;){var zr=nt(ot[nn]);zr!==u&&(Mt=Mt===u?zr:Mt+zr)}return Mt}function U_(ot,nt){for(var Mt=-1,nn=Array(ot);++Mt<ot;)nn[Mt]=nt(Mt);return nn}function qp(ot){return ot&&ot.slice(0,rl(ot)+1).replace(ae,"")}function hc(ot){return function(nt){return ot(nt)}}function si(ot,nt){return wr(nt,function(Mt){return ot[Mt]})}function nl(ot,nt){return ot.has(nt)}function Kp(ot,nt){for(var Mt=-1,nn=ot.length;++Mt<nn&&df(nt,ot[Mt],0)>-1;);return Mt}function zl(ot,nt){for(var Mt=ot.length;Mt--&&df(nt,ot[Mt],0)>-1;);return Mt}var F_=Fg({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),hf=Fg({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Ly(ot){return"\\"+Ul[ot]}function Eu(ot){return on.test(ot)}function Jd(ot){var nt=-1,Mt=Array(ot.size);return ot.forEach(function(nn,Gt){Mt[++nt]=[Gt,nn]}),Mt}function Ks(ot,nt){return function(Mt){return ot(nt(Mt))}}function Yi(ot,nt){for(var Mt=-1,nn=ot.length,Gt=0,zr=[];++Mt<nn;){var js=ot[Mt];js!==nt&&js!==p||(ot[Mt]=p,zr[Gt++]=Mt)}return zr}function $a(ot){var nt=-1,Mt=Array(ot.size);return ot.forEach(function(nn){Mt[++nt]=nn}),Mt}function id(ot){var nt=-1,Mt=Array(ot.size);return ot.forEach(function(nn){Mt[++nt]=[nn,nn]}),Mt}function Ms(ot){return Eu(ot)?function(nt){for(var Mt=jn.lastIndex=0;jn.test(nt);)++Mt;return Mt}(ot):zp(ot)}function Is(ot){return Eu(ot)?function(nt){return nt.match(jn)||[]}(ot):function(nt){return nt.split("")}(ot)}function rl(ot){for(var nt=ot.length;nt--&&j.test(ot.charAt(nt)););return nt}var fa=Fg({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),sd=function ot(nt){var Mt,nn=(nt=nt==null?vn:sd.defaults(vn.Object(),nt,sd.pick(vn,Er))).Array,Gt=nt.Date,zr=nt.Error,js=nt.Function,il=nt.Math,Lr=nt.Object,Qd=nt.RegExp,Zd=nt.String,Ro=nt.TypeError,eh=nn.prototype,Bg=js.prototype,Ys=Lr.prototype,Xs=nt["__core-js_shared__"],Gl=Bg.toString,Gr=Ys.hasOwnProperty,kc=0,od=(Mt=/[^.]+$/.exec(Xs&&Xs.keys&&Xs.keys.IE_PROTO||""))?"Symbol(src)_1."+Mt:"",Yp=Ys.toString,ad=Gl.call(Lr),B_=vn._,fc=Qd("^"+Gl.call(Gr).replace(xt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zo=gr?nt.Buffer:u,gi=nt.Symbol,Nc=nt.Uint8Array,Pc=zo?zo.allocUnsafe:u,ff=Ks(Lr.getPrototypeOf,Lr),Xp=Lr.create,Jp=Ys.propertyIsEnumerable,Su=eh.splice,j_=gi?gi.isConcatSpreadable:u,sl=gi?gi.iterator:u,pc=gi?gi.toStringTag:u,th=function(){try{var v=Ga(Lr,"defineProperty");return v({},"",{}),v}catch{}}(),Yt=nt.clearTimeout!==vn.clearTimeout&&nt.clearTimeout,ss=Gt&&Gt.now!==vn.Date.now&&Gt.now,Uy=nt.setTimeout!==vn.setTimeout&&nt.setTimeout,Qp=il.ceil,lo=il.floor,Zp=Lr.getOwnPropertySymbols,em=zo?zo.isBuffer:u,Js=nt.isFinite,pf=eh.join,Qs=Ks(Lr.keys,Lr),oi=il.max,hs=il.min,Qn=Gt.now,mc=nt.parseInt,uo=il.random,Ai=eh.reverse,nh=Ga(nt,"DataView"),ho=Ga(nt,"Map"),Lt=Ga(nt,"Promise"),Os=Ga(nt,"Set"),Go=Ga(nt,"WeakMap"),gc=Ga(Lr,"create"),Pi=Go&&new Go,os={},ks=mh(nh),mf=mh(ho),tm=mh(Lt),Tu=mh(Os),Fy=mh(Go),$s=gi?gi.prototype:u,cd=$s?$s.valueOf:u,gf=$s?$s.toString:u;function me(v){if(O(v)&&!Ve(v)&&!(v instanceof Mr)){if(v instanceof Hs)return v;if(Gr.call(v,"__wrapped__"))return Ou(v)}return new Hs(v)}var Wo=function(){function v(){}return function(T){if(!C(T))return{};if(Xp)return Xp(T);v.prototype=T;var D=new v;return v.prototype=u,D}}();function Ha(){}function Hs(v,T){this.__wrapped__=v,this.__actions__=[],this.__chain__=!!T,this.__index__=0,this.__values__=u}function Mr(v){this.__wrapped__=v,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=I,this.__views__=[]}function ol(v){var T=-1,D=v==null?0:v.length;for(this.clear();++T<D;){var Y=v[T];this.set(Y[0],Y[1])}}function al(v){var T=-1,D=v==null?0:v.length;for(this.clear();++T<D;){var Y=v[T];this.set(Y[0],Y[1])}}function cl(v){var T=-1,D=v==null?0:v.length;for(this.clear();++T<D;){var Y=v[T];this.set(Y[0],Y[1])}}function ll(v){var T=-1,D=v==null?0:v.length;for(this.__data__=new cl;++T<D;)this.add(v[T])}function vc(v){var T=this.__data__=new al(v);this.size=T.size}function jg(v,T){var D=Ve(v),Y=!D&&Rr(v),oe=!D&&!Y&&yn(v),we=!D&&!Y&&!oe&&de(v),Pe=D||Y||oe||we,$e=Pe?U_(v.length,Zd):[],at=$e.length;for(var It in v)!T&&!Gr.call(v,It)||Pe&&(It=="length"||oe&&(It=="offset"||It=="parent")||we&&(It=="buffer"||It=="byteLength"||It=="byteOffset")||Ii(It,at))||$e.push(It);return $e}function ul(v){var T=v.length;return T?v[Jg(0,T-1)]:u}function $g(v,T){return Df(Xo(v),xu(T,0,v.length))}function rh(v){return Df(Xo(v))}function nm(v,T,D){(D!==u&&!Zn(v[T],D)||D===u&&!(T in v))&&dl(v,T,D)}function wu(v,T,D){var Y=v[T];Gr.call(v,T)&&Zn(Y,D)&&(D!==u||T in v)||dl(v,T,D)}function ld(v,T){for(var D=v.length;D--;)if(Zn(v[D][0],T))return D;return-1}function Hg(v,T,D,Y){return ud(v,function(oe,we,Pe){T(Y,oe,D(oe),Pe)}),Y}function vf(v,T){return v&&fl(T,Sn(T),v)}function dl(v,T,D){T=="__proto__"&&th?th(v,T,{configurable:!0,enumerable:!0,value:D,writable:!0}):v[T]=D}function Vg(v,T){for(var D=-1,Y=T.length,oe=nn(Y),we=v==null;++D<Y;)oe[D]=we?u:kr(v,T[D]);return oe}function xu(v,T,D){return v==v&&(D!==u&&(v=v<=D?v:D),T!==u&&(v=v>=T?v:T)),v}function qo(v,T,D,Y,oe,we){var Pe,$e=1&T,at=2&T,It=4&T;if(D&&(Pe=oe?D(v,Y,oe,we):D(v)),Pe!==u)return Pe;if(!C(v))return v;var At=Ve(v);if(At){if(Pe=function(Ot){var Xt=Ot.length,ir=new Ot.constructor(Xt);return Xt&&typeof Ot[0]=="string"&&Gr.call(Ot,"index")&&(ir.index=Ot.index,ir.input=Ot.input),ir}(v),!$e)return Xo(v,Pe)}else{var Wt=as(v),An=Wt==W||Wt==X;if(yn(v))return ch(v,$e);if(Wt==ie||Wt==U||An&&!oe){if(Pe=at||An?{}:iv(v),!$e)return at?function(Ot,Xt){return fl(Ot,vm(Ot),Xt)}(v,function(Ot,Xt){return Ot&&fl(Xt,qn(Xt),Ot)}(Pe,v)):function(Ot,Xt){return fl(Ot,pd(Ot),Xt)}(v,vf(Pe,v))}else{if(!lr[Wt])return oe?v:{};Pe=function(Ot,Xt,ir){var an=Ot.constructor;switch(Xt){case le:return xf(Ot);case $:case q:return new an(+Ot);case xe:return function(Sr,Ui){var $n=Ui?xf(Sr.buffer):Sr.buffer;return new Sr.constructor($n,Sr.byteOffset,Sr.byteLength)}(Ot,ir);case Ee:case Se:case Ie:case Ze:case _t:case fe:case ge:case rt:case Re:return tv(Ot,ir);case ne:return new an;case Z:case ve:return new an(Ot);case Q:return function(Sr){var Ui=new Sr.constructor(Sr.source,Ue.exec(Sr));return Ui.lastIndex=Sr.lastIndex,Ui}(Ot);case se:return new an;case Oe:return $r=Ot,cd?Lr(cd.call($r)):{}}var $r}(v,Wt,$e)}}we||(we=new vc);var Nn=we.get(v);if(Nn)return Nn;we.set(v,Pe),z(v)?v.forEach(function(Ot){Pe.add(qo(Ot,T,D,Ot,v,we))}):P(v)&&v.forEach(function(Ot,Xt){Pe.set(Xt,qo(Ot,T,D,Xt,v,we))});var Yn=At?u:(It?at?ps:Cr:at?qn:Sn)(v);return ur(Yn||v,function(Ot,Xt){Yn&&(Ot=v[Xt=Ot]),wu(Pe,Xt,qo(Ot,T,D,Xt,v,we))}),Pe}function Ns(v,T,D){var Y=D.length;if(v==null)return!Y;for(v=Lr(v);Y--;){var oe=D[Y],we=T[oe],Pe=v[oe];if(Pe===u&&!(oe in v)||!we(Pe))return!1}return!0}function zg(v,T,D){if(typeof v!="function")throw new Ro(d);return Ec(function(){v.apply(u,D)},T)}function ih(v,T,D,Y){var oe=-1,we=Vp,Pe=!0,$e=v.length,at=[],It=T.length;if(!$e)return at;D&&(T=wr(T,hc(D))),Y?(we=rd,Pe=!1):T.length>=200&&(we=nl,Pe=!1,T=new ll(T));e:for(;++oe<$e;){var At=v[oe],Wt=D==null?At:D(At);if(At=Y||At!==0?At:0,Pe&&Wt==Wt){for(var An=It;An--;)if(T[An]===Wt)continue e;at.push(At)}else we(T,Wt,Y)||at.push(At)}return at}me.templateSettings={escape:ue,evaluate:tt,interpolate:yt,variable:"",imports:{_:me}},me.prototype=Ha.prototype,me.prototype.constructor=me,Hs.prototype=Wo(Ha.prototype),Hs.prototype.constructor=Hs,Mr.prototype=Wo(Ha.prototype),Mr.prototype.constructor=Mr,ol.prototype.clear=function(){this.__data__=gc?gc(null):{},this.size=0},ol.prototype.delete=function(v){var T=this.has(v)&&delete this.__data__[v];return this.size-=T?1:0,T},ol.prototype.get=function(v){var T=this.__data__;if(gc){var D=T[v];return D===h?u:D}return Gr.call(T,v)?T[v]:u},ol.prototype.has=function(v){var T=this.__data__;return gc?T[v]!==u:Gr.call(T,v)},ol.prototype.set=function(v,T){var D=this.__data__;return this.size+=this.has(v)?0:1,D[v]=gc&&T===u?h:T,this},al.prototype.clear=function(){this.__data__=[],this.size=0},al.prototype.delete=function(v){var T=this.__data__,D=ld(T,v);return!(D<0)&&(D==T.length-1?T.pop():Su.call(T,D,1),--this.size,!0)},al.prototype.get=function(v){var T=this.__data__,D=ld(T,v);return D<0?u:T[D][1]},al.prototype.has=function(v){return ld(this.__data__,v)>-1},al.prototype.set=function(v,T){var D=this.__data__,Y=ld(D,v);return Y<0?(++this.size,D.push([v,T])):D[Y][1]=T,this},cl.prototype.clear=function(){this.size=0,this.__data__={hash:new ol,map:new(ho||al),string:new ol}},cl.prototype.delete=function(v){var T=gs(this,v).delete(v);return this.size-=T?1:0,T},cl.prototype.get=function(v){return gs(this,v).get(v)},cl.prototype.has=function(v){return gs(this,v).has(v)},cl.prototype.set=function(v,T){var D=gs(this,v),Y=D.size;return D.set(v,T),this.size+=D.size==Y?0:1,this},ll.prototype.add=ll.prototype.push=function(v){return this.__data__.set(v,h),this},ll.prototype.has=function(v){return this.__data__.has(v)},vc.prototype.clear=function(){this.__data__=new al,this.size=0},vc.prototype.delete=function(v){var T=this.__data__,D=T.delete(v);return this.size=T.size,D},vc.prototype.get=function(v){return this.__data__.get(v)},vc.prototype.has=function(v){return this.__data__.has(v)},vc.prototype.set=function(v,T){var D=this.__data__;if(D instanceof al){var Y=D.__data__;if(!ho||Y.length<199)return Y.push([v,T]),this.size=++D.size,this;D=this.__data__=new cl(Y)}return D.set(v,T),this.size=D.size,this};var ud=W_(Va),rm=W_($_,!0);function By(v,T){var D=!0;return ud(v,function(Y,oe,we){return D=!!T(Y,oe,we)}),D}function im(v,T,D){for(var Y=-1,oe=v.length;++Y<oe;){var we=v[Y],Pe=T(we);if(Pe!=null&&($e===u?Pe==Pe&&!ce(Pe):D(Pe,$e)))var $e=Pe,at=we}return at}function _f(v,T){var D=[];return ud(v,function(Y,oe,we){T(Y,oe,we)&&D.push(Y)}),D}function fo(v,T,D,Y,oe){var we=-1,Pe=v.length;for(D||(D=_m),oe||(oe=[]);++we<Pe;){var $e=v[we];T>0&&D($e)?T>1?fo($e,T-1,D,Y,oe):$l(oe,$e):Y||(oe[oe.length]=$e)}return oe}var Gg=nv(),Wg=nv(!0);function Va(v,T){return v&&Gg(v,T,Sn)}function $_(v,T){return v&&Wg(v,T,Sn)}function Wl(v,T){return jl(T,function(D){return x(v[D])})}function fs(v,T){for(var D=0,Y=(T=hl(T,v)).length;v!=null&&D<Y;)v=v[Lc(T[D++])];return D&&D==Y?v:u}function Cu(v,T,D){var Y=T(v);return Ve(v)?Y:$l(Y,D(v))}function Vs(v){return v==null?v===u?"[object Undefined]":"[object Null]":pc&&pc in Lr(v)?function(T){var D=Gr.call(T,pc),Y=T[pc];try{T[pc]=u;var oe=!0}catch{}var we=Yp.call(T);return oe&&(D?T[pc]=Y:delete T[pc]),we}(v):function(T){return Yp.call(T)}(v)}function Mi(v,T){return v>T}function yf(v,T){return v!=null&&Gr.call(v,T)}function sh(v,T){return v!=null&&T in Lr(v)}function qg(v,T,D){for(var Y=D?rd:Vp,oe=v[0].length,we=v.length,Pe=we,$e=nn(we),at=1/0,It=[];Pe--;){var At=v[Pe];Pe&&T&&(At=wr(At,hc(T))),at=hs(At.length,at),$e[Pe]=!D&&(T||oe>=120&&At.length>=120)?new ll(Pe&&At):u}At=v[0];var Wt=-1,An=$e[0];e:for(;++Wt<oe&&It.length<at;){var Nn=At[Wt],Yn=T?T(Nn):Nn;if(Nn=D||Nn!==0?Nn:0,!(An?nl(An,Yn):Y(It,Yn,D))){for(Pe=we;--Pe;){var Ot=$e[Pe];if(!(Ot?nl(Ot,Yn):Y(v[Pe],Yn,D)))continue e}An&&An.push(Yn),It.push(Nn)}}return It}function ql(v,T,D){var Y=(v=Pf(v,T=hl(T,v)))==null?v:v[Lc(mo(T))];return Y==null?u:ha(Y,v,D)}function sm(v){return O(v)&&Vs(v)==U}function Ao(v,T,D,Y,oe){return v===T||(v==null||T==null||!O(v)&&!O(T)?v!=v&&T!=T:function(we,Pe,$e,at,It,At){var Wt=Ve(we),An=Ve(Pe),Nn=Wt?F:as(we),Yn=An?F:as(Pe),Ot=(Nn=Nn==U?ie:Nn)==ie,Xt=(Yn=Yn==U?ie:Yn)==ie,ir=Nn==Yn;if(ir&&yn(we)){if(!yn(Pe))return!1;Wt=!0,Ot=!1}if(ir&&!Ot)return At||(At=new vc),Wt||de(we)?gm(we,Pe,$e,at,It,At):function($n,sr,Sa,Oo,vl,Ds,Fc){switch(Sa){case xe:if($n.byteLength!=sr.byteLength||$n.byteOffset!=sr.byteOffset)return!1;$n=$n.buffer,sr=sr.buffer;case le:return!($n.byteLength!=sr.byteLength||!Ds(new Nc($n),new Nc(sr)));case $:case q:case Z:return Zn(+$n,+sr);case K:return $n.name==sr.name&&$n.message==sr.message;case Q:case ve:return $n==sr+"";case ne:var jf=Jd;case se:var hv=1&Oo;if(jf||(jf=$a),$n.size!=sr.size&&!hv)return!1;var Hx=Fc.get($n);if(Hx)return Hx==sr;Oo|=2,Fc.set($n,sr);var IN=gm(jf($n),jf(sr),Oo,vl,Ds,Fc);return Fc.delete($n),IN;case Oe:if(cd)return cd.call($n)==cd.call(sr)}return!1}(we,Pe,Nn,$e,at,It,At);if(!(1&$e)){var an=Ot&&Gr.call(we,"__wrapped__"),$r=Xt&&Gr.call(Pe,"__wrapped__");if(an||$r){var Sr=an?we.value():we,Ui=$r?Pe.value():Pe;return At||(At=new vc),It(Sr,Ui,$e,at,At)}}return ir?(At||(At=new vc),function($n,sr,Sa,Oo,vl,Ds){var Fc=1&Sa,jf=Cr($n),hv=jf.length,Hx=Cr(sr),IN=Hx.length;if(hv!=IN&&!Fc)return!1;for(var Vx=hv;Vx--;){var r0=jf[Vx];if(!(Fc?r0 in sr:Gr.call(sr,r0)))return!1}var jj=Ds.get($n),$j=Ds.get(sr);if(jj&&$j)return jj==sr&&$j==$n;var zx=!0;Ds.set($n,sr),Ds.set(sr,$n);for(var ON=Fc;++Vx<hv;){var Gx=$n[r0=jf[Vx]],Wx=sr[r0];if(Oo)var Hj=Fc?Oo(Wx,Gx,r0,sr,$n,Ds):Oo(Gx,Wx,r0,$n,sr,Ds);if(!(Hj===u?Gx===Wx||vl(Gx,Wx,Sa,Oo,Ds):Hj)){zx=!1;break}ON||(ON=r0=="constructor")}if(zx&&!ON){var qx=$n.constructor,Kx=sr.constructor;qx==Kx||!("constructor"in $n)||!("constructor"in sr)||typeof qx=="function"&&qx instanceof qx&&typeof Kx=="function"&&Kx instanceof Kx||(zx=!1)}return Ds.delete($n),Ds.delete(sr),zx}(we,Pe,$e,at,It,At)):!1}(v,T,D,Y,Ao,oe))}function Kg(v,T,D,Y){var oe=D.length,we=oe,Pe=!Y;if(v==null)return!we;for(v=Lr(v);oe--;){var $e=D[oe];if(Pe&&$e[2]?$e[1]!==v[$e[0]]:!($e[0]in v))return!1}for(;++oe<we;){var at=($e=D[oe])[0],It=v[at],At=$e[1];if(Pe&&$e[2]){if(It===u&&!(at in v))return!1}else{var Wt=new vc;if(Y)var An=Y(It,At,at,v,T,Wt);if(!(An===u?Ao(At,It,3,Y,Wt):An))return!1}}return!0}function bf(v){return!(!C(v)||(T=v,od&&od in T))&&(x(v)?fc:Ct).test(mh(v));var T}function Ef(v){return typeof v=="function"?v:v==null?Ps:typeof v=="object"?Ve(v)?H_(v[0],v[1]):po(v):xm(v)}function Sf(v){if(!Dc(v))return Qs(v);var T=[];for(var D in Lr(v))Gr.call(v,D)&&D!="constructor"&&T.push(D);return T}function om(v){if(!C(v))return function(oe){var we=[];if(oe!=null)for(var Pe in Lr(oe))we.push(Pe);return we}(v);var T=Dc(v),D=[];for(var Y in v)(Y!="constructor"||!T&&Gr.call(v,Y))&&D.push(Y);return D}function am(v,T){return v<T}function pa(v,T){var D=-1,Y=ut(v)?nn(v.length):[];return ud(v,function(oe,we,Pe){Y[++D]=T(oe,we,Pe)}),Y}function po(v){var T=In(v);return T.length==1&&T[0][2]?Nf(T[0][0],T[0][1]):function(D){return D===v||Kg(D,v,T)}}function H_(v,T){return kf(v)&&ym(T)?Nf(Lc(v),T):function(D){var Y=kr(D,v);return Y===u&&Y===T?Nr(D,v):Ao(T,Y,3)}}function Yg(v,T,D,Y,oe){v!==T&&Gg(T,function(we,Pe){if(oe||(oe=new vc),C(we))(function(at,It,At,Wt,An,Nn,Yn){var Ot=ph(at,At),Xt=ph(It,At),ir=Yn.get(Xt);if(ir)return void nm(at,At,ir);var an=Nn?Nn(Ot,Xt,At+"",at,It,Yn):u,$r=an===u;if($r){var Sr=Ve(Xt),Ui=!Sr&&yn(Xt),$n=!Sr&&!Ui&&de(Xt);an=Xt,Sr||Ui||$n?Ve(Ot)?an=Ot:Ht(Ot)?an=Xo(Ot):Ui?($r=!1,an=ch(Xt,!0)):$n?($r=!1,an=tv(Xt,!0)):an=[]:J(Xt)||Rr(Xt)?(an=Ot,Rr(Ot)?an=en(Ot):C(Ot)&&!x(Ot)||(an=iv(Xt))):$r=!1}$r&&(Yn.set(Xt,an),An(an,Xt,Wt,Nn,Yn),Yn.delete(Xt)),nm(at,At,an)})(v,T,Pe,D,Yg,Y,oe);else{var $e=Y?Y(ph(v,Pe),we,Pe+"",v,T,oe):u;$e===u&&($e=we),nm(v,Pe,$e)}},qn)}function za(v,T){var D=v.length;if(D)return Ii(T+=T<0?D:0,D)?v[T]:u}function Ko(v,T,D){T=T.length?wr(T,function(we){return Ve(we)?function(Pe){return fs(Pe,we.length===1?we[0]:we)}:we}):[Ps];var Y=-1;T=wr(T,hc(kn()));var oe=pa(v,function(we,Pe,$e){var at=wr(T,function(It){return It(we)});return{criteria:at,index:++Y,value:we}});return function(we,Pe){var $e=we.length;for(we.sort(Pe);$e--;)we[$e]=we[$e].value;return we}(oe,function(we,Pe){return function($e,at,It){for(var At=-1,Wt=$e.criteria,An=at.criteria,Nn=Wt.length,Yn=It.length;++At<Nn;){var Ot=Cf(Wt[At],An[At]);if(Ot)return At>=Yn?Ot:Ot*(It[At]=="desc"?-1:1)}return $e.index-at.index}(we,Pe,D)})}function V_(v,T,D){for(var Y=-1,oe=T.length,we={};++Y<oe;){var Pe=T[Y],$e=fs(v,Pe);D($e,Pe)&&Tf(we,hl(Pe,v),$e)}return we}function Xg(v,T,D,Y){var oe=Y?Hl:df,we=-1,Pe=T.length,$e=v;for(v===T&&(T=Xo(T)),D&&($e=wr(v,hc(D)));++we<Pe;)for(var at=0,It=T[we],At=D?D(It):It;(at=oe($e,At,at,Y))>-1;)$e!==v&&Su.call($e,at,1),Su.call(v,at,1);return v}function z_(v,T){for(var D=v?T.length:0,Y=D-1;D--;){var oe=T[D];if(D==Y||oe!==we){var we=oe;Ii(oe)?Su.call(v,oe,1):ga(v,oe)}}return v}function Jg(v,T){return v+lo(uo()*(T-v+1))}function Qg(v,T){var D="";if(!v||T<1||T>A)return D;do T%2&&(D+=v),(T=lo(T/2))&&(v+=v);while(T);return D}function xr(v,T){return va(md(v,T,Ps),v+"")}function cm(v){return ul(Li(v))}function G_(v,T){var D=Li(v);return Df(D,xu(T,0,D.length))}function Tf(v,T,D,Y){if(!C(v))return v;for(var oe=-1,we=(T=hl(T,v)).length,Pe=we-1,$e=v;$e!=null&&++oe<we;){var at=Lc(T[oe]),It=D;if(at==="__proto__"||at==="constructor"||at==="prototype")return v;if(oe!=Pe){var At=$e[at];(It=Y?Y(At,at,$e):u)===u&&(It=C(At)?At:Ii(T[oe+1])?[]:{})}wu($e,at,It),$e=$e[at]}return v}var dd=Pi?function(v,T){return Pi.set(v,T),v}:Ps,Ru=th?function(v,T){return th(v,"toString",{configurable:!0,enumerable:!1,value:Ql(T),writable:!0})}:Ps;function Kl(v){return Df(Li(v))}function Yo(v,T,D){var Y=-1,oe=v.length;T<0&&(T=-T>oe?0:oe+T),(D=D>oe?oe:D)<0&&(D+=oe),oe=T>D?0:D-T>>>0,T>>>=0;for(var we=nn(oe);++Y<oe;)we[Y]=v[Y+T];return we}function Yl(v,T){var D;return ud(v,function(Y,oe,we){return!(D=T(Y,oe,we))}),!!D}function hd(v,T,D){var Y=0,oe=v==null?Y:v.length;if(typeof T=="number"&&T==T&&oe<=2147483647){for(;Y<oe;){var we=Y+oe>>>1,Pe=v[we];Pe!==null&&!ce(Pe)&&(D?Pe<=T:Pe<T)?Y=we+1:oe=we}return oe}return Zg(v,T,Ps,D)}function Zg(v,T,D,Y){var oe=0,we=v==null?0:v.length;if(we===0)return 0;for(var Pe=(T=D(T))!=T,$e=T===null,at=ce(T),It=T===u;oe<we;){var At=lo((oe+we)/2),Wt=D(v[At]),An=Wt!==u,Nn=Wt===null,Yn=Wt==Wt,Ot=ce(Wt);if(Pe)var Xt=Y||Yn;else Xt=It?Yn&&(Y||An):$e?Yn&&An&&(Y||!Nn):at?Yn&&An&&!Nn&&(Y||!Ot):!Nn&&!Ot&&(Y?Wt<=T:Wt<T);Xt?oe=At+1:we=At}return hs(we,4294967294)}function lm(v,T){for(var D=-1,Y=v.length,oe=0,we=[];++D<Y;){var Pe=v[D],$e=T?T(Pe):Pe;if(!D||!Zn($e,at)){var at=$e;we[oe++]=Pe===0?0:Pe}}return we}function wf(v){return typeof v=="number"?v:ce(v)?k:+v}function ma(v){if(typeof v=="string")return v;if(Ve(v))return wr(v,ma)+"";if(ce(v))return gf?gf.call(v):"";var T=v+"";return T=="0"&&1/v==-1/0?"-0":T}function Au(v,T,D){var Y=-1,oe=Vp,we=v.length,Pe=!0,$e=[],at=$e;if(D)Pe=!1,oe=rd;else if(we>=200){var It=T?null:Y_(v);if(It)return $a(It);Pe=!1,oe=nl,at=new ll}else at=T?[]:$e;e:for(;++Y<we;){var At=v[Y],Wt=T?T(At):At;if(At=D||At!==0?At:0,Pe&&Wt==Wt){for(var An=at.length;An--;)if(at[An]===Wt)continue e;T&&at.push(Wt),$e.push(At)}else oe(at,Wt,D)||(at!==$e&&at.push(Wt),$e.push(At))}return $e}function ga(v,T){return(v=Pf(v,T=hl(T,v)))==null||delete v[Lc(mo(T))]}function jy(v,T,D,Y){return Tf(v,T,D(fs(v,T)),Y)}function ev(v,T,D,Y){for(var oe=v.length,we=Y?oe:-1;(Y?we--:++we<oe)&&T(v[we],we,v););return D?Yo(v,Y?0:we,Y?we+1:oe):Yo(v,Y?we+1:0,Y?oe:we)}function oh(v,T){var D=v;return D instanceof Mr&&(D=D.value()),L_(T,function(Y,oe){return oe.func.apply(oe.thisArg,$l([Y],oe.args))},D)}function Mu(v,T,D){var Y=v.length;if(Y<2)return Y?Au(v[0]):[];for(var oe=-1,we=nn(Y);++oe<Y;)for(var Pe=v[oe],$e=-1;++$e<Y;)$e!=oe&&(we[oe]=ih(we[oe]||Pe,v[$e],T,D));return Au(fo(we,1),T,D)}function um(v,T,D){for(var Y=-1,oe=v.length,we=T.length,Pe={};++Y<oe;){var $e=Y<we?T[Y]:u;D(Pe,v[Y],$e)}return Pe}function rn(v){return Ht(v)?v:[]}function ah(v){return typeof v=="function"?v:Ps}function hl(v,T){return Ve(v)?v:kf(v,T)?[v]:bm(Pt(v))}var $y=xr;function Mo(v,T,D){var Y=v.length;return D=D===u?Y:D,!T&&D>=Y?v:Yo(v,T,D)}var Iu=Yt||function(v){return vn.clearTimeout(v)};function ch(v,T){if(T)return v.slice();var D=v.length,Y=Pc?Pc(D):new v.constructor(D);return v.copy(Y),Y}function xf(v){var T=new v.constructor(v.byteLength);return new Nc(T).set(new Nc(v)),T}function tv(v,T){var D=T?xf(v.buffer):v.buffer;return new v.constructor(D,v.byteOffset,v.length)}function Cf(v,T){if(v!==T){var D=v!==u,Y=v===null,oe=v==v,we=ce(v),Pe=T!==u,$e=T===null,at=T==T,It=ce(T);if(!$e&&!It&&!we&&v>T||we&&Pe&&at&&!$e&&!It||Y&&Pe&&at||!D&&at||!oe)return 1;if(!Y&&!we&&!It&&v<T||It&&D&&oe&&!Y&&!we||$e&&D&&oe||!Pe&&oe||!at)return-1}return 0}function lh(v,T,D,Y){for(var oe=-1,we=v.length,Pe=D.length,$e=-1,at=T.length,It=oi(we-Pe,0),At=nn(at+It),Wt=!Y;++$e<at;)At[$e]=T[$e];for(;++oe<Pe;)(Wt||oe<we)&&(At[D[oe]]=v[oe]);for(;It--;)At[$e++]=v[oe++];return At}function Rf(v,T,D,Y){for(var oe=-1,we=v.length,Pe=-1,$e=D.length,at=-1,It=T.length,At=oi(we-$e,0),Wt=nn(At+It),An=!Y;++oe<At;)Wt[oe]=v[oe];for(var Nn=oe;++at<It;)Wt[Nn+at]=T[at];for(;++Pe<$e;)(An||oe<we)&&(Wt[Nn+D[Pe]]=v[oe++]);return Wt}function Xo(v,T){var D=-1,Y=v.length;for(T||(T=nn(Y));++D<Y;)T[D]=v[D];return T}function fl(v,T,D,Y){var oe=!D;D||(D={});for(var we=-1,Pe=T.length;++we<Pe;){var $e=T[we],at=Y?Y(D[$e],v[$e],$e,D,v):u;at===u&&(at=v[$e]),oe?dl(D,$e,at):wu(D,$e,at)}return D}function Af(v,T){return function(D,Y){var oe=Ve(D)?uf:Hg,we=T?T():{};return oe(D,v,kn(Y,2),we)}}function fd(v){return xr(function(T,D){var Y=-1,oe=D.length,we=oe>1?D[oe-1]:u,Pe=oe>2?D[2]:u;for(we=v.length>3&&typeof we=="function"?(oe--,we):u,Pe&&eo(D[0],D[1],Pe)&&(we=oe<3?u:we,oe=1),T=Lr(T);++Y<oe;){var $e=D[Y];$e&&v(T,$e,Y,we)}return T})}function W_(v,T){return function(D,Y){if(D==null)return D;if(!ut(D))return v(D,Y);for(var oe=D.length,we=T?oe:-1,Pe=Lr(D);(T?we--:++we<oe)&&Y(Pe[we],we,Pe)!==!1;);return D}}function nv(v){return function(T,D,Y){for(var oe=-1,we=Lr(T),Pe=Y(T),$e=Pe.length;$e--;){var at=Pe[v?$e:++oe];if(D(we[at],at,we)===!1)break}return T}}function dm(v){return function(T){var D=Eu(T=Pt(T))?Is(T):u,Y=D?D[0]:T.charAt(0),oe=D?Mo(D,1).join(""):T.slice(1);return Y[v]()+oe}}function uh(v){return function(T){return L_(Uc(Zi(T).replace(Vr,"")),v,"")}}function hm(v){return function(){var T=arguments;switch(T.length){case 0:return new v;case 1:return new v(T[0]);case 2:return new v(T[0],T[1]);case 3:return new v(T[0],T[1],T[2]);case 4:return new v(T[0],T[1],T[2],T[3]);case 5:return new v(T[0],T[1],T[2],T[3],T[4]);case 6:return new v(T[0],T[1],T[2],T[3],T[4],T[5]);case 7:return new v(T[0],T[1],T[2],T[3],T[4],T[5],T[6])}var D=Wo(v.prototype),Y=v.apply(D,T);return C(Y)?Y:D}}function q_(v){return function(T,D,Y){var oe=Lr(T);if(!ut(T)){var we=kn(D,3);T=Sn(T),D=function($e){return we(oe[$e],$e,oe)}}var Pe=v(T,D,Y);return Pe>-1?oe[we?T[Pe]:Pe]:u}}function rv(v){return xi(function(T){var D=T.length,Y=D,oe=Hs.prototype.thru;for(v&&T.reverse();Y--;){var we=T[Y];if(typeof we!="function")throw new Ro(d);if(oe&&!Pe&&zs(we)=="wrapper")var Pe=new Hs([],!0)}for(Y=Pe?Y:D;++Y<D;){var $e=zs(we=T[Y]),at=$e=="wrapper"?ms(we):u;Pe=at&&Xl(at[0])&&at[1]==424&&!at[4].length&&at[9]==1?Pe[zs(at[0])].apply(Pe,at[3]):we.length==1&&Xl(we)?Pe[$e]():Pe.thru(we)}return function(){var It=arguments,At=It[0];if(Pe&&It.length==1&&Ve(At))return Pe.plant(At).value();for(var Wt=0,An=D?T[Wt].apply(this,It):At;++Wt<D;)An=T[Wt].call(this,An);return An}})}function fm(v,T,D,Y,oe,we,Pe,$e,at,It){var At=T&E,Wt=1&T,An=2&T,Nn=24&T,Yn=512&T,Ot=An?u:hm(v);return function Xt(){for(var ir=arguments.length,an=nn(ir),$r=ir;$r--;)an[$r]=arguments[$r];if(Nn)var Sr=Zs(Xt),Ui=function(Oo,vl){for(var Ds=Oo.length,Fc=0;Ds--;)Oo[Ds]===vl&&++Fc;return Fc}(an,Sr);if(Y&&(an=lh(an,Y,oe,Nn)),we&&(an=Rf(an,we,Pe,Nn)),ir-=Ui,Nn&&ir<It){var $n=Yi(an,Sr);return If(v,T,fm,Xt.placeholder,D,an,$n,$e,at,It-ir)}var sr=Wt?D:this,Sa=An?sr[v]:v;return ir=an.length,$e?an=function(Oo,vl){for(var Ds=Oo.length,Fc=hs(vl.length,Ds),jf=Xo(Oo);Fc--;){var hv=vl[Fc];Oo[Fc]=Ii(hv,Ds)?jf[hv]:u}return Oo}(an,$e):Yn&&ir>1&&an.reverse(),At&&at<ir&&(an.length=at),this&&this!==vn&&this instanceof Xt&&(Sa=Ot||hm(Sa)),Sa.apply(sr,an)}}function K_(v,T){return function(D,Y){return function(oe,we,Pe,$e){return Va(oe,function(at,It,At){we($e,Pe(at),It,At)}),$e}(D,v,T(Y),{})}}function dh(v,T){return function(D,Y){var oe;if(D===u&&Y===u)return T;if(D!==u&&(oe=D),Y!==u){if(oe===u)return Y;typeof D=="string"||typeof Y=="string"?(D=ma(D),Y=ma(Y)):(D=wf(D),Y=wf(Y)),oe=v(D,Y)}return oe}}function Mf(v){return xi(function(T){return T=wr(T,hc(kn())),xr(function(D){var Y=this;return v(T,function(oe){return ha(oe,Y,D)})})})}function hh(v,T){var D=(T=T===u?" ":ma(T)).length;if(D<2)return D?Qg(T,v):T;var Y=Qg(T,Qp(v/Ms(T)));return Eu(T)?Mo(Is(Y),0,v).join(""):Y.slice(0,v)}function pm(v){return function(T,D,Y){return Y&&typeof Y!="number"&&eo(T,D,Y)&&(D=Y=u),T=Me(T),D===u?(D=T,T=0):D=Me(D),function(oe,we,Pe,$e){for(var at=-1,It=oi(Qp((we-oe)/(Pe||1)),0),At=nn(It);It--;)At[$e?It:++at]=oe,oe+=Pe;return At}(T,D,Y=Y===u?T<D?1:-1:Me(Y),v)}}function fh(v){return function(T,D){return typeof T=="string"&&typeof D=="string"||(T=Ut(T),D=Ut(D)),v(T,D)}}function If(v,T,D,Y,oe,we,Pe,$e,at,It){var At=8&T;T|=At?g:y,4&(T&=~(At?y:g))||(T&=-4);var Wt=[v,T,oe,At?we:u,At?Pe:u,At?u:we,At?u:Pe,$e,at,It],An=D.apply(u,Wt);return Xl(v)&&Di(An,Wt),An.placeholder=Y,vs(An,v,T)}function Of(v){var T=il[v];return function(D,Y){if(D=Ut(D),(Y=Y==null?0:hs(Te(Y),292))&&Js(D)){var oe=(Pt(D)+"e").split("e");return+((oe=(Pt(T(oe[0]+"e"+(+oe[1]+Y)))+"e").split("e"))[0]+"e"+(+oe[1]-Y))}return T(D)}}var Y_=Os&&1/$a(new Os([,-0]))[1]==R?function(v){return new Os(v)}:Zl;function mm(v){return function(T){var D=as(T);return D==ne?Jd(T):D==se?id(T):function(Y,oe){return wr(oe,function(we){return[we,Y[we]]})}(T,v(T))}}function _c(v,T,D,Y,oe,we,Pe,$e){var at=2&T;if(!at&&typeof v!="function")throw new Ro(d);var It=Y?Y.length:0;if(It||(T&=-97,Y=oe=u),Pe=Pe===u?Pe:oi(Te(Pe),0),$e=$e===u?$e:Te($e),It-=oe?oe.length:0,T&y){var At=Y,Wt=oe;Y=oe=u}var An=at?u:ms(v),Nn=[v,T,D,Y,oe,At,Wt,we,Pe,$e];if(An&&function(Ot,Xt){var ir=Ot[1],an=Xt[1],$r=ir|an,Sr=$r<131,Ui=an==E&&ir==8||an==E&&ir==w&&Ot[7].length<=Xt[8]||an==384&&Xt[7].length<=Xt[8]&&ir==8;if(!Sr&&!Ui)return Ot;1&an&&(Ot[2]=Xt[2],$r|=1&ir?0:4);var $n=Xt[3];if($n){var sr=Ot[3];Ot[3]=sr?lh(sr,$n,Xt[4]):$n,Ot[4]=sr?Yi(Ot[3],p):Xt[4]}($n=Xt[5])&&(sr=Ot[5],Ot[5]=sr?Rf(sr,$n,Xt[6]):$n,Ot[6]=sr?Yi(Ot[5],p):Xt[6]),($n=Xt[7])&&(Ot[7]=$n),an&E&&(Ot[8]=Ot[8]==null?Xt[8]:hs(Ot[8],Xt[8])),Ot[9]==null&&(Ot[9]=Xt[9]),Ot[0]=Xt[0],Ot[1]=$r}(Nn,An),v=Nn[0],T=Nn[1],D=Nn[2],Y=Nn[3],oe=Nn[4],!($e=Nn[9]=Nn[9]===u?at?0:v.length:oi(Nn[9]-It,0))&&24&T&&(T&=-25),T&&T!=1)Yn=T==8||T==f?function(Ot,Xt,ir){var an=hm(Ot);return function $r(){for(var Sr=arguments.length,Ui=nn(Sr),$n=Sr,sr=Zs($r);$n--;)Ui[$n]=arguments[$n];var Sa=Sr<3&&Ui[0]!==sr&&Ui[Sr-1]!==sr?[]:Yi(Ui,sr);return(Sr-=Sa.length)<ir?If(Ot,Xt,fm,$r.placeholder,u,Ui,Sa,u,u,ir-Sr):ha(this&&this!==vn&&this instanceof $r?an:Ot,this,Ui)}}(v,T,$e):T!=g&&T!=33||oe.length?fm.apply(u,Nn):function(Ot,Xt,ir,an){var $r=1&Xt,Sr=hm(Ot);return function Ui(){for(var $n=-1,sr=arguments.length,Sa=-1,Oo=an.length,vl=nn(Oo+sr),Ds=this&&this!==vn&&this instanceof Ui?Sr:Ot;++Sa<Oo;)vl[Sa]=an[Sa];for(;sr--;)vl[Sa++]=arguments[++$n];return ha(Ds,$r?ir:this,vl)}}(v,T,D,Y);else var Yn=function(Ot,Xt,ir){var an=1&Xt,$r=hm(Ot);return function Sr(){return(this&&this!==vn&&this instanceof Sr?$r:Ot).apply(an?ir:this,arguments)}}(v,T,D);return vs((An?dd:Di)(Yn,Nn),v,T)}function yc(v,T,D,Y){return v===u||Zn(v,Ys[D])&&!Gr.call(Y,D)?T:v}function bc(v,T,D,Y,oe,we){return C(v)&&C(T)&&(we.set(T,v),Yg(v,T,u,bc,we),we.delete(T)),v}function wi(v){return J(v)?u:v}function gm(v,T,D,Y,oe,we){var Pe=1&D,$e=v.length,at=T.length;if($e!=at&&!(Pe&&at>$e))return!1;var It=we.get(v),At=we.get(T);if(It&&At)return It==T&&At==v;var Wt=-1,An=!0,Nn=2&D?new ll:u;for(we.set(v,T),we.set(T,v);++Wt<$e;){var Yn=v[Wt],Ot=T[Wt];if(Y)var Xt=Pe?Y(Ot,Yn,Wt,T,v,we):Y(Yn,Ot,Wt,v,T,we);if(Xt!==u){if(Xt)continue;An=!1;break}if(Nn){if(!Lg(T,function(ir,an){if(!nl(Nn,an)&&(Yn===ir||oe(Yn,ir,D,Y,we)))return Nn.push(an)})){An=!1;break}}else if(Yn!==Ot&&!oe(Yn,Ot,D,Y,we)){An=!1;break}}return we.delete(v),we.delete(T),An}function xi(v){return va(md(v,u,X_),v+"")}function Cr(v){return Cu(v,Sn,pd)}function ps(v){return Cu(v,qn,vm)}var ms=Pi?function(v){return Pi.get(v)}:Zl;function zs(v){for(var T=v.name+"",D=os[T],Y=Gr.call(os,T)?D.length:0;Y--;){var oe=D[Y],we=oe.func;if(we==null||we==v)return oe.name}return T}function Zs(v){return(Gr.call(me,"placeholder")?me:v).placeholder}function kn(){var v=me.iteratee||Pu;return v=v===Pu?Ef:v,arguments.length?v(arguments[0],arguments[1]):v}function gs(v,T){var D,Y,oe=v.__data__;return((Y=typeof(D=T))=="string"||Y=="number"||Y=="symbol"||Y=="boolean"?D!=="__proto__":D===null)?oe[typeof T=="string"?"string":"hash"]:oe.map}function In(v){for(var T=Sn(v),D=T.length;D--;){var Y=T[D],oe=v[Y];T[D]=[Y,oe,ym(oe)]}return T}function Ga(v,T){var D=function(Y,oe){return Y==null?u:Y[oe]}(v,T);return bf(D)?D:u}var pd=Zp?function(v){return v==null?[]:(v=Lr(v),jl(Zp(v),function(T){return Jp.call(v,T)}))}:Cm,vm=Zp?function(v){for(var T=[];v;)$l(T,pd(v)),v=ff(v);return T}:Cm,as=Vs;function Jo(v,T,D){for(var Y=-1,oe=(T=hl(T,v)).length,we=!1;++Y<oe;){var Pe=Lc(T[Y]);if(!(we=v!=null&&D(v,Pe)))break;v=v[Pe]}return we||++Y!=oe?we:!!(oe=v==null?0:v.length)&&S(oe)&&Ii(Pe,oe)&&(Ve(v)||Rr(v))}function iv(v){return typeof v.constructor!="function"||Dc(v)?{}:Wo(ff(v))}function _m(v){return Ve(v)||Rr(v)||!!(j_&&v&&v[j_])}function Ii(v,T){var D=typeof v;return!!(T=T??A)&&(D=="number"||D!="symbol"&&Jt.test(v))&&v>-1&&v%1==0&&v<T}function eo(v,T,D){if(!C(D))return!1;var Y=typeof T;return!!(Y=="number"?ut(D)&&Ii(T,D.length):Y=="string"&&T in D)&&Zn(D[T],v)}function kf(v,T){if(Ve(v))return!1;var D=typeof v;return!(D!="number"&&D!="symbol"&&D!="boolean"&&v!=null&&!ce(v))||ze.test(v)||!We.test(v)||T!=null&&v in Lr(T)}function Xl(v){var T=zs(v),D=me[T];if(typeof D!="function"||!(T in Mr.prototype))return!1;if(v===D)return!0;var Y=ms(D);return!!Y&&v===Y[0]}(nh&&as(new nh(new ArrayBuffer(1)))!=xe||ho&&as(new ho)!=ne||Lt&&as(Lt.resolve())!=G||Os&&as(new Os)!=se||Go&&as(new Go)!=_e)&&(as=function(v){var T=Vs(v),D=T==ie?v.constructor:u,Y=D?mh(D):"";if(Y)switch(Y){case ks:return xe;case mf:return ne;case tm:return G;case Tu:return se;case Fy:return _e}return T});var sv=Xs?x:Rm;function Dc(v){var T=v&&v.constructor;return v===(typeof T=="function"&&T.prototype||Ys)}function ym(v){return v==v&&!C(v)}function Nf(v,T){return function(D){return D!=null&&D[v]===T&&(T!==u||v in Lr(D))}}function md(v,T,D){return T=oi(T===u?v.length-1:T,0),function(){for(var Y=arguments,oe=-1,we=oi(Y.length-T,0),Pe=nn(we);++oe<we;)Pe[oe]=Y[T+oe];oe=-1;for(var $e=nn(T+1);++oe<T;)$e[oe]=Y[oe];return $e[T]=D(Pe),ha(v,this,$e)}}function Pf(v,T){return T.length<2?v:fs(v,Yo(T,0,-1))}function ph(v,T){if((T!=="constructor"||typeof v[T]!="function")&&T!="__proto__")return v[T]}var Di=to(dd),Ec=Uy||function(v,T){return vn.setTimeout(v,T)},va=to(Ru);function vs(v,T,D){var Y=T+"";return va(v,function(oe,we){var Pe=we.length;if(!Pe)return oe;var $e=Pe-1;return we[$e]=(Pe>1?"& ":"")+we[$e],we=we.join(Pe>2?", ":" "),oe.replace(V,`{
/* [wrapped with `+we+`] */
`)}(Y,function(oe,we){return ur(N,function(Pe){var $e="_."+Pe[0];we&Pe[1]&&!Vp(oe,$e)&&oe.push($e)}),oe.sort()}(function(oe){var we=oe.match(pe);return we?we[1].split(Ne):[]}(Y),D)))}function to(v){var T=0,D=0;return function(){var Y=Qn(),oe=16-(Y-D);if(D=Y,oe>0){if(++T>=800)return arguments[0]}else T=0;return v.apply(u,arguments)}}function Df(v,T){var D=-1,Y=v.length,oe=Y-1;for(T=T===u?Y:T;++D<T;){var we=Jg(D,oe),Pe=v[we];v[we]=v[D],v[D]=Pe}return v.length=T,v}var bm=function(v){var T=je(v,function(Y){return D.size===500&&D.clear(),Y}),D=T.cache;return T}(function(v){var T=[];return v.charCodeAt(0)===46&&T.push(""),v.replace(Vt,function(D,Y,oe,we){T.push(oe?we.replace(bt,"$1"):Y||D)}),T});function Lc(v){if(typeof v=="string"||ce(v))return v;var T=v+"";return T=="0"&&1/v==-1/0?"-0":T}function mh(v){if(v!=null){try{return Gl.call(v)}catch{}try{return v+""}catch{}}return""}function Ou(v){if(v instanceof Mr)return v.clone();var T=new Hs(v.__wrapped__,v.__chain__);return T.__actions__=Xo(v.__actions__),T.__index__=v.__index__,T.__values__=v.__values__,T}var Lf=xr(function(v,T){return Ht(v)?ih(v,fo(T,1,Ht,!0)):[]}),no=xr(function(v,T){var D=mo(T);return Ht(D)&&(D=u),Ht(v)?ih(v,fo(T,1,Ht,!0),kn(D,2)):[]}),Uf=xr(function(v,T){var D=mo(T);return Ht(D)&&(D=u),Ht(v)?ih(v,fo(T,1,Ht,!0),u,D):[]});function Vi(v,T,D){var Y=v==null?0:v.length;if(!Y)return-1;var oe=D==null?0:Te(D);return oe<0&&(oe=oi(Y+oe,0)),Ug(v,kn(T,3),oe)}function pl(v,T,D){var Y=v==null?0:v.length;if(!Y)return-1;var oe=Y-1;return D!==u&&(oe=Te(D),oe=D<0?oi(Y+oe,0):hs(oe,Y-1)),Ug(v,kn(T,3),oe,!0)}function X_(v){return v!=null&&v.length?fo(v,1):[]}function gd(v){return v&&v.length?v[0]:u}var gh=xr(function(v){var T=wr(v,rn);return T.length&&T[0]===v[0]?qg(T):[]}),_a=xr(function(v){var T=mo(v),D=wr(v,rn);return T===mo(D)?T=u:D.pop(),D.length&&D[0]===v[0]?qg(D,kn(T,2)):[]}),Qo=xr(function(v){var T=mo(v),D=wr(v,rn);return(T=typeof T=="function"?T:u)&&D.pop(),D.length&&D[0]===v[0]?qg(D,u,T):[]});function mo(v){var T=v==null?0:v.length;return T?v[T-1]:u}var ov=xr(vd);function vd(v,T){return v&&v.length&&T&&T.length?Xg(v,T):v}var ku=xi(function(v,T){var D=v==null?0:v.length,Y=Vg(v,T);return z_(v,wr(T,function(oe){return Ii(oe,D)?+oe:oe}).sort(Cf)),Y});function Ir(v){return v==null?v:Ai.call(v)}var Hy=xr(function(v){return Au(fo(v,1,Ht,!0))}),Wa=xr(function(v){var T=mo(v);return Ht(T)&&(T=u),Au(fo(v,1,Ht,!0),kn(T,2))}),AS=xr(function(v){var T=mo(v);return T=typeof T=="function"?T:u,Au(fo(v,1,Ht,!0),u,T)});function vh(v){if(!v||!v.length)return[];var T=0;return v=jl(v,function(D){if(Ht(D))return T=oi(D.length,T),!0}),U_(T,function(D){return wr(v,Wp(D))})}function Ff(v,T){if(!v||!v.length)return[];var D=vh(v);return T==null?D:wr(D,function(Y){return ha(T,u,Y)})}var Em=xr(function(v,T){return Ht(v)?ih(v,T):[]}),Vy=xr(function(v){return Mu(jl(v,Ht))}),zy=xr(function(v){var T=mo(v);return Ht(T)&&(T=u),Mu(jl(v,Ht),kn(T,2))}),MS=xr(function(v){var T=mo(v);return T=typeof T=="function"?T:u,Mu(jl(v,Ht),u,T)}),_s=xr(vh),Sc=xr(function(v){var T=v.length,D=T>1?v[T-1]:u;return D=typeof D=="function"?(v.pop(),D):u,Ff(v,D)});function _h(v){var T=me(v);return T.__chain__=!0,T}function Zo(v,T){return T(v)}var Jl=xi(function(v){var T=v.length,D=T?v[0]:0,Y=this.__wrapped__,oe=function(we){return Vg(we,v)};return!(T>1||this.__actions__.length)&&Y instanceof Mr&&Ii(D)?((Y=Y.slice(D,+D+(T?1:0))).__actions__.push({func:Zo,args:[oe],thisArg:u}),new Hs(Y,this.__chain__).thru(function(we){return T&&!we.length&&we.push(u),we})):this.thru(oe)}),ya=Af(function(v,T,D){Gr.call(v,D)?++v[D]:dl(v,D,1)}),zi=q_(Vi),Io=q_(pl);function Sm(v,T){return(Ve(v)?ur:ud)(v,kn(T,3))}function av(v,T){return(Ve(v)?Py:rm)(v,kn(T,3))}var J_=Af(function(v,T,D){Gr.call(v,D)?v[D].push(T):dl(v,D,[T])}),Gy=xr(function(v,T,D){var Y=-1,oe=typeof T=="function",we=ut(v)?nn(v.length):[];return ud(v,function(Pe){we[++Y]=oe?ha(T,Pe,D):ql(Pe,T,D)}),we}),Q_=Af(function(v,T,D){dl(v,D,T)});function Tm(v,T){return(Ve(v)?wr:pa)(v,kn(T,3))}var cv=Af(function(v,T,D){v[D?0:1].push(T)},function(){return[[],[]]}),IS=xr(function(v,T){if(v==null)return[];var D=T.length;return D>1&&eo(v,T[0],T[1])?T=[]:D>2&&eo(T[0],T[1],T[2])&&(T=[T[0]]),Ko(v,fo(T,1),[])}),wm=ss||function(){return vn.Date.now()};function m(v,T,D){return T=D?u:T,T=v&&T==null?v.length:T,_c(v,E,u,u,u,u,T)}function _(v,T){var D;if(typeof T!="function")throw new Ro(d);return v=Te(v),function(){return--v>0&&(D=T.apply(this,arguments)),v<=1&&(T=u),D}}var M=xr(function(v,T,D){var Y=1;if(D.length){var oe=Yi(D,Zs(M));Y|=g}return _c(v,Y,T,D,oe)}),L=xr(function(v,T,D){var Y=3;if(D.length){var oe=Yi(D,Zs(L));Y|=g}return _c(T,Y,v,D,oe)});function H(v,T,D){var Y,oe,we,Pe,$e,at,It=0,At=!1,Wt=!1,An=!0;if(typeof v!="function")throw new Ro(d);function Nn(an){var $r=Y,Sr=oe;return Y=oe=u,It=an,Pe=v.apply(Sr,$r)}function Yn(an){var $r=an-at;return at===u||$r>=T||$r<0||Wt&&an-It>=we}function Ot(){var an=wm();if(Yn(an))return Xt(an);$e=Ec(Ot,function($r){var Sr=T-($r-at);return Wt?hs(Sr,we-($r-It)):Sr}(an))}function Xt(an){return $e=u,An&&Y?Nn(an):(Y=oe=u,Pe)}function ir(){var an=wm(),$r=Yn(an);if(Y=arguments,oe=this,at=an,$r){if($e===u)return function(Sr){return It=Sr,$e=Ec(Ot,T),At?Nn(Sr):Pe}(at);if(Wt)return Iu($e),$e=Ec(Ot,T),Nn(at)}return $e===u&&($e=Ec(Ot,T)),Pe}return T=Ut(T)||0,C(D)&&(At=!!D.leading,we=(Wt="maxWait"in D)?oi(Ut(D.maxWait)||0,T):we,An="trailing"in D?!!D.trailing:An),ir.cancel=function(){$e!==u&&Iu($e),It=0,Y=at=oe=$e=u},ir.flush=function(){return $e===u?Pe:Xt(wm())},ir}var ee=xr(function(v,T){return zg(v,1,T)}),Ae=xr(function(v,T,D){return zg(v,Ut(T)||0,D)});function je(v,T){if(typeof v!="function"||T!=null&&typeof T!="function")throw new Ro(d);var D=function(){var Y=arguments,oe=T?T.apply(this,Y):Y[0],we=D.cache;if(we.has(oe))return we.get(oe);var Pe=v.apply(this,Y);return D.cache=we.set(oe,Pe)||we,Pe};return D.cache=new(je.Cache||cl),D}function Et(v){if(typeof v!="function")throw new Ro(d);return function(){var T=arguments;switch(T.length){case 0:return!v.call(this);case 1:return!v.call(this,T[0]);case 2:return!v.call(this,T[0],T[1]);case 3:return!v.call(this,T[0],T[1],T[2])}return!v.apply(this,T)}}je.Cache=cl;var qt=$y(function(v,T){var D=(T=T.length==1&&Ve(T[0])?wr(T[0],hc(kn())):wr(fo(T,1),hc(kn()))).length;return xr(function(Y){for(var oe=-1,we=hs(Y.length,D);++oe<we;)Y[oe]=T[oe].call(this,Y[oe]);return ha(v,this,Y)})}),fn=xr(function(v,T){var D=Yi(T,Zs(fn));return _c(v,g,u,T,D)}),pr=xr(function(v,T){var D=Yi(T,Zs(pr));return _c(v,y,u,T,D)}),gn=xi(function(v,T){return _c(v,w,u,u,u,T)});function Zn(v,T){return v===T||v!=v&&T!=T}var bn=fh(Mi),ea=fh(function(v,T){return v>=T}),Rr=sm(function(){return arguments}())?sm:function(v){return O(v)&&Gr.call(v,"callee")&&!Jp.call(v,"callee")},Ve=nn.isArray,Je=Xd?hc(Xd):function(v){return O(v)&&Vs(v)==le};function ut(v){return v!=null&&S(v.length)&&!x(v)}function Ht(v){return O(v)&&ut(v)}var yn=em||Rm,dr=lf?hc(lf):function(v){return O(v)&&Vs(v)==q};function hr(v){if(!O(v))return!1;var T=Vs(v);return T==K||T=="[object DOMException]"||typeof v.message=="string"&&typeof v.name=="string"&&!J(v)}function x(v){if(!C(v))return!1;var T=Vs(v);return T==W||T==X||T=="[object AsyncFunction]"||T=="[object Proxy]"}function b(v){return typeof v=="number"&&v==Te(v)}function S(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=A}function C(v){var T=typeof v;return v!=null&&(T=="object"||T=="function")}function O(v){return v!=null&&typeof v=="object"}var P=bu?hc(bu):function(v){return O(v)&&as(v)==ne};function B(v){return typeof v=="number"||O(v)&&Vs(v)==Z}function J(v){if(!O(v)||Vs(v)!=ie)return!1;var T=ff(v);if(T===null)return!0;var D=Gr.call(T,"constructor")&&T.constructor;return typeof D=="function"&&D instanceof D&&Gl.call(D)==ad}var te=$p?hc($p):function(v){return O(v)&&Vs(v)==Q},z=Hp?hc(Hp):function(v){return O(v)&&as(v)==se};function re(v){return typeof v=="string"||!Ve(v)&&O(v)&&Vs(v)==ve}function ce(v){return typeof v=="symbol"||O(v)&&Vs(v)==Oe}var de=nd?hc(nd):function(v){return O(v)&&S(v.length)&&!!Jn[Vs(v)]},ke=fh(am),Qe=fh(function(v,T){return v<=T});function Be(v){if(!v)return[];if(ut(v))return re(v)?Is(v):Xo(v);if(sl&&v[sl])return function(D){for(var Y,oe=[];!(Y=D.next()).done;)oe.push(Y.value);return oe}(v[sl]());var T=as(v);return(T==ne?Jd:T==se?$a:Li)(v)}function Me(v){return v?(v=Ut(v))===R||v===-1/0?17976931348623157e292*(v<0?-1:1):v==v?v:0:v===0?v:0}function Te(v){var T=Me(v),D=T%1;return T==T?D?T-D:T:0}function gt(v){return v?xu(Te(v),0,I):0}function Ut(v){if(typeof v=="number")return v;if(ce(v))return k;if(C(v)){var T=typeof v.valueOf=="function"?v.valueOf():v;v=C(T)?T+"":T}if(typeof v!="string")return v===0?v:+v;v=qp(v);var D=st.test(v);return D||sn.test(v)?Co(v.slice(2),D?2:8):Dt.test(v)?k:+v}function en(v){return fl(v,qn(v))}function Pt(v){return v==null?"":ma(v)}var Hn=fd(function(v,T){if(Dc(T)||ut(T))fl(T,Sn(T),v);else for(var D in T)Gr.call(T,D)&&wu(v,D,T[D])}),Ln=fd(function(v,T){fl(T,qn(T),v)}),Or=fd(function(v,T,D,Y){fl(T,qn(T),v,Y)}),Ur=fd(function(v,T,D,Y){fl(T,Sn(T),v,Y)}),Fr=xi(Vg),Br=xr(function(v,T){v=Lr(v);var D=-1,Y=T.length,oe=Y>2?T[2]:u;for(oe&&eo(T[0],T[1],oe)&&(Y=1);++D<Y;)for(var we=T[D],Pe=qn(we),$e=-1,at=Pe.length;++$e<at;){var It=Pe[$e],At=v[It];(At===u||Zn(At,Ys[It])&&!Gr.call(v,It))&&(v[It]=we[It])}return v}),vr=xr(function(v){return v.push(u,bc),ha(Xi,u,v)});function kr(v,T,D){var Y=v==null?u:fs(v,T);return Y===u?D:Y}function Nr(v,T){return v!=null&&Jo(v,T,sh)}var Pr=K_(function(v,T,D){T!=null&&typeof T.toString!="function"&&(T=Yp.call(T)),v[T]=D},Ql(Ps)),jr=K_(function(v,T,D){T!=null&&typeof T.toString!="function"&&(T=Yp.call(T)),Gr.call(v,T)?v[T].push(D):v[T]=[D]},kn),er=xr(ql);function Sn(v){return ut(v)?jg(v):Sf(v)}function qn(v){return ut(v)?jg(v,!0):om(v)}var vi=fd(function(v,T,D){Yg(v,T,D)}),Xi=fd(function(v,T,D,Y){Yg(v,T,D,Y)}),Ji=xi(function(v,T){var D={};if(v==null)return D;var Y=!1;T=wr(T,function(we){return we=hl(we,v),Y||(Y=we.length>1),we}),fl(v,ps(v),D),Y&&(D=qo(D,7,wi));for(var oe=T.length;oe--;)ga(D,T[oe]);return D}),ys=xi(function(v,T){return v==null?{}:function(D,Y){return V_(D,Y,function(oe,we){return Nr(D,we)})}(v,T)});function cs(v,T){if(v==null)return{};var D=wr(ps(v),function(Y){return[Y]});return T=kn(T),V_(v,D,function(Y,oe){return T(Y,oe[0])})}var ls=mm(Sn),Qi=mm(qn);function Li(v){return v==null?[]:si(v,Sn(v))}var us=uh(function(v,T,D){return T=T.toLowerCase(),v+(D?Gs(T):T)});function Gs(v){return qa(Pt(v).toLowerCase())}function Zi(v){return(v=Pt(v))&&v.replace(Le,F_).replace(En,"")}var ba=uh(function(v,T,D){return v+(D?"-":"")+T.toLowerCase()}),ta=uh(function(v,T,D){return v+(D?" ":"")+T.toLowerCase()}),Tc=dm("toLowerCase"),wc=uh(function(v,T,D){return v+(D?"_":"")+T.toLowerCase()}),Ea=uh(function(v,T,D){return v+(D?" ":"")+qa(T)}),ml=uh(function(v,T,D){return v+(D?" ":"")+T.toUpperCase()}),qa=dm("toUpperCase");function Uc(v,T,D){return v=Pt(v),(T=D?u:T)===u?function(Y){return qi.test(Y)}(v)?function(Y){return Y.match(br)||[]}(v):function(Y){return Y.match(Fe)||[]}(v):v.match(T)||[]}var gl=xr(function(v,T){try{return ha(v,u,T)}catch(D){return hr(D)?D:new zr(D)}}),Ka=xi(function(v,T){return ur(T,function(D){D=Lc(D),dl(v,D,M(v[D],v))}),v});function Ql(v){return function(){return v}}var yh=rv(),Nu=rv(!0);function Ps(v){return v}function Pu(v){return Ef(typeof v=="function"?v:qo(v,1))}var _d=xr(function(v,T){return function(D){return ql(D,v,T)}}),yd=xr(function(v,T){return function(D){return ql(v,D,T)}});function Du(v,T,D){var Y=Sn(T),oe=Wl(T,Y);D!=null||C(T)&&(oe.length||!Y.length)||(D=T,T=v,v=this,oe=Wl(T,Sn(T)));var we=!(C(D)&&"chain"in D&&!D.chain),Pe=x(v);return ur(oe,function($e){var at=T[$e];v[$e]=at,Pe&&(v.prototype[$e]=function(){var It=this.__chain__;if(we||It){var At=v(this.__wrapped__);return(At.__actions__=Xo(this.__actions__)).push({func:at,args:arguments,thisArg:v}),At.__chain__=It,At}return at.apply(v,$l([this.value()],arguments))})}),v}function Zl(){}var bd=Mf(wr),Ed=Mf(Pg),lv=Mf(Lg);function xm(v){return kf(v)?Wp(Lc(v)):function(T){return function(D){return fs(D,T)}}(v)}var uv=pm(),dv=pm(!0);function Cm(){return[]}function Rm(){return!1}var Z_=dh(function(v,T){return v+T},0),e0=Of("ceil"),t0=dh(function(v,T){return v/T},1),Wy=Of("floor"),n0,Bf=dh(function(v,T){return v*T},1),qy=Of("round"),Ky=dh(function(v,T){return v-T},0);return me.after=function(v,T){if(typeof T!="function")throw new Ro(d);return v=Te(v),function(){if(--v<1)return T.apply(this,arguments)}},me.ary=m,me.assign=Hn,me.assignIn=Ln,me.assignInWith=Or,me.assignWith=Ur,me.at=Fr,me.before=_,me.bind=M,me.bindAll=Ka,me.bindKey=L,me.castArray=function(){if(!arguments.length)return[];var v=arguments[0];return Ve(v)?v:[v]},me.chain=_h,me.chunk=function(v,T,D){T=(D?eo(v,T,D):T===u)?1:oi(Te(T),0);var Y=v==null?0:v.length;if(!Y||T<1)return[];for(var oe=0,we=0,Pe=nn(Qp(Y/T));oe<Y;)Pe[we++]=Yo(v,oe,oe+=T);return Pe},me.compact=function(v){for(var T=-1,D=v==null?0:v.length,Y=0,oe=[];++T<D;){var we=v[T];we&&(oe[Y++]=we)}return oe},me.concat=function(){var v=arguments.length;if(!v)return[];for(var T=nn(v-1),D=arguments[0],Y=v;Y--;)T[Y-1]=arguments[Y];return $l(Ve(D)?Xo(D):[D],fo(T,1))},me.cond=function(v){var T=v==null?0:v.length,D=kn();return v=T?wr(v,function(Y){if(typeof Y[1]!="function")throw new Ro(d);return[D(Y[0]),Y[1]]}):[],xr(function(Y){for(var oe=-1;++oe<T;){var we=v[oe];if(ha(we[0],this,Y))return ha(we[1],this,Y)}})},me.conforms=function(v){return function(T){var D=Sn(T);return function(Y){return Ns(Y,T,D)}}(qo(v,1))},me.constant=Ql,me.countBy=ya,me.create=function(v,T){var D=Wo(v);return T==null?D:vf(D,T)},me.curry=function v(T,D,Y){var oe=_c(T,8,u,u,u,u,u,D=Y?u:D);return oe.placeholder=v.placeholder,oe},me.curryRight=function v(T,D,Y){var oe=_c(T,f,u,u,u,u,u,D=Y?u:D);return oe.placeholder=v.placeholder,oe},me.debounce=H,me.defaults=Br,me.defaultsDeep=vr,me.defer=ee,me.delay=Ae,me.difference=Lf,me.differenceBy=no,me.differenceWith=Uf,me.drop=function(v,T,D){var Y=v==null?0:v.length;return Y?Yo(v,(T=D||T===u?1:Te(T))<0?0:T,Y):[]},me.dropRight=function(v,T,D){var Y=v==null?0:v.length;return Y?Yo(v,0,(T=Y-(T=D||T===u?1:Te(T)))<0?0:T):[]},me.dropRightWhile=function(v,T){return v&&v.length?ev(v,kn(T,3),!0,!0):[]},me.dropWhile=function(v,T){return v&&v.length?ev(v,kn(T,3),!0):[]},me.fill=function(v,T,D,Y){var oe=v==null?0:v.length;return oe?(D&&typeof D!="number"&&eo(v,T,D)&&(D=0,Y=oe),function(we,Pe,$e,at){var It=we.length;for(($e=Te($e))<0&&($e=-$e>It?0:It+$e),(at=at===u||at>It?It:Te(at))<0&&(at+=It),at=$e>at?0:gt(at);$e<at;)we[$e++]=Pe;return we}(v,T,D,Y)):[]},me.filter=function(v,T){return(Ve(v)?jl:_f)(v,kn(T,3))},me.flatMap=function(v,T){return fo(Tm(v,T),1)},me.flatMapDeep=function(v,T){return fo(Tm(v,T),R)},me.flatMapDepth=function(v,T,D){return D=D===u?1:Te(D),fo(Tm(v,T),D)},me.flatten=X_,me.flattenDeep=function(v){return v!=null&&v.length?fo(v,R):[]},me.flattenDepth=function(v,T){return v!=null&&v.length?fo(v,T=T===u?1:Te(T)):[]},me.flip=function(v){return _c(v,512)},me.flow=yh,me.flowRight=Nu,me.fromPairs=function(v){for(var T=-1,D=v==null?0:v.length,Y={};++T<D;){var oe=v[T];Y[oe[0]]=oe[1]}return Y},me.functions=function(v){return v==null?[]:Wl(v,Sn(v))},me.functionsIn=function(v){return v==null?[]:Wl(v,qn(v))},me.groupBy=J_,me.initial=function(v){return v!=null&&v.length?Yo(v,0,-1):[]},me.intersection=gh,me.intersectionBy=_a,me.intersectionWith=Qo,me.invert=Pr,me.invertBy=jr,me.invokeMap=Gy,me.iteratee=Pu,me.keyBy=Q_,me.keys=Sn,me.keysIn=qn,me.map=Tm,me.mapKeys=function(v,T){var D={};return T=kn(T,3),Va(v,function(Y,oe,we){dl(D,T(Y,oe,we),Y)}),D},me.mapValues=function(v,T){var D={};return T=kn(T,3),Va(v,function(Y,oe,we){dl(D,oe,T(Y,oe,we))}),D},me.matches=function(v){return po(qo(v,1))},me.matchesProperty=function(v,T){return H_(v,qo(T,1))},me.memoize=je,me.merge=vi,me.mergeWith=Xi,me.method=_d,me.methodOf=yd,me.mixin=Du,me.negate=Et,me.nthArg=function(v){return v=Te(v),xr(function(T){return za(T,v)})},me.omit=Ji,me.omitBy=function(v,T){return cs(v,Et(kn(T)))},me.once=function(v){return _(2,v)},me.orderBy=function(v,T,D,Y){return v==null?[]:(Ve(T)||(T=T==null?[]:[T]),Ve(D=Y?u:D)||(D=D==null?[]:[D]),Ko(v,T,D))},me.over=bd,me.overArgs=qt,me.overEvery=Ed,me.overSome=lv,me.partial=fn,me.partialRight=pr,me.partition=cv,me.pick=ys,me.pickBy=cs,me.property=xm,me.propertyOf=function(v){return function(T){return v==null?u:fs(v,T)}},me.pull=ov,me.pullAll=vd,me.pullAllBy=function(v,T,D){return v&&v.length&&T&&T.length?Xg(v,T,kn(D,2)):v},me.pullAllWith=function(v,T,D){return v&&v.length&&T&&T.length?Xg(v,T,u,D):v},me.pullAt=ku,me.range=uv,me.rangeRight=dv,me.rearg=gn,me.reject=function(v,T){return(Ve(v)?jl:_f)(v,Et(kn(T,3)))},me.remove=function(v,T){var D=[];if(!v||!v.length)return D;var Y=-1,oe=[],we=v.length;for(T=kn(T,3);++Y<we;){var Pe=v[Y];T(Pe,Y,v)&&(D.push(Pe),oe.push(Y))}return z_(v,oe),D},me.rest=function(v,T){if(typeof v!="function")throw new Ro(d);return xr(v,T=T===u?T:Te(T))},me.reverse=Ir,me.sampleSize=function(v,T,D){return T=(D?eo(v,T,D):T===u)?1:Te(T),(Ve(v)?$g:G_)(v,T)},me.set=function(v,T,D){return v==null?v:Tf(v,T,D)},me.setWith=function(v,T,D,Y){return Y=typeof Y=="function"?Y:u,v==null?v:Tf(v,T,D,Y)},me.shuffle=function(v){return(Ve(v)?rh:Kl)(v)},me.slice=function(v,T,D){var Y=v==null?0:v.length;return Y?(D&&typeof D!="number"&&eo(v,T,D)?(T=0,D=Y):(T=T==null?0:Te(T),D=D===u?Y:Te(D)),Yo(v,T,D)):[]},me.sortBy=IS,me.sortedUniq=function(v){return v&&v.length?lm(v):[]},me.sortedUniqBy=function(v,T){return v&&v.length?lm(v,kn(T,2)):[]},me.split=function(v,T,D){return D&&typeof D!="number"&&eo(v,T,D)&&(T=D=u),(D=D===u?I:D>>>0)?(v=Pt(v))&&(typeof T=="string"||T!=null&&!te(T))&&!(T=ma(T))&&Eu(v)?Mo(Is(v),0,D):v.split(T,D):[]},me.spread=function(v,T){if(typeof v!="function")throw new Ro(d);return T=T==null?0:oi(Te(T),0),xr(function(D){var Y=D[T],oe=Mo(D,0,T);return Y&&$l(oe,Y),ha(v,this,oe)})},me.tail=function(v){var T=v==null?0:v.length;return T?Yo(v,1,T):[]},me.take=function(v,T,D){return v&&v.length?Yo(v,0,(T=D||T===u?1:Te(T))<0?0:T):[]},me.takeRight=function(v,T,D){var Y=v==null?0:v.length;return Y?Yo(v,(T=Y-(T=D||T===u?1:Te(T)))<0?0:T,Y):[]},me.takeRightWhile=function(v,T){return v&&v.length?ev(v,kn(T,3),!1,!0):[]},me.takeWhile=function(v,T){return v&&v.length?ev(v,kn(T,3)):[]},me.tap=function(v,T){return T(v),v},me.throttle=function(v,T,D){var Y=!0,oe=!0;if(typeof v!="function")throw new Ro(d);return C(D)&&(Y="leading"in D?!!D.leading:Y,oe="trailing"in D?!!D.trailing:oe),H(v,T,{leading:Y,maxWait:T,trailing:oe})},me.thru=Zo,me.toArray=Be,me.toPairs=ls,me.toPairsIn=Qi,me.toPath=function(v){return Ve(v)?wr(v,Lc):ce(v)?[v]:Xo(bm(Pt(v)))},me.toPlainObject=en,me.transform=function(v,T,D){var Y=Ve(v),oe=Y||yn(v)||de(v);if(T=kn(T,4),D==null){var we=v&&v.constructor;D=oe?Y?new we:[]:C(v)&&x(we)?Wo(ff(v)):{}}return(oe?ur:Va)(v,function(Pe,$e,at){return T(D,Pe,$e,at)}),D},me.unary=function(v){return m(v,1)},me.union=Hy,me.unionBy=Wa,me.unionWith=AS,me.uniq=function(v){return v&&v.length?Au(v):[]},me.uniqBy=function(v,T){return v&&v.length?Au(v,kn(T,2)):[]},me.uniqWith=function(v,T){return T=typeof T=="function"?T:u,v&&v.length?Au(v,u,T):[]},me.unset=function(v,T){return v==null||ga(v,T)},me.unzip=vh,me.unzipWith=Ff,me.update=function(v,T,D){return v==null?v:jy(v,T,ah(D))},me.updateWith=function(v,T,D,Y){return Y=typeof Y=="function"?Y:u,v==null?v:jy(v,T,ah(D),Y)},me.values=Li,me.valuesIn=function(v){return v==null?[]:si(v,qn(v))},me.without=Em,me.words=Uc,me.wrap=function(v,T){return fn(ah(T),v)},me.xor=Vy,me.xorBy=zy,me.xorWith=MS,me.zip=_s,me.zipObject=function(v,T){return um(v||[],T||[],wu)},me.zipObjectDeep=function(v,T){return um(v||[],T||[],Tf)},me.zipWith=Sc,me.entries=ls,me.entriesIn=Qi,me.extend=Ln,me.extendWith=Or,Du(me,me),me.add=Z_,me.attempt=gl,me.camelCase=us,me.capitalize=Gs,me.ceil=e0,me.clamp=function(v,T,D){return D===u&&(D=T,T=u),D!==u&&(D=(D=Ut(D))==D?D:0),T!==u&&(T=(T=Ut(T))==T?T:0),xu(Ut(v),T,D)},me.clone=function(v){return qo(v,4)},me.cloneDeep=function(v){return qo(v,5)},me.cloneDeepWith=function(v,T){return qo(v,5,T=typeof T=="function"?T:u)},me.cloneWith=function(v,T){return qo(v,4,T=typeof T=="function"?T:u)},me.conformsTo=function(v,T){return T==null||Ns(v,T,Sn(T))},me.deburr=Zi,me.defaultTo=function(v,T){return v==null||v!=v?T:v},me.divide=t0,me.endsWith=function(v,T,D){v=Pt(v),T=ma(T);var Y=v.length,oe=D=D===u?Y:xu(Te(D),0,Y);return(D-=T.length)>=0&&v.slice(D,oe)==T},me.eq=Zn,me.escape=function(v){return(v=Pt(v))&&Ce.test(v)?v.replace(He,hf):v},me.escapeRegExp=function(v){return(v=Pt(v))&&jt.test(v)?v.replace(xt,"\\$&"):v},me.every=function(v,T,D){var Y=Ve(v)?Pg:By;return D&&eo(v,T,D)&&(T=u),Y(v,kn(T,3))},me.find=zi,me.findIndex=Vi,me.findKey=function(v,T){return tl(v,kn(T,3),Va)},me.findLast=Io,me.findLastIndex=pl,me.findLastKey=function(v,T){return tl(v,kn(T,3),$_)},me.floor=Wy,me.forEach=Sm,me.forEachRight=av,me.forIn=function(v,T){return v==null?v:Gg(v,kn(T,3),qn)},me.forInRight=function(v,T){return v==null?v:Wg(v,kn(T,3),qn)},me.forOwn=function(v,T){return v&&Va(v,kn(T,3))},me.forOwnRight=function(v,T){return v&&$_(v,kn(T,3))},me.get=kr,me.gt=bn,me.gte=ea,me.has=function(v,T){return v!=null&&Jo(v,T,yf)},me.hasIn=Nr,me.head=gd,me.identity=Ps,me.includes=function(v,T,D,Y){v=ut(v)?v:Li(v),D=D&&!Y?Te(D):0;var oe=v.length;return D<0&&(D=oi(oe+D,0)),re(v)?D<=oe&&v.indexOf(T,D)>-1:!!oe&&df(v,T,D)>-1},me.indexOf=function(v,T,D){var Y=v==null?0:v.length;if(!Y)return-1;var oe=D==null?0:Te(D);return oe<0&&(oe=oi(Y+oe,0)),df(v,T,oe)},me.inRange=function(v,T,D){return T=Me(T),D===u?(D=T,T=0):D=Me(D),function(Y,oe,we){return Y>=hs(oe,we)&&Y<oi(oe,we)}(v=Ut(v),T,D)},me.invoke=er,me.isArguments=Rr,me.isArray=Ve,me.isArrayBuffer=Je,me.isArrayLike=ut,me.isArrayLikeObject=Ht,me.isBoolean=function(v){return v===!0||v===!1||O(v)&&Vs(v)==$},me.isBuffer=yn,me.isDate=dr,me.isElement=function(v){return O(v)&&v.nodeType===1&&!J(v)},me.isEmpty=function(v){if(v==null)return!0;if(ut(v)&&(Ve(v)||typeof v=="string"||typeof v.splice=="function"||yn(v)||de(v)||Rr(v)))return!v.length;var T=as(v);if(T==ne||T==se)return!v.size;if(Dc(v))return!Sf(v).length;for(var D in v)if(Gr.call(v,D))return!1;return!0},me.isEqual=function(v,T){return Ao(v,T)},me.isEqualWith=function(v,T,D){var Y=(D=typeof D=="function"?D:u)?D(v,T):u;return Y===u?Ao(v,T,u,D):!!Y},me.isError=hr,me.isFinite=function(v){return typeof v=="number"&&Js(v)},me.isFunction=x,me.isInteger=b,me.isLength=S,me.isMap=P,me.isMatch=function(v,T){return v===T||Kg(v,T,In(T))},me.isMatchWith=function(v,T,D){return D=typeof D=="function"?D:u,Kg(v,T,In(T),D)},me.isNaN=function(v){return B(v)&&v!=+v},me.isNative=function(v){if(sv(v))throw new zr("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return bf(v)},me.isNil=function(v){return v==null},me.isNull=function(v){return v===null},me.isNumber=B,me.isObject=C,me.isObjectLike=O,me.isPlainObject=J,me.isRegExp=te,me.isSafeInteger=function(v){return b(v)&&v>=-9007199254740991&&v<=A},me.isSet=z,me.isString=re,me.isSymbol=ce,me.isTypedArray=de,me.isUndefined=function(v){return v===u},me.isWeakMap=function(v){return O(v)&&as(v)==_e},me.isWeakSet=function(v){return O(v)&&Vs(v)=="[object WeakSet]"},me.join=function(v,T){return v==null?"":pf.call(v,T)},me.kebabCase=ba,me.last=mo,me.lastIndexOf=function(v,T,D){var Y=v==null?0:v.length;if(!Y)return-1;var oe=Y;return D!==u&&(oe=(oe=Te(D))<0?oi(Y+oe,0):hs(oe,Y-1)),T==T?function(we,Pe,$e){for(var at=$e+1;at--;)if(we[at]===Pe)return at;return at}(v,T,oe):Ug(v,Vl,oe,!0)},me.lowerCase=ta,me.lowerFirst=Tc,me.lt=ke,me.lte=Qe,me.max=function(v){return v&&v.length?im(v,Ps,Mi):u},me.maxBy=function(v,T){return v&&v.length?im(v,kn(T,2),Mi):u},me.mean=function(v){return Gp(v,Ps)},me.meanBy=function(v,T){return Gp(v,kn(T,2))},me.min=function(v){return v&&v.length?im(v,Ps,am):u},me.minBy=function(v,T){return v&&v.length?im(v,kn(T,2),am):u},me.stubArray=Cm,me.stubFalse=Rm,me.stubObject=function(){return{}},me.stubString=function(){return""},me.stubTrue=function(){return!0},me.multiply=Bf,me.nth=function(v,T){return v&&v.length?za(v,Te(T)):u},me.noConflict=function(){return vn._===this&&(vn._=B_),this},me.noop=Zl,me.now=wm,me.pad=function(v,T,D){v=Pt(v);var Y=(T=Te(T))?Ms(v):0;if(!T||Y>=T)return v;var oe=(T-Y)/2;return hh(lo(oe),D)+v+hh(Qp(oe),D)},me.padEnd=function(v,T,D){v=Pt(v);var Y=(T=Te(T))?Ms(v):0;return T&&Y<T?v+hh(T-Y,D):v},me.padStart=function(v,T,D){v=Pt(v);var Y=(T=Te(T))?Ms(v):0;return T&&Y<T?hh(T-Y,D)+v:v},me.parseInt=function(v,T,D){return D||T==null?T=0:T&&(T=+T),mc(Pt(v).replace(ae,""),T||0)},me.random=function(v,T,D){if(D&&typeof D!="boolean"&&eo(v,T,D)&&(T=D=u),D===u&&(typeof T=="boolean"?(D=T,T=u):typeof v=="boolean"&&(D=v,v=u)),v===u&&T===u?(v=0,T=1):(v=Me(v),T===u?(T=v,v=0):T=Me(T)),v>T){var Y=v;v=T,T=Y}if(D||v%1||T%1){var oe=uo();return hs(v+oe*(T-v+Ti("1e-"+((oe+"").length-1))),T)}return Jg(v,T)},me.reduce=function(v,T,D){var Y=Ve(v)?L_:Dy,oe=arguments.length<3;return Y(v,kn(T,4),D,oe,ud)},me.reduceRight=function(v,T,D){var Y=Ve(v)?Dg:Dy,oe=arguments.length<3;return Y(v,kn(T,4),D,oe,rm)},me.repeat=function(v,T,D){return T=(D?eo(v,T,D):T===u)?1:Te(T),Qg(Pt(v),T)},me.replace=function(){var v=arguments,T=Pt(v[0]);return v.length<3?T:T.replace(v[1],v[2])},me.result=function(v,T,D){var Y=-1,oe=(T=hl(T,v)).length;for(oe||(oe=1,v=u);++Y<oe;){var we=v==null?u:v[Lc(T[Y])];we===u&&(Y=oe,we=D),v=x(we)?we.call(v):we}return v},me.round=qy,me.runInContext=ot,me.sample=function(v){return(Ve(v)?ul:cm)(v)},me.size=function(v){if(v==null)return 0;if(ut(v))return re(v)?Ms(v):v.length;var T=as(v);return T==ne||T==se?v.size:Sf(v).length},me.snakeCase=wc,me.some=function(v,T,D){var Y=Ve(v)?Lg:Yl;return D&&eo(v,T,D)&&(T=u),Y(v,kn(T,3))},me.sortedIndex=function(v,T){return hd(v,T)},me.sortedIndexBy=function(v,T,D){return Zg(v,T,kn(D,2))},me.sortedIndexOf=function(v,T){var D=v==null?0:v.length;if(D){var Y=hd(v,T);if(Y<D&&Zn(v[Y],T))return Y}return-1},me.sortedLastIndex=function(v,T){return hd(v,T,!0)},me.sortedLastIndexBy=function(v,T,D){return Zg(v,T,kn(D,2),!0)},me.sortedLastIndexOf=function(v,T){if(v!=null&&v.length){var D=hd(v,T,!0)-1;if(Zn(v[D],T))return D}return-1},me.startCase=Ea,me.startsWith=function(v,T,D){return v=Pt(v),D=D==null?0:xu(Te(D),0,v.length),T=ma(T),v.slice(D,D+T.length)==T},me.subtract=Ky,me.sum=function(v){return v&&v.length?dc(v,Ps):0},me.sumBy=function(v,T){return v&&v.length?dc(v,kn(T,2)):0},me.template=function(v,T,D){var Y=me.templateSettings;D&&eo(v,T,D)&&(T=u),v=Pt(v),T=Or({},T,Y,yc);var oe,we,Pe=Or({},T.imports,Y.imports,yc),$e=Sn(Pe),at=si(Pe,$e),It=0,At=T.interpolate||it,Wt="__p += '",An=Qd((T.escape||it).source+"|"+At.source+"|"+(At===yt?Dn:it).source+"|"+(T.evaluate||it).source+"|$","g"),Nn="//# sourceURL="+(Gr.call(T,"sourceURL")?(T.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Bs+"]")+`
`;v.replace(An,function(Xt,ir,an,$r,Sr,Ui){return an||(an=$r),Wt+=v.slice(It,Ui).replace(Tt,Ly),ir&&(oe=!0,Wt+=`' +
__e(`+ir+`) +
'`),Sr&&(we=!0,Wt+=`';
`+Sr+`;
__p += '`),an&&(Wt+=`' +
((__t = (`+an+`)) == null ? '' : __t) +
'`),It=Ui+Xt.length,Xt}),Wt+=`';
`;var Yn=Gr.call(T,"variable")&&T.variable;if(Yn){if(dt.test(Yn))throw new zr("Invalid `variable` option passed into `_.template`")}else Wt=`with (obj) {
`+Wt+`
}
`;Wt=(we?Wt.replace(St,""):Wt).replace(Ge,"$1").replace(kt,"$1;"),Wt="function("+(Yn||"obj")+`) {
`+(Yn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(oe?", __e = _.escape":"")+(we?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Wt+`return __p
}`;var Ot=gl(function(){return js($e,Nn+"return "+Wt).apply(u,at)});if(Ot.source=Wt,hr(Ot))throw Ot;return Ot},me.times=function(v,T){if((v=Te(v))<1||v>A)return[];var D=I,Y=hs(v,I);T=kn(T),v-=I;for(var oe=U_(Y,T);++D<v;)T(D);return oe},me.toFinite=Me,me.toInteger=Te,me.toLength=gt,me.toLower=function(v){return Pt(v).toLowerCase()},me.toNumber=Ut,me.toSafeInteger=function(v){return v?xu(Te(v),-9007199254740991,A):v===0?v:0},me.toString=Pt,me.toUpper=function(v){return Pt(v).toUpperCase()},me.trim=function(v,T,D){if((v=Pt(v))&&(D||T===u))return qp(v);if(!v||!(T=ma(T)))return v;var Y=Is(v),oe=Is(T);return Mo(Y,Kp(Y,oe),zl(Y,oe)+1).join("")},me.trimEnd=function(v,T,D){if((v=Pt(v))&&(D||T===u))return v.slice(0,rl(v)+1);if(!v||!(T=ma(T)))return v;var Y=Is(v);return Mo(Y,0,zl(Y,Is(T))+1).join("")},me.trimStart=function(v,T,D){if((v=Pt(v))&&(D||T===u))return v.replace(ae,"");if(!v||!(T=ma(T)))return v;var Y=Is(v);return Mo(Y,Kp(Y,Is(T))).join("")},me.truncate=function(v,T){var D=30,Y="...";if(C(T)){var oe="separator"in T?T.separator:oe;D="length"in T?Te(T.length):D,Y="omission"in T?ma(T.omission):Y}var we=(v=Pt(v)).length;if(Eu(v)){var Pe=Is(v);we=Pe.length}if(D>=we)return v;var $e=D-Ms(Y);if($e<1)return Y;var at=Pe?Mo(Pe,0,$e).join(""):v.slice(0,$e);if(oe===u)return at+Y;if(Pe&&($e+=at.length-$e),te(oe)){if(v.slice($e).search(oe)){var It,At=at;for(oe.global||(oe=Qd(oe.source,Pt(Ue.exec(oe))+"g")),oe.lastIndex=0;It=oe.exec(At);)var Wt=It.index;at=at.slice(0,Wt===u?$e:Wt)}}else if(v.indexOf(ma(oe),$e)!=$e){var An=at.lastIndexOf(oe);An>-1&&(at=at.slice(0,An))}return at+Y},me.unescape=function(v){return(v=Pt(v))&&$t.test(v)?v.replace(Bt,fa):v},me.uniqueId=function(v){var T=++kc;return Pt(v)+T},me.upperCase=ml,me.upperFirst=qa,me.each=Sm,me.eachRight=av,me.first=gd,Du(me,(n0={},Va(me,function(v,T){Gr.call(me.prototype,T)||(n0[T]=v)}),n0),{chain:!1}),me.VERSION="4.17.21",ur(["bind","bindKey","curry","curryRight","partial","partialRight"],function(v){me[v].placeholder=me}),ur(["drop","take"],function(v,T){Mr.prototype[v]=function(D){D=D===u?1:oi(Te(D),0);var Y=this.__filtered__&&!T?new Mr(this):this.clone();return Y.__filtered__?Y.__takeCount__=hs(D,Y.__takeCount__):Y.__views__.push({size:hs(D,I),type:v+(Y.__dir__<0?"Right":"")}),Y},Mr.prototype[v+"Right"]=function(D){return this.reverse()[v](D).reverse()}}),ur(["filter","map","takeWhile"],function(v,T){var D=T+1,Y=D==1||D==3;Mr.prototype[v]=function(oe){var we=this.clone();return we.__iteratees__.push({iteratee:kn(oe,3),type:D}),we.__filtered__=we.__filtered__||Y,we}}),ur(["head","last"],function(v,T){var D="take"+(T?"Right":"");Mr.prototype[v]=function(){return this[D](1).value()[0]}}),ur(["initial","tail"],function(v,T){var D="drop"+(T?"":"Right");Mr.prototype[v]=function(){return this.__filtered__?new Mr(this):this[D](1)}}),Mr.prototype.compact=function(){return this.filter(Ps)},Mr.prototype.find=function(v){return this.filter(v).head()},Mr.prototype.findLast=function(v){return this.reverse().find(v)},Mr.prototype.invokeMap=xr(function(v,T){return typeof v=="function"?new Mr(this):this.map(function(D){return ql(D,v,T)})}),Mr.prototype.reject=function(v){return this.filter(Et(kn(v)))},Mr.prototype.slice=function(v,T){v=Te(v);var D=this;return D.__filtered__&&(v>0||T<0)?new Mr(D):(v<0?D=D.takeRight(-v):v&&(D=D.drop(v)),T!==u&&(D=(T=Te(T))<0?D.dropRight(-T):D.take(T-v)),D)},Mr.prototype.takeRightWhile=function(v){return this.reverse().takeWhile(v).reverse()},Mr.prototype.toArray=function(){return this.take(I)},Va(Mr.prototype,function(v,T){var D=/^(?:filter|find|map|reject)|While$/.test(T),Y=/^(?:head|last)$/.test(T),oe=me[Y?"take"+(T=="last"?"Right":""):T],we=Y||/^find/.test(T);oe&&(me.prototype[T]=function(){var Pe=this.__wrapped__,$e=Y?[1]:arguments,at=Pe instanceof Mr,It=$e[0],At=at||Ve(Pe),Wt=function(ir){var an=oe.apply(me,$l([ir],$e));return Y&&An?an[0]:an};At&&D&&typeof It=="function"&&It.length!=1&&(at=At=!1);var An=this.__chain__,Nn=!!this.__actions__.length,Yn=we&&!An,Ot=at&&!Nn;if(!we&&At){Pe=Ot?Pe:new Mr(this);var Xt=v.apply(Pe,$e);return Xt.__actions__.push({func:Zo,args:[Wt],thisArg:u}),new Hs(Xt,An)}return Yn&&Ot?v.apply(this,$e):(Xt=this.thru(Wt),Yn?Y?Xt.value()[0]:Xt.value():Xt)})}),ur(["pop","push","shift","sort","splice","unshift"],function(v){var T=eh[v],D=/^(?:push|sort|unshift)$/.test(v)?"tap":"thru",Y=/^(?:pop|shift)$/.test(v);me.prototype[v]=function(){var oe=arguments;if(Y&&!this.__chain__){var we=this.value();return T.apply(Ve(we)?we:[],oe)}return this[D](function(Pe){return T.apply(Ve(Pe)?Pe:[],oe)})}}),Va(Mr.prototype,function(v,T){var D=me[T];if(D){var Y=D.name+"";Gr.call(os,Y)||(os[Y]=[]),os[Y].push({name:T,func:D})}}),os[fm(u,2).name]=[{name:"wrapper",func:u}],Mr.prototype.clone=function(){var v=new Mr(this.__wrapped__);return v.__actions__=Xo(this.__actions__),v.__dir__=this.__dir__,v.__filtered__=this.__filtered__,v.__iteratees__=Xo(this.__iteratees__),v.__takeCount__=this.__takeCount__,v.__views__=Xo(this.__views__),v},Mr.prototype.reverse=function(){if(this.__filtered__){var v=new Mr(this);v.__dir__=-1,v.__filtered__=!0}else(v=this.clone()).__dir__*=-1;return v},Mr.prototype.value=function(){var v=this.__wrapped__.value(),T=this.__dir__,D=Ve(v),Y=T<0,oe=D?v.length:0,we=function(Ui,$n,sr){for(var Sa=-1,Oo=sr.length;++Sa<Oo;){var vl=sr[Sa],Ds=vl.size;switch(vl.type){case"drop":Ui+=Ds;break;case"dropRight":$n-=Ds;break;case"take":$n=hs($n,Ui+Ds);break;case"takeRight":Ui=oi(Ui,$n-Ds)}}return{start:Ui,end:$n}}(0,oe,this.__views__),Pe=we.start,$e=we.end,at=$e-Pe,It=Y?$e:Pe-1,At=this.__iteratees__,Wt=At.length,An=0,Nn=hs(at,this.__takeCount__);if(!D||!Y&&oe==at&&Nn==at)return oh(v,this.__actions__);var Yn=[];e:for(;at--&&An<Nn;){for(var Ot=-1,Xt=v[It+=T];++Ot<Wt;){var ir=At[Ot],an=ir.iteratee,$r=ir.type,Sr=an(Xt);if($r==2)Xt=Sr;else if(!Sr){if($r==1)continue e;break e}}Yn[An++]=Xt}return Yn},me.prototype.at=Jl,me.prototype.chain=function(){return _h(this)},me.prototype.commit=function(){return new Hs(this.value(),this.__chain__)},me.prototype.next=function(){this.__values__===u&&(this.__values__=Be(this.value()));var v=this.__index__>=this.__values__.length;return{done:v,value:v?u:this.__values__[this.__index__++]}},me.prototype.plant=function(v){for(var T,D=this;D instanceof Ha;){var Y=Ou(D);Y.__index__=0,Y.__values__=u,T?oe.__wrapped__=Y:T=Y;var oe=Y;D=D.__wrapped__}return oe.__wrapped__=v,T},me.prototype.reverse=function(){var v=this.__wrapped__;if(v instanceof Mr){var T=v;return this.__actions__.length&&(T=new Mr(this)),(T=T.reverse()).__actions__.push({func:Zo,args:[Ir],thisArg:u}),new Hs(T,this.__chain__)}return this.thru(Ir)},me.prototype.toJSON=me.prototype.valueOf=me.prototype.value=function(){return oh(this.__wrapped__,this.__actions__)},me.prototype.first=me.prototype.head,sl&&(me.prototype[sl]=function(){return this}),me}();vn._=sd,(l=(function(){return sd}).call(a,c,a,o))===u||(o.exports=l)}).call(this)},2492:(o,a,c)=>{var l=c(2980),u=c(1463)(function(d,h,p){l(d,h,p)});o.exports=u},5062:o=>{o.exports=function(){return!1}},9881:(o,a,c)=>{var l=c(8363),u=c(1704);o.exports=function(d){return l(d,u(d))}},6692:o=>{var a=o.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var l="candidate:%s %d %s %d %s %d typ %s";return l+=c.raddr!=null?" raddr %s rport %d":"%v%v",l+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(l+=" generation %d"),l+=c["network-id"]!=null?" network-id %d":"%v",l+=c["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var l="ssrc:%d";return c.attribute!=null&&(l+=" %s",c.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var l="mediaclk:";return l+=c.id!=null?"id=%s %s":"%v%s",l+=c.mediaClockValue!=null?"=%s":"",l+=c.rateNumerator!=null?" rate=%s":"",l+=c.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(a).forEach(function(c){a[c].forEach(function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")})})},766:(o,a,c)=>{var l=c(962),u=c(8627);a.cW=u,a.Qc=l.parse,a.rz=l.parseParams,l.parseFmtpConfig,l.parsePayloads,l.parseRemoteCandidates,l.parseImageAttributes,l.parseSimulcastStreamList},962:(o,a,c)=>{var l=function(f){return String(Number(f))===f?Number(f):f},u=function(f,g,y){var E=f.name&&f.names;f.push&&!g[f.push]?g[f.push]=[]:E&&!g[f.name]&&(g[f.name]={});var w=f.push?{}:E?g[f.name]:g;(function(R,A,k,I){if(I&&!k)A[I]=l(R[1]);else for(var N=0;N<k.length;N+=1)R[N+1]!=null&&(A[k[N]]=l(R[N+1]))})(y.match(f.reg),w,f.names,f.name),f.push&&g[f.push].push(w)},d=c(6692),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(f){var g={},y=[],E=g;return f.split(/(\r\n|\r|\n)/).filter(h).forEach(function(w){var R=w[0],A=w.slice(2);R==="m"&&(y.push({rtp:[],fmtp:[]}),E=y[y.length-1]);for(var k=0;k<(d[R]||[]).length;k+=1){var I=d[R][k];if(I.reg.test(A))return u(I,E,A)}}),g.media=y,g};var p=function(f,g){var y=g.split(/=(.+)/,2);return y.length===2?f[y[0]]=l(y[1]):y.length===1&&g.length>1&&(f[y[0]]=void 0),f};a.parseParams=function(f){return f.split(/;\s?/).reduce(p,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(f){return f.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(f){for(var g=[],y=f.split(" ").map(l),E=0;E<y.length;E+=3)g.push({component:y[E],ip:y[E+1],port:y[E+2]});return g},a.parseImageAttributes=function(f){return f.split(" ").map(function(g){return g.substring(1,g.length-1).split(",").reduce(p,{})})},a.parseSimulcastStreamList=function(f){return f.split(";").map(function(g){return g.split(",").map(function(y){var E,w=!1;return y[0]!=="~"?E=l(y):(E=l(y.substring(1,y.length)),w=!0),{scid:E,paused:w}})})}},8627:(o,a,c)=>{var l=c(6692),u=/%[sdv%]/g,d=function(g){var y=1,E=arguments,w=E.length;return g.replace(u,function(R){if(y>=w)return R;var A=E[y];switch(y+=1,R){case"%%":return"%";case"%s":return String(A);case"%d":return Number(A);case"%v":return""}})},h=function(g,y,E){var w=[g+"="+(y.format instanceof Function?y.format(y.push?E:E[y.name]):y.format)];if(y.names)for(var R=0;R<y.names.length;R+=1){var A=y.names[R];y.name?w.push(E[y.name][A]):w.push(E[y.names[R]])}else w.push(E[y.name]);return d.apply(null,w)},p=["v","o","s","i","u","e","p","c","b","t","r","z","a"],f=["i","c","b","a"];o.exports=function(g,y){y=y||{},g.version==null&&(g.version=0),g.name==null&&(g.name=" "),g.media.forEach(function(A){A.payloads==null&&(A.payloads="")});var E=y.outerOrder||p,w=y.innerOrder||f,R=[];return E.forEach(function(A){l[A].forEach(function(k){k.name in g&&g[k.name]!=null?R.push(h(A,k,g)):k.push in g&&g[k.push]!=null&&g[k.push].forEach(function(I){R.push(h(A,k,I))})})}),g.media.forEach(function(A){R.push(h("m",l.m[0],A)),w.forEach(function(k){l[k].forEach(function(I){I.name in A&&A[I.name]!=null?R.push(h(k,I,A)):I.push in A&&A[I.push]!=null&&A[I.push].forEach(function(N){R.push(h(k,I,N))})})})}),R.join(`\r
`)+`\r
`}},7539:o=>{const a={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};a.localCName=a.generateIdentifier(),a.splitLines=function(c){return c.trim().split(`
`).map(l=>l.trim())},a.splitSections=function(c){return c.split(`
m=`).map((l,u)=>(u>0?"m="+l:l).trim()+`\r
`)},a.getDescription=function(c){const l=a.splitSections(c);return l&&l[0]},a.getMediaSections=function(c){const l=a.splitSections(c);return l.shift(),l},a.matchPrefix=function(c,l){return a.splitLines(c).filter(u=>u.indexOf(l)===0)},a.parseCandidate=function(c){let l;l=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" ");const u={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let d=8;d<l.length;d+=2)switch(l[d]){case"raddr":u.relatedAddress=l[d+1];break;case"rport":u.relatedPort=parseInt(l[d+1],10);break;case"tcptype":u.tcpType=l[d+1];break;case"ufrag":u.ufrag=l[d+1],u.usernameFragment=l[d+1];break;default:u[l[d]]===void 0&&(u[l[d]]=l[d+1])}return u},a.writeCandidate=function(c){const l=[];l.push(c.foundation);const u=c.component;u==="rtp"?l.push(1):u==="rtcp"?l.push(2):l.push(u),l.push(c.protocol.toUpperCase()),l.push(c.priority),l.push(c.address||c.ip),l.push(c.port);const d=c.type;return l.push("typ"),l.push(d),d!=="host"&&c.relatedAddress&&c.relatedPort&&(l.push("raddr"),l.push(c.relatedAddress),l.push("rport"),l.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(l.push("ufrag"),l.push(c.usernameFragment||c.ufrag)),"candidate:"+l.join(" ")},a.parseIceOptions=function(c){return c.substring(14).split(" ")},a.parseRtpMap=function(c){let l=c.substring(9).split(" ");const u={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),u.name=l[0],u.clockRate=parseInt(l[1],10),u.channels=l.length===3?parseInt(l[2],10):1,u.numChannels=u.channels,u},a.writeRtpMap=function(c){let l=c.payloadType;c.preferredPayloadType!==void 0&&(l=c.preferredPayloadType);const u=c.channels||c.numChannels||1;return"a=rtpmap:"+l+" "+c.name+"/"+c.clockRate+(u!==1?"/"+u:"")+`\r
`},a.parseExtmap=function(c){const l=c.substring(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1],attributes:l.slice(2).join(" ")}},a.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+(c.attributes?" "+c.attributes:"")+`\r
`},a.parseFmtp=function(c){const l={};let u;const d=c.substring(c.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)u=d[h].trim().split("="),l[u[0].trim()]=u[1];return l},a.writeFmtp=function(c){let l="",u=c.payloadType;if(c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){const d=[];Object.keys(c.parameters).forEach(h=>{c.parameters[h]!==void 0?d.push(h+"="+c.parameters[h]):d.push(h)}),l+="a=fmtp:"+u+" "+d.join(";")+`\r
`}return l},a.parseRtcpFb=function(c){const l=c.substring(c.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},a.writeRtcpFb=function(c){let l="",u=c.payloadType;return c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach(d=>{l+="a=rtcp-fb:"+u+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),l},a.parseSsrcMedia=function(c){const l=c.indexOf(" "),u={ssrc:parseInt(c.substring(7,l),10)},d=c.indexOf(":",l);return d>-1?(u.attribute=c.substring(l+1,d),u.value=c.substring(d+1)):u.attribute=c.substring(l+1),u},a.parseSsrcGroup=function(c){const l=c.substring(13).split(" ");return{semantics:l.shift(),ssrcs:l.map(u=>parseInt(u,10))}},a.getMid=function(c){const l=a.matchPrefix(c,"a=mid:")[0];if(l)return l.substring(6)},a.parseFingerprint=function(c){const l=c.substring(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},a.getDtlsParameters=function(c,l){return{role:"auto",fingerprints:a.matchPrefix(c+l,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(c,l){let u="a=setup:"+l+`\r
`;return c.fingerprints.forEach(d=>{u+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),u},a.parseCryptoLine=function(c){const l=c.substring(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},a.writeCryptoLine=function(c){return"a=crypto:"+c.tag+" "+c.cryptoSuite+" "+(typeof c.keyParams=="object"?a.writeCryptoKeyParams(c.keyParams):c.keyParams)+(c.sessionParams?" "+c.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(c){if(c.indexOf("inline:")!==0)return null;const l=c.substring(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(c){return c.keyMethod+":"+c.keySalt+(c.lifeTime?"|"+c.lifeTime:"")+(c.mkiValue&&c.mkiLength?"|"+c.mkiValue+":"+c.mkiLength:"")},a.getCryptoParameters=function(c,l){return a.matchPrefix(c+l,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(c,l){const u=a.matchPrefix(c+l,"a=ice-ufrag:")[0],d=a.matchPrefix(c+l,"a=ice-pwd:")[0];return u&&d?{usernameFragment:u.substring(12),password:d.substring(10)}:null},a.writeIceParameters=function(c){let l="a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`;return c.iceLite&&(l+=`a=ice-lite\r
`),l},a.parseRtpParameters=function(c){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=a.splitLines(c)[0].split(" ");l.profile=u[2];for(let h=3;h<u.length;h++){const p=u[h],f=a.matchPrefix(c,"a=rtpmap:"+p+" ")[0];if(f){const g=a.parseRtpMap(f),y=a.matchPrefix(c,"a=fmtp:"+p+" ");switch(g.parameters=y.length?a.parseFmtp(y[0]):{},g.rtcpFeedback=a.matchPrefix(c,"a=rtcp-fb:"+p+" ").map(a.parseRtcpFb),l.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(g.name.toUpperCase())}}}a.matchPrefix(c,"a=extmap:").forEach(h=>{l.headerExtensions.push(a.parseExtmap(h))});const d=a.matchPrefix(c,"a=rtcp-fb:* ").map(a.parseRtcpFb);return l.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(f=>f.type===p.type&&f.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),l},a.writeRtpDescription=function(c,l){let u="";u+="m="+c+" ",u+=l.codecs.length>0?"9":"0",u+=" "+(l.profile||"UDP/TLS/RTP/SAVPF")+" ",u+=l.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach(h=>{u+=a.writeRtpMap(h),u+=a.writeFmtp(h),u+=a.writeRtcpFb(h)});let d=0;return l.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(u+="a=maxptime:"+d+`\r
`),l.headerExtensions&&l.headerExtensions.forEach(h=>{u+=a.writeExtmap(h)}),u},a.parseRtpEncodingParameters=function(c){const l=[],u=a.parseRtpParameters(c),d=u.fecMechanisms.indexOf("RED")!==-1,h=u.fecMechanisms.indexOf("ULPFEC")!==-1,p=a.matchPrefix(c,"a=ssrc:").map(w=>a.parseSsrcMedia(w)).filter(w=>w.attribute==="cname"),f=p.length>0&&p[0].ssrc;let g;const y=a.matchPrefix(c,"a=ssrc-group:FID").map(w=>w.substring(17).split(" ").map(R=>parseInt(R,10)));y.length>0&&y[0].length>1&&y[0][0]===f&&(g=y[0][1]),u.codecs.forEach(w=>{if(w.name.toUpperCase()==="RTX"&&w.parameters.apt){let R={ssrc:f,codecPayloadType:parseInt(w.parameters.apt,10)};f&&g&&(R.rtx={ssrc:g}),l.push(R),d&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:f,mechanism:h?"red+ulpfec":"red"},l.push(R))}}),l.length===0&&f&&l.push({ssrc:f});let E=a.matchPrefix(c,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,l.forEach(w=>{w.maxBitrate=E})),l},a.parseRtcpParameters=function(c){const l={},u=a.matchPrefix(c,"a=ssrc:").map(p=>a.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];u&&(l.cname=u.value,l.ssrc=u.ssrc);const d=a.matchPrefix(c,"a=rtcp-rsize");l.reducedSize=d.length>0,l.compound=d.length===0;const h=a.matchPrefix(c,"a=rtcp-mux");return l.mux=h.length>0,l},a.writeRtcpParameters=function(c){let l="";return c.reducedSize&&(l+=`a=rtcp-rsize\r
`),c.mux&&(l+=`a=rtcp-mux\r
`),c.ssrc!==void 0&&c.cname&&(l+="a=ssrc:"+c.ssrc+" cname:"+c.cname+`\r
`),l},a.parseMsid=function(c){let l;const u=a.matchPrefix(c,"a=msid:");if(u.length===1)return l=u[0].substring(7).split(" "),{stream:l[0],track:l[1]};const d=a.matchPrefix(c,"a=ssrc:").map(h=>a.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(l=d[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},a.parseSctpDescription=function(c){const l=a.parseMLine(c),u=a.matchPrefix(c,"a=max-message-size:");let d;u.length>0&&(d=parseInt(u[0].substring(19),10)),isNaN(d)&&(d=65536);const h=a.matchPrefix(c,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:l.fmt,maxMessageSize:d};const p=a.matchPrefix(c,"a=sctpmap:");if(p.length>0){const f=p[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:d}}},a.writeSctpDescription=function(c,l){let u=[];return u=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&u.push("a=max-message-size:"+l.maxMessageSize+`\r
`),u.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(c,l,u){let d;const h=l!==void 0?l:2;return d=c||a.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(c,l){const u=a.splitLines(c);for(let d=0;d<u.length;d++)switch(u[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[d].substring(2)}return l?a.getDirection(l):"sendrecv"},a.getKind=function(c){return a.splitLines(c)[0].split(" ")[0].substring(2)},a.isRejected=function(c){return c.split(" ",2)[1]==="0"},a.parseMLine=function(c){const l=a.splitLines(c)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},a.parseOLine=function(c){const l=a.matchPrefix(c,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},a.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;const l=a.splitLines(c);for(let u=0;u<l.length;u++)if(l[u].length<2||l[u].charAt(1)!=="=")return!1;return!0},o.exports=a},477:o=>{o.exports=function(a,c,l,u){var d=self||window;try{try{var h;try{h=new d.Blob([a])}catch{(h=new(d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder)).append(a),h=h.getBlob()}var p=d.URL||d.webkitURL,f=p.createObjectURL(h),g=new d[c](f,l);return p.revokeObjectURL(f),g}catch{return new d[c]("data:application/javascript,".concat(encodeURIComponent(a)),l)}}catch{if(!u)throw Error("Inline worker is not supported");return new d[c](u,l)}}},8520:(o,a,c)=>{var l;(function(u){(function(d){var h=typeof globalThis=="object"?globalThis:typeof c.g=="object"?c.g:typeof self=="object"?self:typeof this=="object"?this:function(){try{return Function("return this;")()}catch{}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch{}}(),p=f(u);function f(g,y){return function(E,w){Object.defineProperty(g,E,{configurable:!0,writable:!0,value:w}),y&&y(E,w)}}h.Reflect!==void 0&&(p=f(h.Reflect,p)),function(g,y){var E=Object.prototype.hasOwnProperty,w=typeof Symbol=="function",R=w&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",A=w&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",k=typeof Object.create=="function",I={__proto__:[]}instanceof Array,N=!k&&!I,U={create:k?function(){return Jt(Object.create(null))}:I?function(){return Jt({__proto__:null})}:function(){return Jt({})},has:N?function(Le,it){return E.call(Le,it)}:function(Le,it){return it in Le},get:N?function(Le,it){return E.call(Le,it)?Le[it]:void 0}:function(Le,it){return Le[it]}},F=Object.getPrototypeOf(Function),$=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:st(),q=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ct(),K=typeof WeakMap=="function"?WeakMap:sn(),W=w?Symbol.for("@reflect-metadata:registry"):void 0,X=bt(),ne=Dn(X);function Z(Le,it,Tt,wt){if(Ge(Tt)){if(!We(Le))throw new TypeError;if(!Vt(it))throw new TypeError;return Ee(Le,it)}if(!We(Le))throw new TypeError;if(!He(it))throw new TypeError;if(!He(wt)&&!Ge(wt)&&!kt(wt))throw new TypeError;return kt(wt)&&(wt=void 0),Se(Le,it,Tt=yt(Tt),wt)}function ie(Le,it){function Tt(wt,Pn){if(!He(wt))throw new TypeError;if(!Ge(Pn)&&!xt(Pn))throw new TypeError;ge(Le,it,wt,Pn)}return Tt}function G(Le,it,Tt,wt){if(!He(Tt))throw new TypeError;return Ge(wt)||(wt=yt(wt)),ge(Le,it,Tt,wt)}function Q(Le,it,Tt){if(!He(it))throw new TypeError;return Ge(Tt)||(Tt=yt(Tt)),Ie(Le,it,Tt)}function se(Le,it,Tt){if(!He(it))throw new TypeError;return Ge(Tt)||(Tt=yt(Tt)),Ze(Le,it,Tt)}function ve(Le,it,Tt){if(!He(it))throw new TypeError;return Ge(Tt)||(Tt=yt(Tt)),_t(Le,it,Tt)}function Oe(Le,it,Tt){if(!He(it))throw new TypeError;return Ge(Tt)||(Tt=yt(Tt)),fe(Le,it,Tt)}function _e(Le,it){if(!He(Le))throw new TypeError;return Ge(it)||(it=yt(it)),rt(Le,it)}function le(Le,it){if(!He(Le))throw new TypeError;return Ge(it)||(it=yt(it)),Re(Le,it)}function xe(Le,it,Tt){if(!He(it))throw new TypeError;if(Ge(Tt)||(Tt=yt(Tt)),!He(it))throw new TypeError;Ge(Tt)||(Tt=yt(Tt));var wt=Dt(it,Tt,!1);return!Ge(wt)&&wt.OrdinaryDeleteMetadata(Le,it,Tt)}function Ee(Le,it){for(var Tt=Le.length-1;Tt>=0;--Tt){var wt=(0,Le[Tt])(it);if(!Ge(wt)&&!kt(wt)){if(!Vt(wt))throw new TypeError;it=wt}}return it}function Se(Le,it,Tt,wt){for(var Pn=Le.length-1;Pn>=0;--Pn){var Yr=(0,Le[Pn])(it,Tt,wt);if(!Ge(Yr)&&!kt(Yr)){if(!He(Yr))throw new TypeError;wt=Yr}}return wt}function Ie(Le,it,Tt){if(Ze(Le,it,Tt))return!0;var wt=Fe(it);return!kt(wt)&&Ie(Le,wt,Tt)}function Ze(Le,it,Tt){var wt=Dt(it,Tt,!1);return!Ge(wt)&&ue(wt.OrdinaryHasOwnMetadata(Le,it,Tt))}function _t(Le,it,Tt){if(Ze(Le,it,Tt))return fe(Le,it,Tt);var wt=Fe(it);return kt(wt)?void 0:_t(Le,wt,Tt)}function fe(Le,it,Tt){var wt=Dt(it,Tt,!1);if(!Ge(wt))return wt.OrdinaryGetOwnMetadata(Le,it,Tt)}function ge(Le,it,Tt,wt){Dt(Tt,wt,!0).OrdinaryDefineOwnMetadata(Le,it,Tt,wt)}function rt(Le,it){var Tt=Re(Le,it),wt=Fe(Le);if(wt===null)return Tt;var Pn=rt(wt,it);if(Pn.length<=0)return Tt;if(Tt.length<=0)return Pn;for(var Yr=new q,cr=[],zn=0,dn=Tt;zn<dn.length;zn++){var tn=dn[zn];Yr.has(tn)||(Yr.add(tn),cr.push(tn))}for(var Cn=0,Rn=Pn;Cn<Rn.length;Cn++)tn=Rn[Cn],Yr.has(tn)||(Yr.add(tn),cr.push(tn));return cr}function Re(Le,it){var Tt=Dt(Le,it,!1);return Tt?Tt.OrdinaryOwnMetadataKeys(Le,it):[]}function St(Le){if(Le===null)return 1;switch(typeof Le){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Le===null?1:6;default:return 6}}function Ge(Le){return Le===void 0}function kt(Le){return Le===null}function Bt(Le){return typeof Le=="symbol"}function He(Le){return typeof Le=="object"?Le!==null:typeof Le=="function"}function $t(Le,it){switch(St(Le)){case 0:case 1:case 2:case 3:case 4:case 5:return Le}var Tt="string",wt=ae(Le,R);if(wt!==void 0){var Pn=wt.call(Le,Tt);if(He(Pn))throw new TypeError;return Pn}return Ce(Le)}function Ce(Le,it){var Tt,wt;{var Pn=Le.toString;if(ze(Pn)&&!He(wt=Pn.call(Le))||ze(Tt=Le.valueOf)&&!He(wt=Tt.call(Le)))return wt}throw new TypeError}function ue(Le){return!!Le}function tt(Le){return""+Le}function yt(Le){var it=$t(Le);return Bt(it)?it:tt(it)}function We(Le){return Array.isArray?Array.isArray(Le):Le instanceof Object?Le instanceof Array:Object.prototype.toString.call(Le)==="[object Array]"}function ze(Le){return typeof Le=="function"}function Vt(Le){return typeof Le=="function"}function xt(Le){switch(St(Le)){case 3:case 4:return!0;default:return!1}}function jt(Le,it){return Le===it||Le!=Le&&it!=it}function ae(Le,it){var Tt=Le[it];if(Tt!=null){if(!ze(Tt))throw new TypeError;return Tt}}function j(Le){var it=ae(Le,A);if(!ze(it))throw new TypeError;var Tt=it.call(Le);if(!He(Tt))throw new TypeError;return Tt}function V(Le){return Le.value}function pe(Le){var it=Le.next();return!it.done&&it}function Ne(Le){var it=Le.return;it&&it.call(Le)}function Fe(Le){var it=Object.getPrototypeOf(Le);if(typeof Le!="function"||Le===F||it!==F)return it;var Tt=Le.prototype,wt=Tt&&Object.getPrototypeOf(Tt);if(wt==null||wt===Object.prototype)return it;var Pn=wt.constructor;return typeof Pn!="function"||Pn===Le?it:Pn}function dt(){var Le,it,Tt,wt;Ge(W)||y.Reflect===void 0||W in y.Reflect||typeof y.Reflect.defineMetadata!="function"||(Le=Ue(y.Reflect));var Pn=new K,Yr={registerProvider:cr,getProvider:dn,setProvider:Cn};return Yr;function cr(Rn){if(!Object.isExtensible(Yr))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Le===Rn:break;case Ge(it):it=Rn;break;case it===Rn:break;case Ge(Tt):Tt=Rn;break;case Tt===Rn:break;default:wt===void 0&&(wt=new q),wt.add(Rn)}}function zn(Rn,_r){if(!Ge(it)){if(it.isProviderFor(Rn,_r))return it;if(!Ge(Tt)){if(Tt.isProviderFor(Rn,_r))return it;if(!Ge(wt))for(var di=j(wt);;){var ii=pe(di);if(!ii)return;var xo=V(ii);if(xo.isProviderFor(Rn,_r))return Ne(di),xo}}}if(!Ge(Le)&&Le.isProviderFor(Rn,_r))return Le}function dn(Rn,_r){var di,ii=Pn.get(Rn);return Ge(ii)||(di=ii.get(_r)),Ge(di)&&(Ge(di=zn(Rn,_r))||(Ge(ii)&&(ii=new $,Pn.set(Rn,ii)),ii.set(_r,di))),di}function tn(Rn){if(Ge(Rn))throw new TypeError;return it===Rn||Tt===Rn||!Ge(wt)&&wt.has(Rn)}function Cn(Rn,_r,di){if(!tn(di))throw new Error("Metadata provider not registered.");var ii=dn(Rn,_r);if(ii!==di){if(!Ge(ii))return!1;var xo=Pn.get(Rn);Ge(xo)&&(xo=new $,Pn.set(Rn,xo)),xo.set(_r,di)}return!0}}function bt(){var Le;return!Ge(W)&&He(y.Reflect)&&Object.isExtensible(y.Reflect)&&(Le=y.Reflect[W]),Ge(Le)&&(Le=dt()),!Ge(W)&&He(y.Reflect)&&Object.isExtensible(y.Reflect)&&Object.defineProperty(y.Reflect,W,{enumerable:!1,configurable:!1,writable:!1,value:Le}),Le}function Dn(Le){var it=new K,Tt={isProviderFor:function(tn,Cn){var Rn=it.get(tn);return!Ge(Rn)&&Rn.has(Cn)},OrdinaryDefineOwnMetadata:cr,OrdinaryHasOwnMetadata:Pn,OrdinaryGetOwnMetadata:Yr,OrdinaryOwnMetadataKeys:zn,OrdinaryDeleteMetadata:dn};return X.registerProvider(Tt),Tt;function wt(tn,Cn,Rn){var _r=it.get(tn),di=!1;if(Ge(_r)){if(!Rn)return;_r=new $,it.set(tn,_r),di=!0}var ii=_r.get(Cn);if(Ge(ii)){if(!Rn)return;if(ii=new $,_r.set(Cn,ii),!Le.setProvider(tn,Cn,Tt))throw _r.delete(Cn),di&&it.delete(tn),new Error("Wrong provider for target.")}return ii}function Pn(tn,Cn,Rn){var _r=wt(Cn,Rn,!1);return!Ge(_r)&&ue(_r.has(tn))}function Yr(tn,Cn,Rn){var _r=wt(Cn,Rn,!1);if(!Ge(_r))return _r.get(tn)}function cr(tn,Cn,Rn,_r){wt(Rn,_r,!0).set(tn,Cn)}function zn(tn,Cn){var Rn=[],_r=wt(tn,Cn,!1);if(Ge(_r))return Rn;for(var di=j(_r.keys()),ii=0;;){var xo=pe(di);if(!xo)return Rn.length=ii,Rn;var yu=V(xo);try{Rn[ii]=yu}catch(Kd){try{Ne(di)}finally{throw Kd}}ii++}}function dn(tn,Cn,Rn){var _r=wt(Cn,Rn,!1);if(Ge(_r)||!_r.delete(tn))return!1;if(_r.size===0){var di=it.get(Cn);Ge(di)||(di.delete(Rn),di.size===0&&it.delete(di))}return!0}}function Ue(Le){var it=Le.defineMetadata,Tt=Le.hasOwnMetadata,wt=Le.getOwnMetadata,Pn=Le.getOwnMetadataKeys,Yr=Le.deleteMetadata,cr=new K;return{isProviderFor:function(zn,dn){var tn=cr.get(zn);return!(Ge(tn)||!tn.has(dn))||!!Pn(zn,dn).length&&(Ge(tn)&&(tn=new q,cr.set(zn,tn)),tn.add(dn),!0)},OrdinaryDefineOwnMetadata:it,OrdinaryHasOwnMetadata:Tt,OrdinaryGetOwnMetadata:wt,OrdinaryOwnMetadataKeys:Pn,OrdinaryDeleteMetadata:Yr}}function Dt(Le,it,Tt){var wt=X.getProvider(Le,it);if(!Ge(wt))return wt;if(Tt){if(X.setProvider(Le,it,ne))return ne;throw new Error("Illegal state.")}}function st(){var Le={},it=[],Tt=function(){function cr(zn,dn,tn){this._index=0,this._keys=zn,this._values=dn,this._selector=tn}return cr.prototype["@@iterator"]=function(){return this},cr.prototype[A]=function(){return this},cr.prototype.next=function(){var zn=this._index;if(zn>=0&&zn<this._keys.length){var dn=this._selector(this._keys[zn],this._values[zn]);return zn+1>=this._keys.length?(this._index=-1,this._keys=it,this._values=it):this._index++,{value:dn,done:!1}}return{value:void 0,done:!0}},cr.prototype.throw=function(zn){throw this._index>=0&&(this._index=-1,this._keys=it,this._values=it),zn},cr.prototype.return=function(zn){return this._index>=0&&(this._index=-1,this._keys=it,this._values=it),{value:zn,done:!0}},cr}();return function(){function cr(){this._keys=[],this._values=[],this._cacheKey=Le,this._cacheIndex=-2}return Object.defineProperty(cr.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),cr.prototype.has=function(zn){return this._find(zn,!1)>=0},cr.prototype.get=function(zn){var dn=this._find(zn,!1);return dn>=0?this._values[dn]:void 0},cr.prototype.set=function(zn,dn){var tn=this._find(zn,!0);return this._values[tn]=dn,this},cr.prototype.delete=function(zn){var dn=this._find(zn,!1);if(dn>=0){for(var tn=this._keys.length,Cn=dn+1;Cn<tn;Cn++)this._keys[Cn-1]=this._keys[Cn],this._values[Cn-1]=this._values[Cn];return this._keys.length--,this._values.length--,jt(zn,this._cacheKey)&&(this._cacheKey=Le,this._cacheIndex=-2),!0}return!1},cr.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Le,this._cacheIndex=-2},cr.prototype.keys=function(){return new Tt(this._keys,this._values,wt)},cr.prototype.values=function(){return new Tt(this._keys,this._values,Pn)},cr.prototype.entries=function(){return new Tt(this._keys,this._values,Yr)},cr.prototype["@@iterator"]=function(){return this.entries()},cr.prototype[A]=function(){return this.entries()},cr.prototype._find=function(zn,dn){if(!jt(this._cacheKey,zn)){this._cacheIndex=-1;for(var tn=0;tn<this._keys.length;tn++)if(jt(this._keys[tn],zn)){this._cacheIndex=tn;break}}return this._cacheIndex<0&&dn&&(this._cacheIndex=this._keys.length,this._keys.push(zn),this._values.push(void 0)),this._cacheIndex},cr}();function wt(cr,zn){return cr}function Pn(cr,zn){return zn}function Yr(cr,zn){return[cr,zn]}}function Ct(){return function(){function Le(){this._map=new $}return Object.defineProperty(Le.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Le.prototype.has=function(it){return this._map.has(it)},Le.prototype.add=function(it){return this._map.set(it,it),this},Le.prototype.delete=function(it){return this._map.delete(it)},Le.prototype.clear=function(){this._map.clear()},Le.prototype.keys=function(){return this._map.keys()},Le.prototype.values=function(){return this._map.keys()},Le.prototype.entries=function(){return this._map.entries()},Le.prototype["@@iterator"]=function(){return this.keys()},Le.prototype[A]=function(){return this.keys()},Le}()}function sn(){var Le=16,it=U.create(),Tt=wt();return function(){function dn(){this._key=wt()}return dn.prototype.has=function(tn){var Cn=Pn(tn,!1);return Cn!==void 0&&U.has(Cn,this._key)},dn.prototype.get=function(tn){var Cn=Pn(tn,!1);return Cn!==void 0?U.get(Cn,this._key):void 0},dn.prototype.set=function(tn,Cn){return Pn(tn,!0)[this._key]=Cn,this},dn.prototype.delete=function(tn){var Cn=Pn(tn,!1);return Cn!==void 0&&delete Cn[this._key]},dn.prototype.clear=function(){this._key=wt()},dn}();function wt(){var dn;do dn="@@WeakMap@@"+zn();while(U.has(it,dn));return it[dn]=!0,dn}function Pn(dn,tn){if(!E.call(dn,Tt)){if(!tn)return;Object.defineProperty(dn,Tt,{value:U.create()})}return dn[Tt]}function Yr(dn,tn){for(var Cn=0;Cn<tn;++Cn)dn[Cn]=255*Math.random()|0;return dn}function cr(dn){if(typeof Uint8Array=="function"){var tn=new Uint8Array(dn);return typeof crypto<"u"?crypto.getRandomValues(tn):typeof msCrypto<"u"?msCrypto.getRandomValues(tn):Yr(tn,dn),tn}return Yr(new Array(dn),dn)}function zn(){var dn=cr(Le);dn[6]=79&dn[6]|64,dn[8]=191&dn[8]|128;for(var tn="",Cn=0;Cn<Le;++Cn){var Rn=dn[Cn];Cn!==4&&Cn!==6&&Cn!==8||(tn+="-"),Rn<16&&(tn+="0"),tn+=Rn.toString(16).toLowerCase()}return tn}}function Jt(Le){return Le.__=void 0,delete Le.__,Le}g("decorate",Z),g("metadata",ie),g("defineMetadata",G),g("hasMetadata",Q),g("hasOwnMetadata",se),g("getMetadata",ve),g("getOwnMetadata",Oe),g("getMetadataKeys",_e),g("getOwnMetadataKeys",le),g("deleteMetadata",xe)}(p,h),h.Reflect===void 0&&(h.Reflect=u)})()})(l||(l={}))}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={id:o,loaded:!1,exports:{}};return n[o].call(c.exports,c,c.exports,i),c.loaded=!0,c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.nmd=o=>(o.paths=[],o.children||(o.children=[]),o);var s={};return(()=>{i.r(s),i.d(s,{BASIC_FULL_HD_LANDSCAPE:()=>Jn,BASIC_FULL_HD_PORTRAIT:()=>lr,BASIC_LANDSCAPE:()=>Er,BASIC_PORTRAIT:()=>Bs,BroadcastClientError:()=>bt,BroadcastClientEvents:()=>Ms,ConnectionState:()=>nt,Errors:()=>u,InitialLayerPreference:()=>Cu,JitterBufferMinDelay:()=>fs,LOG_LEVEL:()=>V,LocalStageStream:()=>J_,LocalStageStreamEvents:()=>Jl,LogLevels:()=>V,RemoteStageStream:()=>L,RemoteStageStreamEvents:()=>_h,STANDARD_LANDSCAPE:()=>Ul,STANDARD_PORTRAIT:()=>Ti,Stage:()=>yn,StageConnectionState:()=>wi,StageErrorCategory:()=>ku,StageErrorCode:()=>Ir,StageEvents:()=>Rr,StageLeftReason:()=>dr,StageParticipantPublishState:()=>zi,StageParticipantSubscribeState:()=>Io,StageStream:()=>av,StageStreamLayerSelectedReason:()=>Zo,StreamType:()=>Gt,SubscribeType:()=>Qo,__version:()=>th,create:()=>pc,default:()=>hr,isSupported:()=>j});var o={};i.r(o),i.d(o,{fixNegotiationNeeded:()=>Q,shimAddTrackRemoveTrack:()=>ie,shimAddTrackRemoveTrackWithNative:()=>Z,shimGetDisplayMedia:()=>$,shimGetSendersWithDtmf:()=>W,shimGetStats:()=>X,shimGetUserMedia:()=>F,shimMediaStream:()=>q,shimOnTrack:()=>K,shimPeerConnection:()=>G,shimSenderReceiverGetStats:()=>ne});var a={};i.r(a),i.d(a,{shimAddTransceiver:()=>Ie,shimCreateAnswer:()=>fe,shimCreateOffer:()=>_t,shimGetDisplayMedia:()=>ve,shimGetParameters:()=>Ze,shimGetUserMedia:()=>se,shimOnTrack:()=>Oe,shimPeerConnection:()=>_e,shimRTCDataChannel:()=>Se,shimReceiverGetStats:()=>xe,shimRemoveStream:()=>Ee,shimSenderGetStats:()=>le});var c={};i.r(c),i.d(c,{shimAudioContext:()=>$t,shimCallbacksAPI:()=>Re,shimConstraints:()=>Ge,shimCreateOfferLegacy:()=>He,shimGetUserMedia:()=>St,shimLocalStreamsAPI:()=>ge,shimRTCIceServerUrls:()=>kt,shimRemoteStreamsAPI:()=>rt,shimTrackEventTransceiver:()=>Bt});var l={};i.r(l),i.d(l,{removeExtmapAllowMixed:()=>xt,shimAddIceCandidateNullOrEmpty:()=>jt,shimConnectionState:()=>Vt,shimMaxMessageSize:()=>We,shimParameterlessSetLocalDescription:()=>ae,shimRTCIceCandidate:()=>tt,shimRTCIceCandidateRelayProtocol:()=>yt,shimSendThrowTypeError:()=>ze});var u={};i.r(u),i.d(u,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Jt,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>sn,ADD_DEVICE_CONSTRAINTS_ERROR:()=>Tt,ADD_DEVICE_DEVICE_ERROR:()=>st,ADD_DEVICE_NAME_EXISTS_ERROR:()=>Ct,ADD_DEVICE_NAME_MISSING_ERROR:()=>Le,ADD_DEVICE_UNSUPPORTED:()=>it,BROADCAST_CONFIGURATION_ERROR:()=>di,BROADCAST_ERROR:()=>Dn,CAMERA_ERROR:()=>Ue,CLIENT_INVALID_ERROR:()=>cf,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>dn,FAILED_TO_ADD_IMAGE_ERROR:()=>tn,INGEST_ENDPOINT_TYPE_ERROR:()=>xo,INGEST_ENDPOINT_URL_ERROR:()=>yu,INPUT_ERROR:()=>Dt,INVALID_STREAM_KEY:()=>_r,LOGGER_TYPE_ERROR:()=>af,LOG_LEVEL_TYPE_ERROR:()=>Kd,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>ye,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>Ke,PEER_CONNECTION_ERROR:()=>Rn,PEER_SETUP_ERROR:()=>Cn,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>wt,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>Pn,STAGE_TOKEN_TYPE_ERROR:()=>vt,STAGE_WHIP_OVERRIDE_ERROR:()=>Xe,STREAM_CONFIGURATION_ERROR:()=>ii,STREAM_KEY_INVALID_CHAR_ERROR:()=>pt,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>cr,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>Yr,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>zn});var d={};i.r(d),i.d(d,{BASIC_FULL_HD_LANDSCAPE:()=>Jn,BASIC_FULL_HD_PORTRAIT:()=>lr,BASIC_LANDSCAPE:()=>Er,BASIC_PORTRAIT:()=>Bs,BroadcastClientError:()=>bt,BroadcastClientEvents:()=>Ms,ConnectionState:()=>nt,Errors:()=>u,LOG_LEVEL:()=>V,LogLevels:()=>V,STANDARD_LANDSCAPE:()=>Ul,STANDARD_PORTRAIT:()=>Ti,__version:()=>th,create:()=>pc,isSupported:()=>j});let h=!0,p=!0;function f(x,b,S){const C=x.match(b);return C&&C.length>=S&&parseInt(C[S],10)}function g(x,b,S){if(!x.RTCPeerConnection)return;const C=x.RTCPeerConnection.prototype,O=C.addEventListener;C.addEventListener=function(B,J){if(B!==b)return O.apply(this,arguments);const te=z=>{const re=S(z);re&&(J.handleEvent?J.handleEvent(re):J(re))};return this._eventMap=this._eventMap||{},this._eventMap[b]||(this._eventMap[b]=new Map),this._eventMap[b].set(J,te),O.apply(this,[B,te])};const P=C.removeEventListener;C.removeEventListener=function(B,J){if(B!==b||!this._eventMap||!this._eventMap[b])return P.apply(this,arguments);if(!this._eventMap[b].has(J))return P.apply(this,arguments);const te=this._eventMap[b].get(J);return this._eventMap[b].delete(J),this._eventMap[b].size===0&&delete this._eventMap[b],Object.keys(this._eventMap).length===0&&delete this._eventMap,P.apply(this,[B,te])},Object.defineProperty(C,"on"+b,{get(){return this["_on"+b]},set(B){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),B&&this.addEventListener(b,this["_on"+b]=B)},enumerable:!0,configurable:!0})}function y(x){return typeof x!="boolean"?new Error("Argument type: "+typeof x+". Please use a boolean."):(h=x,x?"adapter.js logging disabled":"adapter.js logging enabled")}function E(x){return typeof x!="boolean"?new Error("Argument type: "+typeof x+". Please use a boolean."):(p=!x,"adapter.js deprecation warnings "+(x?"disabled":"enabled"))}function w(){if(typeof window=="object"){if(h)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function R(x,b){p&&console.warn(x+" is deprecated, please use "+b+" instead.")}function A(x){return Object.prototype.toString.call(x)==="[object Object]"}function k(x){return A(x)?Object.keys(x).reduce(function(b,S){const C=A(x[S]),O=C?k(x[S]):x[S],P=C&&!Object.keys(O).length;return O===void 0||P?b:Object.assign(b,{[S]:O})},{}):x}function I(x,b,S){b&&!S.has(b.id)&&(S.set(b.id,b),Object.keys(b).forEach(C=>{C.endsWith("Id")?I(x,x.get(b[C]),S):C.endsWith("Ids")&&b[C].forEach(O=>{I(x,x.get(O),S)})}))}function N(x,b,S){const C=S?"outbound-rtp":"inbound-rtp",O=new Map;if(b===null)return O;const P=[];return x.forEach(B=>{B.type==="track"&&B.trackIdentifier===b.id&&P.push(B)}),P.forEach(B=>{x.forEach(J=>{J.type===C&&J.trackId===B.id&&I(x,J,O)})}),O}const U=w;function F(x,b){const S=x&&x.navigator;if(!S.mediaDevices)return;const C=function(B){if(typeof B!="object"||B.mandatory||B.optional)return B;const J={};return Object.keys(B).forEach(te=>{if(te==="require"||te==="advanced"||te==="mediaSource")return;const z=typeof B[te]=="object"?B[te]:{ideal:B[te]};z.exact!==void 0&&typeof z.exact=="number"&&(z.min=z.max=z.exact);const re=function(ce,de){return ce?ce+de.charAt(0).toUpperCase()+de.slice(1):de==="deviceId"?"sourceId":de};if(z.ideal!==void 0){J.optional=J.optional||[];let ce={};typeof z.ideal=="number"?(ce[re("min",te)]=z.ideal,J.optional.push(ce),ce={},ce[re("max",te)]=z.ideal,J.optional.push(ce)):(ce[re("",te)]=z.ideal,J.optional.push(ce))}z.exact!==void 0&&typeof z.exact!="number"?(J.mandatory=J.mandatory||{},J.mandatory[re("",te)]=z.exact):["min","max"].forEach(ce=>{z[ce]!==void 0&&(J.mandatory=J.mandatory||{},J.mandatory[re(ce,te)]=z[ce])})}),B.advanced&&(J.optional=(J.optional||[]).concat(B.advanced)),J},O=function(B,J){if(b.version>=61)return J(B);if((B=JSON.parse(JSON.stringify(B)))&&typeof B.audio=="object"){const te=function(z,re,ce){re in z&&!(ce in z)&&(z[ce]=z[re],delete z[re])};te((B=JSON.parse(JSON.stringify(B))).audio,"autoGainControl","googAutoGainControl"),te(B.audio,"noiseSuppression","googNoiseSuppression"),B.audio=C(B.audio)}if(B&&typeof B.video=="object"){let te=B.video.facingMode;te=te&&(typeof te=="object"?te:{ideal:te});const z=b.version<66;if(te&&(te.exact==="user"||te.exact==="environment"||te.ideal==="user"||te.ideal==="environment")&&(!S.mediaDevices.getSupportedConstraints||!S.mediaDevices.getSupportedConstraints().facingMode||z)){let re;if(delete B.video.facingMode,te.exact==="environment"||te.ideal==="environment"?re=["back","rear"]:te.exact!=="user"&&te.ideal!=="user"||(re=["front"]),re)return S.mediaDevices.enumerateDevices().then(ce=>{let de=(ce=ce.filter(ke=>ke.kind==="videoinput")).find(ke=>re.some(Qe=>ke.label.toLowerCase().includes(Qe)));return!de&&ce.length&&re.includes("back")&&(de=ce[ce.length-1]),de&&(B.video.deviceId=te.exact?{exact:de.deviceId}:{ideal:de.deviceId}),B.video=C(B.video),U("chrome: "+JSON.stringify(B)),J(B)})}B.video=C(B.video)}return U("chrome: "+JSON.stringify(B)),J(B)},P=function(B){return b.version>=64?B:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[B.name]||B.name,message:B.message,constraint:B.constraint||B.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(S.getUserMedia=(function(B,J,te){O(B,z=>{S.webkitGetUserMedia(z,J,re=>{te&&te(P(re))})})}).bind(S),S.mediaDevices.getUserMedia){const B=S.mediaDevices.getUserMedia.bind(S.mediaDevices);S.mediaDevices.getUserMedia=function(J){return O(J,te=>B(te).then(z=>{if(te.audio&&!z.getAudioTracks().length||te.video&&!z.getVideoTracks().length)throw z.getTracks().forEach(re=>{re.stop()}),new DOMException("","NotFoundError");return z},z=>Promise.reject(P(z))))}}}function $(x,b){x.navigator.mediaDevices&&"getDisplayMedia"in x.navigator.mediaDevices||x.navigator.mediaDevices&&(typeof b=="function"?x.navigator.mediaDevices.getDisplayMedia=function(S){return b(S).then(C=>{const O=S.video&&S.video.width,P=S.video&&S.video.height,B=S.video&&S.video.frameRate;return S.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:C,maxFrameRate:B||3}},O&&(S.video.mandatory.maxWidth=O),P&&(S.video.mandatory.maxHeight=P),x.navigator.mediaDevices.getUserMedia(S)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function q(x){x.MediaStream=x.MediaStream||x.webkitMediaStream}function K(x){if(typeof x=="object"&&x.RTCPeerConnection&&!("ontrack"in x.RTCPeerConnection.prototype)){Object.defineProperty(x.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(S){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=S)},enumerable:!0,configurable:!0});const b=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=S=>{S.stream.addEventListener("addtrack",C=>{let O;O=x.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(B=>B.track&&B.track.id===C.track.id):{track:C.track};const P=new Event("track");P.track=C.track,P.receiver=O,P.transceiver={receiver:O},P.streams=[S.stream],this.dispatchEvent(P)}),S.stream.getTracks().forEach(C=>{let O;O=x.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(B=>B.track&&B.track.id===C.id):{track:C};const P=new Event("track");P.track=C,P.receiver=O,P.transceiver={receiver:O},P.streams=[S.stream],this.dispatchEvent(P)})},this.addEventListener("addstream",this._ontrackpoly)),b.apply(this,arguments)}}else g(x,"track",b=>(b.transceiver||Object.defineProperty(b,"transceiver",{value:{receiver:b.receiver}}),b))}function W(x){if(typeof x=="object"&&x.RTCPeerConnection&&!("getSenders"in x.RTCPeerConnection.prototype)&&"createDTMFSender"in x.RTCPeerConnection.prototype){const b=function(O,P){return{track:P,get dtmf(){return this._dtmf===void 0&&(P.kind==="audio"?this._dtmf=O.createDTMFSender(P):this._dtmf=null),this._dtmf},_pc:O}};if(!x.RTCPeerConnection.prototype.getSenders){x.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const O=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addTrack=function(B,J){let te=O.apply(this,arguments);return te||(te=b(this,B),this._senders.push(te)),te};const P=x.RTCPeerConnection.prototype.removeTrack;x.RTCPeerConnection.prototype.removeTrack=function(B){P.apply(this,arguments);const J=this._senders.indexOf(B);J!==-1&&this._senders.splice(J,1)}}const S=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(O){this._senders=this._senders||[],S.apply(this,[O]),O.getTracks().forEach(P=>{this._senders.push(b(this,P))})};const C=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(O){this._senders=this._senders||[],C.apply(this,[O]),O.getTracks().forEach(P=>{const B=this._senders.find(J=>J.track===P);B&&this._senders.splice(this._senders.indexOf(B),1)})}}else if(typeof x=="object"&&x.RTCPeerConnection&&"getSenders"in x.RTCPeerConnection.prototype&&"createDTMFSender"in x.RTCPeerConnection.prototype&&x.RTCRtpSender&&!("dtmf"in x.RTCRtpSender.prototype)){const b=x.RTCPeerConnection.prototype.getSenders;x.RTCPeerConnection.prototype.getSenders=function(){const S=b.apply(this,[]);return S.forEach(C=>C._pc=this),S},Object.defineProperty(x.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function X(x){if(!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){const[S,C,O]=arguments;if(arguments.length>0&&typeof S=="function")return b.apply(this,arguments);if(b.length===0&&(arguments.length===0||typeof S!="function"))return b.apply(this,[]);const P=function(J){const te={};return J.result().forEach(z=>{const re={id:z.id,timestamp:z.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[z.type]||z.type};z.names().forEach(ce=>{re[ce]=z.stat(ce)}),te[re.id]=re}),te},B=function(J){return new Map(Object.keys(J).map(te=>[te,J[te]]))};if(arguments.length>=2){const J=function(te){C(B(P(te)))};return b.apply(this,[J,S])}return new Promise((J,te)=>{b.apply(this,[function(z){J(B(P(z)))},te])}).then(C,O)}}function ne(x){if(!(typeof x=="object"&&x.RTCPeerConnection&&x.RTCRtpSender&&x.RTCRtpReceiver))return;if(!("getStats"in x.RTCRtpSender.prototype)){const S=x.RTCPeerConnection.prototype.getSenders;S&&(x.RTCPeerConnection.prototype.getSenders=function(){const O=S.apply(this,[]);return O.forEach(P=>P._pc=this),O});const C=x.RTCPeerConnection.prototype.addTrack;C&&(x.RTCPeerConnection.prototype.addTrack=function(){const O=C.apply(this,arguments);return O._pc=this,O}),x.RTCRtpSender.prototype.getStats=function(){const O=this;return this._pc.getStats().then(P=>N(P,O.track,!0))}}if(!("getStats"in x.RTCRtpReceiver.prototype)){const S=x.RTCPeerConnection.prototype.getReceivers;S&&(x.RTCPeerConnection.prototype.getReceivers=function(){const C=S.apply(this,[]);return C.forEach(O=>O._pc=this),C}),g(x,"track",C=>(C.receiver._pc=C.srcElement,C)),x.RTCRtpReceiver.prototype.getStats=function(){const C=this;return this._pc.getStats().then(O=>N(O,C.track,!1))}}if(!("getStats"in x.RTCRtpSender.prototype)||!("getStats"in x.RTCRtpReceiver.prototype))return;const b=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof x.MediaStreamTrack){const S=arguments[0];let C,O,P;return this.getSenders().forEach(B=>{B.track===S&&(C?P=!0:C=B)}),this.getReceivers().forEach(B=>(B.track===S&&(O?P=!0:O=B),B.track===S)),P||C&&O?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):C?C.getStats():O?O.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return b.apply(this,arguments)}}function Z(x){x.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(P=>this._shimmedLocalStreams[P][0])};const b=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addTrack=function(P,B){if(!B)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const J=b.apply(this,arguments);return this._shimmedLocalStreams[B.id]?this._shimmedLocalStreams[B.id].indexOf(J)===-1&&this._shimmedLocalStreams[B.id].push(J):this._shimmedLocalStreams[B.id]=[B,J],J};const S=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(P){this._shimmedLocalStreams=this._shimmedLocalStreams||{},P.getTracks().forEach(te=>{if(this.getSenders().find(z=>z.track===te))throw new DOMException("Track already exists.","InvalidAccessError")});const B=this.getSenders();S.apply(this,arguments);const J=this.getSenders().filter(te=>B.indexOf(te)===-1);this._shimmedLocalStreams[P.id]=[P].concat(J)};const C=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(P){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[P.id],C.apply(this,arguments)};const O=x.RTCPeerConnection.prototype.removeTrack;x.RTCPeerConnection.prototype.removeTrack=function(P){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},P&&Object.keys(this._shimmedLocalStreams).forEach(B=>{const J=this._shimmedLocalStreams[B].indexOf(P);J!==-1&&this._shimmedLocalStreams[B].splice(J,1),this._shimmedLocalStreams[B].length===1&&delete this._shimmedLocalStreams[B]}),O.apply(this,arguments)}}function ie(x,b){if(!x.RTCPeerConnection)return;if(x.RTCPeerConnection.prototype.addTrack&&b.version>=65)return Z(x);const S=x.RTCPeerConnection.prototype.getLocalStreams;x.RTCPeerConnection.prototype.getLocalStreams=function(){const te=S.apply(this);return this._reverseStreams=this._reverseStreams||{},te.map(z=>this._reverseStreams[z.id])};const C=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(te){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},te.getTracks().forEach(z=>{if(this.getSenders().find(re=>re.track===z))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[te.id]){const z=new x.MediaStream(te.getTracks());this._streams[te.id]=z,this._reverseStreams[z.id]=te,te=z}C.apply(this,[te])};const O=x.RTCPeerConnection.prototype.removeStream;function P(te,z){let re=z.sdp;return Object.keys(te._reverseStreams||[]).forEach(ce=>{const de=te._reverseStreams[ce],ke=te._streams[de.id];re=re.replace(new RegExp(ke.id,"g"),de.id)}),new RTCSessionDescription({type:z.type,sdp:re})}x.RTCPeerConnection.prototype.removeStream=function(te){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},O.apply(this,[this._streams[te.id]||te]),delete this._reverseStreams[this._streams[te.id]?this._streams[te.id].id:te.id],delete this._streams[te.id]},x.RTCPeerConnection.prototype.addTrack=function(te,z){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const re=[].slice.call(arguments,1);if(re.length!==1||!re[0].getTracks().find(de=>de===te))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(de=>de.track===te))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const ce=this._streams[z.id];if(ce)ce.addTrack(te),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const de=new x.MediaStream([te]);this._streams[z.id]=de,this._reverseStreams[de.id]=z,this.addStream(de)}return this.getSenders().find(de=>de.track===te)},["createOffer","createAnswer"].forEach(function(te){const z=x.RTCPeerConnection.prototype[te],re={[te](){const ce=arguments;return arguments.length&&typeof arguments[0]=="function"?z.apply(this,[de=>{const ke=P(this,de);ce[0].apply(null,[ke])},de=>{ce[1]&&ce[1].apply(null,de)},arguments[2]]):z.apply(this,arguments).then(de=>P(this,de))}};x.RTCPeerConnection.prototype[te]=re[te]});const B=x.RTCPeerConnection.prototype.setLocalDescription;x.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(te,z){let re=z.sdp;return Object.keys(te._reverseStreams||[]).forEach(ce=>{const de=te._reverseStreams[ce],ke=te._streams[de.id];re=re.replace(new RegExp(de.id,"g"),ke.id)}),new RTCSessionDescription({type:z.type,sdp:re})}(this,arguments[0]),B.apply(this,arguments)):B.apply(this,arguments)};const J=Object.getOwnPropertyDescriptor(x.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(x.RTCPeerConnection.prototype,"localDescription",{get(){const te=J.get.apply(this);return te.type===""?te:P(this,te)}}),x.RTCPeerConnection.prototype.removeTrack=function(te){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!te._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(te._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let z;this._streams=this._streams||{},Object.keys(this._streams).forEach(re=>{this._streams[re].getTracks().find(ce=>te.track===ce)&&(z=this._streams[re])}),z&&(z.getTracks().length===1?this.removeStream(this._reverseStreams[z.id]):z.removeTrack(te.track),this.dispatchEvent(new Event("negotiationneeded")))}}function G(x,b){!x.RTCPeerConnection&&x.webkitRTCPeerConnection&&(x.RTCPeerConnection=x.webkitRTCPeerConnection),x.RTCPeerConnection&&b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(S){const C=x.RTCPeerConnection.prototype[S],O={[S](){return arguments[0]=new(S==="addIceCandidate"?x.RTCIceCandidate:x.RTCSessionDescription)(arguments[0]),C.apply(this,arguments)}};x.RTCPeerConnection.prototype[S]=O[S]})}function Q(x,b){g(x,"negotiationneeded",S=>{const C=S.target;if(!(b.version<72||C.getConfiguration&&C.getConfiguration().sdpSemantics==="plan-b")||C.signalingState==="stable")return S})}function se(x,b){const S=x&&x.navigator,C=x&&x.MediaStreamTrack;if(S.getUserMedia=function(O,P,B){R("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),S.mediaDevices.getUserMedia(O).then(P,B)},!(b.version>55&&"autoGainControl"in S.mediaDevices.getSupportedConstraints())){const O=function(B,J,te){J in B&&!(te in B)&&(B[te]=B[J],delete B[J])},P=S.mediaDevices.getUserMedia.bind(S.mediaDevices);if(S.mediaDevices.getUserMedia=function(B){return typeof B=="object"&&typeof B.audio=="object"&&(B=JSON.parse(JSON.stringify(B)),O(B.audio,"autoGainControl","mozAutoGainControl"),O(B.audio,"noiseSuppression","mozNoiseSuppression")),P(B)},C&&C.prototype.getSettings){const B=C.prototype.getSettings;C.prototype.getSettings=function(){const J=B.apply(this,arguments);return O(J,"mozAutoGainControl","autoGainControl"),O(J,"mozNoiseSuppression","noiseSuppression"),J}}if(C&&C.prototype.applyConstraints){const B=C.prototype.applyConstraints;C.prototype.applyConstraints=function(J){return this.kind==="audio"&&typeof J=="object"&&(J=JSON.parse(JSON.stringify(J)),O(J,"autoGainControl","mozAutoGainControl"),O(J,"noiseSuppression","mozNoiseSuppression")),B.apply(this,[J])}}}}function ve(x,b){x.navigator.mediaDevices&&"getDisplayMedia"in x.navigator.mediaDevices||x.navigator.mediaDevices&&(x.navigator.mediaDevices.getDisplayMedia=function(S){if(!S||!S.video){const C=new DOMException("getDisplayMedia without video constraints is undefined");return C.name="NotFoundError",C.code=8,Promise.reject(C)}return S.video===!0?S.video={mediaSource:b}:S.video.mediaSource=b,x.navigator.mediaDevices.getUserMedia(S)})}function Oe(x){typeof x=="object"&&x.RTCTrackEvent&&"receiver"in x.RTCTrackEvent.prototype&&!("transceiver"in x.RTCTrackEvent.prototype)&&Object.defineProperty(x.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _e(x,b){if(typeof x!="object"||!x.RTCPeerConnection&&!x.mozRTCPeerConnection)return;!x.RTCPeerConnection&&x.mozRTCPeerConnection&&(x.RTCPeerConnection=x.mozRTCPeerConnection),b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(O){const P=x.RTCPeerConnection.prototype[O],B={[O](){return arguments[0]=new(O==="addIceCandidate"?x.RTCIceCandidate:x.RTCSessionDescription)(arguments[0]),P.apply(this,arguments)}};x.RTCPeerConnection.prototype[O]=B[O]});const S={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},C=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){const[O,P,B]=arguments;return C.apply(this,[O||null]).then(J=>{if(b.version<53&&!P)try{J.forEach(te=>{te.type=S[te.type]||te.type})}catch(te){if(te.name!=="TypeError")throw te;J.forEach((z,re)=>{J.set(re,Object.assign({},z,{type:S[z.type]||z.type}))})}return J}).then(P,B)}}function le(x){if(typeof x!="object"||!x.RTCPeerConnection||!x.RTCRtpSender||x.RTCRtpSender&&"getStats"in x.RTCRtpSender.prototype)return;const b=x.RTCPeerConnection.prototype.getSenders;b&&(x.RTCPeerConnection.prototype.getSenders=function(){const C=b.apply(this,[]);return C.forEach(O=>O._pc=this),C});const S=x.RTCPeerConnection.prototype.addTrack;S&&(x.RTCPeerConnection.prototype.addTrack=function(){const C=S.apply(this,arguments);return C._pc=this,C}),x.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function xe(x){if(typeof x!="object"||!x.RTCPeerConnection||!x.RTCRtpSender||x.RTCRtpSender&&"getStats"in x.RTCRtpReceiver.prototype)return;const b=x.RTCPeerConnection.prototype.getReceivers;b&&(x.RTCPeerConnection.prototype.getReceivers=function(){const S=b.apply(this,[]);return S.forEach(C=>C._pc=this),S}),g(x,"track",S=>(S.receiver._pc=S.srcElement,S)),x.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ee(x){x.RTCPeerConnection&&!("removeStream"in x.RTCPeerConnection.prototype)&&(x.RTCPeerConnection.prototype.removeStream=function(b){R("removeStream","removeTrack"),this.getSenders().forEach(S=>{S.track&&b.getTracks().includes(S.track)&&this.removeTrack(S)})})}function Se(x){x.DataChannel&&!x.RTCDataChannel&&(x.RTCDataChannel=x.DataChannel)}function Ie(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype.addTransceiver;b&&(x.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let S=arguments[1]&&arguments[1].sendEncodings;S===void 0&&(S=[]),S=[...S];const C=S.length>0;C&&S.forEach(P=>{if("rid"in P&&!/^[a-z0-9]{0,16}$/i.test(P.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in P&&!(parseFloat(P.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in P&&!(parseFloat(P.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const O=b.apply(this,arguments);if(C){const{sender:P}=O,B=P.getParameters();(!("encodings"in B)||B.encodings.length===1&&Object.keys(B.encodings[0]).length===0)&&(B.encodings=S,P.sendEncodings=S,this.setParametersPromises.push(P.setParameters(B).then(()=>{delete P.sendEncodings}).catch(()=>{delete P.sendEncodings})))}return O})}function Ze(x){if(typeof x!="object"||!x.RTCRtpSender)return;const b=x.RTCRtpSender.prototype.getParameters;b&&(x.RTCRtpSender.prototype.getParameters=function(){const S=b.apply(this,arguments);return"encodings"in S||(S.encodings=[].concat(this.sendEncodings||[{}])),S})}function _t(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype.createOffer;x.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}function fe(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype.createAnswer;x.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}function ge(x){if(typeof x=="object"&&x.RTCPeerConnection){if("getLocalStreams"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in x.RTCPeerConnection.prototype)){const b=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addStream=function(S){this._localStreams||(this._localStreams=[]),this._localStreams.includes(S)||this._localStreams.push(S),S.getAudioTracks().forEach(C=>b.call(this,C,S)),S.getVideoTracks().forEach(C=>b.call(this,C,S))},x.RTCPeerConnection.prototype.addTrack=function(S,...C){return C&&C.forEach(O=>{this._localStreams?this._localStreams.includes(O)||this._localStreams.push(O):this._localStreams=[O]}),b.apply(this,arguments)}}"removeStream"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.removeStream=function(b){this._localStreams||(this._localStreams=[]);const S=this._localStreams.indexOf(b);if(S===-1)return;this._localStreams.splice(S,1);const C=b.getTracks();this.getSenders().forEach(O=>{C.includes(O.track)&&this.removeTrack(O)})})}}function rt(x){if(typeof x=="object"&&x.RTCPeerConnection&&("getRemoteStreams"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in x.RTCPeerConnection.prototype))){Object.defineProperty(x.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(S){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=S),this.addEventListener("track",this._onaddstreampoly=C=>{C.streams.forEach(O=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(O))return;this._remoteStreams.push(O);const P=new Event("addstream");P.stream=O,this.dispatchEvent(P)})})}});const b=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){const S=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(C){C.streams.forEach(O=>{if(S._remoteStreams||(S._remoteStreams=[]),S._remoteStreams.indexOf(O)>=0)return;S._remoteStreams.push(O);const P=new Event("addstream");P.stream=O,S.dispatchEvent(P)})}),b.apply(S,arguments)}}}function Re(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype,S=b.createOffer,C=b.createAnswer,O=b.setLocalDescription,P=b.setRemoteDescription,B=b.addIceCandidate;b.createOffer=function(te,z){const re=arguments.length>=2?arguments[2]:arguments[0],ce=S.apply(this,[re]);return z?(ce.then(te,z),Promise.resolve()):ce},b.createAnswer=function(te,z){const re=arguments.length>=2?arguments[2]:arguments[0],ce=C.apply(this,[re]);return z?(ce.then(te,z),Promise.resolve()):ce};let J=function(te,z,re){const ce=O.apply(this,[te]);return re?(ce.then(z,re),Promise.resolve()):ce};b.setLocalDescription=J,J=function(te,z,re){const ce=P.apply(this,[te]);return re?(ce.then(z,re),Promise.resolve()):ce},b.setRemoteDescription=J,J=function(te,z,re){const ce=B.apply(this,[te]);return re?(ce.then(z,re),Promise.resolve()):ce},b.addIceCandidate=J}function St(x){const b=x&&x.navigator;if(b.mediaDevices&&b.mediaDevices.getUserMedia){const S=b.mediaDevices,C=S.getUserMedia.bind(S);b.mediaDevices.getUserMedia=O=>C(Ge(O))}!b.getUserMedia&&b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=(function(S,C,O){b.mediaDevices.getUserMedia(S).then(C,O)}).bind(b))}function Ge(x){return x&&x.video!==void 0?Object.assign({},x,{video:k(x.video)}):x}function kt(x){if(!x.RTCPeerConnection)return;const b=x.RTCPeerConnection;x.RTCPeerConnection=function(S,C){if(S&&S.iceServers){const O=[];for(let P=0;P<S.iceServers.length;P++){let B=S.iceServers[P];B.urls===void 0&&B.url?(R("RTCIceServer.url","RTCIceServer.urls"),B=JSON.parse(JSON.stringify(B)),B.urls=B.url,delete B.url,O.push(B)):O.push(S.iceServers[P])}S.iceServers=O}return new b(S,C)},x.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in b&&Object.defineProperty(x.RTCPeerConnection,"generateCertificate",{get:()=>b.generateCertificate})}function Bt(x){typeof x=="object"&&x.RTCTrackEvent&&"receiver"in x.RTCTrackEvent.prototype&&!("transceiver"in x.RTCTrackEvent.prototype)&&Object.defineProperty(x.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function He(x){const b=x.RTCPeerConnection.prototype.createOffer;x.RTCPeerConnection.prototype.createOffer=function(S){if(S){S.offerToReceiveAudio!==void 0&&(S.offerToReceiveAudio=!!S.offerToReceiveAudio);const C=this.getTransceivers().find(P=>P.receiver.track.kind==="audio");S.offerToReceiveAudio===!1&&C?C.direction==="sendrecv"?C.setDirection?C.setDirection("sendonly"):C.direction="sendonly":C.direction==="recvonly"&&(C.setDirection?C.setDirection("inactive"):C.direction="inactive"):S.offerToReceiveAudio!==!0||C||this.addTransceiver("audio",{direction:"recvonly"}),S.offerToReceiveVideo!==void 0&&(S.offerToReceiveVideo=!!S.offerToReceiveVideo);const O=this.getTransceivers().find(P=>P.receiver.track.kind==="video");S.offerToReceiveVideo===!1&&O?O.direction==="sendrecv"?O.setDirection?O.setDirection("sendonly"):O.direction="sendonly":O.direction==="recvonly"&&(O.setDirection?O.setDirection("inactive"):O.direction="inactive"):S.offerToReceiveVideo!==!0||O||this.addTransceiver("video",{direction:"recvonly"})}return b.apply(this,arguments)}}function $t(x){typeof x!="object"||x.AudioContext||(x.AudioContext=x.webkitAudioContext)}var Ce=i(7539),ue=i.n(Ce);function tt(x){if(!x.RTCIceCandidate||x.RTCIceCandidate&&"foundation"in x.RTCIceCandidate.prototype)return;const b=x.RTCIceCandidate;x.RTCIceCandidate=function(S){if(typeof S=="object"&&S.candidate&&S.candidate.indexOf("a=")===0&&((S=JSON.parse(JSON.stringify(S))).candidate=S.candidate.substring(2)),S.candidate&&S.candidate.length){const C=new b(S),O=ue().parseCandidate(S.candidate);for(const P in O)P in C||Object.defineProperty(C,P,{value:O[P]});return C.toJSON=function(){return{candidate:C.candidate,sdpMid:C.sdpMid,sdpMLineIndex:C.sdpMLineIndex,usernameFragment:C.usernameFragment}},C}return new b(S)},x.RTCIceCandidate.prototype=b.prototype,g(x,"icecandidate",S=>(S.candidate&&Object.defineProperty(S,"candidate",{value:new x.RTCIceCandidate(S.candidate),writable:"false"}),S))}function yt(x){!x.RTCIceCandidate||x.RTCIceCandidate&&"relayProtocol"in x.RTCIceCandidate.prototype||g(x,"icecandidate",b=>{if(b.candidate){const S=ue().parseCandidate(b.candidate.candidate);S.type==="relay"&&(b.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[S.priority>>24])}return b})}function We(x,b){if(!x.RTCPeerConnection)return;"sctp"in x.RTCPeerConnection.prototype||Object.defineProperty(x.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const S=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,b.browser==="chrome"&&b.version>=76){const{sdpSemantics:C}=this.getConfiguration();C==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(C){if(!C||!C.sdp)return!1;const O=ue().splitSections(C.sdp);return O.shift(),O.some(P=>{const B=ue().parseMLine(P);return B&&B.kind==="application"&&B.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const C=function(te){const z=te.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(z===null||z.length<2)return-1;const re=parseInt(z[1],10);return re!=re?-1:re}(arguments[0]),O=function(te){let z=65536;return b.browser==="firefox"&&(z=b.version<57?te===-1?16384:2147483637:b.version<60?b.version===57?65535:65536:2147483637),z}(C),P=function(te,z){let re=65536;b.browser==="firefox"&&b.version===57&&(re=65535);const ce=ue().matchPrefix(te.sdp,"a=max-message-size:");return ce.length>0?re=parseInt(ce[0].substring(19),10):b.browser==="firefox"&&z!==-1&&(re=2147483637),re}(arguments[0],C);let B;B=O===0&&P===0?Number.POSITIVE_INFINITY:O===0||P===0?Math.max(O,P):Math.min(O,P);const J={};Object.defineProperty(J,"maxMessageSize",{get:()=>B}),this._sctp=J}return S.apply(this,arguments)}}function ze(x){if(!x.RTCPeerConnection||!("createDataChannel"in x.RTCPeerConnection.prototype))return;function b(C,O){const P=C.send;C.send=function(){const B=arguments[0],J=B.length||B.size||B.byteLength;if(C.readyState==="open"&&O.sctp&&J>O.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+O.sctp.maxMessageSize+" bytes)");return P.apply(C,arguments)}}const S=x.RTCPeerConnection.prototype.createDataChannel;x.RTCPeerConnection.prototype.createDataChannel=function(){const C=S.apply(this,arguments);return b(C,this),C},g(x,"datachannel",C=>(b(C.channel,C.target),C))}function Vt(x){if(!x.RTCPeerConnection||"connectionState"in x.RTCPeerConnection.prototype)return;const b=x.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(b,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(S){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),S&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=S)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(S=>{const C=b[S];b[S]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=O=>{const P=O.target;if(P._lastConnectionState!==P.connectionState){P._lastConnectionState=P.connectionState;const B=new Event("connectionstatechange",O);P.dispatchEvent(B)}return O},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),C.apply(this,arguments)}})}function xt(x,b){if(!x.RTCPeerConnection||b.browser==="chrome"&&b.version>=71||b.browser==="safari"&&b.version>=605)return;const S=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(C){if(C&&C.sdp&&C.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const O=C.sdp.split(`
`).filter(P=>P.trim()!=="a=extmap-allow-mixed").join(`
`);x.RTCSessionDescription&&C instanceof x.RTCSessionDescription?arguments[0]=new x.RTCSessionDescription({type:C.type,sdp:O}):C.sdp=O}return S.apply(this,arguments)}}function jt(x,b){if(!x.RTCPeerConnection||!x.RTCPeerConnection.prototype)return;const S=x.RTCPeerConnection.prototype.addIceCandidate;S&&S.length!==0&&(x.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(b.browser==="chrome"&&b.version<78||b.browser==="firefox"&&b.version<68||b.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():S.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ae(x,b){if(!x.RTCPeerConnection||!x.RTCPeerConnection.prototype)return;const S=x.RTCPeerConnection.prototype.setLocalDescription;S&&S.length!==0&&(x.RTCPeerConnection.prototype.setLocalDescription=function(){let C=arguments[0]||{};if(typeof C!="object"||C.type&&C.sdp)return S.apply(this,arguments);if(C={type:C.type,sdp:C.sdp},!C.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":C.type="offer";break;default:C.type="answer"}return C.sdp||C.type!=="offer"&&C.type!=="answer"?S.apply(this,[C]):(C.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(O=>S.apply(this,[O]))})}(function({window:x}={},b={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const S=w,C=function(P){const B={browser:null,version:null};if(P===void 0||!P.navigator||!P.navigator.userAgent)return B.browser="Not a browser.",B;const{navigator:J}=P;if(J.mozGetUserMedia)B.browser="firefox",B.version=f(J.userAgent,/Firefox\/(\d+)\./,1);else if(J.webkitGetUserMedia||P.isSecureContext===!1&&P.webkitRTCPeerConnection)B.browser="chrome",B.version=f(J.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!P.RTCPeerConnection||!J.userAgent.match(/AppleWebKit\/(\d+)\./))return B.browser="Not a supported browser.",B;B.browser="safari",B.version=f(J.userAgent,/AppleWebKit\/(\d+)\./,1),B.supportsUnifiedPlan=P.RTCRtpTransceiver&&"currentDirection"in P.RTCRtpTransceiver.prototype}return B}(x),O={browserDetails:C,commonShim:l,extractVersion:f,disableLog:y,disableWarnings:E,sdp:Ce};switch(C.browser){case"chrome":if(!o||!G||!b.shimChrome)return S("Chrome shim is not included in this adapter release."),O;if(C.version===null)return S("Chrome shim can not determine version, not shimming."),O;S("adapter.js shimming chrome."),O.browserShim=o,jt(x,C),ae(x),F(x,C),q(x),G(x,C),K(x),ie(x,C),W(x),X(x),ne(x),Q(x,C),tt(x),yt(x),Vt(x),We(x,C),ze(x),xt(x,C);break;case"firefox":if(!a||!_e||!b.shimFirefox)return S("Firefox shim is not included in this adapter release."),O;S("adapter.js shimming firefox."),O.browserShim=a,jt(x,C),ae(x),se(x,C),_e(x,C),Oe(x),Ee(x),le(x),xe(x),Se(x),Ie(x),Ze(x),_t(x),fe(x),tt(x),Vt(x),We(x,C),ze(x);break;case"safari":if(!c||!b.shimSafari)return S("Safari shim is not included in this adapter release."),O;S("adapter.js shimming safari."),O.browserShim=c,jt(x,C),ae(x),kt(x),He(x),Re(x),ge(x),rt(x),Bt(x),St(x),$t(x),tt(x),yt(x),We(x,C),ze(x),xt(x,C);break;default:S("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),i(8520);const j=()=>typeof RTCPeerConnection=="function";var V,pe;(function(x){x[x.TRACE=0]="TRACE",x[x.DEBUG=1]="DEBUG",x[x.INFO=2]="INFO",x[x.WARN=3]="WARN",x[x.ERROR=4]="ERROR",x[x.SILENT=5]="SILENT"})(V||(V={})),function(x){x.SPADE="SPADE",x.TIME="Time",x.WEBRTC="WebRTC",x.EMITTER="Emitter",x.MEDIA="Media",x.SUBSCRIPTION="StageSubscription",x.PUBLICATION="StagePublication",x.CONNECTION="StageConnection",x.SOCKET="StageSocket",x.BROADCAST_STAGE_CLIENT="BroadcastStageClient",x.STAGE="Stage",x.REMOTE_PARTICIPANT="RemoteParticipant",x.LOCAL_PARTICIPANT="LocalParticipant",x.CONFIGURATION="Configuration",x.REMOTE_PLAYBACK="RemotePlaybackController",x.REMOTE_STAGE_STREAM="RemoteStageStream"}(pe||(pe={}));const Ne=1007,Fe=12e4,dt=3e5;class bt extends Error{constructor({name:b,message:S,code:C,details:O,cause:P,params:B}){super(S),Error.captureStackTrace&&Error.captureStackTrace(this,bt),this.name=b||"BroadcastClientError",this.message=S,this.code=C,this.details=O,this.cause=P,this.params=B}}const Dn={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},Ue={name:"CameraError",code:2e3,message:"Camera could not be captured"},Dt={name:"InputError",code:3e3,message:"Input could not be attached"},st={name:"AddDeviceError",code:4e3,message:"Device is missing"},Ct={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},sn={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},Jt={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},Le={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},it={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},Tt={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},wt={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},Pn={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},Yr={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},cr={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},zn={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},dn={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},tn={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},Cn={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},Rn={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},_r={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},di={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},ii={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},xo={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},yu={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},Kd={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},af={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},cf={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},ye={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},Ke={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},pt={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},vt={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},Xe={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var zt,Qt,hn,mn,Un,Xn,_n,yr,Vr,En=function(x,b,S,C){if(S==="a"&&!C)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!C:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?C:S==="a"?C.call(x):C?C.value:b.get(x)},jn=function(x,b,S,C,O){if(typeof b=="function"?x!==b||!O:!b.has(x))throw new TypeError("Cannot write private member to an object whose class did not declare it");return b.set(x,S),S};const br=1920,on=1080,qi=V.ERROR,Er={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},Bs={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},Jn={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},lr={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},Ul={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},Ti={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},Co={reconnect:!1,timeout:Fe};function Fl(x){var b,S;if(typeof x!="string"&&x!==void 0)throw new bt(xo);if(x){if(x.startsWith("https"))return x;{const C=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(x);if(((b=C==null?void 0:C.groups)===null||b===void 0?void 0:b.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(S=C==null?void 0:C.groups)===null||S===void 0?void 0:S.id)return`https://${C.groups.id}.webrtc.live-video.net:4443`;throw new bt(yu)}}return""}class Ki{constructor(b,S,C=Er,O,P=Co){this.LOG_LEVEL=V,this.BASIC_LANDSCAPE=Er,this.BASIC_PORTRAIT=Bs,this.BASIC_FULL_HD_LANDSCAPE=Jn,this.BASIC_FULL_HD_PORTRAIT=lr,this.STANDARD_LANDSCAPE=Ul,this.STANDARD_PORTRAIT=Ti,zt.set(this,void 0),Qt.set(this,void 0),hn.set(this,Er),mn.set(this,void 0),Un.set(this,Co),Xn.set(this,B=>{if(!B)throw new bt(Object.assign(Object.assign({},ii),{details:"missing stream configuration"}));if(!(B.maxBitrate<=8500&&B.maxBitrate>=200))throw new bt(Object.assign(Object.assign({},ii),{details:"maxBitrate must be between 200 and 8500"}));if(!(B.maxFramerate<=60&&B.maxFramerate>=10))throw new bt(Object.assign(Object.assign({},ii),{details:"maxFramerate must be between 10 and 60"}));const J=B.maxResolution.width,te=B.maxResolution.height;if(J>br||te>br||J<160||te<160||J===br&&te>on||te===br&&J>on)throw new bt(Object.assign(Object.assign({},ii),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))}),_n.set(this,B=>{if(!B)return;const J=Number(B),te=Number.isInteger(J),z=J>=V.TRACE,re=J<=V.SILENT;if(!te||!z||!re)throw new bt(Kd)}),yr.set(this,B=>{if(B&&typeof B!="object")throw new bt(af)}),Vr.set(this,B=>{if(!B)return;if(typeof B!="object"||typeof B.reconnect!="boolean")throw new bt(ye);const{timeout:J}=B;if(J!==void 0&&(Number.isNaN(J)||typeof J!="number"||J<1e4||J>dt))throw new bt(Ke)}),En(this,yr,"f").call(this,O),En(this,_n,"f").call(this,S),En(this,Xn,"f").call(this,C),jn(this,zt,b),jn(this,Qt,S),jn(this,hn,C),jn(this,mn,O),jn(this,Un,P)}get ingestEndpoint(){return En(this,zt,"f")}set ingestEndpoint(b){jn(this,zt,Fl(b))}get streamConfig(){return En(this,hn,"f")}set streamConfig(b){En(this,Xn,"f").call(this,b),jn(this,hn,b)}get logLevel(){return En(this,Qt,"f")}set logLevel(b){En(this,_n,"f").call(this,b),jn(this,Qt,b)}get logger(){return En(this,mn,"f")}set logger(b){En(this,yr,"f").call(this,b),jn(this,mn,b)}get networkReconnectConfig(){return En(this,Un,"f")}set networkReconnectConfig(b){En(this,Vr,"f").call(this,b),jn(this,Un,b)}}zt=new WeakMap,Qt=new WeakMap,hn=new WeakMap,mn=new WeakMap,Un=new WeakMap,Xn=new WeakMap,_n=new WeakMap,yr=new WeakMap,Vr=new WeakMap;var vn,uc=i(6729),Bl=i(1206);(function(x){x.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",x.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",x.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",x.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",x.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",x.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",x.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",x.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",x.PUBLISH="ivs_broadcast_multihost_publish",x.UNPUBLISH="ivs_broadcast_multihost_unpublish",x.SUBSCRIBE="ivs_broadcast_multihost_subscribe",x.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",x.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",x.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",x.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",x.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",x.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",x.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",x.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",x.FIRST_FRAME="ivs_broadcast_multihost_first_frame",x.JOIN="ivs_broadcast_multihost_join",x.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",x.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",x.JOIN_ENDED="ivs_broadcast_multihost_join_ended",x.LEAVE="ivs_broadcast_multihost_leave",x.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",x.SERVER_REQUEST="ivs_broadcast_multihost_server_request",x.TRACE="ivs_broadcast_stage_trace",x.ERROR="ivs_broadcast_error",x.MINUTE="ivs_broadcast_multihost_minute",x.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",x.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",x.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",x.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",x.EDP_PONG="ivs_broadcast_multihost_edp_rtt",x.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",x.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",x.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",x.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",x.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state"})(vn||(vn={}));class gr{constructor(b,S,C,O){let P="unknown";if(S.stageARN&&S.stageARN.startsWith("arn:aws:ivs:")){const B=S.stageARN.split(":");B.length===6&&(P=B[4])}this.event=b,this.properties={client_time:new Date().toISOString(),customer_id:P,device_software:window.navigator.userAgent,multihost_id:S.stageARN,participant_id:S.participantID,participant_user_id:S.userID,platform:"web",sdk_version:"1.19.0",stage_arn:S.stageARN,trace_id:C.value},S.attrGsRole&&(this.properties.token_attribute_0=S.attrGsRole),S.attrGsSessionId&&(this.properties.token_attribute_1=S.attrGsSessionId),this.critical=O}}class Yd extends gr{constructor(b){super(vn.ERROR,b.token,b.traceId,!0),Object.assign(this.properties,{code:b.code,tag:b.tag,description:b.message,remote_participant_id:b.remoteParticipantId,request_uuid:b.requestUUID,is_nominal:b.nominal,is_fatal:b.fatal,details:b.details,location:b.location})}}const Vo="IVS_CLIENT_OVERRIDES";function Xd(x){const b=window[Vo];return typeof b=="object"?b[x]:x==="logLevel"?window.STAGES_LOG_LEVEL:x==="appLabel"?window.IVS_APP_LABEL:x==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function lf(x){const b=Xd(x);if(typeof b=="string")return b}function bu(x){const b=Xd(x);if(typeof b=="boolean")return b}function $p(){const x=Xd("logLevel");if(typeof x=="number"&&Object.values(V).includes(x))return x}function Hp(){return bu("disableXdp")}function nd(){return bu("enableXdpPublish")}function ha(){return bu("preferMainProfile")}function uf(){return bu("enableInitialLayerOnSdp")}var ur=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};const Py=4;class Pg{constructor(b="https://broadcast.stats.live-video.net/"){this.spadeUrl=b}send(b,S=!1){return ur(this,void 0,void 0,function*(){const C=Date.now();for(const J of b)J.properties.batch_time_millis=C;const O=this.b64EncodeUnicode(JSON.stringify(b)),P={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},B=`data=${O}`;S?navigator.sendBeacon(this.spadeUrl,B):ur(this,void 0,void 0,function*(){try{yield function(J,te,z={},re=""){return ur(this,void 0,void 0,function*(){const ce=new XMLHttpRequest;return ce.open(J,te,!0),z&&Object.keys(z).forEach(de=>{z.hasOwnProperty(de)&&ce.setRequestHeader(de,z[de])}),new Promise((de,ke)=>{ce.onreadystatechange=()=>{ce.readyState===Py&&(ce.status>=200&&ce.status<300?de(ce.responseText):ke(new Error(`Spade ${J} ${te} responded ${ce.status}
${ce.responseText}`)))},ce.send(re)})})}("POST",this.spadeUrl,P,B)}catch{}})})}b64EncodeUnicode(b){return btoa(encodeURIComponent(b).replace(/%([0-9A-F]{2})/g,(S,C)=>String.fromCharCode(+`0x${C}`)))}}function jl(x){if(!x)throw new Error("SpadeClient is not defined")}function Vp(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,x=>{const b=16*Math.random()|0;return(x==="x"?b:3&b|8).toString(16)})}class rd{constructor(){this.sharedProperties={},this.spadeClient={},this.queuedEvents=[],this.genSessionId();const b=function(){const C=lf("analyticsPostUrl");if(C!==void 0)return C}()||"https://broadcast.stats.live-video.net/",S=function(){const C=lf("appLabel");if(C!==void 0)return C.substring(0,64)}();this.spadeClient=new Pg(b),this.initSharedProperties({appLabel:S})}start(){this.flushInterval||(this.flushInterval=window.setInterval(()=>{this.flushEvents()},1e3))}stop(b){let S=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,b&&(this.queuedEvents=this.queuedEvents.filter(C=>C.critical),S=!0),this.flushEvents(S),this.genSessionId()}trackEvent(b,S=!1){let C=this.sharedProperties;S&&(C={global_session_id:rd.globalSessionId,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version}),"data"in b?(b.data.properties=Object.assign({},C,b.data.properties),this.queuedEvents.push(b.data)):(b.properties=Object.assign({},C,b.properties),this.queuedEvents.push(b))}trackEventNoSharedProps(b){this.trackEvent(b,!0)}trackErrorAndThrow(b){throw this.trackError(b),b}trackError(b){this.trackEvent(new Yd(b))}batchEvents(b){jl(this.spadeClient);const S=b.map(C=>(C.data.properties=Object.assign({},this.sharedProperties,C.data.properties),C.data));this.spadeClient.send(S)}initSharedProperties({appLabel:b}){const S=Bl.getParser(navigator.userAgent),C=this.parseSemver(String(S.getBrowserVersion()));this.sharedProperties={browser:navigator.appVersion,browser_family:S.getBrowserName().toLowerCase(),browser_version:`${C.major}.${C.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:S.getOSName(),os_version:String(S.getOSVersion()),platform:"web",global_session_id:rd.globalSessionId,session_id:this.sessionId,sdk_version:"1.19.0",user_agent:navigator.userAgent},b&&(this.sharedProperties.app_label=b)}genSessionId(){this.sessionId=Vp(),this.sharedProperties.session_id=this.sessionId}flushEvents(b=!1){jl(this.spadeClient),this.queuedEvents.length>0&&this.spadeClient.send(this.queuedEvents,b),this.queuedEvents=[]}parseSemver(b){const S=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(b)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(b)||/^(\d+)$/.exec(b)||[];return{major:parseInt(S[1],10)||0,minor:parseInt(S[2],10)||0,patch:parseInt(S[3],10)||0}}getSessionId(){return this.sessionId}}rd.globalSessionId=Vp();class wr{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const C=this.transformProperties(b,S);this.data={event:si.CONGESTION_TIME,properties:C}}}class $l{constructor(b,S,C){this.transformProperties=(P,B,J)=>({duration:(P.getTime()-((B==null?void 0:B.getTime())||0))/1e3,ecn_negotiated:!1,ingest_session_id:J});const O=this.transformProperties(b,S,C);this.data={event:si.CONNECTION_ESTABLISHED,properties:O}}}class L_{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const C=this.transformProperties(b,S);this.data={event:si.CONNECTION_RTT,properties:C}}}class Dg{constructor(b){this.transformProperties=C=>{var O;return{is_fatal:(O=C.isFatal)!==null&&O!==void 0&&O,value:C.value,code:C.code,description:C.description}};const S=this.transformProperties(b);this.data={event:si.ERROR,properties:S}}}class Lg{constructor(b,S){this.transformProperties=(O,P)=>({type:O,input_device_id:P.deviceId,position:P.facingMode||"unknown"});const C=this.transformProperties(b,S);this.data={event:si.INPUT_DEVICE_ATTACHED,properties:C}}}class zp{constructor(b,S){this.transformProperties=(O,P)=>({type:O,input_device_id:P.deviceId,position:P.facingMode||"unknown"});const C=this.transformProperties(b,S);this.data={event:si.INPUT_DEVICE_DETACHED,properties:C}}}class tl{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const C=this.transformProperties(b,S);this.data={event:si.MEASURED_BITRATE,properties:C}}}class Ug{constructor(b,S){this.transformProperties=(O,P)=>({minutes_logged:Math.round((O.timestamp-P)/6e4)});const C=this.transformProperties(b,S);this.data={event:si.MINUTE_BROADCAST,properties:C}}}class df{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const C=this.transformProperties(b,S);this.data={event:si.RECOMMENDED_BITRATE,properties:C}}}class Hl{constructor(b){this.transformProperties=C=>({codec:C.mimeType,bitrate:0,sample_rate:C.clockRate,channel_count:C.channels});const S=this.transformProperties(b);this.data={event:si.SESSION_AUDIO_ENCODER_CONFIGURED,properties:S}}}class Vl{constructor(b){this.transformProperties=C=>({codec:"audio",bitrate:32e3,sample_rate:C.sampleRate,channel_count:C.channelCount});const S=this.transformProperties(b);this.data={event:si.SESSION_AUDIO_PROPERTIES,properties:S}}}class Gp{constructor(b,S,C){this.transformProperties=(P,B,J)=>({codec:J.mimeType,codec_profile:B.profile,codec_level:B.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:P.width,height:P.height,bframe_count:0,target_fps:P.frameRate});const O=this.transformProperties(b,S,C);this.data={event:si.SESSION_VIDEO_ENCODER_CONFIGURED,properties:O}}}class Wp{constructor(b){this.transformProperties=C=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:C.width,height:C.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:C.frameRate});const S=this.transformProperties(b);this.data={event:si.SESSION_VIDEO_PROPERTIES,properties:S}}}class Fg{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const C=this.transformProperties(b,S);this.data={event:si.SOURCE_AUDIO_LATENCY,properties:C}}}class Dy{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const C=this.transformProperties(b,S);this.data={event:si.SOURCE_VIDEO_LATENCY,properties:C}}}class dc{constructor(b,S){this.transformProperties=({protocol:O,hostname:P,port:B},J)=>({protocol:O,endpoint_host:P,endpoint_port:B,reason:J});const C=this.transformProperties(b,S);this.data={event:si.START_BROADCAST,properties:C}}}class U_{constructor(b){this.transformProperties=({protocol:C,hostname:O,port:P})=>({protocol:C,endpoint_host:O,endpoint_port:P});const S=this.transformProperties(b);this.data={event:si.STOP_BROADCAST,properties:S}}}class qp{constructor(b){this.transformProperties=C=>({bytes_sent:C.bytesSent,header_bytes_sent:C.headerBytesSent,nack_count:C.nackCount,packets_sent:C.packetsSent,retransmitted_bytes_sent:C.retransmittedBytesSent,retransmitted_packets_sent:C.retransmittedPacketsSent});const S=this.transformProperties(b);this.data={event:si.WEBRTC_AUDIO_STATS,properties:S}}}class hc{constructor(b){this.transformProperties=C=>({bytes_sent:C.bytesSent,fir_count:C.firCount,frames_encoded:C.framesEncoded,frames_sent:C.framesSent,header_bytes_sent:C.headerBytesSent,huge_frames_sent:C.hugeFramesSent,key_frames_encoded:C.keyFramesEncoded,nack_count:C.nackCount,packets_sent:C.packetsSent,pli_count:C.pliCount,quality_limitation_reason:C.qualityLimitationReason,quality_limitation_resolution_changes:C.qualityLimitationResolutionChanges,retransmitted_bytes_sent:C.retransmittedBytesSent,retransmitted_packets_sent:C.retransmittedPacketsSent,total_encode_time:C.totalEncodeTime,total_encoded_bytes_target:C.totalEncodedBytesTarget,total_packet_send_delay:C.totalPacketSendDelay});const S=this.transformProperties(b);this.data={event:si.WEBRTC_VIDEO_STATS,properties:S}}}var si,nl;(function(x){x.START_BROADCAST="ivs_broadcast_start_broadcast",x.STOP_BROADCAST="ivs_broadcast_stop_broadcast",x.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",x.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",x.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",x.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",x.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",x.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",x.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",x.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",x.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",x.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",x.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",x.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",x.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",x.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",x.CONGESTION_TIME="ivs_broadcast_congestion_time",x.BUFFER_DURATION="ivs_broadcast_buffer_duration",x.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",x.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",x.CONNECTION_RTT="ivs_broadcast_connection_rtt",x.ERROR="ivs_broadcast_error"})(si||(si={})),function(x){x.USER_INITIATED="user-initiated",x.NETWORK_DISCONNECT="network-disconnect"}(nl||(nl={}));const Kp={[V.INFO]:"#528bff",[V.WARN]:"#ffb31a",[V.DEBUG]:"#00f593",[V.ERROR]:"#ff4f4d",[V.TRACE]:"",[V.SILENT]:"",[pe.SPADE]:"#a970ff",[pe.TIME]:"#53535f",[pe.WEBRTC]:"#0e9bd8",[pe.SUBSCRIPTION]:"#ffc400",[pe.CONNECTION]:"#ff5edb",[pe.SOCKET]:"#8585ff",[pe.EMITTER]:"#adadb8",[pe.LOCAL_PARTICIPANT]:"#1DD21D",[pe.STAGE]:"#EC9806",[pe.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},zl=({label:x})=>`background: ${Kp[x]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,F_=Object.entries(V),hf=(x,b,S)=>{const C=zl({label:x}),[O]=F_.find(([,Qe])=>Qe===Number(x))||[],P=`%c${O}`,B=zl({label:b}),J=`%c${b}`,te=zl({label:pe.TIME}),z=`%c[${new Date().toISOString()}]`,re=zl({label:"details"}),ce=`%c[${S}]`,de=[z,P,J],ke=[te,C,B];return S&&(de.push(ce),ke.push(re)),[de.join(""),...ke]},Ly={debug(x){console.groupCollapsed(...hf(V.DEBUG,x.scope,x.label)),console.debug(x.msg,Object.assign(Object.assign({},x),{level:"debug"})),console.groupEnd()},info(x){console.groupCollapsed(...hf(V.INFO,x.scope,x.label)),console.info(x.msg,Object.assign(Object.assign({},x),{level:"info"})),console.groupEnd()},warn(x){console.groupCollapsed(...hf(V.WARN,x.scope,x.label)),console.warn(x.msg,Object.assign(Object.assign({},x),{level:"warn"})),console.groupEnd()},error(x){console.groupCollapsed(...hf(V.ERROR,x.scope,x.label)),console.error(x),console.groupEnd()}};var Eu=function(x,b){var S={};for(var C in x)Object.prototype.hasOwnProperty.call(x,C)&&b.indexOf(C)<0&&(S[C]=x[C]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function"){var O=0;for(C=Object.getOwnPropertySymbols(x);O<C.length;O++)b.indexOf(C[O])<0&&Object.prototype.propertyIsEnumerable.call(x,C[O])&&(S[C[O]]=x[C[O]])}return S};Object.entries(V);class Jd{constructor(b=qi,S=Ly){this.logLevel=b,this.loggerInstance=S}debug(b){var S,C;this.logLevel>V.DEBUG||(C=(S=this.loggerInstance).debug)===null||C===void 0||C.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{level:"debug"}))))}info(b){var S,C;this.logLevel>V.INFO||(C=(S=this.loggerInstance).info)===null||C===void 0||C.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{level:"info"}))))}warn(b){var S,C;this.logLevel>V.WARN||(C=(S=this.loggerInstance).warn)===null||C===void 0||C.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{level:"warn"}))))}error(b){var S,C,{err:O}=b,P=Eu(b,["err"]);this.logLevel>V.ERROR||(C=(S=this.loggerInstance).error)===null||C===void 0||C.call(S,Object.assign({err:O},P))}}class Ks{constructor(b,S){this.logger=b,this.scope=S}debug(b){var S,C;(C=(S=this.logger).debug)===null||C===void 0||C.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{scope:this.scope}))))}info(b){var S,C;(C=(S=this.logger).info)===null||C===void 0||C.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{scope:this.scope}))))}warn(b){var S,C;(C=(S=this.logger).warn)===null||C===void 0||C.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{scope:this.scope}))))}error(b){var S,C,{err:O}=b,P=Eu(b,["err"]);(C=(S=this.logger).error)===null||C===void 0||C.call(S,Object.assign(Object.assign({err:O},P),{scope:this.scope}))}unwrap(){return this.logger}}class Yi{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(b){(this.min===0||b<this.min)&&(this.min=b),b>=this.max&&(this.max=b),this.data.push(b),this.sum+=b}median(){this.data.sort();const b=this.data.length>>1;return this.data.length%2==0?this.data[b-1]+this.data[b]>>1:this.data[b]}percentile(b){if(this.data.length===0)return 0;if(b<=0)return this.data[0];if(b>=1)return this.data[this.data.length-1];const S=(this.data.length-1)*b,C=Math.floor(S),O=C+1,P=S%1;return O>=this.data.length?this.data[C]:this.data[C]*(1-P)+this.data[O]*P}}var $a=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};class id{constructor(b,S,C,O){this.peerClient=b,this.broadcastCanvasManager=S,this.analyticsTracker=O,this.logger=new Ks(C,pe.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval(()=>{this.collectSamples()},1e3),this.trackSamplesTimerId=window.setInterval(()=>{this.trackSamples()},3e4),this.trackPeerConnectionStatsTimerId=window.setInterval(()=>{this.trackPeerConnectionStats()},6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return $a(this,void 0,void 0,function*(){(yield this.peerClient.getReports()).forEach(b=>{if(b.type==="outbound-rtp")switch(b.kind){case"audio":this.analyticsTracker.trackEvent(new qp(b));break;case"video":{const S=new hc(b),C=new Ug(b,this.startTimestamp);this.analyticsTracker.batchEvents([S,C]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:b.kind})}})})}collectSamples(){return $a(this,void 0,void 0,function*(){let b=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach(C=>{switch(C.type){case"candidate-pair":C.nominated&&(this.rttSamples.push(C.currentRoundTripTime),this.recommendedBitrateSamples.push(C.availableOutgoingBitrate));break;case"outbound-rtp":b+=C.bytesSent||0,this.startTimestamp===0&&C.kind==="video"&&(this.startTimestamp=C.timestamp)}});const S=8*Math.round(b-this.previousBytesSent);this.previousBytesSent=b,this.measuredBitrateSamples.push(S)})}trackSamples(){const S=new Fg(this.audioLatencySamples,30),C=new Dy(this.videoLatencySamples,30),O=new wr(this.congestionTimeSamples,30),P=new tl(this.measuredBitrateSamples,30),B=new df(this.recommendedBitrateSamples,30),J=new L_(this.rttSamples,30);this.analyticsTracker.batchEvents([S,C,O,P,B,J]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new Yi,this.videoLatencySamples=new Yi,this.congestionTimeSamples=new Yi,this.measuredBitrateSamples=new Yi,this.recommendedBitrateSamples=new Yi,this.rttSamples=new Yi}}const Ms={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},Is="connectionStateChange",rl="sdpNegotiated",fa="clientError",sd="seiMessageReceived",ot="transformError";var nt;(function(x){x.CLOSED="closed",x.COMPLETED="completed",x.CONNECTED="connected",x.CONNECTING="connecting",x.DISCONNECTED="disconnected",x.FAILED="failed",x.IDLE="idle",x.NEW="new",x.NONE="none"})(nt||(nt={}));const Mt=x=>{const b=P=>{var B;return!((B=P.deviceId)===null||B===void 0)&&B.startsWith("web-contents-media-stream")?"tab":void 0},S=P=>{var B;return!((B=P.deviceId)===null||B===void 0)&&B.startsWith("window")&&P.displaySurface==="window"?"window":void 0},C=P=>{var B;return!((B=P.deviceId)===null||B===void 0)&&B.startsWith("screen")&&P.displaySurface==="monitor"?"screen":void 0};return(b(O=x)||S(O)||C(O)?void 0:"camera")||C(x)||S(x)||b(x)||"unknown";var O};function nn(x,b){return x.find(S=>S.kind===b)}var Gt;(function(x){x.VIDEO="video",x.AUDIO="audio"})(Gt||(Gt={}));class zr{constructor(){this.mediaTracks=new Map([[Gt.VIDEO,void 0],[Gt.AUDIO,void 0]])}setTrack(b,S){this.mediaTracks.set(b,S)}getTrack(b){return this.mediaTracks.get(b)}}class js{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(b){return b?(b.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map(S=>S.trim()).filter(Boolean).forEach(S=>{const C=S.split("=");if(C.length===2)switch(C[0]){case"level-asymmetry-allowed":C[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":C[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(C[1]),this.level=this.getLevelFromId(C[1])}}),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(b){const S=b.substr(0,2),C=b.substr(2,2);switch(S.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return C==="00"?"high 10":"high 10 intra";case"7a":return C==="00"?"high 42":"high 42 intra";case"f4":return C==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(b){return parseInt(b.substr(4,2),16)}}function il(x){return btoa(JSON.stringify(x))}var Lr,Qd=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};(function(x){x.IDLE="idle",x.EXECUTING="executing",x.RECONNECTING="reconnecting"})(Lr||(Lr={}));class Zd{constructor(b,S=12e4,C,O){this.state=Lr.IDLE,this.failureCallback=()=>{},this.peerClient=b,this.timeout=S,this.logger=C,this.emitter=O}onFailure(b){this.failureCallback=b}setStartConfig(b,S){this.ingestEndpoint=b,this.streamKey=S}execute(){const{id:b}=this;this.state===Lr.IDLE&&(this.state=Lr.EXECUTING,this.emitter.emit(Ms.CONNECTION_STATE_CHANGE,nt.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:b}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(b){this.timeoutTimerId=window.setTimeout(()=>{this.state!==Lr.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(Ms.CONNECTION_STATE_CHANGE,nt.FAILED),this.failureCallback())},b)}stop(){this.state=Lr.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return Qd(this,void 0,void 0,function*(){if(this.ingestEndpoint&&this.streamKey){const b=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),b===nt.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(S){throw this.logger.error({err:S}),S}}})}isActive(){return this.state!==Lr.IDLE}}class Ro extends Zd{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let b=5e3;const S=()=>Qd(this,void 0,void 0,function*(){if(this.state===Lr.EXECUTING)try{this.state=Lr.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:b}),this.state=Lr.EXECUTING,this.currentTimeoutId=window.setTimeout(S,b),b*=2}});this.currentTimeoutId=window.setTimeout(S,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class eh extends Zd{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>Qd(this,void 0,void 0,function*(){if(navigator.onLine&&this.state===Lr.EXECUTING){this.state=Lr.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=Lr.EXECUTING}}})}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class Bg{static create(b,S=Co,C,O){const{reconnect:P,timeout:B}=S;if(P){const J=Bl.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(J)&&navigator.connection?new eh(b,B,C,O):new Ro(b,B,C,O)}}}var Ys,Xs=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})},Gl=function(x,b,S,C){if(S==="a"&&!C)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!C:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?C:S==="a"?C.call(x):C?C.value:b.get(x)};const Gr=x=>!!x;function kc(x){if(!x)throw new Error("PeerConnection is not defined")}const od={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class Yp{constructor(b,S,C,O,P){this.config=b,this.emitter=S,this.mediaStreamManager=C,this.analyticsTracker=P,this.establishConnection=(B,J)=>Xs(this,void 0,void 0,function*(){var te,z,re;kc(this.peerConnection);try{const ce=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(ce),yield this.sendSetupRequest(B,J,ce)}catch(ce){if(ce instanceof Error){(te=(re=ce).code)!==null&&te!==void 0||(re.code=Cn.code);const de=new bt(Object.assign(Object.assign({},Cn),{name:ce.name,message:ce.message,code:ce==null?void 0:ce.code,cause:ce}));throw!((z=this.reconnectStrategy)===null||z===void 0)&&z.isActive()||this.handleError(ce.code,ce.message),this.stop(),de}}}),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var B;if(!this.peerConnection)return nt.NONE;const J=(B=this.reconnectStrategy)===null||B===void 0?void 0:B.isActive(),te=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(te){case"new":return nt.NEW;case"closed":return nt.CLOSED;case"disconnected":return J?nt.CONNECTING:nt.DISCONNECTED;case"failed":return J?nt.CONNECTING:nt.FAILED;case"idle":return nt.IDLE;case"checking":case"connecting":return nt.CONNECTING;case"completed":case"connected":return nt.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:te}),nt.IDLE}},this.onConnectionStateChange=()=>{var B;const J=this.getConnectionState();switch(J){case nt.CONNECTED:{this.emitter.emit(Ms.CONNECTION_STATE_CHANGE,J);const te=new Date;this.analyticsTracker.trackEvent(new $l(te,this.connectionStartDate,this.ingestSessionId));const z=this.mediaStreamManager.getTrack(Gt.AUDIO),re=this.mediaStreamManager.getTrack(Gt.VIDEO);if(re){const ce=re.getSettings();this.analyticsTracker.trackEvent(new Wp(ce))}if(z){const ce=z.getSettings();this.analyticsTracker.trackEvent(new Vl(ce))}(((B=this.peerConnection)===null||B===void 0?void 0:B.getSenders())||[]).forEach(ce=>{var de;(((de=ce.getParameters())===null||de===void 0?void 0:de.codecs)||[]).forEach(ke=>{var Qe;switch((Qe=ce.track)===null||Qe===void 0?void 0:Qe.kind){case"video":{if(!re)break;const Be=new js().extractVideoSdpFmtpLine(ke.sdpFmtpLine),Me=re.getSettings();this.analyticsTracker.trackEvent(new Gp(Me,Be,ke));break}case"audio":if(!z)break;this.analyticsTracker.trackEvent(new Hl(ke))}})});break}case nt.CONNECTING:this.emitter.emit(Ms.CONNECTION_STATE_CHANGE,J),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case nt.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(Ms.CONNECTION_STATE_CHANGE,J),this.handleTerminalConnectionFailure());break;case nt.DISCONNECTED:this.emitter.emit(Ms.CONNECTION_STATE_CHANGE,J),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(Ms.CONNECTION_STATE_CHANGE,J)}},this.handleLocalDescription=B=>Xs(this,void 0,void 0,function*(){var J;return(J=this.peerConnection)===null||J===void 0?void 0:J.setLocalDescription(B)}),Ys.set(this,B=>{if(typeof B!="string")throw new bt(xo);try{new URL(B)}catch{throw new bt(yu)}}),this.logger=new Ks(O,pe.WEBRTC),this.createReconnectStrategy(b)}start(b,S){var C;return Xs(this,void 0,void 0,function*(){Gl(this,Ys,"f").call(this,b);const O=[this.mediaStreamManager.getTrack(Gt.VIDEO),this.mediaStreamManager.getTrack(Gt.AUDIO)].filter(Gr);if(this.createPeerConnection(),this.addTracks({tracks:O}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(b,S),yield this.establishConnection(b,S),!((C=this.reconnectStrategy)===null||C===void 0)&&C.isActive()){const P=new URL(b);this.analyticsTracker.trackEvent(new dc({protocol:"webrtc",hostname:P.hostname,port:P.port},nl.NETWORK_DISCONNECT))}})}stop(){var b,S,C,O;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[nt.NEW,nt.CONNECTING,nt.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(Ms.CONNECTION_STATE_CHANGE,nt.CLOSED),(b=this.peerConnection)===null||b===void 0||b.close(),(S=this.peerConnection)===null||S===void 0||S.removeEventListener("connectionstatechange",this.onConnectionStateChange),(C=this.peerConnection)===null||C===void 0||C.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(O=this.reconnectStrategy)===null||O===void 0||O.stop()}addTracks(b){var S;if(kc(this.peerConnection),!b)return;const C=this.peerConnection.getSenders().map(P=>{var B;return(B=P.track)===null||B===void 0?void 0:B.id}),O=b.tracks.filter(P=>!C.includes(P.id));for(const P of O)(S=this.peerConnection)===null||S===void 0||S.addTrack(P)}getReports(){var b;return Xs(this,void 0,void 0,function*(){try{const S=(yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats())||[],C=[];return S.forEach(O=>{C.push(O)}),C}catch{return[]}})}sendSetupRequest(b,S,C){var O;return Xs(this,void 0,void 0,function*(){const P=yield fetch(`${b}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:il(C),streamKey:S},this.config.streamConfig))});if(!P.ok)throw function(J){let te=new bt(Object.assign({},Cn));return(J==null?void 0:J.code)===Ne&&(te=new bt(Object.assign({},_r))),J!=null&&J.message&&(te.message=J.message),te}(yield P.json());const B=yield P.json();B!=null&&B.answer&&(yield(O=this.peerConnection)===null||O===void 0?void 0:O.setRemoteDescription(function(J){return JSON.parse(atob(J))}(B.answer)),this.ingestSessionId=B.ingestSessionId)})}handleTerminalConnectionFailure(){const b=new bt(Rn);this.handleError(b.code,b.message)}handleError(b,S){this.analyticsTracker.trackEvent(new Dg({code:b,description:S,isFatal:!0})),this.emitter.emit(Ms.ERROR,{code:b,message:S})}createPeerConnection(){var b;const S=this.getConnectionState(),C=S!==nt.NONE,O=S!==nt.CLOSED,P=(b=this.reconnectStrategy)===null||b===void 0?void 0:b.isActive();C&&O&&!P||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval(()=>{const B=this.getConnectionState();if(this.reconnectStrategy&&B===nt.DISCONNECTED&&this.disconnectionStartDate){const J=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:J}),J>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else B===nt.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)},1e3),this.peerConnection=new RTCPeerConnection(od),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(b){if(this.reconnectStrategy=Bg.create(this,b.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const S=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:S})}}}Ys=new WeakMap;var ad,B_=i(2492);(function(x){x.CONFIG="config",x.UPDATE="update",x.START="start",x.STOP="stop"})(ad||(ad={}));var fc=i(477),zo=i.n(fc);function gi(){return zo()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var t;!function(t){t.CONFIG="config",t.UPDATE="update",t.START="start",t.STOP="stop"}(t||(t={}));const i=self;const s=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(t){this.config=Object.assign(Object.assign({},this.config),t),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{i.postMessage({type:t.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};i.addEventListener("message",(function(i){var n;if(null===(n=null==i?void 0:i.data)||void 0===n?void 0:n.type)switch(i.data.type){case t.CONFIG:s.setConfig(i.data.payload||{});break;case t.START:s.start();break;case t.STOP:s.stop()}}))})();`,"Worker",void 0,void 0)}var Nc=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};class Pc{constructor(b,S,C){this.config=b,this.mediaStreamManager=S,this.analyticsTracker=C,this.handleWorkerEvent=J=>{var te;((te=J.data)===null||te===void 0?void 0:te.type)===ad.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new gi,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const O=this.compositeEl.getContext("2d");if(O===null)throw new bt(Object.assign({},Dn));this.compositeContext=O,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const P=nn(this.compositeStream.getTracks(),Gt.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const B=nn(this.audioDestination.stream.getTracks(),Gt.AUDIO);P&&this.mediaStreamManager.setTrack(Gt.VIDEO,P),B&&this.mediaStreamManager.setTrack(Gt.AUDIO,B),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:ad.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(b){this.previewElement=b;const{width:S,height:C}=this.config.streamConfig.maxResolution;this.previewElement.width=S,this.previewElement.height=C,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const b=this.audioContext.createConstantSource(),S=this.audioContext.createGain();S.gain.value=.001,b.connect(S),S.connect(this.audioDestination),b.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const b=document.body,S=["touchstart","touchend","mousedown","keydown"],C=()=>{S.forEach(P=>{b.removeEventListener(P,O)})},O=()=>{this.audioContext.resume().then(C)};S.forEach(P=>{b.addEventListener(P,O,!1)})}getTracks(){return[this.mediaStreamManager.getTrack(Gt.VIDEO),this.mediaStreamManager.getTrack(Gt.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(Gt.VIDEO)}getAudioInputDevice(b){if(typeof b!="string")return;const S=this.mixer.audio.find(C=>{if(C.name===b)return C.source});return S==null?void 0:S.source}getVideoInputDevice(b){if(typeof b=="string")return this.mixer.video.find(S=>S.name===b)}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(b,S,C){var O;return Nc(this,void 0,void 0,function*(){if(typeof b!="object")throw new bt(Object.assign({},st));if(!S||typeof S!="string")throw new bt(Object.assign({},Le));if(this.mixer.video.some(de=>de.name===S))throw new bt(Object.assign({},Ct));if(!C)throw new bt(Object.assign({},sn));if(typeof C.index!="number")throw new bt(Object.assign({},Jt));const P=function(){const de=document.createElement("video");return de.autoplay=!0,de.muted=!0,de.setAttribute("playsinline",""),de.setAttribute("webkit-playsinline",""),de}(),B=b.getVideoTracks(),[J]=B;if(!B.length)throw new bt(Object.assign({},Ue));const te=J.getConstraints(),z=B_({},te,{frameRate:this.config.streamConfig.maxFramerate});try{yield J.applyConstraints(z)}catch(de){let ke="Unknown constraints error";de instanceof Error&&(ke=de.message),this.analyticsTracker.trackEvent(new Dg({description:`${Tt.message}: ${ke}`,isFatal:!1,code:Tt.code}))}const re=()=>Nc(this,void 0,void 0,function*(){let de=0;for(;de<5;)try{return void(yield P.play())}catch(ke){if(!(ke instanceof Error))throw new Error("unknown error trying to add video to broadcast");de++,yield new Promise(Qe=>setTimeout(Qe,150))}throw new Error("Error playing video, tries exceeded")}),ce=new MediaStream([J]);P.srcObject=ce;try{yield re();const de={name:S,element:P,position:C,source:ce,render:!0},ke=((O=J.getSettings)===null||O===void 0?void 0:O.call(J))||{};this.analyticsTracker.trackEvent(new Lg(Mt(ke),ke)),this.mixer.video.push(de)}catch(de){throw new bt(Object.assign(Object.assign({},Ue),{cause:de}))}})}addImageSource(b,S,C){var O;return Nc(this,void 0,void 0,function*(){if(!b)throw new bt(Object.assign({},st));if(!S||typeof S!="string")throw new bt(Object.assign({},Le));if(b.tagName==="image")throw new bt(Object.assign({},it));if(this.mixer.video.some(B=>B.name===S))throw new bt(Object.assign({},Ct));if(!C)throw new bt(Object.assign({},sn));if(typeof C.index!="number")throw new bt(Object.assign({},Jt));if(b instanceof Image){const B=(O=b.src)===null||O===void 0?void 0:O.slice();try{const J=b.src?new URL(b.src):{};if(J.host&&J.hostname){const te=yield fetch(b.src).then(re=>Nc(this,void 0,void 0,function*(){return re.blob()})),z=yield new Promise(re=>{const ce=new FileReader;ce.onload=()=>{re(ce.result)},ce.readAsDataURL(te)});b.src=z}}catch{throw new bt(Object.assign(Object.assign({},tn),{params:{details:`Image URL: ${B}`}}))}}const P={name:S,element:b,position:C,render:!0};this.mixer.video.push(P)})}addAudioInputDevice(b,S){return Nc(this,void 0,void 0,function*(){if(typeof b!="object")throw new bt(Object.assign({},st));if(!S||typeof S!="string")throw new bt(Object.assign({},Le));if(this.mixer.audio.some(J=>J.name===S))throw new bt(Object.assign({},Ct));const C=b.getAudioTracks();if(!C.length)throw new bt(Object.assign({},Dt));const O=this.audioContext.createMediaStreamSource(new MediaStream(C)),P=this.audioContext.createGain();P.gain.value=1,O.connect(P),P.connect(this.audioDestination);const B={name:S,source:b,audioTrackSource:O,gainNode:P};this.analyticsTracker.trackEvent(new Lg("audio",{deviceId:b.id})),this.mixer.audio.push(B)})}removeImage(b){const S=this.mixer.video.findIndex(C=>C.name===b);if(S<0)throw new bt(Object.assign({},Pn));this.mixer.video.splice(S,1)}removeVideoInputDevice(b){var S;const C=this.removeDevice(b,this.mixer.video);if(!C)throw new bt(Object.assign({},wt));{const O=nn(C.source.getTracks(),Gt.VIDEO);if(!O)throw new bt(Object.assign({},wt));C.element.srcObject=null,O.stop();const P=((S=O==null?void 0:O.getSettings)===null||S===void 0?void 0:S.call(O))||{};this.analyticsTracker.trackEvent(new zp(Mt(P),P))}}removeAudioInputDevice(b){const S=this.removeDevice(b,this.mixer.audio);if(S!=null&&S.audioTrackSource){for(const C of S.source.getTracks())C.stop(),this.analyticsTracker.trackEvent(new zp("audio",{deviceId:C.id}));S.gainNode.disconnect(this.audioDestination)}else if(!S)throw new bt(Object.assign({},wt))}updateVideoDeviceComposition(b,S){if(!b||typeof b!="string")throw new bt(Object.assign({},zn));if(!S)throw new bt(Object.assign({},Yr));if(typeof S.index!="number")throw new bt(Object.assign({},cr));this.mixer.video.forEach((C,O)=>{C.name===b&&(C.position=S)})}exchangeVideoDevicePositions(b,S){const C=this.getVideoInputDevice(b),O=this.getVideoInputDevice(S);if(!C)throw new bt(Object.assign(Object.assign({},dn),{params:{details:`device with name: "${b}" not found`}}));if(!O)throw new bt(Object.assign(Object.assign({},dn),{params:{details:`device with name: "${S}" not found`}}));const P=Object.assign({},C.position),B=Object.assign({},O.position);for(const J of this.mixer.video)J.name===b&&(ff(B.x)?J.position=Object.assign(Object.assign({},J.position),B):J.position={index:B.index}),J.name===S&&(ff(P.x)?J.position=Object.assign(Object.assign({},J.position),P):J.position={index:P.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:ad.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:ad.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var b;return((b=this.mediaStreamManager.getTrack(Gt.VIDEO))===null||b===void 0?void 0:b.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach(b=>{b.render=!1})}enableVideo(){this.mixer.video.forEach(b=>{b.render=!0})}disableAudio(){this.mixer.audio.forEach(b=>{b.audioTrackSource&&(b.gainNode.gain.value=0)})}enableAudio(){this.mixer.audio.forEach(b=>{b.audioTrackSource&&(b.gainNode.gain.value=1)})}getDrawRegion(b,S,C){var O,P,B,J;let te=(O=b.position.x)!==null&&O!==void 0?O:0,z=(P=b.position.y)!==null&&P!==void 0?P:0;const re=(B=b.position.width)!==null&&B!==void 0?B:S-te,ce=(J=b.position.height)!==null&&J!==void 0?J:C-z,de=re/ce;let ke=b.element.width,Qe=b.element.height;b.element instanceof HTMLVideoElement&&(ke=b.element.videoWidth,Qe=b.element.videoHeight);const Be=ke/Qe;let Me=re,Te=ce;return Be>de?(Me=re,Te=2*Math.round(re/Be/2),z+=(ce-Te)/2):Be<de&&(Te=ce,Me=2*Math.round(ce*Be/2),te+=(re-Me)/2),{x:te,y:z,width:Me,height:Te}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const b=this.mixer.video.filter(S=>S.render);b.sort((S,C)=>S.position.index-C.position.index);for(const S of b){const{x:C,y:O,width:P,height:B}=this.getDrawRegion(S,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(S.element,C,O,P,B)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(Gt.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(b,S){const C=S.findIndex(O=>(P=>P.name===b)(O));if(!(C<0))return S.splice(C,1)[0]}shouldMix(b){if(b.getTime()<this.nextMix)return!1;for(;this.nextMix<=b.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function ff(x){return Number.isSafeInteger(x)}var Xp,Jp,Su=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})},j_=function(x,b,S,C){if(S==="a"&&!C)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!C:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?C:S==="a"?C.call(x):C?C.value:b.get(x)};class sl{constructor(b){this.config=b,Xp.add(this),this.emitter=new uc,this.isValid=!0,this.emitter.on(Ms.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new rd,this.mediaStreamManager=new zr;const S=new Jd(b.logLevel,b.logger);this.peerClient=new Yp(this.config,this.emitter,this.mediaStreamManager,S,this.analyticsTracker),this.broadcastCanvasManager=new Pc(b,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new id(this.peerClient,this.broadcastCanvasManager,S,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(sl.prototype).forEach(C=>{this[C]=new Proxy(this[C],{apply:(O,P,B)=>{if(!P.isValid)throw new bt(Object.assign({},cf));return Reflect.apply(O,P,B)}})}),window.addEventListener("beforeunload",()=>{this.analyticsTracker.stop(!0)})}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(b,S){return Su(this,void 0,void 0,function*(){j_(this,Xp,"m",Jp).call(this,b);const C=Fl(S||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(C,b),this.emitter.emit(Ms.ACTIVE_STATE_CHANGE,!0),this.url=new URL(C),this.url&&this.analyticsTracker.trackEvent(new dc({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},nl.USER_INITIATED))})}stopBroadcast(){var b,S,C;this.url&&this.analyticsTracker.trackEvent(new U_({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(b=this.peerStatsTracker)===null||b===void 0||b.stop(),(S=this.peerClient)===null||S===void 0||S.stop(),(C=this.emitter)===null||C===void 0||C.emit(Ms.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(b,S,C){return Su(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addVideoInputDevice(b,S,C)})}addImageSource(b,S,C){return Su(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addImageSource(b,S,C)})}addAudioInputDevice(b,S){return Su(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addAudioInputDevice(b,S)})}removeVideoInputDevice(b){this.broadcastCanvasManager.removeVideoInputDevice(b)}removeAudioInputDevice(b){this.broadcastCanvasManager.removeAudioInputDevice(b)}removeImage(b){this.broadcastCanvasManager.removeImage(b)}updateVideoDeviceComposition(b,S){this.broadcastCanvasManager.updateVideoDeviceComposition(b,S)}exchangeVideoDevicePositions(b,S){this.broadcastCanvasManager.exchangeVideoDevicePositions(b,S)}getAudioInputDevice(b){return this.broadcastCanvasManager.getAudioInputDevice(b)}getVideoInputDevice(b){return this.broadcastCanvasManager.getVideoInputDevice(b)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(b,S){this.emitter.on(b,S)}off(b,S){this.emitter.off(b,S)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(b){this.broadcastCanvasManager.attachPreview(b)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function pc(x){return new sl(function(b){const S=new Ki;return S.streamConfig=b.streamConfig,S.ingestEndpoint=b.ingestEndpoint,S.logger=b.logger,S.logLevel=b.logLevel,S.networkReconnectConfig=b.networkReconnectConfig,S}(x))}Xp=new WeakSet,Jp=function(x){if(typeof x!="string"||!/^[a-zA-Z0-9_-]+$/.test(x))throw new bt(pt)};const th="1.19.0";var Yt,ss=i(6486);(function(x){x.PUBLISH="publish",x.SUBSCRIBE="subscribe",x.JOIN="join",x.LEAVE="leave"})(Yt||(Yt={}));const Uy=2;class Qp extends gr{constructor(b){super(vn.LEAVE,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.LEAVE,event_endpoint:b.eventEndpoint,whip_endpoint:b.whipEndpoint,reason:b.reason}),this.critical=!0}}class lo{constructor(){this.emitter=new uc}on(b,S,C){S.call=function(O,P){return function(B,...J){try{P.apply(B,J)}catch(te){let z=`Error in callback for ${O}`;const re=P.name;return re&&(z+=` for function ${re}`),void console.error(`${z}
`,te)}}}(b,S),this.emitter.on(b,S,C)}off(b,S,C){this.emitter.off(b,S,C)}emit(b,...S){this.emitter.emit(b,...S)}removeAllListeners(){this.emitter.removeAllListeners()}}function Zp(x){const b="0123456789abcdef";let S="";for(let C=0;C<x;C+=1)S+=b.charAt(Math.floor(Math.random()*b.length));return S}class em{constructor(){const b=Zp;this.value=`${b(8)}-${b(4)}-${b(4)}-${b(4)}-${b(12)}`}}function Js(){return new em}class pf{constructor(){const b=(Date.now()/1e3|0).toString(16);this.value=`1-${b}-${Zp(24)}`}}function Qs(){return new pf}var oi=i(9669),hs=i.n(oi);class Qn extends bt{constructor({token:b,traceId:S,code:C,tag:O,location:P,message:B,details:J,remoteParticipantId:te,requestUUID:z,fatal:re,nominal:ce,action:de}){super({name:"StageClientError",message:B,code:C}),Error.captureStackTrace&&Error.captureStackTrace(this,Qn),this.action=de,this.token=b,this.traceId=S,this.code=C,this.tag=O,this.location=P,this.message=B,this.details=J,this.remoteParticipantId=te,this.requestUUID=z,this.fatal=re,this.nominal=ce}}const mc={JOIN_RELATED:"signalling_session",PUBLISH_RELATED:"webrtc_sink",UNPUBLISH_RELATED:"webrtc_unsink",SUBSCRIBE_RELATED:"webrtc_source"};function uo(x,b){switch(x){case Yt.PUBLISH:return mc.PUBLISH_RELATED;case Yt.SUBSCRIBE:return`webrtc_source:${b}`;default:return"unknown"}}function Ai(x,b){var S,C,O,P;const B={code:x.code,message:`${x.message}: ${b.name} ${b.message}`,fatal:(S=x.fatal)!==null&&S!==void 0&&S,nominal:(C=x.nominal)!==null&&C!==void 0&&C};return b instanceof Qn&&(B.fatal=(O=b.fatal)!==null&&O!==void 0&&O,B.nominal=(P=b.nominal)!==null&&P!==void 0&&P),B}function nh(x,b){if(x===0)return Lt.UNKNOWN_SERVER_ERROR;if(!(x<400))if(x>=400&&x<=403)switch(b){case ho.TokenExpired:return Lt.EXPIRED_TOKEN;case ho.NoPermissions:return Lt.TOKEN_PERMISSIONS_DENIED;case ho.StageAtCapacity:return Lt.STAGE_AT_CAPACITY;case ho.NoMatchingCodec:return Lt.NO_MATCHING_CODEC;default:return Lt.UNKNOWN_SERVER_ERROR}else{if(x===404)return b===ho.RemoteStreamNotFound?Lt.REMOTE_STREAM_NOT_FOUND:Lt.UNKNOWN_SERVER_ERROR;if(x===412)return b===ho.AbortedMHCPError?Lt.MHCP_ABORTED:Lt.UNKNOWN_SERVER_ERROR;if(x===429)return b===ho.StageAuthThrottled?Lt.STAGE_AUTH_THROTTLED:Lt.WHIP_TOO_MANY_REQUESTS;if(x!==500)return Lt.UNKNOWN_SERVER_ERROR;switch(b){case ho.InternalMHCPError:return Lt.INTERNAL_MHCP_ERROR;case ho.UnreachableMHCP:return Lt.UNREACHABLE_MHCP;case ho.InvalidSessionStatus:return Lt.INVALID_SESSION_STATUS;default:return Lt.INTERNAL_SERVER_ERROR}}}var ho;(function(x){x[x.Unspecified=2001]="Unspecified",x[x.TokenExpired=2002]="TokenExpired",x[x.NoPermissions=2003]="NoPermissions",x[x.RemoteStreamNotFound=2004]="RemoteStreamNotFound",x[x.StageAtCapacity=2005]="StageAtCapacity",x[x.InternalMHCPError=2006]="InternalMHCPError",x[x.UncategorizedMHCPError=2007]="UncategorizedMHCPError",x[x.UnreachableMHCP=2008]="UnreachableMHCP",x[x.InvalidSessionStatus=2010]="InvalidSessionStatus",x[x.PostWithoutOptions=2011]="PostWithoutOptions",x[x.AbortedMHCPError=2012]="AbortedMHCPError",x[x.StageAuthThrottled=2013]="StageAuthThrottled",x[x.NoMatchingCodec=2014]="NoMatchingCodec"})(ho||(ho={}));const Lt={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},NO_CANDIDATES:{code:1022,message:"No ICE candidates",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNCATEGORIZED_MHCP_ERROR:{code:1029,message:"Authorization failed due to uncategorized MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},POST_WITHOUT_OPTIONS:{code:1032,message:"Cannot POST without OPTIONS in mandatory TURN",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},CHIME_MEETING_NOT_FOUND:{code:1098,message:"Meeting or Attendee was deleted",fatal:!0,nominal:!0},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message",fatal:!1,nominal:!1},WHIP_SESSION_RESOURCE_DELETED:{code:1206,message:"WHIP signaling session resource not found",fatal:!0,nominal:!0},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_OPTIONS_FAILURE:{code:1501,message:"Failed to get ICE Servers from OPTIONS",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PING_SEND_FAIL:{code:1303,message:"Ping send fail",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var Os;(function(x){x.UNPUBLISH="unpublish",x.UNSUBSCRIBE="unsubscribe",x.UNLOAD="unload",x.CONNECTION_FAIL="connection fail",x.REASSIGNMENT="reassignment"})(Os||(Os={}));const Go="stageJoined",gc="stageParticipantJoined",Pi="stageParticipantLeft",os="stageParticipantKicked",ks="stageParticipantUpdated",mf="localPublishingChanged",tm="stageRefresh",Tu="stateChange",Fy="error",$s="reassignmentRequest",cd="incompatibleCodecs",gf="connectionStateChange",me="stageStreamUpdate",Wo="error",Ha="stageStreamSeiMessageReceived",Hs="transformError",Mr="reassignmentStarted",ol="reassignmentSuccess",al="reassignmentFailed",cl="open",ll="closed",vc="messageParseError",jg="refresh",ul="error",$g="stageStateMessage",rh="sdpAnswer",nm="disconnectMessage",wu="reassignmentMessage",ld="incompatibleCodecs";function Hg(x){return S=function(C){return C.replace(/-/g,"+").replace(/_/g,"/").padEnd(C.length+(4-C.length%4)%4,"=")}(x),window.atob(S);var S}class vf{constructor(b,S){this.analyticsTracker=S,this.rawToken=b;const C=b.split(".");if(C.length!==3)throw Error(`Token format incorrect. length: ${C.length}`);try{this.header=JSON.parse(Hg(C[0]))}catch(B){const J=B instanceof Error?`: ${B.message}`:"";throw Error(`Error parsing Stage Token header${J}`)}try{this.claims=JSON.parse(Hg(C[1]))}catch(B){const J=B instanceof Error?`: ${B.message}`:"";throw Error(`Error parsing Stage Token claims${J}`)}this.signature=C[2];const{claims:O}=this;this.stageARN=O.resource,this.participantID=O.jti,this.eventsURL=O.events_url,this.whipURL=lf("whipUrl")||O.whip_url,this.userID=O.user_id,this.expirationTime=O.exp,this.topic=O.topic,this.parseVersionFlags(O.version);const{attributes:P}=O;P&&(this.attrGsRole=P.gs_role,this.attrGsSessionId=P.gs_session_id)}getPublishEndpoint(){let b="";return this.whipURL&&this.participantID&&(b=`${this.whipURL}/publish/${this.participantID}`),b}getSubscribeEndpoint(b){let S="";return this.whipURL&&(S=`${this.whipURL}/subscribe/${b}`),S}assertTokenIsUnexpired(b,S,C,O){(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new Qn(Object.assign(Object.assign({},Lt.EXPIRED_TOKEN),{action:Yt.JOIN,location:C,tag:S,token:this,traceId:b,remoteParticipantId:O,message:Lt.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(b){if(!b)return;const S=b.split(".");S.length===2&&(this.versionFlags=parseInt(S[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||(this.versionFlags&Uy)!=0}}function dl(x,b){return new vf(x,b)}class Vg{constructor(b,S){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=b,this.trailing=!(S&&S.skipTrailing)}invoke(b,...S){return this.throttled?(this.trailingFn=b,this.trailingFnArgs=S,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),b(...S),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}class xu extends gr{constructor(b,S,C,O,P,B,J,te){super(vn.SERVER_REQUEST,S,J,!0),Object.assign(this.properties,{action:b,http_method:O,remote_participant_id:B,request_uuid:P,url:C,transport:te})}}const qo="draft-ietf-wish-whip-04";var Ns,zg=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};function ih(x,b){return zg(this,void 0,void 0,function*(){x.validateStatus=C=>C>=200&&C<300||C===403;const S=yield hs()(x);if(S.status===403){if(S.data.code===2003)throw new oi.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",x,S.request,S);return x.url===S.request.responseURL?(x.validateStatus=C=>C>=200&&C<300,hs()(x)):(x.url=S.request.responseURL,b<5?ih(x,b+1):(x.validateStatus=C=>C>=200&&C<300,hs()(x)))}return S})}function ud(x){return zg(this,void 0,void 0,function*(){return ih(x,0)})}function rm(){}function By(x){switch(x){case"new":return nt.NEW;case"closed":return nt.CLOSED;case"disconnected":return nt.DISCONNECTED;case"failed":return nt.FAILED;case"idle":return nt.IDLE;case"checking":case"connecting":return nt.CONNECTING;case"completed":case"connected":return nt.CONNECTED;default:throw new Error(`unknown connecion state: ${x}`)}}function im(x,b,S){let C=document.createElement(b);const O=()=>{C&&(C.removeEventListener("loadeddata",P),C.removeEventListener("error",O),C.srcObject=null,C.src="",C=null)},P=()=>{O(),S(b)};return C.addEventListener("loadeddata",P),C.addEventListener("error",O),C.srcObject=x,O}class _f extends gr{constructor(b,S,C,O,P){super(vn.TRACE,b,S,!1),Object.assign(this.properties,{action:O,message:C,remote_participant_id:P})}}class fo extends gr{constructor(b,S,C,O,P){super(vn.CONNECTION_STATE,S,C,!1),Object.assign(this.properties,{action:b,remote_participant_id:P,state:O})}}class Gg extends gr{constructor(b,S,C,O,P){super(vn.ICE_GATHERING_STATE,S,C,!1),Object.assign(this.properties,{action:b,remote_participant_id:P,state:O})}}(function(x){x.POST="post",x.CONNECTED="connected",x.ICE_GATHERING="icegathering",x.SDP_EXCHANGE="sdpExchange",x.SET_REMOTE_DESC="setRemoteDesc",x.PEER_CONNECTION="peerConnection"})(Ns||(Ns={}));const Wg="start",Va="stop";class $_{constructor(b,S){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=b,this.traceId=S}markActionStart(){this.markStart(Ns.CONNECTED)}markPostStart(){this.markStart(Ns.POST)}markPostStop(){this.markStop(Ns.POST),this.postDuration=this.measure(Ns.POST)}markIceGatheringStart(){this.markStart(Ns.ICE_GATHERING)}markIceGatheringStop(){this.markStop(Ns.ICE_GATHERING),this.timeToCandidate=this.measure(Ns.ICE_GATHERING)}markActionStop(){this.markStop(Ns.CONNECTED),this.timeToConnected=this.measure(Ns.CONNECTED),this.markStop(Ns.PEER_CONNECTION),this.peerConnectionDuration=this.measure(Ns.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(Ns.SET_REMOTE_DESC)}markSetRemoteDescStop(){const b=Ns.SET_REMOTE_DESC;this.markStop(b),this.setRemoteDescDuration=this.measure(b),this.markStart(Ns.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(Ns.SDP_EXCHANGE)}markSdpExchangeStop(){const b=Ns.SDP_EXCHANGE;this.markStop(b),this.sdpExchangeDuration=this.measure(b)}setTransport(b){this.sdpExchangeTransport=b}markStart(b){this.marks[`${this.namespace}.${b}.${Wg}`]=performance.now()}markStop(b){this.marks[`${this.namespace}.${b}.${Va}`]=performance.now()}measure(b){const S=`${this.namespace}.${b}.${Wg}`,C=`${this.namespace}.${b}.${Va}`,O=this.marks[S],P=this.marks[C];return O===void 0||P===void 0?0:P-O}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:b,postDuration:S,timeToCandidate:C,timeToConnected:O,sdpExchangeDuration:P,sdpExchangeTransport:B,setRemoteDescDuration:J,peerConnectionDuration:te}=this;return{optionsDuration:b,postDuration:S,timeToCandidate:C,timeToConnected:O,sdpExchangeDuration:P,sdpExchangeTransport:B,setRemoteDescDuration:J,peerConnectionDuration:te}}resetMeasurements(b){this.traceId=b,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var Wl,fs,Cu;(function(x){x.VIDEO="video",x.AUDIO="audio"})(Wl||(Wl={})),function(x){x.DEFAULT="default",x.LOW="low",x.MEDIUM="medium",x.HIGH="high"}(fs||(fs={})),function(x){x.LOWEST_QUALITY="lowest_quality",x.HIGHEST_QUALITY="highest_quality"}(Cu||(Cu={}));var Vs=i(766);class Mi{constructor(b){this.sdp=b}static splitLines(b){return b.trim().split(`
`).map(S=>S.trim())}static splitSections(b){return b.split(`
m=`).map((S,C)=>(C>0?`m=${S}`:S).trim()+Mi.CRLF)}getUniqueRtpHeaderExtensionId(b){const S=[];for(const O of b)if(/^a=extmap:/.test(O.trim())){const P=+O.split("a=extmap:")[1].split(" ")[0];S.includes(P)||S.push(P)}S.sort((O,P)=>O-P);let C=0;for(const O of S){if(O-C>1)return C+1;C=O}return C===14?-1:C+1}withVideoLayersAllocationRtpHeaderExtension(b){const S="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",C=b?b.getRtpHeaderExtensionId(S):-1,O=C===-1?this.getUniqueRtpHeaderExtensionId(Mi.splitLines(this.sdp)):C,P=Mi.splitSections(this.sdp),B=[];for(let te of P){if(/^m=video/.test(te)&&Mi.getRtpHeaderExtensionIdInSection(te,S)===-1){const z=Mi.splitLines(te),re=[];if(O===-1||this.hasRtpHeaderExtensionId(O)){B.push(te);continue}for(const ce of z)if(re.push(ce),/^a=sendrecv/.test(ce.trim())){const de=`a=extmap:${O} ${S}`;re.push(de)}te=re.join(Mi.CRLF)+Mi.CRLF}else if(C!==-1&&/^m=video/.test(te)&&Mi.getRtpHeaderExtensionIdInSection(te,S)!==C){const z=Mi.splitLines(te),re=[];for(const ce of z){if(/^a=extmap:/.test(ce.trim())&&ce.split("a=extmap:")[1].split(" ")[1]===S){if(!this.hasRtpHeaderExtensionId(C)){const de=`a=extmap:${C} ${S}`;re.push(de)}continue}re.push(ce)}te=re.join(Mi.CRLF)+Mi.CRLF}B.push(te)}const J=B.join("");return new Mi(J)}withOpusAudioConfig(b,S){const C=Vs.Qc(this.sdp);for(const O of C.media)if(O.type==="audio"){const{payload:P}=O.rtp.find(z=>z.codec==="opus");if(!P)continue;let B=O.fmtp.find(z=>z.payload===P);B||(B={payload:P,config:""});const J=Vs.rz(B.config);if(J.maxaveragebitrate=b,typeof S=="boolean"){const z=S?1:0;J["sprop-stereo"]=z,J.stereo=z}let te="";for(const z of Object.keys(J))te+=`${z}=${J[z]}; `;B.config=te.trim()}return new Mi(Vs.cW(C))}static getRtpHeaderExtensionIdInSection(b,S){const C=Mi.splitLines(b);for(const O of C)if(/^a=extmap:/.test(O.trim())){const P=O.split("a=extmap:")[1].split(" "),B=+P[0];if(P[1]===S)return B}return-1}getRtpHeaderExtensionId(b){const S=Mi.splitSections(this.sdp);for(const C of S)if(/^m=video/.test(C)){const O=Mi.getRtpHeaderExtensionIdInSection(C,b);if(O!==-1)return O}return-1}hasRtpHeaderExtensionId(b){const S=Mi.splitLines(this.sdp);for(const C of S)if(/^a=extmap:/.test(C.trim())&&+C.split("a=extmap:")[1].split(" ")[0]===b)return!0;return!1}hasAudioNacksEnabled(){var b,S,C;return((C=(S=((b=Vs.Qc(this.sdp).media.filter(O=>O.type==="audio")[0])!==null&&b!==void 0?b:{}).rtcpFb)===null||S===void 0?void 0:S.filter(O=>O.type==="nack"))!==null&&C!==void 0?C:[]).length>0}}Mi.CRLF=`\r
`,Mi.rfc7587LowestBitrate=6e3,Mi.rfc7587HighestBitrate=51e4;const yf=200,sh=2500,qg=10,ql=30,sm=12,Ao=128,Kg={[fs.DEFAULT]:0,[fs.LOW]:50,[fs.MEDIUM]:150,[fs.HIGH]:250},bf={[fs.DEFAULT]:0,[fs.LOW]:100,[fs.MEDIUM]:200,[fs.HIGH]:300},Ef=()=>({minBitrate:yf,maxBitrate:sh,maxFramerate:ql,simulcast:{enabled:!1},maxAudioBitrateKbps:64,stereo:!1});var Sf=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};const om="H264",am=x=>{const b=x==null?void 0:x.split("/");if((b==null?void 0:b.length)===2)return b[1]},pa=(x,b)=>{const S=am(x);if(x===void 0||S===void 0)return;const C={mimeSubtype:S};if(b){const O=(P=>{const B=P.split(";"),J=new Map;for(const te of B){const[z,re]=te.split("=");J.set(z,re)}return J})(b);switch(S){case om:{const P=O.get("profile-level-id");P&&((B,J)=>{if(J.length<6)return;const te=J.substring(0,4),z=parseInt(J.substring(4,6),16);B.profile=te,B.level=z})(C,P);break}case"H265":((P,B)=>{const J=B.get("profile-id")||"0",te=B.get("tier-flag")||"0",z=parseInt(B.get("level-id")||"0",10),re=[te,J].join("_");P.profile=re,P.level=z})(C,O)}}return C},po=(x,b)=>x.sort((S,C)=>{if(am(S.mimeType)===om){const O=pa(S.mimeType,S.sdpFmtpLine);if((O==null?void 0:O.profile)===b)return-1}return 0}),H_=(x,b)=>{var S;const C=pa(x.mimeType,x.sdpFmtpLine);return(C==null?void 0:C.mimeSubtype.toLowerCase())===b.mime.toLowerCase()&&((S=C==null?void 0:C.profile)===null||S===void 0?void 0:S.toLowerCase().indexOf(b.config.toLowerCase()))===0},Yg=(x,b)=>b.filter(S=>!S.mimeType.endsWith("rtx")).filter(S=>S.mimeType.indexOf("packetization-mode=0")===-1).find(S=>x.reduce((C,O)=>C&&H_(S,O)===!1,!0));class za extends gr{constructor(b,S,C,O,P,B,J,te,z){var re,ce;super(vn.PUBLISHED_VIDEO_STATS,b,S,!1),Object.assign(this.properties,Object.assign({action:Yt.PUBLISH,node:(re=C==null?void 0:C.node)!==null&&re!==void 0?re:"",cluster:(ce=C==null?void 0:C.cluster)!==null&&ce!==void 0?ce:""},((de,ke,Qe,Be,Me,Te)=>{var gt,Ut,en,Pt,Hn,Ln,Or,Ur,Fr,Br,vr,kr,Nr,Pr,jr,er,Sn,qn,vi,Xi,Ji,ys,cs,ls,Qi,Li,us,Gs,Zi,ba,ta;const Tc=(Ut=(gt=de==null?void 0:de.qualityLimitationDurations)===null||gt===void 0?void 0:gt.cpu)!==null&&Ut!==void 0?Ut:0,wc=(Pt=(en=de==null?void 0:de.qualityLimitationDurations)===null||en===void 0?void 0:en.bandwidth)!==null&&Pt!==void 0?Pt:0,Ea=Math.max((Hn=de==null?void 0:de.bytesSent)!==null&&Hn!==void 0?Hn:0,0),ml=8*Ea/(Te??1),qa=Math.max((Ln=ke==null?void 0:ke.packetsLost)!==null&&Ln!==void 0?Ln:0,0),Uc=Math.max((Or=de==null?void 0:de.packetsSent)!==null&&Or!==void 0?Or:0,0),gl=qa/Math.max(Uc,1),Ka=pa(Be==null?void 0:Be.mimeType,Be==null?void 0:Be.sdpFmtpLine);return{active:!!(de!=null&&de.framesPerSecond)&&de.framesPerSecond!==0,bytes_sent:Ea,codec_mime_type:Ka==null?void 0:Ka.mimeSubtype,codec_profile:Ka==null?void 0:Ka.profile,codec_level:Ka==null?void 0:Ka.level,configured_bitrate:Me==null?void 0:Me.max_bitrate,connection_bandwidth:(Ur=Qe==null?void 0:Qe.availableOutgoingBitrate)!==null&&Ur!==void 0?Ur:0,encode_bitrate:ml,encoder_implementation:(Fr=de==null?void 0:de.encoderImplementation)!==null&&Fr!==void 0?Fr:"unknown",fir_count:(Br=de==null?void 0:de.firCount)!==null&&Br!==void 0?Br:0,fraction_packets_lost:gl,frame_height:Math.max((vr=de==null?void 0:de.frameHeight)!==null&&vr!==void 0?vr:0,0),frame_width:Math.max((kr=de==null?void 0:de.frameWidth)!==null&&kr!==void 0?kr:0,0),frames_encoded:(Nr=de==null?void 0:de.framesEncoded)!==null&&Nr!==void 0?Nr:0,frames_per_second:Math.max((Pr=de==null?void 0:de.framesPerSecond)!==null&&Pr!==void 0?Pr:0,0),frames_sent:(jr=de==null?void 0:de.framesSent)!==null&&jr!==void 0?jr:0,header_bytes_sent:(er=de==null?void 0:de.headerBytesSent)!==null&&er!==void 0?er:0,huge_frames_sent:(Sn=de==null?void 0:de.hugeFramesSent)!==null&&Sn!==void 0?Sn:0,key_frames_encoded:(qn=de==null?void 0:de.keyFramesEncoded)!==null&&qn!==void 0?qn:0,nack_count:(vi=de==null?void 0:de.nackCount)!==null&&vi!==void 0?vi:0,packets_lost:qa,packets_sent:Uc,power_efficient_encoder:(Xi=de==null?void 0:de.powerEfficientEncoder)!==null&&Xi!==void 0&&Xi,pli_count:(Ji=de==null?void 0:de.pliCount)!==null&&Ji!==void 0?Ji:0,quality_limitation_reason:(ys=de==null?void 0:de.qualityLimitationReason)!==null&&ys!==void 0?ys:"none",quality_limitation_resolution_changes:(cs=de==null?void 0:de.qualityLimitationResolutionChanges)!==null&&cs!==void 0?cs:0,quality_limitation_cpu_duration:Tc,quality_limitation_bandwidth_duration:wc,retransmitted_bytes_sent:(ls=de==null?void 0:de.retransmittedBytesSent)!==null&&ls!==void 0?ls:0,retransmitted_packets_sent:(Qi=de==null?void 0:de.retransmittedPacketsSent)!==null&&Qi!==void 0?Qi:0,rid:(Li=de==null?void 0:de.rid)!==null&&Li!==void 0?Li:"no-rid",scalability_mode:(us=de==null?void 0:de.scalabilityMode)!==null&&us!==void 0?us:"unknown",target_bitrate:Math.max((Gs=de==null?void 0:de.targetBitrate)!==null&&Gs!==void 0?Gs:0,0),total_encode_time:(Zi=de==null?void 0:de.totalEncodeTime)!==null&&Zi!==void 0?Zi:0,total_encoded_bytes_target:(ba=de==null?void 0:de.totalEncodedBytesTarget)!==null&&ba!==void 0?ba:0,total_packet_send_delay:(ta=de==null?void 0:de.totalPacketSendDelay)!==null&&ta!==void 0?ta:0}})(O,P,B,J,te,z)))}}class Ko extends gr{constructor(b,S,C,O,P,B,J,te,z,re){var ce,de,ke,Qe;super(vn.PUBLISHED_VIDEO_STATS_WINDOW,b,S,!1);const Be=Math.max(((ce=O==null?void 0:O.timestamp)!==null&&ce!==void 0?ce:0)-((de=P==null?void 0:P.timestamp)!==null&&de!==void 0?de:0),0);Object.assign(this.properties,Object.assign({action:Yt.PUBLISH,node:(ke=C==null?void 0:C.node)!==null&&ke!==void 0?ke:"",cluster:(Qe=C==null?void 0:C.cluster)!==null&&Qe!==void 0?Qe:"",window_size_ms:Be},((Me,Te,gt,Ut,en,Pt,Hn,Ln)=>{var Or,Ur,Fr,Br,vr,kr,Nr,Pr,jr,er,Sn,qn,vi,Xi,Ji,ys,cs,ls,Qi,Li,us,Gs,Zi,ba,ta,Tc,wc,Ea,ml,qa,Uc,gl,Ka,Ql,yh,Nu,Ps,Pu,_d,yd,Du,Zl,bd,Ed,lv,xm,uv,dv,Cm,Rm,Z_,e0;const t0=(Ur=(Or=Me==null?void 0:Me.qualityLimitationDurations)===null||Or===void 0?void 0:Or.cpu)!==null&&Ur!==void 0?Ur:0,Wy=(Br=(Fr=Te==null?void 0:Te.qualityLimitationDurations)===null||Fr===void 0?void 0:Fr.cpu)!==null&&Br!==void 0?Br:0,n0=(kr=(vr=Me==null?void 0:Me.qualityLimitationDurations)===null||vr===void 0?void 0:vr.bandwidth)!==null&&kr!==void 0?kr:0,Bf=(Pr=(Nr=Te==null?void 0:Te.qualityLimitationDurations)===null||Nr===void 0?void 0:Nr.bandwidth)!==null&&Pr!==void 0?Pr:0,qy=Math.max(((jr=Me==null?void 0:Me.bytesSent)!==null&&jr!==void 0?jr:0)-((er=Te==null?void 0:Te.bytesSent)!==null&&er!==void 0?er:0),0),Ky=8*qy/(typeof Ln!="number"?1:Ln/1e3),v=Math.max(((Sn=gt==null?void 0:gt.packetsLost)!==null&&Sn!==void 0?Sn:0)-((qn=Ut==null?void 0:Ut.packetsLost)!==null&&qn!==void 0?qn:0),0),T=Math.max(((vi=Me==null?void 0:Me.packetsSent)!==null&&vi!==void 0?vi:0)-((Xi=Te==null?void 0:Te.packetsSent)!==null&&Xi!==void 0?Xi:0),0),D=v/Math.max(T,1),Y=pa(Pt==null?void 0:Pt.mimeType,Pt==null?void 0:Pt.sdpFmtpLine);return{active:!!(Me!=null&&Me.framesPerSecond)&&(Me==null?void 0:Me.framesPerSecond)!==0,bytes_sent:qy,codec_mime_type:Y==null?void 0:Y.mimeSubtype,codec_profile:Y==null?void 0:Y.profile,codec_level:Y==null?void 0:Y.level,configured_bitrate:Hn==null?void 0:Hn.max_bitrate,connection_bandwidth:(Ji=en==null?void 0:en.availableOutgoingBitrate)!==null&&Ji!==void 0?Ji:0,encode_bitrate:Ky,encoder_implementation:(ys=Me==null?void 0:Me.encoderImplementation)!==null&&ys!==void 0?ys:"unknown",fir_count:Math.max(((cs=Me==null?void 0:Me.firCount)!==null&&cs!==void 0?cs:0)-((ls=Te==null?void 0:Te.firCount)!==null&&ls!==void 0?ls:0),0),fraction_packets_lost:D,frame_height:Math.max((Qi=Me==null?void 0:Me.frameHeight)!==null&&Qi!==void 0?Qi:0,0),frame_width:Math.max((Li=Me==null?void 0:Me.frameWidth)!==null&&Li!==void 0?Li:0,0),frames_encoded:Math.max(((us=Me==null?void 0:Me.framesEncoded)!==null&&us!==void 0?us:0)-((Gs=Te==null?void 0:Te.framesEncoded)!==null&&Gs!==void 0?Gs:0),0),frames_per_second:Math.max((Zi=Me==null?void 0:Me.framesPerSecond)!==null&&Zi!==void 0?Zi:0,0),frames_sent:Math.max(((ba=Me==null?void 0:Me.framesSent)!==null&&ba!==void 0?ba:0)-((ta=Te==null?void 0:Te.framesSent)!==null&&ta!==void 0?ta:0),0),header_bytes_sent:Math.max(((Tc=Me==null?void 0:Me.headerBytesSent)!==null&&Tc!==void 0?Tc:0)-((wc=Te==null?void 0:Te.headerBytesSent)!==null&&wc!==void 0?wc:0),0),huge_frames_sent:Math.max(((Ea=Me==null?void 0:Me.hugeFramesSent)!==null&&Ea!==void 0?Ea:0)-((ml=Te==null?void 0:Te.hugeFramesSent)!==null&&ml!==void 0?ml:0),0),key_frames_encoded:Math.max(((qa=Me==null?void 0:Me.keyFramesEncoded)!==null&&qa!==void 0?qa:0)-((Uc=Te==null?void 0:Te.keyFramesEncoded)!==null&&Uc!==void 0?Uc:0),0),nack_count:Math.max(((gl=Me==null?void 0:Me.nackCount)!==null&&gl!==void 0?gl:0)-((Ka=Te==null?void 0:Te.nackCount)!==null&&Ka!==void 0?Ka:0),0),packets_lost:v,packets_sent:T,power_efficient_encoder:(Ql=Me==null?void 0:Me.powerEfficientEncoder)!==null&&Ql!==void 0&&Ql,pli_count:Math.max(((yh=Me==null?void 0:Me.pliCount)!==null&&yh!==void 0?yh:0)-((Nu=Te==null?void 0:Te.pliCount)!==null&&Nu!==void 0?Nu:0),0),quality_limitation_reason:(Ps=Me==null?void 0:Me.qualityLimitationReason)!==null&&Ps!==void 0?Ps:"none",quality_limitation_resolution_changes:Math.max(((Pu=Me==null?void 0:Me.qualityLimitationResolutionChanges)!==null&&Pu!==void 0?Pu:0)-((_d=Te==null?void 0:Te.qualityLimitationResolutionChanges)!==null&&_d!==void 0?_d:0),0),quality_limitation_cpu_duration:Math.max(t0-Wy,0),quality_limitation_bandwidth_duration:Math.max(n0-Bf,0),retransmitted_bytes_sent:Math.max(((yd=Me==null?void 0:Me.retransmittedBytesSent)!==null&&yd!==void 0?yd:0)-((Du=Te==null?void 0:Te.retransmittedBytesSent)!==null&&Du!==void 0?Du:0),0),rid:(Zl=Me==null?void 0:Me.rid)!==null&&Zl!==void 0?Zl:"no-rid",retransmitted_packets_sent:Math.max(((bd=Me==null?void 0:Me.retransmittedPacketsSent)!==null&&bd!==void 0?bd:0)-((Ed=Te==null?void 0:Te.retransmittedPacketsSent)!==null&&Ed!==void 0?Ed:0),0),scalability_mode:(lv=Me==null?void 0:Me.scalabilityMode)!==null&&lv!==void 0?lv:"unknown",target_bitrate:Math.max((xm=Me==null?void 0:Me.targetBitrate)!==null&&xm!==void 0?xm:0,0),total_encode_time:Math.max(((uv=Me==null?void 0:Me.totalEncodeTime)!==null&&uv!==void 0?uv:0)-((dv=Te==null?void 0:Te.totalEncodeTime)!==null&&dv!==void 0?dv:0),0),total_encoded_bytes_target:Math.max(((Cm=Me==null?void 0:Me.totalEncodedBytesTarget)!==null&&Cm!==void 0?Cm:0)-((Rm=Te==null?void 0:Te.totalEncodedBytesTarget)!==null&&Rm!==void 0?Rm:0),0),total_packet_send_delay:Math.max(((Z_=Me==null?void 0:Me.totalPacketSendDelay)!==null&&Z_!==void 0?Z_:0)-((e0=Te==null?void 0:Te.totalPacketSendDelay)!==null&&e0!==void 0?e0:0),0)}})(O,P,B,J,te,z,re,Be)))}}class V_ extends gr{constructor(b,S,C,O,P,B,J,te,z,re){var ce,de;super(vn.PUBLISHED_AUDIO_STATS,b,S,!1),Object.assign(this.properties,Object.assign({action:Yt.PUBLISH,node:(ce=C==null?void 0:C.node)!==null&&ce!==void 0?ce:"",cluster:(de=C==null?void 0:C.cluster)!==null&&de!==void 0?de:""},((ke,Qe,Be,Me,Te,gt,Ut)=>{var en,Pt,Hn,Ln,Or,Ur,Fr,Br,vr,kr,Nr;const Pr=Math.max((en=ke==null?void 0:ke.bytesSent)!==null&&en!==void 0?en:0,0),jr=8*Pr/(gt??1),er=Math.max((Pt=Qe==null?void 0:Qe.packetsLost)!==null&&Pt!==void 0?Pt:0,0),Sn=Math.max((Hn=ke==null?void 0:ke.packetsSent)!==null&&Hn!==void 0?Hn:0,0),qn=er/Math.max(Sn,1),vi=pa(Me==null?void 0:Me.mimeType,Me==null?void 0:Me.sdpFmtpLine);return{audio_nacks_enabled:(Ln=Ut==null?void 0:Ut.audioNacks)!==null&&Ln!==void 0&&Ln,bytes_sent:Pr,codec_mime_type:vi==null?void 0:vi.mimeSubtype,configured_bitrate:(Or=Te==null?void 0:Te.max_audio_bitrate_bps)!==null&&Or!==void 0?Or:0,connection_bandwidth:(Ur=Be==null?void 0:Be.availableOutgoingBitrate)!==null&&Ur!==void 0?Ur:0,encode_bitrate:jr,fraction_packets_lost:qn,header_bytes_sent:(Fr=ke==null?void 0:ke.headerBytesSent)!==null&&Fr!==void 0?Fr:0,nack_count:(Br=ke==null?void 0:ke.nackCount)!==null&&Br!==void 0?Br:0,packets_lost:er,packets_sent:Sn,retransmitted_bytes_sent:(vr=ke==null?void 0:ke.retransmittedBytesSent)!==null&&vr!==void 0?vr:0,retransmitted_packets_sent:(kr=ke==null?void 0:ke.retransmittedPacketsSent)!==null&&kr!==void 0?kr:0,target_bitrate:(Nr=ke==null?void 0:ke.targetBitrate)!==null&&Nr!==void 0?Nr:0}})(O,P,B,J,te,z,re)))}}class Xg extends gr{constructor(b,S,C,O,P,B,J,te,z,re,ce){var de,ke,Qe,Be;super(vn.PUBLISHED_AUDIO_STATS_WINDOW,b,S,!1);const Me=Math.max(((de=O==null?void 0:O.timestamp)!==null&&de!==void 0?de:0)-((ke=P==null?void 0:P.timestamp)!==null&&ke!==void 0?ke:0),0);Object.assign(this.properties,Object.assign({action:Yt.PUBLISH,node:(Qe=C==null?void 0:C.node)!==null&&Qe!==void 0?Qe:"",cluster:(Be=C==null?void 0:C.cluster)!==null&&Be!==void 0?Be:"",window_size_ms:Me},((Te,gt,Ut,en,Pt,Hn,Ln,Or,Ur)=>{var Fr,Br,vr,kr,Nr,Pr,jr,er,Sn,qn,vi,Xi,Ji,ys,cs,ls,Qi,Li,us,Gs;const Zi=Math.max(((Fr=Te==null?void 0:Te.bytesSent)!==null&&Fr!==void 0?Fr:0)-((Br=gt==null?void 0:gt.bytesSent)!==null&&Br!==void 0?Br:0),0),ba=8*Zi/(typeof Or!="number"?1:Or/1e3),ta=Math.max(((vr=Ut==null?void 0:Ut.packetsLost)!==null&&vr!==void 0?vr:0)-((kr=en==null?void 0:en.packetsLost)!==null&&kr!==void 0?kr:0),0),Tc=Math.max(((Nr=Te==null?void 0:Te.packetsSent)!==null&&Nr!==void 0?Nr:0)-((Pr=gt==null?void 0:gt.packetsSent)!==null&&Pr!==void 0?Pr:0),0),wc=ta/Math.max(Tc,1),Ea=pa(Hn==null?void 0:Hn.mimeType,Hn==null?void 0:Hn.sdpFmtpLine);return{audio_nacks_enabled:(jr=Ur==null?void 0:Ur.audioNacks)!==null&&jr!==void 0&&jr,bytes_sent:Zi,codec_mime_type:Ea==null?void 0:Ea.mimeSubtype,configured_bitrate:(er=Ln==null?void 0:Ln.max_audio_bitrate_bps)!==null&&er!==void 0?er:0,connection_bandwidth:(Sn=Pt==null?void 0:Pt.availableOutgoingBitrate)!==null&&Sn!==void 0?Sn:0,encode_bitrate:ba,fraction_packets_lost:wc,header_bytes_sent:Math.max(((qn=Te==null?void 0:Te.headerBytesSent)!==null&&qn!==void 0?qn:0)-((vi=gt==null?void 0:gt.headerBytesSent)!==null&&vi!==void 0?vi:0),0),nack_count:Math.max(((Xi=Te==null?void 0:Te.nackCount)!==null&&Xi!==void 0?Xi:0)-((Ji=gt==null?void 0:gt.nackCount)!==null&&Ji!==void 0?Ji:0),0),packets_lost:ta,packets_sent:Math.max(((ys=Te==null?void 0:Te.packetsSent)!==null&&ys!==void 0?ys:0)-((cs=gt==null?void 0:gt.packetsSent)!==null&&cs!==void 0?cs:0),0),retransmitted_bytes_sent:Math.max(((ls=Te==null?void 0:Te.retransmittedBytesSent)!==null&&ls!==void 0?ls:0)-((Qi=gt==null?void 0:gt.retransmittedBytesSent)!==null&&Qi!==void 0?Qi:0),0),retransmitted_packets_sent:Math.max(((Li=Te==null?void 0:Te.retransmittedPacketsSent)!==null&&Li!==void 0?Li:0)-((us=gt==null?void 0:gt.retransmittedPacketsSent)!==null&&us!==void 0?us:0),0),target_bitrate:Math.max((Gs=Te==null?void 0:Te.targetBitrate)!==null&&Gs!==void 0?Gs:0,0)}})(O,P,B,J,te,z,re,Me,ce)))}}class z_ extends gr{constructor(b,S,C,O,P,B,J,te){var z,re;super(vn.SUBSCRIBED_VIDEO_STATS,b,S,!1),Object.assign(this.properties,Object.assign({action:Yt.SUBSCRIBE,node:(z=O==null?void 0:O.node)!==null&&z!==void 0?z:"",cluster:(re=O==null?void 0:O.cluster)!==null&&re!==void 0?re:"",remote_participant_id:C},((ce,de,ke,Qe)=>{var Be,Me,Te,gt,Ut,en,Pt,Hn,Ln,Or,Ur,Fr,Br,vr,kr,Nr,Pr,jr,er,Sn,qn,vi,Xi;let Ji=0;ce!=null&&ce.jitterBufferDelay&&(ce!=null&&ce.jitterBufferEmittedCount)&&ce.jitterBufferEmittedCount>0&&(Ji=ce.jitterBufferDelay/ce.jitterBufferEmittedCount);const ys=Qe??1,cs=Math.max((Be=ce==null?void 0:ce.bytesReceived)!==null&&Be!==void 0?Be:0,0),ls=8*cs/ys;let Qi=0;ce!=null&&ce.totalDecodeTime&&(ce!=null&&ce.framesDecoded)&&(Qi=ce.totalDecodeTime/Math.max(ce==null?void 0:ce.framesDecoded,1));const Li=Math.max((Me=ce==null?void 0:ce.packetsLost)!==null&&Me!==void 0?Me:0,0),us=Math.max((Te=ce==null?void 0:ce.packetsReceived)!==null&&Te!==void 0?Te:0,0),Gs=Li/Math.max(us+Li,1),Zi=pa(ke==null?void 0:ke.mimeType,ke==null?void 0:ke.sdpFmtpLine);return{bytes_received:cs,codec_mime_type:Zi==null?void 0:Zi.mimeSubtype,codec_profile:Zi==null?void 0:Zi.profile,codec_level:Zi==null?void 0:Zi.level,connection_bandwidth:(gt=de==null?void 0:de.availableIncomingBitrate)!==null&&gt!==void 0?gt:0,decode_bitrate:ls,decoder_implementation:(Ut=ce==null?void 0:ce.decoderImplementation)!==null&&Ut!==void 0?Ut:"unknown",fir_count:Math.max((en=ce==null?void 0:ce.firCount)!==null&&en!==void 0?en:0,0),fraction_packets_lost:Gs,frame_decode_time_avg:Qi,frame_height:Math.max((Pt=ce==null?void 0:ce.frameHeight)!==null&&Pt!==void 0?Pt:0,0),frame_width:Math.max((Hn=ce==null?void 0:ce.frameWidth)!==null&&Hn!==void 0?Hn:0,0),frames_decoded:Math.max((Ln=ce==null?void 0:ce.framesDecoded)!==null&&Ln!==void 0?Ln:0,0),frames_dropped:Math.max((Or=ce==null?void 0:ce.framesDropped)!==null&&Or!==void 0?Or:0,0),frames_received:Math.max((Ur=ce==null?void 0:ce.framesReceived)!==null&&Ur!==void 0?Ur:0,0),freeze_count:Math.max((Fr=ce==null?void 0:ce.freezeCount)!==null&&Fr!==void 0?Fr:0,0),frames_rendered:Math.max((Br=ce==null?void 0:ce.framesRendered)!==null&&Br!==void 0?Br:0,0),frames_per_second:Math.max((vr=ce==null?void 0:ce.framesPerSecond)!==null&&vr!==void 0?vr:0,0),header_bytes_received:Math.max((kr=ce==null?void 0:ce.headerBytesReceived)!==null&&kr!==void 0?kr:0,0),jitter_buffer_delay_avg:Ji,key_frames_decoded:Math.max((Nr=ce==null?void 0:ce.keyFramesDecoded)!==null&&Nr!==void 0?Nr:0,0),nack_count:Math.max((Pr=ce==null?void 0:ce.nackCount)!==null&&Pr!==void 0?Pr:0,0),packets_discarded:Math.max((jr=ce==null?void 0:ce.packetsDiscarded)!==null&&jr!==void 0?jr:0,0),packets_lost:Li,packets_received:us,pause_count:Math.max((er=ce==null?void 0:ce.pauseCount)!==null&&er!==void 0?er:0,0),pli_count:Math.max((Sn=ce==null?void 0:ce.pliCount)!==null&&Sn!==void 0?Sn:0,0),power_efficient_decoder:(qn=ce==null?void 0:ce.powerEfficientDecoder)!==null&&qn!==void 0&&qn,total_freezes_duration:Math.max((vi=ce==null?void 0:ce.totalFreezesDuration)!==null&&vi!==void 0?vi:0,0),total_pauses_duration:Math.max((Xi=ce==null?void 0:ce.totalPausesDuration)!==null&&Xi!==void 0?Xi:0,0)}})(P,B,J,te)))}}class Jg extends gr{constructor(b,S,C,O,P,B,J,te,z,re,ce){var de,ke,Qe,Be;super(vn.SUBSCRIBED_VIDEO_STATS_WINDOW,b,S,!1);const Me=Math.max(((de=P==null?void 0:P.timestamp)!==null&&de!==void 0?de:0)-((ke=B==null?void 0:B.timestamp)!==null&&ke!==void 0?ke:0),0);Object.assign(this.properties,Object.assign({action:Yt.SUBSCRIBE,node:(Qe=O==null?void 0:O.node)!==null&&Qe!==void 0?Qe:"",cluster:(Be=O==null?void 0:O.cluster)!==null&&Be!==void 0?Be:"",window_size_ms:Me,remote_participant_id:C},((Te,gt,Ut,en,Pt,Hn,Ln,Or)=>{var Ur,Fr,Br,vr,kr,Nr,Pr,jr,er,Sn,qn,vi,Xi,Ji,ys,cs,ls,Qi,Li,us,Gs,Zi,ba,ta,Tc,wc,Ea,ml,qa,Uc,gl,Ka,Ql,yh,Nu,Ps,Pu,_d,yd,Du,Zl,bd,Ed;let lv=0,xm=0;if(Te!=null&&Te.jitterBufferEmittedCount&&(gt!=null&&gt.jitterBufferEmittedCount)&&Te.jitterBufferEmittedCount>gt.jitterBufferEmittedCount){Te!=null&&Te.jitterBufferDelay&&(gt!=null&&gt.jitterBufferDelay)&&(lv=(Te.jitterBufferDelay-gt.jitterBufferDelay)/(Te.jitterBufferEmittedCount-gt.jitterBufferEmittedCount));const Ky=gt==null?void 0:gt.jitterBufferMinimumDelay,v=Te==null?void 0:Te.jitterBufferMinimumDelay;Ky&&v&&(xm=(v-Ky)/(Te.jitterBufferEmittedCount-gt.jitterBufferEmittedCount))}const uv=Math.max(((Ur=Te==null?void 0:Te.bytesReceived)!==null&&Ur!==void 0?Ur:0)-((Fr=gt==null?void 0:gt.bytesReceived)!==null&&Fr!==void 0?Fr:0),0),dv=typeof Pt!="number"?1:Pt/1e3,Cm=8*uv/dv,Rm=Math.max(((Br=Te==null?void 0:Te.totalDecodeTime)!==null&&Br!==void 0?Br:0)-((vr=gt==null?void 0:gt.totalDecodeTime)!==null&&vr!==void 0?vr:0),0),Z_=Math.max(((kr=Te==null?void 0:Te.framesDecoded)!==null&&kr!==void 0?kr:0)-((Nr=gt==null?void 0:gt.framesDecoded)!==null&&Nr!==void 0?Nr:0),0),e0=Rm/Math.max(Z_,1),t0=Math.max(((Pr=Te==null?void 0:Te.packetsLost)!==null&&Pr!==void 0?Pr:0)-((jr=gt==null?void 0:gt.packetsLost)!==null&&jr!==void 0?jr:0),0),Wy=Math.max(((er=Te==null?void 0:Te.packetsReceived)!==null&&er!==void 0?er:0)-((Sn=gt==null?void 0:gt.packetsReceived)!==null&&Sn!==void 0?Sn:0),0),n0=t0/Math.max(Wy+t0,1),Bf=pa(en==null?void 0:en.mimeType,en==null?void 0:en.sdpFmtpLine),qy=8*(Or||0)/dv;return{bytes_received:uv,codec_mime_type:Bf==null?void 0:Bf.mimeSubtype,codec_profile:Bf==null?void 0:Bf.profile,codec_level:Bf==null?void 0:Bf.level,connection_bandwidth:(qn=Ut==null?void 0:Ut.availableIncomingBitrate)!==null&&qn!==void 0?qn:0,decode_bitrate:Cm,decoder_implementation:(vi=Te==null?void 0:Te.decoderImplementation)!==null&&vi!==void 0?vi:"unknown",fir_count:Math.max(((Xi=Te==null?void 0:Te.firCount)!==null&&Xi!==void 0?Xi:0)-((Ji=gt==null?void 0:gt.firCount)!==null&&Ji!==void 0?Ji:0),0),fraction_packets_lost:n0,frame_decode_time_avg:e0,frame_height:Math.max((ys=Te==null?void 0:Te.frameHeight)!==null&&ys!==void 0?ys:0,0),frame_width:Math.max((cs=Te==null?void 0:Te.frameWidth)!==null&&cs!==void 0?cs:0,0),frames_decoded:Math.max(((ls=Te==null?void 0:Te.framesDecoded)!==null&&ls!==void 0?ls:0)-((Qi=gt==null?void 0:gt.framesDecoded)!==null&&Qi!==void 0?Qi:0),0),frames_dropped:Math.max(((Li=Te==null?void 0:Te.framesDropped)!==null&&Li!==void 0?Li:0)-((us=gt==null?void 0:gt.framesDropped)!==null&&us!==void 0?us:0),0),frames_received:Math.max(((Gs=Te==null?void 0:Te.framesReceived)!==null&&Gs!==void 0?Gs:0)-((Zi=gt==null?void 0:gt.framesReceived)!==null&&Zi!==void 0?Zi:0),0),freeze_count:Math.max(((ba=Te==null?void 0:Te.freezeCount)!==null&&ba!==void 0?ba:0)-((ta=gt==null?void 0:gt.freezeCount)!==null&&ta!==void 0?ta:0),0),frames_rendered:Math.max((Tc=Te==null?void 0:Te.framesRendered)!==null&&Tc!==void 0?Tc:0,0),frames_per_second:Math.max((wc=Te==null?void 0:Te.framesPerSecond)!==null&&wc!==void 0?wc:0,0),header_bytes_received:Math.max(((Ea=Te==null?void 0:Te.headerBytesReceived)!==null&&Ea!==void 0?Ea:0)-((ml=gt==null?void 0:gt.headerBytesReceived)!==null&&ml!==void 0?ml:0),0),configured_jitter_buffer_min_delay_ms:Hn??0,jitter_buffer_min_obtainable_delay:xm,jitter_buffer_delay_avg:lv,key_frames_decoded:Math.max(((qa=Te==null?void 0:Te.keyFramesDecoded)!==null&&qa!==void 0?qa:0)-((Uc=gt==null?void 0:gt.keyFramesDecoded)!==null&&Uc!==void 0?Uc:0),0),nack_count:Math.max(((gl=Te==null?void 0:Te.nackCount)!==null&&gl!==void 0?gl:0)-((Ka=gt==null?void 0:gt.nackCount)!==null&&Ka!==void 0?Ka:0),0),packets_discarded:Math.max(((Ql=Te==null?void 0:Te.packetsDiscarded)!==null&&Ql!==void 0?Ql:0)-((yh=gt==null?void 0:gt.packetsDiscarded)!==null&&yh!==void 0?yh:0),0),packets_lost:t0,packets_received:Wy,pause_count:Math.max(((Nu=Te==null?void 0:Te.pauseCount)!==null&&Nu!==void 0?Nu:0)-((Ps=gt==null?void 0:gt.pauseCount)!==null&&Ps!==void 0?Ps:0),0),pli_count:Math.max(((Pu=Te==null?void 0:Te.pliCount)!==null&&Pu!==void 0?Pu:0)-((_d=gt==null?void 0:gt.pliCount)!==null&&_d!==void 0?_d:0),0),power_efficient_decoder:(yd=Te==null?void 0:Te.powerEfficientDecoder)!==null&&yd!==void 0&&yd,total_freezes_duration:Math.max(((Du=Te==null?void 0:Te.totalFreezesDuration)!==null&&Du!==void 0?Du:0)-((Zl=gt==null?void 0:gt.totalFreezesDuration)!==null&&Zl!==void 0?Zl:0),0),total_pauses_duration:Math.max(((bd=Te==null?void 0:Te.totalPausesDuration)!==null&&bd!==void 0?bd:0)-((Ed=gt==null?void 0:gt.totalPausesDuration)!==null&&Ed!==void 0?Ed:0),0),sei_read_count:Ln,sei_bytes_received:Or,sei_bitrate:qy}})(P,B,J,te,Me,z,re,ce)))}}class Qg extends gr{constructor(b,S,C,O,P,B,J,te,z){var re,ce;super(vn.SUBSCRIBED_AUDIO_STATS,b,S,!1),Object.assign(this.properties,Object.assign({action:Yt.SUBSCRIBE,node:(re=O==null?void 0:O.node)!==null&&re!==void 0?re:"",cluster:(ce=O==null?void 0:O.cluster)!==null&&ce!==void 0?ce:"",remote_participant_id:C},((de,ke,Qe,Be,Me)=>{var Te,gt,Ut,en,Pt,Hn,Ln,Or,Ur,Fr,Br,vr,kr,Nr,Pr,jr,er;let Sn=0;de!=null&&de.jitterBufferDelay&&(de!=null&&de.jitterBufferEmittedCount)&&de.jitterBufferEmittedCount>0&&(Sn=de.jitterBufferDelay/de.jitterBufferEmittedCount);const qn=Be??1,vi=Math.max((Te=de==null?void 0:de.bytesReceived)!==null&&Te!==void 0?Te:0,0),Xi=8*vi/qn,Ji=Math.max((gt=de==null?void 0:de.packetsLost)!==null&&gt!==void 0?gt:0,0),ys=Math.max((Ut=de==null?void 0:de.packetsReceived)!==null&&Ut!==void 0?Ut:0,0),cs=Ji/Math.max(ys+Ji,1),ls=Math.max((en=de==null?void 0:de.concealedSamples)!==null&&en!==void 0?en:0,0),Qi=Math.max((Pt=de==null?void 0:de.totalSamplesReceived)!==null&&Pt!==void 0?Pt:0,0),Li=ls/Math.max(Qi,1),us=pa(Qe==null?void 0:Qe.mimeType,Qe==null?void 0:Qe.sdpFmtpLine);return{audio_level:(Hn=de==null?void 0:de.audioLevel)!==null&&Hn!==void 0?Hn:0,audio_nacks_enabled:(Ln=Me==null?void 0:Me.audioNacks)!==null&&Ln!==void 0&&Ln,bytes_received:vi,codec_mime_type:us==null?void 0:us.mimeSubtype,connection_bandwidth:(Or=ke==null?void 0:ke.availableIncomingBitrate)!==null&&Or!==void 0?Or:0,concealed_samples:ls,concealment_events:Math.max((Ur=de==null?void 0:de.concealmentEvents)!==null&&Ur!==void 0?Ur:0,0),silent_concealed_samples:Math.max((Fr=de==null?void 0:de.silentConcealedSamples)!==null&&Fr!==void 0?Fr:0,0),decode_bitrate:Xi,fraction_audio_concealed:Li,fraction_packets_lost:cs,header_bytes_received:Math.max((Br=de==null?void 0:de.headerBytesReceived)!==null&&Br!==void 0?Br:0,0),inserted_samples_for_deceleration:Math.max((vr=de==null?void 0:de.insertedSamplesForDeceleration)!==null&&vr!==void 0?vr:0,0),jitter_buffer_delay_avg:Sn,packets_discarded:Math.max((kr=de==null?void 0:de.packetsDiscarded)!==null&&kr!==void 0?kr:0,0),retransmitted_packets_received:Math.max((Nr=de==null?void 0:de.retransmittedPacketsReceived)!==null&&Nr!==void 0?Nr:0,0),retransmitted_bytes_received:Math.max((Pr=de==null?void 0:de.retransmittedBytesReceived)!==null&&Pr!==void 0?Pr:0,0),packets_lost:Ji,packets_received:ys,nack_count:Math.max((jr=de==null?void 0:de.nackCount)!==null&&jr!==void 0?jr:0,0),removed_samples_for_acceleration:Math.max((er=de==null?void 0:de.removedSamplesForAcceleration)!==null&&er!==void 0?er:0,0),total_samples_received:Qi}})(P,B,J,te,z)))}}class xr extends gr{constructor(b,S,C,O,P,B,J,te,z,re){var ce,de,ke,Qe;super(vn.SUBSCRIBED_AUDIO_STATS_WINDOW,b,S,!1);const Be=Math.max(((ce=P==null?void 0:P.timestamp)!==null&&ce!==void 0?ce:0)-((de=B==null?void 0:B.timestamp)!==null&&de!==void 0?de:0),0);Object.assign(this.properties,Object.assign({action:Yt.SUBSCRIBE,window_size_ms:Be,node:(ke=O==null?void 0:O.node)!==null&&ke!==void 0?ke:"",cluster:(Qe=O==null?void 0:O.cluster)!==null&&Qe!==void 0?Qe:"",remote_participant_id:C},((Me,Te,gt,Ut,en,Pt,Hn)=>{var Ln,Or,Ur,Fr,Br,vr,kr,Nr,Pr,jr,er,Sn,qn,vi,Xi,Ji,ys,cs,ls,Qi,Li,us,Gs,Zi,ba,ta,Tc,wc,Ea,ml,qa;let Uc=0,gl=0;if(Me!=null&&Me.jitterBufferEmittedCount&&(Te!=null&&Te.jitterBufferEmittedCount)&&Me.jitterBufferEmittedCount>Te.jitterBufferEmittedCount){Me!=null&&Me.jitterBufferDelay&&(Te!=null&&Te.jitterBufferDelay)&&(Uc=(Me.jitterBufferDelay-Te.jitterBufferDelay)/(Me.jitterBufferEmittedCount-Te.jitterBufferEmittedCount));const bd=Te==null?void 0:Te.jitterBufferMinimumDelay,Ed=Me==null?void 0:Me.jitterBufferMinimumDelay;bd&&Ed&&(gl=(Ed-bd)/(Me.jitterBufferEmittedCount-Te.jitterBufferEmittedCount))}const Ka=typeof en!="number"?1:en/1e3,Ql=Math.max(((Ln=Me==null?void 0:Me.bytesReceived)!==null&&Ln!==void 0?Ln:0)-((Or=Te==null?void 0:Te.bytesReceived)!==null&&Or!==void 0?Or:0),0),yh=8*Ql/Ka,Nu=Math.max(((Ur=Me==null?void 0:Me.packetsLost)!==null&&Ur!==void 0?Ur:0)-((Fr=Te==null?void 0:Te.packetsLost)!==null&&Fr!==void 0?Fr:0),0),Ps=Math.max(((Br=Me==null?void 0:Me.packetsReceived)!==null&&Br!==void 0?Br:0)-((vr=Te==null?void 0:Te.packetsReceived)!==null&&vr!==void 0?vr:0),0),Pu=Nu/Math.max(Ps+Nu,1),_d=Math.max(((kr=Me==null?void 0:Me.concealedSamples)!==null&&kr!==void 0?kr:0)-((Nr=Te==null?void 0:Te.concealedSamples)!==null&&Nr!==void 0?Nr:0),0),yd=Math.max(((Pr=Me==null?void 0:Me.totalSamplesReceived)!==null&&Pr!==void 0?Pr:0)-((jr=Te==null?void 0:Te.totalSamplesReceived)!==null&&jr!==void 0?jr:0),0),Du=_d/Math.max(yd,1),Zl=pa(Ut==null?void 0:Ut.mimeType,Ut==null?void 0:Ut.sdpFmtpLine);return{audio_level:(er=Me==null?void 0:Me.audioLevel)!==null&&er!==void 0?er:0,audio_nacks_enabled:(Sn=Pt==null?void 0:Pt.audioNacks)!==null&&Sn!==void 0&&Sn,bytes_received:Ql,codec_mime_type:Zl==null?void 0:Zl.mimeSubtype,connection_bandwidth:(qn=gt==null?void 0:gt.availableIncomingBitrate)!==null&&qn!==void 0?qn:0,decode_bitrate:yh,concealed_samples:_d,concealment_events:Math.max(((vi=Me==null?void 0:Me.concealmentEvents)!==null&&vi!==void 0?vi:0)-((Xi=Te==null?void 0:Te.concealmentEvents)!==null&&Xi!==void 0?Xi:0),0),silent_concealed_samples:Math.max(((Ji=Me==null?void 0:Me.silentConcealedSamples)!==null&&Ji!==void 0?Ji:0)-((ys=Te==null?void 0:Te.silentConcealedSamples)!==null&&ys!==void 0?ys:0),0),fraction_audio_concealed:Du,fraction_packets_lost:Pu,header_bytes_received:Math.max(((cs=Me==null?void 0:Me.headerBytesReceived)!==null&&cs!==void 0?cs:0)-((ls=Te==null?void 0:Te.headerBytesReceived)!==null&&ls!==void 0?ls:0),0),inserted_samples_for_deceleration:Math.max(((Qi=Me==null?void 0:Me.insertedSamplesForDeceleration)!==null&&Qi!==void 0?Qi:0)-((Li=Te==null?void 0:Te.insertedSamplesForDeceleration)!==null&&Li!==void 0?Li:0),0),configured_jitter_buffer_min_delay_ms:Hn??0,jitter_buffer_min_obtainable_delay:gl,jitter_buffer_delay_avg:Uc,packets_discarded:Math.max(((us=Me==null?void 0:Me.packetsDiscarded)!==null&&us!==void 0?us:0)-((Gs=Te==null?void 0:Te.packetsDiscarded)!==null&&Gs!==void 0?Gs:0),0),packets_lost:Nu,packets_received:Ps,nack_count:Math.max(((Zi=Me==null?void 0:Me.nackCount)!==null&&Zi!==void 0?Zi:0)-((ba=Te==null?void 0:Te.nackCount)!==null&&ba!==void 0?ba:0),0),removed_samples_for_acceleration:Math.max(((ta=Me==null?void 0:Me.removedSamplesForAcceleration)!==null&&ta!==void 0?ta:0)-((Tc=Te==null?void 0:Te.removedSamplesForAcceleration)!==null&&Tc!==void 0?Tc:0),0),retransmitted_packets_received:Math.max(((wc=Me==null?void 0:Me.retransmittedPacketsReceived)!==null&&wc!==void 0?wc:0)-((Ea=Te==null?void 0:Te.retransmittedPacketsReceived)!==null&&Ea!==void 0?Ea:0),0),retransmitted_bytes_received:Math.max(((ml=Me==null?void 0:Me.retransmittedBytesReceived)!==null&&ml!==void 0?ml:0)-((qa=Te==null?void 0:Te.retransmittedBytesReceived)!==null&&qa!==void 0?qa:0),0),total_samples_received:yd}})(P,B,J,te,Be,z,re)))}}class cm extends gr{constructor(b,S,C,O,P=Yt.PUBLISH,B=!1,J=""){super(vn.SIMULCAST_LAYER_INFO,b,S,!1),Object.assign(this.properties,{rid:C,active:O,selected:B,source:P===Yt.PUBLISH?"publisher":"subscriber",remote_participant_id:J})}}class G_ extends gr{constructor(b,S,C,O){super(vn.MULTIHOST_CONFIGURATION,b,S,!1),Object.assign(this.properties,Object.assign(Object.assign({},C),{action:O}))}}class Tf extends gr{constructor(b,S,C){super(vn.MULTIHOST_SUBSCRIBE_CONFIGURATION,b,S,!1),Object.assign(this.properties,Object.assign({},C))}}var dd,Ru,Kl;(function(x){x.Mobile="mobile",x.Tablet="tablet",x.Desktop="desktop",x.Tv="tv"})(dd||(dd={})),function(x){x.IOS="iOS",x.MacOS="macOS",x.Windows="Windows",x.Android="Android"}(Ru||(Ru={})),function(x){x.Safari="Safari",x.Firefox="Firefox",x.Chrome="Chrome",x.IE="Internet Explorer",x.Edge="Microsoft Edge"}(Kl||(Kl={}));const Yo=function(x){const b=Yl(x);return{platform:{isMobile:hd(dd.Mobile,b),isTablet:hd(dd.Tablet,b),isDesktop:hd(dd.Desktop,b),isTv:hd(dd.Tv,b)},os:{name:lm(b),version:Zg(b),isIOS:wf(Ru.IOS,b),isMacOS:wf(Ru.MacOS,b),isWindows:wf(Ru.Windows,b),isAndroid:wf(Ru.Android,b)},browser:{name:Au(b),version:ma(b),isSafari:ga(Kl.Safari,b),isFirefox:ga(Kl.Firefox,b),isChrome:ga(Kl.Chrome,b),isIE:ga(Kl.IE,b),isEdge:ga(Kl.Edge,b)}}}(window.navigator.userAgent);function Yl(x){try{return Bl.getParser(x||window.navigator.userAgent)}catch{}}function hd(x,b){return()=>(b||(b=Yl()),!(!b||b.getPlatformType(!0)!==x.toLowerCase()))}function Zg(x){return()=>(x||(x=Yl()),x&&x.getOSVersion()||"")}function lm(x){return()=>(x||(x=Yl()),x&&x.getOSName()||"")}function wf(x,b){return()=>(b||(b=Yl()),!(!b||b.getOSName(!0)!==x.toLowerCase()))}function ma(x){return()=>(x||(x=Yl()),x&&x.getBrowserVersion()||"")}function Au(x){return()=>(x||(x=Yl()),x&&x.getBrowserName()||"")}function ga(x,b){return()=>(b||(b=Yl()),!(!b||b.getBrowserName().toLowerCase()!==x.toLowerCase()))}const jy={active:!1,maxBitrate:2e5,rid:"low",maxFramerate:15,scaleResolutionDownBy:4},ev={width:320,height:180},oh={active:!1,maxBitrate:7e5,rid:"mid",maxFramerate:20,scaleResolutionDownBy:2},Mu={width:640,height:360},um={active:!1,maxBitrate:17e5,rid:"hi",maxFramerate:30,scaleResolutionDownBy:1},rn={width:1280,height:720};function ah(x){const{config:b}=x;return[{maxBitrate:b.maxBitrateBps}]}function hl(x,b){var S,C;const O=b==null?void 0:b.track,P=b==null?void 0:b.config;if(x&&O){const B=(0,ss.cloneDeep)([{encodingParams:jy,targetResolution:ev},{encodingParams:oh,targetResolution:Mu},{encodingParams:um,targetResolution:rn}]),{height:J,width:te}=O.getSettings(),z=J&&te?{width:te,height:J}:void 0;for(const de of B){de.encodingParams.active=!0;let ke=1;z&&(ke=Math.floor(Math.sqrt(z.width*z.height/(de.targetResolution.width*de.targetResolution.height))),ke=Math.max(ke,1)),de.encodingParams.scaleResolutionDownBy=ke}let re=(S=P==null?void 0:P.maxBitrateBps)!==null&&S!==void 0?S:um.maxBitrate;const ce=(C=P==null?void 0:P.maxFramerate)!==null&&C!==void 0?C:um.maxFramerate;return re<oh.maxBitrate&&(re=um.maxBitrate),B[2].encodingParams.maxBitrate=re,B[2].encodingParams.maxFramerate=ce,B[2].encodingParams.scaleResolutionDownBy=1,B.map(de=>de.encodingParams)}return P?[{maxBitrate:P.maxBitrateBps,maxFramerate:P.maxFramerate}]:[{maxBitrate:Mo(sh),maxFramerate:ql}]}const $y=1e3;function Mo(x){return x*$y}const Iu=(x,...b)=>{const S=b.map(C=>typeof C!="object").filter(Boolean).length>0;if(typeof x=="object"&&!S)return(0,ss.merge)({},x,...b)},ch=x=>xf(x),xf=x=>(0,ss.cloneDeep)(x),tv=x=>{switch(x){case Cu.HIGHEST_QUALITY:return"highest";case Cu.LOWEST_QUALITY:default:return"lowest"}};var Cf=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};const lh="no-rid";class Rf{constructor(b,S,C,O,P,B){this.analyticsTracker=P,this.receiveVideoTransformer=B,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new Mi(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=Rf.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case nt.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case nt.FAILED:this.flushStats()}},this.action=b,this.token=S,this.traceId=C,this.identifier=O}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:Mo(Ao)}}set sdpAnswer(b){try{this.sdp=new Mi(b),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(b,S=!1){this.peerConnection=b,this.simulcastEnabled=S,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var b;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(b=this.peerConnection)===null||b===void 0||b.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(b){this.sfuResource=b}updateMultihostConfiguration(b,S){var C,O,P,B,J,te;return Cf(this,void 0,void 0,function*(){if(this.action!==Yt.PUBLISH||!this.peerConnection)return;const z=Rf.defaultMultihostConfiguration();if(S){const re=this.peerConnection.getSenders().filter(de=>de.track!==null&&de.track.kind==="video");re.length>0&&(yield re[0].getStats()).forEach(de=>{de.type==="codec"&&(z.video_codec=de.mimeType)});const ce=S.track.getSettings();z.width=(C=ce.width)!==null&&C!==void 0?C:0,z.height=(O=ce.height)!==null&&O!==void 0?O:0,z.target_fps=(P=ce.frameRate)!==null&&P!==void 0?P:0,S.config?(z.max_bitrate=S.config.maxBitrateBps,z.min_bitrate=S.config.minBitrateBps,z.enable_simulcast=S.config.simulcastEnabled):(z.max_bitrate=Mo(sh),z.min_bitrate=Mo(yf),z.enable_simulcast=!1)}if(b){const re=b.track.getSettings();z.auto_gain=(B=re.autoGainControl)!==null&&B!==void 0&&B,z.echo_cancellation=(J=re.echoCancellation)!==null&&J!==void 0&&J,z.noise_suppression=(te=re.noiseSuppression)!==null&&te!==void 0&&te,z.max_audio_bitrate_bps=b.config.maxBitrateBps,z.stereo=b.config.stereo}(0,ss.isEqual)(z,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new G_(this.token,this.traceId,z,this.action)),this.multihostConfiguration=z)})}updateJitterBufferMinDelay(b){this.jitterBufferMinDelayInMs=b}setupIntervals(){this.action===Yt.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(b,S){return setInterval(b.bind(this),S)}getConnectionState(){var b;if(!this.peerConnection)return nt.NONE;const S=(b=this.peerConnection.connectionState)!==null&&b!==void 0?b:this.peerConnection.iceConnectionState;try{return By(S)}catch{return nt.IDLE}}pollSimulcastLayers(){var b;return Cf(this,void 0,void 0,function*(){if(this.getConnectionState()===nt.CONNECTED){const S=yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats();if(!S)return;S.forEach(C=>{var O;if(C.type==="outbound-rtp"){const P=((O=C.framesPerSecond)!==null&&O!==void 0?O:0)!==0;switch(C.rid){case"low":P!==this.simulcastState.low&&(this.simulcastState.low=P,this.analyticsTracker.trackEventNoSharedProps(new cm(this.token,this.traceId,C.rid,P)));break;case"mid":P!==this.simulcastState.mid&&(this.simulcastState.mid=P,this.analyticsTracker.trackEventNoSharedProps(new cm(this.token,this.traceId,C.rid,P)));break;case"hi":P!==this.simulcastState.hi&&(this.simulcastState.hi=P,this.analyticsTracker.trackEventNoSharedProps(new cm(this.token,this.traceId,C.rid,P)))}}})}})}flushStats(){var b;return Cf(this,void 0,void 0,function*(){const S=yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats();S&&(this.action===Yt.PUBLISH?this.uploadPublisherStats(S):this.action===Yt.SUBSCRIBE&&this.uploadSubscriberStats(S))})}uploadStats(){var b;return Cf(this,void 0,void 0,function*(){if(this.getConnectionState()===nt.CONNECTED){const S=yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats();if(!S)return;this.action===Yt.PUBLISH?this.uploadPublisherStats(S):this.action===Yt.SUBSCRIBE&&this.uploadSubscriberStats(S)}})}uploadPublisherStats(b){const S={audio:{},video:[]},C=new Map,O=(Date.now()-this.connectionStartedTimestamp)/1e3,P=Object.assign({},this.multihostConfiguration);b.forEach(B=>{if(B.type==="outbound-rtp"){const J=b.get(B.remoteId),te=this.prevRemoteInboundStats.get(B.remoteId);switch(J&&this.prevRemoteInboundStats.set(J.id,J),B.kind){case"audio":S.audio=this.updateOutboundAudio(B),S.audio.remoteInbound=J,S.audio.prevRemoteInbound=te,S.audio.codec=C.get(B.codecId);break;case"video":S.video.push(Object.assign({},this.updateOutboundVideo(B),{remoteInbound:J,prevRemoteInbound:te,codec:C.get(B.codecId)}))}}B.type==="candidate-pair"&&B.nominated&&(S.candidatePair=B),B.type==="codec"&&C.set(B.id,B)}),this.analyticsTracker.trackEventNoSharedProps(new V_(this.token,this.traceId,this.sfuResource,S.audio.outbound,S.audio.remoteInbound,S.candidatePair,S.audio.codec,P,O,this.sdpFeatures)),S.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Xg(this.token,this.traceId,this.sfuResource,S.audio.outbound,S.audio.prevOutbound,S.audio.remoteInbound,S.audio.prevRemoteInbound,S.candidatePair,S.audio.codec,P,this.sdpFeatures)),S.video.forEach(B=>{this.analyticsTracker.trackEventNoSharedProps(new za(this.token,this.traceId,this.sfuResource,B.outbound,B.remoteInbound,S.candidatePair,B.codec,P,O)),B.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Ko(this.token,this.traceId,this.sfuResource,B.outbound,B.prevOutbound,B.remoteInbound,B.prevRemoteInbound,S.candidatePair,B.codec,P))})}uploadSubscriberStats(b){var S;const C={audio:{},video:{}},O=new Map,P=(Date.now()-this.connectionStartedTimestamp)/1e3,B=(S=this.jitterBufferMinDelayInMs)!==null&&S!==void 0?S:0,{seiReadCnt:J,seiBytesRead:te}=this.updateAndDiffSinceLastUpdate(this.receiveVideoTransformer.getReceiverStats());b.forEach(z=>{if(z.type==="inbound-rtp")switch(z.kind){case"audio":C.audio=this.updateInboundAudio(z),C.audio.codec=O.get(z.codecId);break;case"video":C.video=this.updateInboundVideo(z),C.video.codec=O.get(z.codecId)}z.type==="candidate-pair"&&z.nominated&&(C.candidatePair=z),z.type==="codec"&&O.set(z.id,z)}),this.analyticsTracker.trackEventNoSharedProps(new Qg(this.token,this.traceId,this.identifier,this.sfuResource,C.audio.inbound,C.candidatePair,C.audio.codec,P,this.sdpFeatures)),C.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new xr(this.token,this.traceId,this.identifier,this.sfuResource,C.audio.inbound,C.audio.prevInbound,C.candidatePair,C.audio.codec,this.sdpFeatures,B)),this.analyticsTracker.trackEventNoSharedProps(new z_(this.token,this.traceId,this.identifier,this.sfuResource,C.video.inbound,C.candidatePair,C.video.codec,P)),C.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new Jg(this.token,this.traceId,this.identifier,this.sfuResource,C.video.inbound,C.video.prevInbound,C.candidatePair,C.video.codec,B,J,te))}updateAndDiffSinceLastUpdate(b){const S=this.prevVideoReceiverTransformerStats,C=b.seiReadCnt-S.seiReadCnt,O=b.seiBytesRead-S.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:b.seiReadCnt,seiBytesRead:b.seiBytesRead},{seiReadCnt:C,seiBytesRead:O}}updateOutboundAudio(b){const S=b,C=this.prevOutboundAudioStats,O=b.id===(C==null?void 0:C.id)?C:void 0;return this.prevOutboundAudioStats=b,{outbound:S,prevOutbound:O}}updateInboundAudio(b){const S=b,C=this.prevInboundAudioStats,O=b.id===(C==null?void 0:C.id)?C:void 0;return this.prevInboundAudioStats=b,{inbound:S,prevInbound:O}}updateInboundVideo(b){const S=b,C=this.prevInboundVideoStats.get(lh),O=b.id===(C==null?void 0:C.id)?C:void 0;return this.prevInboundVideoStats.set(lh,b),{inbound:S,prevInbound:O}}updateOutboundVideo(b){const S=b,C=this.getPrevOutboundVideo(b),O=b.id===(C==null?void 0:C.id)?C:void 0;return this.setPrevVideoStat(b),{outbound:S,prevOutbound:O}}getPrevOutboundVideo(b){return this.simulcastEnabled&&b.rid&&this.prevOutboundVideoStats.has(b.rid)?this.prevOutboundVideoStats.get(b.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(lh)?this.prevOutboundVideoStats.get(lh):void 0}setPrevVideoStat(b){this.simulcastEnabled&&b.rid?this.prevOutboundVideoStats.set(b.rid,b):this.simulcastEnabled||this.prevOutboundVideoStats.set(lh,b)}}class Xo extends gr{constructor(b,S,C,O,P){super(vn.MINUTE,b,S,!1),Object.assign(this.properties,{action:O?Yt.PUBLISH:Yt.SUBSCRIBE,is_publishing:O,minutes_logged:C,subscribed_number:P})}}class fl extends gr{constructor(b){super(vn.PUBLISH,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.PUBLISH,remote_participant_id:b.token.participantID})}}class Af extends gr{constructor(b){super(vn.UNPUBLISH,b.token,b.traceId,!0),Object.assign(this.properties,{action:Yt.PUBLISH,remote_participant_id:b.token.participantID})}}class fd extends gr{constructor(b){var S,C,O,P;super(vn.SUBSCRIBE,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.subscribedId,subscribed_id:b.subscribedId,is_edp_connected:b.isEdpConnected,is_reassignment:b.isReassignment,node:(C=(S=b.preAttemptSfuResource)===null||S===void 0?void 0:S.node)!==null&&C!==void 0?C:"",cluster:(P=(O=b.preAttemptSfuResource)===null||O===void 0?void 0:O.cluster)!==null&&P!==void 0?P:""})}}class W_ extends gr{constructor(b){super(vn.UNSUBSCRIBE,b.token,b.traceId,!0),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.unsubscribedId,unsubscribed_id:b.unsubscribedId})}}class nv extends gr{constructor(b){var S,C,O,P;super(vn.PUBLISH_STARTED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.PUBLISH,options_duration:b.optionsDuration,post_duration:b.postDuration,remote_participant_id:b.token.participantID,time_to_candidate:b.timeToCandidate,total_duration:b.totalDuration,edp_initial_connect_duration:b.edpInitialConnectDuration,edp_initial_connect_retry_times:b.edpInitialConnectRetries,edp_initial_state_duration:b.edpInitialStateDuration,edp_state_update_count:b.edpStateUpdateCount,sdp_exchange_duration:b.sdpExchangeDuration,sdp_exchange_transport:b.sdpExchangeTransport,set_remote_desc_duration:b.setRemoteDescDuration,peer_connection_duration:b.peerConnectionDuration,node:(C=(S=b.sfuResource)===null||S===void 0?void 0:S.node)!==null&&C!==void 0?C:"",cluster:(P=(O=b.sfuResource)===null||O===void 0?void 0:O.cluster)!==null&&P!==void 0?P:"",publish_retry_times:b.publishRetries,total_duration_with_retries:b.totalDurationWithRetries})}}class dm extends gr{constructor(b){super(vn.PUBLISH_FAILED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.PUBLISH,code:b.code,message:b.message,fatal:b.fatal,nominal:b.nominal})}}class uh extends gr{constructor(b){super(vn.PUBLISH_ENDED,b.token,b.traceId,!0),Object.assign(this.properties,{action:Yt.PUBLISH,remote_participant_id:b.token.participantID,unpublish_successful:b.isUnpublishSuccessful,reason:b.reason})}}class hm extends gr{constructor(b){var S,C,O,P;super(vn.SUBSCRIBE_STARTED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.SUBSCRIBE,options_duration:b.optionsDuration,post_duration:b.postDuration,remote_participant_id:b.remoteParticipantId,time_to_candidate:b.timeToCandidate,total_duration:b.totalDuration,edp_initial_connect_duration:b.edpInitialConnectDuration,edp_initial_connect_retry_times:b.edpInitialConnectRetries,edp_initial_state_duration:b.edpInitialStateDuration,edp_initial_state_publishing_count:b.edpInitialStatePublishingCount,edp_state_update_count:b.edpStateUpdateCount,sdp_exchange_duration:b.sdpExchangeDuration,sdp_exchange_transport:b.sdpExchangeTransport,set_remote_desc_duration:b.setRemoteDescDuration,peer_connection_duration:b.peerConnectionDuration,node:(C=(S=b.sfuResource)===null||S===void 0?void 0:S.node)!==null&&C!==void 0?C:"",cluster:(P=(O=b.sfuResource)===null||O===void 0?void 0:O.cluster)!==null&&P!==void 0?P:"",total_duration_with_retries:b.totalDurationWithRetries,subscribe_retry_times:b.subscribeRetryTimes,is_reassignment:b.isReassignment})}}class q_ extends gr{constructor(b){super(vn.SUBSCRIBE_FAILED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.remoteParticipantId,code:b.code,message:b.message,fatal:b.fatal,nominal:b.nominal,is_reassignment:b.isReassignment})}}class rv extends gr{constructor(b){super(vn.SUBSCRIBE_ENDED,b.token,b.traceId,!0),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.remoteParticipantId,unsubscribe_successful:b.isUnsubscribeSuccessful,reason:b.reason}),this.critical=!0}}class fm extends gr{constructor(b){super(vn.STATE_UPDATED,b.token,b.traceId,!1),Object.assign(this.properties,{audio_muted:b.isAudioMuted,is_disconnected:b.isDisconnected,is_publishing:b.isPublishing,other_participant_id:b.otherParticipantId,other_participant_user_id:b.otherParticipantUserId,video_stopped:b.isVideoStopped})}}class K_ extends gr{constructor(b){var S,C,O,P,B;super(vn.FIRST_FRAME,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.remoteParticipantId,edp_initial_connect_duration:b.edpInitialConnectDuration,edp_initial_connect_retry_times:b.edpInitialConnectRetries,edp_initial_state_duration:b.edpInitialStateDuration,edp_initial_state_publishing_count:b.edpInitialStatePublishingCount,edp_state_update_count:b.edpStateUpdateCount,sdp_exchange_duration:b.sdpExchangeDuration,sdp_exchange_transport:b.sdpExchangeTransport,set_remote_desc_duration:b.setRemoteDescDuration,peer_connection_duration:b.peerConnectionDuration,node:(C=(S=b.sfuResource)===null||S===void 0?void 0:S.node)!==null&&C!==void 0?C:"",cluster:(P=(O=b.sfuResource)===null||O===void 0?void 0:O.cluster)!==null&&P!==void 0?P:"",video_was_paused:b.videoWasPaused,first_frame_duration:b.firstFrameDuration,total_duration_with_retries:b.totalDurationWithRetries,subscribe_retry_times:b.subscribeRetryTimes,media_type:b.mediaType,configured_jitter_buffer_min_delay_ms:(B=b.currentJitterBufferMinDelayInMs)!==null&&B!==void 0?B:0})}}class dh extends gr{constructor(b){super(vn.EDP_PONG,b.token,b.traceId,!1),Object.assign(this.properties,{event_endpoint:b.eventEndpoint,protocol:b.protocol,edp_rtt:b.edpRttMs})}}class Mf extends gr{constructor(b){super(vn.JOIN,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.JOIN,event_endpoint:b.eventEndpoint,whip_endpoint:b.whipEndpoint})}}class hh extends gr{constructor(b){super(vn.JOIN_ATTEMPT,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.JOIN,event_endpoint:b.eventEndpoint,whip_endpoint:b.whipEndpoint})}}class pm extends gr{constructor(b){super(vn.JOIN_ATTEMPT_FAILED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.JOIN,event_endpoint:b.eventEndpoint,whip_endpoint:b.whipEndpoint,code:b.code,message:b.message,fatal:b.fatal,nominal:b.nominal,connect_retry_times:b.retryCnt})}}class fh extends gr{constructor(b){super(vn.EDP_DISCONNECTED,b.token,b.traceId,!1),Object.assign(this.properties,{event_endpoint:b.eventEndpoint,protocol:b.protocol}),this.critical=!0}}class If extends gr{constructor(b){super(vn.EDP_CONNECTED,b.token,b.traceId,!1),Object.assign(this.properties,{event_endpoint:b.eventEndpoint,protocol:b.protocol,connect_retry_times:b.numRetries}),this.critical=!0}}var Of;(function(x){x.MESSAGE="message",x.RESPONSE="response"})(Of||(Of={}));class Y_{constructor(b,S,C){this.token=b,this.analyticsTracker=C,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.latestPingTimestamp=0,this.pongCount=0,this.latestSequenceNumber=0,this.nextConnectionAttempt=0,this.pingInterval=0,this.pongTimeout=0,this.connectTimeout=0,this.beforeUnload=()=>{this.emitter.emit(ll,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(O,P,B,J,te,z,re,ce)=>{var de;const ke={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:P,requestId:J,traceId:B,platform:"web",sdk:"1.19.0",whipVersion:qo,content:O,contentType:"application/sdp"}};te&&(ke.payload.forceNode=te),z&&(ke.payload.assignmentToken=z),re&&(ke.payload.multiCodec=re);const Qe=uf()===void 0,Be=uf()||Qe;ce&&Be&&(ke.payload.initialLayerPref=tv(ce)),(de=this.socket)===null||de===void 0||de.send(JSON.stringify(ke))},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new fh({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.logger=new Ks(S,pe.SOCKET),this.emitter=new uc.EventEmitter,this.connectionAttempts=0,this.sentPing=!1,this.receivedPong=!1,this.traceId=Qs(),this.id=`[${Js().value}] `,window.addEventListener("beforeunload",this.beforeUnload)}connect(b,S,C=!1){this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=b,this.traceId=S,C&&!this.connecting&&(window.clearTimeout(this.connectTimeout),this.connectTimeout=window.setTimeout(this.connectTimedOut.bind(this),1e4)),this.attemptConnect(S)}attemptConnect(b){this.traceId=b||Qs(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:S,rawToken:C}=this.token;this.connecting=!0,this.closing=!1;try{const O=encodeURIComponent(this.traceId.value);this.socket=this.createWebSocket(`${this.addr}?topic=${S}/publishers&traceid=${O}`,C),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(O){const P=O instanceof Error?O.message:void 0,B=this.createError(Lt.EVENT_PLANE_WS_CREATE_FAILED,P);this.trackJoinFailed(B,this.getRetryCount()),this.emitter.emit(ul,B)}}send(b){var S;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(b)}`}),this.isReady()?(S=this.socket)===null||S===void 0||S.send(JSON.stringify(b)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const b=this.connecting,S=this.socket&&this.socket.readyState===this.socket.OPEN,C=this.socket&&this.socket.readyState===this.socket.CLOSING,O=this.getRetryCount();if(this.closing=!0,this.connecting=!1,this.cleanPingPongTimeouts(),window.clearTimeout(this.nextConnectionAttempt),window.clearTimeout(this.connectTimeout),this.connectionAttempts=0,this.connectTimeout=0,this.socket){if(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,S)this.trackJoinEnded(),this.emitter.emit(ll,"intentional-close");else if(b&&!C){const P=this.createError(Lt.OPERATION_ABORTED);this.trackJoinFailed(P,O),this.analyticsTracker.trackError(P),this.emitter.emit(ul,P)}}}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(b,S){return new WebSocket(b,S)}createError(b,S){return new Qn(Object.assign({action:Yt.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:mc.JOIN_RELATED,details:S},b))}on(b,S){this.emitter.on(b,S)}off(b,S){this.emitter.off(b,S)}isReady(){return this.logger.debug({msg:`${this.id}isReady called`}),!!this.socket&&this.socket.readyState===this.socket.OPEN}onMessage(b){this.logger.debug({msg:`${this.id}received message: ${b.data}`});try{const S=JSON.parse(b.data);switch(S.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const C=S.payload.sequenceNumber;C>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&nd()&&this.connectTimeout>0&&this.triggerSocketOpen(S),this.emitter.emit($g,S),this.latestSequenceNumber=C);break}case"PONG":this.receivedPong=!0,this.pongCount%2==0&&this.analyticsTracker.trackEventNoSharedProps(new dh({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp})),this.pongCount++;break;case"REFRESH":this.emitter.emit(jg);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(rh,S.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(nm,S.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(wu,S.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit(ld,S.payload);break;default:(0,ss.noop)()}}catch(S){this.logger.debug({msg:`onMessage JSON Parse error: ${S}`}),this.emitter.emit(vc,S)}}onError(b){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(b)}`})}onClose(b){if(this.logger.debug({msg:`${this.id}onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.cleanPingPongTimeouts(),this.closing)this.closing=!1;else if(!this.windowUnloading)if(this.connecting){let S=Math.pow(2,this.connectionAttempts-1);S>64&&(S=64),this.logger.debug({msg:`${this.id}reconnecting in ${S} seconds`}),window.clearTimeout(this.nextConnectionAttempt),this.nextConnectionAttempt=window.setTimeout(this.attemptConnect.bind(this),1e3*S);const C=this.createError(Lt.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,`code: ${b==null?void 0:b.code}, reason: ${b==null?void 0:b.reason}, wasClean: ${b==null?void 0:b.wasClean}`);this.trackJoinFailed(C,this.getRetryCount()),this.analyticsTracker.trackError(C)}else{this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(ll,"unknown");const S=this.createError(Lt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,`code: ${b==null?void 0:b.code}, reason: ${b==null?void 0:b.reason}, wasClean: ${b==null?void 0:b.wasClean}`);this.trackJoinEnded(),this.emitter.emit(ul,S)}}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),nd()?this.connectTimeout=window.setTimeout(()=>{this.triggerSocketOpen()},1e4):this.triggerSocketOpen()}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttempt),window.clearTimeout(this.connectTimeout),this.nextConnectionAttempt=0,this.connectTimeout=0}triggerSocketOpen(b){this.clearConnectionAttemptTimeouts();const S=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(),this.emitter.emit(cl,{retryCnt:S,traceId:this.traceId,initialStageState:b}),this.pingInterval=window.setInterval(this.ping.bind(this),3e4)}ping(){var b;this.logger.debug({msg:`${this.id}sending PING`});try{this.latestPingTimestamp=performance.now(),(b=this.socket)===null||b===void 0||b.send(JSON.stringify({type:"PING"})),this.sentPing=!0,this.receivedPong=!1,this.pongTimeout&&clearTimeout(this.pongTimeout),this.pongTimeout=window.setTimeout(this.pongTimedOut.bind(this),5e3)}catch(S){const C=S instanceof Error?S.message:void 0,O=this.createError(Lt.EVENT_PLANE_PING_SEND_FAIL,C);this.emitter.emit(ul,O)}}connectTimedOut(){const b=this.socket&&this.socket.readyState===this.socket.CONNECTING;this.connecting=!1,this.logger.debug({msg:`${this.id}Connect timed out!`});const S=this.createError(Lt.JOIN_TIMED_OUT);b&&this.trackJoinFailed(S,this.getRetryCount()),this.createError(Lt.JOIN_TIMED_OUT),this.emitter.emit(ul,S),this.close()}pongTimedOut(){if(this.sentPing&&!this.receivedPong){this.logger.debug({msg:`${this.id}Pong timed out!`});const b=this.createError(Lt.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(ul,b)}}cleanPingPongTimeouts(){this.sentPing=this.receivedPong=!1,window.clearTimeout(this.pongTimeout),window.clearInterval(this.pingInterval)}trackJoinAttempt(b){const{token:S,traceId:C}=this;this.analyticsTracker.trackEvent(new hh({token:S,eventEndpoint:(S==null?void 0:S.eventsURL)||"",whipEndpoint:(S==null?void 0:S.whipURL)||"",traceId:C}))}trackJoinFailed(b,S){const{token:C,traceId:O,code:P,message:B,fatal:J,nominal:te}=b;this.analyticsTracker.trackEvent(new pm({token:C,eventEndpoint:C.eventsURL,whipEndpoint:C.whipURL,traceId:O,code:P,message:B,fatal:J,nominal:te,retryCnt:S}))}trackJoinStarted(){this.analyticsTracker.trackEventNoSharedProps(new If({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:this.getRetryCount(),protocol:this.protocol,traceId:this.traceId}))}}var mm=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})},_c,yc,bc,wi;(function(x){x.SDP_EXCHANGE="xdp",x.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(_c||(_c={})),function(x){x.USER_INITIATED="user-initiated",x.CLIENT_RECONNECT="reconnect",x.TOKEN_REUSED="token-reused",x.UNKNOWN="unknown",x.PARTICIPANT_DISCONNECTED="participant-disconnected",x.STAGE_DELETED="stage-deleted"}(yc||(yc={})),function(x){x[x.NOT_CONNECTED=0]="NOT_CONNECTED",x[x.CONNECTION_LOST=1]="CONNECTION_LOST",x[x.TIMEDOUT=2]="TIMEDOUT",x[x.ABORTED=3]="ABORTED",x[x.INVALID_MESSAGE=4]="INVALID_MESSAGE",x[x.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"}(bc||(bc={})),function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"}(wi||(wi={}));class gm extends lo{constructor(b,S,C){super(),this.token=b,this.nonScopedLogger=S,this.analyticsTracker=C,this.participants=new Map,this.disconnected=[],this.state={value:wi.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(O,P)=>{this.logger.debug({msg:"onConnecting",context:O,event:P}),O.connectStartTime=performance.now();const B=P.type==="RECONNECT";B&&this.stageSocket.close();const{eventsURL:J}=this.token;this.emit(Tu,wi.CONNECTING),this.state.value=wi.CONNECTING;const te=!B;this.stageSocket.connect(J,this.traceId,te)},this.onConnected=(O,P)=>{this.logger.debug({msg:"onConnected",context:O,event:P}),O.hasConnected=!0,this.emit(Go),this.emit(Tu,wi.CONNECTED),this.state.value=wi.CONNECTED},this.onDisconnected=(O,P)=>{this.logger.debug({msg:"onDisconnected",context:O}),this.state.value=wi.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),O.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(Tu,wi.DISCONNECTED,P)},this.onErrored=(O,P)=>{this.logger.error({msg:"Connection failure occurred",err:P.payload.error}),this.emit(Tu,wi.ERRORED),this.emit(Fy,P.payload.error),this.state.value=wi.ERRORED,O.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=O=>{const P=this.state.value,B=this.state.context;switch(P){case wi.DISCONNECTED:O.type==="CONNECT"&&this.onConnecting(B,O);break;case wi.CONNECTING:O.type==="RECONNECT"?this.onConnecting(B,O):O.type==="DISCONNECT"?this.onDisconnected(B,O.reason):O.type==="CONNECT_SUCCESS"?this.onConnected(B,O):O.type==="ERROR"&&this.onErrored(B,O);break;case wi.CONNECTED:O.type==="RECONNECT"?this.onConnecting(B,O):O.type==="DISCONNECT"?this.onDisconnected(B,O.reason):O.type==="ERROR"&&this.onErrored(B,O);break;case wi.ERRORED:O.type==="RECONNECT"?this.onConnecting(B,O):O.type==="DISCONNECT"&&this.onDisconnected(B,O.reason)}},this.measureConnect=(O,P)=>{const B=this.stats.edpConnectCount,J=B+1,te=performance.now(),z=te-P;return Object.assign(this.stats,{edpConnectCount:J,edpConnectDuration:z}),B===0&&Object.assign(this.stats,{edpInitialStartConnectTime:P,edpInitialFinishConnectTime:te,edpInitialConnectDuration:z,edpInitialConnectRetries:O}),this.stats},this.measureStateUpdate=O=>{const{edpInitialFinishConnectTime:P}=this.stats,B=this.stats.edpStateUpdateCount,J=B+1;return Object.assign(this.stats,{edpStateUpdateCount:J}),B===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-P,edpInitialStatePublishingCount:O}),this.stats},this.trackMessageParseError=O=>{this.logger.error({msg:"Message Parse Error occurred",err:O.err});const P=new Qn({token:O.token,traceId:O.traceId,code:Lt.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:O.tag,location:O.location,message:O.message,details:O.err.message});this.analyticsTracker.trackEvent(new Yd(P))},this.trackStageSocketMessageParseError=(O,P,B)=>{this.trackMessageParseError({token:O,traceId:P,tag:mc.JOIN_RELATED,location:"StageConnection.onMessage",message:Lt.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:B})},this.trackStageStateMessageParseError=(O,P,B,J)=>{this.trackMessageParseError({token:O,traceId:P,tag:mc.JOIN_RELATED,location:"StageConnection.onStageStateMessage",message:J,err:B})},this.onDisconnectMessage=O=>{this.analyticsTracker.trackEventNoSharedProps(new _f(this.token,this.traceId,`DISCONNECT message received: ${O.code}:${O.reason}`,Yt.JOIN));let P=yc.UNKNOWN;if(O.code==="PARTICIPANT_DISCONNECTED")P=yc.PARTICIPANT_DISCONNECTED;else if(O.code==="STAGE_DELETED")P=yc.STAGE_DELETED;else if(O.code==="TOKEN_REUSED"&&(P=yc.TOKEN_REUSED,bu("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${O.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:P})},this.onReassignmentMessage=O=>{this.emit($s,O)},this.onIncompatibleCodecsMessage=O=>{this.emit(cd,O)},this.onStageStateMessage=(O,P,B)=>{var J,te;this.logger.debug({msg:"State Stage Message occurred",state:B});const z=B.payload,re=(J=z.participants)!==null&&J!==void 0?J:[],ce=(te=z.disconnected)!==null&&te!==void 0?te:[],de=[],ke=[];this.measureStateUpdate(re.length),this.enableFeaturesBasedOnServerFeatures(z.serverFeatures||[]);const Qe=(Be,Me)=>{this.analyticsTracker.trackEventNoSharedProps(new fm({token:O,otherParticipantId:Be.id,otherParticipantUserId:Be.userId,isAudioMuted:Be.audioMuted,isVideoStopped:Be.videoStopped,isPublishing:Be.isPublishing,isDisconnected:Me,traceId:P}))};this.participants.forEach(Be=>{const Me=re.find(Te=>Te.id===Be.id);if(Me){let Te=!0,gt=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach(Ut=>{Te=Te&&Me[Ut.toString()]===Be[Ut.toString()],Te||(Be[Ut.toString()]=Me[Ut.toString()],gt=!0)}),Object.keys(Be.attributes).forEach(Ut=>{Te=Te&&Me.attributes[Ut]===Be.attributes[Ut],Te||(Be.attributes=Me.attributes,gt=!0)}),gt&&(Qe(Be,!1),this.emit(ks,Me))}else ke.push(Be)}),re.forEach(Be=>{this.participants.get(Be.id)||de.push(Be)}),ke.forEach(Be=>{this.participants.delete(Be.id),Qe(Be,!0),this.emit(Pi,Be)}),de.forEach(Be=>{this.participants.set(Be.id,Be),Qe(Be,!1),this.emit(gc,Be)}),ce.forEach(Be=>{this.disconnected.find(Me=>Me.id===Be.id)||(this.disconnected.push(Be),Be.status==="KICKED"&&this.emit(os,Be))}),this.disconnected=ce},this.nonScopedLogger=S,this.logger=new Ks(S,pe.CONNECTION),this.stageSocket=new Y_(b,this.nonScopedLogger,C),this.token=b,this.traceId=Qs()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(b){return mm(this,void 0,void 0,function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:b}),this.traceId=b,this.state.value!==wi.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:yc.CLIENT_RECONNECT})),new Promise((S,C)=>{this.stageSocket.on(cl,O=>{var P,B;const{retryCnt:J,initialStageState:te}=O;te&&this.enableFeaturesBasedOnServerFeatures((B=(P=te.payload)===null||P===void 0?void 0:P.serverFeatures)!==null&&B!==void 0?B:[]),this.traceId=O.traceId||Qs(),this.measureConnect(J,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),S(this.traceId)}),this.stageSocket.on(ul,O=>{C(O),this.processStateUpdate({type:"ERROR",payload:{error:O}})}),this.stageSocket.on(jg,()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit(tm),this.processStateUpdate({type:"RECONNECT"})}),this.stageSocket.on($g,O=>this.onStageStateMessage(this.token,this.traceId,O)),this.stageSocket.on(vc,O=>this.trackStageSocketMessageParseError(this.token,this.traceId,O)),this.stageSocket.on(nm,this.onDisconnectMessage),this.stageSocket.on(wu,this.onReassignmentMessage),this.stageSocket.on(ld,this.onIncompatibleCodecsMessage),this.stageSocket.on(ll,O=>{this.stopStageMinuteLoggedInterval()}),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:b}})})})}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:yc.USER_INITIATED}),this.traceId}getParticipant(b){return this.participants.get(b)}listConnectedParticipants(){const b=[];return this.participants.forEach(S=>{S.subscribed&&b.push(S)}),b}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(b,S){this.stageSocket.send({audioMuted:b,type:"SET_STATE",version:"0",videoStopped:S})}setStagePublishing(b){this.isStagePublishing=b,this.emit(mf,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(b,S){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new Xo(b,S,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval(()=>{this.analyticsTracker.trackEvent(new Xo(b,S??Qs(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++},6e4))}stopStageMinuteLoggedInterval(b=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),b&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(b){const S=(B,J)=>{this.trackStageStateMessageParseError(this.token,this.traceId,J,`Could not parse "${B}" from the Eevee server features list`)},C=b.includes(_c.SDP_EXCHANGE);this.features.sdpExchange!==C&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${C}`}),this.features.sdpExchange=C);const O=b.find(B=>B.indexOf(_c.JITTER_BUFFER_MIN_DELAY_MS)!==-1),P=B=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${B}`}),this.features.jitterBufferMinDelayInMs=B};if(O!==void 0)try{const B=O.split("=")[1],J=parseInt(B,10);if(isNaN(J))throw new Error("Unable to parse - result is NaN");if(J<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===J||P(J)}catch(B){S(O,B),P(void 0)}else P(void 0)}isConnected(){return this.state.value===wi.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(b,S,C,O,P,B,J,te,z){return mm(this,void 0,void 0,function*(){return this.isConnected()?new Promise((re,ce)=>{const de=window.setTimeout(()=>{ke(),ce(bc.TIMEDOUT)},8e3),ke=()=>{window.clearTimeout(de),this.stageSocket.off(rh,Qe),this.stageSocket.off(ul,Be)},Qe=Me=>{Me.requestId===O&&(ke(),re(Me))},Be=()=>{ke(),ce(bc.CONNECTION_LOST)};P==null||P.addEventListener("abort",()=>{ke(),ce(bc.ABORTED)}),this.stageSocket.on(rh,Qe),this.stageSocket.on(ul,Be),this.stageSocket.sendSdpOffer(b,S,C,O,B,J,te,z)}):Promise.reject(bc.NOT_CONNECTED)})}}class xi{constructor(b){this.token=b}}var Cr=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};const ps={[bc.ABORTED]:Lt.OPERATION_ABORTED,[bc.NOT_CONNECTED]:Lt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[bc.CONNECTION_LOST]:Lt.XDP_CONNECTION_LOST,[bc.TIMEDOUT]:Lt.XDP_TIMEOUT,[bc.INVALID_MESSAGE]:Lt.XDP_INVALID_ANSWER_MSG,[bc.UNEXPECTED_ERROR]:Lt.XDP_UNEXPECTED_ERROR};class ms extends xi{constructor(b,S,C,O){super(b),this.token=b,this.stageConnection=S,this.contextData=C,this.analyticsTracker=O}exchange(b){return Cr(this,void 0,void 0,function*(){const S=Js(),{action:C}=this.contextData,{sdpOffer:O,url:P,traceId:B,forceNode:J,assignmentToken:te,multiCodec:z,abortController:re,initialLayerPreference:ce}=b;let de;this.trackAttempt(P,S,B);try{de=yield this.stageConnection.exchangeSdp(O,P,B.value,S.value,re==null?void 0:re.signal,J,te,z,ce)}catch(en){if(typeof en=="number")throw this.createClientSideErrorFromReasonCode(en,B,S,C)}if(!de)return;const{httpStatusCode:ke,errorCode:Qe,location:Be,content:Me,sessionDeleteLink:Te,subscriberControlLink:gt,videoLayersLink:Ut}=de;if(ke>=200&&ke<300)return{sdpAnswer:Me,url:P,location:Be,sessionDeleteLink:Te,mediaControls:gt,layerControls:Ut};throw this.createServerSideError(B,S,ke,Qe,C)})}trackAttempt(b,S,C){const{remoteParticipantId:O,action:P}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new xu(P,this.token,b,"POST",S.value,O,C,"xdp"))}createServerSideError(b,S,C,O,P){const B=this.baseErrorProps(b,S);let J=nh(C,O);return J||(J=Lt.UNKNOWN_SERVER_ERROR),new Qn(Object.assign(Object.assign({action:P},B),J))}baseErrorProps(b,S){const{remoteParticipantId:C,action:O}=this.contextData;return{token:this.token,traceId:b,tag:uo(O,C),location:"EdpSdpExchanger.exchange",requestUUID:S,remoteParticipantId:C}}createClientSideErrorFromReasonCode(b,S,C,O){const P=this.baseErrorProps(S,C),B=ps[b];return new Qn(B?Object.assign(Object.assign({action:O},P),B):Object.assign(Object.assign({action:O},P),Lt.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}const zs=new RegExp("^(?:[a-z+]+:)?//","i");function Zs(x){return zs.test(x)}var kn=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};class gs extends xi{constructor(b,S,C){super(b),this.contextData=S,this.analyticsTracker=C}exchange(b){return kn(this,void 0,void 0,function*(){const S=Js(),{token:C}=this,{action:O,remoteParticipantId:P}=this.contextData,{sdpOffer:B,url:J,traceId:te,forceNode:z,assignmentToken:re,multiCodec:ce,abortController:de,initialLayerPreference:ke}=b;try{const Be="POST",Me="http";this.analyticsTracker.trackEventNoSharedProps(new xu(O,C,J,Be,S.value,P,te,Me));const Te={data:B,headers:{Authorization:`Bearer ${C.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":S.value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":te.value,"X-Stages-WHIP-Version":qo,"X-Stages-Options":(Qe=JSON.stringify({cap:["sau"]}),btoa(Qe).replace(/[^A-Za-z0-9+/]/g,""))},method:Be,responseType:"text",url:J,signal:de==null?void 0:de.signal,params:{}};z&&(Te.params.force_node=z),re&&(Te.params.assignment_token=re),ce&&(Te.params.multi_codec=!0);const gt=uf()===void 0,Ut=uf()||gt;ke&&Te.headers&&Ut&&(Te.headers["X-Stages-Initial-Layer-Pref"]=tv(ke));const{data:en,headers:Pt,request:Hn}=yield ud(Te),Ln=this.parseWhipResource(J,Pt.location,Pt.link);return{url:Hn.responseURL,sdpAnswer:en,location:Ln==null?void 0:Ln.location,sessionDeleteLink:Ln==null?void 0:Ln.sessionDeleteLink,mediaControls:Ln==null?void 0:Ln.mediaControls,layerControls:Ln==null?void 0:Ln.layerControls}}catch(Be){if(hs().isCancel(Be))throw new Qn(Object.assign(Object.assign({},Ai(Lt.OPERATION_ABORTED,Be)),{action:O,token:C,traceId:te,tag:uo(O,P),location:"StagePeerClient.start",requestUUID:S,remoteParticipantId:P}));const Me=function(Te,gt){var Ut;return Te instanceof oi.AxiosError&&Te.response&&typeof Te.response.status=="number"?Te instanceof oi.AxiosError&&Te.code==="ERR_NETWORK"?Lt.NETWORK_FAILURE:nh(Number(Te.response.status),(Ut=Te.response.data)===null||Ut===void 0?void 0:Ut.code)||gt:gt}(Be,Lt.WHIP_POST_FAILURE);throw new Qn(Object.assign(Object.assign({},Ai(Me,Be)),{action:O,token:C,traceId:te,tag:uo(O,P),location:"StagePeerClient.start",requestUUID:S,remoteParticipantId:P}))}var Qe})}parseWhipResource(b,S,C){const O=new URL(b);let P;return P=function(B,J,te){if(!te)return B;if(B||(B={}),Zs(te))return B.location=te,B;const z=J.port?`:${J.port}`:"";return B.location=`${J.protocol}//${J.hostname}${z}${te}`,B}(P,O,S),P=function(B,J,te){if(!te)return B;B||(B={});const z=B;return te.split(",").forEach(re=>{const ce=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(re);if((ce==null?void 0:ce.length)!==3)return;let de;if(Zs(ce[1]))de=ce[1];else{const ke=J.port?`:${J.port}`:"";de=`${J.protocol}//${J.hostname}${ke}${ce[1]}`}switch(ce[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":z.sessionDeleteLink=de;break;case"urn:ietf:params:whep:core:playback-controls":z.mediaControls=de;break;case"urn:ietf:params:whep:ext:core:layer":z.layerControls=de;break;default:return}}),z}(P,O,C),P}getTransport(){return"http"}}var In=i(1564);function Ga(x){return x.track.kind===Wl.AUDIO}function pd(x){return x.track.kind===Wl.VIDEO&&typeof x.config=="object"}const vm=(x,b)=>function(S){return S.kind===Wl.AUDIO}(x)?((S,C)=>{var O;const P={maxBitrateBps:Mo((O=C==null?void 0:C.maxAudioBitrateKbps)!==null&&O!==void 0?O:64)},B=C==null?void 0:C.stereo;return typeof B=="boolean"&&(P.stereo=B),{track:S,config:P}})(x,b):((S,C)=>{var O,P,B,J;const te=(O=C==null?void 0:C.minBitrate)!==null&&O!==void 0?O:yf,z=(P=C==null?void 0:C.maxBitrate)!==null&&P!==void 0?P:sh,re=(B=C==null?void 0:C.maxFramerate)!==null&&B!==void 0?B:ql,ce=!!(!((J=C==null?void 0:C.simulcast)===null||J===void 0)&&J.enabled);return{track:S,config:{minBitrateBps:Mo(te),maxBitrateBps:Mo(z),maxFramerate:re,simulcastEnabled:ce,inBandMessagingEnabled:!1}}})(x,b),as=(x,b)=>{if(typeof x=="number")return x;const S=b?Kg:bf;return S[x]!==void 0?S[x]:0};function Jo(x){if(x<yf||x>sh)throw new Error(`Stage bitrate must be between ${yf} kbps and ${sh} kbps`)}function iv(x,b){const S=Ef();let C=Object.assign({},S,(0,ss.cloneDeep)(b));return C=function(O,P){var B,J,te;const z=Object.assign({},(0,ss.cloneDeep)(P)),re=!Yo.browser.isChrome()&&!Yo.browser.isEdge(),ce=(te=(J=(B=O.getSettings)===null||B===void 0?void 0:B.call(O))===null||J===void 0?void 0:J.displaySurface)!==null&&te!==void 0&&te,de=Mo(z.maxBitrate)<oh.maxBitrate;return(re||ce||de)&&(z.simulcast.enabled=!1),z}(x,C),Jo(C.maxBitrate),Jo(C.minBitrate),function(O){if(O&&(O>ql||O<qg))throw new Error(`framerate cannot exceed ${ql} fps`)}(C.maxFramerate),function(O){if(O<sm||O>Ao)throw new Error(`Stage audio bitrate must be between ${sm} kbps and ${Ao} kbps`)}(C.maxAudioBitrateKbps),function(O){if(typeof O!="boolean")throw new Error("Stage stereo prop must be a boolean")}(C.stereo),C}function _m({stageErrorValue:x,action:b,token:S,traceId:C,tag:O,identifier:P,details:B}){return new Qn(Object.assign(Object.assign({},x),{token:S,traceId:C,location:"peer-client",tag:O,action:b,remoteParticipantId:P,details:B}))}var Ii;function eo(x){var b;return!((b=x==null?void 0:x.sender)===null||b===void 0)&&b.createEncodedStreams?Ii.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?Ii.ENCODED_TRANSFORMS:Ii.NONE}function kf(x){var b;return!((b=x==null?void 0:x.receiver)===null||b===void 0)&&b.createEncodedStreams?Ii.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?Ii.ENCODED_TRANSFORMS:Ii.NONE}function Xl(x){let b=[];const S=new Map;function C(O){const P="0123456789abcdef";let B="";for(let J=0;J<O;J+=1)B+=P.charAt(Math.floor(Math.random()*P.length));return B}return{add(O){const P=C,B=`${P(8)}-${P(4)}-${P(4)}-${P(4)}-${P(12)}`,J=Date.now();return b.push({id:B,enqueuedAt:J,payload:O}),B},poll(O){return S.has(O)||S.set(O,[]),S.size>=x&&(S.forEach(P=>{P.push(...b)}),b=[]),(S.get(O)||[]).splice(0,1)}}}function sv(x,b){return b.type==="sei"?function(S,C){const J=new Uint8Array([1,2,1,8,1,2,3,4,2,2,2,4,4,3,2,1]);function te(ce,de,ke){return ke+de.length<=ce.byteLength&&de.every((Qe,Be)=>ce.getUint8(ke+Be)===Qe)}function z(ce,de){const ke=function(Be,Me){return new Uint8Array([0,0,1,6,5,...Me,...Be])}(ce,function(Be){const Me=[];for(;Be>=255;)Me.push(255),Be-=255;return Me.push(Be),new Uint8Array(Me)}(de.length+ce.length)),Qe=function(Be){const Me=[...Be];let Te=3;for(;Te<Me.length-2;)Me[Te]!==0||Me[Te+1]!==0||Me[Te+2]!==0&&Me[Te+2]!==1&&Me[Te+2]!==2&&Me[Te+2]!==3?Te+=1:(Me.splice(Te+2,0,3),Te+=3);return Me}(new Uint8Array([...ke,...de,128]));return new Uint8Array(Qe)}function re(ce,de){const ke=function(Qe){const Be=new DataView(Qe);for(let Me=0;Me<Be.byteLength-4;Me++)if(te(Be,[0,0,1],Me)){const Te=31&Be.getUint8(Me+3);if(Te>=1&&Te<=5)return Me}return-1}(S.data);if(ke>=0){const Qe=new ArrayBuffer(S.data.byteLength+de.byteLength),Be=new Uint8Array(Qe);return Be.set(new Uint8Array(S.data.slice(0,ke)),0),Be.set(de,ke),Be.set(new Uint8Array(S.data.slice(ke)),ke+de.byteLength),Qe}return ce}return function(){for(let ce=0;ce<C.length;ce+=1){const de=z(J,new Uint8Array(C[ce]));S.data=re(S.data,de)}return S}()}(x,b.payloads||[]):x}function Dc(x,b){const{type:S,transformerId:C}=b;if(S==="sei"){const O=function(J){function re(ke,Qe,Be){return Be+Qe.length<ke.byteLength&&Qe.every((Me,Te)=>ke.getUint8(Be+Te)===Me)}function ce(ke){const Qe=[];let Be=0;for(;Be<ke.length;)ke[Be]===0&&ke[Be+1]===0&&ke[Be+2]===3?(Qe.push(ke[Be]),Qe.push(ke[Be+1]),Be+=3):(Qe.push(ke[Be]),Be+=1);return new Uint8Array(Qe)}function de(ke){let Qe=2;const Be=ke.byteLength;for(;Qe<Be;){let Me=0;for(;Qe<Be&&ke[Qe]===255;)Me+=255,Qe++;Me+=ke[Qe],Qe++;const Te=Math.min(Qe+Me,Be),gt=new Uint8Array(ke.slice(Qe,Te));return{uuid:gt.slice(0,16),payload:gt.slice(16)}}}return{messages:function(ke){const Qe=new DataView(ke.data),Be=[];let Me=0;if(!re(Qe,[0,0,1],0)&&!re(Qe,[0,0,0,1],0))return[];for(;Me<Qe.byteLength-5;)if(re(Qe,[0,0,1],Me)){const Te=Me+3;Me=Te;const gt=31&Qe.getUint8(Me),Ut=31&Qe.getUint8(Me+1);if(gt===6&&Ut===5){for(;Me<Qe.byteLength&&!re(Qe,[0,0,1],Me);)Me++;const en=Me,Pt=de(ce(new Uint8Array(ke.data.slice(Te,en))));Pt&&Be.push(Object.assign(Object.assign({},Pt),{timestamp:ke.timestamp,type:ke.type}))}else Me++}else Me++;return Be}(J),frame:J}}(x),{frame:P,messages:B}=O;return{success:!0,frame:P,type:S,transformerId:C,seiResult:B}}return{success:!0,frame:x,transformerId:C,type:S}}function ym(){let x;const b=O=>(P,B)=>{const J=P.getMetadata().synchronizationSource,te=(x?x.poll(J):[]).map(z=>z.payload);B.enqueue("<SEND_TRANSFORMER_IMPL>"(P,Object.assign(Object.assign({},O),{payloads:te})))},S=O=>(P,B)=>{try{const J="<RECEIVE_TRANSFORMER_IMPL>"(P,O);B.enqueue(J.frame),self.postMessage(Object.assign(Object.assign({success:J.success},O),{seiResult:J.seiResult}))}catch{self.postMessage(Object.assign({success:!1},O))}};function C(O,P,B,J){const te=new TransformStream({transform:O==="video/send"?b(P):S(P)});B.pipeThrough(te).pipeTo(J)}return self.onrtctransform=O=>{const P=O.transformer;P&&C(P.options.method,P.options,P.readable,P.writable)},self.onmessage=O=>{var P;const{operation:B,transformerId:J}=O.data;B==="insert"?(x||(x="<CREATE_MESSAGE_QUEUE>"(1)),x.add((P=O.data)===null||P===void 0?void 0:P.payload)):B!=="video/receive"&&B!=="video/send"||C(B,{method:B,transformerId:J,type:"sei"},O.data.readable,O.data.writable)},{videoReceiveTransform:S,videoSendTransform:b}}(function(x){x.NONE="none",x.ENCODED_TRANSFORMS="encodedTransforms",x.INSERTABLE_STREAMS="insertableStreams"})(Ii||(Ii={}));const Nf=()=>{let x=ym.toString();return x=x.replace('"<SEND_TRANSFORMER_IMPL>"',sv.toString()),x=x.replace('"<RECEIVE_TRANSFORMER_IMPL>"',Dc.toString()),x=x.replace('"<CREATE_MESSAGE_QUEUE>"',Xl.toString()),x},md=(()=>{let x;return{getWorker:()=>(x||(x=function(){const b=new Blob([`(${Nf()})()`],{type:"text/javascript"}),S=URL.createObjectURL(b);return new Worker(S)}()),x),destroy:()=>{x&&x.terminate(),x=void 0}}})(),Pf="seiMessageReceived",ph="error";var Di;(function(x){x.CREATED="created",x.INITIALIZED="initialized",x.DESTROYED="destroyed"})(Di||(Di={}));class Ec extends lo{constructor({enabled:b}){super(),this.state=Di.CREATED,this.transformerId=Js().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=S=>{this.onTransformResult(S.data)},b||this.destroy()}initializeInsertableStreams(b){var S;this.worker=md.getWorker();const C=b.receiver.createEncodedStreams(),{readable:O,writable:P}=C;(S=this.worker)===null||S===void 0||S.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:O,writable:P},[O,P]),this.worker.addEventListener("message",this.onMessage)}initializeEncodedTransforms(b){this.worker=md.getWorker();const S={method:"video/receive",type:"sei",transformerId:this.transformerId};b.receiver.transform=new RTCRtpScriptTransform(this.worker,S),this.worker.addEventListener("message",this.onMessage)}initialize(b,S){if(this.state!==Di.CREATED)return!1;const C=kf(b);if(C===Ii.NONE)return!1;if(S&&C===Ii.INSERTABLE_STREAMS)this.initializeInsertableStreams(b);else{if(S||C!==Ii.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(b)}return this.transceiver=b,this.state=Di.INITIALIZED,!0}onTransceiverAdd(b){return this.initialize(b,!0)}onTrackEvent(b){return b.track.kind==="video"&&this.initialize(b.transceiver,!1)}static isSupported(b){return kf(b)!==Ii.NONE}onTransformResult(b){return b.transformerId===this.transformerId&&(b.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!b.seiResult&&(b.seiResult.forEach(S=>{const{payload:C,uuid:O}=S;this.updateReadStats(S),this.emit(Pf,{uuid:O,payload:C})}),b.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(b,Lt.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(b,Lt.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(b){this.seiReadCnt++,this.seiBytesRead+=b.payload.byteLength}getReceiverStats(){const{seiBytesRead:b,seiReadCnt:S}=this;return{seiReadCnt:S,seiBytesRead:b}}onError(b,S){const{type:C}=b;this.emit(ph,{type:C,stageErrorValue:S})}destroy(){var b,S;this.state!==Di.DESTROYED&&(this.removeAllListeners(),(b=this.worker)===null||b===void 0||b.removeEventListener("message",this.onMessage),!((S=this.transceiver)===null||S===void 0)&&S.receiver&&(this.transceiver.receiver.transform=null),this.state=Di.DESTROYED)}getState(){return this.state}}class va{constructor({enabled:b}){this.state=Di.CREATED,this.transformerId=Js().value,b||this.destroy()}initializeInsertableStreams(b,S){var C;this.worker=md.getWorker();const O=b.sender.createEncodedStreams(),{readable:P,writable:B}=O;(C=this.worker)===null||C===void 0||C.postMessage({operation:"video/send",transformerId:this.transformerId,readable:P,writable:B},[P,B])}initializeEncodedTransforms(b,S){this.worker=md.getWorker();const C={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:S};b.sender.transform=new RTCRtpScriptTransform(this.worker,C)}initialize(b){var S;if(this.state!==Di.CREATED)return!1;const C=eo(b);if(C===Ii.NONE)return!1;const O=b.sender.getParameters(),P=((S=O==null?void 0:O.encodings)===null||S===void 0?void 0:S.length)||1;if(C===Ii.INSERTABLE_STREAMS)this.initializeInsertableStreams(b,P);else{if(C!==Ii.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(b,P)}return this.transceiver=b,this.state=Di.INITIALIZED,!0}static isSupported(b){return eo(b)!==Ii.NONE}sendSeiMessage(b){var S;this.state===Di.INITIALIZED&&this.transceiver&&((S=this.worker)===null||S===void 0||S.postMessage({operation:"insert",transformerId:this.transformerId,payload:b}))}onTransceiverAdd(b){return this.initialize(b)}onTrackEvent(b){return!1}destroy(){var b;this.state!==Di.DESTROYED&&(!((b=this.transceiver)===null||b===void 0)&&b.receiver&&(this.transceiver.receiver.transform=null),this.state=Di.DESTROYED)}getState(){return this.state}}var vs=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};let to=null;class Df extends lo{constructor(b,S,C,O,P,B,J,te,z){var re,ce;if(super(),this.analyticsTracker=B,this.sfuResource={node:"",cluster:""},this.stageCapabilities={simulcastNegotiated:!1},this.incompatibleCodecs=new Set,this.connect=({audioOnly:de=!1,traceId:ke,iceRestartOptions:Qe})=>vs(this,void 0,void 0,function*(){const{token:Be,tag:Me,identifier:Te,action:gt}=this,Ut=!!Qe,en=new AbortController;let Pt,Hn,Ln;this.abortController=en,this.traceId=ke,this.perfTracker.resetMeasurements(ke);const Or=()=>{Pt&&this.off(fa,Pt),Hn&&this.off(Is,Hn)},Ur=new Promise((Fr,Br)=>{const vr=function({action:Pr,token:jr,traceId:er,tag:Sn,identifier:qn}){const vi=Pr===Yt.SUBSCRIBE?Lt.SUBSCRIBE_TIMED_OUT:Lt.PUBLISH_TIMED_OUT;return new Qn(Object.assign(Object.assign({},vi),{action:Pr,token:jr,traceId:er,tag:Sn,location:"connect",remoteParticipantId:qn}))}({action:gt,token:Be,traceId:ke,tag:Me,identifier:Te}),kr=function({action:Pr,token:jr,traceId:er,tag:Sn}){const qn=Lt.OPERATION_ABORTED;return new Qn(Object.assign(Object.assign({},qn),{token:jr,traceId:er,location:"peer-client.connect",tag:Sn,action:Pr}))}({action:gt,token:Be,traceId:ke,tag:Me}),Nr=setTimeout(()=>{this.stop(),this.analyticsTracker.trackError(vr),Br(vr)},1e4);Pt=Pr=>{clearTimeout(Nr),Ut||this.stop(),Br(Pr)},Hn=Pr=>{if(Pr===nt.CONNECTED)clearTimeout(Nr),Fr();else if(Pr===nt.FAILED){const jr=function({action:er,token:Sn,traceId:qn,tag:vi}){return new Qn(Object.assign(Object.assign({},Lt.PEER_CONNECTION_NETWORK_FAILURE),{token:Sn,traceId:qn,location:"peer-client.connect",tag:vi,action:er}))}({action:gt,token:Be,traceId:ke,tag:Me});clearTimeout(Nr),Br(jr)}},this.on(fa,Pt),this.on(Is,Hn),Ln=()=>{clearTimeout(Nr)},en.signal.aborted&&(clearTimeout(Nr),Br(kr)),en.signal.addEventListener("abort",()=>{clearTimeout(Nr),Br(kr)})});try{const Fr=yield Promise.all([vs(this,void 0,void 0,function*(){Ut||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(de));const vr=Qe==null?void 0:Qe.assignmentToken,kr=Qe==null?void 0:Qe.nodeOverride;return yield this.exchangeSdp({iceRestart:Ut,nodeOverride:kr,assignmentToken:vr,abortController:en}),this.mediaStream}),Ur]);this.statsReporter.traceId=ke;const Br=Fr[0];if(this.abortController=void 0,!Ut&&gt===Yt.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(vr){this.logger.error({err:vr,msg:"error syncing transceivers"})}return{mediaStream:Br}}catch(Fr){throw Ln&&Ln(),Fr}finally{Or()}}),this.disconnect=(de=!1)=>vs(this,void 0,void 0,function*(){var ke;const{token:Qe,action:Be}=this;(ke=this.abortController)===null||ke===void 0||ke.abort(),this.stop(),de?this.cleanup(Be,Qe.participantID,Qe,de):yield this.cleanup(Be,Qe.participantID,Qe,de)}),this.onTrack=de=>{const{token:ke,action:Qe,traceId:Be,identifier:Me}=this;this.trace(ke,Be,`onTrack: ${de.track.kind}`,Qe,Me),this.videoSenderTransformer.onTrackEvent(de),this.videoReceiverTransformer.onTrackEvent(de)},this.onIceGatheringStateChange=()=>{var de,ke,Qe;const{token:Be,action:Me,traceId:Te,identifier:gt}=this;if(((de=this.peerConnection)===null||de===void 0?void 0:de.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((ke=this.peerConnection)===null||ke===void 0?void 0:ke.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const Ut=this.peerConnection.iceGatheringState,en=new Gg(Me,Be,Te,Ut,gt);this.analyticsTracker.trackEventNoSharedProps(en)}this.trace(Be,Te,`ICE gathering state change: ${(Qe=this.peerConnection)===null||Qe===void 0?void 0:Qe.iceGatheringState}`,Me,gt)},this.onSelectedCandidatePairChange=()=>{var de,ke;const{token:Qe,action:Be,traceId:Me,identifier:Te}=this,gt=(ke=(de=this.peerConnection)===null||de===void 0?void 0:de.getReceivers()[0].transport)===null||ke===void 0?void 0:ke.iceTransport,Ut=gt==null?void 0:gt.getSelectedCandidatePair();if(Ut){const{local:en,remote:Pt}=Ut,Hn=`Selected candidate pair change (local, remote): ${en==null?void 0:en.candidate}, ${Pt==null?void 0:Pt.candidate}`;this.logger.debug({msg:Hn}),this.trace(Qe,Me,Hn,Be,Te)}},this.onIceCandidate=de=>vs(this,void 0,void 0,function*(){var ke,Qe;const{identifier:Be,action:Me,traceId:Te}=this,gt=(ke=de.target.localDescription)===null||ke===void 0?void 0:ke.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new _f(this.token,Te,`ice candidate: hasRelay = ${gt}, candidate = ${(Qe=de.candidate)===null||Qe===void 0?void 0:Qe.candidate}`,Me,Be))}),this.onMute=()=>vs(this,void 0,void 0,function*(){const{token:de,action:ke,traceId:Qe,identifier:Be}=this;this.trace(de,Qe,"Track has muted",ke,Be)}),this.onUnMute=()=>vs(this,void 0,void 0,function*(){const{token:de,action:ke,traceId:Qe,identifier:Be}=this;this.trace(de,Qe,"Track has unmuted",ke,Be)}),this.fetchAndSetRemoteDescription=de=>vs(this,void 0,void 0,function*(){var ke,Qe,Be,Me;const Te=(Qe=(ke=this.peerConnection)===null||ke===void 0?void 0:ke.localDescription)===null||Qe===void 0?void 0:Qe.sdp;Te||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:gt,traceId:Ut,action:en,identifier:Pt,tag:Hn}=this,{endpointURL:Ln,nodeOverride:Or,assignmentToken:Ur,multiCodec:Fr,abortController:Br}=de;let vr;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{this.perfTracker.setTransport(this.sdpExchanger.getTransport());const er=Or||lf("node")||lf("dataPlaneEndpoint");vr=yield this.sdpExchanger.exchange({sdpOffer:Te,url:Ln,traceId:Ut,forceNode:er,assignmentToken:Ur,multiCodec:Fr,abortController:Br,initialLayerPreference:(Be=this.simulcastSubscribeConfig)===null||Be===void 0?void 0:Be.initialLayerPreference})}catch(er){let Sn=er;Sn instanceof Qn||(Sn=new Qn(Object.assign(Object.assign({},Lt.UNEXPECTED_ERROR),{action:en,token:gt,traceId:Ut,tag:Hn,details:er instanceof Error?er.message:"",location:"sdp-exchange"}))),Sn instanceof Qn&&(this.analyticsTracker.trackError(Sn),this.emit(fa,Sn))}if(this.perfTracker.markSdpExchangeStop(),!vr)return;const{location:kr,sessionDeleteLink:Nr,mediaControls:Pr}=vr;let jr=vr.sdpAnswer;try{jr=this.mungeSdpAnswer(jr),vr.sdpAnswer=jr}catch(er){this.logger.error({err:er,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=jr,this.emit(rl,vr),kr&&(this.whipResource={location:kr,sessionDeleteLink:Nr,mediaControls:Pr},this.sfuResource=function(er){const Sn=er.match(/https:\/\/([^/]+)\//);if(Sn){const qn=Sn[1].split(".");if(qn[0].includes("video-rtx"))return{node:`${qn[0]}.${qn[1]}`,cluster:qn[1]}}}(kr)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(Me=this.peerConnection)===null||Me===void 0?void 0:Me.setRemoteDescription({sdp:jr,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(er){const Sn=new Qn(Object.assign(Object.assign({},Lt.SET_ANSWER_FAILURE),{action:en,token:gt,traceId:Ut,tag:uo(en,Pt),location:"setRemoteDescription",remoteParticipantId:Pt,details:er instanceof Error?er.message:""}));this.analyticsTracker.trackError(Sn),this.emit(fa,Sn)}}),this.cleanup=(de,ke,Qe,Be=!1)=>vs(this,void 0,void 0,function*(){var Me,Te,gt;const Ut=Js();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,!(!((Me=this.whipResource)===null||Me===void 0)&&Me.location))return this.trace(Qe,this.traceId,"whipResource location not known, exiting cleanup",de,ke),void this.analyticsTracker.trackError(new Qn(Object.assign(Object.assign({},Lt.WHIP_URL_MISSING),{action:de,token:Qe,traceId:this.traceId,tag:uo(de,ke),location:de===Yt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Ut,remoteParticipantId:ke})));let en=this.whipResource.location;if(this.trace(Qe,this.traceId,`use hostnamecachedurl: ${en}`,de,ke),Be){if(!((gt=this.whipResource)===null||gt===void 0)&&gt.sessionDeleteLink){en=this.whipResource.sessionDeleteLink,this.trace(Qe,this.traceId,`DELETE via session-delete beacon path: ${en}`,de,ke);try{navigator.sendBeacon(en,JSON.stringify({authorization:Qe.rawToken}))}catch(Pt){this.analyticsTracker.trackErrorAndThrow(new Qn(Object.assign(Object.assign({},Ai(Lt.WHIP_DELETE_FAILURE,Pt)),{action:de,token:Qe,traceId:this.traceId,tag:uo(de,ke),location:Yt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Ut,remoteParticipantId:ke})))}}}else try{yield hs().delete(en,{headers:{Authorization:`Bearer ${Qe.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":Ut.value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":qo}})}catch(Pt){((Te=Pt.response)===null||Te===void 0?void 0:Te.status)===404?this.trace(Qe,this.traceId,`DELETE returned 404, ignoring, action = ${de}, uuid = ${Ut.value}`,de,ke):this.analyticsTracker.trackErrorAndThrow(new Qn(Object.assign(Object.assign({},Ai(Lt.WHIP_DELETE_FAILURE,Pt)),{action:de,token:Qe,traceId:this.traceId,tag:uo(de,ke),location:Yt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Ut,remoteParticipantId:ke})))}}),this.getConnectionState=()=>{if(!this.peerConnection)return nt.NONE;const de=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return By(de)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:de}),nt.IDLE}},this.onIceCandidateError=de=>{const{token:ke,traceId:Qe,tag:Be}=this;if(de.errorCode!==701){const Me=new Qn(Object.assign(Object.assign({},Lt.ICE_CANDIDATE_ERROR),{action:this.action,token:ke,traceId:Qe,tag:Be,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(Me),this.emit(fa,Me)}},this.onIceConnectionStateChange=()=>{var de;const{token:ke,traceId:Qe,action:Be,identifier:Me}=this;this.trace(ke,Qe,`ICE connection state change: ${(de=this.peerConnection)===null||de===void 0?void 0:de.iceConnectionState}`,Be,Me),this.onConnectionStateChange()},this.createVideoReceiverTransformer=({enabled:de})=>{const ke=new Ec({enabled:de}),{token:Qe,tag:Be,identifier:Me,action:Te,traceId:gt}=this;ke.on(Pf,Pt=>{this.emit(sd,Pt)});const Ut=function(Pt,Hn){let Ln=0;return function(...Or){const Ur=Date.now();Ur-Ln>=Hn&&(Ln=Ur,Pt(...Or))}}(Pt=>{const Hn=`Transform error occurred: ${Pt.type}`,Ln=_m({traceId:gt,token:Qe,tag:Be,identifier:Me,action:Te,details:Hn,stageErrorValue:Lt.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:Ln,msg:"Error encountered when transforming receiver",error:Pt})},1e3),en=Pt=>{const Hn=`Too many errors occurred: ${Pt.type}`,Ln=_m({traceId:gt,token:Qe,tag:Be,identifier:Me,action:Te,details:Hn,stageErrorValue:Lt.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:Ln,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:Pt}),ke.destroy(),this.analyticsTracker.trackError(Ln),this.emit(ot,Ln)};return ke.on(ph,Pt=>{Pt.stageErrorValue.code!==Lt.TRANSFORM_TOO_MANY_ERRORS.code?Ut(Pt):en(Pt)}),ke},this.onConnectionStateChange=()=>{var de;if(this.peerConnection){const Qe=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:Be,traceId:Me,identifier:Te,action:gt}=this,Ut=new fo(gt,Be,Me,Qe,Te);this.analyticsTracker.trackEventNoSharedProps(Ut),this.trace(Be,Me,`connection state change: ${Qe}`,gt,Te)}const ke=this.getConnectionState();switch(ke){case nt.CONNECTED:this.perfTracker.markActionStop(),this.emit(Is,ke),this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub),(de=this.peerConnection)===null||de===void 0||de.getTransceivers().forEach(Qe=>{var Be,Me;!((Me=(Be=Qe.receiver)===null||Be===void 0?void 0:Be.transport)===null||Me===void 0)&&Me.iceTransport&&Qe.receiver.transport.iceTransport.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)});break;case nt.FAILED:this.emit(Is,ke),this.handleConnectionFailure();break;default:this.emit(Is,ke)}},this.onIncompatibleCodecs=de=>vs(this,void 0,void 0,function*(){if(de.forEach(Be=>{let Me=!1;this.incompatibleCodecs.forEach(Te=>{Te.config===Be.config&&Te.mime===Be.mime&&(Me=!0)}),Me||this.incompatibleCodecs.add(Be)}),this.peerConnection)try{yield(ke=this.peerConnection,Qe=[...this.incompatibleCodecs],Sf(void 0,void 0,void 0,function*(){var Be;for(const Me of ke.getSenders()){const Te=Me.getParameters();if(Te.codecs.length>1){const gt=Te.codecs[0];let Ut=!1;for(const en of Qe)H_(gt,en)&&(Ut=!0);if(Ut){const en=Yg(Qe,Te.codecs);(Be=Te.encodings)===null||Be===void 0||Be.forEach(Pt=>{Pt.active&&(Pt.codec=en)}),yield Me.setParameters(Te)}}}}))}catch(Be){const{token:Me,action:Te,traceId:gt,identifier:Ut}=this,en=new Qn(Object.assign(Object.assign({},Lt.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:Te,token:Me,traceId:gt,tag:uo(Te,Ut),location:"onIncompatibleCodecs",remoteParticipantId:Ut,details:Be instanceof Error?Be.message:""}));this.analyticsTracker.trackError(en),this.emit(fa,en)}var ke,Qe}),this.token=b,this.logger=new Ks(S,pe.WEBRTC),this.action=C,this.tag=O,this.traceId=P,C===Yt.SUBSCRIBE&&!J)throw new Error("Subscribe action provided without subscriber Id");this.inBandMessagingEnabled=C===Yt.SUBSCRIBE?!!(!((re=z==null?void 0:z.inBandMessaging)===null||re===void 0)&&re.enabled):(ce=bu("enableInBandMessaging"))!==null&&ce!==void 0&&ce,this.jitterBufferConfig=z==null?void 0:z.jitterBuffer,this.simulcastSubscribeConfig=z==null?void 0:z.simulcast,this.subscriberId=J,this.stageConnection=te,this.videoSenderTransformer=new va({enabled:this.action===Yt.PUBLISH&&this.inBandMessagingEnabled}),this.videoReceiverTransformer=this.createVideoReceiverTransformer({enabled:this.action===Yt.SUBSCRIBE&&this.inBandMessagingEnabled}),this.perfTracker=new $_(this.action,this.traceId),this.statsReporter=new Rf(C,b,P,this.identifier,this.analyticsTracker,this.videoReceiverTransformer),this.sdpExchanger=function(de){const{connection:ke,token:Qe,action:Be,identifier:Me,tracker:Te}=de,gt=ke&&ke.supportsSdpExchange(),Ut=Be===Yt.SUBSCRIBE&&gt&&!Hp(),en=Be===Yt.PUBLISH&&gt&&nd()&&!Hp();return Ut||en?new ms(Qe,ke,{action:Be,remoteParticipantId:Me},Te):new gs(Qe,{action:Be,remoteParticipantId:Me},Te)}({connection:te,action:C,token:b,identifier:this.identifier,tracker:B}),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var b,S;return(S=(b=this.videoTransceiver)===null||b===void 0?void 0:b.mid)!==null&&S!==void 0?S:null}toggleStageConnectionListeners(b){var S,C;b?(S=this.stageConnection)===null||S===void 0||S.on(mf,this.handlePublishingChangedBinding):(C=this.stageConnection)===null||C===void 0||C.off(mf,this.handlePublishingChangedBinding)}updateSubscribeConfig(b){var S,C;this.jitterBufferConfig=b.jitterBuffer,this.simulcastSubscribeConfig=b.simulcast,this.action===Yt.SUBSCRIBE&&(this.inBandMessagingEnabled=b.inBandMessaging.enabled),this.applyJitterBufferMinDelayConditionally((C=(S=this.stageConnection)===null||S===void 0?void 0:S.getIsStagePublishing())!==null&&C!==void 0&&C)}verifyOrUpdateTransceiverSync(){var b,S;return vs(this,void 0,void 0,function*(){if(this.videoTrackForPub){const C=this.getTransceiverForKind("video");C?this.videoTrackForPub.track.id!==((b=C.sender.track)===null||b===void 0?void 0:b.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateTrack(this.videoTrackForPub)):this.logger.warn({msg:"missing transceiver for video"})}if(this.audioTrackForPub){const C=this.getTransceiverForKind("audio");C?this.audioTrackForPub.track.id!==((S=C.sender.track)===null||S===void 0?void 0:S.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateTrack(this.audioTrackForPub)):this.logger.warn({msg:"missing transceiver for audio"})}})}start(){var b,S,C;return vs(this,void 0,void 0,function*(){const{token:O,action:P,traceId:B,identifier:J}=this;P!==Yt.PUBLISH||O.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new Qn(Object.assign(Object.assign({},Ai(Lt.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:P,token:O,traceId:B,tag:uo(P,J),location:"StagePeerClient.start",remoteParticipantId:J})));const te=function({action:z,identifier:re,token:ce,analyticsTracker:de}){let ke="";const Qe=dl(ce,de);switch(z){case Yt.PUBLISH:ke=Qe.getPublishEndpoint();break;case Yt.SUBSCRIBE:re&&(ke=Qe.getSubscribeEndpoint(re))}return ke}({action:P,identifier:J,token:O.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.stageCapabilities={simulcastNegotiated:(C=(S=(b=this.videoTrackForPub)===null||b===void 0?void 0:b.config)===null||S===void 0?void 0:S.simulcastEnabled)!==null&&C!==void 0&&C},this.endpointURL=te,this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,this.stageCapabilities.simulcastNegotiated),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute),this.trace(O,B,"peer connection created",P,J)}catch(z){const re=new Qn(Object.assign(Object.assign({action:P},Ai(Lt.CREATE_PEER_CONNECTION_FAILURE,z)),{token:O,traceId:B,tag:uo(P,J),location:"StagePeerClient.start",remoteParticipantId:J}));P===Yt.PUBLISH&&this.emit(Is,nt.FAILED),this.emit(fa,re),this.analyticsTracker.trackErrorAndThrow(re)}})}mungeSdpOffer(b,S,C){if(C.simulcastNegotiated&&(b=new Mi(b).withVideoLayersAllocationRtpHeaderExtension().sdp),S===Yt.SUBSCRIBE)b=new Mi(b).withOpusAudioConfig(Mo(Ao),!0).sdp;else if(S===Yt.PUBLISH&&C.audioConfig){const{maxBitrateBps:O,stereo:P}=C.audioConfig;b=new Mi(b).withOpusAudioConfig(O,P).sdp}return b}mungeSdpAnswer(b){return Yo.browser.isFirefox()&&this.audioTrackForPub&&this.action===Yt.PUBLISH&&(b=new Mi(b).withOpusAudioConfig(this.audioTrackForPub.config.maxBitrateBps,void 0).sdp),b}stop(){var b,S,C,O,P,B,J,te,z;this.statsReporter.stop(),this.videoReceiverTransformer.destroy(),this.videoSenderTransformer.destroy(),(b=this.peerConnection)===null||b===void 0||b.removeEventListener("connectionstatechange",this.onConnectionStateChange),(S=this.peerConnection)===null||S===void 0||S.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(C=this.peerConnection)===null||C===void 0||C.removeEventListener("icecandidateerror",this.onIceCandidateError),(O=this.peerConnection)===null||O===void 0||O.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(P=this.peerConnection)===null||P===void 0||P.removeEventListener("track",this.onTrack),(B=this.peerConnection)===null||B===void 0||B.removeEventListener("mute",this.onMute),(J=this.peerConnection)===null||J===void 0||J.removeEventListener("unmute",this.onUnMute),(te=this.peerConnection)===null||te===void 0||te.removeEventListener("icecandidate",this.onIceCandidate),(z=this.peerConnection)===null||z===void 0||z.close()}getTransceiverForKind(b){if(!this.peerConnection)return;const S=this.peerConnection.getTransceivers();return b==="audio"?S.find(C=>C.mid==="0"):b==="video"?S.find(C=>C.mid==="1"):void 0}removeTrack(b){return vs(this,void 0,void 0,function*(){if(b==="audio"||b==="video")if(this.peerConnection)try{const S=this.getTransceiverForKind(b);if(!S)return void this.logger.warn({msg:`tried removing track type ${b} but couldn't find transceiver`});yield S.sender.replaceTrack(null),b===Wl.AUDIO?this.audioTrackForPub=void 0:this.videoTrackForPub=void 0,yield this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub)}catch(S){this.logger.warn({msg:"error replacing track",err:S})}else b===Wl.AUDIO?this.audioTrackForPub=void 0:this.videoTrackForPub=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:b})})}replaceOrUpdateTrack(b){return vs(this,void 0,void 0,function*(){if(b.track){if(Ga(b)?this.audioTrackForPub=b:pd(b)&&(this.videoTrackForPub=b),this.peerConnection)try{const S=this.getTransceiverForKind(b.track.kind);if(!S)return void this.logger.warn({msg:`tried replacing track type ${b.track.kind} but couldn't find transceiver`,track:b.track});if(pd(b)){const C=S.sender.getParameters(),O=hl(this.stageCapabilities.simulcastNegotiated,b);C.encodings=C.encodings.map(P=>{var B;const J=(B=P.rid)!==null&&B!==void 0?B:"",te=O.find(z=>{var re;return((re=z.rid)!==null&&re!==void 0?re:"")===J});return te?Object.assign(Object.assign({},P),te):P}),yield S.sender.setParameters(C)}else if(Ga(b)){const C=S.sender.getParameters(),O=ah(b)[0];C.encodings=C.encodings.map(P=>Object.assign(Object.assign({},P),O)),yield S.sender.setParameters(C)}yield S.sender.replaceTrack(b.track),yield this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub)}catch(S){this.logger.warn({msg:"error replacing track",err:S})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateTrack with no track"})})}initializePeerConnection(b=!1){var S,C,O;return vs(this,void 0,void 0,function*(){const{traceId:P,token:B,action:J,identifier:te}=this;kc(this.peerConnection);let z=new MediaStream;if(J===Yt.PUBLISH){this.audioTrackForPub||(this.audioTrackForPub={track:this.getSilentAudio(),config:{maxBitrateBps:Mo(sm),stereo:!1}});const re=this.peerConnection.getTransceivers(),ce=[];re.forEach(Te=>{var gt;ce.concat((gt=Te.sender.track)===null||gt===void 0?void 0:gt.id)}),z=new MediaStream([this.audioTrackForPub.track,(S=this.videoTrackForPub)===null||S===void 0?void 0:S.track].filter(Te=>!!Te&&!ce.includes(Te.id)));const de=z.getAudioTracks()[0]||"audio",ke=z.getVideoTracks()[0]||"video",Qe={direction:"sendonly",streams:[z],sendEncodings:ah(this.audioTrackForPub)},Be={direction:"sendrecv",streams:[z],sendEncodings:hl(this.stageCapabilities.simulcastNegotiated,this.videoTrackForPub)};this.peerConnection.addTransceiver(de,Qe),this.trace(B,P,`track added, type: ${de.kind||de}`,J,te);const Me=this.peerConnection.addTransceiver(ke,Be);this.trace(B,P,`track added, type: ${ke.kind||ke}`,J,te),this.inBandMessagingEnabled&&!va.isSupported(Me)&&this.handleTransformNotSupported(),this.videoSenderTransformer.onTransceiverAdd(Me)}else J===Yt.SUBSCRIBE&&(B.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(B,P,"track added, type: audio",J,te),b||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(B,P,"track added, type: video",J,te),this.inBandMessagingEnabled&&!Ec.isSupported(this.videoTransceiver)&&this.handleTransformNotSupported(),this.videoReceiverTransformer.onTransceiverAdd(this.videoTransceiver)),this.peerConnection.getTransceivers().forEach(re=>{re.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),z==null||z.addTrack(re.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})}),this.applyJitterBufferMinDelayConditionally((O=(C=this.stageConnection)===null||C===void 0?void 0:C.getIsStagePublishing())!==null&&O!==void 0&&O));return z})}handlePublishingChanged(b){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${b}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===Yt.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(b)}applyJitterBufferMinDelayConditionally(b){const S=this.currentJitterBufferMinDelayInMs,C=this.calcJitterBufferMinDelay(b,this.jitterBufferConfig);if(b){if(S===void 0||S>C){const O=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${C}`;this.logger.debug({msg:O}),this.trace(this.token,this.traceId,O,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(C)}}else if(S===void 0||C!==S){const O=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${C}`;this.logger.debug({msg:O}),this.trace(this.token,this.traceId,O,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(C)}}calcJitterBufferMinDelay(b,S){var C,O,P;let B=0;if(!(()=>{const J=RTCRtpReceiver.prototype;return!(!J||typeof J!="object")&&("jitterBufferTarget"in J||"playoutDelayHint"in J)})())return 0;if(b)B=as((C=S==null?void 0:S.minDelayWhenPublishing)!==null&&C!==void 0?C:fs.DEFAULT,b);else{B=as((O=S==null?void 0:S.minDelayWhenSubscribeOnly)!==null&&O!==void 0?O:fs.DEFAULT,b);const J=(P=this.stageConnection)===null||P===void 0?void 0:P.jitterBufferMinDelayInMs();(S==null?void 0:S.minDelayWhenSubscribeOnly)===fs.DEFAULT&&J!==void 0&&(B=J,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${B}`}))}return B}applyAndTrackJitterBufferMinDelay(b){var S,C;this.currentJitterBufferMinDelayInMs=b,this.statsReporter.updateJitterBufferMinDelay(b),b!==void 0&&((C=(S=this.peerConnection)===null||S===void 0?void 0:S.getTransceivers())===null||C===void 0||C.forEach(O=>{O.receiver&&this.applyJitterBufferMinDelay(O.receiver,b)}))}applyJitterBufferMinDelay(b,S){let C="Unable to set jitter buffer min delay";if("jitterBufferTarget"in b)C=`setting jitterBufferTarget to: ${S} for track: ${b.track.kind}`,this.logger.debug({msg:C}),b.jitterBufferTarget=S;else if("playoutDelayHint"in b){const O=S/1e3;C=`setting playoutDelayHint to: ${S} for track: ${b.track.kind}`,this.logger.debug({msg:C}),b.playoutDelayHint=O}else this.logger.warn({msg:C});this.trace(this.token,this.traceId,C,this.action,this.identifier)}exchangeSdp(b){var S;return vs(this,void 0,void 0,function*(){const{traceId:C,token:O,action:P,identifier:B,tag:J,endpointURL:te}=this,{iceRestart:z=!1,nodeOverride:re,assignmentToken:ce,abortController:de}=b;let ke;this.logger.debug({msg:`Exchanging SDP: ${C.value}, iceRestart=${z}, nodeOverride=${re}, assignmentToken=${ce}`}),kc(this.peerConnection),P===Yt.PUBLISH&&ha()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),((Be,Me)=>{var Te,gt;const Ut=(Te=RTCRtpReceiver.getCapabilities("video"))===null||Te===void 0?void 0:Te.codecs;if(!Ut)return;let en=Ut;en=po(Ut,"42e0"),Me.preferMainProfile&&(en=po(Ut,"4d00")),(gt=Be.getTransceivers().find(Pt=>Pt.receiver.track.kind==="video"))===null||gt===void 0||gt.setCodecPreferences(en)})(this.peerConnection,{preferMainProfile:ha()}));try{this.trace(O,C,"Creating offer",P,B),ke=yield this.peerConnection.createOffer({iceRestart:z})}catch(Be){const Me=new Qn(Object.assign(Object.assign({},Ai(Lt.CREATE_OFFER_FAILURE,Be)),{action:P,token:O,traceId:C,tag:J,location:"exchangeSdp",remoteParticipantId:B}));this.emit(fa,Me),this.analyticsTracker.trackErrorAndThrow(Me)}ke.sdp&&(ke.sdp=this.mungeSdpOffer(ke.sdp,P,{simulcastNegotiated:this.stageCapabilities.simulcastNegotiated,audioConfig:(S=this.audioTrackForPub)===null||S===void 0?void 0:S.config})),this.trace(O,C,"Setting local description",P,B),yield this.peerConnection.setLocalDescription(ke),this.trace(O,C,"local description set",P,B),te||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const Qe=P===Yt.PUBLISH&&ha()||P===Yt.SUBSCRIBE&&bu("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:te,nodeOverride:re,assignmentToken:ce,multiCodec:Qe,abortController:de})})}getReports(){var b;return vs(this,void 0,void 0,function*(){try{const S=(yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats())||[],C=[];return S.forEach(O=>{C.push(O)}),C}catch{return[]}})}requestRTCStats(b){return vs(this,void 0,void 0,function*(){if(this.peerConnection)return this.peerConnection.getStats(b)})}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:b,tag:S,identifier:C,action:O,traceId:P}=this,B=_m({traceId:P,token:b,tag:S,identifier:C,action:O,stageErrorValue:Lt.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:B,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(B),this.emit(ot,B)}handleConnectionFailure(){return vs(this,void 0,void 0,function*(){const{token:b,traceId:S,tag:C}=this;this.analyticsTracker.trackError(new Qn(Object.assign(Object.assign({},Lt.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:b,traceId:S,tag:C,location:"onIceCandidateError",remoteParticipantId:this.identifier})))})}getSilentAudio(){to||(to=new AudioContext);const b=to.createOscillator(),S=to.createGain();b.connect(S);const C=to.createMediaStreamDestination();return S.connect(C),S.gain.value=0,b.start(),C.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}initTracksToPublish(b){this.videoTrackForPub=b.find(pd),this.audioTrackForPub=b.find(Ga)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var b,S;return this.calcJitterBufferMinDelay((S=(b=this.stageConnection)===null||b===void 0?void 0:b.getIsStagePublishing())!==null&&S!==void 0&&S,this.jitterBufferConfig)}trace(b,S,C,O,P){this.analyticsTracker.trackEventNoSharedProps(new _f(b,S,C,O,P))}sendSeiMessage(b){var S;this.action===Yt.PUBLISH&&((S=this.videoSenderTransformer)===null||S===void 0||S.sendSeiMessage(b))}}const bm=Yt.SUBSCRIBE;class Lc{constructor(b,S,C){this.analyticsTracker=b,this.token=S,this.remoteId=C,this.action=bm}trackAttempt({stageConnectionStats:b,isReassignment:S=!1,traceIdOverride:C,preAttemptSfuResource:O}){const{action:P,analyticsTracker:B,token:J,remoteId:te}=this,z=C||Qs();return B.trackEvent(new fd({token:this.token,subscribedId:this.remoteId,traceId:z,isEdpConnected:b.isConnected,isReassignment:S,preAttemptSfuResource:O})),{getTraceId:()=>z,trackSubscribeStarted({totalDurationWithRetries:re,retryTimes:ce,sfuResource:de,peerClientPerfStats:ke}){const{optionsDuration:Qe,postDuration:Be,timeToCandidate:Me,timeToConnected:Te,sdpExchangeDuration:gt,sdpExchangeTransport:Ut,setRemoteDescDuration:en,peerConnectionDuration:Pt}=ke,{edpInitialConnectDuration:Hn,edpInitialConnectRetries:Ln,edpInitialStateDuration:Or,edpInitialStatePublishingCount:Ur,edpStateUpdateCount:Fr}=b;B.trackEvent(new hm({token:J,traceId:z,remoteParticipantId:te,optionsDuration:Qe,postDuration:Be,timeToCandidate:Me,totalDuration:Te,edpInitialConnectDuration:Hn,edpInitialConnectRetries:Ln,edpInitialStateDuration:Or,edpInitialStatePublishingCount:Ur,edpStateUpdateCount:Fr,sdpExchangeDuration:gt,sdpExchangeTransport:Ut,setRemoteDescDuration:en,peerConnectionDuration:Pt,sfuResource:de,totalDurationWithRetries:re,subscribeRetryTimes:ce,isReassignment:S}))},trackSubscribeFirstFrame:({peerClientPerfStats:re,totalDurationWithRetries:ce,sfuResource:de,retryTimes:ke,currentJitterBufferMinDelayInMs:Qe,mediaType:Be,firstFrameDuration:Me})=>{const{sdpExchangeDuration:Te,sdpExchangeTransport:gt,setRemoteDescDuration:Ut,peerConnectionDuration:en}=re,{edpInitialConnectDuration:Pt,edpInitialConnectRetries:Hn,edpInitialStateDuration:Ln,edpInitialStatePublishingCount:Or,edpStateUpdateCount:Ur}=b;this.analyticsTracker.trackEvent(new K_({token:this.token,traceId:z,remoteParticipantId:te,edpInitialConnectDuration:Pt,edpInitialConnectRetries:Hn,edpInitialStateDuration:Ln,edpInitialStatePublishingCount:Or,edpStateUpdateCount:Ur,sdpExchangeDuration:Te,sdpExchangeTransport:gt,setRemoteDescDuration:Ut,peerConnectionDuration:en,videoWasPaused:!1,firstFrameDuration:Me,mediaType:Be,sfuResource:de,totalDurationWithRetries:ce,subscribeRetryTimes:ke,currentJitterBufferMinDelayInMs:Qe}))},trackSubscribeFailed(re,ce){const de=((Be,Me,Te)=>{if(Be instanceof Qn)return Be;let gt="";return Be instanceof oi.AxiosError&&(gt+=`AxiosError - ${Be.code}`),new Qn(Object.assign(Object.assign(Object.assign({},Lt.SUBSCRIBE_FAILURE),{action:bm,token:Me,traceId:Te,tag:mc.SUBSCRIBE_RELATED,location:"subscribe",details:`${gt} ${Be==null?void 0:Be.message}`}),{fatal:!0}))})(re,J,z);B.trackEvent(new q_({token:J,traceId:z,remoteParticipantId:te,code:de.code,message:de.message,fatal:de.fatal,nominal:de.nominal,isReassignment:S}));const{isConnected:ke}=b,Qe=new Qn(Object.assign(Object.assign({},Lt.SUBSCRIBE_FAILURE),{action:P,token:J,traceId:z,tag:uo(Yt.SUBSCRIBE,te),location:"subscribe",remoteParticipantId:te,isEdpConnected:ke,details:ce}));return re instanceof Qn&&(Qe.fatal=re.fatal,Qe.nominal=re.nominal,Qe.location=`subscribe > ${re.location}`),B.trackError(Qe),de},trackUnsubscribe:()=>{B.trackEvent(new W_({token:J,unsubscribedId:te,traceId:z}))},trackEndSucceeded:re=>{B.trackEvent(new rv({token:J,traceId:z,remoteParticipantId:te,isUnsubscribeSuccessful:!0,reason:re}))},trackEndFailed:re=>{const ce=new Qn(Object.assign(Object.assign({},Lt.UNSUBSCRIBE_FAILURE),{token:J,traceId:z,tag:uo(Yt.SUBSCRIBE,te),location:"unsubscribe",remoteParticipantId:te}));return re!==Os.UNLOAD&&re!==Os.UNSUBSCRIBE||B.trackError(ce),B.trackEvent(new rv({token:J,traceId:z,remoteParticipantId:te,isUnsubscribeSuccessful:!0,reason:re})),ce}}}}class mh extends gr{constructor(b,S,C,O,P,B){super(vn.PLAYBACK_LAYER_REQUEST,b,S,!1),Object.assign(this.properties,{media_type:C,remote_participant_id:O,track_id:P,layer_id:B})}}class Ou extends gr{constructor(b,S,C,O,P,B=1){super(vn.PLAYBACK_LAYER_STATE,b,S,!1),Object.assign(this.properties,{media_type:C,remote_participant_id:O,track_id:P,request_count:B})}}var Lf,no,Uf,Vi;(function(x){x.PAUSE="pause",x.PLAY="play"})(Lf||(Lf={})),function(x){x.IDLE="idle",x.ACTIVE="active",x.ERRORED="errored",x.DESTROYED="destroyed"}(no||(no={})),function(x){x.SUCCESS="success"}(Uf||(Uf={})),function(x){x.FAILED="failed",x.DESTROYED="destroyed",x.THROTTLED="throttled"}(Vi||(Vi={}));var pl=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};class X_{constructor(b){this.state=no.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>pl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(Lf.PAUSE)}),this.startVideo=()=>pl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(Lf.PLAY)}),this.setLayer=S=>pl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(S)}),this.unsetLayer=()=>pl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()}),this.getLayers=()=>pl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()}),this.sendPlaybackRequest=S=>pl(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,In.err)(Vi.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,In.err)(Vi.FAILED);this.logger.info({msg:`Sending ${S} request to ${this.playbackEndpoint}`});const C=S===Lf.PAUSE?{pause:[this.mid]}:{play:[this.mid]},O=this.createPostWhepRequest(C);return fetch(this.playbackEndpoint,O).then(P=>P.status>=300?(new Error(`Error sending media controls request: ${P.status}:${P.statusText}`),this.logger.error({err:In.err}),(0,In.err)(Vi.FAILED)):(this.logger.debug({msg:`Request to ${S} was successful: ${P.status}`}),(0,In.ok)(Uf.SUCCESS))).catch(P=>(this.logger.error({err:P,msg:"Error sending media controls request"}),(0,In.err)(Vi.FAILED)))}),this.sendLayerRequest=S=>pl(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,In.err)(Vi.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,In.err)(Vi.FAILED);const C=typeof S=="string",O=C?{mediaId:this.mid,encodingId:S}:{},P=C?`set : ${S}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${P} at ${this.layersEndpoint}`});const B=this.createPostWhepRequest(O);return this.trackLayerRequest(S??"auto"),fetch(this.layersEndpoint,B).then(J=>this.state===no.DESTROYED?(0,In.err)(Vi.DESTROYED):J.status>=300?this.handleLayerRequestError(J.status,J.statusText):(this.logger.debug({msg:`Request to ${P} was successful: ${J.status}`}),(0,In.ok)(Uf.SUCCESS))).catch(J=>this.handleLayerRequestError(0,J.message))}),this.sendLayerStateRequest=()=>pl(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,In.err)(Vi.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,In.err)(Vi.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const S=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,S).then(C=>pl(this,void 0,void 0,function*(){var O;if(this.state===no.DESTROYED)return(0,In.err)(Vi.DESTROYED);if(C.status>=300)return this.handleLayerStateRequestError(C.status,C.statusText);const P=yield C.json(),B=(O=P==null?void 0:P.layers)!==null&&O!==void 0?O:[],J=JSON.stringify(B,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${J}`}),(0,In.ok)(B)})).catch(C=>this.handleLayerStateRequestError(0,C.message))}),this.logger=new Ks(b.logger,pe.REMOTE_PLAYBACK),this.token=b.token,this.traceId=b.traceId,this.analyticsTracker=b.analyticsTracker,this.remoteParticipantId=b.remoteParticipantId}set mediaId(b){if(this.state!==no.DESTROYED){if(this.mid=b,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=no.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=no.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(b){var S,C;if(this.state!==no.DESTROYED){if(this.playbackEndpoint=(S=b.playback)!==null&&S!==void 0?S:null,this.layersEndpoint=(C=b.layers)!==null&&C!==void 0?C:null,!this.playbackEndpoint||!this.layersEndpoint){const O={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(O,null)}`}),void(this.state=no.IDLE)}this.mid&&(this.state=no.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=no.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(b="command"){this.logger.info({msg:`skipping ${b}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(b){return b===no.DESTROYED?(0,In.err)(Vi.DESTROYED):(0,In.err)(Vi.FAILED)}createPostWhepRequest(b){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(b)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var b,S;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":Js().value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(S=(b=this.traceId)===null||b===void 0?void 0:b.value)!==null&&S!==void 0?S:"","X-Stages-WHIP-Version":qo}}trackLayerRequest(b){var S;this.analyticsTracker.trackEventNoSharedProps(new mh(this.token,this.traceId,Gt.VIDEO,this.remoteParticipantId,(S=this.mid)!==null&&S!==void 0?S:"unknown",b))}trackLayerStateRequest(b=1){var S;this.analyticsTracker.trackEventNoSharedProps(new Ou(this.token,this.traceId,Gt.VIDEO,this.remoteParticipantId,(S=this.mid)!==null&&S!==void 0?S:"unknown",b))}handleLayerRequestError(b,S){const C=`sendLayerRequest failed for reason: ${b} ${S}`;let O,P;return b===429?(O=Vi.THROTTLED,P=Lt.WHEP_SET_LAYER_REQUEST_THROTTLED):(O=Vi.FAILED,P=Lt.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError(P,C),(0,In.err)(O)}handleLayerStateRequestError(b,S){const C=`sendLayerStateRequest failed for reason: ${b} ${S}`;let O,P;return b===429?(O=Vi.THROTTLED,P=Lt.WHEP_GET_LAYER_STATE_THROTTLED):(O=Vi.FAILED,P=Lt.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError(P,C),(0,In.err)(O)}trackRequestError(b,S){const C=new Error(S);this.logger.error({err:C}),b.message=S;const O=this.createError(b);this.analyticsTracker.trackError(O)}createError(b,S){return new Qn(Object.assign({action:Yt.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:mc.SUBSCRIBE_RELATED,details:S},b))}}var gd,gh,_a,Qo,mo=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})},ov=function(x,b,S,C){if(S==="a"&&!C)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!C:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?C:S==="a"?C.call(x):C?C.value:b.get(x)};(function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"})(_a||(_a={})),function(x){x.NONE="none",x.AUDIO_ONLY="audio_only",x.AUDIO_VIDEO="audio_video"}(Qo||(Qo={}));class vd extends lo{constructor(b,S,C,O,P,B,J){super(),this.id=b,this.token=S,this.stageConnection=C,this.nonScopedLogger=O,this.analyticsTracker=P,this.desiredSubscribeType=B,gd.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:_a.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new Vg(1e3),this.cleanupFirstFrameTracking=rm,this.actualSubscribeType=Qo.NONE,this.action=Yt.SUBSCRIBE,this.updateDesiredSubscribeType=z=>{this.desiredSubscribeType=z,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=z=>{this.peerClient.updateSubscribeConfig(z)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const z=this.actualSubscribeType,re=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${re}`}),this.subscriptionState.connectionState===_a.CONNECTED&&re!==Qo.NONE&&z!==re&&this.applyVideoControlsBySubscribeType(re,z)},this.onParticipantUpdated=z=>{ov(this,gd,"m",gh).call(this,z)&&(this.logger.debug({msg:"onParticipantUpdated",participant:z}),this.processStateUpdate({isTargetPublishing:z.isPublishing}))},this.onParticipantJoined=z=>{ov(this,gd,"m",gh).call(this,z)&&(this.logger.debug({msg:"onParticipantJoined",participant:z}),this.processStateUpdate({isTargetPublishing:z.isPublishing}))},this.onParticipantLeft=z=>{ov(this,gd,"m",gh).call(this,z)&&(this.logger.debug({msg:"onParticipantLeft",participant:z}),this.processStateUpdate({isTargetPublishing:!1}))},this.requestRTCStats=z=>mo(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(z)}),this.trySubscribe=z=>mo(this,void 0,void 0,function*(){if(this.logger.debug({msg:`Subscribe attempt started: ${z}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==_a.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:_a.CONNECTING}));const re=this.stageConnection.getConnectionStats(),ce=this.peerClient.getExpectedJitterBufferMinDelayInMs(),de=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:re,preAttemptSfuResource:de});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:ke}=yield this.subscribe(this.attemptTracker.getTraceId()),Qe=performance.now()-this.startConnectingTimestamp,Be=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const Me=this.failedRetries;this.attemptToActualizeSubscribeType();const Te=this.peerClient.getActionMeasurements();if(this.attemptTracker.trackSubscribeStarted({sfuResource:Be,totalDurationWithRetries:Qe,retryTimes:Me,peerClientPerfStats:Te}),ke){this.cleanupFirstFrameTracking();const gt=this.actualSubscribeType,Ut=this.attemptTracker,en=(Pt,Hn)=>{Ut.trackSubscribeFirstFrame({peerClientPerfStats:Te,sfuResource:Be,totalDurationWithRetries:Qe,retryTimes:Me,currentJitterBufferMinDelayInMs:ce,mediaType:Hn,firstFrameDuration:Pt})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:ke,subscribeType:gt,callback:en})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,ke&&this.emit(me,ke,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(ke){const Qe=this.attemptTracker.trackSubscribeFailed(ke);this.logger.error({log:"Subscribe attempt failed",err:ke}),this.onTrySubscribeFailure(Qe,z)}return!1});const te=Qs();this.peerClient=new Df(S,this.nonScopedLogger,this.action,uo(this.action,b),te,P,b,C,J),this.logger=new Ks(O,pe.SUBSCRIPTION),this.subscribeTracker=new Lc(this.analyticsTracker,S,b),this.remotePlaybackController=new X_({token:S,analyticsTracker:P,traceId:te,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(b,S){try{b===Qo.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch(C=>{this.logger.error({err:C,msg:"Remote playback request to stop video failed"})}):b===Qo.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch(C=>{this.logger.error({err:C,msg:"Remote playback request to start video failed"})}),this.actualSubscribeType=b,this.logger.debug({msg:`Desired subscribe type actualized from ${S} to ${b}.`})}catch(C){this.logger.error({err:C,msg:`Error updating subscribe type from ${S} to ${b}.`})}}onPeerClientConnectionStateChange(b){const S=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${b}`,state:b,targetParticipant:S}),this.processStateUpdate({peerClientState:b})}onPeerClientTransformError(b){this.emit(Hs,b)}processStateUpdate(b){const S=this.previousSignalState,C=Object.assign({},S,b);this.isSubscriptionActive?(C.isTargetPublishing?b.peerClientState===nt.CONNECTED?this.updateState({connectionState:_a.CONNECTED,subscribeInProgress:!0}):b.peerClientState===nt.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(Os.CONNECTION_FAIL),this.updateState({subscribeInProgress:!1})):(S.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:_a.DISCONNECTED})),(!S.isTargetPublishing&&b.isTargetPublishing||b.peerClientState===nt.FAILED)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,b)):this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"})}onTrySubscribeFailure(b,S){this.logger.debug({msg:"Changing/keeping state FAILED"});const C=b.fatal,O=b.code===Lt.OPERATION_ABORTED.code,P=this.failedRetries<=4;if(!O&&!C&&P){const B=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${B}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout(()=>mo(this,void 0,void 0,function*(){this.throttledTrySubscribe(S)}),B)}else this.updateState({connectionState:_a.ERRORED}),this.emit(Wo,b),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(Is,this.onPeerClientConnectionStateChange,this),this.peerClient.on(rl,S=>{this.remotePlaybackController.endpoints={playback:S.mediaControls,layers:S.layerControls}}),this.peerClient.on(sd,S=>{this.emit(Ha,S)}),this.peerClient.on(ot,this.onPeerClientTransformError,this),this.stageConnection.on(ks,this.onParticipantUpdated),this.stageConnection.on(gc,this.onParticipantJoined),this.stageConnection.on(Pi,this.onParticipantLeft),this.stageConnection.on(os,this.onParticipantLeft);let b=!0;if(this.stageConnection.isConnected()){const S=this.stageConnection.getParticipant(this.id);b=!!(S!=null&&S.isPublishing)}this.processStateUpdate({isTargetPublishing:b})}throttledTrySubscribe(b){return this.throttler.invoke(this.trySubscribe,b)}updateState(b){b.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=b.subscribeInProgress),b.connectionState&&this.subscriptionState.connectionState!==b.connectionState&&(this.subscriptionState.connectionState=b.connectionState,this.emit(gf,this.subscriptionState.connectionState))}stop(b=!1){this.peerClient.off(Is,this.onPeerClientConnectionStateChange,this),this.peerClient.off(ot,this.onPeerClientTransformError,this),this.unsubscribe(b),this.throttler.clear(),this.stageConnection.off(ks,this.onParticipantUpdated),this.stageConnection.off(gc,this.onParticipantJoined),this.stageConnection.off(Pi,this.onParticipantLeft),this.stageConnection.off(os,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:_a.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(b,S){return mo(this,void 0,void 0,function*(){const{token:C,id:O}=this;C.assertTokenIsUnexpired(b,uo(Yt.SUBSCRIBE,O),"subscribe",O);const{mediaStream:P}=yield this.peerClient.connect({audioOnly:S,traceId:b});return{peerClient:this.peerClient,mediaStream:P}})}unsubscribe(b=!1){return mo(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===_a.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const S=b?Os.UNLOAD:Os.UNSUBSCRIBE;try{b?this.peerClient.disconnect(b):yield this.peerClient.disconnect(b),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(S)}catch{this.attemptTracker.trackEndFailed(S)}})}triggerIceRestart(b){var S;return mo(this,void 0,void 0,function*(){const C=this.stageConnection.getConnectionStats(),O=this.peerClient.getSfuResource(),P=this.subscribeTracker.trackAttempt({stageConnectionStats:C,isReassignment:!0,traceIdOverride:b.traceId,preAttemptSfuResource:O}),B=performance.now();try{this.emit(Mr),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:b,traceId:b.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const J=performance.now()-B,te=this.peerClient.getSfuResource(),z=this.peerClient.getActionMeasurements();(S=this.attemptTracker)===null||S===void 0||S.trackEndSucceeded(Os.REASSIGNMENT),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),P.trackSubscribeStarted({totalDurationWithRetries:J,sfuResource:te,retryTimes:0,peerClientPerfStats:z}),this.emit(ol)}catch(J){this.emit(al),this.logger.error({msg:"ICE restart attempt failed",err:J});const te=this.peerClient.getSfuResource(),z=P.trackSubscribeFailed(J,`iceRestart=true, startNode=${O.node}, endNode=${te==null?void 0:te.node}`);throw z.code===Lt.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(z,"ice restart timeout"),J}})}measureFirstFrameDuration({mediaStream:b,subscribeType:S,callback:C}){const O=performance.now(),P=te=>{const z=performance.now()-O;C(z,te),te==="audio"?J():B()};let B=rm,J=rm;return S!==Qo.AUDIO_ONLY&&(B=function(te,z){return im(te,"video",z)}(b,P)),J=function(te,z){return im(te,"audio",z)}(b,P),()=>{B(),J()}}}var ku,Ir;gd=new WeakSet,gh=function(x){return x.id===this.id},function(x){x.JOIN_ERROR="JOIN_ERROR",x.PUBLISH_ERROR="PUBLISH_ERROR",x.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"}(ku||(ku={})),function(x){x[x.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",x[x.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",x[x.TIMEOUT=3]="TIMEOUT",x[x.FAILED=4]="FAILED",x[x.CANCELED=5]="CANCELED",x[x.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",x[x.CODEC_MISMATCH=7]="CODEC_MISMATCH",x[x.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED"}(Ir||(Ir={}));const Hy={[Ir.TOKEN_MALFORMED]:"Token is malformed",[Ir.TOKEN_EXPIRED]:"Token expired and is no longer valid",[Ir.TIMEOUT]:"Operation timed out",[Ir.FAILED]:"Operation failed",[Ir.CANCELED]:"Operation canceled",[Ir.STAGE_AT_CAPACITY]:"Stage at capacity",[Ir.CODEC_MISMATCH]:"Client codec is not supported",[Ir.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation"},Wa={[Lt.EXPIRED_TOKEN.code]:Ir.TOKEN_EXPIRED,[Lt.MALFORMED_TOKEN.code]:Ir.TOKEN_MALFORMED,[Lt.TOKEN_PERMISSIONS_DENIED.code]:Ir.TOKEN_NOT_ALLOWED,[Lt.OPERATION_ABORTED.code]:Ir.CANCELED,[Lt.JOIN_TIMED_OUT.code]:Ir.TIMEOUT,[Lt.EVENT_PLANE_WS_CREATE_FAILED.code]:Ir.FAILED,[Lt.EVENT_PLANE_PONG_TIMEOUT.code]:Ir.FAILED,[Lt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:Ir.FAILED,[Lt.PUBLISH_TIMED_OUT.code]:Ir.TIMEOUT,[Lt.PUBLISH_FAILURE.code]:Ir.FAILED,[Lt.SUBSCRIBE_TIMED_OUT.code]:Ir.TIMEOUT,[Lt.SUBSCRIBE_FAILURE.code]:Ir.FAILED,[Lt.STAGE_AT_CAPACITY.code]:Ir.STAGE_AT_CAPACITY,[Lt.NO_MATCHING_CODEC.code]:Ir.CODEC_MISMATCH,[Lt.NETWORK_FAILURE.code]:Ir.FAILED,[Lt.INTERNAL_SERVER_ERROR.code]:Ir.FAILED,[Lt.REMOTE_STREAM_NOT_FOUND.code]:Ir.FAILED,[Lt.INTERNAL_MHCP_ERROR.code]:Ir.FAILED,[Lt.UNREACHABLE_MHCP.code]:Ir.FAILED,[Lt.INVALID_SESSION_STATUS.code]:Ir.FAILED,[Lt.MHCP_ABORTED.code]:Ir.FAILED};class AS extends Error{constructor(b,S,C){super(),this.code=b,this.category=S,this.message=C,this.name="StageError",this.errorDetails=[],this.message=`[${S}] ${C}`}addDetails(b){this.errorDetails.push(b)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var vh,Ff,Em;(function(x){x.ERROR="error"})(vh||(vh={}));class Vy extends lo{constructor(){super(...arguments),this.handleError=(b,S,C=!0)=>{let O;if(b instanceof Qn){const P=Wa[b.code];P&&(O=function(B,J,te){var z,re;const ce=Hy[B],de=new AS(B,J,ce);return de.addDetails({stageErrorMessage:ce,stageErrorCode:B,stageErrorCategory:J,stageArn:(z=te.token)===null||z===void 0?void 0:z.stageARN,traceId:(re=te.traceId)===null||re===void 0?void 0:re.value,causeCode:te.code,causeDetails:te.details,causeMessage:te.message,causeLocation:te.location}),de}(P,S,b))}if(O)return C&&this.emit(vh.ERROR,O),O}}}(function(x){x.INTERNAL="internal",x.API="api"})(Ff||(Ff={})),function(x){x.ADDITIVE="additive",x.REPLACE="replace"}(Em||(Em={}));class zy{constructor(b){this.logger=new Ks(b.logger,pe.CONNECTION),this.subscribeConfig={defaults:b.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(b,S,C,O=Em.REPLACE){S=(re=>{const ce=xf(re);if(ce.jitterBuffer!==void 0){const de=ke=>{if(typeof ke=="number"){if(ke<0)return 0;if(ke>4e3)return 4e3}return ke};ce.jitterBuffer.minDelayWhenPublishing!==void 0&&(ce.jitterBuffer.minDelayWhenPublishing=de(ce.jitterBuffer.minDelayWhenPublishing)),ce.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(ce.jitterBuffer.minDelayWhenSubscribeOnly=de(ce.jitterBuffer.minDelayWhenSubscribeOnly))}return ce})(S),this.subscribeConfig.participants[b]===void 0&&(this.subscribeConfig.participants[b]={internalOverrides:{},apiOverrides:{},lastMerged:this.subscribeConfig.defaults});const P=this.subscribeConfig.participants[b];switch(C){case Ff.INTERNAL:P.internalOverrides=this.handleSubscribeConfigLevelMerging(P.internalOverrides,S,O);break;case Ff.API:P.apiOverrides=this.handleSubscribeConfigLevelMerging(P.apiOverrides,S,O);break;default:(function(re){throw new Error(`Unknown case kind: ${re}`)})(C)}const B=Iu(this.subscribeConfig.defaults,P.internalOverrides,P.apiOverrides);if(B===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${b} | ${P}, ${S}`}),!1;const J=(te=P.lastMerged,z=B,(typeof te=="object"&&typeof z=="object"&&(0,ss.isEqual)(te,z))===!1);var te,z;return P.lastMerged=B,this.subscribeConfig.participants[b]=P,J}handleExternalSubscribeConfigUpdate(b,S,C,O=Em.REPLACE){const P=(B=>{const J={};return typeof B!="object"?In.err(new Error("Invalid input")):(B.jitterBuffer!==void 0&&(J.jitterBuffer={},B.jitterBuffer.minDelay!==void 0&&(J.jitterBuffer.minDelayWhenSubscribeOnly=B.jitterBuffer.minDelay)),B.inBandMessaging!==void 0&&(J.inBandMessaging={enabled:B.inBandMessaging.enabled===!0}),B.simulcast!==void 0&&(J.simulcast={},B.simulcast.initialLayerPreference!==void 0&&(J.simulcast.initialLayerPreference=B.simulcast.initialLayerPreference)),In.ok(J))})(S);return P.ok===!0&&this.handleSubscribeConfigUpdate(b,P.value,C,O)}handleSubscribeConfigLevelMerging(b,S,C){if(C===Em.REPLACE)return S;{const O=Iu(b,S);return O===void 0?(this.logger.warn({msg:`Unable to merge '${b}' and '${S}' with type ${C}`}),b):O}}getSubscribeConfigSnapshot(b){return this.subscribeConfig.participants[b]===void 0?ch(this.subscribeConfig.defaults):ch(this.subscribeConfig.participants[b].lastMerged)}}class MS extends gr{constructor(b){super(vn.REASSIGNMENT_REQUEST,b.token,b.traceId,!1),Object.assign(this.properties,{target_local_participant_id:b.targetLocalParticipantId,target_remote_participant_id:b.targetRemoteParticipantId}),this.critical=!0}}var _s,Sc,_h,Zo,Jl,ya,zi,Io,Sm=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};class av extends lo{constructor(b,S){super(),this.setGetStats=C=>{this.getInternalStats=C},this.getStats=()=>Sm(this,void 0,void 0,function*(){return this.requestRTCStats()}),this.requestRTCStats=()=>Sm(this,void 0,void 0,function*(){if(this.getInternalStats)return this.getInternalStats(this.mediaStreamTrack)}),this.getInternalStats=S,this.id=b.id,this.isMuted=!b.enabled,this.mediaStreamTrack=b,this.streamType=this.mediaStreamTrack.kind==="audio"?Gt.AUDIO:Gt.VIDEO}cleanup(){this.removeAllListeners(),this.getInternalStats=void 0}}(function(x){x.IDLE="IDLE",x.INITIALIZING="INITIALIZING",x.ACTIVE="ACTIVE",x.CONTROLS_PAUSED="CONTROLS_PAUSED",x.DESTROYED="DESTROYED"})(_s||(_s={})),function(x){x.LAYERS_CHANGED="LAYERS_CHANGED",x.LAYER_SELECTED="LAYER_SELECTED",x.ADAPTION_CHANGED="ADAPTION_CHANGED"}(Sc||(Sc={})),function(x){x.LAYERS_CHANGED="LAYERS_CHANGED",x.LAYER_SELECTED="LAYER_SELECTED",x.ADAPTION_CHANGED="ADAPTION_CHANGED"}(_h||(_h={})),function(x){x.UNAVAILABLE="unavailable",x.SELECTED="selected"}(Zo||(Zo={})),function(x){x.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged"}(Jl||(Jl={}));class J_ extends av{constructor(b,S){super(b),this.setMuted=C=>{C!==this.isMuted&&(this.mediaStreamTrack.enabled=!C,this.isMuted=C,this.emit(Jl.LOCAL_STREAM_MUTE_CHANGED,this))},this.mediaConfig=iv(b,S)}}class Gy{constructor(b,S){this.strategy=b,this.logger=S}setStrategy(b){this.strategy=b}stageStreamsToPublish(){let b=[];try{b=this.strategy.stageStreamsToPublish(),b=b.filter(O=>O instanceof J_)}catch(O){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:O}),console.error("Error executing stageStreamsToPublish",O),In.err(O)}let S=0,C=0;for(const O of b)O.mediaStreamTrack.kind==="audio"?S++:O.mediaStreamTrack.kind==="video"&&C++;if(S>1||C>1){const O=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return In.err(O)}return In.ok(b)}shouldPublishParticipant(b){try{return In.ok(this.strategy.shouldPublishParticipant(b))}catch(S){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:S}),console.error("Error executing shouldPublishParticipant",S),In.err(S)}}shouldSubscribeToParticipant(b){try{return In.ok(this.strategy.shouldSubscribeToParticipant(b))}catch(S){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:S}),console.error("Error executing shouldSubscribeToParticipant",S),In.err(S)}}subscribeConfiguration(b){var S,C;try{return In.ok((C=(S=this.strategy).subscribeConfiguration)===null||C===void 0?void 0:C.call(S,b))}catch(O){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:O}),console.error("Error executing subscribeConfiguration",O),In.err(O)}}preferredLayerForStream(b,S){var C,O;try{return In.ok((O=(C=this.strategy).preferredLayerForStream)===null||O===void 0?void 0:O.call(C,b,S))}catch(P){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:P}),console.error("Error executing preferredLayerForStream",P),In.err(P)}}}class Q_ extends lo{constructor(b,S){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=zi.NOT_PUBLISHED,this.logger=S,this.info=b,this.audioMuted=b.audioMuted,this.videoStopped=b.videoStopped}}(function(x){x.PUBLISH="publish",x.SUBSCRIBE="subscribe"})(ya||(ya={})),function(x){x.NOT_PUBLISHED="not_published",x.ATTEMPTING_PUBLISH="attempting_publish",x.PUBLISHED="published",x.ERRORED="errored"}(zi||(zi={})),function(x){x.NOT_SUBSCRIBED="not_subscribed",x.ATTEMPTING_SUBSCRIBE="attempting_subscribe",x.SUBSCRIBED="subscribed",x.ERRORED="errored"}(Io||(Io={}));const Tm=1e3;function cv(x){return x.map(b=>b.remote)}function IS(x){return{label:x.encodingId,bitrateBps:x.bitrate*Tm,width:x.width,height:x.height,framesPerSecond:x.framesPerSecond,selected:x.selected}}function wm(x,b){const S=x.width*x.height,C=b.width*b.height;return S>C||x.bitrateBps>b.bitrateBps||x.framesPerSecond>b.framesPerSecond?1:S===C||x.bitrateBps===b.bitrateBps||x.framesPerSecond>b.framesPerSecond?0:-1}var m,_,M=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};class L extends lo{constructor(b){super(),this.setGetStats=()=>{},this.requestRTCStats=()=>this.internalStream.requestRTCStats(),this.getStats=()=>M(this,void 0,void 0,function*(){return this.internalStream.requestRTCStats()}),this.setMuted=S=>{this.internalStream.setMuted(S)},this.getLayers=()=>this.internalStream.layers,this.getSelectedLayer=()=>this.internalStream.selectedLayer,this.getLowestQualityLayer=()=>this.internalStream.lowestQualityLayer,this.getHighestQualityLayer=()=>this.internalStream.highestQualityLayer,this.internalStream=b,this.internalStream.on(Sc.ADAPTION_CHANGED,S=>{this.emit(_h.ADAPTION_CHANGED,S)}),this.internalStream.on(Sc.LAYERS_CHANGED,S=>{this.emit(_h.LAYERS_CHANGED,S)}),this.internalStream.on(Sc.LAYER_SELECTED,(S,C)=>{this.emit(_h.LAYER_SELECTED,S,C)})}get id(){return this.internalStream.id}get participantInfo(){return this.internalStream.participantInfo}get streamType(){return this.internalStream.streamType}get mediaStreamTrack(){return this.internalStream.mediaStreamTrack}get isMuted(){return this.internalStream.isMuted}set isMuted(b){this.internalStream.setMuted(b)}get isAdapting(){return this.internalStream.isAdapting}cleanup(){this.removeAllListeners()}}class H extends av{constructor({track:b,info:S,getStats:C,remotePlaybackController:O,analyticsTracker:P,token:B}){super(b,C),this.setMuted=te=>{this.isMuted=te},this.setLayer=te=>{const z=(0,ss.cloneDeep)(te);if(this.queueLayerUpdateForValidState(z))return void this.logger.debug({msg:`setLayer:${z} queued, skipping for now`});const re=function(de,ke){if(!de)return(0,In.ok)(void 0);const Qe=typeof de=="string"?de:de.label,Be=ke.filter(Me=>Me.label===Qe)[0];return Be?(0,In.ok)(Be):(0,In.err)(`Provided layer with id ${Qe} does not exist`)}(z,this._layers);if(!re.ok){const de=re.error;return void this.logger.error({err:de,msg:"Unable to select layer, skipping skipping selection"})}const ce=re.value;if(this.isNextUpdateAdaptionOnly(ce))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(ce)||this.isAdapting?ce&&(this.logger.warn({msg:`setLayer:${JSON.stringify(ce)} `}),this.handleManualUpdate(ce)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=_s.INITIALIZING,this.prevState=_s.IDLE,this.analyticsTracker=P,this.token=B,this.id=b.id,this.info=S,this.mediaStreamTrack=b,this.remotePlaybackController=O,this.layerPollingTimeoutId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const J=$p();this.logger=new Ks(new Jd(J),pe.REMOTE_STAGE_STREAM),this.streamType===Gt.AUDIO?this.isMuted=S.audioMuted:this.isMuted=S.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers()}transitionStateTo(b){this.state!==b&&(this.prevState=this.state,this.state=b)}initializeLayerPolling(){this.streamType!==Gt.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingTimeoutId=setInterval(()=>{this.pollInternalLayers()},3e3)):this.logger.debug({msg:"Skipping initializing polling for audio streams"})}startLayerPolling(){this.layerPollingTimeoutId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingTimeoutId!==null?(clearInterval(this.layerPollingTimeoutId),this.layerPollingTimeoutId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(){this.streamType!==Gt.AUDIO?this.remotePlaybackController.getLayers().then(b=>{if(this.isStateValidForLayerUpdates()){if(!b.ok)throw Error(b.error);this.updateInternalLayersFromRemote(b.value),this.transitionStateTo(_s.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})}).catch(b=>{this.logger.error({err:b,msg:"Error calling getLayers, returning current layers"})}):this.logger.debug({msg:"Skipping layer poll request for audio stream"})}updateInternalLayersFromRemote(b){const S=this._layers,C=b.map(IS).sort(wm),O=!(0,ss.isEqual)(C,S);this._layers=C;const P=this._selectedLayer,B=this._layers.filter(te=>te.selected)[0],J=!(0,ss.isEqual)(B,P);P&&(P.selected=!1),this._selectedLayer=B,J&&(this.trackLayerUpdate(P),this.trackLayerUpdate(B)),this.isCommandQueueEmpty()&&(O&&this.emitLayersChanged(),J&&this.emitLayerSelected(B))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const b=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${b}`});for(const S of this.commandMap.keys()){const C=this.commandMap.get(S);C==null||C()}this.commandMap.clear()}queueLayerUpdateForValidState(b){if(!b)return this.commandMap.delete("setLayer"),!1;if(this.state===_s.INITIALIZING){const S=this.setLayer.bind(this,b);return this.commandMap.set("setLayer",S),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const b=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then(S=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(b,`Stream in invalid state: ${this.state}`);S.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(b,S.error)}).catch(()=>{})}resetAdaptionStateOnError(b,S){this._isAdapting=b,this.emitAdaptionChanged(),this.logger.error({err:S,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(b){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const S=this._isAdapting,C=this._selectedLayer;C&&(C.selected=!1),this._isAdapting=!1,this._selectedLayer=b,b.selected=!0,S!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(b,C),this.trackLayerUpdate(C),this.trackLayerUpdate(b),this.emitLayersChanged(),this.emitLayerSelected(b),this.remotePlaybackController.setLayer(b.label).then(O=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const P=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(S,P),void this.resetLayerOnError(C,b,P)}if(!O.ok){const P=O.error;return this.resetAdaptionStateOnError(S,P),void this.resetLayerOnError(C,b,P)}this.logger.debug({msg:`Layer successfully selected: ${b.label}`})}).catch(()=>{})}applyExistingControlState(){var b;this._isAdapting?this.remotePlaybackController.unsetLayer().then(()=>{}).catch(()=>{}):!((b=this._selectedLayer)===null||b===void 0)&&b.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then(()=>{}).catch(()=>{})}resetLayerOnError(b,S,C){S&&(S.selected=!1),b&&(b.selected=!0),this._selectedLayer=b,this.logger.error({err:C,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(b,S),this.emitLayersChanged(),b!==null&&this.emitLayerSelected(b,Zo.UNAVAILABLE),this.trackLayerUpdate(S),this.trackLayerUpdate(b)}updateLocalLayerStateBeforeRemote(b,S){this._layers=this._layers.map(C=>C.label===(b==null?void 0:b.label)?b:C.label===(S==null?void 0:S.label)?S:C).sort(wm)}trackLayerUpdate(b){var S,C;this.analyticsTracker.trackEventNoSharedProps(new cm(this.token,Qs(),(S=b==null?void 0:b.label)!==null&&S!==void 0?S:"auto",!0,Yt.SUBSCRIBE,(C=b==null?void 0:b.selected)!==null&&C!==void 0&&C,this.info.id))}isNextUpdateAdaptionOnly(b){return b===void 0&&this.isFirstLayerUpdate()||b===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(b){var S;return((S=this._selectedLayer)===null||S===void 0?void 0:S.label)===(b==null?void 0:b.label)}isStateValidForLayerUpdates(){return this.state===_s.ACTIVE||this.state===_s.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(b,S=Zo.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(b,null,2)}`}),this.emit(Sc.LAYER_SELECTED,(0,ss.cloneDeep)(b),S)}emitLayersChanged(){this.emit(Sc.LAYERS_CHANGED,(0,ss.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(Sc.ADAPTION_CHANGED,this._isAdapting)}get remote(){const b=this.weakRemoteMap.get(this.weakRemoteKey);if(b)return b;const S=new L(this);return this.weakRemoteMap.set(this.weakRemoteKey,S),S}get participantInfo(){return(0,ss.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,ss.cloneDeep)(this._layers)}get selectedLayer(){var b;return(0,ss.cloneDeep)((b=this._selectedLayer)!==null&&b!==void 0?b:void 0)}get highestQualityLayer(){return(0,ss.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,ss.cloneDeep)(this.layers[0])}pauseControls(){this.transitionStateTo(_s.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(_s.ACTIVE)}cleanup(){this.transitionStateTo(_s.DESTROYED),super.cleanup(),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(x){x.STATE_CHANGE="stateChange",x.MEDIA_STREAM_ADDED="mediaStreamAdded",x.MEDIA_STREAM_REMOVED="mediaStreamRemoved",x.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",x.ERROR="error"})(m||(m={})),function(x){x.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",x.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"}(_||(_={}));const ee=Object.assign(Object.assign({},m),_);var Ae;(function(x){x.PUBLICATION_STATE_CHANGE="publicationStateChange"})(Ae||(Ae={}));const je=Object.assign(Object.assign({},m),Ae);var Et=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};class qt extends Q_{constructor(b,S,C,O,P,B,J,te=!1){super(b,new Ks(O,pe.REMOTE_PARTICIPANT)),this.subscribeState=Io.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=z=>{this.logger.debug({msg:"subscriptionStateChange",state:z}),z===_a.DISCONNECTED?this.updateSubscriptionState(Io.NOT_SUBSCRIBED):z===_a.CONNECTED?this.updateSubscriptionState(Io.SUBSCRIBED):z===_a.CONNECTING?this.updateSubscriptionState(Io.ATTEMPTING_SUBSCRIBE):z===_a.ERRORED?this.updateSubscriptionState(Io.ERRORED):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:z})},this.onSubscriptionMediaStream=(z,re)=>{this.logger.debug({msg:"onSubscriptionMediaStream",stream:z});let ce=z.getTracks().map(de=>{const ke=new H({track:de,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:re,analyticsTracker:this.analyticsTracker,token:this.token});return this.streams.push(ke),ke});this.subscription.getDesiredSubscribeType()===Qo.AUDIO_ONLY&&(ce=ce.filter(de=>de.streamType!==Gt.VIDEO)),this.emit(ee.MEDIA_STREAM_ADDED,ce)},this.onSubscriptionError=z=>{this.emit(ee.ERROR,z)},this.onSubscriptionSeiMessageReceived=z=>{this.emit(ee.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,z)},this.onSubscriptionTransformError=z=>{this.emit(ee.ERROR,z)},this.onSubscriptionReassignmentStart=()=>{for(const z of this.streams)z.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const z of this.streams)z.resumeControls()},this.updateSubscribeStateIfNecessary=(z,re)=>{if(!this.info.capabilities.has(ya.SUBSCRIBE))return;re!==void 0&&this.subscription.updateSubscribeConfig(re);const ce=z!==Qo.NONE&&this.publishState===zi.PUBLISHED,de=this.subscribeState!==Io.NOT_SUBSCRIBED&&this.subscribeState!==Io.ERRORED;if(ce&&!de)this.subscription.updateDesiredSubscribeType(z),this.subscribe();else if(!ce&&de)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(z);else if(this.subscribeState===Io.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==z)try{z===Qo.AUDIO_ONLY?this.emit(ee.MEDIA_STREAM_REMOVED,this.streams.filter(ke=>ke.streamType===Gt.VIDEO)):z===Qo.AUDIO_VIDEO&&this.emit(ee.MEDIA_STREAM_ADDED,this.streams.filter(ke=>ke.streamType===Gt.VIDEO)),this.subscription.updateDesiredSubscribeType(z)}catch(ke){this.logger.error({err:ke,msg:"error updating subscribe type"})}},this.updatePublishState=z=>{const re=z&&this.publishState===zi.PUBLISHED,ce=!z&&this.publishState===zi.NOT_PUBLISHED;return!re&&!ce&&(this.info.isPublishing=z,this.publishState=z?zi.PUBLISHED:zi.NOT_PUBLISHED,!0)},this.updateStreamState=(z,re)=>{this.audioMuted!==z&&(this.audioMuted=z,this.info.audioMuted=z,this.updateStreamMuteState(Gt.AUDIO,z)),this.videoStopped!==re&&(this.videoStopped=re,this.info.videoStopped=re,this.updateStreamMuteState(Gt.VIDEO,re))},this.updateStreamMuteState=(z,re)=>{const ce=this.streams.find(de=>de.streamType===z);ce?(ce.setMuted(re),this.emit(ee.MEDIA_STREAM_MUTE_CHANGED,ce)):this.logger.warn({msg:`tried to update mute state for ${z} stream on participant ${this.info.id} that didn't exist`})},this.cleanup=()=>{for(const z of this.streams)z.remote.removeAllListeners(),z.removeAllListeners();this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==Io.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=J,this.token=S,this.createSubscription=()=>{const z=new vd(b.id,S,C,O,J,P,B);return z.on(gf,this.onSubscriptionStateChange),z.on(me,this.onSubscriptionMediaStream),z.on(Wo,this.onSubscriptionError),z.on(Ha,this.onSubscriptionSeiMessageReceived),z.on(Hs,this.onSubscriptionTransformError),z.on(Mr,this.onSubscriptionReassignmentStart),z.on(ol,this.onSubscriptionReassignmentDone),z.on(al,this.onSubscriptionReassignmentDone),z},this.subscription=this.createSubscription(),te&&(this.publishState=zi.PUBLISHED)}updateSubscriptionState(b){b!==this.subscribeState&&(this.subscribeState=b,this.emit(ee.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(Io.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===Io.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off(gf,this.onSubscriptionStateChange),this.subscription.off(me,this.onSubscriptionMediaStream),this.subscription.off(Wo,this.onSubscriptionError),this.subscription.off(Hs,this.onSubscriptionTransformError);const b=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),b===Qo.AUDIO_ONLY?this.emit(ee.MEDIA_STREAM_REMOVED,this.streams.filter(S=>S.streamType===Gt.AUDIO)):this.emit(ee.MEDIA_STREAM_REMOVED,this.streams),this.updateSubscriptionState(Io.NOT_SUBSCRIBED),this.streams.forEach(S=>{S.cleanup()}),this.streams=[]}triggerIceRestart(b){return Et(this,void 0,void 0,function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(b)}finally{this.reassigning=!1}})}}const fn=Yt.PUBLISH;class pr{constructor(b,S){this.analyticsTracker=b,this.token=S,this.action=fn,this.traceId=Qs()}trackPublish(b){const{action:S,traceId:C,analyticsTracker:O,token:P}=this;return O.trackEvent(new fl({token:P,traceId:C})),{getTraceId:()=>C,trackPublishStarted({totalDurationWithRetries:B,retryTimes:J,sfuResource:te,peerClientPerfStats:z}){const{optionsDuration:re,postDuration:ce,timeToCandidate:de,timeToConnected:ke,sdpExchangeDuration:Qe,sdpExchangeTransport:Be,setRemoteDescDuration:Me,peerConnectionDuration:Te}=z,{edpInitialConnectDuration:gt,edpInitialConnectRetries:Ut,edpInitialStateDuration:en,edpStateUpdateCount:Pt}=b;O.trackEvent(new nv({token:P,traceId:C,optionsDuration:re,postDuration:ce,timeToCandidate:de,totalDuration:ke,edpInitialConnectDuration:gt,edpInitialConnectRetries:Ut,edpInitialStateDuration:en,edpStateUpdateCount:Pt,sdpExchangeDuration:Qe,sdpExchangeTransport:Be,setRemoteDescDuration:Me,peerConnectionDuration:Te,publishRetries:J,totalDurationWithRetries:B,sfuResource:te}))},trackPublishFailed(B){const J=((z,re,ce)=>{if(z instanceof Qn)return z;let de="";return z instanceof oi.AxiosError&&(de+=`AxiosError - ${z.code}`),new Qn(Object.assign(Object.assign(Object.assign({},Lt.PUBLISH_FAILURE),{action:fn,token:re,traceId:ce,tag:mc.PUBLISH_RELATED,location:"publish",details:`${de} ${z.message}`}),{fatal:!0}))})(B,P,C);O.trackEvent(new dm({token:P,traceId:C,code:J.code,message:J.message,fatal:J.fatal,nominal:J.nominal}));const te=new Qn(Object.assign(Object.assign({},Lt.PUBLISH_FAILURE),{action:S,token:P,traceId:C,tag:mc.PUBLISH_RELATED,location:"publish"}));return B instanceof Qn&&(te.fatal=B.fatal,te.nominal=B.nominal,te.location=`publish > ${B.location}`),O.trackError(te),J},trackUnpublish:()=>{O.trackEvent(new Af({token:P,traceId:C}))},trackEndSucceeded:B=>{O.trackEvent(new uh({token:P,isUnpublishSuccessful:!0,traceId:C,reason:B}))},trackEndFailed:B=>{const J=new Qn(Object.assign(Object.assign({},Lt.UNPUBLISH_FAILURE),{token:P,traceId:C,tag:mc.UNPUBLISH_RELATED,location:"unpublish"}));return B!==Os.UNLOAD&&B!==Os.UNPUBLISH||this.analyticsTracker.trackError(J),O.trackEvent(new uh({token:P,isUnpublishSuccessful:!1,traceId:C,reason:B})),J}}}}var gn,Zn,bn=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};(function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"})(gn||(gn={})),function(x){x.STATE_CHANGE="stateChange",x.ERROR="error",x.TRANSFORM_ERROR="transformError"}(Zn||(Zn={}));class ea extends lo{constructor(b,S,C,O){super(),this.token=b,this.stageConnection=S,this.nonScopedLogger=C,this.analyticsTracker=O,this.tracksToPublish=[],this.publicationState=gn.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=Yt.PUBLISH,this.start=P=>{this.publicationState===gn.DISCONNECTED||this.publicationState===gn.ERRORED?(this.tracksToPublish=P,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=P=>bn(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(P)}),this.stop=(P=!1)=>bn(this,void 0,void 0,function*(){this.peerClient.off(Is,this.onPeerClientConnectionStateChange,this),this.peerClient.off(ot,this.onPeerClientTransformError,this),yield this.unpublish(P),this.updateState(gn.DISCONNECTED)}),this.processStateUpdate=P=>{const{publicationState:B}=this;B===gn.DISCONNECTED||B===gn.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(gn.CONNECTING),this.tryPublish()):B===gn.CONNECTING?P===nt.CONNECTED&&this.updateState(gn.CONNECTED):B===gn.CONNECTED&&P===nt.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(Os.CONNECTION_FAIL),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(gn.CONNECTING),this.tryPublish()))},this.updateState=P=>{this.publicationState=P,this.emit(Zn.STATE_CHANGE,P)},this.tryPublish=()=>bn(this,void 0,void 0,function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const P=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish(P);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.tracksToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const B=this.peerClient.getSfuResource(),J=this.latestPubAttemptNum-1,te=performance.now()-this.startConnectingTimestamp,z=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:B,totalDurationWithRetries:te,retryTimes:J,peerClientPerfStats:z}),this.latestPubAttemptNum=0}catch(B){this.logger.error({msg:"publish failed!",err:B});const J=this.attemptTracker.trackPublishFailed(B),te=J.code===Lt.OPERATION_ABORTED.code,z=J.fatal,re=this.latestPubAttemptNum===4;if(te)return;if(z||re)return this.logger.error({msg:`Stopping attempts: isFatal=${z}, isLastAttempt=${re}`,err:B}),this.updateState(gn.ERRORED),void this.emit(Zn.ERROR,J);const ce=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${ce}ms`}),this.nextAttemptTimerId=window.setTimeout(()=>{this.tryPublish()},ce)}}}),this.publish=(P,B)=>bn(this,void 0,void 0,function*(){this.peerClient.initTracksToPublish(P),yield this.peerClient.connect({audioOnly:!1,traceId:B})}),this.unpublish=(P=!1)=>bn(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===gn.DISCONNECTED||this.publicationState===gn.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const B=P?Os.UNLOAD:Os.UNPUBLISH;try{P?this.peerClient.disconnect(P):yield this.peerClient.disconnect(P),this.attemptTracker.trackEndSucceeded(B)}catch{this.attemptTracker.trackEndFailed(B)}}),this.replaceOrUpdateTrack=P=>bn(this,void 0,void 0,function*(){this.tracksToPublish.find(B=>B.track.kind===P.track.kind)?this.tracksToPublish=this.tracksToPublish.map(B=>B.track.kind===P.track.kind?P:B):this.tracksToPublish.push(P),yield this.peerClient.replaceOrUpdateTrack(P)}),this.onPeerClientConnectionStateChange=P=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${P}`,state:P}),this.processStateUpdate(P)},this.onPeerClientTransformError=P=>{this.emit(Zn.TRANSFORM_ERROR,P)},this.onIncompatibleCodecs=P=>bn(this,void 0,void 0,function*(){yield this.peerClient.onIncompatibleCodecs(P)}),this.sendSeiMessage=P=>{this.peerClient.sendSeiMessage(P)},this.peerClient=new Df(b,this.nonScopedLogger,this.action,uo(this.action),Qs(),this.analyticsTracker,void 0,S,void 0),this.logger=new Ks(C,pe.PUBLICATION),this.peerClient.on(Is,this.onPeerClientConnectionStateChange,this),this.peerClient.on(ot,this.onPeerClientTransformError,this),this.publishTracker=new pr(this.analyticsTracker,this.token)}removeTrack(b){return bn(this,void 0,void 0,function*(){this.tracksToPublish=this.tracksToPublish.filter(S=>S.track.kind!==b),yield this.peerClient.removeTrack(b)})}}var Rr,Ve=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};class Je extends Q_{constructor(b,S,C,O,P){super(b,new Ks(C,pe.LOCAL_PARTICIPANT)),this.onPublicationStateChange=B=>{switch(this.logger.debug({msg:"publicationStateChange",state:B}),B){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(zi.PUBLISHED);break;case"connecting":this.updatePublishState(zi.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(zi.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:B})}},this.onPublicationError=B=>{this.emit(je.ERROR,B)},this.updatePublishState=B=>{this.info.isPublishing=B===zi.PUBLISHED,this.publishState=B,this.emit(je.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=B=>{B.streamType===Gt.AUDIO&&(this.audioMuted=B.isMuted,this.info.audioMuted=B.isMuted),B.streamType===Gt.VIDEO&&(this.videoStopped=B.isMuted,this.info.videoStopped=B.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(je.MEDIA_STREAM_MUTE_CHANGED,B)},this.publish=B=>{this.logger.debug({msg:"publish"}),B.forEach(te=>{te&&(this.setupStreamListener(te),te.streamType===Gt.AUDIO?(this.audioStream=te,this.audioMuted=!te.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):te.streamType===Gt.VIDEO&&(this.videoStream=te,this.videoStopped=!te.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),te.setGetStats(this.publication.requestRTCStats))}),this.connection.emitStageState(this.audioMuted,this.videoStopped);const J=B.map(te=>vm(te.mediaStreamTrack,te.mediaConfig));this.publication.start(J)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==zi.NOT_PUBLISHED&&this.publishState!==zi.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=B=>Ve(this,void 0,void 0,function*(){yield this.publication.onIncompatibleCodecs(B)}),this.sendSeiMessage=B=>{this.publication.sendSeiMessage(B)},this.sendSeiMessageString=B=>{const J=new TextEncoder().encode(B);this.publication.sendSeiMessage(J)},this.connection=O,this.createPublication=()=>{const B=new ea(S,O,C,P);return B.on(Zn.STATE_CHANGE,this.onPublicationStateChange),B.on(Zn.ERROR,this.onPublicationError),B.on(Zn.TRANSFORM_ERROR,this.onPublicationError),B},this.publication=this.createPublication()}setupStreamListener(b){b.on(Jl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute)}removeTrack(b){var S,C;b.streamType===Gt.AUDIO?((S=this.audioStream)===null||S===void 0||S.off(Jl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):b.streamType===Gt.VIDEO&&((C=this.videoStream)===null||C===void 0||C.off(Jl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(b.streamType)}replaceOrAddTrack(b){return Ve(this,void 0,void 0,function*(){this.setupStreamListener(b),b.setGetStats(this.publication.requestRTCStats),b.streamType===Gt.AUDIO?(this.audioStream=b,this.audioMuted=!b.mediaStreamTrack.enabled):b.streamType===Gt.VIDEO&&(this.videoStream=b,this.videoStopped=!b.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const S=vm(b.mediaStreamTrack,b.mediaConfig);yield this.publication.replaceOrUpdateTrack(S)})}unpublish(){if(this.publishState===zi.NOT_PUBLISHED||this.publishState===zi.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off(Zn.STATE_CHANGE,this.onPublicationStateChange),this.publication.off(Zn.ERROR,this.onPublicationError),this.publication.off(Zn.TRANSFORM_ERROR,this.onPublicationError);const b=[this.audioStream,this.videoStream].filter(S=>!!S);b.forEach(S=>{S.cleanup()}),this.audioStream=void 0,this.videoStream=void 0,this.emit(je.MEDIA_STREAM_REMOVED,b),this.updatePublishState(zi.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(x){x.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",x.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",x.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",x.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",x.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",x.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",x.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",x.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",x.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",x.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",x.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",x.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",x.ERROR="error",x.STAGE_LEFT="stageLeft"})(Rr||(Rr={}));var ut=function(x,b,S,C){return new(S||(S=Promise))(function(O,P){function B(z){try{te(C.next(z))}catch(re){P(re)}}function J(z){try{te(C.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((C=C.apply(x,[])).next())})};const Ht=x=>!!x;class yn extends lo{constructor(b,S){super(),this.connectionState=wi.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=(O,P)=>{var B,J;if(this.connectionState=O,O===wi.ERRORED&&(this.connectionStateErrored=!0),O===wi.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==zi.NOT_PUBLISHED&&this.stageConnection.emitStageState((B=this.localParticipant)===null||B===void 0?void 0:B.audioMuted,(J=this.localParticipant)===null||J===void 0?void 0:J.videoStopped),O===wi.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),O===wi.DISCONNECTED){if(P&&P!==yc.CLIENT_RECONNECT&&P!==yc.USER_INITIATED){let te=dr.UNKNOWN;(function(z){return Object.values(dr).includes(z)})(P)?te=P:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${P}`}),this.cleanup(te)}}else this.emit(Rr.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var O;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new _f(this.token,(O=this.joinTraceId)!==null&&O!==void 0?O:new pf,"reusing local participant from repeat join",Yt.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const O=function(P){var B,J;const te=new Set;return P.token.claims.capabilities.allow_publish&&te.add(ya.PUBLISH),P.token.claims.capabilities.allow_subscribe&&te.add(ya.SUBSCRIBE),{id:P.token.participantID,userId:(B=P.token.userID)!==null&&B!==void 0?B:"",attributes:(J=P.token.claims.attributes)!==null&&J!==void 0?J:{},capabilities:te,isLocal:!0,userInfo:{},videoStopped:P.videoStopped,audioMuted:P.audioMuted,isPublishing:P.isPublishing}}({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new Je(O,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(je.PUBLICATION_STATE_CHANGE,P=>{this.onPublishStateChanged(this.localParticipant.info,P)}),this.localParticipant.on(je.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(je.MEDIA_STREAM_MUTE_CHANGED,P=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,P):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})}),this.localParticipant.on(je.ERROR,P=>{this.errorManager.handleError(P,ku.PUBLISH_ERROR)}),this.emit(Rr.STAGE_PARTICIPANT_JOINED,O)},this.onRemoteParticipantJoined=O=>{var P;if(O.id!==((P=this.localParticipant)===null||P===void 0?void 0:P.info.id)){const B=function(re){return{id:re.id,userId:re.userId,attributes:re.attributes,capabilities:new Set([ya.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:re.videoStopped,audioMuted:re.audioMuted,isPublishing:re.isPublishing}}(O);if(this.participants.has(B.id))return void this.logger.warn({msg:"Remote participant already tracked"});let J=Qo.NONE;B.capabilities.has(ya.SUBSCRIBE)&&(J=In.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(B),J),this.updateManagerWithExternalSubscribeConfig(B,"joined"));const te=this.configManager.getSubscribeConfigSnapshot(B.id),z=new qt(B,this.token,this.stageConnection,this.logger.unwrap(),J,te,this.analyticsTracker,O.isPublishing);this.participants.set(B.id,z),this.setupRemoteParticipantListeners(z),this.emit(Rr.STAGE_PARTICIPANT_JOINED,z.info),z.updateSubscribeStateIfNecessary(J)}},this.setupRemoteParticipantListeners=O=>{O.on(ee.SUBSCRIPTION_STATE_CHANGE,P=>{this.onParticipantSubscribeStateChanged(O.info.id,P)}),O.on(ee.MEDIA_STREAM_ADDED,P=>{const B=this.participants.get(O.info.id);if(B){for(const J of P)this.setupRemoteParticipantStreamEvents(B.info,J);this.emit(Rr.STAGE_PARTICIPANT_STREAMS_ADDED,B.info,cv(P)),this.updateStreamLayerForParticipant(O)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})}),O.on(ee.MEDIA_STREAM_REMOVED,P=>{const B=this.participants.get(O.info.id);B?this.emit(Rr.STAGE_PARTICIPANT_STREAMS_REMOVED,B.info,cv(P)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})}),O.on(ee.MEDIA_STREAM_MUTE_CHANGED,P=>{this.onStreamMuteChange(O.info,P.remote)}),O.on(ee.ERROR,P=>{this.errorManager.handleError(P,ku.SUBSCRIBE_ERROR)}),O.on(ee.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,P=>{this.onSeiMessageReceived(O.info,P)})},this.onRemoteParticipantLeft=O=>{if(this.connectionState!==wi.CONNECTED)return;const P=this.participants.get(O);P?(P.participantLeave(),P.unsubscribe(),P.cleanup(),this.participants.delete(O),this.emitParticipantLeave(P.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=O=>{this.emit(Rr.STAGE_PARTICIPANT_LEFT,O)},this.onRemoteParticipantStateChanged=O=>{const P=this.participants.get(O.id);if(!P)return void this.logger.warn({msg:"Remote participant updated but not tracked"});P.updatePublishState(O.isPublishing)&&this.onPublishStateChanged(P.info,P.publishState),P.updateStreamState(O.audioMuted,O.videoStopped);const B=this.strategyWrapper.shouldSubscribeToParticipant(P.info);if(In.isNotOk(B))return;this.updateManagerWithExternalSubscribeConfig(P.info,"updated");const J=this.configManager.getSubscribeConfigSnapshot(P.info.id),te=In.getOk_or(B,Qo.NONE);P.updateSubscribeStateIfNecessary(te,J)},this.onPublishStateChanged=(O,P)=>{this.emit(Rr.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,O,P)},this.onParticipantSubscribeStateChanged=(O,P)=>{const B=this.participants.get(O);B?this.emit(Rr.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,B.info,P):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=O=>{this.localParticipant&&this.emit(Rr.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,O)},this.onLocalStreamsRemoved=O=>{this.localParticipant&&this.emit(Rr.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,O)},this.onStreamMuteChange=(O,P)=>{this.emit(Rr.STAGE_STREAM_MUTE_CHANGED,O,P)},this.onSeiMessageReceived=(O,P)=>{this.emit(Rr.STAGE_STREAM_SEI_MESSAGE_RECEIVED,O,P)},this.leave=()=>{this.cleanup(dr.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var O;this.participants.forEach(P=>{P.quickUnsubscribe()}),(O=this.localParticipant)===null||O===void 0||O.quickUnpublish(),this.stageConnection.disconnect(),this.emit(Rr.STAGE_CONNECTION_STATE_CHANGED,wi.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=O=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new Qp({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:O})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const P=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(P);const B=this.participants.entries();for(const[J,te]of B)te.unsubscribe(),this.participants.delete(J),te.cleanup(),this.emitParticipantLeave(te.info);md.destroy(),this.stageConnection.disconnect(),this.emit(Rr.STAGE_CONNECTION_STATE_CHANGED,wi.DISCONNECTED),this.emit(Rr.STAGE_LEFT,O),this.stageConnection.removeAllListeners(),this.stageConnection=new gm(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners(),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach(O=>{if(O.info.capabilities.has(ya.SUBSCRIBE)){const P=this.strategyWrapper.shouldSubscribeToParticipant(O.info);if(In.isNotOk(P))return;const B=In.getOk_or(P,Qo.NONE);this.updateManagerWithExternalSubscribeConfig(O.info,"updated");const J=this.configManager.getSubscribeConfigSnapshot(O.info.id);O.updateSubscribeStateIfNecessary(B,J),this.updateStreamLayerForParticipant(O)}}),this.updateStreamsToPublishIfNecessary()},this.updateStreamsToPublishIfNecessary=()=>{var O;if(!this.localParticipant||!(!((O=this.localParticipant)===null||O===void 0)&&O.info.capabilities.has(ya.PUBLISH)))return;const P=this.localParticipant.publishState!==zi.NOT_PUBLISHED&&this.localParticipant.publishState!==zi.ERRORED,B=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(In.isNotOk(B))return;let J=In.getOk_or(B,!1);if(!P&&!J)return;if(P&&!J)return void this.localParticipant.unpublish();const te=this.strategyWrapper.stageStreamsToPublish();if(In.isNotOk(te)){const re=In.getErr(te);if(re instanceof Error&&re.cause==="UserStrategy")throw re;return}const z=In.getOk_or(te,[]);J=J&&z.length>0,!P&&J?(this.localParticipant.publish(z),this.onLocalStreamsAdded(z)):this.syncTracksToPublish(z)},this.syncTracksToPublish=O=>{var P;if(!this.localParticipant)return;const B=this.localParticipant.audioStream,J=this.localParticipant.videoStream,{updates:te,streamsToAdd:z,streamsToRemove:re}=this.determineStreamUpdates(B,J,O);if(te.length){for(const ce of te)ce.newStream?(P=this.localParticipant)===null||P===void 0||P.replaceOrAddTrack(ce.newStream):ce.oldStream&&this.localParticipant.removeTrack(ce.oldStream);re.length!==0&&this.onLocalStreamsRemoved(re),z.length!==0&&this.onLocalStreamsAdded(z)}},this.determineStreamUpdates=(O,P,B=[])=>{const J=[],te=B.slice(0,2);if(te.sort((ce,de)=>ce.streamType===Gt.AUDIO?-1:1),te.length===0)O&&J.push({oldStream:O}),P&&J.push({oldStream:P});else if(te.length===1){const ce=te[0];ce.streamType===Gt.AUDIO?P&&J.push({oldStream:P}):ce.streamType===Gt.VIDEO&&O&&J.push({oldStream:O})}te.forEach(ce=>{var de,ke;ce.streamType===Gt.AUDIO?O?O.id===ce.id&&(0,ss.isEqual)(O.mediaConfig,ce.mediaConfig)||(!!(!((de=O.mediaConfig)===null||de===void 0)&&de.stereo)!=!!(!((ke=ce.mediaConfig)===null||ke===void 0)&&ke.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),J.push({oldStream:O,newStream:ce})):J.push({newStream:ce}):ce.streamType===Gt.VIDEO&&(P?P.id===ce.id&&(0,ss.isEqual)(P.mediaConfig,ce.mediaConfig)||J.push({oldStream:P,newStream:ce}):J.push({newStream:ce}))});const z=J.map(ce=>ce.newStream).filter(Ht),re=J.map(ce=>ce.oldStream).filter(Ht);return{updates:J,streamsToAdd:z,streamsToRemove:re}},this.onReassignmentMessage=O=>ut(this,void 0,void 0,function*(){if(bu("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!Yo.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const P=Qs();this.trackReassignmentRequest(O,P);const B=this.participants.get(O.remoteParticipantId),J=this.token.participantID,te=function(z,{localParticipantId:re,remoteParticipant:ce}){const{participantId:de}=z;if(re!==de)return In.err(Object.assign(Object.assign({},Lt.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${de}`}));if(!ce)return In.err(Object.assign(Object.assign({},Lt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${ce}`}));if(ce.isReassigning())return In.err(Lt.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const ke=ce.subscription.peerClient.getConnectionState();return[nt.CONNECTED,nt.DISCONNECTED].includes(ke)?In.ok(ce):In.err(Object.assign(Object.assign({},Lt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${ke}`}))}(O,{localParticipantId:J,remoteParticipant:B});if(!te.ok)this.trackReassignmentRequestRejected(te.error,P);else try{const{token:z,nodeOverride:re}=O;yield te.value.triggerIceRestart({assignmentToken:z,traceId:P,nodeOverride:re})}catch(z){this.logger.error({msg:"Reassignment failed.",err:z})}}),this.onIncompatibleCodecsMessage=O=>ut(this,void 0,void 0,function*(){var P;yield(P=this.localParticipant)===null||P===void 0?void 0:P.onIncompatibleCodecs(O.codecs)}),this.analyticsTracker=new rd;const C=$p();this.logger=new Ks(new Jd(C),pe.STAGE),this.strategyWrapper=new Gy(S,this.logger),this.configManager=new zy({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:fs.DEFAULT,minDelayWhenSubscribeOnly:fs.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:Cu.LOWEST_QUALITY}}}),this.errorManager=new Vy;try{this.token=dl(b,this.analyticsTracker)}catch(O){const P=new Qn(Object.assign({action:Yt.JOIN,token:b,traceId:Qs(),tag:mc.JOIN_RELATED,location:"Stage.constructor"},Lt.MALFORMED_TOKEN));throw O instanceof Error&&(P.details=O.message),this.errorManager.handleError(P,ku.JOIN_ERROR)||O}this.stageConnection=new gm(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(Tu,(b,S)=>{this.onConnectionStateChanged(b,S)}),this.stageConnection.on(gc,b=>{this.onRemoteParticipantJoined(b)}),this.stageConnection.on(Pi,b=>{this.onRemoteParticipantLeft(b.id)}),this.stageConnection.on(ks,b=>{var S;b.id!==((S=this.localParticipant)===null||S===void 0?void 0:S.info.id)&&this.onRemoteParticipantStateChanged(b)}),this.stageConnection.on($s,b=>ut(this,void 0,void 0,function*(){yield this.onReassignmentMessage(b)})),this.stageConnection.on(cd,b=>ut(this,void 0,void 0,function*(){yield this.onIncompatibleCodecsMessage(b)})),this.stageConnection.on(Fy,b=>{b instanceof Qn&&this.analyticsTracker.trackError(b),this.errorManager.handleError(b,ku.JOIN_ERROR)}),this.errorManager.on(vh.ERROR,b=>{this.emit(Rr.ERROR,b)})}setupRemoteParticipantStreamEvents(b,S){const C=S.remote;S.on(Sc.ADAPTION_CHANGED,O=>{this.emit(Rr.STAGE_STREAM_ADAPTION_CHANGED,b,C,O)}),S.on(Sc.LAYERS_CHANGED,O=>{this.emit(Rr.STAGE_STREAM_LAYERS_CHANGED,b,C,O)}),S.on(Sc.LAYER_SELECTED,(O,P)=>{this.emit(Rr.STAGE_STREAM_LAYER_SELECTED,b,C,O,P)}),S.layers.length>0&&(this.emit(Rr.STAGE_STREAM_LAYERS_CHANGED,b,C,C.getLayers()),this.emit(Rr.STAGE_STREAM_LAYER_SELECTED,b,C,C.getSelectedLayer(),Zo.SELECTED))}join(){return ut(this,void 0,void 0,function*(){this.analyticsTracker.start(),this.joinTraceId=Qs(),this.analyticsTracker.trackEvent(new Mf({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(Qs(),mc.JOIN_RELATED,"join")}catch(b){throw this.errorManager.handleError(b,ku.JOIN_ERROR)||b}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===wi.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(b){throw this.logger.error({err:b,msg:"error joining stage"}),this.errorManager.handleError(b,ku.JOIN_ERROR,!1)||b}})}replaceStrategy(b){this.strategyWrapper.setStrategy(b),this.refreshStrategy()}updateManagerWithExternalSubscribeConfig(b,S){const C=In.getOk(this.strategyWrapper.subscribeConfiguration(b));if(C===void 0)return;const O=b.id;if(this.configManager.handleExternalSubscribeConfigUpdate(O,C,Ff.API)){const P=this.configManager.getSubscribeConfigSnapshot(O);this.analyticsTracker.trackEventNoSharedProps(new Tf(this.token,this.joinTraceId,{trigger:S==="joined"?"initial":"ad-hoc",remote_participant_id:O,min_delay_when_publishing:as(P.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:as(P.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:P.inBandMessaging.enabled,simulcast_initial_layer_preference:P.simulcast.initialLayerPreference}))}}updateStreamLayerForParticipant(b){b.streams.forEach(S=>{if(S.streamType==="audio")return;const C=this.strategyWrapper.preferredLayerForStream(b.info,S.remote),O=In.getOk_or(C,void 0);S.setLayer(O)})}trackReassignmentRequestRejected(b,S){const{token:C}=this,O=new Qn(Object.assign(Object.assign({},b),{token:C,action:Yt.JOIN,traceId:S,tag:mc.SUBSCRIBE_RELATED,location:"publish"}));this.logger.error({err:O,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(O)}trackReassignmentRequest(b,S){const{token:C}=this;this.analyticsTracker.trackEvent(new MS({token:C,traceId:S,targetLocalParticipantId:b.participantId,targetRemoteParticipantId:b.remoteParticipantId}))}}var dr;(function(x){x.UNKNOWN="unknown",x.USER_INITIATED="user-initiated",x.TOKEN_REUSED="token-reused",x.PARTICIPANT_DISCONNECTED="participant-disconnected",x.STAGE_DELETED="stage-deleted"})(dr||(dr={}));const hr=d})(),s})())})(ZZ);var wWe=ZZ.exports;const v0=Nl(wWe);let Hc;const bl=Xh("broadcast",["second"],t=>{if(bl.session(t))switch(t.target){case"startstream":eu(bl,async()=>{if(he(Hc))ai(bl,"session","session is already open");else{const e=window.innerHeight>window.innerWidth;Hc=v0.create({streamConfig:e?v0.STANDARD_PORTRAIT:v0.STANDARD_LANDSCAPE,logLevel:v0.LOG_LEVEL.DEBUG}),Hc.on(v0.BroadcastClientEvents.ACTIVE_STATE_CHANGE,function(i){console.info({activestate:i})}),Hc.on(v0.BroadcastClientEvents.CONNECTION_STATE_CHANGE,function(i){Ar(bl,i)}),Hc.on(v0.BroadcastClientEvents.ERROR,function(i){ai(bl,"connection",i),Hc=void 0});const n=document.querySelector("canvas");if(he(n))await Hc.addImageSource(n,"video",{index:1});else{ai(bl,"video","unabled to find canvas element"),Hc=void 0;return}const r=YVe();if(he(r))await Hc.addAudioInputDevice(r.stream,"audio");else{ai(bl,"video","unable create media audio node destination"),Hc=void 0;return}Ar(bl,"created client")}nr(t.data)&&he(Hc)&&(sp(bl,"broadcasting in"),ti(bl,"3","..."),await Zf(1e3),ti(bl,"2","..."),await Zf(1e3),ti(bl,"1","..."),await Zf(1e3),sp(bl,"GOING LIVE"),await Hc.startBroadcast(t.data,"https://g.webrtc.live-video.net:4443"))});break;case"stopstream":he(Hc)?(Hc.stopBroadcast(),Hc.delete(),Hc=void 0,Ar(bl,"closed client")):ai(bl,"session","need an active session to stop stream");break}}),sj=Object.prototype.toString.call(typeof Bn<"u"?Bn:0)==="[object process]";var wv,Kn;(function(t){t[t.CRITICAL=0]="CRITICAL",t[t.ERROR=1]="ERROR",t[t.WARNING=2]="WARNING",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t[t.TRACE=7]="TRACE"})(Kn||(Kn={}));function oj(t){if(typeof t=="number"){if(Object.prototype.hasOwnProperty.call(Kn,t))return t;var e=Object.keys(Kn).map(function(r){return parseInt(r,10)}).filter(function(r){return!isNaN(r)&&r<t});return e.length?Math.max.apply(Math,e):Kn.WARNING}var n=t.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(Kn,n))throw new Error("Unknown log level string: ".concat(t));return Kn[n]}var xWe=sj?console.log.bind(console):console.debug.bind(console),eee=(wv={},wv[Kn.CRITICAL]=console.error.bind(console),wv[Kn.ERROR]=console.error.bind(console),wv[Kn.WARNING]=console.warn.bind(console),wv[Kn.INFO]=console.info.bind(console),wv[Kn.DEBUG]=xWe.bind(console),wv[Kn.TRACE]=console.trace.bind(console),wv);function D_(t){return function(e,n){Object.defineProperty(e,n,{get:function(){},set:function(r){Object.defineProperty(this,n,{value:r,writable:!0,enumerable:t})},enumerable:t})}}function mF(t){return ao(this,void 0,Promise,function(){return E4(this,function(e){switch(e.label){case 0:return typeof t!="function"?[3,2]:[4,t()];case 1:return[2,e.sent()];case 2:return[2,t]}})})}function CWe(t){return typeof t=="function"?t():t}function tee(t){var e,n,r;return E4(this,function(i){switch(i.label){case 0:e=0,n=1,i.label=1;case 1:return e<t?[4,e]:[3,3];case 2:return i.sent(),r=Kk([n,e+n],2),e=r[0],n=r[1],[3,1];case 3:return[4,t];case 4:return i.sent(),[3,3];case 5:return[2]}})}function aC(t,e){return Object.assign.apply(Object,oF([{}],Kk(t.map(e)),!1))}function gF(t,e){Object.entries(t).forEach(function(n){var r=Kk(n,2),i=r[0],s=r[1];return e(s,i)})}function nee(t){return t==null}function hw(t,e){return nee(t)?null:e(t)}function ree(t,e){return nee(t)?void 0:e(t)}function RWe(t){return ao(this,void 0,Promise,function(){return E4(this,function(e){switch(e.label){case 0:return[4,new Promise(function(n){return setTimeout(n,t)})];case 1:return e.sent(),[2]}})})}function vF(){var t,e,n=new Promise(function(r,i){t=r,e=i});return{promise:n,resolve:t,reject:e}}function AWe(t,e,n){if(typeof t=="number"&&(t=t.toString()),e=e-t.length,e<=0)return t;n===void 0&&(n=" ");var r="";do(e&1)===1&&(r+=n),e>>=1,e&&(n+=n);while(e);return r+t}function V0(t,e,n){var r=t.split(e);return r.length<=n?r:oF(oF([],Kk(r.slice(0,n-1)),!1),[r.slice(n-1).join(e)],!1)}var MWe={},OD,kD,OA=typeof Bn>"u"?[]:(kD=(OD=MWe.LOGGING)===null||OD===void 0?void 0:OD.split(";").map(function(t){var e=t.split("=",2),n=e[0],r=e[1];return r?[n==="default"?void 0:n.split(":"),oj(r)]:null}).filter(function(t){return!!t}).sort(function(t,e){var n,r,i=t[0],s=e[0];return((n=s==null?void 0:s.length)!==null&&n!==void 0?n:0)-((r=i==null?void 0:i.length)!==null&&r!==void 0?r:0)}))!==null&&kD!==void 0?kD:[],ND=OA.findIndex(function(t){var e=t[0];return!e}),iee=void 0;ND!==-1&&(iee=OA[ND][1],OA.splice(ND));function IWe(t,e){return e.length<=t.length&&e.every(function(n,r){return n===t[r]})}function see(t){for(var e=t.split(":"),n=0,r=OA;n<r.length;n++){var i=r[n],s=i[0],o=i[1];if(IWe(e,s))return o}return iee}var oee=function(){function t(e){var n=e.name,r=e.minLevel,i=e.emoji,s=i===void 0?!1:i,o=e.colors,a=e.timestamps,c=a===void 0?sj:a,l,u;this._name=n,this._minLevel=(u=(l=ree(r,function(d){return oj(d)}))!==null&&l!==void 0?l:see(n))!==null&&u!==void 0?u:Kn.WARNING,this._emoji=s,this._colors=o,this._timestamps=c}return t.prototype.crit=function(e){this.log(Kn.CRITICAL,e)},t.prototype.error=function(e){this.log(Kn.ERROR,e)},t.prototype.warn=function(e){this.log(Kn.WARNING,e)},t.prototype.info=function(e){this.log(Kn.INFO,e)},t.prototype.debug=function(e){this.log(Kn.DEBUG,e)},t.prototype.trace=function(e){this.log(Kn.TRACE,e)},t}(),OWe=function(t){lZ(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){if(!(n>this._minLevel)){var i=eee[n],s="[".concat(this._name,"] ").concat(r);this._timestamps&&(s="[".concat(new Date().toISOString(),"] ").concat(r)),i(s)}},e}(oee),kWe=function(){function t(e){var n=e.name,r=e.minLevel,i=e.custom,s;this._minLevel=(s=ree(r,function(o){return oj(o)}))!==null&&s!==void 0?s:see(n),this._override=typeof i=="function"?{log:i}:i}return t.prototype.log=function(e,n){this._shouldLog(e)&&this._override.log(e,n)},t.prototype.crit=function(e){this._override.crit?this._shouldLog(Kn.CRITICAL)&&this._override.crit(e):this.log(Kn.CRITICAL,e)},t.prototype.error=function(e){this._override.error?this._shouldLog(Kn.ERROR)&&this._override.error(e):this.log(Kn.ERROR,e)},t.prototype.warn=function(e){this._override.warn?this._shouldLog(Kn.WARNING)&&this._override.warn(e):this.log(Kn.WARNING,e)},t.prototype.info=function(e){this._override.info?this._shouldLog(Kn.INFO)&&this._override.info(e):this.log(Kn.INFO,e)},t.prototype.debug=function(e){this._override.debug?this._shouldLog(Kn.DEBUG)&&this._override.debug(e):this.log(Kn.DEBUG,e)},t.prototype.trace=function(e){this._override.trace?this._shouldLog(Kn.TRACE)&&this._override.trace(e):this.log(Kn.TRACE,e)},t.prototype._shouldLog=function(e){return this._minLevel===void 0||this._minLevel>=e},t}(),xv,Cv,Rv,NWe=(xv={},xv[Kn.CRITICAL]="🛑",xv[Kn.ERROR]="❌",xv[Kn.WARNING]="⚠️ ",xv[Kn.INFO]="ℹ️ ",xv[Kn.DEBUG]="🐞",xv[Kn.TRACE]="🐾",xv),PWe={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},DWe={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function gN(t,e,n){return function(r){return"\x1B[".concat(t,"m").concat(n?n(r):r,"\x1B[").concat(e,"m")}}function ap(t){return gN(PWe[t],39)}function XS(t,e){return gN(DWe[t],49,e)}var LWe=(Cv={},Cv[Kn.CRITICAL]=ap("red"),Cv[Kn.ERROR]=ap("redBright"),Cv[Kn.WARNING]=ap("yellow"),Cv[Kn.INFO]=ap("blue"),Cv[Kn.DEBUG]=ap("magenta"),Cv[Kn.TRACE]=gN(0,0),Cv),iz=(Rv={},Rv[Kn.CRITICAL]=XS("bgRed",ap("white")),Rv[Kn.ERROR]=XS("bgRedBright",ap("white")),Rv[Kn.WARNING]=XS("bgYellow",ap("black")),Rv[Kn.INFO]=XS("bgBlue",ap("white")),Rv[Kn.DEBUG]=XS("bgMagenta",ap("black")),Rv[Kn.TRACE]=gN(7,27),Rv),UWe=function(t){lZ(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){var i,s,o;if(!(n>this._minLevel)){var a=eee[n],c="";if(this._timestamps&&(c+="[".concat(new Date().toISOString(),"] ")),this._emoji){var l=NWe[n];c+="".concat(l," ")}var u=(o=(i=this._colors)!==null&&i!==void 0?i:(s=Bn.stdout)===null||s===void 0?void 0:s.isTTY)!==null&&o!==void 0?o:!0;u?c+="".concat(iz[n](this._name)," ").concat(iz[n](Kn[n])," ").concat(LWe[n](r)):c+="[".concat(this._name,":").concat(Kn[n].toLowerCase(),"] ").concat(r),a(c)}},e}(oee);function vN(t){return t.custom?new kWe(t):sj?new UWe(t):new OWe(t)}let FWe=class extends Error{constructor(...e){var n;super(...e),Object.setPrototypeOf(this,new.target.prototype),(n=Error.captureStackTrace)===null||n===void 0||n.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}};class aee extends FWe{}class BWe{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._paused=!1,this._logger=vN({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i,this._partitionKeyCallback=s}async request(e,n){return await new Promise((r,i)=>{var s,o;const a={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n==null?void 0:n.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"},c=this._partitionKeyCallback(e),l=(o=this._usedFromBucket.get(c))!==null&&o!==void 0?o:0;if(l>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{const u=this._getPartitionedQueue(c);u.push(a),l+u.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${u.length}`):this._logger.info(`Enqueueing request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused; queue size is ${u.length}`);break}case"null":{a.resolve(null),this._paused?this._logger.info(`Returning null for request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{a.reject(new aee(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${c?`partition ${c}`:"default partition"} was reached`}`));break}default:throw new Error("this should never happen")}else this._runRequest(a,c)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const n=[];return this._partitionedQueue.set(e,n),n}async _runRequest(e,n){var r;const i=this._getPartitionedQueue(n);this._logger.debug(`doing a request for ${n?`partition ${n}`:"default partition"}, new queue length is ${i.length}`),this._usedFromBucket.set(n,((r=this._usedFromBucket.get(n))!==null&&r!==void 0?r:0)+1);const{req:s,resolve:o,reject:a}=e;try{o(await this._callback(s))}catch(c){a(c)}finally{setTimeout(()=>{const c=this._usedFromBucket.get(n)-1;this._usedFromBucket.set(n,c),i.length&&c<this._bucketSize&&this._runNextRequest(n)},this._timeFrame)}}_runNextRequest(e){if(this._paused)return;const r=this._getPartitionedQueue(e).shift();r&&this._runRequest(r,e)}}class _F{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i}){this._queue=[],this._usedFromBucket=0,this._paused=!1,this._logger=vN({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i}async request(e,n){return await new Promise((r,i)=>{var s;const o={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n==null?void 0:n.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(o.limitReachedBehavior){case"enqueue":{this._queue.push(o),this._usedFromBucket+this._queue.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`):this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{o.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused?this._logger.info("Returning null for request because the rate limiter is paused"):this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{o.reject(new aee(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw new Error("this should never happen")}else this._runRequest(o)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}async _runRequest(e){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;const{req:n,resolve:r,reject:i}=e;try{r(await this._callback(n))}catch(s){i(s)}finally{setTimeout(()=>{this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize&&this._runNextRequest()},this._timeFrame)}}_runNextRequest(){if(this._paused)return;const e=this._queue.shift();e&&this._runRequest(e)}}class jWe extends _F{constructor(e,n){super({...n,async doRequest(r,i){return await e.request(r,i)}})}}class $We{constructor(e,n,r,i=!1){this.owner=e,this.event=n,this.listener=r,this._internal=i}unbind(){this.owner.removeListener(this)}}let Nx=class{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,n){return this._addListener(!1,e,n)}addListener(e,n){return this._addListener(!1,e,n)}removeListener(e,n){this._removeListener(!1,e,n)}registerEvent(){const e=n=>this.addListener(e,n);return e}emit(e,...n){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...n);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...n)}registerInternalEvent(){const e=n=>this.addInternalListener(e,n);return e}addInternalListener(e,n){return this._addListener(!0,e,n)}removeInternalListener(e,n){this._removeListener(!0,e,n)}_addListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;return i.has(n)?i.get(n).push(r):i.set(n,[r]),new $We(this,n,r,e)}_removeListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;if(!n)i.clear();else if(typeof n=="object"){const s=n;this._removeListener(s._internal,s.event,s.listener)}else{const s=n;if(i.has(s))if(r){const o=i.get(s);let a=0;for(;(a=o.indexOf(r))!==-1;)o.splice(a,1)}else i.delete(s)}}};const HWe=6e4;function VWe(t){return hw(t.expiresIn,e=>t.obtainmentTimestamp+e*1e3-HWe)}function eR(t){var e;return(e=hw(VWe(t),n=>Date.now()>n))!==null&&e!==void 0?e:!1}var yF={exports:{}};(function(t,e){var n=typeof self<"u"?self:Da,r=function(){function s(){this.fetch=!1,this.DOMException=n.DOMException}return s.prototype=n,new s}();(function(s){(function(o){var a={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function c(X){return X&&DataView.prototype.isPrototypeOf(X)}if(a.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(X){return X&&l.indexOf(Object.prototype.toString.call(X))>-1};function d(X){if(typeof X!="string"&&(X=String(X)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(X))throw new TypeError("Invalid character in header field name");return X.toLowerCase()}function h(X){return typeof X!="string"&&(X=String(X)),X}function p(X){var ne={next:function(){var Z=X.shift();return{done:Z===void 0,value:Z}}};return a.iterable&&(ne[Symbol.iterator]=function(){return ne}),ne}function f(X){this.map={},X instanceof f?X.forEach(function(ne,Z){this.append(Z,ne)},this):Array.isArray(X)?X.forEach(function(ne){this.append(ne[0],ne[1])},this):X&&Object.getOwnPropertyNames(X).forEach(function(ne){this.append(ne,X[ne])},this)}f.prototype.append=function(X,ne){X=d(X),ne=h(ne);var Z=this.map[X];this.map[X]=Z?Z+", "+ne:ne},f.prototype.delete=function(X){delete this.map[d(X)]},f.prototype.get=function(X){return X=d(X),this.has(X)?this.map[X]:null},f.prototype.has=function(X){return this.map.hasOwnProperty(d(X))},f.prototype.set=function(X,ne){this.map[d(X)]=h(ne)},f.prototype.forEach=function(X,ne){for(var Z in this.map)this.map.hasOwnProperty(Z)&&X.call(ne,this.map[Z],Z,this)},f.prototype.keys=function(){var X=[];return this.forEach(function(ne,Z){X.push(Z)}),p(X)},f.prototype.values=function(){var X=[];return this.forEach(function(ne){X.push(ne)}),p(X)},f.prototype.entries=function(){var X=[];return this.forEach(function(ne,Z){X.push([Z,ne])}),p(X)},a.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);function g(X){if(X.bodyUsed)return Promise.reject(new TypeError("Already read"));X.bodyUsed=!0}function y(X){return new Promise(function(ne,Z){X.onload=function(){ne(X.result)},X.onerror=function(){Z(X.error)}})}function E(X){var ne=new FileReader,Z=y(ne);return ne.readAsArrayBuffer(X),Z}function w(X){var ne=new FileReader,Z=y(ne);return ne.readAsText(X),Z}function R(X){for(var ne=new Uint8Array(X),Z=new Array(ne.length),ie=0;ie<ne.length;ie++)Z[ie]=String.fromCharCode(ne[ie]);return Z.join("")}function A(X){if(X.slice)return X.slice(0);var ne=new Uint8Array(X.byteLength);return ne.set(new Uint8Array(X)),ne.buffer}function k(){return this.bodyUsed=!1,this._initBody=function(X){this._bodyInit=X,X?typeof X=="string"?this._bodyText=X:a.blob&&Blob.prototype.isPrototypeOf(X)?this._bodyBlob=X:a.formData&&FormData.prototype.isPrototypeOf(X)?this._bodyFormData=X:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(X)?this._bodyText=X.toString():a.arrayBuffer&&a.blob&&c(X)?(this._bodyArrayBuffer=A(X.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(X)||u(X))?this._bodyArrayBuffer=A(X):this._bodyText=X=Object.prototype.toString.call(X):this._bodyText="",this.headers.get("content-type")||(typeof X=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(X)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var X=g(this);if(X)return X;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(E)}),this.text=function(){var X=g(this);if(X)return X;if(this._bodyBlob)return w(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(R(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(F)}),this.json=function(){return this.text().then(JSON.parse)},this}var I=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function N(X){var ne=X.toUpperCase();return I.indexOf(ne)>-1?ne:X}function U(X,ne){ne=ne||{};var Z=ne.body;if(X instanceof U){if(X.bodyUsed)throw new TypeError("Already read");this.url=X.url,this.credentials=X.credentials,ne.headers||(this.headers=new f(X.headers)),this.method=X.method,this.mode=X.mode,this.signal=X.signal,!Z&&X._bodyInit!=null&&(Z=X._bodyInit,X.bodyUsed=!0)}else this.url=String(X);if(this.credentials=ne.credentials||this.credentials||"same-origin",(ne.headers||!this.headers)&&(this.headers=new f(ne.headers)),this.method=N(ne.method||this.method||"GET"),this.mode=ne.mode||this.mode||null,this.signal=ne.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Z)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Z)}U.prototype.clone=function(){return new U(this,{body:this._bodyInit})};function F(X){var ne=new FormData;return X.trim().split("&").forEach(function(Z){if(Z){var ie=Z.split("="),G=ie.shift().replace(/\+/g," "),Q=ie.join("=").replace(/\+/g," ");ne.append(decodeURIComponent(G),decodeURIComponent(Q))}}),ne}function $(X){var ne=new f,Z=X.replace(/\r?\n[\t ]+/g," ");return Z.split(/\r?\n/).forEach(function(ie){var G=ie.split(":"),Q=G.shift().trim();if(Q){var se=G.join(":").trim();ne.append(Q,se)}}),ne}k.call(U.prototype);function q(X,ne){ne||(ne={}),this.type="default",this.status=ne.status===void 0?200:ne.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in ne?ne.statusText:"OK",this.headers=new f(ne.headers),this.url=ne.url||"",this._initBody(X)}k.call(q.prototype),q.prototype.clone=function(){return new q(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},q.error=function(){var X=new q(null,{status:0,statusText:""});return X.type="error",X};var K=[301,302,303,307,308];q.redirect=function(X,ne){if(K.indexOf(ne)===-1)throw new RangeError("Invalid status code");return new q(null,{status:ne,headers:{location:X}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(ne,Z){this.message=ne,this.name=Z;var ie=Error(ne);this.stack=ie.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function W(X,ne){return new Promise(function(Z,ie){var G=new U(X,ne);if(G.signal&&G.signal.aborted)return ie(new o.DOMException("Aborted","AbortError"));var Q=new XMLHttpRequest;function se(){Q.abort()}Q.onload=function(){var ve={status:Q.status,statusText:Q.statusText,headers:$(Q.getAllResponseHeaders()||"")};ve.url="responseURL"in Q?Q.responseURL:ve.headers.get("X-Request-URL");var Oe="response"in Q?Q.response:Q.responseText;Z(new q(Oe,ve))},Q.onerror=function(){ie(new TypeError("Network request failed"))},Q.ontimeout=function(){ie(new TypeError("Network request failed"))},Q.onabort=function(){ie(new o.DOMException("Aborted","AbortError"))},Q.open(G.method,G.url,!0),G.credentials==="include"?Q.withCredentials=!0:G.credentials==="omit"&&(Q.withCredentials=!1),"responseType"in Q&&a.blob&&(Q.responseType="blob"),G.headers.forEach(function(ve,Oe){Q.setRequestHeader(Oe,ve)}),G.signal&&(G.signal.addEventListener("abort",se),Q.onreadystatechange=function(){Q.readyState===4&&G.signal.removeEventListener("abort",se)}),Q.send(typeof G._bodyInit>"u"?null:G._bodyInit)})}return W.polyfill=!0,s.fetch||(s.fetch=W,s.Headers=f,s.Request=U,s.Response=q),o.Headers=f,o.Request=U,o.Response=q,o.fetch=W,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e})(yF,yF.exports);var cee=yF.exports;const zWe=Nl(cee);var PD=Object.prototype.hasOwnProperty,Db=Array.isArray,Vf=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),GWe=function(e){for(;e.length>1;){var n=e.pop(),r=n.obj[n.prop];if(Db(r)){for(var i=[],s=0;s<r.length;++s)typeof r[s]<"u"&&i.push(r[s]);n.obj[n.prop]=i}}},lee=function(e,n){for(var r=n&&n.plainObjects?Object.create(null):{},i=0;i<e.length;++i)typeof e[i]<"u"&&(r[i]=e[i]);return r},WWe=function t(e,n,r){if(!n)return e;if(typeof n!="object"){if(Db(e))e.push(n);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!PD.call(Object.prototype,n))&&(e[n]=!0);else return[e,n];return e}if(!e||typeof e!="object")return[e].concat(n);var i=e;return Db(e)&&!Db(n)&&(i=lee(e,r)),Db(e)&&Db(n)?(n.forEach(function(s,o){if(PD.call(e,o)){var a=e[o];a&&typeof a=="object"&&s&&typeof s=="object"?e[o]=t(a,s,r):e.push(s)}else e[o]=s}),e):Object.keys(n).reduce(function(s,o){var a=n[o];return PD.call(s,o)?s[o]=t(s[o],a,r):s[o]=a,s},i)},qWe=function(e,n){return Object.keys(n).reduce(function(r,i){return r[i]=n[i],r},e)},KWe=function(t,e,n){var r=t.replace(/\+/g," ");if(n==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},YWe=function(e,n,r){if(e.length===0)return e;var i=e;if(typeof e=="symbol"?i=Symbol.prototype.toString.call(e):typeof e!="string"&&(i=String(e)),r==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var s="",o=0;o<i.length;++o){var a=i.charCodeAt(o);if(a===45||a===46||a===95||a===126||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122){s+=i.charAt(o);continue}if(a<128){s=s+Vf[a];continue}if(a<2048){s=s+(Vf[192|a>>6]+Vf[128|a&63]);continue}if(a<55296||a>=57344){s=s+(Vf[224|a>>12]+Vf[128|a>>6&63]+Vf[128|a&63]);continue}o+=1,a=65536+((a&1023)<<10|i.charCodeAt(o)&1023),s+=Vf[240|a>>18]+Vf[128|a>>12&63]+Vf[128|a>>6&63]+Vf[128|a&63]}return s},XWe=function(e){for(var n=[{obj:{o:e},prop:"o"}],r=[],i=0;i<n.length;++i)for(var s=n[i],o=s.obj[s.prop],a=Object.keys(o),c=0;c<a.length;++c){var l=a[c],u=o[l];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(n.push({obj:o,prop:l}),r.push(u))}return GWe(n),e},JWe=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},QWe=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},ZWe=function(e,n){return[].concat(e,n)},aj={arrayToObject:lee,assign:qWe,combine:ZWe,compact:XWe,decode:KWe,encode:YWe,isBuffer:QWe,isRegExp:JWe,merge:WWe},eqe=String.prototype.replace,tqe=/%20/g,nqe=aj,sz={RFC1738:"RFC1738",RFC3986:"RFC3986"},rqe=nqe.assign({default:sz.RFC3986,formatters:{RFC1738:function(t){return eqe.call(t,tqe,"+")},RFC3986:function(t){return String(t)}}},sz),uee=aj,ST=rqe,iqe=Object.prototype.hasOwnProperty,oz={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,n){return e+"["+n+"]"},repeat:function(e){return e}},mE=Array.isArray,sqe=Array.prototype.push,bF=function(t,e){sqe.apply(t,mE(e)?e:[e])},oqe=Date.prototype.toISOString,az=ST.default,Vc={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:uee.encode,encodeValuesOnly:!1,format:az,formatter:ST.formatters[az],indices:!1,serializeDate:function(e){return oqe.call(e)},skipNulls:!1,strictNullHandling:!1},aqe=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},cqe=function t(e,n,r,i,s,o,a,c,l,u,d,h,p){var f=e;if(typeof a=="function"?f=a(n,f):f instanceof Date?f=u(f):r==="comma"&&mE(f)&&(f=f.join(",")),f===null){if(i)return o&&!h?o(n,Vc.encoder,p,"key"):n;f=""}if(aqe(f)||uee.isBuffer(f)){if(o){var g=h?n:o(n,Vc.encoder,p,"key");return[d(g)+"="+d(o(f,Vc.encoder,p,"value"))]}return[d(n)+"="+d(String(f))]}var y=[];if(typeof f>"u")return y;var E;if(mE(a))E=a;else{var w=Object.keys(f);E=c?w.sort(c):w}for(var R=0;R<E.length;++R){var A=E[R];s&&f[A]===null||(mE(f)?bF(y,t(f[A],typeof r=="function"?r(n,A):n,r,i,s,o,a,c,l,u,d,h,p)):bF(y,t(f[A],n+(l?"."+A:"["+A+"]"),r,i,s,o,a,c,l,u,d,h,p)))}return y},lqe=function(e){if(!e)return Vc;if(e.encoder!==null&&e.encoder!==void 0&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var n=e.charset||Vc.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=ST.default;if(typeof e.format<"u"){if(!iqe.call(ST.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=ST.formatters[r],s=Vc.filter;return(typeof e.filter=="function"||mE(e.filter))&&(s=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:Vc.addQueryPrefix,allowDots:typeof e.allowDots>"u"?Vc.allowDots:!!e.allowDots,charset:n,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Vc.charsetSentinel,delimiter:typeof e.delimiter>"u"?Vc.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:Vc.encode,encoder:typeof e.encoder=="function"?e.encoder:Vc.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:Vc.encodeValuesOnly,filter:s,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:Vc.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:Vc.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Vc.strictNullHandling}},uqe=function(t,e){var n=t,r=lqe(e),i,s;typeof r.filter=="function"?(s=r.filter,n=s("",n)):mE(r.filter)&&(s=r.filter,i=s);var o=[];if(typeof n!="object"||n===null)return"";var a;e&&e.arrayFormat in oz?a=e.arrayFormat:e&&"indices"in e?a=e.indices?"indices":"repeat":a="indices";var c=oz[a];i||(i=Object.keys(n)),r.sort&&i.sort(r.sort);for(var l=0;l<i.length;++l){var u=i[l];r.skipNulls&&n[u]===null||bF(o,cqe(n[u],u,c,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.formatter,r.encodeValuesOnly,r.charset))}var d=o.join(r.delimiter),h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""};const dee=Nl(uqe);var dqe=aj;dqe.decode;const Lb=Symbol("twurpleRawData");class hqe{constructor(e){this[Lb]=e}}class ky extends Error{constructor(e,n){var r;super(e,n),Object.setPrototypeOf(this,new.target.prototype),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}function Px(t,e,n){return r=>{const i=n?function(){return`[${e}#${this[n]} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`}:function(){return`[${e} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class cz extends ky{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}function $m(t){return typeof t=="string"?t:typeof t=="number"?t.toString(10):t.id}class hee extends ky{constructor(e,n,r,i,s,o){super(`Encountered HTTP status code ${e}: ${n}

URL: ${r}
Method: ${i}
Body:
${!o&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=i,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function fqe(t,e){var n;if(!t.ok){const r=t.headers.get("Content-Type")==="application/json",i=r?JSON.stringify(await t.json(),null,2):await t.text(),s=dee(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),o=`${e.url}${s}`;throw new hee(t.status,t.statusText,o,(n=e.method)!==null&&n!==void 0?n:"GET",i,r)}}async function pqe(t){if(t.status===204)return;const e=await t.text();if(e)return JSON.parse(e)}function mqe(t,e,n){switch(e){case"helix":return`https://api.twitch.tv/helix/${t.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${t.replace(/^\//,"")}`;case"custom":return t;default:return t}}async function gqe(t,e,n,r,i={},s){var o,a;const c=(o=t.type)!==null&&o!==void 0?o:"helix",l=mqe(t.url,c),u=dee(t.query,{arrayFormat:"repeat",addQueryPrefix:!0}),d=new cee.Headers({Accept:"application/json"});let h;t.jsonBody&&(h=JSON.stringify(t.jsonBody),d.append("Content-Type","application/json")),e&&c!=="auth"&&d.append("Client-ID",e),n&&d.append("Authorization",`${c==="helix"?"Bearer":"OAuth"} ${n}`);const p={...i,method:(a=t.method)!==null&&a!==void 0?a:"GET",headers:d,body:h};return await zWe(`${l}${u}`,p)}async function _N(t,e,n,r,i={}){const s=await gqe(t,e,n,r,i);return await fqe(s,t),await pqe(s)}class gE extends ky{constructor(e){super("Invalid token supplied",e)}}class tR extends ky{}function vqe(t,e,n,r){return{grant_type:"authorization_code",client_id:t,client_secret:e,code:n,redirect_uri:r}}function _qe(t,e){return{grant_type:"client_credentials",client_id:t,client_secret:e}}function yqe(t,e,n){return{grant_type:"refresh_token",client_id:t,client_secret:e,refresh_token:n}}let EF=class extends hqe{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[Lb].client_id}get userId(){var e;return(e=this[Lb].user_id)!==null&&e!==void 0?e:null}get userName(){var e;return(e=this[Lb].login)!==null&&e!==void 0?e:null}get scopes(){return this[Lb].scopes}get expiryDate(){return hw(this[Lb].expires_in,e=>new Date(this._obtainmentDate.getTime()+e*1e3))}};EF=As([Px("auth","TokenInfo","clientId")],EF);function cj(t){var e,n;return{accessToken:t.access_token,refreshToken:t.refresh_token||null,scope:(e=t.scope)!==null&&e!==void 0?e:[],expiresIn:(n=t.expires_in)!==null&&n!==void 0?n:null,obtainmentTimestamp:Date.now()}}async function bqe(t,e,n,r){return cj(await _N({type:"auth",url:"token",method:"POST",query:vqe(t,e,n,r)}))}async function Eqe(t,e){return cj(await _N({type:"auth",url:"token",method:"POST",query:_qe(t,e)}))}async function lz(t,e,n){return cj(await _N({type:"auth",url:"token",method:"POST",query:yqe(t,e,n)}))}async function fw(t,e){try{const n=await _N({type:"auth",url:"validate"},e,t);return new EF(n)}catch(n){throw n instanceof hee&&n.statusCode===401?new gE({cause:n}):n}}const Sqe=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function Tqe(t,e){if(e!=null&&e.length){const n=new Set(t.flatMap(r=>{var i;return[r,...(i=Sqe.get(r))!==null&&i!==void 0?i:[]]}));if(e.every(r=>!n.has(r))){const r=e.join(", ");throw new Error(`This token does not have any of the requested scopes (${r}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function nR(t,e){for(const n of e)Tqe(t,n)}async function wqe(t,e,n,r,i){if(i!=null&&i.length||!n){const s=await fw(e,t);if(!s.userId)throw new Error("Trying to use an app access token as a user access token");const o=r??s.scopes;return i&&nR(o,i.filter(a=>!!a)),[o,s.userId]}return[r,n]}class uz{constructor(e){this._newTokenScopeSets=[],this._newTokenPromise=null,this._queuedScopeSets=[],this._queueExecutor=null,this._queuePromise=null,this._executor=e}async fetch(...e){var n;const r=e.filter(a=>!!a);if(this._newTokenPromise){if(!r.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...r):this._queuedScopeSets=[...r],!this._queuePromise){const{promise:a,resolve:c,reject:l}=vF();this._queuePromise=a,this._queueExecutor=async()=>{var u;if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{c(await this._executor(this._newTokenScopeSets))}catch(d){l(d)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(u=this._queueExecutor)===null||u===void 0||u.call(this)}}}}return await this._queuePromise}this._newTokenScopeSets=[...r];const{promise:i,resolve:s,reject:o}=vF();this._newTokenPromise=i;try{s(await this._executor(this._newTokenScopeSets))}catch(a){o(a)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(n=this._queueExecutor)===null||n===void 0||n.call(this)}return await i}}class dz extends ky{constructor(e){super(`The user context for the user ${e} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class xqe extends ky{constructor(e){super(`User ${e} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class Cqe extends ky{constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}let T_=class extends Nx{constructor(e){var n;super(),this._userAccessTokens=new Map,this._userTokenFetchers=new Map,this._intentToUserId=new Map,this._userIdToIntents=new Map,this._cachedRefreshFailures=new Set,this.onRefresh=this.registerEvent(),this.onRefreshFailure=this.registerEvent(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=(n=e.appImpliedScopes)!==null&&n!==void 0?n:[],this._appTokenFetcher=new uz(async r=>await this._fetchAppToken(r))}addUser(e,n,r){const i=$m(e);if(!n.refreshToken)throw new Error(`Trying to add user ${i} without refresh token`);this._cachedRefreshFailures.delete(i),this._userAccessTokens.set(i,{...n,userId:i}),this._userTokenFetchers.has(i)||this._userTokenFetchers.set(i,new uz(async s=>await this._fetchUserToken(i,s))),r&&this.addIntentsToUser(e,r)}async addUserForToken(e,n){let r=null;if(e.accessToken&&!eR(e))try{const a=await fw(e.accessToken);r=[e,a]}catch(a){if(!(a instanceof gE))throw a}if(!r){if(!e.refreshToken)throw new gE;const a=await lz(this._clientId,this._clientSecret,e.refreshToken),c=await fw(a.accessToken);this.emit(this.onRefresh,c.userId,a),r=[a,c]}const[i,s]=r;if(!s.userId)throw new tR("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const o=i.scope?i:{...i,scope:s.scopes};return this.addUser(s.userId,o,n),s.userId}async addUserForCode(e,n){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const r=await bqe(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(r,n)}hasUser(e){return this._userTokenFetchers.has($m(e))}removeUser(e){const n=$m(e);if(this._userIdToIntents.has(n)){const r=this._userIdToIntents.get(n);for(const i of r)this._intentToUserId.delete(i);this._userIdToIntents.delete(n)}this._userAccessTokens.delete(n),this._userTokenFetchers.delete(n),this._cachedRefreshFailures.delete(n)}addIntentsToUser(e,n){const r=$m(e);if(!this._userAccessTokens.has(r))throw new Error("Trying to add intents to a user that was not added to this provider");for(const i of n)this._intentToUserId.has(i)&&this._userIdToIntents.get(this._intentToUserId.get(i)).delete(i),this._intentToUserId.set(i,r),this._userIdToIntents.has(r)?this._userIdToIntents.get(r).add(i):this._userIdToIntents.set(r,new Set([i]))}getIntentsForUser(e){const n=$m(e);return this._userIdToIntents.has(n)?Array.from(this._userIdToIntents.get(n)):[]}removeIntents(e){var n;for(const r of e)if(this._intentToUserId.has(r)){const i=this._intentToUserId.get(r);(n=this._userIdToIntents.get(i))===null||n===void 0||n.delete(r),this._intentToUserId.delete(r)}}async refreshAccessTokenForUser(e){const n=$m(e);if(this._cachedRefreshFailures.has(n))throw new dz(n);const r=this._userAccessTokens.get(n);if(!r)throw new Error("Trying to refresh token for user that was not added to the provider");const i=await this._refreshUserTokenWithCallback(n,r.refreshToken);return this._checkIntermediateUserRemoval(n),this._userAccessTokens.set(n,{...i,userId:n}),this.emit(this.onRefresh,n,i),{...i,userId:n}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new Cqe(e);const n=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(n)}get clientId(){return this._clientId}getCurrentScopesForUser(e){var n;const r=this._userAccessTokens.get($m(e));if(!r)throw new Error("Trying to get scopes for user that was not added to the provider");return(n=r.scope)!==null&&n!==void 0?n:[]}async getAccessTokenForUser(e,...n){const r=$m(e),i=this._userTokenFetchers.get(r);if(!i)return null;if(this._cachedRefreshFailures.has(r))throw new dz(r);return nR(this.getCurrentScopesForUser(r),n.filter(Boolean)),await i.fetch(...n)}async getAccessTokenForIntent(e,...n){if(!this._intentToUserId.has(e))return null;const r=this._intentToUserId.get(e),i=await this.getAccessTokenForUser(r,...n);if(!i)throw new cz(`Found intent ${e} corresponding to user ID ${r} but no token was found`);return{...i,userId:r}}async getAnyAccessToken(e){if(e){const n=$m(e);if(this._userAccessTokens.has(n)){const r=await this.getAccessTokenForUser(n);if(!r)throw new cz(`Token for user ID ${n} exists but nothing was returned by getAccessTokenForUser`);return{...r,userId:n}}}return await this.getAppAccessToken()}async getAppAccessToken(e=!1){return e&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(n=>[n]))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new xqe(e)}async _fetchUserToken(e,n){const r=this._userAccessTokens.get(e);if(!r)throw new Error("Trying to get token for user that was not added to the provider");if(r.accessToken&&!eR(r))try{if(r.scope)return nR(r.scope,n),r;const[s=[]]=await wqe(this._clientId,r.accessToken,e,r.scope,n),o={...r,scope:s};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,o),o}catch(s){if(!(s instanceof gE))throw s}this._checkIntermediateUserRemoval(e);const i=await this.refreshAccessTokenForUser(e);return nR(i.scope,n),i}async _refreshUserTokenWithCallback(e,n){try{return await lz(this.clientId,this._clientSecret,n)}catch(r){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e,r),r}}async _fetchAppToken(e){if(e.length>0)for(const n of e)if(this._appImpliedScopes.length){if(n.every(r=>!this._appImpliedScopes.includes(r)))throw new Error(`One of the scopes ${n.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw new Error(`One of the scopes ${n.join(", ")} requested but the client credentials flow does not support scopes`);return!this._appAccessToken||eR(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await Eqe(this._clientId,this._clientSecret)}};As([D_(!1)],T_.prototype,"_clientSecret",void 0);As([D_(!1)],T_.prototype,"_userAccessTokens",void 0);As([D_(!1)],T_.prototype,"_userTokenFetchers",void 0);As([D_(!1)],T_.prototype,"_appAccessToken",void 0);As([D_(!1)],T_.prototype,"_appTokenFetcher",void 0);T_=As([Px("auth","RefreshingAuthProvider","clientId")],T_);class Rqe extends Nx{constructor({lineBased:e,logger:n,additionalOptions:r}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=e??!1,this._logger=n,this._additionalOptions=r}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r
`))}assumeExternalDisconnect(){var e;(e=this._logger)===null||e===void 0||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var n,r;if(!this._lineBased){this.emit(this.onReceive,e);return}const i=e.split(`\r
`);if(this._currentLine+=(n=i.shift())!==null&&n!==void 0?n:"",i.length){this.emit(this.onReceive,this._currentLine),this._currentLine=(r=i.pop())!==null&&r!==void 0?r:"";for(const s of i)this.emit(this.onReceive,s)}}}class Aqe{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}class Mqe extends Nx{constructor(e,n,r={}){var i;super(),this._type=e,this._target=n,this._config=r,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(i=r.retryLimit)!==null&&i!==void 0?i:1/0,this._logger=r.logger}get isConnected(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnected)!==null&&n!==void 0?n:!1}get isConnecting(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnecting)!==null&&n!==void 0?n:this._connecting}get hasSocket(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.hasSocket)!==null&&n!==void 0?n:!1}sendLine(e){var n;(n=this._currentConnection)===null||n===void 0||n.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if((e=this._logger)===null||e===void 0||e.trace(`PersistentConnection disconnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const n=this._currentConnection;this._currentConnection=void 0,n.disconnect()}}assumeExternalDisconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("PersistentConnection assumeExternalDisconnect"),(n=this._currentConnection)===null||n===void 0||n.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(e=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(e=!1){var n,r;(n=this._logger)===null||n===void 0||n.trace(`PersistentConnection tryConnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;(r=this._retryTimerGenerator)!==null&&r!==void 0||(this._retryTimerGenerator=tee(120));const s=this._currentConnection=new this._type(CWe(this._target),this._config);s.onReceive(o=>this.emit(this.onReceive,o)),s.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),s.onDisconnect((o,a)=>{var c,l,u;if(this.emit(this.onDisconnect,o,a),o)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,s.disconnect(),this._currentConnection===s&&(this._currentConnection=void 0),this._previousConnection===s&&(this._previousConnection=void 0);else if(this._connecting){if((c=this._logger)===null||c===void 0||c.debug(`Connection error caught: ${(l=a==null?void 0:a.message)!==null&&l!==void 0?l:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const d=this._retryTimerGenerator.next().value;d!==0&&((u=this._logger)===null||u===void 0||u.info(`Retrying in ${d} seconds`)),setTimeout(()=>{var h;this._connecting&&((h=this._logger)===null||h===void 0||h.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())},d*1e3)}else this._reconnect()}),s.connect()}_reconnect(e=!1){e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}var Ub=null;typeof WebSocket<"u"?Ub=WebSocket:typeof MozWebSocket<"u"?Ub=MozWebSocket:typeof Xm<"u"?Ub=Xm.WebSocket||Xm.MozWebSocket:typeof window<"u"?Ub=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Ub=self.WebSocket||self.MozWebSocket);class Iqe extends Rqe{constructor(e,n){if(super(n),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else if(e.url)this._url=e.url;else throw new Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(e){var n;(n=this._socket)===null||n===void 0||n.send(e)}connect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new Ub(this._url,(n=this._additionalOptions)===null||n===void 0?void 0:n.wsOptions),this._socket.onopen=()=>{var r;(r=this._logger)===null||r===void 0||r.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:r})=>{this.receiveRaw(r.toString())},this._socket.onerror=r=>{var i;(i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onError message:${r.message}`)},this._socket.onclose=r=>{var i;const s=this._connected,o=this._connecting;if((i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onClose wasConnected:${s.toString()} wasConnecting:${o.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${r.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const a=new Error(`[${r.code}] ${r.reason}`);this.emit(this.onDisconnect,!1,a),this.emit(this.onEnd,!1,a)}this.clearSocket()}}disconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(n=this._socket)===null||n===void 0||n.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}function TT(t){var e,n,r;if(Array.isArray(t)){for(n=Array(e=t.length);e--;)n[e]=(r=t[e])&&typeof r=="object"?TT(r):r;return n}if(Object.prototype.toString.call(t)==="[object Object]"){n={};for(e in t)e==="__proto__"?Object.defineProperty(n,e,{value:TT(t[e]),configurable:!0,enumerable:!0,writable:!0}):n[e]=(r=t[e])&&typeof r=="object"?TT(r):r;return n}return t}const Oqe={name:"away-notify"};class kA extends Error{constructor(e,n,r){super(`command "${e}" expected ${n} or more parameters, got ${r}`),this._command=e,this._expectedParams=n,this._actualParams=r,Object.setPrototypeOf(this,kA.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kA)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class NA extends Error{constructor(e,n,r,i){var s;super(`required parameter "${n}" did not validate against ${(s=r.type)!==null&&s!==void 0?s:"regex"} validation: "${i}"`),this._command=e,this._paramName=n,this._paramSpec=r,this._givenValue=i,Object.setPrototypeOf(this,NA.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,NA)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const vE={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var fee={exports:{}};(function(t){t.exports=e=>{if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},t.exports.default=t.exports})(fee);var kqe=fee.exports;const Nqe=Nl(kqe);function SF(t,e="#&"){return new RegExp(`^[${Nqe(e)}][^ \b\0
\r,]+$`).test(t)}const hz={0:"\0",n:`
`,r:"\r","":""};function fz(t){if(!t.startsWith("")||(t=t.substring(1),t.endsWith("")&&(t=t.slice(0,-1)),!t))return!1;t=t.replace(/\x10(.)/,(r,i)=>i in hz?hz[i]:"");let[e,n=""]=V0(t," ",2);return e=e?e.toUpperCase():"",{command:e,params:n}}const Pqe={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function Dqe(t){return t.replace(/[\\;\n\r ]/g,e=>`\\${Pqe[e]}`)}function Lqe(t){let e=`${t.nick}`;return t.user&&(e+=`!${t.user}`),t.host&&(e+=`@${t.host}`),e}function Uqe(t,e,n,r,i=vE,s=!1){const o=new t(t.COMMAND,void 0,{serverProperties:i}),a={};if(o._paramSpec&&gF(o._paramSpec,(c,l)=>{if(!(s&&c.noServer)&&!(!s&&c.noClient)){if(l in e){const u=e[l];if(u!==void 0){if(t.checkParam(u,c,i))a[l]={value:u,trailing:!!c.trailing};else if(!c.optional)throw new Error(`required parameter "${l}" did not suit requirements: "${u}"`)}}if(!(l in a)&&!c.optional)throw new Error(`required parameter "${l}" not found in command "${t.COMMAND}"`)}}),o._parsedParams=a,o._paramSpec)for(const c of Object.keys(o._paramSpec))Object.defineProperty(o,c,{get(){var l,u;return(u=(l=this._parsedParams)===null||l===void 0?void 0:l[c])===null||u===void 0?void 0:u.value}});return o._initPrefixAndTags(n,r),o}class Nt{static checkParam(e,n,r=vE){return!(n.type==="channel"&&!SF(e,r.channelTypes)||n.type==="channelList"&&!e.split(",").every(s=>SF(s,r.channelTypes))||n.match&&!n.match.test(e))}constructor(e,{params:n,tags:r,prefix:i,rawLine:s}={},{serverProperties:o=vE,isServer:a=!1,shouldParseParams:c=!0}={},l){this._params=[],this._serverProperties=vE,this._paramSpec=l,this._command=e,this._params=n,this._tags=r??new Map,this._prefix=i,this._serverProperties=o,this._raw=s,c&&this.parseParams(a)}getMinParamCount(e=!1){return this._paramSpec?Object.values(this._paramSpec).filter(n=>n.noServer&&e||n.noClient&&!e?!1:!n.optional).length:0}get paramCount(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.length)!==null&&n!==void 0?n:0}prefixToString(){return this._prefix?Lqe(this._prefix):""}tagsToString(){return[...this._tags.entries()].map(([e,n])=>n?`${e}=${Dqe(n)}`:e).join(";")}toString(e=!1,n=!1){const i=[n?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const o=this.prefixToString();o&&i.unshift(`:${o}`)}const s=this.tagsToString();return s&&i.unshift(`@${s}`),i.join(" ")}_initPrefixAndTags(e,n){this._prefix=e,n&&(this._tags=n)}parseParams(e=!1){if(this._params){let n=this.getMinParamCount(e);if(n>this._params.length)throw new kA(this._command,n,this._params.length);const r=this._paramSpec;if(!r)return;let i=0;const s={};for(const[o,a]of Object.entries(r)){if(a.noServer&&e||a.noClient&&!e)continue;if(this._params.length-i<=n){if(a.optional)continue;if(this._params.length-i!==n)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let c=this._params[i];if(!c){if(a.optional)break;throw new Error("unexpected parameter underflow")}if(a.rest){const l=[];for(;this._params[i]&&!this._params[i].trailing;)l.push(this._params[i].value),++i;if(!l.length){if(a.optional)continue;throw new Error(`no parameters left for required rest parameter "${o}"`)}c={value:l.join(" "),trailing:!1}}if(Nt.checkParam(c.value,a))s[o]={...c},a.optional||--n,a.rest||++i;else if(!a.optional)throw new NA(this._command,o,a,c.value);if(a.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const o of Object.keys(this._paramSpec))Object.defineProperty(this,o,{get(){var a,c;return(c=(a=this._parsedParams)===null||a===void 0?void 0:a[o])===null||c===void 0?void 0:c.value}})}}get rawParamValues(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>r.value))!==null&&n!==void 0?n:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map(n=>{var r;const i=(r=this._parsedParams)===null||r===void 0?void 0:r[n];if(i)return(i.trailing?":":"")+i.value}).filter(n=>n!==void 0)].join(" ")}_buildCommandFromRawParams(){var e,n;return[this._command,...(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>`${r.trailing?":":""}${r.value}`))!==null&&n!==void 0?n:[]].join(" ")}}Nt.COMMAND="";Nt.SUPPORTS_CAPTURE=!1;class pee extends Nt{constructor(e,n,r){super(e,n,r,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}pee.COMMAND="BATCH";const Fqe={name:"batch",messageTypes:[pee],usesTags:!0},Bqe={name:"cap-notify"};class mee extends Nt{constructor(e,n,r){super(e,n,r,{newUser:{},newHost:{}})}}mee.COMMAND="CHGHOST";const jqe={name:"chghost",messageTypes:[mee]},$qe={name:"invite-notify"};class gee extends Nt{}gee.COMMAND="ACK";const Hqe={name:"labeled-response",messageTypes:[gee],usesTags:!0},Vqe={name:"message-tags",usesTags:!0},zqe={name:"multi-prefix"},Gqe=Object.freeze(Object.defineProperty({__proto__:null,AwayNotify:Oqe,Batch:Fqe,CapNotify:Bqe,ChgHost:jqe,InviteNotify:$qe,LabeledResponse:Hqe,MessageTags:Vqe,MultiPrefix:zqe},Symbol.toStringTag,{value:"Module"}));class Wqe{constructor(e,n,...r){this._client=e,this._originalMessage=n,this._messages=[],this._endEventHandlers=new Map,this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const n=this._client.on(e,()=>this.end());this._endEventHandlers.set(e,n)}async promise(){return this._promise||(this._promise=new Promise(e=>{this._promiseResolve=e})),await this._promise}collect(e){return this._originalMessage._acceptsInReplyCollection(e)?(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0):!1}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach(e=>{this._client.removeListener(e)}),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class lj extends Nt{constructor(e,n,r){super(e,n,r,{password:{}})}}lj.COMMAND="PASS";class wT extends Nt{constructor(e,n,r){super(e,n,r,{nick:{}})}}wT.COMMAND="NICK";class uj extends Nt{constructor(e,n,r){super(e,n,r,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}uj.COMMAND="USER";class vee extends Nt{constructor(e,n,r){super(e,n,r,{name:{},password:{}})}}vee.COMMAND="OPER";class dj extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}dj.COMMAND="QUIT";class _ee extends Nt{constructor(e,n,r){super(e,n,r,{server:{},reason:{trailing:!0}})}}_ee.COMMAND="SQUIT";class pw extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},key:{optional:!0}})}}pw.COMMAND="JOIN";class mw extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}mw.COMMAND="PART";class PA extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,PA.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,PA)}get char(){return this._char}}class yee extends Nt{constructor(e,n,r){super(e,n,r,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return SF(this.target,this._serverProperties.channelTypes)}separate(){const e=[],n=this.modes;if(!n)throw new Error("can't separate a channel mode request, just set actions");const r=n.split(" "),i=r.shift();let s="add";for(const o of i){let a=s;switch(o){case"+":{s="add";break}case"-":{s="remove";break}default:{let c=!1,l=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(o)||this._serverProperties.supportedChannelModes.prefix.includes(o))c=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(o))s==="add"&&(c=!0);else if(this._serverProperties.supportedChannelModes.list.includes(o))r.length?c=!0:a="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(o))throw new PA(o)}else l=this._serverProperties.supportedUserModes.includes(o);if(c&&!r.length)continue;e.push({prefix:this._prefix,action:a,letter:o,param:c?r.shift():void 0,known:l})}}}return e}}yee.COMMAND="MODE";class bee extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}bee.COMMAND="TOPIC";class Dx extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channelList",optional:!0}})}}Dx.COMMAND="NAMES";Dx.SUPPORTS_CAPTURE=!0;class Eee extends Nt{constructor(e,n,r){super(e,n,r,{channel:{optional:!0},server:{optional:!0}})}}Eee.COMMAND="LIST";class See extends Nt{constructor(e,n,r){super(e,n,r,{target:{},channel:{type:"channel"}})}}See.COMMAND="INVITE";class Tee extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}Tee.COMMAND="KICK";class wee extends Nt{constructor(e,n,r){super(e,n,r,{server:{optional:!0}})}}wee.COMMAND="TIME";class gw extends Nt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}gw.COMMAND="PRIVMSG";class yN extends Nt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}yN.COMMAND="NOTICE";class bN extends Nt{constructor(e,n,r){super(e,n,r,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}bN.COMMAND="WHO";class xee extends Nt{constructor(e,n,r){super(e,n,r,{server:{optional:!0},nickMask:{}})}}xee.COMMAND="WHOIS";class Cee extends Nt{constructor(e,n,r){super(e,n,r,{nick:{},count:{optional:!0},server:{optional:!0}})}}Cee.COMMAND="WHOWAS";class Ree extends Nt{constructor(e,n,r){super(e,n,r,{target:{},reason:{trailing:!0,optional:!0}})}}Ree.COMMAND="KILL";class DA extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}DA.COMMAND="PING";class LA extends Nt{constructor(e,n,r){super(e,n,r,{server:{noClient:!0},text:{trailing:!0}})}}LA.COMMAND="PONG";class Aee extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}Aee.COMMAND="ERROR";class Mee extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}Mee.COMMAND="AWAY";class Iee extends Nt{}Iee.COMMAND="REHASH";class Oee extends Nt{}Oee.COMMAND="RESTART";class kee extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}kee.COMMAND="WALLOPS";class Nee extends Nt{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}Nee.COMMAND="USERHOST";class Pee extends Nt{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}Pee.COMMAND="ISON";class Ad extends Nt{constructor(e,n,r){super(e,n,r,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof Ad))return!1;switch(this.subCommand){case"ACK":case"NAK":return e.subCommand==="REQ"&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof Ad))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}Ad.COMMAND="CAP";Ad.SUPPORTS_CAPTURE=!0;class Dee extends Nt{constructor(e,n,r){super(e,n,r,{target:{}})}}Dee.COMMAND="TAGMSG";const Lee=Object.freeze(Object.defineProperty({__proto__:null,Away:Mee,CapabilityNegotiation:Ad,ChannelInvite:See,ChannelJoin:pw,ChannelKick:Tee,ChannelList:Eee,ChannelPart:mw,ClientQuit:dj,ErrorMessage:Aee,IsOnQuery:Pee,Kill:Ree,Mode:yee,Names:Dx,NickChange:wT,Notice:yN,OperLogin:vee,Password:lj,Ping:DA,Pong:LA,PrivateMessage:gw,Rehash:Iee,Restart:Oee,ServerQuit:_ee,TagMessage:Dee,Time:wee,Topic:bee,UserHostQuery:Nee,UserRegistration:uj,Wallops:kee,WhoIsQuery:xee,WhoQuery:bN,WhoWasQuery:Cee},Symbol.toStringTag,{value:"Module"}));class hj extends Nt{constructor(e,n,r){super(e,n,r,{me:{},welcomeText:{trailing:!0}})}}hj.COMMAND="001";class Uee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},yourHost:{trailing:!0}})}}Uee.COMMAND="002";class Fee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},createdText:{trailing:!0}})}}Fee.COMMAND="003";class fj extends Nt{constructor(e,n,r){super(e,n,r,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}fj.COMMAND="004";class pj extends Nt{constructor(e,n,r){super(e,n,r,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}pj.COMMAND="005";class Bee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},modes:{}})}}Bee.COMMAND="221";class jee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},text:{trailing:!0}})}}jee.COMMAND="301";class $ee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},hosts:{trailing:!0}})}}$ee.COMMAND="302";class Hee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Hee.COMMAND="305";class Vee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Vee.COMMAND="306";class zee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}zee.COMMAND="311";class Gee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof bN}endsResponseTo(){return!0}}Gee.COMMAND="315";class Wee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nickMask:{},suffix:{trailing:!0}})}}Wee.COMMAND="318";class qee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channels:{trailing:!0}})}}qee.COMMAND="319";class Kee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}Kee.COMMAND="322";class Yee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Yee.COMMAND="323";class Xee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}Xee.COMMAND="324";class Jee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Jee.COMMAND="331";class Qee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}Qee.COMMAND="332";class Zee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},who:{},ts:{}})}}Zee.COMMAND="333";class ete extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"}})}}ete.COMMAND="341";class tte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}tte.COMMAND="348";class nte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}nte.COMMAND="349";class rte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof bN}}rte.COMMAND="352";class ite extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof Dx}}ite.COMMAND="353";class ste extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof Dx}endsResponseTo(){return!0}}ste.COMMAND="366";class ote extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}ote.COMMAND="367";class ate extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}ate.COMMAND="368";class cte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}cte.COMMAND="372";class lte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}lte.COMMAND="375";class mj extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}mj.COMMAND="376";class ute extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}ute.COMMAND="381";class dte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}dte.COMMAND="391";class hte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}}hte.COMMAND="401";class fte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},server:{},suffix:{trailing:!0}})}}fte.COMMAND="402";class pte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}pte.COMMAND="403";class mte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}mte.COMMAND="404";class gte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}gte.COMMAND="405";class vte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},subCommand:{},suffix:{trailing:!0}})}}vte.COMMAND="410";class _te extends Nt{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}_te.COMMAND="421";class gj extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}gj.COMMAND="422";class yte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}yte.COMMAND="431";class bte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}bte.COMMAND="432";class Ete extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Ete.COMMAND="433";class Ste extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Ste.COMMAND="436";class Tte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Tte.COMMAND="441";class wte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}wte.COMMAND="442";class xte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}xte.COMMAND="443";class Cte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Cte.COMMAND="451";class Rte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}}Rte.COMMAND="461";class vj extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}vj.COMMAND="462";class Ate extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Ate.COMMAND="471";class Mte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},char:{},suffix:{trailing:!0}})}}Mte.COMMAND="472";class Ite extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Ite.COMMAND="473";class Ote extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Ote.COMMAND="474";class kte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}kte.COMMAND="475";class Nte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}Nte.COMMAND="479";class Pte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Pte.COMMAND="481";class Dte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}Dte.COMMAND="482";class Lte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Lte.COMMAND="491";class Ute extends Nt{constructor(e,n,r){super(e,n,r,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}Ute.COMMAND="501";class Fte extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Fte.COMMAND="502";const Bte=Object.freeze(Object.defineProperty({__proto__:null,Error401NoSuchNick:hte,Error402NoSuchServer:fte,Error403NoSuchChannel:pte,Error404CanNotSendToChan:mte,Error405TooManyChannels:gte,Error410InvalidCapCmd:vte,Error421UnknownCommand:_te,Error422NoMotd:gj,Error431NoNickNameGiven:yte,Error432ErroneusNickname:bte,Error433NickNameInUse:Ete,Error436NickCollision:Ste,Error441UserNotInChannel:Tte,Error442NotOnChannel:wte,Error443UserOnChannel:xte,Error451NotRegistered:Cte,Error461NeedMoreParams:Rte,Error462AlreadyRegistered:vj,Error471ChannelIsFull:Ate,Error472UnknownMode:Mte,Error473InviteOnlyChan:Ite,Error474BannedFromChan:Ote,Error475BadChannelKey:kte,Error479BadChanName:Nte,Error481NoPrivileges:Pte,Error482ChanOpPrivsNeeded:Dte,Error491NoOperHost:Lte,Error501UmodeUnknownFlag:Ute,Error502UsersDontMatch:Fte,Reply001Welcome:hj,Reply002YourHost:Uee,Reply003Created:Fee,Reply004ServerInfo:fj,Reply005Isupport:pj,Reply221UmodeIs:Bee,Reply301Away:jee,Reply302UserHost:$ee,Reply305UnAway:Hee,Reply306NowAway:Vee,Reply311WhoisUser:zee,Reply315EndOfWho:Gee,Reply318EndOfWhois:Wee,Reply319WhoisChannels:qee,Reply322List:Kee,Reply323ListEnd:Yee,Reply324ChannelModeIs:Xee,Reply331NoTopic:Jee,Reply332Topic:Qee,Reply333TopicWhoTime:Zee,Reply341Inviting:ete,Reply348ExceptList:tte,Reply349EndOfExceptList:nte,Reply352WhoReply:rte,Reply353NamesReply:ite,Reply366EndOfNames:ste,Reply367BanList:ote,Reply368EndOfBanList:ate,Reply372Motd:cte,Reply375MotdStart:lte,Reply376EndOfMotd:mj,Reply381YoureOper:ute,Reply391Time:dte},Symbol.toStringTag,{value:"Module"})),qqe=new Map([...Object.values(Lee),...Object.values(Bte)].map(t=>[t.COMMAND,t]));function Kqe(t){const[e,n]=V0(t,"!",2);if(n){const[r,i]=V0(n,"@",2);return i?{nick:e,user:r,host:i}:{nick:e,host:r}}return{nick:e}}const pz={":":";",n:`
`,r:"\r",s:" "};function Yqe(t){const e=new Map,n=t.split(";");for(const r of n){const[i,s]=V0(r,"=",2);i!==""&&e.set(i,s?s.replace(/\\(.?)/g,(o,a)=>Object.prototype.hasOwnProperty.call(pz,a)?pz[a]:a):"")}return e}function Xqe(t,e=vE,n=qqe,r=!1,i=[],s=!0){const o=t.split(" ");let a,c;const l=[];let u,d;for(;o.length;){if([a]=o,a.startsWith("@")&&!u&&!c&&!d)u=Yqe(a.slice(1));else if(a.startsWith(":"))if(!d&&!c)a.length>1&&(d=Kqe(a.slice(1)));else{l.push({value:o.join(" ").slice(1),trailing:!0});break}else c?l.push({value:a,trailing:!1}):c=a.toUpperCase();o.shift()}if(u||(u=new Map),!c)throw new Error(`line without command received: ${t}`);s&&(s=!i.includes(c));let h=Nt;return n.has(c)&&(h=n.get(c)),new h(c,{params:l,tags:u,prefix:d,rawLine:t},{serverProperties:e,isServer:r,shouldParseParams:s})}class jte extends Nx{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=TT(vE),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:n,credentials:r,channels:i,channelTypes:s,webSocket:o,logger:a={}}=e;this._options=e;const{pingOnInactivity:c=60,pingTimeout:l=10}=n;this._pingOnInactivity=c,this._pingTimeout=l,this._currentNick=r.nick,this._logger=vN({name:"ircv3",emoji:!0,...a}),this.registerCoreMessageTypes();const{hostName:u,secure:d,reconnect:h=!0}=n,p={hostName:u,port:this.port,secure:d},f={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},g=o?Iqe:Aqe;h?this._connection=new Mqe(g,p,f):this._connection=new g(f,this._logger,e.connectionOptions);for(const y of Object.values(Gqe))this.addCapability(y);this.addInternalListener(this.onRegister,async()=>{const y=this._hasRegisteredBefore,E=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const w=y&&this._options.rejoinChannelsOnReconnect?E:await mF(i);if(w)for(const R of w)this.join(R)}),this.onTypedMessage(Ad,async({subCommand:y,capabilities:E})=>{const w=E.split(" ");switch(y.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${w.join(", ")}`);const R=aC(w,k=>{if(!k)return{};const[I,N]=V0(k,"=",2);return{[I]:{name:I,param:N||!0}}});for(const[k,I]of Object.entries(R))this._serverCapabilities.set(k,I);const A=Object.keys(R);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([k])=>A.includes(k)).map(([,k])=>k));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${w.join(", ")}`);for(const R of w)this._serverCapabilities.delete(R),this._negotiatedCapabilities.delete(R)}}}),this.onTypedMessage(DA,({text:y})=>{this.sendMessage(LA,{text:y})}),this.onTypedMessage(hj,({me:y})=>this._handleReceivedClientNick(y)),this.onTypedMessage(fj,({userModes:y})=>{y&&(this._serverProperties.supportedUserModes=y)}),this.onTypedMessage(pj,({supports:y})=>{const E=aC(y.split(" "),w=>{const[R,A]=V0(w,"=",2);return{[R]:A||!0}});this._supportedFeatures={...this._supportedFeatures,...E}}),this.onTypedMessage(mj,({me:y})=>{this._registered||(this._handleReceivedClientNick(y),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(gj,({me:y})=>{this._registered||(this._handleReceivedClientNick(y),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(vj,({me:y})=>{this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(y),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(gw,y=>{var E;const{target:w,text:R}=y,A=fz(R),k=(E=y.prefix)===null||E===void 0?void 0:E.nick;A?A.command==="ACTION"?this.emit(this.onAction,w,k,A.params,y):this.emit(this.onCtcp,w,k,A.command,A.params,y):this.emit(this.onPrivmsg,w,k,R,y)}),this.onTypedMessage(wT,y=>{var E;const{nick:w}=y,R=(E=y.prefix)===null||E===void 0?void 0:E.nick;R===this._currentNick&&(this._currentNick=w),this.emit(this.onNickChange,R,w,y)}),this.onTypedMessage(yN,y=>{var E;const{target:w,text:R}=y,A=fz(R),k=(E=y.prefix)===null||E===void 0?void 0:E.nick;A&&this.emit(this.onCtcpReply,w,k,A.command,A.params,y),this.emit(this.onNotice,w,k,R,y)}),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(pw,({channel:y,prefix:E})=>{(E==null?void 0:E.nick)===this._currentNick&&this.acknowledgeJoin(y)}),this.onTypedMessage(mw,y=>{var E;((E=y.prefix)===null||E===void 0?void 0:E.nick)===this._currentNick&&(this._currentChannels.delete(y.channel),this._channelsFromLastRegister.delete(y.channel))}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=r.nick,this._userName=r.userName,this._realName=r.realName,s&&(this._serverProperties.channelTypes=s)}receiveLine(e){var n;this._logger.debug(`Received message: ${e}`);let r;try{r=Xqe(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(i){this._logger.error(`Error parsing message: ${i.message}`),this._logger.trace((n=i.stack)!==null&&n!==void 0?n:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify(r)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,r),this._handleEvents(r)}get serverProperties(){return TT(this._serverProperties)}get port(){const{webSocket:e,connection:{port:n,secure:r}}=this._options;return n||(e?r?443:80:r?6697:6667)}pingCheck(){const e=Date.now(),n=e.toString(),r=this.onTypedMessage(LA,i=>{const{text:s}=i;s===n&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(r))});this._pingTimeoutTimer=setTimeout(()=>{this.removeMessageListener(r),this._options.connection.reconnect===!1?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()},this._pingTimeout*1e3),this.sendMessage(DA,{text:n})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){e.COMMAND!==""&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const n of Object.values(e.messageTypes))this.registerMessageType(n)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,n,r){this._events.has(e)||this._events.set(e,new Map);const i=this._events.get(e);if(!r)do r=`${e}:${AWe(Math.random()*1e4,4,"0")}`;while(i.has(r));return i.set(r,n),r}onTypedMessage(e,n,r){return this.onNamedMessage(e.COMMAND,n,r)}removeMessageListener(e){const[n]=e.split(":");this._events.has(n)&&this._events.get(n).delete(e)}createMessage(e,n,r){const i=r?new Map(Object.entries(r)):void 0;return Uqe(e,n,void 0,i,this.serverProperties)}sendMessage(e,n,r){this.send(this.createMessage(e,n,r))}async sendMessageAndCaptureReply(e,n){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const r=this.createMessage(e,n),i=this.collect(r).promise();return this.send(r),await i}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e,...n){const r=new Wqe(this,e,...n);return this._collectors.push(r),r}stopCollect(e){this._collectors.splice(this._collectors.findIndex(n=>n===e),1)}join(e,n){this.sendMessage(pw,{channel:e,key:n})}part(e){this.sendMessage(mw,{channel:e})}quit(e){this.sendMessage(dj,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,n,r={}){this.sendMessage(gw,{target:e,text:n},r)}sendCtcp(e,n,r){this.say(e,`${n.toUpperCase()} ${r}`)}action(e,n){this.sendCtcp(e,"ACTION",n)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(wT,{nick:e}))}registerCoreMessageTypes(){gF(Lee,e=>{this.registerMessageType(e)}),gF(Bte,e=>{this.registerMessageType(e)})}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter(n=>n.length).map(async n=>await this._negotiateCapabilities(n)))}async _negotiateCapabilities(e){const n=aC(e,o=>({[o.name]:o})),i=(await this.sendMessageAndCaptureReply(Ad,{subCommand:"REQ",capabilities:e.map(o=>o.name).join(" ")})).shift();if(!i)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(i instanceof Ad))throw new Error(`capability negotiation failed unexpectedly with "${i.command}" command`);const s=i.capabilities.split(" ").filter(o=>o);if(i.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${s.join(", ")}`);const o=s.map(a=>n[a]);for(const a of o){const c=this._clientCapabilities.get(a.name);c.param=a.param,this._negotiatedCapabilities.set(c.name,c)}return o}return this._logger.warn(`Failed to negotiate capabilities: ${s.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect(async()=>{var e,n;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[r]=await Promise.all([mF(this._options.credentials.password),this.sendMessageAndCaptureReply(Ad,{subCommand:"LS",version:"302"}).then(async i=>{if(!i.length||!(i[0]instanceof Ad))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const s=i.map(a=>aC(a.capabilities.split(" "),c=>{if(!c)return{};const[l,u]=V0(c,"=",2);return{[l]:{name:l,param:u||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...s))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const o=s.map(a=>{const c=Object.keys(a);return Array.from(this._clientCapabilities.entries()).filter(([l])=>c.includes(l)).map(([,l])=>l)});return await this._negotiateCapabilityBatch(o)}).then(()=>{this.sendMessage(Ad,{subCommand:"END"})})]);r&&this.sendMessage(lj,{password:r}),this.sendMessage(wT,{nick:this._desiredNick}),this.sendMessage(uj,{user:(e=this._userName)!==null&&e!==void 0?e:this._desiredNick,mode:"8",unused:"*",realName:(n=this._realName)!==null&&n!==void 0?n:this._desiredNick})}catch(r){this.emit(this.onPasswordError,r),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive(e=>{this.receiveLine(e)}),this._connection.onDisconnect((e,n)=>{var r;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const i=(r=this._options.connection.reconnect)!==null&&r!==void 0?r:!0,s=n?`Disconnected unexpectedly: ${n.message}`:"Disconnected unexpectedly";i?this._logger.warn(`${s}; trying to reconnect`):this._logger.error(s)}this.emit(this.onDisconnect,e,n)}),this._connection.onEnd(e=>{e||this._logger.warn("No further retries will be made")}))}_handleReceivedClientNick(e){this._currentNick!==e&&(this._currentNick!==""&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some(r=>r.collect(e));const n=this._events.get(e.constructor.COMMAND);if(n)for(const r of n.values())r(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1e3):this._pingCheckTimer=void 0}}As([D_(!1)],jte.prototype,"_options",void 0);class _j extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return(e=this._tags.get("target-user-id"))!==null&&e!==void 0?e:null}}_j.COMMAND="CLEARCHAT";class $te extends Nt{}$te.COMMAND="RECONNECT";class yj extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}yj.COMMAND="ROOMSTATE";function Jqe(t){switch(typeof t){case"undefined":return"";case"object":{if(t===null)return"";if("cacheKey"in t)return t.cacheKey;const e=JSON.stringify(t);if(e!=="{}")return e}default:return t.toString()}}function Hte(t,e,n){return[t,...e.map(Jqe)].join("/")+(n?"/":"")}const Hm=Symbol("cache");function Qqe(t){var e,n;return n=class extends t{constructor(){super(...arguments),this[e]=new Map}getFromCache(r){if(this._cleanCache(),this[Hm].has(r)){const i=this[Hm].get(r);if(i)return i.value}}setCache(r,i,s){this[Hm].set(r,{value:i,expires:Date.now()+s*1e3})}removeFromCache(r,i){const s=this._getInternalCacheKey(r,i);i?this[Hm].forEach((o,a)=>{a.startsWith(s)&&this[Hm].delete(a)}):this[Hm].delete(s)}_cleanCache(){const r=Date.now();this[Hm].forEach((i,s)=>{i.expires<r&&this[Hm].delete(s)})}_getInternalCacheKey(r,i){if(typeof r=="string"){let s=r;return s.endsWith("/")||(s+="/"),s}else{const s=r.shift();return Hte(s,r,i)}}},e=Hm,n}function Vte(t=1/0){return function(e,n,r){if(r.get){const i=r.get;r.get=function(){const s=Hte(n,[]),o=this.getFromCache(s);if(o)return o;const a=i.call(this);return this.setCache(s,a,t),a}}return r}}var rR;let w_=rR=class{constructor(e,n){this._userName=e.toLowerCase(),this._userData=n?new Map(n):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map(n=>{const r=n.indexOf("/");return r===-1?[n,""]:[n.slice(0,r),n.slice(r+1)]})):new Map}get userName(){return this._userName}get displayName(){var e;return(e=this._userData.get("display-name"))!==null&&e!==void 0?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return rR._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return rR._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){const e=this._userData.get("vip");return e!=null&&e!=="0"}get isArtist(){return this.badges.has("artist-badge")}};As([D_(!1)],w_.prototype,"_userData",void 0);As([Vte()],w_.prototype,"badges",null);As([Vte()],w_.prototype,"badgeInfo",null);w_=rR=As([Qqe,Px("chat","ChatUser","userId")],w_);function bj(t){return t?new Map(t.split("/").map(e=>{const[n,r]=e.split(":",2);return r?[n,r.split(",")]:null}).filter(e=>e!==null)):new Map}class Ej extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new w_(this._tags.get("login"),this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get emoteOffsets(){return bj(this._tags.get("emotes"))}}Ej.COMMAND="USERNOTICE";class zte extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}zte.COMMAND="USERSTATE";class Sj extends Nt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}get userInfo(){return new w_(this._prefix.nick,this._tags)}get emoteOffsets(){return bj(this._tags.get("emotes"))}}Sj.COMMAND="WHISPER";const Zqe={name:"twitch.tv/commands",messageTypes:[_j,$te,yj,Ej,zte,Sj]},e9e={name:"twitch.tv/membership"};class Tj extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}Tj.COMMAND="CLEARMSG";class Gte extends Nt{}Gte.COMMAND="GLOBALUSERSTATE";const t9e={name:"twitch.tv/tags",messageTypes:[Gte,Tj]},n9e=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"];let UA=class extends gw{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new w_(this._prefix.nick,this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return!!this._tags.get("custom-reward-id")}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return(e=this._tags.get("reply-parent-msg-id"))!==null&&e!==void 0?e:null}get parentMessageText(){var e;return(e=this._tags.get("reply-parent-msg-body"))!==null&&e!==void 0?e:null}get parentMessageUserId(){var e;return(e=this._tags.get("reply-parent-user-id"))!==null&&e!==void 0?e:null}get parentMessageUserName(){var e;return(e=this._tags.get("reply-parent-user-login"))!==null&&e!==void 0?e:null}get parentMessageUserDisplayName(){var e;return(e=this._tags.get("reply-parent-display-name"))!==null&&e!==void 0?e:null}get threadMessageId(){var e;return(e=this._tags.get("reply-thread-parent-msg-id"))!==null&&e!==void 0?e:null}get threadMessageUserId(){var e;return(e=this._tags.get("reply-thread-parent-user-id"))!==null&&e!==void 0?e:null}get bits(){var e;return Number((e=this._tags.get("bits"))!==null&&e!==void 0?e:0)}get emoteOffsets(){return bj(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return hw(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return hw(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){const e=this.hypeChatAmount;return e?e/10**this.hypeChatDecimalPlaces:null}get hypeChatCurrency(){var e;return(e=this._tags.get("pinned-chat-paid-currency"))!==null&&e!==void 0?e:null}get hypeChatLevel(){const e=this._tags.get("pinned-chat-paid-level");return e?n9e.indexOf(e)+1:null}get hypeChatIsSystemMessage(){const e=this._tags.get("pinned-chat-paid-is-system-message");return e?!!Number(e):null}};UA=As([Px("chat","ChatMessage","id")],UA);function r9e(t){return t instanceof UA?t.tags.get("id"):t}function mz(t,e){if(t.length<=e)return[t];t=t.trim();const n=[];let r=0,i=e;for(;r<t.length;){let s=t.lastIndexOf(" ",i);(s===-1||s<=r||t.length-r+1<=e)&&(s=r+e);const o=t.slice(r,s).trim();o.length&&n.push(o),r=s+(t[s]===" "?1:0),i=r+e}return n}const i9e=/^[a-z0-9][a-z0-9_]{0,24}$/;function wa(t){const e=t.replace(/^#/,"").toLowerCase();if(!i9e.test(e))throw new Error(`"${e}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return e}function cC(t){return`#${wa(t)}`}var TF;let FA=TF=class extends Nx{constructor(e={}){var n,r,i,s,o;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new tR("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new jte({connection:{hostName:(n=e.hostName)!==null&&n!==void 0?n:!((r=e.webSocket)!==null&&r!==void 0)||r?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(i=e.ssl)!==null&&i!==void 0?i:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(s=e.webSocket)!==null&&s!==void 0?s:!0,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((l,u)=>{this._messageRateLimiter.clear(),this._messageRateLimiter.pause(),this._joinRateLimiter.clear(),this._joinRateLimiter.pause(),this.emit(this.onDisconnect,l,u)}),this._ircClient.registerMessageType(UA),this._chatLogger=vN({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...(o=e.authIntents)!==null&&o!==void 0?o:[],"chat"];const a=async({type:l,text:u,channel:d,tags:h})=>{l==="say"?this._ircClient.say(d,u,h):this._ircClient.action(d,u)},c=async l=>{const{promise:u,resolve:d,reject:h}=vF();let p;const f=this.addInternalListener(this._onJoinResult,(g,y,E)=>{g===l&&(clearTimeout(p),E?h(E):d(),this.removeListener(f))});p=setTimeout(()=>{this.removeListener(f),this.emit(this._onJoinResult,l,void 0,"twurple_timeout"),h(new Error(`Did not receive a reply to join ${l} in time; assuming that the join failed`))},1e4),this._ircClient.join(l),await u};if(e.isAlwaysMod)this._messageRateLimiter=new _F({bucketSize:e.botLevel==="verified"?7500:100,timeFrame:32e3,doRequest:a});else{let l=20;e.botLevel==="verified"?l=7500:e.botLevel==="known"&&(l=50),this._messageRateLimiter=new jWe(new BWe({bucketSize:1,timeFrame:1200,logger:{minLevel:Kn.ERROR},doRequest:a,getPartitionKey:({channel:u})=>u}),{bucketSize:l,timeFrame:32e3})}this._joinRateLimiter=new _F({bucketSize:e.botLevel==="verified"?2e3:20,timeFrame:11e3,doRequest:c}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause(),this._ircClient.addCapability(t9e),this._ircClient.addCapability(Zqe),e.requestMembershipEvents&&this._ircClient.addCapability(e9e),this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{this._messageRateLimiter.resume(),this._joinRateLimiter.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const l=await mF(e.channels);l&&await Promise.all(l.map(async u=>{var d;try{await this.join(u)}catch(h){this._chatLogger.warn(`Failed to join configured channel ${u}; original message: ${(d=h==null?void 0:h.message)!==null&&d!==void 0?d:h}`)}}))}),this._ircClient.onPasswordError(l=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${l.message}`),this.emit(this.onTokenFetchFailure,l)}),this._ircClient.onPrivmsg((l,u,d,h)=>{u!=="jtv"&&this.emit(this.onMessage,wa(l),u,d,h)}),this._ircClient.onAction((l,u,d,h)=>{this.emit(this.onAction,wa(l),u,d,h)}),this.addInternalListener(this._onJoinResult,(l,u,d)=>{d?this.emit(this.onJoinFailure,wa(l),d):this._ircClient.acknowledgeJoin(l)}),this._ircClient.onTypedMessage(_j,l=>{const{channel:u,user:d,tags:h}=l,p=wa(u);if(d){const f=h.get("ban-duration");f===void 0?this.emit(this.onBan,p,d,l):this.emit(this.onTimeout,p,d,Number(f),l)}else this.emit(this.onChatClear,p,l)}),this._ircClient.onTypedMessage(Tj,l=>{const{channel:u,targetMessageId:d}=l;this.emit(this.onMessageRemove,wa(u),d,l)}),this._ircClient.onTypedMessage(pw,({prefix:l,channel:u})=>{this.emit(this.onJoin,wa(u),l.nick)}),this._ircClient.onTypedMessage(mw,({prefix:l,channel:u})=>{this.emit(this.onPart,wa(u),l.nick)}),this._ircClient.onTypedMessage(yj,({channel:l,tags:u})=>{let d=!1;if(u.has("subs-only")&&u.has("slow")&&(this.emit(this._onJoinResult,l,u),d=!0),!d){const h=wa(l);if(u.has("slow")){const p=Number(u.get("slow"));p?this.emit(this.onSlow,h,!0,p):this.emit(this.onSlow,h,!1)}if(u.has("followers-only")){const p=Number(u.get("followers-only"));p===-1?this.emit(this.onFollowersOnly,h,!1):this.emit(this.onFollowersOnly,h,!0,p)}}}),this._ircClient.onTypedMessage(Ej,l=>{const{channel:u,text:d,tags:h}=l,p=h.get("msg-id"),f=wa(u);switch(p){case"sub":case"resub":{const g=p==="sub"?this.onSub:this.onResub,y=h.get("msg-param-sub-plan"),E=h.get("msg-param-streak-months"),w={userId:h.get("user-id"),displayName:h.get("display-name"),plan:y,planName:h.get("msg-param-sub-plan-name"),isPrime:y==="Prime",months:Number(h.get("msg-param-cumulative-months")),streak:E?Number(E):void 0,message:d};if(h.get("msg-param-was-gifted")==="true"){const A=h.get("msg-param-anon-gift")==="true",k=Number(h.get("msg-param-gift-months")),I=Number(h.get("msg-param-gift-month-being-redeemed"));A?w.originalGiftInfo={anonymous:!0,duration:k,redeemedMonth:I}:w.originalGiftInfo={anonymous:!1,duration:k,redeemedMonth:I,userId:h.get("msg-param-gifter-id"),userName:h.get("msg-param-gifter-login"),userDisplayName:h.get("msg-param-gifter-name")}}this.emit(g,f,h.get("login"),w,l);break}case"subgift":{const g=h.get("msg-param-sub-plan"),y=h.get("login"),E=y==="ananonymousgifter",w={userId:h.get("msg-param-recipient-id"),displayName:h.get("msg-param-recipient-display-name"),gifter:E?void 0:y,gifterUserId:E?void 0:h.get("user-id"),gifterDisplayName:E?void 0:h.get("display-name"),gifterGiftCount:E?void 0:Number(h.get("msg-param-sender-count")),giftDuration:Number(h.get("msg-param-gift-months")),plan:g,planName:h.get("msg-param-sub-plan-name"),isPrime:g==="Prime",months:Number(h.get("msg-param-months"))};this.emit(this.onSubGift,f,h.get("msg-param-recipient-user-name"),w,l);break}case"submysterygift":{const g=h.get("login"),y=g==="ananonymousgifter",E={gifter:y?void 0:g,gifterUserId:y?void 0:h.get("user-id"),gifterDisplayName:y?void 0:h.get("display-name"),gifterGiftCount:y?void 0:Number(h.get("msg-param-sender-count")),count:Number(h.get("msg-param-mass-gift-count")),plan:h.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,f,h.get("login"),E,l);break}case"primepaidupgrade":{const g={userId:h.get("user-id"),displayName:h.get("display-name"),plan:h.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,f,h.get("login"),g,l);break}case"giftpaidupgrade":{const g={userId:h.get("user-id"),displayName:h.get("display-name"),gifter:h.get("msg-param-sender-login"),gifterDisplayName:h.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,f,h.get("login"),g,l);break}case"standardpayforward":{const g=h.get("msg-param-prior-gifter-anonymous")==="true",y={userId:h.get("user-id"),displayName:h.get("display-name"),originalGifterUserId:g?void 0:h.get("msg-param-prior-gifter-id"),originalGifterDisplayName:g?void 0:h.get("msg-param-prior-gifter-display-name"),recipientUserId:h.get("msg-param-recipient-id"),recipientDisplayName:h.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,f,h.get("login"),y,l);break}case"communitypayforward":{const g=h.get("msg-param-prior-gifter-anonymous")==="true",y={userId:h.get("user-id"),displayName:h.get("display-name"),originalGifterUserId:g?void 0:h.get("msg-param-prior-gifter-id"),originalGifterDisplayName:g?void 0:h.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,f,h.get("login"),y,l);break}case"primecommunitygiftreceived":{const g={name:h.get("msg-param-gift-name"),gifter:h.get("login"),gifterDisplayName:h.get("display-name")};this.emit(this.onPrimeCommunityGift,f,h.get("msg-param-recipient"),g,l);break}case"raid":{const g={displayName:h.get("msg-param-displayName"),viewerCount:Number(h.get("msg-param-viewerCount"))};this.emit(this.onRaid,f,h.get("login"),g,l);break}case"unraid":{this.emit(this.onRaidCancel,f,l);break}case"ritual":{const g={ritualName:h.get("msg-param-ritual-name"),message:d};this.emit(this.onRitual,f,h.get("login"),g,l);break}case"bitsbadgetier":{const g={displayName:h.get("display-name"),threshold:Number(h.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,f,h.get("login"),g,l);break}case"extendsub":{const g={userId:h.get("user-id"),displayName:h.get("display-name"),plan:h.get("msg-param-sub-plan"),months:Number(h.get("msg-param-cumulative-months")),endMonth:Number(h.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,f,h.get("login"),g,l);break}case"rewardgift":{const g={domain:h.get("msg-param-domain"),gifterId:h.get("user-id"),gifterDisplayName:h.get("display-name"),count:Number(h.get("msg-param-selected-count")),gifterGiftCount:Number(h.get("msg-param-total-reward-count")),triggerType:h.get("msg-param-trigger-type")};this.emit(this.onRewardGift,f,h.get("login"),g,l);break}case"announcement":{const g={color:h.get("msg-param-color")};this.emit(this.onAnnouncement,f,h.get("login"),g,l);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${p}`)}}),this._ircClient.onTypedMessage(Sj,l=>{this.emit(this.onWhisper,l.prefix.nick,l.text,l)}),this._ircClient.onTypedMessage(yN,async({target:l,text:u,tags:d})=>{const h=d.get("msg-id");switch(h){case"emote_only_on":{this.emit(this.onEmoteOnly,wa(l),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,wa(l),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,l,void 0,h);break}case"r9k_on":{this.emit(this.onUniqueChat,wa(l),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,wa(l),!1);break}case"subs_on":{this.emit(this.onSubsOnly,wa(l),!0);break}case"subs_off":{this.emit(this.onSubsOnly,wa(l),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,wa(l),u);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,wa(l),u);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,wa(l),h);break}case void 0:{if(u==="Login authentication failed"||u==="Improperly formatted AUTH"||u==="Invalid NICK"){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=tee(120),this._authRetryCount=0);const p=this._authRetryTimer.next().value,f=++this._authRetryCount;this.emit(this.onAuthenticationFailure,u,f),p!==0&&this._chatLogger.info(`Retrying authentication in ${p} seconds`),await RWe(p*1e3),this._ircClient.reconnect()}break}default:h.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${h}'`)}})}connect(){this._authProvider||this._ircClient.changeNick(TF._generateJustinfanNick()),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,n,r={},i){const s={};r.replyTo&&(s["reply-parent-msg-id"]=r9e(r.replyTo));const o=mz(n,500);await Promise.all(o.map(async a=>await this._messageRateLimiter.request({type:"say",channel:cC(e),text:a,tags:s},i)))}async action(e,n,r){const i=mz(n,490);await Promise.all(i.map(async s=>await this._messageRateLimiter.request({type:"action",channel:cC(e),text:s},r)))}async join(e){await this._joinRateLimiter.request(cC(e))}part(e){this._ircClient.part(cC(e))}quit(){this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,n;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!eR(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const r=this._getNecessaryScopes();let i,s=!1;for(const o of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(o,r),!this._authToken)continue;s=!0;const a=await fw(this._authToken.accessToken);if(!a.userName)throw new tR("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}catch(a){a instanceof gE?i=a:this._chatLogger.error(`Retrieving an access token failed: ${a.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await((n=(e=this._authProvider).refreshAccessTokenForIntent)===null||n===void 0?void 0:n.call(e,o)),this._authToken){const a=await fw(this._authToken.accessToken);if(!a.userName)throw new tR("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}}catch(a){a instanceof gE?i=a:this._chatLogger.error(`Refreshing the access token failed: ${a.message}`)}}throw this._authVerified=!1,i??new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof T_?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}};As([D_(!1)],FA.prototype,"_authProvider",void 0);FA=TF=As([Px("chat","ChatClient")],FA);let zf;const Vm=Xh("chat",[],t=>{if(Vm.session(t))switch(t.target){case"connect":he(zf)?ai(Vm,"connection","chat is already connected"):nr(t.data)&&(Ar(Vm,`connecting to ${t.data}`),zf=new FA({channels:[t.data]}),zf.connect(),zf.onConnect(()=>{Ar(Vm,"connected")}),zf.onDisconnect(()=>{Ar(Vm,"disconnected")}),zf.onMessage((e,n,r)=>{tg(Vm,void 0,"text",`chat:message:${t.data}`,`${n}:${r}`,Ni())}),zf.onAction((e,n,r)=>{tg(Vm,void 0,"text",`chat:action:${t.data}`,`${n}:${r}`,Ni())}));break;case"disconnect":he(zf)?(zf.quit(),zf=void 0,Ar(Vm,"client quit")):ai(Vm,"connection","chat is already disconnected");break}}),gz=Xh("gadgetclient",[],t=>{if(!gz.session(t))return;const{desync:e}=og.getState();switch(t.target){case"paint":t.player===Ni()&&og.setState({desync:!1,gadget:t.data});break;case"patch":t.player===Ni()&&!e&&og.setState(n=>{let r;try{r=sB(t.data,n.gadget)}catch(s){r=s}if(he(r))return gz.replynext(t,"desync",void 0,t.player),{...n,desync:!0};const i=iM(n.gadget,t.data,!0,!1);return{...n,gadget:i.newDocument}});break}}),Wte="0123456789abcdefABCDEF";Wte.split("").map(t=>t.codePointAt(0));Array(256).fill(!0).map((t,e)=>{const n=String.fromCodePoint(e),r=Wte.indexOf(n);return r<0?void 0:r<16?r:r-6});new TextEncoder;new TextDecoder;function Tb(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;++r)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return t.length===e.length?0:t.length>e.length?1:-1}var s9e=(t,e,n=Math.min(t.length,e.length))=>{for(let r=0;r<n;r++){const i=t[r],s=e[r];if(i!==s)return 8*n-(r*8+Math.clz32(i^s)-24)}return 0},o9e=class{constructor(t,e){this.id=t,this.bucketSize=e.bucketSize||20,this.buckets=new Array(t.length*8+1).fill(void 0).map(()=>[]),this.compare=e.compare||(()=>0),this.getId=e.getId}get length(){return this.buckets.reduce((t,e)=>t+e.length,0)}*[Symbol.iterator](){for(const t of this.buckets)for(const e of t)yield e}add(t,e=this.getBitwiseDistance(this.getId(t))){if(this.has(this.getId(t),e))return!1;if(this.buckets[e].length<this.bucketSize)return this.buckets[e].push(t),!0;const n=this.buckets[e].slice(0);n.push(t);const r=n.sort(this.compare);this.buckets[e]=r.slice(0,this.bucketSize);const i=r.at(-1);return Tb(this.getId(t),this.getId(i))!==0}clear(){for(let t=0;t<this.buckets.length;t++)this.buckets[t]=[]}listClosestToId(t,e=this.buckets.length*this.bucketSize){const n=this.getBitwiseDistance(t);return this.getNodes(n,e)}get(t){const e=this.buckets[t].shift();return e&&this.buckets[t].push(e),e}getById(t,e=this.getBitwiseDistance(t)){const n=this.buckets[e].findIndex(i=>Tb(this.getId(i),t)===0);if(n===-1)return;const r=this.buckets[e][n];return this.buckets[e]=this.buckets[e].splice(n,1).concat(r),r}getBitwiseDistance(t){return s9e(this.id,t)}getNodes(t,e,n=0){const r=(n%2===0?1:-1)*Math.ceil(n/2);if(Math.abs(r)>Math.max(t,this.buckets.length-1-t))return[];const i=t+r;if(0>i||i>this.buckets.length-1)return this.getNodes(t,e,n+1);const s=this.buckets[i].slice(0,e);return s.length>=e?(this.buckets[i]=this.buckets[i].slice(s.length).concat(this.buckets[i].slice(0,s.length)),s):s.concat(this.getNodes(t,e-s.length,n+1))}has(t,e=this.getBitwiseDistance(t)){return!!this.buckets[e].find(n=>Tb(this.getId(n),t)===0)}peek(t){return this.buckets[t].at(0)}peekById(t,e=this.getBitwiseDistance(t)){return this.buckets[e].find(n=>Tb(this.getId(n),t)===0)}update(t,e=this.getBitwiseDistance(this.getId(t))){const n=this.buckets[e].findIndex(r=>Tb(this.getId(r),this.getId(t))===0);return n===-1?!1:(this.buckets[e][n]=t,!0)}remove(t,e=this.getBitwiseDistance(t)){const n=this.buckets[e].findIndex(r=>Tb(this.getId(r),t)===0);return n===-1?!1:(this.buckets[e].splice(n,1),!0)}},qte={exports:{}};(function(t){var e=function(){function n(h,p){return p!=null&&h instanceof p}var r;try{r=Map}catch{r=function(){}}var i;try{i=Set}catch{i=function(){}}var s;try{s=Promise}catch{s=function(){}}function o(h,p,f,g,y){typeof p=="object"&&(f=p.depth,g=p.prototype,y=p.includeNonEnumerable,p=p.circular);var E=[],w=[],R=typeof Mc<"u";typeof p>"u"&&(p=!0),typeof f>"u"&&(f=1/0);function A(k,I){if(k===null)return null;if(I===0)return k;var N,U;if(typeof k!="object")return k;if(n(k,r))N=new r;else if(n(k,i))N=new i;else if(n(k,s))N=new s(function(ie,G){k.then(function(Q){ie(A(Q,I-1))},function(Q){G(A(Q,I-1))})});else if(o.__isArray(k))N=[];else if(o.__isRegExp(k))N=new RegExp(k.source,d(k)),k.lastIndex&&(N.lastIndex=k.lastIndex);else if(o.__isDate(k))N=new Date(k.getTime());else{if(R&&Mc.isBuffer(k))return Mc.allocUnsafe?N=Mc.allocUnsafe(k.length):N=new Mc(k.length),k.copy(N),N;n(k,Error)?N=Object.create(k):typeof g>"u"?(U=Object.getPrototypeOf(k),N=Object.create(U)):(N=Object.create(g),U=g)}if(p){var F=E.indexOf(k);if(F!=-1)return w[F];E.push(k),w.push(N)}n(k,r)&&k.forEach(function(ie,G){var Q=A(G,I-1),se=A(ie,I-1);N.set(Q,se)}),n(k,i)&&k.forEach(function(ie){var G=A(ie,I-1);N.add(G)});for(var $ in k){var q;U&&(q=Object.getOwnPropertyDescriptor(U,$)),!(q&&q.set==null)&&(N[$]=A(k[$],I-1))}if(Object.getOwnPropertySymbols)for(var K=Object.getOwnPropertySymbols(k),$=0;$<K.length;$++){var W=K[$],X=Object.getOwnPropertyDescriptor(k,W);X&&!X.enumerable&&!y||(N[W]=A(k[W],I-1),X.enumerable||Object.defineProperty(N,W,{enumerable:!1}))}if(y)for(var ne=Object.getOwnPropertyNames(k),$=0;$<ne.length;$++){var Z=ne[$],X=Object.getOwnPropertyDescriptor(k,Z);X&&X.enumerable||(N[Z]=A(k[Z],I-1),Object.defineProperty(N,Z,{enumerable:!1}))}return N}return A(h,f)}o.clonePrototype=function(p){if(p===null)return null;var f=function(){};return f.prototype=p,new f};function a(h){return Object.prototype.toString.call(h)}o.__objToStr=a;function c(h){return typeof h=="object"&&a(h)==="[object Date]"}o.__isDate=c;function l(h){return typeof h=="object"&&a(h)==="[object Array]"}o.__isArray=l;function u(h){return typeof h=="object"&&a(h)==="[object RegExp]"}o.__isRegExp=u;function d(h){var p="";return h.global&&(p+="g"),h.ignoreCase&&(p+="i"),h.multiline&&(p+="m"),p}return o.__getRegExpFlags=d,o}();t.exports&&(t.exports=e)})(qte);var a9e=qte.exports,wF={exports:{}},DD,vz;function c9e(){if(vz)return DD;vz=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,s=r*365.25;DD=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return o(u);if(h==="number"&&isFinite(u))return d.long?c(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),p=(d[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*n;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=n?Math.round(u/n)+"h":d>=e?Math.round(u/e)+"m":d>=t?Math.round(u/t)+"s":u+"ms"}function c(u){var d=Math.abs(u);return d>=r?l(u,d,r,"day"):d>=n?l(u,d,n,"hour"):d>=e?l(u,d,e,"minute"):d>=t?l(u,d,t,"second"):u+" ms"}function l(u,d,h,p){var f=d>=h*1.5;return Math.round(u/h)+" "+p+(f?"s":"")}return DD}function l9e(t){n.debug=n,n.default=n,n.coerce=c,n.disable=s,n.enable=i,n.enabled=o,n.humanize=c9e(),n.destroy=l,Object.keys(t).forEach(u=>{n[u]=t[u]}),n.names=[],n.skips=[],n.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return n.colors[Math.abs(d)%n.colors.length]}n.selectColor=e;function n(u){let d,h=null,p,f;function g(...y){if(!g.enabled)return;const E=g,w=Number(new Date),R=w-(d||w);E.diff=R,E.prev=d,E.curr=w,d=w,y[0]=n.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let A=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(I,N)=>{if(I==="%%")return"%";A++;const U=n.formatters[N];if(typeof U=="function"){const F=y[A];I=U.call(E,F),y.splice(A,1),A--}return I}),n.formatArgs.call(E,y),(E.log||n.log).apply(E,y)}return g.namespace=u,g.useColors=n.useColors(),g.color=n.selectColor(u),g.extend=r,g.destroy=n.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==n.namespaces&&(p=n.namespaces,f=n.enabled(u)),f),set:y=>{h=y}}),typeof n.init=="function"&&n.init(g),g}function r(u,d){const h=n(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){n.save(u),n.namespaces=u,n.names=[],n.skips=[];let d;const h=(typeof u=="string"?u:"").split(/[\s,]+/),p=h.length;for(d=0;d<p;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?n.skips.push(new RegExp("^"+u.slice(1)+"$")):n.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...n.names.map(a),...n.skips.map(a).map(d=>"-"+d)].join(",");return n.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=n.skips.length;d<h;d++)if(n.skips[d].test(u))return!1;for(d=0,h=n.names.length;d<h;d++)if(n.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var u9e=l9e;(function(t,e){var n={};e.formatArgs=i,e.save=s,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let d=0,h=0;l[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(d++,p==="%c"&&(h=d))}),l.splice(h,0,u)}e.log=console.debug||console.log||(()=>{});function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function o(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof Bn<"u"&&"env"in Bn&&(l=n.DEBUG),l}function a(){try{return localStorage}catch{}}t.exports=u9e(e);const{formatters:c}=t.exports;c.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(wF,wF.exports);var EN=wF.exports,d9e=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},xF={exports:{}},CF={exports:{}};const Lx=FF(Ebe);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(t,e){var n=Lx,r=n.Buffer;function i(o,a){for(var c in o)a[c]=o[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(i(n,e),e.Buffer=s);function s(o,a,c){return r(o,a,c)}s.prototype=Object.create(r.prototype),i(r,s),s.from=function(o,a,c){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,c)},s.alloc=function(o,a,c){if(typeof o!="number")throw new TypeError("Argument must be a number");var l=r(o);return a!==void 0?typeof c=="string"?l.fill(a,c):l.fill(a):l.fill(0),l},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(o)}})(CF,CF.exports);var Kte=CF.exports,LD=65536,h9e=4294967295;function f9e(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var p9e=Kte.Buffer,BA=Da.crypto||Da.msCrypto;BA&&BA.getRandomValues?xF.exports=m9e:xF.exports=f9e;function m9e(t,e){if(t>h9e)throw new RangeError("requested too many random bytes");var n=p9e.allocUnsafe(t);if(t>0)if(t>LD)for(var r=0;r<t;r+=LD)BA.getRandomValues(n.slice(r,r+LD));else BA.getRandomValues(n);return typeof e=="function"?Bn.nextTick(function(){e(null,n)}):n}var SN=xF.exports,RF={exports:{}},wj={exports:{}},_E=typeof Reflect=="object"?Reflect:null,_z=_E&&typeof _E.apply=="function"?_E.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},iR;_E&&typeof _E.ownKeys=="function"?iR=_E.ownKeys:Object.getOwnPropertySymbols?iR=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:iR=function(e){return Object.getOwnPropertyNames(e)};function g9e(t){console&&console.warn&&console.warn(t)}var Yte=Number.isNaN||function(e){return e!==e};function is(){is.init.call(this)}wj.exports=is;wj.exports.once=b9e;is.EventEmitter=is;is.prototype._events=void 0;is.prototype._eventsCount=0;is.prototype._maxListeners=void 0;var yz=10;function TN(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(is,"defaultMaxListeners",{enumerable:!0,get:function(){return yz},set:function(t){if(typeof t!="number"||t<0||Yte(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");yz=t}});is.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};is.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Yte(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Xte(t){return t._maxListeners===void 0?is.defaultMaxListeners:t._maxListeners}is.prototype.getMaxListeners=function(){return Xte(this)};is.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")_z(c,this,n);else for(var l=c.length,u=tne(c,l),r=0;r<l;++r)_z(u[r],this,n);return!0};function Jte(t,e,n,r){var i,s,o;if(TN(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=Xte(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,g9e(a)}return t}is.prototype.addListener=function(e,n){return Jte(this,e,n,!1)};is.prototype.on=is.prototype.addListener;is.prototype.prependListener=function(e,n){return Jte(this,e,n,!0)};function v9e(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Qte(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=v9e.bind(r);return i.listener=n,r.wrapFn=i,i}is.prototype.once=function(e,n){return TN(n),this.on(e,Qte(this,e,n)),this};is.prototype.prependOnceListener=function(e,n){return TN(n),this.prependListener(e,Qte(this,e,n)),this};is.prototype.removeListener=function(e,n){var r,i,s,o,a;if(TN(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():_9e(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};is.prototype.off=is.prototype.removeListener;is.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function Zte(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?y9e(i):tne(i,i.length)}is.prototype.listeners=function(e){return Zte(this,e,!0)};is.prototype.rawListeners=function(e){return Zte(this,e,!1)};is.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ene.call(t,e)};is.prototype.listenerCount=ene;function ene(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}is.prototype.eventNames=function(){return this._eventsCount>0?iR(this._events):[]};function tne(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function _9e(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function y9e(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function b9e(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}nne(t,e,s,{once:!0}),e!=="error"&&E9e(t,i,{once:!0})})}function E9e(t,e,n){typeof t.on=="function"&&nne(t,"error",e,n)}function nne(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var wN=wj.exports,rne=wN.EventEmitter,xj={},ine={},sne=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var s=Object.getOwnPropertySymbols(e);if(s.length!==1||s[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,n);if(o.value!==i||o.enumerable!==!0)return!1}return!0},S9e=sne,xN=function(){return S9e()&&!!Symbol.toStringTag},one=Object,ane=Error,cne=EvalError,lne=RangeError,une=ReferenceError,Cj=SyntaxError,UD,bz;function wS(){return bz||(bz=1,UD=TypeError),UD}var dne=URIError,T9e=Math.abs,w9e=Math.floor,x9e=Math.max,C9e=Math.min,R9e=Math.pow,A9e=Math.round,M9e=Number.isNaN||function(e){return e!==e},I9e=M9e,O9e=function(e){return I9e(e)||e===0?e:e<0?-1:1},k9e=Object.getOwnPropertyDescriptor,sR=k9e;if(sR)try{sR([],"length")}catch{sR=null}var N9e=sR,oR=Object.defineProperty||!1;if(oR)try{oR({},"a",{value:1})}catch{oR=!1}var P9e=oR,FD,Ez;function D9e(){return Ez||(Ez=1,FD=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,n);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),FD}var BD,Sz;function L9e(){if(Sz)return BD;Sz=1;var t=typeof Symbol<"u"&&Symbol,e=D9e();return BD=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},BD}var jD,Tz;function hne(){return Tz||(Tz=1,jD=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),jD}var $D,wz;function fne(){if(wz)return $D;wz=1;var t=one;return $D=t.getPrototypeOf||null,$D}var U9e="Function.prototype.bind called on incompatible ",F9e=Object.prototype.toString,B9e=Math.max,j9e="[object Function]",xz=function(e,n){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var s=0;s<n.length;s+=1)r[s+e.length]=n[s];return r},$9e=function(e,n){for(var r=[],i=n,s=0;i<e.length;i+=1,s+=1)r[s]=e[i];return r},H9e=function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=e);return n},V9e=function(e){var n=this;if(typeof n!="function"||F9e.apply(n)!==j9e)throw new TypeError(U9e+n);for(var r=$9e(arguments,1),i,s=function(){if(this instanceof i){var u=n.apply(this,xz(r,arguments));return Object(u)===u?u:this}return n.apply(e,xz(r,arguments))},o=B9e(0,n.length-r.length),a=[],c=0;c<o;c++)a[c]="$"+c;if(i=Function("binder","return function ("+H9e(a,",")+"){ return binder.apply(this,arguments); }")(s),n.prototype){var l=function(){};l.prototype=n.prototype,i.prototype=new l,l.prototype=null}return i},z9e=V9e,xS=Function.prototype.bind||z9e,Rj=Function.prototype.call,Aj=Function.prototype.apply,G9e=typeof Reflect<"u"&&Reflect&&Reflect.apply,W9e=xS,q9e=Aj,K9e=Rj,Y9e=G9e,pne=Y9e||W9e.call(K9e,q9e),X9e=xS,J9e=wS(),Q9e=Rj,Z9e=pne,Mj=function(e){if(e.length<1||typeof e[0]!="function")throw new J9e("a function is required");return Z9e(X9e,Q9e,e)},HD,Cz;function e7e(){return Cz||(Cz=1,HD=Object.getOwnPropertyDescriptor),HD}var VD,Rz;function t7e(){if(Rz)return VD;Rz=1;var t=e7e();if(t)try{t([],"length")}catch{t=null}return VD=t,VD}var zD,Az;function n7e(){if(Az)return zD;Az=1;var t=Mj,e=t7e(),n;try{n=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!n&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return zD=r&&typeof r.get=="function"?t([r.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,zD}var GD,Mz;function mne(){if(Mz)return GD;Mz=1;var t=hne(),e=fne(),n=n7e();return GD=t?function(i){return t(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:n?function(i){return n(i)}:null,GD}var r7e=Function.prototype.call,i7e=Object.prototype.hasOwnProperty,s7e=xS,Ij=s7e.call(r7e,i7e),hi,o7e=one,a7e=ane,c7e=cne,l7e=lne,u7e=une,nS=Cj,yE=wS(),d7e=dne,h7e=T9e,f7e=w9e,p7e=x9e,m7e=C9e,g7e=R9e,v7e=A9e,_7e=O9e,gne=Function,WD=function(t){try{return gne('"use strict"; return ('+t+").constructor;")()}catch{}},vw=N9e,y7e=P9e,qD=function(){throw new yE},b7e=vw?function(){try{return arguments.callee,qD}catch{try{return vw(arguments,"callee").get}catch{return qD}}}():qD,wb=L9e()(),Za=mne(),E7e=fne(),S7e=hne(),vne=Aj,Ux=Rj,Fb={},T7e=typeof Uint8Array>"u"||!Za?hi:Za(Uint8Array),z0={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?hi:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?hi:ArrayBuffer,"%ArrayIteratorPrototype%":wb&&Za?Za([][Symbol.iterator]()):hi,"%AsyncFromSyncIteratorPrototype%":hi,"%AsyncFunction%":Fb,"%AsyncGenerator%":Fb,"%AsyncGeneratorFunction%":Fb,"%AsyncIteratorPrototype%":Fb,"%Atomics%":typeof Atomics>"u"?hi:Atomics,"%BigInt%":typeof BigInt>"u"?hi:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?hi:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?hi:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?hi:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":a7e,"%eval%":eval,"%EvalError%":c7e,"%Float32Array%":typeof Float32Array>"u"?hi:Float32Array,"%Float64Array%":typeof Float64Array>"u"?hi:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?hi:FinalizationRegistry,"%Function%":gne,"%GeneratorFunction%":Fb,"%Int8Array%":typeof Int8Array>"u"?hi:Int8Array,"%Int16Array%":typeof Int16Array>"u"?hi:Int16Array,"%Int32Array%":typeof Int32Array>"u"?hi:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":wb&&Za?Za(Za([][Symbol.iterator]())):hi,"%JSON%":typeof JSON=="object"?JSON:hi,"%Map%":typeof Map>"u"?hi:Map,"%MapIteratorPrototype%":typeof Map>"u"||!wb||!Za?hi:Za(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":o7e,"%Object.getOwnPropertyDescriptor%":vw,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?hi:Promise,"%Proxy%":typeof Proxy>"u"?hi:Proxy,"%RangeError%":l7e,"%ReferenceError%":u7e,"%Reflect%":typeof Reflect>"u"?hi:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?hi:Set,"%SetIteratorPrototype%":typeof Set>"u"||!wb||!Za?hi:Za(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?hi:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":wb&&Za?Za(""[Symbol.iterator]()):hi,"%Symbol%":wb?Symbol:hi,"%SyntaxError%":nS,"%ThrowTypeError%":b7e,"%TypedArray%":T7e,"%TypeError%":yE,"%Uint8Array%":typeof Uint8Array>"u"?hi:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?hi:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?hi:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?hi:Uint32Array,"%URIError%":d7e,"%WeakMap%":typeof WeakMap>"u"?hi:WeakMap,"%WeakRef%":typeof WeakRef>"u"?hi:WeakRef,"%WeakSet%":typeof WeakSet>"u"?hi:WeakSet,"%Function.prototype.call%":Ux,"%Function.prototype.apply%":vne,"%Object.defineProperty%":y7e,"%Object.getPrototypeOf%":E7e,"%Math.abs%":h7e,"%Math.floor%":f7e,"%Math.max%":p7e,"%Math.min%":m7e,"%Math.pow%":g7e,"%Math.round%":v7e,"%Math.sign%":_7e,"%Reflect.getPrototypeOf%":S7e};if(Za)try{null.error}catch(t){var w7e=Za(Za(t));z0["%Error.prototype%"]=w7e}var x7e=function t(e){var n;if(e==="%AsyncFunction%")n=WD("async function () {}");else if(e==="%GeneratorFunction%")n=WD("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=WD("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=t("%AsyncGenerator%");i&&Za&&(n=Za(i.prototype))}return z0[e]=n,n},Iz={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Fx=xS,jA=Ij,C7e=Fx.call(Ux,Array.prototype.concat),R7e=Fx.call(vne,Array.prototype.splice),Oz=Fx.call(Ux,String.prototype.replace),$A=Fx.call(Ux,String.prototype.slice),A7e=Fx.call(Ux,RegExp.prototype.exec),M7e=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,I7e=/\\(\\)?/g,O7e=function(e){var n=$A(e,0,1),r=$A(e,-1);if(n==="%"&&r!=="%")throw new nS("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new nS("invalid intrinsic syntax, expected opening `%`");var i=[];return Oz(e,M7e,function(s,o,a,c){i[i.length]=a?Oz(c,I7e,"$1"):o||s}),i},k7e=function(e,n){var r=e,i;if(jA(Iz,r)&&(i=Iz[r],r="%"+i[0]+"%"),jA(z0,r)){var s=z0[r];if(s===Fb&&(s=x7e(r)),typeof s>"u"&&!n)throw new yE("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:s}}throw new nS("intrinsic "+e+" does not exist!")},N7e=function(e,n){if(typeof e!="string"||e.length===0)throw new yE("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new yE('"allowMissing" argument must be a boolean');if(A7e(/^%?[^%]*%?$/,e)===null)throw new nS("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=O7e(e),i=r.length>0?r[0]:"",s=k7e("%"+i+"%",n),o=s.name,a=s.value,c=!1,l=s.alias;l&&(i=l[0],R7e(r,C7e([0,1],l)));for(var u=1,d=!0;u<r.length;u+=1){var h=r[u],p=$A(h,0,1),f=$A(h,-1);if((p==='"'||p==="'"||p==="`"||f==='"'||f==="'"||f==="`")&&p!==f)throw new nS("property names with quotes must have matching quotes");if((h==="constructor"||!d)&&(c=!0),i+="."+h,o="%"+i+"%",jA(z0,o))a=z0[o];else if(a!=null){if(!(h in a)){if(!n)throw new yE("base intrinsic for "+e+" exists, but the property is not available.");return}if(vw&&u+1>=r.length){var g=vw(a,h);d=!!g,d&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[h]}else d=jA(a,h),a=a[h];d&&!c&&(z0[o]=a)}}return a},_ne=N7e,yne=Mj,P7e=yne([_ne("%String.prototype.indexOf%")]),Bx=function(e,n){var r=_ne(e,!!n);return typeof r=="function"&&P7e(e,".prototype.")>-1?yne([r]):r},D7e=xN(),L7e=Bx,AF=L7e("Object.prototype.toString"),CN=function(e){return D7e&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:AF(e)==="[object Arguments]"},bne=function(e){return CN(e)?!0:e!==null&&typeof e=="object"&&"length"in e&&typeof e.length=="number"&&e.length>=0&&AF(e)!=="[object Array]"&&"callee"in e&&AF(e.callee)==="[object Function]"},U7e=function(){return CN(arguments)}();CN.isLegacyArguments=bne;var F7e=U7e?CN:bne,B7e=Object.getOwnPropertyDescriptor,aR=B7e;if(aR)try{aR([],"length")}catch{aR=null}var j7e=aR,kz=Bx,$7e=xN(),H7e=Ij,V7e=j7e,MF;if($7e){var z7e=kz("RegExp.prototype.exec"),Nz={},KD=function(){throw Nz},Pz={toString:KD,valueOf:KD};typeof Symbol.toPrimitive=="symbol"&&(Pz[Symbol.toPrimitive]=KD),MF=function(e){if(!e||typeof e!="object")return!1;var n=V7e(e,"lastIndex"),r=n&&H7e(n,"value");if(!r)return!1;try{z7e(e,Pz)}catch(i){return i===Nz}}}else{var G7e=kz("Object.prototype.toString"),W7e="[object RegExp]";MF=function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:G7e(e)===W7e}}var q7e=MF,K7e=Bx,Y7e=q7e,X7e=K7e("RegExp.prototype.exec"),J7e=wS(),Q7e=function(e){if(!Y7e(e))throw new J7e("`regex` must be a RegExp");return function(r){return X7e(e,r)!==null}},Ene=Bx,Z7e=Q7e,eKe=Z7e(/^\s*(?:function)?\*/),Sne=xN(),YD=mne(),tKe=Ene("Object.prototype.toString"),nKe=Ene("Function.prototype.toString"),rKe=function(){if(!Sne)return!1;try{return Function("return function*() {}")()}catch{}},XD,iKe=function(e){if(typeof e!="function")return!1;if(eKe(nKe(e)))return!0;if(!Sne){var n=tKe(e);return n==="[object GeneratorFunction]"}if(!YD)return!1;if(typeof XD>"u"){var r=rKe();XD=r?YD(r):!1}return YD(e)===XD},Tne=Function.prototype.toString,Qb=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,IF,cR;if(typeof Qb=="function"&&typeof Object.defineProperty=="function")try{IF=Object.defineProperty({},"length",{get:function(){throw cR}}),cR={},Qb(function(){throw 42},null,IF)}catch(t){t!==cR&&(Qb=null)}else Qb=null;var sKe=/^\s*class\b/,OF=function(e){try{var n=Tne.call(e);return sKe.test(n)}catch{return!1}},JD=function(e){try{return OF(e)?!1:(Tne.call(e),!0)}catch{return!1}},lR=Object.prototype.toString,oKe="[object Object]",aKe="[object Function]",cKe="[object GeneratorFunction]",lKe="[object HTMLAllCollection]",uKe="[object HTML document.all class]",dKe="[object HTMLCollection]",hKe=typeof Symbol=="function"&&!!Symbol.toStringTag,fKe=!(0 in[,]),kF=function(){return!1};if(typeof document=="object"){var pKe=document.all;lR.call(pKe)===lR.call(document.all)&&(kF=function(e){if((fKe||!e)&&(typeof e>"u"||typeof e=="object"))try{var n=lR.call(e);return(n===lKe||n===uKe||n===dKe||n===oKe)&&e("")==null}catch{}return!1})}var mKe=Qb?function(e){if(kF(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{Qb(e,null,IF)}catch(n){if(n!==cR)return!1}return!OF(e)&&JD(e)}:function(e){if(kF(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(hKe)return JD(e);if(OF(e))return!1;var n=lR.call(e);return n!==aKe&&n!==cKe&&!/^\[object HTML/.test(n)?!1:JD(e)},gKe=mKe,vKe=Object.prototype.toString,wne=Object.prototype.hasOwnProperty,_Ke=function(e,n,r){for(var i=0,s=e.length;i<s;i++)wne.call(e,i)&&(r==null?n(e[i],i,e):n.call(r,e[i],i,e))},yKe=function(e,n,r){for(var i=0,s=e.length;i<s;i++)r==null?n(e.charAt(i),i,e):n.call(r,e.charAt(i),i,e)},bKe=function(e,n,r){for(var i in e)wne.call(e,i)&&(r==null?n(e[i],i,e):n.call(r,e[i],i,e))},EKe=function(e,n,r){if(!gKe(n))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=r),vKe.call(e)==="[object Array]"?_Ke(e,n,i):typeof e=="string"?yKe(e,n,i):bKe(e,n,i)},SKe=EKe,TKe=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],QD=TKe,wKe=typeof globalThis>"u"?Da:globalThis,xKe=function(){for(var e=[],n=0;n<QD.length;n++)typeof wKe[QD[n]]=="function"&&(e[e.length]=QD[n]);return e},xne={exports:{}},Dz=typeof Symbol<"u"&&Symbol,CKe=sne,RKe=function(){return typeof Dz!="function"||typeof Symbol!="function"||typeof Dz("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:CKe()},ZD={__proto__:null,foo:{}},AKe=Object,MKe=function(){return{__proto__:ZD}.foo===ZD.foo&&!(ZD instanceof AKe)},fi,IKe=ane,OKe=cne,kKe=lne,NKe=une,rS=Cj,bE=wS(),PKe=dne,Cne=Function,eL=function(t){try{return Cne('"use strict"; return ('+t+").constructor;")()}catch{}},G0=Object.getOwnPropertyDescriptor;if(G0)try{G0({},"")}catch{G0=null}var tL=function(){throw new bE},DKe=G0?function(){try{return arguments.callee,tL}catch{try{return G0(arguments,"callee").get}catch{return tL}}}():tL,xb=RKe(),LKe=MKe(),ec=Object.getPrototypeOf||(LKe?function(t){return t.__proto__}:null),Bb={},UKe=typeof Uint8Array>"u"||!ec?fi:ec(Uint8Array),W0={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?fi:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?fi:ArrayBuffer,"%ArrayIteratorPrototype%":xb&&ec?ec([][Symbol.iterator]()):fi,"%AsyncFromSyncIteratorPrototype%":fi,"%AsyncFunction%":Bb,"%AsyncGenerator%":Bb,"%AsyncGeneratorFunction%":Bb,"%AsyncIteratorPrototype%":Bb,"%Atomics%":typeof Atomics>"u"?fi:Atomics,"%BigInt%":typeof BigInt>"u"?fi:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?fi:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?fi:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?fi:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":IKe,"%eval%":eval,"%EvalError%":OKe,"%Float32Array%":typeof Float32Array>"u"?fi:Float32Array,"%Float64Array%":typeof Float64Array>"u"?fi:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?fi:FinalizationRegistry,"%Function%":Cne,"%GeneratorFunction%":Bb,"%Int8Array%":typeof Int8Array>"u"?fi:Int8Array,"%Int16Array%":typeof Int16Array>"u"?fi:Int16Array,"%Int32Array%":typeof Int32Array>"u"?fi:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":xb&&ec?ec(ec([][Symbol.iterator]())):fi,"%JSON%":typeof JSON=="object"?JSON:fi,"%Map%":typeof Map>"u"?fi:Map,"%MapIteratorPrototype%":typeof Map>"u"||!xb||!ec?fi:ec(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?fi:Promise,"%Proxy%":typeof Proxy>"u"?fi:Proxy,"%RangeError%":kKe,"%ReferenceError%":NKe,"%Reflect%":typeof Reflect>"u"?fi:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?fi:Set,"%SetIteratorPrototype%":typeof Set>"u"||!xb||!ec?fi:ec(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?fi:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":xb&&ec?ec(""[Symbol.iterator]()):fi,"%Symbol%":xb?Symbol:fi,"%SyntaxError%":rS,"%ThrowTypeError%":DKe,"%TypedArray%":UKe,"%TypeError%":bE,"%Uint8Array%":typeof Uint8Array>"u"?fi:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?fi:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?fi:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?fi:Uint32Array,"%URIError%":PKe,"%WeakMap%":typeof WeakMap>"u"?fi:WeakMap,"%WeakRef%":typeof WeakRef>"u"?fi:WeakRef,"%WeakSet%":typeof WeakSet>"u"?fi:WeakSet};if(ec)try{null.error}catch(t){var FKe=ec(ec(t));W0["%Error.prototype%"]=FKe}var BKe=function t(e){var n;if(e==="%AsyncFunction%")n=eL("async function () {}");else if(e==="%GeneratorFunction%")n=eL("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=eL("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=t("%AsyncGenerator%");i&&ec&&(n=ec(i.prototype))}return W0[e]=n,n},Lz={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},jx=xS,HA=Ij,jKe=jx.call(Function.call,Array.prototype.concat),$Ke=jx.call(Function.apply,Array.prototype.splice),Uz=jx.call(Function.call,String.prototype.replace),VA=jx.call(Function.call,String.prototype.slice),HKe=jx.call(Function.call,RegExp.prototype.exec),VKe=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,zKe=/\\(\\)?/g,GKe=function(e){var n=VA(e,0,1),r=VA(e,-1);if(n==="%"&&r!=="%")throw new rS("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new rS("invalid intrinsic syntax, expected opening `%`");var i=[];return Uz(e,VKe,function(s,o,a,c){i[i.length]=a?Uz(c,zKe,"$1"):o||s}),i},WKe=function(e,n){var r=e,i;if(HA(Lz,r)&&(i=Lz[r],r="%"+i[0]+"%"),HA(W0,r)){var s=W0[r];if(s===Bb&&(s=BKe(r)),typeof s>"u"&&!n)throw new bE("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:s}}throw new rS("intrinsic "+e+" does not exist!")},Oj=function(e,n){if(typeof e!="string"||e.length===0)throw new bE("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new bE('"allowMissing" argument must be a boolean');if(HKe(/^%?[^%]*%?$/,e)===null)throw new rS("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=GKe(e),i=r.length>0?r[0]:"",s=WKe("%"+i+"%",n),o=s.name,a=s.value,c=!1,l=s.alias;l&&(i=l[0],$Ke(r,jKe([0,1],l)));for(var u=1,d=!0;u<r.length;u+=1){var h=r[u],p=VA(h,0,1),f=VA(h,-1);if((p==='"'||p==="'"||p==="`"||f==='"'||f==="'"||f==="`")&&p!==f)throw new rS("property names with quotes must have matching quotes");if((h==="constructor"||!d)&&(c=!0),i+="."+h,o="%"+i+"%",HA(W0,o))a=W0[o];else if(a!=null){if(!(h in a)){if(!n)throw new bE("base intrinsic for "+e+" exists, but the property is not available.");return}if(G0&&u+1>=r.length){var g=G0(a,h);d=!!g,d&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[h]}else d=HA(a,h),a=a[h];d&&!c&&(W0[o]=a)}}return a},qKe=Oj,uR=qKe("%Object.defineProperty%",!0)||!1;if(uR)try{uR({},"a",{value:1})}catch{uR=!1}var kj=uR,KKe=Oj,dR=KKe("%Object.getOwnPropertyDescriptor%",!0);if(dR)try{dR([],"length")}catch{dR=null}var Rne=dR,Fz=kj,YKe=Cj,Cb=wS(),Bz=Rne,XKe=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new Cb("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new Cb("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Cb("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Cb("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Cb("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Cb("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,c=!!Bz&&Bz(e,n);if(Fz)Fz(e,n,{configurable:o===null&&c?c.configurable:!o,enumerable:i===null&&c?c.enumerable:!i,value:r,writable:s===null&&c?c.writable:!s});else if(a||!i&&!s&&!o)e[n]=r;else throw new YKe("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},NF=kj,Ane=function(){return!!NF};Ane.hasArrayLengthDefineBug=function(){if(!NF)return null;try{return NF([],"length",{value:1}).length!==1}catch{return!0}};var JKe=Ane,QKe=Oj,jz=XKe,ZKe=JKe(),$z=Rne,Hz=wS(),eYe=QKe("%Math.floor%"),tYe=function(e,n){if(typeof e!="function")throw new Hz("`fn` is not a function");if(typeof n!="number"||n<0||n>4294967295||eYe(n)!==n)throw new Hz("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],i=!0,s=!0;if("length"in e&&$z){var o=$z(e,"length");o&&!o.configurable&&(i=!1),o&&!o.writable&&(s=!1)}return(i||s||!r)&&(ZKe?jz(e,"length",n,!0,!0):jz(e,"length",n)),e},nYe=xS,rYe=Aj,iYe=pne,sYe=function(){return iYe(nYe,rYe,arguments)};(function(t){var e=tYe,n=kj,r=Mj,i=sYe;t.exports=function(o){var a=r(arguments),c=o.length-(arguments.length-1);return e(a,1+(c>0?c:0),!0)},n?n(t.exports,"apply",{value:i}):t.exports.apply=i})(xne);var oYe=xne.exports,aYe=Object.getOwnPropertyDescriptor,hR=aYe;if(hR)try{hR([],"length")}catch{hR=null}var cYe=hR,zA=SKe,lYe=xKe,Vz=oYe,Nj=Bx,fR=cYe,uYe=Nj("Object.prototype.toString"),Mne=xN(),zz=typeof globalThis>"u"?Da:globalThis,PF=lYe(),Pj=Nj("String.prototype.slice"),nL=Object.getPrototypeOf,dYe=Nj("Array.prototype.indexOf",!0)||function(e,n){for(var r=0;r<e.length;r+=1)if(e[r]===n)return r;return-1},GA={__proto__:null};Mne&&fR&&nL?zA(PF,function(t){var e=new zz[t];if(Symbol.toStringTag in e){var n=nL(e),r=fR(n,Symbol.toStringTag);if(!r){var i=nL(n);r=fR(i,Symbol.toStringTag)}GA["$"+t]=Vz(r.get)}}):zA(PF,function(t){var e=new zz[t],n=e.slice||e.set;n&&(GA["$"+t]=Vz(n))});var hYe=function(e){var n=!1;return zA(GA,function(r,i){if(!n)try{"$"+r(e)===i&&(n=Pj(i,1))}catch{}}),n},fYe=function(e){var n=!1;return zA(GA,function(r,i){if(!n)try{r(e),n=Pj(i,1)}catch{}}),n},Ine=function(e){if(!e||typeof e!="object")return!1;if(!Mne){var n=Pj(uYe(e),8,-1);return dYe(PF,n)>-1?n:n!=="Object"?!1:fYe(e)}return fR?hYe(e):null},pYe=Ine,mYe=function(e){return!!pYe(e)};(function(t){var e=F7e,n=iKe,r=Ine,i=mYe;function s(He){return He.call.bind(He)}var o=typeof BigInt<"u",a=typeof Symbol<"u",c=s(Object.prototype.toString),l=s(Number.prototype.valueOf),u=s(String.prototype.valueOf),d=s(Boolean.prototype.valueOf);if(o)var h=s(BigInt.prototype.valueOf);if(a)var p=s(Symbol.prototype.valueOf);function f(He,$t){if(typeof He!="object")return!1;try{return $t(He),!0}catch{return!1}}t.isArgumentsObject=e,t.isGeneratorFunction=n,t.isTypedArray=i;function g(He){return typeof Promise<"u"&&He instanceof Promise||He!==null&&typeof He=="object"&&typeof He.then=="function"&&typeof He.catch=="function"}t.isPromise=g;function y(He){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(He):i(He)||_e(He)}t.isArrayBufferView=y;function E(He){return r(He)==="Uint8Array"}t.isUint8Array=E;function w(He){return r(He)==="Uint8ClampedArray"}t.isUint8ClampedArray=w;function R(He){return r(He)==="Uint16Array"}t.isUint16Array=R;function A(He){return r(He)==="Uint32Array"}t.isUint32Array=A;function k(He){return r(He)==="Int8Array"}t.isInt8Array=k;function I(He){return r(He)==="Int16Array"}t.isInt16Array=I;function N(He){return r(He)==="Int32Array"}t.isInt32Array=N;function U(He){return r(He)==="Float32Array"}t.isFloat32Array=U;function F(He){return r(He)==="Float64Array"}t.isFloat64Array=F;function $(He){return r(He)==="BigInt64Array"}t.isBigInt64Array=$;function q(He){return r(He)==="BigUint64Array"}t.isBigUint64Array=q;function K(He){return c(He)==="[object Map]"}K.working=typeof Map<"u"&&K(new Map);function W(He){return typeof Map>"u"?!1:K.working?K(He):He instanceof Map}t.isMap=W;function X(He){return c(He)==="[object Set]"}X.working=typeof Set<"u"&&X(new Set);function ne(He){return typeof Set>"u"?!1:X.working?X(He):He instanceof Set}t.isSet=ne;function Z(He){return c(He)==="[object WeakMap]"}Z.working=typeof WeakMap<"u"&&Z(new WeakMap);function ie(He){return typeof WeakMap>"u"?!1:Z.working?Z(He):He instanceof WeakMap}t.isWeakMap=ie;function G(He){return c(He)==="[object WeakSet]"}G.working=typeof WeakSet<"u"&&G(new WeakSet);function Q(He){return G(He)}t.isWeakSet=Q;function se(He){return c(He)==="[object ArrayBuffer]"}se.working=typeof ArrayBuffer<"u"&&se(new ArrayBuffer);function ve(He){return typeof ArrayBuffer>"u"?!1:se.working?se(He):He instanceof ArrayBuffer}t.isArrayBuffer=ve;function Oe(He){return c(He)==="[object DataView]"}Oe.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Oe(new DataView(new ArrayBuffer(1),0,1));function _e(He){return typeof DataView>"u"?!1:Oe.working?Oe(He):He instanceof DataView}t.isDataView=_e;var le=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function xe(He){return c(He)==="[object SharedArrayBuffer]"}function Ee(He){return typeof le>"u"?!1:(typeof xe.working>"u"&&(xe.working=xe(new le)),xe.working?xe(He):He instanceof le)}t.isSharedArrayBuffer=Ee;function Se(He){return c(He)==="[object AsyncFunction]"}t.isAsyncFunction=Se;function Ie(He){return c(He)==="[object Map Iterator]"}t.isMapIterator=Ie;function Ze(He){return c(He)==="[object Set Iterator]"}t.isSetIterator=Ze;function _t(He){return c(He)==="[object Generator]"}t.isGeneratorObject=_t;function fe(He){return c(He)==="[object WebAssembly.Module]"}t.isWebAssemblyCompiledModule=fe;function ge(He){return f(He,l)}t.isNumberObject=ge;function rt(He){return f(He,u)}t.isStringObject=rt;function Re(He){return f(He,d)}t.isBooleanObject=Re;function St(He){return o&&f(He,h)}t.isBigIntObject=St;function Ge(He){return a&&f(He,p)}t.isSymbolObject=Ge;function kt(He){return ge(He)||rt(He)||Re(He)||St(He)||Ge(He)}t.isBoxedPrimitive=kt;function Bt(He){return typeof Uint8Array<"u"&&(ve(He)||Ee(He))}t.isAnyArrayBuffer=Bt,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(He){Object.defineProperty(t,He,{enumerable:!1,value:function(){throw new Error(He+" is not supported in userland")}})})})(ine);var gYe=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"},DF={exports:{}};typeof Object.create=="function"?DF.exports=function(e,n){n&&(e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:DF.exports=function(e,n){if(n){e.super_=n;var r=function(){};r.prototype=n.prototype,e.prototype=new r,e.prototype.constructor=e}};var CS=DF.exports;(function(t){var e={},n=Object.getOwnPropertyDescriptors||function(le){for(var xe=Object.keys(le),Ee={},Se=0;Se<xe.length;Se++)Ee[xe[Se]]=Object.getOwnPropertyDescriptor(le,xe[Se]);return Ee},r=/%[sdj%]/g;t.format=function(_e){if(!I(_e)){for(var le=[],xe=0;xe<arguments.length;xe++)le.push(a(arguments[xe]));return le.join(" ")}for(var xe=1,Ee=arguments,Se=Ee.length,Ie=String(_e).replace(r,function(_t){if(_t==="%%")return"%";if(xe>=Se)return _t;switch(_t){case"%s":return String(Ee[xe++]);case"%d":return Number(Ee[xe++]);case"%j":try{return JSON.stringify(Ee[xe++])}catch{return"[Circular]"}default:return _t}}),Ze=Ee[xe];xe<Se;Ze=Ee[++xe])R(Ze)||!$(Ze)?Ie+=" "+Ze:Ie+=" "+a(Ze);return Ie},t.deprecate=function(_e,le){if(typeof Bn<"u"&&Bn.noDeprecation===!0)return _e;if(typeof Bn>"u")return function(){return t.deprecate(_e,le).apply(this,arguments)};var xe=!1;function Ee(){if(!xe){if(Bn.throwDeprecation)throw new Error(le);Bn.traceDeprecation?console.trace(le):console.error(le),xe=!0}return _e.apply(this,arguments)}return Ee};var i={},s=/^$/;if(e.NODE_DEBUG){var o=e.NODE_DEBUG;o=o.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),s=new RegExp("^"+o+"$","i")}t.debuglog=function(_e){if(_e=_e.toUpperCase(),!i[_e])if(s.test(_e)){var le=Bn.pid;i[_e]=function(){var xe=t.format.apply(t,arguments);console.error("%s %d: %s",_e,le,xe)}}else i[_e]=function(){};return i[_e]};function a(_e,le){var xe={seen:[],stylize:l};return arguments.length>=3&&(xe.depth=arguments[2]),arguments.length>=4&&(xe.colors=arguments[3]),w(le)?xe.showHidden=le:le&&t._extend(xe,le),U(xe.showHidden)&&(xe.showHidden=!1),U(xe.depth)&&(xe.depth=2),U(xe.colors)&&(xe.colors=!1),U(xe.customInspect)&&(xe.customInspect=!0),xe.colors&&(xe.stylize=c),d(xe,_e,xe.depth)}t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function c(_e,le){var xe=a.styles[le];return xe?"\x1B["+a.colors[xe][0]+"m"+_e+"\x1B["+a.colors[xe][1]+"m":_e}function l(_e,le){return _e}function u(_e){var le={};return _e.forEach(function(xe,Ee){le[xe]=!0}),le}function d(_e,le,xe){if(_e.customInspect&&le&&W(le.inspect)&&le.inspect!==t.inspect&&!(le.constructor&&le.constructor.prototype===le)){var Ee=le.inspect(xe,_e);return I(Ee)||(Ee=d(_e,Ee,xe)),Ee}var Se=h(_e,le);if(Se)return Se;var Ie=Object.keys(le),Ze=u(Ie);if(_e.showHidden&&(Ie=Object.getOwnPropertyNames(le)),K(le)&&(Ie.indexOf("message")>=0||Ie.indexOf("description")>=0))return p(le);if(Ie.length===0){if(W(le)){var _t=le.name?": "+le.name:"";return _e.stylize("[Function"+_t+"]","special")}if(F(le))return _e.stylize(RegExp.prototype.toString.call(le),"regexp");if(q(le))return _e.stylize(Date.prototype.toString.call(le),"date");if(K(le))return p(le)}var fe="",ge=!1,rt=["{","}"];if(E(le)&&(ge=!0,rt=["[","]"]),W(le)){var Re=le.name?": "+le.name:"";fe=" [Function"+Re+"]"}if(F(le)&&(fe=" "+RegExp.prototype.toString.call(le)),q(le)&&(fe=" "+Date.prototype.toUTCString.call(le)),K(le)&&(fe=" "+p(le)),Ie.length===0&&(!ge||le.length==0))return rt[0]+fe+rt[1];if(xe<0)return F(le)?_e.stylize(RegExp.prototype.toString.call(le),"regexp"):_e.stylize("[Object]","special");_e.seen.push(le);var St;return ge?St=f(_e,le,xe,Ze,Ie):St=Ie.map(function(Ge){return g(_e,le,xe,Ze,Ge,ge)}),_e.seen.pop(),y(St,fe,rt)}function h(_e,le){if(U(le))return _e.stylize("undefined","undefined");if(I(le)){var xe="'"+JSON.stringify(le).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return _e.stylize(xe,"string")}if(k(le))return _e.stylize(""+le,"number");if(w(le))return _e.stylize(""+le,"boolean");if(R(le))return _e.stylize("null","null")}function p(_e){return"["+Error.prototype.toString.call(_e)+"]"}function f(_e,le,xe,Ee,Se){for(var Ie=[],Ze=0,_t=le.length;Ze<_t;++Ze)Q(le,String(Ze))?Ie.push(g(_e,le,xe,Ee,String(Ze),!0)):Ie.push("");return Se.forEach(function(fe){fe.match(/^\d+$/)||Ie.push(g(_e,le,xe,Ee,fe,!0))}),Ie}function g(_e,le,xe,Ee,Se,Ie){var Ze,_t,fe;if(fe=Object.getOwnPropertyDescriptor(le,Se)||{value:le[Se]},fe.get?fe.set?_t=_e.stylize("[Getter/Setter]","special"):_t=_e.stylize("[Getter]","special"):fe.set&&(_t=_e.stylize("[Setter]","special")),Q(Ee,Se)||(Ze="["+Se+"]"),_t||(_e.seen.indexOf(fe.value)<0?(R(xe)?_t=d(_e,fe.value,null):_t=d(_e,fe.value,xe-1),_t.indexOf(`
`)>-1&&(Ie?_t=_t.split(`
`).map(function(ge){return"  "+ge}).join(`
`).slice(2):_t=`
`+_t.split(`
`).map(function(ge){return"   "+ge}).join(`
`))):_t=_e.stylize("[Circular]","special")),U(Ze)){if(Ie&&Se.match(/^\d+$/))return _t;Ze=JSON.stringify(""+Se),Ze.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Ze=Ze.slice(1,-1),Ze=_e.stylize(Ze,"name")):(Ze=Ze.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Ze=_e.stylize(Ze,"string"))}return Ze+": "+_t}function y(_e,le,xe){var Ee=_e.reduce(function(Se,Ie){return Ie.indexOf(`
`)>=0,Se+Ie.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Ee>60?xe[0]+(le===""?"":le+`
 `)+" "+_e.join(`,
  `)+" "+xe[1]:xe[0]+le+" "+_e.join(", ")+" "+xe[1]}t.types=ine;function E(_e){return Array.isArray(_e)}t.isArray=E;function w(_e){return typeof _e=="boolean"}t.isBoolean=w;function R(_e){return _e===null}t.isNull=R;function A(_e){return _e==null}t.isNullOrUndefined=A;function k(_e){return typeof _e=="number"}t.isNumber=k;function I(_e){return typeof _e=="string"}t.isString=I;function N(_e){return typeof _e=="symbol"}t.isSymbol=N;function U(_e){return _e===void 0}t.isUndefined=U;function F(_e){return $(_e)&&ne(_e)==="[object RegExp]"}t.isRegExp=F,t.types.isRegExp=F;function $(_e){return typeof _e=="object"&&_e!==null}t.isObject=$;function q(_e){return $(_e)&&ne(_e)==="[object Date]"}t.isDate=q,t.types.isDate=q;function K(_e){return $(_e)&&(ne(_e)==="[object Error]"||_e instanceof Error)}t.isError=K,t.types.isNativeError=K;function W(_e){return typeof _e=="function"}t.isFunction=W;function X(_e){return _e===null||typeof _e=="boolean"||typeof _e=="number"||typeof _e=="string"||typeof _e=="symbol"||typeof _e>"u"}t.isPrimitive=X,t.isBuffer=gYe;function ne(_e){return Object.prototype.toString.call(_e)}function Z(_e){return _e<10?"0"+_e.toString(10):_e.toString(10)}var ie=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function G(){var _e=new Date,le=[Z(_e.getHours()),Z(_e.getMinutes()),Z(_e.getSeconds())].join(":");return[_e.getDate(),ie[_e.getMonth()],le].join(" ")}t.log=function(){console.log("%s - %s",G(),t.format.apply(t,arguments))},t.inherits=CS,t._extend=function(_e,le){if(!le||!$(le))return _e;for(var xe=Object.keys(le),Ee=xe.length;Ee--;)_e[xe[Ee]]=le[xe[Ee]];return _e};function Q(_e,le){return Object.prototype.hasOwnProperty.call(_e,le)}var se=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;t.promisify=function(le){if(typeof le!="function")throw new TypeError('The "original" argument must be of type Function');if(se&&le[se]){var xe=le[se];if(typeof xe!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(xe,se,{value:xe,enumerable:!1,writable:!1,configurable:!0}),xe}function xe(){for(var Ee,Se,Ie=new Promise(function(fe,ge){Ee=fe,Se=ge}),Ze=[],_t=0;_t<arguments.length;_t++)Ze.push(arguments[_t]);Ze.push(function(fe,ge){fe?Se(fe):Ee(ge)});try{le.apply(this,Ze)}catch(fe){Se(fe)}return Ie}return Object.setPrototypeOf(xe,Object.getPrototypeOf(le)),se&&Object.defineProperty(xe,se,{value:xe,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(xe,n(le))},t.promisify.custom=se;function ve(_e,le){if(!_e){var xe=new Error("Promise was rejected with a falsy value");xe.reason=_e,_e=xe}return le(_e)}function Oe(_e){if(typeof _e!="function")throw new TypeError('The "original" argument must be of type Function');function le(){for(var xe=[],Ee=0;Ee<arguments.length;Ee++)xe.push(arguments[Ee]);var Se=xe.pop();if(typeof Se!="function")throw new TypeError("The last argument must be of type Function");var Ie=this,Ze=function(){return Se.apply(Ie,arguments)};_e.apply(this,xe).then(function(_t){Bn.nextTick(Ze.bind(null,null,_t))},function(_t){Bn.nextTick(ve.bind(null,_t,Ze))})}return Object.setPrototypeOf(le,Object.getPrototypeOf(_e)),Object.defineProperties(le,n(_e)),le}t.callbackify=Oe})(xj);var rL,Gz;function vYe(){if(Gz)return rL;Gz=1;function t(f,g){var y=Object.keys(f);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(f);g&&(E=E.filter(function(w){return Object.getOwnPropertyDescriptor(f,w).enumerable})),y.push.apply(y,E)}return y}function e(f){for(var g=1;g<arguments.length;g++){var y=arguments[g]!=null?arguments[g]:{};g%2?t(Object(y),!0).forEach(function(E){n(f,E,y[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(y)):t(Object(y)).forEach(function(E){Object.defineProperty(f,E,Object.getOwnPropertyDescriptor(y,E))})}return f}function n(f,g,y){return g=o(g),g in f?Object.defineProperty(f,g,{value:y,enumerable:!0,configurable:!0,writable:!0}):f[g]=y,f}function r(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}function i(f,g){for(var y=0;y<g.length;y++){var E=g[y];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(f,o(E.key),E)}}function s(f,g,y){return g&&i(f.prototype,g),Object.defineProperty(f,"prototype",{writable:!1}),f}function o(f){var g=a(f,"string");return typeof g=="symbol"?g:String(g)}function a(f,g){if(typeof f!="object"||f===null)return f;var y=f[Symbol.toPrimitive];if(y!==void 0){var E=y.call(f,g||"default");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(f)}var c=Lx,l=c.Buffer,u=xj,d=u.inspect,h=d&&d.custom||"inspect";function p(f,g,y){l.prototype.copy.call(f,g,y)}return rL=function(){function f(){r(this,f),this.head=null,this.tail=null,this.length=0}return s(f,[{key:"push",value:function(y){var E={data:y,next:null};this.length>0?this.tail.next=E:this.head=E,this.tail=E,++this.length}},{key:"unshift",value:function(y){var E={data:y,next:this.head};this.length===0&&(this.tail=E),this.head=E,++this.length}},{key:"shift",value:function(){if(this.length!==0){var y=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,y}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(y){if(this.length===0)return"";for(var E=this.head,w=""+E.data;E=E.next;)w+=y+E.data;return w}},{key:"concat",value:function(y){if(this.length===0)return l.alloc(0);for(var E=l.allocUnsafe(y>>>0),w=this.head,R=0;w;)p(w.data,E,R),R+=w.data.length,w=w.next;return E}},{key:"consume",value:function(y,E){var w;return y<this.head.data.length?(w=this.head.data.slice(0,y),this.head.data=this.head.data.slice(y)):y===this.head.data.length?w=this.shift():w=E?this._getString(y):this._getBuffer(y),w}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(y){var E=this.head,w=1,R=E.data;for(y-=R.length;E=E.next;){var A=E.data,k=y>A.length?A.length:y;if(k===A.length?R+=A:R+=A.slice(0,y),y-=k,y===0){k===A.length?(++w,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=A.slice(k));break}++w}return this.length-=w,R}},{key:"_getBuffer",value:function(y){var E=l.allocUnsafe(y),w=this.head,R=1;for(w.data.copy(E),y-=w.data.length;w=w.next;){var A=w.data,k=y>A.length?A.length:y;if(A.copy(E,E.length-y,0,k),y-=k,y===0){k===A.length?(++R,w.next?this.head=w.next:this.head=this.tail=null):(this.head=w,w.data=A.slice(k));break}++R}return this.length-=R,E}},{key:h,value:function(y,E){return d(this,e(e({},E),{},{depth:0,customInspect:!1}))}}]),f}(),rL}function _Ye(t,e){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Bn.nextTick(LF,this,t)):Bn.nextTick(LF,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?n._writableState?n._writableState.errorEmitted?Bn.nextTick(pR,n):(n._writableState.errorEmitted=!0,Bn.nextTick(Wz,n,s)):Bn.nextTick(Wz,n,s):e?(Bn.nextTick(pR,n),e(s)):Bn.nextTick(pR,n)}),this)}function Wz(t,e){LF(t,e),pR(t)}function pR(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function yYe(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function LF(t,e){t.emit("error",e)}function bYe(t,e){var n=t._readableState,r=t._writableState;n&&n.autoDestroy||r&&r.autoDestroy?t.destroy(e):t.emit("error",e)}var One={destroy:_Ye,undestroy:yYe,errorOrDestroy:bYe},Ny={};function EYe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var kne={};function qd(t,e,n){n||(n=Error);function r(s,o,a){return typeof e=="string"?e:e(s,o,a)}var i=function(s){EYe(o,s);function o(a,c,l){return s.call(this,r(a,c,l))||this}return o}(n);i.prototype.name=n.name,i.prototype.code=t,kne[t]=i}function qz(t,e){if(Array.isArray(t)){var n=t.length;return t=t.map(function(r){return String(r)}),n>2?"one of ".concat(e," ").concat(t.slice(0,n-1).join(", "),", or ")+t[n-1]:n===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function SYe(t,e,n){return t.substr(0,e.length)===e}function TYe(t,e,n){return(n===void 0||n>t.length)&&(n=t.length),t.substring(n-e.length,n)===e}function wYe(t,e,n){return typeof n!="number"&&(n=0),n+e.length>t.length?!1:t.indexOf(e,n)!==-1}qd("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);qd("ERR_INVALID_ARG_TYPE",function(t,e,n){var r;typeof e=="string"&&SYe(e,"not ")?(r="must not be",e=e.replace(/^not /,"")):r="must be";var i;if(TYe(t," argument"))i="The ".concat(t," ").concat(r," ").concat(qz(e,"type"));else{var s=wYe(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(r," ").concat(qz(e,"type"))}return i+=". Received type ".concat(typeof n),i},TypeError);qd("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");qd("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});qd("ERR_STREAM_PREMATURE_CLOSE","Premature close");qd("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});qd("ERR_MULTIPLE_CALLBACK","Callback called multiple times");qd("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");qd("ERR_STREAM_WRITE_AFTER_END","write after end");qd("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);qd("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);qd("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Ny.codes=kne;var xYe=Ny.codes.ERR_INVALID_OPT_VALUE;function CYe(t,e,n){return t.highWaterMark!=null?t.highWaterMark:e?t[n]:null}function RYe(t,e,n,r){var i=CYe(e,r,n);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=r?n:"highWaterMark";throw new xYe(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var Nne={getHighWaterMark:RYe},AYe=MYe;function MYe(t,e){if(iL("noDeprecation"))return t;var n=!1;function r(){if(!n){if(iL("throwDeprecation"))throw new Error(e);iL("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}return r}function iL(t){try{if(!Da.localStorage)return!1}catch{return!1}var e=Da.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}var sL,Kz;function Pne(){if(Kz)return sL;Kz=1,sL=U;function t(Ee){var Se=this;this.next=null,this.entry=null,this.finish=function(){xe(Se,Ee)}}var e;U.WritableState=I;var n={deprecate:AYe},r=rne,i=Lx.Buffer,s=(typeof Da<"u"?Da:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(Ee){return i.from(Ee)}function a(Ee){return i.isBuffer(Ee)||Ee instanceof s}var c=One,l=Nne,u=l.getHighWaterMark,d=Ny.codes,h=d.ERR_INVALID_ARG_TYPE,p=d.ERR_METHOD_NOT_IMPLEMENTED,f=d.ERR_MULTIPLE_CALLBACK,g=d.ERR_STREAM_CANNOT_PIPE,y=d.ERR_STREAM_DESTROYED,E=d.ERR_STREAM_NULL_VALUES,w=d.ERR_STREAM_WRITE_AFTER_END,R=d.ERR_UNKNOWN_ENCODING,A=c.errorOrDestroy;CS(U,r);function k(){}function I(Ee,Se,Ie){e=e||iS(),Ee=Ee||{},typeof Ie!="boolean"&&(Ie=Se instanceof e),this.objectMode=!!Ee.objectMode,Ie&&(this.objectMode=this.objectMode||!!Ee.writableObjectMode),this.highWaterMark=u(this,Ee,"writableHighWaterMark",Ie),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Ze=Ee.decodeStrings===!1;this.decodeStrings=!Ze,this.defaultEncoding=Ee.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(_t){Z(Se,_t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Ee.emitClose!==!1,this.autoDestroy=!!Ee.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new t(this)}I.prototype.getBuffer=function(){for(var Se=this.bufferedRequest,Ie=[];Se;)Ie.push(Se),Se=Se.next;return Ie},function(){try{Object.defineProperty(I.prototype,"buffer",{get:n.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var N;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(N=Function.prototype[Symbol.hasInstance],Object.defineProperty(U,Symbol.hasInstance,{value:function(Se){return N.call(this,Se)?!0:this!==U?!1:Se&&Se._writableState instanceof I}})):N=function(Se){return Se instanceof this};function U(Ee){e=e||iS();var Se=this instanceof e;if(!Se&&!N.call(U,this))return new U(Ee);this._writableState=new I(Ee,this,Se),this.writable=!0,Ee&&(typeof Ee.write=="function"&&(this._write=Ee.write),typeof Ee.writev=="function"&&(this._writev=Ee.writev),typeof Ee.destroy=="function"&&(this._destroy=Ee.destroy),typeof Ee.final=="function"&&(this._final=Ee.final)),r.call(this)}U.prototype.pipe=function(){A(this,new g)};function F(Ee,Se){var Ie=new w;A(Ee,Ie),Bn.nextTick(Se,Ie)}function $(Ee,Se,Ie,Ze){var _t;return Ie===null?_t=new E:typeof Ie!="string"&&!Se.objectMode&&(_t=new h("chunk",["string","Buffer"],Ie)),_t?(A(Ee,_t),Bn.nextTick(Ze,_t),!1):!0}U.prototype.write=function(Ee,Se,Ie){var Ze=this._writableState,_t=!1,fe=!Ze.objectMode&&a(Ee);return fe&&!i.isBuffer(Ee)&&(Ee=o(Ee)),typeof Se=="function"&&(Ie=Se,Se=null),fe?Se="buffer":Se||(Se=Ze.defaultEncoding),typeof Ie!="function"&&(Ie=k),Ze.ending?F(this,Ie):(fe||$(this,Ze,Ee,Ie))&&(Ze.pendingcb++,_t=K(this,Ze,fe,Ee,Se,Ie)),_t},U.prototype.cork=function(){this._writableState.corked++},U.prototype.uncork=function(){var Ee=this._writableState;Ee.corked&&(Ee.corked--,!Ee.writing&&!Ee.corked&&!Ee.bufferProcessing&&Ee.bufferedRequest&&Q(this,Ee))},U.prototype.setDefaultEncoding=function(Se){if(typeof Se=="string"&&(Se=Se.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Se+"").toLowerCase())>-1))throw new R(Se);return this._writableState.defaultEncoding=Se,this},Object.defineProperty(U.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function q(Ee,Se,Ie){return!Ee.objectMode&&Ee.decodeStrings!==!1&&typeof Se=="string"&&(Se=i.from(Se,Ie)),Se}Object.defineProperty(U.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function K(Ee,Se,Ie,Ze,_t,fe){if(!Ie){var ge=q(Se,Ze,_t);Ze!==ge&&(Ie=!0,_t="buffer",Ze=ge)}var rt=Se.objectMode?1:Ze.length;Se.length+=rt;var Re=Se.length<Se.highWaterMark;if(Re||(Se.needDrain=!0),Se.writing||Se.corked){var St=Se.lastBufferedRequest;Se.lastBufferedRequest={chunk:Ze,encoding:_t,isBuf:Ie,callback:fe,next:null},St?St.next=Se.lastBufferedRequest:Se.bufferedRequest=Se.lastBufferedRequest,Se.bufferedRequestCount+=1}else W(Ee,Se,!1,rt,Ze,_t,fe);return Re}function W(Ee,Se,Ie,Ze,_t,fe,ge){Se.writelen=Ze,Se.writecb=ge,Se.writing=!0,Se.sync=!0,Se.destroyed?Se.onwrite(new y("write")):Ie?Ee._writev(_t,Se.onwrite):Ee._write(_t,fe,Se.onwrite),Se.sync=!1}function X(Ee,Se,Ie,Ze,_t){--Se.pendingcb,Ie?(Bn.nextTick(_t,Ze),Bn.nextTick(_e,Ee,Se),Ee._writableState.errorEmitted=!0,A(Ee,Ze)):(_t(Ze),Ee._writableState.errorEmitted=!0,A(Ee,Ze),_e(Ee,Se))}function ne(Ee){Ee.writing=!1,Ee.writecb=null,Ee.length-=Ee.writelen,Ee.writelen=0}function Z(Ee,Se){var Ie=Ee._writableState,Ze=Ie.sync,_t=Ie.writecb;if(typeof _t!="function")throw new f;if(ne(Ie),Se)X(Ee,Ie,Ze,Se,_t);else{var fe=se(Ie)||Ee.destroyed;!fe&&!Ie.corked&&!Ie.bufferProcessing&&Ie.bufferedRequest&&Q(Ee,Ie),Ze?Bn.nextTick(ie,Ee,Ie,fe,_t):ie(Ee,Ie,fe,_t)}}function ie(Ee,Se,Ie,Ze){Ie||G(Ee,Se),Se.pendingcb--,Ze(),_e(Ee,Se)}function G(Ee,Se){Se.length===0&&Se.needDrain&&(Se.needDrain=!1,Ee.emit("drain"))}function Q(Ee,Se){Se.bufferProcessing=!0;var Ie=Se.bufferedRequest;if(Ee._writev&&Ie&&Ie.next){var Ze=Se.bufferedRequestCount,_t=new Array(Ze),fe=Se.corkedRequestsFree;fe.entry=Ie;for(var ge=0,rt=!0;Ie;)_t[ge]=Ie,Ie.isBuf||(rt=!1),Ie=Ie.next,ge+=1;_t.allBuffers=rt,W(Ee,Se,!0,Se.length,_t,"",fe.finish),Se.pendingcb++,Se.lastBufferedRequest=null,fe.next?(Se.corkedRequestsFree=fe.next,fe.next=null):Se.corkedRequestsFree=new t(Se),Se.bufferedRequestCount=0}else{for(;Ie;){var Re=Ie.chunk,St=Ie.encoding,Ge=Ie.callback,kt=Se.objectMode?1:Re.length;if(W(Ee,Se,!1,kt,Re,St,Ge),Ie=Ie.next,Se.bufferedRequestCount--,Se.writing)break}Ie===null&&(Se.lastBufferedRequest=null)}Se.bufferedRequest=Ie,Se.bufferProcessing=!1}U.prototype._write=function(Ee,Se,Ie){Ie(new p("_write()"))},U.prototype._writev=null,U.prototype.end=function(Ee,Se,Ie){var Ze=this._writableState;return typeof Ee=="function"?(Ie=Ee,Ee=null,Se=null):typeof Se=="function"&&(Ie=Se,Se=null),Ee!=null&&this.write(Ee,Se),Ze.corked&&(Ze.corked=1,this.uncork()),Ze.ending||le(this,Ze,Ie),this},Object.defineProperty(U.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function se(Ee){return Ee.ending&&Ee.length===0&&Ee.bufferedRequest===null&&!Ee.finished&&!Ee.writing}function ve(Ee,Se){Ee._final(function(Ie){Se.pendingcb--,Ie&&A(Ee,Ie),Se.prefinished=!0,Ee.emit("prefinish"),_e(Ee,Se)})}function Oe(Ee,Se){!Se.prefinished&&!Se.finalCalled&&(typeof Ee._final=="function"&&!Se.destroyed?(Se.pendingcb++,Se.finalCalled=!0,Bn.nextTick(ve,Ee,Se)):(Se.prefinished=!0,Ee.emit("prefinish")))}function _e(Ee,Se){var Ie=se(Se);if(Ie&&(Oe(Ee,Se),Se.pendingcb===0&&(Se.finished=!0,Ee.emit("finish"),Se.autoDestroy))){var Ze=Ee._readableState;(!Ze||Ze.autoDestroy&&Ze.endEmitted)&&Ee.destroy()}return Ie}function le(Ee,Se,Ie){Se.ending=!0,_e(Ee,Se),Ie&&(Se.finished?Bn.nextTick(Ie):Ee.once("finish",Ie)),Se.ended=!0,Ee.writable=!1}function xe(Ee,Se,Ie){var Ze=Ee.entry;for(Ee.entry=null;Ze;){var _t=Ze.callback;Se.pendingcb--,_t(Ie),Ze=Ze.next}Se.corkedRequestsFree.next=Ee}return Object.defineProperty(U.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Se){this._writableState&&(this._writableState.destroyed=Se)}}),U.prototype.destroy=c.destroy,U.prototype._undestroy=c.undestroy,U.prototype._destroy=function(Ee,Se){Se(Ee)},sL}var oL,Yz;function iS(){if(Yz)return oL;Yz=1;var t=Object.keys||function(l){var u=[];for(var d in l)u.push(d);return u};oL=o;var e=Lne(),n=Pne();CS(o,e);for(var r=t(n.prototype),i=0;i<r.length;i++){var s=r[i];o.prototype[s]||(o.prototype[s]=n.prototype[s])}function o(l){if(!(this instanceof o))return new o(l);e.call(this,l),n.call(this,l),this.allowHalfOpen=!0,l&&(l.readable===!1&&(this.readable=!1),l.writable===!1&&(this.writable=!1),l.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}Object.defineProperty(o.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(o.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(o.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function a(){this._writableState.ended||Bn.nextTick(c,this)}function c(l){l.end()}return Object.defineProperty(o.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(u){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=u,this._writableState.destroyed=u)}}),oL}var aL={},Xz;function Jz(){if(Xz)return aL;Xz=1;var t=Kte.Buffer,e=t.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(E){if(!E)return"utf8";for(var w;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(w)return;E=(""+E).toLowerCase(),w=!0}}function r(E){var w=n(E);if(typeof w!="string"&&(t.isEncoding===e||!e(E)))throw new Error("Unknown encoding: "+E);return w||E}aL.StringDecoder=i;function i(E){this.encoding=r(E);var w;switch(this.encoding){case"utf16le":this.text=d,this.end=h,w=4;break;case"utf8":this.fillLast=c,w=4;break;case"base64":this.text=p,this.end=f,w=3;break;default:this.write=g,this.end=y;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(w)}i.prototype.write=function(E){if(E.length===0)return"";var w,R;if(this.lastNeed){if(w=this.fillLast(E),w===void 0)return"";R=this.lastNeed,this.lastNeed=0}else R=0;return R<E.length?w?w+this.text(E,R):this.text(E,R):w||""},i.prototype.end=u,i.prototype.text=l,i.prototype.fillLast=function(E){if(this.lastNeed<=E.length)return E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),this.lastNeed-=E.length};function s(E){return E<=127?0:E>>5===6?2:E>>4===14?3:E>>3===30?4:E>>6===2?-1:-2}function o(E,w,R){var A=w.length-1;if(A<R)return 0;var k=s(w[A]);return k>=0?(k>0&&(E.lastNeed=k-1),k):--A<R||k===-2?0:(k=s(w[A]),k>=0?(k>0&&(E.lastNeed=k-2),k):--A<R||k===-2?0:(k=s(w[A]),k>=0?(k>0&&(k===2?k=0:E.lastNeed=k-3),k):0))}function a(E,w,R){if((w[0]&192)!==128)return E.lastNeed=0,"�";if(E.lastNeed>1&&w.length>1){if((w[1]&192)!==128)return E.lastNeed=1,"�";if(E.lastNeed>2&&w.length>2&&(w[2]&192)!==128)return E.lastNeed=2,"�"}}function c(E){var w=this.lastTotal-this.lastNeed,R=a(this,E);if(R!==void 0)return R;if(this.lastNeed<=E.length)return E.copy(this.lastChar,w,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,w,0,E.length),this.lastNeed-=E.length}function l(E,w){var R=o(this,E,w);if(!this.lastNeed)return E.toString("utf8",w);this.lastTotal=R;var A=E.length-(R-this.lastNeed);return E.copy(this.lastChar,0,A),E.toString("utf8",w,A)}function u(E){var w=E&&E.length?this.write(E):"";return this.lastNeed?w+"�":w}function d(E,w){if((E.length-w)%2===0){var R=E.toString("utf16le",w);if(R){var A=R.charCodeAt(R.length-1);if(A>=55296&&A<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],R.slice(0,-1)}return R}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",w,E.length-1)}function h(E){var w=E&&E.length?this.write(E):"";if(this.lastNeed){var R=this.lastTotal-this.lastNeed;return w+this.lastChar.toString("utf16le",0,R)}return w}function p(E,w){var R=(E.length-w)%3;return R===0?E.toString("base64",w):(this.lastNeed=3-R,this.lastTotal=3,R===1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",w,E.length-R))}function f(E){var w=E&&E.length?this.write(E):"";return this.lastNeed?w+this.lastChar.toString("base64",0,3-this.lastNeed):w}function g(E){return E.toString(this.encoding)}function y(E){return E&&E.length?this.write(E):""}return aL}var Qz=Ny.codes.ERR_STREAM_PREMATURE_CLOSE;function IYe(t){var e=!1;return function(){if(!e){e=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];t.apply(this,r)}}}function OYe(){}function kYe(t){return t.setHeader&&typeof t.abort=="function"}function Dne(t,e,n){if(typeof e=="function")return Dne(t,null,e);e||(e={}),n=IYe(n||OYe);var r=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||a()},o=t._writableState&&t._writableState.finished,a=function(){i=!1,o=!0,r||n.call(t)},c=t._readableState&&t._readableState.endEmitted,l=function(){r=!1,c=!0,i||n.call(t)},u=function(f){n.call(t,f)},d=function(){var f;if(r&&!c)return(!t._readableState||!t._readableState.ended)&&(f=new Qz),n.call(t,f);if(i&&!o)return(!t._writableState||!t._writableState.ended)&&(f=new Qz),n.call(t,f)},h=function(){t.req.on("finish",a)};return kYe(t)?(t.on("complete",a),t.on("abort",d),t.req?h():t.on("request",h)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",l),t.on("finish",a),e.error!==!1&&t.on("error",u),t.on("close",d),function(){t.removeListener("complete",a),t.removeListener("abort",d),t.removeListener("request",h),t.req&&t.req.removeListener("finish",a),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",a),t.removeListener("end",l),t.removeListener("error",u),t.removeListener("close",d)}}var Dj=Dne,cL,Zz;function NYe(){if(Zz)return cL;Zz=1;var t;function e(R,A,k){return A=n(A),A in R?Object.defineProperty(R,A,{value:k,enumerable:!0,configurable:!0,writable:!0}):R[A]=k,R}function n(R){var A=r(R,"string");return typeof A=="symbol"?A:String(A)}function r(R,A){if(typeof R!="object"||R===null)return R;var k=R[Symbol.toPrimitive];if(k!==void 0){var I=k.call(R,A||"default");if(typeof I!="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(R)}var i=Dj,s=Symbol("lastResolve"),o=Symbol("lastReject"),a=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),u=Symbol("handlePromise"),d=Symbol("stream");function h(R,A){return{value:R,done:A}}function p(R){var A=R[s];if(A!==null){var k=R[d].read();k!==null&&(R[l]=null,R[s]=null,R[o]=null,A(h(k,!1)))}}function f(R){Bn.nextTick(p,R)}function g(R,A){return function(k,I){R.then(function(){if(A[c]){k(h(void 0,!0));return}A[u](k,I)},I)}}var y=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((t={get stream(){return this[d]},next:function(){var A=this,k=this[a];if(k!==null)return Promise.reject(k);if(this[c])return Promise.resolve(h(void 0,!0));if(this[d].destroyed)return new Promise(function(F,$){Bn.nextTick(function(){A[a]?$(A[a]):F(h(void 0,!0))})});var I=this[l],N;if(I)N=new Promise(g(I,this));else{var U=this[d].read();if(U!==null)return Promise.resolve(h(U,!1));N=new Promise(this[u])}return this[l]=N,N}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var A=this;return new Promise(function(k,I){A[d].destroy(null,function(N){if(N){I(N);return}k(h(void 0,!0))})})}),t),y),w=function(A){var k,I=Object.create(E,(k={},e(k,d,{value:A,writable:!0}),e(k,s,{value:null,writable:!0}),e(k,o,{value:null,writable:!0}),e(k,a,{value:null,writable:!0}),e(k,c,{value:A._readableState.endEmitted,writable:!0}),e(k,u,{value:function(U,F){var $=I[d].read();$?(I[l]=null,I[s]=null,I[o]=null,U(h($,!1))):(I[s]=U,I[o]=F)},writable:!0}),k));return I[l]=null,i(A,function(N){if(N&&N.code!=="ERR_STREAM_PREMATURE_CLOSE"){var U=I[o];U!==null&&(I[l]=null,I[s]=null,I[o]=null,U(N)),I[a]=N;return}var F=I[s];F!==null&&(I[l]=null,I[s]=null,I[o]=null,F(h(void 0,!0))),I[c]=!0}),A.on("readable",f.bind(null,I)),I};return cL=w,cL}var lL,eG;function PYe(){return eG||(eG=1,lL=function(){throw new Error("Readable.from is not available in the browser")}),lL}var uL,tG;function Lne(){if(tG)return uL;tG=1,uL=F;var t;F.ReadableState=U,wN.EventEmitter;var e=function(ge,rt){return ge.listeners(rt).length},n=rne,r=Lx.Buffer,i=(typeof Da<"u"?Da:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(fe){return r.from(fe)}function o(fe){return r.isBuffer(fe)||fe instanceof i}var a=xj,c;a&&a.debuglog?c=a.debuglog("stream"):c=function(){};var l=vYe(),u=One,d=Nne,h=d.getHighWaterMark,p=Ny.codes,f=p.ERR_INVALID_ARG_TYPE,g=p.ERR_STREAM_PUSH_AFTER_EOF,y=p.ERR_METHOD_NOT_IMPLEMENTED,E=p.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,w,R,A;CS(F,n);var k=u.errorOrDestroy,I=["error","close","destroy","pause","resume"];function N(fe,ge,rt){if(typeof fe.prependListener=="function")return fe.prependListener(ge,rt);!fe._events||!fe._events[ge]?fe.on(ge,rt):Array.isArray(fe._events[ge])?fe._events[ge].unshift(rt):fe._events[ge]=[rt,fe._events[ge]]}function U(fe,ge,rt){t=t||iS(),fe=fe||{},typeof rt!="boolean"&&(rt=ge instanceof t),this.objectMode=!!fe.objectMode,rt&&(this.objectMode=this.objectMode||!!fe.readableObjectMode),this.highWaterMark=h(this,fe,"readableHighWaterMark",rt),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=fe.emitClose!==!1,this.autoDestroy=!!fe.autoDestroy,this.destroyed=!1,this.defaultEncoding=fe.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,fe.encoding&&(w||(w=Jz().StringDecoder),this.decoder=new w(fe.encoding),this.encoding=fe.encoding)}function F(fe){if(t=t||iS(),!(this instanceof F))return new F(fe);var ge=this instanceof t;this._readableState=new U(fe,this,ge),this.readable=!0,fe&&(typeof fe.read=="function"&&(this._read=fe.read),typeof fe.destroy=="function"&&(this._destroy=fe.destroy)),n.call(this)}Object.defineProperty(F.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(ge){this._readableState&&(this._readableState.destroyed=ge)}}),F.prototype.destroy=u.destroy,F.prototype._undestroy=u.undestroy,F.prototype._destroy=function(fe,ge){ge(fe)},F.prototype.push=function(fe,ge){var rt=this._readableState,Re;return rt.objectMode?Re=!0:typeof fe=="string"&&(ge=ge||rt.defaultEncoding,ge!==rt.encoding&&(fe=r.from(fe,ge),ge=""),Re=!0),$(this,fe,ge,!1,Re)},F.prototype.unshift=function(fe){return $(this,fe,null,!0,!1)};function $(fe,ge,rt,Re,St){c("readableAddChunk",ge);var Ge=fe._readableState;if(ge===null)Ge.reading=!1,Z(fe,Ge);else{var kt;if(St||(kt=K(Ge,ge)),kt)k(fe,kt);else if(Ge.objectMode||ge&&ge.length>0)if(typeof ge!="string"&&!Ge.objectMode&&Object.getPrototypeOf(ge)!==r.prototype&&(ge=s(ge)),Re)Ge.endEmitted?k(fe,new E):q(fe,Ge,ge,!0);else if(Ge.ended)k(fe,new g);else{if(Ge.destroyed)return!1;Ge.reading=!1,Ge.decoder&&!rt?(ge=Ge.decoder.write(ge),Ge.objectMode||ge.length!==0?q(fe,Ge,ge,!1):Q(fe,Ge)):q(fe,Ge,ge,!1)}else Re||(Ge.reading=!1,Q(fe,Ge))}return!Ge.ended&&(Ge.length<Ge.highWaterMark||Ge.length===0)}function q(fe,ge,rt,Re){ge.flowing&&ge.length===0&&!ge.sync?(ge.awaitDrain=0,fe.emit("data",rt)):(ge.length+=ge.objectMode?1:rt.length,Re?ge.buffer.unshift(rt):ge.buffer.push(rt),ge.needReadable&&ie(fe)),Q(fe,ge)}function K(fe,ge){var rt;return!o(ge)&&typeof ge!="string"&&ge!==void 0&&!fe.objectMode&&(rt=new f("chunk",["string","Buffer","Uint8Array"],ge)),rt}F.prototype.isPaused=function(){return this._readableState.flowing===!1},F.prototype.setEncoding=function(fe){w||(w=Jz().StringDecoder);var ge=new w(fe);this._readableState.decoder=ge,this._readableState.encoding=this._readableState.decoder.encoding;for(var rt=this._readableState.buffer.head,Re="";rt!==null;)Re+=ge.write(rt.data),rt=rt.next;return this._readableState.buffer.clear(),Re!==""&&this._readableState.buffer.push(Re),this._readableState.length=Re.length,this};var W=1073741824;function X(fe){return fe>=W?fe=W:(fe--,fe|=fe>>>1,fe|=fe>>>2,fe|=fe>>>4,fe|=fe>>>8,fe|=fe>>>16,fe++),fe}function ne(fe,ge){return fe<=0||ge.length===0&&ge.ended?0:ge.objectMode?1:fe!==fe?ge.flowing&&ge.length?ge.buffer.head.data.length:ge.length:(fe>ge.highWaterMark&&(ge.highWaterMark=X(fe)),fe<=ge.length?fe:ge.ended?ge.length:(ge.needReadable=!0,0))}F.prototype.read=function(fe){c("read",fe),fe=parseInt(fe,10);var ge=this._readableState,rt=fe;if(fe!==0&&(ge.emittedReadable=!1),fe===0&&ge.needReadable&&((ge.highWaterMark!==0?ge.length>=ge.highWaterMark:ge.length>0)||ge.ended))return c("read: emitReadable",ge.length,ge.ended),ge.length===0&&ge.ended?Ie(this):ie(this),null;if(fe=ne(fe,ge),fe===0&&ge.ended)return ge.length===0&&Ie(this),null;var Re=ge.needReadable;c("need readable",Re),(ge.length===0||ge.length-fe<ge.highWaterMark)&&(Re=!0,c("length less than watermark",Re)),ge.ended||ge.reading?(Re=!1,c("reading or ended",Re)):Re&&(c("do read"),ge.reading=!0,ge.sync=!0,ge.length===0&&(ge.needReadable=!0),this._read(ge.highWaterMark),ge.sync=!1,ge.reading||(fe=ne(rt,ge)));var St;return fe>0?St=Se(fe,ge):St=null,St===null?(ge.needReadable=ge.length<=ge.highWaterMark,fe=0):(ge.length-=fe,ge.awaitDrain=0),ge.length===0&&(ge.ended||(ge.needReadable=!0),rt!==fe&&ge.ended&&Ie(this)),St!==null&&this.emit("data",St),St};function Z(fe,ge){if(c("onEofChunk"),!ge.ended){if(ge.decoder){var rt=ge.decoder.end();rt&&rt.length&&(ge.buffer.push(rt),ge.length+=ge.objectMode?1:rt.length)}ge.ended=!0,ge.sync?ie(fe):(ge.needReadable=!1,ge.emittedReadable||(ge.emittedReadable=!0,G(fe)))}}function ie(fe){var ge=fe._readableState;c("emitReadable",ge.needReadable,ge.emittedReadable),ge.needReadable=!1,ge.emittedReadable||(c("emitReadable",ge.flowing),ge.emittedReadable=!0,Bn.nextTick(G,fe))}function G(fe){var ge=fe._readableState;c("emitReadable_",ge.destroyed,ge.length,ge.ended),!ge.destroyed&&(ge.length||ge.ended)&&(fe.emit("readable"),ge.emittedReadable=!1),ge.needReadable=!ge.flowing&&!ge.ended&&ge.length<=ge.highWaterMark,Ee(fe)}function Q(fe,ge){ge.readingMore||(ge.readingMore=!0,Bn.nextTick(se,fe,ge))}function se(fe,ge){for(;!ge.reading&&!ge.ended&&(ge.length<ge.highWaterMark||ge.flowing&&ge.length===0);){var rt=ge.length;if(c("maybeReadMore read 0"),fe.read(0),rt===ge.length)break}ge.readingMore=!1}F.prototype._read=function(fe){k(this,new y("_read()"))},F.prototype.pipe=function(fe,ge){var rt=this,Re=this._readableState;switch(Re.pipesCount){case 0:Re.pipes=fe;break;case 1:Re.pipes=[Re.pipes,fe];break;default:Re.pipes.push(fe);break}Re.pipesCount+=1,c("pipe count=%d opts=%j",Re.pipesCount,ge);var St=(!ge||ge.end!==!1)&&fe!==Bn.stdout&&fe!==Bn.stderr,Ge=St?Bt:ze;Re.endEmitted?Bn.nextTick(Ge):rt.once("end",Ge),fe.on("unpipe",kt);function kt(Vt,xt){c("onunpipe"),Vt===rt&&xt&&xt.hasUnpiped===!1&&(xt.hasUnpiped=!0,Ce())}function Bt(){c("onend"),fe.end()}var He=ve(rt);fe.on("drain",He);var $t=!1;function Ce(){c("cleanup"),fe.removeListener("close",yt),fe.removeListener("finish",We),fe.removeListener("drain",He),fe.removeListener("error",tt),fe.removeListener("unpipe",kt),rt.removeListener("end",Bt),rt.removeListener("end",ze),rt.removeListener("data",ue),$t=!0,Re.awaitDrain&&(!fe._writableState||fe._writableState.needDrain)&&He()}rt.on("data",ue);function ue(Vt){c("ondata");var xt=fe.write(Vt);c("dest.write",xt),xt===!1&&((Re.pipesCount===1&&Re.pipes===fe||Re.pipesCount>1&&_t(Re.pipes,fe)!==-1)&&!$t&&(c("false write response, pause",Re.awaitDrain),Re.awaitDrain++),rt.pause())}function tt(Vt){c("onerror",Vt),ze(),fe.removeListener("error",tt),e(fe,"error")===0&&k(fe,Vt)}N(fe,"error",tt);function yt(){fe.removeListener("finish",We),ze()}fe.once("close",yt);function We(){c("onfinish"),fe.removeListener("close",yt),ze()}fe.once("finish",We);function ze(){c("unpipe"),rt.unpipe(fe)}return fe.emit("pipe",rt),Re.flowing||(c("pipe resume"),rt.resume()),fe};function ve(fe){return function(){var rt=fe._readableState;c("pipeOnDrain",rt.awaitDrain),rt.awaitDrain&&rt.awaitDrain--,rt.awaitDrain===0&&e(fe,"data")&&(rt.flowing=!0,Ee(fe))}}F.prototype.unpipe=function(fe){var ge=this._readableState,rt={hasUnpiped:!1};if(ge.pipesCount===0)return this;if(ge.pipesCount===1)return fe&&fe!==ge.pipes?this:(fe||(fe=ge.pipes),ge.pipes=null,ge.pipesCount=0,ge.flowing=!1,fe&&fe.emit("unpipe",this,rt),this);if(!fe){var Re=ge.pipes,St=ge.pipesCount;ge.pipes=null,ge.pipesCount=0,ge.flowing=!1;for(var Ge=0;Ge<St;Ge++)Re[Ge].emit("unpipe",this,{hasUnpiped:!1});return this}var kt=_t(ge.pipes,fe);return kt===-1?this:(ge.pipes.splice(kt,1),ge.pipesCount-=1,ge.pipesCount===1&&(ge.pipes=ge.pipes[0]),fe.emit("unpipe",this,rt),this)},F.prototype.on=function(fe,ge){var rt=n.prototype.on.call(this,fe,ge),Re=this._readableState;return fe==="data"?(Re.readableListening=this.listenerCount("readable")>0,Re.flowing!==!1&&this.resume()):fe==="readable"&&!Re.endEmitted&&!Re.readableListening&&(Re.readableListening=Re.needReadable=!0,Re.flowing=!1,Re.emittedReadable=!1,c("on readable",Re.length,Re.reading),Re.length?ie(this):Re.reading||Bn.nextTick(_e,this)),rt},F.prototype.addListener=F.prototype.on,F.prototype.removeListener=function(fe,ge){var rt=n.prototype.removeListener.call(this,fe,ge);return fe==="readable"&&Bn.nextTick(Oe,this),rt},F.prototype.removeAllListeners=function(fe){var ge=n.prototype.removeAllListeners.apply(this,arguments);return(fe==="readable"||fe===void 0)&&Bn.nextTick(Oe,this),ge};function Oe(fe){var ge=fe._readableState;ge.readableListening=fe.listenerCount("readable")>0,ge.resumeScheduled&&!ge.paused?ge.flowing=!0:fe.listenerCount("data")>0&&fe.resume()}function _e(fe){c("readable nexttick read 0"),fe.read(0)}F.prototype.resume=function(){var fe=this._readableState;return fe.flowing||(c("resume"),fe.flowing=!fe.readableListening,le(this,fe)),fe.paused=!1,this};function le(fe,ge){ge.resumeScheduled||(ge.resumeScheduled=!0,Bn.nextTick(xe,fe,ge))}function xe(fe,ge){c("resume",ge.reading),ge.reading||fe.read(0),ge.resumeScheduled=!1,fe.emit("resume"),Ee(fe),ge.flowing&&!ge.reading&&fe.read(0)}F.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Ee(fe){var ge=fe._readableState;for(c("flow",ge.flowing);ge.flowing&&fe.read()!==null;);}F.prototype.wrap=function(fe){var ge=this,rt=this._readableState,Re=!1;fe.on("end",function(){if(c("wrapped end"),rt.decoder&&!rt.ended){var kt=rt.decoder.end();kt&&kt.length&&ge.push(kt)}ge.push(null)}),fe.on("data",function(kt){if(c("wrapped data"),rt.decoder&&(kt=rt.decoder.write(kt)),!(rt.objectMode&&kt==null)&&!(!rt.objectMode&&(!kt||!kt.length))){var Bt=ge.push(kt);Bt||(Re=!0,fe.pause())}});for(var St in fe)this[St]===void 0&&typeof fe[St]=="function"&&(this[St]=function(Bt){return function(){return fe[Bt].apply(fe,arguments)}}(St));for(var Ge=0;Ge<I.length;Ge++)fe.on(I[Ge],this.emit.bind(this,I[Ge]));return this._read=function(kt){c("wrapped _read",kt),Re&&(Re=!1,fe.resume())},this},typeof Symbol=="function"&&(F.prototype[Symbol.asyncIterator]=function(){return R===void 0&&(R=NYe()),R(this)}),Object.defineProperty(F.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(F.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(F.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(ge){this._readableState&&(this._readableState.flowing=ge)}}),F._fromList=Se,Object.defineProperty(F.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Se(fe,ge){if(ge.length===0)return null;var rt;return ge.objectMode?rt=ge.buffer.shift():!fe||fe>=ge.length?(ge.decoder?rt=ge.buffer.join(""):ge.buffer.length===1?rt=ge.buffer.first():rt=ge.buffer.concat(ge.length),ge.buffer.clear()):rt=ge.buffer.consume(fe,ge.decoder),rt}function Ie(fe){var ge=fe._readableState;c("endReadable",ge.endEmitted),ge.endEmitted||(ge.ended=!0,Bn.nextTick(Ze,ge,fe))}function Ze(fe,ge){if(c("endReadableNT",fe.endEmitted,fe.length),!fe.endEmitted&&fe.length===0&&(fe.endEmitted=!0,ge.readable=!1,ge.emit("end"),fe.autoDestroy)){var rt=ge._writableState;(!rt||rt.autoDestroy&&rt.finished)&&ge.destroy()}}typeof Symbol=="function"&&(F.from=function(fe,ge){return A===void 0&&(A=PYe()),A(F,fe,ge)});function _t(fe,ge){for(var rt=0,Re=fe.length;rt<Re;rt++)if(fe[rt]===ge)return rt;return-1}return uL}var Une=mg,RN=Ny.codes,DYe=RN.ERR_METHOD_NOT_IMPLEMENTED,LYe=RN.ERR_MULTIPLE_CALLBACK,UYe=RN.ERR_TRANSFORM_ALREADY_TRANSFORMING,FYe=RN.ERR_TRANSFORM_WITH_LENGTH_0,AN=iS();CS(mg,AN);function BYe(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(r===null)return this.emit("error",new LYe);n.writechunk=null,n.writecb=null,e!=null&&this.push(e),r(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function mg(t){if(!(this instanceof mg))return new mg(t);AN.call(this,t),this._transformState={afterTransform:BYe.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",jYe)}function jYe(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,n){nG(t,e,n)}):nG(this,null,null)}mg.prototype.push=function(t,e){return this._transformState.needTransform=!1,AN.prototype.push.call(this,t,e)};mg.prototype._transform=function(t,e,n){n(new DYe("_transform()"))};mg.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};mg.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};mg.prototype._destroy=function(t,e){AN.prototype._destroy.call(this,t,function(n){e(n)})};function nG(t,e,n){if(e)return t.emit("error",e);if(n!=null&&t.push(n),t._writableState.length)throw new FYe;if(t._transformState.transforming)throw new UYe;return t.push(null)}var $Ye=_w,Fne=Une;CS(_w,Fne);function _w(t){if(!(this instanceof _w))return new _w(t);Fne.call(this,t)}_w.prototype._transform=function(t,e,n){n(null,t)};var dL;function HYe(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var Bne=Ny.codes,VYe=Bne.ERR_MISSING_ARGS,zYe=Bne.ERR_STREAM_DESTROYED;function rG(t){if(t)throw t}function GYe(t){return t.setHeader&&typeof t.abort=="function"}function WYe(t,e,n,r){r=HYe(r);var i=!1;t.on("close",function(){i=!0}),dL===void 0&&(dL=Dj),dL(t,{readable:e,writable:n},function(o){if(o)return r(o);i=!0,r()});var s=!1;return function(o){if(!i&&!s){if(s=!0,GYe(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();r(o||new zYe("pipe"))}}}function iG(t){t()}function qYe(t,e){return t.pipe(e)}function KYe(t){return!t.length||typeof t[t.length-1]!="function"?rG:t.pop()}function YYe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=KYe(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new VYe("streams");var i,s=e.map(function(o,a){var c=a<e.length-1,l=a>0;return WYe(o,c,l,function(u){i||(i=u),u&&s.forEach(iG),!c&&(s.forEach(iG),r(i))})});return e.reduce(qYe)}var XYe=YYe;(function(t,e){e=t.exports=Lne(),e.Stream=e,e.Readable=e,e.Writable=Pne(),e.Duplex=iS(),e.Transform=Une,e.PassThrough=$Ye,e.finished=Dj,e.pipeline=XYe})(RF,RF.exports);var jne=RF.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let sG;var $ne=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:Da):t=>(sG||(sG=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));function oG(t,e){for(const n in e)Object.defineProperty(t,n,{value:e[n],enumerable:!0,configurable:!0});return t}function JYe(t,e,n){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");n||(n={}),typeof e=="object"&&(n=e,e=""),e&&(n.code=e);try{return oG(t,n)}catch{n.message=t.message,n.stack=t.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(t)),oG(new i,n)}}var QYe=JYe;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const ZYe=EN("simple-peer"),Hne=d9e,aG=SN,eXe=jne,hL=$ne,_i=QYe,{Buffer:tXe}=Lx,fL=64*1024,nXe=5*1e3,rXe=5*1e3;function cG(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function iXe(t){console.warn(t)}let MN=class UF extends eXe.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=aG(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||aG(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||UF.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},UF.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(n=>n),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||nXe,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Hne(),!this._wrtc)throw _i(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(n){this.destroy(_i(n,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=n=>{this._onIceCandidate(n)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(n=>{this.destroy(_i(n,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=n=>{this._setupData(n)},this.streams&&this.streams.forEach(n=>{this.addStream(n)}),this._pc.ontrack=n=>{this._onTrack(n)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw _i(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(n=>{this._addIceCandidate(n)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(n=>{this.destroy(_i(n,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(_i(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch(r=>{!n.address||n.address.endsWith(".local")?iXe("Ignoring unsupported ICE candidate."):this.destroy(_i(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw _i(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,n){if(!this.destroying){if(this.destroyed)throw _i(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,n),this._needsNegotiation()}catch(r){this.destroy(_i(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:n}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw _i(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(n=>{this.addTrack(n,e)})}}addTrack(e,n){if(this.destroying)return;if(this.destroyed)throw _i(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(e)||new Map;let i=r.get(n);if(!i)i=this._pc.addTrack(e,n),r.set(n,i),this._senderMap.set(e,r),this._needsNegotiation();else throw i.removed?_i(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):_i(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,n,r){if(this.destroying)return;if(this.destroyed)throw _i(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const i=this._senderMap.get(e),s=i?i.get(r):null;if(!s)throw _i(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");n&&this._senderMap.set(n,i),s.replaceTrack!=null?s.replaceTrack(n):this.destroy(_i(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,n){if(this.destroying)return;if(this.destroyed)throw _i(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw _i(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(i):this.destroy(_i(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw _i(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(n=>{this.removeTrack(n,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,hL(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw _i(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,n){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),hL(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),n()}))}_setupData(e){if(!e.channel)return this.destroy(_i(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=fL),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const i=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.destroy(_i(i,"ERR_DATA_CHANNEL"))};let n=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(n&&this._onChannelClose(),n=!0):n=!1},rXe)}_read(){}_write(e,n,r){if(this.destroyed)return r(_i(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(i){return this.destroy(_i(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>fL?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=cG(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},i=s=>{this.destroy(_i(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(_i(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=cG(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},i=s=>{this.destroy(_i(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(_i(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(_i(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,n=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,n),this.emit("iceStateChange",e,n),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(_i(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(_i(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const n=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(i=>{Object.assign(r,i)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const i=[];r.forEach(s=>{i.push(n(s))}),e(null,i)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const i=[];r.result().forEach(s=>{const o={};s.names().forEach(a=>{o[a]=s.stat(a)}),o.id=s.id,o.type=s.type,o.timestamp=s.timestamp,i.push(n(o))}),e(null,i)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((n,r)=>{if(this.destroyed)return;n&&(r=[]);const i={},s={},o={};let a=!1;r.forEach(l=>{(l.type==="remotecandidate"||l.type==="remote-candidate")&&(i[l.id]=l),(l.type==="localcandidate"||l.type==="local-candidate")&&(s[l.id]=l),(l.type==="candidatepair"||l.type==="candidate-pair")&&(o[l.id]=l)});const c=l=>{a=!0;let u=s[l.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof l.googLocalAddress=="string"&&(u=l.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let d=i[l.remoteCandidateId];d&&(d.ip||d.address)?(this.remoteAddress=d.ip||d.address,this.remotePort=Number(d.port)):d&&d.ipAddress?(this.remoteAddress=d.ipAddress,this.remotePort=Number(d.portNumber)):typeof l.googRemoteAddress=="string"&&(d=l.googRemoteAddress.split(":"),this.remoteAddress=d[0],this.remotePort=Number(d[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(l=>{l.type==="transport"&&l.selectedCandidatePairId&&c(o[l.selectedCandidatePairId]),(l.type==="googCandidatePair"&&l.googActiveConnection==="true"||(l.type==="candidatepair"||l.type==="candidate-pair")&&l.selected)&&c(l)}),!a&&(!Object.keys(o).length||Object.keys(s).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(u){return this.destroy(_i(u,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const l=this._cb;this._cb=null,l(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>fL||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let n=e.data;n instanceof ArrayBuffer&&(n=tXe.from(n)),this.push(n)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(n=>{this._debug("on track"),this.emit("track",e.track,n),this._remoteTracks.push({track:e.track,stream:n}),!this._remoteStreams.some(r=>r.id===n.id)&&(this._remoteStreams.push(n),hL(()=>{this._debug("on stream"),this.emit("stream",n)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],ZYe.apply(null,e)}};MN.WEBRTC_SUPPORT=!!Hne();MN.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};MN.channelConfig={};var sXe=MN;const oXe={},aXe=Object.freeze(Object.defineProperty({__proto__:null,default:oXe},Symbol.toStringTag,{value:"Module"})),Lj=FF(aXe),cXe=EN("simple-websocket"),lXe=SN,uXe=jne,lG=$ne,xT=Lj,dT=typeof xT!="function"?WebSocket:xT,uG=64*1024;let Vne=class extends uXe.Duplex{constructor(e={}){if(typeof e=="string"&&(e={url:e}),e=Object.assign({allowHalfOpen:!1},e),super(e),e.url==null&&e.socket==null)throw new Error("Missing required `url` or `socket` option");if(e.url!=null&&e.socket!=null)throw new Error("Must specify either `url` or `socket` option, not both");if(this._id=lXe(4).toString("hex").slice(0,7),this._debug("new websocket: %o",e),this.connected=!1,this.destroyed=!1,this._chunk=null,this._cb=null,this._interval=null,e.socket)this.url=e.socket.url,this._ws=e.socket,this.connected=e.socket.readyState===dT.OPEN;else{this.url=e.url;try{typeof xT=="function"?this._ws=new dT(e.url,null,{...e,encoding:void 0}):this._ws=new dT(e.url)}catch(n){lG(()=>this.destroy(n));return}}this._ws.binaryType="arraybuffer",e.socket&&this.connected?lG(()=>this._handleOpen()):this._ws.onopen=()=>this._handleOpen(),this._ws.onmessage=n=>this._handleMessage(n),this._ws.onclose=()=>this._handleClose(),this._ws.onerror=n=>this._handleError(n),this._handleFinishBound=()=>this._handleFinish(),this.once("finish",this._handleFinishBound)}send(e){this._ws.send(e)}destroy(e){this._destroy(e,()=>{})}_destroy(e,n){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.connected=!1,this.destroyed=!0,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){const r=this._ws,i=()=>{r.onclose=null};if(r.readyState===dT.CLOSED)i();else try{r.onclose=i,r.close()}catch{i()}r.onopen=null,r.onmessage=null,r.onerror=()=>{}}this._ws=null,e&&this.emit("error",e),this.emit("close"),n()}}_read(){}_write(e,n,r){if(this.destroyed)return r(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(i){return this.destroy(i)}typeof xT!="function"&&this._ws.bufferedAmount>uG?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_handleOpen(){if(!(this.connected||this.destroyed)){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(n){return this.destroy(n)}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}typeof xT!="function"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}}_handleMessage(e){if(this.destroyed)return;let n=e.data;n instanceof ArrayBuffer&&(n=Mc.from(n)),this.push(n)}_handleClose(){this.destroyed||(this._debug("on close"),this.destroy())}_handleError(e){this.destroy(new Error(`Error connecting to ${this.url}`))}_handleFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this.connected?e():this.once("connect",e)}_onInterval(){if(!this._cb||!this._ws||this._ws.bufferedAmount>uG)return;this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],cXe.apply(null,e)}};Vne.WEBSOCKET_SUPPORT=!!dT;var dXe=Vne,zne={};(function(t){t.DEFAULT_ANNOUNCE_PEERS=50,t.MAX_ANNOUNCE_PEERS=82,t.binaryToHex=n=>(typeof n!="string"&&(n=String(n)),Mc.from(n,"binary").toString("hex")),t.hexToBinary=n=>(typeof n!="string"&&(n=String(n)),Mc.from(n,"hex").toString("binary")),t.parseUrl=n=>{const r=new URL(n.replace(/^udp:/,"http:"));return n.match(/^udp:/)&&Object.defineProperties(r,{href:{value:r.href.replace(/^http/,"udp")},protocol:{value:r.protocol.replace(/^http/,"udp")},origin:{value:r.origin.replace(/^http/,"udp")}}),r},Object.assign(t,Lj)})(zne);const hXe=wN;let fXe=class extends hXe{constructor(e,n){super(),this.client=e,this.announceUrl=n,this.interval=null,this.destroyed=!1}setInterval(e){e==null&&(e=this.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(this.interval),e&&(this.interval=setInterval(()=>{this.announce(this.client._defaultAnnounceOpts())},e),this.interval.unref&&this.interval.unref())}};var pXe=fXe;const mXe=a9e,wh=EN("bittorrent-tracker:websocket-tracker"),gXe=sXe,vXe=SN,_Xe=dXe,yXe=Lj,Av=zne,bXe=pXe,zm={},EXe=10*1e3,SXe=60*60*1e3,TXe=5*60*1e3,wXe=50*1e3;let Uj=class extends bXe{constructor(e,n){super(e,n),wh("new websocket tracker %s",n),this.peers={},this.socket=null,this.reconnecting=!1,this.retries=0,this.reconnectTimer=null,this.expectingResponse=!1,this._openSocket()}announce(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.announce(e)});return}const n=Object.assign({},e,{action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary});if(this._trackerId&&(n.trackerid=this._trackerId),e.event==="stopped"||e.event==="completed")this._send(n);else{const r=Math.min(e.numwant,5);this._generateOffers(r,i=>{n.numwant=r,n.offers=i,this._send(n)})}}scrape(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.scrape(e)});return}const r={action:"scrape",info_hash:Array.isArray(e.infoHash)&&e.infoHash.length>0?e.infoHash.map(i=>i.toString("binary")):e.infoHash&&e.infoHash.toString("binary")||this.client._infoHashBinary};this._send(r)}destroy(e=dG){if(this.destroyed)return e(null);this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer);for(const s in this.peers){const o=this.peers[s];clearTimeout(o.trackerTimeout),o.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,zm[this.announceUrl]&&(zm[this.announceUrl].consumers-=1),zm[this.announceUrl].consumers>0)return e();let n=zm[this.announceUrl];delete zm[this.announceUrl],n.on("error",dG),n.once("close",e);let r;if(!this.expectingResponse)return i();r=setTimeout(i,Av.DESTROY_TIMEOUT),n.once("data",i);function i(){r&&(clearTimeout(r),r=null),n.removeListener("data",i),n.destroy(),n=null}}_openSocket(){if(this.destroyed=!1,this.peers||(this.peers={}),this._onSocketConnectBound=()=>{this._onSocketConnect()},this._onSocketErrorBound=e=>{this._onSocketError(e)},this._onSocketDataBound=e=>{this._onSocketData(e)},this._onSocketCloseBound=()=>{this._onSocketClose()},this.socket=zm[this.announceUrl],this.socket)zm[this.announceUrl].consumers+=1,this.socket.connected&&this._onSocketConnectBound();else{const e=new URL(this.announceUrl);let n;this.client._proxyOpts&&(n=e.protocol==="wss:"?this.client._proxyOpts.httpsAgent:this.client._proxyOpts.httpAgent,!n&&this.client._proxyOpts.socksProxy&&(n=new yXe.Agent(mXe(this.client._proxyOpts.socksProxy),e.protocol==="wss:"))),this.socket=zm[this.announceUrl]=new _Xe({url:this.announceUrl,agent:n}),this.socket.consumers=1,this.socket.once("connect",this._onSocketConnectBound)}this.socket.on("data",this._onSocketDataBound),this.socket.once("close",this._onSocketCloseBound),this.socket.once("error",this._onSocketErrorBound)}_onSocketConnect(){this.destroyed||this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.announce(this.client._defaultAnnounceOpts()))}_onSocketData(e){if(!this.destroyed){this.expectingResponse=!1;try{e=JSON.parse(e)}catch{this.client.emit("warning",new Error("Invalid tracker response"));return}e.action==="announce"?this._onAnnounceResponse(e):e.action==="scrape"?this._onScrapeResponse(e):this._onSocketError(new Error(`invalid action in WS response: ${e.action}`))}}_onAnnounceResponse(e){if(e.info_hash!==this.client._infoHashBinary){wh("ignoring websocket data from %s for %s (looking for %s: reused socket)",this.announceUrl,Av.binaryToHex(e.info_hash),this.client.infoHash);return}if(e.peer_id&&e.peer_id===this.client._peerIdBinary)return;wh("received %s from %s for %s",JSON.stringify(e),this.announceUrl,this.client.infoHash);const n=e["failure reason"];if(n)return this.client.emit("warning",new Error(n));const r=e["warning message"];r&&this.client.emit("warning",new Error(r));const i=e.interval||e["min interval"];i&&this.setInterval(i*1e3);const s=e["tracker id"];if(s&&(this._trackerId=s),e.complete!=null){const a=Object.assign({},e,{announce:this.announceUrl,infoHash:Av.binaryToHex(e.info_hash)});this.client.emit("update",a)}let o;if(e.offer&&e.peer_id&&(wh("creating peer (from remote offer)"),o=this._createPeer(),o.id=Av.binaryToHex(e.peer_id),o.once("signal",a=>{const c={action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary,to_peer_id:e.peer_id,answer:a,offer_id:e.offer_id};this._trackerId&&(c.trackerid=this._trackerId),this._send(c)}),this.client.emit("peer",o),o.signal(e.offer)),e.answer&&e.peer_id){const a=Av.binaryToHex(e.offer_id);o=this.peers[a],o?(o.id=Av.binaryToHex(e.peer_id),this.client.emit("peer",o),o.signal(e.answer),clearTimeout(o.trackerTimeout),o.trackerTimeout=null,delete this.peers[a]):wh(`got unexpected answer: ${JSON.stringify(e.answer)}`)}}_onScrapeResponse(e){e=e.files||{};const n=Object.keys(e);if(n.length===0){this.client.emit("warning",new Error("invalid scrape response"));return}n.forEach(r=>{const i=Object.assign(e[r],{announce:this.announceUrl,infoHash:Av.binaryToHex(r)});this.client.emit("scrape",i)})}_onSocketClose(){this.destroyed||(this.destroy(),this._startReconnectTimer())}_onSocketError(e){this.destroyed||(this.destroy(),this.client.emit("warning",e),this._startReconnectTimer())}_startReconnectTimer(){const e=Math.floor(Math.random()*TXe)+Math.min(Math.pow(2,this.retries)*EXe,SXe);this.reconnecting=!0,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(()=>{this.retries++,this._openSocket()},e),this.reconnectTimer.unref&&this.reconnectTimer.unref(),wh("reconnecting socket in %s ms",e)}_send(e){if(this.destroyed)return;this.expectingResponse=!0;const n=JSON.stringify(e);wh("send %s",n),this.socket.send(n)}_generateOffers(e,n){const r=this,i=[];wh("generating %s offers",e);for(let a=0;a<e;++a)s();o();function s(){const a=vXe(20).toString("hex");wh("creating peer (from _generateOffers)");const c=r.peers[a]=r._createPeer({initiator:!0});c.once("signal",l=>{i.push({offer:l,offer_id:Av.hexToBinary(a)}),o()}),c.trackerTimeout=setTimeout(()=>{wh("tracker timeout: destroying peer"),c.trackerTimeout=null,delete r.peers[a],c.destroy()},wXe),c.trackerTimeout.unref&&c.trackerTimeout.unref()}function o(){i.length===e&&(wh("generated %s offers",e),n(i))}}_createPeer(e){const n=this;e=Object.assign({trickle:!1,config:n.client._rtcConfig,wrtc:n.client._wrtc},e);const r=new gXe(e);return r.once("error",i),r.once("connect",s),r;function i(o){n.client.emit("warning",new Error(`Connection error: ${o.message}`)),r.destroy()}function s(){r.removeListener("error",i),r.removeListener("connect",s)}}};Uj.prototype.DEFAULT_ANNOUNCE_INTERVAL=30*1e3;Uj._socketPool=zm;function dG(){}var xXe=Uj,Fj={exports:{}},Gne={exports:{}};(function(t,e){(function(r,i){t.exports=i()})(typeof self<"u"?self:Da,function(){return function(n){var r={};function i(s){if(r[s])return r[s].exports;var o=r[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=r,i.d=function(s,o,a){i.o(s,o)||Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:a})},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=3)}([function(n,r,i){function s(y,E){if(!(y instanceof E))throw new TypeError("Cannot call a class as a function")}var o=i(5),a=i(1),c=a.toHex,l=a.ceilHeapSize,u=i(6),d=function(y){for(y+=9;y%64>0;y+=1);return y},h=function(y,E){var w=new Uint8Array(y.buffer),R=E%4,A=E-R;switch(R){case 0:w[A+3]=0;case 1:w[A+2]=0;case 2:w[A+1]=0;case 3:w[A+0]=0}for(var k=(E>>2)+1;k<y.length;k++)y[k]=0},p=function(y,E,w){y[E>>2]|=128<<24-(E%4<<3),y[((E>>2)+2&-16)+14]=w/(1<<29)|0,y[((E>>2)+2&-16)+15]=w<<3},f=function(y,E){var w=new Int32Array(y,E+320,5),R=new Int32Array(5),A=new DataView(R.buffer);return A.setInt32(0,w[0],!1),A.setInt32(4,w[1],!1),A.setInt32(8,w[2],!1),A.setInt32(12,w[3],!1),A.setInt32(16,w[4],!1),R},g=function(){function y(E){if(s(this,y),E=E||64*1024,E%64>0)throw new Error("Chunk size must be a multiple of 128 bit");this._offset=0,this._maxChunkLen=E,this._padMaxChunkLen=d(E),this._heap=new ArrayBuffer(l(this._padMaxChunkLen+320+20)),this._h32=new Int32Array(this._heap),this._h8=new Int8Array(this._heap),this._core=new o({Int32Array},{},this._heap)}return y.prototype._initState=function(w,R){this._offset=0;var A=new Int32Array(w,R+320,5);A[0]=1732584193,A[1]=-271733879,A[2]=-1732584194,A[3]=271733878,A[4]=-1009589776},y.prototype._padChunk=function(w,R){var A=d(w),k=new Int32Array(this._heap,0,A>>2);return h(k,w),p(k,w,R),A},y.prototype._write=function(w,R,A,k){u(w,this._h8,this._h32,R,A,k||0)},y.prototype._coreCall=function(w,R,A,k,I){var N=A;this._write(w,R,A),I&&(N=this._padChunk(A,k)),this._core.hash(N,this._padMaxChunkLen)},y.prototype.rawDigest=function(w){var R=w.byteLength||w.length||w.size||0;this._initState(this._heap,this._padMaxChunkLen);var A=0,k=this._maxChunkLen;for(A=0;R>A+k;A+=k)this._coreCall(w,A,k,R,!1);return this._coreCall(w,A,R-A,R,!0),f(this._heap,this._padMaxChunkLen)},y.prototype.digest=function(w){return c(this.rawDigest(w).buffer)},y.prototype.digestFromString=function(w){return this.digest(w)},y.prototype.digestFromBuffer=function(w){return this.digest(w)},y.prototype.digestFromArrayBuffer=function(w){return this.digest(w)},y.prototype.resetState=function(){return this._initState(this._heap,this._padMaxChunkLen),this},y.prototype.append=function(w){var R=0,A=w.byteLength||w.length||w.size||0,k=this._offset%this._maxChunkLen,I=void 0;for(this._offset+=A;R<A;)I=Math.min(A-R,this._maxChunkLen-k),this._write(w,R,I,k),k+=I,R+=I,k===this._maxChunkLen&&(this._core.hash(this._maxChunkLen,this._padMaxChunkLen),k=0);return this},y.prototype.getState=function(){var w=this._offset%this._maxChunkLen,R=void 0;if(w)R=this._heap.slice(0);else{var A=new Int32Array(this._heap,this._padMaxChunkLen+320,5);R=A.buffer.slice(A.byteOffset,A.byteOffset+A.byteLength)}return{offset:this._offset,heap:R}},y.prototype.setState=function(w){if(this._offset=w.offset,w.heap.byteLength===20){var R=new Int32Array(this._heap,this._padMaxChunkLen+320,5);R.set(new Int32Array(w.heap))}else this._h32.set(new Int32Array(w.heap));return this},y.prototype.rawEnd=function(){var w=this._offset,R=w%this._maxChunkLen,A=this._padChunk(R,w);this._core.hash(A,this._padMaxChunkLen);var k=f(this._heap,this._padMaxChunkLen);return this._initState(this._heap,this._padMaxChunkLen),k},y.prototype.end=function(){return c(this.rawEnd().buffer)},y}();n.exports=g,n.exports._core=o},function(n,r){for(var i=new Array(256),s=0;s<256;s++)i[s]=(s<16?"0":"")+s.toString(16);n.exports.toHex=function(o){for(var a=new Uint8Array(o),c=new Array(o.byteLength),l=0;l<c.length;l++)c[l]=i[a[l]];return c.join("")},n.exports.ceilHeapSize=function(o){var a=0;if(o<=65536)return 65536;if(o<16777216)for(a=1;a<o;a=a<<1);else for(a=16777216;a<o;a+=16777216);return a},n.exports.isDedicatedWorkerScope=function(o){var a="WorkerGlobalScope"in o&&o instanceof o.WorkerGlobalScope,c="SharedWorkerGlobalScope"in o&&o instanceof o.SharedWorkerGlobalScope,l="ServiceWorkerGlobalScope"in o&&o instanceof o.ServiceWorkerGlobalScope;return a&&!c&&!l}},function(n,r,i){n.exports=function(){var s=i(0),o=function(l,u,d){try{return d(null,l.digest(u))}catch(h){return d(h)}},a=function(l,u,d,h,p){var f=new self.FileReader;f.onloadend=function(){if(f.error)return p(f.error);var y=f.result;u+=f.result.byteLength;try{l.append(y)}catch(E){p(E);return}u<h.size?a(l,u,d,h,p):p(null,l.end())},f.readAsArrayBuffer(h.slice(u,u+d))},c=!0;return self.onmessage=function(l){if(c){var u=l.data.data,d=l.data.file,h=l.data.id;if(!(typeof h>"u")&&!(!d&&!u)){var p=l.data.blockSize||4*1024*1024,f=new s(p);f.resetState();var g=function(y,E){y?self.postMessage({id:h,error:y.name}):self.postMessage({id:h,hash:E})};u&&o(f,u,g),d&&a(f,0,p,d,g)}}},function(){c=!1}}},function(n,r,i){var s=i(4),o=i(0),a=i(7),c=i(2),l=i(1),u=l.isDedicatedWorkerScope,d=typeof self<"u"&&u(self);o.disableWorkerBehaviour=d?c():function(){},o.createWorker=function(){var h=s(2),p=h.terminate;return h.terminate=function(){URL.revokeObjectURL(h.objectURL),p.call(h)},h},o.createHash=a,n.exports=o},function(n,r,i){function s(h){var p={};function f(y){if(p[y])return p[y].exports;var E=p[y]={i:y,l:!1,exports:{}};return h[y].call(E.exports,E,E.exports,f),E.l=!0,E.exports}f.m=h,f.c=p,f.i=function(y){return y},f.d=function(y,E,w){f.o(y,E)||Object.defineProperty(y,E,{configurable:!1,enumerable:!0,get:w})},f.r=function(y){Object.defineProperty(y,"__esModule",{value:!0})},f.n=function(y){var E=y&&y.__esModule?function(){return y.default}:function(){return y};return f.d(E,"a",E),E},f.o=function(y,E){return Object.prototype.hasOwnProperty.call(y,E)},f.p="/",f.oe=function(y){throw console.error(y),y};var g=f(f.s=ENTRY_MODULE);return g.default||g}var o="[\\.|\\-|\\+|\\w|/|@]+",a="\\((/\\*.*?\\*/)?s?.*?("+o+").*?\\)";function c(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function l(h,p,f){var g={};g[f]=[];var y=p.toString(),E=y.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!E)return g;for(var w=E[1],R=new RegExp("(\\\\n|\\W)"+c(w)+a,"g"),A;A=R.exec(y);)A[3]!=="dll-reference"&&g[f].push(A[3]);for(R=new RegExp("\\("+c(w)+'\\("(dll-reference\\s('+o+'))"\\)\\)'+a,"g");A=R.exec(y);)h[A[2]]||(g[f].push(A[1]),h[A[2]]=i(A[1]).m),g[A[2]]=g[A[2]]||[],g[A[2]].push(A[4]);return g}function u(h){var p=Object.keys(h);return p.reduce(function(f,g){return f||h[g].length>0},!1)}function d(h,p){for(var f={main:[p]},g={main:[]},y={main:{}};u(f);)for(var E=Object.keys(f),w=0;w<E.length;w++){var R=E[w],A=f[R],k=A.pop();if(y[R]=y[R]||{},!(y[R][k]||!h[R][k])){y[R][k]=!0,g[R]=g[R]||[],g[R].push(k);for(var I=l(h,h[R][k],R),N=Object.keys(I),U=0;U<N.length;U++)f[N[U]]=f[N[U]]||[],f[N[U]]=f[N[U]].concat(I[N[U]])}}return g}n.exports=function(h,p){p=p||{};var f={main:i.m},g=p.all?{main:Object.keys(f)}:d(f,h),y="";Object.keys(g).filter(function(k){return k!=="main"}).forEach(function(k){for(var I=0;g[k][I];)I++;g[k].push(I),f[k][I]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",y=y+"var "+k+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(I))+")({"+g[k].map(function(N){return""+JSON.stringify(N)+": "+f[k][N].toString()}).join(",")+`});
`}),y=y+"("+s.toString().replace("ENTRY_MODULE",JSON.stringify(h))+")({"+g.main.map(function(k){return""+JSON.stringify(k)+": "+f.main[k].toString()}).join(",")+"})(self);";var E=new window.Blob([y],{type:"text/javascript"});if(p.bare)return E;var w=window.URL||window.webkitURL||window.mozURL||window.msURL,R=w.createObjectURL(E),A=new window.Worker(R);return A.objectURL=R,A}},function(n,r){n.exports=function(s,o,a){var c=new s.Int32Array(a);function l(u,d){u=u|0,d=d|0;var h=0,p=0,f=0,g=0,y=0,E=0,w=0,R=0,A=0,k=0,I=0,N=0,U=0,F=0;for(f=c[d+320>>2]|0,y=c[d+324>>2]|0,w=c[d+328>>2]|0,A=c[d+332>>2]|0,I=c[d+336>>2]|0,h=0;(h|0)<(u|0);h=h+64|0){for(g=f,E=y,R=w,k=A,N=I,p=0;(p|0)<64;p=p+4|0)F=c[h+p>>2]|0,U=((f<<5|f>>>27)+(y&w|~y&A)|0)+((F+I|0)+1518500249|0)|0,I=A,A=w,w=y<<30|y>>>2,y=f,f=U,c[u+p>>2]=F;for(p=u+64|0;(p|0)<(u+80|0);p=p+4|0)F=(c[p-12>>2]^c[p-32>>2]^c[p-56>>2]^c[p-64>>2])<<1|(c[p-12>>2]^c[p-32>>2]^c[p-56>>2]^c[p-64>>2])>>>31,U=((f<<5|f>>>27)+(y&w|~y&A)|0)+((F+I|0)+1518500249|0)|0,I=A,A=w,w=y<<30|y>>>2,y=f,f=U,c[p>>2]=F;for(p=u+80|0;(p|0)<(u+160|0);p=p+4|0)F=(c[p-12>>2]^c[p-32>>2]^c[p-56>>2]^c[p-64>>2])<<1|(c[p-12>>2]^c[p-32>>2]^c[p-56>>2]^c[p-64>>2])>>>31,U=((f<<5|f>>>27)+(y^w^A)|0)+((F+I|0)+1859775393|0)|0,I=A,A=w,w=y<<30|y>>>2,y=f,f=U,c[p>>2]=F;for(p=u+160|0;(p|0)<(u+240|0);p=p+4|0)F=(c[p-12>>2]^c[p-32>>2]^c[p-56>>2]^c[p-64>>2])<<1|(c[p-12>>2]^c[p-32>>2]^c[p-56>>2]^c[p-64>>2])>>>31,U=((f<<5|f>>>27)+(y&w|y&A|w&A)|0)+((F+I|0)-1894007588|0)|0,I=A,A=w,w=y<<30|y>>>2,y=f,f=U,c[p>>2]=F;for(p=u+240|0;(p|0)<(u+320|0);p=p+4|0)F=(c[p-12>>2]^c[p-32>>2]^c[p-56>>2]^c[p-64>>2])<<1|(c[p-12>>2]^c[p-32>>2]^c[p-56>>2]^c[p-64>>2])>>>31,U=((f<<5|f>>>27)+(y^w^A)|0)+((F+I|0)-899497514|0)|0,I=A,A=w,w=y<<30|y>>>2,y=f,f=U,c[p>>2]=F;f=f+g|0,y=y+E|0,w=w+R|0,A=A+k|0,I=I+N|0}c[d+320>>2]=f,c[d+324>>2]=y,c[d+328>>2]=w,c[d+332>>2]=A,c[d+336>>2]=I}return{hash:l}}},function(n,r){var i=this,s=void 0;typeof self<"u"&&typeof self.FileReaderSync<"u"&&(s=new self.FileReaderSync);var o=function(l,u,d,h,p,f){var g=void 0,y=f%4,E=(p+y)%4,w=p-E;switch(y){case 0:u[f]=l.charCodeAt(h+3);case 1:u[f+1-(y<<1)|0]=l.charCodeAt(h+2);case 2:u[f+2-(y<<1)|0]=l.charCodeAt(h+1);case 3:u[f+3-(y<<1)|0]=l.charCodeAt(h)}if(!(p<E+(4-y))){for(g=4-y;g<w;g=g+4|0)d[f+g>>2]=l.charCodeAt(h+g)<<24|l.charCodeAt(h+g+1)<<16|l.charCodeAt(h+g+2)<<8|l.charCodeAt(h+g+3);switch(E){case 3:u[f+w+1|0]=l.charCodeAt(h+w+2);case 2:u[f+w+2|0]=l.charCodeAt(h+w+1);case 1:u[f+w+3|0]=l.charCodeAt(h+w)}}},a=function(l,u,d,h,p,f){var g=void 0,y=f%4,E=(p+y)%4,w=p-E;switch(y){case 0:u[f]=l[h+3];case 1:u[f+1-(y<<1)|0]=l[h+2];case 2:u[f+2-(y<<1)|0]=l[h+1];case 3:u[f+3-(y<<1)|0]=l[h]}if(!(p<E+(4-y))){for(g=4-y;g<w;g=g+4|0)d[f+g>>2|0]=l[h+g]<<24|l[h+g+1]<<16|l[h+g+2]<<8|l[h+g+3];switch(E){case 3:u[f+w+1|0]=l[h+w+2];case 2:u[f+w+2|0]=l[h+w+1];case 1:u[f+w+3|0]=l[h+w]}}},c=function(l,u,d,h,p,f){var g=void 0,y=f%4,E=(p+y)%4,w=p-E,R=new Uint8Array(s.readAsArrayBuffer(l.slice(h,h+p)));switch(y){case 0:u[f]=R[3];case 1:u[f+1-(y<<1)|0]=R[2];case 2:u[f+2-(y<<1)|0]=R[1];case 3:u[f+3-(y<<1)|0]=R[0]}if(!(p<E+(4-y))){for(g=4-y;g<w;g=g+4|0)d[f+g>>2|0]=R[g]<<24|R[g+1]<<16|R[g+2]<<8|R[g+3];switch(E){case 3:u[f+w+1|0]=R[w+2];case 2:u[f+w+2|0]=R[w+1];case 1:u[f+w+3|0]=R[w]}}};n.exports=function(l,u,d,h,p,f){if(typeof l=="string")return o(l,u,d,h,p,f);if(l instanceof Array||i&&i.Buffer&&i.Buffer.isBuffer(l))return a(l,u,d,h,p,f);if(l instanceof ArrayBuffer)return a(new Uint8Array(l),u,d,h,p,f);if(l.buffer instanceof ArrayBuffer)return a(new Uint8Array(l.buffer,l.byteOffset,l.byteLength),u,d,h,p,f);if(l instanceof Blob)return c(l,u,d,h,p,f);throw new Error("Unsupported data type.")}},function(n,r,i){var s=function(){function d(h,p){for(var f=0;f<p.length;f++){var g=p[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(h,g.key,g)}}return function(h,p,f){return p&&d(h.prototype,p),f&&d(h,f),h}}();function o(d,h){if(!(d instanceof h))throw new TypeError("Cannot call a class as a function")}var a=i(0),c=i(1),l=c.toHex,u=function(){function d(){o(this,d),this._rusha=new a,this._rusha.resetState()}return d.prototype.update=function(p){return this._rusha.append(p),this},d.prototype.digest=function(p){var f=this._rusha.rawEnd().buffer;if(!p)return f;if(p==="hex")return l(f);throw new Error("unsupported digest encoding")},s(d,[{key:"state",get:function(){return this._rusha.getState()},set:function(h){this._rusha.setState(h)}}]),d}();n.exports=function(){return new u}}])})})(Gne);var Wne=Gne.exports;const CXe=Wne;let WA,mR,gR;function RXe(){WA=CXe.createWorker(),mR=1,gR={},WA.onmessage=function(e){const n=e.data.id,r=gR[n];delete gR[n],e.data.error!=null?r(new Error("Rusha worker error: "+e.data.error)):r(null,e.data.hash)}}function AXe(t,e){WA||RXe(),gR[mR]=e,WA.postMessage({id:mR,data:t}),mR+=1}var MXe=AXe;const IXe=Wne,OXe=MXe,kXe=new IXe,hG=typeof window<"u"?window:self,fG=hG.crypto||hG.msCrypto||{};let CT=fG.subtle||fG.webkitSubtle;function vR(t){return kXe.digest(t)}try{CT.digest({name:"sha-1"},new Uint8Array).catch(function(){CT=!1})}catch{CT=!1}function NXe(t,e){if(!CT){typeof window<"u"?OXe(t,function(r,i){if(r){e(vR(t));return}e(i)}):queueMicrotask(()=>e(vR(t)));return}typeof t=="string"&&(t=PXe(t)),CT.digest({name:"sha-1"},t).then(function(r){e(DXe(new Uint8Array(r)))},function(){e(vR(t))})}function PXe(t){const e=t.length,n=new Uint8Array(e);for(let r=0;r<e;r++)n[r]=t.charCodeAt(r);return n}function DXe(t){const e=t.length,n=[];for(let r=0;r<e;r++){const i=t[r];n.push((i>>>4).toString(16)),n.push((i&15).toString(16))}return n.join("")}Fj.exports=NXe;Fj.exports.sync=vR;var LXe=Fj.exports;const pG=xXe,UXe=SN,FXe=wN,BXe=LXe,JS=EN("p2pt"),mG="^",gG=16e3;class jXe extends FXe{constructor(e=[],n=""){super(),this.announceURLs=e,this.trackers={},this.peers={},this.msgChunks={},this.responseWaiting={},n&&this.setIdentifier(n),this._peerIdBuffer=UXe(20),this._peerId=this._peerIdBuffer.toString("hex"),this._peerIdBinary=this._peerIdBuffer.toString("binary"),JS("my peer id: "+this._peerId)}setIdentifier(e){this.identifierString=e,this.infoHash=BXe.sync(e).toLowerCase(),this._infoHashBuffer=Mc.from(this.infoHash,"hex"),this._infoHashBinary=this._infoHashBuffer.toString("binary")}start(){this.on("peer",e=>{let n=!1;this.peers[e.id]||(n=!0,this.peers[e.id]={},this.responseWaiting[e.id]={}),e.on("connect",()=>{this.peers[e.id][e.channelName]=e,n&&this.emit("peerconnect",e)}),e.on("data",r=>{if(this.emit("data",e,r),r=r.toString(),JS("got a message from "+e.id),r[0]===mG)try{r=JSON.parse(r.slice(1)),e.respond=this._peerRespond(e,r.id);let i=this._chunkHandler(r);i!==!1&&(r.o&&(i=JSON.parse(i)),this.responseWaiting[e.id][r.id]?(this.responseWaiting[e.id][r.id]([e,i]),delete this.responseWaiting[e.id][r.id]):this.emit("msg",e,i),this._destroyChunks(r.id))}catch(i){console.log(i)}}),e.on("error",r=>{this._removePeer(e),JS("Error in connection : "+r)}),e.on("close",()=>{this._removePeer(e),JS("Connection closed with "+e.id)})}),this.on("update",e=>{const n=this.trackers[this.announceURLs.indexOf(e.announce)];this.emit("trackerconnect",n,this.getTrackerStats())}),this.on("warning",e=>{this.emit("trackerwarning",e,this.getTrackerStats())}),this._fetchPeers()}addTracker(e){if(this.announceURLs.indexOf(e)!==-1)throw new Error("Tracker already added");const n=this.announceURLs.push(e);this.trackers[n]=new pG(this,e),this.trackers[n].announce(this._defaultAnnounceOpts())}removeTracker(e){const n=this.announceURLs.indexOf(e);if(n===-1)throw new Error("Tracker does not exist");this.trackers[n].peers=[],this.trackers[n].destroy(),delete this.trackers[n],delete this.announceURLs[n]}_removePeer(e){if(!this.peers[e.id])return!1;delete this.peers[e.id][e.channelName],Object.keys(this.peers[e.id]).length===0&&(this.emit("peerclose",e),delete this.responseWaiting[e.id],delete this.peers[e.id])}send(e,n,r=""){return new Promise((i,s)=>{const o={id:r!==""?r:Math.floor(Math.random()*1e5+1e5),msg:n};typeof n=="object"&&(o.msg=JSON.stringify(n),o.o=1);try{if(!e.connected){for(const l in this.peers[e.id])if(e=this.peers[e.id][l],e.connected)break}this.responseWaiting[e.id]||(this.responseWaiting[e.id]={}),this.responseWaiting[e.id][o.id]=i}catch(l){return s(Error("Connection to peer closed"+l))}let a=0,c="";for(;o.msg.length>0;)o.c=a,c=o.msg.slice(gG),o.msg=o.msg.slice(0,gG),c||(o.last=!0),e.send(mG+JSON.stringify(o)),o.msg=c,a++;JS("sent a message to "+e.id)})}requestMorePeers(){return new Promise(e=>{for(const n in this.trackers)this.trackers[n].announce(this._defaultAnnounceOpts());e(this.peers)})}getTrackerStats(){let e=0;for(const n in this.trackers)this.trackers[n].socket&&this.trackers[n].socket.connected&&e++;return{connected:e,total:this.announceURLs.length}}destroy(){let e;for(e in this.peers)for(const n in this.peers[e])this.peers[e][n].destroy();for(e in this.trackers)this.trackers[e].destroy()}_peerRespond(e,n){return r=>this.send(e,r,n)}_chunkHandler(e){return this.msgChunks[e.id]||(this.msgChunks[e.id]=[]),this.msgChunks[e.id][e.c]=e.msg,e.last?this.msgChunks[e.id].join(""):!1}_destroyChunks(e){delete this.msgChunks[e]}_defaultAnnounceOpts(e={}){return e.numwant==null&&(e.numwant=50),e.uploaded==null&&(e.uploaded=0),e.downloaded==null&&(e.downloaded=0),e}_fetchPeers(){for(const e in this.announceURLs)this.trackers[e]=new pG(this,this.announceURLs[e]),this.trackers[e].announce(this._defaultAnnounceOpts())}}var $Xe=jXe;const HXe=Nl($Xe);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const qA=[];for(let t=0;t<256;t++)t<16&&(t<10?qA[48+t]=t:qA[87+t]=t);const VXe=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=qA[t.charCodeAt(s++)]<<4|qA[t.charCodeAt(s++)];return r};var vG="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zXe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var lC=0;lC<vG.length;lC++)zXe[vG.charCodeAt(lC)]=lC;new TextDecoder;new TextEncoder;const _G=typeof window<"u"?window:self,yG=_G.crypto||_G.msCrypto||{};yG.subtle||yG.webkitSubtle;const GXe=`
wss://tracker.btorrent.xyz
wss://tracker.webtorrent.dev
wss://tracker.openwebtorrent.com
`.split(`
`).map(t=>t.trim()).filter(t=>t);function RS(t){return VXe(t)}const WXe="hubworld_4de3dec56c4ccc6d59a3e73a2c60f3966e7f4af8",Qu=new HXe(GXe,WXe),$x=new o9e(RS(Qu._peerId),{getId(t){return t.id}});Qu.on("peerconnect",t=>{Ar(qe,`remote connected ${t.id}`),$x.add({id:RS(t.id),peer:t})});Qu.on("peerclose",t=>{Ar(qe,`remote closed ${t.id}`),$x.remove(RS(t.id))});let _R="";const bG=new Map;Qu.on("msg",(t,e)=>{const n=Date.now(),r=bG.get(e.topic)??new Map;if("pub"in e){e.topic===_R&&(jv==null||jv.forward({...e.gme,session:qe.session()}));for(const[i,s]of r)if(n-s>1e3*60)r.delete(i);else{const[a]=$x.listClosestToId(RS(i),1);he(a)&&Qu.send(a.peer,e).catch(console.error)}}else"sub"in e&&(r.set(e.sub,n),e.topic===_R&&Qu._peerId===_R?jv==null||jv.forward({...e.gme,session:qe.session()}):he(e.gme)&&Bj(e.topic,e.sub,e.gme));bG.set(e.topic,r)});Qu.on("trackerconnect",(t,e)=>{Ar(qe,`looking for players ${t.announceUrl} [${e.connected}]`)});let EG=!1,jv;function qne(t){EG||(EG=!0,_R=t,Qu.start(),Ar(qe,`connecting to hubworld for ${t}`))}function pL(t,e){const[n]=$x.listClosestToId(RS(t),1);he(n)&&Qu.send(n.peer,{topic:t,pub:!0,gme:e}).catch(console.error)}function qXe(t,e){const n=Qu._peerId;qne(n),mde(qe,t,n,e),jv=Z3(r=>{switch(r.target){case"tape:info":case"tape:error":case"tape:debug":case"tape:terminal:open":case"tape:terminal:close":case"tape:terminal:toggle":case"tape:terminal:inclayout":case"tape:terminal:crash":case"register:loginready":case"synth:audioenabled":case"synth:tts":case"synth:play":case"synth:bpm":case"synth:mainvolume":case"synth:drumvolume":case"synth:ttsvolume":case"synth:voice":case"synth:voicefx":case"gadgetclient:paint":case"gadgetclient:patch":pL(n,r);break;default:{const i=r.target.split(":"),[s]=i;switch(s){case"error":console.info(r.target),pL(n,r);break}const[o]=i.slice(-1);switch(o){case"acklogin":case"acklogout":console.info(r.target),pL(n,r);break}break}}})}function Bj(t,e,n){const[r]=$x.listClosestToId(RS(t),1);he(r)&&Qu.send(r.peer,{topic:t,sub:e,gme:n}).catch(console.error)}function Kne(t,e){Bj(t,Qu._peerId,ZW(qe.session(),"vm:joinack",qe.id(),t,e)),setTimeout(()=>Kne(t,e),1e3*3)}function KXe(t,e){qne(t),Kne(t,e),jv=Z3(n=>{switch(n.target){case"vm:cli":case"vm:doot":case"vm:input":case"vm:login":case"vm:joinack":case"gadgetserver:desync":case"gadgetserver:clearscroll":Bj(t,Qu._peerId,n);break}})}async function YXe(t,e,n,r,i){let s;switch(rr(r)){case"get":{s=await fetch(n);break}case"post:json":{const c=[];for(let l=0;l<i.length;l+=2)c.push([i[l],i[l+1]]);s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(rde(c))});break}}if(!(s!=null&&s.ok))return;const o=`fetch:${e}`,[a]=(s.headers.get("content-type")??"").split(";");switch(a){case"text/plain":{const c=await s.text();Ar(qe,JSON.stringify(c)),tg(qe,t,"text",o,c,Ni());break}case"application/json":{const c=await s.json();Ar(qe,JSON.stringify(c)),tg(qe,t,"json",o,c,Ni());break}case"application/octet-stream":{const c=await s.arrayBuffer();tg(qe,t,"binary",o,new Uint8Array(c),Ni());break}}}const uC=Xh("network",[],t=>{if(uC.session(t))switch(t.target){case"fetch":if(qr(t.data)){const[e,n,r,i,s]=t.data;eu(qe,async()=>{await YXe(e,n,r,i,s)})}break;case"start":t.player===Ni()&&qXe(!!t.data,t.player);break;case"join":t.player===Ni()&&nr(t.data)&&KXe(t.data,t.player);break;case"showjoincode":{eu(uC,async()=>{if(t.player===Ni()&&qr(t.data)){const[e,n]=t.data,r=`${location.origin}/join/#${n}`,i=await GU(r);e?qR(uC,i,"secret join url",!1):qR(uC,i,i)}});break}}}),XXe=["$brown$153","$purple$5","$green$42","$ltgray$94","$white$24","$white$25","$white$26","$white$27","$white$16","$white$17","$white$30","$white$31","$red$234","$cyan$227","$dkpurple$227"];function JXe(t){return qr(t.data)?[t.sender,...t.data.map(e=>`${e}`)].join(" "):""}function mL(t){const{terminal:e}=Us.getState();let n=[[Po(),t.target,T9(t.sender,XXe),...t.data],...e.logs];n.length>F8&&(n=n.slice(0,F8)),Us.setState(r=>({terminal:{...r.terminal,logs:n}}))}function QXe(t){const{layout:e,editor:n}=Us.getState();let i=e+(t?1:-1);if(i<0&&(i+=zu.MAX),i>=zu.MAX&&(i-=zu.MAX),!n.open)switch(i){case zu.SPLIT_Y:case zu.SPLIT_Y_ALT:i=zu.TOP;break}Us.setState({layout:i})}const gL=Xh("tape",[],t=>{if(!gL.session(t))return;const{terminal:e}=Us.getState();switch(t.target){case"inspector":t.player===Ni()&&Us.setState(n=>{const r=he(t.data)?!!t.data:!n.inspector;return Ar(gL,`gadget inspector ${r?"$greenon":"$redoff"}`),r&&Ar(gL,"mouse click or tap elements to inspect"),{inspector:r}});break;case"info":e.level>=QC.INFO&&mL(t);break;case"debug":e.level>=QC.DEBUG&&mL(t);break;case"error":e.level>QC.OFF&&mL(t),console.error(JXe(t));break;case"crash":Us.setState(n=>({layout:zu.FULL,terminal:{...n.terminal,open:!0}}));break;case"terminal:open":t.player===Ni()&&Us.setState(n=>({terminal:{...n.terminal,open:!0}}));break;case"terminal:quickopen":t.player===Ni()&&Us.setState({quickterminal:!0});break;case"terminal:close":t.player===Ni()&&Us.setState(n=>({quickterminal:!1,terminal:{...n.terminal,open:!1}}));break;case"terminal:toggle":t.player===Ni()&&Us.setState(n=>({terminal:{...n.terminal,open:!n.terminal.open}}));break;case"terminal:inclayout":t.player===Ni()&&ide(t.data)&&QXe(t.data);break;case"editor:open":if(qr(t.data)&&he(t.player)){const{player:n}=t,[r,i,s,o]=t.data??["","",""];Us.setState(()=>({editor:{open:!0,player:n,book:r,path:i,type:s,title:o}}))}break;case"editor:close":Us.setState(n=>({editor:{...n.editor,open:!1}}));break}});function ZXe(){const{viewport:t}=lS(),{width:e,height:n}=t.getCurrentViewport(),[r]=ft.useState(()=>new pze);ft.useEffect(()=>{if(!Lye)return;document.body.appendChild(r.dom),r.showPanel(0),r.dom.style.cssText="position:fixed;bottom:0;left:0;";const h=vue(()=>r.begin()),p=_ue(()=>r.end());return()=>{document.body.removeChild(r.dom),h(),p()}},[r]);const[i,s]=ft.useState();ft.useEffect(()=>{eu(qe,async()=>{const h=await oze();s(h)})},[]);const a=Math.min(e,n)<600||Bye;ar.DRAW_CHAR_SCALE=a?1:2;const c=e>n,l=jye||dF==="touchOnly"||hze==="touch",u=J4(Tze);u.minFilter=jo,u.magFilter=jo;const d=!Fye&&!a&&!l&&i&&i.tier>2&&!i.isMobile;return ft.useEffect(()=>{ou.setState(h=>({...h,islowrez:a,islandscape:c,showtouchcontrols:l}))},[a,c,l]),De.jsxs(De.Fragment,{children:[De.jsx(Oy,{children:De.jsxs(JGe,{children:[De.jsx(QGe,{}),De.jsx(TWe,{})]})}),d&&De.jsx(Z8e,{children:De.jsx(Sze,{splat:u,viewheight:n})})]})}EW({BufferGeometry:Yh,Group:eT,Mesh:Dh,MeshBasicMaterial:JF,OrthographicCamera:QF,PlaneGeometry:Tw,Points:Ble});document.addEventListener("keydown",()=>{SS()});window.addEventListener("touchstart",()=>{SS()});window.addEventListener("click",()=>{SS()});window.addEventListener("dragover",t=>{t.preventDefault()});window.addEventListener("contextmenu",t=>{SS(),t.preventDefault()});window.addEventListener("paste",t=>{var n;if(!((n=t.clipboardData)!=null&&n.files.length))return;SS(),t.preventDefault(),[...t.clipboardData.files].forEach(r=>tg(qe,void 0,"file",`file:${r.name}`,r,Ni()))});window.addEventListener("drop",t=>{var e,n;SS(),t.preventDefault(),(e=t.dataTransfer)!=null&&e.items?[...t.dataTransfer.items].forEach(i=>{if(i.kind==="file"){const s=i.getAsFile();he(s)&&tg(qe,void 0,"file",s.name,s,Ni())}}):[...((n=t.dataTransfer)==null?void 0:n.files)??[]].forEach(i=>tg(qe,void 0,"file",i.name,i,Ni()))});function eJe(){return De.jsx(ZXe,{})}Oue();const dC=new ht,SG=new ht,tJe=t=>({...Cue(t),filter:e=>{const n=e.filter(o=>!(!o.object.visible||(o.object.userData.clippingPlanes??[]).some(c=>(c.projectPoint(o.point,dC),SG.subVectors(o.point,dC).normalize().round(),dC.copy(c.normal).round(),dC.equals(SG)===!1)))),r=n.findIndex(o=>o.object.userData.blocking),i=r===-1?n:n.slice(0,r+1);let s="default";return i.some(o=>o.object.userData.cursor?(s=o.object.userData.cursor,!0):!1),document.querySelectorAll("html, body").forEach(o=>{o.style.cursor=s}),i}}),TG=document.querySelector("canvas");if(he(TG)){const t=Tue(TG),e=(r,i)=>{const s=cH(r),o=cH(i);t.configure({...Gc({flat:!0,linear:!0,shadows:!1,gl:{alpha:!1,stencil:!1,antialias:!1,powerPreference:"low-power",preserveDrawingBuffer:!0}}),events:tJe,size:{width:s,height:o,top:0,left:0},onCreated({gl:a}){a.localClippingEnabled=!0}})},n=Aue(e,256);window.addEventListener("resize",()=>{n(window.innerWidth,window.innerHeight)}),e(window.innerWidth,window.innerHeight),t.render(De.jsx(eJe,{}))}});export default nJe();

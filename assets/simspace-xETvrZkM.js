var yj=Object.defineProperty;var bj=(gi,Gn,Nn)=>Gn in gi?yj(gi,Gn,{enumerable:!0,configurable:!0,writable:!0,value:Nn}):gi[Gn]=Nn;var Mt=(gi,Gn,Nn)=>bj(gi,typeof Gn!="symbol"?Gn+"":Gn,Nn);(function(){"use strict";const gi=new Set,Gn={emit(t,e,n,r,i){Gn.invoke(kv(t,e,n,r,i))},invoke(t){gi.forEach(e=>e.handle(t))},connect(t){gi.add(t)},disconnect(t){gi.delete(t)}};var Nn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function no(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Kx(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var vp={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Nn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(vp);var Wx=vp.exports,kp=no(Wx),Tp={};(function(t){var e=Nn&&Nn.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,p;d<h;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,b=l.addAdverb,y=b===void 0?!1:b,k=e(e(e([],e([],Array(m),!0).map(function(A){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),y?[n(t.adverbs)]:[],!0);return h&&(k=k.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),k.join(f)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return t.adjectives.length*f*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*f+f*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(h?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*f+f*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(h?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(Tp);var Ap=no(Tp);const Hx="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Gx=t=>crypto.getRandomValues(new Uint8Array(t)),Yx=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Rp=(t,e=21)=>Yx(t,e,Gx),Vx=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Hx[n[t]&63];return e};var Sp="abcdefghijklmnopqrstuvwxyz",Op="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Ip="0123456789",Zx="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Xx="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const qx=Ip,Jx=Sp,Qx=Op;var tv=qx+Jx+Qx,gh={lowercase:Sp,uppercase:Op,numbers:Ip,nolookalikes:Zx,nolookalikesSafe:Xx,alphanumeric:tv};function Me(){return`sid_${Vx(12).replaceAll("-",".")}`}Rp(gh.numbers,4),Rp(`${gh.numbers}${gh.lowercase}`,16);function Rr(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function ev(){return Ap({capitalize:!1,adjectiveCount:1})}function nv(){return Ap({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var rv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),iv=Object.prototype.hasOwnProperty;function _h(t,e){return iv.call(t,e)}function yh(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)_h(t,i)&&r.push(i);return r}function Cn(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function bh(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function bs(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Np(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function wh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(wh(t[e]))return!0}else if(typeof t=="object"){for(var r=yh(t),i=r.length,s=0;s<i;s++)if(wh(t[r[s]]))return!0}}return!1}function Cp(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Lp=function(t){rv(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,Cp(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Cp(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),Ue=Lp,sv=Cn,ro={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=$c(n,this.path);r&&(r=Cn(r));var i=ws(n,{op:"remove",path:this.from}).removed;return ws(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=$c(n,this.from);return ws(n,{op:"add",path:this.path,value:Cn(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:ga(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},ov={add:function(t,e,n){return bh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:ro.move,copy:ro.copy,test:ro.test,_get:ro._get};function $c(t,e){if(e=="")return t;var n={op:"_get",path:e};return ws(t,n),n.value}function ws(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):jc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=$c(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=ga(t,e.value),o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new Ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Cn(t));var a=e.path||"",c=a.split("/"),l=t,u=1,f=c.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=jc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Np(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!bh(h))throw new Ue("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);bh(h)&&(h=~~h)}if(u>=f){if(n&&e.op==="add"&&h>l.length)throw new Ue("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=ov[e.op].call(e,l,h,t);if(o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=f){var o=ro[e.op].call(e,l,h,t);if(o.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Ue("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function Eh(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new Ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Cn(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=ws(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function av(t,e,n){var r=ws(t,e);if(r.test===!1)throw new Ue("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function jc(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Ue("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(ro[t.op]){if(typeof t.path!="string")throw new Ue("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Ue('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Ue("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&wh(t.value))throw new Ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Ue("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Ue("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Mp([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ue("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new Ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Mp(t,e,n){try{if(!Array.isArray(t))throw new Ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Eh(Cn(e),Cn(t),n||!0);else{n=n||jc;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof Ue)return i;throw i}}function ga(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!ga(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ga(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var cv=Object.freeze({__proto__:null,JsonPatchError:Ue,_areEquals:ga,applyOperation:ws,applyPatch:Eh,applyReducer:av,deepClone:sv,getValueByPointer:$c,validate:Mp,validator:jc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var xh=new WeakMap,lv=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),uv=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function hv(t){return xh.get(t)}function fv(t,e){return t.observers.get(e)}function dv(t,e){t.observers.delete(e.callback)}function pv(t,e){e.unobserve()}function mv(t,e){var n=[],r,i=hv(t);if(!i)i=new lv(t),xh.set(t,i);else{var s=fv(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Cn(t),e){r.callback=e,r.next=null;var o=function(){vh(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){vh(r),clearTimeout(r.next),dv(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new uv(e,r)),r}function vh(t,e){e===void 0&&(e=!1);var n=xh.get(t.object);kh(n.value,t.object,t.patches,"",e),t.patches.length&&Eh(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function kh(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=yh(e),o=yh(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(_h(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?kh(u,f,n,r+"/"+bs(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+bs(l),value:Cn(u)}),n.push({op:"replace",path:r+"/"+bs(l),value:Cn(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+bs(l),value:Cn(u)}),n.push({op:"remove",path:r+"/"+bs(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!_h(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+bs(l),value:Cn(e[l])})}}}function Up(t,e,n){n===void 0&&(n=!1);var r=[];return kh(t,e,r,"",n),r}var gv=Object.freeze({__proto__:null,compare:Up,generate:vh,observe:mv,unobserve:pv});Object.assign({},cv,gv,{JsonPatchError:Lp,deepClone:Cn,escapePathComponent:bs,unescapePathComponent:Np});var _v=typeof Element<"u",yv=typeof Map=="function",bv=typeof Set=="function",wv=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function zc(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!zc(t[r],e[r]))return!1;return!0}var s;if(yv&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!zc(r.value[1],e.get(r.value[0])))return!1;return!0}if(bv&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(wv&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(_v&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!zc(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var Ev=function(e,n){try{return zc(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},xv=no(Ev);function x(t){return t!=null}const Sr=Object.keys;function Yn(t){return Cn(t)}function vv(t){return typeof t=="boolean"}function Rt(t){return typeof t=="number"&&isNaN(t)===!1}function wt(t){return typeof t=="string"}function se(t){return Array.isArray(t)}function Th(t){return t}var St=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(St||{}),Wt=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Wt||{}),cr=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(cr||{}),pt=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.PLAYER=18]="PLAYER",t[t.FIND=19]="FIND",t[t.FLEE=20]="FLEE",t[t.TO=21]="TO",t[t.MID=22]="MID",t[t.OVER=23]="OVER",t[t.UNDER=24]="UNDER",t))(pt||{}),vt=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.ZSSEDIT=14]="ZSSEDIT",t[t.CHAREDIT=15]="CHAREDIT",t[t.COLOREDIT=16]="COLOREDIT",t))(vt||{});function It(t){return(t==null?void 0:t.toLowerCase().trim())??""}function kv(t,e,n,r,i){return{session:t,player:e,id:Me(),sender:n,target:r,data:i}}function Vn(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function io(t,e=[],n=Th,r=""){const i=Me(),s=It(t),o=e.map(It);let a=r;const c={id(){return i},name(){return t},session(l){return x(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,f){Gn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Vn(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&x(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Gn.connect(c),c}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Tv=4,Fp=0,Pp=1,Av=2;function so(t){let e=t.length;for(;--e>=0;)t[e]=0}const Rv=0,Bp=1,Sv=2,Ov=3,Iv=258,Ah=29,_a=256,ya=_a+1+Ah,oo=30,Rh=19,Dp=2*ya+1,Es=15,Sh=16,Nv=7,Oh=256,$p=16,jp=17,zp=18,Ih=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Kc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Cv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Kp=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Lv=512,_i=new Array((ya+2)*2);so(_i);const ba=new Array(oo*2);so(ba);const wa=new Array(Lv);so(wa);const Ea=new Array(Iv-Ov+1);so(Ea);const Nh=new Array(Ah);so(Nh);const Wc=new Array(oo);so(Wc);function Ch(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let Wp,Hp,Gp;function Lh(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const Yp=t=>t<256?wa[t]:wa[256+(t>>>7)],xa=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Ln=(t,e,n)=>{t.bi_valid>Sh-n?(t.bi_buf|=e<<t.bi_valid&65535,xa(t,t.bi_buf),t.bi_buf=e>>Sh-t.bi_valid,t.bi_valid+=n-Sh):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Kr=(t,e,n)=>{Ln(t,n[e*2],n[e*2+1])},Vp=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Mv=t=>{t.bi_valid===16?(xa(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Uv=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,f,d,h,p,m=0;for(d=0;d<=Es;d++)t.bl_count[d]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Dp;l++)u=t.heap[l],d=n[n[u*2+1]*2+1]+1,d>c&&(d=c,m++),n[u*2+1]=d,!(u>r)&&(t.bl_count[d]++,h=0,u>=a&&(h=o[u-a]),p=n[u*2],t.opt_len+=p*(d+h),s&&(t.static_len+=p*(i[u*2+1]+h)));if(m!==0){do{for(d=c-1;t.bl_count[d]===0;)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,m-=2}while(m>0);for(d=c;d!==0;d--)for(u=t.bl_count[d];u!==0;)f=t.heap[--l],!(f>r)&&(n[f*2+1]!==d&&(t.opt_len+=(d-n[f*2+1])*n[f*2],n[f*2+1]=d),u--)}},Zp=(t,e,n)=>{const r=new Array(Es+1);let i=0,s,o;for(s=1;s<=Es;s++)i=i+n[s-1]<<1,r[s]=i;for(o=0;o<=e;o++){let a=t[o*2+1];a!==0&&(t[o*2]=Vp(r[a]++,a))}},Fv=()=>{let t,e,n,r,i;const s=new Array(Es+1);for(n=0,r=0;r<Ah-1;r++)for(Nh[r]=n,t=0;t<1<<Ih[r];t++)Ea[n++]=r;for(Ea[n-1]=r,i=0,r=0;r<16;r++)for(Wc[r]=i,t=0;t<1<<Kc[r];t++)wa[i++]=r;for(i>>=7;r<oo;r++)for(Wc[r]=i<<7,t=0;t<1<<Kc[r]-7;t++)wa[256+i++]=r;for(e=0;e<=Es;e++)s[e]=0;for(t=0;t<=143;)_i[t*2+1]=8,t++,s[8]++;for(;t<=255;)_i[t*2+1]=9,t++,s[9]++;for(;t<=279;)_i[t*2+1]=7,t++,s[7]++;for(;t<=287;)_i[t*2+1]=8,t++,s[8]++;for(Zp(_i,ya+1,s),t=0;t<oo;t++)ba[t*2+1]=5,ba[t*2]=Vp(t,5);Wp=new Ch(_i,Ih,_a+1,ya,Es),Hp=new Ch(ba,Kc,0,oo,Es),Gp=new Ch(new Array(0),Cv,0,Rh,Nv)},Xp=t=>{let e;for(e=0;e<ya;e++)t.dyn_ltree[e*2]=0;for(e=0;e<oo;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Rh;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Oh*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},qp=t=>{t.bi_valid>8?xa(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Jp=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},Mh=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Jp(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Jp(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},Qp=(t,e,n)=>{let r,i,s=0,o,a;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+s++]&255,r+=(t.pending_buf[t.sym_buf+s++]&255)<<8,i=t.pending_buf[t.sym_buf+s++],r===0?Kr(t,i,e):(o=Ea[i],Kr(t,o+_a+1,e),a=Ih[o],a!==0&&(i-=Nh[o],Ln(t,i,a)),r--,o=Yp(r),Kr(t,o,n),a=Kc[o],a!==0&&(r-=Wc[o],Ln(t,r,a)));while(s<t.sym_next);Kr(t,Oh,e)},Uh=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c=-1,l;for(t.heap_len=0,t.heap_max=Dp,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)Mh(t,n,o);l=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Mh(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[l*2]=n[o*2]+n[a*2],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=l,t.heap[1]=l++,Mh(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Uv(t,e),Zp(n,c,t.bl_count)},tm=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)&&(a<l?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[$p*2]++):a<=10?t.bl_tree[jp*2]++:t.bl_tree[zp*2]++,a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},em=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)){if(a<l)do Kr(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Kr(t,s,t.bl_tree),a--),Kr(t,$p,t.bl_tree),Ln(t,a-3,2)):a<=10?(Kr(t,jp,t.bl_tree),Ln(t,a-3,3)):(Kr(t,zp,t.bl_tree),Ln(t,a-11,7));a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},Pv=t=>{let e;for(tm(t,t.dyn_ltree,t.l_desc.max_code),tm(t,t.dyn_dtree,t.d_desc.max_code),Uh(t,t.bl_desc),e=Rh-1;e>=3&&t.bl_tree[Kp[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Bv=(t,e,n,r)=>{let i;for(Ln(t,e-257,5),Ln(t,n-1,5),Ln(t,r-4,4),i=0;i<r;i++)Ln(t,t.bl_tree[Kp[i]*2+1],3);em(t,t.dyn_ltree,e-1),em(t,t.dyn_dtree,n-1)},Dv=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return Fp;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Pp;for(n=32;n<_a;n++)if(t.dyn_ltree[n*2]!==0)return Pp;return Fp};let nm=!1;const $v=t=>{nm||(Fv(),nm=!0),t.l_desc=new Lh(t.dyn_ltree,Wp),t.d_desc=new Lh(t.dyn_dtree,Hp),t.bl_desc=new Lh(t.bl_tree,Gp),t.bi_buf=0,t.bi_valid=0,Xp(t)},rm=(t,e,n,r)=>{Ln(t,(Rv<<1)+(r?1:0),3),qp(t),xa(t,n),xa(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},jv=t=>{Ln(t,Bp<<1,3),Kr(t,Oh,_i),Mv(t)},zv=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===Av&&(t.strm.data_type=Dv(t)),Uh(t,t.l_desc),Uh(t,t.d_desc),o=Pv(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?rm(t,e,n,r):t.strategy===Tv||s===i?(Ln(t,(Bp<<1)+(r?1:0),3),Qp(t,_i,ba)):(Ln(t,(Sv<<1)+(r?1:0),3),Bv(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Qp(t,t.dyn_ltree,t.dyn_dtree)),Xp(t),r&&qp(t)},Kv=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(Ea[n]+_a+1)*2]++,t.dyn_dtree[Yp(e)*2]++),t.sym_next===t.sym_end);var Wv=$v,Hv=rm,Gv=zv,Yv=Kv,Vv=jv,Zv={_tr_init:Wv,_tr_stored_block:Hv,_tr_flush_block:Gv,_tr_tally:Yv,_tr_align:Vv},va=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const Xv=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},qv=new Uint32Array(Xv());var rn=(t,e,n,r)=>{const i=qv,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1},xs={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},vs={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Jv,_tr_stored_block:Fh,_tr_flush_block:Qv,_tr_tally:Wi,_tr_align:tk}=Zv,{Z_NO_FLUSH:Hi,Z_PARTIAL_FLUSH:ek,Z_FULL_FLUSH:nk,Z_FINISH:lr,Z_BLOCK:im,Z_OK:un,Z_STREAM_END:sm,Z_STREAM_ERROR:Wr,Z_DATA_ERROR:rk,Z_BUF_ERROR:Ph,Z_DEFAULT_COMPRESSION:ik,Z_FILTERED:sk,Z_HUFFMAN_ONLY:Hc,Z_RLE:ok,Z_FIXED:ak,Z_DEFAULT_STRATEGY:ck,Z_UNKNOWN:lk,Z_DEFLATED:Gc}=vs,uk=9,hk=15,fk=8,Bh=256+1+29,dk=30,pk=19,mk=2*Bh+1,gk=15,Zt=3,Gi=258,Hr=Gi+Zt+1,_k=32,ao=42,Dh=57,$h=69,jh=73,zh=91,Kh=103,ks=113,ka=666,vn=1,co=2,Ts=3,lo=4,yk=3,As=(t,e)=>(t.msg=xs[e],e),om=t=>t*2-(t>4?9:0),Yi=t=>{let e=t.length;for(;--e>=0;)t[e]=0},bk=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let Vi=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Zn=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Xn=(t,e)=>{Qv(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Zn(t.strm)},oe=(t,e)=>{t.pending_buf[t.pending++]=e},Ta=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},Wh=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=va(t.adler,e,i,n):t.state.wrap===2&&(t.adler=rn(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},am=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-Hr?t.strstart-(t.w_size-Hr):0,l=t.window,u=t.w_mask,f=t.prev,d=t.strstart+Gi;let h=l[r+o-1],p=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(l[i+o]!==p||l[i+o-1]!==h||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<d);if(s=Gi-(d-r),r=d-Gi,s>o){if(t.match_start=e,o=s,s>=a)break;h=l[r+o-1],p=l[r+o]}}while((e=f[e&u])>c&&--n!==0);return o<=t.lookahead?o:t.lookahead},uo=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Hr)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),bk(t),r+=e),t.strm.avail_in===0)break;if(n=Wh(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=Zt)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Vi(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Vi(t,t.ins_h,t.window[i+Zt-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<Zt)););}while(t.lookahead<Hr&&t.strm.avail_in!==0)},cm=(t,e)=>{let n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,s,o=0,a=t.strm.avail_in;do{if(r=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>s&&(r=s),r<n&&(r===0&&e!==lr||e===Hi||r!==i+t.strm.avail_in)))break;o=e===lr&&r===i+t.strm.avail_in?1:0,Fh(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,Zn(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(Wh(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?lo:e!==Hi&&e!==lr&&t.strm.avail_in===0&&t.strstart===t.block_start?co:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(Wh(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,n=s>t.w_size?t.w_size:s,i=t.strstart-t.block_start,(i>=n||(i||e===lr)&&e!==Hi&&t.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,o=e===lr&&t.strm.avail_in===0&&r===i?1:0,Fh(t,t.block_start,r,o),t.block_start+=r,Zn(t.strm)),o?Ts:vn)},Hh=(t,e)=>{let n,r;for(;;){if(t.lookahead<Hr){if(uo(t),t.lookahead<Hr&&e===Hi)return vn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Zt&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Hr&&(t.match_length=am(t,n)),t.match_length>=Zt)if(r=Wi(t,t.strstart-t.match_start,t.match_length-Zt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Zt){t.match_length--;do t.strstart++,t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+1]);else r=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Xn(t,!1),t.strm.avail_out===0))return vn}return t.insert=t.strstart<Zt-1?t.strstart:Zt-1,e===lr?(Xn(t,!0),t.strm.avail_out===0?Ts:lo):t.sym_next&&(Xn(t,!1),t.strm.avail_out===0)?vn:co},ho=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Hr){if(uo(t),t.lookahead<Hr&&e===Hi)return vn;if(t.lookahead===0)break}if(n=0,t.lookahead>=Zt&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Zt-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Hr&&(t.match_length=am(t,n),t.match_length<=5&&(t.strategy===sk||t.match_length===Zt&&t.strstart-t.match_start>4096)&&(t.match_length=Zt-1)),t.prev_length>=Zt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Zt,r=Wi(t,t.strstart-1-t.prev_match,t.prev_length-Zt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Vi(t,t.ins_h,t.window[t.strstart+Zt-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Zt-1,t.strstart++,r&&(Xn(t,!1),t.strm.avail_out===0))return vn}else if(t.match_available){if(r=Wi(t,0,t.window[t.strstart-1]),r&&Xn(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return vn}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Wi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Zt-1?t.strstart:Zt-1,e===lr?(Xn(t,!0),t.strm.avail_out===0?Ts:lo):t.sym_next&&(Xn(t,!1),t.strm.avail_out===0)?vn:co},wk=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=Gi){if(uo(t),t.lookahead<=Gi&&e===Hi)return vn;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Zt&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Gi;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Gi-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Zt?(n=Wi(t,1,t.match_length-Zt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Xn(t,!1),t.strm.avail_out===0))return vn}return t.insert=0,e===lr?(Xn(t,!0),t.strm.avail_out===0?Ts:lo):t.sym_next&&(Xn(t,!1),t.strm.avail_out===0)?vn:co},Ek=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(uo(t),t.lookahead===0)){if(e===Hi)return vn;break}if(t.match_length=0,n=Wi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Xn(t,!1),t.strm.avail_out===0))return vn}return t.insert=0,e===lr?(Xn(t,!0),t.strm.avail_out===0?Ts:lo):t.sym_next&&(Xn(t,!1),t.strm.avail_out===0)?vn:co};function Gr(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const Aa=[new Gr(0,0,0,0,cm),new Gr(4,4,8,4,Hh),new Gr(4,5,16,8,Hh),new Gr(4,6,32,32,Hh),new Gr(4,4,16,16,ho),new Gr(8,16,32,32,ho),new Gr(8,16,128,128,ho),new Gr(8,32,128,256,ho),new Gr(32,128,258,1024,ho),new Gr(32,258,258,4096,ho)],xk=t=>{t.window_size=2*t.w_size,Yi(t.head),t.max_lazy_match=Aa[t.level].max_lazy,t.good_match=Aa[t.level].good_length,t.nice_match=Aa[t.level].nice_length,t.max_chain_length=Aa[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Zt-1,t.match_available=0,t.ins_h=0};function vk(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(mk*2),this.dyn_dtree=new Uint16Array((2*dk+1)*2),this.bl_tree=new Uint16Array((2*pk+1)*2),Yi(this.dyn_ltree),Yi(this.dyn_dtree),Yi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(gk+1),this.heap=new Uint16Array(2*Bh+1),Yi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Bh+1),Yi(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ra=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==ao&&e.status!==Dh&&e.status!==$h&&e.status!==jh&&e.status!==zh&&e.status!==Kh&&e.status!==ks&&e.status!==ka?1:0},lm=t=>{if(Ra(t))return As(t,Wr);t.total_in=t.total_out=0,t.data_type=lk;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Dh:e.wrap?ao:ks,t.adler=e.wrap===2?0:1,e.last_flush=-2,Jv(e),un},um=t=>{const e=lm(t);return e===un&&xk(t.state),e},kk=(t,e)=>Ra(t)||t.state.wrap!==2?Wr:(t.state.gzhead=e,un),hm=(t,e,n,r,i,s)=>{if(!t)return Wr;let o=1;if(e===ik&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>uk||n!==Gc||r<8||r>15||e<0||e>9||s<0||s>ak||r===8&&o!==1)return As(t,Wr);r===8&&(r=9);const a=new vk;return t.state=a,a.strm=t,a.status=ao,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Zt-1)/Zt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=n,um(t)},Tk=(t,e)=>hm(t,e,Gc,hk,fk,ck),Ak=(t,e)=>{if(Ra(t)||e>im||e<0)return t?As(t,Wr):Wr;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===ka&&e!==lr)return As(t,t.avail_out===0?Ph:Wr);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(Zn(t),t.avail_out===0)return n.last_flush=-1,un}else if(t.avail_in===0&&om(e)<=om(r)&&e!==lr)return As(t,Ph);if(n.status===ka&&t.avail_in!==0)return As(t,Ph);if(n.status===ao&&n.wrap===0&&(n.status=ks),n.status===ao){let i=Gc+(n.w_bits-8<<4)<<8,s=-1;if(n.strategy>=Hc||n.level<2?s=0:n.level<6?s=1:n.level===6?s=2:s=3,i|=s<<6,n.strstart!==0&&(i|=_k),i+=31-i%31,Ta(n,i),n.strstart!==0&&(Ta(n,t.adler>>>16),Ta(n,t.adler&65535)),t.adler=1,n.status=ks,Zn(t),n.pending!==0)return n.last_flush=-1,un}if(n.status===Dh){if(t.adler=0,oe(n,31),oe(n,139),oe(n,8),n.gzhead)oe(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),oe(n,n.gzhead.time&255),oe(n,n.gzhead.time>>8&255),oe(n,n.gzhead.time>>16&255),oe(n,n.gzhead.time>>24&255),oe(n,n.level===9?2:n.strategy>=Hc||n.level<2?4:0),oe(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(oe(n,n.gzhead.extra.length&255),oe(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=rn(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=$h;else if(oe(n,0),oe(n,0),oe(n,0),oe(n,0),oe(n,0),oe(n,n.level===9?2:n.strategy>=Hc||n.level<2?4:0),oe(n,yk),n.status=ks,Zn(t),n.pending!==0)return n.last_flush=-1,un}if(n.status===$h){if(n.gzhead.extra){let i=n.pending,s=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,Zn(t),n.pending!==0)return n.last_flush=-1,un;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=jh}if(n.status===jh){if(n.gzhead.name){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),Zn(t),n.pending!==0)return n.last_flush=-1,un;i=0}n.gzindex<n.gzhead.name.length?s=n.gzhead.name.charCodeAt(n.gzindex++)&255:s=0,oe(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=zh}if(n.status===zh){if(n.gzhead.comment){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i)),Zn(t),n.pending!==0)return n.last_flush=-1,un;i=0}n.gzindex<n.gzhead.comment.length?s=n.gzhead.comment.charCodeAt(n.gzindex++)&255:s=0,oe(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=rn(t.adler,n.pending_buf,n.pending-i,i))}n.status=Kh}if(n.status===Kh){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Zn(t),n.pending!==0))return n.last_flush=-1,un;oe(n,t.adler&255),oe(n,t.adler>>8&255),t.adler=0}if(n.status=ks,Zn(t),n.pending!==0)return n.last_flush=-1,un}if(t.avail_in!==0||n.lookahead!==0||e!==Hi&&n.status!==ka){let i=n.level===0?cm(n,e):n.strategy===Hc?Ek(n,e):n.strategy===ok?wk(n,e):Aa[n.level].func(n,e);if((i===Ts||i===lo)&&(n.status=ka),i===vn||i===Ts)return t.avail_out===0&&(n.last_flush=-1),un;if(i===co&&(e===ek?tk(n):e!==im&&(Fh(n,0,0,!1),e===nk&&(Yi(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Zn(t),t.avail_out===0))return n.last_flush=-1,un}return e!==lr?un:n.wrap<=0?sm:(n.wrap===2?(oe(n,t.adler&255),oe(n,t.adler>>8&255),oe(n,t.adler>>16&255),oe(n,t.adler>>24&255),oe(n,t.total_in&255),oe(n,t.total_in>>8&255),oe(n,t.total_in>>16&255),oe(n,t.total_in>>24&255)):(Ta(n,t.adler>>>16),Ta(n,t.adler&65535)),Zn(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?un:sm)},Rk=t=>{if(Ra(t))return Wr;const e=t.state.status;return t.state=null,e===ks?As(t,rk):un},Sk=(t,e)=>{let n=e.length;if(Ra(t))return Wr;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==ao||r.lookahead)return Wr;if(i===1&&(t.adler=va(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Yi(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,uo(r);r.lookahead>=Zt;){let c=r.strstart,l=r.lookahead-(Zt-1);do r.ins_h=Vi(r,r.ins_h,r.window[c+Zt-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=Zt-1,uo(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Zt-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,un};var Ok=Tk,Ik=hm,Nk=um,Ck=lm,Lk=kk,Mk=Ak,Uk=Rk,Fk=Sk,Pk="pako deflate (from Nodeca project)",Sa={deflateInit:Ok,deflateInit2:Ik,deflateReset:Nk,deflateResetKeep:Ck,deflateSetHeader:Lk,deflate:Mk,deflateEnd:Uk,deflateSetDictionary:Fk,deflateInfo:Pk};const Bk=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Dk=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Bk(n,r)&&(t[r]=n[r])}}return t},$k=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n},Yc={assign:Dk,flattenChunks:$k};let fm=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{fm=!1}const Oa=new Uint8Array(256);for(let t=0;t<256;t++)Oa[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Oa[254]=Oa[254]=1;var jk=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const zk=(t,e)=>{if(e<65534&&t.subarray&&fm)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var Kk=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=Oa[o];if(a>4){s[i++]=65533,r+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|t[r++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return zk(s,i)},Wk=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+Oa[t[n]]>e?n:e},Ia={string2buf:jk,buf2string:Kk,utf8border:Wk};function Hk(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var dm=Hk;const pm=Object.prototype.toString,{Z_NO_FLUSH:Gk,Z_SYNC_FLUSH:Yk,Z_FULL_FLUSH:Vk,Z_FINISH:Zk,Z_OK:Vc,Z_STREAM_END:Xk,Z_DEFAULT_COMPRESSION:qk,Z_DEFAULT_STRATEGY:Jk,Z_DEFLATED:Qk}=vs;function Na(t){this.options=Yc.assign({level:qk,method:Qk,chunkSize:16384,windowBits:15,memLevel:8,strategy:Jk},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dm,this.strm.avail_out=0;let n=Sa.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Vc)throw new Error(xs[n]);if(e.header&&Sa.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=Ia.string2buf(e.dictionary):pm.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=Sa.deflateSetDictionary(this.strm,r),n!==Vc)throw new Error(xs[n]);this._dict_set=!0}}Na.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Zk:Gk,typeof t=="string"?n.input=Ia.string2buf(t):pm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Yk||s===Vk)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=Sa.deflate(n,s),i===Xk)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Sa.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Vc;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0},Na.prototype.onData=function(t){this.chunks.push(t)},Na.prototype.onEnd=function(t){t===Vc&&(this.result=Yc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Gh(t,e){const n=new Na(e);if(n.push(t,!0),n.err)throw n.msg||xs[n.err];return n.result}function tT(t,e){return e=e||{},e.raw=!0,Gh(t,e)}function eT(t,e){return e=e||{},e.gzip=!0,Gh(t,e)}var nT=Na,rT=Gh,iT=tT,sT=eT,oT=vs,aT={Deflate:nT,deflate:rT,deflateRaw:iT,gzip:sT,constants:oT};const Zc=16209,cT=16191;var lT=function(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,b,y,k,A,T,C,R,S,U,N,D;const Y=e.state;r=e.next_in,N=e.input,i=r+(e.avail_in-5),s=e.next_out,D=e.output,o=s-(n-e.avail_out),a=s+(e.avail_out-257),c=Y.dmax,l=Y.wsize,u=Y.whave,f=Y.wnext,d=Y.window,h=Y.hold,p=Y.bits,m=Y.lencode,b=Y.distcode,y=(1<<Y.lenbits)-1,k=(1<<Y.distbits)-1;t:do{p<15&&(h+=N[r++]<<p,p+=8,h+=N[r++]<<p,p+=8),A=m[h&y];e:for(;;){if(T=A>>>24,h>>>=T,p-=T,T=A>>>16&255,T===0)D[s++]=A&65535;else if(T&16){C=A&65535,T&=15,T&&(p<T&&(h+=N[r++]<<p,p+=8),C+=h&(1<<T)-1,h>>>=T,p-=T),p<15&&(h+=N[r++]<<p,p+=8,h+=N[r++]<<p,p+=8),A=b[h&k];n:for(;;){if(T=A>>>24,h>>>=T,p-=T,T=A>>>16&255,T&16){if(R=A&65535,T&=15,p<T&&(h+=N[r++]<<p,p+=8,p<T&&(h+=N[r++]<<p,p+=8)),R+=h&(1<<T)-1,R>c){e.msg="invalid distance too far back",Y.mode=Zc;break t}if(h>>>=T,p-=T,T=s-o,R>T){if(T=R-T,T>u&&Y.sane){e.msg="invalid distance too far back",Y.mode=Zc;break t}if(S=0,U=d,f===0){if(S+=l-T,T<C){C-=T;do D[s++]=d[S++];while(--T);S=s-R,U=D}}else if(f<T){if(S+=l+f-T,T-=f,T<C){C-=T;do D[s++]=d[S++];while(--T);if(S=0,f<C){T=f,C-=T;do D[s++]=d[S++];while(--T);S=s-R,U=D}}}else if(S+=f-T,T<C){C-=T;do D[s++]=d[S++];while(--T);S=s-R,U=D}for(;C>2;)D[s++]=U[S++],D[s++]=U[S++],D[s++]=U[S++],C-=3;C&&(D[s++]=U[S++],C>1&&(D[s++]=U[S++]))}else{S=s-R;do D[s++]=D[S++],D[s++]=D[S++],D[s++]=D[S++],C-=3;while(C>2);C&&(D[s++]=D[S++],C>1&&(D[s++]=D[S++]))}}else if(T&64){e.msg="invalid distance code",Y.mode=Zc;break t}else{A=b[(A&65535)+(h&(1<<T)-1)];continue n}break}}else if(T&64)if(T&32){Y.mode=cT;break t}else{e.msg="invalid literal/length code",Y.mode=Zc;break t}else{A=m[(A&65535)+(h&(1<<T)-1)];continue e}break}}while(r<i&&s<a);C=p>>3,r-=C,p-=C<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<a?257+(a-s):257-(s-a),Y.hold=h,Y.bits=p};const fo=15,mm=852,gm=592,_m=0,Yh=1,ym=2,uT=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),hT=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fT=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dT=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ca=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l=0,u=0,f=0,d=0,h=0,p=0,m=0,b=0,y=0,k=0,A,T,C,R,S,U=null,N;const D=new Uint16Array(fo+1),Y=new Uint16Array(fo+1);let L=null,I,E,B;for(l=0;l<=fo;l++)D[l]=0;for(u=0;u<r;u++)D[e[n+u]]++;for(h=c,d=fo;d>=1&&D[d]===0;d--);if(h>d&&(h=d),d===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(f=1;f<d&&D[f]===0;f++);for(h<f&&(h=f),b=1,l=1;l<=fo;l++)if(b<<=1,b-=D[l],b<0)return-1;if(b>0&&(t===_m||d!==1))return-1;for(Y[1]=0,l=1;l<fo;l++)Y[l+1]=Y[l]+D[l];for(u=0;u<r;u++)e[n+u]!==0&&(o[Y[e[n+u]]++]=u);if(t===_m?(U=L=o,N=20):t===Yh?(U=uT,L=hT,N=257):(U=fT,L=dT,N=0),k=0,u=0,l=f,S=s,p=h,m=0,C=-1,y=1<<h,R=y-1,t===Yh&&y>mm||t===ym&&y>gm)return 1;for(;;){I=l-m,o[u]+1<N?(E=0,B=o[u]):o[u]>=N?(E=L[o[u]-N],B=U[o[u]-N]):(E=96,B=0),A=1<<l-m,T=1<<p,f=T;do T-=A,i[S+(k>>m)+T]=I<<24|E<<16|B|0;while(T!==0);for(A=1<<l-1;k&A;)A>>=1;if(A!==0?(k&=A-1,k+=A):k=0,u++,--D[l]===0){if(l===d)break;l=e[n+o[u]]}if(l>h&&(k&R)!==C){for(m===0&&(m=h),S+=f,p=l-m,b=1<<p;p+m<d&&(b-=D[p+m],!(b<=0));)p++,b<<=1;if(y+=1<<p,t===Yh&&y>mm||t===ym&&y>gm)return 1;C=k&R,i[C]=h<<24|p<<16|S-s|0}}return k!==0&&(i[S+k]=l-m<<24|64<<16|0),a.bits=h,0};const pT=0,bm=1,wm=2,{Z_FINISH:Em,Z_BLOCK:mT,Z_TREES:Xc,Z_OK:Rs,Z_STREAM_END:gT,Z_NEED_DICT:_T,Z_STREAM_ERROR:ur,Z_DATA_ERROR:xm,Z_MEM_ERROR:vm,Z_BUF_ERROR:yT,Z_DEFLATED:km}=vs,qc=16180,Tm=16181,Am=16182,Rm=16183,Sm=16184,Om=16185,Im=16186,Nm=16187,Cm=16188,Lm=16189,Jc=16190,yi=16191,Vh=16192,Mm=16193,Zh=16194,Um=16195,Fm=16196,Pm=16197,Bm=16198,Qc=16199,tl=16200,Dm=16201,$m=16202,jm=16203,zm=16204,Km=16205,Xh=16206,Wm=16207,Hm=16208,ve=16209,Gm=16210,Ym=16211,bT=852,wT=592,ET=15,Vm=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function xT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ss=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<qc||e.mode>Ym?1:0},Zm=t=>{if(Ss(t))return ur;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=qc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(bT),e.distcode=e.distdyn=new Int32Array(wT),e.sane=1,e.back=-1,Rs},Xm=t=>{if(Ss(t))return ur;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Zm(t)},qm=(t,e)=>{let n;if(Ss(t))return ur;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?ur:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Xm(t))},Jm=(t,e)=>{if(!t)return ur;const n=new xT;t.state=n,n.strm=t,n.window=null,n.mode=qc;const r=qm(t,e);return r!==Rs&&(t.state=null),r},vT=t=>Jm(t,ET);let Qm=!0,qh,Jh;const kT=t=>{if(Qm){qh=new Int32Array(512),Jh=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Ca(bm,t.lens,0,288,qh,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Ca(wm,t.lens,0,32,Jh,0,t.work,{bits:5}),Qm=!1}t.lencode=qh,t.lenbits=9,t.distcode=Jh,t.distbits=5},tg=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},TT=(t,e)=>{let n,r,i,s,o,a,c,l,u,f,d,h,p,m,b=0,y,k,A,T,C,R,S,U;const N=new Uint8Array(4);let D,Y;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ss(t)||!t.output||!t.input&&t.avail_in!==0)return ur;n=t.state,n.mode===yi&&(n.mode=Vh),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,f=a,d=c,U=Rs;t:for(;;)switch(n.mode){case qc:if(n.wrap===0){n.mode=Vh;break}for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,N[0]=l&255,N[1]=l>>>8&255,n.check=rn(n.check,N,2,0),l=0,u=0,n.mode=Tm;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=ve;break}if((l&15)!==km){t.msg="unknown compression method",n.mode=ve;break}if(l>>>=4,u-=4,S=(l&15)+8,n.wbits===0&&(n.wbits=S),S>15||S>n.wbits){t.msg="invalid window size",n.mode=ve;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=l&512?Lm:yi,l=0,u=0;break;case Tm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==km){t.msg="unknown compression method",n.mode=ve;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=ve;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(N[0]=l&255,N[1]=l>>>8&255,n.check=rn(n.check,N,2,0)),l=0,u=0,n.mode=Am;case Am:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(N[0]=l&255,N[1]=l>>>8&255,N[2]=l>>>16&255,N[3]=l>>>24&255,n.check=rn(n.check,N,4,0)),l=0,u=0,n.mode=Rm;case Rm:for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(N[0]=l&255,N[1]=l>>>8&255,n.check=rn(n.check,N,2,0)),l=0,u=0,n.mode=Sm;case Sm:if(n.flags&1024){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(N[0]=l&255,N[1]=l>>>8&255,n.check=rn(n.check,N,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=Om;case Om:if(n.flags&1024&&(h=n.length,h>a&&(h=a),h&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+h),S)),n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,n.length-=h),n.length))break t;n.length=0,n.mode=Im;case Im:if(n.flags&2048){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=Nm;case Nm:if(n.flags&4096){if(a===0)break t;h=0;do S=r[s+h++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S));while(S&&h<a);if(n.flags&512&&n.wrap&4&&(n.check=rn(n.check,r,h,s)),a-=h,s+=h,S)break t}else n.head&&(n.head.comment=null);n.mode=Cm;case Cm:if(n.flags&512){for(;u<16;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=ve;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=yi;break;case Lm:for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=Vm(l),l=0,u=0,n.mode=Jc;case Jc:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,_T;t.adler=n.check=1,n.mode=yi;case yi:if(e===mT||e===Xc)break t;case Vh:if(n.last){l>>>=u&7,u-=u&7,n.mode=Xh;break}for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}switch(n.last=l&1,l>>>=1,u-=1,l&3){case 0:n.mode=Mm;break;case 1:if(kT(n),n.mode=Qc,e===Xc){l>>>=2,u-=2;break t}break;case 2:n.mode=Fm;break;case 3:t.msg="invalid block type",n.mode=ve}l>>>=2,u-=2;break;case Mm:for(l>>>=u&7,u-=u&7;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=ve;break}if(n.length=l&65535,l=0,u=0,n.mode=Zh,e===Xc)break t;case Zh:n.mode=Um;case Um:if(h=n.length,h){if(h>a&&(h=a),h>c&&(h=c),h===0)break t;i.set(r.subarray(s,s+h),o),a-=h,s+=h,c-=h,o+=h,n.length-=h;break}n.mode=yi;break;case Fm:for(;u<14;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=ve;break}n.have=0,n.mode=Pm;case Pm:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.lens[L[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,D={bits:n.lenbits},U=Ca(pT,n.lens,0,19,n.lencode,0,n.work,D),n.lenbits=D.bits,U){t.msg="invalid code lengths set",n.mode=ve;break}n.have=0,n.mode=Bm;case Bm:for(;n.have<n.nlen+n.ndist;){for(;b=n.lencode[l&(1<<n.lenbits)-1],y=b>>>24,k=b>>>16&255,A=b&65535,!(y<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(A<16)l>>>=y,u-=y,n.lens[n.have++]=A;else{if(A===16){for(Y=y+2;u<Y;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(l>>>=y,u-=y,n.have===0){t.msg="invalid bit length repeat",n.mode=ve;break}S=n.lens[n.have-1],h=3+(l&3),l>>>=2,u-=2}else if(A===17){for(Y=y+3;u<Y;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=y,u-=y,S=0,h=3+(l&7),l>>>=3,u-=3}else{for(Y=y+7;u<Y;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=y,u-=y,S=0,h=11+(l&127),l>>>=7,u-=7}if(n.have+h>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=ve;break}for(;h--;)n.lens[n.have++]=S}}if(n.mode===ve)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=ve;break}if(n.lenbits=9,D={bits:n.lenbits},U=Ca(bm,n.lens,0,n.nlen,n.lencode,0,n.work,D),n.lenbits=D.bits,U){t.msg="invalid literal/lengths set",n.mode=ve;break}if(n.distbits=6,n.distcode=n.distdyn,D={bits:n.distbits},U=Ca(wm,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D),n.distbits=D.bits,U){t.msg="invalid distances set",n.mode=ve;break}if(n.mode=Qc,e===Xc)break t;case Qc:n.mode=tl;case tl:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,lT(t,d),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===yi&&(n.back=-1);break}for(n.back=0;b=n.lencode[l&(1<<n.lenbits)-1],y=b>>>24,k=b>>>16&255,A=b&65535,!(y<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(k&&!(k&240)){for(T=y,C=k,R=A;b=n.lencode[R+((l&(1<<T+C)-1)>>T)],y=b>>>24,k=b>>>16&255,A=b&65535,!(T+y<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=T,u-=T,n.back+=T}if(l>>>=y,u-=y,n.back+=y,n.length=A,k===0){n.mode=Km;break}if(k&32){n.back=-1,n.mode=yi;break}if(k&64){t.msg="invalid literal/length code",n.mode=ve;break}n.extra=k&15,n.mode=Dm;case Dm:if(n.extra){for(Y=n.extra;u<Y;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=$m;case $m:for(;b=n.distcode[l&(1<<n.distbits)-1],y=b>>>24,k=b>>>16&255,A=b&65535,!(y<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(!(k&240)){for(T=y,C=k,R=A;b=n.distcode[R+((l&(1<<T+C)-1)>>T)],y=b>>>24,k=b>>>16&255,A=b&65535,!(T+y<=u);){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}l>>>=T,u-=T,n.back+=T}if(l>>>=y,u-=y,n.back+=y,k&64){t.msg="invalid distance code",n.mode=ve;break}n.offset=A,n.extra=k&15,n.mode=jm;case jm:if(n.extra){for(Y=n.extra;u<Y;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=ve;break}n.mode=zm;case zm:if(c===0)break t;if(h=d-c,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=ve;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=i,p=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do i[o++]=m[p++];while(--h);n.length===0&&(n.mode=tl);break;case Km:if(c===0)break t;i[o++]=n.length,c--,n.mode=tl;break;case Xh:if(n.wrap){for(;u<32;){if(a===0)break t;a--,l|=r[s++]<<u,u+=8}if(d-=c,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?rn(n.check,i,d,o-d):va(n.check,i,d,o-d)),d=c,n.wrap&4&&(n.flags?l:Vm(l))!==n.check){t.msg="incorrect data check",n.mode=ve;break}l=0,u=0}n.mode=Wm;case Wm:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break t;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=ve;break}l=0,u=0}n.mode=Hm;case Hm:U=gT;break t;case ve:U=xm;break t;case Gm:return vm;case Ym:default:return ur}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<ve&&(n.mode<Xh||e!==Em))&&tg(t,t.output,t.next_out,d-t.avail_out),f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,n.total+=d,n.wrap&4&&d&&(t.adler=n.check=n.flags?rn(n.check,i,d,t.next_out-d):va(n.check,i,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===yi?128:0)+(n.mode===Qc||n.mode===Zh?256:0),(f===0&&d===0||e===Em)&&U===Rs&&(U=yT),U},AT=t=>{if(Ss(t))return ur;let e=t.state;return e.window&&(e.window=null),t.state=null,Rs},RT=(t,e)=>{if(Ss(t))return ur;const n=t.state;return n.wrap&2?(n.head=e,e.done=!1,Rs):ur},ST=(t,e)=>{const n=e.length;let r,i,s;return Ss(t)||(r=t.state,r.wrap!==0&&r.mode!==Jc)?ur:r.mode===Jc&&(i=1,i=va(i,e,n,0),i!==r.check)?xm:(s=tg(t,e,n,n),s?(r.mode=Gm,vm):(r.havedict=1,Rs))};var OT=Xm,IT=qm,NT=Zm,CT=vT,LT=Jm,MT=TT,UT=AT,FT=RT,PT=ST,BT="pako inflate (from Nodeca project)",bi={inflateReset:OT,inflateReset2:IT,inflateResetKeep:NT,inflateInit:CT,inflateInit2:LT,inflate:MT,inflateEnd:UT,inflateGetHeader:FT,inflateSetDictionary:PT,inflateInfo:BT};function DT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var $T=DT;const eg=Object.prototype.toString,{Z_NO_FLUSH:jT,Z_FINISH:zT,Z_OK:La,Z_STREAM_END:Qh,Z_NEED_DICT:tf,Z_STREAM_ERROR:KT,Z_DATA_ERROR:ng,Z_MEM_ERROR:WT}=vs;function Ma(t){this.options=Yc.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dm,this.strm.avail_out=0;let n=bi.inflateInit2(this.strm,e.windowBits);if(n!==La)throw new Error(xs[n]);if(this.header=new $T,bi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ia.string2buf(e.dictionary):eg.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=bi.inflateSetDictionary(this.strm,e.dictionary),n!==La)))throw new Error(xs[n])}Ma.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?zT:jT,eg.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=bi.inflate(n,o),s===tf&&i&&(s=bi.inflateSetDictionary(n,i),s===La?s=bi.inflate(n,o):s===ng&&(s=tf));n.avail_in>0&&s===Qh&&n.state.wrap>0&&t[n.next_in]!==0;)bi.inflateReset(n),s=bi.inflate(n,o);switch(s){case KT:case ng:case tf:case WT:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===Qh))if(this.options.to==="string"){let c=Ia.utf8border(n.output,n.next_out),l=n.next_out-c,u=Ia.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===La&&a===0)){if(s===Qh)return s=bi.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Ma.prototype.onData=function(t){this.chunks.push(t)},Ma.prototype.onEnd=function(t){t===La&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Yc.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ef(t,e){const n=new Ma(e);if(n.push(t),n.err)throw n.msg||xs[n.err];return n.result}function HT(t,e){return e=e||{},e.raw=!0,ef(t,e)}var GT=Ma,YT=ef,VT=HT,ZT=ef,XT=vs,qT={Inflate:GT,inflate:YT,inflateRaw:VT,ungzip:ZT,constants:XT};const{Deflate:JT,deflate:QT,deflateRaw:tA,gzip:eA}=aT,{Inflate:nA,inflate:rA,inflateRaw:iA,ungzip:sA}=qT;var oA=JT,aA=QT,cA=tA,lA=eA,uA=nA,hA=rA,fA=iA,dA=sA,pA=vs,mA={Deflate:oA,deflate:aA,deflateRaw:cA,gzip:lA,Inflate:uA,inflate:hA,inflateRaw:fA,ungzip:dA,constants:pA};function rg(t){let e=t.r.toString(16),n=t.g.toString(16),r=t.b.toString(16);return e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),e+n+r}const gA=t=>new Promise((e,n)=>{try{const r=mA.inflate(t),i=_A(r);e(i)}catch(r){n(r)}}),_A=t=>{const e=new DataView(t.buffer),n={version:e.getUint32(0,!0),layers:[]},r=e.getUint32(4,!0);let i=8;for(let s=0;s<r;s++){const o={width:0,height:0,raster:[]};o.width=e.getUint32(i,!0),i+=4,o.height=e.getUint32(i,!0),i+=4,o.raster=Array(o.height*o.width);for(let a=0;a<o.width;a++)for(let c=0;c<o.height;c++){const l={asciiCode:e.getUint32(i,!0),transparent:!1,color:{r:0,g:0,b:0,hex:""},bg:{r:0,g:0,b:0,hex:""}};i+=4,l.color.r=e.getUint8(i++),l.color.g=e.getUint8(i++),l.color.b=e.getUint8(i++),l.color.hex=rg(l.color),l.bg.r=e.getUint8(i++),l.bg.g=e.getUint8(i++),l.bg.b=e.getUint8(i++),l.bg.hex=rg(l.bg),l.transparent=l.bg.r===255&&l.bg.g===0&&l.bg.b===255,o.raster[a+o.width*c]=l}n.layers.push(o)}return n};function yA(t){return typeof t=="object"&&wt(t.session)&&wt(t.player)&&wt(t.id)&&wt(t.sender)&&wt(t.target)}function he(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function bA(t,e,...n){return t.emit(e,"info",n),!0}function fe(t,e,...n){return t.emit(e,"log",n),!0}function wA(t,e,n){t.emit(e,"toast",n)}function EA(t,e,n){t.emit(e,"bridge:streamstart",n)}function xA(t,e){t.emit(e,"bridge:streamstop",void 0)}function vA(t,e,n){t.emit(e,"bridge:chatstart",n)}function kA(t,e){t.emit(e,"bridge:chatstop")}function TA(t,e,n,r,i,s,o){t.emit(e,"bridge:fetch",[n,r,i,s,o])}function AA(t,e){t.emit(e,"bridge:talkstart",e)}function RA(t,e){t.emit(e,"bridge:talkstop",e)}function SA(t,e){t.emit(e,"bridge:mediastart",e)}function OA(t,e){t.emit(e,"bridge:mediastop",e)}function IA(t,e,n){t.emit(e,"bridge:start",n)}function NA(t,e,n){t.emit(e,"bridge:tab",n)}function CA(t,e,n){t.emit(e,"gadgetclient:paint",n)}function LA(t,e,n){t.emit(e,"gadgetclient:patch",n)}function MA(t,e){t.emit(e,"gadgetserver:clearscroll")}function UA(t){t.emit("","ready")}function ig(t,e){t.emit(e,"register:loginfail")}function nf(t,e){t.emit(e,"register:loginready",!0)}function FA(t,e,n,r){t.emit(e,"register:savemem",[n,r])}function PA(t,e,n){t.emit(e,"register:forkmem",[n])}function rf(t,e,n){t.emit(e,"register:copy",n)}function BA(t,e,n,r){t.emit(e,"register:copyjsonfile",[n,r])}function sg(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function DA(t,e){t.emit(e,"register:dev",void 0)}function $A(t,e){t.emit(e,"register:share",void 0)}function jA(t,e){t.emit(e,"register:nuke",void 0)}function zA(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function KA(t,e,n){t.emit(e,"synth:tta",[n])}function WA(t,e,n,r,i){t.emit(e,"synth:play",[n,r,i])}function HA(t,e,n){t.emit(e,"synth:focus",n)}function GA(t,e,n){t.emit(e,"synth:bpm",n)}function YA(t,e,n){t.emit(e,"synth:playvolume",n)}function VA(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function ZA(t,e,n){t.emit(e,"synth:ttsvolume",n)}function sf(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function og(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function XA(t,e){t.emit(e,"register:inspector")}function ag(t,e,n,r,i,s,o){t.emit(e,"register:editor:open",[n,r,i,s,o])}function qA(t,e){t.emit(e,"register:editor:close")}function cg(t,e){t.emit(e,"vm:logout")}function el(t,e){const[n,r]=e;return`${t}:${[n,r].filter(x).join(":")}`}function JA(t,e,n){t.emit(e,"vm:cli",n)}function QA(t,e){t.emit(e,"vm:restart")}function lg(t,e){t.emit(e,"vm:flush")}function tR(t,e){t.emit(e,"vm:fork")}function eR(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function nR(t,e){return{filename:t,json:e}}function rR(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function iR(t,e){const n={filename:t,cursor:0,content:void 0};return gA(e).then(r=>{n.content=r}).catch(()=>{}),n}function nl(t,e,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=eR(i,s);break;case"json":o=nR(i,s);break;case"binary":o=rR(i,s);break;case"rexpaint":o=iR(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,o])},1)}function sR(t){const e=new Set;function n(s){yA(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Gn.invoke(s))}const r=io("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){Gn.disconnect(r)}return{forward:n,disconnect:i}}function oR(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=Vn(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const of=66.666,rl=Math.round(1e3/of),aR=3;function ug(t){return new Promise(e=>setTimeout(e,t))}const af=io("clock");let cf=0,il=0,lf=0,hg=performance.now();function fg(){const t=performance.now(),e=t-hg;lf+=e,lf>=of&&(lf%=of,af.emit("","tick",il),af.emit("","tock",il),++cf,++il,cf>=rl&&(cf%=rl,af.emit("","second",il))),hg=t,setTimeout(fg,2)}fg();function cR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dg={exports:{}},De=dg.exports={},Yr,Vr;function uf(){throw new Error("setTimeout has not been defined")}function hf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Yr=setTimeout:Yr=uf}catch{Yr=uf}try{typeof clearTimeout=="function"?Vr=clearTimeout:Vr=hf}catch{Vr=hf}})();function pg(t){if(Yr===setTimeout)return setTimeout(t,0);if((Yr===uf||!Yr)&&setTimeout)return Yr=setTimeout,setTimeout(t,0);try{return Yr(t,0)}catch{try{return Yr.call(null,t,0)}catch{return Yr.call(this,t,0)}}}function lR(t){if(Vr===clearTimeout)return clearTimeout(t);if((Vr===hf||!Vr)&&clearTimeout)return Vr=clearTimeout,clearTimeout(t);try{return Vr(t)}catch{try{return Vr.call(null,t)}catch{return Vr.call(this,t)}}}var wi=[],po=!1,Os,sl=-1;function uR(){!po||!Os||(po=!1,Os.length?wi=Os.concat(wi):sl=-1,wi.length&&mg())}function mg(){if(!po){var t=pg(uR);po=!0;for(var e=wi.length;e;){for(Os=wi,wi=[];++sl<e;)Os&&Os[sl].run();sl=-1,e=wi.length}Os=null,po=!1,lR(t)}}De.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi.push(new gg(t,e)),wi.length===1&&!po&&pg(mg)};function gg(t,e){this.fun=t,this.array=e}gg.prototype.run=function(){this.fun.apply(null,this.array)},De.title="browser",De.browser=!0,De.env={},De.argv=[],De.version="",De.versions={};function Ei(){}De.on=Ei,De.addListener=Ei,De.once=Ei,De.off=Ei,De.removeListener=Ei,De.removeAllListeners=Ei,De.emit=Ei,De.prependListener=Ei,De.prependOnceListener=Ei,De.listeners=function(t){return[]},De.binding=function(t){throw new Error("process.binding is not supported")},De.cwd=function(){return"/"},De.chdir=function(t){throw new Error("process.chdir is not supported")},De.umask=function(){return 0};var hR=dg.exports;const Or=cR(hR);var Kt={},ff=Symbol.for("react.transitional.element"),fR=Symbol.for("react.portal"),dR=Symbol.for("react.fragment"),pR=Symbol.for("react.strict_mode"),mR=Symbol.for("react.profiler"),gR=Symbol.for("react.consumer"),_R=Symbol.for("react.context"),yR=Symbol.for("react.forward_ref"),bR=Symbol.for("react.suspense"),wR=Symbol.for("react.memo"),_g=Symbol.for("react.lazy"),yg=Symbol.iterator;function ER(t){return t===null||typeof t!="object"?null:(t=yg&&t[yg]||t["@@iterator"],typeof t=="function"?t:null)}var bg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wg=Object.assign,Eg={};function mo(t,e,n){this.props=t,this.context=e,this.refs=Eg,this.updater=n||bg}mo.prototype.isReactComponent={},mo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},mo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function xg(){}xg.prototype=mo.prototype;function df(t,e,n){this.props=t,this.context=e,this.refs=Eg,this.updater=n||bg}var pf=df.prototype=new xg;pf.constructor=df,wg(pf,mo.prototype),pf.isPureReactComponent=!0;var vg=Array.isArray,ke={H:null,A:null,T:null,S:null,V:null},kg=Object.prototype.hasOwnProperty;function mf(t,e,n,r,i,s){return n=s.ref,{$$typeof:ff,type:t,key:e,ref:n!==void 0?n:null,props:s}}function xR(t,e){return mf(t.type,e,void 0,void 0,void 0,t.props)}function gf(t){return typeof t=="object"&&t!==null&&t.$$typeof===ff}function vR(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Tg=/\/+/g;function _f(t,e){return typeof t=="object"&&t!==null&&t.key!=null?vR(""+t.key):e.toString(36)}function Ag(){}function kR(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Ag,Ag):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function go(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ff:case fR:o=!0;break;case _g:return o=t._init,go(o(t._payload),e,n,r,i)}}if(o)return i=i(t),o=r===""?"."+_f(t,0):r,vg(i)?(n="",o!=null&&(n=o.replace(Tg,"$&/")+"/"),go(i,e,n,"",function(l){return l})):i!=null&&(gf(i)&&(i=xR(i,n+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(Tg,"$&/")+"/")+o)),e.push(i)),1;o=0;var a=r===""?".":r+":";if(vg(t))for(var c=0;c<t.length;c++)r=t[c],s=a+_f(r,c),o+=go(r,e,n,s,i);else if(c=ER(t),typeof c=="function")for(t=c.call(t),c=0;!(r=t.next()).done;)r=r.value,s=a+_f(r,c++),o+=go(r,e,n,s,i);else if(s==="object"){if(typeof t.then=="function")return go(kR(t),e,n,r,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function ol(t,e,n){if(t==null)return t;var r=[],i=0;return go(t,r,"","",function(s){return e.call(n,s,i++)}),r}function TR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Rg=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof Or=="object"&&typeof Or.emit=="function"){Or.emit("uncaughtException",t);return}console.error(t)};function AR(){}Kt.Children={map:ol,forEach:function(t,e,n){ol(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ol(t,function(){e++}),e},toArray:function(t){return ol(t,function(e){return e})||[]},only:function(t){if(!gf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},Kt.Component=mo,Kt.Fragment=dR,Kt.Profiler=mR,Kt.PureComponent=df,Kt.StrictMode=pR,Kt.Suspense=bR,Kt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ke,Kt.__COMPILER_RUNTIME={__proto__:null,c:function(t){return ke.H.useMemoCache(t)}},Kt.cache=function(t){return function(){return t.apply(null,arguments)}},Kt.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=wg({},t.props),i=t.key,s=void 0;if(e!=null)for(o in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(i=""+e.key),e)!kg.call(e,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&e.ref===void 0||(r[o]=e[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return mf(t.type,i,void 0,void 0,s,r)},Kt.createContext=function(t){return t={$$typeof:_R,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:gR,_context:t},t},Kt.createElement=function(t,e,n){var r,i={},s=null;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)kg.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return mf(t,s,void 0,void 0,null,i)},Kt.createRef=function(){return{current:null}},Kt.forwardRef=function(t){return{$$typeof:yR,render:t}},Kt.isValidElement=gf,Kt.lazy=function(t){return{$$typeof:_g,_payload:{_status:-1,_result:t},_init:TR}},Kt.memo=function(t,e){return{$$typeof:wR,type:t,compare:e===void 0?null:e}},Kt.startTransition=function(t){var e=ke.T,n={};ke.T=n;try{var r=t(),i=ke.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(AR,Rg)}catch(s){Rg(s)}finally{ke.T=e}},Kt.unstable_useCacheRefresh=function(){return ke.H.useCacheRefresh()},Kt.use=function(t){return ke.H.use(t)},Kt.useActionState=function(t,e,n){return ke.H.useActionState(t,e,n)},Kt.useCallback=function(t,e){return ke.H.useCallback(t,e)},Kt.useContext=function(t){return ke.H.useContext(t)},Kt.useDebugValue=function(){},Kt.useDeferredValue=function(t,e){return ke.H.useDeferredValue(t,e)},Kt.useEffect=function(t,e,n){var r=ke.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)},Kt.useId=function(){return ke.H.useId()},Kt.useImperativeHandle=function(t,e,n){return ke.H.useImperativeHandle(t,e,n)},Kt.useInsertionEffect=function(t,e){return ke.H.useInsertionEffect(t,e)},Kt.useLayoutEffect=function(t,e){return ke.H.useLayoutEffect(t,e)},Kt.useMemo=function(t,e){return ke.H.useMemo(t,e)},Kt.useOptimistic=function(t,e){return ke.H.useOptimistic(t,e)},Kt.useReducer=function(t,e,n){return ke.H.useReducer(t,e,n)},Kt.useRef=function(t){return ke.H.useRef(t)},Kt.useState=function(t){return ke.H.useState(t)},Kt.useSyncExternalStore=function(t,e,n){return ke.H.useSyncExternalStore(t,e,n)},Kt.useTransition=function(){return ke.H.useTransition()},Kt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Sg="0123456789abcdef",Og=[],al=[];for(let t=0;t<256;t++)Og[t]=Sg[t>>4&15]+Sg[t&15],t<16&&(t<10?al[48+t]=t:al[87+t]=t);const Ig=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=Og[t[r++]];return n},cl=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=al[t.charCodeAt(s++)]<<4|al[t.charCodeAt(s++)];return r};for(var Ng="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",RR=typeof Uint8Array>"u"?[]:new Uint8Array(256),ll=0;ll<Ng.length;ll++)RR[Ng.charCodeAt(ll)]=ll;new TextDecoder,new TextEncoder;const Cg=typeof window<"u"?window:self,Lg=Cg.crypto||Cg.msCrypto||{};Lg.subtle||Lg.webkitSubtle;const _o=globalThis||void 0||self,Ir=()=>new Map,yf=t=>{const e=Ir();return t.forEach((n,r)=>{e.set(r,n)}),e},Zi=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},SR=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},OR=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},yo=()=>new Set,bf=t=>t[t.length-1],IR=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Is=Array.from,NR=Array.isArray;class CR{constructor(){this._observers=Ir()}on(e,n){return Zi(this._observers,e,yo).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Is((this._observers.get(e)||Ir()).values()).forEach(r=>r(...n))}destroy(){this._observers=Ir()}}const Xi=Math.floor,ul=Math.abs,Mg=(t,e)=>t<e?t:e,Ns=(t,e)=>t>e?t:e,Ug=t=>t!==0?t<0:1/t<0,Fg=1,Pg=2,wf=4,Ef=8,Ua=32,xi=64,qn=128,hl=31,xf=63,Cs=127,LR=2147483647,Bg=Number.MAX_SAFE_INTEGER,MR=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Xi(t)===t),UR=t=>t.toLowerCase(),FR=/^\s*/g,PR=t=>t.replace(FR,""),BR=/([A-Z])/g,Dg=(t,e)=>PR(t.replace(BR,n=>`${e}${UR(n)}`)),DR=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},Fa=typeof TextEncoder<"u"?new TextEncoder:null,$R=Fa?t=>Fa.encode(t):DR;let Pa=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Pa&&Pa.decode(new Uint8Array).length===1&&(Pa=null);class Ba{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const fl=()=>new Ba,jR=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Zr=t=>{const e=new Uint8Array(jR(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},zR=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Ns(n,e)*2),t.cpos=0)},sn=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},vf=sn,ne=(t,e)=>{for(;e>Cs;)sn(t,qn|Cs&e),e=Xi(e/128);sn(t,Cs&e)},kf=(t,e)=>{const n=Ug(e);for(n&&(e=-e),sn(t,(e>xf?qn:0)|(n?xi:0)|xf&e),e=Xi(e/64);e>0;)sn(t,(e>Cs?qn:0)|Cs&e),e=Xi(e/128)},Tf=new Uint8Array(3e4),KR=Tf.length/3,WR=(t,e)=>{if(e.length<KR){const n=Fa.encodeInto(e,Tf).written||0;ne(t,n);for(let r=0;r<n;r++)sn(t,Tf[r])}else Jn(t,$R(e))},HR=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ne(t,r);for(let i=0;i<r;i++)sn(t,n.codePointAt(i))},bo=Fa&&Fa.encodeInto?WR:HR,dl=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Mg(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Ns(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Jn=(t,e)=>{ne(t,e.byteLength),dl(t,e)},Af=(t,e)=>{zR(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},GR=(t,e)=>Af(t,4).setFloat32(0,e,!1),YR=(t,e)=>Af(t,8).setFloat64(0,e,!1),VR=(t,e)=>Af(t,8).setBigInt64(0,e,!1),$g=new DataView(new ArrayBuffer(4)),ZR=t=>($g.setFloat32(0,t),$g.getFloat32(0)===t),Da=(t,e)=>{switch(typeof e){case"string":sn(t,119),bo(t,e);break;case"number":MR(e)&&ul(e)<=LR?(sn(t,125),kf(t,e)):ZR(e)?(sn(t,124),GR(t,e)):(sn(t,123),YR(t,e));break;case"bigint":sn(t,122),VR(t,e);break;case"object":if(e===null)sn(t,126);else if(NR(e)){sn(t,117),ne(t,e.length);for(let n=0;n<e.length;n++)Da(t,e[n])}else if(e instanceof Uint8Array)sn(t,116),Jn(t,e);else{sn(t,118);const n=Object.keys(e);ne(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];bo(t,i),Da(t,e[i])}}break;case"boolean":sn(t,e?120:121);break;default:sn(t,127)}};class jg extends Ba{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ne(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const zg=t=>{t.count>0&&(kf(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ne(t.encoder,t.count-2))};class pl{constructor(){this.encoder=new Ba,this.s=0,this.count=0}write(e){this.s===e?this.count++:(zg(this),this.count=1,this.s=e)}toUint8Array(){return zg(this),Zr(this.encoder)}}const Kg=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);kf(t.encoder,e),t.count>1&&ne(t.encoder,t.count-2)}};class Rf{constructor(){this.encoder=new Ba,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Kg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Kg(this),Zr(this.encoder)}}class XR{constructor(){this.sarr=[],this.s="",this.lensE=new pl}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Ba;return this.sarr.push(this.s),this.s="",bo(e,this.sarr.join("")),dl(e,this.lensE.toUint8Array()),Zr(e)}}const qi=t=>new Error(t),Xr=()=>{throw qi("Method unimplemented")},qr=()=>{throw qi("Unexpected case")},Wg=qi("Unexpected end of array"),Hg=qi("Integer out of Range");class ml{constructor(e){this.arr=e,this.pos=0}}const wo=t=>new ml(t),qR=t=>t.pos!==t.arr.length,JR=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Qn=t=>JR(t,Ht(t)),Eo=t=>t.arr[t.pos++],Ht=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&Cs)*n,n*=128,i<qn)return e;if(e>Bg)throw Hg}throw Wg},Sf=t=>{let e=t.arr[t.pos++],n=e&xf,r=64;const i=(e&xi)>0?-1:1;if(!(e&qn))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&Cs)*r,r*=128,e<qn)return i*n;if(n>Bg)throw Hg}throw Wg},xo=Pa?t=>Pa.decode(Qn(t)):t=>{let e=Ht(t);if(e===0)return"";{let n=String.fromCodePoint(Eo(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Eo(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Of=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},QR=[t=>{},t=>null,Sf,t=>Of(t,4).getFloat32(0,!1),t=>Of(t,8).getFloat64(0,!1),t=>Of(t,8).getBigInt64(0,!1),t=>!1,t=>!0,xo,t=>{const e=Ht(t),n={};for(let r=0;r<e;r++){const i=xo(t);n[i]=$a(t)}return n},t=>{const e=Ht(t),n=[];for(let r=0;r<e;r++)n.push($a(t));return n},Qn],$a=t=>QR[127-Eo(t)](t);class Gg extends ml{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),qR(this)?this.count=Ht(this)+1:this.count=-1),this.count--,this.s}}class gl extends ml{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Sf(this);const e=Ug(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ht(this)+2)}return this.count--,this.s}}class If extends ml{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Sf(this),n=e&1;this.diff=Xi(e/2),this.count=1,n&&(this.count=Ht(this)+2)}return this.s+=this.diff,this.count--,this.s}}class tS{constructor(e){this.decoder=new gl(e),this.str=xo(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const eS=crypto.getRandomValues.bind(crypto),Yg=()=>eS(new Uint32Array(1))[0],nS="10000000-1000-4000-8000"+-1e11,rS=()=>nS.replace(/[018]/g,t=>(t^Yg()&15>>t/4).toString(16)),Vg=t=>new Promise(t);Promise.all.bind(Promise);var Zg={},_l={};_l.byteLength=oS,_l.toByteArray=cS,_l.fromByteArray=hS;for(var Jr=[],hr=[],iS=typeof Uint8Array<"u"?Uint8Array:Array,Nf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vo=0,sS=Nf.length;vo<sS;++vo)Jr[vo]=Nf[vo],hr[Nf.charCodeAt(vo)]=vo;hr[45]=62,hr[95]=63;function Xg(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function oS(t){var e=Xg(t),n=e[0],r=e[1];return(n+r)*3/4-r}function aS(t,e,n){return(e+n)*3/4-n}function cS(t){var e,n=Xg(t),r=n[0],i=n[1],s=new iS(aS(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=hr[t.charCodeAt(c)]<<18|hr[t.charCodeAt(c+1)]<<12|hr[t.charCodeAt(c+2)]<<6|hr[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=hr[t.charCodeAt(c)]<<2|hr[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=hr[t.charCodeAt(c)]<<10|hr[t.charCodeAt(c+1)]<<4|hr[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function lS(t){return Jr[t>>18&63]+Jr[t>>12&63]+Jr[t>>6&63]+Jr[t&63]}function uS(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(lS(r));return i.join("")}function hS(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(uS(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Jr[e>>2]+Jr[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Jr[e>>10]+Jr[e>>4&63]+Jr[e<<2&63]+"=")),i.join("")}var Cf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Cf.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=t[e+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Cf.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=d/c:e+=d*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=a&255,h+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+h]=o&255,h+=p,o/=256,l-=8);t[n+h-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=_l,n=Cf,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=C,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const O=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(O,g),O.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(O){if(O>i)throw new RangeError('The value "'+O+'" is invalid for option "size"');const g=new s(O);return Object.setPrototypeOf(g,u.prototype),g}function u(O,g,_){if(typeof O=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(O)}return f(O,g,_)}u.poolSize=8192;function f(O,g,_){if(typeof O=="string")return m(O,g);if(o.isView(O))return y(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(dt(O,o)||O&&dt(O.buffer,o)||typeof a<"u"&&(dt(O,a)||O&&dt(O.buffer,a)))return k(O,g,_);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=O.valueOf&&O.valueOf();if(M!=null&&M!==O)return u.from(M,g,_);const z=A(O);if(z)return z;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return u.from(O[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}u.from=function(O,g,_){return f(O,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function h(O,g,_){return d(O),O<=0?l(O):g!==void 0?typeof _=="string"?l(O).fill(g,_):l(O).fill(g):l(O)}u.alloc=function(O,g,_){return h(O,g,_)};function p(O){return d(O),l(O<0?0:T(O)|0)}u.allocUnsafe=function(O){return p(O)},u.allocUnsafeSlow=function(O){return p(O)};function m(O,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=R(O,g)|0;let M=l(_);const z=M.write(O,g);return z!==_&&(M=M.slice(0,z)),M}function b(O){const g=O.length<0?0:T(O.length)|0,_=l(g);for(let M=0;M<g;M+=1)_[M]=O[M]&255;return _}function y(O){if(dt(O,s)){const g=new s(O);return k(g.buffer,g.byteOffset,g.byteLength)}return b(O)}function k(O,g,_){if(g<0||O.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&_===void 0?M=new s(O):_===void 0?M=new s(O,g):M=new s(O,g,_),Object.setPrototypeOf(M,u.prototype),M}function A(O){if(u.isBuffer(O)){const g=T(O.length)|0,_=l(g);return _.length===0||O.copy(_,0,0,g),_}if(O.length!==void 0)return typeof O.length!="number"||At(O.length)?l(0):b(O);if(O.type==="Buffer"&&Array.isArray(O.data))return b(O.data)}function T(O){if(O>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return O|0}function C(O){return+O!=O&&(O=0),u.alloc(+O)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),dt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let M=g.length,z=_.length;for(let Q=0,it=Math.min(M,z);Q<it;++Q)if(g[Q]!==_[Q]){M=g[Q],z=_[Q];break}return M<z?-1:z<M?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let M;if(_===void 0)for(_=0,M=0;M<g.length;++M)_+=g[M].length;const z=u.allocUnsafe(_);let Q=0;for(M=0;M<g.length;++M){let it=g[M];if(dt(it,s))Q+it.length>z.length?(u.isBuffer(it)||(it=u.from(it)),it.copy(z,Q)):s.prototype.set.call(z,it,Q);else if(u.isBuffer(it))it.copy(z,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return z};function R(O,g){if(u.isBuffer(O))return O.length;if(o.isView(O)||dt(O,o))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);const _=O.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&_===0)return 0;let z=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ct(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return mt(O).length;default:if(z)return M?-1:ct(O).length;g=(""+g).toLowerCase(),z=!0}}u.byteLength=R;function S(O,g,_){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(O||(O="utf8");;)switch(O){case"hex":return W(this,g,_);case"utf8":case"utf-8":return j(this,g,_);case"ascii":return ft(this,g,_);case"latin1":case"binary":return V(this,g,_);case"base64":return J(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Et(this,g,_);default:if(M)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),M=!0}}u.prototype._isBuffer=!0;function U(O,g,_){const M=O[g];O[g]=O[_],O[_]=M}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)U(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)U(this,_,_+3),U(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)U(this,_,_+7),U(this,_+1,_+6),U(this,_+2,_+5),U(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?j(this,0,g):S.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=t.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,M,z,Q){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),M===void 0&&(M=g?g.length:0),z===void 0&&(z=0),Q===void 0&&(Q=this.length),_<0||M>g.length||z<0||Q>this.length)throw new RangeError("out of range index");if(z>=Q&&_>=M)return 0;if(z>=Q)return-1;if(_>=M)return 1;if(_>>>=0,M>>>=0,z>>>=0,Q>>>=0,this===g)return 0;let it=Q-z,zt=M-_;const Oe=Math.min(it,zt),we=this.slice(z,Q),Ie=g.slice(_,M);for(let ce=0;ce<Oe;++ce)if(we[ce]!==Ie[ce]){it=we[ce],zt=Ie[ce];break}return it<zt?-1:zt<it?1:0};function N(O,g,_,M,z){if(O.length===0)return-1;if(typeof _=="string"?(M=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,At(_)&&(_=z?0:O.length-1),_<0&&(_=O.length+_),_>=O.length){if(z)return-1;_=O.length-1}else if(_<0)if(z)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,M)),u.isBuffer(g))return g.length===0?-1:D(O,g,_,M,z);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?z?s.prototype.indexOf.call(O,g,_):s.prototype.lastIndexOf.call(O,g,_):D(O,[g],_,M,z);throw new TypeError("val must be string, number or Buffer")}function D(O,g,_,M,z){let Q=1,it=O.length,zt=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(O.length<2||g.length<2)return-1;Q=2,it/=2,zt/=2,_/=2}function Oe(Ie,ce){return Q===1?Ie[ce]:Ie.readUInt16BE(ce*Q)}let we;if(z){let Ie=-1;for(we=_;we<it;we++)if(Oe(O,we)===Oe(g,Ie===-1?0:we-Ie)){if(Ie===-1&&(Ie=we),we-Ie+1===zt)return Ie*Q}else Ie!==-1&&(we-=we-Ie),Ie=-1}else for(_+zt>it&&(_=it-zt),we=_;we>=0;we--){let Ie=!0;for(let ce=0;ce<zt;ce++)if(Oe(O,we+ce)!==Oe(g,ce)){Ie=!1;break}if(Ie)return we}return-1}u.prototype.includes=function(g,_,M){return this.indexOf(g,_,M)!==-1},u.prototype.indexOf=function(g,_,M){return N(this,g,_,M,!0)},u.prototype.lastIndexOf=function(g,_,M){return N(this,g,_,M,!1)};function Y(O,g,_,M){_=Number(_)||0;const z=O.length-_;M?(M=Number(M),M>z&&(M=z)):M=z;const Q=g.length;M>Q/2&&(M=Q/2);let it;for(it=0;it<M;++it){const zt=parseInt(g.substr(it*2,2),16);if(At(zt))return it;O[_+it]=zt}return it}function L(O,g,_,M){return bt(ct(g,O.length-_),O,_,M)}function I(O,g,_,M){return bt(ht(g),O,_,M)}function E(O,g,_,M){return bt(mt(g),O,_,M)}function B(O,g,_,M){return bt(q(g,O.length-_),O,_,M)}u.prototype.write=function(g,_,M,z){if(_===void 0)z="utf8",M=this.length,_=0;else if(M===void 0&&typeof _=="string")z=_,M=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(M)?(M=M>>>0,z===void 0&&(z="utf8")):(z=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-_;if((M===void 0||M>Q)&&(M=Q),g.length>0&&(M<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");z||(z="utf8");let it=!1;for(;;)switch(z){case"hex":return Y(this,g,_,M);case"utf8":case"utf-8":return L(this,g,_,M);case"ascii":case"latin1":case"binary":return I(this,g,_,M);case"base64":return E(this,g,_,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,g,_,M);default:if(it)throw new TypeError("Unknown encoding: "+z);z=(""+z).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(O,g,_){return g===0&&_===O.length?e.fromByteArray(O):e.fromByteArray(O.slice(g,_))}function j(O,g,_){_=Math.min(O.length,_);const M=[];let z=g;for(;z<_;){const Q=O[z];let it=null,zt=Q>239?4:Q>223?3:Q>191?2:1;if(z+zt<=_){let Oe,we,Ie,ce;switch(zt){case 1:Q<128&&(it=Q);break;case 2:Oe=O[z+1],(Oe&192)===128&&(ce=(Q&31)<<6|Oe&63,ce>127&&(it=ce));break;case 3:Oe=O[z+1],we=O[z+2],(Oe&192)===128&&(we&192)===128&&(ce=(Q&15)<<12|(Oe&63)<<6|we&63,ce>2047&&(ce<55296||ce>57343)&&(it=ce));break;case 4:Oe=O[z+1],we=O[z+2],Ie=O[z+3],(Oe&192)===128&&(we&192)===128&&(Ie&192)===128&&(ce=(Q&15)<<18|(Oe&63)<<12|(we&63)<<6|Ie&63,ce>65535&&ce<1114112&&(it=ce))}}it===null?(it=65533,zt=1):it>65535&&(it-=65536,M.push(it>>>10&1023|55296),it=56320|it&1023),M.push(it),z+=zt}return tt(M)}const st=4096;function tt(O){const g=O.length;if(g<=st)return String.fromCharCode.apply(String,O);let _="",M=0;for(;M<g;)_+=String.fromCharCode.apply(String,O.slice(M,M+=st));return _}function ft(O,g,_){let M="";_=Math.min(O.length,_);for(let z=g;z<_;++z)M+=String.fromCharCode(O[z]&127);return M}function V(O,g,_){let M="";_=Math.min(O.length,_);for(let z=g;z<_;++z)M+=String.fromCharCode(O[z]);return M}function W(O,g,_){const M=O.length;(!g||g<0)&&(g=0),(!_||_<0||_>M)&&(_=M);let z="";for(let Q=g;Q<_;++Q)z+=le[O[Q]];return z}function Et(O,g,_){const M=O.slice(g,_);let z="";for(let Q=0;Q<M.length-1;Q+=2)z+=String.fromCharCode(M[Q]+M[Q+1]*256);return z}u.prototype.slice=function(g,_){const M=this.length;g=~~g,_=_===void 0?M:~~_,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),_<0?(_+=M,_<0&&(_=0)):_>M&&(_=M),_<g&&(_=g);const z=this.subarray(g,_);return Object.setPrototypeOf(z,u.prototype),z};function at(O,g,_){if(O%1!==0||O<0)throw new RangeError("offset is not uint");if(O+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||at(g,_,this.length);let z=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)z+=this[g+it]*Q;return z},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||at(g,_,this.length);let z=this[g+--_],Q=1;for(;_>0&&(Q*=256);)z+=this[g+--_]*Q;return z},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||at(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||at(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||at(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||at(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Bt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&P(g,this.length-8);const z=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(z)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=Bt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&P(g,this.length-8);const z=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(z)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||at(g,_,this.length);let z=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)z+=this[g+it]*Q;return Q*=128,z>=Q&&(z-=Math.pow(2,8*_)),z},u.prototype.readIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||at(g,_,this.length);let z=_,Q=1,it=this[g+--z];for(;z>0&&(Q*=256);)it+=this[g+--z]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*_)),it},u.prototype.readInt8=function(g,_){return g=g>>>0,_||at(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||at(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||at(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Bt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&P(g,this.length-8);const z=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(z)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Bt(function(g){g=g>>>0,et(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&P(g,this.length-8);const z=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(z)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||at(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||at(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||at(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||at(g,8,this.length),n.read(this,g,!1,52,8)};function lt(O,g,_,M,z,Q){if(!u.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>z||g<Q)throw new RangeError('"value" argument is out of bounds');if(_+M>O.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,M,z){if(g=+g,_=_>>>0,M=M>>>0,!z){const zt=Math.pow(2,8*M)-1;lt(this,g,_,M,zt,0)}let Q=1,it=0;for(this[_]=g&255;++it<M&&(Q*=256);)this[_+it]=g/Q&255;return _+M},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,M,z){if(g=+g,_=_>>>0,M=M>>>0,!z){const zt=Math.pow(2,8*M)-1;lt(this,g,_,M,zt,0)}let Q=M-1,it=1;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)this[_+Q]=g/it&255;return _+M},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function Ut(O,g,_,M,z){ot(g,M,z,O,_,7);let Q=Number(g&BigInt(4294967295));O[_++]=Q,Q=Q>>8,O[_++]=Q,Q=Q>>8,O[_++]=Q,Q=Q>>8,O[_++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[_++]=it,it=it>>8,O[_++]=it,it=it>>8,O[_++]=it,it=it>>8,O[_++]=it,_}function Vt(O,g,_,M,z){ot(g,M,z,O,_,7);let Q=Number(g&BigInt(4294967295));O[_+7]=Q,Q=Q>>8,O[_+6]=Q,Q=Q>>8,O[_+5]=Q,Q=Q>>8,O[_+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return O[_+3]=it,it=it>>8,O[_+2]=it,it=it>>8,O[_+1]=it,it=it>>8,O[_]=it,_+8}u.prototype.writeBigUInt64LE=Bt(function(g,_=0){return Ut(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Bt(function(g,_=0){return Vt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,M,z){if(g=+g,_=_>>>0,!z){const Oe=Math.pow(2,8*M-1);lt(this,g,_,M,Oe-1,-Oe)}let Q=0,it=1,zt=0;for(this[_]=g&255;++Q<M&&(it*=256);)g<0&&zt===0&&this[_+Q-1]!==0&&(zt=1),this[_+Q]=(g/it>>0)-zt&255;return _+M},u.prototype.writeIntBE=function(g,_,M,z){if(g=+g,_=_>>>0,!z){const Oe=Math.pow(2,8*M-1);lt(this,g,_,M,Oe-1,-Oe)}let Q=M-1,it=1,zt=0;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)g<0&&zt===0&&this[_+Q+1]!==0&&(zt=1),this[_+Q]=(g/it>>0)-zt&255;return _+M},u.prototype.writeInt8=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=Bt(function(g,_=0){return Ut(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Bt(function(g,_=0){return Vt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ft(O,g,_,M,z,Q){if(_+M>O.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function kt(O,g,_,M,z){return g=+g,_=_>>>0,z||Ft(O,g,_,4),n.write(O,g,_,M,23,4),_+4}u.prototype.writeFloatLE=function(g,_,M){return kt(this,g,_,!0,M)},u.prototype.writeFloatBE=function(g,_,M){return kt(this,g,_,!1,M)};function $t(O,g,_,M,z){return g=+g,_=_>>>0,z||Ft(O,g,_,8),n.write(O,g,_,M,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,M){return $t(this,g,_,!0,M)},u.prototype.writeDoubleBE=function(g,_,M){return $t(this,g,_,!1,M)},u.prototype.copy=function(g,_,M,z){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!z&&z!==0&&(z=this.length),_>=g.length&&(_=g.length),_||(_=0),z>0&&z<M&&(z=M),z===M||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(z<0)throw new RangeError("sourceEnd out of bounds");z>this.length&&(z=this.length),g.length-_<z-M&&(z=g.length-_+M);const Q=z-M;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,M,z):s.prototype.set.call(g,this.subarray(M,z),_),Q},u.prototype.fill=function(g,_,M,z){if(typeof g=="string"){if(typeof _=="string"?(z=_,_=0,M=this.length):typeof M=="string"&&(z=M,M=this.length),z!==void 0&&typeof z!="string")throw new TypeError("encoding must be a string");if(typeof z=="string"&&!u.isEncoding(z))throw new TypeError("Unknown encoding: "+z);if(g.length===1){const it=g.charCodeAt(0);(z==="utf8"&&it<128||z==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<M)throw new RangeError("Out of range index");if(M<=_)return this;_=_>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=_;Q<M;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,z),zt=it.length;if(zt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<M-_;++Q)this[Q+_]=it[Q%zt]}return this};const Pt={};function Se(O,g,_){Pt[O]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${O}]`,this.stack,delete this.name}get code(){return O}set code(z){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:z,writable:!0})}toString(){return`${this.name} [${O}]: ${this.message}`}}}Se("ERR_BUFFER_OUT_OF_BOUNDS",function(O){return O?`${O} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Se("ERR_INVALID_ARG_TYPE",function(O,g){return`The "${O}" argument must be of type number. Received type ${typeof g}`},TypeError),Se("ERR_OUT_OF_RANGE",function(O,g,_){let M=`The value of "${O}" is out of range.`,z=_;return Number.isInteger(_)&&Math.abs(_)>2**32?z=Be(String(_)):typeof _=="bigint"&&(z=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(z=Be(z)),z+="n"),M+=` It must be ${g}. Received ${z}`,M},RangeError);function Be(O){let g="",_=O.length;const M=O[0]==="-"?1:0;for(;_>=M+4;_-=3)g=`_${O.slice(_-3,_)}${g}`;return`${O.slice(0,_)}${g}`}function v(O,g,_){et(g,"offset"),(O[g]===void 0||O[g+_]===void 0)&&P(g,O.length-(_+1))}function ot(O,g,_,M,z,Q){if(O>_||O<g){const it=typeof g=="bigint"?"n":"";let zt;throw g===0||g===BigInt(0)?zt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:zt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Pt.ERR_OUT_OF_RANGE("value",zt,O)}v(M,z,Q)}function et(O,g){if(typeof O!="number")throw new Pt.ERR_INVALID_ARG_TYPE(g,"number",O)}function P(O,g,_){throw Math.floor(O)!==O?(et(O,_),new Pt.ERR_OUT_OF_RANGE("offset","an integer",O)):g<0?new Pt.ERR_BUFFER_OUT_OF_BOUNDS:new Pt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,O)}const F=/[^+/0-9A-Za-z-_]/g;function G(O){if(O=O.split("=")[0],O=O.trim().replace(F,""),O.length<2)return"";for(;O.length%4!==0;)O=O+"=";return O}function ct(O,g){g=g||1/0;let _;const M=O.length;let z=null;const Q=[];for(let it=0;it<M;++it){if(_=O.charCodeAt(it),_>55295&&_<57344){if(!z){if(_>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===M){(g-=3)>-1&&Q.push(239,191,189);continue}z=_;continue}if(_<56320){(g-=3)>-1&&Q.push(239,191,189),z=_;continue}_=(z-55296<<10|_-56320)+65536}else z&&(g-=3)>-1&&Q.push(239,191,189);if(z=null,_<128){if((g-=1)<0)break;Q.push(_)}else if(_<2048){if((g-=2)<0)break;Q.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;Q.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;Q.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return Q}function ht(O){const g=[];for(let _=0;_<O.length;++_)g.push(O.charCodeAt(_)&255);return g}function q(O,g){let _,M,z;const Q=[];for(let it=0;it<O.length&&!((g-=2)<0);++it)_=O.charCodeAt(it),M=_>>8,z=_%256,Q.push(z),Q.push(M);return Q}function mt(O){return e.toByteArray(G(O))}function bt(O,g,_,M){let z;for(z=0;z<M&&!(z+_>=g.length||z>=O.length);++z)g[z+_]=O[z];return z}function dt(O,g){return O instanceof g||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===g.name}function At(O){return O!==O}const le=function(){const O="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const M=_*16;for(let z=0;z<16;++z)g[M+z]=O[_]+O[z]}return g}();function Bt(O){return typeof BigInt>"u"?Hn:O}function Hn(){throw new Error("BigInt not supported")}})(Zg);const hn=Zg.Buffer,qg=t=>t===void 0?null:t;class fS{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Jg=new fS,dS=!0;try{typeof localStorage<"u"&&localStorage&&(Jg=localStorage,dS=!1)}catch{}const pS=Jg,mS=Object.assign,gS=Object.keys,_S=(t,e)=>{for(const n in t)e(t[n],n)},Qg=t=>gS(t).length,yS=t=>{for(const e in t)return!1;return!0},bS=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},wS=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),ES=(t,e)=>t===e||Qg(t)===Qg(e)&&bS(t,(n,r)=>(n!==void 0||wS(e,r))&&e[r]===n),xS=Object.freeze,t_=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&t_(t[e])}return xS(t)},Lf=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Lf(t,e,n+1)}},vS=t=>t,kS=(t,e)=>e.includes(t);var e_={};const ja=typeof Or<"u"&&Or.release&&/node|io\.js/.test(Or.release.name)&&Object.prototype.toString.call(typeof Or<"u"?Or:0)==="[object process]";let Qr;const TS=()=>{if(Qr===void 0)if(ja){Qr=Ir();const t=Or.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Qr.set(e,""),e=r):e!==null&&(Qr.set(e,r),e=null)}e!==null&&Qr.set(e,"")}else typeof location=="object"?(Qr=Ir(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Qr.set(`--${Dg(e,"-")}`,n),Qr.set(`-${Dg(e,"-")}`,n)}})):Qr=Ir();return Qr},Mf=t=>TS().has(t),yl=t=>qg(ja?e_[t.toUpperCase().replaceAll("-","_")]:pS.getItem(t)),n_=t=>Mf("--"+t)||yl(t)!==null;n_("production");const AS=ja&&kS(e_.FORCE_COLOR,["true","1","2"])||!Mf("--no-colors")&&!n_("no-color")&&(!ja||Or.stdout.isTTY)&&(!ja||Mf("--color")||yl("COLORTERM")!==null||(yl("TERM")||"").includes("color")),RS=t=>new Uint8Array(t),SS=t=>{const e=RS(t.byteLength);return e.set(t),e};class OS{constructor(e,n){this.left=e,this.right=n}}const vi=(t,e)=>new OS(t,e);typeof DOMParser<"u"&&new DOMParser;const IS=t=>SR(t,(e,n)=>`${n}:${e};`).join(""),ki=Symbol,r_=ki(),i_=ki(),NS=ki(),CS=ki(),LS=ki(),s_=ki(),MS=ki(),Uf=ki(),US=ki(),FS=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},PS={[r_]:vi("font-weight","bold"),[i_]:vi("font-weight","normal"),[NS]:vi("color","blue"),[LS]:vi("color","green"),[CS]:vi("color","grey"),[s_]:vi("color","red"),[MS]:vi("color","purple"),[Uf]:vi("color","orange"),[US]:vi("color","black")},o_=AS?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Ir();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=PS[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=IS(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:FS,BS=(...t)=>{console.log(...o_(t)),a_.forEach(e=>e.print(t))},DS=(...t)=>{console.warn(...o_(t)),t.unshift(Uf),a_.forEach(e=>e.print(t))},a_=yo(),c_=t=>({[Symbol.iterator](){return this},next:t}),$S=(t,e)=>c_(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Ff=(t,e)=>c_(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Pf{constructor(e,n){this.clock=e,this.len=n}}class za{constructor(){this.clients=new Map}}const l_=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];T_(t,s,a.clock,a.len,n)}}),jS=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Xi((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},u_=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&jS(n,e.clock)!==null},Bf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=Ns(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},zS=t=>{const e=new za;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)IR(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return Bf(e),e},bl=(t,e,n,r)=>{Zi(t.clients,e,()=>[]).push(new Pf(n,r))},KS=()=>new za,WS=t=>{const e=KS();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Pf(a,c))}}i.length>0&&e.clients.set(r,i)}),e},ko=(t,e)=>{ne(t.restEncoder,e.clients.size),Is(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ne(t.restEncoder,n);const i=r.length;ne(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},Df=t=>{const e=new za,n=Ht(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Ht(t.restDecoder),s=Ht(t.restDecoder);if(s>0){const o=Zi(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Pf(t.readDsClock(),t.readDsLen()))}}return e},h_=(t,e,n)=>{const r=new za,i=Ht(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Ht(t.restDecoder),a=Ht(t.restDecoder),c=n.clients.get(o)||[],l=on(n,o);for(let u=0;u<a;u++){const f=t.readDsClock(),d=f+t.readDsLen();if(f<l){l<d&&bl(r,o,l,d-l);let h=ti(c,f),p=c[h];for(!p.deleted&&p.id.clock<f&&(c.splice(h+1,0,Ll(e,p,f-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(h,0,Ll(e,p,d-p.id.clock)),p.delete(e))}else bl(r,o,f,d-f)}}if(r.clients.size>0){const s=new Ls;return ne(s.restEncoder,0),ko(s,r),s.toUint8Array()}return null},f_=Yg;class To extends CR{constructor({guid:e=rS(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=f_(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new x_,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Vg(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Vg(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&de(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Is(this.subdocs).map(e=>e.guid))}transact(e,n=null){return de(this,e,n)}get(e,n=fn){const r=Zi(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==fn&&i!==n)if(i===fn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Oo)}getText(e=""){return this.get(e,Ti)}getMap(e=""){return this.get(e,Io)}getXmlElement(e=""){return this.get(e,Co)}getXmlFragment(e=""){return this.get(e,Ms)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Is(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new To({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,de(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class d_{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ht(this.restDecoder)}readDsLen(){return Ht(this.restDecoder)}}class p_ extends d_{readLeftID(){return Xt(Ht(this.restDecoder),Ht(this.restDecoder))}readRightID(){return Xt(Ht(this.restDecoder),Ht(this.restDecoder))}readClient(){return Ht(this.restDecoder)}readInfo(){return Eo(this.restDecoder)}readString(){return xo(this.restDecoder)}readParentInfo(){return Ht(this.restDecoder)===1}readTypeRef(){return Ht(this.restDecoder)}readLen(){return Ht(this.restDecoder)}readAny(){return $a(this.restDecoder)}readBuf(){return SS(Qn(this.restDecoder))}readJSON(){return JSON.parse(xo(this.restDecoder))}readKey(){return xo(this.restDecoder)}}class HS{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ht(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ht(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Ao extends HS{constructor(e){super(e),this.keys=[],Ht(e),this.keyClockDecoder=new If(Qn(e)),this.clientDecoder=new gl(Qn(e)),this.leftClockDecoder=new If(Qn(e)),this.rightClockDecoder=new If(Qn(e)),this.infoDecoder=new Gg(Qn(e),Eo),this.stringDecoder=new tS(Qn(e)),this.parentInfoDecoder=new Gg(Qn(e),Eo),this.typeRefDecoder=new gl(Qn(e)),this.lenDecoder=new gl(Qn(e))}readLeftID(){return new Ro(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ro(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return $a(this.restDecoder)}readBuf(){return Qn(this.restDecoder)}readJSON(){return $a(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class GS{constructor(){this.restEncoder=fl()}toUint8Array(){return Zr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ne(this.restEncoder,e)}writeDsLen(e){ne(this.restEncoder,e)}}class Ka extends GS{writeLeftID(e){ne(this.restEncoder,e.client),ne(this.restEncoder,e.clock)}writeRightID(e){ne(this.restEncoder,e.client),ne(this.restEncoder,e.clock)}writeClient(e){ne(this.restEncoder,e)}writeInfo(e){vf(this.restEncoder,e)}writeString(e){bo(this.restEncoder,e)}writeParentInfo(e){ne(this.restEncoder,e?1:0)}writeTypeRef(e){ne(this.restEncoder,e)}writeLen(e){ne(this.restEncoder,e)}writeAny(e){Da(this.restEncoder,e)}writeBuf(e){Jn(this.restEncoder,e)}writeJSON(e){bo(this.restEncoder,JSON.stringify(e))}writeKey(e){bo(this.restEncoder,e)}}class YS{constructor(){this.restEncoder=fl(),this.dsCurrVal=0}toUint8Array(){return Zr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ne(this.restEncoder,n)}writeDsLen(e){e===0&&qr(),ne(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ls extends YS{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Rf,this.clientEncoder=new pl,this.leftClockEncoder=new Rf,this.rightClockEncoder=new Rf,this.infoEncoder=new jg(vf),this.stringEncoder=new XR,this.parentInfoEncoder=new jg(vf),this.typeRefEncoder=new pl,this.lenEncoder=new pl}toUint8Array(){const e=fl();return ne(e,0),Jn(e,this.keyClockEncoder.toUint8Array()),Jn(e,this.clientEncoder.toUint8Array()),Jn(e,this.leftClockEncoder.toUint8Array()),Jn(e,this.rightClockEncoder.toUint8Array()),Jn(e,Zr(this.infoEncoder)),Jn(e,this.stringEncoder.toUint8Array()),Jn(e,Zr(this.parentInfoEncoder)),Jn(e,this.typeRefEncoder.toUint8Array()),Jn(e,this.lenEncoder.toUint8Array()),dl(e,Zr(this.restEncoder)),Zr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Da(this.restEncoder,e)}writeBuf(e){Jn(this.restEncoder,e)}writeJSON(e){Da(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const VS=(t,e,n,r)=>{r=Ns(r,e[0].id.clock);const i=ti(e,r);ne(t.restEncoder,e.length-i),t.writeClient(n),ne(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},$f=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{on(e,s)>i&&r.set(s,i)}),zf(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ne(t.restEncoder,r.size),Is(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{VS(t,e.clients.get(i),i,s)})},ZS=(t,e)=>{const n=Ir(),r=Ht(t.restDecoder);for(let i=0;i<r;i++){const s=Ht(t.restDecoder),o=new Array(s),a=t.readClient();let c=Ht(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(hl&u){case 0:{const f=t.readLen();o[l]=new fr(Xt(a,c),f),c+=f;break}case 10:{const f=Ht(t.restDecoder);o[l]=new dr(Xt(a,c),f),c+=f;break}default:{const f=(u&(xi|qn))===0,d=new Ze(Xt(a,c),null,(u&qn)===qn?t.readLeftID():null,null,(u&xi)===xi?t.readRightID():null,f?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,f&&(u&Ua)===Ua?t.readString():null,X_(t,u));o[l]=d,c+=d.length}}}}return n},XS=(t,e,n)=>{const r=[];let i=Is(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new x_,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==dr){const p=Zi(f,u.id.client,()=>on(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,on(e,m)),d();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new Ls;return $f(h,a,new Map),ne(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},qS=(t,e)=>$f(t,e.doc.store,e.beforeState),JS=(t,e,n,r=new Ao(t))=>de(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=ZS(r,o),l=XS(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<on(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const p=u.missing.get(d);(p==null||p>h)&&u.missing.set(d,h)}u.update=xl([u.update,l.update])}}else a.pendingStructs=l;const f=h_(r,i,a);if(a.pendingDs){const d=new Ao(wo(a.pendingDs));Ht(d.restDecoder);const h=h_(d,i,a);f&&h?a.pendingDs=xl([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,m_(i.doc,d)}},n,!1),m_=(t,e,n,r=Ao)=>{const i=wo(e);JS(i,t,n,new r(i))},g_=(t,e,n)=>m_(t,e,n,p_),QS=(t,e,n=new Map)=>{$f(t,e.store,n),ko(t,WS(e.store))},tO=(t,e=new Uint8Array([0]),n=new Ls)=>{const r=__(e);QS(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(fO(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Ka)return uO(i.map((s,o)=>o===0?s:pO(s)));if(n.constructor===Ls)return xl(i)}return i[0]},eO=(t,e)=>tO(t,e,new Ka),nO=t=>{const e=new Map,n=Ht(t.restDecoder);for(let r=0;r<n;r++){const i=Ht(t.restDecoder),s=Ht(t.restDecoder);e.set(i,s)}return e},__=t=>nO(new d_(wo(t)));class rO{constructor(){this.l=[]}}const y_=()=>new rO,b_=(t,e)=>t.l.push(e),w_=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},E_=(t,e,n)=>Lf(t.l,[e,n]);class Ro{constructor(e,n){this.client=e,this.clock=n}}const wl=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Xt=(t,e)=>new Ro(t,e),iO=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw qr()},So=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!u_(e.ds,t.id),jf=(t,e)=>{const n=Zi(t.meta,jf,yo),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<on(r,s)&&Ji(t,Xt(s,i))}),l_(t,e.ds,i=>{}),n.add(e))};class x_{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const zf=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},on=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},v_=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw qr()}n.push(e)},ti=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Xi(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Xi((n+r)/2)}throw qr()},Kf=(t,e)=>{const n=t.clients.get(e.client);return n[ti(n,e.clock)]},Wf=(t,e,n)=>{const r=ti(e,n),i=e[r];return i.id.clock<n&&i instanceof Ze?(e.splice(r+1,0,Ll(t,i,n-i.id.clock)),r+1):r},Ji=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Wf(t,n,e.clock)]},k_=(t,e,n)=>{const r=e.clients.get(n.client),i=ti(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==fr&&r.splice(i+1,0,Ll(t,s,n.clock-s.id.clock+1)),s},sO=(t,e,n)=>{const r=t.clients.get(e.id.client);r[ti(r,e.id.clock)]=n},T_=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=Wf(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&Wf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class oO{constructor(e,n,r){this.doc=e,this.deleteSet=new za,this.beforeState=zf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const A_=(t,e)=>e.deleteSet.clients.size===0&&!OR(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Bf(e.deleteSet),qS(t,e),ko(t,e.deleteSet),!0),R_=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Zi(t.changed,e,yo).add(n)},El=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},aO=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ti(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Ze&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},cO=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Mg(i.length-1,1+ti(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+El(i,c)}})},S_=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Bf(s),n.afterState=zf(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),E_(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Lf(a,[]),n._needFormattingCleanup&&SO(n)}finally{r.gc&&aO(s,i,r.gcFilter),cO(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=Ns(ti(h,d),1);for(let m=h.length-1;m>=p;)m-=1+El(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=ti(h,d);p+1<h.length&&El(h,p+1)>1||p>0&&El(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(BS(Uf,r_,"[yjs] ",i_,s_,"Changed the client-id because another client seems to be using it."),r.clientID=f_()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ka;A_(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Ls;A_(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):S_(t,e+1)}}},de=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new oO(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&S_(i,0)}}return o};function*lO(t){const e=Ht(t.restDecoder);for(let n=0;n<e;n++){const r=Ht(t.restDecoder),i=t.readClient();let s=Ht(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Ht(t.restDecoder);yield new dr(Xt(i,s),c),s+=c}else if(hl&a){const c=(a&(xi|qn))===0,l=new Ze(Xt(i,s),null,(a&qn)===qn?t.readLeftID():null,null,(a&xi)===xi?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Ua)===Ua?t.readString():null,X_(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new fr(Xt(i,s),c),s+=c}}}}class Hf{constructor(e,n){this.gen=lO(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===dr);return this.curr}}class Gf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const uO=t=>xl(t,p_,Ka),hO=(t,e)=>{if(t.constructor===fr){const{client:n,clock:r}=t.id;return new fr(Xt(n,r+e),t.length-e)}else if(t.constructor===dr){const{client:n,clock:r}=t.id;return new dr(Xt(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Ze(Xt(r,i+e),null,Xt(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},xl=(t,e=Ao,n=Ls)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(wo(u)));let i=r.map(u=>new Hf(u,!0)),s=null;const o=new n,a=new Gf(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const p=d.curr.id.clock-h.curr.id.clock;return p===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===dr?1:-1:p}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Qi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===dr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Qi(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new dr(Xt(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===dr?s.struct.length-=p:d=hO(d,p)),s.struct.mergeWith(d)||(Qi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==dr;d=u.next())Qi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Qi(a,s.struct,s.offset),s=null),Yf(a);const c=r.map(u=>Df(u)),l=zS(c);return ko(o,l),o.toUint8Array()},fO=(t,e,n=Ao,r=Ls)=>{const i=__(e),s=new r,o=new Gf(s),a=new n(wo(t)),c=new Hf(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===dr){c.next();continue}if(u.id.clock+u.length>d)for(Qi(o,u,Ns(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Qi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}Yf(o);const l=Df(a);return ko(s,l),s.toUint8Array()},O_=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Zr(t.encoder.restEncoder)}),t.encoder.restEncoder=fl(),t.written=0)},Qi=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&O_(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ne(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Yf=t=>{O_(t);const e=t.encoder.restEncoder;ne(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ne(e,r.written),dl(e,r.restEncoder)}},dO=(t,e,n,r)=>{const i=new n(wo(t)),s=new Hf(i,!1),o=new r,a=new Gf(o);for(let l=s.curr;l!==null;l=s.next())Qi(a,e(l),0);Yf(a);const c=Df(i);return ko(o,c),o.toUint8Array()},pO=t=>dO(t,vS,Ao,Ka),I_="You must not compute changes after the event-handler fired.";class vl{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=mO(this.currentTarget,this.target))}deletes(e){return u_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw qi(I_);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=bf(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=bf(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=bf(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw qi(I_);const n=this.target,r=yo(),i=yo(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const mO=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},gn=()=>{DS("Invalid access: Add Yjs type to a document before reading data.")},N_=80;let Vf=0;class gO{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Vf++}}const _O=t=>{t.timestamp=Vf++},C_=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Vf++},yO=(t,e,n)=>{if(t.length>=N_){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return C_(r,e,n),r}else{const r=new gO(e,n);return t.push(r),r}},kl=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>ul(e-s.index)<ul(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,_O(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ul(n.index-i)<r.parent.length/N_?(C_(n,r,i),n):yO(t._searchMarker,r,i)},Wa=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=Ns(e,i.index+n))}},Tl=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Zi(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;E_(r._eH,n,e)};class fn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=y_(),this._dEH=y_(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Xr()}clone(){throw Xr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){b_(this._eH,e)}observeDeep(e){b_(this._dEH,e)}unobserve(e){w_(this._eH,e)}unobserveDeep(e){w_(this._dEH,e)}toJSON(){}}const L_=(t,e,n)=>{t.doc??gn(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},M_=t=>{t.doc??gn();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Ha=(t,e)=>{let n=0,r=t._start;for(t.doc??gn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},U_=(t,e)=>{const n=[];return Ha(t,(r,i)=>{n.push(e(r,i,t))}),n},bO=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},F_=(t,e)=>{t.doc??gn();const n=kl(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Al=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ze(Xt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Fs(l)),i.integrate(t,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Ze(Xt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ga(new Uint8Array(f))),i.integrate(t,0);break;case To:i=new Ze(Xt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Va(f)),i.integrate(t,0);break;default:if(f instanceof fn)i=new Ze(Xt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ai(f)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},P_=()=>qi("Length exceeded!"),B_=(t,e,n,r)=>{if(n>e._length)throw P_();if(n===0)return e._searchMarker&&Wa(e._searchMarker,n,r.length),Al(t,e,null,r);const i=n,s=kl(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ji(t,Xt(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Wa(e._searchMarker,i,r.length),Al(t,e,o,r)},wO=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Al(t,e,i,n)},D_=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=kl(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ji(t,Xt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ji(t,Xt(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw P_();e._searchMarker&&Wa(e._searchMarker,i,-s+r)},Rl=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Zf=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new Fs([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Fs([r]);break;case Uint8Array:a=new Ga(r);break;case To:a=new Va(r);break;default:if(r instanceof fn)a=new Ai(r);else throw new Error("Unexpected content type")}new Ze(Xt(o,on(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Xf=(t,e)=>{t.doc??gn();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},$_=t=>{const e={};return t.doc??gn(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},j_=(t,e)=>{t.doc??gn();const n=t._map.get(e);return n!==void 0&&!n.deleted},EO=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&So(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Sl=t=>(t.doc??gn(),$S(t._map.entries(),e=>!e[1].deleted));class xO extends vl{}class Oo extends fn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Oo;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Oo}clone(){const e=new Oo;return e.insert(0,this.toArray().map(n=>n instanceof fn?n.clone():n)),e}get length(){return this.doc??gn(),this._length}_callObserver(e,n){super._callObserver(e,n),Tl(this,e,new xO(this,e))}insert(e,n){this.doc!==null?de(this.doc,r=>{B_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?de(this.doc,n=>{wO(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?de(this.doc,r=>{D_(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return F_(this,e)}toArray(){return M_(this)}slice(e=0,n=this.length){return L_(this,e,n)}toJSON(){return this.map(e=>e instanceof fn?e.toJSON():e)}map(e){return U_(this,e)}forEach(e){Ha(this,e)}[Symbol.iterator](){return bO(this)}_write(e){e.writeTypeRef(YO)}}const vO=t=>new Oo;class kO extends vl{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Io extends fn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Io}clone(){const e=new Io;return this.forEach((n,r)=>{e.set(r,n instanceof fn?n.clone():n)}),e}_callObserver(e,n){Tl(this,e,new kO(this,e,n))}toJSON(){this.doc??gn();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof fn?i.toJSON():i}}),e}get size(){return[...Sl(this)].length}keys(){return Ff(Sl(this),e=>e[0])}values(){return Ff(Sl(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Ff(Sl(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??gn(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?de(this.doc,n=>{Rl(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?de(this.doc,r=>{Zf(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Xf(this,e)}has(e){return j_(this,e)}clear(){this.doc!==null?de(this.doc,e=>{this.forEach(function(n,r,i){Rl(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(VO)}}const TO=t=>new Io,ts=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&ES(t,e);class qf{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&qr(),this.right.content.constructor){case Ve:this.right.deleted||No(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const z_=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Ve:e.right.deleted||No(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Ji(t,Xt(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Ol=(t,e,n,r)=>{const i=new Map,s=r?kl(e,n):null;if(s){const o=new qf(s.p.left,s.p,s.index,i);return z_(t,o,n-s.index)}else{const o=new qf(null,e._start,0,i);return z_(t,o,n)}},K_=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ve&&ts(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ze(Xt(s,on(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Ve(a,o));u.integrate(t,0),n.right=u,n.forward()})},No=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},W_=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ve&&ts(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},H_=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!ts(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Ze(Xt(s,on(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Ve(a,c)),n.right.integrate(t,0),n.forward()}}return o},Jf=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;W_(n,i);const a=H_(t,e,n,i),c=r.constructor===String?new ei(r):r instanceof fn?new Ai(r):new Us(r);let{left:l,right:u,index:f}=n;e._searchMarker&&Wa(e._searchMarker,n.index,c.getLength()),u=new Ze(Xt(o,on(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=f,n.forward(),K_(t,e,n,a)},G_=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;W_(n,i);const a=H_(t,e,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ve));){if(!n.right.deleted)switch(n.right.content.constructor){case Ve:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(ts(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Ji(t,Xt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ze(Xt(o,on(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new ei(c)),n.right.integrate(t,0),n.forward()}K_(t,e,n,a)},Y_=(t,e,n,r,i)=>{let s=e;const o=Ir();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ve){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Ve:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(e.delete(t),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&No(i,l);break}}}e=e.right}return a},AO=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ve){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},RO=t=>{let e=0;return de(t.doc,n=>{let r=t._start,i=t._start,s=Ir();const o=yf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ve:No(o,i.content);break;default:e+=Y_(n,r,i,s,o),s=yf(o),r=i;break}i=i.right}}),e},SO=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&T_(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ve&&o.constructor!==fr&&e.add(o.parent)})}de(n,r=>{l_(t,t.deleteSet,i=>{if(i instanceof fr||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Ve?e.add(s):AO(r,i)});for(const i of e)RO(i)})},V_=(t,e,n)=>{const r=n,i=yf(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ai:case Us:case ei:n<e.right.length&&Ji(t,Xt(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Y_(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Wa(o._searchMarker,e.index,-r+n),e};class OO extends vl{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];de(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},yS(c)||(h.attributes=mS({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case Ai:case Us:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ei:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Ve:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;ts(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),ts(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;ts(m,p)||(a==="retain"&&d(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(ts(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&d(),No(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ti extends fn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??gn(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ti}clone(){const e=new Ti;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new OO(this,e,n);Tl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??gn();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ei&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?de(this.doc,r=>{const i=new qf(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Jf(r,this,i,a,o.attributes||{})}else o.retain!==void 0?G_(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&V_(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??gn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(So(c,e)||n!==void 0&&So(c,n))switch(c.content.constructor){case ei:{const f=s.get("ychange");e!==void 0&&!So(c,e)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!So(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Ai:case Us:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Ve:So(c,e)&&(l(),No(s,c.content));break}c=c.right}l()};return e||n?de(o,f=>{e&&jf(f,e),n&&jf(f,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?de(i,s=>{const o=Ol(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Jf(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?de(i,s=>{const o=Ol(s,this,e,!r);Jf(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?de(r,i=>{V_(i,Ol(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?de(i,s=>{const o=Ol(s,this,e,!1);o.right!==null&&G_(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?de(this.doc,n=>{Rl(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?de(this.doc,r=>{Zf(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Xf(this,e)}getAttributes(){return $_(this)}_write(e){e.writeTypeRef(ZO)}}const IO=t=>new Ti;class Qf{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??gn()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Co||n.constructor===Ms)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Ms extends fn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ms}clone(){const e=new Ms;return e.insert(0,this.toArray().map(n=>n instanceof fn?n.clone():n)),e}get length(){return this.doc??gn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Qf(this,e)}querySelector(e){e=e.toUpperCase();const r=new Qf(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Is(new Qf(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Tl(this,e,new LO(this,n,e))}toString(){return U_(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ha(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?de(this.doc,r=>{B_(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)de(this.doc,r=>{const i=e&&e instanceof fn?e._item:e;Al(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw qi("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?de(this.doc,r=>{D_(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return M_(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return F_(this,e)}slice(e=0,n=this.length){return L_(this,e,n)}forEach(e){Ha(this,e)}_write(e){e.writeTypeRef(qO)}}const NO=t=>new Ms;class Co extends Ms{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Co(this.nodeName)}clone(){const e=new Co(this.nodeName),n=this.getAttributes();return _S(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof fn?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?de(this.doc,n=>{Rl(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?de(this.doc,r=>{Zf(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Xf(this,e)}hasAttribute(e){return j_(this,e)}getAttributes(e){return e?EO(this,e):$_(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ha(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(XO),e.writeKey(this.nodeName)}}const CO=t=>new Co(t.readKey());class LO extends vl{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Il extends Io{constructor(e){super(),this.hookName=e}_copy(){return new Il(this.hookName)}clone(){const e=new Il(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(JO),e.writeKey(this.hookName)}}const MO=t=>new Il(t.readKey());class Nl extends Ti{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Nl}clone(){const e=new Nl;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(QO)}}const UO=t=>new Nl;class td{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Xr()}mergeWith(e){return!1}write(e,n,r){throw Xr()}integrate(e,n){throw Xr()}}const FO=0;class fr extends td{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),v_(e.doc.store,this)}write(e,n){e.writeInfo(FO),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Ga{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ga(this.content)}splice(e){throw Xr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const PO=t=>new Ga(t.readBuf());class Ya{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ya(this.len)}splice(e){const n=new Ya(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){bl(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const BO=t=>new Ya(t.readLen()),Z_=(t,e)=>new To({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Va{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Va(Z_(this.doc.guid,this.opts))}splice(e){throw Xr()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const DO=t=>new Va(Z_(t.readString(),t.readAny()));class Us{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Us(this.embed)}splice(e){throw Xr()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const $O=t=>new Us(t.readJSON());class Ve{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ve(this.key,this.value)}splice(e){throw Xr()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const jO=t=>new Ve(t.readKey(),t.readJSON());class Cl{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Cl(this.arr)}splice(e){const n=new Cl(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const zO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Cl(n)},KO=yl("node_env")==="development";class Fs{constructor(e){this.arr=e,KO&&t_(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Fs(this.arr)}splice(e){const n=new Fs(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const WO=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Fs(n)};class ei{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ei(this.str)}splice(e){const n=new ei(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const HO=t=>new ei(t.readString()),GO=[vO,TO,IO,CO,NO,MO,UO],YO=0,VO=1,ZO=2,XO=3,qO=4,JO=5,QO=6;class Ai{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ai(this.type._copy())}splice(e){throw Xr()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const tI=t=>new Ai(GO[t.readTypeRef()](t)),Ll=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Ze(Xt(r,i+n),e,Xt(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Xt(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Ze extends td{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Pg:0}set marker(e){(this.info&Ef)>0!==e&&(this.info^=Ef)}get marker(){return(this.info&Ef)>0}get keep(){return(this.info&Fg)>0}set keep(e){this.keep!==e&&(this.info^=Fg)}get countable(){return(this.info&Pg)>0}get deleted(){return(this.info&wf)>0}set deleted(e){this.deleted!==e&&(this.info^=wf)}markDeleted(){this.info|=wf}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=on(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=on(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ro&&this.id.client!==this.parent.client&&this.parent.clock>=on(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=k_(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ji(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===fr||this.right&&this.right.constructor===fr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ro){const r=Kf(n,this.parent);r.constructor===fr?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=k_(e,e.doc.store,Xt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),wl(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(wl(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Kf(e.doc.store,i.origin)))s.has(Kf(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),v_(e.doc.store,this),this.content.integrate(e,this),R_(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new fr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Xt(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&wl(e.origin,this.lastId)&&this.right===e&&wl(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),bl(e.deleteSet,this.id.client,this.id.clock,this.length),R_(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw qr();this.content.gc(e),n?sO(e,this,new fr(this.id,this.length)):this.content=new Ya(this.length)}write(e,n){const r=n>0?Xt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&hl|(r===null?0:qn)|(i===null?0:xi)|(s===null?0:Ua);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=iO(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Ro?(e.writeParentInfo(!1),e.writeLeftID(a)):qr();s!==null&&e.writeString(s)}this.content.write(e,n)}}const X_=(t,e)=>eI[e&hl](t),eI=[()=>{qr()},BO,zO,PO,HO,$O,jO,tI,WO,DO,()=>{qr()}],nI=10;class dr extends td{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){qr()}write(e,n){e.writeInfo(nI),ne(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const q_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof _o<"u"?_o:{},J_="__ $YJS$ __";q_[J_]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),q_[J_]=!0;let Q_=!1;const tr=new To;function ty(t,e,n){const r=tr.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function rI(t,e){ty(t,0,e)}function ed(t,e){const n=new Ti(e);ty(t,1,n)}function iI(t,e){tr.getMap().set(t,e)}function sI(t,e){const n=tr.getMap(),r=new Ti(e);n.set(t,r)}function ey(t,e){const n=tr.getMap();function r(i){const s=n.get(t);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function oI(t,e){return ey(t,n=>{Rt(n)&&e(n)})}function ny(t,e){return ey(t,n=>{n instanceof Ti&&e(n.toJSON())})}const Ps=io("modem",["second"],t=>{if(Ps.session(t))switch(t.target){case"second":!Q_&&t.data%2===0&&Ps.emit(t.player,"modem:join");break;case"join":t.sender!==Ps.id()&&Ps.reply(t,"joinack",Ig(eO(tr)));break;case"joinack":t.sender!==Ps.id()&&(Q_=!0,g_(tr,cl(t.data),tr));break;case"sync":{t.sender!==Ps.id()&&x(t.data)&&g_(tr,cl(t.data),tr);break}}});function ry(t,e){e!==tr&&Ps.emit("","modem:sync",Ig(t))}tr.on("update",ry),tr.on("destroy",()=>{tr.off("update",ry)});function aI(t,e){return t%e}function cI(t,e){return Math.floor(t/e)}function lI(t,e){return{x:aI(t,e),y:cI(t,e)}}function Lo(t,e){return t.x+t.y*e}function Mo(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function iy(t,e,n,r){const i=[],s=Math.min(t,n),o=Math.max(t,n),a=Math.min(e,r),c=Math.max(e,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function sy(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const oy="176",uI="",Nr="srgb",ay="srgb-linear",cy="linear",nd="srgb";function Cr(t,e,n){return Math.max(e,Math.min(n,t))}function hI(t,e){return(t%e+e)%e}function rd(t,e,n){return(1-n)*t+n*e}class Za{constructor(e=0,n=0){Za.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Cr(this.x,e.x,n.x),this.y=Cr(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Cr(this.x,e,n),this.y=Cr(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Cr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Cr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xa{constructor(e,n,r,i,s,o,a,c,l){Xa.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],p=r[8],m=i[0],b=i[3],y=i[6],k=i[1],A=i[4],T=i[7],C=i[2],R=i[5],S=i[8];return s[0]=o*m+a*k+c*C,s[3]=o*b+a*A+c*R,s[6]=o*y+a*T+c*S,s[1]=l*m+u*k+f*C,s[4]=l*b+u*A+f*R,s[7]=l*y+u*T+f*S,s[2]=d*m+h*k+p*C,s[5]=d*b+h*A+p*R,s[8]=d*y+h*T+p*S,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,p=n*f+r*d+i*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=f*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=h*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(id.makeScale(e,n)),this}rotate(e){return this.premultiply(id.makeRotation(-e)),this}translate(e,n){return this.premultiply(id.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const id=new Xa,ly=new Xa().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),uy=new Xa().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function fI(){const t={enabled:!0,workingColorSpace:ay,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===nd&&(i.r=Uo(i.r),i.g=Uo(i.g),i.b=Uo(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===nd&&(i.r=Fo(i.r),i.g=Fo(i.g),i.b=Fo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===uI?cy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[ay]:{primaries:e,whitePoint:r,transfer:cy,toXYZ:ly,fromXYZ:uy,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Nr},outputColorSpaceConfig:{drawingBufferColorSpace:Nr}},[Nr]:{primaries:e,whitePoint:r,transfer:nd,toXYZ:ly,fromXYZ:uy,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Nr}}}),t}const Lr=fI();function Uo(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Fo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const hy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},es={h:0,s:0,l:0},Ml={h:0,s:0,l:0};function sd(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class od{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Nr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Lr.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Lr.workingColorSpace){return this.r=e,this.g=n,this.b=r,Lr.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Lr.workingColorSpace){if(e=hI(e,1),n=Cr(n,0,1),r=Cr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=sd(o,s,e+1/3),this.g=sd(o,s,e),this.b=sd(o,s,e-1/3)}return Lr.toWorkingColorSpace(this,i),this}setStyle(e,n=Nr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Nr){const r=hy[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Uo(e.r),this.g=Uo(e.g),this.b=Uo(e.b),this}copyLinearToSRGB(e){return this.r=Fo(e.r),this.g=Fo(e.g),this.b=Fo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Nr){return Lr.fromWorkingColorSpace(_n.copy(this),e),Math.round(Cr(_n.r*255,0,255))*65536+Math.round(Cr(_n.g*255,0,255))*256+Math.round(Cr(_n.b*255,0,255))}getHexString(e=Nr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Lr.workingColorSpace){Lr.fromWorkingColorSpace(_n.copy(this),n);const r=_n.r,i=_n.g,s=_n.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Lr.workingColorSpace){return Lr.fromWorkingColorSpace(_n.copy(this),n),e.r=_n.r,e.g=_n.g,e.b=_n.b,e}getStyle(e=Nr){Lr.fromWorkingColorSpace(_n.copy(this),e);const n=_n.r,r=_n.g,i=_n.b;return e!==Nr?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(es),this.setHSL(es.h+e,es.s+n,es.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(es),e.getHSL(Ml);const r=rd(es.h,Ml.h,n),i=rd(es.s,Ml.s,n),s=rd(es.l,Ml.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _n=new od;od.NAMES=hy,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:oy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=oy),new Za,new Za;function Xe(t,e,n){return Math.max(e,Math.min(n,t))}function fy(t){return t/180*Math.PI}function ad(t){return t*180/Math.PI}const dI=kp("089fad0j9awfem09wavefc09uwaef");function pI(){return dI()}function mI(t){return kp(t)()}function pr(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(pI()*i)}function dy(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(mI(t)*s)}function py(t,e,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function gI(t){return t[pr(0,t.length-1)]}function _I(t,e){return e[dy(t,0,e.length-1)]}function Te(...t){return gI(t.flat())}function my(t,...e){return _I(t,e.flat())}function yI(t){return[...new Set(t)].filter(x)}function Po(t){return x(t)&&x(t.x)&&x(t.y)}function Ke(t,e){switch(e){case pt.NORTH:--t.y;break;case pt.SOUTH:++t.y;break;case pt.WEST:--t.x;break;case pt.EAST:++t.x;break}return t}function bI(t,e){return t<0?pt.WEST:t>0?pt.EAST:e<0?pt.NORTH:e>0?pt.SOUTH:pt.IDLE}function Ri(t,e){return bI(e.x-t.x,e.y-t.y)}const cd={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Si(t){return se(t)&&gy(t[0])}function gy(t){return x(pt[t])&&wt(t)}function wI(t){const e=pt[t];return x(e)?e:pt.IDLE}function ld(t){if(wt(t))return cd[It(t)]}function EI(t){if(Si(t))return t;if(gy(t))return[t];const e=ld(t);if(x(e))return[e]}function _y(t){const e=w.words[t],n=EI(e);return Si(n)?[n,t+1]:[void 0,t]}function yy(t){var i,s;const e=[];let[n,r]=_y(t);for(;Si(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(w.words,r,[$.NUMBER,$.NUMBER]);e.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(w.words,r,[$.DIR]);e.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=rt(w.words,r,[$.DIR,$.DIR]),f=((i=w.element)==null?void 0:i.x)??0,d=((s=w.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,e.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[e,r]}const[o,a]=_y(r);n=o,r=a}return e.length?[e,r]:[void 0,t]}function xI(t){return x(t)&&t<St.ONBLACK?t:void 0}function vI(t){return x(t)&&t>St.WHITE&&t<St.ONCLEAR?t-St.ONBLACK:void 0}const qa={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function ni(t){return se(t)&&wy(t[0])}function by(t){return ni(t)&&t[0].startsWith("ON")}function wy(t){return x(St[t])&&wt(t)}function ud(t){if(wt(t))return qa[It(t)]}function kI(t){return t.map(e=>St[e]).find(e=>x(e)&&e<St.ONBLACK)}function TI(t){return t.map(e=>St[e]).find(e=>x(e)&&e>=St.ONBLACK)}function AI(t){if(ni(t))return t;if(wy(t))return[t];const e=ud(t);if(x(e))return[e]}function Ey(t){const e=w.words[t],n=AI(e);return ni(n)?[n,t+1]:[void 0,t]}function hd(t){const e=[];let n=t;const[r,i]=Ey(t);if(ni(r)&&(e.push(...r),n=i),ni(e)&&!by(e)){const[s,o]=Ey(i);by(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function xy(t){const e={};return t.every(n=>{const r=St[n];x(r)&&(r<St.ONBLACK?e.color=r:e.bg=r-St.ONBLACK)}),e}function Bo(t){return se(t)&&typeof t[0]=="string"}function RI(t){const e=w.words[t];return wt(e)?[e,t+1]:[void 0,t]}function vy(t){const e=w.words[t];if(Bo(e))return[e,t+1];const[n,r]=hd(t),[i,s]=RI(r);return wt(i)?[[i,n],s]:[void 0,t]}function fd(t){if(!Bo(t))return;const[e]=t;return e}function ky(t){if(!Bo(t))return;const[,e]=t,n=x(e)?kI(e):void 0;return x(n)?n:void 0}function Ty(t){if(!Bo(t))return;const[,e]=t,n=x(e)?TI(e):void 0;return x(n)?n:void 0}var dd;try{dd=new TextDecoder}catch{}var gt,mr,K=0,pe={},qt,ns,gr=0,ri=0,an,Oi,Mn=[],Yt,Ay={useRecords:!1,mapsAsObjects:!0};class Ry{}const Sy=new Ry;Sy.name="MessagePack 0xC1";var rs=!1,Oy=2,Iy;try{new Function("")}catch{Oy=1/0}class Ja{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(gt)return Ky(()=>(yd(),this?this.unpack(e,n):Ja.prototype.unpack.call(Ay,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof hn<"u"?hn.from(e):new Uint8Array(e)),typeof n=="object"?(mr=n.end||e.length,K=n.start||0):(K=0,mr=n>-1?n:e.length),ri=0,ns=null,an=null,gt=e;try{Yt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw gt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Ja){if(pe=this,this.structures)return qt=this.structures,Ul(n);(!qt||qt.length>0)&&(qt=[])}else pe=Ay,(!qt||qt.length>0)&&(qt=[]);return Ul(n)}unpackMultiple(e,n){let r,i=0;try{rs=!0;let s=e.length,o=this?this.unpack(e,s):Fl.unpack(e,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Ul(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Ul());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{rs=!1,yd()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Ul(t){try{if(!pe.trusted&&!rs){let n=qt.sharedLength||0;n<qt.length&&(qt.length=n)}let e;if(pe.randomAccessStructure&&gt[K]<64&&gt[K]>=32&&Iy?(e=Iy(gt,K,mr,pe),gt=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),K=mr):e=$e(),an&&(K=an.postBundlePosition,an=null),rs&&(qt.restoreStructures=null),K==mr)qt&&qt.restoreStructures&&Ny(),qt=null,gt=null,Oi&&(Oi=null);else{if(K>mr)throw new Error("Unexpected end of MessagePack data");if(!rs){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw qt&&qt.restoreStructures&&Ny(),yd(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||K>mr)&&(e.incomplete=!0),e}}function Ny(){for(let t in qt.restoreStructures)qt[t]=qt.restoreStructures[t];qt.restoreStructures=null}function $e(){let t=gt[K++];if(t<160)if(t<128){if(t<64)return t;{let e=qt[t&63]||pe.getStructures&&Ly()[t&63];return e?(e.read||(e.read=pd(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,pe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Dy();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return pe.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(ri>=K)return ns.slice(K-gr,(K+=e)-gr);if(ri==0&&mr<140){let n=e<16?gd(e):Fy(e);if(n!=null)return n}return md(e)}else{let e;switch(t){case 192:return null;case 193:return an?(e=$e(),e>0?an[1].slice(an.position1,an.position1+=e):an[0].slice(an.position0,an.position0-=e)):Sy;case 194:return!1;case 195:return!0;case 196:if(e=gt[K++],e===void 0)throw new Error("Unexpected end of buffer");return _d(e);case 197:return e=Yt.getUint16(K),K+=2,_d(e);case 198:return e=Yt.getUint32(K),K+=4,_d(e);case 199:return Bs(gt[K++]);case 200:return e=Yt.getUint16(K),K+=2,Bs(e);case 201:return e=Yt.getUint32(K),K+=4,Bs(e);case 202:if(e=Yt.getFloat32(K),pe.useFloat32>2){let n=bd[(gt[K]&127)<<1|gt[K+1]>>7];return K+=4,(n*e+(e>0?.5:-.5)>>0)/n}return K+=4,e;case 203:return e=Yt.getFloat64(K),K+=8,e;case 204:return gt[K++];case 205:return e=Yt.getUint16(K),K+=2,e;case 206:return e=Yt.getUint32(K),K+=4,e;case 207:return pe.int64AsType==="number"?(e=Yt.getUint32(K)*4294967296,e+=Yt.getUint32(K+4)):pe.int64AsType==="string"?e=Yt.getBigUint64(K).toString():pe.int64AsType==="auto"?(e=Yt.getBigUint64(K),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Yt.getBigUint64(K),K+=8,e;case 208:return Yt.getInt8(K++);case 209:return e=Yt.getInt16(K),K+=2,e;case 210:return e=Yt.getInt32(K),K+=4,e;case 211:return pe.int64AsType==="number"?(e=Yt.getInt32(K)*4294967296,e+=Yt.getUint32(K+4)):pe.int64AsType==="string"?e=Yt.getBigInt64(K).toString():pe.int64AsType==="auto"?(e=Yt.getBigInt64(K),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Yt.getBigInt64(K),K+=8,e;case 212:if(e=gt[K++],e==114)return jy(gt[K++]&63);{let n=Mn[e];if(n)return n.read?(K++,n.read($e())):n.noBuffer?(K++,n()):n(gt.subarray(K,++K));throw new Error("Unknown extension "+e)}case 213:return e=gt[K],e==114?(K++,jy(gt[K++]&63,gt[K++])):Bs(2);case 214:return Bs(4);case 215:return Bs(8);case 216:return Bs(16);case 217:return e=gt[K++],ri>=K?ns.slice(K-gr,(K+=e)-gr):OI(e);case 218:return e=Yt.getUint16(K),K+=2,ri>=K?ns.slice(K-gr,(K+=e)-gr):II(e);case 219:return e=Yt.getUint32(K),K+=4,ri>=K?ns.slice(K-gr,(K+=e)-gr):NI(e);case 220:return e=Yt.getUint16(K),K+=2,My(e);case 221:return e=Yt.getUint32(K),K+=4,My(e);case 222:return e=Yt.getUint16(K),K+=2,Uy(e);case 223:return e=Yt.getUint32(K),K+=4,Uy(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const SI=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function pd(t,e){function n(){if(n.count++>Oy){let i=t.read=new Function("r","return function(){return "+(pe.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":SI.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")($e);return t.highByte===0&&(t.read=Cy(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=$e()}return pe.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?Cy(e,n):n}const Cy=(t,e)=>function(){let n=gt[K++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=qt[r]||Ly()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=pd(i,t)),i.read()};function Ly(){let t=Ky(()=>(gt=null,pe.getStructures()));return qt=pe._mergeStructures(t,qt)}var md=Qa,OI=Qa,II=Qa,NI=Qa;function Qa(t){let e;if(t<16&&(e=gd(t)))return e;if(t>64&&dd)return dd.decode(gt.subarray(K,K+=t));const n=K+t,r=[];for(e="";K<n;){const i=gt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gt[K++]&63,o=gt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=gt[K++]&63,o=gt[K++]&63,a=gt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=cn.apply(String,r),r.length=0)}return r.length>0&&(e+=cn.apply(String,r)),e}function My(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=$e();return pe.freezeData?Object.freeze(e):e}function Uy(t){if(pe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Dy();r==="__proto__"&&(r="__proto_"),e[r]=$e()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set($e(),$e());return e}}var cn=String.fromCharCode;function Fy(t){let e=K,n=new Array(t);for(let r=0;r<t;r++){const i=gt[K++];if((i&128)>0){K=e;return}n[r]=i}return cn.apply(String,n)}function gd(t){if(t<4)if(t<2){if(t===0)return"";{let e=gt[K++];if((e&128)>1){K-=1;return}return cn(e)}}else{let e=gt[K++],n=gt[K++];if((e&128)>0||(n&128)>0){K-=2;return}if(t<3)return cn(e,n);let r=gt[K++];if((r&128)>0){K-=3;return}return cn(e,n,r)}else{let e=gt[K++],n=gt[K++],r=gt[K++],i=gt[K++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(t<6){if(t===4)return cn(e,n,r,i);{let s=gt[K++];if((s&128)>0){K-=5;return}return cn(e,n,r,i,s)}}else if(t<8){let s=gt[K++],o=gt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(t<7)return cn(e,n,r,i,s,o);let a=gt[K++];if((a&128)>0){K-=7;return}return cn(e,n,r,i,s,o,a)}else{let s=gt[K++],o=gt[K++],a=gt[K++],c=gt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(t<10){if(t===8)return cn(e,n,r,i,s,o,a,c);{let l=gt[K++];if((l&128)>0){K-=9;return}return cn(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=gt[K++],u=gt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(t<11)return cn(e,n,r,i,s,o,a,c,l,u);let f=gt[K++];if((f&128)>0){K-=11;return}return cn(e,n,r,i,s,o,a,c,l,u,f)}else{let l=gt[K++],u=gt[K++],f=gt[K++],d=gt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(t<14){if(t===12)return cn(e,n,r,i,s,o,a,c,l,u,f,d);{let h=gt[K++];if((h&128)>0){K-=13;return}return cn(e,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=gt[K++],p=gt[K++];if((h&128)>0||(p&128)>0){K-=14;return}if(t<15)return cn(e,n,r,i,s,o,a,c,l,u,f,d,h,p);let m=gt[K++];if((m&128)>0){K-=15;return}return cn(e,n,r,i,s,o,a,c,l,u,f,d,h,p,m)}}}}}function Py(){let t=gt[K++],e;if(t<192)e=t-160;else switch(t){case 217:e=gt[K++];break;case 218:e=Yt.getUint16(K),K+=2;break;case 219:e=Yt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return Qa(e)}function _d(t){return pe.copyBuffers?Uint8Array.prototype.slice.call(gt,K,K+=t):gt.subarray(K,K+=t)}function Bs(t){let e=gt[K++];if(Mn[e]){let n;return Mn[e](gt.subarray(K,n=K+=t),r=>{K=r;try{return $e()}finally{K=n}})}else throw new Error("Unknown extension type "+e)}var By=new Array(4096);function Dy(){let t=gt[K++];if(t>=160&&t<192){if(t=t-160,ri>=K)return ns.slice(K-gr,(K+=t)-gr);if(!(ri==0&&mr<180))return md(t)}else return K--,$y($e());let e=(t<<5^(t>1?Yt.getUint16(K):t>0?gt[K]:0))&4095,n=By[e],r=K,i=K+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Yt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],By[e]=n,n.bytes=t;r<i;)s=Yt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gt[r++],n.push(s);let a=t<16?gd(t):Fy(t);return a!=null?n.string=a:n.string=md(t)}function $y(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const jy=(t,e)=>{let n=$e().map($y),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=qt[t];return i&&(i.isShared||rs)&&((qt.restoreStructures||(qt.restoreStructures=[]))[t]=i),qt[t]=n,n.read=pd(n,r),n.read()};Mn[0]=()=>{},Mn[0].noBuffer=!0,Mn[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let CI={Error,TypeError,ReferenceError};Mn[101]=()=>{let t=$e();return(CI[t[0]]||Error)(t[1],{cause:t[2]})},Mn[105]=t=>{if(pe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Yt.getUint32(K-4);Oi||(Oi=new Map);let n=gt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Oi.set(e,i);let s=$e();return i.used?Object.assign(r,s):(i.target=s,s)},Mn[112]=t=>{if(pe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Yt.getUint32(K-4),n=Oi.get(e);return n.used=!0,n.target},Mn[115]=()=>new Set($e());const zy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let LI=typeof globalThis=="object"?globalThis:window;Mn[116]=t=>{let e=t[0],n=zy[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new LI[n](Uint8Array.prototype.slice.call(t,1).buffer)},Mn[120]=()=>{let t=$e();return new RegExp(t[0],t[1])};const MI=[];Mn[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=K;return K+=e-t.length,an=MI,an=[Py(),Py()],an.position0=0,an.position1=0,an.postBundlePosition=K,K=n,$e()},Mn[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function Ky(t){let e=mr,n=K,r=gr,i=ri,s=ns,o=Oi,a=an,c=new Uint8Array(gt.slice(0,mr)),l=qt,u=qt.slice(0,qt.length),f=pe,d=rs,h=t();return mr=e,K=n,gr=r,ri=i,ns=s,Oi=o,an=a,gt=c,rs=d,qt=l,qt.splice(0,qt.length,...u),pe=f,Yt=new DataView(gt.buffer,gt.byteOffset,gt.byteLength),h}function yd(){gt=null,Oi=null,qt=null}const bd=new Array(147);for(let t=0;t<256;t++)bd[t]=+("1e"+Math.floor(45.15-t*.30103));var Fl=new Ja({useRecords:!1});const UI=Fl.unpack;Fl.unpackMultiple,Fl.unpack;let FI=new Float32Array(1);new Uint8Array(FI.buffer,0,4);let Pl;try{Pl=new TextEncoder}catch{}let wd,Wy;const Bl=typeof hn<"u",Dl=Bl?function(t){return hn.allocUnsafeSlow(t)}:Uint8Array,Hy=Bl?hn:Uint8Array,Gy=Bl?4294967296:2144337920;let X,tc,me,H=0,kn,Ne=null,PI;const BI=21760,DI=/[\u0080-\uFFFF]/,Do=Symbol("record-id");class $I extends Ja{constructor(e){super(e),this.offset=0;let n,r,i,s,o=Hy.prototype.utf8Write?function(I,E){return X.utf8Write(I,E,X.byteLength-E)}:Pl&&Pl.encodeInto?function(I,E){return Pl.encodeInto(I,X.subarray(E)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let f=e.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,p=u+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,y=0;this.pack=this.encode=function(I,E){if(X||(X=new Dl(8192),me=X.dataView||(X.dataView=new DataView(X.buffer,0,8192)),H=0),kn=X.length-10,kn-H<2048?(X=new Dl(X.length),me=X.dataView||(X.dataView=new DataView(X.buffer,0,X.length)),kn=X.length-10,H=0):H=H+7&2147483640,n=H,E&YI&&(H+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof I!="string"?(Ne=[],Ne.size=1/0):Ne=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let J=i.sharedLength||0;if(J>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let j=0;j<J;j++){let st=i[j];if(!st)continue;let tt,ft=i.transitions;for(let V=0,W=st.length;V<W;V++){let Et=st[V];tt=ft[Et],tt||(tt=ft[Et]=Object.create(null)),ft=tt}ft[Do]=j+64}this.lastNamedStructuresLength=J}c||(i.nextId=J+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&I&&I.constructor&&I.constructor===Object?L(I):T(I);let J=Ne;if(Ne&&Zy(n,T,0),s&&s.idsToInsert){let j=s.idsToInsert.sort((V,W)=>V.offset>W.offset?1:-1),st=j.length,tt=-1;for(;J&&st>0;){let V=j[--st].offset+n;V<J.stringsPosition+n&&tt===-1&&(tt=0),V>J.position+n?tt>=0&&(tt+=6):(tt>=0&&(me.setUint32(J.position+n,me.getUint32(J.position+n)+tt),tt=-1),J=J.previous,st++)}tt>=0&&J&&me.setUint32(J.position+n,me.getUint32(J.position+n)+tt),H+=j.length*6,H>kn&&N(H),a.offset=H;let ft=zI(X.subarray(n,H),j);return s=null,ft}return a.offset=H,E&HI?(X.start=n,X.end=H,X):X.subarray(n,H)}catch(J){throw B=J,J}finally{if(i&&(k(),r&&a.saveStructures)){let J=i.sharedLength||0,j=X.subarray(n,H),st=KI(i,a);if(!B)return a.saveStructures(st,st.isCompatible)===!1?a.pack(I,E):(a.lastNamedStructuresLength=J,X.length>1073741824&&(X=null),j)}X.length>1073741824&&(X=null),E&GI&&(H=n)}};const k=()=>{y<10&&y++;let I=i.sharedLength||0;if(i.length>I&&!c&&(i.length=I),b>1e4)i.transitions=null,y=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,B=m.length;E<B;E++)m[E][Do]=0;m=[]}},A=I=>{var E=I.length;E<16?X[H++]=144|E:E<65536?(X[H++]=220,X[H++]=E>>8,X[H++]=E&255):(X[H++]=221,me.setUint32(H,E),H+=4);for(let B=0;B<E;B++)T(I[B])},T=I=>{H>kn&&(X=N(H));var E=typeof I,B;if(E==="string"){let J=I.length;if(Ne&&J>=4&&J<4096){if((Ne.size+=J)>BI){let ft,V=(Ne[0]?Ne[0].length*3+Ne[1].length:0)+10;H+V>kn&&(X=N(H+V));let W;Ne.position?(W=Ne,X[H]=200,H+=3,X[H++]=98,ft=H-n,H+=4,Zy(n,T,0),me.setUint16(ft+n-3,H-n-ft)):(X[H++]=214,X[H++]=98,ft=H-n,H+=4),Ne=["",""],Ne.previous=W,Ne.size=0,Ne.position=ft}let tt=DI.test(I);Ne[tt?0:1]+=I,X[H++]=193,T(tt?-J:J);return}let j;J<32?j=1:J<256?j=2:J<65536?j=3:j=5;let st=J*3;if(H+st>kn&&(X=N(H+st)),J<64||!o){let tt,ft,V,W=H+j;for(tt=0;tt<J;tt++)ft=I.charCodeAt(tt),ft<128?X[W++]=ft:ft<2048?(X[W++]=ft>>6|192,X[W++]=ft&63|128):(ft&64512)===55296&&((V=I.charCodeAt(tt+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(V&1023),tt++,X[W++]=ft>>18|240,X[W++]=ft>>12&63|128,X[W++]=ft>>6&63|128,X[W++]=ft&63|128):(X[W++]=ft>>12|224,X[W++]=ft>>6&63|128,X[W++]=ft&63|128);B=W-H-j}else B=o(I,H+j);B<32?X[H++]=160|B:B<256?(j<2&&X.copyWithin(H+2,H+1,H+1+B),X[H++]=217,X[H++]=B):B<65536?(j<3&&X.copyWithin(H+3,H+2,H+2+B),X[H++]=218,X[H++]=B>>8,X[H++]=B&255):(j<5&&X.copyWithin(H+5,H+3,H+3+B),X[H++]=219,me.setUint32(H,B),H+=4),H+=B}else if(E==="number")if(I>>>0===I)I<32||I<128&&this.useRecords===!1||I<64&&!this.randomAccessStructure?X[H++]=I:I<256?(X[H++]=204,X[H++]=I):I<65536?(X[H++]=205,X[H++]=I>>8,X[H++]=I&255):(X[H++]=206,me.setUint32(H,I),H+=4);else if(I>>0===I)I>=-32?X[H++]=256+I:I>=-128?(X[H++]=208,X[H++]=I+256):I>=-32768?(X[H++]=209,me.setInt16(H,I),H+=2):(X[H++]=210,me.setInt32(H,I),H+=4);else{let J;if((J=this.useFloat32)>0&&I<4294967296&&I>=-2147483648){X[H++]=202,me.setFloat32(H,I);let j;if(J<4||(j=I*bd[(X[H]&127)<<1|X[H+1]>>7])>>0===j){H+=4;return}else H--}X[H++]=203,me.setFloat64(H,I),H+=8}else if(E==="object"||E==="function")if(!I)X[H++]=192;else{if(s){let j=s.get(I);if(j){if(!j.id){let st=s.idsToInsert||(s.idsToInsert=[]);j.id=st.push(j)}X[H++]=214,X[H++]=112,me.setUint32(H,j.id),H+=4;return}else s.set(I,{offset:H-n})}let J=I.constructor;if(J===Object)U(I);else if(J===Array)A(I);else if(J===Map)if(this.mapAsEmptyObject)X[H++]=128;else{B=I.size,B<16?X[H++]=128|B:B<65536?(X[H++]=222,X[H++]=B>>8,X[H++]=B&255):(X[H++]=223,me.setUint32(H,B),H+=4);for(let[j,st]of I)T(j),T(st)}else{for(let j=0,st=wd.length;j<st;j++){let tt=Wy[j];if(I instanceof tt){let ft=wd[j];if(ft.write){ft.type&&(X[H++]=212,X[H++]=ft.type,X[H++]=0);let lt=ft.write.call(this,I);lt===I?Array.isArray(I)?A(I):U(I):T(lt);return}let V=X,W=me,Et=H;X=null;let at;try{at=ft.pack.call(this,I,lt=>(X=V,V=null,H+=lt,H>kn&&N(H),{target:X,targetView:me,position:H-lt}),T)}finally{V&&(X=V,me=W,H=Et,kn=X.length-10)}at&&(at.length+H>kn&&N(at.length+H),H=jI(at,X,H,ft.type));return}}if(Array.isArray(I))A(I);else{if(I.toJSON){const j=I.toJSON();if(j!==I)return T(j)}if(E==="function")return T(this.writeFunction&&this.writeFunction(I));U(I)}}}else if(E==="boolean")X[H++]=I?195:194;else if(E==="bigint"){if(I<BigInt(1)<<BigInt(63)&&I>=-(BigInt(1)<<BigInt(63)))X[H++]=211,me.setBigInt64(H,I);else if(I<BigInt(1)<<BigInt(64)&&I>0)X[H++]=207,me.setBigUint64(H,I);else if(this.largeBigIntToFloat)X[H++]=203,me.setFloat64(H,Number(I));else{if(this.largeBigIntToString)return T(I.toString());if(this.useBigIntExtension&&I<BigInt(2)**BigInt(1023)&&I>-(BigInt(2)**BigInt(1023))){X[H++]=199,H++,X[H++]=66;let J=[],j;do{let st=I&BigInt(255);j=(st&BigInt(128))===(I<BigInt(0)?BigInt(128):BigInt(0)),J.push(st),I>>=BigInt(8)}while(!((I===BigInt(0)||I===BigInt(-1))&&j));X[H-2]=J.length;for(let st=J.length;st>0;)X[H++]=Number(J[--st]);return}else throw new RangeError(I+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}H+=8}else if(E==="undefined")this.encodeUndefinedAsNil?X[H++]=192:(X[H++]=212,X[H++]=0,X[H++]=0);else throw new Error("Unknown type: "+E)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?I=>{let E;if(this.skipValues){E=[];for(let j in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(j))&&!this.skipValues.includes(I[j])&&E.push(j)}else E=Object.keys(I);let B=E.length;B<16?X[H++]=128|B:B<65536?(X[H++]=222,X[H++]=B>>8,X[H++]=B&255):(X[H++]=223,me.setUint32(H,B),H+=4);let J;if(this.coercibleKeyAsNumber)for(let j=0;j<B;j++){J=E[j];let st=Number(J);T(isNaN(st)?J:st),T(I[J])}else for(let j=0;j<B;j++)T(J=E[j]),T(I[J])}:I=>{X[H++]=222;let E=H-n;H+=2;let B=0;for(let J in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(J))&&(T(J),T(I[J]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');X[E+++n]=B>>8,X[E+n]=B&255},R=this.useRecords===!1?C:e.progressiveRecords&&!d?I=>{let E,B=i.transitions||(i.transitions=Object.create(null)),J=H++-n,j;for(let st in I)if(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(st)){if(E=B[st],E)B=E;else{let tt=Object.keys(I),ft=B;B=i.transitions;let V=0;for(let W=0,Et=tt.length;W<Et;W++){let at=tt[W];E=B[at],E||(E=B[at]=Object.create(null),V++),B=E}J+n+1==H?(H--,D(B,tt,V)):Y(B,tt,J,V),j=!0,B=ft[st]}T(I[st])}if(!j){let st=B[Do];st?X[J+n]=st:Y(B,Object.keys(I),J,0)}}:I=>{let E,B=i.transitions||(i.transitions=Object.create(null)),J=0;for(let st in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(st))&&(E=B[st],E||(E=B[st]=Object.create(null),J++),B=E);let j=B[Do];j?j>=96&&d?(X[H++]=((j-=96)&31)+96,X[H++]=j>>5):X[H++]=j:D(B,B.__keys__||Object.keys(I),J);for(let st in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(st))&&T(I[st])},S=typeof this.useRecords=="function"&&this.useRecords,U=S?I=>{S(I)?R(I):C(I)}:R,N=I=>{let E;if(I>16777216){if(I-n>Gy)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(Gy,Math.round(Math.max((I-n)*(I>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(I-n<<2,X.length-1)>>12)+1<<12;let B=new Dl(E);return me=B.dataView||(B.dataView=new DataView(B.buffer,0,E)),I=Math.min(I,X.length),X.copy?X.copy(B,0,n,I):B.set(X.slice(n,I)),H-=n,n=0,kn=B.length-10,X=B},D=(I,E,B)=>{let J=i.nextId;J||(J=64),J<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(J=i.nextOwnId,J<p||(J=h),i.nextOwnId=J+1):(J>=p&&(J=h),i.nextId=J+1);let j=E.highByte=J>=96&&d?J-96>>5:-1;I[Do]=J,I.__keys__=E,i[J-64]=E,J<h?(E.isShared=!0,i.sharedLength=J-63,r=!0,j>=0?(X[H++]=(J&31)+96,X[H++]=j):X[H++]=J):(j>=0?(X[H++]=213,X[H++]=114,X[H++]=(J&31)+96,X[H++]=j):(X[H++]=212,X[H++]=114,X[H++]=J),B&&(b+=y*B),m.length>=f&&(m.shift()[Do]=0),m.push(I),T(E))},Y=(I,E,B,J)=>{let j=X,st=H,tt=kn,ft=n;X=tc,H=0,n=0,X||(tc=X=new Dl(8192)),kn=X.length-10,D(I,E,J),tc=X;let V=H;if(X=j,H=st,kn=tt,n=ft,V>1){let W=H+V-1;W>kn&&N(W);let Et=B+n;X.copyWithin(Et+V,Et+1,H),X.set(tc.slice(0,V),Et),H=W}else X[B+n]=tc[0]},L=I=>{let E=PI(I,X,n,H,i,N,(B,J,j)=>{if(j)return r=!0;H=J;let st=X;return T(B),k(),st!==X?{position:H,targetView:me,target:X}:H},this);if(E===0)return U(I);H=E}}useBuffer(e){X=e,X.dataView||(X.dataView=new DataView(X.buffer,X.byteOffset,X.byteLength)),H=0}set position(e){H=e}get position(){return H}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Wy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Ry],wd=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?Yy(t,16,e):Vy(Bl?hn.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==Hy&&this.moreTypes?Yy(t,zy.indexOf(n.name),e):Vy(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function Yy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Vy(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function jI(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function zI(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function Zy(t,e,n){if(Ne.length>0){me.setUint32(Ne.position+t,H+n-Ne.position-t),Ne.stringsPosition=H-t;let r=Ne;Ne=null,e(r[0]),e(r[1])}}function KI(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let Xy=new $I({useRecords:!1});const WI=Xy.pack;Xy.pack;const HI=512,GI=1024,YI=2048,nt=io("SOFTWARE");function Ae(){return null}function $o(t,e,n={}){if(!x(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];x(c)&&(a=c(a));const l=e[o];x(l)&&(o=l),a!==null&&r.push(o,a)}return r}function ec(t,e,n={}){if(x(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){he(nt,"","binary",r.message)}}function VI(t){try{const e=Yn(t);return WI(e)}catch(e){he(nt,"","binary",e.message)}}function ZI(t){try{return UI(t)}catch(e){he(nt,"","binary",e.message)}}function qy(){return{id:Me()}}var $l=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.destructible=16]="destructible",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t))($l||{});function jl(t){return x(t==null?void 0:t.id)?$o(t,$l,{category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae}):$o(t,$l,{id:Ae,x:Ae,y:Ae,lx:Ae,ly:Ae,code:Ae,category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae})}function zl(t){return ec(t,$l)}function yn(t){var e;return(((e=t==null?void 0:t.id)==null?void 0:e.length)??0)>0}function nc(t,e){if(!x(t)||!ni(e))return;const{color:n,bg:r}=xy(e);x(n)&&(t.color=n),x(r)&&(t.bg=r)}function is(t){var e;return It((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}const Ot=60,Jt=25,Ed=Ot*Jt;var _t=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(_t||{});function XI(){return new Array(Ot*Jt).map(()=>{})}function xd(t=Th){const e={terrain:XI(),objects:{},id:""};return t(e)}var vd=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(vd||{});function qI(t){return $o(t,vd,{terrain:e=>e.map(jl),objects:e=>Object.values(e).filter(n=>!n.removed).map(jl),id:Ae,named:Ae,lookup:Ae,codepage:Ae,distmaps:Ae,overboard:Ae,underboard:Ae})}function JI(t){return ec(t,vd,{terrain:e=>e.map(zl),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=zl(e[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Kl(t){return Mo(t.x,t.y,0,Ot-1,Jt-1,0)}function Mr(t,e){return!x(t)||!x(e==null?void 0:e.x)||!x(e==null?void 0:e.y)||e.x<0||e.x>=Ot||e.y<0||e.y>=Jt?-1:e.x+e.y*Ot}function ge(t,e){const n=Mr(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Tn(t,t.lookup[n]??"");return x(r)?r:t.terrain[n]}function QI(t,e){const n=Tn(t,e);if(x(n))return n;const r=parseFloat(e),i=lI(isNaN(r)?-1:r,Ot);return jo(t,i.x,i.y)}function jo(t,e,n){return(e>=0&&e<Ot)??(n>=0&&n<Jt)?t==null?void 0:t.terrain[e+n*Ot]:void 0}function ln(t,e){if(!x(t)||!x(e)||!x(e.x)||!x(e.y)||e.x<0||e.x>=Ot||e.y<0||e.y>=Jt)return;const n=Yn(e),r=e.x+e.y*Ot;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function kd(t,e){if(!x(t)||!x(e))return;const n=Yn(e);return n.id=n.id??Me(),t.objects[n.id]=n,t.objects[n.id]}function tN(t,e,n){return ln(t,{...e,kind:n})}function Td(t,e,n,r){return kd(t,{...e,kind:n,id:r})}function Tn(t,e){if(t)return t.objects[e]}function eN(t,e){const n=Mr(t,e);if(n<0||!x(t==null?void 0:t.lookup))return;const r=Tn(t,t.lookup[n]??"");if(x(r))return r}function Jy(t,e){return x(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function nN(t,e,n){if(!x(t)||!x(e))return;const r=t.objects[n];if(x(r))return r;if(Po(e))return eb(e,ic(t,"player"))}function zo(t,e){const n=t??Wt.ISWALK,r=e??Wt.ISWALK;switch(n){case Wt.ISWALK:return r!==Wt.ISWALK;case Wt.ISSWIM:return r!==Wt.ISSWIM;case Wt.ISSOLID:return!0;case Wt.ISBULLET:return r!==Wt.ISWALK&&r!==Wt.ISSWIM}}function rc(t,e,n){const r=t==null?void 0:t.objects[n];if(x(r))return r;const i=ic(t,"player");return x(e)?(e.x<0&&(e.x=pr(0,Ot-1)),e.y<0&&(e.y=pr(0,Jt-1)),eb(e,i)):Te(...i)}function ic(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(x)}function rN(t){const e=[];for(let n=0;n<Jt;++n)for(let r=0;r<Ot;++r){const i={x:r,y:n},s=ge(t,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&e.push(i)}return e}function Qy(t,e){const n=fd(e),r=ky(e),i=Ty(e);return ic(t,n??"").filter(s=>{var o,a,c;return!(x(n)&&It((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??St.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??St.BLACK)!==i)}).filter(x)}function tb(t,e){return x(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(x(i))return i;const s=ic(t,It(n));if(s.length)return s}else if(Po(n)&&n.x>=0&&n.x<Ot&&n.y>=0&&n.y<Jt){const i=n.x+n.y*Ot,s=(r=t.lookup)==null?void 0:r[i];return x(s)?t.objects[s]:t.terrain[i]}}).flat().filter(x):[]}function eb(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function nb(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}const Ad=14,sc=3,Wl=8,Hl=14,Gl=16,iN=16,sN=16;var Yl=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(Yl||{});function Vl(t,e){return new Array(t).fill(e)}function oN(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:Vl(s,0),color:Vl(s,0),bg:Vl(s,i)}}function aN(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:St.ONCLEAR}}function cN(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function lN(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:Vl(s,i)}}function uN(t,e,n,r){return{id:`media:${t}:${e}`,type:4,mime:n,media:r}}function hN(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function rb(t,e){return`${t}:${e}`}const fN=1,dN=16,pN=256;var An=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(An||{});function Rd(t){const e=Math.floor(t.length/sc);if(e*sc!==t.length)return;const n=nb(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function mN(t,e){return t&1<<e?255:0}function ib(t){const e=Math.floor(t.length/Ad);if(e*Ad!==t.length)return;const n=Math.ceil(e/Gl),r=Wl*Gl,i=nb(r,Hl*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*Hl+a,u=t[c];for(let f=0;f<Wl;++f){const d=s*Wl+f;i.bits[d+l*r]=mN(u,7-f)}++a,a===Hl&&(a=0,++s,s===Gl&&(s=0,++o))}return i}const gN=cl("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),sb=cl("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ob=typeof _o=="object"&&_o&&_o.Object===Object&&_o,_N=typeof self=="object"&&self&&self.Object===Object&&self,ii=ob||_N||Function("return this")(),_r=ii.Symbol,ab=Object.prototype,yN=ab.hasOwnProperty,bN=ab.toString,oc=_r?_r.toStringTag:void 0;function wN(t){var e=yN.call(t,oc),n=t[oc];try{t[oc]=void 0;var r=!0}catch{}var i=bN.call(t);return r&&(e?t[oc]=n:delete t[oc]),i}var EN=Object.prototype,xN=EN.toString;function vN(t){return xN.call(t)}var kN="[object Null]",TN="[object Undefined]",cb=_r?_r.toStringTag:void 0;function ss(t){return t==null?t===void 0?TN:kN:cb&&cb in Object(t)?wN(t):vN(t)}function Ur(t){return t!=null&&typeof t=="object"}var AN="[object Symbol]";function Zl(t){return typeof t=="symbol"||Ur(t)&&ss(t)==AN}function Xl(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var ee=Array.isArray,RN=1/0,lb=_r?_r.prototype:void 0,ub=lb?lb.toString:void 0;function hb(t){if(typeof t=="string")return t;if(ee(t))return Xl(t,hb)+"";if(Zl(t))return ub?ub.call(t):"";var e=t+"";return e=="0"&&1/t==-RN?"-0":e}var SN=/\s/;function ON(t){for(var e=t.length;e--&&SN.test(t.charAt(e)););return e}var IN=/^\s+/;function NN(t){return t&&t.slice(0,ON(t)+1).replace(IN,"")}function yr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var fb=NaN,CN=/^[-+]0x[0-9a-f]+$/i,LN=/^0b[01]+$/i,MN=/^0o[0-7]+$/i,UN=parseInt;function FN(t){if(typeof t=="number")return t;if(Zl(t))return fb;if(yr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=yr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=NN(t);var n=LN.test(t);return n||MN.test(t)?UN(t.slice(2),n?2:8):CN.test(t)?fb:+t}var db=1/0,PN=17976931348623157e292;function BN(t){if(!t)return t===0?t:0;if(t=FN(t),t===db||t===-db){var e=t<0?-1:1;return e*PN}return t===t?t:0}function ql(t){var e=BN(t),n=e%1;return e===e?n?e-n:e:0}function Ko(t){return t}var DN="[object AsyncFunction]",$N="[object Function]",jN="[object GeneratorFunction]",zN="[object Proxy]";function Ii(t){if(!yr(t))return!1;var e=ss(t);return e==$N||e==jN||e==DN||e==zN}var Sd=ii["__core-js_shared__"],pb=function(){var t=/[^.]+$/.exec(Sd&&Sd.keys&&Sd.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function KN(t){return!!pb&&pb in t}var WN=Function.prototype,HN=WN.toString;function Ds(t){if(t!=null){try{return HN.call(t)}catch{}try{return t+""}catch{}}return""}var GN=/[\\^$.*+?()[\]{}|]/g,YN=/^\[object .+?Constructor\]$/,VN=Function.prototype,ZN=Object.prototype,XN=VN.toString,qN=ZN.hasOwnProperty,JN=RegExp("^"+XN.call(qN).replace(GN,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function QN(t){if(!yr(t)||KN(t))return!1;var e=Ii(t)?JN:YN;return e.test(Ds(t))}function tC(t,e){return t==null?void 0:t[e]}function $s(t,e){var n=tC(t,e);return QN(n)?n:void 0}var Od=$s(ii,"WeakMap"),mb=Object.create,eC=function(){function t(){}return function(e){if(!yr(e))return{};if(mb)return mb(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function nC(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function qe(){}function rC(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var iC=800,sC=16,oC=Date.now;function aC(t){var e=0,n=0;return function(){var r=oC(),i=sC-(r-n);if(n=r,i>0){if(++e>=iC)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function cC(t){return function(){return t}}var Jl=function(){try{var t=$s(Object,"defineProperty");return t({},"",{}),t}catch{}}(),lC=Jl?function(t,e){return Jl(t,"toString",{configurable:!0,enumerable:!1,value:cC(e),writable:!0})}:Ko,uC=aC(lC);function gb(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function _b(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function hC(t){return t!==t}function fC(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Id(t,e,n){return e===e?fC(t,e,n):_b(t,hC,n)}function yb(t,e){var n=t==null?0:t.length;return!!n&&Id(t,e,0)>-1}var dC=9007199254740991,pC=/^(?:0|[1-9]\d*)$/;function Ql(t,e){var n=typeof t;return e=e??dC,!!e&&(n=="number"||n!="symbol"&&pC.test(t))&&t>-1&&t%1==0&&t<e}function Nd(t,e,n){e=="__proto__"&&Jl?Jl(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ac(t,e){return t===e||t!==t&&e!==e}var mC=Object.prototype,gC=mC.hasOwnProperty;function tu(t,e,n){var r=t[e];(!(gC.call(t,e)&&ac(r,n))||n===void 0&&!(e in t))&&Nd(t,e,n)}function Cd(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?Nd(n,a,c):tu(n,a,c)}return n}var bb=Math.max;function _C(t,e,n){return e=bb(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=bb(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),nC(t,this,a)}}function Ld(t,e){return uC(_C(t,e,Ko),t+"")}var yC=9007199254740991;function Md(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=yC}function si(t){return t!=null&&Md(t.length)&&!Ii(t)}function wb(t,e,n){if(!yr(n))return!1;var r=typeof e;return(r=="number"?si(n)&&Ql(e,n.length):r=="string"&&e in n)?ac(n[e],t):!1}function bC(t){return Ld(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&wb(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var wC=Object.prototype;function cc(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||wC;return t===n}function EC(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var xC="[object Arguments]";function Eb(t){return Ur(t)&&ss(t)==xC}var xb=Object.prototype,vC=xb.hasOwnProperty,kC=xb.propertyIsEnumerable,eu=Eb(function(){return arguments}())?Eb:function(t){return Ur(t)&&vC.call(t,"callee")&&!kC.call(t,"callee")};function TC(){return!1}var vb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kb=vb&&typeof module=="object"&&module&&!module.nodeType&&module,AC=kb&&kb.exports===vb,Tb=AC?ii.Buffer:void 0,RC=Tb?Tb.isBuffer:void 0,lc=RC||TC,SC="[object Arguments]",OC="[object Array]",IC="[object Boolean]",NC="[object Date]",CC="[object Error]",LC="[object Function]",MC="[object Map]",UC="[object Number]",FC="[object Object]",PC="[object RegExp]",BC="[object Set]",DC="[object String]",$C="[object WeakMap]",jC="[object ArrayBuffer]",zC="[object DataView]",KC="[object Float32Array]",WC="[object Float64Array]",HC="[object Int8Array]",GC="[object Int16Array]",YC="[object Int32Array]",VC="[object Uint8Array]",ZC="[object Uint8ClampedArray]",XC="[object Uint16Array]",qC="[object Uint32Array]",Ee={};Ee[KC]=Ee[WC]=Ee[HC]=Ee[GC]=Ee[YC]=Ee[VC]=Ee[ZC]=Ee[XC]=Ee[qC]=!0,Ee[SC]=Ee[OC]=Ee[jC]=Ee[IC]=Ee[zC]=Ee[NC]=Ee[CC]=Ee[LC]=Ee[MC]=Ee[UC]=Ee[FC]=Ee[PC]=Ee[BC]=Ee[DC]=Ee[$C]=!1;function JC(t){return Ur(t)&&Md(t.length)&&!!Ee[ss(t)]}function nu(t){return function(e){return t(e)}}var Ab=typeof exports=="object"&&exports&&!exports.nodeType&&exports,uc=Ab&&typeof module=="object"&&module&&!module.nodeType&&module,QC=uc&&uc.exports===Ab,Ud=QC&&ob.process,os=function(){try{var t=uc&&uc.require&&uc.require("util").types;return t||Ud&&Ud.binding&&Ud.binding("util")}catch{}}(),Rb=os&&os.isTypedArray,Fd=Rb?nu(Rb):JC,t6=Object.prototype,e6=t6.hasOwnProperty;function Sb(t,e){var n=ee(t),r=!n&&eu(t),i=!n&&!r&&lc(t),s=!n&&!r&&!i&&Fd(t),o=n||r||i||s,a=o?EC(t.length,String):[],c=a.length;for(var l in t)(e||e6.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Ql(l,c)))&&a.push(l);return a}function Ob(t,e){return function(n){return t(e(n))}}var n6=Ob(Object.keys,Object),r6=Object.prototype,i6=r6.hasOwnProperty;function Ib(t){if(!cc(t))return n6(t);var e=[];for(var n in Object(t))i6.call(t,n)&&n!="constructor"&&e.push(n);return e}function br(t){return si(t)?Sb(t):Ib(t)}var s6=Object.prototype,o6=s6.hasOwnProperty,Un=bC(function(t,e){if(cc(e)||si(e)){Cd(e,br(e),t);return}for(var n in e)o6.call(e,n)&&tu(t,n,e[n])});function a6(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var c6=Object.prototype,l6=c6.hasOwnProperty;function u6(t){if(!yr(t))return a6(t);var e=cc(t),n=[];for(var r in t)r=="constructor"&&(e||!l6.call(t,r))||n.push(r);return n}function Nb(t){return si(t)?Sb(t,!0):u6(t)}var h6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,f6=/^\w*$/;function Pd(t,e){if(ee(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Zl(t)?!0:f6.test(t)||!h6.test(t)||e!=null&&t in Object(e)}var hc=$s(Object,"create");function d6(){this.__data__=hc?hc(null):{},this.size=0}function p6(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var m6="__lodash_hash_undefined__",g6=Object.prototype,_6=g6.hasOwnProperty;function y6(t){var e=this.__data__;if(hc){var n=e[t];return n===m6?void 0:n}return _6.call(e,t)?e[t]:void 0}var b6=Object.prototype,w6=b6.hasOwnProperty;function E6(t){var e=this.__data__;return hc?e[t]!==void 0:w6.call(e,t)}var x6="__lodash_hash_undefined__";function v6(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=hc&&e===void 0?x6:e,this}function js(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}js.prototype.clear=d6,js.prototype.delete=p6,js.prototype.get=y6,js.prototype.has=E6,js.prototype.set=v6;function k6(){this.__data__=[],this.size=0}function ru(t,e){for(var n=t.length;n--;)if(ac(t[n][0],e))return n;return-1}var T6=Array.prototype,A6=T6.splice;function R6(t){var e=this.__data__,n=ru(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():A6.call(e,n,1),--this.size,!0}function S6(t){var e=this.__data__,n=ru(e,t);return n<0?void 0:e[n][1]}function O6(t){return ru(this.__data__,t)>-1}function I6(t,e){var n=this.__data__,r=ru(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Ni(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ni.prototype.clear=k6,Ni.prototype.delete=R6,Ni.prototype.get=S6,Ni.prototype.has=O6,Ni.prototype.set=I6;var fc=$s(ii,"Map");function N6(){this.size=0,this.__data__={hash:new js,map:new(fc||Ni),string:new js}}function C6(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function iu(t,e){var n=t.__data__;return C6(e)?n[typeof e=="string"?"string":"hash"]:n.map}function L6(t){var e=iu(this,t).delete(t);return this.size-=e?1:0,e}function M6(t){return iu(this,t).get(t)}function U6(t){return iu(this,t).has(t)}function F6(t,e){var n=iu(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Ci(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ci.prototype.clear=N6,Ci.prototype.delete=L6,Ci.prototype.get=M6,Ci.prototype.has=U6,Ci.prototype.set=F6;var P6="Expected a function";function Bd(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(P6);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Bd.Cache||Ci),n}Bd.Cache=Ci;var B6=500;function D6(t){var e=Bd(t,function(r){return n.size===B6&&n.clear(),r}),n=e.cache;return e}var $6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,j6=/\\(\\)?/g,z6=D6(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace($6,function(n,r,i,s){e.push(i?s.replace(j6,"$1"):r||n)}),e});function Cb(t){return t==null?"":hb(t)}function su(t,e){return ee(t)?t:Pd(t,e)?[t]:z6(Cb(t))}var K6=1/0;function dc(t){if(typeof t=="string"||Zl(t))return t;var e=t+"";return e=="0"&&1/t==-K6?"-0":e}function Dd(t,e){e=su(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[dc(e[n++])];return n&&n==r?t:void 0}function W6(t,e,n){var r=t==null?void 0:Dd(t,e);return r===void 0?n:r}function $d(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Lb=_r?_r.isConcatSpreadable:void 0;function H6(t){return ee(t)||eu(t)||!!(Lb&&t&&t[Lb])}function jd(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=H6),i||(i=[]);++s<o;){var a=t[s];n(a)?$d(i,a):r||(i[i.length]=a)}return i}function er(t){var e=t==null?0:t.length;return e?jd(t):[]}var Mb=Ob(Object.getPrototypeOf,Object);function zd(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function G6(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:zd(t,e,n)}var Y6="\\ud800-\\udfff",V6="\\u0300-\\u036f",Z6="\\ufe20-\\ufe2f",X6="\\u20d0-\\u20ff",q6=V6+Z6+X6,J6="\\ufe0e\\ufe0f",Q6="\\u200d",tL=RegExp("["+Q6+Y6+q6+J6+"]");function Ub(t){return tL.test(t)}function eL(t){return t.split("")}var Fb="\\ud800-\\udfff",nL="\\u0300-\\u036f",rL="\\ufe20-\\ufe2f",iL="\\u20d0-\\u20ff",sL=nL+rL+iL,oL="\\ufe0e\\ufe0f",aL="["+Fb+"]",Kd="["+sL+"]",Wd="\\ud83c[\\udffb-\\udfff]",cL="(?:"+Kd+"|"+Wd+")",Pb="[^"+Fb+"]",Bb="(?:\\ud83c[\\udde6-\\uddff]){2}",Db="[\\ud800-\\udbff][\\udc00-\\udfff]",lL="\\u200d",$b=cL+"?",jb="["+oL+"]?",uL="(?:"+lL+"(?:"+[Pb,Bb,Db].join("|")+")"+jb+$b+")*",hL=jb+$b+uL,fL="(?:"+[Pb+Kd+"?",Kd,Bb,Db,aL].join("|")+")",dL=RegExp(Wd+"(?="+Wd+")|"+fL+hL,"g");function pL(t){return t.match(dL)||[]}function mL(t){return Ub(t)?pL(t):eL(t)}function gL(t){return function(e){e=Cb(e);var n=Ub(e)?mL(e):void 0,r=n?n[0]:e.charAt(0),i=n?G6(n,1).join(""):e.slice(1);return r[t]()+i}}var zb=gL("toUpperCase");function _L(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function yL(){this.__data__=new Ni,this.size=0}function bL(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function wL(t){return this.__data__.get(t)}function EL(t){return this.__data__.has(t)}var xL=200;function vL(t,e){var n=this.__data__;if(n instanceof Ni){var r=n.__data__;if(!fc||r.length<xL-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ci(r)}return n.set(t,e),this.size=n.size,this}function oi(t){var e=this.__data__=new Ni(t);this.size=e.size}oi.prototype.clear=yL,oi.prototype.delete=bL,oi.prototype.get=wL,oi.prototype.has=EL,oi.prototype.set=vL;function kL(t,e){return t&&Cd(e,br(e),t)}var Kb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Wb=Kb&&typeof module=="object"&&module&&!module.nodeType&&module,TL=Wb&&Wb.exports===Kb,Hb=TL?ii.Buffer:void 0,Gb=Hb?Hb.allocUnsafe:void 0;function AL(t,e){var n=t.length,r=Gb?Gb(n):new t.constructor(n);return t.copy(r),r}function Hd(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Yb(){return[]}var RL=Object.prototype,SL=RL.propertyIsEnumerable,Vb=Object.getOwnPropertySymbols,Gd=Vb?function(t){return t==null?[]:(t=Object(t),Hd(Vb(t),function(e){return SL.call(t,e)}))}:Yb;function OL(t,e){return Cd(t,Gd(t),e)}var IL=Object.getOwnPropertySymbols,NL=IL?function(t){for(var e=[];t;)$d(e,Gd(t)),t=Mb(t);return e}:Yb;function Zb(t,e,n){var r=e(t);return ee(t)?r:$d(r,n(t))}function Yd(t){return Zb(t,br,Gd)}function CL(t){return Zb(t,Nb,NL)}var Vd=$s(ii,"DataView"),Zd=$s(ii,"Promise"),Wo=$s(ii,"Set"),Xb="[object Map]",LL="[object Object]",qb="[object Promise]",Jb="[object Set]",Qb="[object WeakMap]",t1="[object DataView]",ML=Ds(Vd),UL=Ds(fc),FL=Ds(Zd),PL=Ds(Wo),BL=Ds(Od),wr=ss;(Vd&&wr(new Vd(new ArrayBuffer(1)))!=t1||fc&&wr(new fc)!=Xb||Zd&&wr(Zd.resolve())!=qb||Wo&&wr(new Wo)!=Jb||Od&&wr(new Od)!=Qb)&&(wr=function(t){var e=ss(t),n=e==LL?t.constructor:void 0,r=n?Ds(n):"";if(r)switch(r){case ML:return t1;case UL:return Xb;case FL:return qb;case PL:return Jb;case BL:return Qb}return e});var DL=Object.prototype,$L=DL.hasOwnProperty;function jL(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&$L.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var ou=ii.Uint8Array;function zL(t){var e=new t.constructor(t.byteLength);return new ou(e).set(new ou(t)),e}function KL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var WL=/\w*$/;function HL(t){var e=new t.constructor(t.source,WL.exec(t));return e.lastIndex=t.lastIndex,e}var e1=_r?_r.prototype:void 0,n1=e1?e1.valueOf:void 0;function GL(t){return n1?Object(n1.call(t)):{}}function YL(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var VL="[object Boolean]",ZL="[object Date]",XL="[object Map]",qL="[object Number]",JL="[object RegExp]",QL="[object Set]",t2="[object String]",e2="[object Symbol]",n2="[object ArrayBuffer]",r2="[object DataView]",i2="[object Float32Array]",s2="[object Float64Array]",o2="[object Int8Array]",a2="[object Int16Array]",c2="[object Int32Array]",l2="[object Uint8Array]",u2="[object Uint8ClampedArray]",h2="[object Uint16Array]",f2="[object Uint32Array]";function d2(t,e,n){var r=t.constructor;switch(e){case n2:return zL(t);case VL:case ZL:return new r(+t);case r2:return KL(t);case i2:case s2:case o2:case a2:case c2:case l2:case u2:case h2:case f2:return YL(t);case XL:return new r;case qL:case t2:return new r(t);case JL:return HL(t);case QL:return new r;case e2:return GL(t)}}function p2(t){return typeof t.constructor=="function"&&!cc(t)?eC(Mb(t)):{}}var m2="[object Map]";function g2(t){return Ur(t)&&wr(t)==m2}var r1=os&&os.isMap,_2=r1?nu(r1):g2,y2="[object Set]";function b2(t){return Ur(t)&&wr(t)==y2}var i1=os&&os.isSet,w2=i1?nu(i1):b2,s1="[object Arguments]",E2="[object Array]",x2="[object Boolean]",v2="[object Date]",k2="[object Error]",o1="[object Function]",T2="[object GeneratorFunction]",A2="[object Map]",R2="[object Number]",a1="[object Object]",S2="[object RegExp]",O2="[object Set]",I2="[object String]",N2="[object Symbol]",C2="[object WeakMap]",L2="[object ArrayBuffer]",M2="[object DataView]",U2="[object Float32Array]",F2="[object Float64Array]",P2="[object Int8Array]",B2="[object Int16Array]",D2="[object Int32Array]",$2="[object Uint8Array]",j2="[object Uint8ClampedArray]",z2="[object Uint16Array]",K2="[object Uint32Array]",_e={};_e[s1]=_e[E2]=_e[L2]=_e[M2]=_e[x2]=_e[v2]=_e[U2]=_e[F2]=_e[P2]=_e[B2]=_e[D2]=_e[A2]=_e[R2]=_e[a1]=_e[S2]=_e[O2]=_e[I2]=_e[N2]=_e[$2]=_e[j2]=_e[z2]=_e[K2]=!0,_e[k2]=_e[o1]=_e[C2]=!1;function au(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!yr(t))return t;var a=ee(t);if(a)return o=jL(t),rC(t,o);var c=wr(t),l=c==o1||c==T2;if(lc(t))return AL(t);if(c==a1||c==s1||l&&!i)return o=l?{}:p2(t),OL(t,kL(o,t));if(!_e[c])return i?t:{};o=d2(t,c),s||(s=new oi);var u=s.get(t);if(u)return u;s.set(t,o),w2(t)?t.forEach(function(h){o.add(au(h,e,n,h,t,s))}):_2(t)&&t.forEach(function(h,p){o.set(p,au(h,e,n,p,t,s))});var f=Yd,d=a?void 0:f(t);return gb(d||t,function(h,p){d&&(p=h,h=t[p]),tu(o,p,au(h,e,n,p,t,s))}),o}var W2=4;function dn(t){return au(t,W2)}function pc(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var H2="__lodash_hash_undefined__";function G2(t){return this.__data__.set(t,H2),this}function Y2(t){return this.__data__.has(t)}function Ho(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ci;++e<n;)this.add(t[e])}Ho.prototype.add=Ho.prototype.push=G2,Ho.prototype.has=Y2;function c1(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Xd(t,e){return t.has(e)}var V2=1,Z2=2;function l1(t,e,n,r,i,s){var o=n&V2,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var f=-1,d=!0,h=n&Z2?new Ho:void 0;for(s.set(t,e),s.set(e,t);++f<a;){var p=t[f],m=e[f];if(r)var b=o?r(m,p,f,e,t,s):r(p,m,f,t,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!c1(e,function(y,k){if(!Xd(h,k)&&(p===y||i(p,y,n,r,s)))return h.push(k)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function X2(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function qd(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var q2=1,J2=2,Q2="[object Boolean]",tM="[object Date]",eM="[object Error]",nM="[object Map]",rM="[object Number]",iM="[object RegExp]",sM="[object Set]",oM="[object String]",aM="[object Symbol]",cM="[object ArrayBuffer]",lM="[object DataView]",u1=_r?_r.prototype:void 0,Jd=u1?u1.valueOf:void 0;function uM(t,e,n,r,i,s,o){switch(n){case lM:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case cM:return!(t.byteLength!=e.byteLength||!s(new ou(t),new ou(e)));case Q2:case tM:case rM:return ac(+t,+e);case eM:return t.name==e.name&&t.message==e.message;case iM:case oM:return t==e+"";case nM:var a=X2;case sM:var c=r&q2;if(a||(a=qd),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=J2,o.set(t,e);var u=l1(a(t),a(e),r,i,s,o);return o.delete(t),u;case aM:if(Jd)return Jd.call(t)==Jd.call(e)}return!1}var hM=1,fM=Object.prototype,dM=fM.hasOwnProperty;function pM(t,e,n,r,i,s){var o=n&hM,a=Yd(t),c=a.length,l=Yd(e),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in e:dM.call(e,d)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var b=o;++f<c;){d=a[f];var y=t[d],k=e[d];if(r)var A=o?r(k,y,d,e,t,s):r(y,k,d,t,e,s);if(!(A===void 0?y===k||i(y,k,n,r,s):A)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var T=t.constructor,C=e.constructor;T!=C&&"constructor"in t&&"constructor"in e&&!(typeof T=="function"&&T instanceof T&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var mM=1,h1="[object Arguments]",f1="[object Array]",cu="[object Object]",gM=Object.prototype,d1=gM.hasOwnProperty;function _M(t,e,n,r,i,s){var o=ee(t),a=ee(e),c=o?f1:wr(t),l=a?f1:wr(e);c=c==h1?cu:c,l=l==h1?cu:l;var u=c==cu,f=l==cu,d=c==l;if(d&&lc(t)){if(!lc(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new oi),o||Fd(t)?l1(t,e,n,r,i,s):uM(t,e,c,n,r,i,s);if(!(n&mM)){var h=u&&d1.call(t,"__wrapped__"),p=f&&d1.call(e,"__wrapped__");if(h||p){var m=h?t.value():t,b=p?e.value():e;return s||(s=new oi),i(m,b,n,r,s)}}return d?(s||(s=new oi),pM(t,e,n,r,i,s)):!1}function Qd(t,e,n,r,i){return t===e?!0:t==null||e==null||!Ur(t)&&!Ur(e)?t!==t&&e!==e:_M(t,e,n,r,Qd,i)}var yM=1,bM=2;function wM(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new oi,f;if(!(f===void 0?Qd(l,c,yM|bM,r,u):f))return!1}}return!0}function p1(t){return t===t&&!yr(t)}function EM(t){for(var e=br(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,p1(i)]}return e}function m1(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function xM(t){var e=EM(t);return e.length==1&&e[0][2]?m1(e[0][0],e[0][1]):function(n){return n===t||wM(n,t,e)}}function vM(t,e){return t!=null&&e in Object(t)}function g1(t,e,n){e=su(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=dc(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Md(i)&&Ql(o,i)&&(ee(t)||eu(t)))}function kM(t,e){return t!=null&&g1(t,e,vM)}var TM=1,AM=2;function RM(t,e){return Pd(t)&&p1(e)?m1(dc(t),e):function(n){var r=W6(n,t);return r===void 0&&r===e?kM(n,t):Qd(e,r,TM|AM)}}function SM(t){return function(e){return e==null?void 0:e[t]}}function OM(t){return function(e){return Dd(e,t)}}function IM(t){return Pd(t)?SM(dc(t)):OM(t)}function ai(t){return typeof t=="function"?t:t==null?Ko:typeof t=="object"?ee(t)?RM(t[0],t[1]):xM(t):IM(t)}function NM(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function CM(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var LM=CM();function MM(t,e){return t&&LM(t,e,br)}function UM(t,e){return function(n,r){if(n==null)return n;if(!si(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var zs=UM(MM);function FM(t,e,n,r){return zs(t,function(i,s,o){e(r,i,n(i),o)}),r}function PM(t,e){return function(n,r){var i=ee(n)?NM:FM,s=e?e():{};return i(n,t,ai(r),s)}}var _1=Object.prototype,BM=_1.hasOwnProperty,t0=Ld(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&wb(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Nb(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||ac(u,_1[l])&&!BM.call(t,l))&&(t[l]=s[l])}return t});function y1(t){return Ur(t)&&si(t)}var DM=200;function $M(t,e,n,r){var i=-1,s=yb,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=DM&&(s=Xd,o=!1,e=new Ho(e));t:for(;++i<a;){var u=t[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(e[d]===f)continue t;c.push(u)}else s(e,f,r)||c.push(u)}return c}var lu=Ld(function(t,e){return y1(t)?$M(t,jd(e,1,y1,!0)):[]});function Go(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function pn(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ql(e),zd(t,e<0?0:e,r)):[]}function mc(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:ql(e),e=r-e,zd(t,0,e<0?0:e)):[]}function jM(t){return typeof t=="function"?t:Ko}function Ct(t,e){var n=ee(t)?gb:zs;return n(t,jM(e))}function zM(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function KM(t,e){var n=!0;return zs(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function Fr(t,e,n){var r=ee(t)?zM:KM;return r(t,ai(e))}function b1(t,e){var n=[];return zs(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Er(t,e){var n=ee(t)?Hd:b1;return n(t,ai(e))}function WM(t){return function(e,n,r){var i=Object(e);if(!si(e)){var s=ai(n);e=br(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var HM=Math.max;function GM(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:ql(n);return i<0&&(i=HM(r+i,0)),_b(t,ai(e),i)}var Yo=WM(GM);function Pr(t){return t&&t.length?t[0]:void 0}function YM(t,e){var n=-1,r=si(t)?Array(t.length):[];return zs(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function xt(t,e){var n=ee(t)?Xl:YM;return n(t,ai(e))}function xr(t,e){return jd(xt(t,e))}var VM=Object.prototype,ZM=VM.hasOwnProperty,w1=PM(function(t,e,n){ZM.call(t,n)?t[n].push(e):Nd(t,n,[e])}),XM=Object.prototype,qM=XM.hasOwnProperty;function JM(t,e){return t!=null&&qM.call(t,e)}function Nt(t,e){return t!=null&&g1(t,e,JM)}var QM="[object String]";function Fn(t){return typeof t=="string"||!ee(t)&&Ur(t)&&ss(t)==QM}function t8(t,e){return Xl(e,function(n){return t[n]})}function We(t){return t==null?[]:t8(t,br(t))}var e8=Math.max;function Rn(t,e,n,r){t=si(t)?t:We(t),n=n&&!r?ql(n):0;var i=t.length;return n<0&&(n=e8(i+n,0)),Fn(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Id(t,e,n)>-1}function E1(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return Id(t,e,i)}var n8="[object Map]",r8="[object Set]",i8=Object.prototype,s8=i8.hasOwnProperty;function ye(t){if(t==null)return!0;if(si(t)&&(ee(t)||typeof t=="string"||typeof t.splice=="function"||lc(t)||Fd(t)||eu(t)))return!t.length;var e=wr(t);if(e==n8||e==r8)return!t.size;if(cc(t))return!Ib(t).length;for(var n in t)if(s8.call(t,n))return!1;return!0}var o8="[object RegExp]";function a8(t){return Ur(t)&&ss(t)==o8}var x1=os&&os.isRegExp,Li=x1?nu(x1):a8;function Mi(t){return t===void 0}var c8="Expected a function";function l8(t){if(typeof t!="function")throw new TypeError(c8);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function u8(t,e,n,r){if(!yr(t))return t;e=su(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=dc(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=yr(u)?u:Ql(e[i+1])?[]:{})}tu(a,c,l),a=a[c]}return t}function h8(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Dd(t,o);n(a,o)&&u8(s,su(o,t),a)}return s}function Br(t,e){if(t==null)return{};var n=Xl(CL(t),function(r){return[r]});return e=ai(e),h8(t,n,function(r,i){return e(r,i[0])})}function f8(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Pn(t,e,n){var r=ee(t)?_L:f8,i=arguments.length<3;return r(t,ai(e),n,i,zs)}function uu(t,e){var n=ee(t)?Hd:b1;return n(t,l8(ai(e)))}function d8(t,e){var n;return zs(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function e0(t,e,n){var r=ee(t)?c1:d8;return r(t,ai(e))}var p8=1/0,m8=Wo&&1/qd(new Wo([,-0]))[1]==p8?function(t){return new Wo(t)}:qe,g8=200;function _8(t,e,n){var r=-1,i=yb,s=t.length,o=!0,a=[],c=a;if(s>=g8){var l=m8(t);if(l)return qd(l);o=!1,i=Xd,c=new Ho}else c=a;t:for(;++r<s;){var u=t[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function hu(t){return t&&t.length?_8(t):[]}function n0(t){console&&console.error&&console.error(`Error: ${t}`)}function v1(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function k1(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function T1(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function y8(t){return b8(t)?t.LABEL:t.name}function b8(t){return Fn(t.LABEL)&&t.LABEL!==""}class ci{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Ct(this.definition,n=>{n.accept(e)})}}class Bn extends ci{constructor(e){super([]),this.idx=1,Un(this,Br(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Vo extends ci{constructor(e){super(e.definition),this.orgText="",Un(this,Br(e,n=>n!==void 0))}}class Dn extends ci{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Un(this,Br(e,n=>n!==void 0))}}class $n extends ci{constructor(e){super(e.definition),this.idx=1,Un(this,Br(e,n=>n!==void 0))}}class li extends ci{constructor(e){super(e.definition),this.idx=1,Un(this,Br(e,n=>n!==void 0))}}class ui extends ci{constructor(e){super(e.definition),this.idx=1,Un(this,Br(e,n=>n!==void 0))}}class Je extends ci{constructor(e){super(e.definition),this.idx=1,Un(this,Br(e,n=>n!==void 0))}}class Dr extends ci{constructor(e){super(e.definition),this.idx=1,Un(this,Br(e,n=>n!==void 0))}}class $r extends ci{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Un(this,Br(e,n=>n!==void 0))}}class Ce{constructor(e){this.idx=1,Un(this,Br(e,n=>n!==void 0))}accept(e){e.visit(this)}}function w8(t){return xt(t,fu)}function fu(t){function e(n){return xt(n,fu)}if(t instanceof Bn){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Fn(t.label)&&(n.label=t.label),n}else{if(t instanceof Dn)return{type:"Alternative",definition:e(t.definition)};if(t instanceof $n)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof li)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof ui)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:fu(new Ce({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Dr)return{type:"RepetitionWithSeparator",idx:t.idx,separator:fu(new Ce({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Je)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof $r)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Ce){const n={type:"Terminal",name:t.terminalType.name,label:y8(t.terminalType),idx:t.idx};Fn(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Li(r)?r.source:r),n}else{if(t instanceof Vo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Ks{visit(e){const n=e;switch(n.constructor){case Bn:return this.visitNonTerminal(n);case Dn:return this.visitAlternative(n);case $n:return this.visitOption(n);case li:return this.visitRepetitionMandatory(n);case ui:return this.visitRepetitionMandatoryWithSeparator(n);case Dr:return this.visitRepetitionWithSeparator(n);case Je:return this.visitRepetition(n);case $r:return this.visitAlternation(n);case Ce:return this.visitTerminal(n);case Vo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function E8(t){return t instanceof Dn||t instanceof $n||t instanceof Je||t instanceof li||t instanceof ui||t instanceof Dr||t instanceof Ce||t instanceof Vo}function du(t,e=[]){return t instanceof $n||t instanceof Je||t instanceof Dr?!0:t instanceof $r?e0(t.definition,r=>du(r,e)):t instanceof Bn&&Rn(e,t)?!1:t instanceof ci?(t instanceof Bn&&e.push(t),Fr(t.definition,r=>du(r,e))):!1}function x8(t){return t instanceof $r}function hi(t){if(t instanceof Bn)return"SUBRULE";if(t instanceof $n)return"OPTION";if(t instanceof $r)return"OR";if(t instanceof li)return"AT_LEAST_ONE";if(t instanceof ui)return"AT_LEAST_ONE_SEP";if(t instanceof Dr)return"MANY_SEP";if(t instanceof Je)return"MANY";if(t instanceof Ce)return"CONSUME";throw Error("non exhaustive match")}class pu{walk(e,n=[]){Ct(e.definition,(r,i)=>{const s=pn(e.definition,i+1);if(r instanceof Bn)this.walkProdRef(r,s,n);else if(r instanceof Ce)this.walkTerminal(r,s,n);else if(r instanceof Dn)this.walkFlat(r,s,n);else if(r instanceof $n)this.walkOption(r,s,n);else if(r instanceof li)this.walkAtLeastOne(r,s,n);else if(r instanceof ui)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Dr)this.walkManySep(r,s,n);else if(r instanceof Je)this.walkMany(r,s,n);else if(r instanceof $r)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new $n({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=A1(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new $n({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=A1(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Ct(e.definition,s=>{const o=new Dn({definition:[s]});this.walk(o,i)})}}function A1(t,e,n){return[new $n({definition:[new Ce({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function gc(t){if(t instanceof Bn)return gc(t.referencedRule);if(t instanceof Ce)return T8(t);if(E8(t))return v8(t);if(x8(t))return k8(t);throw Error("non exhaustive match")}function v8(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=du(s),e=e.concat(gc(s)),r=r+1,i=n.length>r;return hu(e)}function k8(t){const e=xt(t.definition,n=>gc(n));return hu(er(e))}function T8(t){return[t.terminalType]}const R1="_~IN~_";class A8 extends pu{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=S8(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new Dn({definition:s}),a=gc(o);this.follows[i]=a}}function R8(t){const e={};return Ct(t,n=>{const r=new A8(n).startWalking();Un(e,r)}),e}function S8(t,e){return t.name+e+R1}function Lt(t){return t.charCodeAt(0)}function r0(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function _c(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Zo(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function O8(){throw Error("Internal Error - Should never get here!")}function S1(t){return t.type==="Character"}const mu=[];for(let t=Lt("0");t<=Lt("9");t++)mu.push(t);const gu=[Lt("_")].concat(mu);for(let t=Lt("a");t<=Lt("z");t++)gu.push(t);for(let t=Lt("A");t<=Lt("Z");t++)gu.push(t);const O1=[Lt(" "),Lt("\f"),Lt(`
`),Lt("\r"),Lt("	"),Lt("\v"),Lt("	"),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt(""),Lt("\u2028"),Lt("\u2029"),Lt(""),Lt(""),Lt(""),Lt("\uFEFF")],I8=/[0-9a-fA-F]/,_u=/[0-9]/,N8=/[1-9]/;class C8{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":_c(r,"global");break;case"i":_c(r,"ignoreCase");break;case"m":_c(r,"multiLine");break;case"u":_c(r,"unicode");break;case"y":_c(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Zo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return O8()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Zo(n);break}if(!(e===!0&&n===void 0)&&Zo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Zo(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Lt(`
`),Lt("\r"),Lt("\u2028"),Lt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=mu;break;case"D":e=mu,n=!0;break;case"s":e=O1;break;case"S":e=O1,n=!0;break;case"w":e=gu;break;case"W":e=gu,n=!0;break}if(Zo(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Lt("\f");break;case"n":e=Lt(`
`);break;case"r":e=Lt("\r");break;case"t":e=Lt("	");break;case"v":e=Lt("\v");break}if(Zo(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Lt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Lt(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Lt(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,S1(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,S1(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else r0(r.value,e),e.push(Lt("-")),r0(i.value,e)}else r0(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Lt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(N8.test(e)===!1)throw Error("Expecting a positive integer");for(;_u.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(_u.test(e)===!1)throw Error("Expecting an integer");for(;_u.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Lt(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return _u.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(I8.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class i0{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let yu={};const L8=new C8;function bu(t){const e=t.toString();if(yu.hasOwnProperty(e))return yu[e];{const n=L8.pattern(e);return yu[e]=n,n}}function M8(){yu={}}const I1="Complement Sets are not supported for first char optimization",wu=`Unable to use "first char" lexer optimizations:
`;function U8(t,e=!1){try{const n=bu(t);return s0(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===I1)e&&v1(`${wu}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),n0(`${wu}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function s0(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)s0(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Eu(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(I1);Ct(o.value,c=>{if(typeof c=="number")Eu(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Eu(u,e,n);else{for(let u=l.from;u<=l.to&&u<bc;u++)Eu(u,e,n);if(l.to>=bc){const u=l.from>=bc?l.from:bc,f=l.to,d=as(u),h=as(f);for(let p=d;p<=h;p++)e[p]=p}}}});break;case"Group":s0(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&o0(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return We(e)}function Eu(t,e,n){const r=as(t);e[r]=r,n===!0&&F8(t,e)}function F8(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=as(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=as(i.charCodeAt(0));e[s]=s}}}function N1(t,e){return Yo(t.value,n=>{if(typeof n=="number")return Rn(e,n);{const r=n;return Yo(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function o0(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?ee(t.value)?Fr(t.value,o0):o0(t.value):!1}class P8 extends i0{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Rn(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?N1(e,this.targetCharCodes)===void 0&&(this.found=!0):N1(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function a0(t,e){if(e instanceof RegExp){const n=bu(e),r=new P8(t);return r.visit(n),r.found}else return Yo(e,n=>Rn(t,n.charCodeAt(0)))!==void 0}const Ws="PATTERN",yc="defaultMode",xu="modes";let C1=typeof new RegExp("(?:)").sticky=="boolean";function B8(t,e){e=t0(e,{useSticky:C1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(k,A)=>A()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{a3()});let r;n("Reject Lexer.NA",()=>{r=uu(t,k=>k[Ws]===Qe.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=xt(r,k=>{const A=k[Ws];if(Li(A)){const T=A.source;return T.length===1&&T!=="^"&&T!=="$"&&T!=="."&&!A.ignoreCase?T:T.length===2&&T[0]==="\\"&&!Rn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],T[1])?T[1]:e.useSticky?M1(A):L1(A)}else{if(Ii(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const T=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(T);return e.useSticky?M1(C):L1(C)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=xt(r,k=>k.tokenTypeIdx),a=xt(r,k=>{const A=k.GROUP;if(A!==Qe.SKIPPED){if(Fn(A))return A;if(Mi(A))return!1;throw Error("non exhaustive match")}}),c=xt(r,k=>{const A=k.LONGER_ALT;if(A)return ee(A)?xt(A,C=>E1(r,C)):[E1(r,A)]}),l=xt(r,k=>k.PUSH_MODE),u=xt(r,k=>Nt(k,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const k=P1(e.lineTerminatorCharacters);f=xt(r,A=>!1),e.positionTracking!=="onlyOffset"&&(f=xt(r,A=>Nt(A,"LINE_BREAKS")?!!A.LINE_BREAKS:F1(A,k)===!1&&a0(k,A.PATTERN)))});let d,h,p,m;n("Misc Mapping #2",()=>{d=xt(r,U1),h=xt(s,i3),p=Pn(r,(k,A)=>{const T=A.GROUP;return Fn(T)&&T!==Qe.SKIPPED&&(k[T]=[]),k},{}),m=xt(s,(k,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:f[A],isCustom:d[A],short:h[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let b=!0,y=[];return e.safeMode||n("First Char Optimization",()=>{y=Pn(r,(k,A,T)=>{if(typeof A.PATTERN=="string"){const C=A.PATTERN.charCodeAt(0),R=as(C);c0(k,R,m[T])}else if(ee(A.START_CHARS_HINT)){let C;Ct(A.START_CHARS_HINT,R=>{const S=typeof R=="string"?R.charCodeAt(0):R,U=as(S);C!==U&&(C=U,c0(k,U,m[T]))})}else if(Li(A.PATTERN))if(A.PATTERN.unicode)b=!1,e.ensureOptimizations&&n0(`${wu}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=U8(A.PATTERN,e.ensureOptimizations);ye(C)&&(b=!1),Ct(C,R=>{c0(k,R,m[T])})}else e.ensureOptimizations&&n0(`${wu}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return k},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:b}}function D8(t,e){let n=[];const r=j8(t);n=n.concat(r.errors);const i=z8(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat($8(s)),n=n.concat(X8(s)),n=n.concat(q8(s,e)),n=n.concat(J8(s)),n}function $8(t){let e=[];const n=Er(t,r=>Li(r[Ws]));return e=e.concat(W8(n)),e=e.concat(Y8(n)),e=e.concat(V8(n)),e=e.concat(Z8(n)),e=e.concat(H8(n)),e}function j8(t){const e=Er(t,i=>!Nt(i,Ws)),n=xt(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Fe.MISSING_PATTERN,tokenTypes:[i]})),r=lu(t,e);return{errors:n,valid:r}}function z8(t){const e=Er(t,i=>{const s=i[Ws];return!Li(s)&&!Ii(s)&&!Nt(s,"exec")&&!Fn(s)}),n=xt(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Fe.INVALID_PATTERN,tokenTypes:[i]})),r=lu(t,e);return{errors:n,valid:r}}const K8=/[^\\][$]/;function W8(t){class e extends i0{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Er(t,i=>{const s=i.PATTERN;try{const o=bu(s),a=new e;return a.visit(o),a.found}catch{return K8.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Fe.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function H8(t){const e=Er(t,r=>r.PATTERN.test(""));return xt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Fe.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const G8=/[^\\[][\^]|^\^/;function Y8(t){class e extends i0{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Er(t,i=>{const s=i.PATTERN;try{const o=bu(s),a=new e;return a.visit(o),a.found}catch{return G8.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Fe.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function V8(t){const e=Er(t,r=>{const i=r[Ws];return i instanceof RegExp&&(i.multiline||i.global)});return xt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Fe.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function Z8(t){const e=[];let n=xt(t,s=>Pn(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Rn(e,a)&&a.PATTERN!==Qe.NA&&(e.push(a),o.push(a)),o),[]));n=pc(n);const r=Er(n,s=>s.length>1);return xt(r,s=>{const o=xt(s,c=>c.name);return{message:`The same RegExp pattern ->${Pr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Fe.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function X8(t){const e=Er(t,r=>{if(!Nt(r,"GROUP"))return!1;const i=r.GROUP;return i!==Qe.SKIPPED&&i!==Qe.NA&&!Fn(i)});return xt(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Fe.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function q8(t,e){const n=Er(t,i=>i.PUSH_MODE!==void 0&&!Rn(e,i.PUSH_MODE));return xt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Fe.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function J8(t){const e=[],n=Pn(t,(r,i,s)=>{const o=i.PATTERN;return o===Qe.NA||(Fn(o)?r.push({str:o,idx:s,tokenType:i}):Li(o)&&t3(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ct(t,(r,i)=>{Ct(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&Q8(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Fe.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function Q8(t,e){if(Li(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Ii(e))return e(t,0,[],{});if(Nt(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function t3(t){return Yo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function L1(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function M1(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function e3(t,e,n){const r=[];return Nt(t,yc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+yc+`> property in its definition
`,type:Fe.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Nt(t,xu)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+xu+`> property in its definition
`,type:Fe.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Nt(t,xu)&&Nt(t,yc)&&!Nt(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${yc}: <${t.defaultMode}>which does not exist
`,type:Fe.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Nt(t,xu)&&Ct(t.modes,(i,s)=>{Ct(i,(o,a)=>{if(Mi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Fe.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Nt(o,"LONGER_ALT")){const c=ee(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ct(c,l=>{!Mi(l)&&!Rn(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Fe.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function n3(t,e,n){const r=[];let i=!1;const s=pc(er(We(t.modes))),o=uu(s,c=>c[Ws]===Qe.NA),a=P1(n);return e&&Ct(o,c=>{const l=F1(c,a);if(l!==!1){const f={message:o3(c,l),type:l.issue,tokenType:c};r.push(f)}else Nt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):a0(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Fe.NO_LINE_BREAKS_FLAGS}),r}function r3(t){const e={},n=br(t);return Ct(n,r=>{const i=t[r];if(ee(i))e[r]=[];else throw Error("non exhaustive match")}),e}function U1(t){const e=t.PATTERN;if(Li(e))return!1;if(Ii(e))return!0;if(Nt(e,"exec"))return!0;if(Fn(e))return!1;throw Error("non exhaustive match")}function i3(t){return Fn(t)&&t.length===1?t.charCodeAt(0):!1}const s3={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function F1(t,e){if(Nt(t,"LINE_BREAKS"))return!1;if(Li(t.PATTERN)){try{a0(e,t.PATTERN)}catch(n){return{issue:Fe.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Fn(t.PATTERN))return!1;if(U1(t))return{issue:Fe.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function o3(t,e){if(e.issue===Fe.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Fe.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function P1(t){return xt(t,n=>Fn(n)?n.charCodeAt(0):n)}function c0(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const bc=256;let vu=[];function as(t){return t<bc?t:vu[t]}function a3(){if(ye(vu)){vu=new Array(65536);for(let t=0;t<65536;t++)vu[t]=t>255?255+~~(t/255):t}}function wc(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function ku(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let B1=1;const D1={};function Ec(t){const e=c3(t);l3(e),h3(e),u3(e),Ct(e,n=>{n.isParent=n.categoryMatches.length>0})}function c3(t){let e=dn(t),n=t,r=!0;for(;r;){n=pc(er(xt(n,s=>s.CATEGORIES)));const i=lu(n,e);e=e.concat(i),ye(i)?r=!1:n=i}return e}function l3(t){Ct(t,e=>{j1(e)||(D1[B1]=e,e.tokenTypeIdx=B1++),z1(e)&&!ee(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),z1(e)||(e.CATEGORIES=[]),f3(e)||(e.categoryMatches=[]),d3(e)||(e.categoryMatchesMap={})})}function u3(t){Ct(t,e=>{e.categoryMatches=[],Ct(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(D1[r].tokenTypeIdx)})})}function h3(t){Ct(t,e=>{$1([],e)})}function $1(t,e){Ct(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ct(e.CATEGORIES,n=>{const r=t.concat(e);Rn(r,n)||$1(r,n)})}function j1(t){return Nt(t,"tokenTypeIdx")}function z1(t){return Nt(t,"CATEGORIES")}function f3(t){return Nt(t,"categoryMatches")}function d3(t){return Nt(t,"categoryMatchesMap")}function p3(t){return Nt(t,"tokenTypeIdx")}const m3={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var Fe;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Fe||(Fe={}));const xc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:m3,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(xc);let Qe=class{constructor(e,n=xc){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=k1(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Un({},xc,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===xc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=s3;else if(this.config.lineTerminatorCharacters===xc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),ee(e)?i={modes:{defaultMode:dn(e)},defaultMode:yc}:(s=!1,i=dn(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(e3(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(n3(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ct(i.modes,(a,c)=>{i.modes[c]=uu(a,l=>Mi(l))});const o=br(i.modes);if(Ct(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(D8(a,o))}),ye(this.lexerDefinitionErrors)){Ec(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=B8(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Un({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ye(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=xt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ct(this.lexerDefinitionWarning,a=>{v1(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(C1?(this.chopInput=Ko,this.match=this.matchWithTest):(this.updateLastIndex=qe,this.match=this.matchWithExec),s&&(this.handleModes=qe),this.trackStartLines===!1&&(this.computeNewColumn=Ko),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=qe),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Pn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ye(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{M8()}),this.TRACE_INIT("toFastProperties",()=>{T1(this)})})}tokenize(e,n=this.defaultMode){if(!ye(this.lexerDefinitionErrors)){const i=xt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,b,y;const k=e,A=k.length;let T=0,C=0;const R=this.hasCustom?0:Math.floor(e.length/10),S=new Array(R),U=[];let N=this.trackStartLines?1:void 0,D=this.trackStartLines?1:void 0;const Y=r3(this.emptyGroups),L=this.trackStartLines,I=this.config.lineTerminatorsPattern;let E=0,B=[],J=[];const j=[],st=[];Object.freeze(st);let tt;function ft(){return B}function V(Ut){const Vt=as(Ut),Ft=J[Vt];return Ft===void 0?st:Ft}const W=Ut=>{if(j.length===1&&Ut.tokenType.PUSH_MODE===void 0){const Vt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ut);U.push({offset:Ut.startOffset,line:Ut.startLine,column:Ut.startColumn,length:Ut.image.length,message:Vt})}else{j.pop();const Vt=Go(j);B=this.patternIdxToConfig[Vt],J=this.charCodeToPatternIdxToConfig[Vt],E=B.length;const Ft=this.canModeBeOptimized[Vt]&&this.config.safeMode===!1;J&&Ft?tt=V:tt=ft}};function Et(Ut){j.push(Ut),J=this.charCodeToPatternIdxToConfig[Ut],B=this.patternIdxToConfig[Ut],E=B.length,E=B.length;const Vt=this.canModeBeOptimized[Ut]&&this.config.safeMode===!1;J&&Vt?tt=V:tt=ft}Et.call(this,n);let at;const lt=this.config.recoveryEnabled;for(;T<A;){c=null;const Ut=k.charCodeAt(T),Vt=tt(Ut),Ft=Vt.length;for(r=0;r<Ft;r++){at=Vt[r];const kt=at.pattern;l=null;const $t=at.short;if($t!==!1?Ut===$t&&(c=kt):at.isCustom===!0?(y=kt.exec(k,T,S,Y),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(kt,T),c=this.match(kt,e,T)),c!==null){if(a=at.longerAlt,a!==void 0){const Pt=a.length;for(s=0;s<Pt;s++){const Se=B[a[s]],Be=Se.pattern;if(u=null,Se.isCustom===!0?(y=Be.exec(k,T,S,Y),y!==null?(o=y[0],y.payload!==void 0&&(u=y.payload)):o=null):(this.updateLastIndex(Be,T),o=this.match(Be,e,T)),o&&o.length>c.length){c=o,l=u,at=Se;break}}}break}}if(c!==null){if(f=c.length,d=at.group,d!==void 0&&(h=at.tokenTypeIdx,p=this.createTokenInstance(c,T,h,at.tokenType,N,D,f),this.handlePayload(p,l),d===!1?C=this.addToken(S,C,p):Y[d].push(p)),e=this.chopInput(e,f),T=T+f,D=this.computeNewColumn(D,f),L===!0&&at.canLineTerminator===!0){let kt=0,$t,Pt;I.lastIndex=0;do $t=I.test(c),$t===!0&&(Pt=I.lastIndex-1,kt++);while($t===!0);kt!==0&&(N=N+kt,D=f-Pt,this.updateTokenEndLineColumnLocation(p,d,Pt,kt,N,D,f))}this.handleModes(at,W,Et,p)}else{const kt=T,$t=N,Pt=D;let Se=lt===!1;for(;Se===!1&&T<A;)for(e=this.chopInput(e,1),T++,i=0;i<E;i++){const Be=B[i],v=Be.pattern,ot=Be.short;if(ot!==!1?k.charCodeAt(T)===ot&&(Se=!0):Be.isCustom===!0?Se=v.exec(k,T,S,Y)!==null:(this.updateLastIndex(v,T),Se=v.exec(e)!==null),Se===!0)break}if(m=T-kt,D=this.computeNewColumn(D,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(k,kt,m,$t,Pt),U.push({offset:kt,line:$t,column:Pt,length:m,message:b}),lt===!1)break}}return this.hasCustom||(S.length=C),{tokens:S,groups:Y,errors:U}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};Qe.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Qe.NA=/NOT_APPLICABLE/;function vc(t){return K1(t)?t.LABEL:t.name}function K1(t){return Fn(t.LABEL)&&t.LABEL!==""}const g3="parent",W1="categories",H1="label",G1="group",Y1="push_mode",V1="pop_mode",Z1="longer_alt",X1="line_breaks",q1="start_chars_hint";function nr(t){return _3(t)}function _3(t){const e=t.pattern,n={};if(n.name=t.name,Mi(e)||(n.PATTERN=e),Nt(t,g3))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Nt(t,W1)&&(n.CATEGORIES=t[W1]),Ec([n]),Nt(t,H1)&&(n.LABEL=t[H1]),Nt(t,G1)&&(n.GROUP=t[G1]),Nt(t,V1)&&(n.POP_MODE=t[V1]),Nt(t,Y1)&&(n.PUSH_MODE=t[Y1]),Nt(t,Z1)&&(n.LONGER_ALT=t[Z1]),Nt(t,X1)&&(n.LINE_BREAKS=t[X1]),Nt(t,q1)&&(n.START_CHARS_HINT=t[q1]),n}const Hs=nr({name:"EOF",pattern:Qe.NA});Ec([Hs]);function Tu(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function y3(t,e){return wc(t,e)}const J1={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${K1(t)?`--> ${vc(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Pr(e).image+"'";if(r)return s+r+a;{const c=Pn(t,(d,h)=>d.concat(h),[]),l=xt(c,d=>`[${xt(d,h=>vc(h)).join(", ")}]`),f=`one of these possible Token sequences:
${xt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Pr(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${xt(t,l=>`[${xt(l,u=>vc(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(J1);const b3={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Gs={buildDuplicateFoundError(t,e){function n(u){return u instanceof Ce?u.terminalType.name:u instanceof Bn?u.nonTerminalName:""}const r=t.name,i=Pr(e),s=i.idx,o=hi(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=xt(t.prefixPath,i=>vc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=xt(t.prefixPath,i=>vc(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=hi(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=xt(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Vo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function w3(t,e){const n=new E3(t,e);return n.resolveRefs(),n.errors}class E3 extends Ks{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ct(We(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Sn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class x3 extends pu{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=dn(this.path.ruleStack).reverse(),this.occurrenceStack=dn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){ye(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class v3 extends x3{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Dn({definition:i});this.possibleTokTypes=gc(s),this.found=!0}}}class Au extends pu{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class k3 extends Au{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class Q1 extends Au{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class T3 extends Au{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class tw extends Au{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Pr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function l0(t,e,n=[]){n=dn(n);let r=[],i=0;function s(a){return a.concat(pn(t,i+1))}function o(a){const c=l0(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof Dn)return o(a.definition);if(a instanceof Bn)return o(a.definition);if(a instanceof $n)r=o(a.definition);else if(a instanceof li){const c=a.definition.concat([new Je({definition:a.definition})]);return o(c)}else if(a instanceof ui){const c=[new Dn({definition:a.definition}),new Je({definition:[new Ce({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Dr){const c=a.definition.concat([new Je({definition:[new Ce({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Je){const c=a.definition.concat([new Je({definition:a.definition})]);r=o(c)}else{if(a instanceof $r)return Ct(a.definition,c=>{ye(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ce)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:pn(t,i)}),r}function ew(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!ye(f);){const d=f.pop();if(d===o){a&&Go(f).idx<=l&&f.pop();continue}const h=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(ye(h))continue;const y=h[0];if(y===i){const k={idx:p,def:pn(h),ruleStack:mc(m),occurrenceStack:mc(b)};f.push(k)}else if(y instanceof Ce)if(p<c-1){const k=p+1,A=e[k];if(n(A,y.terminalType)){const T={idx:k,def:pn(h),ruleStack:m,occurrenceStack:b};f.push(T)}}else if(p===c-1)u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(y instanceof Bn){const k=dn(m);k.push(y.nonTerminalName);const A=dn(b);A.push(y.idx);const T={idx:p,def:y.definition.concat(s,pn(h)),ruleStack:k,occurrenceStack:A};f.push(T)}else if(y instanceof $n){const k={idx:p,def:pn(h),ruleStack:m,occurrenceStack:b};f.push(k),f.push(o);const A={idx:p,def:y.definition.concat(pn(h)),ruleStack:m,occurrenceStack:b};f.push(A)}else if(y instanceof li){const k=new Je({definition:y.definition,idx:y.idx}),A=y.definition.concat([k],pn(h)),T={idx:p,def:A,ruleStack:m,occurrenceStack:b};f.push(T)}else if(y instanceof ui){const k=new Ce({terminalType:y.separator}),A=new Je({definition:[k].concat(y.definition),idx:y.idx}),T=y.definition.concat([A],pn(h)),C={idx:p,def:T,ruleStack:m,occurrenceStack:b};f.push(C)}else if(y instanceof Dr){const k={idx:p,def:pn(h),ruleStack:m,occurrenceStack:b};f.push(k),f.push(o);const A=new Ce({terminalType:y.separator}),T=new Je({definition:[A].concat(y.definition),idx:y.idx}),C=y.definition.concat([T],pn(h)),R={idx:p,def:C,ruleStack:m,occurrenceStack:b};f.push(R)}else if(y instanceof Je){const k={idx:p,def:pn(h),ruleStack:m,occurrenceStack:b};f.push(k),f.push(o);const A=new Je({definition:y.definition,idx:y.idx}),T=y.definition.concat([A],pn(h)),C={idx:p,def:T,ruleStack:m,occurrenceStack:b};f.push(C)}else if(y instanceof $r)for(let k=y.definition.length-1;k>=0;k--){const A=y.definition[k],T={idx:p,def:A.definition.concat(pn(h)),ruleStack:m,occurrenceStack:b};f.push(T),f.push(o)}else if(y instanceof Dn)f.push({idx:p,def:y.definition.concat(pn(h)),ruleStack:m,occurrenceStack:b});else if(y instanceof Vo)f.push(A3(y,p,m,b));else throw Error("non exhaustive match")}return u}function A3(t,e,n,r){const i=dn(n);i.push(t.name);const s=dn(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var Pe;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(Pe||(Pe={}));function nw(t){if(t instanceof $n||t==="Option")return Pe.OPTION;if(t instanceof Je||t==="Repetition")return Pe.REPETITION;if(t instanceof li||t==="RepetitionMandatory")return Pe.REPETITION_MANDATORY;if(t instanceof ui||t==="RepetitionMandatoryWithSeparator")return Pe.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Dr||t==="RepetitionWithSeparator")return Pe.REPETITION_WITH_SEPARATOR;if(t instanceof $r||t==="Alternation")return Pe.ALTERNATION;throw Error("non exhaustive match")}function R3(t,e,n,r,i,s){const o=h0(t,e,n),a=ow(o)?ku:wc;return s(o,r,a,i)}function S3(t,e,n,r,i,s){const o=f0(t,e,i,n),a=ow(o)?ku:wc;return s(o[0],a,r)}function O3(t,e,n,r){const i=t.length,s=Fr(t,o=>Fr(o,a=>a.length===1));if(e)return function(o){const a=xt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],p=h.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,h[m])===!1)continue t}return c}}};if(s&&!r){const o=xt(t,c=>er(c)),a=Pn(o,(c,l,u)=>(Ct(l,f=>{Nt(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Ct(f.categoryMatches,d=>{Nt(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function I3(t,e,n){const r=Fr(t,s=>s.length===1),i=t.length;if(r&&!n){const s=er(t);if(s.length===1&&ye(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Pn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ct(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue t}return!0}return!1}}class N3 extends pu{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,Pe.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,Pe.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,Pe.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,Pe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class rw extends Ks{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,Pe.OPTION)}visitRepetition(e){this.checkIsTarget(e,Pe.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,Pe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,Pe.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,Pe.ALTERNATION)}}function iw(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function u0(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function C3(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function sw(t,e){const n=xt(t,o=>l0([o],1)),r=iw(n.length),i=xt(n,o=>{const a={};return Ct(o,c=>{const l=u0(c.partialPath);Ct(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=iw(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=u0(f);if(C3(i,h,c)||ye(d)||f.length===e){const m=r[c];if(d0(m,f)===!1){m.push(f);for(let b=0;b<h.length;b++){const y=h[b];i[c][y]=!0}}}else{const m=l0(d,o+1,f);s[c]=s[c].concat(m),Ct(m,b=>{const y=u0(b.partialPath);Ct(y,k=>{i[c][k]=!0})})}}}}return r}function h0(t,e,n,r){const i=new rw(t,Pe.ALTERNATION,r);return e.accept(i),sw(i.result,n)}function f0(t,e,n,r){const i=new rw(t,n);e.accept(i);const s=i.result,a=new N3(e,t,n).startWalking(),c=new Dn({definition:s}),l=new Dn({definition:a});return sw([c,l],r)}function d0(t,e){t:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function L3(t,e){return t.length<e.length&&Fr(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function ow(t){return Fr(t,e=>Fr(e,n=>Fr(n,r=>ye(r.categoryMatches))))}function M3(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return xt(e,n=>Object.assign({type:Sn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function U3(t,e,n,r){const i=xr(t,c=>F3(c,n)),s=V3(t,e,n),o=xr(t,c=>W3(c,n)),a=xr(t,c=>D3(c,t,r,n));return i.concat(s,o,a)}function F3(t,e){const n=new B3;t.accept(n);const r=n.allProductions,i=w1(r,P3),s=Br(i,a=>a.length>1);return xt(We(s),a=>{const c=Pr(a),l=e.buildDuplicateFoundError(t,a),u=hi(c),f={message:l,type:Sn.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=aw(c);return d&&(f.parameter=d),f})}function P3(t){return`${hi(t)}_#_${t.idx}_#_${aw(t)}`}function aw(t){return t instanceof Ce?t.terminalType.name:t instanceof Bn?t.nonTerminalName:""}class B3 extends Ks{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function D3(t,e,n,r){const i=[];if(Pn(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:Sn.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function $3(t,e,n){const r=[];let i;return Rn(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Sn.INVALID_RULE_OVERRIDE,ruleName:t})),r}function cw(t,e,n,r=[]){const i=[],s=Ru(e.definition);if(ye(s))return[];{const o=t.name;Rn(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Sn.LEFT_RECURSION,ruleName:o});const c=lu(s,r.concat([t])),l=xr(c,u=>{const f=dn(r);return f.push(u),cw(t,u,n,f)});return i.concat(l)}}function Ru(t){let e=[];if(ye(t))return e;const n=Pr(t);if(n instanceof Bn)e.push(n.referencedRule);else if(n instanceof Dn||n instanceof $n||n instanceof li||n instanceof ui||n instanceof Dr||n instanceof Je)e=e.concat(Ru(n.definition));else if(n instanceof $r)e=er(xt(n.definition,s=>Ru(s.definition)));else if(!(n instanceof Ce))throw Error("non exhaustive match");const r=du(n),i=t.length>1;if(r&&i){const s=pn(t);return e.concat(Ru(s))}else return e}class p0 extends Ks{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function j3(t,e){const n=new p0;t.accept(n);const r=n.alternations;return xr(r,s=>{const o=mc(s.definition);return xr(o,(a,c)=>{const l=ew([a],[],wc,1);return ye(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Sn.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function z3(t,e,n){const r=new p0;t.accept(r);let i=r.alternations;return i=uu(i,o=>o.ignoreAmbiguities===!0),xr(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=h0(a,t,c,o),u=G3(l,o,t,n),f=Y3(l,o,t,n);return u.concat(f)})}class K3 extends Ks{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function W3(t,e){const n=new p0;t.accept(n);const r=n.alternations;return xr(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Sn.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function H3(t,e,n){const r=[];return Ct(t,i=>{const s=new K3;i.accept(s);const o=s.allProductions;Ct(o,a=>{const c=nw(a),l=a.maxLookahead||e,u=a.idx,d=f0(u,i,c,l)[0];if(ye(er(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:Sn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function G3(t,e,n,r){const i=[],s=Pn(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Ct(c,u=>{const f=[l];Ct(t,(d,h)=>{l!==h&&d0(d,u)&&e.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!d0(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return xt(s,a=>{const c=xt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Sn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function Y3(t,e,n,r){const i=Pn(t,(o,a,c)=>{const l=xt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return pc(xr(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Er(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&L3(d.path,l));return xt(u,d=>{const h=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:h,prefixPath:d.path}),type:Sn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function V3(t,e,n){const r=[],i=xt(e,s=>s.name);return Ct(t,s=>{const o=s.name;if(Rn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Sn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function Z3(t){const e=t0(t,{errMsgProvider:b3}),n={};return Ct(t.rules,r=>{n[r.name]=r}),w3(n,e.errMsgProvider)}function X3(t){return t=t0(t,{errMsgProvider:Gs}),U3(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const lw="MismatchedTokenException",uw="NoViableAltException",hw="EarlyExitException",fw="NotAllInputParsedException",dw=[lw,uw,hw,fw];Object.freeze(dw);function Su(t){return Rn(dw,t.name)}class Ou extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class pw extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=lw}}class q3 extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=uw}}class J3 extends Ou{constructor(e,n){super(e,n),this.name=fw}}class Q3 extends Ou{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=hw}}const m0={},mw="InRuleRecoveryException";class tU extends Error{constructor(e){super(e),this.name=mw}}class eU{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Nt(e,"recoveryEnabled")?e.recoveryEnabled:Ui.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=nU)}getTokenToInsert(e){const n=Tu(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new pw(h,l,this.LA(0));p.resyncedTokens=mc(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new tU("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||ye(n))return!1;const r=this.LA(1);return Yo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Rn(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Yo(e,s=>y3(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return m0;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return xt(e,(r,i)=>i===0?m0:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=xt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return er(e)}getFollowSetFromFollowKey(e){if(e===m0)return[Hs];const n=e.ruleName+e.idxInCallingRule+R1+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Hs)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return mc(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=dn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return xt(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function nU(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=Hs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const rU=4,cs=8,gw=1<<cs,_w=2<<cs,g0=3<<cs,_0=4<<cs,y0=5<<cs,Iu=6<<cs;function b0(t,e,n){return n|e|t}class iU{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Ui.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(ye(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return xr(e,n=>cw(n,n,Gs))}validateEmptyOrAlternatives(e){return xr(e,n=>j3(n,Gs))}validateAmbiguousAlternationAlternatives(e,n){return xr(e,r=>z3(r,n,Gs))}validateSomeNonEmptyLookaheadPath(e,n){return H3(e,n,Gs)}buildLookaheadForAlternation(e){return R3(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,O3)}buildLookaheadForOptional(e){return S3(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,nw(e.prodType),I3)}}class sU{initLooksAhead(e){this.dynamicTokensEnabled=Nt(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Ui.dynamicTokensEnabled,this.maxLookahead=Nt(e,"maxLookahead")?e.maxLookahead:Ui.maxLookahead,this.lookaheadStrategy=Nt(e,"lookaheadStrategy")?e.lookaheadStrategy:new iU({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Ct(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=aU(n);Ct(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${hi(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=b0(this.fullRuleNameToShort[n.name],gw,l.idx);this.setLaFuncCache(d,f)})}),Ct(i,l=>{this.computeLookaheadFunc(n,l.idx,g0,"Repetition",l.maxLookahead,hi(l))}),Ct(s,l=>{this.computeLookaheadFunc(n,l.idx,_w,"Option",l.maxLookahead,hi(l))}),Ct(o,l=>{this.computeLookaheadFunc(n,l.idx,_0,"RepetitionMandatory",l.maxLookahead,hi(l))}),Ct(a,l=>{this.computeLookaheadFunc(n,l.idx,Iu,"RepetitionMandatoryWithSeparator",l.maxLookahead,hi(l))}),Ct(c,l=>{this.computeLookaheadFunc(n,l.idx,y0,"RepetitionWithSeparator",l.maxLookahead,hi(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=b0(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return b0(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class oU extends Ks{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Nu=new oU;function aU(t){Nu.reset(),t.accept(Nu);const e=Nu.dslMethods;return Nu.reset(),e}function yw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function bw(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function cU(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function lU(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const uU="name";function ww(t,e){Object.defineProperty(t,uU,{enumerable:!1,configurable:!0,writable:!1,value:e})}function hU(t,e){const n=br(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function fU(t,e){const n=function(){};ww(n,t+"BaseSemantics");const r={visit:function(i,s){if(ee(i)&&(i=i[0]),!Mi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=pU(this,e);if(!ye(i)){const s=xt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function dU(t,e,n){const r=function(){};ww(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ct(e,s=>{i[s]=hU}),r.prototype=i,r.prototype.constructor=r,r}var w0;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(w0||(w0={}));function pU(t,e){return mU(t,e)}function mU(t,e){const n=Er(e,i=>Ii(t[i])===!1),r=xt(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:w0.MISSING_METHOD,methodName:i}));return pc(r)}class gU{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Nt(e,"nodeLocationTracking")?e.nodeLocationTracking:Ui.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=qe,this.cstFinallyStateUpdate=qe,this.cstPostTerminal=qe,this.cstPostNonTerminal=qe,this.cstPostRule=qe;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=bw,this.setNodeLocationFromNode=bw,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=yw,this.setNodeLocationFromNode=yw,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=qe,this.setInitialNodeLocation=qe;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];cU(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];lU(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Mi(this.baseCstVisitorConstructor)){const e=fU(this.className,br(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Mi(this.baseCstVisitorWithDefaultsConstructor)){const e=dU(this.className,br(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class _U{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Mu}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Mu:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class yU{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Uu){if(Rn(this.definedRulesNames,e)){const o={message:Gs.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Sn.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Uu){const i=$3(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Su(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return w8(We(this.gastProductionsCache))}}class bU{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ku,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Nt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(ee(e)){if(ye(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(ee(e))this.tokensMap=Pn(e,(s,o)=>(s[o.name]=o,s),{});else if(Nt(e,"modes")&&Fr(er(We(e.modes)),p3)){const s=er(We(e.modes)),o=hu(s);this.tokensMap=Pn(o,(a,c)=>(a[c.name]=c,a),{})}else if(yr(e))this.tokensMap=dn(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Hs;const r=Nt(e,"modes")?er(We(e.modes)):We(e),i=Fr(r,s=>ye(s.categoryMatches));this.tokenMatcher=i?ku:wc,Ec(We(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Nt(r,"resyncEnabled")?r.resyncEnabled:Uu.resyncEnabled,s=Nt(r,"recoveryValueFunc")?r.recoveryValueFunc:Uu.recoveryValueFunc,o=this.ruleShortNameIdx<<rU+cs;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Su(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(_w,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(_0,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,Pe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,_0,e,T3)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Iu,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,tw],a,Iu,e,tw)}else throw this.raiseEarlyExitException(e,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(g0,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,g0,e,k3,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(y0,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Q1],a,y0,e,Q1)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Iu,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(gw,n),i=ee(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new J3(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Su(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new pw(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===mw?r:s}}else throw r}saveRecogState(){const e=this.errors,n=dn(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Hs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class wU{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Nt(e,"errorMessageProvider")?e.errorMessageProvider:Ui.errorMessageProvider}SAVE_ERROR(e){if(Su(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:dn(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return dn(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=f0(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new Q3(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=h0(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new q3(c,this.LA(1),a))}}class EU{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Mi(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return ew([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Pr(e.ruleStack),i=this.getGAstProductions()[n];return new v3(i,e).startWalking()}}const Cu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Cu);const Ew=!0,xw=Math.pow(2,cs)-1,vw=nr({name:"RECORDING_PHASE_TOKEN",pattern:Qe.NA});Ec([vw]);const kw=Tu(vw,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(kw);const xU={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class vU{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Mu}topLevelRuleRecord(e,n){try{const r=new Vo({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return kc.call(this,$n,e,n)}atLeastOneInternalRecord(e,n){kc.call(this,li,n,e)}atLeastOneSepFirstInternalRecord(e,n){kc.call(this,ui,n,e,Ew)}manyInternalRecord(e,n){kc.call(this,Je,n,e)}manySepFirstInternalRecord(e,n){kc.call(this,Dr,n,e,Ew)}orInternalRecord(e,n){return kU.call(this,e,n)}subruleInternalRecord(e,n,r){if(Lu(n),!e||Nt(e,"ruleName")===!1){const a=new Error(`<SUBRULE${Tw(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Go(this.recordingProdStack),s=e.ruleName,o=new Bn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?xU:Cu}consumeInternalRecord(e,n,r){if(Lu(n),!j1(e)){const o=new Error(`<CONSUME${Tw(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Go(this.recordingProdStack),s=new Ce({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),kw}}function kc(t,e,n,r=!1){Lu(n);const i=Go(this.recordingProdStack),s=Ii(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),Nt(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Cu}function kU(t,e){Lu(e);const n=Go(this.recordingProdStack),r=ee(t)===!1,i=r===!1?t:t.DEF,s=new $r({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});Nt(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=e0(i,a=>Ii(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ct(i,a=>{const c=new Dn({definition:[]});s.definition.push(c),Nt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Nt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Cu}function Tw(t){return t===0?"":`${t}`}function Lu(t){if(t<0||t>xw){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${xw+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class TU{initPerformanceTracer(e){if(Nt(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ui.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=k1(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function AU(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Mu=Tu(Hs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Mu);const Ui=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:J1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Uu=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Sn;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Sn||(Sn={}));let E0=class $x{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{T1(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ct(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=Z3({rules:We(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ye(r)&&this.skipValidations===!1){const i=X3({rules:We(this.gastProductionsCache),tokenTypes:We(this.tokensMap),errMsgProvider:Gs,grammarName:n}),s=M3({lookaheadStrategy:this.lookaheadStrategy,rules:We(this.gastProductionsCache),tokenTypes:We(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ye(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=R8(We(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:We(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(We(this.gastProductionsCache))})),!$x.DEFER_DEFINITION_ERRORS_HANDLING&&!ye(this.definitionErrors))throw e=xt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Nt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Nt(n,"skipValidations")?n.skipValidations:Ui.skipValidations}};E0.DEFER_DEFINITION_ERRORS_HANDLING=!1,AU(E0,[eU,sU,gU,_U,bU,yU,wU,EU,vU,TU]);class RU extends E0{constructor(e,n=Ui){const r=dn(n);r.outputCst=!0,super(e,r)}}function SU(t){const e=new OU,n=We(t);return xt(n,r=>e.visitRule(r))}class OU extends Ks{visitRule(e){const n=this.visitEach(e.definition),r=w1(n,s=>s.propertyName),i=xt(r,(s,o)=>{const a=!e0(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=xt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Fu(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Fu(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Fu(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Fu(e)}]}visitEachAndOverrideWith(e,n){return xt(this.visitEach(e),r=>Un({},r,n))}visitEach(e){return er(xt(e,n=>this.visit(n)))}}function Fu(t){return t instanceof Bn?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function IU(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(er(xt(t,r=>NU(r)))),e.includeVisitorInterface&&(n=n.concat(UU(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function NU(t){const e=CU(t),n=LU(t);return[e,n]}function CU(t){const e=Rw(t.name),n=x0(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function LU(t){return`export type ${x0(t.name)} = {
  ${xt(t.properties,n=>MU(n)).join(`
  `)}
};`}function MU(t){const e=PU(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function UU(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${xt(e,n=>FU(n)).join(`
  `)}
}`}function FU(t){const e=x0(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function PU(t){if(ee(t)){const e=hu(xt(t,r=>Aw(r)));return"("+Pn(e,(r,i)=>r+" | "+i)+")"}else return Aw(t)}function Aw(t){return t.kind==="token"?"IToken":Rw(t.name)}function Rw(t){return zb(t)+"CstNode"}function x0(t){return zb(t)+"CstChildren"}const BU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function DU(t,e){const n=Object.assign(Object.assign({},BU),e),r=SU(t);return IU(r,n)}const fi=!!JSON.parse("false"),$U=!!JSON.parse("false");JSON.parse("false");const jU=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Fi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Wl*Fi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Hl*Fi.DRAW_CHAR_SCALE}},Pu=py(32,126).map(t=>String.fromCharCode(t));function Gt(t){return nr({...t,name:`token_${t.name}`})}function ls(t,e=!1){return Gt(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:mn,group:Qe.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:mn})}const Tc=Gt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),zU=Gt({name:"whitespace",pattern:/ +/,group:Qe.SKIPPED}),KU=Gt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Qe.SKIPPED}),v0=Gt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Xo=Gt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Sw=!1;function WU(t,e,n){if(!Sw)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Tc)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const k0=Gt({name:"text",pattern:WU,line_breaks:!1,start_chars_hint:Pu.filter(t=>"@#/?':!".includes(t)===!1)}),Ow=Gt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Iw=Gt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Nw=Gt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Cw=Gt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),mn=Gt({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:Pu}),Lw=Gt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Mw=Gt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Uw=Gt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:mn}),Fw=Gt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:mn}),Pw=Gt({name:"islessthan",pattern:/<|below/,longer_alt:mn}),Bw=Gt({name:"isgreaterthan",pattern:/>|above/,longer_alt:mn}),Dw=Gt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:mn}),$w=Gt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:mn}),T0=Gt({name:"or",pattern:/or/i,longer_alt:mn}),A0=Gt({name:"not",pattern:/not/i,longer_alt:mn}),R0=Gt({name:"and",pattern:/and/i,longer_alt:mn}),S0=Gt({name:"plus",pattern:/\+/}),O0=Gt({name:"minus",pattern:/-/}),jw=Gt({name:"power",pattern:/\*\*/}),zw=Gt({name:"multiply",pattern:/\*/}),I0=Gt({name:"divide",pattern:/\//}),Kw=Gt({name:"moddivide",pattern:/%/}),Ww=Gt({name:"floordivide",pattern:/%%/}),Hw=Gt({name:"query",pattern:/\?/}),Gw=Gt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Yw=Gt({name:"rparen",pattern:/\)/,pop_mode:!0}),Vw=Gt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Pu,longer_alt:mn}),Zw=Gt({name:"command_toast",pattern:/toast .*/,start_chars_hint:Pu,longer_alt:mn}),N0=Gt({name:"if",pattern:/if|try|take|give/,longer_alt:mn}),Bu=ls("do"),C0=ls("done"),L0=ls("else"),Xw=ls("while"),qw=ls("repeat"),Jw=ls("waitfor"),Qw=Gt({name:"foreach",pattern:/foreach|for/,longer_alt:mn}),tE=ls("break"),eE=ls("continue");function nE(t){return[...t,Mw,Uw,Fw,Dw,Pw,$w,Bw,T0,A0,R0,S0,O0,jw,zw,I0,Ww,Kw,Hw,Gw,Yw,Lw,mn]}const rE=nE([k0,v0,Vw,Zw,Xo,Ow,Iw,Nw,Cw,Tc,zU,tE,eE,C0,Bu,L0,Qw,N0,qw,Jw,Xw]),HU=new Qe({defaultMode:"use_newlines",modes:{use_newlines:rE,ignore_newlines:nE([KU])}},{skipValidations:!fi,ensureOptimizations:fi,positionTracking:"full"});function M0(t){Sw=!0;const e=HU.tokenize(t||` 
`),[n]=(se(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Tu(Tc,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function GU(t,e,n=!0){if(n){const[r,...i]=e;switch(It(r??"")){default:return{type:vt.OBJECT,values:e};case"loader":return{type:vt.LOADER,values:i};case"board":return{type:vt.BOARD,values:i};case"object":return{type:vt.OBJECT,values:i};case"terrain":return{type:vt.TERRAIN,values:i};case"charset":return{type:vt.CHARSET,values:i};case"palette":return{type:vt.PALETTE,values:i}}}else{const[r,i,...s]=e,o=It(i??""),a=[r,t,...s];switch(o){default:return{type:vt.CONST,values:e};case"rn":case"range":return{type:vt.RANGE,values:a};case"sl":case"select":return{type:vt.SELECT,values:a};case"nm":case"number":return{type:vt.NUMBER,values:a};case"tx":case"text":return{type:vt.TEXT,values:a};case"hk":case"hotkey":return{type:vt.HOTKEY,values:a};case"copyit":return{type:vt.COPYIT,values:a};case"openit":return{type:vt.OPENIT,values:a};case"zssedit":return{type:vt.ZSSEDIT,values:a};case"charedit":return{type:vt.CHAREDIT,values:a};case"coloredit":return{type:vt.COLOREDIT,values:a}}}}function rr(t){switch(t){case vt.LOADER:return"loader";case vt.BOARD:return"board";case vt.OBJECT:return"object";case vt.TERRAIN:return"terrain";case vt.CHARSET:return"charset";case vt.PALETTE:return"palette";case vt.CONST:return"const";case vt.RANGE:return"range";case vt.SELECT:return"select";case vt.NUMBER:return"number";case vt.TEXT:return"text";case vt.HOTKEY:return"hotkey";case vt.COPYIT:return"copyit";case vt.OPENIT:return"openit";case vt.ZSSEDIT:return"zssedit";case vt.CHAREDIT:return"charedit";case vt.COLOREDIT:return"coloredit"}}var U0=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(U0||{});function iE(t){return $o(t,U0,{bits:e=>Array.from(e)})}function sE(t){return ec(t,U0,{bits:e=>new Uint8Array(e)})}function YU(t,e){return{id:Me(),code:t,...e}}var F0=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(F0||{});function VU(t){return $o(t,F0,{board:qI,object:jl,terrain:jl,charset:iE,palette:iE,stats:Ae})}function ZU(t){return ec(t,F0,{board:JI,object:zl,terrain:zl,charset:sE,palette:sE})}function Ac(t){const e={...Ys(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function XU(t){return x(t)?(t.stats=void 0,Ys(t)):{}}function oE(t){const e=M0(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===v0){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=GU(wt(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case vt.LOADER:n.type=_t.LOADER,n.name=f;break;case vt.BOARD:n.type=_t.BOARD,n.name=f;break;case vt.OBJECT:n.type=_t.OBJECT,n.name=f||"object";break;case vt.TERRAIN:n.type=_t.TERRAIN,n.name=f;break;case vt.CHARSET:n.type=_t.CHARSET,n.name=f;break;case vt.PALETTE:n.type=_t.PALETTE,n.name=f;break;case vt.CONST:{const[d,h]=u.values;if(wt(d)){const p=It(d);if(wt(h)){const m=parseFloat(h);n[p]=Rt(m)?m:h}else Rt(h)?n[p]=h:n[p]=1}break}case vt.RANGE:case vt.SELECT:case vt.NUMBER:case vt.TEXT:case vt.HOTKEY:case vt.ZSSEDIT:case vt.CHAREDIT:case vt.COLOREDIT:{const[d,...h]=u.values;if(wt(d)){const p=It(d);n[p]=[rr(u.type),...h]}break}}}}return n}function Ys(t){var e;return x(t)?(x((e=t.stats)==null?void 0:e.type)||(t.stats=oE(t.code),x(t.stats.type)||(t.stats.type=_t.OBJECT)),t.stats):{}}function aE(t){switch(t){default:case _t.ERROR:return"error";case _t.LOADER:return rr(vt.LOADER);case _t.BOARD:return rr(vt.BOARD);case _t.OBJECT:return rr(vt.OBJECT);case _t.TERRAIN:return rr(vt.TERRAIN);case _t.CHARSET:return rr(vt.CHARSET);case _t.PALETTE:return rr(vt.PALETTE)}}function Pi(t){return Ys(t).type??_t.ERROR}function Bi(t){return aE(Pi(t))}function je(t){return Ys(t).name??""}function cE(t,e){return Ys(t)[e]}const Du=new od;function P0(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!se(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"ispushable":e.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=Wt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=Wt.ISSWIM;break;case"issolid":e.collision=Wt.ISSOLID;break;case"isbullet":e.collision=Wt.ISBULLET;break;case"isdestructible":e.destructible=1;break}}}function Le(t){var e;if(x(t))switch(Pi(t)){default:return;case _t.ERROR:return t.code??"";case _t.LOADER:return t.code??"";case _t.BOARD:{x(t.board)||(t.board=xd()),t.board.id=t.id;const n=Ac(t);return t.board.isdark=n.isdark??t.board.isdark?1:0,t.board.startx=n.startx??t.board.startx,t.board.starty=n.starty??t.board.starty,t.board.over=n.over??t.board.over,t.board.under=n.under??t.board.under,t.board.camera=n.camera??t.board.camera,t.board.graphics=n.graphics??t.board.graphics,t.board.facing=n.facing??t.board.facing,t.board.exitnorth=n.exitnorth??t.board.exitnorth,t.board.exitsouth=n.exitsouth??t.board.exitsouth,t.board.exitwest=n.exitwest??t.board.exitwest,t.board.exiteast=n.exiteast??t.board.exiteast,t.board.timelimit=n.timelimit??t.board.timelimit,t.board.restartonzap=n.restartonzap??t.board.restartonzap,t.board.maxplayershots=n.maxplayershots??t.board.maxplayershots,t.board}case _t.OBJECT:return x(t.object)||(t.object=qy()),t.object.name=je(t),t.object.category=cr.ISOBJECT,P0(Ac(t),t.object),t.object;case _t.TERRAIN:return x(t.terrain)||(t.terrain=qy()),t.terrain.name=je(t),t.terrain.category=cr.ISTERRAIN,P0(Ac(t),t.terrain),t.terrain;case _t.PALETTE:{if(x(t.palette)||(t.palette=Rd(sb)),x((e=t.palette)==null?void 0:e.bits)){const n=Ac(t),r=Sr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&wt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Du.set(o);const c=a*sc,l=Du.r*63,u=Du.g*63,f=Du.b*63;t.palette.bits[c+0]=Xe(l,0,63),t.palette.bits[c+1]=Xe(u,0,63),t.palette.bits[c+2]=Xe(f,0,63)}}}}return t.palette}case _t.CHARSET:return x(t.charset)||(t.charset=ib(gN)),t.charset}}function lE(t){return{id:Me(),name:ev(),timestamp:0,activelist:[],pages:t,flags:{}}}var B0=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))(B0||{});function qU(t){return $o(t,B0,{pages:e=>e.map(VU),flags:e=>{const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function JU(t){return ec(t,B0,{pages:e=>e.map(ZU)})}function uE(t){x(t)&&(t.token=`${nv()}${pr(1111,9999)}`)}function Di(t,e){if(!x(t))return;const n=It(e);return t.pages.find(i=>i.id===e||n===je(i))}function tn(t,e,n){if(!x(t))return;const r=It(n);return t.pages.find(s=>Pi(s)===e&&(s.id===n||r===je(s)))}function D0(t,e,n){let r=tn(t,e,n);if(!x(r)){const i=aE(e);r=YU(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),fE(t,r)}return r}function Vs(t,e){return x(t)?t.pages.filter(n=>Pi(n)===e):[]}function jn(t,e,n){if(!x(t))return[];const r=It(n);return t.pages.filter(s=>Pi(s)===e).filter(s=>{const o=Ys(s),a=It(je(s));return s.id===n||r===a||x(o[n])})}function $u(t){return x(t)?Yn(t.pages).sort((n,r)=>{const i=Pi(n),s=Pi(r);return i===s?je(n).localeCompare(je(r)):s-i}):[]}function hE(t,e){if(x(e)){const n=tn(t,_t.TERRAIN,e.kind??"");if(x(n))return n;const r=tn(t,_t.OBJECT,e.kind??"");if(x(r))return r}}function fE(t,e){if(!x(t)||!x(e))return!1;const n=Di(t,e.id);return x(n)?!1:(t.pages.push(e),uE(t),!0)}function dE(t,e){const n=Di(t,e);if(x(t)&&x(n)){const r=It(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==je(i)),uE(t),n}}function jr(t,e){if(x(e)&&x(e.kind))return x(e.kinddata)||(e.kinddata=x(e.id)?qo(t,e.kind):zu(t,e.kind)),e.kinddata}function bn(t,e,n){const r=jr(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function us(t,e){let n=Me();const r=bn(t,e,"group");wt(r)&&(n=r);const i=bn(t,e==null?void 0:e.kinddata,"group");return wt(i)&&(n=i),n}function ju(t,e,n,r,i){const s=jr(t,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??n,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function qo(t,e){const n=e??"",r=tn(t,_t.OBJECT,n);if(x(r)){const i=Le(r);return{...Yn(i),name:n,code:r.code}}}function zu(t,e){const n=e??"",r=tn(t,_t.TERRAIN,n);if(x(r)){const i=Le(r);return{...Yn(i),name:n,code:r.code}}}function hs(t,e){const n=Di(t,e);return Le(n)}function QU(t,e){return!!(t!=null&&t.flags[e])}function $i(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function pE(t,e){t&&delete t.flags[e]}function mE(t,e,n){const r=$i(t,e);return r==null?void 0:r[n]}function tF(t,e,n,r){const i=$i(t,e);return i&&(i[n]=r),r}function Zs(t,e){const n=mE(t,e,"board");return hs(t,wt(n)?n:"")}function eF(t,e){return(t==null?void 0:t.activelist.includes(e))??!1}function Ku(t,e,n){if(!x(t))return;tF(t,e,"board",n);const r=hs(t,n);x(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function Jo(t,e,n,r){if(!x(t))return;const i=Zs(t,e);if(!x(i))return;const s=Tn(i,e);if(!yn(s)||!(s!=null&&s.id))return;const o=hs(t,n);if(!x(o)||(He(t,o),K0(t,o,Wt.ISWALK,r)))return;delete i.objects[s.id];const a=Mr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Mr(o,s);o.lookup&&(o.lookup[c]=s.id),Ku(t,e,o.id)}function nF(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=mE(t,r,"board");return wt(i)?i:""});return yI(n)}function $0(t){const e=nF(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=hs(t,e[i]);if(x(s)&&!n.has(s.id)){if(wt(s.over))if(wt(s.overboard)){const o=hs(t,s.overboard);x(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=jn(t,_t.BOARD,s.over);if(o.length){const a=Te(o),c=Le(a);x(c)&&(s.overboard=c.id)}}else wt(s.overboard)&&delete s.overboard;if(r.push(s),wt(s.under))if(wt(s.underboard)){const o=hs(t,s.underboard);x(o)||delete s.underboard}else{const o=jn(t,_t.BOARD,s.under);if(o.length){const a=Te(o),c=Le(a);x(c)&&(s.underboard=c.id)}}else wt(s.underboard)&&delete s.underboard}}return r}function rF(t,e,n,r,i){if(!x(e))return;x(e.distmaps)||(e.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=e.distmaps[s];if(!x(o)){o=new Array(Ed).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(x(l)&&Kl(l)){const u=Lo(l,Ot);if(o[u]===-2){const f=jo(e,l.x,l.y);zo(n,bn(t,f,"collision")??Wt.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}e.distmaps[s]=o}return o}function gE(t,e){return Kl(t)?e[Lo(t,Ot)]:-1}function _E(t,e,n,r,i,s){if(!x(t)||!x(e))return;const o=rF(t,e,n,r,i);if(!x(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const f=gE(a[u],o);f>=0&&f>l&&(l=f,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const f=gE(a[u],o);f>=0&&f<l&&(l=f,c=a[u])}}return c}function He(t,e){var a;if(!x(t)||!x(e)||x(e.lookup)&&x(e.named))return;const n=new Array(Ot*Jt).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(x(l.x)&&x(l.y)&&x(l.id)&&!x(l.removed)){l.category=cr.ISOBJECT,n[l.x+l.y*Ot]=l.id;const u=It(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(x(l)){l.x=s,l.y=o,l.category=cr.ISTERRAIN;const u=is(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=Ot&&(s=0,++o)}e.lookup=n,e.named=r}function Wu(t,e){x(e)&&(delete e.named,delete e.lookup,He(t,e))}function yE(t,e,n,r){var s;if(!x(t)||!x(e)||!x(e.named)||!x(n))return;const i=It(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function iF(t,e,n){if(!(!x(t)||!x(e)||!x(e.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*Ot]=n.id}}function sF(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.x)&&x(n.y)){const i=is(n),s=Mr(e,n);x((r=e.named)==null?void 0:r[i])&&e.named[i].delete(s)}}function j0(t,e,n){var r;if(x(t)&&x(e)&&x(n==null?void 0:n.id)){if(x(e.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*Ot;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=is(n);x((r=e.named)==null?void 0:r[i])&&x(n.id)&&e.named[i].delete(n.id)}}function z0(t,e,n,r,i,s){const o=pt.MID;if(!x(t)||!x(e)||!x(n))return{dir:i,startpt:s,destpt:s,layer:o};const a={x:n.x??0,y:n.y??0},c={x:n.lx??a.x,y:n.ly??a.y},l=Ri(c,a),u=Ot-1,f=Jt-1;for(let d=0;d<i.length;++d){const h=wI(i[d]);switch(h){case pt.IDLE:break;case pt.NORTH:case pt.SOUTH:case pt.WEST:case pt.EAST:Ke(a,h);break;case pt.BY:{const[p,m]=i.slice(d+1);Rt(p)&&Rt(m)&&(a.x=Xe(a.x+p,0,u),a.y=Xe(a.y+m,0,f)),d+=2;break}case pt.TO:case pt.AT:{const[p,m]=i.slice(d+1);Rt(p)&&Rt(m)&&(a.x=Xe(p,0,u),a.y=Xe(m,0,f)),d+=2;break}case pt.FLOW:Ke(a,l);break;case pt.SEEK:{const p=nN(e,n,r);Po(p)&&Ke(a,Ri(s,p));break}case pt.RNDNS:Ke(a,Te(pt.NORTH,pt.SOUTH));break;case pt.RNDNE:Ke(a,Te(pt.NORTH,pt.EAST));break;case pt.RND:Ke(a,Te(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));break;case pt.CW:case pt.CCW:case pt.OPP:case pt.RNDP:{const p=z0(t,e,n,r,i.slice(d+1),s);switch(a.x=s.x,a.y=s.y,h){case pt.CW:switch(Ri(s,p.destpt)){case pt.NORTH:Ke(a,pt.EAST);break;case pt.SOUTH:Ke(a,pt.WEST);break;case pt.EAST:Ke(a,pt.SOUTH);break;case pt.WEST:Ke(a,pt.NORTH);break}break;case pt.CCW:switch(Ri(s,p.destpt)){case pt.NORTH:Ke(a,pt.WEST);break;case pt.SOUTH:Ke(a,pt.EAST);break;case pt.EAST:Ke(a,pt.NORTH);break;case pt.WEST:Ke(a,pt.SOUTH);break}break;case pt.OPP:switch(Ri(s,p.destpt)){case pt.NORTH:Ke(a,pt.SOUTH);break;case pt.SOUTH:Ke(a,pt.NORTH);break;case pt.EAST:Ke(a,pt.WEST);break;case pt.WEST:Ke(a,pt.EAST);break}break;case pt.RNDP:switch(Ri(s,p.destpt)){case pt.NORTH:case pt.SOUTH:a.x+=Te(-1,1);break;case pt.WEST:case pt.EAST:a.y+=Te(-1,1);break}break}break}case pt.FLEE:case pt.AWAY:{const[p,m]=i.slice(d+1);if(Rt(p)&&Rt(m)){const b={x:Xe(p,0,u),y:Xe(m,0,f)},y=bn(t,n,"collision"),k=_E(t,e,y,a,b,!0);x(k)&&(a.x=k.x,a.y=k.y)}d+=2;break}case pt.FIND:case pt.TOWARD:{const[p,m]=i.slice(d+1);if(Rt(p)&&Rt(m)){const b={x:Xe(p,0,u),y:Xe(m,0,f)};if(pr(1,100)<5)Ke(a,Te(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));else{const y=bn(t,n,"collision"),k=_E(t,e,y,a,b,!1);if(x(k))if(k.x!==p&&k.y!==m&&eN(e,k))switch(Ri(s,k)){case pt.EAST:case pt.WEST:a.y+=Te(-1,1);break;case pt.NORTH:case pt.SOUTH:a.x+=Te(-1,1);break}else a.x=k.x,a.y=k.y}}d+=2;break}case pt.PLAYER:{const p=rc(e,s,r);Po(p)&&(a.x=p.x,a.y=p.y);break}case pt.OVER:case pt.UNDER:{const p=z0(t,e,n,r,i.slice(d+1),s);return p.layer=h,p}}}return{dir:i,startpt:s,destpt:a,layer:o}}function oF(t,e,n,r){if(x(t)&&x(e)&&x(n)){const[i,s]=n,o=qo(t,i);if(x(o)&&x(o.name)){const a=Td(e,r,i);return nc(a,s),a}}}function Xs(t,e,n,r,i){if(x(t)&&x(e)&&x(n)){const[s,o]=n,a=zu(t,s);if(x(a)){const l=tN(e,r,s);if(x(l)){nc(l,o);const u=Lo(r,Ot);return jr(t,l),yE(t,e,l,u),l}}const c=qo(t,s);if(x(c)&&x(c.name)){const l=Td(e,r,s,i);if(x(l))return nc(l,o),iF(t,e,l),jr(t,l),yE(t,e,l),l}}}function ir(t,e,n,r){return!x(n)||is(n)==="player"?!1:(n.id?(n.removed=r,j0(t,e,n)):(ln(e,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),sF(t,e,n)),!0)}function K0(t,e,n,r){if(!x(t)||!x(e)||!x(e.lookup)||r.x<0||r.x>=Ot||r.y<0||r.y>=Jt)return!0;const i=r.x+r.y*Ot,s=Tn(e,e.lookup[i]??"404");if(x(s))return!0;const o=e.terrain[i];if(x(o)){const a=jr(t,o),c=o.collision??(a==null?void 0:a.collision);return zo(n,c)}return!1}function aF(t,e,n,r){const i=Tn(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=bn(t,i,"collision");return K0(t,e,a,r)}function W0(t,e,n,r){var d;const i=Tn(e,(n==null?void 0:n.id)??"");if(!x(t)||!x(e)||!x(i)||!x(i.x)||!x(i.y)||!x(e.lookup)||!x(n)||r.x<0||r.x>=Ot||r.y<0||r.y>=Jt)return{name:"edge",kind:"edge",collision:Wt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Mr(e,i),o=Mr(e,r),a=bn(t,i,"collision")??Wt.ISWALK,c=Rr(i==null?void 0:i.id),l=Tn(e,e.lookup[o]??""),u=Rr((l==null?void 0:l.id)??"");if(x(l)&&(!c||!u)&&us(t,n)!==us(t,l)){if(!!bn(t,l,"pushable")){const p={x:r.x-(n.x??0),y:r.y-(n.y??0)};W0(t,e,l,p)}return{...l}}const f=e.terrain[o];if(x(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??Wt.ISWALK;if(zo(a,h))return{...f,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function cF(t,e,n){const r=[];if(!x(t)||!x(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>rl*5&&(r.push(o.id),Jy(e,o.id))}return r}function lF(t,e,n){const r=[];if(!x(t)||!x(e))return r;e.lookup=void 0,He(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!x(a.id))continue;a.lx=a.x,a.ly=a.y;const c=jr(t,a),l=`${(c==null?void 0:c.code)??""}
${a.code??""}`;l&&r.push({id:a.id,type:_t.OBJECT,code:l,object:a,terrain:void 0})}const s=cF(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:_t.ERROR,code:"",object:void 0,terrain:void 0});return r}function uF(t,e,n){const r=[],i=[];if(!x(t)||!x(e))return{objectelements:r,terrainelements:i};function s(a){const c=bn(t,a,n),l=us(t,a);return x(c)||l===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c)&&r.push(c)}for(let a=0;a<Ed;++a){const c=e.terrain[a];x(c)&&s(c)&&i.push(c)}return{objectelements:r,terrainelements:i}}var bE={exports:{}},H0={exports:{}},wE;function hF(){return wE||(wE=1,function(t,e){(function(n,r){t.exports=r()})(Nn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(m){if(m)for(var b=0;b<u.length;b++)m[u[b]]!==void 0&&this["set"+r(u[b])](m[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof f)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new f(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",y=this.getColumnNumber()||"",k=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+y+")":"[eval]:"+b+":"+y:k?k+" ("+m+":"+b+":"+y+")":m+":"+b+":"+y}},f.fromString=function(b){var y=b.indexOf("("),k=b.lastIndexOf(")"),A=b.substring(0,y),T=b.substring(y+1,k).split(","),C=b.substring(k+1);if(C.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),S=R[1],U=R[2],N=R[3];return new f({functionName:A,args:T||void 0,fileName:S,lineNumber:U||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[h]);for(var p=0;p<a.length;p++)f.prototype["get"+r(a[p])]=i(a[p]),f.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return f})}(H0)),H0.exports}(function(t,e){(function(n,r){t.exports=r(hF())})(Nn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),p=d&&f||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(bE);var fF=bE.exports,dF=no(fF);function ji(t){const e={},n={tick(){},everytick(){},listcommands(){return Sr(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function be(t){return`${t??""}`}function Rc(t,e){const n=parseFloat(be(t));return isNaN(n)?e:n}function EE(t,e,n){var i;const[r]=rt(e,0,[$.MAYBE_NAME]);WA(nt,t,((i=w.board)==null?void 0:i.id)??"",r??"",n)}function vr(t,e,n,r){const[i,s]=rt(r,0,[$.NUMBER_OR_STRING,$.MAYBE_NUMBER_OR_STRING]);og(nt,t,e,n,i,s)}const pF=["echo","reverb","phaser","distortion","vibrato","fc"];function xE(t,e,n){const[r,i]=rt(n,0,[$.NUMBER_OR_STRING]);if(Rt(r))sf(nt,t,e,"volume",r);else if(pF.includes(It(r))){const[s,o]=rt(n,i,[$.NUMBER_OR_STRING,$.MAYBE_NUMBER_OR_STRING]);og(nt,t,e,r,s,o)}else{const[s]=rt(n,i,[$.MAYBE_NUMBER_OR_STRING]);if(Rt(s)){const o=n.length-i,a=new Array(o).fill($.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;sf(nt,t,e,r,l)}else{const[o]=rt(n,i,[$.MAYBE_NUMBER_OR_STRING]);sf(nt,t,e,r,o)}}}const G0=ji().command("talk",(t,e)=>{const[n]=rt(e,0,[$.ANY]);switch(It(n)){default:AA(nt,w.elementfocus);break;case"stop":RA(nt,w.elementfocus);break}return 0}).command("media",(t,e)=>{const[n]=rt(e,0,[$.ANY]);switch(It(n)){default:SA(nt,w.elementfocus);break;case"stop":OA(nt,w.elementfocus);break}return 0}).command("tts",(t,e)=>{const[n,r]=rt(e,0,[$.STRING]),i=e.slice(r).map(be).join("");return zA(nt,w.elementfocus,n,i),0}).command("tta",(t,e)=>{const n=e.map(be).join("");return KA(nt,w.elementfocus,n),0}).command("bpm",(t,e)=>{const[n]=rt(e,0,[$.NUMBER]);return GA(nt,w.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=rt(e,0,[$.NUMBER]);return YA(nt,w.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=rt(e,0,[$.NUMBER]);return VA(nt,w.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=rt(e,0,[$.NUMBER]);return ZA(nt,w.elementfocus,n),0}).command("play",(t,e)=>(EE(w.elementfocus,e,!1),0)).command("bgplay",(t,e)=>(EE(w.elementfocus,e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)xE(w.elementfocus,n,e);return 0}).command("echo",(t,e)=>{for(let n=0;n<3;++n)vr(w.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<3;++n)vr(w.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<3;++n)vr(w.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<3;++n)vr(w.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<3;++n)vr(w.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<3;++n)vr(w.elementfocus,n,"vibrato",e);return 0});for(let t=0;t<8;++t)G0.command(`synth${t+1}`,(e,n)=>(xE(w.elementfocus,t,n),0));for(let t=0;t<3;++t){const e=t+1;G0.command(`echo${e}`,(n,r)=>(vr(w.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(vr(w.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(vr(w.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(vr(w.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(vr(w.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(vr(w.elementfocus,t,"vibrato",r),0))}const mF=py(32,126).map(t=>String.fromCharCode(t)),gF=nr({name:"Whitespace",pattern:/ +/}),_F=nr({name:"WhitespaceSkipped",pattern:/ +/,group:Qe.SKIPPED}),Y0=nr({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),vE=nr({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:mF}),V0=nr({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Z0=nr({name:"EscapedDollar",pattern:"$$"}),X0=nr({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),q0=nr({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),kE=nr({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function yF(t,e=""){return nr({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const TE=Object.keys(qa).map(t=>yF(`\\$(${t})`,t)),bF=[gF,Y0,...TE,V0,vE,q0,Z0,kE,X0],wF=new Qe(bF,{skipValidations:!fi,ensureOptimizations:fi}),EF=new Qe([_F,Y0,...TE,V0,vE,q0,Z0,kE,X0],{skipValidations:!fi,ensureOptimizations:fi});function J0(t,e=!1){return e?EF.tokenize(t):wF.tokenize(t)}function Q0(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function AE(t){t.active={...t.reset}}function RE(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Z0:s("$");break;case q0:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case V0:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Y0:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=qa[l],f=xI(St[u]),d=vI(St[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):x(f)?e.active.color=f:x(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(x(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){AE(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;vF(u,u+l.length,e.active.color,e.active.bg,e),xF(u,l,e)}}}function SE(t,e,n){const r=J0(t);r.tokens&&(RE(r.tokens,e),n&&AE(e),e.changed())}function OE(t,e,n){const r=J0(t);if(!r.tokens)return;const i=Q0(e,n,St.WHITE,St.BLACK);return i.measureonly=!0,RE(r.tokens,i),i.x>0&&++i.y,i}function xF(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function vF(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function IE(t,e,n){if(!Po(w.element))return 0;const[r,i]=rt(e,0,[$.DIR,$.MAYBE_KIND]),s=i??["bullet"],o=oF(w.book,w.board,s,{x:w.element.x,y:w.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=w.elementid,o.collision=Wt.ISBULLET,o.destructible=1,o.stepx=r.destpt.x-w.element.x,o.stepy=r.destpt.y-w.element.y,o.bg=St.ONCLEAR;const a=jr(w.book,o),c=o.code??(a==null?void 0:a.code)??"";kx(w.book,w.board,o,c,1)}return t.yield(),0}function Hu(t,e,n,r){var f,d;if(!Po(w.element)||!x(w.book)||!x(w.board)||!x(w.element))return 0;He(w.book,w.board);const[i,s]=rt(e,0,[$.DIR,$.KIND]),o=ge(w.board,i.destpt);if((o==null?void 0:o.category)===cr.ISOBJECT&&(o!=null&&o.pushable)){const h={x:((f=w.element)==null?void 0:f.x)??0,y:((d=w.element)==null?void 0:d.y)??0},p=Ke(i.destpt,Ri(h,i.destpt));W0(w.book,w.board,o,p)}const[a]=s,c=qo(w.book,a)??zu(w.book,a),l=(c==null?void 0:c.collision)??Wt.ISWALK;if(!K0(w.book,w.board,l,i.destpt)){const h=Xs(w.book,w.board,s,i.destpt,n);x(h)&&x(r)&&(h.arg=r)}return 0}const kF=ji().command("board",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=rt(e,0,[$.NAME]),[i,s]=rt(e,r,[$.MAYBE_NUMBER,$.MAYBE_NUMBER]),o=jn(w.book,_t.BOARD,n);if(o.length){const a=Te(...o);x(a)&&Jo(w.book,w.elementfocus,a.id,{x:i??Math.round(Ot*.5),y:s??Math.round(Jt*.5)})}return 0}).command("edge",(t,e)=>{var s,o;if(!x(w.book)||!x(w.board)||!x(w.element))return 0;const[n,r]=rt(e,0,[$.DIR,$.NAME]),i=jn(w.book,_t.BOARD,r);if(i.length){const a={x:((s=w.element)==null?void 0:s.x)??0,y:((o=w.element)==null?void 0:o.y)??0},c=Ri(a,n.destpt),l=Te(...i);switch(c){case pt.NORTH:w.board.exitnorth=l.id;break;case pt.SOUTH:w.board.exitsouth=l.id;break;case pt.WEST:w.board.exitwest=l.id;break;case pt.EAST:w.board.exiteast=l.id;break}}return 0}).command("shove",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;He(w.book,w.board);const[n,r]=rt(e,0,[$.DIR,$.DIR]),i=ge(w.board,n.destpt);return yn(i)&&ca(w.book,w.board,i,r.destpt),0}).command("duplicate",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;He(w.book,w.board);const[n,r]=rt(e,0,[$.DIR,$.DIR]),i=ge(w.board,n.destpt);return yn(i),0}).command("write",(t,e)=>{var l;if(!x(w.book)||!x(w.board))return 0;He(w.book,w.board);const[n,r,i]=rt(e,0,[$.DIR,$.COLOR,$.STRING]),{color:s,bg:o}=xy(r),a=((l=OE(i,256,1))==null?void 0:l.measuredwidth)??1,c=Q0(256,1,s??St.WHITE,o??St.BLACK);SE(i,c,!1);for(let u=0;u<a;++u)ln(w.board,{x:n.destpt.x+u,y:n.destpt.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;He(w.book,w.board);const[n,r]=rt(e,0,[$.KIND,$.KIND]);(fd(n)??"")==="empty"&&rN(w.board).forEach(c=>{Xs(w.book,w.board,r,c)});const s=fd(r),o=ky(r),a=Ty(r);return Qy(w.board,n).forEach(c=>{if(is(c)===s)x(o)&&(c.color=o),x(a)&&(c.bg=a);else if(ir(w.book,w.board,c,w.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};Xs(w.book,w.board,r,l)}}),0}).command("put",(t,e)=>Hu(t,e)).command("putwith",(t,e)=>{const[n,r]=rt(e,0,[$.ANY]);return Hu(t,e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=rt(e,0,[$.ANY]);return x(w.board)&&Tn(w.board,n)?0:Hu(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=rt(e,0,[$.ANY,$.ANY]);return x(w.board)&&Tn(w.board,r)?0:Hu(t,e.slice(i),r,n)}).command("shoot",IE).command("shootwith",(t,e)=>{const[n,r]=rt(e,0,[$.ANY]);return IE(t,e.slice(r),n)}),fs="$dkpurple",TF="$196",AF="$205";function Re(t,e,n){bA(t,e,n)}function RF(t,e,n){const r=TF.repeat(n);Re(t,e,`${fs}${r}`)}function tp(t,e,n){const r=AF.repeat(n);Re(t,e,`${fs}${r}`)}function Gu(t,e,n){Re(t,e,`${fs} ${" ".repeat(n.length)} `),RF(t,e,n.length+2),Re(t,e,`${fs} $white${n} `),tp(t,e,n.length+2)}function qs(t,e,n){Re(t,e,`${fs} ${" ".repeat(n.length)} `),Re(t,e,`${fs} $gray${n} `),tp(t,e,n.length+2)}function Sc(t,e,n,r){Re(t,e,`${fs} $white${n} $blue${r}`)}function zn(t,e,n){Re(t,e,`${fs}$blue${n}`)}function SF(t,e,n,r){Re(t,e,`!${n};${r}`)}function NE(t){const[e,n]=t.split(":"),r=x(n);return[r?e:"self",r?n:t]}var OF=`desc;$DKGRAYname and type of codepage
`,IF=Object.freeze({__proto__:null,default:OF}),NF="desc;changes object into specified element",CF=Object.freeze({__proto__:null,default:NF}),LF="desc;like #play but for sound effects",MF=Object.freeze({__proto__:null,default:LF}),UF="",FF=Object.freeze({__proto__:null,default:UF}),PF="",BF=Object.freeze({__proto__:null,default:PF}),DF="",$F=Object.freeze({__proto__:null,default:DF}),jF="",zF=Object.freeze({__proto__:null,default:jF}),KF="",WF=Object.freeze({__proto__:null,default:KF}),HF="",GF=Object.freeze({__proto__:null,default:HF}),YF="",VF=Object.freeze({__proto__:null,default:YF}),ZF="",XF=Object.freeze({__proto__:null,default:ZF}),qF="",JF=Object.freeze({__proto__:null,default:qF}),QF="",tP=Object.freeze({__proto__:null,default:QF}),eP="",nP=Object.freeze({__proto__:null,default:eP}),rP="",iP=Object.freeze({__proto__:null,default:rP}),sP="",oP=Object.freeze({__proto__:null,default:sP}),aP="",cP=Object.freeze({__proto__:null,default:aP}),lP="",uP=Object.freeze({__proto__:null,default:lP}),hP=`desc;$DKGRAYstarts a section of an if-do-done block
`,fP=Object.freeze({__proto__:null,default:hP}),dP=`desc;$DKGRAYcompletes an if-do-done block
`,pP=Object.freeze({__proto__:null,default:dP}),mP="",gP=Object.freeze({__proto__:null,default:mP}),_P="",yP=Object.freeze({__proto__:null,default:_P}),bP="",wP=Object.freeze({__proto__:null,default:bP}),EP=`desc;$DKGRAYelse logic in an if-do-done block
`,xP=Object.freeze({__proto__:null,default:EP}),vP=`desc;$DKGRAYconditional else logic in an if-do-done block
`,kP=Object.freeze({__proto__:null,default:vP}),TP="",AP=Object.freeze({__proto__:null,default:TP}),RP="",SP=Object.freeze({__proto__:null,default:RP}),OP="",IP=Object.freeze({__proto__:null,default:OP}),NP="",CP=Object.freeze({__proto__:null,default:NP}),LP="",MP=Object.freeze({__proto__:null,default:LP}),UP="",FP=Object.freeze({__proto__:null,default:UP}),PP="",BP=Object.freeze({__proto__:null,default:PP}),DP="",$P=Object.freeze({__proto__:null,default:DP}),jP=`desc;$DKGRAYhalt until the next cycle
`,zP=Object.freeze({__proto__:null,default:jP}),KP=`desc;$DKGRAYevals condition for true or false
`,WP=Object.freeze({__proto__:null,default:KP}),HP="",GP=Object.freeze({__proto__:null,default:HP}),YP="",VP=Object.freeze({__proto__:null,default:YP}),ZP="",XP=Object.freeze({__proto__:null,default:ZP}),qP="",JP=Object.freeze({__proto__:null,default:qP}),QP="",tB=Object.freeze({__proto__:null,default:QP}),eB="",nB=Object.freeze({__proto__:null,default:eB}),rB="",iB=Object.freeze({__proto__:null,default:rB}),sB="",oB=Object.freeze({__proto__:null,default:sB}),aB="",cB=Object.freeze({__proto__:null,default:aB}),lB="",uB=Object.freeze({__proto__:null,default:lB}),hB="",fB=Object.freeze({__proto__:null,default:hB}),dB="",pB=Object.freeze({__proto__:null,default:dB}),mB="",gB=Object.freeze({__proto__:null,default:mB}),_B="",yB=Object.freeze({__proto__:null,default:_B}),bB="",wB=Object.freeze({__proto__:null,default:bB}),EB="",xB=Object.freeze({__proto__:null,default:EB}),vB="",kB=Object.freeze({__proto__:null,default:vB}),TB="",AB=Object.freeze({__proto__:null,default:TB}),RB="",SB=Object.freeze({__proto__:null,default:RB}),OB="",IB=Object.freeze({__proto__:null,default:OB}),NB="",CB=Object.freeze({__proto__:null,default:NB}),LB=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,MB=Object.freeze({__proto__:null,default:LB}),UB="",FB=Object.freeze({__proto__:null,default:UB}),PB="",BB=Object.freeze({__proto__:null,default:PB}),DB="",$B=Object.freeze({__proto__:null,default:DB}),jB="",zB=Object.freeze({__proto__:null,default:jB}),KB="",WB=Object.freeze({__proto__:null,default:KB}),HB="",GB=Object.freeze({__proto__:null,default:HB}),YB="",VB=Object.freeze({__proto__:null,default:YB}),ZB="",XB=Object.freeze({__proto__:null,default:ZB}),qB="",JB=Object.freeze({__proto__:null,default:qB}),QB="",tD=Object.freeze({__proto__:null,default:QB}),eD="",nD=Object.freeze({__proto__:null,default:eD}),rD="",iD=Object.freeze({__proto__:null,default:rD}),sD="",oD=Object.freeze({__proto__:null,default:sD}),aD="",cD=Object.freeze({__proto__:null,default:aD}),lD="",uD=Object.freeze({__proto__:null,default:lD}),hD="",fD=Object.freeze({__proto__:null,default:hD}),dD="",pD=Object.freeze({__proto__:null,default:dD}),mD="",gD=Object.freeze({__proto__:null,default:mD}),_D="",yD=Object.freeze({__proto__:null,default:_D}),bD=`desc;$DKGRAYdesignates an inactive label or comment
`,wD=Object.freeze({__proto__:null,default:bD}),ED=`desc;$DKGRAYadds hyperlink text

`,xD=Object.freeze({__proto__:null,default:ED}),vD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,kD=Object.freeze({__proto__:null,default:vD}),TD=`desc;$DKGRAYread number input into given stat/flag
`,AD=Object.freeze({__proto__:null,default:TD}),RD=`desc;$DKGRAYa slider input from 1 to 9 

`,SD=Object.freeze({__proto__:null,default:RD}),OD=`desc;$DKGRAYlist with label value pairs to pick from
`,ID=Object.freeze({__proto__:null,default:OD}),ND=`desc;$DKGRAYread text input into given stat/flag
`,CD=Object.freeze({__proto__:null,default:ND}),LD=`desc;$DKGRAYdesignates a starting point for running code
`,MD=Object.freeze({__proto__:null,default:LD}),UD=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,FD=Object.freeze({__proto__:null,default:UD}),PD=`desc;$DKGRAYwill move the object in the given direction
`,BD=Object.freeze({__proto__:null,default:PD}),DD=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,$D=Object.freeze({__proto__:null,default:DD}),jD=`desc;$DKGRAYcustom 8x14 charset
`,zD=Object.freeze({__proto__:null,default:jD}),KD=`desc;$DKGRAYsets stat to given value

`,WD=Object.freeze({__proto__:null,default:KD}),HD=`desc;$DKGRAYsends the given message when hotkey is pressed

`,GD=Object.freeze({__proto__:null,default:HD}),YD=`desc;$DKGRAYread external content and/or handle events
`,VD=Object.freeze({__proto__:null,default:YD}),ZD=`desc;$DKGRAYread number input into given stat/flag
`,XD=Object.freeze({__proto__:null,default:ZD}),qD=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,JD=Object.freeze({__proto__:null,default:qD}),QD=`desc;$DKGRAYcustom palette colors
`,t$=Object.freeze({__proto__:null,default:QD}),e$=`desc;$DKGRAYa slider input from 1 to 9 

`,n$=Object.freeze({__proto__:null,default:e$}),r$=`desc;$DKGRAYlist with label value pairs to pick from
`,i$=Object.freeze({__proto__:null,default:r$}),s$=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,o$=Object.freeze({__proto__:null,default:s$}),a$=`desc;$DKGRAYread text input into given stat/flag
`,c$=Object.freeze({__proto__:null,default:a$}),l$=`desc;$DKGRAYadds text
`,u$=Object.freeze({__proto__:null,default:l$}),h$=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,f$=Object.freeze({__proto__:null,default:h$}),d$=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,p$=Object.freeze({__proto__:null,default:d$}),m$=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,g$=Object.freeze({__proto__:null,default:m$}),_$=`header;player settings
#set user "name goes here"
`,y$=Object.freeze({__proto__:null,default:_$}),b$=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,w$=Object.freeze({__proto__:null,default:b$});const CE=Object.assign({"./editor/codepagename.txt":IF,"./editor/command/become.txt":CF,"./editor/command/bgplay.txt":MF,"./editor/command/bgvol.txt":FF,"./editor/command/bind.txt":BF,"./editor/command/board.txt":$F,"./editor/command/bpm.txt":zF,"./editor/command/break.txt":WF,"./editor/command/change.txt":GF,"./editor/command/char.txt":VF,"./editor/command/charset.txt":XF,"./editor/command/clear.txt":JF,"./editor/command/color.txt":tP,"./editor/command/continue.txt":nP,"./editor/command/copy.txt":iP,"./editor/command/cycle.txt":oP,"./editor/command/die.txt":cP,"./editor/command/distort.txt":uP,"./editor/command/do.txt":fP,"./editor/command/done.txt":pP,"./editor/command/duplicate.txt":gP,"./editor/command/echo.txt":yP,"./editor/command/edge.txt":wP,"./editor/command/else.txt":xP,"./editor/command/elseif.txt":kP,"./editor/command/end.txt":AP,"./editor/command/endgame.txt":SP,"./editor/command/endwith.txt":IP,"./editor/command/fcrush.txt":CP,"./editor/command/fetch.txt":MP,"./editor/command/fetchwith.txt":FP,"./editor/command/foreach.txt":BP,"./editor/command/go.txt":$P,"./editor/command/idle.txt":zP,"./editor/command/if.txt":WP,"./editor/command/lock.txt":GP,"./editor/command/oneof.txt":VP,"./editor/command/oneofwith.txt":XP,"./editor/command/palette.txt":JP,"./editor/command/phaser.txt":tB,"./editor/command/pivot.txt":nB,"./editor/command/play.txt":iB,"./editor/command/put.txt":oB,"./editor/command/putwith.txt":cB,"./editor/command/readbin.txt":uB,"./editor/command/readjson.txt":fB,"./editor/command/readline.txt":pB,"./editor/command/readrexpaint.txt":gB,"./editor/command/remix.txt":yB,"./editor/command/repeat.txt":wB,"./editor/command/restore.txt":xB,"./editor/command/reverb.txt":kB,"./editor/command/revert.txt":AB,"./editor/command/run.txt":SB,"./editor/command/runwith.txt":IB,"./editor/command/set.txt":CB,"./editor/command/shoot.txt":MB,"./editor/command/shootwith.txt":FB,"./editor/command/shove.txt":BB,"./editor/command/snapshot.txt":$B,"./editor/command/synth.txt":zB,"./editor/command/toast.txt":WB,"./editor/command/tts.txt":GB,"./editor/command/ttsvol.txt":VB,"./editor/command/twitchbroadcast.txt":XB,"./editor/command/twitchchat.txt":JB,"./editor/command/unlock.txt":tD,"./editor/command/vibrato.txt":nD,"./editor/command/vol.txt":iD,"./editor/command/waitfor.txt":oD,"./editor/command/walk.txt":cD,"./editor/command/weave.txt":uD,"./editor/command/while.txt":fD,"./editor/command/with.txt":pD,"./editor/command/write.txt":gD,"./editor/command/zap.txt":yD,"./editor/comment.txt":wD,"./editor/hyperlink.txt":xD,"./editor/hyperlink/hotkey.txt":kD,"./editor/hyperlink/number.txt":AD,"./editor/hyperlink/range.txt":SD,"./editor/hyperlink/select.txt":ID,"./editor/hyperlink/text.txt":CD,"./editor/label.txt":MD,"./editor/shortgo.txt":FD,"./editor/shorttry.txt":BD,"./editor/stat/board.txt":$D,"./editor/stat/charset.txt":zD,"./editor/stat/const.txt":WD,"./editor/stat/hotkey.txt":GD,"./editor/stat/loader.txt":VD,"./editor/stat/number.txt":XD,"./editor/stat/object.txt":JD,"./editor/stat/palette.txt":t$,"./editor/stat/range.txt":n$,"./editor/stat/select.txt":i$,"./editor/stat/terrain.txt":o$,"./editor/stat/text.txt":c$,"./editor/text.txt":u$,"./help/controls.txt":f$,"./help/developer.txt":p$,"./help/menu.txt":g$,"./help/player.txt":y$,"./help/text.txt":w$}),LE={};Sr(CE).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");LE[e]=CE[t].default});function E$(t){const e=It(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=LE[e];if(x(n))return n;const{target:r,path:i}=Vn(e);switch(r){case"editor":{const s=Vn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function x$(t,e){const n=(t??"").split(`
`);for(let r=0;r<n.length;++r)e(n[r].split(";"))}function v$(t,e){const[n,...r]=e,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":Gu(nt,t,i);break;case"section":qs(nt,t,i);break;case"option":Sc(nt,t,i,s);break;default:n.trimStart().startsWith("!")?SF(nt,t,n.trimStart().slice(1),i):Re(nt,t,n);break}}function Qo(){lg(nt,or())}function Oc(t){x$(E$(`help:${t}`),e=>v$(w.elementfocus,e))}const k$=ji().command("send",(t,e)=>{const[n,r]=rt(e,0,[$.NAME,$.ANY]);switch(It(n)){case"helpmenu":Oc("menu");break;case"helpcontrols":Oc("controls");break;case"helptext":Oc("text");break;case"helpdeveloper":Oc("developer");break;case"helpplayer":Oc("player");break;default:{const[i,s]=NE(n);_p(i==="self"&&w.elementisplayer?`${w.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(be),s=i.join(" ");switch(It(r)){case rr(vt.LOADER):n=_s(Dt.CONTENT,s,_t.LOADER);break;default:n=_s(Dt.CONTENT,[r,...i].join(" "),_t.OBJECT);break;case rr(vt.BOARD):n=_s(Dt.CONTENT,s,_t.BOARD);break;case rr(vt.OBJECT):n=_s(Dt.CONTENT,s,_t.OBJECT);break;case rr(vt.TERRAIN):n=_s(Dt.CONTENT,s,_t.TERRAIN);break;case rr(vt.CHARSET):n=_s(Dt.CONTENT,s,_t.CHARSET);break;case rr(vt.PALETTE):n=_s(Dt.CONTENT,s,_t.PALETTE);break}return x(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(be).join(" ");if(x(w.element)&&w.elementisplayer){const{user:r}=Tr(w.elementid),i=wt(r)?r:"player";w.element.tickertext=`${i}: ${n}`,w.element.tickertime=w.timestamp;const s=ju(w.book,w.element,1,St.WHITE,St.BLACK);fe(nt,w.elementid,`$${St[s.color]}$ON${St[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`)}return 0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=be(n),s=r.map(be).join(" "),{user:o}=Tr(w.elementid),a=wt(o)?o:"player",c=ju(w.book,w.element,1,St.WHITE,St.BLACK);return fe(nt,w.elementid,`!${s};$${St[c.color]}$ON${St[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`),0}).command("bookcreate",(t,e)=>{const[n]=rt(e,0,[$.MAYBE_NAME]),r=wx(n);return x(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=zr(n);return x(r)?(fe(nt,w.elementfocus,`opened [book] ${r.name}`),ch(Dt.MAIN,r.id),t.command("pages")):he(nt,w.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=ue(Dt.MAIN),i=zr(n);return x(i)&&(r===i&&ch(Dt.MAIN,""),k4(n),fe(nt,w.elementfocus,`trashed [book] ${i.name}`),Qo(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=jn(w.book,_t.BOARD,n);if(r.length){const i=Te(...r);x(i)&&Jo(w.book,w.elementfocus,i.id,{x:pr(0,Ot-1),y:pr(0,Jt-1)})}return 0}).command("pageopenwith",(t,e)=>{const[n,r,i]=rt(e,0,[$.NAME,$.MAYBE_NAME,$.MAYBE_NAME]);return t.command("pageopen",r,i,n)}).command("pageopen",(t,e)=>{const[n,r,i]=rt(e,0,[$.NAME,$.MAYBE_NAME,$.MAYBE_NAME]),s=En(Dt.MAIN);if(!x(s))return 0;const o=Di(s,n);if(x(o)){const a=je(o),c=Bi(o);fe(nt,w.elementfocus,`opened [${c}] ${a}`);const l=[],u=Di(s,i??""),f=x(u)?M0(u.code):void 0;if(x(f))for(let p=0;p<f.tokens.length;++p){const m=f.tokens[p];m.tokenType===k0&&l.push(m.image.startsWith('"')?m.image.slice(1):m.image)}const d=[o.id,r];ed(el(s.id,d),o.code);const h=Bi(o);ag(nt,w.elementfocus,s.id,d,h,`${a} - ${s.name}`,l)}else he(nt,"pageopen",`page ${n} not found`,w.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=En(Dt.MAIN),i=dE(r,n);if(x(n)){const s=je(i),o=Bi(i);fe(nt,w.elementfocus,`trashed [${o}] ${s}`),Qo(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(be).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{qs(nt,w.elementfocus,"books");const t=ue(Dt.MAIN);Sc(nt,w.elementfocus,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=ue(Dt.CONTENT);Sc(nt,w.elementfocus,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),tp(nt,w.elementfocus,7);const n=aa();return n.length?n.forEach(r=>{Re(nt,w.elementfocus,`!bookopen ${r.id};${r.name}`)}):zn(nt,w.elementfocus,"no books found"),Re(nt,w.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=En(Dt.MAIN);return x(t)&&(qs(nt,w.elementfocus,"pages"),Sc(nt,w.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?$u(t).forEach(n=>{const r=je(n),i=Bi(n);Re(nt,w.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Re(nt,w.elementfocus,""),zn(nt,w.elementfocus,"$white no pages found"),zn(nt,w.elementfocus,"$white use @ to create a page"),zn(nt,w.elementfocus,"$white @board name of board"),zn(nt,w.elementfocus,"$white @object name of object"),zn(nt,w.elementfocus,"$white @terrain name of terrain"),zn(nt,w.elementfocus,"$white You can omit the type and it will default to object"),zn(nt,w.elementfocus,"$white @object name of object"),zn(nt,w.elementfocus,"$white @name of object"))),0}).command("boards",()=>{qs(nt,w.elementfocus,"boards");const t=En(Dt.MAIN);if(x(t)){Sc(nt,w.elementfocus,"main",`${t.name} $GREEN${t.id}`);const e=$u(t);e.filter(n=>Pi(n)===_t.BOARD).forEach(n=>{const r=je(n),i=Bi(n);Re(nt,w.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),e.length===0&&(Re(nt,w.elementfocus,""),zn(nt,w.elementfocus,"$white no boards found"),zn(nt,w.elementfocus,"$white use @ to create a board"),zn(nt,w.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{qs(nt,w.elementfocus,"$REDTRASH"),zn(nt,w.elementfocus,"books");const t=aa();t.length&&(t.forEach(n=>{Re(nt,w.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Re(nt,w.elementfocus,""));const e=ue(Dt.MAIN);return x(e)&&(zn(nt,w.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=je(n);Re(nt,w.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Re(nt,w.elementfocus,"")),0}).command("dev",()=>(Qo(),DA(nt,w.elementfocus),0)).command("share",()=>(Qo(),$A(nt,w.elementfocus),0)).command("save",()=>(Qo(),0)).command("fork",()=>(tR(nt,w.elementfocus),0)).command("nuke",()=>(jA(nt,w.elementfocus),0)).command("restart",()=>(QA(nt,w.elementfocus),Qo(),0)).command("export",()=>{Gu(nt,w.elementfocus,"E X P O R T"),qs(nt,w.elementfocus,"books");const t=aa();return t.length&&t.forEach(e=>Re(nt,w.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=zr(n);return x(r)&&(Gu(nt,w.elementfocus,"E X P O R T"),qs(nt,w.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=$u(r);Re(nt,w.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=je(s),a=Bi(s);Re(nt,w.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=zr(n);return x(r)&&sg(nt,w.elementfocus,Yn(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=rt(e,0,[$.NAME]),{target:r,path:i}=Vn(n),s=zr(r),o=Di(s,i);return x(o)&&sg(nt,w.elementfocus,Yn(o),`${je(o)}.${Bi(o)}.json`),0}).command("gadget",()=>(XA(nt,w.elementfocus),0)).command("joincode",(t,e)=>{const[n]=rt(e,0,[$.MAYBE_NAME]);return IA(nt,w.elementfocus,!!n),0}).command("jointab",(t,e)=>{const[n]=rt(e,0,[$.MAYBE_NAME]);return NA(nt,w.elementfocus,!!n),0}),T$=ji().command("toast",(t,e)=>{const n=e.map(be).join("");return wA(nt,w.elementfocus,n),0}).command("palette",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=Ex(),i=tn(w.book,_t.PALETTE,n);return x(i)?(r.palette=i.id,fe(nt,w.elementfocus,`loaded palette ${n}`)):he(nt,w.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=Ex(),i=tn(w.book,_t.CHARSET,n);return x(i)?(r.charset=i.id,fe(nt,w.elementfocus,`loaded charset ${n}`)):he(nt,w.elementfocus,"not-found",`unabled to find charset ${n}`),0}),ep={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ic(t){return se(t)&&ME(t[0])}function ME(t){return x(cr[t])&&wt(t)}function UE(t){if(wt(t))return ep[It(t)]}function FE(t){if(Ic(t))return t;if(ME(t))return[t];const e=UE(t);if(x(e))return[e]}function A$(t){const e=w.words[t],n=FE(e);if(Ic(n))return[n,t+1];const[r,i]=Wn(t),s=FE(r);return Ic(s)?[s,i]:[void 0,t]}const np={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Wt.ISSOLID,Wt.ISWALK,Wt.ISSWIM,Wt.ISBULLET,Wt.ISWALK,Wt.ISSWIM;function Yu(t){return se(t)&&rp(t[0])}function rp(t){return x(Wt[t])&&wt(t)}function R$(t){if(wt(t))return np[It(t)]}function S$(t){const e=w.words[t];if(Yu(e))return[e,t+1];if(rp(e))return[[e],t+1];const[n,r]=Wn(t);return Yu(n)?[n,r]:rp(n)?[[n],r]:[void 0,t]}const O$=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),PE=new Set(["char","color","bg","group","party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),I$=["NORTH","SOUTH","WEST","EAST"];function N$(t){const e=Tr(t);if(Rt(e.inputcurrent)||(e.inputcurrent=0),se(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=An.NONE,i=0]=n??[An.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&fN?1:0,e.inputctrl=i&dN?1:0,e.inputshift=i&pN?1:0,r){case An.MOVE_UP:case An.MOVE_DOWN:case An.MOVE_LEFT:case An.MOVE_RIGHT:e.inputmove=[I$[r-An.MOVE_UP]];break;case An.OK_BUTTON:e.inputok=1;break;case An.CANCEL_BUTTON:e.inputcancel=1;break;case An.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==An.NONE&&o!==r}),e}function C$(t){const e=ep[t];if(x(e))return e;const n=np[t];if(x(n))return n;const r=qa[t];if(x(r))return r;const i=cd[t];if(x(i))return i}const L$=ji({get(t,e){var o,a,c,l,u,f,d,h,p,m,b,y,k,A,T,C,R,S,U,N,D;const n=C$(e);if(x(n))return[!0,n];if(w.elementisplayer&&O$.has(e)){const Y=N$(w.elementid)[e];return[x(Y),Y]}const r=rc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus??or();switch(e){case"isdark":return[!0,(c=w.board)!=null&&c.isdark?1:0];case"startx":return[!0,((l=w.board)==null?void 0:l.startx)??0];case"starty":return[!0,((u=w.board)==null?void 0:u.starty)??0];case"over":return[!0,((f=w.board)==null?void 0:f.over)??""];case"under":return[!0,((d=w.board)==null?void 0:d.under)??""];case"camera":return[!0,((h=w.board)==null?void 0:h.camera)??""];case"graphics":return[!0,((p=w.board)==null?void 0:p.graphics)??""];case"facing":break;case"exitnorth":return[!0,((m=w.board)==null?void 0:m.exitnorth)??""];case"exitsouth":return[!0,((b=w.board)==null?void 0:b.exitsouth)??""];case"exitwest":return[!0,((y=w.board)==null?void 0:y.exitwest)??""];case"exiteast":return[!0,((k=w.board)==null?void 0:k.exiteast)??""];case"timelimit":return[!0,((A=w.board)==null?void 0:A.timelimit)??0];case"restartonzap":return[!0,((T=w.board)==null?void 0:T.restartonzap)??0];case"maxplayershots":return[!0,((C=w.board)==null?void 0:C.maxplayershots)??0];case"boardid":return[!0,((R=w.board)==null?void 0:R.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((S=w.element)==null?void 0:S.id)??""];case"thisx":return[!0,((U=w.element)==null?void 0:U.x)??-1];case"thisy":return[!0,((N=w.element)==null?void 0:N.y)??-1];default:{const Y=(D=w.element)==null?void 0:D[e];if(PE.has(e))return[!0,Y];break}}const s=Tr(i)[e];return[x(s),s]},set(t,e,n){var o,a;const r=rc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus;switch(e){case"isdark":if(x(w.board))return w.board.isdark=n?1:0,[!0,w.board.isdark];break;case"startx":if(x(w.board))return w.board.startx=Rc(n,0),[!0,w.board.startx];break;case"starty":if(x(w.board))return w.board.starty=Rc(n,0),[!0,w.board.starty];break;case"over":if(x(w.board))return w.board.over=Rt(n)?n:be(n),[!0,w.board.over];break;case"under":if(x(w.board))return w.board.under=Rt(n)?n:be(n),[!0,w.board.under];break;case"camera":if(x(w.board))return[!0,w.board.camera=be(n)];break;case"graphics":if(x(w.board))return[!0,w.board.graphics=be(n)];break;case"facing":break;case"exitnorth":if(x(w.board))return w.board.exitnorth=be(n),[!0,w.board.exitnorth];break;case"exitsouth":if(x(w.board))return w.board.exitsouth=be(n),[!0,w.board.exitsouth];break;case"exitwest":if(x(w.board))return w.board.exitwest=be(n),[!0,w.board.exitwest];break;case"exiteast":if(x(w.board))return w.board.exiteast=be(n),[!0,w.board.exiteast];break;case"timelimit":if(x(w.board))return w.board.timelimit=Rc(n,0),[!0,w.board.timelimit];break;case"restartonzap":if(x(w.board))return w.board.restartonzap=n?1:0,[!0,w.board.restartonzap];break;case"maxplayershots":if(x(w.board))return w.board.maxplayershots=Rc(n,0),[!0,w.board.maxplayershots];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(PE.has(e))return x(w.element)&&(w.element[e]=n),[!0,n];break}}const s=Tr(i);return x(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n,r,i;if(!((t=w.element)!=null&&t.removed)&&(x((e=w.element)==null?void 0:e.stepx)||x((n=w.element)==null?void 0:n.stepy))){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};ca(w.book,w.board,w.element,{x:s.x+(w.element.stepx??0),y:s.y+(w.element.stepy??0)})===!1&&(w.element.stepx=0,w.element.stepy=0,bn(w.book,w.element,"destructible")&&ir(w.book,w.board,w.element,w.timestamp))}}}).command("clear",(t,e)=>{for(let n=0;n<e.length;++n)t.set(be(e[n]),0);return 0}).command("set",(t,e)=>{const[n,r]=rt(e,0,[$.NAME,$.ANY]);return t.set(n,r??1),0}).command("become",(t,e)=>{var r,i;const[n]=rt(e,0,[$.KIND]);if(He(w.book,w.board),j0(w.book,w.board,w.element),ir(w.book,w.board,w.element,w.timestamp)){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};Xs(w.book,w.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=rt(e,0,[$.ANY]);if(Si(n)){const[r,i]=rt(e,0,[$.DIR,$.NUMBER]),s=ge(w.board,r.destpt);x(s)&&(s.char=i)}else x(w.element)&&Rt(n)&&(w.element.char=n);return 0}).command("color",(t,e)=>{const[n]=rt(e,0,[$.ANY]);if(Si(n)){const[r,i]=rt(e,0,[$.DIR,$.COLOR]),s=ge(w.board,r.destpt);x(s)&&nc(w.element,i)}else{const[r]=rt(e,0,[$.COLOR]);x(w.element)&&x(r)&&nc(w.element,r)}return 0}).command("go",(t,e)=>{if(x(w.element)){const[n]=rt(e,0,[$.DIR]);if(ca(w.book,w.board,w.element,n.destpt),t.yield(),w.element.x===n.destpt.x&&w.element.y===n.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!x(w.element))return 0;const[n]=rt(e,0,[$.DIR]),r=w.element.x??0,i=w.element.y??0;return w.element.stepx=n.destpt.x-r,w.element.stepy=n.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=rt(e,0,[$.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(be(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(be(e[0])),0)).command("cycle",(t,e)=>{if(x(w.element)){const[n]=rt(e,0,[$.NUMBER]);w.element.cycle=Xe(Math.round(n),1,255)}return 0}).command("die",t=>(ir(w.book,w.board,w.element,w.timestamp),t.endofprogram(),0)).command("endgame",()=>(cg(nt,w.elementfocus),0)).command("run",(t,e)=>{const[n]=rt(e,0,[$.NAME]);return lh(n),0}).command("runwith",(t,e)=>{const[n,r]=rt(e,0,[$.ANY,$.NAME]);return t.set("arg",n),lh(r),0}),Vu={};function M$(t){var e;return(e=Vu[t])==null?void 0:e.arg}function U$(t){var e;return(e=Vu[t])==null?void 0:e.format}function ds(t){var e;return(e=Vu[t])==null?void 0:e.content}function F$(t,e,n,r,i){const s=ue(Dt.MAIN);if(!x(s))return;const o=Vs(s,_t.LOADER).filter(a=>{const c=Ys(a),l=c.format,u=wt(l)?new RegExp(l).test(e):!1,f=c.event,d=wt(f)?new RegExp(f).test(n):!1;return wt(l)&&wt(f)?u&&d:wt(l)?u:wt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${Me()}_loader`;Vu[c]={arg:t,format:e,content:r,player:i},S4(c,o[a].code)}}function BE(t,e){if(!x(t))return;const n=It(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const P$=(t,e)=>{const n=ds(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[$.NAME]),s=It(r);switch(s){case"seek":{const[o]=rt(e,i,[$.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(e,i,[$.NAME]);t.set(o,BE(n,s));break}case"text":{const[o,a]=rt(e,i,[$.NAME,$.NAME]),c=BE(n,o);if(Rt(c)&&wt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);t.set(a,f),n.cursor+=c}break}case"palette":{const[o]=rt(e,i,[$.NAME]),a=D0(w.book,_t.PALETTE,o),c=Le(a);if(x(c)){const l=sN*sc,u=Rd(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(e,i,[$.NAME]),a=D0(w.book,_t.CHARSET,o),c=Le(a);if(x(c)){const l=Gl*iN*Ad,u=ib(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},ta=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",Zu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!Zu(t[n],e[n]))return!1;return!0}if(ta(t)&&ta(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Zu(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},Xu=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(ta(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},B$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",DE=t=>t>="0"&&t<="9"||t==="-",D$=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var Z;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(Z||(Z={}));const $E={"(":Z.TOK_LPAREN,")":Z.TOK_RPAREN,"*":Z.TOK_STAR,",":Z.TOK_COMMA,".":Z.TOK_DOT,":":Z.TOK_COLON,"@":Z.TOK_CURRENT,$:Z.TOK_ROOT,"]":Z.TOK_RBRACKET,"{":Z.TOK_LBRACE,"}":Z.TOK_RBRACE},$$={"!":!0,"<":!0,"=":!0,">":!0},j$={"	":!0,"\n":!0,"\r":!0," ":!0};class z${constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(B$(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:Z.TOK_UNQUOTEDIDENTIFIER,value:i});else if($E[e[this._current]]!==void 0)n.push({start:this._current,type:$E[e[this._current]],value:e[this._current]}),this._current+=1;else if(DE(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:Z.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:Z.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:Z.TOK_LITERAL,value:o})}else if($$[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(j$[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:Z.TOK_AND,value:"&&"})):n.push({start:r,type:Z.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:Z.TOK_OR,value:"||"})):n.push({start:r,type:Z.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&D$(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;DE(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:Z.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:Z.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:Z.TOK_FLATTEN,value:"[]"}):{start:n,type:Z.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_NE,value:"!="}):{start:n,type:Z.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_LTE,value:"<="}):{start:n,type:Z.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:Z.TOK_GTE,value:">="}):{start:n,type:Z.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:Z.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const K$=new z$,wn={[Z.TOK_EOF]:0,[Z.TOK_UNQUOTEDIDENTIFIER]:0,[Z.TOK_QUOTEDIDENTIFIER]:0,[Z.TOK_RBRACKET]:0,[Z.TOK_RPAREN]:0,[Z.TOK_COMMA]:0,[Z.TOK_RBRACE]:0,[Z.TOK_NUMBER]:0,[Z.TOK_CURRENT]:0,[Z.TOK_EXPREF]:0,[Z.TOK_ROOT]:0,[Z.TOK_PIPE]:1,[Z.TOK_OR]:2,[Z.TOK_AND]:3,[Z.TOK_EQ]:5,[Z.TOK_GT]:5,[Z.TOK_LT]:5,[Z.TOK_GTE]:5,[Z.TOK_LTE]:5,[Z.TOK_NE]:5,[Z.TOK_FLATTEN]:9,[Z.TOK_STAR]:20,[Z.TOK_FILTER]:21,[Z.TOK_DOT]:40,[Z.TOK_NOT]:45,[Z.TOK_LBRACE]:50,[Z.TOK_LBRACKET]:55,[Z.TOK_LPAREN]:60};class W${constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Z.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...K$.tokenize(e),{type:Z.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<wn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case Z.TOK_LITERAL:return{type:"Literal",value:e.value};case Z.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case Z.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===Z.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Z.TOK_NOT:return r=this.expression(wn.Not),{type:"NotExpression",children:[r]};case Z.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Z.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(wn.Star),{type:"ValueProjection",children:[n,r]};case Z.TOK_FILTER:return this.led(e.type,{type:"Identity"});case Z.TOK_LBRACE:return this.parseMultiselectHash();case Z.TOK_FLATTEN:return n={type:Z.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(wn.Flatten),{type:"Projection",children:[n,r]};case Z.TOK_LBRACKET:return this.lookahead(0)===Z.TOK_NUMBER||this.lookahead(0)===Z.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Z.TOK_STAR&&this.lookahead(1)===Z.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(wn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Z.TOK_CURRENT:return{type:Z.TOK_CURRENT};case Z.TOK_ROOT:return{type:Z.TOK_ROOT};case Z.TOK_EXPREF:return i=this.expression(wn.Expref),{type:"ExpressionReference",children:[i]};case Z.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Z.TOK_RPAREN;)this.lookahead(0)===Z.TOK_CURRENT?(i={type:Z.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Z.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case Z.TOK_DOT:const i=wn.Dot;return this.lookahead(0)!==Z.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Z.TOK_PIPE:return r=this.expression(wn.Pipe),{type:Z.TOK_PIPE,children:[n,r]};case Z.TOK_OR:return r=this.expression(wn.Or),{type:"OrExpression",children:[n,r]};case Z.TOK_AND:return r=this.expression(wn.And),{type:"AndExpression",children:[n,r]};case Z.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Z.TOK_RPAREN;)this.lookahead(0)===Z.TOK_CURRENT?(a={type:Z.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Z.TOK_COMMA&&this.match(Z.TOK_COMMA),o.push(a);return this.match(Z.TOK_RPAREN),{name:s,type:"Function",children:o};case Z.TOK_FILTER:const l=this.expression(0);return this.match(Z.TOK_RBRACKET),r=this.lookahead(0)===Z.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(wn.Filter),{type:"FilterProjection",children:[n,r,l]};case Z.TOK_FLATTEN:const u={type:Z.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(wn.Flatten);return{type:"Projection",children:[u,f]};case Z.TOK_EQ:case Z.TOK_NE:case Z.TOK_GT:case Z.TOK_GTE:case Z.TOK_LT:case Z.TOK_LTE:return this.parseComparator(n,e);case Z.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===Z.TOK_NUMBER||d.type===Z.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Z.TOK_STAR),this.match(Z.TOK_RBRACKET),r=this.parseProjectionRHS(wn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Z.TOK_COLON||this.lookahead(1)===Z.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Z.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(wn.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Z.TOK_RBRACKET&&n<3;){if(r===Z.TOK_COLON)n+=1,this.advance();else if(r===Z.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Z.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(wn[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([Z.TOK_UNQUOTEDIDENTIFIER,Z.TOK_QUOTEDIDENTIFIER,Z.TOK_STAR].includes(n))return this.expression(e);if(n===Z.TOK_LBRACKET)return this.match(Z.TOK_LBRACKET),this.parseMultiselectList();if(n===Z.TOK_LBRACE)return this.match(Z.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(wn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Z.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===Z.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===Z.TOK_DOT)return this.match(Z.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==Z.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===Z.TOK_COMMA&&(this.match(Z.TOK_COMMA),this.lookahead(0)===Z.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Z.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[Z.TOK_UNQUOTEDIDENTIFIER,Z.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Z.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Z.TOK_COMMA)this.match(Z.TOK_COMMA);else if(this.lookahead(0)===Z.TOK_RBRACE){this.match(Z.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const H$=new W$;var ut;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class G${constructor(e){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>ta(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var b;return(b=!m.optional)!==null&&b!==void 0?b:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,h=this.getTypeName(n[m]);let b;for(b=0;b<d.length;b+=1)if(h!==void 0&&this.typeMatches(h,d[b],n[m])){p=!0;break}if(!p&&h!==void 0){const y=d.map(k=>this.TYPE_NAME_TABLE[k]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(e,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return e===ut.TYPE_ARRAY;if(e===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return e.jmespathType===Z.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class Y${constructor(){this._rootValue=null,this.runtime=new G$(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,f,d,h;switch(e.type){case"Field":return n===null?null:ta(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...e.children],b=this.computeSliceParams(n.length,m),[y,k,A]=b;if(s=[],A>0)for(d=y;d<k;d+=A)s.push(n[d]);else for(d=y;d>k;d+=A)s.push(n[d]);return s;case"Projection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(e.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(e.children[0],n),!ta(h))return null;f=[];const T=Object.values(h);for(d=0;d<T.length;d+=1)i=this.visit(e.children[1],T[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(e.children[0],n),!Array.isArray(h))return null;const C=[],R=[];for(d=0;d<h.length;d+=1)r=this.visit(e.children[2],h[d]),Xu(r)||C.push(h[d]);for(let L=0;L<C.length;L+=1)i=this.visit(e.children[1],C[L]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case Z.TOK_EQ:s=Zu(o,a);break;case Z.TOK_NE:s=!Zu(o,a);break;case Z.TOK_GT:s=o>a;break;case Z.TOK_GTE:s=o>=a;break;case Z.TOK_LT:s=o<a;break;case Z.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case Z.TOK_FLATTEN:const S=this.visit(e.children[0],n);if(!Array.isArray(S))return null;let U=[];for(d=0;d<S.length;d+=1)i=S[d],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<e.children.length;d+=1)f.push(this.visit(e.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let N;for(d=0;d<e.children.length;d+=1)N=e.children[d],f[N.name]=this.visit(N.value,n);return f;case"OrExpression":return r=this.visit(e.children[0],n),Xu(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),Xu(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),Xu(o);case"Literal":return e.value;case Z.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case Z.TOK_CURRENT:return n;case Z.TOK_ROOT:return this._rootValue;case"Function":const D=[];for(let L=0;L<e.children.length;L+=1)D.push(this.visit(e.children[L],n));return this.runtime.callFunction(e.name,D);case"ExpressionReference":const Y=e.children[0];return Y.jmespathType=Z.TOK_EXPREF,Y;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const V$=new Y$;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function Z$(t,e){const n=H$.parse(e);return V$.search(n,t)}const X$=(t,e)=>{const n=ds(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[$.NAME,$.NAME]),s=Z$(n.json,r);return t.set(i,s),0};function q$(t,e){return Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2))}const qu=Rd(sb);function jE(t){let e;if(!x(qu))return e;let n=1e9;for(let r=0;r<=St.BLACK;++r){const i=r*sc,s=qu.bits[i],o=qu.bits[i+1],a=qu.bits[i+2],c=q$(t,{r:s,g:o,b:a,hex:""});c<n&&(e=r,n=c)}return e}const J$=(t,e)=>{var a,c,l,u;const n=ds(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[$.NAME]),s=It(r),o=((a=n.content)==null?void 0:a.layers)??[];switch(s){case"seek":{const[f]=rt(e,i,[$.NUMBER]);n.cursor=Xe(f,0,o.length-1);break}case"layer":{const f=n.cursor+1;n.cursor=Xe(f,0,o.length-1);break}case"char":{const[f,d,h]=rt(e,i,[$.NUMBER,$.NUMBER,$.NAME]),p=(c=n.content)==null?void 0:c.layers[n.cursor];x(p)&&Mo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,p.raster[f+d*p.width].asciiCode);break}case"color":{const[f,d,h]=rt(e,i,[$.NUMBER,$.NUMBER,$.NAME]),p=(l=n.content)==null?void 0:l.layers[n.cursor];x(p)&&Mo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,jE(p.raster[f+d*p.width].color));break}case"bg":{const[f,d,h]=rt(e,i,[$.NUMBER,$.NUMBER,$.NAME]),p=(u=n.content)==null?void 0:u.layers[n.cursor];x(p)&&Mo(f,d,0,p.width-1,p.height-1,0)&&t.set(h,jE(p.raster[f+d*p.width].bg));break}}return 0},Q$=(t,e)=>{const n=ds(t.id());if(!x(n))return 0;const[r,i]=rt(e,0,[$.NAME]);switch(It(r)){case"seek":{const[o]=rt(e,i,[$.NUMBER]);n.cursor=Xe(o,0,n.lines.length-1);break}case"line":n.cursor=Xe(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[f,d]=rt(e,u,[$.NAME]);t.set(f,c[l]??0),++l,u=d}break}}return 0},t5=ji({get(t,e){var r,i,s;const n=U$(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const o=ds(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"lines":return[!0,o.lines.length]}break}case"json":{const o=ds(t.id());switch(e){case"filename":return[!0,o.filename]}break}case"binary":{const o=ds(t.id());switch(e){case"filename":return[!0,o.filename];case"cursor":return[!0,o.cursor];case"bytes":return[!0,o.bytes.length]}break}case"rexpaint":{const o=ds(t.id());switch(e){case"filename":return[!0,o.filename];case"layers":return[!0,((r=o.content)==null?void 0:r.layers.length)??0];case"width":return[!0,((i=o.content)==null?void 0:i.layers[o.cursor].width)??0];case"height":return[!0,((s=o.content)==null?void 0:s.layers[o.cursor].height)??0];case"cursor":return[!0,o.cursor]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=rt(e,0,[$.NAME,$.ANY]);return _p(n,r),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(be).join(" ");return fe(nt,w.elementfocus,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=be(n),s=r.map(be).join(" ");return fe(nt,w.elementfocus,"$175",`!${s};${i}`),0}).command("readline",Q$).command("readjson",X$).command("readbin",P$).command("readrexpaint",J$).command("with",(t,e)=>{const[n]=rt(e,0,[$.NAME]),r=jn(w.book,_t.BOARD,n);if(r.length){const i=Te(...r);x(i)&&(w.board=Le(i),w.element={x:-1,y:-1})}return 0});function zE(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[$.ANY]);se(c)&&!Si(c)&&!Ic(c)&&!Yu(c)&&!ni(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":TA(nt,w.elementfocus,t,e,n,r,o);break}return 0}const e5=ji().command("fetch",(t,e)=>{const[n,r,i="get",s]=rt(e,0,[$.NAME,$.NAME,$.MAYBE_STRING]);return zE(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=rt(e,0,[$.ANY,$.NAME,$.NAME,$.MAYBE_STRING]);return zE(n,r,i,s,e,o),0}).command("twitchchat",(t,e)=>{const[n]=rt(e,0,[$.ANY]);switch(It(n)){default:vA(nt,w.elementfocus,n);break;case"stop":kA(nt,w.elementfocus);break}return 0}).command("twitchbroadcast",(t,e)=>{const[n]=rt(e,0,[$.NAME]);switch(It(n)){default:EA(nt,w.elementfocus,n);break;case"stop":xA(nt,w.elementfocus);break}return 0}),n5=ji({set(t,e,n){return D4(t,e,n),[!1,void 0]},everytick(){const t=mi(w.elementid),[e]=t;if(t.length===1&&wt(e)){if(x(w.element))if(e.trim().length===0){const n=In(w.elementid);n.sidebar=[]}else w.element.tickertext=e,w.element.tickertime=w.timestamp}else if(t.length>1)if(w.elementisplayer){const n=In(w.elementid);n.sidebar=t}else{const n=In(w.elementfocus);n.scroll=t}}}).command("send",(t,e)=>{var a,c;const[n,r]=rt(e,0,[$.NAME,$.ANY]),[i,s]=NE(n);switch(It(i)){case"all":for(const l of Object.keys(((a=w.board)==null?void 0:a.objects)??{}))t.send(w.elementfocus,l,s,r);break;case"self":t.message({session:nt.session(),player:w.elementfocus,id:Me(),sender:t.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((c=w.board)==null?void 0:c.objects)??{}))l!==t.id()&&t.send(w.elementfocus,l,s,r);break;default:{const l=tb(w.board,[i]);for(let u=0;u<l.length;++u){const f=l[u];x(f.id)&&t.send(w.elementfocus,f.id,s,r)}break}}return 0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(be).join("");return ae(w.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=be(n);return jt(w.elementid,t.id(),i,r,t.get,t.set),0});function KE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ge(e,{x:s,y:i});yn(o)&&ir(t,e,o,t.timestamp),ln(e,{x:s,y:i})}}function r5(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)ln(t,{x:i,y:r})}function WE(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ge(e,{x:s,y:i});yn(o)&&ir(t,e,o,t.timestamp),ln(e,{x:s,y:i})}}function Ju(t,e){x(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.code=e.code,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.stepx=e.stepx,t.stepy=e.stepy,t.pushable=e.pushable,t.collision=e.collision,t.destructible=e.destructible,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function ip(t,e,n,r,i){if(!x(w.book))return;const s=w.book,o=tn(s,_t.BOARD,t),a=Le(o);if(!x(a))return;const c=tn(s,_t.BOARD,e),l=Le(c);if(!x(l))return;He(s,a),He(s,l);let u=!1;if(x(a)&&x(l)){switch(i){case"all":KE(s,l,n,r);break;case"object":WE(s,l,n,r);break;case"terrain":r5(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,p=!1;switch(i){case"all":h=!0,p=!0;break;case"object":h=!0;break;case"terrain":p=!0;break}const m={x:d,y:f};let b,y=ge(a,m);if(yn(y)?(b=jo(a,d,f),Rr(y==null?void 0:y.id)&&(y=void 0)):(b=y,y=void 0),x(b)&&(p||u&&us(s,b)===i)){u&&KE(s,l,m,m);const k=Xs(s,l,[b.kind??""],m);Ju(k,b)}if(x(y)&&(h||u&&us(s,y)===i)){u&&WE(s,l,m,m);const k=Xs(s,l,[y.kind??""],m);Ju(k,y)}}Wu(s,l)}}function i5(t,e,n,r,i){if(!x(w.book))return;const s=w.book,o=tn(s,_t.BOARD,t),a=Le(o);if(!x(a))return;const c=xd(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";He(s,a),He(s,c);const f=-Math.tan(e*.5),d=Math.sin(e),h=Math.round(12.5*f),p=Math.round(12.5*d),m=new Array(Jt).fill(0);sy(h,0,-h,Jt-1).forEach(T=>{T.x<0?m[T.y]=Math.min(m[T.y],T.x):m[T.y]=Math.max(m[T.y],T.x)});const y=new Array(Ot).fill(0);sy(0,p,Ot-1,-p).forEach(T=>{T.y<0?y[T.x]=Math.min(y[T.x],T.y):y[T.x]=Math.max(y[T.x],T.y)});const A=[m,y,m];for(let T=0;T<A.length;++T){const C=A[T];if(T!==1){for(let R=0;R<Jt;++R){const S=C[R],U=R*Ot;for(let N=0;N<Ot;N++){const D=(N+S+Ot)%Ot;u&&(c.terrain[D+U]=a.terrain[N+U])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:N,y:D}=a.objects[U];if(x(N)&&x(D)){const Y=C[D];a.objects[U].x=(N+Y+Ot)%Ot,a.objects[U].lx=a.objects[U].x}}}}if(T===1){for(let R=0;R<Ot;++R){const S=C[R];for(let U=0;U<Jt;++U){const N=(U+S+Jt)%Jt;u&&(c.terrain[R+N*Ot]=a.terrain[R+U*Ot])}}if(l){const R=Object.keys(a.objects);for(let S=0;S<R.length;++S){const U=R[S],{x:N,y:D}=a.objects[U];if(x(N)&&x(D)){const Y=C[N];a.objects[U].y=(D+Y+Jt)%Jt,a.objects[U].ly=a.objects[U].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,He(s,c),He(s,a)}}function s5(t,e){let n=0,r=0,i=0;for(;i<t.length;i++)n+=t[i];for(i=0,e*=n;e&&i<t.length;){if(r+=t[i],e<=r)return i;i++}return 0}var o5=s5;const a5=o5,Qt=function(){};Qt.prototype.FMX=0,Qt.prototype.FMY=0,Qt.prototype.FMXxFMY=0,Qt.prototype.T=0,Qt.prototype.N=0,Qt.prototype.initiliazedField=!1,Qt.prototype.generationComplete=!1,Qt.prototype.wave=null,Qt.prototype.compatible=null,Qt.prototype.weightLogWeights=null,Qt.prototype.sumOfWeights=0,Qt.prototype.sumOfWeightLogWeights=0,Qt.prototype.startingEntropy=0,Qt.prototype.sumsOfOnes=null,Qt.prototype.sumsOfWeights=null,Qt.prototype.sumsOfWeightLogWeights=null,Qt.prototype.entropies=null,Qt.prototype.propagator=null,Qt.prototype.observed=null,Qt.prototype.distribution=null,Qt.prototype.stack=null,Qt.prototype.stackSize=0,Qt.prototype.DX=[-1,0,1,0],Qt.prototype.DY=[0,1,0,-1],Qt.prototype.opposite=[2,3,0,1],Qt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let e=0;e<this.T;e++)this.compatible[t][e]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Qt.prototype.observe=function(t){let e=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=e){const c=1e-6*t();a+c<e&&(e=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=a5(this.distribution,t()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Qt.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const e=t[0],n=e%this.FMX,r=e/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][t[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],p=f[h];p[i]--,p[i]==0&&this.ban(l,h)}}}},Qt.prototype.singleIteration=function(t){const e=this.observe(t);return e!==null?(this.generationComplete=e,!!e):(this.propagate(),null)},Qt.prototype.iterate=function(t,e){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,e=e||Math.random;for(let n=0;n<t||t===0;n++){const r=this.singleIteration(e);if(r!==null)return!!r}return!0},Qt.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const e=this.singleIteration(t);if(e!==null)return!!e}},Qt.prototype.isGenerationComplete=function(){return this.generationComplete},Qt.prototype.ban=function(t,e){const n=this.compatible[t][e];for(let i=0;i<4;i++)n[i]=0;this.wave[t][e]=!1,this.stack[this.stackSize]=[t,e],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[e],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[e];const r=this.sumsOfWeights[t];this.entropies[t]=Math.log(r)-this.sumsOfWeightLogWeights[t]/r},Qt.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let e=0;e<this.T;e++){this.wave[t][e]=!0;for(let n=0;n<4;n++)this.compatible[t][e][n]=this.propagator[this.opposite[n]][e].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var HE=Qt;const GE=HE,zi=function(e,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let N=0;N<f;N++)d[N]=new Array(r);this.colors=[];const h={};for(let N=0;N<r;N++)for(let D=0;D<n;D++){const Y=(N*n+D)*4,L=[e[Y],e[Y+1],e[Y+2],e[Y+3]],I=L.join("-");h.hasOwnProperty(I)||(h[I]=this.colors.length,this.colors.push(L)),d[D][N]=h[I]}const p=this.colors.length,m=Math.pow(p,i*i),b=function(D){let Y=new Array(i*i);for(let L=0;L<i;L++)for(let I=0;I<i;I++)Y[I+L*i]=D(I,L);return Y},y=function(D,Y){return b(function(L,I){return d[(D+L)%n][(Y+I)%r]})},k=function(D){return b(function(Y,L){return D[i-1-L+Y*i]})},A=function(D){return b(function(Y,L){return D[i-1-Y+L*i]})},T=function(D){let Y=0,L=1;for(let I=0;I<D.length;I++)Y+=D[D.length-1-I]*L,L*=p;return Y},C=function(D){let Y=D,L=m;const I=new Array(i*i);for(let E=0;E<I.length;E++){L/=p;let B=0;for(;Y>=L;)Y-=L,B++;I[E]=B}return I},R={},S=[];for(let N=0;N<(a?r:r-i+1);N++)for(let D=0;D<(a?n:n-i+1);D++){const Y=new Array(8);Y[0]=y(D,N),Y[1]=A(Y[0]),Y[2]=k(Y[0]),Y[3]=A(Y[2]),Y[4]=k(Y[2]),Y[5]=A(Y[4]),Y[6]=k(Y[4]),Y[7]=A(Y[6]);for(let L=0;L<l;L++){const I=T(Y[L]);R[I]?R[I]++:(S.push(I),R[I]=1)}}this.T=S.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const D=parseInt(S[N],10);this.patterns[N]=C(D),this.weights[N]=R[D]}const U=function(D,Y,L,I){const E=L<0?0:L,B=L<0?L+i:i,J=I<0?0:I,j=I<0?I+i:i;for(let st=J;st<j;st++)for(let tt=E;tt<B;tt++)if(D[tt+i*st]!=Y[tt-L+i*(st-I)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let D=0;D<this.T;D++){const Y=[];for(let L=0;L<this.T;L++)U(this.patterns[D],this.patterns[L],this.DX[N],this.DY[N])&&Y.push(L);this.propagator[N][D]=Y}}};zi.prototype=Object.create(GE.prototype),zi.prototype.constructor=zi,zi.prototype.onBoundary=function(t,e){return!this.periodic&&(t+this.N>this.FMX||e+this.N>this.FMY||t<0||e<0)},zi.prototype.clear=function(){if(GE.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let e=0;e<this.T;e++)e!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,e);for(let e=0;e<this.FMY-1;e++)this.ban(t+e*this.FMX,this.ground)}this.propagate()}},zi.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},zi.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMY;e++){const n=e<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(e*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(e-n)*this.FMX]][i+n*this.N]];t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3]}}},zi.prototype.graphicsIncomplete=function(t){for(let e=0;e<this.FMXxFMY;e++){const n=e%this.FMX,r=e/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const p=d+h*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const b=this.colors[this.patterns[m][f+u*this.N]];s+=b[0],o+=b[1],a+=b[2],c+=b[3]}}const l=e*4;t[l]=s/i,t[l+1]=o/i,t[l+2]=a/i,t[l+3]=c/i}};var c5=zi;const l5=HE,ps=function(e,n,r,i,s){const o=e.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!e.unique;let c=null;n&&e.subsets&&e.subsets[n]&&(c=e.subsets[n]);const l=function(T){const C=new Array(o*o);for(let R=0;R<o;R++)for(let S=0;S<o;S++)C[S+R*o]=T(S,R);return C},u=function(T){return l(function(C,R){return T[o-1-R+C*o]})},f=function(T){return l(function(C,R){return T[o-1-C+R*o]})};this.tiles=[];const d=[],h=[],p={};let m,b,y;for(let A=0;A<e.tiles.length;A++){const T=e.tiles[A];if(c!==null&&c.indexOf(T.name)===-1)continue;switch(T.symmetry){case"L":y=4,m=function(R){return(R+1)%4},b=function(R){return R%2===0?R+1:R-1};break;case"T":y=4,m=function(R){return(R+1)%4},b=function(R){return R%2===0?R:4-R};break;case"I":y=2,m=function(R){return 1-R},b=function(R){return R};break;case"\\":y=2,m=function(R){return 1-R},b=function(R){return 1-R};break;case"F":y=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},b=function(R){return R<4?R+4:R-4};break;default:y=1,m=function(R){return R},b=function(R){return R};break}this.T=h.length,p[T.name]=this.T;for(let R=0;R<y;R++)h.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+b(R),this.T+b(m(R)),this.T+b(m(m(R))),this.T+b(m(m(m(R))))]);let C;if(a)for(let R=0;R<y;R++)C=T.bitmap[R],this.tiles.push(l(function(S,U){return[C[(o*U+S)*4],C[(o*U+S)*4+1],C[(o*U+S)*4+2],C[(o*U+S)*4+3]]}));else{C=T.bitmap,this.tiles.push(l(function(R,S){return[C[(o*S+R)*4],C[(o*S+R)*4+1],C[(o*S+R)*4+2],C[(o*S+R)*4+3]]}));for(let R=1;R<y;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):f(this.tiles[this.T+R-4]))}for(let R=0;R<y;R++)d.push(T.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const k=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),k[A]=new Array(this.T);for(let T=0;T<this.T;T++){k[A][T]=new Array(this.T);for(let C=0;C<this.T;C++)k[A][T][C]=!1}}for(let A=0;A<e.neighbors.length;A++){const T=e.neighbors[A],C=T.left.split(" ").filter(function(Y){return Y.length}),R=T.right.split(" ").filter(function(Y){return Y.length});if(c!==null&&(c.indexOf(C[0])===-1||c.indexOf(R[0])===-1))continue;const S=h[p[C[0]]][C.length==1?0:parseInt(C[1],10)],U=h[S][1],N=h[p[R[0]]][R.length==1?0:parseInt(R[1],10)],D=h[N][1];k[0][N][S]=!0,k[0][h[N][6]][h[S][6]]=!0,k[0][h[S][4]][h[N][4]]=!0,k[0][h[S][2]][h[N][2]]=!0,k[1][D][U]=!0,k[1][h[U][6]][h[D][6]]=!0,k[1][h[D][4]][h[U][4]]=!0,k[1][h[U][2]][h[D][2]]=!0}for(let A=0;A<this.T;A++)for(let T=0;T<this.T;T++)k[2][A][T]=k[0][T][A],k[3][A][T]=k[1][T][A];for(let A=0;A<4;A++)for(let T=0;T<this.T;T++){const C=[],R=k[A][T];for(let S=0;S<this.T;S++)R[S]&&C.push(S);this.propagator[A][T]=C}};ps.prototype=Object.create(l5.prototype),ps.prototype.constructor=ps,ps.prototype.onBoundary=function(t,e){return!this.periodic&&(t<0||e<0||t>=this.FMX||e>=this.FMY)},ps.prototype.graphics=function(t,e){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,e),t},ps.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMX;e++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[e+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(e*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];t[o]=a[0],t[o+1]=a[1],t[o+2]=a[2],t[o+3]=a[3]}}},ps.prototype.graphicsIncomplete=function(t,e){(!e||e.length!==4)&&(e=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(e&&s===this.T)t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];else{let f=0,d=0,h=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const b=this.tiles[m][l+c*this.tilesize],y=this.weights[m]*a;f+=b[0]*y,d+=b[1]*y,h+=b[2]*y,p+=b[3]*y}t[u]=f,t[u+1]=d,t[u+2]=h,t[u+3]=p}}}};var u5=ps,h5={OverlappingModel:c5,SimpleTiledModel:u5},f5=no(h5);const YE=5;function VE(t,e,n,r,i,s,o){if(!x(w.book))return!1;const a=w.book,c=tn(a,_t.BOARD,t),l=tn(a,_t.BOARD,e),u=Le(c),f=Le(l);if(!x(u)||!x(f))return!1;He(a,u),He(a,f);let d=0;const h=new Map,p=new Map;let m=0;const b=32,y=new Uint8Array(Ed*4);for(let S=0;S<Jt;++S)for(let U=0;U<Ot;++U){const N=ge(f,{x:U,y:S}),D=(N==null?void 0:N.char)??0,Y=(N==null?void 0:N.color)??b,L=(N==null?void 0:N.bg)??b;y[m++]=D,y[m++]=Y,y[m++]=L;const I=jr(a,N),E=It((I==null?void 0:I.name)??"empty"),B=h.get(E);Rt(B)?y[m++]=B:(h.set(E,d),p.set(d,E),y[m++]=d++)}const k=s.x-i.x+1,A=s.y-i.y+1,T=new f5.OverlappingModel(y,Ot,Jt,n,k,A,!1,!1,r,0);let C=0;for(;C<YE&&!T.generate();++C);if(C===YE)return!1;m=0;const R=T.graphics();for(let S=i.y;S<=s.y;++S)for(let U=i.x;U<=s.x;++U){const N={x:U,y:S},D=R[m++],Y=R[m++],L=R[m++];switch(d=R[m++],o){case"all":{const st=ge(u,{x:U,y:S});yn(st)&&ir(a,u,st,a.timestamp),ln(u,{x:U,y:S});break}case"object":{const st=ge(u,{x:U,y:S});yn(st)&&ir(a,u,st,a.timestamp);break}case"terrain":ln(u,{x:U,y:S});break}let I=p.get(d)??"";const E=qo(a,I),B=zu(a,I),J=E??B;switch(o){case"all":break;case"object":x(B)&&(I="");break;case"terrain":x(E)&&(I="");break;default:if(us(a,J)!==o&&(I=""),I){const st=ge(u,{x:U,y:S});yn(st)&&ir(a,u,st,a.timestamp),ln(u,{x:U,y:S})}break}const j=I?Xs(a,u,[I],N):void 0;if(!(!x(j)||!x(J))&&(Ju(j,J),D>0&&(j.char=D),Y<b&&(j.color=Y),L<b&&(j.bg=L),yn(j))){const st=Te(ic(f,I));x(st)&&(ln(u,{...jo(f,st.x??0,st.y??0),x:U,y:S}),Ju(j,st))}}return!0}function ZE(t){return`zss_snapshot_${t}`}function d5(t,e,n,r){const i=tn(w.book,_t.BOARD,t),s=Le(i);if(!x(s))return;const o=ZE(s.id);dE(w.book,o);const a=_s(Dt.CONTENT,o,_t.BOARD),c=Le(a);if(x(c))return ip(t,c.id,e,n,r),c}function p5(t,e,n,r){const i=tn(w.book,_t.BOARD,t),s=Le(i);if(!x(s))return;const o=ZE(s.id),a=tn(w.book,_t.BOARD,o),c=Le(a);if(x(c))return ip(c.id,t,e,n,r),c}function m5(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return g5(t,e,i)}if(!x(w.book))return;const s=w.book,o=tn(s,_t.BOARD,t),a=Le(o);if(!x(a))return;const c=xd();He(s,a);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let f=!1,d=!1;switch(i){case"all":f=!0,d=!0;break;case"object":f=!0;break;case"terrain":d=!0;break}const h=(u+e.x+Ot)%Ot,p=(l+e.y+Jt)%Jt;if(f){const m=ge(a,{x:u,y:l});yn(m)&&x(m==null?void 0:m.x)&&x(m==null?void 0:m.y)&&(m.x=h,m.lx=h,m.y=p,m.ly=p)}d&&(c.terrain[h+p*Ot]=a.terrain[u+l*Ot])}(i==="all"||i==="terrain")&&(a.terrain=[...c.terrain]),Wu(s,a)}function g5(t,e,n){if(!x(w.book))return;const r=w.book,i=tn(r,_t.BOARD,t),s=Le(i);if(!x(s))return;He(r,s);const{objectelements:o,terrainelements:a}=uF(r,s,n);let c=!1;const l={};for(let f=0;f<a.length;++f){const d=a[f],h=bn(r,d,"collision"),p={x:d.x??-1,y:d.y??-1},m=ge(s,p);yn(m)&&x(m)&&(l[m.id??""]=!0);const b={x:p.x+e.x,y:p.y+e.y};if(Kl(b)){const y=ge(s,b),k=us(r,y),A=bn(r,y,"collision");yn(y)&&n!==k?zo(h,A)?c=!0:bn(r,y,"pushable")?c=ca(r,s,y,b)!==!0:c=!1:A===Wt.ISSOLID&&n!==k&&(c=!0)}else c=!0}if(c)return;for(let f=0;f<o.length;++f){const d=o[f],h=bn(r,d,"collision"),p={x:d.x??0,y:d.y??0},m={x:p.x+e.x,y:p.y+e.y};if(Kl(m)){const b=ge(s,m),y=us(r,b),k=bn(r,b,"collision");yn(b)&&x(b)&&n!==y&&!l[b.id??""]?bn(r,b,"pushable")?c=ca(r,s,b,m)!==!0:c=!0:zo(h,k)&&n!==y&&(c=!0)}else c=!0}if(c)return;(e.x>0||e.y>0)&&a.reverse();for(let f=0;f<a.length;++f){const d=a[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y},m=jo(s,p.x,p.y);if(x(d)&&x(m)){ln(s,{...d,x:p.x,y:p.y}),ln(s,{...m,x:h.x,y:h.y});const b=ge(s,h);yn(b)&&x(b)&&(b.x=(b.x??0)+e.x,b.y=(b.y??0)+e.y,b.lx=(b.lx??0)+e.x,b.ly=(b.ly??0)+e.y)}}Wu(r,s);for(let f=0;f<o.length;++f){const d=o[f],h={x:d.x??-1,y:d.y??-1},p={x:h.x+e.x,y:h.y+e.y};if(!ca(r,s,d,p))break}Wu(r,s)}function ea(t,e){let n="all";const r={x:0,y:0},i={x:Ot-1,y:Jt-1};for(let s=e;s<t.length;){const[o,a]=rt(t,s,[$.MAYBE_NUMBER_OR_STRING]);if(wt(o))n=It(o),s=a;else if(Rt(o)){const[c,l,u,f]=rt(t,a,[$.NUMBER,$.NUMBER,$.NUMBER]);r.x=Math.min(o,l),r.y=Math.min(c,u),i.x=Math.max(o,l),i.y=Math.max(c,u),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const _5=ji().command("snapshot",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const n=ea(e,0);return d5(w.board.id,n.pt1,n.pt2,n.targetset),0}).command("revert",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const n=ea(e,0);return p5(w.board.id,n.pt1,n.pt2,n.targetset),0}).command("copy",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=rt(e,0,[$.NAME]),i=jn(w.book,_t.BOARD,n),s=Te(...i);if(x(s)){const o=ea(e,r);ip(s.id,w.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r,i,s]=rt(e,0,[$.NAME,$.NUMBER,$.NUMBER]),o=jn(w.book,_t.BOARD,n),a=Te(...o);if(x(a)){const c=ea(e,s);VE(w.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{var o,a;if(!x(w.book)||!x(w.board))return 0;const[n,r]=rt(e,0,[$.DIR]),i={x:n.destpt.x-(((o=w.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=w.element)==null?void 0:a.y)??0)},s=ea(e,r);return m5(w.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(t,e)=>{if(!x(w.book)||!x(w.board))return 0;const[n,r]=rt(e,0,[$.NUMBER]),i=ea(e,r);return i5(w.board.id,fy(n),i.pt1,i.pt2,i.targetset),0});var ms=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(ms||{});const y5={audio:G0,board:kF,cli:k$,display:T$,element:L$,runtime:n5,loader:t5,network:e5,transform:_5},sp=["audio","board","display","network","transform","element"],b5={0:[],1:["cli",...sp],2:["loader",...sp],3:["runtime",...sp]},w5={0:new Map,1:new Map,2:new Map,3:new Map};function na(t){return(b5[t]??[]).map(n=>y5[n]).filter(x)}function op(t){const e=[],n=na(t);for(let r=0;r<n.length;++r)e.push(...n[r].listcommands());return e}function E5(t,e){const n=w5[t];if(!n.has(e)){let r;const i=na(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!x(r));++s);n.set(e,r)}return n.get(e)}function x5(t,e,n){const r=na(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,n);if(o)return[o,a]}}return[!1,void 0]}function v5(t,e,n,r){const i=na(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,n,r);if(a)return[a,r]}}return[!1,void 0]}function k5(t,e){const n=na(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function XE(t,e){const n=na(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var qE={},JE={},QE={};const tx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");QE.encode=function(t){if(0<=t&&t<tx.length)return tx[t];throw new TypeError("Must be between 0 and 63: "+t)};const T5=QE,ex=5,nx=1<<ex,A5=nx-1,R5=nx;function S5(t){return t<0?(-t<<1)+1:(t<<1)+0}JE.encode=function(e){let n="",r,i=S5(e);do r=i&A5,i>>>=ex,i>0&&(r|=R5),n+=T5.encode(r);while(i>0);return n};var Nc={};(function(t){function e(R,S,U){if(S in R)return R[S];if(arguments.length===3)return U;throw new Error('"'+S+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const S=R.match(n);return S?{scheme:S[1],auth:S[2],host:S[3],port:S[4],path:S[5]}:null}t.urlParse=i;function s(R){let S="";return R.scheme&&(S+=R.scheme+":"),S+="//",R.auth&&(S+=R.auth+"@"),R.host&&(S+=R.host),R.port&&(S+=":"+R.port),R.path&&(S+=R.path),S}t.urlGenerate=s;const o=32;function a(R){const S=[];return function(U){for(let D=0;D<S.length;D++)if(S[D].input===U){const Y=S[0];return S[0]=S[D],S[D]=Y,S[0].result}const N=R(U);return S.unshift({input:U,result:N}),S.length>o&&S.pop(),N}}const c=a(function(S){let U=S;const N=i(S);if(N){if(!N.path)return S;U=N.path}const D=t.isAbsolute(U),Y=[];let L=0,I=0;for(;;)if(L=I,I=U.indexOf("/",L),I===-1){Y.push(U.slice(L));break}else for(Y.push(U.slice(L,I));I<U.length&&U[I]==="/";)I++;let E=0;for(I=Y.length-1;I>=0;I--){const B=Y[I];B==="."?Y.splice(I,1):B===".."?E++:E>0&&(B===""?(Y.splice(I+1,E),E=0):(Y.splice(I,2),E--))}return U=Y.join("/"),U===""&&(U=D?"/":"."),N?(N.path=U,s(N)):U});t.normalize=c;function l(R,S){R===""&&(R="."),S===""&&(S=".");const U=i(S),N=i(R);if(N&&(R=N.path||"/"),U&&!U.scheme)return N&&(U.scheme=N.scheme),s(U);if(U||S.match(r))return S;if(N&&!N.host&&!N.path)return N.host=S,s(N);const D=S.charAt(0)==="/"?S:c(R.replace(/\/+$/,"")+"/"+S);return N?(N.path=D,s(N)):D}t.join=l,t.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,S){R===""&&(R="."),R=R.replace(/\/$/,"");let U=0;for(;S.indexOf(R+"/")!==0;){const N=R.lastIndexOf("/");if(N<0||(R=R.slice(0,N),R.match(/^([^\/]+:\/)?\/*$/)))return S;++U}return Array(U+1).join("../")+S.substr(R.length+1)}t.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(R){return R}function h(R){return m(R)?"$"+R:R}t.toSetString=f?d:h;function p(R){return m(R)?R.slice(1):R}t.fromSetString=f?d:p;function m(R){if(!R)return!1;const S=R.length;if(S<9||R.charCodeAt(S-1)!==95||R.charCodeAt(S-2)!==95||R.charCodeAt(S-3)!==111||R.charCodeAt(S-4)!==116||R.charCodeAt(S-5)!==111||R.charCodeAt(S-6)!==114||R.charCodeAt(S-7)!==112||R.charCodeAt(S-8)!==95||R.charCodeAt(S-9)!==95)return!1;for(let U=S-10;U>=0;U--)if(R.charCodeAt(U)!==36)return!1;return!0}function b(R,S,U){let N=k(R.source,S.source);return N!==0||(N=R.originalLine-S.originalLine,N!==0)||(N=R.originalColumn-S.originalColumn,N!==0||U)||(N=R.generatedColumn-S.generatedColumn,N!==0)||(N=R.generatedLine-S.generatedLine,N!==0)?N:k(R.name,S.name)}t.compareByOriginalPositions=b;function y(R,S,U){let N=R.generatedLine-S.generatedLine;return N!==0||(N=R.generatedColumn-S.generatedColumn,N!==0||U)||(N=k(R.source,S.source),N!==0)||(N=R.originalLine-S.originalLine,N!==0)||(N=R.originalColumn-S.originalColumn,N!==0)?N:k(R.name,S.name)}t.compareByGeneratedPositionsDeflated=y;function k(R,S){return R===S?0:R===null?1:S===null?-1:R>S?1:-1}function A(R,S){let U=R.generatedLine-S.generatedLine;return U!==0||(U=R.generatedColumn-S.generatedColumn,U!==0)||(U=k(R.source,S.source),U!==0)||(U=R.originalLine-S.originalLine,U!==0)||(U=R.originalColumn-S.originalColumn,U!==0)?U:k(R.name,S.name)}t.compareByGeneratedPositionsInflated=A;function T(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=T;function C(R,S,U){if(S=S||"",R&&(R[R.length-1]!=="/"&&S[0]!=="/"&&(R+="/"),S=R+S),U){const N=i(U);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const D=N.path.lastIndexOf("/");D>=0&&(N.path=N.path.substring(0,D+1))}S=l(s(N),S)}return c(S)}t.computeSourceURL=C})(Nc);var ap={};let O5=class jx{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new jx;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};ap.ArraySet=O5;var rx={};const ix=Nc;function I5(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||ix.compareByGeneratedPositionsInflated(t,e)<=0}let N5=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){I5(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(ix.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};rx.MappingList=N5;const Cc=JE,Ge=Nc,Qu=ap.ArraySet,C5=rx.MappingList;let sx=class zx{constructor(e){e||(e={}),this._file=Ge.getArg(e,"file",null),this._sourceRoot=Ge.getArg(e,"sourceRoot",null),this._skipValidation=Ge.getArg(e,"skipValidation",!1),this._sources=new Qu,this._names=new Qu,this._mappings=new C5,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new zx({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ge.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=Ge.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=Ge.getArg(e,"generated"),r=Ge.getArg(e,"original",null);let i=Ge.getArg(e,"source",null),s=Ge.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=Ge.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ge.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ge.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=Ge.relative(s,i));const o=this._mappings.toArray().length>0?new Qu:this._sources,a=new Qu;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=Ge.join(r,c.source)),s!=null&&(c.source=Ge.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=Ge.join(r,c)),s!=null&&(c=Ge.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,p=d.length;h<p;h++){if(l=d[h],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Ge.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Cc.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Cc.encode(f-o),o=f,c+=Cc.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Cc.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Cc.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ge.relative(n,r));const i=Ge.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};sx.prototype._version=3,qE.SourceMapGenerator=sx;var ox={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(ox);var Lc={exports:{}},L5={},M5=Object.freeze({__proto__:null,default:L5}),ax=Kx(M5);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;Lc.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Lc.exports.initialize=e=>t=e}else{const t=ax,e=ax;Lc.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Lc.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var cx=Lc.exports;const U5=cx;function F5(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Mc=null;var P5=function(){if(Mc)return Mc;const e=[];return Mc=U5().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new F5;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),e[e.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw Mc=null,n}),Mc};const Tt=Nc,cp=ox,th=ap.ArraySet,B5=cx,D5=P5,lp=Symbol("smcInternal");class ze{constructor(e,n){return e==lp?Promise.resolve(this):j5(e,n)}static initialize(e){B5.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return z5(e,n)}static async with(e,n,r){const i=await new ze(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ze.prototype._version=3,ze.GENERATED_ORDER=1,ze.ORIGINAL_ORDER=2,ze.GREATEST_LOWER_BOUND=1,ze.LEAST_UPPER_BOUND=2;class Uc extends ze{constructor(e,n){return super(lp).then(r=>{let i=e;typeof e=="string"&&(i=Tt.parseSourceMapInput(e));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const l=Tt.getArg(i,"sourcesContent",null),u=Tt.getArg(i,"mappings"),f=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(d){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(d)?Tt.relative(c,d):d}),r._names=th.fromArray(a.map(String),!0),r._sources=th.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return Tt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,D5().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new Uc(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||ze.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case ze.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ze.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=Tt.getArg(e,"source");const r=Tt.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:Tt.getArg(e,"line"),generatedColumn:Tt.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(e,"bias",ze.GREATEST_LOWER_BOUND);r==null&&(r=ze.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=Tt.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(e,"line"),originalColumn:Tt.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(e,"bias",ze.GREATEST_LOWER_BOUND);i==null&&(i=ze.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Uc.prototype.consumer=ze;class $5 extends ze{constructor(e,n){return super(lp).then(r=>{let i=e;typeof e=="string"&&(i=Tt.parseSourceMapInput(e));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new th,r._names=new th,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Tt.getArg(c,"offset"),u=Tt.getArg(l,"line"),f=Tt.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ze(Tt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(Tt.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:Tt.getArg(e,"line"),generatedColumn:Tt.getArg(e,"column")},r=cp.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||ze.GENERATED_ORDER;let o;switch(s){case ze.GENERATED_ORDER:o=this._generatedMappings;break;case ze.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Tt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return cp.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=Tt.getArg(e,"line"),r={source:Tt.getArg(e,"source"),originalLine:n,originalColumn:Tt.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,cp.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function j5(t,e){let n=t;typeof t=="string"&&(n=Tt.parseSourceMapInput(t));const r=n.sections!=null?new $5(n,e):new Uc(n,e);return Promise.resolve(r)}function z5(t,e){return Uc.fromSourceMap(t,e)}var lx={};const K5=qE.SourceMapGenerator,eh=Nc,W5=/(\r?\n)/,H5=10,ra="$$$isSourceNode$$$";let G5=class xp{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[ra]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new xp,s=e.split(W5);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const p=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=eh.join(r,h)),i.setSourceContent(h,p))}),i;function d(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?eh.join(r,h.source):h.source;i.add(new xp(h.originalLine,h.originalColumn,m,p,h.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[ra]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[ra]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[ra]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[ra]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[eh.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][ra]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(eh.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new K5(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===H5?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};lx.SourceNode=G5;var Y5=lx.SourceNode;let ux=0;const hx=fi,V5=["Command","lines"];class Z5 extends RU{constructor(){super(rE,{traceInitPerf:fi,skipValidations:!fi,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Mt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Mt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Tc)}])}));Mt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Mt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Mt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Mt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Iw)}));Mt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(v0)}));Mt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(k0)}])}));Mt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Ow)}));Mt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Nw),this.SUBRULE(this.words),this.CONSUME(Cw)}));Mt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Xo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Mt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Mt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Mt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Mt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(I0),this.SUBRULE(this.words)}));Mt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Hw),this.SUBRULE(this.words)}));Mt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(N0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Mt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Tc)),this.CONSUME4(Xo),this.CONSUME4(C0)}}])}));Mt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Xo),this.CONSUME(C0)}}])}));Mt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Bu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Mt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Xo),this.CONSUME(L0),this.CONSUME(N0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Mt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Xo),this.CONSUME(L0),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Mt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(Xw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Mt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(qw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Mt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Jw),this.SUBRULE(this.words)}));Mt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(Qw),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Mt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(tE)}));Mt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(eE)}));Mt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Vw)}));Mt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Zw)}));Mt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(T0),this.SUBRULE2(this.and_test)})}));Mt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(R0),this.SUBRULE2(this.not_test)})}));Mt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(A0),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Mt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Mt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME($w)}])}));Mt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(T0),this.SUBRULE2(this.and_test_value)})}));Mt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(R0),this.SUBRULE2(this.not_test_value)})}));Mt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(A0),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Mt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Mt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(S0)},{ALT:()=>this.CONSUME(O0)}]),this.SUBRULE(this.term)}));Mt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Mt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(I0)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(Ww)}]),this.SUBRULE(this.factor)}));Mt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(S0)},{ALT:()=>this.CONSUME(O0)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Mt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(jw),this.SUBRULE(this.factor)})}));Mt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Mt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(mn)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>{this.CONSUME(Gw),this.SUBRULE(this.words),this.CONSUME(Yw)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=V5.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(ux++).toString().padStart(3),c=s?"font-weight: bold;":"";if(hx&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),hx&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),ux--},i)}}const ia=new Z5;if($U){const t=ia.getGAstProductions(),e=DU(t);console.info(e)}const X5=ia.getBaseCstVisitorConstructor();var yt=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(yt||{}),Js=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Js||{}),di=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(di||{}),nh=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(nh||{});function kr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class q5 extends X5{constructor(){super();Mt(this,"unique",0);fi&&this.validateVisitor()}visit(n){if(se(n)&&(n=n[0]),!!x(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:kr(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:kr(n.token_stat,"@").slice(1)}))}stmt_text(n,r){return this.createlinenode(r,this.createcodenode(r,{type:6,value:kr(n.token_text,"")}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:kr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:kr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n,r){return n.words?this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,kr(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=Me(),s=Me();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=Me(),s=Me();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,kr(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){return this.createcodenode(r,{type:17,lines:this.go(n.command_fork)})}command_while(n,r){const i=Me(),s=Me();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=Me(),s=Me(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=Me(),s=Me(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=Me();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=kr(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}))}command_toast(n,r){const s=kr(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"toast"),this.createstringnode(r,s)].flat()}))}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}token(n,r){if(n.token_stringliteraldouble){const i=kr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=kr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(kr(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return n.token_lparen?this.createcodenode(r,{type:31,words:this.go(n.words)}):[]}}const J5=new q5,Kn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},rh="zss.js";function te(t,e){return new Y5(t.startLine??1,t.startColumn??1,rh,e)}function up(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function hp(t){return`'${up(t)}'`}function ih(t){if(t.startsWith('"'))return ih(t.replaceAll(/(^"|"$)/g,""));const e=J0(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===X0?`', api.get('${up(r.image.substring(1))}'), '`:up(r.image)).join("")}'].join('')`}function sa(t){return t.filter(e=>e!==void 0).map(ie)}function fx(t){return te(t,"")}function Q5(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function en(t,e,n){return te(t,[`api.${e}(`,...Q5(n,", "),")"])}function t4(t){if(t.type===yt.COMPARE&&t.compare.type===yt.COMPARE_ITEM)switch(t.compare.method){case Js.IS_EQ:return en(t,"isEq",[ie(t.lhs),ie(t.rhs)]);case Js.IS_NOT_EQ:return en(t,"isNotEq",[ie(t.lhs),ie(t.rhs)]);case Js.IS_LESS_THAN:return en(t,"isLessThan",[ie(t.lhs),ie(t.rhs)]);case Js.IS_GREATER_THAN:return en(t,"isGreaterThan",[ie(t.lhs),ie(t.rhs)]);case Js.IS_LESS_THAN_OR_EQ:return en(t,"isLessThanOrEq",[ie(t.lhs),ie(t.rhs)]);case Js.IS_GREATER_THAN_OR_EQ:return en(t,"isGreaterThanOrEq",[ie(t.lhs),ie(t.rhs)])}return te(t,"")}function Qs(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",ie(n),")"])}function dx(t,e,n){return t.prepend(`api.${e}(`),t.add([ie(n),")"])}function e4(t,e){if(t.type===yt.OPERATOR_ITEM)switch(t.operator){case di.PLUS:return Qs(e,"opPlus",t.rhs);case di.MINUS:return Qs(e,"opMinus",t.rhs);case di.POWER:return Qs(e,"opPower",t.rhs);case di.MULTIPLY:return Qs(e,"opMultiply",t.rhs);case di.DIVIDE:return Qs(e,"opDivide",t.rhs);case di.MOD_DIVIDE:return Qs(e,"opModDivide",t.rhs);case di.FLOOR_DIVIDE:return Qs(e,"opFloorDivide",t.rhs);case di.UNI_PLUS:return dx(e,"opUniPlus",t.rhs);case di.UNI_MINUS:return dx(e,"opUniMinus",t.rhs)}return te(t,"")}function n4(t){if(t.type===yt.OPERATOR){const e=t.lhs?ie(t.lhs):te(t,"");return t.items.forEach(n=>e4(n,e)),e}return te(t,"")}function sh(t,e){return te(t,[en(t,"jump",[`${e}`]),"; continue;"])}function Ki(t){return Kn.linelookup[t??""]??-1}function fp(t,e){Kn.linelookup[t]=e}function oa(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&(i.done=n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&(i.skip=n);break;case yt.LINE:oa(i.stmts,e,n);break}}}function px(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===e&&fp(i.done,n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===e&&fp(i.skip,n);break;case yt.LINE:px(i.stmts,e,n);break}}}function ie(t){var e;switch(t.type){case yt.PROGRAM:return te(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(ie).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${rh}`]);case yt.API:return te(t,["  ",en(t,t.method,sa(t.words)),`;
`]);case yt.LINE:return te(t,[`case ${t.lineindex}:
`,...t.stmts.map(ie).flat(),`  break;
`]);case yt.MARK:return te(t,`  // ${t.comment}
`);case yt.GOTO:{const n=Ki(t.id);return te(t,["  ",sh(t,n),`
`])}case yt.COUNT:return te(t,`${t.index}`);case yt.LITERAL:switch(t.literal){case nh.NUMBER:return te(t,`${t.value}`);case nh.STRING:return te(t,hp(t.value));case nh.TEMPLATE:return te(t,ih(t.value))}return fx(t);case yt.TEXT:return te(t,["  ",en(t,"text",[ih(t.value)]),`;
`]);case yt.STAT:if(Kn.isfirststat){Kn.isfirststat=!1;const n=t.value.trim().split(" ").map(hp);return te(t,["  ",en(t,"stat",n),`;
`])}return te(t,`  // skipped ${t.value}
`);case yt.LABEL:{const n=It(t.name),r=t.active?"label":"comment";Kn.labels[n]||(Kn.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Kn.labels[n].push(i),te(t,`  // ${i} '${n}' ${r}
`)}case yt.HYPERLINK:return te(t,["  ",en(t,"hyperlink",[ih(t.text),...sa(t.link)]),`;
`]);case yt.MOVE:{const n=en(t,"command",[hp("go"),sa(t.words)].flat());return t.wait?te(t,["  if (",n,`) { continue; };
`]):te(t,["  ",n,`;
`])}case yt.COMMAND:return te(t,["  if (",en(t,"command",sa(t.words)),`) { continue; };
`]);case yt.IF:{const n=((e=t.block)==null?void 0:e.type)===yt.IF_BLOCK?t.block:void 0;if(x(n)){oa([t.check],yt.IF_CHECK,n.skip);const r=te(t,ie(t.check));return n.lines.forEach(i=>r.add(ie(i))),px(n.altlines,yt.ELSE_IF,Ki(n.done)),n.altlines.forEach(i=>r.add(ie(i))),r}return te(t,ie(t.check))}case yt.IF_CHECK:{const n=Ki(t.skip);return n===-1?te(t,["  ",en(t,t.method,sa(t.words)),`;
`]):te(t,["  if (!",en(t,t.method,sa(t.words)),") { ",sh(t,n),` }
`])}case yt.ELSE_IF:case yt.ELSE:{const n=te(t,"");return t.lines.forEach(r=>n.add(ie(r))),n}case yt.WHILE:{const n=Ki(t.loop),r=Ki(t.done),i=te(t,"");return oa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.REPEAT:{const n=Ki(t.loop),r=Ki(t.done),i=te(t,"");return oa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.WAITFOR:{const n=te(t,"");return oa(t.lines,yt.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(ie(r))}),n}case yt.FOREACH:{const n=Ki(t.loop),r=Ki(t.done),i=te(t,"");return oa(t.lines,yt.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case yt.BREAK:return te(t,["  ",sh(t,t.goto),`
`]);case yt.CONTINUE:return te(t,["  ",sh(t,t.goto),`
`]);case yt.OR:return en(t,"or",t.items.map(ie));case yt.AND:return en(t,"and",t.items.map(ie));case yt.NOT:return en(t,"not",t.items.map(ie));case yt.COMPARE:return t4(t);case yt.OPERATOR:return n4(t);case yt.EXPR:return en(t,"expr",t.words.map(ie));default:return console.error("<unsupported node>",t.type,t),fx(t)}}function pi(t){if(x(t))switch(t.type===yt.LINE&&++Kn.lineindex,t.lineindex=Kn.lineindex,t.type){case yt.PROGRAM:t.lines.forEach(pi);break;case yt.LINE:t.stmts.forEach(pi);break;case yt.MARK:fp(t.id,t.lineindex);break;case yt.IF:pi(t.check),pi(t.block);break;case yt.IF_BLOCK:t.lines.forEach(pi),t.altlines.forEach(pi);break;case yt.ELSE_IF:t.lines.forEach(pi);break;case yt.ELSE:case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.WAITFOR:t.lines.forEach(pi);break;case yt.MOVE:case yt.COMMAND:case yt.IF_CHECK:t.words.forEach(pi);break}}function r4(t){Kn.labels={},Kn.internal=1,Kn.lineindex=0,Kn.isfirststat=!0,pi(t)}function i4(t){return r4(t),{...ie(t).toStringWithSourceMap({file:`${rh}.map`}),...Kn}}function mx(t){return se(t)?t.length>0?1:0:t??0}function s4(t){return`${t}_chip`}function gx(t=""){return`vm:${t??""}`}function o4(t,e,n){var l,u;const r=s4(t),i=Tr(r);let s;const o=Yn(Object.entries(n.labels??{}));(!se(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){w.words=d;const h=E5(e,f);return x(h)?h(c,d):f!=="send"?a("send",[f,...d]):0}const c={halt(){x4(r)},id(){return t},set(f,d){const[h,p]=v5(e,c,f,d);if(h)return p},get(f){const[d,h]=x5(e,c,f);if(d)return h},tick(f){const d=Rt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return XE(e,c),!1;i.lc=0,i.ys=0,w.get=c.get,k5(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){he(nt,w.elementfocus,"crash",p.message),i.es=1}return XE(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Rt(i.lc)?++i.lc>Fi.HALT_AT_COUNT:!0},hm(){if(se(i.mg)&&se(i.lb)){const[f]=i.mg;if(x(f))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)return p.find(m=>Rt(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,p){nt.emit(f,`${gx(d)}:${h}`,p)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(se(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f){const m=p.findIndex(b=>b>0);m>=0&&(p[m]*=-1)}}},restore(f){if(se(i.lb))for(let d=0;d<i.lb.length;++d){const[h,p]=i.lb[d];if(h===f)for(let m=0;m<p.length;m++)p[d]=Math.abs(p[d])}},getcase(){i.ec=Rt(i.ec)?i.ec:1;const f=c.hm();if(f&&se(i.mg)){const[,d,h,p]=i.mg;c.set("sender",h),x(d)&&c.set("arg",d),p&&(c.set("player",p),w.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=Rt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=dF.parse(f),[h]=d.filter(p=>p.fileName===rh);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(be(d)),h)},if(...f){const[d,h]=rt(f,0,[$.ANY]),p=mx(d);return p&&h<f.length&&c.command(...f.slice(h)),p?1:0},try(...f){const[,d]=rt(f,0,[$.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,p]=rt(f,0,[$.NAME,$.ANY]),m=Rt(h),b=m?p:1,y=c.get(d),k=m?h:1;if(!Rt(y))return b<f.length&&c.command(...f.slice(b)),1;const A=y-k;return A<0?(b<f.length&&c.command(...f.slice(b)),1):(c.set(d,A),0)},give(...f){const[d,h,p]=rt(f,0,[$.NAME,$.ANY]),m=Rt(h),b=m?p:1,y=c.get(d),k=m?h:1,A=y===void 0?1:0;return A&&b<f.length&&c.command(...f.slice(b)),c.set(d,Rc(y,0)+k),A},repeatstart(f,...d){const[h,p]=rt(d,0,[$.NUMBER]),m=`repeatcount${f}`,b=`repeatwords${f}`;i[m]=h,i[b]=p<d.length?d.slice(p):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!Rt(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,b=i[h];return m&&se(b)&&c.command(...b),m?1:0},foreachstart(f,...d){const[h,p,m,b]=rt(d,0,[$.NAME,$.NUMBER,$.NUMBER,$.MAYBE_NUMBER]);let y=Math.min(p,m),k=Math.max(p,m);const A=(b??0)||1;if(A<0){const T=y;y=k,k=T}return c.set(h,y-A),0},foreach(f,...d){const[h,p,m,b,y]=rt(d,0,[$.NAME,$.NUMBER,$.NUMBER,$.MAYBE_NUMBER]);let k=Math.min(p,m),A=Math.max(p,m);const T=(b??0)||1;if(T<0){const S=k;k=A,A=S}let C=c.get(h);!Rt(C)||C<k||C>A?C=k:C+=T;const R=C<=A?1:0;return R&&(c.set(h,C),y<d.length&&c.command(...d.slice(y))),R},waitfor(...f){const[d]=rt(f,0,[$.ANY]),h=mx(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[$.ANY]);if(d=p,d)break;h=m}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[p,m]=rt(f,h,[$.ANY]);if(d=p,!d)break;h=m}return d},not(...f){const[d]=rt(f,0,[$.ANY]);return d?0:1},expr(...f){const[d]=rt(f,0,[$.ANY]);return d},isEq(f,d){const[h]=rt([f],0,[$.ANY]),[p]=rt([d],0,[$.ANY]);return typeof h=="object"||typeof p=="object"?xv(h,p)?1:0:h===p?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h<p?1:0},isGreaterThan(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h>p?1:0},isLessThanOrEq(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h<=p?1:0},isGreaterThanOrEq(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h>=p?1:0},opPlus(f,d){const[h]=rt([f],0,[$.ANY]),[p]=rt([d],0,[$.ANY]);return h+p},opMinus(f,d){const[h]=rt([f],0,[$.ANY]),[p]=rt([d],0,[$.ANY]);return h-p},opPower(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return Math.pow(h,p)},opMultiply(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h*p},opDivide(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h/p},opModDivide(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return h%p},opFloorDivide(f,d){const[h]=rt([f],0,[$.NUMBER]),[p]=rt([d],0,[$.NUMBER]);return Math.floor(h/p)},opUniPlus(f){const[d]=rt([f],0,[$.NUMBER]);return+d},opUniMinus(f){const[d]=rt([f],0,[$.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function dp(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];se(r)?r.forEach(i=>{e.push(dp(i))}):e.push(dp(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function a4(t){const e=M0(`${t}
`);if(e.errors.length>0)return e;ia.input=e.tokens;const n=ia.program();if(ia.errors.length>0)return{tokens:e.tokens,errors:ia.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=J5.go(n);return r?(dp(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const pp=Object.getPrototypeOf(function*(){}).constructor;function c4(t,e){const n=`compile-${t}`;console.time(n);const r=a4(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=i4(r.ast);if(i.code){jU&&console.info(i.code);try{return{...r,...i,source:i.code,code:new pp("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new pp("api"," ")}}}return{...r,...i,source:"",code:new pp("api"," ")}}function l4(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=c4(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return x(s)?s.isended():!0},halt(i){const s=e[i];return x(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!x(e[i])){const f=n(a,c);if(l=e[i]=o4(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((y,k)=>[y,k]);p.slice(h-5,h).forEach(([y,k])=>{he(nt,or(),"build",`$grey${k+1} $grey${y}`)});const[m,b]=p[h]??[];if(wt(m)&&x(b)){const y=(d.column??1)-1,k=y+d.length,A=y<m.length?m:`${m}*`,T=A.substring(0,y),C=A.substring(y,k),R=A.substring(k);he(nt,or(),"build",`$red${b+1} $grey${T}$red${C}$grey${R}`)}return d.message.split(`
`).forEach(y=>{he(nt,or(),"build",y)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Vn(i.target),a=e[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}let _x=0;function u4(){switch(_x++){case 0:return St.BLUE;case 1:return St.BLACK;case 2:return St.GREEN;case 3:return St.BLACK;case 4:return St.CYAN;case 5:return St.BLACK;case 6:return St.RED;case 7:return St.BLACK;case 8:return St.PURPLE;case 9:return St.BLACK;case 10:return St.YELLOW;case 11:return St.BLACK;case 12:return St.WHITE;default:return _x=0,St.BLACK}}const Ye=new Za,On={},oh={};function yx(t,e,n,r,i=0){const s=`tiles:${t}:${e}`;return x(On[s])||(On[s]=oN(t,e,n,r,i)),On[s]}function h4(t,e,n,r){const i=`sprites:${t}:${e}:${n}`,s=`sprite:${t}:${e}:${r}`;return x(oh[s])||(oh[s]=aN(t,e,n)),oh[s].id=i,oh[s]}function f4(t,e){const n=`sprites:${t}:${e}`;return x(On[n])||(On[n]=cN(t,e)),On[n]}function d4(t,e,n,r,i=0){const s=`dither:${t}:${e}`;return x(On[s])||(On[s]=lN(t,e,n,r,i)),On[s]}function ah(t,e,n,r){const i=`media:${t}:${e}`;x(On[i])||(On[i]=uN(t,e,n,r));const s=On[i];return s.mime=n,s.media=r,s}function p4(t,e){const n=`control:${t}:${e}`;return x(On[n])||(On[n]=hN(t,e)),On[n]}const gs=.4;function bx(t,e){const n=[];Ye.x=t-gs,Ye.y=e-gs,n.push(Ye.angle()),Ye.x=t+gs,Ye.y=e-gs,n.push(Ye.angle()),Ye.x=t-gs,Ye.y=e+gs,n.push(Ye.angle()),Ye.x=t+gs,Ye.y=e+gs,n.push(Ye.angle());const r=Math.round(ad(Math.min(...n))),i=Math.round(ad(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function mp(t,e,n,r,i,s){var S;if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const o=[];let a=e;const c=Ot,l=Jt,u=s?St.BLACK:St.ONCLEAR,f=yx(t,a++,c,l,u);o.push(f);const d=a++,h=f4(t,d);h.sprites=[],o.push(h);const p=r.isdark?1:0,m=d4(t,a++,c,l,p);o.push(m),m.alphas.fill(p);const b=yx(t,a++,c,l,St.ONCLEAR);o.push(b),b.char.fill(0);const y={...Q0(Ot,Jt,u4(),St.ONCLEAR),...b},k=p4(t,a++);if(i){if(o.push(k),wt(r.camera))switch(It(r.camera)){default:case"mid":k.viewscale=Yl.MID;break;case"near":k.viewscale=Yl.NEAR;break;case"far":k.viewscale=Yl.FAR;break}if(wt(r.graphics)){const N=It(r.graphics);switch(N){case"mode7":case"firstperson":k.graphics=N;break;default:case"flat":k.graphics="flat";break}}const{facing:U}=Tr(t);Rt(U)&&(k.facing=fy(U%360))}for(let U=0;U<r.terrain.length;++U){const N=r.terrain[U],D=ju(n,N,0,St.WHITE,s?St.BLACK:St.ONCLEAR);f.char[U]=D.char,f.color[U]=D.color,f.bg[U]=D.bg}const A=Object.values(r.objects??{});for(let U=0;U<A.length;++U){const N=A[U];if(x(N.removed))continue;const D=N.id??"",Y=ju(n,N,1,St.WHITE,St.BLACK),L=h4(t,d,D,U);if(L.x=N.x??0,L.y=N.y??0,L.char=Y.char,L.color=Y.color,L.bg=Y.bg,h.sprites.push(L),p){if(Y.light>0){const I=[],E=Xe(Math.round(Y.light),1,Ot),B=E*.5,J=Mr(r,L),j=1/B;if(m.alphas[J]=0,E>1)for(let st=1;st<=E;++st)for(let tt=L.y-st;tt<=L.y+st;++tt)for(let ft=L.x-st;ft<=L.x+st;++ft){if(ft===L.x&&tt===L.y)continue;Ye.x=ft-L.x,Ye.y=tt-L.y;const V=Ye.length();if(V>E)continue;const W=Mr(r,{x:ft,y:tt});if(W===-1)continue;const Et=Math.round(ad(Ye.angle()));let at=0;for(let kt=0;kt<I.length;++kt){const $t=I[kt];Et>=$t[0]&&Et<=$t[1]&&(at=Math.max(at,$t[2]))}m.alphas[W]=Math.min(m.alphas[W],at+(V<B?0:(V-B)*j)),m.alphas[W]=Xe(m.alphas[W],0,1);const lt=Tn(r,((S=r.lookup)==null?void 0:S[W])??"");if(x(lt)){const kt=[...bx(Ye.x,Ye.y),.25];I.push(kt)}const Ut=r.terrain[W],Vt=jr(n,Ut),Ft=(Ut==null?void 0:Ut.collision)??(Vt==null?void 0:Vt.collision);if(zo(Wt.ISBULLET,Ft)){const kt=[...bx(Ye.x,Ye.y),1];let $t=0;for($t=0;$t<I.length;++$t){const Pt=I[$t];if(Pt[1]>Pt[0]&&kt[1]>=Pt[0]&&kt[0]<=Pt[1]&&kt[2]>=1&&Pt[2]>=1){I[$t]=[Math.min(kt[0],Pt[0]),Math.max(kt[1],Pt[1]),1];break}}$t===I.length&&I.push(kt)}}}else if(Rr(D)){const I=Mr(r,L);m.alphas[I]=0}}if(wt(N.tickertext)&&Rt(N.tickertime)&&N.tickertext.length){const I=Ot,E=OE(N.tickertext,I,Jt-1),B=(E==null?void 0:E.measuredwidth)??1,J=N.x??0,j=N.y??0,st=j<Jt*.5;y.x=J-Math.floor(B*.5),y.y=j+(st?1:-1),y.x+B>Ot&&(y.x=Ot-B),y.x<0&&(y.x=0),SE(N.tickertext,y,!0)}D===t&&(k.focusx=L.x,k.focusy=L.y,k.focusid=D)}o.push(ah(t,a++,"text/mood",p?"dark":"bright"));const T=ue(Dt.MAIN),C=$i(T,Dt.MAIN);if(wt(C.palette)){const U=tn(T,_t.PALETTE,C.palette),N=Le(U);x(N==null?void 0:N.bits)&&o.push(ah(t,a++,"image/palette",Array.from(N.bits)))}if(wt(C.charset)){const U=tn(T,_t.CHARSET,C.charset),N=Le(U);x(N==null?void 0:N.bits)&&o.push(ah(t,a++,"image/charset",Array.from(N.bits)))}const R=Object.keys(r.objects).filter(Rr);return o.push(ah(t,a++,"text/players",R.join(","))),o}const sr=l4();var Dt=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Dt||{});const xe={halt:!1,session:Me(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function m4(){return xe.session}function or(){return xe.operator}function g4(t){xe.operator=t}function _4(t){xe.halt=t}function y4(){return xe.halt}function aa(){return[...xe.books.values()]}function b4(){const[t]=xe.books.values();return t}function zr(t){const e=It(t);return xe.books.get(t)??aa().find(n=>n.name===e)}function ch(t,e){x(zr(e))&&(xe.software[t]=e)}function ue(t){return zr(xe.software[t])}function wx(t){const e=lE([]);return wt(t)&&(e.name=t),gp(e),fe(nt,xe.operator,`created [book] ${e.name}`),e}function w4(t){let e=zr(t);return x(e)||(e=lE([]),e.name=t),gp(e),fe(nt,xe.operator,`created [book] ${e.name}`),e}function En(t,e){let n=x(e)?w4(e):ue(t);return x(n)||(x(n)||(n=b4()),x(n)||(n=wx(e)),x(n)&&fe(nt,xe.operator,`opened [book] ${n.name} for ${t}`)),ch(t,n.id),n}function _s(t,e,n){return D0(En(t),n,e)}function Tr(t){const e=En("main");return $i(e,t)}function E4(t){const e=En("main");return QU(e,t)}function Ex(){const t=En("main");return $i(t,"main")}function x4(t){const e=En("main");return pE(e,t)}function v4(t,e){xe.books.clear(),t.forEach(r=>{xe.books.set(r.id,r),r.name==="main"&&(xe.software.main=r.id)});const n=zr(e);if(x(n)&&ch("main",n.id),!xe.software.main){const r=xe.books.values().next();r.value&&(xe.software.main=r.value.id)}}function gp(t){return xe.books.set(t.id,t),t.id}function k4(t){const e=zr(t);e&&xe.books.delete(e.id)}function xx(t){if(!wt(t)||!t)return he(nt,t,"login",`failed for playerid ==>${t}<==`);const e=ue("main");if(!x(e))return he(nt,t,"login:main","login failed to find book 'main'");const n=Zs(e,t);if(x(n))return!0;const r=jn(e,_t.BOARD,"title");if(r.length===0)return he(nt,t,"login:title","login failed to find board with 'title' stat");const i=qo(e,"player");if(!x(i))return he(nt,t,"login:player","login failed to find object type 'player'");const s=my(t,r),o=Le(s);if(x(o)){const a=cE(s,"startx"),c=cE(s,"starty"),l=Rt(a)?a:Math.round(Ot*.5),u=Rt(c)?c:Math.round(Jt*.5),f=i.name??"player",d=Td(o,{x:l,y:u},f,t);if(x(d==null?void 0:d.id))return d.player=t,Ku(e,t,o.id),!0}return!1}function T4(t){const e=ue("main"),n=Zs(e,t);Ku(e,t,""),j0(e,n,Tn(n,t)),Jy(n,t),sr.halt(t),pE(e,t)}function ar(t){const e=ue("main");return Zs(e,t)}function A4(t){const e=ue("main"),n=eF(e,t),r=Zs(e,t),i=Tn(r,t);return n&&x(i)}function R4(t){const e=ue("main"),n=$0(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Rr(c)&&x(t[c])===!1&&(t[c]=0,Ku(e,c,i.id))}}}function vx(t){sr.message(t)}function Fc(t,e,n,r){const i=is(e);wt(n.id)&&nt.emit(t,"vm:touched",[n.id,i,r])}function ca(t,e,n,r){if(!x(n==null?void 0:n.id))return!1;const i=W0(t,e,n,r);if(x(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=jn(t,_t.BOARD,(e==null?void 0:e.exitwest)??"");if(o.length){const a=Te(o);Jo(t,n.id,a.id,{x:Ot-1,y:r.y})}}else if(r.x>=Ot){const o=jn(t,_t.BOARD,(e==null?void 0:e.exiteast)??"");if(o.length){const a=Te(o);Jo(t,n.id,a.id,{x:0,y:r.y})}}else if(r.y<0){const o=jn(t,_t.BOARD,(e==null?void 0:e.exitnorth)??"");if(o.length){const a=Te(o);Jo(t,n.id,a.id,{x:r.x,y:Jt-1})}}else if(r.y>=Jt){const o=jn(t,_t.BOARD,(e==null?void 0:e.exitsouth)??"");if(o.length){const a=Te(o);Jo(t,n.id,a.id,{x:r.x,y:0})}}}else Fc("",i,n,"thud");if(n.kind==="player"){const o=Rr(i.id);Fc(n.id,n,i,o?"bump":"touch")}else if(n.collision===Wt.ISBULLET){const o=Rr(n.party),a=Rr(i.id);o!==a?Fc(n.party??"",n,i,"shot"):Fc("",n,i,"thud")}else Fc("",n,i,"bump");const s=jr(t,i);return i.destructible??(s==null?void 0:s.destructible)?(x(i==null?void 0:i.id)?ir(w.book,w.board,i,w.timestamp):ln(e,{x:r.x,y:r.y}),!0):!1}return!0}function kx(t,e,n,r,i=aR){var f;if(!x(t)||!x(e)||!x(n))return;const s={...w};w.book=t,w.board=e,w.element=n,w.elementid=n.id??"",w.elementisplayer=Rr(w.elementid);const o=w.element.player??xe.operator;w.elementfocus=w.elementisplayer?w.elementid:o;const a=jr(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=It(n.name??((f=n.kinddata)==null?void 0:f.name)??"");if(sr.tick(l,ms.RUNTIME,Rt(c)?c:i,u,r),Rt(n==null?void 0:n.tickertime)&&w.timestamp-n.tickertime>rl*5&&(n.tickertime=0,n.tickertext=""),w.elementisplayer){const d=Tr(w.elementid);Rt(d.inputcurrent)&&(d.inputcurrent=0)}Sr(s).forEach(d=>{w[d]=s[d]})}function S4(t,e){xe.loaders.set(t,e)}function O4(t){sr.halt(t)}function I4(){const t=sr.ids();for(let n=0;n<t.length;++n)sr.halt(t[n]);const e=ue("main");x(e)&&(e.flags={})}function N4(){const t=ue("main");if(!x(t))return;const e=t.timestamp+1,n=Fi.HALT_AT_COUNT;Fi.HALT_AT_COUNT=n*2,xe.loaders.forEach((i,s)=>{const o={...w};w.timestamp=t.timestamp,w.book=t,w.board=void 0,w.element=void 0,w.elementid=s,w.elementisplayer=!1,w.elementfocus=or();const a=M$(s);x(a)&&sr.arg(s,a),sr.tick(s,ms.LOADER,1,"loader",i),sr.isended(s)&&(sr.halt(s),xe.loaders.delete(s)),Sr(o).forEach(c=>{w[c]=o[c]})}),Fi.HALT_AT_COUNT=n,t.timestamp=e,w.timestamp=e;const r=$0(t);for(let i=0;i<r.length;++i){const s=r[i],o=lF(t,s,e);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:f}=o[a];l===_t.ERROR?sr.halt(c):kx(t,s,f,u)}}}function _p(t,e){const n=ue("main");if(!x(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(x(u.id)){const f=`${gx(u.id)}:${c}`;nt.emit("",f,e)}}}const{target:i,path:s}=Vn(t),o=$0(n);for(let a=0;a<o.length;++a){const c=o[a];switch(It(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(tb(c,[i]),s);break}}}}function C4(t){const e=Tr(t).playbuffer;wt(e)&&e&&Tx(t,e)}function Tx(t,e=""){var s;const n=En("main");if(!x(n))return;const r=`${t}_cli`;w.timestamp=n.timestamp,w.book=n,w.board=Zs(n,t),w.element=Tn(w.board,t),w.elementid=((s=w.element)==null?void 0:s.id)??"",w.elementisplayer=!0,w.elementfocus=w.elementid||t;const i=Fi.HALT_AT_COUNT;Fi.HALT_AT_COUNT=i*8,sr.once(r,ms.CLI,"cli",e),Tr(t).playbuffer=e,Fi.HALT_AT_COUNT=i}function lh(t){var o;const e=En("main"),n=Di(e,t);if(!x(e)||!x(n)||!x(w.element))return;const r=`${t}_run`,i=It(w.element.name??((o=w.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";sr.once(r,ms.RUNTIME,i,s)}function L4(t){const e=ue("main"),n=Zs(e,t),r=[],i=[],s=[];if(!x(e)||!x(n))return{over:r,under:i,layers:s};const o=n.graphics??"flat",a=hs(e,n.overboard??""),c=hs(e,n.underboard??"");return i.push(...mp(t,0,e,c,!1,!0)),s.push(...mp(t,i.length,e,n,!0,o!=="flat")),r.push(...mp(t,i.length+s.length,e,a,!1,!1)),{over:r,under:i,layers:s}}function la(t,e=0){const n=[];let r=t;for(;r<w.words.length;){const[i,s]=Wn(r);if(se(i)&&!Si(i)&&!Ic(i)&&!Yu(i)&&!ni(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function Wn(t){var r,i,s,o,a,c,l,u,f;const e=w.words[t],n=t+1;if(UE(e)){const[d,h]=A$(t);if(x(d))return[d,h]}if(R$(e)){const[d,h]=S$(t);if(x(d))return[d,h]}if(ud(e)){const[d,h]=hd(t);if(x(d))return[d,h]}if(wt(e)&&It(e)==="rnd"){const[d,h]=Wn(n),[p,m]=Wn(h);return Rt(d)&&Rt(p)?[pr(d,p),m]:Rt(d)?[pr(0,d),h]:[pr(0,1),n]}if(ld(e)){const[d,h]=yy(t);if(x(d))return[d,h]}if(!x(e))return[void 0,t];if(Rt(e)||se(e))return[e,n];if(wt(e)){const d=It(e),h=(r=w.get)==null?void 0:r.call(w,e);if(x(h))return[h,n];switch(d){case"aligned":case"alligned":{const p=rc(w.board,{x:((i=w.element)==null?void 0:i.x)??-1,y:((s=w.element)==null?void 0:s.y)??-1},w.elementfocus);return!x(w.element)||!x(p)?[0,n]:[w.element.x===p.x||w.element.y===p.y?1:0,n]}case"contact":{const p=rc(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus);if(!x(w.element)||!x(p))return[0,n];const m=(p.x??0)-(((c=w.element)==null?void 0:c.x)??0),b=(p.y??0)-(((l=w.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(b)<2||b===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=rt(w.words,n,[$.DIR]);return[aF(w.book,w.board,w.element,p.destpt)?1:0,m]}case"any":{const[p,m]=rt(w.words,n,[$.KIND]);return[Qy(w.board,p).length?1:0,m]}case"rnd":return[pr(0,1),n];case"abs":{const[p,m]=rt(w.words,n,[$.NUMBER]);return[Math.abs(p),m]}case"intceil":{const[p,m]=rt(w.words,n,[$.NUMBER]);return[Math.ceil(p),m]}case"intfloor":{const[p,m]=rt(w.words,n,[$.NUMBER]);return[Math.floor(p),m]}case"intround":{const[p,m]=rt(w.words,n,[$.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,b,y]=rt(w.words,n,[$.NUMBER,$.NUMBER,$.NUMBER]);return[Xe(p,m,b),y]}case"min":{const[p,m]=la(n);return[Math.min(...p),m]}case"max":{const[p,m]=la(n);return[Math.max(...p),m]}case"pick":{const[p,m]=la(n);return[Te(p),m]}case"pickwith":{const[p,m]=rt(w.words,n,[$.NUMBER_OR_STRING]),[b,y]=la(m);return[my(`${p}`,b),y]}case"random":{const[p,m]=la(n,2),[b,y]=p;return[pr(b,y??0),m]}case"randomwith":{const[p,m]=rt(w.words,n,[$.NUMBER_OR_STRING]),[b,y]=la(m,2),[k,A]=b;return[dy(`${p}`,k,A??0),y]}case"run":{const[p,m]=rt(w.words,n,[$.NAME]);return lh(p),[(u=w.get)==null?void 0:u.call(w,"arg"),m]}case"runwith":{const[p,m,b]=rt(w.words,n,[$.ANY,$.NAME]);return x(w.element)&&(w.element.arg=p),lh(m),[(f=w.get)==null?void 0:f.call(w,"arg"),b]}}}return[e,n]}const w={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var $=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.MAYBE_KIND=7]="MAYBE_KIND",t[t.MAYBE_NAME=8]="MAYBE_NAME",t[t.MAYBE_NUMBER=9]="MAYBE_NUMBER",t[t.MAYBE_STRING=10]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",t[t.ANY=12]="ANY",t))($||{});function xn(t,e,n){throw console.info(n,w.element,w.elementid,w.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function Ax(t){var n,r;const e={x:((n=w.element)==null?void 0:n.x)??0,y:((r=w.element)==null?void 0:r.y)??0};return z0(w.book,w.board,w.element,w.elementfocus,t,e)}function rt(t,e,n){const r=w.words;w.words=t;const i=[];let s=e;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=vy(s);Bo(a)?(s=c,i.push(a)):xn("kind",a,t);break}case 0:{if(ud(t[0])===void 0){const[a,c]=Wn(s);ni(a)?(s=c,i.push(a)):xn("color",a,t)}else{const[a,c]=hd(s);ni(a)?(s=c,i.push(a)):xn("color",a,t)}break}case 2:{if(ld(t[0])===void 0){const[a,c]=Wn(s);Si(a)?(s=c,i.push(Ax(a))):xn("direction",a,t)}else{const[a,c]=yy(s);Si(a)?(s=c,i.push(Ax(a))):xn("direction",a,t)}break}case 3:{const a=w.words[s];wt(a)||xn("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Wn(s);if(wt(a)){const l=parseFloat(a);Rt(l)?i.push(l):xn("number",a,t)}else Rt(a)?i.push(a):xn("number",a,t);s=c;break}case 5:{const[a,c]=Wn(s);wt(a)||xn("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Wn(s);let l=a;if(wt(l)){const u=parseFloat(l);Rt(u)&&(l=u)}else Rt(l)||xn("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=vy(s);a!==void 0&&!Bo(a)&&xn("optional kind",a,t),s=c,i.push(a);break}case 8:{const a=w.words[s];a!==void 0&&!wt(a)&&xn("optional string",a,t),++s,i.push(a);break}case 9:{const[a,c]=Wn(s);if(wt(a)){const l=parseFloat(a);Rt(l)?i.push(l):xn("optional number",a,t)}else Rt(a)||a===void 0?i.push(a):xn("optional number",a,t);s=c;break}case 10:{const[a,c]=Wn(s);a!==void 0&&!wt(a)&&xn("optional string",a,t),s=c,i.push(a);break}case 11:{const[a,c]=Wn(s);let l=a;if(wt(l)){const u=parseFloat(l);Rt(u)&&(l=u)}else l!==void 0&&!Rt(l)&&xn("number or string",l,t);s=c,i.push(l);break}case 12:{const[a,c]=Wn(s);s=c,i.push(a);break}}return w.words=r,[...i,s]}const uh={},ua={};function yp(){return{id:Me(),layers:[],scroll:[],sidebar:[]}}const M4=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),U4=new Set(["tx","text"]),F4={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Rx={};let Sx=t=>{let e=Rx[t];return x(e)||(Rx[t]=e=yp()),e};function P4(t){Sx=t}function In(t){return Sx(t)}function bp(t){return x(uh[t])||(uh[t]=[]),uh[t]}function B4(t){const e=In(t);e.scroll=[]}function D4(t,e,n){Object.values(ua).forEach(r=>{if(r[e]!==void 0){const i=rb(t.id(),e);Rt(n)&&iI(i,n),wt(n)&&sI(i,n)}})}function mi(t){const e=bp(t);return uh[t]=[],e}function ae(t,e){bp(t).push(e)}function jt(t,e,n,r,i=()=>0,s=Th){const o=[e,n,...r],a=It(`${o[3]}`),c={...w};function l(u,f){x(f)&&f!==i(u)&&(w.board=c.board,w.element=c.element,w.elementfocus=c.elementfocus,s(u,f))}if(M4.has(a)){const u=`${o[2]}`;ua[e]=ua[e]??{};const f=i(u)??F4[a];if(ua[e][u]===void 0){const d=rb(e,u);Rt(f)&&rI(d,f),wt(f)&&ed(d,f),U4.has(a)?ua[e][u]=ny(d,h=>{l(u,h)}):ua[e][u]=oI(d,h=>{l(u,h)})}}bp(t).push(o)}P4(t=>{if(Rr(t)){const e=ue(Dt.MAIN),n=$i(e,Dt.GADGETSTORE);let r=n[t];return x(r)||(n[t]=r=yp()),r}return yp()});const hh=io("gadgetserver",["tock","second"],t=>{if(!hh.session(t))return;const e=ue(Dt.MAIN),n=(e==null?void 0:e.activelist)??[],r=$i(e,Dt.GADGETSYNC);switch(t.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=In(s),{over:a,under:c,layers:l}=L4(s);o.over=a,o.under=c,o.layers=l;const u=r[s]??{},f=Up(u,o);f.length&&(r[s]=Yn(o),LA(hh,s,f))}break;case"second":{for(let i=0;i<n.length;++i){const s=n[i],o=ar(s);x(o)&&HA(hh,s,o.id)}break}case"desync":CA(hh,t.player,In(t.player));break;case"clearscroll":B4(t.player);break;case"clearplayer":{const i=ue(Dt.MAIN),s=$i(i,Dt.GADGETSTORE);delete s[t.player];const o=$i(i,Dt.GADGETSYNC);delete o[t.player];break}}});function fh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ox={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof fh=="function"&&fh;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof fh=="function"&&fh,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,p,m,b=[],y=0,k=c.length,A=k,T=s.getTypeOf(c)!=="string";y<c.length;)A=k-y,f=T?(l=c[y++],u=y<k?c[y++]:0,y<k?c[y++]:0):(l=c.charCodeAt(y++),u=y<k?c.charCodeAt(y++):0,y<k?c.charCodeAt(y++):0),d=l>>2,h=(3&l)<<4|u>>4,p=1<A?(15&u)<<2|f>>6:64,m=2<A?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var l,u,f,d,h,p,m=0,b=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var k,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=o.uint8array?new Uint8Array(0|A):new Array(0|A);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(m++)))>>2,f=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),k[b++]=l,h!==64&&(k[b++]=u),p!==64&&(k[b++]=f);return k}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,p){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,p,m,b,y,k){var A,T,C=h.file,R=h.compression,S=k!==l.utf8encode,U=a.transformTo("string",k(C.name)),N=a.transformTo("string",l.utf8encode(C.name)),D=C.comment,Y=a.transformTo("string",k(D)),L=a.transformTo("string",l.utf8encode(D)),I=N.length!==C.name.length,E=L.length!==D.length,B="",J="",j="",st=C.dir,tt=C.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=h.crc32,ft.compressedSize=h.compressedSize,ft.uncompressedSize=h.uncompressedSize);var V=0;p&&(V|=8),S||!I&&!E||(V|=2048);var W=0,Et=0;st&&(W|=16),y==="UNIX"?(Et=798,W|=function(lt,Ut){var Vt=lt;return lt||(Vt=Ut?16893:33204),(65535&Vt)<<16}(C.unixPermissions,st)):(Et=20,W|=function(lt){return 63&(lt||0)}(C.dosPermissions)),A=tt.getUTCHours(),A<<=6,A|=tt.getUTCMinutes(),A<<=5,A|=tt.getUTCSeconds()/2,T=tt.getUTCFullYear()-1980,T<<=4,T|=tt.getUTCMonth()+1,T<<=5,T|=tt.getUTCDate(),I&&(J=s(1,1)+s(u(U),4)+N,B+="up"+s(J.length,2)+J),E&&(j=s(1,1)+s(u(Y),4)+L,B+="uc"+s(j.length,2)+j);var at="";return at+=`
\0`,at+=s(V,2),at+=R.magic,at+=s(A,2),at+=s(T,2),at+=s(ft.crc32,4),at+=s(ft.compressedSize,4),at+=s(ft.uncompressedSize,4),at+=s(U.length,2),at+=s(B.length,2),{fileRecord:f.LOCAL_FILE_HEADER+at+U+B,dirRecord:f.CENTRAL_FILE_HEADER+s(Et,2)+at+s(Y.length,2)+"\0\0\0\0"+s(W,4)+s(b,4)+U+B+Y}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,b=function(y,k,A,T,C){var R=a.transformTo("string",C(T));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(k,4)+s(A,4)+s(R.length,2)+R}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var p=function(k,A){var T=k||A,C=s[T];if(!C)throw new Error(T+" is not a valid compression method !");return C}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,y=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:y,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var b=new c(h);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],y=m.files;if(h.checkCRC32)for(var k=0;k<y.length;k++)b.push(f(y[k]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),y=b.files,k=0;k<y.length;k++){var A=y[k],T=A.fileNameStr,C=s.resolve(A.fileNameStr);p.file(C,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:h.createFolders}),A.dir||(p.file(C).unsafeOriginalName=T)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof hn<"u",newBufferFrom:function(s,o){if(hn.from&&hn.from!==Uint8Array.from)return hn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new hn(s,o)},allocBuffer:function(s){if(hn.alloc)return hn.alloc(s);var o=new hn(s);return o.fill(0),o},isBuffer:function(s){return hn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,R,S){var U,N=a.getTypeOf(R),D=a.extend(S||{},u);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(C=y(C)),D.createFolders&&(U=b(C))&&k.call(this,U,!0);var Y=N==="string"&&D.binary===!1&&D.base64===!1;S&&S.binary!==void 0||(D.binary=!Y),(R instanceof f&&R.uncompressedSize===0||D.dir||!R||R.length===0)&&(D.base64=!1,D.binary=!0,R="",D.compression="STORE",N="string");var L=null;L=R instanceof f||R instanceof c?R:p.isNode&&p.isStream(R)?new m(C,R):a.prepareContent(C,R,D.binary,D.optimizedBinaryString,D.base64);var I=new d(C,L,D);this.files[C]=I}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var R=C.lastIndexOf("/");return 0<R?C.substring(0,R):""},y=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},k=function(C,R){return R=R!==void 0?R:u.createFolders,C=y(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:R}),this.files[C]};function A(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var R,S,U;for(R in this.files)U=this.files[R],(S=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&C(S,U)},filter:function(C){var R=[];return this.forEach(function(S,U){C(S,U)&&R.push(U)}),R},file:function(C,R,S){if(arguments.length!==1)return C=this.root+C,s.call(this,C,R,S),this;if(A(C)){var U=C;return this.filter(function(D,Y){return!Y.dir&&U.test(D)})}var N=this.files[this.root+C];return N&&!N.dir?N:null},folder:function(C){if(!C)return this;if(A(C))return this.filter(function(N,D){return D.dir&&C.test(N)});var R=this.root+C,S=k.call(this,R),U=this.clone();return U.root=S.name,U},remove:function(C){C=this.root+C;var R=this.files[C];if(R||(C.slice(-1)!=="/"&&(C+="/"),R=this.files[C]),R&&!R.dir)delete this.files[C];else for(var S=this.filter(function(N,D){return D.name.slice(0,C.length)===C}),U=0;U<S.length;U++)delete this.files[S[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var R,S={};try{if((S=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");a.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var U=S.comment||this.comment||"";R=h.generateWorker(this,S,U)}catch(N){(R=new c("error")).error(N)}return new l(R,S.type||"string",S.mimeType)},generateAsync:function(C,R){return this.generateInternalStream(C).accumulate(R)},generateNodeStream:function(C,R){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(R)}};r.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(b,y){var k=[],A=p._internalType,T=p._outputType,C=p._mimeType;p.on("data",function(R,S){k.push(R),m&&m(S)}).on("error",function(R){k=[],y(R)}).on("end",function(){try{var R=function(S,U,N){switch(S){case"blob":return s.newBlob(s.transformTo("arraybuffer",U),N);case"base64":return c.encode(U);default:return s.transformTo(S,U)}}(T,function(S,U){var N,D=0,Y=null,L=0;for(N=0;N<U.length;N++)L+=U[N].length;switch(S){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(Y=new Uint8Array(L),N=0;N<U.length;N++)Y.set(U[N],D),D+=U[N].length;return Y;case"nodebuffer":return hn.concat(U);default:throw new Error("concat : unsupported type '"+S+"'")}}(A,k),C);b(R)}catch(S){y(S)}k=[]}).resume()})}function h(p,m,b){var y=m;switch(m){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=m,this._mimeType=b,s.checkSupport(y),this._worker=p.pipe(new o(y)),p.lock()}catch(k){this._worker=new a("error"),this._worker.error(k)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(y){m.call(b,y.data,y.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof hn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,b,y,k,A,T=p.length,C=0;for(k=0;k<T;k++)(64512&(b=p.charCodeAt(k)))==55296&&k+1<T&&(64512&(y=p.charCodeAt(k+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),k++),C+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),k=A=0;A<C;k++)(64512&(b=p.charCodeAt(k)))==55296&&k+1<T&&(64512&(y=p.charCodeAt(k+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),k++),b<128?m[A++]=b:(b<2048?m[A++]=192|b>>>6:(b<65536?m[A++]=224|b>>>12:(m[A++]=240|b>>>18,m[A++]=128|b>>>12&63),m[A++]=128|b>>>6&63),m[A++]=128|63&b);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,b,y,k,A=p.length,T=new Array(2*A);for(m=b=0;m<A;)if((y=p[m++])<128)T[b++]=y;else if(4<(k=l[y]))T[b++]=65533,m+=k-1;else{for(y&=k===2?31:k===3?15:7;1<k&&m<A;)y=y<<6|63&p[m++],k--;1<k?T[b++]=65533:y<65536?T[b++]=y:(y-=65536,T[b++]=55296|y>>10&1023,T[b++]=56320|1023&y)}return T.length!==b&&(T.subarray?T=T.subarray(0,b):T.length=b),s.applyFromCharCode(T)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(k,A){var T;for((A=A||k.length)>k.length&&(A=k.length),T=A-1;0<=T&&(192&k[T])==128;)T--;return T<0||T===0?A:T+l[k[T]]>A?T:A}(p),y=p;b!==p.length&&(o.uint8array?(y=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(y=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(y),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,b){for(var y=0;y<m.length;++y)b[y]=255&m.charCodeAt(y);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(m),y.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,b,y){var k=[],A=0,T=m.length;if(T<=y)return String.fromCharCode.apply(null,m);for(;A<T;)b==="array"||b==="nodebuffer"?k.push(String.fromCharCode.apply(null,m.slice(A,Math.min(A+y,T)))):k.push(String.fromCharCode.apply(null,m.subarray(A,Math.min(A+y,T)))),A+=y;return k.join("")},stringifyByChar:function(m){for(var b="",y=0;y<m.length;y++)b+=String.fromCharCode(m[y]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,y=i.getTypeOf(m),k=!0;if(y==="uint8array"?k=f.applyCanBeUsed.uint8array:y==="nodebuffer"&&(k=f.applyCanBeUsed.nodebuffer),k)for(;1<b;)try{return f.stringifyByChunk(m,y,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(m)}function h(m,b){for(var y=0;y<m.length;y++)b[y]=m[y];return b}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var y=i.getTypeOf(b);return p[y][m](b)},i.resolve=function(m){for(var b=m.split("/"),y=[],k=0;k<b.length;k++){var A=b[k];A==="."||A===""&&k!==0&&k!==b.length-1||(A===".."?y.pop():y.push(A))}return y.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,y,k="";for(y=0;y<(m||"").length;y++)k+="\\x"+((b=m.charCodeAt(y))<16?"0":"")+b.toString(16).toUpperCase();return k},i.delay=function(m,b,y){setImmediate(function(){m.apply(y||null,b||[])})},i.inherits=function(m,b){function y(){}y.prototype=b.prototype,m.prototype=new y},i.extend=function(){var m,b,y={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&y[b]===void 0&&(y[b]=arguments[m][b]);return y},i.prepareContent=function(m,b,y,k,A){return c.Promise.resolve(b).then(function(T){return s.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,R){var S=new FileReader;S.onload=function(U){C(U.target.result)},S.onerror=function(U){R(U.target.error)},S.readAsArrayBuffer(T)}):T}).then(function(T){var C=i.getTypeOf(T);return C?(C==="arraybuffer"?T=i.transformTo("uint8array",T):C==="string"&&(A?T=o.decode(T):y&&k!==!0&&(T=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(T))),T):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===b)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,b,y=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<y;)p=h.readInt(2),m=h.readInt(2),b=h.readData(m),this.extraFields[p]={id:p,length:m,value:b};h.setIndex(y)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var y=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var y=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var k=!this._dataBinary;k&&!y&&(m=m.pipe(new c.Utf8EncodeWorker)),!k&&y&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(A){(m=new u("error")).error(A)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,b;a=!0;for(var y=h.length;y;){for(b=h,h=[],m=-1;++m<y;)b[m]();y=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Nn<"u"?Nn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&m(this,y)}function d(y,k,A){this.promise=y,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function h(y,k,A){s(function(){var T;try{T=k(A)}catch(C){return a.reject(y,C)}T===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,T)})}function p(y){var k=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof k=="function")return function(){k.apply(y,arguments)}}function m(y,k){var A=!1;function T(S){A||(A=!0,a.reject(y,S))}function C(S){A||(A=!0,a.resolve(y,S))}var R=b(function(){k(C,T)});R.status==="error"&&T(R.value)}function b(y,k){var A={};try{A.value=y(k),A.status="success"}catch(T){A.status="error",A.value=T}return A}(r.exports=f).prototype.finally=function(y){if(typeof y!="function")return this;var k=this.constructor;return this.then(function(A){return k.resolve(y()).then(function(){return A})},function(A){return k.resolve(y()).then(function(){throw A})})},f.prototype.catch=function(y){return this.then(null,y)},f.prototype.then=function(y,k){if(typeof y!="function"&&this.state===l||typeof k!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?h(A,this.state===l?y:k,this.outcome):this.queue.push(new d(A,y,k)),A},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){h(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){h(this.promise,this.onRejected,y)},a.resolve=function(y,k){var A=b(p,k);if(A.status==="error")return a.reject(y,A.value);var T=A.value;if(T)m(y,T);else{y.state=l,y.outcome=k;for(var C=-1,R=y.queue.length;++C<R;)y.queue[C].callFulfilled(k)}return y},a.reject=function(y,k){y.state=c,y.outcome=k;for(var A=-1,T=y.queue.length;++A<T;)y.queue[A].callRejected(k);return y},f.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},f.reject=function(y){var k=new this(o);return a.reject(k,y)},f.all=function(y){var k=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,T=!1;if(!A)return this.resolve([]);for(var C=new Array(A),R=0,S=-1,U=new this(o);++S<A;)N(y[S],S);return U;function N(D,Y){k.resolve(D).then(function(L){C[Y]=L,++R!==A||T||(T=!0,a.resolve(U,C))},function(L){T||(T=!0,a.reject(U,L))})}},f.race=function(y){var k=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,T=!1;if(!A)return this.resolve([]);for(var C=-1,R=new this(o);++C<A;)S=y[C],k.resolve(S).then(function(U){T||(T=!0,a.resolve(R,U))},function(U){T||(T=!0,a.reject(R,U))});var S;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(y){if(!(this instanceof m))return new m(y);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},y||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(A!==f)throw new Error(c[A]);if(k.header&&s.deflateSetHeader(this.strm,k.header),k.dictionary){var T;if(T=typeof k.dictionary=="string"?a.string2buf(k.dictionary):u.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(A=s.deflateSetDictionary(this.strm,T))!==f)throw new Error(c[A]);this._dict_set=!0}}function b(y,k){var A=new m(k);if(A.push(y,!0),A.err)throw A.msg||c[A.err];return A.result}m.prototype.push=function(y,k){var A,T,C=this.strm,R=this.options.chunkSize;if(this.ended)return!1;T=k===~~k?k:k===!0?4:0,typeof y=="string"?C.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?C.input=new Uint8Array(y):C.input=y,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(R),C.next_out=0,C.avail_out=R),(A=s.deflate(C,T))!==1&&A!==f)return this.onEnd(A),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&A!==1);return T===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===f):T!==2||(this.onEnd(f),!(C.avail_out=0))},m.prototype.onData=function(y){this.chunks.push(y)},m.prototype.onEnd=function(y){y===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(y,k){return(k=k||{}).raw=!0,b(y,k)},i.gzip=function(y,k){return(k=k||{}).gzip=!0,b(y,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,b.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var y=new h(b);if(y.push(m,!0),y.err)throw y.msg||l[y.err];return y.result}h.prototype.push=function(m,b){var y,k,A,T,C,R,S=this.strm,U=this.options.chunkSize,N=this.options.dictionary,D=!1;if(this.ended)return!1;k=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?S.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(U),S.next_out=0,S.avail_out=U),(y=s.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(R=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,y=s.inflateSetDictionary(this.strm,R)),y===c.Z_BUF_ERROR&&D===!0&&(y=c.Z_OK,D=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&y!==c.Z_STREAM_END&&(S.avail_in!==0||k!==c.Z_FINISH&&k!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(S.output,S.next_out),T=S.next_out-A,C=a.buf2string(S.output,A),S.next_out=T,S.avail_out=U-T,T&&o.arraySet(S.output,S.output,A,T,0),this.onData(C)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(D=!0)}while((0<S.avail_in||S.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(k=c.Z_FINISH),k===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):k!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,p;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(p=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],p.set(h,d),d+=h.length;return p}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,p,m,b,y=f.length,k=0;for(m=0;m<y;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<y&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),k+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(k),m=b=0;b<k;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<y&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,p,m,b,y=d||f.length,k=new Array(2*y);for(h=p=0;h<y;)if((m=f[h++])<128)k[p++]=m;else if(4<(b=c[m]))k[p++]=65533,h+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&h<y;)m=m<<6|63&f[h++],b--;1<b?k[p++]=65533:m<65536?k[p++]=m:(m-=65536,k[p++]=55296|m>>10&1023,k[p++]=56320|1023&m)}return u(k,p)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,p=-2,m=-1,b=4,y=2,k=8,A=9,T=286,C=30,R=19,S=2*T+1,U=15,N=3,D=258,Y=D+N+1,L=42,I=113,E=1,B=2,J=3,j=4;function st(v,ot){return v.msg=u[ot],ot}function tt(v){return(v<<1)-(4<v?9:0)}function ft(v){for(var ot=v.length;0<=--ot;)v[ot]=0}function V(v){var ot=v.state,et=ot.pending;et>v.avail_out&&(et=v.avail_out),et!==0&&(o.arraySet(v.output,ot.pending_buf,ot.pending_out,et,v.next_out),v.next_out+=et,ot.pending_out+=et,v.total_out+=et,v.avail_out-=et,ot.pending-=et,ot.pending===0&&(ot.pending_out=0))}function W(v,ot){a._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,ot),v.block_start=v.strstart,V(v.strm)}function Et(v,ot){v.pending_buf[v.pending++]=ot}function at(v,ot){v.pending_buf[v.pending++]=ot>>>8&255,v.pending_buf[v.pending++]=255&ot}function lt(v,ot){var et,P,F=v.max_chain_length,G=v.strstart,ct=v.prev_length,ht=v.nice_match,q=v.strstart>v.w_size-Y?v.strstart-(v.w_size-Y):0,mt=v.window,bt=v.w_mask,dt=v.prev,At=v.strstart+D,le=mt[G+ct-1],Bt=mt[G+ct];v.prev_length>=v.good_match&&(F>>=2),ht>v.lookahead&&(ht=v.lookahead);do if(mt[(et=ot)+ct]===Bt&&mt[et+ct-1]===le&&mt[et]===mt[G]&&mt[++et]===mt[G+1]){G+=2,et++;do;while(mt[++G]===mt[++et]&&mt[++G]===mt[++et]&&mt[++G]===mt[++et]&&mt[++G]===mt[++et]&&mt[++G]===mt[++et]&&mt[++G]===mt[++et]&&mt[++G]===mt[++et]&&mt[++G]===mt[++et]&&G<At);if(P=D-(At-G),G=At-D,ct<P){if(v.match_start=ot,ht<=(ct=P))break;le=mt[G+ct-1],Bt=mt[G+ct]}}while((ot=dt[ot&bt])>q&&--F!=0);return ct<=v.lookahead?ct:v.lookahead}function Ut(v){var ot,et,P,F,G,ct,ht,q,mt,bt,dt=v.w_size;do{if(F=v.window_size-v.lookahead-v.strstart,v.strstart>=dt+(dt-Y)){for(o.arraySet(v.window,v.window,dt,dt,0),v.match_start-=dt,v.strstart-=dt,v.block_start-=dt,ot=et=v.hash_size;P=v.head[--ot],v.head[ot]=dt<=P?P-dt:0,--et;);for(ot=et=dt;P=v.prev[--ot],v.prev[ot]=dt<=P?P-dt:0,--et;);F+=dt}if(v.strm.avail_in===0)break;if(ct=v.strm,ht=v.window,q=v.strstart+v.lookahead,mt=F,bt=void 0,bt=ct.avail_in,mt<bt&&(bt=mt),et=bt===0?0:(ct.avail_in-=bt,o.arraySet(ht,ct.input,ct.next_in,bt,q),ct.state.wrap===1?ct.adler=c(ct.adler,ht,bt,q):ct.state.wrap===2&&(ct.adler=l(ct.adler,ht,bt,q)),ct.next_in+=bt,ct.total_in+=bt,bt),v.lookahead+=et,v.lookahead+v.insert>=N)for(G=v.strstart-v.insert,v.ins_h=v.window[G],v.ins_h=(v.ins_h<<v.hash_shift^v.window[G+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[G+N-1])&v.hash_mask,v.prev[G&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=G,G++,v.insert--,!(v.lookahead+v.insert<N)););}while(v.lookahead<Y&&v.strm.avail_in!==0)}function Vt(v,ot){for(var et,P;;){if(v.lookahead<Y){if(Ut(v),v.lookahead<Y&&ot===f)return E;if(v.lookahead===0)break}if(et=0,v.lookahead>=N&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),et!==0&&v.strstart-et<=v.w_size-Y&&(v.match_length=lt(v,et)),v.match_length>=N)if(P=a._tr_tally(v,v.strstart-v.match_start,v.match_length-N),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=N){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else P=a._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(P&&(W(v,!1),v.strm.avail_out===0))return E}return v.insert=v.strstart<N-1?v.strstart:N-1,ot===d?(W(v,!0),v.strm.avail_out===0?J:j):v.last_lit&&(W(v,!1),v.strm.avail_out===0)?E:B}function Ft(v,ot){for(var et,P,F;;){if(v.lookahead<Y){if(Ut(v),v.lookahead<Y&&ot===f)return E;if(v.lookahead===0)break}if(et=0,v.lookahead>=N&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=N-1,et!==0&&v.prev_length<v.max_lazy_match&&v.strstart-et<=v.w_size-Y&&(v.match_length=lt(v,et),v.match_length<=5&&(v.strategy===1||v.match_length===N&&4096<v.strstart-v.match_start)&&(v.match_length=N-1)),v.prev_length>=N&&v.match_length<=v.prev_length){for(F=v.strstart+v.lookahead-N,P=a._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-N),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=F&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,et=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=N-1,v.strstart++,P&&(W(v,!1),v.strm.avail_out===0))return E}else if(v.match_available){if((P=a._tr_tally(v,0,v.window[v.strstart-1]))&&W(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return E}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(P=a._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<N-1?v.strstart:N-1,ot===d?(W(v,!0),v.strm.avail_out===0?J:j):v.last_lit&&(W(v,!1),v.strm.avail_out===0)?E:B}function kt(v,ot,et,P,F){this.good_length=v,this.max_lazy=ot,this.nice_length=et,this.max_chain=P,this.func=F}function $t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(U+1),this.heap=new o.Buf16(2*T+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*T+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pt(v){var ot;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=y,(ot=v.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?L:I,v.adler=ot.wrap===2?0:1,ot.last_flush=f,a._tr_init(ot),h):st(v,p)}function Se(v){var ot=Pt(v);return ot===h&&function(et){et.window_size=2*et.w_size,ft(et.head),et.max_lazy_match=s[et.level].max_lazy,et.good_match=s[et.level].good_length,et.nice_match=s[et.level].nice_length,et.max_chain_length=s[et.level].max_chain,et.strstart=0,et.block_start=0,et.lookahead=0,et.insert=0,et.match_length=et.prev_length=N-1,et.match_available=0,et.ins_h=0}(v.state),ot}function Be(v,ot,et,P,F,G){if(!v)return p;var ct=1;if(ot===m&&(ot=6),P<0?(ct=0,P=-P):15<P&&(ct=2,P-=16),F<1||A<F||et!==k||P<8||15<P||ot<0||9<ot||G<0||b<G)return st(v,p);P===8&&(P=9);var ht=new $t;return(v.state=ht).strm=v,ht.wrap=ct,ht.gzhead=null,ht.w_bits=P,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=F+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+N-1)/N),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<F+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=ot,ht.strategy=G,ht.method=et,Se(v)}s=[new kt(0,0,0,0,function(v,ot){var et=65535;for(et>v.pending_buf_size-5&&(et=v.pending_buf_size-5);;){if(v.lookahead<=1){if(Ut(v),v.lookahead===0&&ot===f)return E;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var P=v.block_start+et;if((v.strstart===0||v.strstart>=P)&&(v.lookahead=v.strstart-P,v.strstart=P,W(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-Y&&(W(v,!1),v.strm.avail_out===0))return E}return v.insert=0,ot===d?(W(v,!0),v.strm.avail_out===0?J:j):(v.strstart>v.block_start&&(W(v,!1),v.strm.avail_out),E)}),new kt(4,4,8,4,Vt),new kt(4,5,16,8,Vt),new kt(4,6,32,32,Vt),new kt(4,4,16,16,Ft),new kt(8,16,32,32,Ft),new kt(8,16,128,128,Ft),new kt(8,32,128,256,Ft),new kt(32,128,258,1024,Ft),new kt(32,258,258,4096,Ft)],i.deflateInit=function(v,ot){return Be(v,ot,k,15,8,0)},i.deflateInit2=Be,i.deflateReset=Se,i.deflateResetKeep=Pt,i.deflateSetHeader=function(v,ot){return v&&v.state?v.state.wrap!==2?p:(v.state.gzhead=ot,h):p},i.deflate=function(v,ot){var et,P,F,G;if(!v||!v.state||5<ot||ot<0)return v?st(v,p):p;if(P=v.state,!v.output||!v.input&&v.avail_in!==0||P.status===666&&ot!==d)return st(v,v.avail_out===0?-5:p);if(P.strm=v,et=P.last_flush,P.last_flush=ot,P.status===L)if(P.wrap===2)v.adler=0,Et(P,31),Et(P,139),Et(P,8),P.gzhead?(Et(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),Et(P,255&P.gzhead.time),Et(P,P.gzhead.time>>8&255),Et(P,P.gzhead.time>>16&255),Et(P,P.gzhead.time>>24&255),Et(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),Et(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(Et(P,255&P.gzhead.extra.length),Et(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(v.adler=l(v.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(Et(P,0),Et(P,0),Et(P,0),Et(P,0),Et(P,0),Et(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),Et(P,3),P.status=I);else{var ct=k+(P.w_bits-8<<4)<<8;ct|=(2<=P.strategy||P.level<2?0:P.level<6?1:P.level===6?2:3)<<6,P.strstart!==0&&(ct|=32),ct+=31-ct%31,P.status=I,at(P,ct),P.strstart!==0&&(at(P,v.adler>>>16),at(P,65535&v.adler)),v.adler=1}if(P.status===69)if(P.gzhead.extra){for(F=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),V(v),F=P.pending,P.pending!==P.pending_buf_size));)Et(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(P.status===73)if(P.gzhead.name){F=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),V(v),F=P.pending,P.pending===P.pending_buf_size)){G=1;break}G=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,Et(P,G)}while(G!==0);P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),G===0&&(P.gzindex=0,P.status=91)}else P.status=91;if(P.status===91)if(P.gzhead.comment){F=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),V(v),F=P.pending,P.pending===P.pending_buf_size)){G=1;break}G=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,Et(P,G)}while(G!==0);P.gzhead.hcrc&&P.pending>F&&(v.adler=l(v.adler,P.pending_buf,P.pending-F,F)),G===0&&(P.status=103)}else P.status=103;if(P.status===103&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&V(v),P.pending+2<=P.pending_buf_size&&(Et(P,255&v.adler),Et(P,v.adler>>8&255),v.adler=0,P.status=I)):P.status=I),P.pending!==0){if(V(v),v.avail_out===0)return P.last_flush=-1,h}else if(v.avail_in===0&&tt(ot)<=tt(et)&&ot!==d)return st(v,-5);if(P.status===666&&v.avail_in!==0)return st(v,-5);if(v.avail_in!==0||P.lookahead!==0||ot!==f&&P.status!==666){var ht=P.strategy===2?function(q,mt){for(var bt;;){if(q.lookahead===0&&(Ut(q),q.lookahead===0)){if(mt===f)return E;break}if(q.match_length=0,bt=a._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,bt&&(W(q,!1),q.strm.avail_out===0))return E}return q.insert=0,mt===d?(W(q,!0),q.strm.avail_out===0?J:j):q.last_lit&&(W(q,!1),q.strm.avail_out===0)?E:B}(P,ot):P.strategy===3?function(q,mt){for(var bt,dt,At,le,Bt=q.window;;){if(q.lookahead<=D){if(Ut(q),q.lookahead<=D&&mt===f)return E;if(q.lookahead===0)break}if(q.match_length=0,q.lookahead>=N&&0<q.strstart&&(dt=Bt[At=q.strstart-1])===Bt[++At]&&dt===Bt[++At]&&dt===Bt[++At]){le=q.strstart+D;do;while(dt===Bt[++At]&&dt===Bt[++At]&&dt===Bt[++At]&&dt===Bt[++At]&&dt===Bt[++At]&&dt===Bt[++At]&&dt===Bt[++At]&&dt===Bt[++At]&&At<le);q.match_length=D-(le-At),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=N?(bt=a._tr_tally(q,1,q.match_length-N),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(bt=a._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),bt&&(W(q,!1),q.strm.avail_out===0))return E}return q.insert=0,mt===d?(W(q,!0),q.strm.avail_out===0?J:j):q.last_lit&&(W(q,!1),q.strm.avail_out===0)?E:B}(P,ot):s[P.level].func(P,ot);if(ht!==J&&ht!==j||(P.status=666),ht===E||ht===J)return v.avail_out===0&&(P.last_flush=-1),h;if(ht===B&&(ot===1?a._tr_align(P):ot!==5&&(a._tr_stored_block(P,0,0,!1),ot===3&&(ft(P.head),P.lookahead===0&&(P.strstart=0,P.block_start=0,P.insert=0))),V(v),v.avail_out===0))return P.last_flush=-1,h}return ot!==d?h:P.wrap<=0?1:(P.wrap===2?(Et(P,255&v.adler),Et(P,v.adler>>8&255),Et(P,v.adler>>16&255),Et(P,v.adler>>24&255),Et(P,255&v.total_in),Et(P,v.total_in>>8&255),Et(P,v.total_in>>16&255),Et(P,v.total_in>>24&255)):(at(P,v.adler>>>16),at(P,65535&v.adler)),V(v),0<P.wrap&&(P.wrap=-P.wrap),P.pending!==0?h:1)},i.deflateEnd=function(v){var ot;return v&&v.state?(ot=v.state.status)!==L&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==I&&ot!==666?st(v,p):(v.state=null,ot===I?st(v,-3):h):p},i.deflateSetDictionary=function(v,ot){var et,P,F,G,ct,ht,q,mt,bt=ot.length;if(!v||!v.state||(G=(et=v.state).wrap)===2||G===1&&et.status!==L||et.lookahead)return p;for(G===1&&(v.adler=c(v.adler,ot,bt,0)),et.wrap=0,bt>=et.w_size&&(G===0&&(ft(et.head),et.strstart=0,et.block_start=0,et.insert=0),mt=new o.Buf8(et.w_size),o.arraySet(mt,ot,bt-et.w_size,et.w_size,0),ot=mt,bt=et.w_size),ct=v.avail_in,ht=v.next_in,q=v.input,v.avail_in=bt,v.next_in=0,v.input=ot,Ut(et);et.lookahead>=N;){for(P=et.strstart,F=et.lookahead-(N-1);et.ins_h=(et.ins_h<<et.hash_shift^et.window[P+N-1])&et.hash_mask,et.prev[P&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=P,P++,--F;);et.strstart=P,et.lookahead=N-1,Ut(et)}return et.strstart+=et.lookahead,et.block_start=et.strstart,et.insert=et.lookahead,et.lookahead=0,et.match_length=et.prev_length=N-1,et.match_available=0,v.next_in=ht,v.input=q,v.avail_in=ct,et.wrap=G,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,p,m,b,y,k,A,T,C,R,S,U,N,D,Y,L,I,E,B;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,B=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,y=a.window,k=a.hold,A=a.bits,T=a.lencode,C=a.distcode,R=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;t:do{A<15&&(k+=E[c++]<<A,A+=8,k+=E[c++]<<A,A+=8),U=T[k&R];e:for(;;){if(k>>>=N=U>>>24,A-=N,(N=U>>>16&255)===0)B[u++]=65535&U;else{if(!(16&N)){if(!(64&N)){U=T[(65535&U)+(k&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}D=65535&U,(N&=15)&&(A<N&&(k+=E[c++]<<A,A+=8),D+=k&(1<<N)-1,k>>>=N,A-=N),A<15&&(k+=E[c++]<<A,A+=8,k+=E[c++]<<A,A+=8),U=C[k&S];n:for(;;){if(k>>>=N=U>>>24,A-=N,!(16&(N=U>>>16&255))){if(!(64&N)){U=C[(65535&U)+(k&(1<<N)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(Y=65535&U,A<(N&=15)&&(k+=E[c++]<<A,(A+=8)<N&&(k+=E[c++]<<A,A+=8)),h<(Y+=k&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(k>>>=N,A-=N,(N=u-f)<Y){if(m<(N=Y-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(I=y,(L=0)===b){if(L+=p-N,N<D){for(D-=N;B[u++]=y[L++],--N;);L=u-Y,I=B}}else if(b<N){if(L+=p+b-N,(N-=b)<D){for(D-=N;B[u++]=y[L++],--N;);if(L=0,b<D){for(D-=N=b;B[u++]=y[L++],--N;);L=u-Y,I=B}}}else if(L+=b-N,N<D){for(D-=N;B[u++]=y[L++],--N;);L=u-Y,I=B}for(;2<D;)B[u++]=I[L++],B[u++]=I[L++],B[u++]=I[L++],D-=3;D&&(B[u++]=I[L++],1<D&&(B[u++]=I[L++]))}else{for(L=u-Y;B[u++]=B[L++],B[u++]=B[L++],B[u++]=B[L++],2<(D-=3););D&&(B[u++]=B[L++],1<D&&(B[u++]=B[L++]))}break}}break}}while(c<l&&u<d);c-=D=A>>3,k&=(1<<(A-=D<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=k,a.bits=A}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,p=1,m=852,b=592;function y(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(L){var I;return L&&L.state?(I=L.state,L.total_in=L.total_out=I.total=0,L.msg="",I.wrap&&(L.adler=1&I.wrap),I.mode=p,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new s.Buf32(m),I.distcode=I.distdyn=new s.Buf32(b),I.sane=1,I.back=-1,d):h}function T(L){var I;return L&&L.state?((I=L.state).wsize=0,I.whave=0,I.wnext=0,A(L)):h}function C(L,I){var E,B;return L&&L.state?(B=L.state,I<0?(E=0,I=-I):(E=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?h:(B.window!==null&&B.wbits!==I&&(B.window=null),B.wrap=E,B.wbits=I,T(L))):h}function R(L,I){var E,B;return L?(B=new k,(L.state=B).window=null,(E=C(L,I))!==d&&(L.state=null),E):h}var S,U,N=!0;function D(L){if(N){var I;for(S=new s.Buf32(512),U=new s.Buf32(32),I=0;I<144;)L.lens[I++]=8;for(;I<256;)L.lens[I++]=9;for(;I<280;)L.lens[I++]=7;for(;I<288;)L.lens[I++]=8;for(l(u,L.lens,0,288,S,0,L.work,{bits:9}),I=0;I<32;)L.lens[I++]=5;l(f,L.lens,0,32,U,0,L.work,{bits:5}),N=!1}L.lencode=S,L.lenbits=9,L.distcode=U,L.distbits=5}function Y(L,I,E,B){var J,j=L.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),B>=j.wsize?(s.arraySet(j.window,I,E-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(B<(J=j.wsize-j.wnext)&&(J=B),s.arraySet(j.window,I,E-B,J,j.wnext),(B-=J)?(s.arraySet(j.window,I,E-B,B,0),j.wnext=B,j.whave=j.wsize):(j.wnext+=J,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=J))),0}i.inflateReset=T,i.inflateReset2=C,i.inflateResetKeep=A,i.inflateInit=function(L){return R(L,15)},i.inflateInit2=R,i.inflate=function(L,I){var E,B,J,j,st,tt,ft,V,W,Et,at,lt,Ut,Vt,Ft,kt,$t,Pt,Se,Be,v,ot,et,P,F=0,G=new s.Buf8(4),ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(E=L.state).mode===12&&(E.mode=13),st=L.next_out,J=L.output,ft=L.avail_out,j=L.next_in,B=L.input,tt=L.avail_in,V=E.hold,W=E.bits,Et=tt,at=ft,ot=d;t:for(;;)switch(E.mode){case p:if(E.wrap===0){E.mode=13;break}for(;W<16;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if(2&E.wrap&&V===35615){G[E.check=0]=255&V,G[1]=V>>>8&255,E.check=a(E.check,G,2,0),W=V=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&V)<<8)+(V>>8))%31){L.msg="incorrect header check",E.mode=30;break}if((15&V)!=8){L.msg="unknown compression method",E.mode=30;break}if(W-=4,v=8+(15&(V>>>=4)),E.wbits===0)E.wbits=v;else if(v>E.wbits){L.msg="invalid window size",E.mode=30;break}E.dmax=1<<v,L.adler=E.check=1,E.mode=512&V?10:12,W=V=0;break;case 2:for(;W<16;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if(E.flags=V,(255&E.flags)!=8){L.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){L.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=V>>8&1),512&E.flags&&(G[0]=255&V,G[1]=V>>>8&255,E.check=a(E.check,G,2,0)),W=V=0,E.mode=3;case 3:for(;W<32;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}E.head&&(E.head.time=V),512&E.flags&&(G[0]=255&V,G[1]=V>>>8&255,G[2]=V>>>16&255,G[3]=V>>>24&255,E.check=a(E.check,G,4,0)),W=V=0,E.mode=4;case 4:for(;W<16;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}E.head&&(E.head.xflags=255&V,E.head.os=V>>8),512&E.flags&&(G[0]=255&V,G[1]=V>>>8&255,E.check=a(E.check,G,2,0)),W=V=0,E.mode=5;case 5:if(1024&E.flags){for(;W<16;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}E.length=V,E.head&&(E.head.extra_len=V),512&E.flags&&(G[0]=255&V,G[1]=V>>>8&255,E.check=a(E.check,G,2,0)),W=V=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(tt<(lt=E.length)&&(lt=tt),lt&&(E.head&&(v=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,B,j,lt,v)),512&E.flags&&(E.check=a(E.check,B,lt,j)),tt-=lt,j+=lt,E.length-=lt),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(tt===0)break t;for(lt=0;v=B[j+lt++],E.head&&v&&E.length<65536&&(E.head.name+=String.fromCharCode(v)),v&&lt<tt;);if(512&E.flags&&(E.check=a(E.check,B,lt,j)),tt-=lt,j+=lt,v)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(tt===0)break t;for(lt=0;v=B[j+lt++],E.head&&v&&E.length<65536&&(E.head.comment+=String.fromCharCode(v)),v&&lt<tt;);if(512&E.flags&&(E.check=a(E.check,B,lt,j)),tt-=lt,j+=lt,v)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;W<16;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if(V!==(65535&E.check)){L.msg="header crc mismatch",E.mode=30;break}W=V=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),L.adler=E.check=0,E.mode=12;break;case 10:for(;W<32;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}L.adler=E.check=y(V),W=V=0,E.mode=11;case 11:if(E.havedict===0)return L.next_out=st,L.avail_out=ft,L.next_in=j,L.avail_in=tt,E.hold=V,E.bits=W,2;L.adler=E.check=1,E.mode=12;case 12:if(I===5||I===6)break t;case 13:if(E.last){V>>>=7&W,W-=7&W,E.mode=27;break}for(;W<3;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}switch(E.last=1&V,W-=1,3&(V>>>=1)){case 0:E.mode=14;break;case 1:if(D(E),E.mode=20,I!==6)break;V>>>=2,W-=2;break t;case 2:E.mode=17;break;case 3:L.msg="invalid block type",E.mode=30}V>>>=2,W-=2;break;case 14:for(V>>>=7&W,W-=7&W;W<32;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if((65535&V)!=(V>>>16^65535)){L.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&V,W=V=0,E.mode=15,I===6)break t;case 15:E.mode=16;case 16:if(lt=E.length){if(tt<lt&&(lt=tt),ft<lt&&(lt=ft),lt===0)break t;s.arraySet(J,B,j,lt,st),tt-=lt,j+=lt,ft-=lt,st+=lt,E.length-=lt;break}E.mode=12;break;case 17:for(;W<14;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if(E.nlen=257+(31&V),V>>>=5,W-=5,E.ndist=1+(31&V),V>>>=5,W-=5,E.ncode=4+(15&V),V>>>=4,W-=4,286<E.nlen||30<E.ndist){L.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;W<3;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}E.lens[ct[E.have++]]=7&V,V>>>=3,W-=3}for(;E.have<19;)E.lens[ct[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,et={bits:E.lenbits},ot=l(0,E.lens,0,19,E.lencode,0,E.work,et),E.lenbits=et.bits,ot){L.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;kt=(F=E.lencode[V&(1<<E.lenbits)-1])>>>16&255,$t=65535&F,!((Ft=F>>>24)<=W);){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if($t<16)V>>>=Ft,W-=Ft,E.lens[E.have++]=$t;else{if($t===16){for(P=Ft+2;W<P;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if(V>>>=Ft,W-=Ft,E.have===0){L.msg="invalid bit length repeat",E.mode=30;break}v=E.lens[E.have-1],lt=3+(3&V),V>>>=2,W-=2}else if($t===17){for(P=Ft+3;W<P;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}W-=Ft,v=0,lt=3+(7&(V>>>=Ft)),V>>>=3,W-=3}else{for(P=Ft+7;W<P;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}W-=Ft,v=0,lt=11+(127&(V>>>=Ft)),V>>>=7,W-=7}if(E.have+lt>E.nlen+E.ndist){L.msg="invalid bit length repeat",E.mode=30;break}for(;lt--;)E.lens[E.have++]=v}}if(E.mode===30)break;if(E.lens[256]===0){L.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,et={bits:E.lenbits},ot=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,et),E.lenbits=et.bits,ot){L.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,et={bits:E.distbits},ot=l(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,et),E.distbits=et.bits,ot){L.msg="invalid distances set",E.mode=30;break}if(E.mode=20,I===6)break t;case 20:E.mode=21;case 21:if(6<=tt&&258<=ft){L.next_out=st,L.avail_out=ft,L.next_in=j,L.avail_in=tt,E.hold=V,E.bits=W,c(L,at),st=L.next_out,J=L.output,ft=L.avail_out,j=L.next_in,B=L.input,tt=L.avail_in,V=E.hold,W=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;kt=(F=E.lencode[V&(1<<E.lenbits)-1])>>>16&255,$t=65535&F,!((Ft=F>>>24)<=W);){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if(kt&&!(240&kt)){for(Pt=Ft,Se=kt,Be=$t;kt=(F=E.lencode[Be+((V&(1<<Pt+Se)-1)>>Pt)])>>>16&255,$t=65535&F,!(Pt+(Ft=F>>>24)<=W);){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}V>>>=Pt,W-=Pt,E.back+=Pt}if(V>>>=Ft,W-=Ft,E.back+=Ft,E.length=$t,kt===0){E.mode=26;break}if(32&kt){E.back=-1,E.mode=12;break}if(64&kt){L.msg="invalid literal/length code",E.mode=30;break}E.extra=15&kt,E.mode=22;case 22:if(E.extra){for(P=E.extra;W<P;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}E.length+=V&(1<<E.extra)-1,V>>>=E.extra,W-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;kt=(F=E.distcode[V&(1<<E.distbits)-1])>>>16&255,$t=65535&F,!((Ft=F>>>24)<=W);){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if(!(240&kt)){for(Pt=Ft,Se=kt,Be=$t;kt=(F=E.distcode[Be+((V&(1<<Pt+Se)-1)>>Pt)])>>>16&255,$t=65535&F,!(Pt+(Ft=F>>>24)<=W);){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}V>>>=Pt,W-=Pt,E.back+=Pt}if(V>>>=Ft,W-=Ft,E.back+=Ft,64&kt){L.msg="invalid distance code",E.mode=30;break}E.offset=$t,E.extra=15&kt,E.mode=24;case 24:if(E.extra){for(P=E.extra;W<P;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}E.offset+=V&(1<<E.extra)-1,V>>>=E.extra,W-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){L.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(ft===0)break t;if(lt=at-ft,E.offset>lt){if((lt=E.offset-lt)>E.whave&&E.sane){L.msg="invalid distance too far back",E.mode=30;break}Ut=lt>E.wnext?(lt-=E.wnext,E.wsize-lt):E.wnext-lt,lt>E.length&&(lt=E.length),Vt=E.window}else Vt=J,Ut=st-E.offset,lt=E.length;for(ft<lt&&(lt=ft),ft-=lt,E.length-=lt;J[st++]=Vt[Ut++],--lt;);E.length===0&&(E.mode=21);break;case 26:if(ft===0)break t;J[st++]=E.length,ft--,E.mode=21;break;case 27:if(E.wrap){for(;W<32;){if(tt===0)break t;tt--,V|=B[j++]<<W,W+=8}if(at-=ft,L.total_out+=at,E.total+=at,at&&(L.adler=E.check=E.flags?a(E.check,J,at,st-at):o(E.check,J,at,st-at)),at=ft,(E.flags?V:y(V))!==E.check){L.msg="incorrect data check",E.mode=30;break}W=V=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;W<32;){if(tt===0)break t;tt--,V+=B[j++]<<W,W+=8}if(V!==(4294967295&E.total)){L.msg="incorrect length check",E.mode=30;break}W=V=0}E.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=st,L.avail_out=ft,L.next_in=j,L.avail_in=tt,E.hold=V,E.bits=W,(E.wsize||at!==L.avail_out&&E.mode<30&&(E.mode<27||I!==4))&&Y(L,L.output,L.next_out,at-L.avail_out)?(E.mode=31,-4):(Et-=L.avail_in,at-=L.avail_out,L.total_in+=Et,L.total_out+=at,E.total+=at,E.wrap&&at&&(L.adler=E.check=E.flags?a(E.check,J,at,L.next_out-at):o(E.check,J,at,L.next_out-at)),L.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(Et==0&&at===0||I===4)&&ot===d&&(ot=-5),ot)},i.inflateEnd=function(L){if(!L||!L.state)return h;var I=L.state;return I.window&&(I.window=null),L.state=null,d},i.inflateGetHeader=function(L,I){var E;return L&&L.state&&2&(E=L.state).wrap?((E.head=I).done=!1,d):h},i.inflateSetDictionary=function(L,I){var E,B=I.length;return L&&L.state?(E=L.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,I,B,0)!==E.check?-3:Y(L,I,B,B)?(E.mode=31,-4):(E.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,p,m,b,y){var k,A,T,C,R,S,U,N,D,Y=y.bits,L=0,I=0,E=0,B=0,J=0,j=0,st=0,tt=0,ft=0,V=0,W=null,Et=0,at=new s.Buf16(16),lt=new s.Buf16(16),Ut=null,Vt=0;for(L=0;L<=15;L++)at[L]=0;for(I=0;I<h;I++)at[f[d+I]]++;for(J=Y,B=15;1<=B&&at[B]===0;B--);if(B<J&&(J=B),B===0)return p[m++]=20971520,p[m++]=20971520,y.bits=1,0;for(E=1;E<B&&at[E]===0;E++);for(J<E&&(J=E),L=tt=1;L<=15;L++)if(tt<<=1,(tt-=at[L])<0)return-1;if(0<tt&&(u===0||B!==1))return-1;for(lt[1]=0,L=1;L<15;L++)lt[L+1]=lt[L]+at[L];for(I=0;I<h;I++)f[d+I]!==0&&(b[lt[f[d+I]]++]=I);if(S=u===0?(W=Ut=b,19):u===1?(W=o,Et-=257,Ut=a,Vt-=257,256):(W=c,Ut=l,-1),L=E,R=m,st=I=V=0,T=-1,C=(ft=1<<(j=J))-1,u===1&&852<ft||u===2&&592<ft)return 1;for(;;){for(U=L-st,D=b[I]<S?(N=0,b[I]):b[I]>S?(N=Ut[Vt+b[I]],W[Et+b[I]]):(N=96,0),k=1<<L-st,E=A=1<<j;p[R+(V>>st)+(A-=k)]=U<<24|N<<16|D|0,A!==0;);for(k=1<<L-1;V&k;)k>>=1;if(k!==0?(V&=k-1,V+=k):V=0,I++,--at[L]==0){if(L===B)break;L=f[d+b[I]]}if(J<L&&(V&C)!==T){for(st===0&&(st=J),R+=E,tt=1<<(j=L-st);j+st<B&&!((tt-=at[j+st])<=0);)j++,tt<<=1;if(ft+=1<<j,u===1&&852<ft||u===2&&592<ft)return 1;p[T=V&C]=J<<24|j<<16|R-m|0}}return V!==0&&(p[R+V]=L-st<<24|64<<16|0),y.bits=J,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var G=F.length;0<=--G;)F[G]=0}var l=0,u=29,f=256,d=f+1+u,h=30,p=19,m=2*d+1,b=15,y=16,k=7,A=256,T=16,C=17,R=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=new Array(2*(d+2));c(Y);var L=new Array(2*h);c(L);var I=new Array(512);c(I);var E=new Array(256);c(E);var B=new Array(u);c(B);var J,j,st,tt=new Array(h);function ft(F,G,ct,ht,q){this.static_tree=F,this.extra_bits=G,this.extra_base=ct,this.elems=ht,this.max_length=q,this.has_stree=F&&F.length}function V(F,G){this.dyn_tree=F,this.max_code=0,this.stat_desc=G}function W(F){return F<256?I[F]:I[256+(F>>>7)]}function Et(F,G){F.pending_buf[F.pending++]=255&G,F.pending_buf[F.pending++]=G>>>8&255}function at(F,G,ct){F.bi_valid>y-ct?(F.bi_buf|=G<<F.bi_valid&65535,Et(F,F.bi_buf),F.bi_buf=G>>y-F.bi_valid,F.bi_valid+=ct-y):(F.bi_buf|=G<<F.bi_valid&65535,F.bi_valid+=ct)}function lt(F,G,ct){at(F,ct[2*G],ct[2*G+1])}function Ut(F,G){for(var ct=0;ct|=1&F,F>>>=1,ct<<=1,0<--G;);return ct>>>1}function Vt(F,G,ct){var ht,q,mt=new Array(b+1),bt=0;for(ht=1;ht<=b;ht++)mt[ht]=bt=bt+ct[ht-1]<<1;for(q=0;q<=G;q++){var dt=F[2*q+1];dt!==0&&(F[2*q]=Ut(mt[dt]++,dt))}}function Ft(F){var G;for(G=0;G<d;G++)F.dyn_ltree[2*G]=0;for(G=0;G<h;G++)F.dyn_dtree[2*G]=0;for(G=0;G<p;G++)F.bl_tree[2*G]=0;F.dyn_ltree[2*A]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function kt(F){8<F.bi_valid?Et(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function $t(F,G,ct,ht){var q=2*G,mt=2*ct;return F[q]<F[mt]||F[q]===F[mt]&&ht[G]<=ht[ct]}function Pt(F,G,ct){for(var ht=F.heap[ct],q=ct<<1;q<=F.heap_len&&(q<F.heap_len&&$t(G,F.heap[q+1],F.heap[q],F.depth)&&q++,!$t(G,ht,F.heap[q],F.depth));)F.heap[ct]=F.heap[q],ct=q,q<<=1;F.heap[ct]=ht}function Se(F,G,ct){var ht,q,mt,bt,dt=0;if(F.last_lit!==0)for(;ht=F.pending_buf[F.d_buf+2*dt]<<8|F.pending_buf[F.d_buf+2*dt+1],q=F.pending_buf[F.l_buf+dt],dt++,ht===0?lt(F,q,G):(lt(F,(mt=E[q])+f+1,G),(bt=S[mt])!==0&&at(F,q-=B[mt],bt),lt(F,mt=W(--ht),ct),(bt=U[mt])!==0&&at(F,ht-=tt[mt],bt)),dt<F.last_lit;);lt(F,A,G)}function Be(F,G){var ct,ht,q,mt=G.dyn_tree,bt=G.stat_desc.static_tree,dt=G.stat_desc.has_stree,At=G.stat_desc.elems,le=-1;for(F.heap_len=0,F.heap_max=m,ct=0;ct<At;ct++)mt[2*ct]!==0?(F.heap[++F.heap_len]=le=ct,F.depth[ct]=0):mt[2*ct+1]=0;for(;F.heap_len<2;)mt[2*(q=F.heap[++F.heap_len]=le<2?++le:0)]=1,F.depth[q]=0,F.opt_len--,dt&&(F.static_len-=bt[2*q+1]);for(G.max_code=le,ct=F.heap_len>>1;1<=ct;ct--)Pt(F,mt,ct);for(q=At;ct=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Pt(F,mt,1),ht=F.heap[1],F.heap[--F.heap_max]=ct,F.heap[--F.heap_max]=ht,mt[2*q]=mt[2*ct]+mt[2*ht],F.depth[q]=(F.depth[ct]>=F.depth[ht]?F.depth[ct]:F.depth[ht])+1,mt[2*ct+1]=mt[2*ht+1]=q,F.heap[1]=q++,Pt(F,mt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(Bt,Hn){var O,g,_,M,z,Q,it=Hn.dyn_tree,zt=Hn.max_code,Oe=Hn.stat_desc.static_tree,we=Hn.stat_desc.has_stree,Ie=Hn.stat_desc.extra_bits,ce=Hn.stat_desc.extra_base,Dc=Hn.stat_desc.max_length,mh=0;for(M=0;M<=b;M++)Bt.bl_count[M]=0;for(it[2*Bt.heap[Bt.heap_max]+1]=0,O=Bt.heap_max+1;O<m;O++)Dc<(M=it[2*it[2*(g=Bt.heap[O])+1]+1]+1)&&(M=Dc,mh++),it[2*g+1]=M,zt<g||(Bt.bl_count[M]++,z=0,ce<=g&&(z=Ie[g-ce]),Q=it[2*g],Bt.opt_len+=Q*(M+z),we&&(Bt.static_len+=Q*(Oe[2*g+1]+z)));if(mh!==0){do{for(M=Dc-1;Bt.bl_count[M]===0;)M--;Bt.bl_count[M]--,Bt.bl_count[M+1]+=2,Bt.bl_count[Dc]--,mh-=2}while(0<mh);for(M=Dc;M!==0;M--)for(g=Bt.bl_count[M];g!==0;)zt<(_=Bt.heap[--O])||(it[2*_+1]!==M&&(Bt.opt_len+=(M-it[2*_+1])*it[2*_],it[2*_+1]=M),g--)}}(F,G),Vt(mt,le,F.bl_count)}function v(F,G,ct){var ht,q,mt=-1,bt=G[1],dt=0,At=7,le=4;for(bt===0&&(At=138,le=3),G[2*(ct+1)+1]=65535,ht=0;ht<=ct;ht++)q=bt,bt=G[2*(ht+1)+1],++dt<At&&q===bt||(dt<le?F.bl_tree[2*q]+=dt:q!==0?(q!==mt&&F.bl_tree[2*q]++,F.bl_tree[2*T]++):dt<=10?F.bl_tree[2*C]++:F.bl_tree[2*R]++,mt=q,le=(dt=0)===bt?(At=138,3):q===bt?(At=6,3):(At=7,4))}function ot(F,G,ct){var ht,q,mt=-1,bt=G[1],dt=0,At=7,le=4;for(bt===0&&(At=138,le=3),ht=0;ht<=ct;ht++)if(q=bt,bt=G[2*(ht+1)+1],!(++dt<At&&q===bt)){if(dt<le)for(;lt(F,q,F.bl_tree),--dt!=0;);else q!==0?(q!==mt&&(lt(F,q,F.bl_tree),dt--),lt(F,T,F.bl_tree),at(F,dt-3,2)):dt<=10?(lt(F,C,F.bl_tree),at(F,dt-3,3)):(lt(F,R,F.bl_tree),at(F,dt-11,7));mt=q,le=(dt=0)===bt?(At=138,3):q===bt?(At=6,3):(At=7,4)}}c(tt);var et=!1;function P(F,G,ct,ht){at(F,(l<<1)+(ht?1:0),3),function(q,mt,bt,dt){kt(q),Et(q,bt),Et(q,~bt),s.arraySet(q.pending_buf,q.window,mt,bt,q.pending),q.pending+=bt}(F,G,ct)}i._tr_init=function(F){et||(function(){var G,ct,ht,q,mt,bt=new Array(b+1);for(q=ht=0;q<u-1;q++)for(B[q]=ht,G=0;G<1<<S[q];G++)E[ht++]=q;for(E[ht-1]=q,q=mt=0;q<16;q++)for(tt[q]=mt,G=0;G<1<<U[q];G++)I[mt++]=q;for(mt>>=7;q<h;q++)for(tt[q]=mt<<7,G=0;G<1<<U[q]-7;G++)I[256+mt++]=q;for(ct=0;ct<=b;ct++)bt[ct]=0;for(G=0;G<=143;)Y[2*G+1]=8,G++,bt[8]++;for(;G<=255;)Y[2*G+1]=9,G++,bt[9]++;for(;G<=279;)Y[2*G+1]=7,G++,bt[7]++;for(;G<=287;)Y[2*G+1]=8,G++,bt[8]++;for(Vt(Y,d+1,bt),G=0;G<h;G++)L[2*G+1]=5,L[2*G]=Ut(G,5);J=new ft(Y,S,f+1,d,b),j=new ft(L,U,0,h,b),st=new ft(new Array(0),N,0,p,k)}(),et=!0),F.l_desc=new V(F.dyn_ltree,J),F.d_desc=new V(F.dyn_dtree,j),F.bl_desc=new V(F.bl_tree,st),F.bi_buf=0,F.bi_valid=0,Ft(F)},i._tr_stored_block=P,i._tr_flush_block=function(F,G,ct,ht){var q,mt,bt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(dt){var At,le=4093624447;for(At=0;At<=31;At++,le>>>=1)if(1&le&&dt.dyn_ltree[2*At]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(At=32;At<f;At++)if(dt.dyn_ltree[2*At]!==0)return a;return o}(F)),Be(F,F.l_desc),Be(F,F.d_desc),bt=function(dt){var At;for(v(dt,dt.dyn_ltree,dt.l_desc.max_code),v(dt,dt.dyn_dtree,dt.d_desc.max_code),Be(dt,dt.bl_desc),At=p-1;3<=At&&dt.bl_tree[2*D[At]+1]===0;At--);return dt.opt_len+=3*(At+1)+5+5+4,At}(F),q=F.opt_len+3+7>>>3,(mt=F.static_len+3+7>>>3)<=q&&(q=mt)):q=mt=ct+5,ct+4<=q&&G!==-1?P(F,G,ct,ht):F.strategy===4||mt===q?(at(F,2+(ht?1:0),3),Se(F,Y,L)):(at(F,4+(ht?1:0),3),function(dt,At,le,Bt){var Hn;for(at(dt,At-257,5),at(dt,le-1,5),at(dt,Bt-4,4),Hn=0;Hn<Bt;Hn++)at(dt,dt.bl_tree[2*D[Hn]+1],3);ot(dt,dt.dyn_ltree,At-1),ot(dt,dt.dyn_dtree,le-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,bt+1),Se(F,F.dyn_ltree,F.dyn_dtree)),Ft(F),ht&&kt(F)},i._tr_tally=function(F,G,ct){return F.pending_buf[F.d_buf+2*F.last_lit]=G>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&G,F.pending_buf[F.l_buf+F.last_lit]=255&ct,F.last_lit++,G===0?F.dyn_ltree[2*ct]++:(F.matches++,G--,F.dyn_ltree[2*(E[ct]+f+1)]++,F.dyn_dtree[2*W(G)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){at(F,2,3),lt(F,A,Y),function(G){G.bi_valid===16?(Et(G,G.bi_buf),G.bi_buf=0,G.bi_valid=0):8<=G.bi_valid&&(G.pending_buf[G.pending++]=255&G.bi_buf,G.bi_buf>>=8,G.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(T){Or.nextTick(function(){k(T)})}:function(){if(o.postMessage&&!o.importScripts){var T=!0,C=o.onmessage;return o.onmessage=function(){T=!1},o.postMessage("","*"),o.onmessage=C,T}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(T){o.postMessage(f+T,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(T){k(T.data)},function(T){u.port2.postMessage(T)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(T){var C=m.createElement("script");C.onreadystatechange=function(){k(T),C.onreadystatechange=null,l.removeChild(C),C=null},l.appendChild(C)}):function(T){setTimeout(k,0,T)},b.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var C=new Array(arguments.length-1),R=0;R<C.length;R++)C[R]=arguments[R+1];var S={callback:T,args:C};return h[d]=S,c(d),d++},b.clearImmediate=y}function y(T){delete h[T]}function k(T){if(p)setTimeout(k,0,T);else{var C=h[T];if(C){p=!0;try{(function(R){var S=R.callback,U=R.args;switch(U.length){case 0:S();break;case 1:S(U[0]);break;case 2:S(U[0],U[1]);break;case 3:S(U[0],U[1],U[2]);break;default:S.apply(a,U)}})(C)}finally{y(T),p=!1}}}}function A(T){T.source===o&&typeof T.data=="string"&&T.data.indexOf(f)===0&&k(+T.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Nn<"u"?Nn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ox);var $4=Ox.exports,wp=no($4);const Ix={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Ix);var Ar=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},ha,Pc,to;class j4{constructor(...e){ha.set(this,new Map),Pc.set(this,new Map),to.set(this,new Map);for(const n of e)this.define(n)}define(e,n=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Ar(this,to,"f").has(r)||Ar(this,to,"f").set(r,new Set);const s=Ar(this,to,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Ar(this,Pc,"f").set(r,a),o=!1,c)continue;const l=Ar(this,ha,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Ar(this,ha,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const n=e.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<e.length;return!(r.length<n.length-1)&&i?null:Ar(this,ha,"f").get(r)??null}getExtension(e){var n;return typeof e!="string"?null:(e=(n=e==null?void 0:e.split)==null?void 0:n.call(e,";")[0],(e&&Ar(this,Pc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Ar(this,to,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Ar(this,to,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Ar(this,ha,"f"),extensions:Ar(this,Pc,"f")}}}ha=new WeakMap,Pc=new WeakMap,to=new WeakMap;var z4=new j4(Ix)._freeze();function Nx(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:if(t.endsWith(".xp"))return"application/rexpaint";break}return z4.getType(t)??"application/octet-stream"}async function K4(t,e,n){try{fe(nt,t,"parsezipfile",e.name);const r=await e.arrayBuffer();(await new wp().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=Nx(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{he(nt,t,"crash",c.message)})})}catch(r){he(nt,t,"crash",r.message)}}async function Cx(t,e,n){try{fe(nt,e,"parsebinaryfile",t.name);const r=await t.arrayBuffer();n(new Uint8Array(r))}catch(r){he(nt,e,"crash",r.message)}}function Lx(t,e){function n(r){if(x(e))switch(r){case"text/plain":e.text().then(i=>nl(nt,t,void 0,"text",`file:${e.name}`,i)).catch(i=>he(nt,t,"crash",i.message));break;case"application/json":e.text().then(i=>nl(nt,t,void 0,"json",`file:${e.name}`,i)).catch(i=>he(nt,t,"crash",i.message));break;case"application/zip":K4(t,e,i=>Lx(t,i)).catch(i=>he(nt,t,"crash",i.message));break;case"application/rexpaint":Cx(e,t,i=>nl(nt,t,void 0,"rexpaint",`file:${e.name}`,i)).catch(i=>he(nt,t,"crash",i.message));break;case"application/octet-stream":Cx(e,t,i=>nl(nt,t,void 0,"binary",`file:${e.name}`,i)).catch(i=>he(nt,t,"crash",i.message));break;default:e.arrayBuffer().then(i=>{const s=Nx(e.name,new Uint8Array(i));if(s)n(s);else return he(nt,t,"parsewebfile",`unsupported file ${e.name}`)}).catch(i=>he(nt,t,"crash",i.message));return}}n((e==null?void 0:e.type)??"")}function fa(t,e,n){function r(i){he(t,e,"crash",i.message)}n().catch(r)}function W4(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function H4(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const G4=new Date("1980/09/02");async function Mx(t){return console.info("saved",t),new Promise((e,n)=>{const r=new wp;for(let i=0;i<t.length;++i){const s=t[i],o=qU(s);if(o){const a=VI(o);x(a)&&r.file(s.id,a,{date:G4})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(H4(i))}).catch(n)})}async function Y4(t){return new Promise((e,n)=>{const r=new wp;r.loadAsync(W4(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=JU(ZI(c));x(l)&&i.push(l)}e(i)}).catch(n)})}const Ux="$yellow$205$205$205$196";function Fx(t,e){return`${t.x},${t.y},${e.x},${e.y}`}let nn;function V4(){return!!nn}function Z4(t,e,n){const r=Math.min(e.x,n.x),i=Math.min(e.y,n.y),s=Math.max(e.x,n.x),o=Math.max(e.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},p=ge(t,{x:d,y:f});(p==null?void 0:p.category)===cr.ISOBJECT?(l.push(Yn(jo(t,d,f))),is(p)!=="player"&&u.push({...Yn(p),...h,id:"blank"})):l.push({...Yn(p),...h})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}function X4(t,e,n,r){const i=ar(t);if(x(i))switch(nn=Z4(i,e,n),r){case"copyobjects":nn.terrain=[];break;case"copyterrain":nn.objects=[];break}}function q4(t,e,n){const r=Fx(e,n);ae(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,Ux),jt(t,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),jt(t,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),jt(t,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=In(t);i.scroll=mi(t)}function J4(t,e,n,r){const i=ar(t);if(!x(i)||!x(nn))return;const s=Math.min(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.x,n.x),c=Math.max(e.y,n.y),l=a-s+1,u=c-o+1,f=Math.min(nn.width,l),d=Math.min(nn.height,u);switch(r){case"pasteall":{for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Lo({x:p,y:h},nn.width);ln(i,{...nn.terrain[m],x:s+p,y:o+h})}for(let h=0;h<nn.objects.length;++h){const p=nn.objects[h];x(p.x)&&x(p.y)&&Mo(p.x,p.y,0,l-1,u-1,0)&&kd(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let h=0;h<nn.objects.length;++h){const p=nn.objects[h];x(p.x)&&x(p.y)&&Mo(p.x,p.y,0,l-1,u-1,0)&&kd(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let h=0;h<d;++h)for(let p=0;p<f;++p){const m=Lo({x:p,y:h},nn.width);ln(i,{...nn.terrain[m],x:s+p,y:o+h})}break;case"pasteterraintiled":for(let h=o;h<=c;++h)for(let p=s;p<=a;++p){const m=(p-s)%nn.width,b=(h-o)%nn.height,y=Lo({x:m,y:b},nn.width);ln(i,{...nn.terrain[y],x:p,y:h})}break}}function Q4(t,e,n){const r=Fx(e,n);ae(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,Ux),jt(t,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),jt(t,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),jt(t,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),jt(t,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=In(t);i.scroll=mi(t)}const eo="$yellow$205$205$205$196";function dh(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function tj(t,e,n,r){const i=ar(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){Rt(u)&&(s=u,iy(e.x,e.y,n.x,n.y).forEach(f=>{const d=ge(i,f);x(d)&&(d[l]=u)}))}ae(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,eo),jt(t,`batch:${dh(e,n)}`,"char",[r,"charedit"],o,a);const c=In(t);c.scroll=mi(t)}function ej(t,e,n,r){const i=ar(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){if(Rt(u)){s=u;for(let f=e.y;f<=n.y;++f)for(let d=e.x;d<=n.x;++d){const h=ge(i,{x:d,y:f});x(h)&&(h[l]=u)}}}ae(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,eo),jt(t,`batch:${dh(e,n)}`,"color",[r,"coloredit"],o,a);const c=In(t);c.scroll=mi(t)}function nj(t,e,n,r){const i=ar(t);if(!x(i))return;let s=0;function o(){return s}function a(l,u){Rt(u)&&(s=u,iy(e.x,e.y,n.x,n.y).forEach(f=>{const d=ge(i,f);x(d)&&(d[l]=u)}))}ae(t,`batch chars: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,eo),jt(t,`batch:${dh(e,n)}`,"color",[r,"coloredit"],o,a);const c=In(t);c.scroll=mi(t)}const Bc={stat:"",patternsize:2,mirror:1};function rj(t,e,n){const r=En(Dt.MAIN);if(!x(r))return;const i=ar(t);if(!x(i))return;const s=dh(e,n);ae(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,eo),jt(t,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),V4()&&jt(t,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),jt(t,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(h){const{target:p}=Vn(h);return Bc[p]}function a(h,p){if(Rt(p)||wt(p)){const{target:m}=Vn(h);Bc[m]=p}}jt(t,"batch","remix",[`stat:${s}`,"text"],o,a),jt(t,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),jt(t,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),jt(t,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),ae(t,eo),jt(t,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),jt(t,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),jt(t,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),ae(t,eo),jt(t,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),ae(t,eo),ae(t,"codepages:");const c=Math.min(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.x,n.x),f=Math.max(e.y,n.y),d=new Set;for(let h=l;h<=f;++h)for(let p=c;p<=u;++p){const m=ge(i,{x:p,y:h}),b=hE(r,m);x(b)&&!d.has(b.id)&&(d.add(b.id),jt(t,"batch",`edit @${je(b)}`,[`pageopen:${b.id}`]))}}const da="$yellow$205$205$205$196";function Ep(t,e){return`inspect:${e!=null&&e.id?e.id:Mr(t,e)}`}function ij(t,e,n){const r=En(Dt.MAIN);if(!x(r))return;const i=ar(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===cr.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=Ep(i,e);ae(t,`${a}: ${c} ${l}`),ae(t,da),jt(t,u,"color",[n,"coloredit"],s,o);const f=In(t);f.scroll=mi(t)}function sj(t,e,n){const r=En(Dt.MAIN);if(!x(r))return;const i=ar(t);if(!x(i))return;function s(d){var p;return(e==null?void 0:e[d])??((p=e==null?void 0:e.kinddata)==null?void 0:p[d])??0}function o(d,h){x(e)&&(e[d]=h)}const a=e.category===cr.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=Ep(i,e);ae(t,`${a}: ${c} ${l}`),ae(t,da),jt(t,u,"char",[n,"charedit"],s,o);const f=In(t);f.scroll=mi(t)}function oj(t,e,n,r,i,s){var f,d,h;function o(p){var b;const m=(r==null?void 0:r[p])??((b=r==null?void 0:r.kinddata)==null?void 0:b[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Wt.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?ae(t,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ae(t,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ae(t,da);const c=Ep(e,r);s?(jt(t,c,"cycle",["cycle","number","1","255"],o,a),jt(t,c,"collision",["collision","select","iswalking",`${Wt.ISWALK}`,"isswimming",`${Wt.ISSWIM}`],o,a)):jt(t,c,"collision",["collision","select","iswalkable",`${Wt.ISWALK}`,"isswimable",`${Wt.ISSWIM}`,"issolid",`${Wt.ISSOLID}`],o,a),s&&jt(t,c,"pushable",["pushable","select","no","0","yes","1"],o,a),jt(t,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const l=Ac(n),u=Sr(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(se(l[m])){const[b,y,...k]=l[m];wt(y)&&jt(t,c,y||m,[m,b,...k],o,a)}break}}jt(t,c,"copy coords",["copycoords","hk","5"," 5 "]),ae(t,da),jt(t,c,`char: ${r.char??((f=r.kinddata)==null?void 0:f.char)??1}`,["char","hk","a"," A ","next"],o,a),jt(t,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),jt(t,c,`bg: ${r.bg??((h=r.kinddata)==null?void 0:h.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ae(t,da),jt(t,c,"make empty",["empty","hk","0"],o,a),ae(t,da),jt(t,"batch",`edit @${je(n)}`,[`pageopen:${n.id}`])}const Px="$yellow$205$205$205$196";function aj(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function cj(t,e,n,r){const i=En(Dt.MAIN);if(!x(i))return;const s=ar(t);if(x(s))switch(r){case"emptyall":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=ge(s,{x:a,y:o});(c==null?void 0:c.category)===cr.ISOBJECT&&ir(i,s,c,i.timestamp),ln(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a){const c=ge(s,{x:a,y:o});(c==null?void 0:c.category)===cr.ISOBJECT&&ir(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=n.y;++o)for(let a=e.x;a<=n.x;++a)ln(s,{x:a,y:o});break}}}function lj(t,e,n){const r=aj(e,n);ae(t,`selected: ${e.x},${e.y} - ${n.x},${n.y}`),ae(t,Px),jt(t,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),jt(t,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),jt(t,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=In(t);i.scroll=mi(t)}function uj(t,e,n){const r=En(Dt.MAIN);if(!x(r))return;const i=ar(t);if(!x(i))return;if(He(r,i),e.x===n.x&&e.y===n.y){const o=ge(i,e),a=hE(r,o);x(o)&&x(a)&&oj(t,i,a,o,e,yn(o)),o!=null&&o.kind||(ae(t,`empty: ${e.x}, ${e.y}`),ae(t,Px),jt(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]))}else rj(t,e,n);const s=In(t);s.scroll=mi(t)}function hj(t,e){const n=ue(Dt.MAIN);if(!x(n))return;const r=ar(e);if(!x(r))return;const i=Vn(t),s=QI(r,i.target);if(x(s))switch(i.path){case"copycoords":rf(nt,or(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":ij(e,s,i.path);break;case"char":sj(e,s,i.path);break;case"empty":ir(n,r,s,n.timestamp);break;case"code":fa(nt,e,async()=>{const o=is(s),a="object";fe(nt,e,`opened [${a}] ${o}`);const c=[r.id,s.id];ed(el(n.id,c),s.code??""),MA(nt,e),await ug(800),ag(nt,e,n.id,c,a,`${o} - ${n.name}`,[])});break;default:console.info("unknown inspect",i);break}}function fj(t,e){const n=ar(e);if(!x(n))return;const r=Vn(t),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":q4(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":X4(e,c,l,r.target);break;case"paste":Q4(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":J4(e,c,l,r.target);break;case"empty":lj(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":cj(e,c,l,r.target);break;case"chars":tj(e,c,l,"char");break;case"colors":ej(e,c,l,"color");break;case"bgs":nj(e,c,l,"bg");break;case"copycoords":rf(nt,e,[i,s,o,a].join(" "));break;case"remixrun":{const u=jn(w.book,_t.BOARD,Bc.stat),f=Te(...u);x(f)&&VE(n.id,f.id,Bc.patternsize,Bc.mirror,c,l,"all");break}case"pageopen":fa(nt,e,async()=>{await ug(800),JA(nt,e,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const dj=16,ys={},ph={},pj=60;let Bx=0;const pa={},ma={};async function Dx(t){const e=aa(),n=ue(Dt.MAIN);if(e.length&&x(n)){const r=await Mx(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;FA(re,or(),i,r)}}async function mj(){const t=aa(),e=ue(Dt.MAIN);if(t.length&&x(e)){const n=await Mx(t);PA(re,or(),n)}}const re=io("vm",["tick","second"],t=>{var n;if(!re.session(t))return;const e=or();switch(t.target){case"operator":g4(t.player),fe(re,t.player,`operator set to ${t.player}`),re.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=ue(Dt.MAIN);re.replynext(t,"ackzsswords",{cli:op(ms.CLI),loader:op(ms.LOADER),runtime:op(ms.RUNTIME),flags:[...Sr(Tr(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...Vs(r,_t.OBJECT).map(i=>je(i)),...Sr(ep)],altkinds:[...Vs(r,_t.TERRAIN),...Vs(r,_t.BOARD),...Vs(r,_t.PALETTE),...Vs(r,_t.CHARSET),...Vs(r,_t.LOADER)].map(i=>je(i)),colors:[...Sr(qa)],dirs:[...Sr(cd).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Sr(np)]});break}case"books":t.player===e&&fa(re,t.player,async()=>{if(se(t.data)){const[r,i]=t.data,s=await Y4(r),o=s.map(a=>a.name);v4(s,i),fe(re,t.player,`loading ${o.join(", ")}`),nf(re,t.player)}});break;case"search":A4(t.player)||nf(re,t.player);break;case"logout":T4(t.player),delete ys[t.player],fe(re,e,`player ${t.player} logout`),nf(re,t.player);break;case"login":xx(t.player)?(ys[t.player]=0,fe(re,or(),`login from ${t.player}`),re.replynext(t,"acklogin",!0)):ig(re,t.player);break;case"local":xx(t.player)?(ys[t.player]=0,fe(re,or(),`login from ${t.player}`)):ig(re,t.player);break;case"doot":ys[t.player]=0,ph[t.player]=ph[t.player]??0,ph[t.player]%32===0&&fe(re,t.player,`$whiteactive $blue${t.player}`),++ph[t.player];break;case"input":{if(!t.player.includes("local")||E4(t.player)){const r=Tr(t.player),[i=An.NONE,s=0]=t.data??[An.NONE,0];se(r.inputqueue)||(r.inputqueue=[]),i!==An.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(se(t.data)){const[r,i]=t.data,s=el(r,i);x(ma[s])||(ma[s]=ny(s,o=>{const[a,c]=i,l=zr(r),u=Di(l,a);if(x(u))if(Pi(u)===_t.BOARD&&x(c)){const f=Le(u),d=Tn(f,c);x(d)&&(d.code=o,P0(oE(o),d))}else u.code=o,XU(u)})),pa[s]=pa[s]??new Set,pa[s].add(t.player)}break;case"coderelease":if(se(t.data)){const[r,i]=t.data,[,s]=i,o=el(r,i);x(pa[o])&&(pa[o].delete(t.player),pa[o].size===0&&((n=ma[o])==null||n.call(ma),ma[o]=void 0,wt(s)&&O4(s)))}break;case"halt":t.player===e&&vv(t.data)&&_4(t.data);break;case"tick":y4()||N4();break;case"synthsend":wt(t.data)&&_p(t.data,void 0);break;case"second":{R4(ys);const r=Object.keys(ys);for(let i=0;i<r.length;++i)++ys[r[i]];for(let i=0;i<r.length;++i){const s=r[i];ys[s]>=dj&&cg(re,s)}++Bx>=pj&&(Bx=0,fa(re,t.player,async()=>{await Dx(!0)}));break}case"copyjsonfile":if(t.player===e){const r=ue(Dt.MAIN);if(x(r)&&se(t.data)){const[i]=t.data,s=Di(r,i);x(s)&&BA(re,e,s,`${je(s)}.${Bi(s)}.json`)}}break;case"refsheet":{const r=ue(Dt.MAIN),i=$u(r);x(r)&&se(t.data)&&(qA(re,t.player),Gu(re,t.player,"use as refsheet"),i.forEach(s=>{const o=je(s),a=Bi(s);Re(re,t.player,`!pageopenwith ${s.id} ${t.data.join(" ")};$blue[${a}]$white ${o}`)}));break}case"fork":t.player===e&&fa(re,t.player,async()=>{await mj()});break;case"flush":t.player===e&&fa(re,t.player,async()=>{await Dx()});break;case"cli":Tx(t.player,t.data);break;case"clirepeatlast":C4(t.player);break;case"restart":t.player===e&&(I4(),lg(re,t.player));break;case"inspect":if(se(t.data)){const[r,i]=t.data;uj(t.player,r,i)}break;case"loader":if(se(t.data)){const[r,i,s,o]=t.data;if(i==="file")Lx(t.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){fe(re,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=ue(Dt.MAIN);x(c)&&x(a.data)&&wt(a.exported)&&(gp(a.data),fe(re,t.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){fe(re,t.player,`loading ${s}`);const a=JSON.parse(o.json),c=ue(Dt.MAIN);x(c)&&x(a.data)&&wt(a.exported)&&(fE(c,a.data),fe(re,t.player,`loaded ${a.exported}`))}else F$(r,i,s,o,t.player)}break;default:{const{target:r,path:i}=Vn(t.target);switch(It(r)){case"batch":fj(i,t.player);break;case"empty":{const s=Vn(i);switch(s.target){case"copycoords":rf(re,or(),s.path.split(",").join(" "));break}break}case"inspect":hj(i,t.player);break;case"touched":if(se(t.data)){const[s,o,a]=t.data;vx({...t,target:`${s}:${a}`,data:void 0,sender:o})}break;default:vx(t);break}break}}},m4());function gj(){UA(re)}const{forward:_j}=sR(t=>{oR(t)&&postMessage(t)});onmessage=function(e){_j(e.data)},setTimeout(gj,100)})();

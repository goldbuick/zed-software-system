var oC=Object.defineProperty;var aC=(Xt,ee,Ze)=>ee in Xt?oC(Xt,ee,{enumerable:!0,configurable:!0,writable:!0,value:Ze}):Xt[ee]=Ze;var P=(Xt,ee,Ze)=>(aC(Xt,typeof ee!="symbol"?ee+"":ee,Ze),Ze);(function(){"use strict";const Xt=new Set,ee={emit(t,e,n,r){ee.invoke(Vm(t,e,n,r))},invoke(t){Xt.forEach(e=>e.handle(t))},connect(t){Xt.add(t)},disconnect(t){Xt.delete(t)}};var Ze=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Cm(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var jl={};(function(t){var e=Ze&&Ze.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function s(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function i(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,E=p===void 0?1:p,A=l.addAdverb,S=A===void 0?!1:A,b=e(e(e([],e([],Array(E),!0).map(function(w){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),S?[n(t.adverbs)]:[],!0);return f&&(b=b.map(function(w){return w.charAt(0).toUpperCase()+w.substr(1)})),b.join(h)}t.humanId=i;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,E=p===void 0?"":p;return r(t.adjectives).length*h+h*E.length+r(t.nouns).length+E.length+r(t.verbs).length+(f?r(t.adverbs).length+E.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,E=p===void 0?"":p;return s(t.adjectives).length*h+h*E.length+s(t.nouns).length+E.length+s(t.verbs).length+(f?s(t.adverbs).length+E.length:0)}t.minLength=c,t.default=i})(jl);var Im=qs(jl);const Lm="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Mm=t=>crypto.getRandomValues(new Uint8Array(t)),xm=(t,e,n)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,s=-~(1.6*r*e/t.length);return(i=e)=>{let o="";for(;;){let a=n(s),c=s;for(;c--;)if(o+=t[a[c]&r]||"",o.length===i)return o}}},Gl=(t,e=21)=>xm(t,e,Mm),Um=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Lm[n[t]&63];return e};var Kl="abcdefghijklmnopqrstuvwxyz",Wl="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Hl="0123456789",Pm="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Dm="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const $m=Hl,Fm=Kl,Bm=Wl;var jm=$m+Fm+Bm,jo={lowercase:Kl,uppercase:Wl,numbers:Hl,nolookalikes:Pm,nolookalikesSafe:Dm,alphanumeric:jm};function Tn(){return`sid_${Um().replaceAll("-",".")}`}const Gm=Gl(jo.numbers,4),Km=Gl(`${jo.numbers}${jo.lowercase}`,16);function Wm(){return`pid_${Gm()}_${Km()}`}function Hm(){return Im({capitalize:!1,adjectiveCount:1})}function Vm(t,e,n,r){return{id:Tn(),target:t,sender:e,data:n,player:r}}function Vl(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function pr(t,e,n){const r=Tn(),s=t.toLowerCase(),i=e.map(a=>a.toLowerCase()),o={id(){return r},name(){return t},tags(){return e},emit(a,c,l){ee.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=Vl(a.target),u=c.toLowerCase();i.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||s===u)&&n({...a,target:l})}};return ee.connect(o),o}function zm(t){const e=new Set;function n(r){e.has(r.id)||(e.add(r.id),ee.invoke(r))}return pr("forward",["all"],r=>{e.has(r.id)||(e.add(r.id),t(r))}),n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Ym=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)s.hasOwnProperty(i)&&(r[i]=s[i])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),qm=Object.prototype.hasOwnProperty;function Go(t,e){return qm.call(t,e)}function Ko(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var s in t)Go(t,s)&&r.push(s);return r}function Me(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Wo(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function jn(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function zl(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Ho(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(Ho(t[e]))return!0}else if(typeof t=="object"){for(var r=Ko(t),s=r.length,i=0;i<s;i++)if(Ho(t[r[i]]))return!0}}return!1}function Yl(t,e){var n=[t];for(var r in e){var s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&n.push(r+": "+s)}return n.join(`
`)}var ql=function(t){Ym(e,t);function e(n,r,s,i,o){var a=this.constructor,c=t.call(this,Yl(n,{name:r,index:s,operation:i,tree:o}))||this;return c.name=r,c.index=s,c.operation=i,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Yl(n,{name:r,index:s,operation:i,tree:o}),c}return e}(Error),ie=ql,Xm=Me,gr={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=Xs(n,this.path);r&&(r=Me(r));var s=Gn(n,{op:"remove",path:this.from}).removed;return Gn(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=Xs(n,this.from);return Gn(n,{op:"add",path:this.path,value:Me(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:Vr(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},Jm={add:function(t,e,n){return Wo(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:gr.move,copy:gr.copy,test:gr.test,_get:gr._get};function Xs(t,e){if(e=="")return t;var n={op:"_get",path:e};return Gn(t,n),n.value}function Gn(t,e,n,r,s,i){if(n===void 0&&(n=!1),r===void 0&&(r=!0),s===void 0&&(s=!0),i===void 0&&(i=0),n&&(typeof n=="function"?n(e,0,t,e.path):Js(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Xs(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=Vr(t,e.value),o.test===!1)throw new ie("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new ie("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,t);return o}}else{r||(t=Me(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=Js;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=zl(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!Wo(f))throw new ie("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,t);Wo(f)&&(f=~~f)}if(u>=h){if(n&&e.op==="add"&&f>l.length)throw new ie("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,t);var o=Jm[e.op].call(e,l,f,t);if(o.test===!1)throw new ie("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o}}else if(u>=h){var o=gr[e.op].call(e,l,f,t);if(o.test===!1)throw new ie("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new ie("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,t)}}}function Vo(t,e,n,r,s){if(r===void 0&&(r=!0),s===void 0&&(s=!0),n&&!Array.isArray(e))throw new ie("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Me(t));for(var i=new Array(e.length),o=0,a=e.length;o<a;o++)i[o]=Gn(t,e[o],n,!0,s,o),t=i[o].newDocument;return i.newDocument=t,i}function Qm(t,e,n){var r=Gn(t,e);if(r.test===!1)throw new ie("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Js(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new ie("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(gr[t.op]){if(typeof t.path!="string")throw new ie("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new ie('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new ie("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new ie("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Ho(t.value))throw new ie("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var s=t.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new ie("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new ie("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Xl([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ie("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new ie("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function Xl(t,e,n){try{if(!Array.isArray(t))throw new ie("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Vo(Me(e),Me(t),n||!0);else{n=n||Js;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(s){if(s instanceof ie)return s;throw s}}function Vr(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),s,i,o;if(n&&r){if(i=t.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!Vr(t[s],e[s]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(i=a.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(a[s]))return!1;for(s=i;s--!==0;)if(o=a[s],!Vr(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var Zm=Object.freeze({__proto__:null,JsonPatchError:ie,_areEquals:Vr,applyOperation:Gn,applyPatch:Vo,applyReducer:Qm,deepClone:Xm,getValueByPointer:Xs,validate:Xl,validator:Js});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var zo=new WeakMap,ey=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),ty=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function ny(t){return zo.get(t)}function ry(t,e){return t.observers.get(e)}function sy(t,e){t.observers.delete(e.callback)}function iy(t,e){e.unobserve()}function oy(t,e){var n=[],r,s=ny(t);if(!s)s=new ey(t),zo.set(t,s);else{var i=ry(s,e);r=i&&i.observer}if(r)return r;if(r={},s.value=Me(t),e){r.callback=e,r.next=null;var o=function(){Yo(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){Yo(r),clearTimeout(r.next),sy(s,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},s.observers.set(e,new ty(e,r)),r}function Yo(t,e){e===void 0&&(e=!1);var n=zo.get(t.object);qo(n.value,t.object,t.patches,"",e),t.patches.length&&Vo(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function qo(t,e,n,r,s){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=Ko(e),o=Ko(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(Go(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?qo(u,h,n,r+"/"+jn(l),s):u!==h&&(s&&n.push({op:"test",path:r+"/"+jn(l),value:Me(u)}),n.push({op:"replace",path:r+"/"+jn(l),value:Me(h)}))}else Array.isArray(t)===Array.isArray(e)?(s&&n.push({op:"test",path:r+"/"+jn(l),value:Me(u)}),n.push({op:"remove",path:r+"/"+jn(l)}),a=!0):(s&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&i.length==o.length))for(var c=0;c<i.length;c++){var l=i[c];!Go(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+jn(l),value:Me(e[l])})}}}function Xo(t,e,n){n===void 0&&(n=!1);var r=[];return qo(t,e,r,"",n),r}var ay=Object.freeze({__proto__:null,compare:Xo,generate:Yo,observe:oy,unobserve:iy});Object.assign({},Zm,ay,{JsonPatchError:ql,deepClone:Me,escapePathComponent:jn,unescapePathComponent:zl});function y(t){return t!=null}function cy(t,e){return Xo(t,e).length===0}function ly(t){return Me(t)}function ke(t){return typeof t=="number"}function te(t){return typeof t=="string"}function Jt(t){return Array.isArray(t)}var Te=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.CLEAR=32]="CLEAR",t[t.SHADOW=33]="SHADOW",t[t.BORROW=34]="BORROW",t))(Te||{});function Qs(t,e){return new Array(t).fill(e)}function uy(t,e,n,r,s=0){const i=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:Qs(i,0),color:Qs(i,0),bg:Qs(i,s)}}function hy(t,e,n,r=1,s=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:s,bg:32}}function fy(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function dy(t,e,n,r,s=0){const i=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:Qs(i,s)}}function py(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:2}}var et=(t=>(t[t.START=0]="START",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.SCROLL=5]="SCROLL",t))(et||{});const gy={start:0,left:1,right:2,top:3,bottom:4,scroll:5},my={0:1,1:20,2:20,3:1,4:1,5:40},yy=1,Ey=16,_y=256;var pe=(t=>(t[t.NONE=0]="NONE",t[t.MOVE_UP=1]="MOVE_UP",t[t.MOVE_DOWN=2]="MOVE_DOWN",t[t.MOVE_LEFT=3]="MOVE_LEFT",t[t.MOVE_RIGHT=4]="MOVE_RIGHT",t[t.OK_BUTTON=5]="OK_BUTTON",t[t.CANCEL_BUTTON=6]="CANCEL_BUTTON",t[t.MENU_BUTTON=7]="MENU_BUTTON",t))(pe||{});function bn(t,e,n,r){const s=r??"anon";return ee.emit(`error:${e}`,t,n,s),Sy(t,n,s)}function wy(t,e,n){ee.emit("gadgetclient:reset",t,e,n)}function Ty(t,e,n){ee.emit("gadgetclient:patch",t,e,n)}function by(t,e,n){ee.emit("register:read",t,[e],n)}function Ay(t,e,n,r){ee.emit("register:write",t,[e,n],r)}function Kn(t,...e){return ee.emit("tape:info",t,e),!0}function Jl(t,...e){return ee.emit("tape:debug",t,e),!0}function Sy(t,...e){return ee.emit("tape:error",t,e),!1}function vy(t,e,n,r,s,i){ee.emit("tape:editor:open",t,[e,n,r,s],i)}var Ql={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Ze,function(){return n.importState=function(s){var i=new n;return i.importState(s),i},n;function n(){return function(s){var i=0,o=0,a=0,c=1;s.length==0&&(s=[+new Date]);var l=r();i=l(" "),o=l(" "),a=l(" ");for(var u=0;u<s.length;u++)i-=l(s[u]),i<0&&(i+=1),o-=l(s[u]),o<0&&(o+=1),a-=l(s[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*i+c*23283064365386963e-26;return i=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=s,h.exportState=function(){return[i,o,a,c]},h.importState=function(d){i=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,i=function(o){o=o.toString();for(var a=0;a<o.length;a++){s+=o.charCodeAt(a);var c=.02519603282416938*s;s=c>>>0,c-=s,c*=s,s=c>>>0,c-=s,s+=c*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(Ql);var Ry=Ql.exports,Oy=qs(Ry);const ky=Oy("089fad0j9awfem09wavefc09uwaef");function Wn(t,e=0,n=1){return Math.max(e,Math.min(n,t))}function Ny(){return ky()}function Zs(t,e){const n=Math.min(t,e),s=Math.max(t,e)-n+1;return n+Math.floor(Ny()*s)}function Jo(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],s=Math.min(t,e),i=Math.max(t,e);for(let o=s;o<=i;o+=n)r.push(o);return r}function Cy(t){return t[Zs(0,t.length-1)]}function Qt(...t){return Cy(t.flat())}function Iy(t){return[...new Set(t)].filter(y)}function Ly(...t){const e=t.flat().filter(y);return e.reduce((n,r)=>n+r,0)/e.length}function Zl(t,e){const n=t??Ne.WALK,r=e??Ne.WALK;switch(n){case Ne.WALK:return r!==Ne.WALK;case Ne.SWIM:return r!==Ne.SWIM;case Ne.SOLID:return!0;case Ne.BULLET:return r!==Ne.WALK&&r!==Ne.SWIM}}function Qo(t,e){var r,s;return[...((s=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:s.values())??[]].map(i=>typeof i=="string"?t==null?void 0:t.objects[i]:t==null?void 0:t.terrain[i]).filter(y)}function My(t,e){const n=ia(e),r=yu(e),s=Eu(e);return t.filter(i=>!(y(n)&&Fy(i)!==n||y(r)&&By(i)!==r||y(s)&&jy(i)!==s)).filter(y)}function Zo(t,e){return y(t)?e.map(n=>{var r;if(typeof n=="string"){const s=t.objects[n];if(y(s))return s;const i=Qo(t,n.toLowerCase());if(i.length)return i}else if(Nt(n)&&n.x>=0&&n.x<t.width&&n.y>=0&&n.y<t.height){const s=n.x+n.y*t.width,i=(r=t.lookup)==null?void 0:r[s];return y(i)?t.objects[i]:t.terrain[s]}}).flat().filter(y):[]}function xy(t,e){let n=0,r;for(let s=0;s<e.length;++s){const i=e[s];if(i){const o=t.x-(i.x??0),a=t.y-(i.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=i)}}return r}const Uy=60,Py=25;new Array(Uy*Py);function Dy(t,e){return!y(t)||e.x<0||e.x>=t.width||e.y<0||e.y>=t.height?-1:e.x+e.y*t.width}function $y(t,e){const n=Dy(t,e);if(n<0||!y(t==null?void 0:t.lookup))return;const r=ea(t,t.lookup[n]??"");return y(r)?r:t.terrain[n]}function Fy(t){var e;return((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"object").toLowerCase()}function By(t){var e;return(t==null?void 0:t.color)??((e=t==null?void 0:t.kinddata)==null?void 0:e.color)??Te.BLACK}function jy(t){var e;return(t==null?void 0:t.bg)??((e=t==null?void 0:t.kinddata)==null?void 0:e.bg)??Te.BLACK}function ei(t,e){if(!y(t)||!nt(e))return;const n=fu(e);y(n)&&(t.color=n);const r=du(e);y(r)&&(t.bg=r)}function Gy(t,e){if(!y(t)||!y(e)||!y(e.x)||!y(e.y)||e.x<0||e.x>=t.width||e.y<0||e.y>=t.height)return;const n={...e},r=e.x+e.y*t.width;return t.terrain[r]=n,e}function eu(t,e){if(!y(t)||!y(e))return;const n={...e,id:e.id??Tn()};return t.objects[n.id]=n,n}function tu(t,e,n){return Gy(t,{...e,kind:n})}function nu(t,e,n){return eu(t,{...e,kind:n})}function ea(t,e){if(t)return t.objects[e]}function mr(t,e,n){if(!y(t)||!y(e))return{x:0,y:0};const r={x:e.x??0,y:e.y??0},s={x:e.lx??r.x,y:e.ly??r.y},i={...r},o=An(s,r),a=t.width-1,c=t.height-1;for(let l=0;l<n.length;++l){const u=Hy(n[l]);switch(u){case W.IDLE:break;case W.NORTH:case W.SOUTH:case W.WEST:case W.EAST:tt(r,u);break;case W.BY:{const[h,d]=n.slice(l+1);ke(h)&&ke(d)&&(r.x=Wn(r.x+h,0,a),r.y=Wn(r.y+d,0,c)),l+=2;break}case W.AT:{const[h,d]=n.slice(l+1);ke(h)&&ke(d)&&(r.x=Wn(h,0,a),r.y=Wn(d,0,c)),l+=2;break}case W.FLOW:tt(r,o);break;case W.SEEK:{const h=na(t,e);Nt(h)&&tt(r,An(i,h));break}case W.RNDNS:tt(r,Qt(W.NORTH,W.SOUTH));break;case W.RNDNE:tt(r,Qt(W.NORTH,W.EAST));break;case W.RND:tt(r,Qt(W.NORTH,W.SOUTH,W.WEST,W.EAST));break;case W.CW:{const h=mr(t,e,n.slice(l+1));tt(r,An(i,h));break}case W.CCW:{const h=mr(t,e,n.slice(l+1));tt(r,An(i,h));break}case W.OPP:{const h=mr(t,e,n.slice(l+1));tt(r,An(i,h));break}case W.RNDP:{const h=mr(t,e,n.slice(l+1));switch(An(i,h)){case W.NORTH:case W.SOUTH:r.x+=Qt(-1,1);break;case W.WEST:case W.EAST:r.y+=Qt(-1,1);break}break}}}return r}function ta(t,e){return y(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function na(t,e){var s;if(!y(t)||!y(e))return;const n=((s=e.stats)==null?void 0:s.player)??"",r=t.objects[n];if(y(r))return r;if(Nt(e))return xy(e,Qo(t,"player"))}function Ky(t,e,n){return{book:t.book,board:t.board,object:t.object,terrain:t.terrain,charset:t.charset,palette:t.palette,words:e,get:n}}var W=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t))(W||{}),Ne=(t=>(t[t.SOLID=0]="SOLID",t[t.WALK=1]="WALK",t[t.SWIM=2]="SWIM",t[t.BULLET=3]="BULLET",t))(Ne||{}),ti=(t=>(t[t.TERRAIN=0]="TERRAIN",t[t.OBJECT=1]="OBJECT",t))(ti||{});function Nt(t){return y(t)&&y(t.x)&&y(t.y)}function tt(t,e){switch(e){case 1:--t.y;break;case 2:++t.y;break;case 3:--t.x;break;case 4:++t.x;break}return t}function An(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return 3;if(n>0)return 4;if(r<0)return 1;if(r>0)return 2}const ru={terrain:"TERRAIN",object:"OBJECT"};function Sn(t){return Jt(t)&&su(t[0])}function su(t){return y(ti[t])&&te(t)}function iu(t){if(te(t))return ru[t.toLowerCase()]}function ou(t){if(Sn(t))return t;if(su(t))return[t];const e=iu(t);if(y(e))return[e]}function ni(t,e){const n=t.words[e],r=ou(n);if(Sn(r))return[r,e+1];const[s,i]=xe(t,e),o=ou(s);return Sn(o)?[o,i]:[void 0,e]}const au={solid:"SOLID",walk:"WALK",swim:"SWIM",bullet:"BULLET",walkable:"WALK",swimmable:"SWIM"};function Hn(t){return Jt(t)&&ra(t[0])}function ra(t){return y(Ne[t])&&te(t)}function Wy(t){if(te(t))return au[t.toLowerCase()]}function cu(t,e){const n=t.words[e];if(Hn(n))return[n,e+1];if(ra(n))return[[n],e+1];const[r,s]=xe(t,e);return Hn(r)?[r,s]:ra(r)?[[r],s]:[void 0,e]}const sa={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",clear:"CLEAR",shadow:"SHADOW",borrow:"BORROW",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY"};function nt(t){return Jt(t)&&uu(t[0])}function lu(t){return nt(t)&&t[0].startsWith("ON")}function uu(t){return y(Te[t])&&te(t)}function hu(t){if(te(t))return sa[t.toLowerCase()]}function fu(t){return t.map(e=>Te[e]).find(e=>y(e)&&e<Te.ONBLACK)}function du(t){return t.map(e=>Te[e]).find(e=>y(e)&&e>=Te.ONBLACK)}function pu(t){if(nt(t))return t;if(uu(t))return[t];const e=hu(t);if(y(e))return[e]}function gu(t,e){const n=t.words[e],r=pu(n);if(nt(r))return[r,e+1];const[s,i]=xe(t,e),o=pu(s);return nt(o)?[o,i]:[void 0,e]}function ri(t,e){const n=[];let r=e;const[s,i]=gu(t,e);if(nt(s)&&(n.push(...s),r=i),nt(n)&&!lu(n)){const[o,a]=gu(t,i);lu(o)&&(r=a)}return n.length?[n,r]:[void 0,e]}function yr(t){return Jt(t)&&typeof t[0]=="string"}function mu(t,e){const n=t.words[e];if(yr(n))return[n,e+1];const[r,s]=ri(t,e),[i,o]=xe(t,s,!1);return te(i)?[[i,r],o]:[void 0,e]}function ia(t){if(!yr(t))return;const[e]=t;return e}function yu(t){if(!yr(t))return;const[,e]=t,n=y(e)?fu(e):void 0;return y(n)?n:void 0}function Eu(t){if(!yr(t))return;const[,e]=t,n=y(e)?du(e):void 0;return y(n)?n:void 0}const _u={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function Zt(t){return Jt(t)&&wu(t[0])}function wu(t){return y(W[t])&&te(t)}function Hy(t){const e=W[t];return y(e)?e:0}function Tu(t){if(te(t))return _u[t.toLowerCase()]}function bu(t){if(Zt(t))return t;if(wu(t))return[t];const e=Tu(t);if(y(e))return[e]}function Au(t,e){const n=t.words[e],r=bu(n);if(Zt(r))return[r,e+1];const[s,i]=xe(t,e),o=bu(s);return Zt(o)?[o,i]:[void 0,e]}function oa(t,e){const n=[];let[r,s]=Au(t,e);for(;Zt(r);){if(n.push(...r),r[0]==="AT"||r[0]==="BY"){const[a,c,l]=k(t,s,[5,5]);n.push(a,c),s=l}const[i,o]=Au(t,s);r=i,s=o}return n.length?[n,s]:[void 0,e]}function xe(t,e,n=!0){const r=t.words[e];if(iu(r)){const[s,i]=ni(t,e);if(y(s))return[s,i]}if(Wy(r)){const[s,i]=cu(t,e);if(y(s))return[s,i]}if(hu(r)){const[s,i]=ri(t,e);if(y(s))return[s,i]}if(te(r)&&r.toLowerCase()==="rnd"){const[s,i]=xe(t,e+1),[o,a]=xe(t,i);return ke(s)&&ke(o)?[Zs(s,o),a]:ke(s)?[Zs(0,s),i]:[Zs(0,1),e+1]}if(Tu(r)){const[s,i]=oa(t,e);if(y(s))return[s,i]}if(!y(r))return[void 0,e];if(Nt(r)||ke(r)||Jt(r))return[r,e+1];if(te(r)){const s=r.toLowerCase();if(n){const i=t.get(r);if(y(i))return[i,e+1]}switch(s){case"aligned":case"alligned":break;case"contact":break;case"blocked":break;case"any":break;case"abs":{const[i,o]=k(t,e+1,[5]);return[Math.abs(i),o]}case"ceil":{const[i,o]=k(t,e+1,[5]);return[Math.ceil(i),o]}case"floor":{const[i,o]=k(t,e+1,[5]);return[Math.floor(i),o]}case"round":{const[i,o]=k(t,e+1,[5]);return[Math.round(i),o]}case"min":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=xe(t,o);if(Jt(a)&&!Nt(a)&&!Zt(a)&&!Sn(a)&&!Hn(a)&&!nt(a))return[Qt(a),c];o=c,i.push(a)}return[Math.min(...i),t.words.length]}case"max":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=xe(t,o);if(Jt(a)&&!Nt(a)&&!Zt(a)&&!Sn(a)&&!Hn(a)&&!nt(a))return[Qt(a),c];o=c,i.push(a)}return[Math.max(...i),t.words.length]}case"clamp":{const[i,o,a,c]=k(t,e+1,[5,5,5]);return[Wn(i,o,a),c]}case"pick":{const i=[];for(let o=e+1;o<t.words.length;){const[a,c]=xe(t,o);if(Jt(a)&&!Nt(a)&&!Zt(a)&&!Sn(a)&&!Hn(a)&&!nt(a))return[Qt(a),c];o=c,i.push(a)}return[Qt(i),t.words.length]}case"range":{const[i,o,a,c]=k(t,e+1,[5,13,13]);return[Jo(i,o,a),c]}}}return[r,e+1]}var R=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NUMBER=5]="NUMBER",t[t.STRING=6]="STRING",t[t.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=9]="MAYBE_COLLISION",t[t.MAYBE_COLOR=10]="MAYBE_COLOR",t[t.MAYBE_KIND=11]="MAYBE_KIND",t[t.MAYBE_DIR=12]="MAYBE_DIR",t[t.MAYBE_NUMBER=13]="MAYBE_NUMBER",t[t.MAYBE_STRING=14]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",t[t.ANY=16]="ANY",t))(R||{});function Ce(t,e){throw new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function k(t,e,n){const r=[];let s=e;for(let i=0;i<n.length;++i)switch(n[i]){case 0:{const[o,a]=ni(t,s);Sn(o)||Ce("terrain or object",o),s=a,r.push(o);break}case 1:{const[o,a]=cu(t,s);Hn(o)||Ce("solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 2:{const[o,a]=ri(t,s);nt(o)||Ce("color",o),s=a,r.push(o);break}case 3:{const[o,a]=mu(t,s);yr(o)?(s=a,r.push(o)):Ce("kind",o);break}case 4:{const[o,a]=oa(t,s);if(Zt(o)){const c=t.board?mr(t.board,t.object,o):{x:0,y:0};s=a,r.push(c)}else Ce("direction",o);break}case 5:{const[o,a]=xe(t,s);ke(o)||Ce("number",o),s=a,r.push(o);break}case 6:{const o=t.words[s];te(o)||Ce("string",o),++s,r.push(o);break}case 7:{const[o,a]=xe(t,s,!1);!ke(o)&&!te(o)&&Ce("number or string",o),s=a,r.push(o);break}case 8:{const[o,a]=ni(t,s);o!==void 0&&!Sn(o)&&Ce("optional terrain or object",o),s=a,r.push(o);break}case 9:{const[o,a]=ni(t,s);o!==void 0&&!Hn(o)&&Ce("optional solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 10:{const[o,a]=ri(t,s);o!==void 0&&!nt(o)&&Ce("optional color",o),s=a,r.push(o);break}case 11:{const[o,a]=mu(t,s);o!==void 0&&!yr(o)&&Ce("optional kind",o),s=a,r.push(o);break}case 12:{const[o,a]=oa(t,s);if(Zt(o)){const c=t.board?mr(t.board,t.object,o):{x:0,y:0};s=a,r.push(c)}else o===void 0?(s=a,r.push(void 0)):Ce("optional direction",o);break}case 13:{const[o,a]=xe(t,s);o!==void 0&&!ke(o)&&Ce("optional number",o),s=a,r.push(o);break}case 14:{const o=t.words[s];o!==void 0&&!te(o)&&Ce("optional string",o),++s,r.push(o);break}case 15:{const[o,a]=xe(t,s,!1);o!==void 0&&!ke(o)&&!te(o)&&Ce("optional number or string",o),s=a,r.push(o);break}case 16:{const[o,a]=xe(t,s);s=a,r.push(o);break}}return[...r,s]}const aa=40,ca=Math.round(1e3/aa),Vy=3;var Su=typeof global=="object"&&global&&global.Object===Object&&global,zy=typeof self=="object"&&self&&self.Object===Object&&self,Ct=Su||zy||Function("return this")(),rt=Ct.Symbol,vu=Object.prototype,Yy=vu.hasOwnProperty,qy=vu.toString,zr=rt?rt.toStringTag:void 0;function Xy(t){var e=Yy.call(t,zr),n=t[zr];try{t[zr]=void 0;var r=!0}catch{}var s=qy.call(t);return r&&(e?t[zr]=n:delete t[zr]),s}var Jy=Object.prototype,Qy=Jy.toString;function Zy(t){return Qy.call(t)}var eE="[object Null]",tE="[object Undefined]",Ru=rt?rt.toStringTag:void 0;function vn(t){return t==null?t===void 0?tE:eE:Ru&&Ru in Object(t)?Xy(t):Zy(t)}function mt(t){return t!=null&&typeof t=="object"}var nE="[object Symbol]";function si(t){return typeof t=="symbol"||mt(t)&&vn(t)==nE}function ii(t,e){for(var n=-1,r=t==null?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s}var G=Array.isArray,rE=1/0,Ou=rt?rt.prototype:void 0,ku=Ou?Ou.toString:void 0;function Nu(t){if(typeof t=="string")return t;if(G(t))return ii(t,Nu)+"";if(si(t))return ku?ku.call(t):"";var e=t+"";return e=="0"&&1/t==-rE?"-0":e}var sE=/\s/;function iE(t){for(var e=t.length;e--&&sE.test(t.charAt(e)););return e}var oE=/^\s+/;function aE(t){return t&&t.slice(0,iE(t)+1).replace(oE,"")}function st(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Cu=NaN,cE=/^[-+]0x[0-9a-f]+$/i,lE=/^0b[01]+$/i,uE=/^0o[0-7]+$/i,hE=parseInt;function fE(t){if(typeof t=="number")return t;if(si(t))return Cu;if(st(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=st(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=aE(t);var n=lE.test(t);return n||uE.test(t)?hE(t.slice(2),n?2:8):cE.test(t)?Cu:+t}var Iu=1/0,dE=17976931348623157e292;function pE(t){if(!t)return t===0?t:0;if(t=fE(t),t===Iu||t===-Iu){var e=t<0?-1:1;return e*dE}return t===t?t:0}function oi(t){var e=pE(t),n=e%1;return e===e?n?e-n:e:0}function Er(t){return t}var gE="[object AsyncFunction]",mE="[object Function]",yE="[object GeneratorFunction]",EE="[object Proxy]";function en(t){if(!st(t))return!1;var e=vn(t);return e==mE||e==yE||e==gE||e==EE}var la=Ct["__core-js_shared__"],Lu=function(){var t=/[^.]+$/.exec(la&&la.keys&&la.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function _E(t){return!!Lu&&Lu in t}var wE=Function.prototype,TE=wE.toString;function Vn(t){if(t!=null){try{return TE.call(t)}catch{}try{return t+""}catch{}}return""}var bE=/[\\^$.*+?()[\]{}|]/g,AE=/^\[object .+?Constructor\]$/,SE=Function.prototype,vE=Object.prototype,RE=SE.toString,OE=vE.hasOwnProperty,kE=RegExp("^"+RE.call(OE).replace(bE,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function NE(t){if(!st(t)||_E(t))return!1;var e=en(t)?kE:AE;return e.test(Vn(t))}function CE(t,e){return t==null?void 0:t[e]}function zn(t,e){var n=CE(t,e);return NE(n)?n:void 0}var ua=zn(Ct,"WeakMap"),Mu=Object.create,IE=function(){function t(){}return function(e){if(!st(e))return{};if(Mu)return Mu(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function LE(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function ge(){}function ME(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var xE=800,UE=16,PE=Date.now;function DE(t){var e=0,n=0;return function(){var r=PE(),s=UE-(r-n);if(n=r,s>0){if(++e>=xE)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function $E(t){return function(){return t}}var ai=function(){try{var t=zn(Object,"defineProperty");return t({},"",{}),t}catch{}}(),FE=ai?function(t,e){return ai(t,"toString",{configurable:!0,enumerable:!1,value:$E(e),writable:!0})}:Er,BE=DE(FE);function xu(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function Uu(t,e,n,r){for(var s=t.length,i=n+-1;++i<s;)if(e(t[i],i,t))return i;return-1}function jE(t){return t!==t}function GE(t,e,n){for(var r=n-1,s=t.length;++r<s;)if(t[r]===e)return r;return-1}function ha(t,e,n){return e===e?GE(t,e,n):Uu(t,jE,n)}function Pu(t,e){var n=t==null?0:t.length;return!!n&&ha(t,e,0)>-1}var KE=9007199254740991,WE=/^(?:0|[1-9]\d*)$/;function ci(t,e){var n=typeof t;return e=e??KE,!!e&&(n=="number"||n!="symbol"&&WE.test(t))&&t>-1&&t%1==0&&t<e}function fa(t,e,n){e=="__proto__"&&ai?ai(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Yr(t,e){return t===e||t!==t&&e!==e}var HE=Object.prototype,VE=HE.hasOwnProperty;function li(t,e,n){var r=t[e];(!(VE.call(t,e)&&Yr(r,n))||n===void 0&&!(e in t))&&fa(t,e,n)}function da(t,e,n,r){var s=!n;n||(n={});for(var i=-1,o=e.length;++i<o;){var a=e[i],c=void 0;c===void 0&&(c=t[a]),s?fa(n,a,c):li(n,a,c)}return n}var Du=Math.max;function zE(t,e,n){return e=Du(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,i=Du(r.length-e,0),o=Array(i);++s<i;)o[s]=r[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=r[s];return a[e]=n(o),LE(t,this,a)}}function pa(t,e){return BE(zE(t,e,Er),t+"")}var YE=9007199254740991;function ga(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=YE}function It(t){return t!=null&&ga(t.length)&&!en(t)}function $u(t,e,n){if(!st(n))return!1;var r=typeof e;return(r=="number"?It(n)&&ci(e,n.length):r=="string"&&e in n)?Yr(n[e],t):!1}function qE(t){return pa(function(e,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(i=t.length>3&&typeof i=="function"?(s--,i):void 0,o&&$u(n[0],n[1],o)&&(i=s<3?void 0:i,s=1),e=Object(e);++r<s;){var a=n[r];a&&t(e,a,r,i)}return e})}var XE=Object.prototype;function qr(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||XE;return t===n}function JE(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var QE="[object Arguments]";function Fu(t){return mt(t)&&vn(t)==QE}var Bu=Object.prototype,ZE=Bu.hasOwnProperty,e_=Bu.propertyIsEnumerable,ui=Fu(function(){return arguments}())?Fu:function(t){return mt(t)&&ZE.call(t,"callee")&&!e_.call(t,"callee")};function t_(){return!1}var ju=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Gu=ju&&typeof module=="object"&&module&&!module.nodeType&&module,n_=Gu&&Gu.exports===ju,Ku=n_?Ct.Buffer:void 0,r_=Ku?Ku.isBuffer:void 0,Xr=r_||t_,s_="[object Arguments]",i_="[object Array]",o_="[object Boolean]",a_="[object Date]",c_="[object Error]",l_="[object Function]",u_="[object Map]",h_="[object Number]",f_="[object Object]",d_="[object RegExp]",p_="[object Set]",g_="[object String]",m_="[object WeakMap]",y_="[object ArrayBuffer]",E_="[object DataView]",__="[object Float32Array]",w_="[object Float64Array]",T_="[object Int8Array]",b_="[object Int16Array]",A_="[object Int32Array]",S_="[object Uint8Array]",v_="[object Uint8ClampedArray]",R_="[object Uint16Array]",O_="[object Uint32Array]",Z={};Z[__]=Z[w_]=Z[T_]=Z[b_]=Z[A_]=Z[S_]=Z[v_]=Z[R_]=Z[O_]=!0,Z[s_]=Z[i_]=Z[y_]=Z[o_]=Z[E_]=Z[a_]=Z[c_]=Z[l_]=Z[u_]=Z[h_]=Z[f_]=Z[d_]=Z[p_]=Z[g_]=Z[m_]=!1;function k_(t){return mt(t)&&ga(t.length)&&!!Z[vn(t)]}function hi(t){return function(e){return t(e)}}var Wu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Jr=Wu&&typeof module=="object"&&module&&!module.nodeType&&module,N_=Jr&&Jr.exports===Wu,ma=N_&&Su.process,Rn=function(){try{var t=Jr&&Jr.require&&Jr.require("util").types;return t||ma&&ma.binding&&ma.binding("util")}catch{}}(),Hu=Rn&&Rn.isTypedArray,ya=Hu?hi(Hu):k_,C_=Object.prototype,I_=C_.hasOwnProperty;function Vu(t,e){var n=G(t),r=!n&&ui(t),s=!n&&!r&&Xr(t),i=!n&&!r&&!s&&ya(t),o=n||r||s||i,a=o?JE(t.length,String):[],c=a.length;for(var l in t)(e||I_.call(t,l))&&!(o&&(l=="length"||s&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ci(l,c)))&&a.push(l);return a}function zu(t,e){return function(n){return t(e(n))}}var L_=zu(Object.keys,Object),M_=Object.prototype,x_=M_.hasOwnProperty;function Yu(t){if(!qr(t))return L_(t);var e=[];for(var n in Object(t))x_.call(t,n)&&n!="constructor"&&e.push(n);return e}function it(t){return It(t)?Vu(t):Yu(t)}var U_=Object.prototype,P_=U_.hasOwnProperty,He=qE(function(t,e){if(qr(e)||It(e)){da(e,it(e),t);return}for(var n in e)P_.call(e,n)&&li(t,n,e[n])});function D_(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var $_=Object.prototype,F_=$_.hasOwnProperty;function B_(t){if(!st(t))return D_(t);var e=qr(t),n=[];for(var r in t)r=="constructor"&&(e||!F_.call(t,r))||n.push(r);return n}function qu(t){return It(t)?Vu(t,!0):B_(t)}var j_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,G_=/^\w*$/;function Ea(t,e){if(G(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||si(t)?!0:G_.test(t)||!j_.test(t)||e!=null&&t in Object(e)}var Qr=zn(Object,"create");function K_(){this.__data__=Qr?Qr(null):{},this.size=0}function W_(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var H_="__lodash_hash_undefined__",V_=Object.prototype,z_=V_.hasOwnProperty;function Y_(t){var e=this.__data__;if(Qr){var n=e[t];return n===H_?void 0:n}return z_.call(e,t)?e[t]:void 0}var q_=Object.prototype,X_=q_.hasOwnProperty;function J_(t){var e=this.__data__;return Qr?e[t]!==void 0:X_.call(e,t)}var Q_="__lodash_hash_undefined__";function Z_(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Qr&&e===void 0?Q_:e,this}function Yn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Yn.prototype.clear=K_,Yn.prototype.delete=W_,Yn.prototype.get=Y_,Yn.prototype.has=J_,Yn.prototype.set=Z_;function ew(){this.__data__=[],this.size=0}function fi(t,e){for(var n=t.length;n--;)if(Yr(t[n][0],e))return n;return-1}var tw=Array.prototype,nw=tw.splice;function rw(t){var e=this.__data__,n=fi(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():nw.call(e,n,1),--this.size,!0}function sw(t){var e=this.__data__,n=fi(e,t);return n<0?void 0:e[n][1]}function iw(t){return fi(this.__data__,t)>-1}function ow(t,e){var n=this.__data__,r=fi(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function tn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}tn.prototype.clear=ew,tn.prototype.delete=rw,tn.prototype.get=sw,tn.prototype.has=iw,tn.prototype.set=ow;var Zr=zn(Ct,"Map");function aw(){this.size=0,this.__data__={hash:new Yn,map:new(Zr||tn),string:new Yn}}function cw(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function di(t,e){var n=t.__data__;return cw(e)?n[typeof e=="string"?"string":"hash"]:n.map}function lw(t){var e=di(this,t).delete(t);return this.size-=e?1:0,e}function uw(t){return di(this,t).get(t)}function hw(t){return di(this,t).has(t)}function fw(t,e){var n=di(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function nn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}nn.prototype.clear=aw,nn.prototype.delete=lw,nn.prototype.get=uw,nn.prototype.has=hw,nn.prototype.set=fw;var dw="Expected a function";function _a(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(dw);var n=function(){var r=arguments,s=e?e.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var o=t.apply(this,r);return n.cache=i.set(s,o)||i,o};return n.cache=new(_a.Cache||nn),n}_a.Cache=nn;var pw=500;function gw(t){var e=_a(t,function(r){return n.size===pw&&n.clear(),r}),n=e.cache;return e}var mw=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,yw=/\\(\\)?/g,Ew=gw(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(mw,function(n,r,s,i){e.push(s?i.replace(yw,"$1"):r||n)}),e});function _w(t){return t==null?"":Nu(t)}function pi(t,e){return G(t)?t:Ea(t,e)?[t]:Ew(_w(t))}var ww=1/0;function es(t){if(typeof t=="string"||si(t))return t;var e=t+"";return e=="0"&&1/t==-ww?"-0":e}function wa(t,e){e=pi(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[es(e[n++])];return n&&n==r?t:void 0}function Tw(t,e,n){var r=t==null?void 0:wa(t,e);return r===void 0?n:r}function Ta(t,e){for(var n=-1,r=e.length,s=t.length;++n<r;)t[s+n]=e[n];return t}var Xu=rt?rt.isConcatSpreadable:void 0;function bw(t){return G(t)||ui(t)||!!(Xu&&t&&t[Xu])}function ba(t,e,n,r,s){var i=-1,o=t.length;for(n||(n=bw),s||(s=[]);++i<o;){var a=t[i];n(a)?Ta(s,a):r||(s[s.length]=a)}return s}function yt(t){var e=t==null?0:t.length;return e?ba(t):[]}var Ju=zu(Object.getPrototypeOf,Object);function Qu(t,e,n){var r=-1,s=t.length;e<0&&(e=-e>s?0:s+e),n=n>s?s:n,n<0&&(n+=s),s=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(s);++r<s;)i[r]=t[r+e];return i}function Aw(t,e,n,r){var s=-1,i=t==null?0:t.length;for(r&&i&&(n=t[++s]);++s<i;)n=e(n,t[s],s,t);return n}function Sw(){this.__data__=new tn,this.size=0}function vw(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Rw(t){return this.__data__.get(t)}function Ow(t){return this.__data__.has(t)}var kw=200;function Nw(t,e){var n=this.__data__;if(n instanceof tn){var r=n.__data__;if(!Zr||r.length<kw-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new nn(r)}return n.set(t,e),this.size=n.size,this}function Lt(t){var e=this.__data__=new tn(t);this.size=e.size}Lt.prototype.clear=Sw,Lt.prototype.delete=vw,Lt.prototype.get=Rw,Lt.prototype.has=Ow,Lt.prototype.set=Nw;function Cw(t,e){return t&&da(e,it(e),t)}var Zu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,eh=Zu&&typeof module=="object"&&module&&!module.nodeType&&module,Iw=eh&&eh.exports===Zu,th=Iw?Ct.Buffer:void 0,nh=th?th.allocUnsafe:void 0;function Lw(t,e){var n=t.length,r=nh?nh(n):new t.constructor(n);return t.copy(r),r}function Aa(t,e){for(var n=-1,r=t==null?0:t.length,s=0,i=[];++n<r;){var o=t[n];e(o,n,t)&&(i[s++]=o)}return i}function rh(){return[]}var Mw=Object.prototype,xw=Mw.propertyIsEnumerable,sh=Object.getOwnPropertySymbols,Sa=sh?function(t){return t==null?[]:(t=Object(t),Aa(sh(t),function(e){return xw.call(t,e)}))}:rh;function Uw(t,e){return da(t,Sa(t),e)}var Pw=Object.getOwnPropertySymbols,Dw=Pw?function(t){for(var e=[];t;)Ta(e,Sa(t)),t=Ju(t);return e}:rh;function ih(t,e,n){var r=e(t);return G(t)?r:Ta(r,n(t))}function va(t){return ih(t,it,Sa)}function $w(t){return ih(t,qu,Dw)}var Ra=zn(Ct,"DataView"),Oa=zn(Ct,"Promise"),_r=zn(Ct,"Set"),oh="[object Map]",Fw="[object Object]",ah="[object Promise]",ch="[object Set]",lh="[object WeakMap]",uh="[object DataView]",Bw=Vn(Ra),jw=Vn(Zr),Gw=Vn(Oa),Kw=Vn(_r),Ww=Vn(ua),ot=vn;(Ra&&ot(new Ra(new ArrayBuffer(1)))!=uh||Zr&&ot(new Zr)!=oh||Oa&&ot(Oa.resolve())!=ah||_r&&ot(new _r)!=ch||ua&&ot(new ua)!=lh)&&(ot=function(t){var e=vn(t),n=e==Fw?t.constructor:void 0,r=n?Vn(n):"";if(r)switch(r){case Bw:return uh;case jw:return oh;case Gw:return ah;case Kw:return ch;case Ww:return lh}return e});var Hw=Object.prototype,Vw=Hw.hasOwnProperty;function zw(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Vw.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var gi=Ct.Uint8Array;function Yw(t){var e=new t.constructor(t.byteLength);return new gi(e).set(new gi(t)),e}function qw(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Xw=/\w*$/;function Jw(t){var e=new t.constructor(t.source,Xw.exec(t));return e.lastIndex=t.lastIndex,e}var hh=rt?rt.prototype:void 0,fh=hh?hh.valueOf:void 0;function Qw(t){return fh?Object(fh.call(t)):{}}function Zw(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var eT="[object Boolean]",tT="[object Date]",nT="[object Map]",rT="[object Number]",sT="[object RegExp]",iT="[object Set]",oT="[object String]",aT="[object Symbol]",cT="[object ArrayBuffer]",lT="[object DataView]",uT="[object Float32Array]",hT="[object Float64Array]",fT="[object Int8Array]",dT="[object Int16Array]",pT="[object Int32Array]",gT="[object Uint8Array]",mT="[object Uint8ClampedArray]",yT="[object Uint16Array]",ET="[object Uint32Array]";function _T(t,e,n){var r=t.constructor;switch(e){case cT:return Yw(t);case eT:case tT:return new r(+t);case lT:return qw(t);case uT:case hT:case fT:case dT:case pT:case gT:case mT:case yT:case ET:return Zw(t);case nT:return new r;case rT:case oT:return new r(t);case sT:return Jw(t);case iT:return new r;case aT:return Qw(t)}}function wT(t){return typeof t.constructor=="function"&&!qr(t)?IE(Ju(t)):{}}var TT="[object Map]";function bT(t){return mt(t)&&ot(t)==TT}var dh=Rn&&Rn.isMap,AT=dh?hi(dh):bT,ST="[object Set]";function vT(t){return mt(t)&&ot(t)==ST}var ph=Rn&&Rn.isSet,RT=ph?hi(ph):vT,gh="[object Arguments]",OT="[object Array]",kT="[object Boolean]",NT="[object Date]",CT="[object Error]",mh="[object Function]",IT="[object GeneratorFunction]",LT="[object Map]",MT="[object Number]",yh="[object Object]",xT="[object RegExp]",UT="[object Set]",PT="[object String]",DT="[object Symbol]",$T="[object WeakMap]",FT="[object ArrayBuffer]",BT="[object DataView]",jT="[object Float32Array]",GT="[object Float64Array]",KT="[object Int8Array]",WT="[object Int16Array]",HT="[object Int32Array]",VT="[object Uint8Array]",zT="[object Uint8ClampedArray]",YT="[object Uint16Array]",qT="[object Uint32Array]",q={};q[gh]=q[OT]=q[FT]=q[BT]=q[kT]=q[NT]=q[jT]=q[GT]=q[KT]=q[WT]=q[HT]=q[LT]=q[MT]=q[yh]=q[xT]=q[UT]=q[PT]=q[DT]=q[VT]=q[zT]=q[YT]=q[qT]=!0,q[CT]=q[mh]=q[$T]=!1;function mi(t,e,n,r,s,i){var o;if(o!==void 0)return o;if(!st(t))return t;var a=G(t);if(a)return o=zw(t),ME(t,o);var c=ot(t),l=c==mh||c==IT;if(Xr(t))return Lw(t);if(c==yh||c==gh||l&&!s)return o=l?{}:wT(t),Uw(t,Cw(o,t));if(!q[c])return s?t:{};o=_T(t,c),i||(i=new Lt);var u=i.get(t);if(u)return u;i.set(t,o),RT(t)?t.forEach(function(f){o.add(mi(f,e,n,f,t,i))}):AT(t)&&t.forEach(function(f,p){o.set(p,mi(f,e,n,p,t,i))});var h=va,d=a?void 0:h(t);return xu(d||t,function(f,p){d&&(p=f,f=t[p]),li(o,p,mi(f,e,n,p,t,i))}),o}var XT=4;function Re(t){return mi(t,XT)}function ts(t){for(var e=-1,n=t==null?0:t.length,r=0,s=[];++e<n;){var i=t[e];i&&(s[r++]=i)}return s}var JT="__lodash_hash_undefined__";function QT(t){return this.__data__.set(t,JT),this}function ZT(t){return this.__data__.has(t)}function wr(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new nn;++e<n;)this.add(t[e])}wr.prototype.add=wr.prototype.push=QT,wr.prototype.has=ZT;function Eh(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function ka(t,e){return t.has(e)}var eb=1,tb=2;function _h(t,e,n,r,s,i){var o=n&eb,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=i.get(t),u=i.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,f=n&tb?new wr:void 0;for(i.set(t,e),i.set(e,t);++h<a;){var p=t[h],E=e[h];if(r)var A=o?r(E,p,h,e,t,i):r(p,E,h,t,e,i);if(A!==void 0){if(A)continue;d=!1;break}if(f){if(!Eh(e,function(S,b){if(!ka(f,b)&&(p===S||s(p,S,n,r,i)))return f.push(b)})){d=!1;break}}else if(!(p===E||s(p,E,n,r,i))){d=!1;break}}return i.delete(t),i.delete(e),d}function nb(t){var e=-1,n=Array(t.size);return t.forEach(function(r,s){n[++e]=[s,r]}),n}function Na(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var rb=1,sb=2,ib="[object Boolean]",ob="[object Date]",ab="[object Error]",cb="[object Map]",lb="[object Number]",ub="[object RegExp]",hb="[object Set]",fb="[object String]",db="[object Symbol]",pb="[object ArrayBuffer]",gb="[object DataView]",wh=rt?rt.prototype:void 0,Ca=wh?wh.valueOf:void 0;function mb(t,e,n,r,s,i,o){switch(n){case gb:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case pb:return!(t.byteLength!=e.byteLength||!i(new gi(t),new gi(e)));case ib:case ob:case lb:return Yr(+t,+e);case ab:return t.name==e.name&&t.message==e.message;case ub:case fb:return t==e+"";case cb:var a=nb;case hb:var c=r&rb;if(a||(a=Na),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=sb,o.set(t,e);var u=_h(a(t),a(e),r,s,i,o);return o.delete(t),u;case db:if(Ca)return Ca.call(t)==Ca.call(e)}return!1}var yb=1,Eb=Object.prototype,_b=Eb.hasOwnProperty;function wb(t,e,n,r,s,i){var o=n&yb,a=va(t),c=a.length,l=va(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:_b.call(e,d)))return!1}var f=i.get(t),p=i.get(e);if(f&&p)return f==e&&p==t;var E=!0;i.set(t,e),i.set(e,t);for(var A=o;++h<c;){d=a[h];var S=t[d],b=e[d];if(r)var w=o?r(b,S,d,e,t,i):r(S,b,d,t,e,i);if(!(w===void 0?S===b||s(S,b,n,r,i):w)){E=!1;break}A||(A=d=="constructor")}if(E&&!A){var O=t.constructor,_=e.constructor;O!=_&&"constructor"in t&&"constructor"in e&&!(typeof O=="function"&&O instanceof O&&typeof _=="function"&&_ instanceof _)&&(E=!1)}return i.delete(t),i.delete(e),E}var Tb=1,Th="[object Arguments]",bh="[object Array]",yi="[object Object]",bb=Object.prototype,Ah=bb.hasOwnProperty;function Ab(t,e,n,r,s,i){var o=G(t),a=G(e),c=o?bh:ot(t),l=a?bh:ot(e);c=c==Th?yi:c,l=l==Th?yi:l;var u=c==yi,h=l==yi,d=c==l;if(d&&Xr(t)){if(!Xr(e))return!1;o=!0,u=!1}if(d&&!u)return i||(i=new Lt),o||ya(t)?_h(t,e,n,r,s,i):mb(t,e,c,n,r,s,i);if(!(n&Tb)){var f=u&&Ah.call(t,"__wrapped__"),p=h&&Ah.call(e,"__wrapped__");if(f||p){var E=f?t.value():t,A=p?e.value():e;return i||(i=new Lt),s(E,A,n,r,i)}}return d?(i||(i=new Lt),wb(t,e,n,r,s,i)):!1}function Ia(t,e,n,r,s){return t===e?!0:t==null||e==null||!mt(t)&&!mt(e)?t!==t&&e!==e:Ab(t,e,n,r,Ia,s)}var Sb=1,vb=2;function Rb(t,e,n,r){var s=n.length,i=s;if(t==null)return!i;for(t=Object(t);s--;){var o=n[s];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++s<i;){o=n[s];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new Lt,h;if(!(h===void 0?Ia(l,c,Sb|vb,r,u):h))return!1}}return!0}function Sh(t){return t===t&&!st(t)}function Ob(t){for(var e=it(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,Sh(s)]}return e}function vh(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function kb(t){var e=Ob(t);return e.length==1&&e[0][2]?vh(e[0][0],e[0][1]):function(n){return n===t||Rb(n,t,e)}}function Nb(t,e){return t!=null&&e in Object(t)}function Rh(t,e,n){e=pi(e,t);for(var r=-1,s=e.length,i=!1;++r<s;){var o=es(e[r]);if(!(i=t!=null&&n(t,o)))break;t=t[o]}return i||++r!=s?i:(s=t==null?0:t.length,!!s&&ga(s)&&ci(o,s)&&(G(t)||ui(t)))}function Cb(t,e){return t!=null&&Rh(t,e,Nb)}var Ib=1,Lb=2;function Mb(t,e){return Ea(t)&&Sh(e)?vh(es(t),e):function(n){var r=Tw(n,t);return r===void 0&&r===e?Cb(n,t):Ia(e,r,Ib|Lb)}}function xb(t){return function(e){return e==null?void 0:e[t]}}function Ub(t){return function(e){return wa(e,t)}}function Pb(t){return Ea(t)?xb(es(t)):Ub(t)}function Mt(t){return typeof t=="function"?t:t==null?Er:typeof t=="object"?G(t)?Mb(t[0],t[1]):kb(t):Pb(t)}function Db(t,e,n,r){for(var s=-1,i=t==null?0:t.length;++s<i;){var o=t[s];e(r,o,n(o),t)}return r}function $b(t){return function(e,n,r){for(var s=-1,i=Object(e),o=r(e),a=o.length;a--;){var c=o[++s];if(n(i[c],c,i)===!1)break}return e}}var Fb=$b();function Bb(t,e){return t&&Fb(t,e,it)}function jb(t,e){return function(n,r){if(n==null)return n;if(!It(n))return t(n,r);for(var s=n.length,i=-1,o=Object(n);++i<s&&r(o[i],i,o)!==!1;);return n}}var qn=jb(Bb);function Gb(t,e,n,r){return qn(t,function(s,i,o){e(r,s,n(s),o)}),r}function Kb(t,e){return function(n,r){var s=G(n)?Db:Gb,i=e?e():{};return s(n,t,Mt(r),i)}}var Oh=Object.prototype,Wb=Oh.hasOwnProperty,La=pa(function(t,e){t=Object(t);var n=-1,r=e.length,s=r>2?e[2]:void 0;for(s&&$u(e[0],e[1],s)&&(r=1);++n<r;)for(var i=e[n],o=qu(i),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||Yr(u,Oh[l])&&!Wb.call(t,l))&&(t[l]=i[l])}return t});function kh(t){return mt(t)&&It(t)}var Hb=200;function Vb(t,e,n,r){var s=-1,i=Pu,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=Hb&&(i=ka,o=!1,e=new wr(e));e:for(;++s<a;){var u=t[s],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else i(e,h,r)||c.push(u)}return c}var Ei=pa(function(t,e){return kh(t)?Vb(t,ba(e,1,kh,!0)):[]});function Tr(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Oe(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:oi(e),Qu(t,e<0?0:e,r)):[]}function ns(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:oi(e),e=r-e,Qu(t,0,e<0?0:e)):[]}function zb(t){return typeof t=="function"?t:Er}function M(t,e){var n=G(t)?xu:qn;return n(t,zb(e))}function Yb(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function qb(t,e){var n=!0;return qn(t,function(r,s,i){return n=!!e(r,s,i),n}),n}function Et(t,e,n){var r=G(t)?Yb:qb;return r(t,Mt(e))}function Nh(t,e){var n=[];return qn(t,function(r,s,i){e(r,s,i)&&n.push(r)}),n}function at(t,e){var n=G(t)?Aa:Nh;return n(t,Mt(e))}function Xb(t){return function(e,n,r){var s=Object(e);if(!It(e)){var i=Mt(n);e=it(e),n=function(a){return i(s[a],a,s)}}var o=t(e,n,r);return o>-1?s[i?e[o]:o]:void 0}}var Jb=Math.max;function Qb(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var s=n==null?0:oi(n);return s<0&&(s=Jb(r+s,0)),Uu(t,Mt(e),s)}var br=Xb(Qb);function _t(t){return t&&t.length?t[0]:void 0}function Zb(t,e){var n=-1,r=It(t)?Array(t.length):[];return qn(t,function(s,i,o){r[++n]=e(s,i,o)}),r}function N(t,e){var n=G(t)?ii:Zb;return n(t,Mt(e))}function ct(t,e){return ba(N(t,e))}var eA=Object.prototype,tA=eA.hasOwnProperty,nA=Kb(function(t,e,n){tA.call(t,n)?t[n].push(e):fa(t,n,[e])}),rA=Object.prototype,sA=rA.hasOwnProperty;function iA(t,e){return t!=null&&sA.call(t,e)}function L(t,e){return t!=null&&Rh(t,e,iA)}var oA="[object String]";function Fe(t){return typeof t=="string"||!G(t)&&mt(t)&&vn(t)==oA}function aA(t,e){return ii(e,function(n){return t[n]})}function me(t){return t==null?[]:aA(t,it(t))}var cA=Math.max;function Ue(t,e,n,r){t=It(t)?t:me(t),n=n&&!r?oi(n):0;var s=t.length;return n<0&&(n=cA(s+n,0)),Fe(t)?n<=s&&t.indexOf(e,n)>-1:!!s&&ha(t,e,n)>-1}function Ch(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var s=0;return ha(t,e,s)}var lA="[object Map]",uA="[object Set]",hA=Object.prototype,fA=hA.hasOwnProperty;function X(t){if(t==null)return!0;if(It(t)&&(G(t)||typeof t=="string"||typeof t.splice=="function"||Xr(t)||ya(t)||ui(t)))return!t.length;var e=ot(t);if(e==lA||e==uA)return!t.size;if(qr(t))return!Yu(t).length;for(var n in t)if(fA.call(t,n))return!1;return!0}var dA="[object RegExp]";function pA(t){return mt(t)&&vn(t)==dA}var Ih=Rn&&Rn.isRegExp,rn=Ih?hi(Ih):pA;function sn(t){return t===void 0}var gA="Expected a function";function mA(t){if(typeof t!="function")throw new TypeError(gA);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function yA(t,e,n,r){if(!st(t))return t;e=pi(e,t);for(var s=-1,i=e.length,o=i-1,a=t;a!=null&&++s<i;){var c=es(e[s]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(s!=o){var u=a[c];l=void 0,l===void 0&&(l=st(u)?u:ci(e[s+1])?[]:{})}li(a,c,l),a=a[c]}return t}function EA(t,e,n){for(var r=-1,s=e.length,i={};++r<s;){var o=e[r],a=wa(t,o);n(a,o)&&yA(i,pi(o,t),a)}return i}function wt(t,e){if(t==null)return{};var n=ii($w(t),function(r){return[r]});return e=Mt(e),EA(t,n,function(r,s){return e(r,s[0])})}function _A(t,e,n,r,s){return s(t,function(i,o,a){n=r?(r=!1,i):e(n,i,o,a)}),n}function Ve(t,e,n){var r=G(t)?Aw:_A,s=arguments.length<3;return r(t,Mt(e),n,s,qn)}function _i(t,e){var n=G(t)?Aa:Nh;return n(t,mA(Mt(e)))}function wA(t,e){var n;return qn(t,function(r,s,i){return n=e(r,s,i),!n}),!!n}function Lh(t,e,n){var r=G(t)?Eh:wA;return r(t,Mt(e))}var TA=1/0,bA=_r&&1/Na(new _r([,-0]))[1]==TA?function(t){return new _r(t)}:ge,AA=200;function SA(t,e,n){var r=-1,s=Pu,i=t.length,o=!0,a=[],c=a;if(i>=AA){var l=bA(t);if(l)return Na(l);o=!1,s=ka,c=new wr}else c=a;e:for(;++r<i;){var u=t[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(u)}else s(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function Ma(t){return t&&t.length?SA(t):[]}function xa(t){console&&console.error&&console.error(`Error: ${t}`)}function Mh(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function xh(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function Uh(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function vA(t){return RA(t)?t.LABEL:t.name}function RA(t){return Fe(t.LABEL)&&t.LABEL!==""}class xt{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),M(this.definition,n=>{n.accept(e)})}}class ze extends xt{constructor(e){super([]),this.idx=1,He(this,wt(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Ar extends xt{constructor(e){super(e.definition),this.orgText="",He(this,wt(e,n=>n!==void 0))}}class Be extends xt{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,He(this,wt(e,n=>n!==void 0))}}class je extends xt{constructor(e){super(e.definition),this.idx=1,He(this,wt(e,n=>n!==void 0))}}class Ut extends xt{constructor(e){super(e.definition),this.idx=1,He(this,wt(e,n=>n!==void 0))}}class Pt extends xt{constructor(e){super(e.definition),this.idx=1,He(this,wt(e,n=>n!==void 0))}}class ye extends xt{constructor(e){super(e.definition),this.idx=1,He(this,wt(e,n=>n!==void 0))}}class Tt extends xt{constructor(e){super(e.definition),this.idx=1,He(this,wt(e,n=>n!==void 0))}}class bt extends xt{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,He(this,wt(e,n=>n!==void 0))}}class ne{constructor(e){this.idx=1,He(this,wt(e,n=>n!==void 0))}accept(e){e.visit(this)}}function OA(t){return N(t,wi)}function wi(t){function e(n){return N(n,wi)}if(t instanceof ze){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Fe(t.label)&&(n.label=t.label),n}else{if(t instanceof Be)return{type:"Alternative",definition:e(t.definition)};if(t instanceof je)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Ut)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Pt)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:wi(new ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Tt)return{type:"RepetitionWithSeparator",idx:t.idx,separator:wi(new ne({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ye)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof bt)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof ne){const n={type:"Terminal",name:t.terminalType.name,label:vA(t.terminalType),idx:t.idx};Fe(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=rn(r)?r.source:r),n}else{if(t instanceof Ar)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Sr{visit(e){const n=e;switch(n.constructor){case ze:return this.visitNonTerminal(n);case Be:return this.visitAlternative(n);case je:return this.visitOption(n);case Ut:return this.visitRepetitionMandatory(n);case Pt:return this.visitRepetitionMandatoryWithSeparator(n);case Tt:return this.visitRepetitionWithSeparator(n);case ye:return this.visitRepetition(n);case bt:return this.visitAlternation(n);case ne:return this.visitTerminal(n);case Ar:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function kA(t){return t instanceof Be||t instanceof je||t instanceof ye||t instanceof Ut||t instanceof Pt||t instanceof Tt||t instanceof ne||t instanceof Ar}function Ti(t,e=[]){return t instanceof je||t instanceof ye||t instanceof Tt?!0:t instanceof bt?Lh(t.definition,r=>Ti(r,e)):t instanceof ze&&Ue(e,t)?!1:t instanceof xt?(t instanceof ze&&e.push(t),Et(t.definition,r=>Ti(r,e))):!1}function NA(t){return t instanceof bt}function Dt(t){if(t instanceof ze)return"SUBRULE";if(t instanceof je)return"OPTION";if(t instanceof bt)return"OR";if(t instanceof Ut)return"AT_LEAST_ONE";if(t instanceof Pt)return"AT_LEAST_ONE_SEP";if(t instanceof Tt)return"MANY_SEP";if(t instanceof ye)return"MANY";if(t instanceof ne)return"CONSUME";throw Error("non exhaustive match")}class bi{walk(e,n=[]){M(e.definition,(r,s)=>{const i=Oe(e.definition,s+1);if(r instanceof ze)this.walkProdRef(r,i,n);else if(r instanceof ne)this.walkTerminal(r,i,n);else if(r instanceof Be)this.walkFlat(r,i,n);else if(r instanceof je)this.walkOption(r,i,n);else if(r instanceof Ut)this.walkAtLeastOne(r,i,n);else if(r instanceof Pt)this.walkAtLeastOneSep(r,i,n);else if(r instanceof Tt)this.walkManySep(r,i,n);else if(r instanceof ye)this.walkMany(r,i,n);else if(r instanceof bt)this.walkOr(r,i,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const s=n.concat(r);this.walk(e,s)}walkOption(e,n,r){const s=n.concat(r);this.walk(e,s)}walkAtLeastOne(e,n,r){const s=[new je({definition:e.definition})].concat(n,r);this.walk(e,s)}walkAtLeastOneSep(e,n,r){const s=Ph(e,n,r);this.walk(e,s)}walkMany(e,n,r){const s=[new je({definition:e.definition})].concat(n,r);this.walk(e,s)}walkManySep(e,n,r){const s=Ph(e,n,r);this.walk(e,s)}walkOr(e,n,r){const s=n.concat(r);M(e.definition,i=>{const o=new Be({definition:[i]});this.walk(o,s)})}}function Ph(t,e,n){return[new je({definition:[new ne({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function rs(t){if(t instanceof ze)return rs(t.referencedRule);if(t instanceof ne)return LA(t);if(kA(t))return CA(t);if(NA(t))return IA(t);throw Error("non exhaustive match")}function CA(t){let e=[];const n=t.definition;let r=0,s=n.length>r,i,o=!0;for(;s&&o;)i=n[r],o=Ti(i),e=e.concat(rs(i)),r=r+1,s=n.length>r;return Ma(e)}function IA(t){const e=N(t.definition,n=>rs(n));return Ma(yt(e))}function LA(t){return[t.terminalType]}const Dh="_~IN~_";class MA extends bi{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const s=UA(e.referencedRule,e.idx)+this.topProd.name,i=n.concat(r),o=new Be({definition:i}),a=rs(o);this.follows[s]=a}}function xA(t){const e={};return M(t,n=>{const r=new MA(n).startWalking();He(e,r)}),e}function UA(t,e){return t.name+e+Dh}function x(t){return t.charCodeAt(0)}function Ua(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function ss(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function vr(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function PA(){throw Error("Internal Error - Should never get here!")}function $h(t){return t.type==="Character"}const Ai=[];for(let t=x("0");t<=x("9");t++)Ai.push(t);const Si=[x("_")].concat(Ai);for(let t=x("a");t<=x("z");t++)Si.push(t);for(let t=x("A");t<=x("Z");t++)Si.push(t);const Fh=[x(" "),x("\f"),x(`
`),x("\r"),x("	"),x("\v"),x("	"),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x(""),x("\u2028"),x("\u2029"),x(""),x(""),x(""),x("\uFEFF")],DA=/[0-9a-fA-F]/,vi=/[0-9]/,$A=/[1-9]/;class FA{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ss(r,"global");break;case"i":ss(r,"ignoreCase");break;case"m":ss(r,"multiLine");break;case"u":ss(r,"unicode");break;case"y":ss(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}vr(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return PA()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const s=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:s,atMost:s};break;case",":let i;this.isDigit()?(i=this.integerIncludingZero(),n={atLeast:s,atMost:i}):n={atLeast:s,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;vr(n);break}if(!(e===!0&&n===void 0)&&vr(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),vr(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[x(`
`),x("\r"),x("\u2028"),x("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Ai;break;case"D":e=Ai,n=!0;break;case"s":e=Fh;break;case"S":e=Fh,n=!0;break;case"w":e=Si;break;case"W":e=Si,n=!0;break}if(vr(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=x("\f");break;case"n":e=x(`
`);break;case"r":e=x("\r");break;case"t":e=x("	");break;case"v":e=x("\v");break}if(vr(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:x("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:x(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:x(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,$h(r)&&this.isRangeDash()){this.consumeChar("-");const s=this.classAtom();if(s.type,$h(s)){if(s.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:s.value})}else Ua(r.value,e),e.push(x("-")),Ua(s.value,e)}else Ua(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:x("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if($A.test(e)===!1)throw Error("Expecting a positive integer");for(;vi.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(vi.test(e)===!1)throw Error("Expecting an integer");for(;vi.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:x(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return vi.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let s=0;s<e;s++){const i=this.popChar();if(DA.test(i)===!1)throw Error("Expecting a HexDecimal digits");n+=i}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class Pa{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(s=>{this.visit(s)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let Ri={};const BA=new FA;function Oi(t){const e=t.toString();if(Ri.hasOwnProperty(e))return Ri[e];{const n=BA.pattern(e);return Ri[e]=n,n}}function jA(){Ri={}}const Bh="Complement Sets are not supported for first char optimization",ki=`Unable to use "first char" lexer optimizations:
`;function GA(t,e=!1){try{const n=Oi(t);return Da(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Bh)e&&Mh(`${ki}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),xa(`${ki}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Da(t,e,n){switch(t.type){case"Disjunction":for(let s=0;s<t.value.length;s++)Da(t.value[s],e,n);break;case"Alternative":const r=t.value;for(let s=0;s<r.length;s++){const i=r[s];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=i;switch(o.type){case"Character":Ni(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(Bh);M(o.value,c=>{if(typeof c=="number")Ni(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Ni(u,e,n);else{for(let u=l.from;u<=l.to&&u<os;u++)Ni(u,e,n);if(l.to>=os){const u=l.from>=os?l.from:os,h=l.to,d=On(u),f=On(h);for(let p=d;p<=f;p++)e[p]=p}}}});break;case"Group":Da(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&$a(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return me(e)}function Ni(t,e,n){const r=On(t);e[r]=r,n===!0&&KA(t,e)}function KA(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const s=On(r.charCodeAt(0));e[s]=s}else{const s=n.toLowerCase();if(s!==n){const i=On(s.charCodeAt(0));e[i]=i}}}function jh(t,e){return br(t.value,n=>{if(typeof n=="number")return Ue(e,n);{const r=n;return br(e,s=>r.from<=s&&s<=r.to)!==void 0}})}function $a(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?G(t.value)?Et(t.value,$a):$a(t.value):!1}class WA extends Pa{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Ue(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?jh(e,this.targetCharCodes)===void 0&&(this.found=!0):jh(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Fa(t,e){if(e instanceof RegExp){const n=Oi(e),r=new WA(t);return r.visit(n),r.found}else return br(e,n=>Ue(t,n.charCodeAt(0)))!==void 0}const Xn="PATTERN",is="defaultMode",Ci="modes";let Gh=typeof new RegExp("(?:)").sticky=="boolean";function HA(t,e){e=La(e,{useSticky:Gh,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(b,w)=>w()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{pS()});let r;n("Reject Lexer.NA",()=>{r=_i(t,b=>b[Xn]===be.NA)});let s=!1,i;n("Transform Patterns",()=>{s=!1,i=N(r,b=>{const w=b[Xn];if(rn(w)){const O=w.source;return O.length===1&&O!=="^"&&O!=="$"&&O!=="."&&!w.ignoreCase?O:O.length===2&&O[0]==="\\"&&!Ue(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],O[1])?O[1]:e.useSticky?Wh(w):Kh(w)}else{if(en(w))return s=!0,{exec:w};if(typeof w=="object")return s=!0,w;if(typeof w=="string"){if(w.length===1)return w;{const O=w.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),_=new RegExp(O);return e.useSticky?Wh(_):Kh(_)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=N(r,b=>b.tokenTypeIdx),a=N(r,b=>{const w=b.GROUP;if(w!==be.SKIPPED){if(Fe(w))return w;if(sn(w))return!1;throw Error("non exhaustive match")}}),c=N(r,b=>{const w=b.LONGER_ALT;if(w)return G(w)?N(w,_=>Ch(r,_)):[Ch(r,w)]}),l=N(r,b=>b.PUSH_MODE),u=N(r,b=>L(b,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const b=zh(e.lineTerminatorCharacters);h=N(r,w=>!1),e.positionTracking!=="onlyOffset"&&(h=N(r,w=>L(w,"LINE_BREAKS")?!!w.LINE_BREAKS:Vh(w,b)===!1&&Fa(b,w.PATTERN)))});let d,f,p,E;n("Misc Mapping #2",()=>{d=N(r,Hh),f=N(i,hS),p=Ve(r,(b,w)=>{const O=w.GROUP;return Fe(O)&&O!==be.SKIPPED&&(b[O]=[]),b},{}),E=N(i,(b,w)=>({pattern:i[w],longerAlt:c[w],canLineTerminator:h[w],isCustom:d[w],short:f[w],group:a[w],push:l[w],pop:u[w],tokenTypeIdx:o[w],tokenType:r[w]}))});let A=!0,S=[];return e.safeMode||n("First Char Optimization",()=>{S=Ve(r,(b,w,O)=>{if(typeof w.PATTERN=="string"){const _=w.PATTERN.charCodeAt(0),m=On(_);Ba(b,m,E[O])}else if(G(w.START_CHARS_HINT)){let _;M(w.START_CHARS_HINT,m=>{const g=typeof m=="string"?m.charCodeAt(0):m,T=On(g);_!==T&&(_=T,Ba(b,T,E[O]))})}else if(rn(w.PATTERN))if(w.PATTERN.unicode)A=!1,e.ensureOptimizations&&xa(`${ki}	Unable to analyze < ${w.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const _=GA(w.PATTERN,e.ensureOptimizations);X(_)&&(A=!1),M(_,m=>{Ba(b,m,E[O])})}else e.ensureOptimizations&&xa(`${ki}	TokenType: <${w.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),A=!1;return b},[])}),{emptyGroups:p,patternIdxToConfig:E,charCodeToPatternIdxToConfig:S,hasCustom:s,canBeOptimized:A}}function VA(t,e){let n=[];const r=YA(t);n=n.concat(r.errors);const s=qA(r.valid),i=s.valid;return n=n.concat(s.errors),n=n.concat(zA(i)),n=n.concat(rS(i)),n=n.concat(sS(i,e)),n=n.concat(iS(i)),n}function zA(t){let e=[];const n=at(t,r=>rn(r[Xn]));return e=e.concat(JA(n)),e=e.concat(eS(n)),e=e.concat(tS(n)),e=e.concat(nS(n)),e=e.concat(QA(n)),e}function YA(t){const e=at(t,s=>!L(s,Xn)),n=N(e,s=>({message:"Token Type: ->"+s.name+"<- missing static 'PATTERN' property",type:oe.MISSING_PATTERN,tokenTypes:[s]})),r=Ei(t,e);return{errors:n,valid:r}}function qA(t){const e=at(t,s=>{const i=s[Xn];return!rn(i)&&!en(i)&&!L(i,"exec")&&!Fe(i)}),n=N(e,s=>({message:"Token Type: ->"+s.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:oe.INVALID_PATTERN,tokenTypes:[s]})),r=Ei(t,e);return{errors:n,valid:r}}const XA=/[^\\][$]/;function JA(t){class e extends Pa{constructor(){super(...arguments),this.found=!1}visitEndAnchor(i){this.found=!0}}const n=at(t,s=>{const i=s.PATTERN;try{const o=Oi(i),a=new e;return a.visit(o),a.found}catch{return XA.test(i.source)}});return N(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:oe.EOI_ANCHOR_FOUND,tokenTypes:[s]}))}function QA(t){const e=at(t,r=>r.PATTERN.test(""));return N(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:oe.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const ZA=/[^\\[][\^]|^\^/;function eS(t){class e extends Pa{constructor(){super(...arguments),this.found=!1}visitStartAnchor(i){this.found=!0}}const n=at(t,s=>{const i=s.PATTERN;try{const o=Oi(i),a=new e;return a.visit(o),a.found}catch{return ZA.test(i.source)}});return N(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:oe.SOI_ANCHOR_FOUND,tokenTypes:[s]}))}function tS(t){const e=at(t,r=>{const s=r[Xn];return s instanceof RegExp&&(s.multiline||s.global)});return N(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:oe.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function nS(t){const e=[];let n=N(t,i=>Ve(t,(o,a)=>(i.PATTERN.source===a.PATTERN.source&&!Ue(e,a)&&a.PATTERN!==be.NA&&(e.push(a),o.push(a)),o),[]));n=ts(n);const r=at(n,i=>i.length>1);return N(r,i=>{const o=N(i,c=>c.name);return{message:`The same RegExp pattern ->${_t(i).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:oe.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}})}function rS(t){const e=at(t,r=>{if(!L(r,"GROUP"))return!1;const s=r.GROUP;return s!==be.SKIPPED&&s!==be.NA&&!Fe(s)});return N(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:oe.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function sS(t,e){const n=at(t,s=>s.PUSH_MODE!==void 0&&!Ue(e,s.PUSH_MODE));return N(n,s=>({message:`Token Type: ->${s.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${s.PUSH_MODE}<-which does not exist`,type:oe.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[s]}))}function iS(t){const e=[],n=Ve(t,(r,s,i)=>{const o=s.PATTERN;return o===be.NA||(Fe(o)?r.push({str:o,idx:i,tokenType:s}):rn(o)&&aS(o)&&r.push({str:o.source,idx:i,tokenType:s})),r},[]);return M(t,(r,s)=>{M(n,({str:i,idx:o,tokenType:a})=>{if(s<o&&oS(i,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:oe.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function oS(t,e){if(rn(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(en(e))return e(t,0,[],{});if(L(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function aS(t){return br([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function Kh(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function Wh(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function cS(t,e,n){const r=[];return L(t,is)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+is+`> property in its definition
`,type:oe.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),L(t,Ci)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ci+`> property in its definition
`,type:oe.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),L(t,Ci)&&L(t,is)&&!L(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${is}: <${t.defaultMode}>which does not exist
`,type:oe.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),L(t,Ci)&&M(t.modes,(s,i)=>{M(s,(o,a)=>{if(sn(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${i}> at index: <${a}>
`,type:oe.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(L(o,"LONGER_ALT")){const c=G(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];M(c,l=>{!sn(l)&&!Ue(s,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${i}>
`,type:oe.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function lS(t,e,n){const r=[];let s=!1;const i=ts(yt(me(t.modes))),o=_i(i,c=>c[Xn]===be.NA),a=zh(n);return e&&M(o,c=>{const l=Vh(c,a);if(l!==!1){const h={message:dS(c,l),type:l.issue,tokenType:c};r.push(h)}else L(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(s=!0):Fa(a,c.PATTERN)&&(s=!0)}),e&&!s&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:oe.NO_LINE_BREAKS_FLAGS}),r}function uS(t){const e={},n=it(t);return M(n,r=>{const s=t[r];if(G(s))e[r]=[];else throw Error("non exhaustive match")}),e}function Hh(t){const e=t.PATTERN;if(rn(e))return!1;if(en(e))return!0;if(L(e,"exec"))return!0;if(Fe(e))return!1;throw Error("non exhaustive match")}function hS(t){return Fe(t)&&t.length===1?t.charCodeAt(0):!1}const fS={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Vh(t,e){if(L(t,"LINE_BREAKS"))return!1;if(rn(t.PATTERN)){try{Fa(e,t.PATTERN)}catch(n){return{issue:oe.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Fe(t.PATTERN))return!1;if(Hh(t))return{issue:oe.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function dS(t,e){if(e.issue===oe.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===oe.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function zh(t){return N(t,n=>Fe(n)?n.charCodeAt(0):n)}function Ba(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const os=256;let Ii=[];function On(t){return t<os?t:Ii[t]}function pS(){if(X(Ii)){Ii=new Array(65536);for(let t=0;t<65536;t++)Ii[t]=t>255?255+~~(t/255):t}}function as(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Li(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let Yh=1;const qh={};function cs(t){const e=gS(t);mS(e),ES(e),yS(e),M(e,n=>{n.isParent=n.categoryMatches.length>0})}function gS(t){let e=Re(t),n=t,r=!0;for(;r;){n=ts(yt(N(n,i=>i.CATEGORIES)));const s=Ei(n,e);e=e.concat(s),X(s)?r=!1:n=s}return e}function mS(t){M(t,e=>{Jh(e)||(qh[Yh]=e,e.tokenTypeIdx=Yh++),Qh(e)&&!G(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Qh(e)||(e.CATEGORIES=[]),_S(e)||(e.categoryMatches=[]),wS(e)||(e.categoryMatchesMap={})})}function yS(t){M(t,e=>{e.categoryMatches=[],M(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(qh[r].tokenTypeIdx)})})}function ES(t){M(t,e=>{Xh([],e)})}function Xh(t,e){M(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),M(e.CATEGORIES,n=>{const r=t.concat(e);Ue(r,n)||Xh(r,n)})}function Jh(t){return L(t,"tokenTypeIdx")}function Qh(t){return L(t,"CATEGORIES")}function _S(t){return L(t,"categoryMatches")}function wS(t){return L(t,"categoryMatchesMap")}function TS(t){return L(t,"tokenTypeIdx")}const bS={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,s){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var oe;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(oe||(oe={}));const ls={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:bS,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(ls);class be{constructor(e,n=ls){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(s,i)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${s}>`);const{time:a,value:c}=xh(i),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${s}> time: ${a}ms`),this.traceInitIndent--,c}else return i()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=He({},ls,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let s,i=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===ls.lineTerminatorsPattern)this.config.lineTerminatorsPattern=fS;else if(this.config.lineTerminatorCharacters===ls.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),G(e)?s={modes:{defaultMode:Re(e)},defaultMode:is}:(i=!1,s=Re(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(cS(s,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(lS(s,this.trackStartLines,this.config.lineTerminatorCharacters))})),s.modes=s.modes?s.modes:{},M(s.modes,(a,c)=>{s.modes[c]=_i(a,l=>sn(l))});const o=it(s.modes);if(M(s.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(VA(a,o))}),X(this.lexerDefinitionErrors)){cs(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=HA(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=He({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=s.defaultMode,!X(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=N(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}M(this.lexerDefinitionWarning,a=>{Mh(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Gh?(this.chopInput=Er,this.match=this.matchWithTest):(this.updateLastIndex=ge,this.match=this.matchWithExec),i&&(this.handleModes=ge),this.trackStartLines===!1&&(this.computeNewColumn=Er),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=ge),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Ve(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!X(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{jA()}),this.TRACE_INIT("toFastProperties",()=>{Uh(this)})})}tokenize(e,n=this.defaultMode){if(!X(this.lexerDefinitionErrors)){const s=N(this.lexerDefinitionErrors,i=>i.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+s)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,s,i,o,a,c,l,u,h,d,f,p,E,A,S;const b=e,w=b.length;let O=0,_=0;const m=this.hasCustom?0:Math.floor(e.length/10),g=new Array(m),T=[];let v=this.trackStartLines?1:void 0,K=this.trackStartLines?1:void 0;const fe=uS(this.emptyGroups),Wr=this.trackStartLines,ve=this.config.lineTerminatorsPattern;let qt=0,pt=[],zs=[];const Bo=[],bm=[];Object.freeze(bm);let Ys;function Am(){return pt}function Sm(Le){const gt=On(Le),Hr=zs[gt];return Hr===void 0?bm:Hr}const iC=Le=>{if(Bo.length===1&&Le.tokenType.PUSH_MODE===void 0){const gt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Le);T.push({offset:Le.startOffset,line:Le.startLine,column:Le.startColumn,length:Le.image.length,message:gt})}else{Bo.pop();const gt=Tr(Bo);pt=this.patternIdxToConfig[gt],zs=this.charCodeToPatternIdxToConfig[gt],qt=pt.length;const Hr=this.canModeBeOptimized[gt]&&this.config.safeMode===!1;zs&&Hr?Ys=Sm:Ys=Am}};function vm(Le){Bo.push(Le),zs=this.charCodeToPatternIdxToConfig[Le],pt=this.patternIdxToConfig[Le],qt=pt.length,qt=pt.length;const gt=this.canModeBeOptimized[Le]&&this.config.safeMode===!1;zs&&gt?Ys=Sm:Ys=Am}vm.call(this,n);let kt;const Rm=this.config.recoveryEnabled;for(;O<w;){c=null;const Le=b.charCodeAt(O),gt=Ys(Le),Hr=gt.length;for(r=0;r<Hr;r++){kt=gt[r];const Qe=kt.pattern;l=null;const _n=kt.short;if(_n!==!1?Le===_n&&(c=Qe):kt.isCustom===!0?(S=Qe.exec(b,O,g,fe),S!==null?(c=S[0],S.payload!==void 0&&(l=S.payload)):c=null):(this.updateLastIndex(Qe,O),c=this.match(Qe,e,O)),c!==null){if(a=kt.longerAlt,a!==void 0){const Bn=a.length;for(i=0;i<Bn;i++){const wn=pt[a[i]],dr=wn.pattern;if(u=null,wn.isCustom===!0?(S=dr.exec(b,O,g,fe),S!==null?(o=S[0],S.payload!==void 0&&(u=S.payload)):o=null):(this.updateLastIndex(dr,O),o=this.match(dr,e,O)),o&&o.length>c.length){c=o,l=u,kt=wn;break}}}break}}if(c!==null){if(h=c.length,d=kt.group,d!==void 0&&(f=kt.tokenTypeIdx,p=this.createTokenInstance(c,O,f,kt.tokenType,v,K,h),this.handlePayload(p,l),d===!1?_=this.addToken(g,_,p):fe[d].push(p)),e=this.chopInput(e,h),O=O+h,K=this.computeNewColumn(K,h),Wr===!0&&kt.canLineTerminator===!0){let Qe=0,_n,Bn;ve.lastIndex=0;do _n=ve.test(c),_n===!0&&(Bn=ve.lastIndex-1,Qe++);while(_n===!0);Qe!==0&&(v=v+Qe,K=h-Bn,this.updateTokenEndLineColumnLocation(p,d,Bn,Qe,v,K,h))}this.handleModes(kt,iC,vm,p)}else{const Qe=O,_n=v,Bn=K;let wn=Rm===!1;for(;wn===!1&&O<w;)for(e=this.chopInput(e,1),O++,s=0;s<qt;s++){const dr=pt[s],Fl=dr.pattern,Om=dr.short;if(Om!==!1?b.charCodeAt(O)===Om&&(wn=!0):dr.isCustom===!0?wn=Fl.exec(b,O,g,fe)!==null:(this.updateLastIndex(Fl,O),wn=Fl.exec(e)!==null),wn===!0)break}if(E=O-Qe,K=this.computeNewColumn(K,E),A=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,Qe,E,_n,Bn),T.push({offset:Qe,line:_n,column:Bn,length:E,message:A}),Rm===!1)break}}return this.hasCustom||(g.length=_),{tokens:g,groups:fe,errors:T}}handleModes(e,n,r,s){if(e.pop===!0){const i=e.push;n(s),i!==void 0&&r.call(this,i)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,s,i,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,s===1&&c===!0||(e.endLine=i+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,s){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:s}}createStartOnlyToken(e,n,r,s,i,o){return{image:e,startOffset:n,startLine:i,startColumn:o,tokenTypeIdx:r,tokenType:s}}createFullToken(e,n,r,s,i,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:s}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}be.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",be.NA=/NOT_APPLICABLE/;function us(t){return Zh(t)?t.LABEL:t.name}function Zh(t){return Fe(t.LABEL)&&t.LABEL!==""}const AS="parent",ef="categories",tf="label",nf="group",rf="push_mode",sf="pop_mode",of="longer_alt",af="line_breaks",cf="start_chars_hint";function U(t){return SS(t)}function SS(t){const e=t.pattern,n={};if(n.name=t.name,sn(e)||(n.PATTERN=e),L(t,AS))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return L(t,ef)&&(n.CATEGORIES=t[ef]),cs([n]),L(t,tf)&&(n.LABEL=t[tf]),L(t,nf)&&(n.GROUP=t[nf]),L(t,sf)&&(n.POP_MODE=t[sf]),L(t,rf)&&(n.PUSH_MODE=t[rf]),L(t,of)&&(n.LONGER_ALT=t[of]),L(t,af)&&(n.LINE_BREAKS=t[af]),L(t,cf)&&(n.START_CHARS_HINT=t[cf]),n}const Jn=U({name:"EOF",pattern:be.NA});cs([Jn]);function Mi(t,e,n,r,s,i,o,a){return{image:e,startOffset:n,endOffset:r,startLine:s,endLine:i,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function vS(t,e){return as(t,e)}const lf={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Zh(t)?`--> ${us(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:s}){const i="Expecting: ",a=`
but found: '`+_t(e).image+"'";if(r)return i+r+a;{const c=Ve(t,(d,f)=>d.concat(f),[]),l=N(c,d=>`[${N(d,f=>us(f)).join(", ")}]`),h=`one of these possible Token sequences:
${N(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return i+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const s="Expecting: ",o=`
but found: '`+_t(e).image+"'";if(n)return s+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${N(t,l=>`[${N(l,u=>us(u)).join(",")}]`).join(" ,")}>`;return s+c+o}}};Object.freeze(lf);const RS={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Qn={buildDuplicateFoundError(t,e){function n(u){return u instanceof ne?u.terminalType.name:u instanceof ze?u.nonTerminalName:""}const r=t.name,s=_t(e),i=s.idx,o=Dt(s),a=n(s),c=i>0;let l=`->${o}${c?i:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=N(t.prefixPath,s=>us(s)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=N(t.prefixPath,s=>us(s)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Dt(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=N(t.leftRecursionPath,i=>i.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Ar?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function OS(t,e){const n=new kS(t,e);return n.resolveRefs(),n.errors}class kS extends Sr{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){M(me(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Pe.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class NS extends bi{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Re(this.path.ruleStack).reverse(),this.occurrenceStack=Re(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const s=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,s)}}updateExpectedNext(){X(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class CS extends NS{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const s=n.concat(r),i=new Be({definition:s});this.possibleTokTypes=rs(i),this.found=!0}}}class xi extends bi{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class IS extends xi{walkMany(e,n,r){if(e.idx===this.occurrence){const s=_t(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof ne&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkMany(e,n,r)}}class uf extends xi{walkManySep(e,n,r){if(e.idx===this.occurrence){const s=_t(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof ne&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkManySep(e,n,r)}}class LS extends xi{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const s=_t(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof ne&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOne(e,n,r)}}class hf extends xi{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const s=_t(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof ne&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOneSep(e,n,r)}}function ja(t,e,n=[]){n=Re(n);let r=[],s=0;function i(a){return a.concat(Oe(t,s+1))}function o(a){const c=ja(i(a),e,n);return r.concat(c)}for(;n.length<e&&s<t.length;){const a=t[s];if(a instanceof Be)return o(a.definition);if(a instanceof ze)return o(a.definition);if(a instanceof je)r=o(a.definition);else if(a instanceof Ut){const c=a.definition.concat([new ye({definition:a.definition})]);return o(c)}else if(a instanceof Pt){const c=[new Be({definition:a.definition}),new ye({definition:[new ne({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Tt){const c=a.definition.concat([new ye({definition:[new ne({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof ye){const c=a.definition.concat([new ye({definition:a.definition})]);r=o(c)}else{if(a instanceof bt)return M(a.definition,c=>{X(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof ne)n.push(a.terminalType);else throw Error("non exhaustive match")}s++}return r.push({partialPath:n,suffixDef:Oe(t,s)}),r}function ff(t,e,n,r){const s="EXIT_NONE_TERMINAL",i=[s],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!X(h);){const d=h.pop();if(d===o){a&&Tr(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,E=d.ruleStack,A=d.occurrenceStack;if(X(f))continue;const S=f[0];if(S===s){const b={idx:p,def:Oe(f),ruleStack:ns(E),occurrenceStack:ns(A)};h.push(b)}else if(S instanceof ne)if(p<c-1){const b=p+1,w=e[b];if(n(w,S.terminalType)){const O={idx:b,def:Oe(f),ruleStack:E,occurrenceStack:A};h.push(O)}}else if(p===c-1)u.push({nextTokenType:S.terminalType,nextTokenOccurrence:S.idx,ruleStack:E,occurrenceStack:A}),a=!0;else throw Error("non exhaustive match");else if(S instanceof ze){const b=Re(E);b.push(S.nonTerminalName);const w=Re(A);w.push(S.idx);const O={idx:p,def:S.definition.concat(i,Oe(f)),ruleStack:b,occurrenceStack:w};h.push(O)}else if(S instanceof je){const b={idx:p,def:Oe(f),ruleStack:E,occurrenceStack:A};h.push(b),h.push(o);const w={idx:p,def:S.definition.concat(Oe(f)),ruleStack:E,occurrenceStack:A};h.push(w)}else if(S instanceof Ut){const b=new ye({definition:S.definition,idx:S.idx}),w=S.definition.concat([b],Oe(f)),O={idx:p,def:w,ruleStack:E,occurrenceStack:A};h.push(O)}else if(S instanceof Pt){const b=new ne({terminalType:S.separator}),w=new ye({definition:[b].concat(S.definition),idx:S.idx}),O=S.definition.concat([w],Oe(f)),_={idx:p,def:O,ruleStack:E,occurrenceStack:A};h.push(_)}else if(S instanceof Tt){const b={idx:p,def:Oe(f),ruleStack:E,occurrenceStack:A};h.push(b),h.push(o);const w=new ne({terminalType:S.separator}),O=new ye({definition:[w].concat(S.definition),idx:S.idx}),_=S.definition.concat([O],Oe(f)),m={idx:p,def:_,ruleStack:E,occurrenceStack:A};h.push(m)}else if(S instanceof ye){const b={idx:p,def:Oe(f),ruleStack:E,occurrenceStack:A};h.push(b),h.push(o);const w=new ye({definition:S.definition,idx:S.idx}),O=S.definition.concat([w],Oe(f)),_={idx:p,def:O,ruleStack:E,occurrenceStack:A};h.push(_)}else if(S instanceof bt)for(let b=S.definition.length-1;b>=0;b--){const w=S.definition[b],O={idx:p,def:w.definition.concat(Oe(f)),ruleStack:E,occurrenceStack:A};h.push(O),h.push(o)}else if(S instanceof Be)h.push({idx:p,def:S.definition.concat(Oe(f)),ruleStack:E,occurrenceStack:A});else if(S instanceof Ar)h.push(MS(S,p,E,A));else throw Error("non exhaustive match")}return u}function MS(t,e,n,r){const s=Re(n);s.push(t.name);const i=Re(r);return i.push(1),{idx:e,def:t.definition,ruleStack:s,occurrenceStack:i}}var ae;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ae||(ae={}));function df(t){if(t instanceof je||t==="Option")return ae.OPTION;if(t instanceof ye||t==="Repetition")return ae.REPETITION;if(t instanceof Ut||t==="RepetitionMandatory")return ae.REPETITION_MANDATORY;if(t instanceof Pt||t==="RepetitionMandatoryWithSeparator")return ae.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Tt||t==="RepetitionWithSeparator")return ae.REPETITION_WITH_SEPARATOR;if(t instanceof bt||t==="Alternation")return ae.ALTERNATION;throw Error("non exhaustive match")}function xS(t,e,n,r,s,i){const o=Ka(t,e,n),a=yf(o)?Li:as;return i(o,r,a,s)}function US(t,e,n,r,s,i){const o=Wa(t,e,s,n),a=yf(o)?Li:as;return i(o[0],a,r)}function PS(t,e,n,r){const s=t.length,i=Et(t,o=>Et(o,a=>a.length===1));if(e)return function(o){const a=N(o,c=>c.GATE);for(let c=0;c<s;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let E=0;E<p;E++){const A=this.LA(E+1);if(n(A,f[E])===!1)continue e}return c}}};if(i&&!r){const o=N(t,c=>yt(c)),a=Ve(o,(c,l,u)=>(M(l,h=>{L(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),M(h.categoryMatches,d=>{L(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<s;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue e}return o}}}}function DS(t,e,n){const r=Et(t,i=>i.length===1),s=t.length;if(r&&!n){const i=yt(t);if(i.length===1&&X(i[0].categoryMatches)){const a=i[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Ve(i,(a,c,l)=>(a[c.tokenTypeIdx]=!0,M(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let i=0;i<s;i++){const o=t[i],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class $S extends bi{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,s){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(s),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,ae.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,ae.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,ae.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,ae.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,ae.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class pf extends Sr{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ae.OPTION)}visitRepetition(e){this.checkIsTarget(e,ae.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ae.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ae.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ae.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ae.ALTERNATION)}}function gf(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Ga(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],s=[];for(let i=0;i<e.length;i++){const o=e[i];s.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];s.push(o+c)}}e=s}return e}function FS(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const s=t[r];for(let i=0;i<e.length;i++){const o=e[i];if(s[o]===!0)return!1}}return!0}function mf(t,e){const n=N(t,o=>ja([o],1)),r=gf(n.length),s=N(n,o=>{const a={};return M(o,c=>{const l=Ga(c.partialPath);M(l,u=>{a[u]=!0})}),a});let i=n;for(let o=1;o<=e;o++){const a=i;i=gf(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=Ga(h);if(FS(s,f,c)||X(d)||h.length===e){const E=r[c];if(Ha(E,h)===!1){E.push(h);for(let A=0;A<f.length;A++){const S=f[A];s[c][S]=!0}}}else{const E=ja(d,o+1,h);i[c]=i[c].concat(E),M(E,A=>{const S=Ga(A.partialPath);M(S,b=>{s[c][b]=!0})})}}}}return r}function Ka(t,e,n,r){const s=new pf(t,ae.ALTERNATION,r);return e.accept(s),mf(s.result,n)}function Wa(t,e,n,r){const s=new pf(t,n);e.accept(s);const i=s.result,a=new $S(e,t,n).startWalking(),c=new Be({definition:i}),l=new Be({definition:a});return mf([c,l],r)}function Ha(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let s=0;s<r.length;s++){const i=e[s],o=r[s];if((i===o||o.categoryMatchesMap[i.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function BS(t,e){return t.length<e.length&&Et(t,(n,r)=>{const s=e[r];return n===s||s.categoryMatchesMap[n.tokenTypeIdx]})}function yf(t){return Et(t,e=>Et(e,n=>Et(n,r=>X(r.categoryMatches))))}function jS(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return N(e,n=>Object.assign({type:Pe.CUSTOM_LOOKAHEAD_VALIDATION},n))}function GS(t,e,n,r){const s=ct(t,c=>KS(c,n)),i=tv(t,e,n),o=ct(t,c=>JS(c,n)),a=ct(t,c=>VS(c,t,r,n));return s.concat(i,o,a)}function KS(t,e){const n=new HS;t.accept(n);const r=n.allProductions,s=nA(r,WS),i=wt(s,a=>a.length>1);return N(me(i),a=>{const c=_t(a),l=e.buildDuplicateFoundError(t,a),u=Dt(c),h={message:l,type:Pe.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=Ef(c);return d&&(h.parameter=d),h})}function WS(t){return`${Dt(t)}_#_${t.idx}_#_${Ef(t)}`}function Ef(t){return t instanceof ne?t.terminalType.name:t instanceof ze?t.nonTerminalName:""}class HS extends Sr{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function VS(t,e,n,r){const s=[];if(Ve(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});s.push({message:o,type:Pe.DUPLICATE_RULE_NAME,ruleName:t.name})}return s}function zS(t,e,n){const r=[];let s;return Ue(e,t)||(s=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:s,type:Pe.INVALID_RULE_OVERRIDE,ruleName:t})),r}function _f(t,e,n,r=[]){const s=[],i=Ui(e.definition);if(X(i))return[];{const o=t.name;Ue(i,t)&&s.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Pe.LEFT_RECURSION,ruleName:o});const c=Ei(i,r.concat([t])),l=ct(c,u=>{const h=Re(r);return h.push(u),_f(t,u,n,h)});return s.concat(l)}}function Ui(t){let e=[];if(X(t))return e;const n=_t(t);if(n instanceof ze)e.push(n.referencedRule);else if(n instanceof Be||n instanceof je||n instanceof Ut||n instanceof Pt||n instanceof Tt||n instanceof ye)e=e.concat(Ui(n.definition));else if(n instanceof bt)e=yt(N(n.definition,i=>Ui(i.definition)));else if(!(n instanceof ne))throw Error("non exhaustive match");const r=Ti(n),s=t.length>1;if(r&&s){const i=Oe(t);return e.concat(Ui(i))}else return e}class Va extends Sr{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function YS(t,e){const n=new Va;t.accept(n);const r=n.alternations;return ct(r,i=>{const o=ns(i.definition);return ct(o,(a,c)=>{const l=ff([a],[],as,1);return X(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:i,emptyChoiceIdx:c}),type:Pe.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:i.idx,alternative:c+1}]:[]})})}function qS(t,e,n){const r=new Va;t.accept(r);let s=r.alternations;return s=_i(s,o=>o.ignoreAmbiguities===!0),ct(s,o=>{const a=o.idx,c=o.maxLookahead||e,l=Ka(a,t,c,o),u=ZS(l,o,t,n),h=ev(l,o,t,n);return u.concat(h)})}class XS extends Sr{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function JS(t,e){const n=new Va;t.accept(n);const r=n.alternations;return ct(r,i=>i.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:i}),type:Pe.TOO_MANY_ALTS,ruleName:t.name,occurrence:i.idx}]:[])}function QS(t,e,n){const r=[];return M(t,s=>{const i=new XS;s.accept(i);const o=i.allProductions;M(o,a=>{const c=df(a),l=a.maxLookahead||e,u=a.idx,d=Wa(u,s,c,l)[0];if(X(yt(d))){const f=n.buildEmptyRepetitionError({topLevelRule:s,repetition:a});r.push({message:f,type:Pe.NO_NON_EMPTY_LOOKAHEAD,ruleName:s.name})}})}),r}function ZS(t,e,n,r){const s=[],i=Ve(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||M(c,u=>{const h=[l];M(t,(d,f)=>{l!==f&&Ha(d,u)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!Ha(s,u)&&(s.push(u),a.push({alts:h,path:u}))}),a),[]);return N(i,a=>{const c=N(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Pe.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function ev(t,e,n,r){const s=Ve(t,(o,a,c)=>{const l=N(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return ts(ct(s,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=at(s,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&BS(d.path,l));return N(u,d=>{const f=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:Pe.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function tv(t,e,n){const r=[],s=N(e,i=>i.name);return M(t,i=>{const o=i.name;if(Ue(s,o)){const a=n.buildNamespaceConflictError(i);r.push({message:a,type:Pe.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function nv(t){const e=La(t,{errMsgProvider:RS}),n={};return M(t.rules,r=>{n[r.name]=r}),OS(n,e.errMsgProvider)}function rv(t){return t=La(t,{errMsgProvider:Qn}),GS(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const wf="MismatchedTokenException",Tf="NoViableAltException",bf="EarlyExitException",Af="NotAllInputParsedException",Sf=[wf,Tf,bf,Af];Object.freeze(Sf);function Pi(t){return Ue(Sf,t.name)}class Di extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class vf extends Di{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=wf}}class sv extends Di{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Tf}}class iv extends Di{constructor(e,n){super(e,n),this.name=Af}}class ov extends Di{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=bf}}const za={},Rf="InRuleRecoveryException";class av extends Error{constructor(e){super(e),this.name=Rf}}class cv{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=L(e,"recoveryEnabled")?e.recoveryEnabled:on.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=lv)}getTokenToInsert(e){const n=Mi(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,s){const i=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:s,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new vf(f,l,this.LA(0));p.resyncedTokens=ns(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,s)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,i)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new av("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||X(n))return!1;const r=this.LA(1);return br(n,i=>this.tokenMatcher(r,i))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Ue(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const s=br(e,i=>vS(n,i));if(s!==void 0)return s;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return za;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return N(e,(r,s)=>s===0?za:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[s],inRule:this.shortRuleNameToFullName(e[s-1])})}flattenFollowSet(){const e=N(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return yt(e)}getFollowSetFromFollowKey(e){if(e===za)return[Jn];const n=e.ruleName+e.idxInCallingRule+Dh+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,Jn)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ns(n)}attemptInRepetitionRecovery(e,n,r,s,i,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),s=Re(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:s,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return N(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function lv(t,e,n,r,s,i,o){const a=this.getKeyForAutomaticLookahead(r,s);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new i(f,s).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=Jn,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const uv=4,kn=8,Of=1<<kn,kf=2<<kn,Ya=3<<kn,qa=4<<kn,Xa=5<<kn,$i=6<<kn;function Ja(t,e,n){return n|e|t}class hv{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:on.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(X(n)){const r=this.validateEmptyOrAlternatives(e.rules),s=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),i=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...s,...i]}return n}validateNoLeftRecursion(e){return ct(e,n=>_f(n,n,Qn))}validateEmptyOrAlternatives(e){return ct(e,n=>YS(n,Qn))}validateAmbiguousAlternationAlternatives(e,n){return ct(e,r=>qS(r,n,Qn))}validateSomeNonEmptyLookaheadPath(e,n){return QS(e,n,Qn)}buildLookaheadForAlternation(e){return xS(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,PS)}buildLookaheadForOptional(e){return US(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,df(e.prodType),DS)}}class fv{initLooksAhead(e){this.dynamicTokensEnabled=L(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:on.dynamicTokensEnabled,this.maxLookahead=L(e,"maxLookahead")?e.maxLookahead:on.maxLookahead,this.lookaheadStrategy=L(e,"lookaheadStrategy")?e.lookaheadStrategy:new hv({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){M(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:s,option:i,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=pv(n);M(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Dt(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Ja(this.fullRuleNameToShort[n.name],Of,l.idx);this.setLaFuncCache(d,h)})}),M(s,l=>{this.computeLookaheadFunc(n,l.idx,Ya,"Repetition",l.maxLookahead,Dt(l))}),M(i,l=>{this.computeLookaheadFunc(n,l.idx,kf,"Option",l.maxLookahead,Dt(l))}),M(o,l=>{this.computeLookaheadFunc(n,l.idx,qa,"RepetitionMandatory",l.maxLookahead,Dt(l))}),M(a,l=>{this.computeLookaheadFunc(n,l.idx,$i,"RepetitionMandatoryWithSeparator",l.maxLookahead,Dt(l))}),M(c,l=>{this.computeLookaheadFunc(n,l.idx,Xa,"RepetitionWithSeparator",l.maxLookahead,Dt(l))})})})}computeLookaheadFunc(e,n,r,s,i,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:s}),c=Ja(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return Ja(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class dv extends Sr{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Fi=new dv;function pv(t){Fi.reset(),t.accept(Fi);const e=Fi.dslMethods;return Fi.reset(),e}function Nf(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function Cf(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function gv(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function mv(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const yv="name";function If(t,e){Object.defineProperty(t,yv,{enumerable:!1,configurable:!0,writable:!1,value:e})}function Ev(t,e){const n=it(t),r=n.length;for(let s=0;s<r;s++){const i=n[s],o=t[i],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function _v(t,e){const n=function(){};If(n,t+"BaseSemantics");const r={visit:function(s,i){if(G(s)&&(s=s[0]),!sn(s))return this[s.name](s.children,i)},validateVisitor:function(){const s=Tv(this,e);if(!X(s)){const i=N(s,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${i.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function wv(t,e,n){const r=function(){};If(r,t+"BaseSemanticsWithDefaults");const s=Object.create(n.prototype);return M(e,i=>{s[i]=Ev}),r.prototype=s,r.prototype.constructor=r,r}var Qa;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Qa||(Qa={}));function Tv(t,e){return bv(t,e)}function bv(t,e){const n=at(e,s=>en(t[s])===!1),r=N(n,s=>({msg:`Missing visitor method: <${s}> on ${t.constructor.name} CST Visitor.`,type:Qa.MISSING_METHOD,methodName:s}));return ts(r)}class Av{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=L(e,"nodeLocationTracking")?e.nodeLocationTracking:on.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=ge,this.cstFinallyStateUpdate=ge,this.cstPostTerminal=ge,this.cstPostNonTerminal=ge,this.cstPostRule=ge;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Cf,this.setNodeLocationFromNode=Cf,this.cstPostRule=ge,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=ge,this.setNodeLocationFromNode=ge,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Nf,this.setNodeLocationFromNode=Nf,this.cstPostRule=ge,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=ge,this.setNodeLocationFromNode=ge,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=ge,this.setNodeLocationFromNode=ge,this.cstPostRule=ge,this.setInitialNodeLocation=ge;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];gv(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];mv(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(sn(this.baseCstVisitorConstructor)){const e=_v(this.className,it(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(sn(this.baseCstVisitorWithDefaultsConstructor)){const e=wv(this.className,it(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class Sv{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Gi}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Gi:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class vv{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Ki){if(Ue(this.definedRulesNames,e)){const o={message:Qn.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Pe.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const s=this.defineRule(e,n,r);return this[e]=s,s}OVERRIDE_RULE(e,n,r=Ki){const s=zS(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(s);const i=this.defineRule(e,n,r);return this[e]=i,i}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(s){if(Pi(s))return!1;throw s}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return OA(me(this.gastProductionsCache))}}class Rv{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Li,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},L(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(G(e)){if(X(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(G(e))this.tokensMap=Ve(e,(i,o)=>(i[o.name]=o,i),{});else if(L(e,"modes")&&Et(yt(me(e.modes)),TS)){const i=yt(me(e.modes)),o=Ma(i);this.tokensMap=Ve(o,(a,c)=>(a[c.name]=c,a),{})}else if(st(e))this.tokensMap=Re(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Jn;const r=L(e,"modes")?yt(me(e.modes)):me(e),s=Et(r,i=>X(i.categoryMatches));this.tokenMatcher=s?Li:as,cs(me(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const s=L(r,"resyncEnabled")?r.resyncEnabled:Ki.resyncEnabled,i=L(r,"recoveryValueFunc")?r.recoveryValueFunc:Ki.recoveryValueFunc,o=this.ruleShortNameIdx<<uv+kn;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const s=this.RULE_STACK.length===1,i=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Pi(e)){const o=e;if(i){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(s)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(kf,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof e!="function"){i=e.DEF;const o=e.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=e;if(s.call(this)===!0)return i.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(qa,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const o=n.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=n;if(s.call(this)===!0){let o=this.doSingleRepetition(i);for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i)}else throw this.raiseEarlyExitException(e,ae.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],s,qa,e,LS)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead($i,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,a,s,hf],a,$i,e,hf)}else throw this.raiseEarlyExitException(e,ae.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ya,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const a=n.GATE;if(a!==void 0){const c=s;s=()=>a.call(this)&&c.call(this)}}else i=n;let o=!0;for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],s,Ya,e,IS,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Xa,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,a,s,uf],a,Xa,e,uf)}}repetitionSepSecondInternal(e,n,r,s,i){for(;r();)this.CONSUME(n),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,s,i],r,$i,e,i)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(Of,n),s=G(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,s);if(o!==void 0)return s[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new iv(n,e))}}subruleInternal(e,n,r){let s;try{const i=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,s=e.apply(this,i),this.cstPostNonTerminal(s,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),s}catch(i){throw this.subruleInternalError(i,r,e.ruleName)}}subruleInternalError(e,n,r){throw Pi(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let s;try{const i=this.LA(1);this.tokenMatcher(i,e)===!0?(this.consumeToken(),s=i):this.consumeInternalError(e,i,r)}catch(i){s=this.consumeInternalRecovery(e,n,i)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,s),s}consumeInternalError(e,n,r){let s;const i=this.LA(0);throw r!==void 0&&r.ERR_MSG?s=r.ERR_MSG:s=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new vf(s,n,i))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const s=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,s)}catch(i){throw i.name===Rf?r:i}}else throw r}saveRecogState(){const e=this.errors,n=Re(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Jn)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class Ov{initErrorHandler(e){this._errors=[],this.errorMessageProvider=L(e,"errorMessageProvider")?e.errorMessageProvider:on.errorMessageProvider}SAVE_ERROR(e){if(Pi(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Re(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Re(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const s=this.getCurrRuleFullName(),i=this.getGAstProductions()[s],a=Wa(e,i,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:s});throw this.SAVE_ERROR(new ov(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),s=this.getGAstProductions()[r],i=Ka(e,s,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new sv(c,this.LA(1),a))}}class kv{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(sn(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return ff([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=_t(e.ruleStack),s=this.getGAstProductions()[n];return new CS(s,e).startWalking()}}const Bi={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Bi);const Lf=!0,Mf=Math.pow(2,kn)-1,xf=U({name:"RECORDING_PHASE_TOKEN",pattern:be.NA});cs([xf]);const Uf=Mi(xf,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Uf);const Nv={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class Cv{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,s){return this.consumeInternalRecord(r,e,s)},this[`SUBRULE${n}`]=function(r,s){return this.subruleInternalRecord(r,e,s)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Gi}topLevelRuleRecord(e,n){try{const r=new Ar({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return hs.call(this,je,e,n)}atLeastOneInternalRecord(e,n){hs.call(this,Ut,n,e)}atLeastOneSepFirstInternalRecord(e,n){hs.call(this,Pt,n,e,Lf)}manyInternalRecord(e,n){hs.call(this,ye,n,e)}manySepFirstInternalRecord(e,n){hs.call(this,Tt,n,e,Lf)}orInternalRecord(e,n){return Iv.call(this,e,n)}subruleInternalRecord(e,n,r){if(ji(n),!e||L(e,"ruleName")===!1){const a=new Error(`<SUBRULE${Pf(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const s=Tr(this.recordingProdStack),i=e.ruleName,o=new ze({idx:n,nonTerminalName:i,label:r==null?void 0:r.LABEL,referencedRule:void 0});return s.definition.push(o),this.outputCst?Nv:Bi}consumeInternalRecord(e,n,r){if(ji(n),!Jh(e)){const o=new Error(`<CONSUME${Pf(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const s=Tr(this.recordingProdStack),i=new ne({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return s.definition.push(i),Uf}}function hs(t,e,n,r=!1){ji(n);const s=Tr(this.recordingProdStack),i=en(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),L(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),i.call(this),s.definition.push(o),this.recordingProdStack.pop(),Bi}function Iv(t,e){ji(e);const n=Tr(this.recordingProdStack),r=G(t)===!1,s=r===!1?t:t.DEF,i=new bt({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});L(t,"MAX_LOOKAHEAD")&&(i.maxLookahead=t.MAX_LOOKAHEAD);const o=Lh(s,a=>en(a.GATE));return i.hasPredicates=o,n.definition.push(i),M(s,a=>{const c=new Be({definition:[]});i.definition.push(c),L(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:L(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Bi}function Pf(t){return t===0?"":`${t}`}function ji(t){if(t<0||t>Mf){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${Mf+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class Lv{initPerformanceTracer(e){if(L(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=on.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:s,value:i}=xh(n),o=s>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${s}ms`),this.traceInitIndent--,i}else return n()}}function Mv(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(s=>{if(s==="constructor")return;const i=Object.getOwnPropertyDescriptor(r,s);i&&(i.get||i.set)?Object.defineProperty(t.prototype,s,i):t.prototype[s]=n.prototype[s]})})}const Gi=Mi(Jn,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Gi);const on=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:lf,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Ki=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Pe;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Pe||(Pe={}));class fs{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Uh(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),M(this.definedRulesNames,s=>{const o=this[s].originalGrammarAction;let a;this.TRACE_INIT(`${s} Rule`,()=>{a=this.topLevelRuleRecord(s,o)}),this.gastProductionsCache[s]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=nv({rules:me(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(X(r)&&this.skipValidations===!1){const s=rv({rules:me(this.gastProductionsCache),tokenTypes:me(this.tokensMap),errMsgProvider:Qn,grammarName:n}),i=jS({lookaheadStrategy:this.lookaheadStrategy,rules:me(this.gastProductionsCache),tokenTypes:me(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(s,i)}}),X(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const s=xA(me(this.gastProductionsCache));this.resyncFollows=s}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var s,i;(i=(s=this.lookaheadStrategy).initialize)===null||i===void 0||i.call(s,{rules:me(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(me(this.gastProductionsCache))})),!fs.DEFER_DEFINITION_ERRORS_HANDLING&&!X(this.definitionErrors))throw e=N(this.definitionErrors,s=>s.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),L(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=L(n,"skipValidations")?n.skipValidations:on.skipValidations}}fs.DEFER_DEFINITION_ERRORS_HANDLING=!1,Mv(fs,[cv,fv,Av,Sv,Rv,vv,Ov,kv,Cv,Lv]);class xv extends fs{constructor(e,n=on){const r=Re(n);r.outputCst=!0,super(e,r)}}const $t=!!JSON.parse("false");JSON.parse("false");const Uv=!!JSON.parse("false");JSON.parse("false");const Za=Jo(32,126).map(t=>String.fromCharCode(t)),ds=U({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Pv=U({name:"Whitespace",pattern:/ +/,group:be.SKIPPED}),Dv=U({name:"Whitespace",pattern:/\s+/,line_breaks:!0,group:be.SKIPPED}),ec=U({name:"Stat",pattern:/@.*/,start_chars_hint:["@"]}),At=U({name:"Command",pattern:/#/,start_chars_hint:["#"]});let Df=!1;function $v(t,e,n){if(!Df)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==ds)return null;let s=e;for(;t[s]===" ";)s++;if("@#/?':!".includes(t[s]))return null;let i=e+1;for(;i<t.length&&t[i]!==`
`;)i++;return[t.substring(e,i)]}const $f=U({name:"Text",pattern:$v,line_breaks:!1,start_chars_hint:Za.filter(t=>"@#/?':!".includes(t)===!1)}),Ff=U({name:"Comment",pattern:/'.*/,start_chars_hint:["'"]}),Bf=U({name:"Label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),jf=U({name:"HyperLink",pattern:/!/,start_chars_hint:["!"]}),Gf=U({name:"HyperLinkText",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Ge=U({name:"StringLiteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Za}),Kf=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Wf=U({name:"NumberLiteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/});function Ke(t){return U({name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:Ge})}const Hf=U({name:"IsEq",pattern:/=|is|eq|equal/,longer_alt:Ge}),Vf=U({name:"IsNotEq",pattern:/!=|not ?eq|not ?equal/,longer_alt:Ge}),zf=U({name:"IsLessThan",pattern:/<|below/,longer_alt:Ge}),Yf=U({name:"IsGreaterThan",pattern:/>|above/,longer_alt:Ge}),qf=U({name:"IsLessThanOrEqual",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:Ge}),Xf=U({name:"IsGreaterThanOrEqual",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:Ge}),tc=U({name:"Or",pattern:/or/i,longer_alt:Ge}),nc=U({name:"Not",pattern:/not/i,longer_alt:Ge}),rc=U({name:"And",pattern:/and/i,longer_alt:Ge}),sc=U({name:"Plus",pattern:/\+/}),ic=U({name:"Minus",pattern:/-/}),Jf=U({name:"Power",pattern:/\*\*/}),Qf=U({name:"Multiply",pattern:/\*/}),oc=U({name:"Divide",pattern:/\//}),Zf=U({name:"ModDivide",pattern:/%/}),ed=U({name:"FloorDivide",pattern:/%%/}),td=U({name:"Query",pattern:/\?/}),nd=U({name:"LParen",pattern:/\(/,push_mode:"ignore_newlines"}),rd=U({name:"RParen",pattern:/\)/,pop_mode:!0}),sd=U({name:"play",pattern:/play .*/,start_chars_hint:Za,longer_alt:Ge}),ac=Ke("if"),Zn=Ke("do"),er=Ke("then"),cc=Ke("else"),id=Ke("endif"),od=Ke("while"),ad=Ke("endwhile"),cd=Ke("repeat"),ld=Ke("endrepeat"),lc=Ke("read"),ud=Ke("into"),hd=Ke("endread"),fd=Ke("break"),dd=Ke("continue");function pd(t){return[...t,Wf,Hf,Vf,qf,zf,Xf,Yf,tc,nc,rc,sc,ic,Jf,Qf,oc,ed,Zf,td,nd,rd,Kf,Ge]}const gd=pd([$f,ec,sd,At,Ff,Bf,jf,Gf,ds,Pv,ac,Zn,er,cc,id,od,ad,cd,ld,lc,ud,hd,fd,dd]),Fv=new be({defaultMode:"use_newlines",modes:{use_newlines:gd,ignore_newlines:pd([Dv])}},{skipValidations:!$t,ensureOptimizations:$t});function uc(t){Df=!0;const e=Fv.tokenize(t||` 
`),[n]=(Array.isArray(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(Mi(ds,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}var le=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(le||{});function Bv(t,e){return{id:Tn(),code:t,...e}}function jv(t){return t.map(e=>e.image)}function Gv(t,e){const[n,r,...s]=e;if(y(t.stats)&&y(n))switch(n.image.toLowerCase()){case"rn":case"range":case"sl":case"select":case"nm":case"number":case"tx":case"text":case"ln":case"link":if(y(r)){const i=r.image.toLowerCase();t.stats[i]=jv(s??[])}break}}function md(t){const e={...hc(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function hc(t){var r;if(!y(t))return{};if(y((r=t.stats)==null?void 0:r.type))return t.stats;t.stats={};const e=uc(t.code);let n=!0;for(let s=0;s<e.tokens.length;++s){const i=e.tokens[s];if(i.tokenType===ec){const[o,...a]=i.image.slice(1).split(" "),c=o.toLowerCase(),l=a.join(" "),u=l.toLowerCase();switch(c){case"stat":{const h=uc(`!${l}`);h.tokens.length&&Gv(t,h.tokens);break}case"flags":t.stats.flags=u;break;case"cli":t.stats.type=1,t.stats.name=u;break;case"board":t.stats.type=2,t.stats.name=u;break;case"object":t.stats.type=3,t.stats.name=u;break;case"terrain":t.stats.type=4,t.stats.name=u;break;case"charset":t.stats.type=5,t.stats.name=u;break;case"palette":t.stats.type=6,t.stats.name=u;break;default:n?t.stats.name=[c,...a].join(" "):t.stats[c]=1;break}n=!1}}return y(t.stats.type)||(t.stats.type=3),t.stats}function fc(t){return hc(t).type??0}function yd(t){switch(fc(t)){default:case 0:return"error";case 1:return"cli";case 2:return"board";case 3:return"object";case 4:return"terrain";case 5:return"charset";case 6:return"palette"}}function Wi(t){return(hc(t).name??"").toLowerCase()}function dc(t){return{id:Tn(),name:Hm(),pages:t,flags:{},players:{}}}function Kv(t,e){if(!y(t))return;const n=e.toLowerCase();return t.pages.find(s=>s.id===e||n===Wi(s))}function Hi(t,e,n){if(!y(t))return;const r=n.toLowerCase();return t.pages.find(i=>fc(i)===e&&(i.id===n||r===Wi(i)))}function Wv(t,e){if(!y(t)||!y(e))return!1;const n=Kv(t,e.id);return y(n)?!1:(t.pages.push(e),!0)}function pc(t,e,n){const r=Hi(t,e,n);if(r)switch(e){case le.ERROR:return r.error;case le.BOARD:return r.board;case le.OBJECT:return r.object;case le.TERRAIN:return r.terrain;case le.CHARSET:return r.charset;case le.PALETTE:return r.palette}}function Ft(t,e){if(y(e)&&y(e.kind))return y(e.kinddata)||(e.kinddata=y(e.id)?Vi(t,e.kind):Ed(t,e.kind)),e.kinddata}function Vi(t,e){const n=e??"",r=Hi(t,le.OBJECT,n),s=pc(t,le.OBJECT,n);if(y(r)){const i=md(r);return{...s,...i,name:n,code:r.code}}else return}function Ed(t,e){const n=e??"",r=Hi(t,le.TERRAIN,n),s=pc(t,le.TERRAIN,n);if(y(r)){const i=md(r);return{...s,...i,name:n,code:r.code}}else return}function Rr(t,e){return pc(t,le.BOARD,e)}function _d(t,e){if(t)return t.flags[e]=t.flags[e]??{},t.flags[e]}function wd(t,e,n){const r=_d(t,e);return r==null?void 0:r[n]}function Td(t,e,n,r){const s=_d(t,e);return s&&(s[n]=r),r}function bd(t,e){return Rr(t,(t==null?void 0:t.players[e])??"")}function Hv(t,e,n){y(t)&&y(Rr(t,n))&&(t.players[e]=n)}function Vv(t){return Iy(Object.values((t==null?void 0:t.players)??[])).map(e=>Rr(t,e)).filter(y)}function zv(t,e,n,r){const s=ea(e,(n==null?void 0:n.id)??"");if(!y(t)||!y(e)||!y(s)||!y(s.x)||!y(s.y)||!y(e.lookup)||r.x<0||r.x>=e.width||r.y<0||r.y>=e.height)return{kind:"edge",collision:Ne.SOLID,x:r.x,y:r.y};if(s.x-r.x===0&&s.y-r.y===0)return;const i=r.x+r.y*e.width,o=Ft(t,s),a=s.collision??(o==null?void 0:o.collision),c=ea(e,e.lookup[i]??"");if(y(c))return{...c};const l=e.terrain[i];if(y(l)){const u=Ft(t,l),h=l.collision??(u==null?void 0:u.collision);if(Zl(a,h))return{...l,x:r.x,y:r.y}}s.x=r.x,s.y=r.y,y(s.removed)||(e.lookup[i]=void 0,e.lookup[s.x+s.y*e.width]=s.id??"")}function Or(t,e){const n=Ft(t,e);return y(e==null?void 0:e.id)&&y(e.x)&&y(e.y)?(e.name??(n==null?void 0:n.name)??"object").toLowerCase():((e==null?void 0:e.name)??(n==null?void 0:n.name)??"terrain").toLowerCase()}function gc(t,e,n,r){if(!y(t)||!y(e)||!y(e.named)||!y(n))return;const s=Or(t,n);e.named[s]||(e.named[s]=new Set),e.named[s].add((n==null?void 0:n.id)??r??"")}function Yv(t,e,n){if(!(!y(t)||!y(e)||!y(e.lookup)||!y(n==null?void 0:n.id))&&!y(n.removed)){const r=n.x??0,s=n.y??0;e.lookup[r+s*e.width]=n.id}}function ps(t,e){if(!y(t)||!y(e)||y(e.lookup)&&y(e.named))return;const n=new Array(e.width*e.height).fill(void 0),r={},s=Object.values(e.objects);for(let a=0;a<s.length;++a){const c=s[a];if(y(c.x)&&y(c.y)&&y(c.id)&&!y(c.removed)){c.category=ti.OBJECT,n[c.x+c.y*e.width]=c.id;const l=Or(t,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let i=0,o=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(y(c)){c.x=i,c.y=o,c.category=ti.TERRAIN;const l=Or(t,c);r[l]||(r[l]=new Set),r[l].add(a)}++i,i>=e.width&&(i=0,++o)}e.lookup=n,e.named=r}function mc(t,e,n){return Or(t,e)!=="player"&&y(e)?(e.removed=n,!0):!1}function zi(t,e,n){var r;if(y(t)&&y(e)&&y(n==null?void 0:n.id)){if(y(e.lookup)&&y(n.x)&&y(n.y)){const i=n.x+n.y*e.width;e.lookup[i]===n.id&&delete e.lookup[i]}const s=Or(t,n);y((r=e.named)==null?void 0:r[s])&&y(n.id)&&e.named[s].delete(n.id)}}function qv(t,e,n){if(!y(t)||!y(e))return;const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const i=r[s];y(i.id)&&y(i.removed)&&n-i.removed>ca*5&&ta(e,i.id)}}function Xv(t,e,n){const r=[];if(!y(t)||!y(e))return r;e.lookup=void 0,ps(t,e);const s=Object.values(e.objects);for(let i=0;i<s.length;++i){const o=s[i];if(!y(o.id))continue;o.lx=o.x,o.ly=o.y;const a=Ft(t,o),c=o.code??(a==null?void 0:a.code)??"";c&&r.push({id:o.id,type:le.OBJECT,code:c,object:o,terrain:void 0})}return qv(t,e,n),r}var gs=(t=>(t[t.VIEW=0]="VIEW",t[t.EDIT=1]="EDIT",t))(gs||{});function Ad(t){return{id:Tn(),type:t}}function Sd(t,e){const n=Ad(0);return n.book=t,n.board=e,n}function Jv(t,e){const n=Ad(1);return n.book=t,n.board=e,n}const Ye={defaultplayer:"",books:new Map,chips:new Map,frames:new Map};function Qv(t){Ye.defaultplayer=t}function vd(t){const e=[Sd(void 0,void 0)];return Ye.frames.set(t,e),e}function Zv(t,e,n){const r=Yi(t);y(r)&&r.push(Sd(e,n))}function eR(t,e,n){const r=Yi(t);y(r)&&r.push(Jv(e,n))}function Yi(t){return Ye.frames.get(t)??vd(t)}function tR(){return[...Ye.books.values()]}function an(t){const e=t.toLowerCase();return Ye.books.get(t)??[...Ye.books.values()].find(n=>n.name.toLowerCase()===e)}function nR(t){return Ye.books.clear(),Ye.books.set(t.id,t),t.id}function yc(t){return Ye.books.set(t.id,t),t.id}function z(t){let e=Ye.chips.get(t);return y(e)||(e={book:void 0,board:void 0,object:void 0,terrain:void 0,charset:void 0,palette:void 0,player:Ye.defaultplayer,inputqueue:new Set,inputmods:{[pe.NONE]:0,[pe.MOVE_UP]:0,[pe.MOVE_DOWN]:0,[pe.MOVE_LEFT]:0,[pe.MOVE_RIGHT]:0,[pe.OK_BUTTON]:0,[pe.CANCEL_BUTTON]:0,[pe.MENU_BUTTON]:0},inputcurrent:void 0},Ye.chips.set(t,e)),e}function I(t,e){const n=z(t.id());return Ky(n,e,t.get)}const qi="main",Ec="player",_c="title";function rR(t){if(!te(t)||!t)return bn("memory","login",`failed for playerid ==>${t}<==`,t);const e=an(qi);if(!y(e))return bn("memory","login",`login failed to find book ${qi}`,t);const n=Rr(e,_c);if(!y(n))return bn("memory","login",`login failed to find board ${_c}`,t);const r=Vi(e,Ec);if(!y(r))return bn("memory","login",`login failed to find object type ${Ec}`,t);const s=eu(n,{id:t,x:0,y:0,kind:Ec,stats:{player:t}});return y(s==null?void 0:s.id)&&Hv(e,t,_c),!0}function sR(t){Ye.books.forEach(e=>ta(bd(e,t),t))}function iR(t,e){const n=an(qi);Vv(n).forEach(r=>{var i,o;const s=Xv(n,r,e);for(let a=0;a<s.length;++a){const c=s[a],l=z(c.id);l.book=n,l.board=r,l.object=c.object,l.inputcurrent=void 0,l.player=((o=(i=c.object)==null?void 0:i.stats)==null?void 0:o.player)??"",t.tick(c.id,c.type,e,c.code)}})}function oR(t,e,n,r){const s=`${n}_cli`,i=z(s);i.player=n,i.book=void 0,i.board=void 0,i.inputcurrent=void 0,Jl("memory","running",e,s,r),t.once(s,le.CLI,e,r)}function aR(t,e,n,r,s,i){const o=[];let a=e;const c=a===0,l=r.width??0,u=r.height??0,h=c?Te.BLACK:Te.CLEAR,d=uy(t,a++,l,u,h);o.push(d);const f=dy(t,a++,l,u);o.push(f);const p=a++,E=fy(t,p);o.push(E);const A=py(t,a++);s&&o.push(A),r.terrain.forEach((_,m)=>{if(_){const g=Ft(n,_);d.char[m]=_.char??(g==null?void 0:g.char)??0,d.color[m]=_.color??(g==null?void 0:g.color)??h,d.bg[m]=_.bg??(g==null?void 0:g.bg)??h,d.color[m]!==Te.CLEAR&&(i[m]=d.color[m])}});const S=r.objects??{};Object.values(S).forEach(_=>{if(y(_.removed)||y(_.headless))return;const m=_.id??"",g=Ft(n,_),T=hy(t,p,m),v=_.lx??_.x??0,K=_.ly??_.y??0,fe=v+K*r.width;T.x=_.x??0,T.y=_.y??0,T.char=_.char??(g==null?void 0:g.char)??1,T.color=_.color??(g==null?void 0:g.color)??Te.WHITE,T.bg=_.bg??(g==null?void 0:g.bg)??Te.BORROW,E.sprites.push(T),T.bg===Te.SHADOW&&(T.bg=Te.CLEAR,f.alphas[v+K*l]=.5),T.bg===Te.BORROW&&(T.bg=i[fe]??Te.BLACK),T.color!==Te.CLEAR&&(i[fe]=T.color),m===t&&(A.focusx=T.x,A.focusy=T.y,A.focusid=m)});function b(_,m){if(!(_<0||_>=r.width||m<0||m>=r.height))return f.alphas[_+m*r.width]}const w=[[1,1,1,1,1],[1,3,5,3,1],[1,5,12,5,1],[1,3,5,3,1],[1,1,1,1,1]].flat(),O=new Array(f.alphas.length);for(let _=0;_<f.alphas.length;++_){const m=_%r.width,g=Math.floor(_/r.width),T=[[b(m-2,g-2),b(m-1,g-2),b(m,g-2),b(m+1,g-2),b(m+2,g-2)],[b(m-2,g-1),b(m-1,g-1),b(m,g-1),b(m+1,g-1),b(m+2,g-1)],[b(m-2,g),b(m-1,g),b(m,g),b(m+1,g),b(m+2,g)],[b(m-2,g+1),b(m-1,g+1),b(m,g+1),b(m+1,g+1),b(m+2,g+1)],[b(m-2,g+2),b(m-1,g+2),b(m,g+2),b(m+1,g+2),b(m+2,g+2)]].flat().map((v,K)=>y(v)?v*w[K]:void 0).filter(y);O[_]=Wn(Ly(T),0,1)}return f.alphas=O,o}function Rd(t){switch(t.type){case gs.EDIT:return 1;case gs.VIEW:return 2}return 0}function cR(t){const e=an(qi),n=bd(e,t),r=[];if(!y(e)||!y(n))return r;let s=0;const i=[...Yi(n.id??"")],o=new Array(n.width*n.height).fill(0);return i.sort((a,c)=>Rd(a)-Rd(c)),i.forEach(a=>{const c=an(a.book??"")??e,l=Rr(c,a.board??"")??n;if(y(c)&&y(l)){const u=aR(t,s,c,l,a.type===gs.VIEW,o);s+=u.length,r.push(...u)}}),r}var Od={exports:{}},wc={exports:{}},kd;function lR(){return kd||(kd=1,function(t,e){(function(n,r){t.exports=r()})(Ze,function(){function n(E){return!isNaN(parseFloat(E))&&isFinite(E)}function r(E){return E.charAt(0).toUpperCase()+E.substring(1)}function s(E){return function(){return this[E]}}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=i.concat(o,a,c,l);function h(E){if(E)for(var A=0;A<u.length;A++)E[u[A]]!==void 0&&this["set"+r(u[A])](E[u[A]])}h.prototype={getArgs:function(){return this.args},setArgs:function(E){if(Object.prototype.toString.call(E)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=E},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(E){if(E instanceof h)this.evalOrigin=E;else if(E instanceof Object)this.evalOrigin=new h(E);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var E=this.getFileName()||"",A=this.getLineNumber()||"",S=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?E?"[eval] ("+E+":"+A+":"+S+")":"[eval]:"+A+":"+S:b?b+" ("+E+":"+A+":"+S+")":E+":"+A+":"+S}},h.fromString=function(A){var S=A.indexOf("("),b=A.lastIndexOf(")"),w=A.substring(0,S),O=A.substring(S+1,b).split(","),_=A.substring(b+1);if(_.indexOf("@")===0)var m=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(_,""),g=m[1],T=m[2],v=m[3];return new h({functionName:w,args:O||void 0,fileName:g,lineNumber:T||void 0,columnNumber:v||void 0})};for(var d=0;d<i.length;d++)h.prototype["get"+r(i[d])]=s(i[d]),h.prototype["set"+r(i[d])]=function(E){return function(A){this[E]=!!A}}(i[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=s(o[f]),h.prototype["set"+r(o[f])]=function(E){return function(A){if(!n(A))throw new TypeError(E+" must be a Number");this[E]=Number(A)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=s(a[p]),h.prototype["set"+r(a[p])]=function(E){return function(A){this[E]=String(A)}}(a[p]);return h})}(wc)),wc.exports}(function(t,e){(function(n,r){t.exports=r(lR())})(Ze,function(r){var s=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(i))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,E=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:E,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,E;f.match(/\(([^)]*)\)/)&&(E=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var A=E===void 0||E==="[arguments not available]"?void 0:E.split(",");return new r({functionName:p,args:A,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Od);var uR=Od.exports,hR=qs(uR),Nd={},Cd={},Id={};const Ld="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Id.encode=function(t){if(0<=t&&t<Ld.length)return Ld[t];throw new TypeError("Must be between 0 and 63: "+t)};const fR=Id,Md=5,xd=1<<Md,dR=xd-1,pR=xd;function gR(t){return t<0?(-t<<1)+1:(t<<1)+0}Cd.encode=function(e){let n="",r,s=gR(e);do r=s&dR,s>>>=Md,s>0&&(r|=pR),n+=fR.encode(r);while(s>0);return n};var ms={};(function(t){function e(m,g,T){if(g in m)return m[g];if(arguments.length===3)return T;throw new Error('"'+g+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function s(m){const g=m.match(n);return g?{scheme:g[1],auth:g[2],host:g[3],port:g[4],path:g[5]}:null}t.urlParse=s;function i(m){let g="";return m.scheme&&(g+=m.scheme+":"),g+="//",m.auth&&(g+=m.auth+"@"),m.host&&(g+=m.host),m.port&&(g+=":"+m.port),m.path&&(g+=m.path),g}t.urlGenerate=i;const o=32;function a(m){const g=[];return function(T){for(let K=0;K<g.length;K++)if(g[K].input===T){const fe=g[0];return g[0]=g[K],g[K]=fe,g[0].result}const v=m(T);return g.unshift({input:T,result:v}),g.length>o&&g.pop(),v}}const c=a(function(g){let T=g;const v=s(g);if(v){if(!v.path)return g;T=v.path}const K=t.isAbsolute(T),fe=[];let Wr=0,ve=0;for(;;)if(Wr=ve,ve=T.indexOf("/",Wr),ve===-1){fe.push(T.slice(Wr));break}else for(fe.push(T.slice(Wr,ve));ve<T.length&&T[ve]==="/";)ve++;let qt=0;for(ve=fe.length-1;ve>=0;ve--){const pt=fe[ve];pt==="."?fe.splice(ve,1):pt===".."?qt++:qt>0&&(pt===""?(fe.splice(ve+1,qt),qt=0):(fe.splice(ve,2),qt--))}return T=fe.join("/"),T===""&&(T=K?"/":"."),v?(v.path=T,i(v)):T});t.normalize=c;function l(m,g){m===""&&(m="."),g===""&&(g=".");const T=s(g),v=s(m);if(v&&(m=v.path||"/"),T&&!T.scheme)return v&&(T.scheme=v.scheme),i(T);if(T||g.match(r))return g;if(v&&!v.host&&!v.path)return v.host=g,i(v);const K=g.charAt(0)==="/"?g:c(m.replace(/\/+$/,"")+"/"+g);return v?(v.path=K,i(v)):K}t.join=l,t.isAbsolute=function(m){return m.charAt(0)==="/"||n.test(m)};function u(m,g){m===""&&(m="."),m=m.replace(/\/$/,"");let T=0;for(;g.indexOf(m+"/")!==0;){const v=m.lastIndexOf("/");if(v<0||(m=m.slice(0,v),m.match(/^([^\/]+:\/)?\/*$/)))return g;++T}return Array(T+1).join("../")+g.substr(m.length+1)}t.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(m){return m}function f(m){return E(m)?"$"+m:m}t.toSetString=h?d:f;function p(m){return E(m)?m.slice(1):m}t.fromSetString=h?d:p;function E(m){if(!m)return!1;const g=m.length;if(g<9||m.charCodeAt(g-1)!==95||m.charCodeAt(g-2)!==95||m.charCodeAt(g-3)!==111||m.charCodeAt(g-4)!==116||m.charCodeAt(g-5)!==111||m.charCodeAt(g-6)!==114||m.charCodeAt(g-7)!==112||m.charCodeAt(g-8)!==95||m.charCodeAt(g-9)!==95)return!1;for(let T=g-10;T>=0;T--)if(m.charCodeAt(T)!==36)return!1;return!0}function A(m,g,T){let v=b(m.source,g.source);return v!==0||(v=m.originalLine-g.originalLine,v!==0)||(v=m.originalColumn-g.originalColumn,v!==0||T)||(v=m.generatedColumn-g.generatedColumn,v!==0)||(v=m.generatedLine-g.generatedLine,v!==0)?v:b(m.name,g.name)}t.compareByOriginalPositions=A;function S(m,g,T){let v=m.generatedLine-g.generatedLine;return v!==0||(v=m.generatedColumn-g.generatedColumn,v!==0||T)||(v=b(m.source,g.source),v!==0)||(v=m.originalLine-g.originalLine,v!==0)||(v=m.originalColumn-g.originalColumn,v!==0)?v:b(m.name,g.name)}t.compareByGeneratedPositionsDeflated=S;function b(m,g){return m===g?0:m===null?1:g===null?-1:m>g?1:-1}function w(m,g){let T=m.generatedLine-g.generatedLine;return T!==0||(T=m.generatedColumn-g.generatedColumn,T!==0)||(T=b(m.source,g.source),T!==0)||(T=m.originalLine-g.originalLine,T!==0)||(T=m.originalColumn-g.originalColumn,T!==0)?T:b(m.name,g.name)}t.compareByGeneratedPositionsInflated=w;function O(m){return JSON.parse(m.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=O;function _(m,g,T){if(g=g||"",m&&(m[m.length-1]!=="/"&&g[0]!=="/"&&(m+="/"),g=m+g),T){const v=s(T);if(!v)throw new Error("sourceMapURL could not be parsed");if(v.path){const K=v.path.lastIndexOf("/");K>=0&&(v.path=v.path.substring(0,K+1))}g=l(i(v),g)}return c(g)}t.computeSourceURL=_})(ms);var Tc={};let mR=class km{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new km;for(let s=0,i=e.length;s<i;s++)r.add(e[s],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),s=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,s)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};Tc.ArraySet=mR;var Ud={};const Pd=ms;function yR(t,e){const n=t.generatedLine,r=e.generatedLine,s=t.generatedColumn,i=e.generatedColumn;return r>n||r==n&&i>=s||Pd.compareByGeneratedPositionsInflated(t,e)<=0}let ER=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){yR(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(Pd.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Ud.MappingList=ER;const ys=Cd,de=ms,Xi=Tc.ArraySet,_R=Ud.MappingList;let Dd=class Nm{constructor(e){e||(e={}),this._file=de.getArg(e,"file",null),this._sourceRoot=de.getArg(e,"sourceRoot",null),this._skipValidation=de.getArg(e,"skipValidation",!1),this._sources=new Xi,this._names=new Xi,this._mappings=new _R,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new Nm({file:e.file,sourceRoot:n});return e.eachMapping(function(s){const i={generated:{line:s.generatedLine,column:s.generatedColumn}};s.source!=null&&(i.source=s.source,n!=null&&(i.source=de.relative(n,i.source)),i.original={line:s.originalLine,column:s.originalColumn},s.name!=null&&(i.name=s.name)),r.addMapping(i)}),e.sources.forEach(function(s){let i=s;n!==null&&(i=de.relative(n,s)),r._sources.has(i)||r._sources.add(i);const o=e.sourceContentFor(s);o!=null&&r.setSourceContent(s,o)}),r}addMapping(e){const n=de.getArg(e,"generated"),r=de.getArg(e,"original",null);let s=de.getArg(e,"source",null),i=de.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,s,i),s!=null&&(s=String(s),this._sources.has(s)||this._sources.add(s)),i!=null&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:s,name:i})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=de.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[de.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[de.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let s=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);s=e.file}const i=this._sourceRoot;i!=null&&(s=de.relative(i,s));const o=this._mappings.toArray().length>0?new Xi:this._sources,a=new Xi;this._mappings.unsortedForEach(function(c){if(c.source===s&&c.originalLine!=null){const h=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=de.join(r,c.source)),i!=null&&(c.source=de.relative(i,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=de.join(r,c)),i!=null&&(c=de.relative(i,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,s){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!s)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:s}))}}_serializeMappings(){let e=0,n=1,r=0,s=0,i=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!de.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=ys.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=ys.encode(h-o),o=h,c+=ys.encode(l.originalLine-1-s),s=l.originalLine-1,c+=ys.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=ys.encode(u-i),i=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=de.relative(n,r));const s=de.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,s)?this._sourcesContents[s]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};Dd.prototype._version=3,Nd.SourceMapGenerator=Dd;var $d={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,s,i,o,a){const c=Math.floor((r-n)/2)+n,l=o(s,i[c],!0);return l===0?c:l>0?r-c>1?e(c,r,s,i,o,a):a==t.LEAST_UPPER_BOUND?r<i.length?r:-1:c:c-n>1?e(n,c,s,i,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,s,i,o){if(s.length===0)return-1;let a=e(-1,s.length,r,s,i,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&i(s[a],s[a-1],!0)===0;)--a;return a}})($d);var Es={exports:{}},wR={},TR=Object.freeze({__proto__:null,default:wR}),Fd=Cm(TR);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;Es.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Es.exports.initialize=e=>t=e}else{const t=Fd,e=Fd;Es.exports=function(){return new Promise((r,s)=>{const i=e.join(__dirname,"mappings.wasm");t.readFile(i,null,(o,a)=>{if(o){s(o);return}r(a.buffer)})})},Es.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Bd=Es.exports;const bR=Bd;function AR(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let _s=null;var SR=function(){if(_s)return _s;const e=[];return _s=bR().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,s,i,o,a,c,l,u,h,d){const f=new AR;f.generatedLine=r+1,f.generatedColumn=s,i&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),e[e.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,s)=>{e.push(r);try{s()}finally{e.pop()}}})).then(null,n=>{throw _s=null,n}),_s};const C=ms,bc=$d,Ji=Tc.ArraySet,vR=Bd,RR=SR,Ac=Symbol("smcInternal");class ue{constructor(e,n){return e==Ac?Promise.resolve(this):kR(e,n)}static initialize(e){vR.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return NR(e,n)}static async with(e,n,r){const s=await new ue(e,n);try{return await r(s)}finally{s.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ue.prototype._version=3,ue.GENERATED_ORDER=1,ue.ORIGINAL_ORDER=2,ue.GREATEST_LOWER_BOUND=1,ue.LEAST_UPPER_BOUND=2;class ws extends ue{constructor(e,n){return super(Ac).then(r=>{let s=e;typeof e=="string"&&(s=C.parseSourceMapInput(e));const i=C.getArg(s,"version");let o=C.getArg(s,"sources");const a=C.getArg(s,"names",[]);let c=C.getArg(s,"sourceRoot",null);const l=C.getArg(s,"sourcesContent",null),u=C.getArg(s,"mappings"),h=C.getArg(s,"file",null);if(i!=r._version)throw new Error("Unsupported version: "+i);return c&&(c=C.normalize(c)),o=o.map(String).map(C.normalize).map(function(d){return c&&C.isAbsolute(c)&&C.isAbsolute(d)?C.relative(c,d):d}),r._names=Ji.fromArray(a.map(String),!0),r._sources=Ji.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return C.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,RR().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=C.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new ws(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,s=this._wasm.exports.allocate_mappings(r),i=new Uint8Array(this._wasm.exports.memory.buffer,s,r);for(let a=0;a<r;a++)i[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(s);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const s=n||null,i=r||ue.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=C.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(s,a)},()=>{switch(i){case ue.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ue.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=C.getArg(e,"source");const r=C.getArg(e,"line"),s=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(s<0)throw new Error("Column numbers must be >= 0");const i=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),i.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,s)}),i}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:C.getArg(e,"line"),generatedColumn:C.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=C.getArg(e,"bias",ue.GREATEST_LOWER_BOUND);r==null&&(r=ue.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(i=>s=i,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),s&&s.generatedLine===n.generatedLine){let i=C.getArg(s,"source",null);i!==null&&(i=this._sources.at(i),i=C.computeSourceURL(this.sourceRoot,i,this._sourceMapURL));let o=C.getArg(s,"name",null);return o!==null&&(o=this._names.at(o)),{source:i,line:C.getArg(s,"originalLine",null),column:C.getArg(s,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let s=e;this.sourceRoot!=null&&(s=C.relative(this.sourceRoot,s));let i;if(this.sourceRoot!=null&&(i=C.urlParse(this.sourceRoot))){const o=s.replace(/^file:\/\//,"");if(i.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!i.path||i.path=="/")&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(n)return null;throw new Error('"'+s+'" is not in the SourceMap.')}generatedPositionFor(e){let n=C.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:C.getArg(e,"line"),originalColumn:C.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let s=C.getArg(e,"bias",ue.GREATEST_LOWER_BOUND);s==null&&(s=ue.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(o=>i=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,s)}),i&&i.source===r.source){let o=i.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:C.getArg(i,"generatedLine",null),column:C.getArg(i,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}ws.prototype.consumer=ue;class OR extends ue{constructor(e,n){return super(Ac).then(r=>{let s=e;typeof e=="string"&&(s=C.parseSourceMapInput(e));const i=C.getArg(s,"version"),o=C.getArg(s,"sections");if(i!=r._version)throw new Error("Unsupported version: "+i);r._sources=new Ji,r._names=new Ji,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=C.getArg(c,"offset"),u=C.getArg(l,"line"),h=C.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ue(C.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(C.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(C.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:C.getArg(e,"line"),generatedColumn:C.getArg(e,"column")},r=bc.search(n,this._sections,function(i,o){const a=i.generatedLine-o.generatedOffset.generatedLine;return a||i.generatedColumn-o.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:n.generatedLine-(s.generatedOffset.generatedLine-1),column:n.generatedColumn-(s.generatedOffset.generatedLine===n.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const i=this._sections[r].consumer.sourceContentFor(e,!0);if(i)return i}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(C.getArg(e,"source"))===-1)continue;const s=r.consumer.generatedPositionFor(e);if(s)return{line:s.line+(r.generatedOffset.generatedLine-1),column:s.column+(r.generatedOffset.generatedLine===s.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],s=this.__originalMappingsUnsorted=[];for(let i=0;i<this._sections.length;i++){const o=this._sections[i],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=C.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&s.push(d)}}}eachMapping(e,n,r){const s=n||null,i=r||ue.GENERATED_ORDER;let o;switch(i){case ue.GENERATED_ORDER:o=this._generatedMappings;break;case ue.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=C.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,s)}_findMapping(e,n,r,s,i,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[s]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[s]);return bc.search(e,n,i,o)}allGeneratedPositionsFor(e){const n=C.getArg(e,"line"),r={source:C.getArg(e,"source"),originalLine:n,originalColumn:C.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const s=[];let i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",C.compareByOriginalPositions,bc.LEAST_UPPER_BOUND);if(i>=0){let o=this._originalMappings[i];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:C.getArg(o,"generatedLine",null),column:C.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:C.getArg(o,"generatedLine",null),column:C.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}}return s}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function kR(t,e){let n=t;typeof t=="string"&&(n=C.parseSourceMapInput(t));const r=n.sections!=null?new OR(n,e):new ws(n,e);return Promise.resolve(r)}function NR(t,e){return ws.fromSourceMap(t,e)}var jd={};const CR=Nd.SourceMapGenerator,Qi=ms,IR=/(\r?\n)/,LR=10,kr="$$$isSourceNode$$$";let MR=class Bl{constructor(e,n,r,s,i){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=i??null,this[kr]=!0,s!=null&&this.add(s)}static fromStringWithSourceMap(e,n,r){const s=new Bl,i=e.split(IR);let o=0;const a=function(){const f=E(),p=E()||"";return f+p;function E(){return o<i.length?i[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=i[o]||"";const p=h.substr(0,f.generatedColumn-l);i[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)s.add(a()),c++;l<f.generatedColumn&&(h=i[o]||"",s.add(h.substr(0,f.generatedColumn)),i[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<i.length&&(u&&d(u,a()),s.add(i.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=Qi.join(r,f)),s.setSourceContent(f,p))}),s;function d(f,p){if(f===null||f.source===void 0)s.add(p);else{const E=r?Qi.join(r,f.source):f.source;s.add(new Bl(f.originalLine,f.originalColumn,E,p,f.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[kr]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[kr]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,s=this.children.length;r<s;r++)n=this.children[r],n[kr]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const s=this.children.length;if(s>0){for(n=[],r=0;r<s-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[kr]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[Qi.toSetString(e)]=n}walkSourceContents(e){for(let r=0,s=this.children.length;r<s;r++)this.children[r][kr]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,s=n.length;r<s;r++)e(Qi.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new CR(e);let s=!1,i=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((i!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),i=u.source,o=u.line,a=u.column,c=u.name,s=!0):s&&(r.addMapping({generated:{line:n.line,column:n.column}}),i=null,s=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===LR?(n.line++,n.column=0,h+1===d?(i=null,s=!1):s&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};jd.SourceNode=MR;var xR=jd.SourceNode,Gd={exports:{}},B={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ts=Symbol.for("react.element"),UR=Symbol.for("react.portal"),PR=Symbol.for("react.fragment"),DR=Symbol.for("react.strict_mode"),$R=Symbol.for("react.profiler"),FR=Symbol.for("react.provider"),BR=Symbol.for("react.context"),jR=Symbol.for("react.forward_ref"),GR=Symbol.for("react.suspense"),KR=Symbol.for("react.memo"),WR=Symbol.for("react.lazy"),Kd=Symbol.iterator;function HR(t){return t===null||typeof t!="object"?null:(t=Kd&&t[Kd]||t["@@iterator"],typeof t=="function"?t:null)}var Wd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Hd=Object.assign,Vd={};function Nr(t,e,n){this.props=t,this.context=e,this.refs=Vd,this.updater=n||Wd}Nr.prototype.isReactComponent={},Nr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},Nr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function zd(){}zd.prototype=Nr.prototype;function Sc(t,e,n){this.props=t,this.context=e,this.refs=Vd,this.updater=n||Wd}var vc=Sc.prototype=new zd;vc.constructor=Sc,Hd(vc,Nr.prototype),vc.isPureReactComponent=!0;var Yd=Array.isArray,qd=Object.prototype.hasOwnProperty,Rc={current:null},Xd={key:!0,ref:!0,__self:!0,__source:!0};function Jd(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)qd.call(e,r)&&!Xd.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Ts,type:t,key:i,ref:o,props:s,_owner:Rc.current}}function VR(t,e){return{$$typeof:Ts,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Oc(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ts}function zR(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Qd=/\/+/g;function kc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?zR(""+t.key):e.toString(36)}function Zi(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ts:case UR:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+kc(o,0):r,Yd(s)?(n="",t!=null&&(n=t.replace(Qd,"$&/")+"/"),Zi(s,e,n,"",function(l){return l})):s!=null&&(Oc(s)&&(s=VR(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Qd,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Yd(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+kc(i,a);o+=Zi(i,e,n,c,s)}else if(c=HR(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+kc(i,a++),o+=Zi(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function eo(t,e,n){if(t==null)return t;var r=[],s=0;return Zi(t,r,"","",function(i){return e.call(n,i,s++)}),r}function YR(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var De={current:null},to={transition:null},qR={ReactCurrentDispatcher:De,ReactCurrentBatchConfig:to,ReactCurrentOwner:Rc};function Zd(){throw Error("act(...) is not supported in production builds of React.")}B.Children={map:eo,forEach:function(t,e,n){eo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return eo(t,function(){e++}),e},toArray:function(t){return eo(t,function(e){return e})||[]},only:function(t){if(!Oc(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},B.Component=Nr,B.Fragment=PR,B.Profiler=$R,B.PureComponent=Sc,B.StrictMode=DR,B.Suspense=GR,B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qR,B.act=Zd,B.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Hd({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Rc.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)qd.call(e,c)&&!Xd.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Ts,type:t.type,key:s,ref:i,props:r,_owner:o}},B.createContext=function(t){return t={$$typeof:BR,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:FR,_context:t},t.Consumer=t},B.createElement=Jd,B.createFactory=function(t){var e=Jd.bind(null,t);return e.type=t,e},B.createRef=function(){return{current:null}},B.forwardRef=function(t){return{$$typeof:jR,render:t}},B.isValidElement=Oc,B.lazy=function(t){return{$$typeof:WR,_payload:{_status:-1,_result:t},_init:YR}},B.memo=function(t,e){return{$$typeof:KR,type:t,compare:e===void 0?null:e}},B.startTransition=function(t){var e=to.transition;to.transition={};try{t()}finally{to.transition=e}},B.unstable_act=Zd,B.useCallback=function(t,e){return De.current.useCallback(t,e)},B.useContext=function(t){return De.current.useContext(t)},B.useDebugValue=function(){},B.useDeferredValue=function(t){return De.current.useDeferredValue(t)},B.useEffect=function(t,e){return De.current.useEffect(t,e)},B.useId=function(){return De.current.useId()},B.useImperativeHandle=function(t,e,n){return De.current.useImperativeHandle(t,e,n)},B.useInsertionEffect=function(t,e){return De.current.useInsertionEffect(t,e)},B.useLayoutEffect=function(t,e){return De.current.useLayoutEffect(t,e)},B.useMemo=function(t,e){return De.current.useMemo(t,e)},B.useReducer=function(t,e,n){return De.current.useReducer(t,e,n)},B.useRef=function(t){return De.current.useRef(t)},B.useState=function(t){return De.current.useState(t)},B.useSyncExternalStore=function(t,e,n){return De.current.useSyncExternalStore(t,e,n)},B.useTransition=function(){return De.current.useTransition()},B.version="18.3.1",Gd.exports=B;var XR=Gd.exports;const JR=Jo(32,126).map(t=>String.fromCharCode(t)),QR=U({name:"Whitespace",pattern:/ +/}),ZR=U({name:"WhitespaceSkipped",pattern:/ +/,group:be.SKIPPED}),ep=U({name:"StringLiteral",pattern:/[^ $;]+/,start_chars_hint:JR}),tp=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),np=U({name:"EscapedDollar",pattern:"$$"}),Nc=U({name:"MaybeFlag",pattern:/\$[^ $]+/}),rp=U({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),sp=U({name:"HyperLinkText",pattern:/;[^;\n]*/,start_chars_hint:[";"]});function eO(t,e=""){return U({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const ip=Object.keys(sa).map(t=>eO(`\\$(${t})`,t)),tO=[QR,...ip,tp,ep,rp,np,sp,Nc],nO=new be(tO,{skipValidations:!$t,ensureOptimizations:$t}),rO=new be([ZR,...ip,tp,ep,rp,np,sp,Nc],{skipValidations:!$t,ensureOptimizations:$t});function sO(t,e=!1){return e?rO.tokenize(t):nO.tokenize(t)}function iO(t,e,n,r){return{disablewrap:!1,measureonly:!1,measuredwidth:0,x:0,y:0,isEven:!0,resetColor:n,resetBg:r,activeColor:n,activeBg:r,width:t,height:e,leftEdge:void 0,rightEdge:void 0,bottomEdge:void 0,char:[],color:[],bg:[]}}XR.createContext(iO(1,1,15,1));let oO=0,op=0;const ap=$t,aO=["Command","lines"];class cO extends xv{constructor(){super(gd,{traceInitPerf:$t,skipValidations:!$t,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});P(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));P(this,"line",this.RULED("line",()=>{this.OPTION(()=>this.SUBRULE(this.stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(ds))}));P(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stat)},{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.label)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));P(this,"stat",this.RULED("stat",()=>{this.CONSUME(ec)}));P(this,"text",this.RULED("text",()=>{this.CONSUME($f)}));P(this,"label",this.RULED("label",()=>{this.CONSUME(Bf)}));P(this,"comment",this.RULED("comment",()=>{this.CONSUME(Ff)}));P(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>{this.CONSUME(At),this.AT_LEAST_ONE1(()=>this.SUBRULE1(this.command))}},{ALT:()=>{this.AT_LEAST_ONE2(()=>this.SUBRULE2(this.command))}}])}));P(this,"command",this.RULED("command",()=>{this.OR([{ALT:()=>this.SUBRULE(this.flat_cmd)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));P(this,"flat_cmd",this.RULED("flat_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.hyperlink)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)},{ALT:()=>this.SUBRULE(this.Command_play)}])}));P(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.Command_if)},{ALT:()=>this.SUBRULE(this.Command_read)},{ALT:()=>this.SUBRULE(this.Command_while)},{ALT:()=>this.SUBRULE(this.Command_repeat)},{ALT:()=>this.SUBRULE(this.Command_break)},{ALT:()=>this.SUBRULE(this.Command_continue)}])}));P(this,"hyperlink",this.RULED("hyperlink",()=>{this.CONSUME(jf),this.SUBRULE(this.words),this.CONSUME(Gf)}));P(this,"Short_go",this.RULED("Short_go",()=>{this.CONSUME(oc),this.SUBRULE(this.words)}));P(this,"Short_try",this.RULED("Short_try",()=>{this.CONSUME(td),this.SUBRULE(this.words)}));P(this,"Command_play",this.RULED("Command_play",()=>{this.CONSUME(sd)}));P(this,"do_line",this.RULED("do_line",()=>{this.OPTION(()=>this.SUBRULE(this.do_stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(ds))}));P(this,"do_stmt",this.RULED("do_stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));P(this,"Command_if",this.RULED("Command_if",()=>{this.CONSUME(ac),this.SUBRULE(this.words),this.OPTION(()=>this.CONSUME(er)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Zn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else_if",this.RULED("Command_else_if",()=>{this.CONSUME(At),this.CONSUME(cc),this.CONSUME(ac),this.SUBRULE(this.words),this.OPTION(()=>this.CONSUME(er)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Zn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else",this.RULED("Command_else",()=>{this.CONSUME(At),this.CONSUME(cc),this.OPTION(()=>this.CONSUME(er)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Zn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.SUBRULE(this.Command_endif)}}])})}));P(this,"Command_endif",this.RULED("Command_endif",()=>{this.CONSUME(At),this.CONSUME(id)}));P(this,"Command_while",this.RULED("Command_while",()=>{this.CONSUME(At),this.CONSUME(od),this.SUBRULE(this.words),this.OPTION(()=>this.CONSUME(er)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Zn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(At),this.CONSUME4(ad)}}])})}));P(this,"Command_repeat",this.RULED("Command_repeat",()=>{this.CONSUME(At),this.CONSUME(cd),this.SUBRULE(this.words),this.OPTION(()=>this.CONSUME(er)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Zn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(At),this.CONSUME4(ld)}}])})}));P(this,"Command_read_flags",this.RULED("Command_read_flags",()=>{this.AT_LEAST_ONE(()=>this.CONSUME(Ge))}));P(this,"Command_read",this.RULED("Command_read",()=>{this.CONSUME(At),this.CONSUME(lc),this.SUBRULE(this.words),this.CONSUME(ud),this.SUBRULE(this.Command_read_flags),this.OPTION(()=>this.CONSUME(er)),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Zn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(At),this.CONSUME4(hd)}}])})}));P(this,"Command_break",this.RULED("Command_break",()=>{this.CONSUME(fd)}));P(this,"Command_continue",this.RULED("Command_continue",()=>{this.CONSUME(dd)}));P(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(tc),this.SUBRULE2(this.and_test)})}));P(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(rc),this.SUBRULE2(this.not_test)})}));P(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(nc),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));P(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));P(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Hf)},{ALT:()=>this.CONSUME(Vf)},{ALT:()=>this.CONSUME(zf)},{ALT:()=>this.CONSUME(Yf)},{ALT:()=>this.CONSUME(qf)},{ALT:()=>this.CONSUME(Xf)}])}));P(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(tc),this.SUBRULE2(this.and_test_value)})}));P(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(rc),this.SUBRULE2(this.not_test_value)})}));P(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(nc),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));P(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));P(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(sc)},{ALT:()=>this.CONSUME(ic)}]),this.SUBRULE(this.term)}));P(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));P(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Qf)},{ALT:()=>this.CONSUME(oc)},{ALT:()=>this.CONSUME(Zf)},{ALT:()=>this.CONSUME(ed)}]),this.SUBRULE(this.factor)}));P(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(sc)},{ALT:()=>this.CONSUME(ic)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));P(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Jf),this.SUBRULE(this.factor)})}));P(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));P(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Kf)},{ALT:()=>this.CONSUME(Ge)},{ALT:()=>this.CONSUME(Wf)},{ALT:()=>this.CONSUME(lc)},{ALT:()=>{this.CONSUME(nd),this.SUBRULE(this.expr),this.CONSUME(rd)}}])}));this.performSelfAnalysis()}PEEK(n,r,...s){console.info(n,s.map(i=>[i.image,i.tokenType]),r)}RULED(n,r,s){const i=aO.some(o=>n.includes(o));return this.RULE(n,()=>{const o=oO++,a=op++,c=a.toString().padStart(3),l=" ".repeat(a),u=i?"font-weight: bold;":"";if(ap&&!this.RECORDING_PHASE){const d=[this.LA(0),this.LA(1),this.LA(2)].map(f=>[`[${f.tokenType.name}]`,f.image.replaceAll(`
`,"\\n")]).flat();console.info(`${c}%c${l}> ${n} ${o} ${d.join(" ")}`,u)}r(),ap&&!this.RECORDING_PHASE&&console.info(`${c}%c${l}< ${n} ${o}`,u),op--},s)}}const bs=new cO,lO=bs.getBaseCstVisitorConstructor();var J=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.TEXT=1]="TEXT",t[t.LABEL=2]="LABEL",t[t.HYPERLINK=3]="HYPERLINK",t[t.STAT=4]="STAT",t[t.MOVE=5]="MOVE",t[t.COMMAND=6]="COMMAND",t[t.LITERAL=7]="LITERAL",t[t.IF=8]="IF",t[t.ELSE_IF=9]="ELSE_IF",t[t.ELSE=10]="ELSE",t[t.WHILE=11]="WHILE",t[t.BREAK=12]="BREAK",t[t.CONTINUE=13]="CONTINUE",t[t.REPEAT=14]="REPEAT",t[t.READ=15]="READ",t[t.OR=16]="OR",t[t.AND=17]="AND",t[t.NOT=18]="NOT",t[t.COMPARE=19]="COMPARE",t[t.OPERATOR=20]="OPERATOR",t[t.OPERATOR_ITEM=21]="OPERATOR_ITEM",t[t.EXPR=22]="EXPR",t))(J||{}),tr=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(tr||{}),Bt=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(Bt||{}),no=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(no||{});function uC(t){return t}function re(t,e){return((e==null?void 0:e.map(n=>t.visit(n)).filter(n=>n))??[]).flat()}function cn(t){return t.image}function cp(t,e){return D(t,{type:7,literal:1,value:e})}function uO(t){return!!(t!=null&&t.tokenType)}function hO(t){const e=Object.values(t).flat().filter(n=>!!n).map(n=>n&&uO(n)?{startLine:n.startLine,startColumn:n.startColumn,startOffset:n.startOffset,endLine:n.endLine,endColumn:n.endColumn,endOffset:n.endOffset}:n!=null&&n.location?{...n.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(n=>n.startLine!==0&&n.endLine!==0);return{startLine:Math.min(...e.map(n=>n.startLine??1)),startColumn:Math.min(...e.map(n=>n.startColumn??1)),startOffset:Math.min(...e.map(n=>n.startOffset??1)),endLine:Math.max(...e.map(n=>n.endLine??1)),endColumn:Math.max(...e.map(n=>n.endColumn??1)),endOffset:Math.max(...e.map(n=>n.endOffset??1))}}function D(t,e){return{...e,...hO(t)}}class fO extends lO{constructor(){super(),$t&&this.validateVisitor()}program(e){return D(e,{type:0,lines:re(this,e.line)})}line(e){if(e.stmt)return this.visit(e.stmt)}stmt(e){if(e.stat)return this.visit(e.stat);if(e.text)return this.visit(e.text);if(e.label)return this.visit(e.label);if(e.comment)return this.visit(e.comment);if(e.commands)return this.visit(e.commands)}stat(e){var n;return D(e,{type:4,value:(n=e.Stat)==null?void 0:n[0].image.slice(1)})}text(e){if(e.Text)return D(e,{type:1,value:cn(e.Text[0])})}label(e){var n;return D(e,{type:2,active:!0,name:cn(((n=e.Label)==null?void 0:n[0])??":").slice(1).trim()})}comment(e){return D(e,{type:2,active:!1,name:cn(e.Comment[0]).slice(1).trim()})}commands(e){return re(this,e.command)}command(e){if(e.flat_cmd)return this.visit(e.flat_cmd);if(e.structured_cmd)return this.visit(e.structured_cmd)}flat_cmd(e){if(e.words)return D(e,{type:6,words:re(this,e.words).flat()});if(e.hyperlink)return this.visit(e.hyperlink);if(e.Short_go)return this.visit(e.Short_go);if(e.Short_try)return this.visit(e.Short_try);if(e.Command_play)return this.visit(e.Command_play)}structured_cmd(e){if(e.Command_if)return this.visit(e.Command_if);if(e.Command_read)return this.visit(e.Command_read);if(e.Command_while)return this.visit(e.Command_while);if(e.Command_repeat)return this.visit(e.Command_repeat);if(e.Command_break)return this.visit(e.Command_break);if(e.Command_continue)return this.visit(e.Command_continue)}hyperlink(e){var n;return D(e,{type:3,link:re(this,e.words).flat(),text:cn(((n=e.HyperLinkText)==null?void 0:n[0])??";").slice(1)})}Short_go(e){if(e.Divide)return D(e,{type:5,wait:!0,words:re(this,e.words).flat()})}Short_try(e){if(e.Query)return D(e,{type:5,wait:!1,words:re(this,e.words).flat()})}Command_play(e){if(e.play)return D(e,{type:6,words:[cp(e,"play"),cp(e,cn(e.play[0]).replace("play","").trim())]})}do_line(e){return this.visit(e.do_stmt)}do_stmt(e){if(e.text)return this.visit(e.text);if(e.comment)return this.visit(e.comment);if(e.commands)return this.visit(e.commands)}Command_if(e){const n=re(this,e.words).flat(),r=[this.visit(e.command),...re(this,e.do_line)].flat(),s=[this.visit(e.Command_else_if),this.visit(e.Command_else)].flat();return D(e,{type:8,method:"if",words:n.filter(y),lines:r.filter(y),branches:s.filter(y)})}Command_else_if(e){const n=re(this,e.words).flat(),r=[this.visit(e.command),...re(this,e.do_line)].flat(),s=re(this,e.Command_else_if).flat();return[D(e,{type:9,method:"if",words:n.filter(y),lines:r.filter(y)}),...s.filter(y),this.visit(e.Command_else)]}Command_else(e){const n=re(this,e.words).flat(),r=[this.visit(e.command),...re(this,e.do_line)].flat();return D(e,{type:10,method:"if",words:n.filter(y),lines:r.filter(y)})}Command_endif(){}Command_while(e){const n=re(this,e.words).flat(),r=[this.visit(e.command),...re(this,e.do_line)].flat();return D(e,{type:11,words:n.filter(y),lines:r.filter(y)})}Command_repeat(e){const n=re(this,e.words).flat(),r=[this.visit(e.command),...re(this,e.do_line)].flat();return D(e,{type:14,words:n.filter(y),lines:r.filter(y)})}Command_read(e){const n=re(this,e.words).flat(),r=[this.visit(e.command),...re(this,e.do_line)].flat();return D(e,{type:15,words:n.filter(y),lines:r.filter(y)})}Command_break(e){return D(e,{type:12})}Command_continue(e){return D(e,{type:13})}expr(e){return e.and_test.length===1?this.visit(e.and_test):D(e,{type:16,items:this.visit(e.and_test)})}and_test(e){return e.not_test.length===1?this.visit(e.not_test):D(e,{type:17,items:this.visit(e.not_test)})}not_test(e){if(e.comparison)return this.visit(e.comparison);if(e.not_test)return D(e,{type:18,items:this.visit(e.not_test)})}comparison(e){return e.arith_expr.length===1?this.visit(e.arith_expr):D(e,{type:19,lhs:this.visit(e.arith_expr[0]),compare:this.visit(e.comp_op),rhs:this.visit(e.arith_expr[1])})}comp_op(e){if(e.is||e.IsEq)return 0;if(e.IsNotEq)return 1;if(e.IsLessThan)return 2;if(e.IsGreaterThan)return 3;if(e.IsLessThanOrEqual)return 4;if(e.IsGreaterThanOrEqual)return 5}expr_value(e){return e.and_test_value.length===1?this.visit(e.and_test_value):D(e,{type:16,items:this.visit(e.and_test_value)})}and_test_value(e){return e.not_test_value.length===1?this.visit(e.not_test_value):D(e,{type:17,items:this.visit(e.not_test_value)})}not_test_value(e){if(e.arith_expr)return this.visit(e.arith_expr);if(e.not_test)return D(e,{type:18,items:this.visit(e.not_test)})}arith_expr(e){const n=this.visit(e.term);return e.arith_expr_item?D(e,{type:20,lhs:n,items:re(this,e.arith_expr_item)}):n}arith_expr_item(e){return D(e,{type:21,operator:e.Plus?1:2,rhs:this.visit(e.term)})}term(e){return e.term_item?D(e,{type:20,lhs:this.visit(e.factor),items:re(this,e.term_item)}):this.visit(e.factor)}term_item(e){let n=0;return e.Multiply&&(n=4),e.Divide&&(n=5),e.ModDivide&&(n=6),e.FloorDivide&&(n=7),D(e,{type:21,operator:n,rhs:this.visit(e.factor)})}factor(e){if(e.power)return this.visit(e.power);let n=0;return e.Plus&&(n=8),e.Minus&&(n=9),D(e,{type:20,lhs:void 0,items:[D(e,{type:21,operator:n,rhs:this.visit(e.factor)})]})}power(e){const n=this.visit(e.token);return e.factor?D(e,{type:20,lhs:n,items:[D(e,{type:21,operator:3,rhs:this.visit(e.factor)})]}):n}words(e){return re(this,e.expr)}token(e){if(e.StringLiteralDouble){const n=cn(e.StringLiteralDouble[0]);return D(e,{type:7,literal:2,value:n.substring(1,n.length-1)})}if(e.StringLiteral)return D(e,{type:7,literal:1,value:cn(e.StringLiteral[0])});if(e.NumberLiteral)return D(e,{type:7,literal:0,value:parseFloat(cn(e.NumberLiteral[0]))});if(e.read)return D(e,{type:7,literal:1,value:cn(e.read[0])});if(e.LParen)return D(e,{type:22,words:re(this,e.expr).flat()})}}const dO=new fO,We={internal:0,labels:{},labelIndex:0},As="if (api.hm()) { continue zss; }",Cc=`if (api.sy()) { yield 1; ${As} };`,ro=`yield 1; ${As}`,so="zss.js";function he(t,e){return new xR(t.startLine??1,t.startColumn??1,so,e)}function Ic(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function lp(t){return`'${Ic(t)}'`}function io(t){if(t.startsWith('"'))return io(t.substring(1,t.length-1));const e=sO(t);return e.errors.length?t:`'${e.tokens.map(r=>r.tokenType===Nc?`', api.group('${Ic(r.image.substring(1))}'), '`:Ic(r.image)).join("")}'`}function ln(t){return t.filter(e=>e!==void 0).map(V)}function up(t){return he(t,"")}function pO(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function se(t,e,n){return he(t,[`api.${e}(`,...pO(n,", "),")"])}function gO(t){if(t.type===J.COMPARE)switch(t.compare){case tr.IS_EQ:return se(t,"isEq",[V(t.lhs),V(t.rhs)]);case tr.IS_NOT_EQ:return se(t,"isNotEq",[V(t.lhs),V(t.rhs)]);case tr.IS_LESS_THAN:return se(t,"isLessThan",[V(t.lhs),V(t.rhs)]);case tr.IS_GREATER_THAN:return se(t,"isGreaterThan",[V(t.lhs),V(t.rhs)]);case tr.IS_LESS_THAN_OR_EQ:return se(t,"isLessThanOrEq",[V(t.lhs),V(t.rhs)]);case tr.IS_GREATER_THAN_OR_EQ:return se(t,"isGreaterThanOrEq",[V(t.lhs),V(t.rhs)])}return he(t,"")}function nr(t,e,n,r){return e.prepend(`api.${n}(`),e.add([", ",V(r),")"])}function hp(t,e,n,r){return e.prepend(`api.${n}(`),e.add([V(r),")"])}function mO(t,e){if(t.type===J.OPERATOR_ITEM)switch(t.operator){case Bt.PLUS:return nr(t,e,"opPlus",t.rhs);case Bt.MINUS:return nr(t,e,"opMinus",t.rhs);case Bt.POWER:return nr(t,e,"opPower",t.rhs);case Bt.MULTIPLY:return nr(t,e,"opMultiply",t.rhs);case Bt.DIVIDE:return nr(t,e,"opDivide",t.rhs);case Bt.MOD_DIVIDE:return nr(t,e,"opModDivide",t.rhs);case Bt.FLOOR_DIVIDE:return nr(t,e,"opFloorDivide",t.rhs);case Bt.UNI_PLUS:return hp(t,e,"opUniPlus",t.rhs);case Bt.UNI_MINUS:return hp(t,e,"opUniMinus",t.rhs)}return he(t,"")}function yO(t){if(t.type===J.OPERATOR){const e=t.lhs?V(t.lhs):he(t,"");return t.items.forEach(n=>mO(n,e)),e}return he(t,"")}function V(t){switch(t.type){case J.PROGRAM:return he(t,[`try { // first-line
`,`zss: while (true) {
`,`switch (api.getcase()) {
`,`default:
`,`case 1: 
`,...t.lines.map(e=>[V(e),`
`]).flat(),`}
`,`api.endofprogram();
`,`while(true) { ${ro} }
`,`}
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${so}`]);case J.LITERAL:switch(t.literal){case no.NUMBER:return he(t,`${t.value}`);case no.STRING:return he(t,lp(t.value));case no.TEMPLATE:return he(t,io(t.value))}return up(t);case J.TEXT:return se(t,"text",[io(t.value)]);case J.STAT:return se(t,"stat",[lp(t.value)]);case J.LABEL:{const e=We.labelIndex++;return We.labels[t.name]||(We.labels[t.name]=[]),We.labels[t.name].push(t.active?e:-e),he(t,`case ${e}: // ${t.name}`)}case J.HYPERLINK:return se(t,"hyperlink",[io(t.text),...ln(t.link)]);case J.MOVE:return he(t,["while (",se(t,"move",[t.wait?"true":"false",...ln(t.words)]),`) { ${ro} };
         ${Cc} ${As}`]);case J.COMMAND:return he(t,["while (",se(t,"command",ln(t.words)),`) { ${ro} };
         ${Cc} ${As}`]);case J.IF:{const e=he(t,["if (",se(t,`${t.method}`,ln(t.words)),`) {
`]);return t.lines&&t.lines.forEach(n=>e.add([V(n),`
`])),t.branches&&t.branches.forEach(n=>e.add(V(n))),e.add("}"),e}case J.ELSE_IF:{const e=he(t,["} else if (",se(t,t.method,ln(t.words)),`) {
`]);return t.lines&&t.lines.forEach(n=>e.add([V(n),`
`])),e}case J.ELSE:{const e=he(t,`} else {
`);return t.words.length&&e.add(["while (",se(t,"command",ln(t.words)),`) { ${ro} };`]),t.lines&&t.lines.forEach(n=>e.add([V(n),`
`])),e}case J.WHILE:{const e=he(t,["while (",se(t,"if",ln(t.words)),`) {
`]);return t.lines&&t.lines.forEach(n=>e.add([V(n),`
`])),e.add("}"),e}case J.REPEAT:{const e=he(t,[se(t,"repeatstart",[`${We.internal}`,...ln(t.words)]),`;
while (`,se(t,"repeat",[`${We.internal}`]),`) {
         ${Cc} ${As}
`]);return We.internal+=1,t.lines&&t.lines.forEach(n=>e.add([V(n),`
`])),e.add("}"),e}case J.READ:{const[e,...n]=t.words,r=he(t,[se(t,"readStart",[`${We.internal}`,V(e)]),`;
while (`,se(t,"read",[`${We.internal}`,...ln(n)]),`) {
`]);return We.internal+=1,t.lines&&t.lines.forEach(s=>r.add([V(s),`
`])),r.add("}"),r}case J.BREAK:return he(t,`break;
`);case J.CONTINUE:return he(t,`continue;
`);case J.OR:return se(t,"or",t.items.map(V));case J.AND:return se(t,"and",t.items.map(V));case J.NOT:return se(t,"not",t.items.map(V));case J.COMPARE:return gO(t);case J.OPERATOR:return yO(t);case J.EXPR:return se(t,"expr",t.words.map(V));default:return console.error("<unsupported node>",t),up(t)}}function EO(t){return We.internal=0,We.labels={restart:[1]},We.labelIndex=2,{...V(t).toStringWithSourceMap({file:`${so}.map`}),...We}}const _O=64;function wO(t){return Array.isArray(t)?t.length>0?1:0:t??0}function qe(t){return`${t??""}`}function TO(t,e){var O;const n=ly(e.labels??{});let r,s="",i,o=0;const a={},c={},l={};let u=!1,h=Vy,d=0,f=0,p=!1;const E=[];let A={};function S(_){if(A[_]===void 0)for(let m=0;m<E.length;++m){const g=E[m].getcommand(_);g&&(A[_]=g)}return A[_]}function b(_,m){const g=S(_);if(!g)throw new Error(`unknown firmware command ${_}`);return g(w,m)}const w={id(){return t},senderid(_=w.id()){return`vm${_??w.id()}`},install(_){y(_)&&(A={},E.push(_))},set(_,m){const g=_.toLowerCase();for(let T=0;T<E.length;++T){const[v]=E[T].set(w,g,m);if(v)return m}return m},get(_){const m=_.toLowerCase();for(let g=0;g<E.length;++g){const[T,v]=E[g].get(w,m);if(T)return v}},cycle(_){h=_},timestamp(){return f},tick(_){f=_;for(let g=0;g<E.length;++g)E[g].shouldtick(w);if(!w.shouldtick())return!1;const m=d%h===0;if(++d,!m)return!1;o=0,u=!1;for(let g=0;g<E.length;++g)E[g].tick(w);try{const g=r==null?void 0:r.next();g!=null&&g.done&&(console.error("we crashed?",e.source),p=!0)}catch(g){console.error("we crashed?",g),p=!0}for(let g=0;g<E.length;++g)E[g].tock(w);return!0},shouldtick(){return p===!1||w.hm()!==0},shouldhalt(){return o++>_O},hm(){var m;const _=(i==null?void 0:i.target)??"";return((m=n[_])==null?void 0:m.find(g=>g>0))??0},yield(){u=!0},sy(){return u||w.shouldhalt()},emit(_,m){ee.emit(_,w.senderid(),m)},send(_,m,g){ee.emit(`${w.senderid(_)}:${m}`,t,g)},lock(_){s=_},unlock(){s=""},message(_){switch(_.target){case"urlstate":{const[m,g]=_.data;w.set(m,g);break}default:if(s&&_.sender!==s)return;i=_;break}},zap(_){const m=n[_];if(m){const g=m.findIndex(T=>T>0);g>=0&&(m[g]*=-1)}},restore(_){const m=n[_];if(m)for(let g=0;g<m.length;g++)m[g]=Math.abs(m[g])},getcase(){if(i){const _=w.hm();return w.set("sender",i.sender),w.set("data",i.data),i.player&&w.set("player",i.player),i=void 0,u=!1,p=!1,_}return 0},endofprogram(){w.yield(),p=!0},stacktrace(_){const m=hR.parse(_),[g]=m.filter(T=>T.fileName===so);return{line:(g==null?void 0:g.lineNumber)??0,column:(g==null?void 0:g.columnNumber)??0}},text(_){return b("text",[_])},stat(..._){return b("stat",_)},hyperlink(..._){return b("hyperlink",_)},move(_,...m){const g=w.command("go",...m);return w.yield(),g&&_?1:0},command(..._){if(_.length===0)return 0;const[m,...g]=_,T=S(qe(m));return T?T(w,g):b("send",[m,...g])},if(..._){const[m,g]=k(I(w,_),0,[R.ANY]),T=wO(m);return T&&g<_.length&&w.command(..._.slice(g)),T},repeatstart(_,...m){const[g,T]=k(I(w,m),0,[R.NUMBER]);a[_]=g,c[_]=T<m.length?m.slice(T):void 0},repeat(_){const m=a[_]??0;a[_]=m-1;const g=m>0,T=c[_];return g&&T&&w.command(...T),g},readstart(_,m){if(!te(m))return;const g=w.get(m)??[];l[_]=Array.isArray(g)?g:[g]},read(_,...m){const g=l[_];if(Array.isArray(g)===!1)return!1;const T=g.shift();if(T===void 0)return!1;const v=m.map(qe);switch(typeof T){case"number":case"string":v.forEach(K=>{w.set(K,T)});break;case"object":v.forEach(K=>{const fe=T[K];w.set(K,fe)});break}return!0},or(..._){let m=0;for(let g=0;g<_.length;){const[T,v]=k(I(w,_),0,[R.ANY]);if(m=T,m)break;g=v}return m},and(..._){let m=0;for(let g=0;g<_.length;){const[T,v]=k(I(w,_),0,[R.ANY]);if(m=T,!m)break;g=v}return m},not(..._){const[m]=k(I(w,_),0,[R.ANY]);return m?0:1},expr(..._){const[m]=k(I(w,_),0,[R.ANY]);return m},isEq(_,m){const[g]=k(I(w,[_]),0,[R.ANY]),[T]=k(I(w,[m]),0,[R.ANY]);return cy(g,T)?1:0},isNotEq(_,m){const[g]=k(I(w,[_]),0,[R.ANY]),[T]=k(I(w,[m]),0,[R.ANY]);return g!==T?1:0},isLessThan(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return g<T?1:0},isGreaterThan(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return g>T?1:0},isLessThanOrEq(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return g<=T?1:0},isGreaterThanOrEq(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return g>=T?1:0},opPlus(_,m){const[g]=k(I(w,[_]),0,[R.ANY]),[T]=k(I(w,[m]),0,[R.ANY]);return g+T},opMinus(_,m){const[g]=k(I(w,[_]),0,[R.ANY]),[T]=k(I(w,[m]),0,[R.ANY]);return g-T},opPower(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return Math.pow(g,T)},opMultiply(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return g*T},opDivide(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return g/T},opModDivide(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return g%T},opFloorDivide(_,m){const[g]=k(I(w,[_]),0,[R.NUMBER]),[T]=k(I(w,[m]),0,[R.NUMBER]);return Math.floor(g/T)},opUniPlus(_){const[m]=k(I(w,[_]),0,[R.NUMBER]);return+m},opUniMinus(_){const[m]=k(I(w,[_]),0,[R.NUMBER]);return-m}};return r=(O=e.code)==null?void 0:O.call(e,w),w}function Ss(t){const e={},n={...t,getcommand(r){return e[r]},command(r,s){return e[r]=s,n}};return n}const bO=Ss({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("register",(t,e)=>{var o,a;const r=((a=(o=z(t.id()).object)==null?void 0:o.stats)==null?void 0:a.player)??"",[s,i]=k(I(t,e),0,[R.STRING,R.STRING]);switch(s.toLowerCase()){case"read":by(t.senderid(),i,r);break;case"write":Ay(t.senderid(),i,t.get(i),r);break;default:bn(t.senderid(),"register",`unknown #regsiter [action] ${s}`,r);break}return 0}).command("clear",(t,e)=>{const n=qe(e[0]);return t.set(n,void 0),0}).command("set",(t,e)=>{const[n,r]=k(I(t,e),0,[R.STRING,R.ANY]);return t.set(n,r),0}).command("take",(t,e)=>{const[n,r,s]=k(I(t,e),0,[R.STRING,R.MAYBE_NUMBER]),i=t.get(n),o=r??1;if(!ke(i))return 1;const a=i-o;return a<0?(s<e.length&&t.command(...e.slice(s)),1):(t.set(n,a),0)}).command("give",(t,e)=>{const[n,r,s]=k(I(t,e),0,[R.STRING,R.MAYBE_NUMBER]),i=t.get(n),o=ke(i)?i:0,a=r??1;if(!ke(a))return 0;const c=i===void 0?1:0;return c&&s<e.length&&t.command(...e.slice(s)),t.set(n,o+a),c}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(qe(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(qe(e[0])),0)),AO=Ss({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("play",(t,e)=>{const n=I(t,e),[r]=k(n,0,[R.STRING]),s=t.get(r);return te(s)?t.emit("pcspeaker:play",[-1,s]):t.emit("pcspeaker:play",[-1,r]),0});function vs(){return vs=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},vs.apply(this,arguments)}function SO(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Lc(t,e)}function Lc(t,e){return Lc=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},Lc(t,e)}function vO(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var fp=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var s=this.observing.get(r.observable);s||(s={byKey:new Set,iterate:!1},this.observing.set(r.observable,s)),r.type==="iterate"?s.iterate=!0:s.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(s,i){s.iterate&&i[Ee].connections.iterate.delete(r),s.byKey.forEach(function(o){i[Ee].connections.byKey.get(o).delete(r)})}),this.observing.clear()},t}(),rr=[],oo=function(t){SO(e,t);function e(r,s,i){var o;if(o=t.call(this,function(){return o._trigger()})||this,o.func=r,o.options=s,o.effect=i,o.isInitial=!0,o.reaction=function(){rr.push(vO(o));try{o.func()}finally{rr.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!i&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=e.prototype;return n._trigger=function(){if(rr.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(fp);function dp(){return!!rr.length}function pp(){return rr.length?rr[rr.length-1]:void 0}function RO(t,e,n){var r=vs({name:"unnamed",fireImmediately:!0},n),s=new oo(t,r,e);return s}var ao=0;function gp(){return ao>0}function Mc(t){ao++;try{return t()}finally{ao--,ao===0&&kO()}}var xc=!1;function mp(){return xc}function yp(t){xc=!0;try{t()}finally{xc=!1}}function OO(t){return function(){return yp(t)}}var Uc=[];function kO(){var t=[].concat(Uc);Uc=[],Ep(t)}function Ep(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[Ee].connections.iterate.forEach(function(s){e.add(s)}),(r=n.observable[Ee].connections.byKey.get(n.key))==null||r.forEach(function(s){e.add(s)})}),e.forEach(function(n){n.trigger()})}function co(t){if(gp()){Uc.push(t);return}Ep([t])}function _p(t,e){if(t.type==="iterate")t.observable[Ee].connections.iterate.add(e);else{var n=t.observable[Ee].connections.byKey.get(t.key);n||(n=new Set,t.observable[Ee].connections.byKey.set(t.key,n)),n.add(e)}}function lo(t,e){if(!mp()){var n=pp();n&&(_p(t,n),n.registerConnection(t)),e&&(_p(t,e),e.registerConnection(t))}}var Pc=Symbol("$skipreactive"),Ee=Symbol("$reactive"),lt=Symbol("$reactiveproxy");function Rs(t,e){return!!(t&&t[lt]&&t[lt].implicitObserver===e)}function Dc(t){return t[Pc]=!0,t}function wp(t){return!!(t&&!Rs(t)&&t[Ee])}function $c(t,e,n){if(n===void 0&&(n=!1),t[Pc]||Rs(t,e))return t;var r=NO(t,n);if(!e)return r;var s=r[Ee].proxiesWithImplicitObserver.get(e);if(!s){var i={implicitObserver:e};Object.setPrototypeOf(i,Tp),s=new Proxy(r[Ee].raw,i),r[Ee].proxiesWithImplicitObserver.set(e,s)}return s}var Os=$c;function NO(t,e){if(e===void 0&&(e=!1),Rs(t))return t;if(wp(t))return t[Ee].proxy;if(t[Ee]||t[lt])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,Ee,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,Tp);return n.proxy=r,r}var Tp={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||lo({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===lt)return{implicitObserver:this.implicitObserver};var s=Reflect.get(e,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),s;if(n==="length"&&Array.isArray(e)?lo({observable:e,type:"iterate"},this.implicitObserver):lo({observable:e,key:n,type:"get"},this.implicitObserver),wp(s))return $c(s,this.implicitObserver);if(e[Ee].shallow)return s;if(typeof s=="object"&&s!==null&&!Rs(s,this.implicitObserver)&&!Object.isFrozen(s)){var i=Reflect.getOwnPropertyDescriptor(e,n);if((!i||!(i.writable===!1&&i.configurable===!1))&&(dp()||this.implicitObserver))return $c(s,this.implicitObserver)}return s},ownKeys:function(e){return lo({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,s){return Mc(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,s);var i=Object.hasOwnProperty.call(e,n),o=Reflect.get(e,n,s),a=Reflect.set(e,n,r,s);if(!i)co({observable:e,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)co({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else co({observable:e,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,n){return Mc(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),s=Reflect.get(e,n),i=Reflect.deleteProperty(e,n);return r&&co({observable:e,key:n,oldValue:s,type:"delete"}),i})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function CO(t,e){var n=vs({name:"unnamed",fireImmediately:!0},e),r=new oo(t,n);return r}function IO(t,e,n){var r=vs({name:"unnamed",fireImmediately:!0},n),s=new oo(function(){t(e)},r);return e=Os(e,s),r.fireImmediately&&s.trigger(),s}var bp=function(){function t(){this._observable=Os({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return Os(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function LO(t,e,n){return new bp}var MO=Object.freeze({__proto__:null,$reactive:Ee,$reactiveproxy:lt,$skipreactive:Pc,Atom:bp,Observer:fp,Reaction:oo,autorun:CO,autorunAsync:IO,createAtom:LO,hasRunningReaction:dp,isActionRunning:gp,isReactive:Rs,isTrackingDisabled:mp,markRaw:Dc,reaction:RO,reactive:Os,runInAction:Mc,runningReaction:pp,untracked:yp,untrackedCB:OO});const St=()=>new Map,Fc=t=>{const e=St();return t.forEach((n,r)=>{e.set(r,n)}),e},Nn=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},xO=(t,e)=>{const n=[];for(const[r,s]of t)n.push(e(s,r));return n},UO=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Cr=()=>new Set,Bc=t=>t[t.length-1],PO=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Cn=Array.from,DO=Array.isArray;class $O{constructor(){this._observers=St()}on(e,n){return Nn(this._observers,e,Cr).add(n),n}once(e,n){const r=(...s)=>{this.off(e,r),n(...s)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Cn((this._observers.get(e)||St()).values()).forEach(r=>r(...n))}destroy(){this._observers=St()}}const In=Math.floor,uo=Math.abs,Ap=(t,e)=>t<e?t:e,sr=(t,e)=>t>e?t:e,Sp=t=>t!==0?t<0:1/t<0,vp=1,Rp=2,jc=4,Gc=8,ks=32,un=64,Xe=128,ho=31,Kc=63,ir=127,FO=2147483647,Op=Number.MAX_SAFE_INTEGER,BO=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&In(t)===t),jO=t=>t.toLowerCase(),GO=/^\s*/g,KO=t=>t.replace(GO,""),WO=/([A-Z])/g,kp=(t,e)=>KO(t.replace(WO,n=>`${e}${jO(n)}`)),HO=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.codePointAt(s);return r},Ns=typeof TextEncoder<"u"?new TextEncoder:null,VO=Ns?t=>Ns.encode(t):HO;let Cs=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Cs&&Cs.decode(new Uint8Array).length===1&&(Cs=null);class Is{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ut=()=>new Is,zO=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},ht=t=>{const e=new Uint8Array(zO(t));let n=0;for(let r=0;r<t.bufs.length;r++){const s=t.bufs[r];e.set(s,n),n+=s.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},YO=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(sr(n,e)*2),t.cpos=0)},Ae=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Wc=Ae,$=(t,e)=>{for(;e>ir;)Ae(t,Xe|ir&e),e=In(e/128);Ae(t,ir&e)},Hc=(t,e)=>{const n=Sp(e);for(n&&(e=-e),Ae(t,(e>Kc?Xe:0)|(n?un:0)|Kc&e),e=In(e/64);e>0;)Ae(t,(e>ir?Xe:0)|ir&e),e=In(e/128)},Vc=new Uint8Array(3e4),qO=Vc.length/3,XO=(t,e)=>{if(e.length<qO){const n=Ns.encodeInto(e,Vc).written||0;$(t,n);for(let r=0;r<n;r++)Ae(t,Vc[r])}else Ie(t,VO(e))},JO=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;$(t,r);for(let s=0;s<r;s++)Ae(t,n.codePointAt(s))},Ir=Ns&&Ns.encodeInto?XO:JO,fo=(t,e)=>{const n=t.cbuf.length,r=t.cpos,s=Ap(n-r,e.length),i=e.length-s;t.cbuf.set(e.subarray(0,s),r),t.cpos+=s,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(sr(n*2,i)),t.cbuf.set(e.subarray(s)),t.cpos=i)},Ie=(t,e)=>{$(t,e.byteLength),fo(t,e)},zc=(t,e)=>{YO(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},QO=(t,e)=>zc(t,4).setFloat32(0,e,!1),ZO=(t,e)=>zc(t,8).setFloat64(0,e,!1),ek=(t,e)=>zc(t,8).setBigInt64(0,e,!1),Np=new DataView(new ArrayBuffer(4)),tk=t=>(Np.setFloat32(0,t),Np.getFloat32(0)===t),Ls=(t,e)=>{switch(typeof e){case"string":Ae(t,119),Ir(t,e);break;case"number":BO(e)&&uo(e)<=FO?(Ae(t,125),Hc(t,e)):tk(e)?(Ae(t,124),QO(t,e)):(Ae(t,123),ZO(t,e));break;case"bigint":Ae(t,122),ek(t,e);break;case"object":if(e===null)Ae(t,126);else if(DO(e)){Ae(t,117),$(t,e.length);for(let n=0;n<e.length;n++)Ls(t,e[n])}else if(e instanceof Uint8Array)Ae(t,116),Ie(t,e);else{Ae(t,118);const n=Object.keys(e);$(t,n.length);for(let r=0;r<n.length;r++){const s=n[r];Ir(t,s),Ls(t,e[s])}}break;case"boolean":Ae(t,e?120:121);break;default:Ae(t,127)}};class Cp extends Is{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&$(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Ip=t=>{t.count>0&&(Hc(t.encoder,t.count===1?t.s:-t.s),t.count>1&&$(t.encoder,t.count-2))};class po{constructor(){this.encoder=new Is,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Ip(this),this.count=1,this.s=e)}toUint8Array(){return Ip(this),ht(this.encoder)}}const Lp=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Hc(t.encoder,e),t.count>1&&$(t.encoder,t.count-2)}};class Yc{constructor(){this.encoder=new Is,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Lp(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Lp(this),ht(this.encoder)}}class nk{constructor(){this.sarr=[],this.s="",this.lensE=new po}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Is;return this.sarr.push(this.s),this.s="",Ir(e,this.sarr.join("")),fo(e,this.lensE.toUint8Array()),ht(e)}}const Ln=t=>new Error(t),jt=()=>{throw Ln("Method unimplemented")},Gt=()=>{throw Ln("Unexpected case")},Mp=Ln("Unexpected end of array"),xp=Ln("Integer out of Range");class go{constructor(e){this.arr=e,this.pos=0}}const Mn=t=>new go(t),rk=t=>t.pos!==t.arr.length,sk=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},$e=t=>sk(t,F(t)),Lr=t=>t.arr[t.pos++],F=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const s=t.arr[t.pos++];if(e=e+(s&ir)*n,n*=128,s<Xe)return e;if(e>Op)throw xp}throw Mp},qc=t=>{let e=t.arr[t.pos++],n=e&Kc,r=64;const s=(e&un)>0?-1:1;if(!(e&Xe))return s*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n=n+(e&ir)*r,r*=128,e<Xe)return s*n;if(n>Op)throw xp}throw Mp},Mr=Cs?t=>Cs.decode($e(t)):t=>{let e=F(t);if(e===0)return"";{let n=String.fromCodePoint(Lr(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Lr(t));else for(;e>0;){const r=e<1e4?e:1e4,s=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(n))}},Xc=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},ik=[t=>{},t=>null,qc,t=>Xc(t,4).getFloat32(0,!1),t=>Xc(t,8).getFloat64(0,!1),t=>Xc(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Mr,t=>{const e=F(t),n={};for(let r=0;r<e;r++){const s=Mr(t);n[s]=Ms(t)}return n},t=>{const e=F(t),n=[];for(let r=0;r<e;r++)n.push(Ms(t));return n},$e],Ms=t=>ik[127-Lr(t)](t);class Up extends go{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),rk(this)?this.count=F(this)+1:this.count=-1),this.count--,this.s}}class mo extends go{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=qc(this);const e=Sp(this.s);this.count=1,e&&(this.s=-this.s,this.count=F(this)+2)}return this.count--,this.s}}class Jc extends go{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=qc(this),n=e&1;this.diff=In(e/2),this.count=1,n&&(this.count=F(this)+2)}return this.s+=this.diff,this.count--,this.s}}class ok{constructor(e){this.decoder=new mo(e),this.str=Mr(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const ak=crypto.getRandomValues.bind(crypto),Pp=()=>ak(new Uint32Array(1))[0],ck="10000000-1000-4000-8000"+-1e11,lk=()=>ck.replace(/[018]/g,t=>(t^Pp()&15>>t/4).toString(16)),Dp=t=>new Promise(t);Promise.all.bind(Promise);const $p=t=>t===void 0?null:t;class uk{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Fp=new uk,hk=!0;try{typeof localStorage<"u"&&localStorage&&(Fp=localStorage,hk=!1)}catch{}const fk=Fp,dk=Object.assign,pk=Object.keys,gk=(t,e)=>{for(const n in t)e(t[n],n)},Bp=t=>pk(t).length,mk=t=>{for(const e in t)return!1;return!0},yk=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Ek=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),_k=(t,e)=>t===e||Bp(t)===Bp(e)&&yk(t,(n,r)=>(n!==void 0||Ek(e,r))&&e[r]===n),Qc=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Qc(t,e,n+1)}},wk=t=>t,Tk=(t,e)=>e.includes(t);var jp={};const xs=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Kt;const bk=()=>{if(Kt===void 0)if(xs){Kt=St();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Kt.set(e,""),e=r):e!==null&&(Kt.set(e,r),e=null)}e!==null&&Kt.set(e,"")}else typeof location=="object"?(Kt=St(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Kt.set(`--${kp(e,"-")}`,n),Kt.set(`-${kp(e,"-")}`,n)}})):Kt=St();return Kt},Zc=t=>bk().has(t),el=t=>$p(xs?jp[t.toUpperCase().replaceAll("-","_")]:fk.getItem(t));(t=>Zc("--"+t)||el(t)!==null)("production");const Gp=xs&&Tk(jp.FORCE_COLOR,["true","1","2"]),Ak=!Zc("--no-colors")&&(!xs||process.stdout.isTTY||Gp)&&(!xs||Zc("--color")||Gp||el("COLORTERM")!==null||(el("TERM")||"").includes("color")),Sk=t=>new Uint8Array(t),vk=t=>{const e=Sk(t.byteLength);return e.set(t),e};class Rk{constructor(e,n){this.left=e,this.right=n}}const hn=(t,e)=>new Rk(t,e);typeof DOMParser<"u"&&new DOMParser;const Ok=t=>xO(t,(e,n)=>`${n}:${e};`).join(""),fn=Symbol,Kp=fn(),Wp=fn(),kk=fn(),Nk=fn(),Ck=fn(),Hp=fn(),Ik=fn(),Vp=fn(),Lk=fn(),Mk=t=>{var r;t.length===1&&((r=t[0])==null?void 0:r.constructor)===Function&&(t=t[0]());const e=[];let n=0;for(;n<t.length;n++){const s=t[n];s===void 0||s.constructor===String||s.constructor===Number||s.constructor===Object&&e.push(JSON.stringify(s))}return e},xk={[Kp]:hn("font-weight","bold"),[Wp]:hn("font-weight","normal"),[kk]:hn("color","blue"),[Ck]:hn("color","green"),[Nk]:hn("color","grey"),[Hp]:hn("color","red"),[Ik]:hn("color","purple"),[Vp]:hn("color","orange"),[Lk]:hn("color","black")},Uk=Ak?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=St();let s=[],i=0;for(;i<t.length;i++){const a=t[i],c=xk[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=Ok(r);i>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(i>0&&(s=n,s.unshift(e.join("")));i<t.length;i++){const a=t[i];a instanceof Symbol||s.push(a)}return s}:Mk,Pk=(...t)=>{console.log(...Uk(t)),Dk.forEach(e=>e.print(t))},Dk=Cr(),zp=t=>({[Symbol.iterator](){return this},next:t}),$k=(t,e)=>zp(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),tl=(t,e)=>zp(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class nl{constructor(e,n){this.clock=e,this.len=n}}class Us{constructor(){this.clients=new Map}}const Yp=(t,e,n)=>e.clients.forEach((r,s)=>{const i=t.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const a=r[o];fg(t,i,a.clock,a.len,n)}}),Fk=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const s=In((n+r)/2),i=t[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;n=s+1}else r=s-1}return null},qp=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&Fk(n,e.clock)!==null},rl=t=>{t.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<e.length;n++){const s=e[r-1],i=e[n];s.clock+s.len>=i.clock?s.len=sr(s.len,i.clock+i.len-s.clock):(r<n&&(e[r]=i),r++)}e.length=r})},Bk=t=>{const e=new Us;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,s)=>{if(!e.clients.has(s)){const i=r.slice();for(let o=n+1;o<t.length;o++)PO(i,t[o].clients.get(s)||[]);e.clients.set(s,i)}});return rl(e),e},yo=(t,e,n,r)=>{Nn(t.clients,e,()=>[]).push(new nl(n,r))},jk=()=>new Us,Gk=t=>{const e=jk();return t.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<n.length)for(let l=n[i+1];i+1<n.length&&l.deleted;l=n[++i+1])c+=l.length;s.push(new nl(a,c))}}s.length>0&&e.clients.set(r,s)}),e},xr=(t,e)=>{$(t.restEncoder,e.clients.size),Cn(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),$(t.restEncoder,n);const s=r.length;$(t.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},sl=t=>{const e=new Us,n=F(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const s=F(t.restDecoder),i=F(t.restDecoder);if(i>0){const o=Nn(e.clients,s,()=>[]);for(let a=0;a<i;a++)o.push(new nl(t.readDsClock(),t.readDsLen()))}}return e},Xp=(t,e,n)=>{const r=new Us,s=F(t.restDecoder);for(let i=0;i<s;i++){t.resetDsCurVal();const o=F(t.restDecoder),a=F(t.restDecoder),c=n.clients.get(o)||[],l=Se(n,o);for(let u=0;u<a;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&yo(r,o,l,d-l);let f=vt(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,Co(e,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,Co(e,p,d-p.id.clock)),p.delete(e))}else yo(r,o,h,d-h)}}if(r.clients.size>0){const i=new or;return $(i.restEncoder,0),xr(i,r),i.toUint8Array()}return null},Jp=Pp;class dn extends $O{constructor({guid:e=lk(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Jp(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new lg,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Dp(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Dp(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Q(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Cn(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Q(this,e,n)}get(e,n=ce){const r=Nn(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==ce&&s!==n)if(s===ce){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Wt)}getText(e=""){return this.get(e,Rt)}getMap(e=""){return this.get(e,Ht)}getXmlElement(e=""){return this.get(e,pn)}getXmlFragment(e=""){return this.get(e,Vt)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){Cn(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new dn({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Q(e.parent.doc,r=>{const s=n.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Qp{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return F(this.restDecoder)}readDsLen(){return F(this.restDecoder)}}class Zp extends Qp{readLeftID(){return j(F(this.restDecoder),F(this.restDecoder))}readRightID(){return j(F(this.restDecoder),F(this.restDecoder))}readClient(){return F(this.restDecoder)}readInfo(){return Lr(this.restDecoder)}readString(){return Mr(this.restDecoder)}readParentInfo(){return F(this.restDecoder)===1}readTypeRef(){return F(this.restDecoder)}readLen(){return F(this.restDecoder)}readAny(){return Ms(this.restDecoder)}readBuf(){return vk($e(this.restDecoder))}readJSON(){return JSON.parse(Mr(this.restDecoder))}readKey(){return Mr(this.restDecoder)}}class Kk{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=F(this.restDecoder),this.dsCurrVal}readDsLen(){const e=F(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Ur extends Kk{constructor(e){super(e),this.keys=[],F(e),this.keyClockDecoder=new Jc($e(e)),this.clientDecoder=new mo($e(e)),this.leftClockDecoder=new Jc($e(e)),this.rightClockDecoder=new Jc($e(e)),this.infoDecoder=new Up($e(e),Lr),this.stringDecoder=new ok($e(e)),this.parentInfoDecoder=new Up($e(e),Lr),this.typeRefDecoder=new mo($e(e)),this.lenDecoder=new mo($e(e))}readLeftID(){return new Pr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Pr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ms(this.restDecoder)}readBuf(){return $e(this.restDecoder)}readJSON(){return Ms(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class eg{constructor(){this.restEncoder=ut()}toUint8Array(){return ht(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){$(this.restEncoder,e)}writeDsLen(e){$(this.restEncoder,e)}}class Ps extends eg{writeLeftID(e){$(this.restEncoder,e.client),$(this.restEncoder,e.clock)}writeRightID(e){$(this.restEncoder,e.client),$(this.restEncoder,e.clock)}writeClient(e){$(this.restEncoder,e)}writeInfo(e){Wc(this.restEncoder,e)}writeString(e){Ir(this.restEncoder,e)}writeParentInfo(e){$(this.restEncoder,e?1:0)}writeTypeRef(e){$(this.restEncoder,e)}writeLen(e){$(this.restEncoder,e)}writeAny(e){Ls(this.restEncoder,e)}writeBuf(e){Ie(this.restEncoder,e)}writeJSON(e){Ir(this.restEncoder,JSON.stringify(e))}writeKey(e){Ir(this.restEncoder,e)}}class tg{constructor(){this.restEncoder=ut(),this.dsCurrVal=0}toUint8Array(){return ht(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,$(this.restEncoder,n)}writeDsLen(e){e===0&&Gt(),$(this.restEncoder,e-1),this.dsCurrVal+=e}}class or extends tg{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Yc,this.clientEncoder=new po,this.leftClockEncoder=new Yc,this.rightClockEncoder=new Yc,this.infoEncoder=new Cp(Wc),this.stringEncoder=new nk,this.parentInfoEncoder=new Cp(Wc),this.typeRefEncoder=new po,this.lenEncoder=new po}toUint8Array(){const e=ut();return $(e,0),Ie(e,this.keyClockEncoder.toUint8Array()),Ie(e,this.clientEncoder.toUint8Array()),Ie(e,this.leftClockEncoder.toUint8Array()),Ie(e,this.rightClockEncoder.toUint8Array()),Ie(e,ht(this.infoEncoder)),Ie(e,this.stringEncoder.toUint8Array()),Ie(e,ht(this.parentInfoEncoder)),Ie(e,this.typeRefEncoder.toUint8Array()),Ie(e,this.lenEncoder.toUint8Array()),fo(e,ht(this.restEncoder)),ht(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Ls(this.restEncoder,e)}writeBuf(e){Ie(this.restEncoder,e)}writeJSON(e){Ls(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Wk=(t,e,n,r)=>{r=sr(r,e[0].id.clock);const s=vt(e,r);$(t.restEncoder,e.length-s),t.writeClient(n),$(t.restEncoder,r);const i=e[s];i.write(t,r-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(t,0)},il=(t,e,n)=>{const r=new Map;n.forEach((s,i)=>{Se(e,i)>s&&r.set(i,s)}),_o(e).forEach((s,i)=>{n.has(i)||r.set(i,0)}),$(t.restEncoder,r.size),Cn(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{Wk(t,e.clients.get(s),s,i)})},Hk=(t,e)=>{const n=St(),r=F(t.restDecoder);for(let s=0;s<r;s++){const i=F(t.restDecoder),o=new Array(i),a=t.readClient();let c=F(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const u=t.readInfo();switch(ho&u){case 0:{const h=t.readLen();o[l]=new Je(j(a,c),h),c+=h;break}case 10:{const h=F(t.restDecoder);o[l]=new ft(j(a,c),h),c+=h;break}default:{const h=(u&(un|Xe))===0,d=new we(j(a,c),null,(u&Xe)===Xe?t.readLeftID():null,null,(u&un)===un?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&ks)===ks?t.readString():null,Dg(t,u));o[l]=d,c+=d.length}}}}return n},Vk=(t,e,n)=>{const r=[];let s=Cn(n.keys()).sort((f,p)=>f-p);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new lg,c=new Map,l=(f,p)=>{const E=c.get(f);(E==null||E>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,E=n.get(p);E?(E.i--,a.clients.set(p,E.refs.slice(E.i)),n.delete(p),E.i=0,E.refs=[]):a.clients.set(p,[f]),s=s.filter(A=>A!==p)}r.length=0};for(;;){if(u.constructor!==ft){const p=Nn(h,u.id.client,()=>Se(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const E=u.getMissing(t,e);if(E!==null){r.push(u);const A=n.get(E)||{refs:[],i:0};if(A.refs.length===A.i)l(E,Se(e,E)),d();else{u=A.refs[A.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new or;return il(f,a,new Map),$(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},zk=(t,e)=>il(t,e.doc.store,e.beforeState),Yk=(t,e,n,r=new Ur(t))=>Q(e,s=>{s.local=!1;let i=!1;const o=s.doc,a=o.store,c=Hk(r,o),l=Vk(s,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<Se(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=To([u.update,l.update])}}else a.pendingStructs=l;const h=Xp(r,s,a);if(a.pendingDs){const d=new Ur(Mn(a.pendingDs));F(d.restDecoder);const f=Xp(d,s,a);h&&f?a.pendingDs=To([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,ng(s.doc,d)}},n,!1),ng=(t,e,n,r=Ur)=>{const s=Mn(e);Yk(s,t,n,new r(s))},qk=(t,e,n)=>ng(t,e,n,Zp),Xk=(t,e,n=new Map)=>{il(t,e.store,n),xr(t,Gk(e.store))},Jk=(t,e=new Uint8Array([0]),n=new or)=>{const r=rg(e);Xk(n,t,r);const s=[n.toUint8Array()];if(t.store.pendingDs&&s.push(t.store.pendingDs),t.store.pendingStructs&&s.push(fN(t.store.pendingStructs.update,e)),s.length>1){if(n.constructor===Ps)return uN(s.map((i,o)=>o===0?i:pN(i)));if(n.constructor===or)return To(s)}return s[0]},Qk=(t,e)=>Jk(t,e,new Ps),Zk=t=>{const e=new Map,n=F(t.restDecoder);for(let r=0;r<n;r++){const s=F(t.restDecoder),i=F(t.restDecoder);e.set(s,i)}return e},rg=t=>Zk(new Qp(Mn(t))),sg=(t,e)=>($(t.restEncoder,e.size),Cn(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{$(t.restEncoder,n),$(t.restEncoder,r)}),t),eN=(t,e)=>sg(t,_o(e.store)),tN=(t,e=new tg)=>(t instanceof Map?sg(e,t):eN(e,t),e.toUint8Array()),nN=t=>tN(t,new eg);class rN{constructor(){this.l=[]}}const ig=()=>new rN,og=(t,e)=>t.l.push(e),ag=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(s=>e!==s),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},cg=(t,e,n)=>Qc(t.l,[e,n]);class Pr{constructor(e,n){this.client=e,this.clock=n}}const Eo=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,j=(t,e)=>new Pr(t,e),sN=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Gt()},Dr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!qp(e.ds,t.id),ol=(t,e)=>{const n=Nn(t.meta,ol,Cr),r=t.doc.store;n.has(e)||(e.sv.forEach((s,i)=>{s<Se(r,i)&&xn(t,j(i,s))}),Yp(t,e.ds,s=>{}),n.add(e))};class lg{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const _o=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const s=n[n.length-1];e.set(r,s.id.clock+s.length)}),e},Se=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ug=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Gt()}n.push(e)},vt=(t,e)=>{let n=0,r=t.length-1,s=t[r],i=s.id.clock;if(i===e)return r;let o=In(e/(i+s.length-1)*r);for(;n<=r;){if(s=t[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;n=o+1}else r=o-1;o=In((n+r)/2)}throw Gt()},al=(t,e)=>{const n=t.clients.get(e.client);return n[vt(n,e.clock)]},cl=(t,e,n)=>{const r=vt(e,n),s=e[r];return s.id.clock<n&&s instanceof we?(e.splice(r+1,0,Co(t,s,n-s.id.clock)),r+1):r},xn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[cl(t,n,e.clock)]},hg=(t,e,n)=>{const r=e.clients.get(n.client),s=vt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==Je&&r.splice(s+1,0,Co(t,i,n.clock-i.id.clock+1)),i},iN=(t,e,n)=>{const r=t.clients.get(e.id.client);r[vt(r,e.id.clock)]=n},fg=(t,e,n,r,s)=>{if(r===0)return;const i=n+r;let o=cl(t,e,n),a;do a=e[o++],i<a.id.clock+a.length&&cl(t,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class oN{constructor(e,n,r){this.doc=e,this.deleteSet=new Us,this.beforeState=_o(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const dg=(t,e)=>e.deleteSet.clients.size===0&&!UO(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(rl(e.deleteSet),zk(t,e),xr(t,e.deleteSet),!0),pg=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Nn(t.changed,e,Cr).add(n)},wo=(t,e)=>{let n=t[e],r=t[e-1],s=e;for(;s>0;n=r,r=t[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof we&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=e-s;return i&&t.splice(e+1-i,i),i},aN=(t,e,n)=>{for(const[r,s]of t.clients.entries()){const i=e.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],c=a.clock+a.len;for(let l=vt(i,a.clock),u=i[l];l<i.length&&u.id.clock<c;u=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof we&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},cN=(t,e)=>{t.clients.forEach((n,r)=>{const s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Ap(s.length-1,1+vt(s,o.clock+o.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=o.clock;l=s[c])c-=1+wo(s,c)}})},gg=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{rl(i),n.afterState=_o(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),cg(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Qc(a,[]),n._needFormattingCleanup&&kN(n)}finally{r.gc&&aN(i,s,r.gcFilter),cN(i,s),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=s.clients.get(h),p=sr(vt(f,d),1);for(let E=f.length-1;E>=p;)E-=1+wo(f,E)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=s.clients.get(h),p=vt(f,d);p+1<f.length&&wo(f,p+1)>1||p>0&&wo(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Pk(Vp,Kp,"[yjs] ",Wp,Hp,"Changed the client-id because another client seems to be using it."),r.clientID=Jp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Ps;dg(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new or;dg(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):gg(t,e+1)}}},Q=(t,e,n=null,r=!0)=>{const s=t._transactionCleanups;let i=!1,o=null;t._transaction===null&&(i=!0,t._transaction=new oN(t,n,r),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const a=t._transaction===s[0];t._transaction=null,a&&gg(s,0)}}return o};function*lN(t){const e=F(t.restDecoder);for(let n=0;n<e;n++){const r=F(t.restDecoder),s=t.readClient();let i=F(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=F(t.restDecoder);yield new ft(j(s,i),c),i+=c}else if(ho&a){const c=(a&(un|Xe))===0,l=new we(j(s,i),null,(a&Xe)===Xe?t.readLeftID():null,null,(a&un)===un?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&ks)===ks?t.readString():null,Dg(t,a));yield l,i+=l.length}else{const c=t.readLen();yield new Je(j(s,i),c),i+=c}}}}class ll{constructor(e,n){this.gen=lN(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ft);return this.curr}}class ul{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const uN=t=>To(t,Zp,Ps),hN=(t,e)=>{if(t.constructor===Je){const{client:n,clock:r}=t.id;return new Je(j(n,r+e),t.length-e)}else if(t.constructor===ft){const{client:n,clock:r}=t.id;return new ft(j(n,r+e),t.length-e)}else{const n=t,{client:r,clock:s}=n.id;return new we(j(r,s+e),null,j(r,s+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},To=(t,e=Ur,n=or)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Mn(u)));let s=r.map(u=>new ll(u,!0)),i=null;const o=new n,a=new ul(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===ft?1:-1:p}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)Un(a,i.struct,i.offset),i={struct:d,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===ft)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{Un(a,i.struct,i.offset);const p=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new ft(j(h,i.struct.id.clock+i.struct.length),p),offset:0}}else{const p=i.struct.id.clock+i.struct.length-d.id.clock;p>0&&(i.struct.constructor===ft?i.struct.length-=p:d=hN(d,p)),i.struct.mergeWith(d)||(Un(a,i.struct,i.offset),i={struct:d,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==ft;d=u.next())Un(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(Un(a,i.struct,i.offset),i=null),hl(a);const c=r.map(u=>sl(u)),l=Bk(c);return xr(o,l),o.toUint8Array()},fN=(t,e,n=Ur,r=or)=>{const s=rg(e),i=new r,o=new ul(i),a=new n(Mn(t)),c=new ll(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=s.get(h)||0;if(c.curr.constructor===ft){c.next();continue}if(u.id.clock+u.length>d)for(Un(o,u,sr(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Un(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}hl(o);const l=sl(a);return xr(i,l),i.toUint8Array()},mg=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:ht(t.encoder.restEncoder)}),t.encoder.restEncoder=ut(),t.written=0)},Un=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&mg(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),$(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},hl=t=>{mg(t);const e=t.encoder.restEncoder;$(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];$(e,r.written),fo(e,r.restEncoder)}},dN=(t,e,n,r)=>{const s=new n(Mn(t)),i=new ll(s,!1),o=new r,a=new ul(o);for(let l=i.curr;l!==null;l=i.next())Un(a,e(l),0);hl(a);const c=sl(s);return xr(o,c),o.toUint8Array()},pN=t=>dN(t,wk,Ur,Ps),yg="You must not compute changes after the event-handler fired.";class bo{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=gN(this.currentTarget,this.target))}deletes(e){return qp(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ln(yg);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=Bc(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Bc(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Bc(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ln(yg);const n=this.target,r=Cr(),s=Cr(),i=[];if(e={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const gN=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}e=e._item.parent}return n},Eg=80;let fl=0;class mN{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=fl++}}const yN=t=>{t.timestamp=fl++},_g=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=fl++},EN=(t,e,n)=>{if(t.length>=Eg){const r=t.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return _g(r,e,n),r}else{const r=new mN(e,n);return t.push(r),r}},Ao=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,o)=>uo(e-i.index)<uo(e-o.index)?i:o);let r=t._start,s=0;for(n!==null&&(r=n.p,s=n.index,yN(n));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&uo(n.index-s)<r.parent.length/Eg?(_g(n,r,s),n):EN(t._searchMarker,r,s)},Ds=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){t.splice(r,1);continue}s.p=i,i.marker=!0}(e<s.index||n>0&&e===s.index)&&(s.index=sr(e,s.index+n))}},So=(t,e,n)=>{const r=t,s=e.changedParentTypes;for(;Nn(s,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;cg(r._eH,n,e)};class ce{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ig(),this._dEH=ig(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw jt()}clone(){throw jt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){og(this._eH,e)}observeDeep(e){og(this._dEH,e)}unobserve(e){ag(this._eH,e)}unobserveDeep(e){ag(this._dEH,e)}toJSON(){}}const wg=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const s=[];let i=t._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)s.push(o[a]),r--;e=0}}i=i.right}return s},Tg=t=>{const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}n=n.right}return e},$s=(t,e)=>{let n=0,r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)e(s[i],n++,t)}r=r.right}},bg=(t,e)=>{const n=[];return $s(t,(r,s)=>{n.push(e(r,s,t))}),n},_N=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Ag=(t,e)=>{const n=Ao(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},vo=(t,e,n,r)=>{let s=n;const i=t.doc,o=i.clientID,a=i.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new we(j(o,Se(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new lr(l)),s.integrate(t,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new we(j(o,Se(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new Fs(new Uint8Array(h))),s.integrate(t,0);break;case dn:s=new we(j(o,Se(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new js(h)),s.integrate(t,0);break;default:if(h instanceof ce)s=new we(j(o,Se(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new gn(h)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Sg=()=>Ln("Length exceeded!"),vg=(t,e,n,r)=>{if(n>e._length)throw Sg();if(n===0)return e._searchMarker&&Ds(e._searchMarker,n,r.length),vo(t,e,null,r);const s=n,i=Ao(e,n);let o=e._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&xn(t,j(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Ds(e._searchMarker,s,r.length),vo(t,e,o,r)},wN=(t,e,n)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return vo(t,e,s,n)},Rg=(t,e,n,r)=>{if(r===0)return;const s=n,i=r,o=Ao(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&xn(t,j(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&xn(t,j(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw Sg();e._searchMarker&&Ds(e._searchMarker,s,-i+r)},Ro=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},dl=(t,e,n,r)=>{const s=e._map.get(n)||null,i=t.doc,o=i.clientID;let a;if(r==null)a=new lr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new lr([r]);break;case Uint8Array:a=new Fs(r);break;case dn:a=new js(r);break;default:if(r instanceof ce)a=new gn(r);else throw new Error("Unexpected content type")}new we(j(o,Se(i.store,o)),s,s&&s.lastId,null,null,e,n,a).integrate(t,0)},pl=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Og=t=>{const e={};return t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},kg=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted},TN=(t,e)=>{const n={};return t._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&Dr(i,e)&&(n[s]=i.content.getContent()[i.length-1])}),n},Oo=t=>$k(t.entries(),e=>!e[1].deleted);class bN extends bo{constructor(e,n){super(e,n),this._transaction=n}}class Wt extends ce{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Wt;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Wt}clone(){const e=new Wt;return e.insert(0,this.toArray().map(n=>n instanceof ce?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,n){super._callObserver(e,n),So(this,e,new bN(this,e))}insert(e,n){this.doc!==null?Q(this.doc,r=>{vg(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Q(this.doc,n=>{wN(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Q(this.doc,r=>{Rg(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return Ag(this,e)}toArray(){return Tg(this)}slice(e=0,n=this.length){return wg(this,e,n)}toJSON(){return this.map(e=>e instanceof ce?e.toJSON():e)}map(e){return bg(this,e)}forEach(e){$s(this,e)}[Symbol.iterator](){return _N(this)}_write(e){e.writeTypeRef(VN)}}const AN=t=>new Wt;class SN extends bo{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Ht extends ce{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Ht}clone(){const e=new Ht;return this.forEach((n,r)=>{e.set(r,n instanceof ce?n.clone():n)}),e}_callObserver(e,n){So(this,e,new SN(this,e,n))}toJSON(){const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];e[r]=s instanceof ce?s.toJSON():s}}),e}get size(){return[...Oo(this._map)].length}keys(){return tl(Oo(this._map),e=>e[0])}values(){return tl(Oo(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return tl(Oo(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Q(this.doc,n=>{Ro(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Q(this.doc,r=>{dl(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return pl(this,e)}has(e){return kg(this,e)}clear(){this.doc!==null?Q(this.doc,e=>{this.forEach(function(n,r,s){Ro(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(zN)}}const vN=t=>new Ht,Pn=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&_k(t,e);class gl{constructor(e,n,r,s){this.left=e,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Gt(),this.right.content.constructor){case _e:this.right.deleted||$r(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Ng=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case _e:e.right.deleted||$r(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&xn(t,j(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ko=(t,e,n,r)=>{const s=new Map,i=r?Ao(e,n):null;if(i){const o=new gl(i.p.left,i.p,i.index,s);return Ng(t,o,n-i.index)}else{const o=new gl(null,e._start,0,s);return Ng(t,o,n)}},Cg=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===_e&&Pn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=t.doc,i=s.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new we(j(i,Se(s.store,i)),c,c&&c.lastId,l,l&&l.id,e,null,new _e(a,o));u.integrate(t,0),n.right=u,n.forward()})},$r=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Ig=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===_e&&Pn(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Lg=(t,e,n,r)=>{const s=t.doc,i=s.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Pn(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new we(j(i,Se(s.store,i)),u,u&&u.lastId,h,h&&h.id,e,null,new _e(a,c)),n.right.integrate(t,0),n.forward()}}return o},ml=(t,e,n,r,s)=>{n.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});const i=t.doc,o=i.clientID;Ig(n,s);const a=Lg(t,e,n,s),c=r.constructor===String?new zt(r):r instanceof ce?new gn(r):new cr(r);let{left:l,right:u,index:h}=n;e._searchMarker&&Ds(e._searchMarker,n.index,c.getLength()),u=new we(j(o,Se(i.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=h,n.forward(),Cg(t,e,n,a)},Mg=(t,e,n,r,s)=>{const i=t.doc,o=i.clientID;Ig(n,s);const a=Lg(t,e,n,s);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===_e));){if(!n.right.deleted)switch(n.right.content.constructor){case _e:{const{key:c,value:l}=n.right.content,u=s[c];if(u!==void 0){if(Pn(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&xn(t,j(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new we(j(o,Se(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new zt(c)),n.right.integrate(t,0),n.forward()}Cg(t,e,n,a)},xg=(t,e,n,r,s)=>{let i=e;const o=St();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===_e){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;e!==i;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case _e:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(t),a++,!c&&(s.get(u)??null)===h&&d!==h&&(d===null?s.delete(u):s.set(u,d))),!c&&!e.deleted&&$r(s,l);break}}}e=e.right}return a},RN=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===_e){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},ON=t=>{let e=0;return Q(t.doc,n=>{let r=t._start,s=t._start,i=St();const o=Fc(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case _e:$r(o,s.content);break;default:e+=xg(n,r,s,i,o),i=Fc(o),r=s;break}s=s.right}}),e},kN=t=>{const e=new Set,n=t.doc;for(const[r,s]of t.afterState.entries()){const i=t.beforeState.get(r)||0;s!==i&&fg(t,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===_e&&o.constructor!==Je&&e.add(o.parent)})}Q(n,r=>{Yp(t,t.deleteSet,s=>{if(s instanceof Je||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===_e?e.add(i):RN(r,s)});for(const s of e)ON(s)})},Ug=(t,e,n)=>{const r=n,s=Fc(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case gn:case cr:case zt:n<e.right.length&&xn(t,j(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&xg(t,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Ds(o._searchMarker,e.index,-r+n),e};class NN extends bo{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Q(e,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((p,E)=>{p!==null&&(f.attributes[E]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},mk(c)||(f.attributes=dk({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case gn:case cr:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case zt:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case _e:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const E=s.get(f)??null;Pn(E,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Pn(p,i.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){i.set(f,p);const E=s.get(f)??null;Pn(E,p)||(a==="retain"&&d(),c[f]=E)}else if(!o.deleted){i.set(f,p);const E=c[f];E!==void 0&&(Pn(E,p)?E!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),$r(s,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Rt extends ce{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Rt}clone(){const e=new Rt;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new NN(this,e,n);So(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===zt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Q(this.doc,r=>{const s=new gl(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ml(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Mg(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Ug(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){const s=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;i.forEach((p,E)=>{d=!0,h[E]=p});const f={insert:a};d&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(Dr(c,e)||n!==void 0&&Dr(c,n))switch(c.content.constructor){case zt:{const h=i.get("ychange");e!==void 0&&!Dr(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Dr(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case gn:case cr:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((f,p)=>{d[p]=f})}s.push(h);break}case _e:Dr(c,e)&&(l(),$r(i,c.content));break}c=c.right}l()};return e||n?Q(o,h=>{e&&ol(h,e),n&&ol(h,n),u()},"cleanup"):u(),s}insert(e,n,r){if(n.length<=0)return;const s=this.doc;s!==null?Q(s,i=>{const o=ko(i,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),ml(i,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const s=this.doc;s!==null?Q(s,i=>{const o=ko(i,this,e,!r);ml(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Q(r,s=>{Ug(s,ko(s,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const s=this.doc;s!==null?Q(s,i=>{const o=ko(i,this,e,!1);o.right!==null&&Mg(i,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Q(this.doc,n=>{Ro(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Q(this.doc,r=>{dl(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return pl(this,e)}getAttributes(){return Og(this)}_write(e){e.writeTypeRef(YN)}}const CN=t=>new Rt;class yl{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===pn||n.constructor===Vt)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Vt extends ce{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Vt}clone(){const e=new Vt;return e.insert(0,this.toArray().map(n=>n instanceof ce?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new yl(this,e)}querySelector(e){e=e.toUpperCase();const r=new yl(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Cn(new yl(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){So(this,e,new MN(this,n,e))}toString(){return bg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),$s(this,i=>{s.insertBefore(i.toDOM(e,n,r),null)}),s}insert(e,n){this.doc!==null?Q(this.doc,r=>{vg(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Q(this.doc,r=>{const s=e&&e instanceof ce?e._item:e;vo(r,this,s,n)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw Ln("Reference item not found");r.splice(s,0,...n)}}delete(e,n=1){this.doc!==null?Q(this.doc,r=>{Rg(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return Tg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Ag(this,e)}slice(e=0,n=this.length){return wg(this,e,n)}forEach(e){$s(this,e)}_write(e){e.writeTypeRef(XN)}}const IN=t=>new Vt;class pn extends Vt{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new pn(this.nodeName)}clone(){const e=new pn(this.nodeName),n=this.getAttributes();return gk(n,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof ce?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?Q(this.doc,n=>{Ro(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Q(this.doc,r=>{dl(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return pl(this,e)}hasAttribute(e){return kg(this,e)}getAttributes(e){return e?TN(this,e):Og(this)}toDOM(e=document,n={},r){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return $s(this,o=>{s.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(qN),e.writeKey(this.nodeName)}}const LN=t=>new pn(t.readKey());class MN extends bo{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Fr extends Ht{constructor(e){super(),this.hookName=e}_copy(){return new Fr(this.hookName)}clone(){const e=new Fr(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(JN),e.writeKey(this.hookName)}}const xN=t=>new Fr(t.readKey());class ar extends Rt{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ar}clone(){const e=new ar;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{const n=[];for(const s in e.attributes){const i=[];for(const o in e.attributes[s])i.push({key:o,value:e.attributes[s][o]});i.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(QN)}}const UN=t=>new ar;class El{constructor(e,n){this.id=e,this.length=n}get deleted(){throw jt()}mergeWith(e){return!1}write(e,n,r){throw jt()}integrate(e,n){throw jt()}}const PN=0;class Je extends El{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),ug(e.doc.store,this)}write(e,n){e.writeInfo(PN),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Fs{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Fs(this.content)}splice(e){throw jt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const DN=t=>new Fs(t.readBuf());class Bs{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Bs(this.len)}splice(e){const n=new Bs(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){yo(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const $N=t=>new Bs(t.readLen()),Pg=(t,e)=>new dn({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class js{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new js(Pg(this.doc.guid,this.opts))}splice(e){throw jt()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const FN=t=>new js(Pg(t.readString(),t.readAny()));class cr{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new cr(this.embed)}splice(e){throw jt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const BN=t=>new cr(t.readJSON());class _e{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new _e(this.key,this.value)}splice(e){throw jt()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const jN=t=>new _e(t.readKey(),t.readJSON());class No{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new No(this.arr)}splice(e){const n=new No(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const GN=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const s=t.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new No(n)};class lr{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new lr(this.arr)}splice(e){const n=new lr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}const KN=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new lr(n)};class zt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new zt(this.str)}splice(e){const n=new zt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const WN=t=>new zt(t.readString()),HN=[AN,vN,CN,LN,IN,xN,UN],VN=0,zN=1,YN=2,qN=3,XN=4,JN=5,QN=6;class gn{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new gn(this.type._copy())}splice(e){throw jt()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const ZN=t=>new gn(HN[t.readTypeRef()](t)),Co=(t,e,n)=>{const{client:r,clock:s}=e.id,i=new we(j(r,s+n),e,j(r,s+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=j(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class we extends El{constructor(e,n,r,s,i,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Rp:0}set marker(e){(this.info&Gc)>0!==e&&(this.info^=Gc)}get marker(){return(this.info&Gc)>0}get keep(){return(this.info&vp)>0}set keep(e){this.keep!==e&&(this.info^=vp)}get countable(){return(this.info&Rp)>0}get deleted(){return(this.info&jc)>0}set deleted(e){this.deleted!==e&&(this.info^=jc)}markDeleted(){this.info|=jc}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Se(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Se(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Pr&&this.id.client!==this.parent.client&&this.parent.clock>=Se(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=hg(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=xn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Je||this.right&&this.right.constructor===Je)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===we&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===we&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Pr){const r=al(n,this.parent);r.constructor===Je?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=hg(e,e.doc.store,j(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Eo(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Eo(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(al(e.doc.store,s.origin)))i.has(al(e.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ug(e.doc.store,this),this.content.integrate(e,this),pg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Je(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:j(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Eo(e.origin,this.lastId)&&this.right===e&&Eo(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),yo(e.deleteSet,this.id.client,this.id.clock,this.length),pg(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Gt();this.content.gc(e),n?iN(e,this,new Je(this.id,this.length)):this.content=new Bs(this.length)}write(e,n){const r=n>0?j(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&ho|(r===null?0:Xe)|(s===null?0:un)|(i===null?0:ks);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=sN(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Pr?(e.writeParentInfo(!1),e.writeLeftID(a)):Gt();i!==null&&e.writeString(i)}this.content.write(e,n)}}const Dg=(t,e)=>e0[e&ho](t),e0=[()=>{Gt()},$N,GN,DN,WN,BN,jN,ZN,KN,FN,()=>{Gt()}],t0=10;class ft extends El{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Gt()}write(e,n){e.writeInfo(t0),$(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const $g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Fg="__ $YJS$ __";$g[Fg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),$g[Fg]=!0;let _l,wl,n0=t=>t();function r0(t,e){if(wl)return wl(t,e);n0(t)}function ur(t,e,n){if(_l)return _l.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function s0(t){_l=function(e,n,r){const s=t.createAtom(e);return n&&n(),s},wl=(e,n)=>t.reaction(e,n,{fireImmediately:!1})}const Bg=new WeakSet;function i0(t){if(Bg.has(t))return t;Bg.add(t);let e;const n=new Map;function r(){if(!e){const h=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&e.reportChanged()};e=ur("map",()=>{t.observe(h)},()=>{t.unobserve(h)})}e.reportObserved(t._implicitObserver)}function s(h){let d=n.get(h);if(!d){const f=p=>{d.reportChanged()};d=ur(h+"",()=>{t.observe(f)},()=>{t.unobserve(f)}),n.set(h,d)}d.reportObserved(t._implicitObserver)}const i=t.get;t.get=function(h){if(typeof h!="number")throw new Error("unexpected");return s(h),Reflect.apply(i,this,arguments)};function o(h){const d=t[h];t[h]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(h){let d=t,f=Object.getOwnPropertyDescriptor(d,h);if(f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),!f)throw new Error("property not found");const p=f.get;f.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(t,h,f)}function c(h,d){let f=t,p=Object.getOwnPropertyDescriptor(f,h);if(p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),!p)throw new Error("property not found");Object.defineProperty(t,d,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=t.push;t.push=function(h){this._disableTracking=!0;const d=l.call(this,h);return this._disableTracking=!1,d};const u=t.slice;return t.slice=function(h,d){this._disableTracking=!0;const f=u.call(this,h,d);return this._disableTracking=!1,f},t}const jg=new WeakSet;function o0(t){if(jg.has(t))return t;jg.add(t);let e;function n(){if(!e){let i=Array.from(t.share.keys());const o=a=>{const c=Array.from(t.share.keys());JSON.stringify(i)!==JSON.stringify(c)&&(i=c,e.reportChanged())};e=ur("map",()=>{t.on("beforeObserverCalls",o)},()=>{t.off("beforeObserverCalls",o)})}e.reportObserved(t._implicitObserver)}const r=t.get;t.get=function(i){if(typeof i!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return Io(o),o};function s(i){const o=t[i];let a;t[i]=function(){let c,l=arguments;return n(),a&&a.removeObservers(),a=r0(()=>(c=Reflect.apply(o,t,l),c),()=>e.reportChanged()),c}}return s("toJSON"),Object.defineProperty(t,"keys",{get:()=>(n(),Object.keys(t.share))}),t}const Gg=new WeakSet;function a0(t){if(Gg.has(t))return t;Gg.add(t);let e;const n=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=ur("map",()=>{t.observe(a)},()=>{t.unobserve(a)})}e.reportObserved(t._implicitObserver)}function s(a){let c=n.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=ur(a,()=>{t.observe(l)},()=>{t.unobserve(l)}),n.set(a,c)}c.reportObserved(t._implicitObserver)}const i=t.get;t.get=function(a){if(typeof a!="string")throw new Error("unexpected");return s(a),Reflect.apply(i,this,arguments)};function o(a){const c=t[a];t[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),t}const Kg=new WeakSet;function Wg(t){if(Kg.has(t))return t;Kg.add(t);let e;const n=s=>{e.reportChanged()};e=ur("text",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(s){const i=t[s];t[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(i,this,arguments)}}return r("toString"),r("toJSON"),t}const Hg=new WeakSet;function Vg(t){if(Hg.has(t))return t;Hg.add(t);let e;const n=i=>{(i.changes.added.size||i.changes.deleted.size||i.changes.keys.size||i.changes.delta.length)&&e.reportChanged()};e=ur("xml",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(i){const o=t[i];t[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function s(i){let o=t,a=Object.getOwnPropertyDescriptor(o,i);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,i)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,i)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(t,i,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),s("firstChild"),t}function Io(t){return t instanceof ar||t instanceof Rt?Wg(t):t instanceof Wt?i0(t):t instanceof Ht?a0(t):t instanceof dn||Object.prototype.hasOwnProperty.call(t,"autoLoad")?o0(t):t instanceof Vt||t instanceof pn?Vg(t):t}function zg(t){t.share.forEach(e=>{e.constructor!==ce&&Io(e)})}function Yg(t,e){for(let r=t.length-1;r>=e;r--){let s=t[r];if(!s.deleted){var n;if(s instanceof Je)continue;(n=s.content)==null||n.getContent().forEach(i=>{i instanceof ce&&Io(i)})}}}const qg=new WeakSet;function c0(t){qg.has(t)||(qg.add(t),Io(t),t.store.clients.forEach(e=>{e&&Yg(e,0)}),zg(t),t.on("beforeObserverCalls",e=>{zg(t),e.afterState.forEach((n,r)=>{const s=e.beforeState.get(r)||0;if(s!==n){const i=e.doc.store.clients.get(r);if(!i)return;const o=vt(i,s);Yg(i,o)}})}))}class Gs{constructor(e){this.value=void 0,this.value=e}}function l0(t){return ArrayBuffer.isView(t)?new Gs(t):new Gs(Object.freeze(t))}function u0(t){const e=function(){var a;let c=(a=this[lt])==null?void 0:a.implicitObserver;return t._implicitObserver=c,t.slice.bind(t).apply(t,arguments).map(u=>{const h=Lo(u,c);return c&&typeof h=="object"?Os(h,c):h})},n=function(a){return a.map(c=>{const l=Tl(c);let u=Br(l)||l;if(u instanceof Gs&&(u=u.value),u instanceof ce&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},s={slice:e,unshift:(...o)=>(t.unshift(n(o)),t.lengthUntracked),push:(...o)=>(t.push(n(o)),t.lengthUntracked),insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>g0(a,o))},splice:function(){let o=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return t.doc?t.doc.transact(()=>{t.delete(o,a),t.insert(o,n(c))}):(t.delete(o,a),t.insert(o,n(c))),l}},i=[];for(let o in s)i[o]=s[o];return i}function Ks(t){if(typeof t=="string"&&t.trim().length){const e=Number(t);if(Number.isInteger(e))return e}return t}function Xg(t,e=new Wt){if(e[Ee])throw new Error("unexpected");const n=u0(e),r=new Proxy(n,{set:(s,i,o)=>{throw typeof Ks(i)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(s,i,o)=>{const a=Ks(i);if(a===Mo)return e;if(typeof a=="number"){let u;if(o&&o[lt]){var c;u=(c=o[lt])==null?void 0:c.implicitObserver,e._implicitObserver=u}let h=e.get(a);return h=Lo(h,u),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=e.slice();return Reflect.get(u,a)}return a==="length"?e.length:Reflect.get(s,a,o)},deleteProperty:(s,i)=>{const o=Ks(i);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(s,i)=>{const o=Ks(i);return typeof o!="number"?Reflect.has(s,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(s,i){const o=Ks(i);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:s=>{const i=[];for(let o=0;o<e.length;o++)i.push(o+"");return i.push("length"),i}});return n.push.apply(r,t),r}function Jg(t,e=new Ht){if(e[Ee])throw new Error("unexpected");const n=new Proxy({},{set:(r,s,i)=>{if(typeof s!="string")throw new Error;const o=Tl(i);let a=Br(o)||o;if(a instanceof Gs&&(a=a.value),a instanceof ce&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(s,a),!0},get:(r,s,i)=>{if(s===Mo)return e;if(typeof s!="string")return Reflect.get(r,s);let o;if(i&&i[lt]){var a;o=(a=i[lt])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(s);return c=Lo(c,o),c},deleteProperty:(r,s)=>{if(typeof s!="string")throw new Error;return e.has(s)?(e.delete(s),!0):!1},has:(r,s)=>!!(typeof s=="string"&&e.has(s)),getOwnPropertyDescriptor(r,s){if(typeof s=="string"&&e.has(s))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});Ws.set(e,n);for(let r in t)n[r]=t[r];return n}function h0(t){return t instanceof ce}const Ws=new WeakMap;function Lo(t,e){if(h0(t)){if(t._implicitObserver=e,t instanceof Wt||t instanceof Ht){if(!Ws.has(t)){const n=Tl(t);Ws.set(t,n)}t=Ws.get(t)}else if(t instanceof pn||t instanceof Vt||t instanceof ar||t instanceof Fr||t instanceof Rt)Dc(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return l0(t)}return t}function Tl(t){if(t==null)return t;if(t=Br(t)||t,t instanceof Wt)return Xg([],t);if(t instanceof Ht)return Jg({},t);if(typeof t=="string")return t;if(Array.isArray(t))return Xg(t);if(t instanceof pn||t instanceof Vt||t instanceof ar||t instanceof Fr)return t;if(t instanceof Rt)return t;if(typeof t=="object")return t instanceof Gs?t:Jg(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function f0(t){for(let[e,n]of Object.entries(t))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function Qg(t,e,n){let r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function d0(t,e){if(t[Ee])throw new Error("unexpected");f0(e);const n=new Proxy({},{set:(r,s,i)=>{throw typeof s!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,s,i)=>{if(s===Mo)return t;if(typeof s!="string")return Reflect.get(r,s);let o;if(i&&i[lt]){var a;o=(a=i[lt])==null?void 0:a.implicitObserver,t._implicitObserver=o}if(s==="toJSON"){for(let u of Object.keys(e))Qg(t,e,u);return Reflect.get(t,s)}let c=Qg(t,e,s);return c=Lo(c,o),c},deleteProperty:(r,s)=>{throw new Error("deleteProperty not available for doc")},has:(r,s)=>!!(typeof s=="string"&&t.share.has(s)),getOwnPropertyDescriptor(r,s){if(typeof s=="string"&&t.share.has(s)||s==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.share.keys())});return Ws.set(t,n),n}s0(MO);const Mo=Symbol("INTERNAL_SYMBOL");function p0(t){const e=Br(t);if(!(e instanceof dn))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function Br(t){if(typeof t!="object"||t===null)return;const e=t[Mo];return e&&(Dc(e),e.__v_skip=!0),e}function g0(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){const n=Br(t),r=Br(e);return!n||!r?!1:n===r}return!1}function m0(t,e=new dn){return c0(e),d0(e,t)}const xo=0,Zg=1,em=2,tm=(t,e)=>{$(t,xo);const n=nN(e);Ie(t,n)},bl=(t,e,n)=>{$(t,Zg),Ie(t,Qk(e,n))},y0=(t,e,n)=>bl(e,n,$e(t)),nm=(t,e,n)=>{try{qk(e,$e(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},rm=(t,e)=>{$(t,em),Ie(t,e)},E0=nm,sm=(t,e,n,r)=>{const s=F(t);switch(s){case xo:y0(t,e,n);break;case Zg:nm(t,n,r);break;case em:E0(t,n,r);break;default:throw new Error("Unknown message type")}return s},Al=m0({shared:[]});function _0(t,e,n){return t.find(r=>r.key===e&&r.type===n)}function w0(t,e,n){const r=_0(Al.shared,t,e);y(r)||Al.shared.push({key:t,type:e,value:n})}function T0(t,e){const n=new Rt(e);w0(t,1,n)}function Uo(t){return ht(t)}let im=!1;const Dn=p0(Al),mn=pr("modem",["second"],t=>{switch(t.target){case"second":!im&&t.data%2===0&&mn.emit("modem:join");break;case"join":if(t.sender!==mn.id()){mn.reply(t,"joinack");const e=ut();tm(e,Dn),mn.reply(t,"sync",Uo(e));const n=ut();bl(n,Dn),mn.reply(t,"sync",Uo(n))}break;case"joinack":im=!0;break;case"sync":{if(y(t.data)&&t.sender!==mn.id()){const e=Mn(t.data),n=ut();sm(e,n,Dn,mn)===xo&&mn.emit("modem:sync",Uo(n))}break}}});function om(t){const e=ut();rm(e,t),mn.emit("modem:sync",Uo(e))}Dn.on("update",om),Dn.on("destroy",()=>{Dn==null||Dn.off("update",om)});const b0=navigator.userAgent.indexOf("Mac")!==-1?"cmd":"ctrl",yn="$dkpurple",A0="$196",am="$205";function Ot(t,e){return`$${t}${e}$blue`}function cm(t,e){return`$${t}${e}$ondkblue`}function dt(t){Kn("cli",t)}function Hs(t){const e=A0.repeat(t.length+2),n=am.repeat(t.length+2);dt(`${yn} ${" ".repeat(t.length)} `),dt(`${yn}${e}`),dt(`${yn} $white${t} `),dt(`${yn}${n}`)}function $n(t){const e=am.repeat(t.length+2);dt(`${yn} ${" ".repeat(t.length)} `),dt(`${yn} $gray${t} `),dt(`${yn}${e}`)}function Y(t,e){dt(`${yn} $white${t} $blue${e}`)}function H(t){dt(`${yn} $blue${t}`)}let hr="";const S0=Ss({get(t,e){const n=z(t.id()),r=wd(n.book,n.player,e);return[y(r),r]},set(t,e,n){const r=z(t.id());return Td(r.book,r.player,e,n),[!0,n]},shouldtick(){},tick(){},tock(){}}).command("help",()=>(Hs("H E L P"),Y("#1","zss controls and inputs"),Y("#2","text formatting"),Y("#3","edit commands"),Y("#4","player settings"),$n("keyboard input"),Y("?","open console"),Y("esc","close console"),Y("tab","move console"),Y("up / down arrow keys","navigate console items"),Y("left / right arrow keys","change console items"),Y("enter","interact with console items"),Y("alt + arrow keys","skip words and console lines"),Y(`${b0} + up / down arrow keys`,"input history"),0)).command("1",()=>(Hs("zss controls and inputs"),$n("keyboard input"),Y("arrow keys","move"),Y("shift + arrow keys","shoot"),Y("enter","ok / accept"),Y("escape","cancel / close"),Y("tab","menu / action"),$n("mouse input"),H("todo ???"),$n("controller input"),Y("left stick","move"),Y("right stick","aim"),Y("a","ok / accept"),Y("b","cancel / close"),Y("y","menu / action"),Y("x","shoot"),Y("triggers","shoot"),0)).command("2",()=>(Hs("text formatting"),$n("typography"),H("plain text"),H("$centering text"),H('"\\"@quoted strings for special chars\\""'),H("$$0-255 for ascii chars $159$176$240"),H(`use color names like ${Ot("red","$$red")} to change foreground color`),H(`use color names like ${cm("ongreen","$$ongreen")} to change background color`),H(`use clear ${cm("clear","to change background to")} transparent`),$n("hyperlinks"),H(`${Ot("white",'"!hotkey"')} message shortcut;${Ot("gray","Label")}`),H(`${Ot("white",'"!range"')} flag [labelmin] [labelmax];${Ot("gray","Input Label")}`),H(`${Ot("white",'"!select"')} flag ...list of values;${Ot("gray","Input Label")}`),H(`${Ot("white",'"!number"')} flag [minvalue] [maxvalue];${Ot("gray","Input Label")}`),H(`${Ot("white",'"!text"')} flag;${Ot("gray","Input Label")}`),0)).command("3",()=>(Hs("edit commands"),Y("#books","list books in memory"),Y("#pages","list pages in opened book"),Y("@[pagetype:]page name","create & edit a new codepage in the currently opened book"),0)).command("4",()=>(Hs("player settings"),H("todo"),0)).command("text",(t,e)=>{const n=z(t.id()),r=e.map(qe).join(" ");return Kn("$2",`${n.player}: ${r}`),0}).command("hyperlink",(t,e)=>{const n=z(t.id()),[r,...s]=e,i=qe(r),o=s.map(qe).join(" ");return Kn("$2",`!${o};${n.player}: ${i}`),0}).command("books",()=>{$n("books");const t=tR();return t.length?t.forEach(e=>{dt(`!bookopen ${e.id};${e.name}`)}):H("no books found"),dt("!bookcreate;create a new book"),0}).command("pages",t=>{$n("pages");const e=an(hr);return y(e)?e.pages.length?e.pages.forEach(n=>{const r=Wi(n);dt(`!pageopen ${n.id};${r}`)}):(H("no pages found"),H("use @ to create a page"),H("@board Name of board"),H("@terrain Name of terrain"),H("@charset Name of charset"),H("@palette Name of palette"),H("You can omit the type and it will default to object"),H("@object Name of object"),H("@Name of object")):(H("no book currently open"),t.command("books")),0}).command("stat",(t,e)=>{let n=an(hr);const[r]=e,s=qe(r);if(/^book /gi.test(s)){const i=s.substring(5);if(n=an(i),!y(n)&&(n=dc([]),n.name=i,hr=n.id,yc(n),H(`created and opened ${n.name}`),!y(n)))return 0}else{if(!y(n)&&(n=dc([]),hr=n.id,yc(n),H(`created and opened ${n.name}`),!y(n)))return 0;const i=z(t.id()),o=`@${s}
`;let a=Bv(o,{});const c=Wi(a),l=yd(a),u=Hi(n,fc(a),c);y(u)?(a=u,H(`opened ${c} of type ${l}`)):(Wv(n,a),H(`created ${c} of type ${l}`)),T0(a.id,o),vy("cli",hr,a.id,yd(a),`@book ${n.name}:${c}`,i.player)}return 0}).command("send",(t,e)=>{const n=z(t.id()),r=I(t,e),[s,i]=k(r,0,[R.STRING,R.ANY]);switch(s){case"bookcreate":{const o=dc([]);hr=o.id,yc(o),H(`created and opened ${o.name}`);break}case"bookopen":if(te(i)){const o=an(i);y(o)?(hr=i,H(`opened book ${o.name}`)):bn("cli","bookopen",`book with id ${i} not found`,n.player)}else bn("cli","bookopen",`expected book id, got: ${i} instead`,n.player);break;default:Kn("$2",`${s} ${i??""}`);break}return 0});var lm={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(t){(function(){var e=function(f,p){return p=p||"",f.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=e("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+e("DF-F6,F8-FF","00"),s="A-Z"+e("C0-D6,D8-DE","00"),i="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,p,E,A){return f=f||n,p=p||r,E=E||s,A=A||i,{capitalize:new RegExp("(^|["+f+"])(["+p+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+p+E+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+A+")\\b","g"),relax:new RegExp("([^"+E+"])(["+E+"]*)(["+E+"])(?=[^"+E+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:e,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,p,E){return p!=null&&(f=f.replace(a.fill,function(A,S){return S?p+S:""})),E&&(f=c.deapostrophe(f)),f},prep:function(f,p,E,A){if(f=f==null?"":f+"",!A&&a.upper.test(f)&&(f=c.low.call(f)),!p&&!a.hole.test(f)){var S=c.fill(f," ");a.hole.test(S)&&(f=S)}return!E&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,p,E,A){return p+" "+(E?E+" ":"")+A}},l={_:c,of:function(f){for(var p=0,E=c.types.length;p<E;p++)if(l[c.types[p]].apply(l,arguments)===f)return c.types[p]},flip:function(f){return f.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(f){return f.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(f,p){l[f]=p,c.types.push(f)}},u={lower:function(f,p,E){return c.fill(c.low.call(c.prep(f,p)),p,E)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,p,E){return c.fill(c.up.call(c.prep(f,p,!1,!0)),p,E)},capital:function(f,p,E){return c.fill(c.prep(f).replace(a.capitalize,function(A,S,b){return S+c.up.call(b)}),p,E)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(p,E,A){return c.up.call(A)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(p,E,A,S){return A>0&&A<S.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(f,p,E){return f=l.lower(f).replace(a.sentence,function(A,S,b){return S+c.up.call(b)}),p&&p.forEach(function(A){f=f.replace(new RegExp("\\b"+l.lower(A)+"\\b","g"),c.cap)}),E&&E.forEach(function(A){f=f.replace(new RegExp("(\\b"+l.lower(A)+"\\. +)(\\w)"),function(S,b,w){return b+c.low.call(w)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(t.exports?t.exports=l:this.Case=l)}).call(Ze)})(lm);var v0=lm.exports,R0=qs(v0);const jr={},Sl={},vl={},Vs={},Yt=pr("shared",["second"],t=>{switch(t.target){case"second":Object.keys(vl).forEach(e=>{const n=Vs[e];n===void 0?Yt.emit("shared:join",e):n<10?Vs[e]=n+1:delete Vs[e]}),Object.keys(Sl).forEach(e=>{Yt.emit("shared:active",e)});break;case"join":{const e=t.data,n=jr[e];if(n&&Sl[e]){Yt.reply(t,"joinack",e);const r=ut();tm(r,n),Yt.reply(t,"sync",Do(e,r));const s=ut();bl(s,n),Yt.reply(t,"sync",Do(e,s))}break}case"joinack":{const e=t.data;jr[e]&&vl[e]&&(Vs[e]=0);break}case"active":{const e=t.data;jr[e]&&vl[e]&&(Vs[e]=0);break}case"sync":{const[e,n,r]=t.data,s=jr[n];if(s&&e!==Yt.id()){const i=Mn(r),o=ut();if(sm(i,o,s,Yt)===xo){const c=Do(n,o);Yt.emit("shared:sync",c)}}break}}});function O0(t){let e=jr[t];if(e)return e;jr[t]=e=new dn({guid:t});function n(r){const s=ut();rm(s,r),Yt.emit("shared:sync",Do(t,s))}return e.on("update",n),e.on("destroy",()=>{e==null||e.off("update",n)}),e}function Po(t){return O0(t).getMap()}function Do(t,e){const n=ht(e);return[Yt.id()??"",t,n]}function um(t,e){const n=t.get(e);return n!=null&&n.toJSON?n.toJSON():n}function hm(t,e,n){typeof n=="string"?t.set(e,new Rt(n)):t.set(e,n)}function k0(t,e,n){Sl[t]=!0;const r=Po(t);r.get(e)===void 0&&n!==void 0&&hm(r,e,n)}function N0(t,e,n){const r=Po(t),s=um(r,e);(s===void 0||n!==s)&&hm(r,e,n)}function C0(t,e,n){const r=Po(t);function s(){n(um(r,e))}function i(o){o.keysChanged.has(e)&&s()}return s(),r.observe(i),()=>{r.unobserve(i)}}function I0(t,e,n){const r=Po(t);let s=r.get(e);function i(){n(s)}function o(c){c.keysChanged.has(e)&&s===void 0&&a(),s&&r.unobserve(o)}function a(){s=r.get(e),s?(s.observeDeep(i),i()):r.observe(o)}return a(),()=>{s?s.unobserveDeep(i):r.unobserve(o)}}const Fn={};function fm(t,e){return t.player=e,t.layers=[],t.layout=[],t.layoutreset=!0,t.layoutfocus="scroll",t}function dm(t){t.text=[],Object.values(Fn[t.id]??{}).forEach(e=>e==null?void 0:e()),Fn[t.id]={}}function pm(t){const e=t.layout.find(n=>n.name===t.layoutfocus);if(!e){const n={id:Tn(),name:t.layoutfocus,edge:et.RIGHT,size:20,text:[]};return t.layout.push(n),t.layoutreset=!1,n}return e}const Rl={},L0=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),M0=new Set(["rn","range","sl","select","nm","number","tx","text"]),x0=new Set(["tx","text"]),U0={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""};function fr(t){let e=Rl[t];return y(e)?e:Rl[t]=e=fm({},t)}function P0(){return Object.keys(Rl)}function D0(t){const e=fr(t);e.layout=e.layout.filter(n=>n.edge!==et.SCROLL)}function $0(t,e,n){Object.values(Fn).forEach(r=>{r[e]!==void 0&&N0(t.id(),e,n)})}function F0(t){const e=fr(t.id());e.layout=e.layout.filter(n=>n.edge!==et.SCROLL||n.text.length>0)}function Ol(t,e,n,r,s){const i=fr(t.id()),o=r,a=s??R0.capital(e),c=i.layout.find(l=>l.name===a);if(c)i.layoutreset=!0,i.layoutfocus=a,ke(o)&&(c.size=o);else switch(n){case et.START:fm(i,t.id());break;case et.LEFT:case et.RIGHT:case et.TOP:case et.BOTTOM:case et.SCROLL:{const l={id:Tn(),name:a,edge:n,size:o??my[n],text:[]};i.layout.push(l),i.layoutfocus=a;break}}}function B0(t,e){const n=fr(t.id()),r=pm(n);n.layoutreset&&(n.layoutreset=!1,dm(r)),r.text.push(e)}function j0(t,e,n,r){const s=fr(t.id()),i=pm(s);s.layoutreset&&(s.layoutreset=!1,dm(i));const o=n.toLowerCase(),a=[t.id(),e,...L0.has(o)?[o]:["hyperlink",n],...r],c=a[2];if(M0.has(c)){const l=`${a[3]??""}`;Fn[i.id]=Fn[i.id]??{};const u=t.get(l);Fn[i.id][l]===void 0&&(k0(t.id(),l,u??U0[c]),x0.has(c)?Fn[i.id][l]=I0(t.id(),l,h=>{if(h!==void 0){const d=h.toJSON();d!==t.get(l)&&t.set(l,d)}}):Fn[i.id][l]=C0(t.id(),l,h=>{h!==void 0&&h!==t.get(l)&&t.set(l,h)}))}i.text.push(a)}const G0=Ss({get(){return[!1,void 0]},set(t,e,n){return $0(t,e,n),[!1,void 0]},shouldtick(){},tick(t){var r;const e=z(t.id());let n="scroll";y((r=e.object)==null?void 0:r.name)&&(n=e.object.name),Ol(t,"scroll",et.SCROLL,void 0,n)},tock(t){F0(t)}}).command("gadget",(t,e)=>{const n=I(t,e),[r]=k(n,0,[R.STRING]),s=gy[r.toLowerCase()];if(s===et.SCROLL){const[,i,o]=k(n,0,[R.STRING,R.MAYBE_STRING,R.MAYBE_NUMBER]);Ol(t,r,s,o,i)}else{const[,i,o]=k(n,0,[R.STRING,R.MAYBE_NUMBER,R.MAYBE_STRING]);Ol(t,r,s,i,o)}return 0}).command("frame",(t,e)=>{var c;const n=z(t.id()),[r,s,i]=k(I(t,e),0,[R.STRING,R.MAYBE_STRING,R.MAYBE_STRING]),o=((c=n.board)==null?void 0:c.id)??"",a=r.toLowerCase();if(a==="reset")vd(o);else if(y(s)&&y(i))switch(s.toLowerCase()){case"edit":eR(o,a,i);break;case"view":Zv(o,a,i);break}return 0}).command("text",(t,e)=>{const n=e.map(qe).join("");return B0(t,n),0}).command("hyperlink",(t,e)=>{const[n,r,...s]=e,i=qe(n),o=qe(r);return j0(t,i,o,s),0});function kl(t,e){if(!(!y(t)||!y(e))){y(t.stats)||(t.stats={});for(const[n,r]of Object.entries(e)){const s=n.toLowerCase();t.stats[s]=r}}}function K0(t,e,n,r){if(y(t)&&y(e)&&y(n)){const[s,i]=n,o=Vi(t,s);if(y(o)&&y(o.name)){const a=nu(e,r,s);return y(a)&&(a.headless=!0,ei(a,i),gc(t,e,a)),a}}}function $o(t,e,n,r){if(y(t)&&y(e)&&y(n)){const[s,i]=n,o=Ed(t,s);if(y(o)){const c=tu(e,r,s);ei(c,i);const l=r.x+r.y*e.width;return gc(t,e,c,l),c}const a=Vi(t,s);if(y(a)&&y(a.name)){const c=nu(e,r,s);return ei(c,i),Yv(t,e,c),gc(t,e,c),c}}}const gm=new Set(["cycle","player","sender","inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu","data"]),W0=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]);function H0(t){const e=ru[t];if(y(e))return e;const n=au[t];if(y(n))return n;const r=sa[t];if(y(r))return r;const s=_u[t];if(y(s))return s}const V0=["NORTH","SOUTH","WEST","EAST"];function z0(t){const e=z(t.id??"");if(e.inputcurrent!==void 0)return;const[n=pe.NONE]=e.inputqueue;t.stats===void 0&&(t.stats={}),t.stats.inputmove=[],t.stats.inputok=0,t.stats.inputcancel=0,t.stats.inputmenu=0;const r=e.inputmods[n];switch(t.stats.inputalt=r&yy?1:0,t.stats.inputctrl=r&Ey?1:0,t.stats.inputshift=r&_y?1:0,n){case pe.MOVE_UP:case pe.MOVE_DOWN:case pe.MOVE_LEFT:case pe.MOVE_RIGHT:t.stats.inputmove=[V0[n-pe.MOVE_UP]];break;case pe.OK_BUTTON:t.stats.inputok=1;break;case pe.CANCEL_BUTTON:t.stats.inputcancel=1;break;case pe.MENU_BUTTON:t.stats.inputmenu=1;break}e.inputcurrent=n,e.inputqueue.delete(n)}function Gr(t,e,n,r){const s=te(e)?e:e.id,i=te(e)?void 0:{x:e.x??0,y:e.y??0},o=te(n)?n:n.id,a=s??i;y(o)&&y(a)&&t.send(o,r,a)}function mm(t,e,n,r){y(n==null?void 0:n.id)?(n.headless=!0,zi(t,e,n)):tu(e,r,"empty")}function ym(t,e,n,r,s){const i=zv(e,n,r,s);if(y(i)){Gr(t,i,t.id(),"thud"),r.kind==="player"?Gr(t,t.id(),i,"touch"):r.collision===Ne.BULLET?Gr(t,t.id(),i,"shot"):Gr(t,t.id(),i,"bump");const o=Ft(e,i);return(i.destructible??(o==null?void 0:o.destructible))&&mm(e,n,i,s),!1}return!0}function Nl(t,e){if(te(t)){const n=t.toLowerCase();switch(n){case"edit":return[n,e+1]}}return[void 0,e]}function Cl(t,e,n){let r;const s=Yi((e==null?void 0:e.id)??"");switch(n){case"edit":{r=s.find(a=>a.type===gs.EDIT);break}}const i=r?an((r==null?void 0:r.book)??""):t,o=r?Rr(i,(r==null?void 0:r.board)??""):e;return{maybebook:i,maybeboard:o}}const Y0=Ss({get(t,e){var o;const n=H0(e);if(y(n))return[!0,n];const r=z(t.id());if(r.object){W0.has(e)&&z0(r.object);const a=(o=r.object.stats)==null?void 0:o[e];if(y(a)||gm.has(e))return[!0,a]}const s=r.board?na(r.board,r.object):void 0,i=wd(r.book,(s==null?void 0:s.id)??"",e);return[y(i),i]},set(t,e,n){var i,o;const r=z(t.id());if(y(r.object)&&(y((o=(i=r.object)==null?void 0:i.stats)==null?void 0:o[e])||gm.has(e)))return r.object.stats||(r.object.stats={}),r.object.stats[e]=n,[!0,n];const s=r.board?na(r.board,r.object):void 0;return Td(r.book,(s==null?void 0:s.id)??"",e,n),[!0,n]},shouldtick(t){var n,r,s,i,o,a;const e=z(t.id());!y((n=e.object)==null?void 0:n.x)||!y((r=e.object)==null?void 0:r.y)||!y((i=(s=e.object)==null?void 0:s.stats)==null?void 0:i.stepx)||!y((a=(o=e.object)==null?void 0:o.stats)==null?void 0:a.stepy)||ym(t,e.book,e.board,e.object,{x:e.object.x+e.object.stats.stepx,y:e.object.y+e.object.stats.stepy})||kl(e.object,{stepx:0,stepy:0})},tick(){},tock(t){var n;(n=z(t.id()).object)!=null&&n.headless&&t.command("die")}}).command("become",(t,e)=>{var i,o;const n=z(t.id()),r={x:((i=n.object)==null?void 0:i.x)??0,y:((o=n.object)==null?void 0:o.y)??0},[s]=k(I(t,e),0,[R.KIND]);return ps(n.book,n.board),zi(n.book,n.board,n.object),mc(n.book,n.object,t.timestamp())&&$o(n.book,n.board,s,r),t.endofprogram(),0}).command("bind",()=>0).command("change",(t,e)=>{const n=z(t.id()),[r,s]=Nl(e[0],0),[i,o]=k(I(t,e),s,[R.KIND,R.KIND]),{maybebook:a,maybeboard:c}=Cl(n.book,n.board,r);ps(a,c);const l=ia(i)??"",u=Qo(c,l),h=My(u,i),d=ia(o),f=yu(o),p=Eu(o);return h.forEach(E=>{if(Or(a,E)===d)y(f)&&(E.color=f),y(p)&&(E.bg=p);else{if(y(E.id))switch(zi(a,c,E),r){case"edit":if(!ta(c,E.id))return;break;default:if(!mc(a,E,t.timestamp()))return;break}Nt(E)&&$o(a,c,o,E)}}),0}).command("char",(t,e)=>{const n=z(t.id()),[r]=k(I(t,e),0,[R.NUMBER]);return y(n.object)&&(n.object.char=r),0}).command("color",(t,e)=>{const n=z(t.id()),[r]=k(I(t,e),0,[R.COLOR]);return y(n.object)&&y(r)&&ei(n.object,r),0}).command("cycle",(t,e)=>{const[n]=k(I(t,e),0,[R.NUMBER]);return t.cycle(Wn(Math.round(n),1,255)),0}).command("die",t=>{var n;const e=z(t.id());return(n=e.object)!=null&&n.headless&&zi(e.book,e.board,e.object),mc(e.book,e.object,t.timestamp()),t.endofprogram(),0}).command("endgame",t=>(t.set("health",0),0)).command("go",(t,e)=>{const n=z(t.id());if(!y(n.object))return 1;const[r]=k(I(t,e),0,[R.DIR]);return ym(t,n.book,n.board,n.object,r),n.object.x!==r.x&&n.object.y!==r.y?1:0}).command("put",(t,e)=>{const n=z(t.id()),[r,s]=Nl(e[0],0),[i,o]=k(I(t,e),s,[R.DIR,R.KIND]),{maybebook:a,maybeboard:c}=Cl(n.book,n.board,r);return ps(a,c),$o(a,c,o,i),0}).command("send",(t,e)=>{var h,d;const n=z(t.id()),[r,s]=k(I(t,e),0,[R.STRING,R.ANY]),[i,o]=r.split(":"),a=y(o)?i:"self",c=o??i;function l(f){f.forEach(p=>{y(p.id)&&t.send(p.id,c,s)})}const u=a.toLowerCase();switch(u){case"all":for(const f of Object.keys(((h=n.board)==null?void 0:h.objects)??{}))t.send(f,c,s);break;case"self":t.send(t.id(),c,s);break;case"others":for(const f of Object.keys(((d=n.board)==null?void 0:d.objects)??{}))f!==t.id()&&t.send(f,c,s);break;case"player":break;default:{l(Zo(n.board,[a]));const f=t.get(u);Array.isArray(f)?l(Zo(n.board,f)):l(Zo(n.board,[f]));break}}return 0}).command("shoot",(t,e)=>{const n=z(t.id());if(!Nt(n.object))return 0;const[r,s]=Nl(e[0],0),[i,o]=k(I(t,e),s,[R.DIR,R.MAYBE_KIND]),{maybebook:a,maybeboard:c}=Cl(n.book,n.board,r),l=An(n.object,i),u=tt({x:0,y:0},l),h=tt({x:n.object.x,y:n.object.y},l);ps(a,c);let d=$y(c,h);if(y(d)&&!y(d.id)){const f=Ft(a,n.object),p=Ft(a,d);Zl(d.collision??(f==null?void 0:f.collision),d.collision??(p==null?void 0:p.collision))||(d=void 0)}if(y(d)){y(d.id)&&Gr(t,t.id(),d,"shot");const f=Ft(a,d);(d.destructible??(f==null?void 0:f.destructible))&&mm(a,c,d,h);const p=K0(a,c,o??["bullet"],h);y(p)&&(p.collision=Ne.BULLET,Gr(t,d,t.id(),"thud"))}else{const f=$o(a,c,o??["bullet"],h);y(f)&&(f.collision=Ne.BULLET,kl(f,{stepx:u.x,stepy:u.y}))}return t.yield(),0}).command("throwstar",(t,e)=>t.command("shoot",...e,"star")?1:0).command("try",(t,e)=>{const[,n]=k(I(t,e),0,[R.DIR]);return t.command("go",...e)&&n<e.length&&t.command(...e.slice(n)),t.yield(),0}).command("walk",(t,e)=>{const n=z(t.id());if(!Nt(n.object))return 0;const[r]=k(I(t,e),0,[R.DIR]),s=An(n.object,r),i=tt({x:0,y:0},s);return kl(n.object,{stepx:i.x,stepy:i.y}),0}).command("stat",(t,e)=>{const n=z(t.id());return n.object&&(n.object.name=e.map(qe).join(" ")),0}),q0={all:bO,cli:S0,audio:AO,gadget:G0,object:Y0},X0={[le.ERROR]:[],[le.CLI]:["all","audio","cli"],[le.BOARD]:["all","audio","gadget"],[le.OBJECT]:["all","audio","object","gadget"],[le.TERRAIN]:["all"],[le.CHARSET]:["all"],[le.PALETTE]:["all"]};function J0(t,e){(X0[e]??[]).forEach(r=>t.install(q0[r]))}function Il(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];Array.isArray(r)?r.forEach(s=>{e.push(Il(s))}):e.push(Il(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function Q0(t){const e=uc(`${t}
`);if(e.errors.length>0)return{errors:e.errors,tokens:[]};bs.input=e.tokens;const n=bs.program();if(bs.errors.length>0)return{tokens:e.tokens,errors:bs.errors};const r=dO.visit(n);return r?(Il(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:["no ast output"]}}const Ll=Object.getPrototypeOf(function*(){}).constructor;function Z0(t){const e=Q0(t);if(e.errors&&e.errors.length>0)return e;if(!e.ast)return{...e,errors:["no ast output"]};const n=EO(e.ast);if(n.code){Uv&&console.info(n.code);try{return{...e,...n,source:n.code,code:new Ll("api",n.code)}}catch(r){return{errors:[{message:r.message}],source:"there was an error",code:new Ll("api"," ")}}}return{...e,...n,source:"there was an error",code:new Ll("api"," ")}}function eC(){const t={},e={};function n(s){const i=t[s];if(i)return i;const o=Z0(s);return t[s]=o,o}const r={ids(){return Object.keys(e)},has(s){return y(e[s])},halt(s){const i=e[s];return i&&delete e[s],!!i},tick(s,i,o,a){var l;let c=e[s];if(!y(e[s])){const u=n(a);if((l=u.errors)!=null&&l.length)return bn("os","build",JSON.stringify(u.errors),""),!1;c=e[s]=TO(s,u),J0(c,i)}return!!(c!=null&&c.tick(o))},once(s,i,o,a){return r.tick(s,i,o,a)&&r.halt(s)},message(s){const{target:i,path:o}=Vl(s.target),a=e[i];y(a)&&a.message({...s,target:o})}};return r}const Ml=Wm();Qv(Ml);const xl=eC();let Ul=0;const tC=32,Kr={},En=pr("vm",["tick","second"],t=>{switch(t.target){case"mem":t.player===Ml&&(nR(t.data),Kn(En.name(),"ackmem",t.player),En.emit("ackmem",void 0,t.player));break;case"login":t.player&&rR(t.player)&&(Kr[t.player]=0,Kn(En.name(),"acklogin",t.player),En.emit("acklogin",void 0,t.player));break;case"doot":t.player&&(Kr[t.player]=0,Jl(En.name(),t.player,"active"),En.emit("doot",void 0,t.player));break;case"input":if(t.player){const e=z(t.player),[n=pe.NONE,r=0]=t.data??{};e.inputqueue.add(n),e.inputmods[n]=r}break;case"tick":Ul=t.data??0,iR(xl,Ul);break;case"second":Object.keys(Kr).forEach(e=>{++Kr[e],Kr[e]>=tC&&(delete Kr[e],sR(e),Kn(En.name(),"logout",e),En.emit("logout",void 0,e))});break;case"cli":oR(xl,Ul,t.player??"",t.data??"");break;default:xl.message(t);break}});function nC(){En.emit("ready",void 0,Ml)}const Pl=pr("clock",[],()=>{});let Dl=0,Em=performance.now(),$l=0,Fo=0;function rC(){Pl.emit("tick",Fo),Pl.emit("tock",Fo),++$l,++Fo,$l>=ca&&($l%=ca,Pl.emit("second",Fo))}function _m(){const t=performance.now(),e=t-Em;Dl+=e,Dl>=aa&&(Dl%=aa,rC()),Em=t,setTimeout(_m)}_m();const wm={},Tm=pr("gadgetserver",["tock"],t=>{switch(t.target){case"tock":P0().forEach(e=>{const n=fr(e);n.layers=cR(e);const r=Xo(wm[e]??{},n);r.length&&(wm[e]=Me(n),Ty(Tm.name(),r,e))});break;case"desync":if(t.player){const e=fr(t.player);wy(Tm.name(),e,t.player)}break;case"clearscroll":t.player&&D0(t.player);break}}),sC=zm(t=>postMessage(t));onmessage=function(e){sC(e.data)},queueMicrotask(nC)})();

var V8=Object.defineProperty;var X8=(Jr,Un,wn)=>Un in Jr?V8(Jr,Un,{enumerable:!0,configurable:!0,writable:!0,value:wn}):Jr[Un]=wn;var Ot=(Jr,Un,wn)=>X8(Jr,typeof Un!="symbol"?Un+"":Un,wn);(function(){"use strict";const Jr=new Set,Un={emit(e,t,n,r,i){Un.invoke(V1(e,t,n,r,i))},invoke(e){Jr.forEach(t=>t.handle(e))},connect(e){Jr.add(e)},disconnect(e){Jr.delete(e)}};var wn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Es(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function d1(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var yd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(wn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(yd);var p1=yd.exports,_d=Es(p1),bd={};(function(e){var t=wn&&wn.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,x=l.addAdverb,w=x===void 0?!1:x,T=t(t(t([],t([],Array(m),!0).map(function(v){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),w?[n(e.adverbs)]:[],!0);return f&&(T=T.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),T.join(h)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(f?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(e.adjectives).length*h+h*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(f?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(f?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(bd);var Ed=Es(bd);const m1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let g1=e=>crypto.getRandomValues(new Uint8Array(e)),y1=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},wd=(e,t=21)=>y1(e,t,g1),_1=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=m1[n[e]&63];return t};var xd="abcdefghijklmnopqrstuvwxyz",kd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Td="0123456789",b1="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",E1="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const w1=Td,x1=xd,k1=kd;var T1=w1+x1+k1,zl={lowercase:xd,uppercase:kd,numbers:Td,nolookalikes:b1,nolookalikesSafe:E1,alphanumeric:T1};function Oe(){return`sid_${_1(12).replaceAll("-",".")}`}wd(zl.numbers,4),wd(`${zl.numbers}${zl.lowercase}`,16);function Tr(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function A1(){return Ed({capitalize:!1,adjectiveCount:1})}function v1(){return Ed({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var S1=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),R1=Object.prototype.hasOwnProperty;function Wl(e,t){return R1.call(e,t)}function Kl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Wl(e,i)&&r.push(i);return r}function xn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Gl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Wi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Ad(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Hl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Hl(e[t]))return!0}else if(typeof e=="object"){for(var r=Kl(e),i=r.length,s=0;s<i;s++)if(Hl(e[r[s]]))return!0}}return!1}function vd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Sd=function(e){S1(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,vd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=vd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),ve=Sd,I1=xn,ws={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Ia(n,this.path);r&&(r=xn(r));var i=Ki(n,{op:"remove",path:this.from}).removed;return Ki(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Ia(n,this.from);return Ki(n,{op:"add",path:this.path,value:xn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:To(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},N1={add:function(e,t,n){return Gl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:ws.move,copy:ws.copy,test:ws.test,_get:ws._get};function Ia(e,t){if(t=="")return e;var n={op:"_get",path:t};return Ki(e,n),n.value}function Ki(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Na(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Ia(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=To(e,t.value),o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=xn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=Na;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=Ad(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=t.path),d!==void 0&&p(t,0,e,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!Gl(f))throw new ve("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Gl(f)&&(f=~~f)}if(u>=h){if(n&&t.op==="add"&&f>l.length)throw new ve("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=N1[t.op].call(t,l,f,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=h){var o=ws[t.op].call(t,l,f,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new ve("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Yl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=xn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Ki(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function O1(e,t,n){var r=Ki(e,t);if(r.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Na(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new ve("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(ws[e.op]){if(typeof e.path!="string")throw new ve("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ve('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ve("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Hl(e.value))throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ve("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new ve("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Rd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ve("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Rd(e,t,n){try{if(!Array.isArray(e))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Yl(xn(t),xn(e),n||!0);else{n=n||Na;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof ve)return i;throw i}}function To(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!To(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!To(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var C1=Object.freeze({__proto__:null,JsonPatchError:ve,_areEquals:To,applyOperation:Ki,applyPatch:Yl,applyReducer:O1,deepClone:I1,getValueByPointer:Ia,validate:Rd,validator:Na});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Vl=new WeakMap,L1=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),M1=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function U1(e){return Vl.get(e)}function F1(e,t){return e.observers.get(t)}function P1(e,t){e.observers.delete(t.callback)}function B1(e,t){t.unobserve()}function D1(e,t){var n=[],r,i=U1(e);if(!i)i=new L1(e),Vl.set(e,i);else{var s=F1(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=xn(e),t){r.callback=t,r.next=null;var o=function(){Xl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Xl(r),clearTimeout(r.next),P1(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new M1(t,r)),r}function Xl(e,t){t===void 0&&(t=!1);var n=Vl.get(e.object);ql(n.value,e.object,e.patches,"",t),e.patches.length&&Yl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function ql(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Kl(t),o=Kl(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(Wl(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var h=t[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?ql(u,h,n,r+"/"+Wi(l),i):u!==h&&(i&&n.push({op:"test",path:r+"/"+Wi(l),value:xn(u)}),n.push({op:"replace",path:r+"/"+Wi(l),value:xn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Wi(l),value:xn(u)}),n.push({op:"remove",path:r+"/"+Wi(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Wl(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+Wi(l),value:xn(t[l])})}}}function Id(e,t,n){n===void 0&&(n=!1);var r=[];return ql(e,t,r,"",n),r}var $1=Object.freeze({__proto__:null,compare:Id,generate:Xl,observe:D1,unobserve:B1});Object.assign({},C1,$1,{JsonPatchError:Sd,deepClone:xn,escapePathComponent:Wi,unescapePathComponent:Ad});var j1=typeof Element<"u",z1=typeof Map=="function",W1=typeof Set=="function",K1=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Oa(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Oa(e[r],t[r]))return!1;return!0}var s;if(z1&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Oa(r.value[1],t.get(r.value[0])))return!1;return!0}if(W1&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(K1&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(j1&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Oa(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var G1=function(t,n){try{return Oa(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},H1=Es(G1);function k(e){return e!=null}const Gn=Object.keys;function Xe(e){return xn(e)}function Y1(e){return typeof e=="boolean"}function Rt(e){return typeof e=="number"&&isNaN(e)===!1}function At(e){return typeof e=="string"}function oe(e){return Array.isArray(e)}function Jl(e){return e}var Wt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Wt||{}),Ht=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Ht||{}),Hn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Hn||{}),mt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e))(mt||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Ct(e){return(e==null?void 0:e.toLowerCase().trim())??""}function V1(e,t,n,r,i){return{session:e,player:t,id:Oe(),sender:n,target:r,data:i}}function lr(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function xs(e,t=[],n=Jl,r=""){const i=Oe(),s=Ct(e),o=t.map(Ct);let a=r;const c={id(){return i},name(){return e},session(l){return k(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,h){Un.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=lr(l.target),d=Ct(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&k(l.session)&&(a=l.session),o.findIndex(f=>f==="all"||f===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:h})}};return Un.connect(c),c}function X1(e){return typeof e=="object"&&At(e.session)&&At(e.player)&&At(e.id)&&At(e.sender)&&At(e.target)}function ge(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function Zr(e,t,...n){return e.emit(t,"info",n),!0}function Nd(e,t,...n){return e.emit(t,"debug",n),!0}function q1(e,t,n){e.emit(t,"toast",n)}function J1(e,t,n){e.emit(t,"bridge:streamstart",n)}function Z1(e,t){e.emit(t,"bridge:streamstop",void 0)}function Q1(e,t,n){e.emit(t,"bridge:chatstart",n)}function tE(e,t){e.emit(t,"bridge:chatstop")}function eE(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function nE(e,t){e.emit(t,"bridge:talkstart",t)}function rE(e,t){e.emit(t,"bridge:talkstop",t)}function iE(e,t){e.emit(t,"bridge:mediastart",t)}function sE(e,t){e.emit(t,"bridge:mediastop",t)}function oE(e,t,n){e.emit(t,"bridge:start",n)}function aE(e,t,n){e.emit(t,"bridge:tab",n)}function cE(e,t,n){e.emit(t,"gadgetclient:paint",n)}function lE(e,t,n){e.emit(t,"gadgetclient:patch",n)}function uE(e,t){e.emit(t,"gadgetserver:clearscroll")}function hE(e){e.emit("","ready")}function fE(e,t){e.emit(t,"register:loginfail")}function Zl(e,t){e.emit(t,"register:loginready",!0)}function dE(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function pE(e,t,n){e.emit(t,"register:forkmem",[n])}function Ql(e,t,n){e.emit(t,"register:copy",n)}function mE(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function Od(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function gE(e,t){e.emit(t,"register:dev",void 0)}function yE(e,t){e.emit(t,"register:share",void 0)}function _E(e,t){e.emit(t,"register:nuke",void 0)}function bE(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function EE(e,t,n){e.emit(t,"synth:tta",[n])}function wE(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function xE(e,t,n){e.emit(t,"synth:focus",n)}function kE(e,t,n){e.emit(t,"synth:bpm",n)}function TE(e,t,n){e.emit(t,"synth:playvolume",n)}function AE(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function vE(e,t,n){e.emit(t,"synth:ttsvolume",n)}function tu(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function Cd(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function SE(e,t){e.emit(t,"register:inspector")}function Ld(e,t,n,r,i,s,o){e.emit(t,"register:editor:open",[n,r,i,s,o])}function RE(e,t){e.emit(t,"register:editor:close")}function Md(e,t){e.emit(t,"vm:logout")}function Ca(e,t){const[n,r]=t;return`${e}:${[n,r].filter(k).join(":")}`}function IE(e,t,n){e.emit(t,"vm:cli",n)}function NE(e,t){e.emit(t,"vm:restart")}function Ud(e,t){e.emit(t,"vm:flush")}function OE(e,t){e.emit(t,"vm:fork")}function CE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function LE(e,t){return{filename:e,json:t}}function ME(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function eu(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=CE(i,s);break;case"json":o=LE(i,s);break;case"binary":o=ME(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function UE(e){const t=new Set;function n(s){X1(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Un.invoke(s))}const r=xs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Un.disconnect(r)}return{forward:n,disconnect:i}}function FE(e){switch(e.target){case"info":case"debug":case"error":case"tick":case"tock":case"ready":case"second":return!0;default:{const t=lr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const nu=66.666,La=Math.round(1e3/nu),PE=3;function Fd(e){return new Promise(t=>setTimeout(t,e))}const ru=xs("clock");let iu=0,Ma=0,su=0,Pd=performance.now();function Bd(){const e=performance.now(),t=e-Pd;su+=t,su>=nu&&(su%=nu,ru.emit("","tick",Ma),ru.emit("","tock",Ma),++iu,++Ma,iu>=La&&(iu%=La,ru.emit("","second",Ma))),Pd=e,setTimeout(Bd,2)}Bd();var Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ao=Symbol.for("react.element"),BE=Symbol.for("react.portal"),DE=Symbol.for("react.fragment"),$E=Symbol.for("react.strict_mode"),jE=Symbol.for("react.profiler"),zE=Symbol.for("react.provider"),WE=Symbol.for("react.context"),KE=Symbol.for("react.forward_ref"),GE=Symbol.for("react.suspense"),HE=Symbol.for("react.memo"),YE=Symbol.for("react.lazy"),Dd=Symbol.iterator;function VE(e){return e===null||typeof e!="object"?null:(e=Dd&&e[Dd]||e["@@iterator"],typeof e=="function"?e:null)}var $d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},jd=Object.assign,zd={};function ks(e,t,n){this.props=e,this.context=t,this.refs=zd,this.updater=n||$d}ks.prototype.isReactComponent={},ks.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},ks.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Wd(){}Wd.prototype=ks.prototype;function ou(e,t,n){this.props=e,this.context=t,this.refs=zd,this.updater=n||$d}var au=ou.prototype=new Wd;au.constructor=ou,jd(au,ks.prototype),au.isPureReactComponent=!0;var Kd=Array.isArray,Gd=Object.prototype.hasOwnProperty,cu={current:null},Hd={key:!0,ref:!0,__self:!0,__source:!0};function Yd(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Gd.call(t,r)&&!Hd.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ao,type:e,key:s,ref:o,props:i,_owner:cu.current}}function XE(e,t){return{$$typeof:Ao,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function lu(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ao}function qE(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Vd=/\/+/g;function uu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?qE(""+e.key):t.toString(36)}function Ua(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Ao:case BE:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+uu(o,0):r,Kd(i)?(n="",e!=null&&(n=e.replace(Vd,"$&/")+"/"),Ua(i,t,n,"",function(l){return l})):i!=null&&(lu(i)&&(i=XE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Vd,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",Kd(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+uu(s,a);o+=Ua(s,t,n,c,i)}else if(c=VE(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+uu(s,a++),o+=Ua(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Fa(e,t,n){if(e==null)return e;var r=[],i=0;return Ua(e,r,"","",function(s){return t.call(n,s,i++)}),r}function JE(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var fn={current:null},Pa={transition:null},ZE={ReactCurrentDispatcher:fn,ReactCurrentBatchConfig:Pa,ReactCurrentOwner:cu};function Xd(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:Fa,forEach:function(e,t,n){Fa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Fa(e,function(){t++}),t},toArray:function(e){return Fa(e,function(t){return t})||[]},only:function(e){if(!lu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Yt.Component=ks,Yt.Fragment=DE,Yt.Profiler=jE,Yt.PureComponent=ou,Yt.StrictMode=$E,Yt.Suspense=GE,Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZE,Yt.act=Xd,Yt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=jd({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=cu.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Gd.call(t,c)&&!Hd.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Ao,type:e.type,key:i,ref:s,props:r,_owner:o}},Yt.createContext=function(e){return e={$$typeof:WE,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:zE,_context:e},e.Consumer=e},Yt.createElement=Yd,Yt.createFactory=function(e){var t=Yd.bind(null,e);return t.type=e,t},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(e){return{$$typeof:KE,render:e}},Yt.isValidElement=lu,Yt.lazy=function(e){return{$$typeof:YE,_payload:{_status:-1,_result:e},_init:JE}},Yt.memo=function(e,t){return{$$typeof:HE,type:e,compare:t===void 0?null:t}},Yt.startTransition=function(e){var t=Pa.transition;Pa.transition={};try{e()}finally{Pa.transition=t}},Yt.unstable_act=Xd,Yt.useCallback=function(e,t){return fn.current.useCallback(e,t)},Yt.useContext=function(e){return fn.current.useContext(e)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(e){return fn.current.useDeferredValue(e)},Yt.useEffect=function(e,t){return fn.current.useEffect(e,t)},Yt.useId=function(){return fn.current.useId()},Yt.useImperativeHandle=function(e,t,n){return fn.current.useImperativeHandle(e,t,n)},Yt.useInsertionEffect=function(e,t){return fn.current.useInsertionEffect(e,t)},Yt.useLayoutEffect=function(e,t){return fn.current.useLayoutEffect(e,t)},Yt.useMemo=function(e,t){return fn.current.useMemo(e,t)},Yt.useReducer=function(e,t,n){return fn.current.useReducer(e,t,n)},Yt.useRef=function(e){return fn.current.useRef(e)},Yt.useState=function(e){return fn.current.useState(e)},Yt.useSyncExternalStore=function(e,t,n){return fn.current.useSyncExternalStore(e,t,n)},Yt.useTransition=function(){return fn.current.useTransition()},Yt.version="18.3.1";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const qd="0123456789abcdef",Jd=[],Ba=[];for(let e=0;e<256;e++)Jd[e]=qd[e>>4&15]+qd[e&15],e<16&&(e<10?Ba[48+e]=e:Ba[87+e]=e);const Zd=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=Jd[e[r++]];return n},Da=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=Ba[e.charCodeAt(s++)]<<4|Ba[e.charCodeAt(s++)];return r};for(var Qd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",QE=typeof Uint8Array>"u"?[]:new Uint8Array(256),$a=0;$a<Qd.length;$a++)QE[Qd.charCodeAt($a)]=$a;new TextDecoder,new TextEncoder;const t0=typeof window<"u"?window:self,e0=t0.crypto||t0.msCrypto||{};e0.subtle||e0.webkitSubtle;const Ts=globalThis||void 0||self,ur=()=>new Map,hu=e=>{const t=ur();return e.forEach((n,r)=>{t.set(r,n)}),t},ki=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},tw=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},ew=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},As=()=>new Set,fu=e=>e[e.length-1],nw=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Gi=Array.from,rw=Array.isArray;class iw{constructor(){this._observers=ur()}on(t,n){return ki(this._observers,t,As).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Gi((this._observers.get(t)||ur()).values()).forEach(r=>r(...n))}destroy(){this._observers=ur()}}const Ti=Math.floor,ja=Math.abs,n0=(e,t)=>e<t?e:t,Hi=(e,t)=>e>t?e:t,r0=e=>e!==0?e<0:1/e<0,i0=1,s0=2,du=4,pu=8,vo=32,Qr=64,Fn=128,za=31,mu=63,Yi=127,sw=2147483647,o0=Number.MAX_SAFE_INTEGER,ow=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ti(e)===e),aw=e=>e.toLowerCase(),cw=/^\s*/g,lw=e=>e.replace(cw,""),uw=/([A-Z])/g,a0=(e,t)=>lw(e.replace(uw,n=>`${t}${aw(n)}`)),hw=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},So=typeof TextEncoder<"u"?new TextEncoder:null,fw=So?e=>So.encode(e):hw;let Ro=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ro&&Ro.decode(new Uint8Array).length===1&&(Ro=null);class Io{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Wa=()=>new Io,dw=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Ar=e=>{const t=new Uint8Array(dw(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},pw=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Hi(n,t)*2),e.cpos=0)},qe=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},gu=qe,ne=(e,t)=>{for(;t>Yi;)qe(e,Fn|Yi&t),t=Ti(t/128);qe(e,Yi&t)},yu=(e,t)=>{const n=r0(t);for(n&&(t=-t),qe(e,(t>mu?Fn:0)|(n?Qr:0)|mu&t),t=Ti(t/64);t>0;)qe(e,(t>Yi?Fn:0)|Yi&t),t=Ti(t/128)},_u=new Uint8Array(3e4),mw=_u.length/3,gw=(e,t)=>{if(t.length<mw){const n=So.encodeInto(t,_u).written||0;ne(e,n);for(let r=0;r<n;r++)qe(e,_u[r])}else Pn(e,fw(t))},yw=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;ne(e,r);for(let i=0;i<r;i++)qe(e,n.codePointAt(i))},vs=So&&So.encodeInto?gw:yw,Ka=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=n0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Hi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},Pn=(e,t)=>{ne(e,t.byteLength),Ka(e,t)},bu=(e,t)=>{pw(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},_w=(e,t)=>bu(e,4).setFloat32(0,t,!1),bw=(e,t)=>bu(e,8).setFloat64(0,t,!1),Ew=(e,t)=>bu(e,8).setBigInt64(0,t,!1),c0=new DataView(new ArrayBuffer(4)),ww=e=>(c0.setFloat32(0,e),c0.getFloat32(0)===e),No=(e,t)=>{switch(typeof t){case"string":qe(e,119),vs(e,t);break;case"number":ow(t)&&ja(t)<=sw?(qe(e,125),yu(e,t)):ww(t)?(qe(e,124),_w(e,t)):(qe(e,123),bw(e,t));break;case"bigint":qe(e,122),Ew(e,t);break;case"object":if(t===null)qe(e,126);else if(rw(t)){qe(e,117),ne(e,t.length);for(let n=0;n<t.length;n++)No(e,t[n])}else if(t instanceof Uint8Array)qe(e,116),Pn(e,t);else{qe(e,118);const n=Object.keys(t);ne(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];vs(e,i),No(e,t[i])}}break;case"boolean":qe(e,t?120:121);break;default:qe(e,127)}};class l0 extends Io{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&ne(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const u0=e=>{e.count>0&&(yu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&ne(e.encoder,e.count-2))};class Ga{constructor(){this.encoder=new Io,this.s=0,this.count=0}write(t){this.s===t?this.count++:(u0(this),this.count=1,this.s=t)}toUint8Array(){return u0(this),Ar(this.encoder)}}const h0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);yu(e.encoder,t),e.count>1&&ne(e.encoder,e.count-2)}};class Eu{constructor(){this.encoder=new Io,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(h0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return h0(this),Ar(this.encoder)}}class xw{constructor(){this.sarr=[],this.s="",this.lensE=new Ga}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Io;return this.sarr.push(this.s),this.s="",vs(t,this.sarr.join("")),Ka(t,this.lensE.toUint8Array()),Ar(t)}}const Ai=e=>new Error(e),vr=()=>{throw Ai("Method unimplemented")},Sr=()=>{throw Ai("Unexpected case")},f0=Ai("Unexpected end of array"),d0=Ai("Integer out of Range");class Ha{constructor(t){this.arr=t,this.pos=0}}const Ss=e=>new Ha(e),kw=e=>e.pos!==e.arr.length,Tw=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Bn=e=>Tw(e,Kt(e)),Rs=e=>e.arr[e.pos++],Kt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&Yi)*n,n*=128,i<Fn)return t;if(t>o0)throw d0}throw f0},wu=e=>{let t=e.arr[e.pos++],n=t&mu,r=64;const i=(t&Qr)>0?-1:1;if(!(t&Fn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&Yi)*r,r*=128,t<Fn)return i*n;if(n>o0)throw d0}throw f0},Is=Ro?e=>Ro.decode(Bn(e)):e=>{let t=Kt(e);if(t===0)return"";{let n=String.fromCodePoint(Rs(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Rs(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},xu=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Aw=[e=>{},e=>null,wu,e=>xu(e,4).getFloat32(0,!1),e=>xu(e,8).getFloat64(0,!1),e=>xu(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Is,e=>{const t=Kt(e),n={};for(let r=0;r<t;r++){const i=Is(e);n[i]=Oo(e)}return n},e=>{const t=Kt(e),n=[];for(let r=0;r<t;r++)n.push(Oo(e));return n},Bn],Oo=e=>Aw[127-Rs(e)](e);class p0 extends Ha{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),kw(this)?this.count=Kt(this)+1:this.count=-1),this.count--,this.s}}class Ya extends Ha{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=wu(this);const t=r0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Kt(this)+2)}return this.count--,this.s}}class ku extends Ha{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=wu(this),n=t&1;this.diff=Ti(t/2),this.count=1,n&&(this.count=Kt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class vw{constructor(t){this.decoder=new Ya(t),this.str=Is(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Sw=crypto.getRandomValues.bind(crypto),m0=()=>Sw(new Uint32Array(1))[0],Rw="10000000-1000-4000-8000"+-1e11,Iw=()=>Rw.replace(/[018]/g,e=>(e^m0()&15>>e/4).toString(16)),g0=e=>new Promise(e);Promise.all.bind(Promise);var y0={},Va={};Va.byteLength=Cw,Va.toByteArray=Mw,Va.fromByteArray=Pw;for(var Rr=[],Yn=[],Nw=typeof Uint8Array<"u"?Uint8Array:Array,Tu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ns=0,Ow=Tu.length;Ns<Ow;++Ns)Rr[Ns]=Tu[Ns],Yn[Tu.charCodeAt(Ns)]=Ns;Yn[45]=62,Yn[95]=63;function _0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Cw(e){var t=_0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Lw(e,t,n){return(t+n)*3/4-n}function Mw(e){var t,n=_0(e),r=n[0],i=n[1],s=new Nw(Lw(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=Yn[e.charCodeAt(c)]<<18|Yn[e.charCodeAt(c+1)]<<12|Yn[e.charCodeAt(c+2)]<<6|Yn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Yn[e.charCodeAt(c)]<<2|Yn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=Yn[e.charCodeAt(c)]<<10|Yn[e.charCodeAt(c+1)]<<4|Yn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Uw(e){return Rr[e>>18&63]+Rr[e>>12&63]+Rr[e>>6&63]+Rr[e&63]}function Fw(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Uw(r));return i.join("")}function Pw(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Fw(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Rr[t>>2]+Rr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Rr[t>>10]+Rr[t>>4&63]+Rr[t<<2&63]+"=")),i.join("")}var Au={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Au.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+h],h+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(f?-1:1)*o*Math.pow(2,s-r)},Au.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=d/c:t+=d*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=a&255,f+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+f]=o&255,f+=p,o/=256,l-=8);e[n+f-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Va,n=Au,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const A=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(A,g),A.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(A){if(A>i)throw new RangeError('The value "'+A+'" is invalid for option "size"');const g=new s(A);return Object.setPrototypeOf(g,u.prototype),g}function u(A,g,y){if(typeof A=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(A)}return h(A,g,y)}u.poolSize=8192;function h(A,g,y){if(typeof A=="string")return m(A,g);if(o.isView(A))return w(A);if(A==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(dt(A,o)||A&&dt(A.buffer,o)||typeof a<"u"&&(dt(A,a)||A&&dt(A.buffer,a)))return T(A,g,y);if(typeof A=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const N=A.valueOf&&A.valueOf();if(N!=null&&N!==A)return u.from(N,g,y);const $=v(A);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof A[Symbol.toPrimitive]=="function")return u.from(A[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}u.from=function(A,g,y){return h(A,g,y)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(A){if(typeof A!="number")throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function f(A,g,y){return d(A),A<=0?l(A):g!==void 0?typeof y=="string"?l(A).fill(g,y):l(A).fill(g):l(A)}u.alloc=function(A,g,y){return f(A,g,y)};function p(A){return d(A),l(A<0?0:I(A)|0)}u.allocUnsafe=function(A){return p(A)},u.allocUnsafeSlow=function(A){return p(A)};function m(A,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=R(A,g)|0;let N=l(y);const $=N.write(A,g);return $!==y&&(N=N.slice(0,$)),N}function x(A){const g=A.length<0?0:I(A.length)|0,y=l(g);for(let N=0;N<g;N+=1)y[N]=A[N]&255;return y}function w(A){if(dt(A,s)){const g=new s(A);return T(g.buffer,g.byteOffset,g.byteLength)}return x(A)}function T(A,g,y){if(g<0||A.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let N;return g===void 0&&y===void 0?N=new s(A):y===void 0?N=new s(A,g):N=new s(A,g,y),Object.setPrototypeOf(N,u.prototype),N}function v(A){if(u.isBuffer(A)){const g=I(A.length)|0,y=l(g);return y.length===0||A.copy(y,0,0,g),y}if(A.length!==void 0)return typeof A.length!="number"||vt(A.length)?l(0):x(A);if(A.type==="Buffer"&&Array.isArray(A.data))return x(A.data)}function I(A){if(A>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return A|0}function U(A){return+A!=A&&(A=0),u.alloc(+A)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,y){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),dt(y,s)&&(y=u.from(y,y.offset,y.byteLength)),!u.isBuffer(g)||!u.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let N=g.length,$=y.length;for(let Q=0,it=Math.min(N,$);Q<it;++Q)if(g[Q]!==y[Q]){N=g[Q],$=y[Q];break}return N<$?-1:$<N?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let N;if(y===void 0)for(y=0,N=0;N<g.length;++N)y+=g[N].length;const $=u.allocUnsafe(y);let Q=0;for(N=0;N<g.length;++N){let it=g[N];if(dt(it,s))Q+it.length>$.length?(u.isBuffer(it)||(it=u.from(it)),it.copy($,Q)):s.prototype.set.call($,it,Q);else if(u.isBuffer(it))it.copy($,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return $};function R(A,g){if(u.isBuffer(A))return A.length;if(o.isView(A)||dt(A,o))return A.byteLength;if(typeof A!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);const y=A.length,N=arguments.length>2&&arguments[2]===!0;if(!N&&y===0)return 0;let $=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return at(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return pt(A).length;default:if($)return N?-1:at(A).length;g=(""+g).toLowerCase(),$=!0}}u.byteLength=R;function L(A,g,y){let N=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(A||(A="utf8");;)switch(A){case"hex":return z(this,g,y);case"utf8":case"utf-8":return D(this,g,y);case"ascii":return ft(this,g,y);case"latin1":case"binary":return V(this,g,y);case"base64":return X(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Et(this,g,y);default:if(N)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),N=!0}}u.prototype._isBuffer=!0;function B(A,g,y){const N=A[g];A[g]=A[y],A[y]=N}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)B(this,y,y+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)B(this,y,y+3),B(this,y+1,y+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)B(this,y,y+7),B(this,y+1,y+6),B(this,y+2,y+5),B(this,y+3,y+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?D(this,0,g):L.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const y=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,y,N,$,Q){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),N===void 0&&(N=g?g.length:0),$===void 0&&($=0),Q===void 0&&(Q=this.length),y<0||N>g.length||$<0||Q>this.length)throw new RangeError("out of range index");if($>=Q&&y>=N)return 0;if($>=Q)return-1;if(y>=N)return 1;if(y>>>=0,N>>>=0,$>>>=0,Q>>>=0,this===g)return 0;let it=Q-$,jt=N-y;const xe=Math.min(it,jt),me=this.slice($,Q),ke=g.slice(y,N);for(let ae=0;ae<xe;++ae)if(me[ae]!==ke[ae]){it=me[ae],jt=ke[ae];break}return it<jt?-1:jt<it?1:0};function O(A,g,y,N,$){if(A.length===0)return-1;if(typeof y=="string"?(N=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=$?0:A.length-1),y<0&&(y=A.length+y),y>=A.length){if($)return-1;y=A.length-1}else if(y<0)if($)y=0;else return-1;if(typeof g=="string"&&(g=u.from(g,N)),u.isBuffer(g))return g.length===0?-1:Y(A,g,y,N,$);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?$?s.prototype.indexOf.call(A,g,y):s.prototype.lastIndexOf.call(A,g,y):Y(A,[g],y,N,$);throw new TypeError("val must be string, number or Buffer")}function Y(A,g,y,N,$){let Q=1,it=A.length,jt=g.length;if(N!==void 0&&(N=String(N).toLowerCase(),N==="ucs2"||N==="ucs-2"||N==="utf16le"||N==="utf-16le")){if(A.length<2||g.length<2)return-1;Q=2,it/=2,jt/=2,y/=2}function xe(ke,ae){return Q===1?ke[ae]:ke.readUInt16BE(ae*Q)}let me;if($){let ke=-1;for(me=y;me<it;me++)if(xe(A,me)===xe(g,ke===-1?0:me-ke)){if(ke===-1&&(ke=me),me-ke+1===jt)return ke*Q}else ke!==-1&&(me-=me-ke),ke=-1}else for(y+jt>it&&(y=it-jt),me=y;me>=0;me--){let ke=!0;for(let ae=0;ae<jt;ae++)if(xe(A,me+ae)!==xe(g,ae)){ke=!1;break}if(ke)return me}return-1}u.prototype.includes=function(g,y,N){return this.indexOf(g,y,N)!==-1},u.prototype.indexOf=function(g,y,N){return O(this,g,y,N,!0)},u.prototype.lastIndexOf=function(g,y,N){return O(this,g,y,N,!1)};function et(A,g,y,N){y=Number(y)||0;const $=A.length-y;N?(N=Number(N),N>$&&(N=$)):N=$;const Q=g.length;N>Q/2&&(N=Q/2);let it;for(it=0;it<N;++it){const jt=parseInt(g.substr(it*2,2),16);if(vt(jt))return it;A[y+it]=jt}return it}function C(A,g,y,N){return _t(at(g,A.length-y),A,y,N)}function S(A,g,y,N){return _t(ht(g),A,y,N)}function b(A,g,y,N){return _t(pt(g),A,y,N)}function P(A,g,y,N){return _t(Z(g,A.length-y),A,y,N)}u.prototype.write=function(g,y,N,$){if(y===void 0)$="utf8",N=this.length,y=0;else if(N===void 0&&typeof y=="string")$=y,N=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(N)?(N=N>>>0,$===void 0&&($="utf8")):($=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-y;if((N===void 0||N>Q)&&(N=Q),g.length>0&&(N<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");let it=!1;for(;;)switch($){case"hex":return et(this,g,y,N);case"utf8":case"utf-8":return C(this,g,y,N);case"ascii":case"latin1":case"binary":return S(this,g,y,N);case"base64":return b(this,g,y,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,g,y,N);default:if(it)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(A,g,y){return g===0&&y===A.length?t.fromByteArray(A):t.fromByteArray(A.slice(g,y))}function D(A,g,y){y=Math.min(A.length,y);const N=[];let $=g;for(;$<y;){const Q=A[$];let it=null,jt=Q>239?4:Q>223?3:Q>191?2:1;if($+jt<=y){let xe,me,ke,ae;switch(jt){case 1:Q<128&&(it=Q);break;case 2:xe=A[$+1],(xe&192)===128&&(ae=(Q&31)<<6|xe&63,ae>127&&(it=ae));break;case 3:xe=A[$+1],me=A[$+2],(xe&192)===128&&(me&192)===128&&(ae=(Q&15)<<12|(xe&63)<<6|me&63,ae>2047&&(ae<55296||ae>57343)&&(it=ae));break;case 4:xe=A[$+1],me=A[$+2],ke=A[$+3],(xe&192)===128&&(me&192)===128&&(ke&192)===128&&(ae=(Q&15)<<18|(xe&63)<<12|(me&63)<<6|ke&63,ae>65535&&ae<1114112&&(it=ae))}}it===null?(it=65533,jt=1):it>65535&&(it-=65536,N.push(it>>>10&1023|55296),it=56320|it&1023),N.push(it),$+=jt}return tt(N)}const ct=4096;function tt(A){const g=A.length;if(g<=ct)return String.fromCharCode.apply(String,A);let y="",N=0;for(;N<g;)y+=String.fromCharCode.apply(String,A.slice(N,N+=ct));return y}function ft(A,g,y){let N="";y=Math.min(A.length,y);for(let $=g;$<y;++$)N+=String.fromCharCode(A[$]&127);return N}function V(A,g,y){let N="";y=Math.min(A.length,y);for(let $=g;$<y;++$)N+=String.fromCharCode(A[$]);return N}function z(A,g,y){const N=A.length;(!g||g<0)&&(g=0),(!y||y<0||y>N)&&(y=N);let $="";for(let Q=g;Q<y;++Q)$+=ce[A[Q]];return $}function Et(A,g,y){const N=A.slice(g,y);let $="";for(let Q=0;Q<N.length-1;Q+=2)$+=String.fromCharCode(N[Q]+N[Q+1]*256);return $}u.prototype.slice=function(g,y){const N=this.length;g=~~g,y=y===void 0?N:~~y,g<0?(g+=N,g<0&&(g=0)):g>N&&(g=N),y<0?(y+=N,y<0&&(y=0)):y>N&&(y=N),y<g&&(y=g);const $=this.subarray(g,y);return Object.setPrototypeOf($,u.prototype),$};function ot(A,g,y){if(A%1!==0||A<0)throw new RangeError("offset is not uint");if(A+g>y)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let $=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)$+=this[g+it]*Q;return $},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let $=this[g+--y],Q=1;for(;y>0&&(Q*=256);)$+=this[g+--y]*Q;return $},u.prototype.readUint8=u.prototype.readUInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Ft(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+N*2**24;return BigInt($)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=Ft(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+N;return(BigInt($)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let $=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)$+=this[g+it]*Q;return Q*=128,$>=Q&&($-=Math.pow(2,8*y)),$},u.prototype.readIntBE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let $=y,Q=1,it=this[g+--$];for(;$>0&&(Q*=256);)it+=this[g+--$]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*y)),it},u.prototype.readInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const N=this[g]|this[g+1]<<8;return N&32768?N|4294901760:N},u.prototype.readInt16BE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const N=this[g+1]|this[g]<<8;return N&32768?N|4294901760:N},u.prototype.readInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Ft(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(N<<24);return(BigInt($)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Ft(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt($)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+N)}),u.prototype.readFloatLE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!1,52,8)};function lt(A,g,y,N,$,Q){if(!u.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>$||g<Q)throw new RangeError('"value" argument is out of bounds');if(y+N>A.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,y,N,$){if(g=+g,y=y>>>0,N=N>>>0,!$){const jt=Math.pow(2,8*N)-1;lt(this,g,y,N,jt,0)}let Q=1,it=0;for(this[y]=g&255;++it<N&&(Q*=256);)this[y+it]=g/Q&255;return y+N},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,y,N,$){if(g=+g,y=y>>>0,N=N>>>0,!$){const jt=Math.pow(2,8*N)-1;lt(this,g,y,N,jt,0)}let Q=N-1,it=1;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)this[y+Q]=g/it&255;return y+N},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,1,255,0),this[y]=g&255,y+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function Lt(A,g,y,N,$){st(g,N,$,A,y,7);let Q=Number(g&BigInt(4294967295));A[y++]=Q,Q=Q>>8,A[y++]=Q,Q=Q>>8,A[y++]=Q,Q=Q>>8,A[y++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return A[y++]=it,it=it>>8,A[y++]=it,it=it>>8,A[y++]=it,it=it>>8,A[y++]=it,y}function Xt(A,g,y,N,$){st(g,N,$,A,y,7);let Q=Number(g&BigInt(4294967295));A[y+7]=Q,Q=Q>>8,A[y+6]=Q,Q=Q>>8,A[y+5]=Q,Q=Q>>8,A[y+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return A[y+3]=it,it=it>>8,A[y+2]=it,it=it>>8,A[y+1]=it,it=it>>8,A[y]=it,y+8}u.prototype.writeBigUInt64LE=Ft(function(g,y=0){return Lt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Ft(function(g,y=0){return Xt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,y,N,$){if(g=+g,y=y>>>0,!$){const xe=Math.pow(2,8*N-1);lt(this,g,y,N,xe-1,-xe)}let Q=0,it=1,jt=0;for(this[y]=g&255;++Q<N&&(it*=256);)g<0&&jt===0&&this[y+Q-1]!==0&&(jt=1),this[y+Q]=(g/it>>0)-jt&255;return y+N},u.prototype.writeIntBE=function(g,y,N,$){if(g=+g,y=y>>>0,!$){const xe=Math.pow(2,8*N-1);lt(this,g,y,N,xe-1,-xe)}let Q=N-1,it=1,jt=0;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)g<0&&jt===0&&this[y+Q+1]!==0&&(jt=1),this[y+Q]=(g/it>>0)-jt&255;return y+N},u.prototype.writeInt8=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},u.prototype.writeInt16LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},u.prototype.writeInt16BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},u.prototype.writeInt32LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},u.prototype.writeInt32BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},u.prototype.writeBigInt64LE=Ft(function(g,y=0){return Lt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Ft(function(g,y=0){return Xt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Mt(A,g,y,N,$,Q){if(y+N>A.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function kt(A,g,y,N,$){return g=+g,y=y>>>0,$||Mt(A,g,y,4),n.write(A,g,y,N,23,4),y+4}u.prototype.writeFloatLE=function(g,y,N){return kt(this,g,y,!0,N)},u.prototype.writeFloatBE=function(g,y,N){return kt(this,g,y,!1,N)};function Bt(A,g,y,N,$){return g=+g,y=y>>>0,$||Mt(A,g,y,8),n.write(A,g,y,N,52,8),y+8}u.prototype.writeDoubleLE=function(g,y,N){return Bt(this,g,y,!0,N)},u.prototype.writeDoubleBE=function(g,y,N){return Bt(this,g,y,!1,N)},u.prototype.copy=function(g,y,N,$){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(N||(N=0),!$&&$!==0&&($=this.length),y>=g.length&&(y=g.length),y||(y=0),$>0&&$<N&&($=N),$===N||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),g.length-y<$-N&&($=g.length-y+N);const Q=$-N;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,N,$):s.prototype.set.call(g,this.subarray(N,$),y),Q},u.prototype.fill=function(g,y,N,$){if(typeof g=="string"){if(typeof y=="string"?($=y,y=0,N=this.length):typeof N=="string"&&($=N,N=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!u.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(g.length===1){const it=g.charCodeAt(0);($==="utf8"&&it<128||$==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<N)throw new RangeError("Out of range index");if(N<=y)return this;y=y>>>0,N=N===void 0?this.length:N>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=y;Q<N;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,$),jt=it.length;if(jt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<N-y;++Q)this[Q+y]=it[Q%jt]}return this};const Ut={};function we(A,g,y){Ut[A]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${A}]`,this.stack,delete this.name}get code(){return A}set code($){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:$,writable:!0})}toString(){return`${this.name} [${A}]: ${this.message}`}}}we("ERR_BUFFER_OUT_OF_BOUNDS",function(A){return A?`${A} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),we("ERR_INVALID_ARG_TYPE",function(A,g){return`The "${A}" argument must be of type number. Received type ${typeof g}`},TypeError),we("ERR_OUT_OF_RANGE",function(A,g,y){let N=`The value of "${A}" is out of range.`,$=y;return Number.isInteger(y)&&Math.abs(y)>2**32?$=Ne(String(y)):typeof y=="bigint"&&($=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&($=Ne($)),$+="n"),N+=` It must be ${g}. Received ${$}`,N},RangeError);function Ne(A){let g="",y=A.length;const N=A[0]==="-"?1:0;for(;y>=N+4;y-=3)g=`_${A.slice(y-3,y)}${g}`;return`${A.slice(0,y)}${g}`}function E(A,g,y){nt(g,"offset"),(A[g]===void 0||A[g+y]===void 0)&&F(g,A.length-(y+1))}function st(A,g,y,N,$,Q){if(A>y||A<g){const it=typeof g=="bigint"?"n":"";let jt;throw g===0||g===BigInt(0)?jt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:jt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Ut.ERR_OUT_OF_RANGE("value",jt,A)}E(N,$,Q)}function nt(A,g){if(typeof A!="number")throw new Ut.ERR_INVALID_ARG_TYPE(g,"number",A)}function F(A,g,y){throw Math.floor(A)!==A?(nt(A,y),new Ut.ERR_OUT_OF_RANGE("offset","an integer",A)):g<0?new Ut.ERR_BUFFER_OUT_OF_BOUNDS:new Ut.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,A)}const M=/[^+/0-9A-Za-z-_]/g;function K(A){if(A=A.split("=")[0],A=A.trim().replace(M,""),A.length<2)return"";for(;A.length%4!==0;)A=A+"=";return A}function at(A,g){g=g||1/0;let y;const N=A.length;let $=null;const Q=[];for(let it=0;it<N;++it){if(y=A.charCodeAt(it),y>55295&&y<57344){if(!$){if(y>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===N){(g-=3)>-1&&Q.push(239,191,189);continue}$=y;continue}if(y<56320){(g-=3)>-1&&Q.push(239,191,189),$=y;continue}y=($-55296<<10|y-56320)+65536}else $&&(g-=3)>-1&&Q.push(239,191,189);if($=null,y<128){if((g-=1)<0)break;Q.push(y)}else if(y<2048){if((g-=2)<0)break;Q.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;Q.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;Q.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Q}function ht(A){const g=[];for(let y=0;y<A.length;++y)g.push(A.charCodeAt(y)&255);return g}function Z(A,g){let y,N,$;const Q=[];for(let it=0;it<A.length&&!((g-=2)<0);++it)y=A.charCodeAt(it),N=y>>8,$=y%256,Q.push($),Q.push(N);return Q}function pt(A){return t.toByteArray(K(A))}function _t(A,g,y,N){let $;for($=0;$<N&&!($+y>=g.length||$>=A.length);++$)g[$+y]=A[$];return $}function dt(A,g){return A instanceof g||A!=null&&A.constructor!=null&&A.constructor.name!=null&&A.constructor.name===g.name}function vt(A){return A!==A}const ce=function(){const A="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const N=y*16;for(let $=0;$<16;++$)g[N+$]=A[y]+A[$]}return g}();function Ft(A){return typeof BigInt>"u"?Mn:A}function Mn(){throw new Error("BigInt not supported")}})(y0);const tn=y0.Buffer;function Bw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var b0={exports:{}},Ce=b0.exports={},Ir,Nr;function vu(){throw new Error("setTimeout has not been defined")}function Su(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Ir=setTimeout:Ir=vu}catch{Ir=vu}try{typeof clearTimeout=="function"?Nr=clearTimeout:Nr=Su}catch{Nr=Su}})();function E0(e){if(Ir===setTimeout)return setTimeout(e,0);if((Ir===vu||!Ir)&&setTimeout)return Ir=setTimeout,setTimeout(e,0);try{return Ir(e,0)}catch{try{return Ir.call(null,e,0)}catch{return Ir.call(this,e,0)}}}function Dw(e){if(Nr===clearTimeout)return clearTimeout(e);if((Nr===Su||!Nr)&&clearTimeout)return Nr=clearTimeout,clearTimeout(e);try{return Nr(e)}catch{try{return Nr.call(null,e)}catch{return Nr.call(this,e)}}}var ti=[],Os=!1,Vi,Xa=-1;function $w(){!Os||!Vi||(Os=!1,Vi.length?ti=Vi.concat(ti):Xa=-1,ti.length&&w0())}function w0(){if(!Os){var e=E0($w);Os=!0;for(var t=ti.length;t;){for(Vi=ti,ti=[];++Xa<t;)Vi&&Vi[Xa].run();Xa=-1,t=ti.length}Vi=null,Os=!1,Dw(e)}}Ce.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ti.push(new x0(e,t)),ti.length===1&&!Os&&E0(w0)};function x0(e,t){this.fun=e,this.array=t}x0.prototype.run=function(){this.fun.apply(null,this.array)},Ce.title="browser",Ce.browser=!0,Ce.env={},Ce.argv=[],Ce.version="",Ce.versions={};function ei(){}Ce.on=ei,Ce.addListener=ei,Ce.once=ei,Ce.off=ei,Ce.removeListener=ei,Ce.removeAllListeners=ei,Ce.emit=ei,Ce.prependListener=ei,Ce.prependOnceListener=ei,Ce.listeners=function(e){return[]},Ce.binding=function(e){throw new Error("process.binding is not supported")},Ce.cwd=function(){return"/"},Ce.chdir=function(e){throw new Error("process.chdir is not supported")},Ce.umask=function(){return 0};var jw=b0.exports;const vi=Bw(jw),k0=e=>e===void 0?null:e;class zw{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let T0=new zw,Ww=!0;try{typeof localStorage<"u"&&localStorage&&(T0=localStorage,Ww=!1)}catch{}const Kw=T0,Gw=Object.assign,Hw=Object.keys,Yw=(e,t)=>{for(const n in e)t(e[n],n)},A0=e=>Hw(e).length,Vw=e=>{for(const t in e)return!1;return!0},Xw=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},qw=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Jw=(e,t)=>e===t||A0(e)===A0(t)&&Xw(e,(n,r)=>(n!==void 0||qw(t,r))&&t[r]===n),Zw=Object.freeze,v0=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&v0(e[t])}return Zw(e)},Ru=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Ru(e,t,n+1)}},Qw=e=>e,tx=(e,t)=>t.includes(e);var S0={};const Co=typeof vi<"u"&&vi.release&&/node|io\.js/.test(vi.release.name)&&Object.prototype.toString.call(typeof vi<"u"?vi:0)==="[object process]";let Or;const ex=()=>{if(Or===void 0)if(Co){Or=ur();const e=vi.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Or.set(t,""),t=r):t!==null&&(Or.set(t,r),t=null)}t!==null&&Or.set(t,"")}else typeof location=="object"?(Or=ur(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Or.set(`--${a0(t,"-")}`,n),Or.set(`-${a0(t,"-")}`,n)}})):Or=ur();return Or},Iu=e=>ex().has(e),qa=e=>k0(Co?S0[e.toUpperCase().replaceAll("-","_")]:Kw.getItem(e)),R0=e=>Iu("--"+e)||qa(e)!==null;R0("production");const nx=Co&&tx(S0.FORCE_COLOR,["true","1","2"])||!Iu("--no-colors")&&!R0("no-color")&&(!Co||vi.stdout.isTTY)&&(!Co||Iu("--color")||qa("COLORTERM")!==null||(qa("TERM")||"").includes("color")),rx=e=>new Uint8Array(e),ix=e=>{const t=rx(e.byteLength);return t.set(e),t};class sx{constructor(t,n){this.left=t,this.right=n}}const ni=(e,t)=>new sx(e,t);typeof DOMParser<"u"&&new DOMParser;const ox=e=>tw(e,(t,n)=>`${n}:${t};`).join(""),ri=Symbol,I0=ri(),N0=ri(),ax=ri(),cx=ri(),lx=ri(),O0=ri(),ux=ri(),Nu=ri(),hx=ri(),fx=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},dx={[I0]:ni("font-weight","bold"),[N0]:ni("font-weight","normal"),[ax]:ni("color","blue"),[lx]:ni("color","green"),[cx]:ni("color","grey"),[O0]:ni("color","red"),[ux]:ni("color","purple"),[Nu]:ni("color","orange"),[hx]:ni("color","black")},C0=nx?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=ur();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=dx[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=ox(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:fx,px=(...e)=>{console.log(...C0(e)),L0.forEach(t=>t.print(e))},mx=(...e)=>{console.warn(...C0(e)),e.unshift(Nu),L0.forEach(t=>t.print(e))},L0=As(),M0=e=>({[Symbol.iterator](){return this},next:e}),gx=(e,t)=>M0(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Ou=(e,t)=>M0(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Cu{constructor(t,n){this.clock=t,this.len=n}}class Lo{constructor(){this.clients=new Map}}const U0=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];J0(e,s,a.clock,a.len,n)}}),yx=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ti((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},F0=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&yx(n,t.clock)!==null},Lu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Hi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},_x=e=>{const t=new Lo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)nw(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Lu(t),t},Ja=(e,t,n,r)=>{ki(e.clients,t,()=>[]).push(new Cu(n,r))},bx=()=>new Lo,Ex=e=>{const t=bx();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Cu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Cs=(e,t)=>{ne(e.restEncoder,t.clients.size),Gi(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),ne(e.restEncoder,n);const i=r.length;ne(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Mu=e=>{const t=new Lo,n=Kt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Kt(e.restDecoder),s=Kt(e.restDecoder);if(s>0){const o=ki(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Cu(e.readDsClock(),e.readDsLen()))}}return t},P0=(e,t,n)=>{const r=new Lo,i=Kt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Kt(e.restDecoder),a=Kt(e.restDecoder),c=n.clients.get(o)||[],l=Je(n,o);for(let u=0;u<a;u++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<l){l<d&&Ja(r,o,l,d-l);let f=Cr(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,hc(t,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,hc(t,p,d-p.id.clock)),p.delete(t))}else Ja(r,o,h,d-h)}}if(r.clients.size>0){const s=new Xi;return ne(s.restEncoder,0),Cs(s,r),s.toUint8Array()}return null},B0=m0;class Ls extends iw{constructor({guid:t=Iw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=B0(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new V0,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=g0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>g0(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&ue(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Gi(this.subdocs).map(t=>t.guid))}transact(t,n=null){return ue(this,t,n)}get(t,n=en){const r=ki(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==en&&i!==n)if(i===en){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Ps)}getText(t=""){return this.get(t,ii)}getMap(t=""){return this.get(t,Bs)}getXmlElement(t=""){return this.get(t,$s)}getXmlFragment(t=""){return this.get(t,qi)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Gi(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Ls({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,ue(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class D0{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Kt(this.restDecoder)}readDsLen(){return Kt(this.restDecoder)}}class $0 extends D0{readLeftID(){return qt(Kt(this.restDecoder),Kt(this.restDecoder))}readRightID(){return qt(Kt(this.restDecoder),Kt(this.restDecoder))}readClient(){return Kt(this.restDecoder)}readInfo(){return Rs(this.restDecoder)}readString(){return Is(this.restDecoder)}readParentInfo(){return Kt(this.restDecoder)===1}readTypeRef(){return Kt(this.restDecoder)}readLen(){return Kt(this.restDecoder)}readAny(){return Oo(this.restDecoder)}readBuf(){return ix(Bn(this.restDecoder))}readJSON(){return JSON.parse(Is(this.restDecoder))}readKey(){return Is(this.restDecoder)}}class wx{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Kt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Kt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Ms extends wx{constructor(t){super(t),this.keys=[],Kt(t),this.keyClockDecoder=new ku(Bn(t)),this.clientDecoder=new Ya(Bn(t)),this.leftClockDecoder=new ku(Bn(t)),this.rightClockDecoder=new ku(Bn(t)),this.infoDecoder=new p0(Bn(t),Rs),this.stringDecoder=new vw(Bn(t)),this.parentInfoDecoder=new p0(Bn(t),Rs),this.typeRefDecoder=new Ya(Bn(t)),this.lenDecoder=new Ya(Bn(t))}readLeftID(){return new Us(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Us(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Oo(this.restDecoder)}readBuf(){return Bn(this.restDecoder)}readJSON(){return Oo(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class xx{constructor(){this.restEncoder=Wa()}toUint8Array(){return Ar(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){ne(this.restEncoder,t)}writeDsLen(t){ne(this.restEncoder,t)}}class Mo extends xx{writeLeftID(t){ne(this.restEncoder,t.client),ne(this.restEncoder,t.clock)}writeRightID(t){ne(this.restEncoder,t.client),ne(this.restEncoder,t.clock)}writeClient(t){ne(this.restEncoder,t)}writeInfo(t){gu(this.restEncoder,t)}writeString(t){vs(this.restEncoder,t)}writeParentInfo(t){ne(this.restEncoder,t?1:0)}writeTypeRef(t){ne(this.restEncoder,t)}writeLen(t){ne(this.restEncoder,t)}writeAny(t){No(this.restEncoder,t)}writeBuf(t){Pn(this.restEncoder,t)}writeJSON(t){vs(this.restEncoder,JSON.stringify(t))}writeKey(t){vs(this.restEncoder,t)}}class kx{constructor(){this.restEncoder=Wa(),this.dsCurrVal=0}toUint8Array(){return Ar(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,ne(this.restEncoder,n)}writeDsLen(t){t===0&&Sr(),ne(this.restEncoder,t-1),this.dsCurrVal+=t}}class Xi extends kx{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Eu,this.clientEncoder=new Ga,this.leftClockEncoder=new Eu,this.rightClockEncoder=new Eu,this.infoEncoder=new l0(gu),this.stringEncoder=new xw,this.parentInfoEncoder=new l0(gu),this.typeRefEncoder=new Ga,this.lenEncoder=new Ga}toUint8Array(){const t=Wa();return ne(t,0),Pn(t,this.keyClockEncoder.toUint8Array()),Pn(t,this.clientEncoder.toUint8Array()),Pn(t,this.leftClockEncoder.toUint8Array()),Pn(t,this.rightClockEncoder.toUint8Array()),Pn(t,Ar(this.infoEncoder)),Pn(t,this.stringEncoder.toUint8Array()),Pn(t,Ar(this.parentInfoEncoder)),Pn(t,this.typeRefEncoder.toUint8Array()),Pn(t,this.lenEncoder.toUint8Array()),Ka(t,Ar(this.restEncoder)),Ar(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){No(this.restEncoder,t)}writeBuf(t){Pn(this.restEncoder,t)}writeJSON(t){No(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Tx=(e,t,n,r)=>{r=Hi(r,t[0].id.clock);const i=Cr(t,r);ne(e.restEncoder,t.length-i),e.writeClient(n),ne(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Uu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Je(t,s)>i&&r.set(s,i)}),Pu(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ne(e.restEncoder,r.size),Gi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Tx(e,t.clients.get(i),i,s)})},Ax=(e,t)=>{const n=ur(),r=Kt(e.restDecoder);for(let i=0;i<r;i++){const s=Kt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Kt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(za&u){case 0:{const h=e.readLen();o[l]=new Vn(qt(a,c),h),c+=h;break}case 10:{const h=Kt(e.restDecoder);o[l]=new Xn(qt(a,c),h),c+=h;break}default:{const h=(u&(Qr|Fn))===0,d=new We(qt(a,c),null,(u&Fn)===Fn?e.readLeftID():null,null,(u&Qr)===Qr?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(u&vo)===vo?e.readString():null,xp(e,u));o[l]=d,c+=d.length}}}}return n},vx=(e,t,n)=>{const r=[];let i=Gi(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new V0,c=new Map,l=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),i=i.filter(x=>x!==p)}r.length=0};for(;;){if(u.constructor!==Xn){const p=ki(h,u.id.client,()=>Je(t,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(e,t);if(m!==null){r.push(u);const x=n.get(m)||{refs:[],i:0};if(x.refs.length===x.i)l(m,Je(t,m)),d();else{u=x.refs[x.i++];continue}}else(p===0||p<u.length)&&(u.integrate(e,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new Xi;return Uu(f,a,new Map),ne(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},Sx=(e,t)=>Uu(e,t.doc.store,t.beforeState),Rx=(e,t,n,r=new Ms(e))=>ue(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=Ax(r,o),l=vx(i,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<Je(a,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=tc([u.update,l.update])}}else a.pendingStructs=l;const h=P0(r,i,a);if(a.pendingDs){const d=new Ms(Ss(a.pendingDs));Kt(d.restDecoder);const f=P0(d,i,a);h&&f?a.pendingDs=tc([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,j0(i.doc,d)}},n,!1),j0=(e,t,n,r=Ms)=>{const i=Ss(t);Rx(i,e,n,new r(i))},z0=(e,t,n)=>j0(e,t,n,$0),Ix=(e,t,n=new Map)=>{Uu(e,t.store,n),Cs(e,Ex(t.store))},Nx=(e,t=new Uint8Array([0]),n=new Xi)=>{const r=W0(t);Ix(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(zx(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Mo)return $x(i.map((s,o)=>o===0?s:Kx(s)));if(n.constructor===Xi)return tc(i)}return i[0]},Ox=(e,t)=>Nx(e,t,new Mo),Cx=e=>{const t=new Map,n=Kt(e.restDecoder);for(let r=0;r<n;r++){const i=Kt(e.restDecoder),s=Kt(e.restDecoder);t.set(i,s)}return t},W0=e=>Cx(new D0(Ss(e)));class Lx{constructor(){this.l=[]}}const K0=()=>new Lx,G0=(e,t)=>e.l.push(t),H0=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Y0=(e,t,n)=>Ru(e.l,[t,n]);class Us{constructor(t,n){this.client=t,this.clock=n}}const Za=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,qt=(e,t)=>new Us(e,t),Mx=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Sr()},Fs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!F0(t.ds,e.id),Fu=(e,t)=>{const n=ki(e.meta,Fu,As),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Je(r,s)&&Si(e,qt(s,i))}),U0(e,t.ds,i=>{}),n.add(t))};class V0{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Pu=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Je=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},X0=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Sr()}n.push(t)},Cr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ti(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ti((n+r)/2)}throw Sr()},Bu=(e,t)=>{const n=e.clients.get(t.client);return n[Cr(n,t.clock)]},Du=(e,t,n)=>{const r=Cr(t,n),i=t[r];return i.id.clock<n&&i instanceof We?(t.splice(r+1,0,hc(e,i,n-i.id.clock)),r+1):r},Si=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Du(e,n,t.clock)]},q0=(e,t,n)=>{const r=t.clients.get(n.client),i=Cr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Vn&&r.splice(i+1,0,hc(e,s,n.clock-s.id.clock+1)),s},Ux=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Cr(r,t.id.clock)]=n},J0=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Du(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Du(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class Fx{constructor(t,n,r){this.doc=t,this.deleteSet=new Lo,this.beforeState=Pu(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Z0=(e,t)=>t.deleteSet.clients.size===0&&!ew(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Lu(t.deleteSet),Sx(e,t),Cs(e,t.deleteSet),!0),Q0=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&ki(e.changed,t,As).add(n)},Qa=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof We&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},Px=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Cr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof We&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Bx=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=n0(i.length-1,1+Cr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Qa(i,c)}})},tp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Lu(s),n.afterState=Pu(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),Y0(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Ru(a,[]),n._needFormattingCleanup&&ik(n)}finally{r.gc&&Px(s,i,r.gcFilter),Bx(s,i),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),p=Hi(Cr(f,d),1);for(let m=f.length-1;m>=p;)m-=1+Qa(f,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=i.clients.get(h),p=Cr(f,d);p+1<f.length&&Qa(f,p+1)>1||p>0&&Qa(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(px(Nu,I0,"[yjs] ",N0,O0,"Changed the client-id because another client seems to be using it."),r.clientID=B0()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Mo;Z0(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Xi;Z0(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):tp(e,t+1)}}},ue=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new Fx(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&tp(i,0)}}return o};function*Dx(e){const t=Kt(e.restDecoder);for(let n=0;n<t;n++){const r=Kt(e.restDecoder),i=e.readClient();let s=Kt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Kt(e.restDecoder);yield new Xn(qt(i,s),c),s+=c}else if(za&a){const c=(a&(Qr|Fn))===0,l=new We(qt(i,s),null,(a&Fn)===Fn?e.readLeftID():null,null,(a&Qr)===Qr?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&vo)===vo?e.readString():null,xp(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new Vn(qt(i,s),c),s+=c}}}}class $u{constructor(t,n){this.gen=Dx(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Xn);return this.curr}}class ju{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const $x=e=>tc(e,$0,Mo),jx=(e,t)=>{if(e.constructor===Vn){const{client:n,clock:r}=e.id;return new Vn(qt(n,r+t),e.length-t)}else if(e.constructor===Xn){const{client:n,clock:r}=e.id;return new Xn(qt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new We(qt(r,i+t),null,qt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},tc=(e,t=Ms,n=Xi)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Ss(u)));let i=r.map(u=>new $u(u,!0)),s=null;const o=new n,a=new ju(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===Xn?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Ri(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Xn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Ri(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Xn(qt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===Xn?s.struct.length-=p:d=jx(d,p)),s.struct.mergeWith(d)||(Ri(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Xn;d=u.next())Ri(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Ri(a,s.struct,s.offset),s=null),zu(a);const c=r.map(u=>Mu(u)),l=_x(c);return Cs(o,l),o.toUint8Array()},zx=(e,t,n=Ms,r=Xi)=>{const i=W0(t),s=new r,o=new ju(s),a=new n(Ss(e)),c=new $u(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===Xn){c.next();continue}if(u.id.clock+u.length>d)for(Ri(o,u,Hi(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Ri(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}zu(o);const l=Mu(a);return Cs(s,l),s.toUint8Array()},ep=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Ar(e.encoder.restEncoder)}),e.encoder.restEncoder=Wa(),e.written=0)},Ri=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&ep(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ne(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},zu=e=>{ep(e);const t=e.encoder.restEncoder;ne(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];ne(t,r.written),Ka(t,r.restEncoder)}},Wx=(e,t,n,r)=>{const i=new n(Ss(e)),s=new $u(i,!1),o=new r,a=new ju(o);for(let l=s.curr;l!==null;l=s.next())Ri(a,t(l),0);zu(a);const c=Mu(i);return Cs(o,c),o.toUint8Array()},Kx=e=>Wx(e,Qw,Ms,Mo),np="You must not compute changes after the event-handler fired.";class ec{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Gx(this.currentTarget,this.target))}deletes(t){return F0(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ai(np);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=fu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=fu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=fu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ai(np);const n=this.target,r=As(),i=As(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const Gx=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},an=()=>{mx("Invalid access: Add Yjs type to a document before reading data.")},rp=80;let Wu=0;class Hx{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Wu++}}const Yx=e=>{e.timestamp=Wu++},ip=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Wu++},Vx=(e,t,n)=>{if(e.length>=rp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return ip(r,t,n),r}else{const r=new Hx(t,n);return e.push(r),r}},nc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>ja(t-s.index)<ja(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Yx(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ja(n.index-i)<r.parent.length/rp?(ip(n,r,i),n):Vx(e._searchMarker,r,i)},Uo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Hi(t,i.index+n))}},rc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;ki(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Y0(r._eH,n,t)};class en{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=K0(),this._dEH=K0(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw vr()}clone(){throw vr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){G0(this._eH,t)}observeDeep(t){G0(this._dEH,t)}unobserve(t){H0(this._eH,t)}unobserveDeep(t){H0(this._dEH,t)}toJSON(){}}const sp=(e,t,n)=>{e.doc??an(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},op=e=>{e.doc??an();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Fo=(e,t)=>{let n=0,r=e._start;for(e.doc??an();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},ap=(e,t)=>{const n=[];return Fo(e,(r,i)=>{n.push(t(r,i,e))}),n},Xx=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},cp=(e,t)=>{e.doc??an();const n=nc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},ic=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new We(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Zi(l)),i.integrate(e,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new We(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Po(new Uint8Array(h))),i.integrate(e,0);break;case Ls:i=new We(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Do(h)),i.integrate(e,0);break;default:if(h instanceof en)i=new We(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new si(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},lp=()=>Ai("Length exceeded!"),up=(e,t,n,r)=>{if(n>t._length)throw lp();if(n===0)return t._searchMarker&&Uo(t._searchMarker,n,r.length),ic(e,t,null,r);const i=n,s=nc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Si(e,qt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Uo(t._searchMarker,i,r.length),ic(e,t,o,r)},qx=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return ic(e,t,i,n)},hp=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=nc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Si(e,qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Si(e,qt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw lp();t._searchMarker&&Uo(t._searchMarker,i,-s+r)},sc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Ku=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new Zi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Zi([r]);break;case Uint8Array:a=new Po(r);break;case Ls:a=new Do(r);break;default:if(r instanceof en)a=new si(r);else throw new Error("Unexpected content type")}new We(qt(o,Je(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Gu=(e,t)=>{e.doc??an();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},fp=e=>{const t={};return e.doc??an(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},dp=(e,t)=>{e.doc??an();const n=e._map.get(t);return n!==void 0&&!n.deleted},Jx=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Fs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},oc=e=>(e.doc??an(),gx(e._map.entries(),t=>!t[1].deleted));class Zx extends ec{}class Ps extends en{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Ps;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ps}clone(){const t=new Ps;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??an(),this._length}_callObserver(t,n){super._callObserver(t,n),rc(this,t,new Zx(this,t))}insert(t,n){this.doc!==null?ue(this.doc,r=>{up(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?ue(this.doc,n=>{qx(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{hp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return cp(this,t)}toArray(){return op(this)}slice(t=0,n=this.length){return sp(this,t,n)}toJSON(){return this.map(t=>t instanceof en?t.toJSON():t)}map(t){return ap(this,t)}forEach(t){Fo(this,t)}[Symbol.iterator](){return Xx(this)}_write(t){t.writeTypeRef(kk)}}const Qx=e=>new Ps;class tk extends ec{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Bs extends en{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Bs}clone(){const t=new Bs;return this.forEach((n,r)=>{t.set(r,n instanceof en?n.clone():n)}),t}_callObserver(t,n){rc(this,t,new tk(this,t,n))}toJSON(){this.doc??an();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof en?i.toJSON():i}}),t}get size(){return[...oc(this)].length}keys(){return Ou(oc(this),t=>t[0])}values(){return Ou(oc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Ou(oc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??an(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ue(this.doc,n=>{sc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?ue(this.doc,r=>{Ku(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Gu(this,t)}has(t){return dp(this,t)}clear(){this.doc!==null?ue(this.doc,t=>{this.forEach(function(n,r,i){sc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Tk)}}const ek=e=>new Bs,Ii=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Jw(e,t);class Hu{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Sr(),this.right.content.constructor){case ze:this.right.deleted||Ds(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const pp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case ze:t.right.deleted||Ds(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Si(e,qt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},ac=(e,t,n,r)=>{const i=new Map,s=r?nc(t,n):null;if(s){const o=new Hu(s.p.left,s.p,s.index,i);return pp(e,o,n-s.index)}else{const o=new Hu(null,t._start,0,i);return pp(e,o,n)}},mp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===ze&&Ii(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new We(qt(s,Je(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new ze(a,o));u.integrate(e,0),n.right=u,n.forward()})},Ds=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},gp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===ze&&Ii(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},yp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Ii(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new We(qt(s,Je(i.store,s)),u,u&&u.lastId,h,h&&h.id,t,null,new ze(a,c)),n.right.integrate(e,0),n.forward()}}return o},Yu=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=e.doc,o=s.clientID;gp(n,i);const a=yp(e,t,n,i),c=r.constructor===String?new Lr(r):r instanceof en?new si(r):new Ji(r);let{left:l,right:u,index:h}=n;t._searchMarker&&Uo(t._searchMarker,n.index,c.getLength()),u=new We(qt(o,Je(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=h,n.forward(),mp(e,t,n,a)},_p=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;gp(n,i);const a=yp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===ze));){if(!n.right.deleted)switch(n.right.content.constructor){case ze:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Ii(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Si(e,qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new We(qt(o,Je(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Lr(c)),n.right.integrate(e,0),n.forward()}mp(e,t,n,a)},bp=(e,t,n,r,i)=>{let s=t;const o=ur();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===ze){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case ze:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(t.delete(e),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&Ds(i,l);break}}}t=t.right}return a},nk=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===ze){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},rk=e=>{let t=0;return ue(e.doc,n=>{let r=e._start,i=e._start,s=ur();const o=hu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case ze:Ds(o,i.content);break;default:t+=bp(n,r,i,s,o),s=hu(o),r=i;break}i=i.right}}),t},ik=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&J0(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===ze&&o.constructor!==Vn&&t.add(o.parent)})}ue(n,r=>{U0(e,e.deleteSet,i=>{if(i instanceof Vn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===ze?t.add(s):nk(r,i)});for(const i of t)rk(i)})},Ep=(e,t,n)=>{const r=n,i=hu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case si:case Ji:case Lr:n<t.right.length&&Si(e,qt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&bp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Uo(o._searchMarker,t.index,-r+n),t};class sk extends ec{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];ue(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},Vw(c)||(f.attributes=Gw({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case si:case Ji:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Lr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case ze:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(f)??null;Ii(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Ii(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const m=i.get(f)??null;Ii(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){s.set(f,p);const m=c[f];m!==void 0&&(Ii(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),Ds(i,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class ii extends en{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??an(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new ii}clone(){const t=new ii;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new sk(this,t,n);rc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??an();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Lr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?ue(this.doc,r=>{const i=new Hu(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Yu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?_p(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Ep(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??an();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const u=()=>{for(;c!==null;){if(Fs(c,t)||n!==void 0&&Fs(c,n))switch(c.content.constructor){case Lr:{const h=s.get("ychange");t!==void 0&&!Fs(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Fs(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case si:case Ji:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case ze:Fs(c,t)&&(l(),Ds(s,c.content));break}c=c.right}l()};return t||n?ue(o,h=>{t&&Fu(h,t),n&&Fu(h,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ac(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Yu(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?ue(i,s=>{const o=ac(s,this,t,!r);Yu(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?ue(r,i=>{Ep(i,ac(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ac(s,this,t,!1);o.right!==null&&_p(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{sc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{Ku(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Gu(this,t)}getAttributes(){return fp(this)}_write(t){t.writeTypeRef(Ak)}}const ok=e=>new ii;class Vu{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??an()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===$s||n.constructor===qi)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class qi extends en{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new qi}clone(){const t=new qi;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??an(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Vu(this,t)}querySelector(t){t=t.toUpperCase();const r=new Vu(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Gi(new Vu(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){rc(this,t,new lk(this,n,t))}toString(){return ap(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Fo(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?ue(this.doc,r=>{up(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)ue(this.doc,r=>{const i=t&&t instanceof en?t._item:t;ic(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ai("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{hp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return op(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return cp(this,t)}slice(t=0,n=this.length){return sp(this,t,n)}forEach(t){Fo(this,t)}_write(t){t.writeTypeRef(Sk)}}const ak=e=>new qi;class $s extends qi{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new $s(this.nodeName)}clone(){const t=new $s(this.nodeName),n=this.getAttributes();return Yw(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof en?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{sc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{Ku(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Gu(this,t)}hasAttribute(t){return dp(this,t)}getAttributes(t){return t?Jx(this,t):fp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Fo(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(vk),t.writeKey(this.nodeName)}}const ck=e=>new $s(e.readKey());class lk extends ec{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class cc extends Bs{constructor(t){super(),this.hookName=t}_copy(){return new cc(this.hookName)}clone(){const t=new cc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Rk),t.writeKey(this.hookName)}}const uk=e=>new cc(e.readKey());class lc extends ii{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new lc}clone(){const t=new lc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ik)}}const hk=e=>new lc;class Xu{constructor(t,n){this.id=t,this.length=n}get deleted(){throw vr()}mergeWith(t){return!1}write(t,n,r){throw vr()}integrate(t,n){throw vr()}}const fk=0;class Vn extends Xu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),X0(t.doc.store,this)}write(t,n){t.writeInfo(fk),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Po{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Po(this.content)}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const dk=e=>new Po(e.readBuf());class Bo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Bo(this.len)}splice(t){const n=new Bo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Ja(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const pk=e=>new Bo(e.readLen()),wp=(e,t)=>new Ls({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Do{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Do(wp(this.doc.guid,this.opts))}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const mk=e=>new Do(wp(e.readString(),e.readAny()));class Ji{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ji(this.embed)}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const gk=e=>new Ji(e.readJSON());class ze{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ze(this.key,this.value)}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const yk=e=>new ze(e.readKey(),e.readJSON());class uc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new uc(this.arr)}splice(t){const n=new uc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const _k=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new uc(n)},bk=qa("node_env")==="development";class Zi{constructor(t){this.arr=t,bk&&v0(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Zi(this.arr)}splice(t){const n=new Zi(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const Ek=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Zi(n)};class Lr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Lr(this.str)}splice(t){const n=new Lr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const wk=e=>new Lr(e.readString()),xk=[Qx,ek,ok,ck,ak,uk,hk],kk=0,Tk=1,Ak=2,vk=3,Sk=4,Rk=5,Ik=6;class si{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new si(this.type._copy())}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Nk=e=>new si(xk[e.readTypeRef()](e)),hc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new We(qt(r,i+n),t,qt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=qt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class We extends Xu{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?s0:0}set marker(t){(this.info&pu)>0!==t&&(this.info^=pu)}get marker(){return(this.info&pu)>0}get keep(){return(this.info&i0)>0}set keep(t){this.keep!==t&&(this.info^=i0)}get countable(){return(this.info&s0)>0}get deleted(){return(this.info&du)>0}set deleted(t){this.deleted!==t&&(this.info^=du)}markDeleted(){this.info|=du}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Je(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Je(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Us&&this.id.client!==this.parent.client&&this.parent.clock>=Je(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=q0(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Si(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Vn||this.right&&this.right.constructor===Vn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===We?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===We&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Us){const r=Bu(n,this.parent);r.constructor===Vn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=q0(t,t.doc.store,qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Za(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Za(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Bu(t.doc.store,i.origin)))s.has(Bu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),X0(t.doc.store,this),this.content.integrate(t,this),Q0(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Vn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:qt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Za(t.origin,this.lastId)&&this.right===t&&Za(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Ja(t.deleteSet,this.id.client,this.id.clock,this.length),Q0(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Sr();this.content.gc(t),n?Ux(t,this,new Vn(this.id,this.length)):this.content=new Bo(this.length)}write(t,n){const r=n>0?qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&za|(r===null?0:Fn)|(i===null?0:Qr)|(s===null?0:vo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=Mx(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Us?(t.writeParentInfo(!1),t.writeLeftID(a)):Sr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const xp=(e,t)=>Ok[t&za](e),Ok=[()=>{Sr()},pk,_k,dk,wk,gk,yk,Nk,Ek,mk,()=>{Sr()}],Ck=10;class Xn extends Xu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Sr()}write(t,n){t.writeInfo(Ck),ne(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const kp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ts<"u"?Ts:{},Tp="__ $YJS$ __";kp[Tp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),kp[Tp]=!0;let Ap=!1;const Dn=new Ls;function vp(e,t,n){const r=Dn.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function Lk(e,t){vp(e,0,t)}function qu(e,t){const n=new ii(t);vp(e,1,n)}function Mk(e,t){Dn.getMap().set(e,t)}function Uk(e,t){const n=Dn.getMap(),r=new ii(t);n.set(e,r)}function Sp(e,t){const n=Dn.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function Fk(e,t){return Sp(e,n=>{Rt(n)&&t(n)})}function Rp(e,t){return Sp(e,n=>{n instanceof ii&&t(n.toJSON())})}const Qi=xs("modem",["second"],e=>{if(Qi.session(e))switch(e.target){case"second":!Ap&&e.data%2===0&&Qi.emit(e.player,"modem:join");break;case"join":e.sender!==Qi.id()&&Qi.reply(e,"joinack",Zd(Ox(Dn)));break;case"joinack":e.sender!==Qi.id()&&(Ap=!0,z0(Dn,Da(e.data),Dn));break;case"sync":{e.sender!==Qi.id()&&k(e.data)&&z0(Dn,Da(e.data),Dn);break}}});function Ip(e,t){t!==Dn&&Qi.emit("","modem:sync",Zd(e))}Dn.on("update",Ip),Dn.on("destroy",()=>{Dn.off("update",Ip)});function Pk(e,t){return e%t}function Bk(e,t){return Math.floor(e/t)}function Dk(e,t){return{x:Pk(e,t),y:Bk(e,t)}}function js(e,t){return e.x+e.y*t}function Ju(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function Np(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Op="170",$k="",hr="srgb",Cp="srgb-linear",Lp="linear",Zu="srgb";function zs(e,t,n){return Math.max(t,Math.min(n,e))}function jk(e,t){return(e%t+t)%t}function Qu(e,t,n){return(1-n)*e+n*t}class $o{constructor(t=0,n=0){$o.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(zs(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class jo{constructor(t,n,r,i,s,o,a,c,l){jo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],m=i[0],x=i[3],w=i[6],T=i[1],v=i[4],I=i[7],U=i[2],R=i[5],L=i[8];return s[0]=o*m+a*T+c*U,s[3]=o*x+a*v+c*R,s[6]=o*w+a*I+c*L,s[1]=l*m+u*T+h*U,s[4]=l*x+u*v+h*R,s[7]=l*w+u*I+h*L,s[2]=d*m+f*T+p*U,s[5]=d*x+f*v+p*R,s[8]=d*w+f*I+p*L,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,p=n*h+r*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*l-u*r)*m,t[2]=(a*r-i*o)*m,t[3]=d*m,t[4]=(u*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=f*m,t[7]=(r*c-l*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(th.makeScale(t,n)),this}rotate(t){return this.premultiply(th.makeRotation(-t)),this}translate(t,n){return this.premultiply(th.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const th=new jo,qn={enabled:!0,workingColorSpace:Cp,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===Zu&&(e.r=Ws(e.r),e.g=Ws(e.g),e.b=Ws(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Zu&&(e.r=Ks(e.r),e.g=Ks(e.g),e.b=Ks(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===$k?Lp:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function Ws(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Ks(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const Mp=[.64,.33,.3,.6,.15,.06],Up=[.2126,.7152,.0722],Fp=[.3127,.329],Pp=new jo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Bp=new jo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);qn.define({[Cp]:{primaries:Mp,whitePoint:Fp,transfer:Lp,toXYZ:Pp,fromXYZ:Bp,luminanceCoefficients:Up,workingColorSpaceConfig:{unpackColorSpace:hr},outputColorSpaceConfig:{drawingBufferColorSpace:hr}},[hr]:{primaries:Mp,whitePoint:Fp,transfer:Zu,toXYZ:Pp,fromXYZ:Bp,luminanceCoefficients:Up,outputColorSpaceConfig:{drawingBufferColorSpace:hr}}});const Dp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ni={h:0,s:0,l:0},fc={h:0,s:0,l:0};function eh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class nh{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=hr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,qn.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=qn.workingColorSpace){return this.r=t,this.g=n,this.b=r,qn.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=qn.workingColorSpace){if(t=jk(t,1),n=zs(n,0,1),r=zs(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=eh(o,s,t+1/3),this.g=eh(o,s,t),this.b=eh(o,s,t-1/3)}return qn.toWorkingColorSpace(this,i),this}setStyle(t,n=hr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=hr){const r=Dp[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ws(t.r),this.g=Ws(t.g),this.b=Ws(t.b),this}copyLinearToSRGB(t){return this.r=Ks(t.r),this.g=Ks(t.g),this.b=Ks(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=hr){return qn.fromWorkingColorSpace(cn.copy(this),t),Math.round(zs(cn.r*255,0,255))*65536+Math.round(zs(cn.g*255,0,255))*256+Math.round(zs(cn.b*255,0,255))}getHexString(t=hr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=qn.workingColorSpace){qn.fromWorkingColorSpace(cn.copy(this),n);const r=cn.r,i=cn.g,s=cn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=qn.workingColorSpace){return qn.fromWorkingColorSpace(cn.copy(this),n),t.r=cn.r,t.g=cn.g,t.b=cn.b,t}getStyle(t=hr){qn.fromWorkingColorSpace(cn.copy(this),t);const n=cn.r,r=cn.g,i=cn.b;return t!==hr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Ni),this.setHSL(Ni.h+t,Ni.s+n,Ni.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Ni),t.getHSL(fc);const r=Qu(Ni.h,fc.h,n),i=Qu(Ni.s,fc.s,n),s=Qu(Ni.l,fc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const cn=new nh;nh.NAMES=Dp,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Op}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Op),new $o,new $o;function nn(e,t,n){return Math.max(t,Math.min(n,e))}function rh(e){return e*180/Math.PI}const zk=_d("089fad0j9awfem09wavefc09uwaef");function Wk(){return zk()}function Kk(e){return _d(e)()}function Jn(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Wk()*i)}function $p(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(Kk(e)*s)}function jp(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function Gk(e){return e[Jn(0,e.length-1)]}function Hk(e,t){return t[$p(e,0,t.length-1)]}function Le(...e){return Gk(e.flat())}function zp(e,...t){return Hk(e,t.flat())}function Yk(e){return[...new Set(e)].filter(k)}function Gs(e){return k(e)&&k(e.x)&&k(e.y)}function Pe(e,t){switch(t){case mt.NORTH:--e.y;break;case mt.SOUTH:++e.y;break;case mt.WEST:--e.x;break;case mt.EAST:++e.x;break}return e}function oi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return mt.WEST;if(n>0)return mt.EAST;if(r<0)return mt.NORTH;if(r>0)return mt.SOUTH}const ih={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function ts(e){return oe(e)&&Wp(e[0])}function Wp(e){return k(mt[e])&&At(e)}function Vk(e){const t=mt[e];return k(t)?t:mt.IDLE}function sh(e){if(At(e))return ih[Ct(e)]}function Xk(e){if(ts(e))return e;if(Wp(e))return[e];const t=sh(e);if(k(t))return[t]}function Kp(e){const t=_.words[e],n=Xk(t);return ts(n)?[n,e+1]:[void 0,e]}function Gp(e){var i,s;const t=[];let[n,r]=Kp(e);for(;ts(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(_.words,r,[H.NUMBER,H.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(_.words,r,[H.DIR]);t.push(c.x,c.y),r=l;break}case"TO":{const[c,l,u]=rt(_.words,r,[H.DIR,H.DIR]),h=((i=_.element)==null?void 0:i.x)??0,d=((s=_.element)==null?void 0:s.y)??0;c.x-=h,c.y-=d,l.x-=h,l.y-=d,t.push(h+c.x+l.x,d+c.y+l.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":break;default:return[t,r]}const[o,a]=Kp(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function qk(e){return k(e)&&e<Wt.ONBLACK?e:void 0}function Jk(e){return k(e)&&e>Wt.WHITE&&e<Wt.ONCLEAR?e-Wt.ONBLACK:void 0}const zo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Mr(e){return oe(e)&&Yp(e[0])}function Hp(e){return Mr(e)&&e[0].startsWith("ON")}function Yp(e){return k(Wt[e])&&At(e)}function oh(e){if(At(e))return zo[Ct(e)]}function Zk(e){return e.map(t=>Wt[t]).find(t=>k(t)&&t<Wt.ONBLACK)}function Qk(e){return e.map(t=>Wt[t]).find(t=>k(t)&&t>=Wt.ONBLACK)}function tT(e){if(Mr(e))return e;if(Yp(e))return[e];const t=oh(e);if(k(t))return[t]}function Vp(e){const t=_.words[e],n=tT(t);return Mr(n)?[n,e+1]:[void 0,e]}function ah(e){const t=[];let n=e;const[r,i]=Vp(e);if(Mr(r)&&(t.push(...r),n=i),Mr(t)&&!Hp(t)){const[s,o]=Vp(i);Hp(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function Xp(e){const t={};return e.every(n=>{const r=Wt[n];k(r)&&(r<Wt.ONBLACK?t.color=r:t.bg=r-Wt.ONBLACK)}),t}function Hs(e){return oe(e)&&typeof e[0]=="string"}function eT(e){const t=_.words[e];return At(t)?[t,e+1]:[void 0,e]}function qp(e){const t=_.words[e];if(Hs(t))return[t,e+1];const[n,r]=ah(e),[i,s]=eT(r);return At(i)?[[i,n],s]:[void 0,e]}function ch(e){if(!Hs(e))return;const[t]=e;return t}function Jp(e){if(!Hs(e))return;const[,t]=e,n=k(t)?Zk(t):void 0;return k(n)?n:void 0}function Zp(e){if(!Hs(e))return;const[,t]=e,n=k(t)?Qk(t):void 0;return k(n)?n:void 0}var lh;try{lh=new TextDecoder}catch{}var gt,Zn,j=0,he={},Jt,Oi,Qn=0,Ur=0,Ze,ai,kn=[],Vt,Qp={useRecords:!1,mapsAsObjects:!0};class tm{}const em=new tm;em.name="MessagePack 0xC1";var Ci=!1,nm=2,rm;try{new Function("")}catch{nm=1/0}class Wo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(gt)return gm(()=>(ph(),this?this.unpack(t,n):Wo.prototype.unpack.call(Qp,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof tn<"u"?tn.from(t):new Uint8Array(t)),typeof n=="object"?(Zn=n.end||t.length,j=n.start||0):(j=0,Zn=n>-1?n:t.length),Ur=0,Oi=null,Ze=null,gt=t;try{Vt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw gt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Wo){if(he=this,this.structures)return Jt=this.structures,dc(n);(!Jt||Jt.length>0)&&(Jt=[])}else he=Qp,(!Jt||Jt.length>0)&&(Jt=[]);return dc(n)}unpackMultiple(t,n){let r,i=0;try{Ci=!0;let s=t.length,o=this?this.unpack(t,s):pc.unpack(t,s);if(n){if(n(o,i,j)===!1)return;for(;j<s;)if(i=j,n(dc(),i,j)===!1)return}else{for(r=[o];j<s;)i=j,r.push(dc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Ci=!1,ph()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function dc(e){try{if(!he.trusted&&!Ci){let n=Jt.sharedLength||0;n<Jt.length&&(Jt.length=n)}let t;if(he.randomAccessStructure&&gt[j]<64&&gt[j]>=32&&rm?(t=rm(gt,j,Zn,he),gt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),j=Zn):t=Me(),Ze&&(j=Ze.postBundlePosition,Ze=null),Ci&&(Jt.restoreStructures=null),j==Zn)Jt&&Jt.restoreStructures&&im(),Jt=null,gt=null,ai&&(ai=null);else{if(j>Zn)throw new Error("Unexpected end of MessagePack data");if(!Ci){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Jt&&Jt.restoreStructures&&im(),ph(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||j>Zn)&&(t.incomplete=!0),t}}function im(){for(let e in Jt.restoreStructures)Jt[e]=Jt.restoreStructures[e];Jt.restoreStructures=null}function Me(){let e=gt[j++];if(e<160)if(e<128){if(e<64)return e;{let t=Jt[e&63]||he.getStructures&&om()[e&63];return t?(t.read||(t.read=uh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=fm();r==="__proto__"&&(r="__proto_"),t[r]=Me()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Me(),Me());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Me();return he.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Ur>=j)return Oi.slice(j-Qn,(j+=t)-Qn);if(Ur==0&&Zn<140){let n=t<16?fh(t):lm(t);if(n!=null)return n}return hh(t)}else{let t;switch(e){case 192:return null;case 193:return Ze?(t=Me(),t>0?Ze[1].slice(Ze.position1,Ze.position1+=t):Ze[0].slice(Ze.position0,Ze.position0-=t)):em;case 194:return!1;case 195:return!0;case 196:if(t=gt[j++],t===void 0)throw new Error("Unexpected end of buffer");return dh(t);case 197:return t=Vt.getUint16(j),j+=2,dh(t);case 198:return t=Vt.getUint32(j),j+=4,dh(t);case 199:return es(gt[j++]);case 200:return t=Vt.getUint16(j),j+=2,es(t);case 201:return t=Vt.getUint32(j),j+=4,es(t);case 202:if(t=Vt.getFloat32(j),he.useFloat32>2){let n=mh[(gt[j]&127)<<1|gt[j+1]>>7];return j+=4,(n*t+(t>0?.5:-.5)>>0)/n}return j+=4,t;case 203:return t=Vt.getFloat64(j),j+=8,t;case 204:return gt[j++];case 205:return t=Vt.getUint16(j),j+=2,t;case 206:return t=Vt.getUint32(j),j+=4,t;case 207:return he.int64AsType==="number"?(t=Vt.getUint32(j)*4294967296,t+=Vt.getUint32(j+4)):he.int64AsType==="string"?t=Vt.getBigUint64(j).toString():he.int64AsType==="auto"?(t=Vt.getBigUint64(j),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigUint64(j),j+=8,t;case 208:return Vt.getInt8(j++);case 209:return t=Vt.getInt16(j),j+=2,t;case 210:return t=Vt.getInt32(j),j+=4,t;case 211:return he.int64AsType==="number"?(t=Vt.getInt32(j)*4294967296,t+=Vt.getUint32(j+4)):he.int64AsType==="string"?t=Vt.getBigInt64(j).toString():he.int64AsType==="auto"?(t=Vt.getBigInt64(j),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigInt64(j),j+=8,t;case 212:if(t=gt[j++],t==114)return pm(gt[j++]&63);{let n=kn[t];if(n)return n.read?(j++,n.read(Me())):n.noBuffer?(j++,n()):n(gt.subarray(j,++j));throw new Error("Unknown extension "+t)}case 213:return t=gt[j],t==114?(j++,pm(gt[j++]&63,gt[j++])):es(2);case 214:return es(4);case 215:return es(8);case 216:return es(16);case 217:return t=gt[j++],Ur>=j?Oi.slice(j-Qn,(j+=t)-Qn):rT(t);case 218:return t=Vt.getUint16(j),j+=2,Ur>=j?Oi.slice(j-Qn,(j+=t)-Qn):iT(t);case 219:return t=Vt.getUint32(j),j+=4,Ur>=j?Oi.slice(j-Qn,(j+=t)-Qn):sT(t);case 220:return t=Vt.getUint16(j),j+=2,am(t);case 221:return t=Vt.getUint32(j),j+=4,am(t);case 222:return t=Vt.getUint16(j),j+=2,cm(t);case 223:return t=Vt.getUint32(j),j+=4,cm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const nT=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function uh(e,t){function n(){if(n.count++>nm){let i=e.read=new Function("r","return function(){return "+(he.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":nT.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Me);return e.highByte===0&&(e.read=sm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Me()}return he.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?sm(t,n):n}const sm=(e,t)=>function(){let n=gt[j++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Jt[r]||om()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=uh(i,e)),i.read()};function om(){let e=gm(()=>(gt=null,he.getStructures()));return Jt=he._mergeStructures(e,Jt)}var hh=Ko,rT=Ko,iT=Ko,sT=Ko;function Ko(e){let t;if(e<16&&(t=fh(e)))return t;if(e>64&&lh)return lh.decode(gt.subarray(j,j+=e));const n=j+e,r=[];for(t="";j<n;){const i=gt[j++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gt[j++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gt[j++]&63,o=gt[j++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=gt[j++]&63,o=gt[j++]&63,a=gt[j++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Qe.apply(String,r),r.length=0)}return r.length>0&&(t+=Qe.apply(String,r)),t}function am(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Me();return he.freezeData?Object.freeze(t):t}function cm(e){if(he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=fm();r==="__proto__"&&(r="__proto_"),t[r]=Me()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Me(),Me());return t}}var Qe=String.fromCharCode;function lm(e){let t=j,n=new Array(e);for(let r=0;r<e;r++){const i=gt[j++];if((i&128)>0){j=t;return}n[r]=i}return Qe.apply(String,n)}function fh(e){if(e<4)if(e<2){if(e===0)return"";{let t=gt[j++];if((t&128)>1){j-=1;return}return Qe(t)}}else{let t=gt[j++],n=gt[j++];if((t&128)>0||(n&128)>0){j-=2;return}if(e<3)return Qe(t,n);let r=gt[j++];if((r&128)>0){j-=3;return}return Qe(t,n,r)}else{let t=gt[j++],n=gt[j++],r=gt[j++],i=gt[j++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){j-=4;return}if(e<6){if(e===4)return Qe(t,n,r,i);{let s=gt[j++];if((s&128)>0){j-=5;return}return Qe(t,n,r,i,s)}}else if(e<8){let s=gt[j++],o=gt[j++];if((s&128)>0||(o&128)>0){j-=6;return}if(e<7)return Qe(t,n,r,i,s,o);let a=gt[j++];if((a&128)>0){j-=7;return}return Qe(t,n,r,i,s,o,a)}else{let s=gt[j++],o=gt[j++],a=gt[j++],c=gt[j++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){j-=8;return}if(e<10){if(e===8)return Qe(t,n,r,i,s,o,a,c);{let l=gt[j++];if((l&128)>0){j-=9;return}return Qe(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=gt[j++],u=gt[j++];if((l&128)>0||(u&128)>0){j-=10;return}if(e<11)return Qe(t,n,r,i,s,o,a,c,l,u);let h=gt[j++];if((h&128)>0){j-=11;return}return Qe(t,n,r,i,s,o,a,c,l,u,h)}else{let l=gt[j++],u=gt[j++],h=gt[j++],d=gt[j++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){j-=12;return}if(e<14){if(e===12)return Qe(t,n,r,i,s,o,a,c,l,u,h,d);{let f=gt[j++];if((f&128)>0){j-=13;return}return Qe(t,n,r,i,s,o,a,c,l,u,h,d,f)}}else{let f=gt[j++],p=gt[j++];if((f&128)>0||(p&128)>0){j-=14;return}if(e<15)return Qe(t,n,r,i,s,o,a,c,l,u,h,d,f,p);let m=gt[j++];if((m&128)>0){j-=15;return}return Qe(t,n,r,i,s,o,a,c,l,u,h,d,f,p,m)}}}}}function um(){let e=gt[j++],t;if(e<192)t=e-160;else switch(e){case 217:t=gt[j++];break;case 218:t=Vt.getUint16(j),j+=2;break;case 219:t=Vt.getUint32(j),j+=4;break;default:throw new Error("Expected string")}return Ko(t)}function dh(e){return he.copyBuffers?Uint8Array.prototype.slice.call(gt,j,j+=e):gt.subarray(j,j+=e)}function es(e){let t=gt[j++];if(kn[t]){let n;return kn[t](gt.subarray(j,n=j+=e),r=>{j=r;try{return Me()}finally{j=n}})}else throw new Error("Unknown extension type "+t)}var hm=new Array(4096);function fm(){let e=gt[j++];if(e>=160&&e<192){if(e=e-160,Ur>=j)return Oi.slice(j-Qn,(j+=e)-Qn);if(!(Ur==0&&Zn<180))return hh(e)}else return j--,dm(Me());let t=(e<<5^(e>1?Vt.getUint16(j):e>0?gt[j]:0))&4095,n=hm[t],r=j,i=j+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return j=r,n.string;i-=3,r=j}for(n=[],hm[t]=n,n.bytes=e;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gt[r++],n.push(s);let a=e<16?fh(e):lm(e);return a!=null?n.string=a:n.string=hh(e)}function dm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const pm=(e,t)=>{let n=Me().map(dm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Jt[e];return i&&(i.isShared||Ci)&&((Jt.restoreStructures||(Jt.restoreStructures=[]))[e]=i),Jt[e]=n,n.read=uh(n,r),n.read()};kn[0]=()=>{},kn[0].noBuffer=!0,kn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let oT={Error,TypeError,ReferenceError};kn[101]=()=>{let e=Me();return(oT[e[0]]||Error)(e[1],{cause:e[2]})},kn[105]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4);ai||(ai=new Map);let n=gt[j],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};ai.set(t,i);let s=Me();return i.used?Object.assign(r,s):(i.target=s,s)},kn[112]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4),n=ai.get(t);return n.used=!0,n.target},kn[115]=()=>new Set(Me());const mm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let aT=typeof globalThis=="object"?globalThis:window;kn[116]=e=>{let t=e[0],n=mm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new aT[n](Uint8Array.prototype.slice.call(e,1).buffer)},kn[120]=()=>{let e=Me();return new RegExp(e[0],e[1])};const cT=[];kn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=j;return j+=t-e.length,Ze=cT,Ze=[um(),um()],Ze.position0=0,Ze.position1=0,Ze.postBundlePosition=j,j=n,Me()},kn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function gm(e){let t=Zn,n=j,r=Qn,i=Ur,s=Oi,o=ai,a=Ze,c=new Uint8Array(gt.slice(0,Zn)),l=Jt,u=Jt.slice(0,Jt.length),h=he,d=Ci,f=e();return Zn=t,j=n,Qn=r,Ur=i,Oi=s,ai=o,Ze=a,gt=c,Ci=d,Jt=l,Jt.splice(0,Jt.length,...u),he=h,Vt=new DataView(gt.buffer,gt.byteOffset,gt.byteLength),f}function ph(){gt=null,ai=null,Jt=null}const mh=new Array(147);for(let e=0;e<256;e++)mh[e]=+("1e"+Math.floor(45.15-e*.30103));var pc=new Wo({useRecords:!1});const lT=pc.unpack;pc.unpackMultiple,pc.unpack;let uT=new Float32Array(1);new Uint8Array(uT.buffer,0,4);let mc;try{mc=new TextEncoder}catch{}let gh,ym;const gc=typeof tn<"u",yc=gc?function(e){return tn.allocUnsafeSlow(e)}:Uint8Array,_m=gc?tn:Uint8Array,bm=gc?4294967296:2144337920;let J,Go,fe,W=0,dn,Te=null,hT;const fT=21760,dT=/[\u0080-\uFFFF]/,Ys=Symbol("record-id");class pT extends Wo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=_m.prototype.utf8Write?function(S,b){return J.utf8Write(S,b,J.byteLength-b)}:mc&&mc.encodeInto?function(S,b){return mc.encodeInto(S,J.subarray(b)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],x=0,w=0;this.pack=this.encode=function(S,b){if(J||(J=new yc(8192),fe=J.dataView||(J.dataView=new DataView(J.buffer,0,8192)),W=0),dn=J.length-10,dn-W<2048?(J=new yc(J.length),fe=J.dataView||(J.dataView=new DataView(J.buffer,0,J.length)),dn=J.length-10,W=0):W=W+7&2147483640,n=W,b&wT&&(W+=b&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof S!="string"?(Te=[],Te.size=1/0):Te=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let X=i.sharedLength||0;if(X>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let D=0;D<X;D++){let ct=i[D];if(!ct)continue;let tt,ft=i.transitions;for(let V=0,z=ct.length;V<z;V++){let Et=ct[V];tt=ft[Et],tt||(tt=ft[Et]=Object.create(null)),ft=tt}ft[Ys]=D+64}this.lastNamedStructuresLength=X}c||(i.nextId=X+64)}r&&(r=!1);let P;try{a.randomAccessStructure&&S&&S.constructor&&S.constructor===Object?C(S):I(S);let X=Te;if(Te&&xm(n,I,0),s&&s.idsToInsert){let D=s.idsToInsert.sort((V,z)=>V.offset>z.offset?1:-1),ct=D.length,tt=-1;for(;X&&ct>0;){let V=D[--ct].offset+n;V<X.stringsPosition+n&&tt===-1&&(tt=0),V>X.position+n?tt>=0&&(tt+=6):(tt>=0&&(fe.setUint32(X.position+n,fe.getUint32(X.position+n)+tt),tt=-1),X=X.previous,ct++)}tt>=0&&X&&fe.setUint32(X.position+n,fe.getUint32(X.position+n)+tt),W+=D.length*6,W>dn&&O(W),a.offset=W;let ft=gT(J.subarray(n,W),D);return s=null,ft}return a.offset=W,b&bT?(J.start=n,J.end=W,J):J.subarray(n,W)}catch(X){throw P=X,X}finally{if(i&&(T(),r&&a.saveStructures)){let X=i.sharedLength||0,D=J.subarray(n,W),ct=yT(i,a);if(!P)return a.saveStructures(ct,ct.isCompatible)===!1?a.pack(S,b):(a.lastNamedStructuresLength=X,J.length>1073741824&&(J=null),D)}J.length>1073741824&&(J=null),b&ET&&(W=n)}};const T=()=>{w<10&&w++;let S=i.sharedLength||0;if(i.length>S&&!c&&(i.length=S),x>1e4)i.transitions=null,w=0,x=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let b=0,P=m.length;b<P;b++)m[b][Ys]=0;m=[]}},v=S=>{var b=S.length;b<16?J[W++]=144|b:b<65536?(J[W++]=220,J[W++]=b>>8,J[W++]=b&255):(J[W++]=221,fe.setUint32(W,b),W+=4);for(let P=0;P<b;P++)I(S[P])},I=S=>{W>dn&&(J=O(W));var b=typeof S,P;if(b==="string"){let X=S.length;if(Te&&X>=4&&X<4096){if((Te.size+=X)>fT){let ft,V=(Te[0]?Te[0].length*3+Te[1].length:0)+10;W+V>dn&&(J=O(W+V));let z;Te.position?(z=Te,J[W]=200,W+=3,J[W++]=98,ft=W-n,W+=4,xm(n,I,0),fe.setUint16(ft+n-3,W-n-ft)):(J[W++]=214,J[W++]=98,ft=W-n,W+=4),Te=["",""],Te.previous=z,Te.size=0,Te.position=ft}let tt=dT.test(S);Te[tt?0:1]+=S,J[W++]=193,I(tt?-X:X);return}let D;X<32?D=1:X<256?D=2:X<65536?D=3:D=5;let ct=X*3;if(W+ct>dn&&(J=O(W+ct)),X<64||!o){let tt,ft,V,z=W+D;for(tt=0;tt<X;tt++)ft=S.charCodeAt(tt),ft<128?J[z++]=ft:ft<2048?(J[z++]=ft>>6|192,J[z++]=ft&63|128):(ft&64512)===55296&&((V=S.charCodeAt(tt+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(V&1023),tt++,J[z++]=ft>>18|240,J[z++]=ft>>12&63|128,J[z++]=ft>>6&63|128,J[z++]=ft&63|128):(J[z++]=ft>>12|224,J[z++]=ft>>6&63|128,J[z++]=ft&63|128);P=z-W-D}else P=o(S,W+D);P<32?J[W++]=160|P:P<256?(D<2&&J.copyWithin(W+2,W+1,W+1+P),J[W++]=217,J[W++]=P):P<65536?(D<3&&J.copyWithin(W+3,W+2,W+2+P),J[W++]=218,J[W++]=P>>8,J[W++]=P&255):(D<5&&J.copyWithin(W+5,W+3,W+3+P),J[W++]=219,fe.setUint32(W,P),W+=4),W+=P}else if(b==="number")if(S>>>0===S)S<32||S<128&&this.useRecords===!1||S<64&&!this.randomAccessStructure?J[W++]=S:S<256?(J[W++]=204,J[W++]=S):S<65536?(J[W++]=205,J[W++]=S>>8,J[W++]=S&255):(J[W++]=206,fe.setUint32(W,S),W+=4);else if(S>>0===S)S>=-32?J[W++]=256+S:S>=-128?(J[W++]=208,J[W++]=S+256):S>=-32768?(J[W++]=209,fe.setInt16(W,S),W+=2):(J[W++]=210,fe.setInt32(W,S),W+=4);else{let X;if((X=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){J[W++]=202,fe.setFloat32(W,S);let D;if(X<4||(D=S*mh[(J[W]&127)<<1|J[W+1]>>7])>>0===D){W+=4;return}else W--}J[W++]=203,fe.setFloat64(W,S),W+=8}else if(b==="object"||b==="function")if(!S)J[W++]=192;else{if(s){let D=s.get(S);if(D){if(!D.id){let ct=s.idsToInsert||(s.idsToInsert=[]);D.id=ct.push(D)}J[W++]=214,J[W++]=112,fe.setUint32(W,D.id),W+=4;return}else s.set(S,{offset:W-n})}let X=S.constructor;if(X===Object)B(S);else if(X===Array)v(S);else if(X===Map)if(this.mapAsEmptyObject)J[W++]=128;else{P=S.size,P<16?J[W++]=128|P:P<65536?(J[W++]=222,J[W++]=P>>8,J[W++]=P&255):(J[W++]=223,fe.setUint32(W,P),W+=4);for(let[D,ct]of S)I(D),I(ct)}else{for(let D=0,ct=gh.length;D<ct;D++){let tt=ym[D];if(S instanceof tt){let ft=gh[D];if(ft.write){ft.type&&(J[W++]=212,J[W++]=ft.type,J[W++]=0);let lt=ft.write.call(this,S);lt===S?Array.isArray(S)?v(S):B(S):I(lt);return}let V=J,z=fe,Et=W;J=null;let ot;try{ot=ft.pack.call(this,S,lt=>(J=V,V=null,W+=lt,W>dn&&O(W),{target:J,targetView:fe,position:W-lt}),I)}finally{V&&(J=V,fe=z,W=Et,dn=J.length-10)}ot&&(ot.length+W>dn&&O(ot.length+W),W=mT(ot,J,W,ft.type));return}}if(Array.isArray(S))v(S);else{if(S.toJSON){const D=S.toJSON();if(D!==S)return I(D)}if(b==="function")return I(this.writeFunction&&this.writeFunction(S));B(S)}}}else if(b==="boolean")J[W++]=S?195:194;else if(b==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))J[W++]=211,fe.setBigInt64(W,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)J[W++]=207,fe.setBigUint64(W,S);else if(this.largeBigIntToFloat)J[W++]=203,fe.setFloat64(W,Number(S));else{if(this.largeBigIntToString)return I(S.toString());if(this.useBigIntExtension&&S<BigInt(2)**BigInt(1023)&&S>-(BigInt(2)**BigInt(1023))){J[W++]=199,W++,J[W++]=66;let X=[],D;do{let ct=S&BigInt(255);D=(ct&BigInt(128))===(S<BigInt(0)?BigInt(128):BigInt(0)),X.push(ct),S>>=BigInt(8)}while(!((S===BigInt(0)||S===BigInt(-1))&&D));J[W-2]=X.length;for(let ct=X.length;ct>0;)J[W++]=Number(X[--ct]);return}else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}W+=8}else if(b==="undefined")this.encodeUndefinedAsNil?J[W++]=192:(J[W++]=212,J[W++]=0,J[W++]=0);else throw new Error("Unknown type: "+b)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?S=>{let b;if(this.skipValues){b=[];for(let D in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(D))&&!this.skipValues.includes(S[D])&&b.push(D)}else b=Object.keys(S);let P=b.length;P<16?J[W++]=128|P:P<65536?(J[W++]=222,J[W++]=P>>8,J[W++]=P&255):(J[W++]=223,fe.setUint32(W,P),W+=4);let X;if(this.coercibleKeyAsNumber)for(let D=0;D<P;D++){X=b[D];let ct=Number(X);I(isNaN(ct)?X:ct),I(S[X])}else for(let D=0;D<P;D++)I(X=b[D]),I(S[X])}:S=>{J[W++]=222;let b=W-n;W+=2;let P=0;for(let X in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(X))&&(I(X),I(S[X]),P++);if(P>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');J[b+++n]=P>>8,J[b+n]=P&255},R=this.useRecords===!1?U:t.progressiveRecords&&!d?S=>{let b,P=i.transitions||(i.transitions=Object.create(null)),X=W++-n,D;for(let ct in S)if(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ct)){if(b=P[ct],b)P=b;else{let tt=Object.keys(S),ft=P;P=i.transitions;let V=0;for(let z=0,Et=tt.length;z<Et;z++){let ot=tt[z];b=P[ot],b||(b=P[ot]=Object.create(null),V++),P=b}X+n+1==W?(W--,Y(P,tt,V)):et(P,tt,X,V),D=!0,P=ft[ct]}I(S[ct])}if(!D){let ct=P[Ys];ct?J[X+n]=ct:et(P,Object.keys(S),X,0)}}:S=>{let b,P=i.transitions||(i.transitions=Object.create(null)),X=0;for(let ct in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ct))&&(b=P[ct],b||(b=P[ct]=Object.create(null),X++),P=b);let D=P[Ys];D?D>=96&&d?(J[W++]=((D-=96)&31)+96,J[W++]=D>>5):J[W++]=D:Y(P,P.__keys__||Object.keys(S),X);for(let ct in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ct))&&I(S[ct])},L=typeof this.useRecords=="function"&&this.useRecords,B=L?S=>{L(S)?R(S):U(S)}:R,O=S=>{let b;if(S>16777216){if(S-n>bm)throw new Error("Packed buffer would be larger than maximum buffer size");b=Math.min(bm,Math.round(Math.max((S-n)*(S>67108864?1.25:2),4194304)/4096)*4096)}else b=(Math.max(S-n<<2,J.length-1)>>12)+1<<12;let P=new yc(b);return fe=P.dataView||(P.dataView=new DataView(P.buffer,0,b)),S=Math.min(S,J.length),J.copy?J.copy(P,0,n,S):P.set(J.slice(n,S)),W-=n,n=0,dn=P.length-10,J=P},Y=(S,b,P)=>{let X=i.nextId;X||(X=64),X<f&&this.shouldShareStructure&&!this.shouldShareStructure(b)?(X=i.nextOwnId,X<p||(X=f),i.nextOwnId=X+1):(X>=p&&(X=f),i.nextId=X+1);let D=b.highByte=X>=96&&d?X-96>>5:-1;S[Ys]=X,S.__keys__=b,i[X-64]=b,X<f?(b.isShared=!0,i.sharedLength=X-63,r=!0,D>=0?(J[W++]=(X&31)+96,J[W++]=D):J[W++]=X):(D>=0?(J[W++]=213,J[W++]=114,J[W++]=(X&31)+96,J[W++]=D):(J[W++]=212,J[W++]=114,J[W++]=X),P&&(x+=w*P),m.length>=h&&(m.shift()[Ys]=0),m.push(S),I(b))},et=(S,b,P,X)=>{let D=J,ct=W,tt=dn,ft=n;J=Go,W=0,n=0,J||(Go=J=new yc(8192)),dn=J.length-10,Y(S,b,X),Go=J;let V=W;if(J=D,W=ct,dn=tt,n=ft,V>1){let z=W+V-1;z>dn&&O(z);let Et=P+n;J.copyWithin(Et+V,Et+1,W),J.set(Go.slice(0,V),Et),W=z}else J[P+n]=Go[0]},C=S=>{let b=hT(S,J,n,W,i,O,(P,X,D)=>{if(D)return r=!0;W=X;let ct=J;return I(P),T(),ct!==J?{position:W,targetView:fe,target:J}:W},this);if(b===0)return B(S);W=b}}useBuffer(t){J=t,J.dataView||(J.dataView=new DataView(J.buffer,J.byteOffset,J.byteLength)),W=0}set position(t){W=t}get position(){return W}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ym=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,tm],gh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Em(e,16,t):wm(gc?tn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==_m&&this.moreTypes?Em(e,mm.indexOf(n.name),t):wm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Em(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function wm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function mT(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function gT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function xm(e,t,n){if(Te.length>0){fe.setUint32(Te.position+e,W+n-Te.position-e),Te.stringsPosition=W-e;let r=Te;Te=null,t(r[0]),t(r[1])}}function yT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let km=new pT({useRecords:!1});const _T=km.pack;km.pack;const bT=512,ET=1024,wT=2048,G=xs("SOFTWARE");function Se(){return null}function Vs(e,t,n={}){if(!k(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];k(c)&&(a=c(a));const l=t[o];k(l)&&(o=l),a!==null&&r.push(o,a)}return r}function Ho(e,t,n={}){if(k(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){ge(G,"","binary",r.message)}}function xT(e){try{const t=Xe(e);return _T(t)}catch(t){ge(G,"","binary",t.message)}}function kT(e){try{return lT(e)}catch(t){ge(G,"","binary",t.message)}}function Tm(){return{id:Oe()}}var _c=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(_c||{});function bc(e){return k(e==null?void 0:e.id)?Vs(e,_c,{category:Se,kinddata:Se,stopped:Se,removed:Se,bucket:Se}):Vs(e,_c,{id:Se,x:Se,y:Se,lx:Se,ly:Se,code:Se,category:Se,kinddata:Se,stopped:Se,removed:Se,bucket:Se})}function Ec(e){return Ho(e,_c)}function Yo(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function wc(e,t){if(!k(e)||!Mr(t))return;const{color:n,bg:r}=Xp(t);k(n)&&(e.color=n),k(r)&&(e.bg=r)}function Fr(e){var t;return Ct((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}const zt=60,ye=25,Am=zt*ye;var bt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(bt||{});function TT(){return new Array(zt*ye).map(()=>{})}function AT(e=Jl){const t={terrain:TT(),objects:{},id:""};return e(t)}var yh=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e))(yh||{});function vT(e){return Vs(e,yh,{terrain:t=>t.map(bc),objects:t=>Object.values(t).filter(n=>!n.removed).map(bc),id:Se,named:Se,lookup:Se,codepage:Se,distmaps:Se})}function ST(e){return Ho(e,yh,{terrain:t=>t.map(Ec),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Ec(t[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function fr(e,t){return!k(e)||!k(t==null?void 0:t.x)||!k(t==null?void 0:t.y)||t.x<0||t.x>=zt||t.y<0||t.y>=ye?-1:t.x+t.y*zt}function Tn(e,t){const n=fr(e,t);if(n<0||!k(e==null?void 0:e.lookup))return;const r=pn(e,e.lookup[n]??"");return k(r)?r:e.terrain[n]}function RT(e,t){const n=pn(e,t);if(k(n))return n;const r=parseFloat(t),i=Dk(isNaN(r)?-1:r,zt);return xc(e,i.x,i.y)}function xc(e,t,n){return(t>=0&&t<zt)??(n>=0&&n<ye)?e==null?void 0:e.terrain[t+n*zt]:void 0}function dr(e,t){if(!k(e)||!k(t)||!k(t.x)||!k(t.y)||t.x<0||t.x>=zt||t.y<0||t.y>=ye)return;const n=Xe(t),r=t.x+t.y*zt;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function _h(e,t){if(!k(e)||!k(t))return;const n=Xe(t);return n.id=n.id??Oe(),e.objects[n.id]=n,e.objects[n.id]}function IT(e,t,n){return dr(e,{...t,kind:n})}function bh(e,t,n,r){return _h(e,{...t,kind:n,id:r})}function pn(e,t){if(e)return e.objects[t]}function NT(e,t){const n=fr(e,t);if(n<0||!k(e==null?void 0:e.lookup))return;const r=pn(e,e.lookup[n]??"");if(k(r))return r}function vm(e,t){return k(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function OT(e,t,n){if(!k(e)||!k(t))return;const r=e.objects[n];if(k(r))return r;if(Gs(t))return Im(t,Xo(e,"player"))}function kc(e,t){const n=e??Ht.ISWALK,r=t??Ht.ISWALK;switch(n){case Ht.ISWALK:return r!==Ht.ISWALK;case Ht.ISSWIM:return r!==Ht.ISSWIM;case Ht.ISSOLID:return!0;case Ht.ISBULLET:return r!==Ht.ISWALK&&r!==Ht.ISSWIM}}function Vo(e,t,n){const r=e==null?void 0:e.objects[n];if(k(r))return r;const i=Xo(e,"player");if(k(t)){const s={x:t.x??0,y:t.y??0};return Im(s,i)}return Le(...i)}function Xo(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(k)}function CT(e){const t=[];for(let n=0;n<ye;++n)for(let r=0;r<zt;++r){const i={x:r,y:n},s=Tn(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Sm(e,t){const n=ch(t),r=Jp(t),i=Zp(t);return Xo(e,n??"").filter(s=>{var o,a,c;return!(k(n)&&Ct((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||k(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Wt.WHITE)!==r||k(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Wt.BLACK)!==i)}).filter(k)}function Rm(e,t){return k(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(k(i))return i;const s=Xo(e,Ct(n));if(s.length)return s}else if(Gs(n)&&n.x>=0&&n.x<zt&&n.y>=0&&n.y<ye){const i=n.x+n.y*zt,s=(r=e.lookup)==null?void 0:r[i];return k(s)?e.objects[s]:e.terrain[i]}}).flat().filter(k):[]}function Im(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function Nm(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}const Eh=14,Tc=3,Ac=8,vc=14,Sc=16,LT=16,MT=16;function Rc(e,t){return new Array(e).fill(t)}function UT(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:Rc(s,0),color:Rc(s,0),bg:Rc(s,i)}}function FT(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Wt.ONCLEAR}}function PT(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function BT(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:Rc(s,i)}}function DT(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function $T(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function Om(e,t){return`${e}:${t}`}const jT=1,zT=16,WT=256;var mn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(mn||{});function Cm(e){const t=Math.floor(e.length/Tc);if(t*Tc!==e.length)return;const n=Nm(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function KT(e,t){return e&1<<t?255:0}function Lm(e){const t=Math.floor(e.length/Eh);if(t*Eh!==e.length)return;const n=Math.ceil(t/Sc),r=Ac*Sc,i=Nm(r,vc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*vc+a,u=e[c];for(let h=0;h<Ac;++h){const d=s*Ac+h;i.bits[d+l*r]=KT(u,7-h)}++a,a===vc&&(a=0,++s,s===Sc&&(s=0,++o))}return i}const GT=Da("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),HT=Da("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var Mm=typeof Ts=="object"&&Ts&&Ts.Object===Object&&Ts,YT=typeof self=="object"&&self&&self.Object===Object&&self,Pr=Mm||YT||Function("return this")(),tr=Pr.Symbol,Um=Object.prototype,VT=Um.hasOwnProperty,XT=Um.toString,qo=tr?tr.toStringTag:void 0;function qT(e){var t=VT.call(e,qo),n=e[qo];try{e[qo]=void 0;var r=!0}catch{}var i=XT.call(e);return r&&(t?e[qo]=n:delete e[qo]),i}var JT=Object.prototype,ZT=JT.toString;function QT(e){return ZT.call(e)}var tA="[object Null]",eA="[object Undefined]",Fm=tr?tr.toStringTag:void 0;function Li(e){return e==null?e===void 0?eA:tA:Fm&&Fm in Object(e)?qT(e):QT(e)}function pr(e){return e!=null&&typeof e=="object"}var nA="[object Symbol]";function Ic(e){return typeof e=="symbol"||pr(e)&&Li(e)==nA}function Nc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var te=Array.isArray,rA=1/0,Pm=tr?tr.prototype:void 0,Bm=Pm?Pm.toString:void 0;function Dm(e){if(typeof e=="string")return e;if(te(e))return Nc(e,Dm)+"";if(Ic(e))return Bm?Bm.call(e):"";var t=e+"";return t=="0"&&1/e==-rA?"-0":t}var iA=/\s/;function sA(e){for(var t=e.length;t--&&iA.test(e.charAt(t)););return t}var oA=/^\s+/;function aA(e){return e&&e.slice(0,sA(e)+1).replace(oA,"")}function er(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var $m=NaN,cA=/^[-+]0x[0-9a-f]+$/i,lA=/^0b[01]+$/i,uA=/^0o[0-7]+$/i,hA=parseInt;function fA(e){if(typeof e=="number")return e;if(Ic(e))return $m;if(er(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=er(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=aA(e);var n=lA.test(e);return n||uA.test(e)?hA(e.slice(2),n?2:8):cA.test(e)?$m:+e}var jm=1/0,dA=17976931348623157e292;function pA(e){if(!e)return e===0?e:0;if(e=fA(e),e===jm||e===-jm){var t=e<0?-1:1;return t*dA}return e===e?e:0}function Oc(e){var t=pA(e),n=t%1;return t===t?n?t-n:t:0}function Xs(e){return e}var mA="[object AsyncFunction]",gA="[object Function]",yA="[object GeneratorFunction]",_A="[object Proxy]";function ci(e){if(!er(e))return!1;var t=Li(e);return t==gA||t==yA||t==mA||t==_A}var wh=Pr["__core-js_shared__"],zm=function(){var e=/[^.]+$/.exec(wh&&wh.keys&&wh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function bA(e){return!!zm&&zm in e}var EA=Function.prototype,wA=EA.toString;function ns(e){if(e!=null){try{return wA.call(e)}catch{}try{return e+""}catch{}}return""}var xA=/[\\^$.*+?()[\]{}|]/g,kA=/^\[object .+?Constructor\]$/,TA=Function.prototype,AA=Object.prototype,vA=TA.toString,SA=AA.hasOwnProperty,RA=RegExp("^"+vA.call(SA).replace(xA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function IA(e){if(!er(e)||bA(e))return!1;var t=ci(e)?RA:kA;return t.test(ns(e))}function NA(e,t){return e==null?void 0:e[t]}function rs(e,t){var n=NA(e,t);return IA(n)?n:void 0}var xh=rs(Pr,"WeakMap"),Wm=Object.create,OA=function(){function e(){}return function(t){if(!er(t))return{};if(Wm)return Wm(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function CA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Ke(){}function LA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var MA=800,UA=16,FA=Date.now;function PA(e){var t=0,n=0;return function(){var r=FA(),i=UA-(r-n);if(n=r,i>0){if(++t>=MA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function BA(e){return function(){return e}}var Cc=function(){try{var e=rs(Object,"defineProperty");return e({},"",{}),e}catch{}}(),DA=Cc?function(e,t){return Cc(e,"toString",{configurable:!0,enumerable:!1,value:BA(t),writable:!0})}:Xs,$A=PA(DA);function Km(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Gm(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function jA(e){return e!==e}function zA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function kh(e,t,n){return t===t?zA(e,t,n):Gm(e,jA,n)}function Hm(e,t){var n=e==null?0:e.length;return!!n&&kh(e,t,0)>-1}var WA=9007199254740991,KA=/^(?:0|[1-9]\d*)$/;function Lc(e,t){var n=typeof e;return t=t??WA,!!t&&(n=="number"||n!="symbol"&&KA.test(e))&&e>-1&&e%1==0&&e<t}function Th(e,t,n){t=="__proto__"&&Cc?Cc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Jo(e,t){return e===t||e!==e&&t!==t}var GA=Object.prototype,HA=GA.hasOwnProperty;function Mc(e,t,n){var r=e[t];(!(HA.call(e,t)&&Jo(r,n))||n===void 0&&!(t in e))&&Th(e,t,n)}function Ah(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Th(n,a,c):Mc(n,a,c)}return n}var Ym=Math.max;function YA(e,t,n){return t=Ym(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Ym(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),CA(e,this,a)}}function vh(e,t){return $A(YA(e,t,Xs),e+"")}var VA=9007199254740991;function Sh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=VA}function Br(e){return e!=null&&Sh(e.length)&&!ci(e)}function Vm(e,t,n){if(!er(n))return!1;var r=typeof t;return(r=="number"?Br(n)&&Lc(t,n.length):r=="string"&&t in n)?Jo(n[t],e):!1}function XA(e){return vh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Vm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var qA=Object.prototype;function Zo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||qA;return e===n}function JA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var ZA="[object Arguments]";function Xm(e){return pr(e)&&Li(e)==ZA}var qm=Object.prototype,QA=qm.hasOwnProperty,tv=qm.propertyIsEnumerable,Uc=Xm(function(){return arguments}())?Xm:function(e){return pr(e)&&QA.call(e,"callee")&&!tv.call(e,"callee")};function ev(){return!1}var Jm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Zm=Jm&&typeof module=="object"&&module&&!module.nodeType&&module,nv=Zm&&Zm.exports===Jm,Qm=nv?Pr.Buffer:void 0,rv=Qm?Qm.isBuffer:void 0,Qo=rv||ev,iv="[object Arguments]",sv="[object Array]",ov="[object Boolean]",av="[object Date]",cv="[object Error]",lv="[object Function]",uv="[object Map]",hv="[object Number]",fv="[object Object]",dv="[object RegExp]",pv="[object Set]",mv="[object String]",gv="[object WeakMap]",yv="[object ArrayBuffer]",_v="[object DataView]",bv="[object Float32Array]",Ev="[object Float64Array]",wv="[object Int8Array]",xv="[object Int16Array]",kv="[object Int32Array]",Tv="[object Uint8Array]",Av="[object Uint8ClampedArray]",vv="[object Uint16Array]",Sv="[object Uint32Array]",_e={};_e[bv]=_e[Ev]=_e[wv]=_e[xv]=_e[kv]=_e[Tv]=_e[Av]=_e[vv]=_e[Sv]=!0,_e[iv]=_e[sv]=_e[yv]=_e[ov]=_e[_v]=_e[av]=_e[cv]=_e[lv]=_e[uv]=_e[hv]=_e[fv]=_e[dv]=_e[pv]=_e[mv]=_e[gv]=!1;function Rv(e){return pr(e)&&Sh(e.length)&&!!_e[Li(e)]}function Fc(e){return function(t){return e(t)}}var tg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ta=tg&&typeof module=="object"&&module&&!module.nodeType&&module,Iv=ta&&ta.exports===tg,Rh=Iv&&Mm.process,Mi=function(){try{var e=ta&&ta.require&&ta.require("util").types;return e||Rh&&Rh.binding&&Rh.binding("util")}catch{}}(),eg=Mi&&Mi.isTypedArray,Ih=eg?Fc(eg):Rv,Nv=Object.prototype,Ov=Nv.hasOwnProperty;function ng(e,t){var n=te(e),r=!n&&Uc(e),i=!n&&!r&&Qo(e),s=!n&&!r&&!i&&Ih(e),o=n||r||i||s,a=o?JA(e.length,String):[],c=a.length;for(var l in e)(t||Ov.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Lc(l,c)))&&a.push(l);return a}function rg(e,t){return function(n){return e(t(n))}}var Cv=rg(Object.keys,Object),Lv=Object.prototype,Mv=Lv.hasOwnProperty;function ig(e){if(!Zo(e))return Cv(e);var t=[];for(var n in Object(e))Mv.call(e,n)&&n!="constructor"&&t.push(n);return t}function nr(e){return Br(e)?ng(e):ig(e)}var Uv=Object.prototype,Fv=Uv.hasOwnProperty,An=XA(function(e,t){if(Zo(t)||Br(t)){Ah(t,nr(t),e);return}for(var n in t)Fv.call(t,n)&&Mc(e,n,t[n])});function Pv(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var Bv=Object.prototype,Dv=Bv.hasOwnProperty;function $v(e){if(!er(e))return Pv(e);var t=Zo(e),n=[];for(var r in e)r=="constructor"&&(t||!Dv.call(e,r))||n.push(r);return n}function sg(e){return Br(e)?ng(e,!0):$v(e)}var jv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zv=/^\w*$/;function Nh(e,t){if(te(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Ic(e)?!0:zv.test(e)||!jv.test(e)||t!=null&&e in Object(t)}var ea=rs(Object,"create");function Wv(){this.__data__=ea?ea(null):{},this.size=0}function Kv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Gv="__lodash_hash_undefined__",Hv=Object.prototype,Yv=Hv.hasOwnProperty;function Vv(e){var t=this.__data__;if(ea){var n=t[e];return n===Gv?void 0:n}return Yv.call(t,e)?t[e]:void 0}var Xv=Object.prototype,qv=Xv.hasOwnProperty;function Jv(e){var t=this.__data__;return ea?t[e]!==void 0:qv.call(t,e)}var Zv="__lodash_hash_undefined__";function Qv(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ea&&t===void 0?Zv:t,this}function is(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}is.prototype.clear=Wv,is.prototype.delete=Kv,is.prototype.get=Vv,is.prototype.has=Jv,is.prototype.set=Qv;function tS(){this.__data__=[],this.size=0}function Pc(e,t){for(var n=e.length;n--;)if(Jo(e[n][0],t))return n;return-1}var eS=Array.prototype,nS=eS.splice;function rS(e){var t=this.__data__,n=Pc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():nS.call(t,n,1),--this.size,!0}function iS(e){var t=this.__data__,n=Pc(t,e);return n<0?void 0:t[n][1]}function sS(e){return Pc(this.__data__,e)>-1}function oS(e,t){var n=this.__data__,r=Pc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function li(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}li.prototype.clear=tS,li.prototype.delete=rS,li.prototype.get=iS,li.prototype.has=sS,li.prototype.set=oS;var na=rs(Pr,"Map");function aS(){this.size=0,this.__data__={hash:new is,map:new(na||li),string:new is}}function cS(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Bc(e,t){var n=e.__data__;return cS(t)?n[typeof t=="string"?"string":"hash"]:n.map}function lS(e){var t=Bc(this,e).delete(e);return this.size-=t?1:0,t}function uS(e){return Bc(this,e).get(e)}function hS(e){return Bc(this,e).has(e)}function fS(e,t){var n=Bc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function ui(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ui.prototype.clear=aS,ui.prototype.delete=lS,ui.prototype.get=uS,ui.prototype.has=hS,ui.prototype.set=fS;var dS="Expected a function";function Oh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(dS);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Oh.Cache||ui),n}Oh.Cache=ui;var pS=500;function mS(e){var t=Oh(e,function(r){return n.size===pS&&n.clear(),r}),n=t.cache;return t}var gS=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,yS=/\\(\\)?/g,_S=mS(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(gS,function(n,r,i,s){t.push(i?s.replace(yS,"$1"):r||n)}),t});function og(e){return e==null?"":Dm(e)}function Dc(e,t){return te(e)?e:Nh(e,t)?[e]:_S(og(e))}var bS=1/0;function ra(e){if(typeof e=="string"||Ic(e))return e;var t=e+"";return t=="0"&&1/e==-bS?"-0":t}function Ch(e,t){t=Dc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ra(t[n++])];return n&&n==r?e:void 0}function ES(e,t,n){var r=e==null?void 0:Ch(e,t);return r===void 0?n:r}function Lh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var ag=tr?tr.isConcatSpreadable:void 0;function wS(e){return te(e)||Uc(e)||!!(ag&&e&&e[ag])}function Mh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=wS),i||(i=[]);++s<o;){var a=e[s];n(a)?Lh(i,a):r||(i[i.length]=a)}return i}function $n(e){var t=e==null?0:e.length;return t?Mh(e):[]}var cg=rg(Object.getPrototypeOf,Object);function Uh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function xS(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Uh(e,t,n)}var kS="\\ud800-\\udfff",TS="\\u0300-\\u036f",AS="\\ufe20-\\ufe2f",vS="\\u20d0-\\u20ff",SS=TS+AS+vS,RS="\\ufe0e\\ufe0f",IS="\\u200d",NS=RegExp("["+IS+kS+SS+RS+"]");function lg(e){return NS.test(e)}function OS(e){return e.split("")}var ug="\\ud800-\\udfff",CS="\\u0300-\\u036f",LS="\\ufe20-\\ufe2f",MS="\\u20d0-\\u20ff",US=CS+LS+MS,FS="\\ufe0e\\ufe0f",PS="["+ug+"]",Fh="["+US+"]",Ph="\\ud83c[\\udffb-\\udfff]",BS="(?:"+Fh+"|"+Ph+")",hg="[^"+ug+"]",fg="(?:\\ud83c[\\udde6-\\uddff]){2}",dg="[\\ud800-\\udbff][\\udc00-\\udfff]",DS="\\u200d",pg=BS+"?",mg="["+FS+"]?",$S="(?:"+DS+"(?:"+[hg,fg,dg].join("|")+")"+mg+pg+")*",jS=mg+pg+$S,zS="(?:"+[hg+Fh+"?",Fh,fg,dg,PS].join("|")+")",WS=RegExp(Ph+"(?="+Ph+")|"+zS+jS,"g");function KS(e){return e.match(WS)||[]}function GS(e){return lg(e)?KS(e):OS(e)}function HS(e){return function(t){t=og(t);var n=lg(t)?GS(t):void 0,r=n?n[0]:t.charAt(0),i=n?xS(n,1).join(""):t.slice(1);return r[e]()+i}}var gg=HS("toUpperCase");function YS(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function VS(){this.__data__=new li,this.size=0}function XS(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function qS(e){return this.__data__.get(e)}function JS(e){return this.__data__.has(e)}var ZS=200;function QS(e,t){var n=this.__data__;if(n instanceof li){var r=n.__data__;if(!na||r.length<ZS-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ui(r)}return n.set(e,t),this.size=n.size,this}function Dr(e){var t=this.__data__=new li(e);this.size=t.size}Dr.prototype.clear=VS,Dr.prototype.delete=XS,Dr.prototype.get=qS,Dr.prototype.has=JS,Dr.prototype.set=QS;function tR(e,t){return e&&Ah(t,nr(t),e)}var yg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,_g=yg&&typeof module=="object"&&module&&!module.nodeType&&module,eR=_g&&_g.exports===yg,bg=eR?Pr.Buffer:void 0,Eg=bg?bg.allocUnsafe:void 0;function nR(e,t){var n=e.length,r=Eg?Eg(n):new e.constructor(n);return e.copy(r),r}function Bh(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function wg(){return[]}var rR=Object.prototype,iR=rR.propertyIsEnumerable,xg=Object.getOwnPropertySymbols,Dh=xg?function(e){return e==null?[]:(e=Object(e),Bh(xg(e),function(t){return iR.call(e,t)}))}:wg;function sR(e,t){return Ah(e,Dh(e),t)}var oR=Object.getOwnPropertySymbols,aR=oR?function(e){for(var t=[];e;)Lh(t,Dh(e)),e=cg(e);return t}:wg;function kg(e,t,n){var r=t(e);return te(e)?r:Lh(r,n(e))}function $h(e){return kg(e,nr,Dh)}function cR(e){return kg(e,sg,aR)}var jh=rs(Pr,"DataView"),zh=rs(Pr,"Promise"),qs=rs(Pr,"Set"),Tg="[object Map]",lR="[object Object]",Ag="[object Promise]",vg="[object Set]",Sg="[object WeakMap]",Rg="[object DataView]",uR=ns(jh),hR=ns(na),fR=ns(zh),dR=ns(qs),pR=ns(xh),rr=Li;(jh&&rr(new jh(new ArrayBuffer(1)))!=Rg||na&&rr(new na)!=Tg||zh&&rr(zh.resolve())!=Ag||qs&&rr(new qs)!=vg||xh&&rr(new xh)!=Sg)&&(rr=function(e){var t=Li(e),n=t==lR?e.constructor:void 0,r=n?ns(n):"";if(r)switch(r){case uR:return Rg;case hR:return Tg;case fR:return Ag;case dR:return vg;case pR:return Sg}return t});var mR=Object.prototype,gR=mR.hasOwnProperty;function yR(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&gR.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var $c=Pr.Uint8Array;function _R(e){var t=new e.constructor(e.byteLength);return new $c(t).set(new $c(e)),t}function bR(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var ER=/\w*$/;function wR(e){var t=new e.constructor(e.source,ER.exec(e));return t.lastIndex=e.lastIndex,t}var Ig=tr?tr.prototype:void 0,Ng=Ig?Ig.valueOf:void 0;function xR(e){return Ng?Object(Ng.call(e)):{}}function kR(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var TR="[object Boolean]",AR="[object Date]",vR="[object Map]",SR="[object Number]",RR="[object RegExp]",IR="[object Set]",NR="[object String]",OR="[object Symbol]",CR="[object ArrayBuffer]",LR="[object DataView]",MR="[object Float32Array]",UR="[object Float64Array]",FR="[object Int8Array]",PR="[object Int16Array]",BR="[object Int32Array]",DR="[object Uint8Array]",$R="[object Uint8ClampedArray]",jR="[object Uint16Array]",zR="[object Uint32Array]";function WR(e,t,n){var r=e.constructor;switch(t){case CR:return _R(e);case TR:case AR:return new r(+e);case LR:return bR(e);case MR:case UR:case FR:case PR:case BR:case DR:case $R:case jR:case zR:return kR(e);case vR:return new r;case SR:case NR:return new r(e);case RR:return wR(e);case IR:return new r;case OR:return xR(e)}}function KR(e){return typeof e.constructor=="function"&&!Zo(e)?OA(cg(e)):{}}var GR="[object Map]";function HR(e){return pr(e)&&rr(e)==GR}var Og=Mi&&Mi.isMap,YR=Og?Fc(Og):HR,VR="[object Set]";function XR(e){return pr(e)&&rr(e)==VR}var Cg=Mi&&Mi.isSet,qR=Cg?Fc(Cg):XR,Lg="[object Arguments]",JR="[object Array]",ZR="[object Boolean]",QR="[object Date]",tI="[object Error]",Mg="[object Function]",eI="[object GeneratorFunction]",nI="[object Map]",rI="[object Number]",Ug="[object Object]",iI="[object RegExp]",sI="[object Set]",oI="[object String]",aI="[object Symbol]",cI="[object WeakMap]",lI="[object ArrayBuffer]",uI="[object DataView]",hI="[object Float32Array]",fI="[object Float64Array]",dI="[object Int8Array]",pI="[object Int16Array]",mI="[object Int32Array]",gI="[object Uint8Array]",yI="[object Uint8ClampedArray]",_I="[object Uint16Array]",bI="[object Uint32Array]",de={};de[Lg]=de[JR]=de[lI]=de[uI]=de[ZR]=de[QR]=de[hI]=de[fI]=de[dI]=de[pI]=de[mI]=de[nI]=de[rI]=de[Ug]=de[iI]=de[sI]=de[oI]=de[aI]=de[gI]=de[yI]=de[_I]=de[bI]=!0,de[tI]=de[Mg]=de[cI]=!1;function jc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!er(e))return e;var a=te(e);if(a)return o=yR(e),LA(e,o);var c=rr(e),l=c==Mg||c==eI;if(Qo(e))return nR(e);if(c==Ug||c==Lg||l&&!i)return o=l?{}:KR(e),sR(e,tR(o,e));if(!de[c])return i?e:{};o=WR(e,c),s||(s=new Dr);var u=s.get(e);if(u)return u;s.set(e,o),qR(e)?e.forEach(function(f){o.add(jc(f,t,n,f,e,s))}):YR(e)&&e.forEach(function(f,p){o.set(p,jc(f,t,n,p,e,s))});var h=$h,d=a?void 0:h(e);return Km(d||e,function(f,p){d&&(p=f,f=e[p]),Mc(o,p,jc(f,t,n,p,e,s))}),o}var EI=4;function rn(e){return jc(e,EI)}function ia(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var wI="__lodash_hash_undefined__";function xI(e){return this.__data__.set(e,wI),this}function kI(e){return this.__data__.has(e)}function Js(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new ui;++t<n;)this.add(e[t])}Js.prototype.add=Js.prototype.push=xI,Js.prototype.has=kI;function Fg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Wh(e,t){return e.has(t)}var TI=1,AI=2;function Pg(e,t,n,r,i,s){var o=n&TI,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var h=-1,d=!0,f=n&AI?new Js:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(r)var x=o?r(m,p,h,t,e,s):r(p,m,h,e,t,s);if(x!==void 0){if(x)continue;d=!1;break}if(f){if(!Fg(t,function(w,T){if(!Wh(f,T)&&(p===w||i(p,w,n,r,s)))return f.push(T)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function vI(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Kh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var SI=1,RI=2,II="[object Boolean]",NI="[object Date]",OI="[object Error]",CI="[object Map]",LI="[object Number]",MI="[object RegExp]",UI="[object Set]",FI="[object String]",PI="[object Symbol]",BI="[object ArrayBuffer]",DI="[object DataView]",Bg=tr?tr.prototype:void 0,Gh=Bg?Bg.valueOf:void 0;function $I(e,t,n,r,i,s,o){switch(n){case DI:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case BI:return!(e.byteLength!=t.byteLength||!s(new $c(e),new $c(t)));case II:case NI:case LI:return Jo(+e,+t);case OI:return e.name==t.name&&e.message==t.message;case MI:case FI:return e==t+"";case CI:var a=vI;case UI:var c=r&SI;if(a||(a=Kh),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=RI,o.set(e,t);var u=Pg(a(e),a(t),r,i,s,o);return o.delete(e),u;case PI:if(Gh)return Gh.call(e)==Gh.call(t)}return!1}var jI=1,zI=Object.prototype,WI=zI.hasOwnProperty;function KI(e,t,n,r,i,s){var o=n&jI,a=$h(e),c=a.length,l=$h(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:WI.call(t,d)))return!1}var f=s.get(e),p=s.get(t);if(f&&p)return f==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var x=o;++h<c;){d=a[h];var w=e[d],T=t[d];if(r)var v=o?r(T,w,d,t,e,s):r(w,T,d,e,t,s);if(!(v===void 0?w===T||i(w,T,n,r,s):v)){m=!1;break}x||(x=d=="constructor")}if(m&&!x){var I=e.constructor,U=t.constructor;I!=U&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(m=!1)}return s.delete(e),s.delete(t),m}var GI=1,Dg="[object Arguments]",$g="[object Array]",zc="[object Object]",HI=Object.prototype,jg=HI.hasOwnProperty;function YI(e,t,n,r,i,s){var o=te(e),a=te(t),c=o?$g:rr(e),l=a?$g:rr(t);c=c==Dg?zc:c,l=l==Dg?zc:l;var u=c==zc,h=l==zc,d=c==l;if(d&&Qo(e)){if(!Qo(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new Dr),o||Ih(e)?Pg(e,t,n,r,i,s):$I(e,t,c,n,r,i,s);if(!(n&GI)){var f=u&&jg.call(e,"__wrapped__"),p=h&&jg.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,x=p?t.value():t;return s||(s=new Dr),i(m,x,n,r,s)}}return d?(s||(s=new Dr),KI(e,t,n,r,i,s)):!1}function Hh(e,t,n,r,i){return e===t?!0:e==null||t==null||!pr(e)&&!pr(t)?e!==e&&t!==t:YI(e,t,n,r,Hh,i)}var VI=1,XI=2;function qI(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new Dr,h;if(!(h===void 0?Hh(l,c,VI|XI,r,u):h))return!1}}return!0}function zg(e){return e===e&&!er(e)}function JI(e){for(var t=nr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,zg(i)]}return t}function Wg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function ZI(e){var t=JI(e);return t.length==1&&t[0][2]?Wg(t[0][0],t[0][1]):function(n){return n===e||qI(n,e,t)}}function QI(e,t){return e!=null&&t in Object(e)}function Kg(e,t,n){t=Dc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ra(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Sh(i)&&Lc(o,i)&&(te(e)||Uc(e)))}function tN(e,t){return e!=null&&Kg(e,t,QI)}var eN=1,nN=2;function rN(e,t){return Nh(e)&&zg(t)?Wg(ra(e),t):function(n){var r=ES(n,e);return r===void 0&&r===t?tN(n,e):Hh(t,r,eN|nN)}}function iN(e){return function(t){return t==null?void 0:t[e]}}function sN(e){return function(t){return Ch(t,e)}}function oN(e){return Nh(e)?iN(ra(e)):sN(e)}function $r(e){return typeof e=="function"?e:e==null?Xs:typeof e=="object"?te(e)?rN(e[0],e[1]):ZI(e):oN(e)}function aN(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function cN(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var lN=cN();function uN(e,t){return e&&lN(e,t,nr)}function hN(e,t){return function(n,r){if(n==null)return n;if(!Br(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var ss=hN(uN);function fN(e,t,n,r){return ss(e,function(i,s,o){t(r,i,n(i),o)}),r}function dN(e,t){return function(n,r){var i=te(n)?aN:fN,s=t?t():{};return i(n,e,$r(r),s)}}var Gg=Object.prototype,pN=Gg.hasOwnProperty,Yh=vh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Vm(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=sg(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||Jo(u,Gg[l])&&!pN.call(e,l))&&(e[l]=s[l])}return e});function Hg(e){return pr(e)&&Br(e)}var mN=200;function gN(e,t,n,r){var i=-1,s=Hm,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=mN&&(s=Wh,o=!1,t=new Js(t));t:for(;++i<a;){var u=e[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(t[d]===h)continue t;c.push(u)}else s(t,h,r)||c.push(u)}return c}var Wc=vh(function(e,t){return Hg(e)?gN(e,Mh(t,1,Hg,!0)):[]});function Zs(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function sn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Oc(t),Uh(e,t<0?0:t,r)):[]}function sa(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Oc(t),t=r-t,Uh(e,0,t<0?0:t)):[]}function yN(e){return typeof e=="function"?e:Xs}function It(e,t){var n=te(e)?Km:ss;return n(e,yN(t))}function _N(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function bN(e,t){var n=!0;return ss(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function mr(e,t,n){var r=te(e)?_N:bN;return r(e,$r(t))}function Yg(e,t){var n=[];return ss(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function ir(e,t){var n=te(e)?Bh:Yg;return n(e,$r(t))}function EN(e){return function(t,n,r){var i=Object(t);if(!Br(t)){var s=$r(n);t=nr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var wN=Math.max;function xN(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Oc(n);return i<0&&(i=wN(r+i,0)),Gm(e,$r(t),i)}var Qs=EN(xN);function gr(e){return e&&e.length?e[0]:void 0}function kN(e,t){var n=-1,r=Br(e)?Array(e.length):[];return ss(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function xt(e,t){var n=te(e)?Nc:kN;return n(e,$r(t))}function sr(e,t){return Mh(xt(e,t))}var TN=Object.prototype,AN=TN.hasOwnProperty,Vg=dN(function(e,t,n){AN.call(e,n)?e[n].push(t):Th(e,n,[t])}),vN=Object.prototype,SN=vN.hasOwnProperty;function RN(e,t){return e!=null&&SN.call(e,t)}function St(e,t){return e!=null&&Kg(e,t,RN)}var IN="[object String]";function vn(e){return typeof e=="string"||!te(e)&&pr(e)&&Li(e)==IN}function NN(e,t){return Nc(t,function(n){return e[n]})}function Be(e){return e==null?[]:NN(e,nr(e))}var ON=Math.max;function gn(e,t,n,r){e=Br(e)?e:Be(e),n=n&&!r?Oc(n):0;var i=e.length;return n<0&&(n=ON(i+n,0)),vn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&kh(e,t,n)>-1}function Xg(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return kh(e,t,i)}var CN="[object Map]",LN="[object Set]",MN=Object.prototype,UN=MN.hasOwnProperty;function pe(e){if(e==null)return!0;if(Br(e)&&(te(e)||typeof e=="string"||typeof e.splice=="function"||Qo(e)||Ih(e)||Uc(e)))return!e.length;var t=rr(e);if(t==CN||t==LN)return!e.size;if(Zo(e))return!ig(e).length;for(var n in e)if(UN.call(e,n))return!1;return!0}var FN="[object RegExp]";function PN(e){return pr(e)&&Li(e)==FN}var qg=Mi&&Mi.isRegExp,hi=qg?Fc(qg):PN;function fi(e){return e===void 0}var BN="Expected a function";function DN(e){if(typeof e!="function")throw new TypeError(BN);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function $N(e,t,n,r){if(!er(e))return e;t=Dc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ra(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=er(u)?u:Lc(t[i+1])?[]:{})}Mc(a,c,l),a=a[c]}return e}function jN(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Ch(e,o);n(a,o)&&$N(s,Dc(o,e),a)}return s}function yr(e,t){if(e==null)return{};var n=Nc(cR(e),function(r){return[r]});return t=$r(t),jN(e,n,function(r,i){return t(r,i[0])})}function zN(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Sn(e,t,n){var r=te(e)?YS:zN,i=arguments.length<3;return r(e,$r(t),n,i,ss)}function Kc(e,t){var n=te(e)?Bh:Yg;return n(e,DN($r(t)))}function WN(e,t){var n;return ss(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Vh(e,t,n){var r=te(e)?Fg:WN;return r(e,$r(t))}var KN=1/0,GN=qs&&1/Kh(new qs([,-0]))[1]==KN?function(e){return new qs(e)}:Ke,HN=200;function YN(e,t,n){var r=-1,i=Hm,s=e.length,o=!0,a=[],c=a;if(s>=HN){var l=GN(e);if(l)return Kh(l);o=!1,i=Wh,c=new Js}else c=a;t:for(;++r<s;){var u=e[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(u)}else i(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function Gc(e){return e&&e.length?YN(e):[]}function Xh(e){console&&console.error&&console.error(`Error: ${e}`)}function Jg(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Zg(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Qg(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function VN(e){return XN(e)?e.LABEL:e.name}function XN(e){return vn(e.LABEL)&&e.LABEL!==""}class jr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),It(this.definition,n=>{n.accept(t)})}}class Rn extends jr{constructor(t){super([]),this.idx=1,An(this,yr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class to extends jr{constructor(t){super(t.definition),this.orgText="",An(this,yr(t,n=>n!==void 0))}}class In extends jr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,An(this,yr(t,n=>n!==void 0))}}class Nn extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class zr extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class Wr extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class Ge extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class _r extends jr{constructor(t){super(t.definition),this.idx=1,An(this,yr(t,n=>n!==void 0))}}class br extends jr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,An(this,yr(t,n=>n!==void 0))}}class Ae{constructor(t){this.idx=1,An(this,yr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function qN(e){return xt(e,Hc)}function Hc(e){function t(n){return xt(n,Hc)}if(e instanceof Rn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return vn(e.label)&&(n.label=e.label),n}else{if(e instanceof In)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Nn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof zr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Wr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Hc(new Ae({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof _r)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Hc(new Ae({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ge)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof br)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ae){const n={type:"Terminal",name:e.terminalType.name,label:VN(e.terminalType),idx:e.idx};vn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=hi(r)?r.source:r),n}else{if(e instanceof to)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class os{visit(t){const n=t;switch(n.constructor){case Rn:return this.visitNonTerminal(n);case In:return this.visitAlternative(n);case Nn:return this.visitOption(n);case zr:return this.visitRepetitionMandatory(n);case Wr:return this.visitRepetitionMandatoryWithSeparator(n);case _r:return this.visitRepetitionWithSeparator(n);case Ge:return this.visitRepetition(n);case br:return this.visitAlternation(n);case Ae:return this.visitTerminal(n);case to:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function JN(e){return e instanceof In||e instanceof Nn||e instanceof Ge||e instanceof zr||e instanceof Wr||e instanceof _r||e instanceof Ae||e instanceof to}function Yc(e,t=[]){return e instanceof Nn||e instanceof Ge||e instanceof _r?!0:e instanceof br?Vh(e.definition,r=>Yc(r,t)):e instanceof Rn&&gn(t,e)?!1:e instanceof jr?(e instanceof Rn&&t.push(e),mr(e.definition,r=>Yc(r,t))):!1}function ZN(e){return e instanceof br}function Kr(e){if(e instanceof Rn)return"SUBRULE";if(e instanceof Nn)return"OPTION";if(e instanceof br)return"OR";if(e instanceof zr)return"AT_LEAST_ONE";if(e instanceof Wr)return"AT_LEAST_ONE_SEP";if(e instanceof _r)return"MANY_SEP";if(e instanceof Ge)return"MANY";if(e instanceof Ae)return"CONSUME";throw Error("non exhaustive match")}class Vc{walk(t,n=[]){It(t.definition,(r,i)=>{const s=sn(t.definition,i+1);if(r instanceof Rn)this.walkProdRef(r,s,n);else if(r instanceof Ae)this.walkTerminal(r,s,n);else if(r instanceof In)this.walkFlat(r,s,n);else if(r instanceof Nn)this.walkOption(r,s,n);else if(r instanceof zr)this.walkAtLeastOne(r,s,n);else if(r instanceof Wr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof _r)this.walkManySep(r,s,n);else if(r instanceof Ge)this.walkMany(r,s,n);else if(r instanceof br)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Nn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=ty(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Nn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=ty(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);It(t.definition,s=>{const o=new In({definition:[s]});this.walk(o,i)})}}function ty(e,t,n){return[new Nn({definition:[new Ae({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function oa(e){if(e instanceof Rn)return oa(e.referencedRule);if(e instanceof Ae)return eO(e);if(JN(e))return QN(e);if(ZN(e))return tO(e);throw Error("non exhaustive match")}function QN(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Yc(s),t=t.concat(oa(s)),r=r+1,i=n.length>r;return Gc(t)}function tO(e){const t=xt(e.definition,n=>oa(n));return Gc($n(t))}function eO(e){return[e.terminalType]}const ey="_~IN~_";class nO extends Vc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=iO(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new In({definition:s}),a=oa(o);this.follows[i]=a}}function rO(e){const t={};return It(e,n=>{const r=new nO(n).startWalking();An(t,r)}),t}function iO(e,t){return e.name+t+ey}function Nt(e){return e.charCodeAt(0)}function qh(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function aa(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function eo(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function sO(){throw Error("Internal Error - Should never get here!")}function ny(e){return e.type==="Character"}const Xc=[];for(let e=Nt("0");e<=Nt("9");e++)Xc.push(e);const qc=[Nt("_")].concat(Xc);for(let e=Nt("a");e<=Nt("z");e++)qc.push(e);for(let e=Nt("A");e<=Nt("Z");e++)qc.push(e);const ry=[Nt(" "),Nt("\f"),Nt(`
`),Nt("\r"),Nt("	"),Nt("\v"),Nt("	"),Nt("Â "),Nt("á"),Nt("â"),Nt("â"),Nt("â"),Nt("â"),Nt("â"),Nt("â"),Nt("â"),Nt("â"),Nt("â"),Nt("â"),Nt("â"),Nt("\u2028"),Nt("\u2029"),Nt("â¯"),Nt("â"),Nt("ã"),Nt("\uFEFF")],oO=/[0-9a-fA-F]/,Jc=/[0-9]/,aO=/[1-9]/;class cO{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":aa(r,"global");break;case"i":aa(r,"ignoreCase");break;case"m":aa(r,"multiLine");break;case"u":aa(r,"unicode");break;case"y":aa(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}eo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return sO()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;eo(n);break}if(!(t===!0&&n===void 0)&&eo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),eo(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Nt(`
`),Nt("\r"),Nt("\u2028"),Nt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Xc;break;case"D":t=Xc,n=!0;break;case"s":t=ry;break;case"S":t=ry,n=!0;break;case"w":t=qc;break;case"W":t=qc,n=!0;break}if(eo(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Nt("\f");break;case"n":t=Nt(`
`);break;case"r":t=Nt("\r");break;case"t":t=Nt("	");break;case"v":t=Nt("\v");break}if(eo(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Nt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Nt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Nt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,ny(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,ny(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else qh(r.value,t),t.push(Nt("-")),qh(i.value,t)}else qh(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Nt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(aO.test(t)===!1)throw Error("Expecting a positive integer");for(;Jc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Jc.test(t)===!1)throw Error("Expecting an integer");for(;Jc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Nt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Jc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(oO.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Jh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Zc={};const lO=new cO;function Qc(e){const t=e.toString();if(Zc.hasOwnProperty(t))return Zc[t];{const n=lO.pattern(t);return Zc[t]=n,n}}function uO(){Zc={}}const iy="Complement Sets are not supported for first char optimization",tl=`Unable to use "first char" lexer optimizations:
`;function hO(e,t=!1){try{const n=Qc(e);return Zh(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===iy)t&&Jg(`${tl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Xh(`${tl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Zh(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Zh(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":el(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(iy);It(o.value,c=>{if(typeof c=="number")el(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)el(u,t,n);else{for(let u=l.from;u<=l.to&&u<la;u++)el(u,t,n);if(l.to>=la){const u=l.from>=la?l.from:la,h=l.to,d=Ui(u),f=Ui(h);for(let p=d;p<=f;p++)t[p]=p}}}});break;case"Group":Zh(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Qh(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Be(t)}function el(e,t,n){const r=Ui(e);t[r]=r,n===!0&&fO(e,t)}function fO(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Ui(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Ui(i.charCodeAt(0));t[s]=s}}}function sy(e,t){return Qs(e.value,n=>{if(typeof n=="number")return gn(t,n);{const r=n;return Qs(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Qh(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?te(e.value)?mr(e.value,Qh):Qh(e.value):!1}class dO extends Jh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){gn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?sy(t,this.targetCharCodes)===void 0&&(this.found=!0):sy(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function tf(e,t){if(t instanceof RegExp){const n=Qc(t),r=new dO(e);return r.visit(n),r.found}else return Qs(t,n=>gn(e,n.charCodeAt(0)))!==void 0}const as="PATTERN",ca="defaultMode",nl="modes";let oy=typeof new RegExp("(?:)").sticky=="boolean";function pO(e,t){t=Yh(t,{useSticky:oy,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,v)=>v()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{PO()});let r;n("Reject Lexer.NA",()=>{r=Kc(e,T=>T[as]===He.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=xt(r,T=>{const v=T[as];if(hi(v)){const I=v.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!v.ignoreCase?I:I.length===2&&I[0]==="\\"&&!gn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:t.useSticky?cy(v):ay(v)}else{if(ci(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const I=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(I);return t.useSticky?cy(U):ay(U)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=xt(r,T=>T.tokenTypeIdx),a=xt(r,T=>{const v=T.GROUP;if(v!==He.SKIPPED){if(vn(v))return v;if(fi(v))return!1;throw Error("non exhaustive match")}}),c=xt(r,T=>{const v=T.LONGER_ALT;if(v)return te(v)?xt(v,U=>Xg(r,U)):[Xg(r,v)]}),l=xt(r,T=>T.PUSH_MODE),u=xt(r,T=>St(T,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const T=hy(t.lineTerminatorCharacters);h=xt(r,v=>!1),t.positionTracking!=="onlyOffset"&&(h=xt(r,v=>St(v,"LINE_BREAKS")?!!v.LINE_BREAKS:uy(v,T)===!1&&tf(T,v.PATTERN)))});let d,f,p,m;n("Misc Mapping #2",()=>{d=xt(r,ly),f=xt(s,MO),p=Sn(r,(T,v)=>{const I=v.GROUP;return vn(I)&&I!==He.SKIPPED&&(T[I]=[]),T},{}),m=xt(s,(T,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:d[v],short:f[v],group:a[v],push:l[v],pop:u[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let x=!0,w=[];return t.safeMode||n("First Char Optimization",()=>{w=Sn(r,(T,v,I)=>{if(typeof v.PATTERN=="string"){const U=v.PATTERN.charCodeAt(0),R=Ui(U);ef(T,R,m[I])}else if(te(v.START_CHARS_HINT)){let U;It(v.START_CHARS_HINT,R=>{const L=typeof R=="string"?R.charCodeAt(0):R,B=Ui(L);U!==B&&(U=B,ef(T,B,m[I]))})}else if(hi(v.PATTERN))if(v.PATTERN.unicode)x=!1,t.ensureOptimizations&&Xh(`${tl}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=hO(v.PATTERN,t.ensureOptimizations);pe(U)&&(x=!1),It(U,R=>{ef(T,R,m[I])})}else t.ensureOptimizations&&Xh(`${tl}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),x=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:x}}function mO(e,t){let n=[];const r=yO(e);n=n.concat(r.errors);const i=_O(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(gO(s)),n=n.concat(vO(s)),n=n.concat(SO(s,t)),n=n.concat(RO(s)),n}function gO(e){let t=[];const n=ir(e,r=>hi(r[as]));return t=t.concat(EO(n)),t=t.concat(kO(n)),t=t.concat(TO(n)),t=t.concat(AO(n)),t=t.concat(wO(n)),t}function yO(e){const t=ir(e,i=>!St(i,as)),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Re.MISSING_PATTERN,tokenTypes:[i]})),r=Wc(e,t);return{errors:n,valid:r}}function _O(e){const t=ir(e,i=>{const s=i[as];return!hi(s)&&!ci(s)&&!St(s,"exec")&&!vn(s)}),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Re.INVALID_PATTERN,tokenTypes:[i]})),r=Wc(e,t);return{errors:n,valid:r}}const bO=/[^\\][$]/;function EO(e){class t extends Jh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=ir(e,i=>{const s=i.PATTERN;try{const o=Qc(s),a=new t;return a.visit(o),a.found}catch{return bO.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Re.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function wO(e){const t=ir(e,r=>r.PATTERN.test(""));return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Re.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const xO=/[^\\[][\^]|^\^/;function kO(e){class t extends Jh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=ir(e,i=>{const s=i.PATTERN;try{const o=Qc(s),a=new t;return a.visit(o),a.found}catch{return xO.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Re.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function TO(e){const t=ir(e,r=>{const i=r[as];return i instanceof RegExp&&(i.multiline||i.global)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Re.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function AO(e){const t=[];let n=xt(e,s=>Sn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!gn(t,a)&&a.PATTERN!==He.NA&&(t.push(a),o.push(a)),o),[]));n=ia(n);const r=ir(n,s=>s.length>1);return xt(r,s=>{const o=xt(s,c=>c.name);return{message:`The same RegExp pattern ->${gr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Re.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function vO(e){const t=ir(e,r=>{if(!St(r,"GROUP"))return!1;const i=r.GROUP;return i!==He.SKIPPED&&i!==He.NA&&!vn(i)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Re.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function SO(e,t){const n=ir(e,i=>i.PUSH_MODE!==void 0&&!gn(t,i.PUSH_MODE));return xt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Re.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function RO(e){const t=[],n=Sn(e,(r,i,s)=>{const o=i.PATTERN;return o===He.NA||(vn(o)?r.push({str:o,idx:s,tokenType:i}):hi(o)&&NO(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return It(e,(r,i)=>{It(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&IO(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Re.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function IO(e,t){if(hi(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(ci(t))return t(e,0,[],{});if(St(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function NO(e){return Qs([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function ay(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function cy(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function OO(e,t,n){const r=[];return St(e,ca)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ca+`> property in its definition
`,type:Re.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),St(e,nl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+nl+`> property in its definition
`,type:Re.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),St(e,nl)&&St(e,ca)&&!St(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ca}: <${e.defaultMode}>which does not exist
`,type:Re.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),St(e,nl)&&It(e.modes,(i,s)=>{It(i,(o,a)=>{if(fi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Re.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(St(o,"LONGER_ALT")){const c=te(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];It(c,l=>{!fi(l)&&!gn(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Re.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function CO(e,t,n){const r=[];let i=!1;const s=ia($n(Be(e.modes))),o=Kc(s,c=>c[as]===He.NA),a=hy(n);return t&&It(o,c=>{const l=uy(c,a);if(l!==!1){const h={message:FO(c,l),type:l.issue,tokenType:c};r.push(h)}else St(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):tf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Re.NO_LINE_BREAKS_FLAGS}),r}function LO(e){const t={},n=nr(e);return It(n,r=>{const i=e[r];if(te(i))t[r]=[];else throw Error("non exhaustive match")}),t}function ly(e){const t=e.PATTERN;if(hi(t))return!1;if(ci(t))return!0;if(St(t,"exec"))return!0;if(vn(t))return!1;throw Error("non exhaustive match")}function MO(e){return vn(e)&&e.length===1?e.charCodeAt(0):!1}const UO={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function uy(e,t){if(St(e,"LINE_BREAKS"))return!1;if(hi(e.PATTERN)){try{tf(t,e.PATTERN)}catch(n){return{issue:Re.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(vn(e.PATTERN))return!1;if(ly(e))return{issue:Re.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function FO(e,t){if(t.issue===Re.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Re.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function hy(e){return xt(e,n=>vn(n)?n.charCodeAt(0):n)}function ef(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const la=256;let rl=[];function Ui(e){return e<la?e:rl[e]}function PO(){if(pe(rl)){rl=new Array(65536);for(let e=0;e<65536;e++)rl[e]=e>255?255+~~(e/255):e}}function ua(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function il(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let fy=1;const dy={};function ha(e){const t=BO(e);DO(t),jO(t),$O(t),It(t,n=>{n.isParent=n.categoryMatches.length>0})}function BO(e){let t=rn(e),n=e,r=!0;for(;r;){n=ia($n(xt(n,s=>s.CATEGORIES)));const i=Wc(n,t);t=t.concat(i),pe(i)?r=!1:n=i}return t}function DO(e){It(e,t=>{my(t)||(dy[fy]=t,t.tokenTypeIdx=fy++),gy(t)&&!te(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),gy(t)||(t.CATEGORIES=[]),zO(t)||(t.categoryMatches=[]),WO(t)||(t.categoryMatchesMap={})})}function $O(e){It(e,t=>{t.categoryMatches=[],It(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(dy[r].tokenTypeIdx)})})}function jO(e){It(e,t=>{py([],t)})}function py(e,t){It(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),It(t.CATEGORIES,n=>{const r=e.concat(t);gn(r,n)||py(r,n)})}function my(e){return St(e,"tokenTypeIdx")}function gy(e){return St(e,"CATEGORIES")}function zO(e){return St(e,"categoryMatches")}function WO(e){return St(e,"categoryMatchesMap")}function KO(e){return St(e,"tokenTypeIdx")}const GO={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Re;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Re||(Re={}));const fa={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:GO,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(fa);let He=class{constructor(t,n=fa){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Zg(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=An({},fa,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===fa.lineTerminatorsPattern)this.config.lineTerminatorsPattern=UO;else if(this.config.lineTerminatorCharacters===fa.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),te(t)?i={modes:{defaultMode:rn(t)},defaultMode:ca}:(s=!1,i=rn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(OO(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(CO(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},It(i.modes,(a,c)=>{i.modes[c]=Kc(a,l=>fi(l))});const o=nr(i.modes);if(It(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(mO(a,o))}),pe(this.lexerDefinitionErrors)){ha(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=pO(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=An({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!pe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=xt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}It(this.lexerDefinitionWarning,a=>{Jg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(oy?(this.chopInput=Xs,this.match=this.matchWithTest):(this.updateLastIndex=Ke,this.match=this.matchWithExec),s&&(this.handleModes=Ke),this.trackStartLines===!1&&(this.computeNewColumn=Xs),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Ke),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Sn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!pe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{uO()}),this.TRACE_INIT("toFastProperties",()=>{Qg(this)})})}tokenize(t,n=this.defaultMode){if(!pe(this.lexerDefinitionErrors)){const i=xt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,h,d,f,p,m,x,w;const T=t,v=T.length;let I=0,U=0;const R=this.hasCustom?0:Math.floor(t.length/10),L=new Array(R),B=[];let O=this.trackStartLines?1:void 0,Y=this.trackStartLines?1:void 0;const et=LO(this.emptyGroups),C=this.trackStartLines,S=this.config.lineTerminatorsPattern;let b=0,P=[],X=[];const D=[],ct=[];Object.freeze(ct);let tt;function ft(){return P}function V(Lt){const Xt=Ui(Lt),Mt=X[Xt];return Mt===void 0?ct:Mt}const z=Lt=>{if(D.length===1&&Lt.tokenType.PUSH_MODE===void 0){const Xt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Lt);B.push({offset:Lt.startOffset,line:Lt.startLine,column:Lt.startColumn,length:Lt.image.length,message:Xt})}else{D.pop();const Xt=Zs(D);P=this.patternIdxToConfig[Xt],X=this.charCodeToPatternIdxToConfig[Xt],b=P.length;const Mt=this.canModeBeOptimized[Xt]&&this.config.safeMode===!1;X&&Mt?tt=V:tt=ft}};function Et(Lt){D.push(Lt),X=this.charCodeToPatternIdxToConfig[Lt],P=this.patternIdxToConfig[Lt],b=P.length,b=P.length;const Xt=this.canModeBeOptimized[Lt]&&this.config.safeMode===!1;X&&Xt?tt=V:tt=ft}Et.call(this,n);let ot;const lt=this.config.recoveryEnabled;for(;I<v;){c=null;const Lt=T.charCodeAt(I),Xt=tt(Lt),Mt=Xt.length;for(r=0;r<Mt;r++){ot=Xt[r];const kt=ot.pattern;l=null;const Bt=ot.short;if(Bt!==!1?Lt===Bt&&(c=kt):ot.isCustom===!0?(w=kt.exec(T,I,L,et),w!==null?(c=w[0],w.payload!==void 0&&(l=w.payload)):c=null):(this.updateLastIndex(kt,I),c=this.match(kt,t,I)),c!==null){if(a=ot.longerAlt,a!==void 0){const Ut=a.length;for(s=0;s<Ut;s++){const we=P[a[s]],Ne=we.pattern;if(u=null,we.isCustom===!0?(w=Ne.exec(T,I,L,et),w!==null?(o=w[0],w.payload!==void 0&&(u=w.payload)):o=null):(this.updateLastIndex(Ne,I),o=this.match(Ne,t,I)),o&&o.length>c.length){c=o,l=u,ot=we;break}}}break}}if(c!==null){if(h=c.length,d=ot.group,d!==void 0&&(f=ot.tokenTypeIdx,p=this.createTokenInstance(c,I,f,ot.tokenType,O,Y,h),this.handlePayload(p,l),d===!1?U=this.addToken(L,U,p):et[d].push(p)),t=this.chopInput(t,h),I=I+h,Y=this.computeNewColumn(Y,h),C===!0&&ot.canLineTerminator===!0){let kt=0,Bt,Ut;S.lastIndex=0;do Bt=S.test(c),Bt===!0&&(Ut=S.lastIndex-1,kt++);while(Bt===!0);kt!==0&&(O=O+kt,Y=h-Ut,this.updateTokenEndLineColumnLocation(p,d,Ut,kt,O,Y,h))}this.handleModes(ot,z,Et,p)}else{const kt=I,Bt=O,Ut=Y;let we=lt===!1;for(;we===!1&&I<v;)for(t=this.chopInput(t,1),I++,i=0;i<b;i++){const Ne=P[i],E=Ne.pattern,st=Ne.short;if(st!==!1?T.charCodeAt(I)===st&&(we=!0):Ne.isCustom===!0?we=E.exec(T,I,L,et)!==null:(this.updateLastIndex(E,I),we=E.exec(t)!==null),we===!0)break}if(m=I-kt,Y=this.computeNewColumn(Y,m),x=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,kt,m,Bt,Ut),B.push({offset:kt,line:Bt,column:Ut,length:m,message:x}),lt===!1)break}}return this.hasCustom||(L.length=U),{tokens:L,groups:et,errors:B}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};He.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",He.NA=/NOT_APPLICABLE/;function da(e){return yy(e)?e.LABEL:e.name}function yy(e){return vn(e.LABEL)&&e.LABEL!==""}const HO="parent",_y="categories",by="label",Ey="group",wy="push_mode",xy="pop_mode",ky="longer_alt",Ty="line_breaks",Ay="start_chars_hint";function jn(e){return YO(e)}function YO(e){const t=e.pattern,n={};if(n.name=e.name,fi(t)||(n.PATTERN=t),St(e,HO))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return St(e,_y)&&(n.CATEGORIES=e[_y]),ha([n]),St(e,by)&&(n.LABEL=e[by]),St(e,Ey)&&(n.GROUP=e[Ey]),St(e,xy)&&(n.POP_MODE=e[xy]),St(e,wy)&&(n.PUSH_MODE=e[wy]),St(e,ky)&&(n.LONGER_ALT=e[ky]),St(e,Ty)&&(n.LINE_BREAKS=e[Ty]),St(e,Ay)&&(n.START_CHARS_HINT=e[Ay]),n}const cs=jn({name:"EOF",pattern:He.NA});ha([cs]);function sl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function VO(e,t){return ua(e,t)}const vy={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${yy(e)?`--> ${da(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+gr(t).image+"'";if(r)return s+r+a;{const c=Sn(e,(d,f)=>d.concat(f),[]),l=xt(c,d=>`[${xt(d,f=>da(f)).join(", ")}]`),h=`one of these possible Token sequences:
${xt(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+gr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${xt(e,l=>`[${xt(l,u=>da(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(vy);const XO={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},ls={buildDuplicateFoundError(e,t){function n(u){return u instanceof Ae?u.terminalType.name:u instanceof Rn?u.nonTerminalName:""}const r=e.name,i=gr(t),s=i.idx,o=Kr(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=xt(e.prefixPath,i=>da(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=xt(e.prefixPath,i=>da(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Kr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=xt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof to?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function qO(e,t){const n=new JO(e,t);return n.resolveRefs(),n.errors}class JO extends os{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){It(Be(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:yn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class ZO extends Vc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=rn(this.path.ruleStack).reverse(),this.occurrenceStack=rn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){pe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class QO extends ZO{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new In({definition:i});this.possibleTokTypes=oa(s),this.found=!0}}}class ol extends Vc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class tC extends ol{walkMany(t,n,r){if(t.idx===this.occurrence){const i=gr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class Sy extends ol{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=gr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class eC extends ol{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=gr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Ry extends ol{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=gr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function nf(e,t,n=[]){n=rn(n);let r=[],i=0;function s(a){return a.concat(sn(e,i+1))}function o(a){const c=nf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof In)return o(a.definition);if(a instanceof Rn)return o(a.definition);if(a instanceof Nn)r=o(a.definition);else if(a instanceof zr){const c=a.definition.concat([new Ge({definition:a.definition})]);return o(c)}else if(a instanceof Wr){const c=[new In({definition:a.definition}),new Ge({definition:[new Ae({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof _r){const c=a.definition.concat([new Ge({definition:[new Ae({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ge){const c=a.definition.concat([new Ge({definition:a.definition})]);r=o(c)}else{if(a instanceof br)return It(a.definition,c=>{pe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ae)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:sn(e,i)}),r}function Iy(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!pe(h);){const d=h.pop();if(d===o){a&&Zs(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,x=d.occurrenceStack;if(pe(f))continue;const w=f[0];if(w===i){const T={idx:p,def:sn(f),ruleStack:sa(m),occurrenceStack:sa(x)};h.push(T)}else if(w instanceof Ae)if(p<c-1){const T=p+1,v=t[T];if(n(v,w.terminalType)){const I={idx:T,def:sn(f),ruleStack:m,occurrenceStack:x};h.push(I)}}else if(p===c-1)u.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:m,occurrenceStack:x}),a=!0;else throw Error("non exhaustive match");else if(w instanceof Rn){const T=rn(m);T.push(w.nonTerminalName);const v=rn(x);v.push(w.idx);const I={idx:p,def:w.definition.concat(s,sn(f)),ruleStack:T,occurrenceStack:v};h.push(I)}else if(w instanceof Nn){const T={idx:p,def:sn(f),ruleStack:m,occurrenceStack:x};h.push(T),h.push(o);const v={idx:p,def:w.definition.concat(sn(f)),ruleStack:m,occurrenceStack:x};h.push(v)}else if(w instanceof zr){const T=new Ge({definition:w.definition,idx:w.idx}),v=w.definition.concat([T],sn(f)),I={idx:p,def:v,ruleStack:m,occurrenceStack:x};h.push(I)}else if(w instanceof Wr){const T=new Ae({terminalType:w.separator}),v=new Ge({definition:[T].concat(w.definition),idx:w.idx}),I=w.definition.concat([v],sn(f)),U={idx:p,def:I,ruleStack:m,occurrenceStack:x};h.push(U)}else if(w instanceof _r){const T={idx:p,def:sn(f),ruleStack:m,occurrenceStack:x};h.push(T),h.push(o);const v=new Ae({terminalType:w.separator}),I=new Ge({definition:[v].concat(w.definition),idx:w.idx}),U=w.definition.concat([I],sn(f)),R={idx:p,def:U,ruleStack:m,occurrenceStack:x};h.push(R)}else if(w instanceof Ge){const T={idx:p,def:sn(f),ruleStack:m,occurrenceStack:x};h.push(T),h.push(o);const v=new Ge({definition:w.definition,idx:w.idx}),I=w.definition.concat([v],sn(f)),U={idx:p,def:I,ruleStack:m,occurrenceStack:x};h.push(U)}else if(w instanceof br)for(let T=w.definition.length-1;T>=0;T--){const v=w.definition[T],I={idx:p,def:v.definition.concat(sn(f)),ruleStack:m,occurrenceStack:x};h.push(I),h.push(o)}else if(w instanceof In)h.push({idx:p,def:w.definition.concat(sn(f)),ruleStack:m,occurrenceStack:x});else if(w instanceof to)h.push(nC(w,p,m,x));else throw Error("non exhaustive match")}return u}function nC(e,t,n,r){const i=rn(n);i.push(e.name);const s=rn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Ie;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Ie||(Ie={}));function Ny(e){if(e instanceof Nn||e==="Option")return Ie.OPTION;if(e instanceof Ge||e==="Repetition")return Ie.REPETITION;if(e instanceof zr||e==="RepetitionMandatory")return Ie.REPETITION_MANDATORY;if(e instanceof Wr||e==="RepetitionMandatoryWithSeparator")return Ie.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof _r||e==="RepetitionWithSeparator")return Ie.REPETITION_WITH_SEPARATOR;if(e instanceof br||e==="Alternation")return Ie.ALTERNATION;throw Error("non exhaustive match")}function rC(e,t,n,r,i,s){const o=sf(e,t,n),a=My(o)?il:ua;return s(o,r,a,i)}function iC(e,t,n,r,i,s){const o=of(e,t,i,n),a=My(o)?il:ua;return s(o[0],a,r)}function sC(e,t,n,r){const i=e.length,s=mr(e,o=>mr(o,a=>a.length===1));if(t)return function(o){const a=xt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let m=0;m<p;m++){const x=this.LA(m+1);if(n(x,f[m])===!1)continue t}return c}}};if(s&&!r){const o=xt(e,c=>$n(c)),a=Sn(o,(c,l,u)=>(It(l,h=>{St(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),It(h.categoryMatches,d=>{St(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue t}return o}}}}function oC(e,t,n){const r=mr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=$n(e);if(s.length===1&&pe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Sn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,It(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class aC extends Vc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Ie.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Ie.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Ie.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Ie.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Oy extends os{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Ie.OPTION)}visitRepetition(t){this.checkIsTarget(t,Ie.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Ie.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Ie.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Ie.ALTERNATION)}}function Cy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function rf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function cC(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function Ly(e,t){const n=xt(e,o=>nf([o],1)),r=Cy(n.length),i=xt(n,o=>{const a={};return It(o,c=>{const l=rf(c.partialPath);It(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=Cy(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=rf(h);if(cC(i,f,c)||pe(d)||h.length===t){const m=r[c];if(af(m,h)===!1){m.push(h);for(let x=0;x<f.length;x++){const w=f[x];i[c][w]=!0}}}else{const m=nf(d,o+1,h);s[c]=s[c].concat(m),It(m,x=>{const w=rf(x.partialPath);It(w,T=>{i[c][T]=!0})})}}}}return r}function sf(e,t,n,r){const i=new Oy(e,Ie.ALTERNATION,r);return t.accept(i),Ly(i.result,n)}function of(e,t,n,r){const i=new Oy(e,n);t.accept(i);const s=i.result,a=new aC(t,e,n).startWalking(),c=new In({definition:s}),l=new In({definition:a});return Ly([c,l],r)}function af(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function lC(e,t){return e.length<t.length&&mr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function My(e){return mr(e,t=>mr(t,n=>mr(n,r=>pe(r.categoryMatches))))}function uC(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return xt(t,n=>Object.assign({type:yn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function hC(e,t,n,r){const i=sr(e,c=>fC(c,n)),s=TC(e,t,n),o=sr(e,c=>EC(c,n)),a=sr(e,c=>mC(c,e,r,n));return i.concat(s,o,a)}function fC(e,t){const n=new pC;e.accept(n);const r=n.allProductions,i=Vg(r,dC),s=yr(i,a=>a.length>1);return xt(Be(s),a=>{const c=gr(a),l=t.buildDuplicateFoundError(e,a),u=Kr(c),h={message:l,type:yn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=Uy(c);return d&&(h.parameter=d),h})}function dC(e){return`${Kr(e)}_#_${e.idx}_#_${Uy(e)}`}function Uy(e){return e instanceof Ae?e.terminalType.name:e instanceof Rn?e.nonTerminalName:""}class pC extends os{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function mC(e,t,n,r){const i=[];if(Sn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:yn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function gC(e,t,n){const r=[];let i;return gn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:yn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Fy(e,t,n,r=[]){const i=[],s=al(t.definition);if(pe(s))return[];{const o=e.name;gn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:yn.LEFT_RECURSION,ruleName:o});const c=Wc(s,r.concat([e])),l=sr(c,u=>{const h=rn(r);return h.push(u),Fy(e,u,n,h)});return i.concat(l)}}function al(e){let t=[];if(pe(e))return t;const n=gr(e);if(n instanceof Rn)t.push(n.referencedRule);else if(n instanceof In||n instanceof Nn||n instanceof zr||n instanceof Wr||n instanceof _r||n instanceof Ge)t=t.concat(al(n.definition));else if(n instanceof br)t=$n(xt(n.definition,s=>al(s.definition)));else if(!(n instanceof Ae))throw Error("non exhaustive match");const r=Yc(n),i=e.length>1;if(r&&i){const s=sn(e);return t.concat(al(s))}else return t}class cf extends os{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function yC(e,t){const n=new cf;e.accept(n);const r=n.alternations;return sr(r,s=>{const o=sa(s.definition);return sr(o,(a,c)=>{const l=Iy([a],[],ua,1);return pe(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:yn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function _C(e,t,n){const r=new cf;e.accept(r);let i=r.alternations;return i=Kc(i,o=>o.ignoreAmbiguities===!0),sr(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=sf(a,e,c,o),u=xC(l,o,e,n),h=kC(l,o,e,n);return u.concat(h)})}class bC extends os{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function EC(e,t){const n=new cf;e.accept(n);const r=n.alternations;return sr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:yn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function wC(e,t,n){const r=[];return It(e,i=>{const s=new bC;i.accept(s);const o=s.allProductions;It(o,a=>{const c=Ny(a),l=a.maxLookahead||t,u=a.idx,d=of(u,i,c,l)[0];if(pe($n(d))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:f,type:yn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function xC(e,t,n,r){const i=[],s=Sn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||It(c,u=>{const h=[l];It(e,(d,f)=>{l!==f&&af(d,u)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!af(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return xt(s,a=>{const c=xt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:yn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function kC(e,t,n,r){const i=Sn(e,(o,a,c)=>{const l=xt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return ia(sr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=ir(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&lC(d.path,l));return xt(u,d=>{const f=[d.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:yn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function TC(e,t,n){const r=[],i=xt(t,s=>s.name);return It(e,s=>{const o=s.name;if(gn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:yn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function AC(e){const t=Yh(e,{errMsgProvider:XO}),n={};return It(e.rules,r=>{n[r.name]=r}),qO(n,t.errMsgProvider)}function vC(e){return e=Yh(e,{errMsgProvider:ls}),hC(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const Py="MismatchedTokenException",By="NoViableAltException",Dy="EarlyExitException",$y="NotAllInputParsedException",jy=[Py,By,Dy,$y];Object.freeze(jy);function cl(e){return gn(jy,e.name)}class ll extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class zy extends ll{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Py}}class SC extends ll{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=By}}class RC extends ll{constructor(t,n){super(t,n),this.name=$y}}class IC extends ll{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Dy}}const lf={},Wy="InRuleRecoveryException";class NC extends Error{constructor(t){super(t),this.name=Wy}}class OC{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=St(t,"recoveryEnabled")?t.recoveryEnabled:di.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=CC)}getTokenToInsert(t){const n=sl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new zy(f,l,this.LA(0));p.resyncedTokens=sa(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new NC("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||pe(n))return!1;const r=this.LA(1);return Qs(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return gn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Qs(t,s=>VO(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return lf;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return xt(t,(r,i)=>i===0?lf:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=xt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return $n(t)}getFollowSetFromFollowKey(t){if(t===lf)return[cs];const n=t.ruleName+t.idxInCallingRule+ey+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,cs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return sa(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=rn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return xt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function CC(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=cs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const LC=4,Fi=8,Ky=1<<Fi,Gy=2<<Fi,uf=3<<Fi,hf=4<<Fi,ff=5<<Fi,ul=6<<Fi;function df(e,t,n){return n|t|e}class MC{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:di.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(pe(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return sr(t,n=>Fy(n,n,ls))}validateEmptyOrAlternatives(t){return sr(t,n=>yC(n,ls))}validateAmbiguousAlternationAlternatives(t,n){return sr(t,r=>_C(r,n,ls))}validateSomeNonEmptyLookaheadPath(t,n){return wC(t,n,ls)}buildLookaheadForAlternation(t){return rC(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,sC)}buildLookaheadForOptional(t){return iC(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Ny(t.prodType),oC)}}class UC{initLooksAhead(t){this.dynamicTokensEnabled=St(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:di.dynamicTokensEnabled,this.maxLookahead=St(t,"maxLookahead")?t.maxLookahead:di.maxLookahead,this.lookaheadStrategy=St(t,"lookaheadStrategy")?t.lookaheadStrategy:new MC({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){It(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=PC(n);It(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Kr(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=df(this.fullRuleNameToShort[n.name],Ky,l.idx);this.setLaFuncCache(d,h)})}),It(i,l=>{this.computeLookaheadFunc(n,l.idx,uf,"Repetition",l.maxLookahead,Kr(l))}),It(s,l=>{this.computeLookaheadFunc(n,l.idx,Gy,"Option",l.maxLookahead,Kr(l))}),It(o,l=>{this.computeLookaheadFunc(n,l.idx,hf,"RepetitionMandatory",l.maxLookahead,Kr(l))}),It(a,l=>{this.computeLookaheadFunc(n,l.idx,ul,"RepetitionMandatoryWithSeparator",l.maxLookahead,Kr(l))}),It(c,l=>{this.computeLookaheadFunc(n,l.idx,ff,"RepetitionWithSeparator",l.maxLookahead,Kr(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=df(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return df(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class FC extends os{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const hl=new FC;function PC(e){hl.reset(),e.accept(hl);const t=hl.dslMethods;return hl.reset(),t}function Hy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Yy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function BC(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function DC(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const $C="name";function Vy(e,t){Object.defineProperty(e,$C,{enumerable:!1,configurable:!0,writable:!1,value:t})}function jC(e,t){const n=nr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function zC(e,t){const n=function(){};Vy(n,e+"BaseSemantics");const r={visit:function(i,s){if(te(i)&&(i=i[0]),!fi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=KC(this,t);if(!pe(i)){const s=xt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function WC(e,t,n){const r=function(){};Vy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return It(t,s=>{i[s]=jC}),r.prototype=i,r.prototype.constructor=r,r}var pf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(pf||(pf={}));function KC(e,t){return GC(e,t)}function GC(e,t){const n=ir(t,i=>ci(e[i])===!1),r=xt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:pf.MISSING_METHOD,methodName:i}));return ia(r)}class HC{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=St(t,"nodeLocationTracking")?t.nodeLocationTracking:di.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Ke,this.cstFinallyStateUpdate=Ke,this.cstPostTerminal=Ke,this.cstPostNonTerminal=Ke,this.cstPostRule=Ke;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Yy,this.setNodeLocationFromNode=Yy,this.cstPostRule=Ke,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Ke,this.setNodeLocationFromNode=Ke,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Hy,this.setNodeLocationFromNode=Hy,this.cstPostRule=Ke,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Ke,this.setNodeLocationFromNode=Ke,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Ke,this.setNodeLocationFromNode=Ke,this.cstPostRule=Ke,this.setInitialNodeLocation=Ke;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];BC(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];DC(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(fi(this.baseCstVisitorConstructor)){const t=zC(this.className,nr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(fi(this.baseCstVisitorWithDefaultsConstructor)){const t=WC(this.className,nr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class YC{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):pl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?pl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class VC{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=ml){if(gn(this.definedRulesNames,t)){const o={message:ls.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:yn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=ml){const i=gC(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(cl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return qN(Be(this.gastProductionsCache))}}class XC{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=il,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},St(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(te(t)){if(pe(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(te(t))this.tokensMap=Sn(t,(s,o)=>(s[o.name]=o,s),{});else if(St(t,"modes")&&mr($n(Be(t.modes)),KO)){const s=$n(Be(t.modes)),o=Gc(s);this.tokensMap=Sn(o,(a,c)=>(a[c.name]=c,a),{})}else if(er(t))this.tokensMap=rn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=cs;const r=St(t,"modes")?$n(Be(t.modes)):Be(t),i=mr(r,s=>pe(s.categoryMatches));this.tokenMatcher=i?il:ua,ha(Be(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=St(r,"resyncEnabled")?r.resyncEnabled:ml.resyncEnabled,s=St(r,"recoveryValueFunc")?r.recoveryValueFunc:ml.recoveryValueFunc,o=this.ruleShortNameIdx<<LC+Fi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(cl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Gy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(hf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Ie.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,hf,t,eC)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(ul,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Ry],a,ul,t,Ry)}else throw this.raiseEarlyExitException(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(uf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,uf,t,tC,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(ff,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Sy],a,ff,t,Sy)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,ul,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ky,n),i=te(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new RC(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw cl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new zy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Wy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=rn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),cs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class qC{initErrorHandler(t){this._errors=[],this.errorMessageProvider=St(t,"errorMessageProvider")?t.errorMessageProvider:di.errorMessageProvider}SAVE_ERROR(t){if(cl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:rn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return rn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=of(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new IC(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=sf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new SC(c,this.LA(1),a))}}class JC{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(fi(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Iy([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=gr(t.ruleStack),i=this.getGAstProductions()[n];return new QO(i,t).startWalking()}}const fl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(fl);const Xy=!0,qy=Math.pow(2,Fi)-1,Jy=jn({name:"RECORDING_PHASE_TOKEN",pattern:He.NA});ha([Jy]);const Zy=sl(Jy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Zy);const ZC={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class QC{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return pl}topLevelRuleRecord(t,n){try{const r=new to({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return pa.call(this,Nn,t,n)}atLeastOneInternalRecord(t,n){pa.call(this,zr,n,t)}atLeastOneSepFirstInternalRecord(t,n){pa.call(this,Wr,n,t,Xy)}manyInternalRecord(t,n){pa.call(this,Ge,n,t)}manySepFirstInternalRecord(t,n){pa.call(this,_r,n,t,Xy)}orInternalRecord(t,n){return tL.call(this,t,n)}subruleInternalRecord(t,n,r){if(dl(n),!t||St(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Qy(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Zs(this.recordingProdStack),s=t.ruleName,o=new Rn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?ZC:fl}consumeInternalRecord(t,n,r){if(dl(n),!my(t)){const o=new Error(`<CONSUME${Qy(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Zs(this.recordingProdStack),s=new Ae({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Zy}}function pa(e,t,n,r=!1){dl(n);const i=Zs(this.recordingProdStack),s=ci(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),St(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),fl}function tL(e,t){dl(t);const n=Zs(this.recordingProdStack),r=te(e)===!1,i=r===!1?e:e.DEF,s=new br({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});St(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Vh(i,a=>ci(a.GATE));return s.hasPredicates=o,n.definition.push(s),It(i,a=>{const c=new In({definition:[]});s.definition.push(c),St(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:St(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),fl}function Qy(e){return e===0?"":`${e}`}function dl(e){if(e<0||e>qy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${qy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class eL{initPerformanceTracer(t){if(St(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=di.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=Zg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function nL(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const pl=sl(cs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(pl);const di=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:vy,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ml=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var yn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(yn||(yn={}));let mf=class u1{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Qg(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),It(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=AC({rules:Be(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(pe(r)&&this.skipValidations===!1){const i=vC({rules:Be(this.gastProductionsCache),tokenTypes:Be(this.tokensMap),errMsgProvider:ls,grammarName:n}),s=uC({lookaheadStrategy:this.lookaheadStrategy,rules:Be(this.gastProductionsCache),tokenTypes:Be(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),pe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=rO(Be(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Be(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Be(this.gastProductionsCache))})),!u1.DEFER_DEFINITION_ERRORS_HANDLING&&!pe(this.definitionErrors))throw t=xt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),St(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=St(n,"skipValidations")?n.skipValidations:di.skipValidations}};mf.DEFER_DEFINITION_ERRORS_HANDLING=!1,nL(mf,[OC,UC,HC,YC,XC,VC,qC,JC,QC,eL]);class rL extends mf{constructor(t,n=di){const r=rn(n);r.outputCst=!0,super(t,r)}}function iL(e){const t=new sL,n=Be(e);return xt(n,r=>t.visitRule(r))}class sL extends os{visitRule(t){const n=this.visitEach(t.definition),r=Vg(n,s=>s.propertyName),i=xt(r,(s,o)=>{const a=!Vh(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=xt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:gl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:gl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:gl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:gl(t)}]}visitEachAndOverrideWith(t,n){return xt(this.visitEach(t),r=>An({},r,n))}visitEach(t){return $n(xt(t,n=>this.visit(n)))}}function gl(e){return e instanceof Rn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function oL(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat($n(xt(e,r=>aL(r)))),t.includeVisitorInterface&&(n=n.concat(hL(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function aL(e){const t=cL(e),n=lL(e);return[t,n]}function cL(e){const t=e_(e.name),n=gf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function lL(e){return`export type ${gf(e.name)} = {
  ${xt(e.properties,n=>uL(n)).join(`
  `)}
};`}function uL(e){const t=dL(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function hL(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${xt(t,n=>fL(n)).join(`
  `)}
}`}function fL(e){const t=gf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function dL(e){if(te(e)){const t=Gc(xt(e,r=>t_(r)));return"("+Sn(t,(r,i)=>r+" | "+i)+")"}else return t_(e)}function t_(e){return e.kind==="token"?"IToken":e_(e.name)}function e_(e){return gg(e)+"CstNode"}function gf(e){return gg(e)+"CstChildren"}const pL={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function mL(e,t){const n=Object.assign(Object.assign({},pL),t),r=iL(e);return oL(r,n)}const Gr=!!JSON.parse("false"),gL=!!JSON.parse("false");JSON.parse("false");const yL=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const pi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Ac*pi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return vc*pi.DRAW_CHAR_SCALE}},yl=jp(32,126).map(e=>String.fromCharCode(e));function Gt(e){return jn({...e,name:`token_${e.name}`})}function Pi(e,t=!1){return Gt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on,group:He.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on})}const ma=Gt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),_L=Gt({name:"whitespace",pattern:/ +/,group:He.SKIPPED}),bL=Gt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:He.SKIPPED}),yf=Gt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),no=Gt({name:"command",pattern:/#/,start_chars_hint:["#"]});let n_=!1;function EL(e,t,n){if(!n_)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==ma)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const _f=Gt({name:"text",pattern:EL,line_breaks:!1,start_chars_hint:yl.filter(e=>"@#/?':!".includes(e)===!1)}),r_=Gt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),i_=Gt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),s_=Gt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),o_=Gt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),on=Gt({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:yl}),a_=Gt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),c_=Gt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),l_=Gt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:on}),u_=Gt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:on}),h_=Gt({name:"islessthan",pattern:/<|below/,longer_alt:on}),f_=Gt({name:"isgreaterthan",pattern:/>|above/,longer_alt:on}),d_=Gt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:on}),p_=Gt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:on}),bf=Gt({name:"or",pattern:/or/i,longer_alt:on}),Ef=Gt({name:"not",pattern:/not/i,longer_alt:on}),wf=Gt({name:"and",pattern:/and/i,longer_alt:on}),xf=Gt({name:"plus",pattern:/\+/}),kf=Gt({name:"minus",pattern:/-/}),m_=Gt({name:"power",pattern:/\*\*/}),g_=Gt({name:"multiply",pattern:/\*/}),Tf=Gt({name:"divide",pattern:/\//}),y_=Gt({name:"moddivide",pattern:/%/}),__=Gt({name:"floordivide",pattern:/%%/}),b_=Gt({name:"query",pattern:/\?/}),E_=Gt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),w_=Gt({name:"rparen",pattern:/\)/,pop_mode:!0}),x_=Gt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:yl,longer_alt:on}),k_=Gt({name:"command_toast",pattern:/toast .*/,start_chars_hint:yl,longer_alt:on}),Af=Gt({name:"if",pattern:/if|try|take|give/,longer_alt:on}),_l=Pi("do"),vf=Pi("done"),Sf=Pi("else"),T_=Pi("while"),A_=Pi("repeat"),v_=Pi("waitfor"),S_=Gt({name:"foreach",pattern:/foreach|for/,longer_alt:on}),R_=Pi("break"),I_=Pi("continue");function N_(e){return[...e,c_,l_,u_,d_,h_,p_,f_,bf,Ef,wf,xf,kf,m_,g_,Tf,__,y_,b_,E_,w_,a_,on]}const O_=N_([_f,yf,x_,k_,no,r_,i_,s_,o_,ma,_L,R_,I_,vf,_l,Sf,S_,Af,A_,v_,T_]),wL=new He({defaultMode:"use_newlines",modes:{use_newlines:O_,ignore_newlines:N_([bL])}},{skipValidations:!Gr,ensureOptimizations:Gr});function Rf(e){n_=!0;const t=wL.tokenize(e||` 
`),[n]=(oe(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(sl(ma,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function xL(e,t,n=!0){if(n){const[r,...i]=t;switch(Ct(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:i};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Ct(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function zn(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var If=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(If||{});function C_(e){return Vs(e,If,{bits:t=>Array.from(t)})}function L_(e){return Ho(e,If,{bits:t=>new Uint8Array(t)})}function kL(e,t){return{id:Oe(),code:e,...t}}var Nf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Nf||{});function TL(e){return Vs(e,Nf,{board:vT,object:bc,terrain:bc,charset:C_,palette:C_,stats:Se})}function AL(e){return Ho(e,Nf,{board:ST,object:Ec,terrain:Ec,charset:L_,palette:L_})}function ga(e){const t={...us(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function vL(e){return k(e)?(e.stats=void 0,us(e)):{}}function M_(e){const t=Rf(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===yf){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=xL(At(c)?c:"",l,r),h=Ct(u.values.join(" "));switch(r=!1,u.type){case wt.LOADER:n.type=bt.LOADER,n.name=h;break;case wt.BOARD:n.type=bt.BOARD,n.name=h;break;case wt.OBJECT:n.type=bt.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=bt.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=bt.CHARSET,n.name=h;break;case wt.PALETTE:n.type=bt.PALETTE,n.name=h;break;case wt.CONST:{const[d,f]=u.values;if(At(d)){const p=Ct(d);if(At(f)){const m=parseFloat(f);n[p]=Rt(m)?m:f}else Rt(f)?n[p]=f:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[d,...f]=u.values;if(At(d)){const p=Ct(d);n[p]=[zn(u.type),...f]}break}}}}return n}function us(e){var t;return k(e)?(k((t=e.stats)==null?void 0:t.type)||(e.stats=M_(e.code),k(e.stats.type)||(e.stats.type=bt.OBJECT)),e.stats):{}}function U_(e){switch(e){default:case bt.ERROR:return"error";case bt.LOADER:return zn(wt.LOADER);case bt.BOARD:return zn(wt.BOARD);case bt.OBJECT:return zn(wt.OBJECT);case bt.TERRAIN:return zn(wt.TERRAIN);case bt.CHARSET:return zn(wt.CHARSET);case bt.PALETTE:return zn(wt.PALETTE)}}function mi(e){return us(e).type??bt.ERROR}function gi(e){return U_(mi(e))}function Ue(e){return us(e).name??""}function F_(e,t){return us(e)[t]}const bl=new nh;function Of(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!oe(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Ht.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Ht.ISSWIM;break;case"issolid":t.collision=Ht.ISSOLID;break;case"isbullet":t.collision=Ht.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function ln(e){var t;if(k(e))switch(mi(e)){default:return;case bt.ERROR:return e.code??"";case bt.LOADER:return e.code??"";case bt.BOARD:{k(e.board)||(e.board=AT()),e.board.id=e.id;const n=ga(e);return e.board.isdark=n.isdark??e.board.isdark?1:0,e.board.startx=n.startx??e.board.startx,e.board.starty=n.starty??e.board.starty,e.board.over=n.over??e.board.over,e.board.under=n.under??e.board.under,e.board.camera=n.camera??e.board.camera,e.board.exitnorth=n.exitnorth??e.board.exitnorth,e.board.exitsouth=n.exitsouth??e.board.exitsouth,e.board.exitwest=n.exitwest??e.board.exitwest,e.board.exiteast=n.exiteast??e.board.exiteast,e.board.timelimit=n.timelimit??e.board.timelimit,e.board.restartonzap=n.restartonzap??e.board.restartonzap,e.board.maxplayershots=n.maxplayershots??e.board.maxplayershots,e.board}case bt.OBJECT:return k(e.object)||(e.object=Tm()),e.object.name=Ue(e),e.object.category=Hn.ISOBJECT,Of(ga(e),e.object),e.object;case bt.TERRAIN:return k(e.terrain)||(e.terrain=Tm()),e.terrain.name=Ue(e),e.terrain.category=Hn.ISTERRAIN,Of(ga(e),e.terrain),e.terrain;case bt.PALETTE:{if(k(e.palette)||(e.palette=Cm(HT)),k((t=e.palette)==null?void 0:t.bits)){const n=ga(e),r=Gn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&At(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){bl.set(o);const c=a*Tc,l=bl.r*63,u=bl.g*63,h=bl.b*63;e.palette.bits[c+0]=nn(l,0,63),e.palette.bits[c+1]=nn(u,0,63),e.palette.bits[c+2]=nn(h,0,63)}}}}return e.palette}case bt.CHARSET:return k(e.charset)||(e.charset=Lm(GT)),e.charset}}function P_(e){return{id:Oe(),name:A1(),timestamp:0,activelist:[],pages:e,flags:{}}}var Cf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(Cf||{});function SL(e){return Vs(e,Cf,{pages:t=>t.map(TL),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function RL(e){return Ho(e,Cf,{pages:t=>t.map(AL)})}function B_(e){k(e)&&(e.token=`${v1()}${Jn(1111,9999)}`)}function yi(e,t){if(!k(e))return;const n=Ct(t);return e.pages.find(i=>i.id===t||n===Ue(i))}function On(e,t,n){if(!k(e))return;const r=Ct(n);return e.pages.find(s=>mi(s)===t&&(s.id===n||r===Ue(s)))}function Lf(e,t,n){let r=On(e,t,n);if(!k(r)){const i=U_(t);r=kL(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),$_(e,r)}return r}function hs(e,t){return k(e)?e.pages.filter(n=>mi(n)===t):[]}function Er(e,t,n){if(!k(e))return[];const r=Ct(n);return e.pages.filter(s=>mi(s)===t).filter(s=>{const o=us(s),a=Ct(Ue(s));return s.id===n||r===a||k(o[n])})}function El(e){return k(e)?Xe(e.pages).sort((n,r)=>{const i=mi(n),s=mi(r);return i===s?Ue(n).localeCompare(Ue(r)):s-i}):[]}function D_(e,t){if(k(t)){const n=On(e,bt.TERRAIN,t.kind??"");if(k(n))return n;const r=On(e,bt.OBJECT,t.kind??"");if(k(r))return r}}function $_(e,t){if(!k(e)||!k(t))return!1;const n=yi(e,t.id);return k(n)?!1:(e.pages.push(t),B_(e),!0)}function j_(e,t){const n=yi(e,t);if(k(e)&&k(n)){const r=Ct(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Ue(i)),B_(e),n}}function wr(e,t){if(k(t)&&k(t.kind))return k(t.kinddata)||(t.kinddata=k(t.id)?ya(e,t.kind):Mf(e,t.kind)),t.kinddata}function ro(e,t,n){const r=wr(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function z_(e,t,n,r,i){const s=wr(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function ya(e,t){const n=t??"",r=On(e,bt.OBJECT,n);if(k(r)){const i=ln(r);return{...Xe(i),name:n,code:r.code}}}function Mf(e,t){const n=t??"",r=On(e,bt.TERRAIN,n);if(k(r)){const i=ln(r);return{...Xe(i),name:n,code:r.code}}}function io(e,t){const n=yi(e,t);return ln(n)}function _i(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function W_(e,t){e&&delete e.flags[t]}function K_(e,t,n){const r=_i(e,t);return r==null?void 0:r[n]}function IL(e,t,n,r){const i=_i(e,t);return i&&(i[n]=r),r}function fs(e,t){const n=K_(e,t,"board");return io(e,At(n)?n:"")}function NL(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function wl(e,t,n){if(!k(e))return;IL(e,t,"board",n);const r=io(e,n);k(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function so(e,t,n,r){if(!k(e))return;const i=fs(e,t);if(!k(i))return;const s=pn(i,t);if(!Yo(s)||!(s!=null&&s.id))return;const o=io(e,n);if(!k(o)||(xr(e,o),Pf(e,o,Ht.ISWALK,r)))return;delete i.objects[s.id];const a=fr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=fr(o,s);o.lookup&&(o.lookup[c]=s.id),wl(e,t,o.id)}function OL(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=K_(e,r,"board");return At(i)?i:""});return Yk(n)}function Uf(e){return OL(e).map(n=>io(e,n)).filter(k)}function G_(e){return Ju(e.x,e.y,0,zt-1,ye-1,0)}function CL(e,t,n,r,i){if(!k(t))return;k(t.distmaps)||(t.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=t.distmaps[s];if(!k(o)){o=new Array(Am).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(k(l)&&G_(l)){const u=js(l,zt);if(o[u]===-2){const h=xc(t,l.x,l.y);kc(n,ro(e,h,"collision")??Ht.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}t.distmaps[s]=o}return o}function H_(e,t){return G_(e)?t[js(e,zt)]:-1}function Y_(e,t,n,r,i,s){if(!k(e)||!k(t))return;const o=CL(e,t,n,r,i);if(!k(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const h=H_(a[u],o);h>=0&&h>l&&(l=h,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const h=H_(a[u],o);h>=0&&h<l&&(l=h,c=a[u])}}return c}function xr(e,t){var a;if(!k(e)||!k(t)||k(t.lookup)&&k(t.named))return;const n=new Array(zt*ye).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const l=i[c];if(k(l.x)&&k(l.y)&&k(l.id)&&!k(l.removed)){l.category=Hn.ISOBJECT,n[l.x+l.y*zt]=l.id;const u=Ct(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const l=t.terrain[c];if(k(l)){l.x=s,l.y=o,l.category=Hn.ISTERRAIN;const u=Fr(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=zt&&(s=0,++o)}t.lookup=n,t.named=r}function V_(e,t,n,r){var s;if(!k(e)||!k(t)||!k(t.named)||!k(n))return;const i=Ct(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function LL(e,t,n){if(!(!k(e)||!k(t)||!k(t.lookup)||!k(n==null?void 0:n.id))&&!k(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*zt]=n.id}}function ML(e,t,n){var r;if(k(e)&&k(t)&&k(n==null?void 0:n.x)&&k(n.y)){const i=Fr(n),s=fr(t,n);k((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function Ff(e,t,n){var r;if(k(e)&&k(t)&&k(n==null?void 0:n.id)){if(k(t.lookup)&&k(n.x)&&k(n.y)){const s=n.x+n.y*zt;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Fr(n);k((r=t.named)==null?void 0:r[i])&&k(n.id)&&t.named[i].delete(n.id)}}function X_(e,t,n,r,i,s){if(!k(e)||!k(t)||!k(n))return{x:0,y:0};const o={x:n.x??0,y:n.y??0},a={x:n.lx??o.x,y:n.ly??o.y},c=oi(a,o),l=zt-1,u=ye-1;for(let h=0;h<i.length;++h){const d=Vk(i[h]);switch(d){case mt.IDLE:break;case mt.NORTH:case mt.SOUTH:case mt.WEST:case mt.EAST:Pe(o,d);break;case mt.BY:{const[f,p]=i.slice(h+1);Rt(f)&&Rt(p)&&(o.x=nn(o.x+f,0,l),o.y=nn(o.y+p,0,u)),h+=2;break}case mt.TO:case mt.AT:{const[f,p]=i.slice(h+1);Rt(f)&&Rt(p)&&(o.x=nn(f,0,l),o.y=nn(p,0,u)),h+=2;break}case mt.FLOW:Pe(o,c);break;case mt.SEEK:{const f=OT(t,n,r);Gs(f)&&Pe(o,oi(s,f));break}case mt.RNDNS:Pe(o,Le(mt.NORTH,mt.SOUTH));break;case mt.RNDNE:Pe(o,Le(mt.NORTH,mt.EAST));break;case mt.RND:Pe(o,Le(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));break;case mt.CW:case mt.CCW:case mt.OPP:case mt.RNDP:{const f=X_(e,t,n,r,i.slice(h+1),s);switch(o.x=s.x,o.y=s.y,d){case mt.CW:switch(oi(s,f)){case mt.NORTH:Pe(o,mt.EAST);break;case mt.SOUTH:Pe(o,mt.WEST);break;case mt.EAST:Pe(o,mt.SOUTH);break;case mt.WEST:Pe(o,mt.NORTH);break}break;case mt.CCW:switch(oi(s,f)){case mt.NORTH:Pe(o,mt.WEST);break;case mt.SOUTH:Pe(o,mt.EAST);break;case mt.EAST:Pe(o,mt.NORTH);break;case mt.WEST:Pe(o,mt.SOUTH);break}break;case mt.OPP:switch(oi(s,f)){case mt.NORTH:Pe(o,mt.SOUTH);break;case mt.SOUTH:Pe(o,mt.NORTH);break;case mt.EAST:Pe(o,mt.WEST);break;case mt.WEST:Pe(o,mt.EAST);break}break;case mt.RNDP:switch(oi(s,f)){case mt.NORTH:case mt.SOUTH:o.x+=Le(-1,1);break;case mt.WEST:case mt.EAST:o.y+=Le(-1,1);break}break}break}case mt.FLEE:case mt.AWAY:{const[f,p]=i.slice(h+1);if(Rt(f)&&Rt(p)){const m={x:nn(f,0,l),y:nn(p,0,u)},x=ro(e,n,"collision"),w=Y_(e,t,x,o,m,!0);k(w)&&(o.x=w.x,o.y=w.y)}h+=2;break}case mt.FIND:case mt.TOWARD:{const[f,p]=i.slice(h+1);if(Rt(f)&&Rt(p)){const m={x:nn(f,0,l),y:nn(p,0,u)};if(Jn(1,100)<5)Pe(o,Le(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));else{const x=ro(e,n,"collision"),w=Y_(e,t,x,o,m,!1);if(k(w))if(w.x!==f&&w.y!==p&&NT(t,w))switch(oi(s,w)){case mt.EAST:case mt.WEST:o.y+=Le(-1,1);break;case mt.NORTH:case mt.SOUTH:o.x+=Le(-1,1);break}else o.x=w.x,o.y=w.y}}h+=2;break}case mt.PLAYER:{const f=Vo(t,n,r);Gs(f)&&(o.x=f.x,o.y=f.y);break}}}return o}function UL(e,t,n,r){if(k(e)&&k(t)&&k(n)){const[i,s]=n,o=ya(e,i);if(k(o)&&k(o.name)){const a=bh(t,r,i);return wc(a,s),a}}}function oo(e,t,n,r,i){if(k(e)&&k(t)&&k(n)){const[s,o]=n,a=Mf(e,s);if(k(a)){const l=IT(t,r,s);if(k(l)){wc(l,o);const u=js(r,zt);return wr(e,l),V_(e,t,l,u),l}}const c=ya(e,s);if(k(c)&&k(c.name)){const l=bh(t,r,s,i);if(k(l))return wc(l,o),LL(e,t,l),wr(e,l),V_(e,t,l),l}}}function Hr(e,t,n,r){return!k(n)||Fr(n)==="player"?!1:(n.id?(n.removed=r,Ff(e,t,n)):(dr(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),ML(e,t,n)),!0)}function Pf(e,t,n,r){if(!k(e)||!k(t)||!k(t.lookup)||r.x<0||r.x>=zt||r.y<0||r.y>=ye)return!0;const i=r.x+r.y*zt,s=pn(t,t.lookup[i]??"404");if(k(s))return!0;const o=t.terrain[i];if(k(o)){const a=wr(e,o),c=o.collision??(a==null?void 0:a.collision);return kc(n,c)}return!1}function FL(e,t,n,r){const i=pn(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=ro(e,i,"collision");return Pf(e,t,a,r)}function q_(e,t,n,r){var d;const i=pn(t,(n==null?void 0:n.id)??"");if(!k(e)||!k(t)||!k(i)||!k(i.x)||!k(i.y)||!k(t.lookup)||r.x<0||r.x>=zt||r.y<0||r.y>=ye)return{name:"edge",kind:"edge",collision:Ht.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=fr(t,i),o=fr(t,r),a=ro(e,i,"collision")??Ht.ISWALK,c=Tr(i==null?void 0:i.id),l=pn(t,t.lookup[o]??""),u=Tr((l==null?void 0:l.id)??"");if(k(l)&&(!c||!u))return{...l};const h=t.terrain[o];if(k(h)){const f=h.collision??((d=h==null?void 0:h.kinddata)==null?void 0:d.collision)??Ht.ISWALK;if(kc(a,f))return{...h,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,k(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function PL(e,t,n){const r=[];if(!k(e)||!k(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&k(o.removed)&&n-o.removed>La*5&&(r.push(o.id),vm(t,o.id))}return r}function BL(e,t,n){const r=[];if(!k(e)||!k(t))return r;t.lookup=void 0,xr(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!k(a.id))continue;a.lx=a.x,a.ly=a.y;const c=wr(e,a),l=`${(c==null?void 0:c.code)??""}
${a.code??""}`;l&&r.push({id:a.id,type:bt.OBJECT,code:l,object:a,terrain:void 0})}const s=PL(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:bt.ERROR,code:"",object:void 0,terrain:void 0});return r}var J_={exports:{}},Bf={exports:{}},Z_;function DL(){return Z_||(Z_=1,function(e,t){(function(n,r){e.exports=r()})(wn,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(m){if(m)for(var x=0;x<u.length;x++)m[u[x]]!==void 0&&this["set"+r(u[x])](m[u[x]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",x=this.getLineNumber()||"",w=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+x+":"+w+")":"[eval]:"+x+":"+w:T?T+" ("+m+":"+x+":"+w+")":m+":"+x+":"+w}},h.fromString=function(x){var w=x.indexOf("("),T=x.lastIndexOf(")"),v=x.substring(0,w),I=x.substring(w+1,T).split(","),U=x.substring(T+1);if(U.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),L=R[1],B=R[2],O=R[3];return new h({functionName:v,args:I||void 0,fileName:L,lineNumber:B||void 0,columnNumber:O||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(m){return function(x){this[m]=!!x}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=i(o[f]),h.prototype["set"+r(o[f])]=function(m){return function(x){if(!n(x))throw new TypeError(m+" must be a Number");this[m]=Number(x)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(x){this[m]=String(x)}}(a[p]);return h})}(Bf)),Bf.exports}(function(e,t){(function(n,r){e.exports=r(DL())})(wn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var x=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:x,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(J_);var $L=J_.exports,jL=Es($L);function bi(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},listcommands(){return Gn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function be(e){return`${e??""}`}function _a(e,t){const n=parseFloat(be(e));return isNaN(n)?t:n}function Q_(e,t,n){var i;const[r]=rt(t,0,[H.MAYBE_NAME]);wE(G,e,((i=_.board)==null?void 0:i.id)??"",r??"",n)}function or(e,t,n,r){const[i,s]=rt(r,0,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);Cd(G,e,t,n,i,s)}const zL=["echo","reverb","phaser","distortion","vibrato","fc"];function tb(e,t,n){const[r,i]=rt(n,0,[H.NUMBER_OR_STRING]);if(Rt(r))tu(G,e,t,"volume",r);else if(zL.includes(Ct(r))){const[s,o]=rt(n,i,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);Cd(G,e,t,r,s,o)}else{const[s]=rt(n,i,[H.MAYBE_NUMBER_OR_STRING]);if(Rt(s)){const o=n.length-i,a=new Array(o).fill(H.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;tu(G,e,t,r,l)}else{const[o]=rt(n,i,[H.MAYBE_NUMBER_OR_STRING]);tu(G,e,t,r,o)}}}const Df=bi().command("talk",(e,t)=>{const[n]=rt(t,0,[H.ANY]);switch(Ct(n)){default:nE(G,_.elementfocus);break;case"stop":rE(G,_.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=rt(t,0,[H.ANY]);switch(Ct(n)){default:iE(G,_.elementfocus);break;case"stop":sE(G,_.elementfocus);break}return 0}).command("tts",(e,t)=>{const[n,r]=rt(t,0,[H.STRING]),i=t.slice(r).map(be).join("");return bE(G,_.elementfocus,n,i),0}).command("tta",(e,t)=>{const n=t.map(be).join("");return EE(G,_.elementfocus,n),0}).command("bpm",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return kE(G,_.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return TE(G,_.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return AE(G,_.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return vE(G,_.elementfocus,n),0}).command("play",(e,t)=>(Q_(_.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(Q_(_.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)tb(_.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)or(_.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)or(_.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)or(_.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)or(_.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)or(_.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)or(_.elementfocus,n,"vibrato",t);return 0});for(let e=0;e<8;++e)Df.command(`synth${e+1}`,(t,n)=>(tb(_.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Df.command(`echo${t}`,(n,r)=>(or(_.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(or(_.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(or(_.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(or(_.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(or(_.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(or(_.elementfocus,e,"vibrato",r),0))}function WL(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var KL=WL;const GL=KL,Zt=function(){};Zt.prototype.FMX=0,Zt.prototype.FMY=0,Zt.prototype.FMXxFMY=0,Zt.prototype.T=0,Zt.prototype.N=0,Zt.prototype.initiliazedField=!1,Zt.prototype.generationComplete=!1,Zt.prototype.wave=null,Zt.prototype.compatible=null,Zt.prototype.weightLogWeights=null,Zt.prototype.sumOfWeights=0,Zt.prototype.sumOfWeightLogWeights=0,Zt.prototype.startingEntropy=0,Zt.prototype.sumsOfOnes=null,Zt.prototype.sumsOfWeights=null,Zt.prototype.sumsOfWeightLogWeights=null,Zt.prototype.entropies=null,Zt.prototype.propagator=null,Zt.prototype.observed=null,Zt.prototype.distribution=null,Zt.prototype.stack=null,Zt.prototype.stackSize=0,Zt.prototype.DX=[-1,0,1,0],Zt.prototype.DY=[0,1,0,-1],Zt.prototype.opposite=[2,3,0,1],Zt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Zt.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=GL(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Zt.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],h=this.compatible[l];for(let d=0;d<u.length;d++){const f=u[d],p=h[f];p[i]--,p[i]==0&&this.ban(l,f)}}}},Zt.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},Zt.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},Zt.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},Zt.prototype.isGenerationComplete=function(){return this.generationComplete},Zt.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},Zt.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var eb=Zt;const nb=eb,Ei=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=n,d=new Array(h);for(let O=0;O<h;O++)d[O]=new Array(r);this.colors=[];const f={};for(let O=0;O<r;O++)for(let Y=0;Y<n;Y++){const et=(O*n+Y)*4,C=[t[et],t[et+1],t[et+2],t[et+3]],S=C.join("-");f.hasOwnProperty(S)||(f[S]=this.colors.length,this.colors.push(C)),d[Y][O]=f[S]}const p=this.colors.length,m=Math.pow(p,i*i),x=function(Y){let et=new Array(i*i);for(let C=0;C<i;C++)for(let S=0;S<i;S++)et[S+C*i]=Y(S,C);return et},w=function(Y,et){return x(function(C,S){return d[(Y+C)%n][(et+S)%r]})},T=function(Y){return x(function(et,C){return Y[i-1-C+et*i]})},v=function(Y){return x(function(et,C){return Y[i-1-et+C*i]})},I=function(Y){let et=0,C=1;for(let S=0;S<Y.length;S++)et+=Y[Y.length-1-S]*C,C*=p;return et},U=function(Y){let et=Y,C=m;const S=new Array(i*i);for(let b=0;b<S.length;b++){C/=p;let P=0;for(;et>=C;)et-=C,P++;S[b]=P}return S},R={},L=[];for(let O=0;O<(a?r:r-i+1);O++)for(let Y=0;Y<(a?n:n-i+1);Y++){const et=new Array(8);et[0]=w(Y,O),et[1]=v(et[0]),et[2]=T(et[0]),et[3]=v(et[2]),et[4]=T(et[2]),et[5]=v(et[4]),et[6]=T(et[4]),et[7]=v(et[6]);for(let C=0;C<l;C++){const S=I(et[C]);R[S]?R[S]++:(L.push(S),R[S]=1)}}this.T=L.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let O=0;O<this.T;O++){const Y=parseInt(L[O],10);this.patterns[O]=U(Y),this.weights[O]=R[Y]}const B=function(Y,et,C,S){const b=C<0?0:C,P=C<0?C+i:i,X=S<0?0:S,D=S<0?S+i:i;for(let ct=X;ct<D;ct++)for(let tt=b;tt<P;tt++)if(Y[tt+i*ct]!=et[tt-C+i*(ct-S)])return!1;return!0};this.propagator=new Array(4);for(let O=0;O<4;O++){this.propagator[O]=new Array(this.T);for(let Y=0;Y<this.T;Y++){const et=[];for(let C=0;C<this.T;C++)B(this.patterns[Y],this.patterns[C],this.DX[O],this.DY[O])&&et.push(C);this.propagator[O][Y]=et}}};Ei.prototype=Object.create(nb.prototype),Ei.prototype.constructor=Ei,Ei.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ei.prototype.clear=function(){if(nb.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ei.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ei.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ei.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let h=0;h<this.N;h++){let d=n-h;d<0&&(d+=this.FMX);let f=r-u;if(f<0&&(f+=this.FMY),this.onBoundary(d,f))continue;const p=d+f*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const x=this.colors[this.patterns[m][h+u*this.N]];s+=x[0],o+=x[1],a+=x[2],c+=x[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var HL=Ei;const YL=eb,Bi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(I){const U=new Array(o*o);for(let R=0;R<o;R++)for(let L=0;L<o;L++)U[L+R*o]=I(L,R);return U},u=function(I){return l(function(U,R){return I[o-1-R+U*o]})},h=function(I){return l(function(U,R){return I[o-1-U+R*o]})};this.tiles=[];const d=[],f=[],p={};let m,x,w;for(let v=0;v<t.tiles.length;v++){const I=t.tiles[v];if(c!==null&&c.indexOf(I.name)===-1)continue;switch(I.symmetry){case"L":w=4,m=function(R){return(R+1)%4},x=function(R){return R%2===0?R+1:R-1};break;case"T":w=4,m=function(R){return(R+1)%4},x=function(R){return R%2===0?R:4-R};break;case"I":w=2,m=function(R){return 1-R},x=function(R){return R};break;case"\\":w=2,m=function(R){return 1-R},x=function(R){return 1-R};break;case"F":w=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},x=function(R){return R<4?R+4:R-4};break;default:w=1,m=function(R){return R},x=function(R){return R};break}this.T=f.length,p[I.name]=this.T;for(let R=0;R<w;R++)f.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+x(R),this.T+x(m(R)),this.T+x(m(m(R))),this.T+x(m(m(m(R))))]);let U;if(a)for(let R=0;R<w;R++)U=I.bitmap[R],this.tiles.push(l(function(L,B){return[U[(o*B+L)*4],U[(o*B+L)*4+1],U[(o*B+L)*4+2],U[(o*B+L)*4+3]]}));else{U=I.bitmap,this.tiles.push(l(function(R,L){return[U[(o*L+R)*4],U[(o*L+R)*4+1],U[(o*L+R)*4+2],U[(o*L+R)*4+3]]}));for(let R=1;R<w;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):h(this.tiles[this.T+R-4]))}for(let R=0;R<w;R++)d.push(I.weight||1)}this.T=f.length,this.weights=d,this.propagator=new Array(4);const T=new Array(4);for(let v=0;v<4;v++){this.propagator[v]=new Array(this.T),T[v]=new Array(this.T);for(let I=0;I<this.T;I++){T[v][I]=new Array(this.T);for(let U=0;U<this.T;U++)T[v][I][U]=!1}}for(let v=0;v<t.neighbors.length;v++){const I=t.neighbors[v],U=I.left.split(" ").filter(function(et){return et.length}),R=I.right.split(" ").filter(function(et){return et.length});if(c!==null&&(c.indexOf(U[0])===-1||c.indexOf(R[0])===-1))continue;const L=f[p[U[0]]][U.length==1?0:parseInt(U[1],10)],B=f[L][1],O=f[p[R[0]]][R.length==1?0:parseInt(R[1],10)],Y=f[O][1];T[0][O][L]=!0,T[0][f[O][6]][f[L][6]]=!0,T[0][f[L][4]][f[O][4]]=!0,T[0][f[L][2]][f[O][2]]=!0,T[1][Y][B]=!0,T[1][f[B][6]][f[Y][6]]=!0,T[1][f[Y][4]][f[B][4]]=!0,T[1][f[B][2]][f[Y][2]]=!0}for(let v=0;v<this.T;v++)for(let I=0;I<this.T;I++)T[2][v][I]=T[0][I][v],T[3][v][I]=T[1][I][v];for(let v=0;v<4;v++)for(let I=0;I<this.T;I++){const U=[],R=T[v][I];for(let L=0;L<this.T;L++)R[L]&&U.push(L);this.propagator[v][I]=U}};Bi.prototype=Object.create(YL.prototype),Bi.prototype.constructor=Bi,Bi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Bi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Bi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Bi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let h=0,d=0,f=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const x=this.tiles[m][l+c*this.tilesize],w=this.weights[m]*a;h+=x[0]*w,d+=x[1]*w,f+=x[2]*w,p+=x[3]*w}e[u]=h,e[u+1]=d,e[u+2]=f,e[u+3]=p}}}};var VL=Bi,XL={OverlappingModel:HL,SimpleTiledModel:VL},qL=Es(XL);function rb(e){return`zss_snapshot_${e}`}function ib(e){const t=Gn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Fr(r)==="player"&&delete e[t[n]]}return e}function JL(e){const t=Gn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Fr(r)!=="player"&&delete e[t[n]]}return e}function ZL(e){const t=On(_.book,bt.BOARD,e),n=ln(t);if(!k(n))return;const r=rb(n.id);j_(_.book,r);const i=zi(Pt.CONTENT,r,bt.BOARD),s=ln(i);if(k(s))return s.terrain=Xe(n.terrain),s.objects=ib(Xe(n.objects)),s}function QL(e){const t=On(_.book,bt.BOARD,e),n=ln(t);if(!k(n))return;const r=rb(n.id),i=On(_.book,bt.BOARD,r),s=ln(i);k(s)&&(n.terrain=Xe(s.terrain),n.objects={...ib(Xe(s.objects)),...JL(Xe(n.objects))})}const sb=5;function $f(e,t,n=2,r=1,i={x:0,y:0},s={x:zt-1,y:ye-1}){const o=On(_.book,bt.BOARD,e),a=On(_.book,bt.BOARD,t),c=ln(o),l=ln(a);if(!k(c)||!k(l))return!1;xr(_.book,c),xr(_.book,l);let u=0;const h=new Map,d=new Map;let f=0;const p=32,m=new Uint8Array(Am*4);for(let O=0;O<ye;++O)for(let Y=0;Y<zt;++Y){const et=Tn(l,{x:Y,y:O}),C=(et==null?void 0:et.char)??0,S=(et==null?void 0:et.color)??p,b=(et==null?void 0:et.bg)??p;m[f++]=C,m[f++]=S,m[f++]=b;const P=wr(_.book,et),X=Ct((P==null?void 0:P.name)??"empty"),D=h.get(X);Rt(D)?m[f++]=D:(h.set(X,u),d.set(u,X),m[f++]=u++)}const x=Math.min(i.x,s.x),w=Math.min(i.y,s.y),T=Math.max(i.x,s.x),v=Math.max(i.y,s.y),I=T-x+1,U=v-w+1,R=new qL.OverlappingModel(m,zt,ye,n,I,U,!1,!1,r,0);let L=0;for(;L<sb&&!R.generate();++L);if(L===sb)return!1;f=0;const B=R.graphics();for(let O=w;O<=v;++O)for(let Y=x;Y<=T;++Y){const et=B[f++],C=B[f++],S=B[f++];u=B[f++];const b=Tn(c,{x:Y,y:O});Hr(_.book,c,b,_.timestamp),dr(c,{x:Y,y:O});const P=d.get(u)??"",X=oo(_.book,c,[P],{x:Y,y:O});if(k(X)&&(et>0&&(X.char=et),C<p&&(X.color=C),S<p&&(X.bg=S),Yo(X))){const D=Le(Xo(l,P));k(D)&&(dr(c,{...xc(l,D.x??0,D.y??0),x:Y,y:O}),X.p1=D.p1,X.p2=D.p2,X.p3=D.p3,X.code=D.code,X.cycle=D.cycle,X.light=D.light,X.stepx=D.stepx,X.stepy=D.stepy,X.pushable=D.pushable,X.collision=D.collision,X.destructible=D.destructible)}}return!0}const t6=jp(32,126).map(e=>String.fromCharCode(e)),e6=jn({name:"Whitespace",pattern:/ +/}),n6=jn({name:"WhitespaceSkipped",pattern:/ +/,group:He.SKIPPED}),jf=jn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),ob=jn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:t6}),zf=jn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Wf=jn({name:"EscapedDollar",pattern:"$$"}),Kf=jn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Gf=jn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),ab=jn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function r6(e,t=""){return jn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const cb=Object.keys(zo).map(e=>r6(`\\$(${e})`,e)),i6=[e6,jf,...cb,zf,ob,Gf,Wf,ab,Kf],s6=new He(i6,{skipValidations:!Gr,ensureOptimizations:Gr}),o6=new He([n6,jf,...cb,zf,ob,Gf,Wf,ab,Kf],{skipValidations:!Gr,ensureOptimizations:Gr});function Hf(e,t=!1){return t?o6.tokenize(e):s6.tokenize(e)}function Yf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function lb(e){e.active={...e.reset}}function ub(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Wf:s("$");break;case Gf:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case zf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case jf:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=zo[l],h=qk(Wt[u]),d=Jk(Wt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):k(h)?t.active.color=h:k(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(k(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){lb(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;c6(u,u+l.length,t.active.color,t.active.bg,t),a6(u,l,t)}}}function hb(e,t,n){const r=Hf(e);r.tokens&&(ub(r.tokens,t),n&&lb(t),t.changed())}function fb(e,t,n){const r=Hf(e);if(!r.tokens)return;const i=Yf(t,n,Wt.WHITE,Wt.BLACK);return i.measureonly=!0,ub(r.tokens,i),i.x>0&&++i.y,i}function a6(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function c6(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function db(e,t,n){if(!Gs(_.element))return 0;const[r,i]=rt(t,0,[H.DIR,H.MAYBE_KIND]),s=i??["bullet"],o=UL(_.book,_.board,s,{x:_.element.x,y:_.element.y});if(k(o)){k(n)&&(o.arg=n),o.party=_.elementid,o.collision=Ht.ISBULLET,o.destructible=1,o.stepx=r.x-_.element.x,o.stepy=r.y-_.element.y,o.bg=Wt.ONCLEAR;const a=wr(_.book,o),c=o.code??(a==null?void 0:a.code)??"";qb(_.book,_.board,o,c,1)}return e.yield(),0}function xl(e,t,n,r){var h,d;if(!Gs(_.element)||!k(_.book)||!k(_.board)||!k(_.element))return 0;xr(_.book,_.board);const[i,s]=rt(t,0,[H.DIR,H.KIND]),o=Tn(_.board,i);if((o==null?void 0:o.category)===Hn.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((h=_.element)==null?void 0:h.x)??0,y:((d=_.element)==null?void 0:d.y)??0},p=Pe(i,oi(f,i));q_(_.book,_.board,o,p)}const[a]=s,c=ya(_.book,a)??Mf(_.book,a),l=(c==null?void 0:c.collision)??Ht.ISWALK;if(!Pf(_.book,_.board,l,i)){const f=oo(_.book,_.board,s,i,n);k(f)&&k(r)&&(f.arg=r)}return 0}const l6=bi().command("remix",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r,i]=rt(t,0,[H.NAME,H.MAYBE_NUMBER,H.MAYBE_NUMBER]),s=Er(_.book,bt.BOARD,n),o=Le(...s);return k(o)&&$f(_.board.id,o.id,r,i),0}).command("remixonly",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r,i,s,o,a,c]=rt(t,0,[H.NAME,H.NUMBER,H.NUMBER,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER,H.MAYBE_NUMBER]),l=Er(_.book,bt.BOARD,n),u=Le(...l);return k(u)&&$f(_.board.id,u.id,a,c,{x:r,y:i},{x:s,y:o}),0}).command("board",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;const[n,r]=rt(t,0,[H.NAME]);switch(Ct(n)){case"snapshot":ZL(_.board.id);break;case"restart":QL(_.board.id);break;default:{const[i,s]=rt(t,r,[H.MAYBE_NUMBER,H.MAYBE_NUMBER]),o=Er(_.book,bt.BOARD,n);if(o.length){const a=Le(...o);k(a)&&so(_.book,_.elementfocus,a.id,{x:i??Math.round(zt*.5),y:s??Math.round(ye*.5)})}break}}return 0}).command("edge",(e,t)=>{var s,o;if(!k(_.book)||!k(_.board)||!k(_.element))return 0;const[n,r]=rt(t,0,[H.DIR,H.NAME]),i=Er(_.book,bt.BOARD,r);if(i.length){const a={x:((s=_.element)==null?void 0:s.x)??0,y:((o=_.element)==null?void 0:o.y)??0},c=oi(a,n),l=Le(...i);switch(c){case mt.NORTH:_.board.exitnorth=l.id;break;case mt.SOUTH:_.board.exitsouth=l.id;break;case mt.WEST:_.board.exitwest=l.id;break;case mt.EAST:_.board.exiteast=l.id;break}}return 0}).command("shove",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;xr(_.book,_.board);const[n,r]=rt(t,0,[H.DIR,H.DIR]),i=Tn(_.board,n);return Yo(i)&&ud(_.book,_.board,i,r),0}).command("duplicate",()=>(!k(_.book)||!k(_.board),0)).command("replace",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;xr(_.book,_.board);const[n,r]=rt(t,0,[H.DIR,H.KIND]),i=Tn(_.board,n);return Yo(i)&&Hr(_.book,_.board,i,_.timestamp),oo(_.book,_.board,r,n),0}).command("write",(e,t)=>{var l;if(!k(_.book)||!k(_.board))return 0;xr(_.book,_.board);const[n,r,i]=rt(t,0,[H.DIR,H.COLOR,H.STRING]),{color:s,bg:o}=Xp(r),a=((l=fb(i,256,1))==null?void 0:l.measuredwidth)??1,c=Yf(256,1,s??Wt.WHITE,o??Wt.BLACK);hb(i,c,!1);for(let u=0;u<a;++u)dr(_.board,{x:n.x+u,y:n.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(e,t)=>{if(!k(_.book)||!k(_.board))return 0;xr(_.book,_.board);const[n,r]=rt(t,0,[H.KIND,H.KIND]);(ch(n)??"")==="empty"&&CT(_.board).forEach(c=>{oo(_.book,_.board,r,c)});const s=ch(r),o=Jp(r),a=Zp(r);return Sm(_.board,n).forEach(c=>{if(Fr(c)===s)k(o)&&(c.color=o),k(a)&&(c.bg=a);else if(Hr(_.book,_.board,c,_.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};oo(_.book,_.board,r,l)}}),0}).command("putwith",(e,t)=>{const[n,r]=rt(t,0,[H.ANY]);return xl(e,t.slice(r),void 0,n)}).command("put",(e,t)=>xl(e,t)).command("oneof",(e,t)=>{const[n,r]=rt(t,0,[H.ANY]);return k(_.board)&&pn(_.board,n)?0:xl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=rt(t,0,[H.ANY,H.ANY]);return k(_.board)&&pn(_.board,r)?0:xl(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=rt(t,0,[H.ANY]);return db(e,t.slice(r),n)}).command("shoot",db),Di="$dkpurple",u6="$196",h6="$205";function $t(e,t,n){Zr(e,t,n)}function f6(e,t,n){const r=u6.repeat(n);$t(e,t,`${Di}${r}`)}function Vf(e,t,n){const r=h6.repeat(n);$t(e,t,`${Di}${r}`)}function ds(e,t,n){$t(e,t,`${Di} ${" ".repeat(n.length)} `),f6(e,t,n.length+2),$t(e,t,`${Di} $white${n} `),Vf(e,t,n.length+2)}function wi(e,t,n){$t(e,t,`${Di} ${" ".repeat(n.length)} `),$t(e,t,`${Di} $gray${n} `),Vf(e,t,n.length+2)}function ee(e,t,n,r){$t(e,t,`${Di} $white${n} $blue${r}`)}function De(e,t,n){$t(e,t,`${Di}$blue${n}`)}function pb(e){const[t,n]=e.split(":"),r=k(n);return[r?t:"self",r?n:e]}const d6=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function ao(){Ud(G,Xr())}const p6=bi().command("send",(e,t)=>{const[n,r]=rt(t,0,[H.NAME,H.ANY]);switch(Ct(n)){case"helpmenu":ds(G,_.elementfocus,"H E L P"),$t(G,_.elementfocus,""),ee(G,_.elementfocus,"#help controls","zss controls and inputs"),$t(G,_.elementfocus,"!helpcontrols;read help controls"),$t(G,_.elementfocus,""),ee(G,_.elementfocus,"#help text","text formatting"),$t(G,_.elementfocus,"!helptext;read help text"),$t(G,_.elementfocus,""),ee(G,_.elementfocus,"#help developer","developer commands"),$t(G,_.elementfocus,"!helpdeveloper;read help developer"),$t(G,_.elementfocus,""),ee(G,_.elementfocus,"#help player","player settings"),$t(G,_.elementfocus,"!helpplayer;read help player"),wi(G,_.elementfocus,"keyboard input"),ee(G,_.elementfocus,"?","open console"),ee(G,_.elementfocus,"esc","close console"),ee(G,_.elementfocus,"tab","move console"),ee(G,_.elementfocus,"up / down arrow keys","navigate console items"),ee(G,_.elementfocus,"left / right arrow keys","change console items"),ee(G,_.elementfocus,"enter","interact with console items"),ee(G,_.elementfocus,"alt + arrow keys","skip words and console lines"),ee(G,_.elementfocus,`${d6} + up / down arrow keys`,"input history");break;case"helpcontrols":ds(G,_.elementfocus,"zss controls and inputs"),wi(G,_.elementfocus,"keyboard input"),ee(G,_.elementfocus,"arrow keys","move"),ee(G,_.elementfocus,"shift + arrow keys","shoot"),ee(G,_.elementfocus,"enter","ok / accept"),ee(G,_.elementfocus,"escape","cancel / close"),ee(G,_.elementfocus,"tab","menu / action"),wi(G,_.elementfocus,"controller input"),ee(G,_.elementfocus,"left stick","move"),ee(G,_.elementfocus,"right stick","aim"),ee(G,_.elementfocus,"a","ok / accept"),ee(G,_.elementfocus,"b","cancel / close"),ee(G,_.elementfocus,"y","menu / action"),ee(G,_.elementfocus,"x","shoot"),ee(G,_.elementfocus,"triggers","shoot");break;case"helptext":break;case"helpdeveloper":ds(G,_.elementfocus,"developer commands"),ee(G,_.elementfocus,"#books","list books in memory"),ee(G,_.elementfocus,"#pages","list pages in opened book"),ee(G,_.elementfocus,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ee(G,_.elementfocus,"#trash","list books and pages from open book you can delete"),ee(G,_.elementfocus,"#save","flush state to register"),ee(G,_.elementfocus,"#share","creates a click to copy share url and QR code");break;case"helpplayer":ds(G,_.elementfocus,"player settings"),De(G,_.elementfocus,"todo");break;default:{const[i,s]=pb(n);hd(i==="self"&&_.elementisplayer?`${_.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(be),s=i.join(" ");switch(Ct(r)){case zn(wt.LOADER):n=zi(Pt.CONTENT,s,bt.LOADER);break;default:n=zi(Pt.CONTENT,[r,...i].join(" "),bt.OBJECT);break;case zn(wt.BOARD):n=zi(Pt.CONTENT,s,bt.BOARD);break;case zn(wt.OBJECT):n=zi(Pt.CONTENT,s,bt.OBJECT);break;case zn(wt.TERRAIN):n=zi(Pt.CONTENT,s,bt.TERRAIN);break;case zn(wt.CHARSET):n=zi(Pt.CONTENT,s,bt.CHARSET);break;case zn(wt.PALETTE):n=zi(Pt.CONTENT,s,bt.PALETTE);break}return k(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(be).join(" ");return k(_.element)&&(_.element.tickertext=n,_.element.tickertime=_.timestamp),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n),s=r.map(be).join(" ");return Zr(G,_.elementfocus,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=rt(t,0,[H.MAYBE_NAME]),r=Yb(n);return k(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=kr(n);return k(r)?(De(G,_.elementfocus,`opened [book] ${r.name}`),Ul(Pt.MAIN,r.id),e.command("pages")):ge(G,_.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=le(Pt.MAIN),i=kr(n);return k(i)&&(r===i&&Ul(Pt.MAIN,""),ZM(n),De(G,_.elementfocus,`trashed [book] ${i.name}`),ao(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=Er(_.book,bt.BOARD,n);if(r.length){const i=Le(...r);k(i)&&so(_.book,_.elementfocus,i.id,{x:Jn(0,zt-1),y:Jn(0,ye-1)})}return 0}).command("pageopenwith",(e,t)=>{const[n,r,i]=rt(t,0,[H.NAME,H.MAYBE_NAME,H.MAYBE_NAME]);return e.command("pageopen",r,i,n)}).command("pageopen",(e,t)=>{const[n,r,i]=rt(t,0,[H.NAME,H.MAYBE_NAME,H.MAYBE_NAME]),s=bn(Pt.MAIN);if(!k(s))return 0;const o=yi(s,n);if(k(o)){const a=Ue(o),c=gi(o);De(G,_.elementfocus,`opened [${c}] ${a}`);const l=[],u=yi(s,i??""),h=k(u)?Rf(u.code):void 0;if(k(h))for(let p=0;p<h.tokens.length;++p){const m=h.tokens[p];m.tokenType===_f&&l.push(m.image.startsWith('"')?m.image.slice(1):m.image)}const d=[o.id,r];qu(Ca(s.id,d),o.code);const f=gi(o);Ld(G,_.elementfocus,s.id,d,f,`${a} - ${s.name}`,l)}else ge(G,"pageopen",`page ${n} not found`,_.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=bn(Pt.MAIN),i=j_(r,n);if(k(n)){const s=Ue(i),o=gi(i);De(G,_.elementfocus,`trashed [${o}] ${s}`),ao(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(be).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{wi(G,_.elementfocus,"books");const e=le(Pt.MAIN);ee(G,_.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=le(Pt.CONTENT);ee(G,_.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Vf(G,_.elementfocus,7);const n=go();return n.length?n.forEach(r=>{$t(G,_.elementfocus,`!bookopen ${r.id};${r.name}`)}):De(G,_.elementfocus,"no books found"),$t(G,_.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=bn(Pt.MAIN);return k(e)&&(wi(G,_.elementfocus,"pages"),ee(G,_.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?El(e).forEach(n=>{const r=Ue(n),i=gi(n);$t(G,_.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):($t(G,_.elementfocus,""),De(G,_.elementfocus,"$white no pages found"),De(G,_.elementfocus,"$white use @ to create a page"),De(G,_.elementfocus,"$white @board name of board"),De(G,_.elementfocus,"$white @object name of object"),De(G,_.elementfocus,"$white @terrain name of terrain"),De(G,_.elementfocus,"$white You can omit the type and it will default to object"),De(G,_.elementfocus,"$white @object name of object"),De(G,_.elementfocus,"$white @name of object"))),0}).command("boards",()=>{wi(G,_.elementfocus,"boards");const e=bn(Pt.MAIN);if(k(e)){ee(G,_.elementfocus,"main",`${e.name} $GREEN${e.id}`);const t=El(e);t.filter(n=>mi(n)===bt.BOARD).forEach(n=>{const r=Ue(n),i=gi(n);$t(G,_.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),t.length===0&&($t(G,_.elementfocus,""),De(G,_.elementfocus,"$white no boards found"),De(G,_.elementfocus,"$white use @ to create a board"),De(G,_.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{wi(G,_.elementfocus,"$REDTRASH"),De(G,_.elementfocus,"books");const e=go();e.length&&(e.forEach(n=>{$t(G,_.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),$t(G,_.elementfocus,""));const t=le(Pt.MAIN);return k(t)&&(De(G,_.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Ue(n);$t(G,_.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),$t(G,_.elementfocus,"")),0}).command("dev",()=>(ao(),gE(G,_.elementfocus),0)).command("share",()=>(ao(),yE(G,_.elementfocus),0)).command("save",()=>(ao(),0)).command("fork",()=>(OE(G,_.elementfocus),0)).command("nuke",()=>(_E(G,_.elementfocus),0)).command("restart",()=>(NE(G,_.elementfocus),ao(),0)).command("export",()=>{ds(G,_.elementfocus,"E X P O R T"),wi(G,_.elementfocus,"books");const e=go();return e.length&&e.forEach(t=>$t(G,_.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=kr(n);return k(r)&&(ds(G,_.elementfocus,"E X P O R T"),wi(G,_.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=El(r);$t(G,_.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ue(s),a=gi(s);$t(G,_.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=kr(n);return k(r)&&Od(G,_.elementfocus,Xe(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=rt(t,0,[H.NAME]),{target:r,path:i}=lr(n),s=kr(r),o=yi(s,i);return k(o)&&Od(G,_.elementfocus,Xe(o),`${Ue(o)}.${gi(o)}.json`),0}).command("gadget",()=>(SE(G,_.elementfocus),0)).command("joincode",(e,t)=>{const[n]=rt(t,0,[H.MAYBE_NAME]);return oE(G,_.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=rt(t,0,[H.MAYBE_NAME]);return aE(G,_.elementfocus,!!n),0}),m6=bi().command("toast",(e,t)=>{const n=t.map(be).join("");return q1(G,_.elementfocus,n),0}).command("palette",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=Vb(),i=On(_.book,bt.PALETTE,n);return k(i)?(r.palette=i.id,$t(G,_.elementfocus,`loaded palette ${n}`)):ge(G,_.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=Vb(),i=On(_.book,bt.CHARSET,n);return k(i)?(r.charset=i.id,$t(G,_.elementfocus,`loaded charset ${n}`)):ge(G,_.elementfocus,"not-found",`unabled to find charset ${n}`),0}),Xf={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function ba(e){return oe(e)&&mb(e[0])}function mb(e){return k(Hn[e])&&At(e)}function gb(e){if(At(e))return Xf[Ct(e)]}function yb(e){if(ba(e))return e;if(mb(e))return[e];const t=gb(e);if(k(t))return[t]}function g6(e){const t=_.words[e],n=yb(t);if(ba(n))return[n,e+1];const[r,i]=Ln(e),s=yb(r);return ba(s)?[s,i]:[void 0,e]}const qf={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Ht.ISSOLID,Ht.ISWALK,Ht.ISSWIM,Ht.ISBULLET,Ht.ISWALK,Ht.ISSWIM;function kl(e){return oe(e)&&Jf(e[0])}function Jf(e){return k(Ht[e])&&At(e)}function y6(e){if(At(e))return qf[Ct(e)]}function _6(e){const t=_.words[e];if(kl(t))return[t,e+1];if(Jf(t))return[[t],e+1];const[n,r]=Ln(e);return kl(n)?[n,r]:Jf(n)?[[n],r]:[void 0,e]}const b6=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),_b=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),E6=["NORTH","SOUTH","WEST","EAST"];function w6(e){const t=gs(e);if(Rt(t.inputcurrent)||(t.inputcurrent=0),oe(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=mn.NONE,i=0]=n??[mn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&jT?1:0,t.inputctrl=i&zT?1:0,t.inputshift=i&WT?1:0,r){case mn.MOVE_UP:case mn.MOVE_DOWN:case mn.MOVE_LEFT:case mn.MOVE_RIGHT:t.inputmove=[E6[r-mn.MOVE_UP]];break;case mn.OK_BUTTON:t.inputok=1;break;case mn.CANCEL_BUTTON:t.inputcancel=1;break;case mn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==mn.NONE&&o!==r}),t}function x6(e){const t=Xf[e];if(k(t))return t;const n=qf[e];if(k(n))return n;const r=zo[e];if(k(r))return r;const i=ih[e];if(k(i))return i}const k6=bi({get(e,t){var o,a,c,l,u,h,d,f,p,m,x,w,T,v,I,U,R,L;const n=x6(t);if(k(n))return[!0,n];if(_.elementisplayer&&b6.has(t)){const B=w6(_.elementid)[t];return[k(B),B]}const r=Vo(_.board,_.element,_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus;switch(t){case"isdark":return[!0,(o=_.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=_.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=_.board)==null?void 0:c.starty)??0];case"over":return[!0,((l=_.board)==null?void 0:l.over)??""];case"under":return[!0,((u=_.board)==null?void 0:u.under)??""];case"camera":return[!0,((h=_.board)==null?void 0:h.camera)??""];case"exitnorth":return[!0,((d=_.board)==null?void 0:d.exitnorth)??""];case"exitsouth":return[!0,((f=_.board)==null?void 0:f.exitsouth)??""];case"exitwest":return[!0,((p=_.board)==null?void 0:p.exitwest)??""];case"exiteast":return[!0,((m=_.board)==null?void 0:m.exiteast)??""];case"timelimit":return[!0,((x=_.board)==null?void 0:x.timelimit)??0];case"restartonzap":return[!0,((w=_.board)==null?void 0:w.restartonzap)??0];case"maxplayershots":return[!0,((T=_.board)==null?void 0:T.maxplayershots)??0];case"boardid":return[!0,((v=_.board)==null?void 0:v.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((I=_.element)==null?void 0:I.id)??""];case"thisx":return[!0,((U=_.element)==null?void 0:U.x)??-1];case"thisy":return[!0,((R=_.element)==null?void 0:R.y)??-1];default:{const B=(L=_.element)==null?void 0:L[t];if(_b.has(t))return[!0,B];break}}const s=gs(i)[t];return[k(s),s]},set(e,t,n){const r=Vo(_.board,_.element,_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus;switch(t){case"isdark":k(_.board)&&(_.board.isdark=n?1:0);break;case"startx":k(_.board)&&(_.board.startx=_a(n,0));break;case"starty":k(_.board)&&(_.board.starty=_a(n,0));break;case"over":k(_.board)&&(_.board.over=be(n));break;case"under":k(_.board)&&(_.board.under=be(n));break;case"camera":k(_.board)&&(_.board.camera=be(n));break;case"exitnorth":k(_.board)&&(_.board.exitnorth=be(n));break;case"exitsouth":k(_.board)&&(_.board.exitsouth=be(n));break;case"exitwest":k(_.board)&&(_.board.exitwest=be(n));break;case"exiteast":k(_.board)&&(_.board.exiteast=be(n));break;case"timelimit":k(_.board)&&(_.board.timelimit=_a(n,0));break;case"restartonzap":k(_.board)&&(_.board.restartonzap=n?1:0);break;case"maxplayershots":k(_.board)&&(_.board.maxplayershots=_a(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(_b.has(t))return k(_.element)&&(_.element[t]=n),[!0,n];break}}const s=gs(i);return k(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=_.element)!=null&&e.removed)&&(k((t=_.element)==null?void 0:t.stepx)||k((n=_.element)==null?void 0:n.stepy))){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};ud(_.book,_.board,_.element,{x:s.x+(_.element.stepx??0),y:s.y+(_.element.stepy??0)})===!1&&(_.element.stepx=0,_.element.stepy=0,ro(_.book,_.element,"destructible")&&Hr(_.book,_.board,_.element,_.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(be(n),0)),0)).command("set",(e,t)=>{const[n,r]=rt(t,0,[H.NAME,H.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=rt(t,0,[H.KIND]);if(xr(_.book,_.board),Ff(_.book,_.board,_.element),Hr(_.book,_.board,_.element,_.timestamp)){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};oo(_.book,_.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return k(_.element)&&(_.element.char=n),0}).command("color",(e,t)=>{const[n]=rt(t,0,[H.COLOR]);return k(_.element)&&k(n)&&wc(_.element,n),0}).command("go",(e,t)=>{if(k(_.element)){const[n]=rt(t,0,[H.DIR]);if(ud(_.book,_.board,_.element,n),e.yield(),_.element.x===n.x&&_.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!k(_.element))return 0;const[n]=rt(t,0,[H.DIR]),r=_.element.x??0,i=_.element.y??0;return _.element.stepx=n.x-r,_.element.stepy=n.y-i,0}),T6=bi().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=rt(t,0,[H.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(be(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(be(t[0])),0)).command("cycle",(e,t)=>{if(k(_.element)){const[n]=rt(t,0,[H.NUMBER]);_.element.cycle=nn(Math.round(n),1,255)}return 0}).command("die",e=>(Hr(_.book,_.board,_.element,_.timestamp),e.endofprogram(),0)).command("endgame",()=>(Md(G,_.elementfocus),0)).command("run",(e,t)=>{const[n]=rt(t,0,[H.NAME]);return Fl(n),0}).command("runwith",(e,t)=>{const[n,r]=rt(t,0,[H.ANY,H.NAME]);return e.set("arg",n),Fl(r),0}),Tl={};function A6(e){var t;return(t=Tl[e])==null?void 0:t.arg}function v6(e){var t;return(t=Tl[e])==null?void 0:t.format}function co(e){var t;return(t=Tl[e])==null?void 0:t.content}function S6(e,t,n,r,i){const s=le(Pt.MAIN);if(!k(s))return;const o=hs(s,bt.LOADER).filter(a=>{const c=us(a),l=c.format,u=At(l)?new RegExp(l).test(t):!1,h=c.event,d=At(h)?new RegExp(h).test(n):!1;return At(l)&&At(h)?u&&d:At(l)?u:At(h)?d:!1});for(let a=0;a<o.length;++a){const c=`${Oe()}_loader`;Tl[c]={arg:e,format:t,content:r,player:i},r8(c,o[a].code)}}function bb(e,t){if(!k(e))return;const n=Ct(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const R6=(e,t)=>{const n=co(e.id());if(!k(n))return 0;const[r,i]=rt(t,0,[H.NAME]),s=Ct(r);switch(s){case"seek":{const[o]=rt(t,i,[H.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(t,i,[H.NAME]);e.set(o,bb(n,s));break}case"text":{const[o,a]=rt(t,i,[H.NAME,H.NAME]),c=bb(n,o);if(Rt(c)&&At(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(l);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=rt(t,i,[H.NAME]),a=Lf(_.book,bt.PALETTE,o),c=ln(a);if(k(c)){const l=MT*Tc,u=Cm(new Uint8Array(n.bytes.buffer,n.cursor,l));k(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(t,i,[H.NAME]),a=Lf(_.book,bt.CHARSET,o),c=ln(a);if(k(c)){const l=Sc*LT*Eh,u=Lm(new Uint8Array(n.bytes.buffer,n.cursor,l));k(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},lo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Al=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Al(e[n],t[n]))return!1;return!0}if(lo(e)&&lo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Al(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},vl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(lo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},I6=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Eb=e=>e>="0"&&e<="9"||e==="-",N6=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var q;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(q||(q={}));const wb={"(":q.TOK_LPAREN,")":q.TOK_RPAREN,"*":q.TOK_STAR,",":q.TOK_COMMA,".":q.TOK_DOT,":":q.TOK_COLON,"@":q.TOK_CURRENT,$:q.TOK_ROOT,"]":q.TOK_RBRACKET,"{":q.TOK_LBRACE,"}":q.TOK_RBRACE},O6={"!":!0,"<":!0,"=":!0,">":!0},C6={"	":!0,"\n":!0,"\r":!0," ":!0};class L6{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(I6(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:q.TOK_UNQUOTEDIDENTIFIER,value:i});else if(wb[t[this._current]]!==void 0)n.push({start:this._current,type:wb[t[this._current]],value:t[this._current]}),this._current+=1;else if(Eb(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:q.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:q.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:q.TOK_LITERAL,value:o})}else if(O6[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(C6[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:q.TOK_AND,value:"&&"})):n.push({start:r,type:q.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:q.TOK_OR,value:"||"})):n.push({start:r,type:q.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&N6(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Eb(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:q.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:q.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:q.TOK_FLATTEN,value:"[]"}):{start:n,type:q.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_NE,value:"!="}):{start:n,type:q.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_LTE,value:"<="}):{start:n,type:q.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_GTE,value:">="}):{start:n,type:q.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:q.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const M6=new L6,un={[q.TOK_EOF]:0,[q.TOK_UNQUOTEDIDENTIFIER]:0,[q.TOK_QUOTEDIDENTIFIER]:0,[q.TOK_RBRACKET]:0,[q.TOK_RPAREN]:0,[q.TOK_COMMA]:0,[q.TOK_RBRACE]:0,[q.TOK_NUMBER]:0,[q.TOK_CURRENT]:0,[q.TOK_EXPREF]:0,[q.TOK_ROOT]:0,[q.TOK_PIPE]:1,[q.TOK_OR]:2,[q.TOK_AND]:3,[q.TOK_EQ]:5,[q.TOK_GT]:5,[q.TOK_LT]:5,[q.TOK_GTE]:5,[q.TOK_LTE]:5,[q.TOK_NE]:5,[q.TOK_FLATTEN]:9,[q.TOK_STAR]:20,[q.TOK_FILTER]:21,[q.TOK_DOT]:40,[q.TOK_NOT]:45,[q.TOK_LBRACE]:50,[q.TOK_LBRACKET]:55,[q.TOK_LPAREN]:60};class U6{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==q.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...M6.tokenize(t),{type:q.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<un[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case q.TOK_LITERAL:return{type:"Literal",value:t.value};case q.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case q.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===q.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case q.TOK_NOT:return r=this.expression(un.Not),{type:"NotExpression",children:[r]};case q.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===q.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(un.Star),{type:"ValueProjection",children:[n,r]};case q.TOK_FILTER:return this.led(t.type,{type:"Identity"});case q.TOK_LBRACE:return this.parseMultiselectHash();case q.TOK_FLATTEN:return n={type:q.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(un.Flatten),{type:"Projection",children:[n,r]};case q.TOK_LBRACKET:return this.lookahead(0)===q.TOK_NUMBER||this.lookahead(0)===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===q.TOK_STAR&&this.lookahead(1)===q.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(un.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case q.TOK_CURRENT:return{type:q.TOK_CURRENT};case q.TOK_ROOT:return{type:q.TOK_ROOT};case q.TOK_EXPREF:return i=this.expression(un.Expref),{type:"ExpressionReference",children:[i]};case q.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(i={type:q.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(q.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case q.TOK_DOT:const i=un.Dot;return this.lookahead(0)!==q.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case q.TOK_PIPE:return r=this.expression(un.Pipe),{type:q.TOK_PIPE,children:[n,r]};case q.TOK_OR:return r=this.expression(un.Or),{type:"OrExpression",children:[n,r]};case q.TOK_AND:return r=this.expression(un.And),{type:"AndExpression",children:[n,r]};case q.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(a={type:q.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===q.TOK_COMMA&&this.match(q.TOK_COMMA),o.push(a);return this.match(q.TOK_RPAREN),{name:s,type:"Function",children:o};case q.TOK_FILTER:const l=this.expression(0);return this.match(q.TOK_RBRACKET),r=this.lookahead(0)===q.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(un.Filter),{type:"FilterProjection",children:[n,r,l]};case q.TOK_FLATTEN:const u={type:q.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(un.Flatten);return{type:"Projection",children:[u,h]};case q.TOK_EQ:case q.TOK_NE:case q.TOK_GT:case q.TOK_GTE:case q.TOK_LT:case q.TOK_LTE:return this.parseComparator(n,t);case q.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===q.TOK_NUMBER||d.type===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(q.TOK_STAR),this.match(q.TOK_RBRACKET),r=this.parseProjectionRHS(un.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===q.TOK_COLON||this.lookahead(1)===q.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(q.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(un.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==q.TOK_RBRACKET&&n<3;){if(r===q.TOK_COLON)n+=1,this.advance();else if(r===q.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(q.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(un[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER,q.TOK_STAR].includes(n))return this.expression(t);if(n===q.TOK_LBRACKET)return this.match(q.TOK_LBRACKET),this.parseMultiselectList();if(n===q.TOK_LBRACE)return this.match(q.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(un[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===q.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===q.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===q.TOK_DOT)return this.match(q.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==q.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===q.TOK_COMMA&&(this.match(q.TOK_COMMA),this.lookahead(0)===q.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(q.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(q.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===q.TOK_COMMA)this.match(q.TOK_COMMA);else if(this.lookahead(0)===q.TOK_RBRACE){this.match(q.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const F6=new U6;var ut;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class P6{constructor(t){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>lo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(m=>{var x;return(x=!m.optional)!==null&&x!==void 0?x:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let d,f,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,f=this.getTypeName(n[m]);let x;for(x=0;x<d.length;x+=1)if(f!==void 0&&this.typeMatches(f,d[x],n[m])){p=!0;break}if(!p&&f!==void 0){const w=d.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${m+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(t,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return t===ut.TYPE_ARRAY;if(t===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return t.jmespathType===q.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class B6{constructor(){this._rootValue=null,this.runtime=new P6(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,h,d,f;switch(t.type){case"Field":return n===null?null:lo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...t.children],x=this.computeSliceParams(n.length,m),[w,T,v]=x;if(s=[],v>0)for(d=w;d<T;d+=v)s.push(n[d]);else for(d=w;d>T;d+=v)s.push(n[d]);return s;case"Projection":if(f=this.visit(t.children[0],n),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(t.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(t.children[0],n),!lo(f))return null;h=[];const I=Object.values(f);for(d=0;d<I.length;d+=1)i=this.visit(t.children[1],I[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(t.children[0],n),!Array.isArray(f))return null;const U=[],R=[];for(d=0;d<f.length;d+=1)r=this.visit(t.children[2],f[d]),vl(r)||U.push(f[d]);for(let C=0;C<U.length;C+=1)i=this.visit(t.children[1],U[C]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case q.TOK_EQ:s=Al(o,a);break;case q.TOK_NE:s=!Al(o,a);break;case q.TOK_GT:s=o>a;break;case q.TOK_GTE:s=o>=a;break;case q.TOK_LT:s=o<a;break;case q.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case q.TOK_FLATTEN:const L=this.visit(t.children[0],n);if(!Array.isArray(L))return null;let B=[];for(d=0;d<L.length;d+=1)i=L[d],Array.isArray(i)?B=[...B,...i]:B.push(i);return B;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],d=0;d<t.children.length;d+=1)h.push(this.visit(t.children[d],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let O;for(d=0;d<t.children.length;d+=1)O=t.children[d],h[O.name]=this.visit(O.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),vl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),vl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),vl(o);case"Literal":return t.value;case q.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case q.TOK_CURRENT:return n;case q.TOK_ROOT:return this._rootValue;case"Function":const Y=[];for(let C=0;C<t.children.length;C+=1)Y.push(this.visit(t.children[C],n));return this.runtime.callFunction(t.name,Y);case"ExpressionReference":const et=t.children[0];return et.jmespathType=q.TOK_EXPREF,et;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const D6=new B6;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function $6(e,t){const n=F6.parse(t);return D6.search(n,e)}const j6=(e,t)=>{const n=co(e.id());if(!k(n))return 0;const[r,i]=rt(t,0,[H.NAME,H.NAME]),s=$6(n.json,r);return e.set(i,s),0},z6=(e,t)=>{const n=co(e.id());if(!k(n))return 0;const[r,i]=rt(t,0,[H.NAME]);switch(Ct(r)){case"seek":{const[o]=rt(t,i,[H.NUMBER]);n.cursor=nn(o,0,n.lines.length-1);break}case"line":n.cursor=nn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[h,d]=rt(t,u,[H.NAME]);e.set(h,c[l]??0),++l,u=d}break}}return 0},W6=bi({get(e,t){const n=v6(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=co(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=co(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=co(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=rt(t,0,[H.NAME,H.ANY]);return hd(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(be).join(" ");return Zr(G,_.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n),s=r.map(be).join(" ");return Zr(G,_.elementfocus,"$175",`!${s};${i}`),0}).command("readline",z6).command("readjson",j6).command("readbin",R6).command("with",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=Er(_.book,bt.BOARD,n);if(r.length){const i=Le(...r);k(i)&&(_.board=ln(i),_.element={x:Jn(0,zt-1),y:Jn(0,ye-1)})}return 0});function xb(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[H.ANY]);oe(c)&&!ts(c)&&!ba(c)&&!kl(c)&&!Mr(c)?o.push(...c):o.push(c),a=l}switch(Ct(r)){case"get":case"post:json":eE(G,_.elementfocus,e,t,n,r,o);break}return 0}const K6=bi().command("fetch",(e,t)=>{const[n,r,i="get",s]=rt(t,0,[H.NAME,H.NAME,H.MAYBE_STRING]);return xb(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=rt(t,0,[H.ANY,H.NAME,H.NAME,H.MAYBE_STRING]);return xb(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=rt(t,0,[H.ANY]);switch(Ct(n)){default:Q1(G,_.elementfocus,n);break;case"stop":tE(G,_.elementfocus);break}return 0}).command("twitchbroadcast",(e,t)=>{const[n]=rt(t,0,[H.NAME]);switch(Ct(n)){default:J1(G,_.elementfocus,n);break;case"stop":Z1(G,_.elementfocus);break}return 0}),G6=bi({set(e,t,n){return p8(e,t,n),[!1,void 0]},everytick(){const e=qr(_.elementid),[t]=e;if(e.length===1&&At(t)){if(k(_.element))if(t.trim().length===0){const n=En(_.elementid);n.sidebar=[]}else _.element.tickertext=t,_.element.tickertime=_.timestamp}else if(e.length>1)if(_.elementisplayer){const n=En(_.elementid);n.sidebar=e}else{const n=En(_.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,l;const[n,r]=rt(t,0,[H.NAME,H.ANY]),[i,s]=pb(n);function o(u){for(let h=0;h<u.length;++h){const d=u[h];k(d.id)&&e.send(d.id,s,r)}}switch(Ct(i)){case"all":for(const u of Object.keys(((c=_.board)==null?void 0:c.objects)??{}))e.send(u,s,r);break;case"self":e.message({session:G.session(),player:_.elementfocus,id:Oe(),sender:e.id(),target:s,data:r});break;case"others":for(const u of Object.keys(((l=_.board)==null?void 0:l.objects)??{}))u!==e.id()&&e.send(u,s,r);break;default:{o(Rm(_.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(be).join("");return ie(_.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=be(n);return Dt(_.elementid,e.id(),i,r,e.get,e.set),0});var $i=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))($i||{});const H6={audio:Df,board:l6,cli:p6,display:m6,element:k6,runtime:G6,lifecycle:T6,loader:W6,network:K6},Zf=["audio","board","display","network","lifecycle","element"],Y6={0:[],1:["cli",...Zf],2:["loader",...Zf],3:["runtime",...Zf]},V6={0:new Map,1:new Map,2:new Map,3:new Map};function uo(e){return(Y6[e]??[]).map(n=>H6[n]).filter(k)}function Qf(e){const t=[],n=uo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function X6(e,t){const n=V6[e];if(!n.has(t)){let r;const i=uo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!k(r));++s);n.set(t,r)}return n.get(t)}function q6(e,t,n){const r=uo(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function J6(e,t,n,r){const i=uo(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function Z6(e,t){const n=uo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function kb(e,t){const n=uo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var Tb={},Ab={},vb={};const Sb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");vb.encode=function(e){if(0<=e&&e<Sb.length)return Sb[e];throw new TypeError("Must be between 0 and 63: "+e)};const Q6=vb,Rb=5,Ib=1<<Rb,tM=Ib-1,eM=Ib;function nM(e){return e<0?(-e<<1)+1:(e<<1)+0}Ab.encode=function(t){let n="",r,i=nM(t);do r=i&tM,i>>>=Rb,i>0&&(r|=eM),n+=Q6.encode(r);while(i>0);return n};var Ea={};(function(e){function t(R,L,B){if(L in R)return R[L];if(arguments.length===3)return B;throw new Error('"'+L+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const L=R.match(n);return L?{scheme:L[1],auth:L[2],host:L[3],port:L[4],path:L[5]}:null}e.urlParse=i;function s(R){let L="";return R.scheme&&(L+=R.scheme+":"),L+="//",R.auth&&(L+=R.auth+"@"),R.host&&(L+=R.host),R.port&&(L+=":"+R.port),R.path&&(L+=R.path),L}e.urlGenerate=s;const o=32;function a(R){const L=[];return function(B){for(let Y=0;Y<L.length;Y++)if(L[Y].input===B){const et=L[0];return L[0]=L[Y],L[Y]=et,L[0].result}const O=R(B);return L.unshift({input:B,result:O}),L.length>o&&L.pop(),O}}const c=a(function(L){let B=L;const O=i(L);if(O){if(!O.path)return L;B=O.path}const Y=e.isAbsolute(B),et=[];let C=0,S=0;for(;;)if(C=S,S=B.indexOf("/",C),S===-1){et.push(B.slice(C));break}else for(et.push(B.slice(C,S));S<B.length&&B[S]==="/";)S++;let b=0;for(S=et.length-1;S>=0;S--){const P=et[S];P==="."?et.splice(S,1):P===".."?b++:b>0&&(P===""?(et.splice(S+1,b),b=0):(et.splice(S,2),b--))}return B=et.join("/"),B===""&&(B=Y?"/":"."),O?(O.path=B,s(O)):B});e.normalize=c;function l(R,L){R===""&&(R="."),L===""&&(L=".");const B=i(L),O=i(R);if(O&&(R=O.path||"/"),B&&!B.scheme)return O&&(B.scheme=O.scheme),s(B);if(B||L.match(r))return L;if(O&&!O.host&&!O.path)return O.host=L,s(O);const Y=L.charAt(0)==="/"?L:c(R.replace(/\/+$/,"")+"/"+L);return O?(O.path=Y,s(O)):Y}e.join=l,e.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,L){R===""&&(R="."),R=R.replace(/\/$/,"");let B=0;for(;L.indexOf(R+"/")!==0;){const O=R.lastIndexOf("/");if(O<0||(R=R.slice(0,O),R.match(/^([^\/]+:\/)?\/*$/)))return L;++B}return Array(B+1).join("../")+L.substr(R.length+1)}e.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(R){return R}function f(R){return m(R)?"$"+R:R}e.toSetString=h?d:f;function p(R){return m(R)?R.slice(1):R}e.fromSetString=h?d:p;function m(R){if(!R)return!1;const L=R.length;if(L<9||R.charCodeAt(L-1)!==95||R.charCodeAt(L-2)!==95||R.charCodeAt(L-3)!==111||R.charCodeAt(L-4)!==116||R.charCodeAt(L-5)!==111||R.charCodeAt(L-6)!==114||R.charCodeAt(L-7)!==112||R.charCodeAt(L-8)!==95||R.charCodeAt(L-9)!==95)return!1;for(let B=L-10;B>=0;B--)if(R.charCodeAt(B)!==36)return!1;return!0}function x(R,L,B){let O=T(R.source,L.source);return O!==0||(O=R.originalLine-L.originalLine,O!==0)||(O=R.originalColumn-L.originalColumn,O!==0||B)||(O=R.generatedColumn-L.generatedColumn,O!==0)||(O=R.generatedLine-L.generatedLine,O!==0)?O:T(R.name,L.name)}e.compareByOriginalPositions=x;function w(R,L,B){let O=R.generatedLine-L.generatedLine;return O!==0||(O=R.generatedColumn-L.generatedColumn,O!==0||B)||(O=T(R.source,L.source),O!==0)||(O=R.originalLine-L.originalLine,O!==0)||(O=R.originalColumn-L.originalColumn,O!==0)?O:T(R.name,L.name)}e.compareByGeneratedPositionsDeflated=w;function T(R,L){return R===L?0:R===null?1:L===null?-1:R>L?1:-1}function v(R,L){let B=R.generatedLine-L.generatedLine;return B!==0||(B=R.generatedColumn-L.generatedColumn,B!==0)||(B=T(R.source,L.source),B!==0)||(B=R.originalLine-L.originalLine,B!==0)||(B=R.originalColumn-L.originalColumn,B!==0)?B:T(R.name,L.name)}e.compareByGeneratedPositionsInflated=v;function I(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=I;function U(R,L,B){if(L=L||"",R&&(R[R.length-1]!=="/"&&L[0]!=="/"&&(R+="/"),L=R+L),B){const O=i(B);if(!O)throw new Error("sourceMapURL could not be parsed");if(O.path){const Y=O.path.lastIndexOf("/");Y>=0&&(O.path=O.path.substring(0,Y+1))}L=l(s(O),L)}return c(L)}e.computeSourceURL=U})(Ea);var td={};let rM=class h1{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new h1;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};td.ArraySet=rM;var Nb={};const Ob=Ea;function iM(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||Ob.compareByGeneratedPositionsInflated(e,t)<=0}let sM=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){iM(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Ob.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Nb.MappingList=sM;const wa=Ab,$e=Ea,Sl=td.ArraySet,oM=Nb.MappingList;let Cb=class f1{constructor(t){t||(t={}),this._file=$e.getArg(t,"file",null),this._sourceRoot=$e.getArg(t,"sourceRoot",null),this._skipValidation=$e.getArg(t,"skipValidation",!1),this._sources=new Sl,this._names=new Sl,this._mappings=new oM,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new f1({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=$e.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=$e.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=$e.getArg(t,"generated"),r=$e.getArg(t,"original",null);let i=$e.getArg(t,"source",null),s=$e.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=$e.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[$e.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[$e.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=$e.relative(s,i));const o=this._mappings.toArray().length>0?new Sl:this._sources,a=new Sl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=$e.join(r,c.source)),s!=null&&(c.source=$e.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=$e.join(r,c)),s!=null&&(c=$e.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!$e.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=wa.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=wa.encode(h-o),o=h,c+=wa.encode(l.originalLine-1-i),i=l.originalLine-1,c+=wa.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=wa.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=$e.relative(n,r));const i=$e.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Cb.prototype._version=3,Tb.SourceMapGenerator=Cb;var Lb={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(Lb);var xa={exports:{}},aM={},cM=Object.freeze({__proto__:null,default:aM}),Mb=d1(cM);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;xa.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},xa.exports.initialize=t=>e=t}else{const e=Mb,t=Mb;xa.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},xa.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Ub=xa.exports;const lM=Ub;function uM(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let ka=null;var hM=function(){if(ka)return ka;const t=[];return ka=lM().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,h,d){const f=new uM;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw ka=null,n}),ka};const Tt=Ea,ed=Lb,Rl=td.ArraySet,fM=Ub,dM=hM,nd=Symbol("smcInternal");class Fe{constructor(t,n){return t==nd?Promise.resolve(this):mM(t,n)}static initialize(t){fM.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return gM(t,n)}static async with(t,n,r){const i=await new Fe(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Fe.prototype._version=3,Fe.GENERATED_ORDER=1,Fe.ORIGINAL_ORDER=2,Fe.GREATEST_LOWER_BOUND=1,Fe.LEAST_UPPER_BOUND=2;class Ta extends Fe{constructor(t,n){return super(nd).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const l=Tt.getArg(i,"sourcesContent",null),u=Tt.getArg(i,"mappings"),h=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(d){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(d)?Tt.relative(c,d):d}),r._names=Rl.fromArray(a.map(String),!0),r._sources=Rl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return Tt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,dM().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ta(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Fe.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Fe.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Fe.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Tt.getArg(t,"source");const r=Tt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(t,"bias",Fe.GREATEST_LOWER_BOUND);r==null&&(r=Fe.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Tt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(t,"line"),originalColumn:Tt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(t,"bias",Fe.GREATEST_LOWER_BOUND);i==null&&(i=Fe.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ta.prototype.consumer=Fe;class pM extends Fe{constructor(t,n){return super(nd).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Rl,r._names=new Rl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Tt.getArg(c,"offset"),u=Tt.getArg(l,"line"),h=Tt.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Fe(Tt.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Tt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")},r=ed.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||Fe.GENERATED_ORDER;let o;switch(s){case Fe.GENERATED_ORDER:o=this._generatedMappings;break;case Fe.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Tt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return ed.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Tt.getArg(t,"line"),r={source:Tt.getArg(t,"source"),originalLine:n,originalColumn:Tt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,ed.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function mM(e,t){let n=e;typeof e=="string"&&(n=Tt.parseSourceMapInput(e));const r=n.sections!=null?new pM(n,t):new Ta(n,t);return Promise.resolve(r)}function gM(e,t){return Ta.fromSourceMap(e,t)}var Fb={};const yM=Tb.SourceMapGenerator,Il=Ea,_M=/(\r?\n)/,bM=10,ho="$$$isSourceNode$$$";let EM=class gd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[ho]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new gd,s=t.split(_M);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=s[o]||"";const p=h.substr(0,f.generatedColumn-l);s[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)i.add(a()),c++;l<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=Il.join(r,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const m=r?Il.join(r,f.source):f.source;i.add(new gd(f.originalLine,f.originalColumn,m,p,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[ho]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[ho]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[ho]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[ho]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Il.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][ho]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Il.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new yM(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===bM?(n.line++,n.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};Fb.SourceNode=EM;var wM=Fb.SourceNode;let Pb=0;const Bb=Gr,xM=["Command","lines"];class kM extends rL{constructor(){super(O_,{traceInitPerf:Gr,skipValidations:!Gr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ot(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ot(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(ma)}])}));Ot(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ot(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ot(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ot(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(i_)}));Ot(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(yf)}));Ot(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(_f)}])}));Ot(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(r_)}));Ot(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(s_),this.SUBRULE(this.words),this.CONSUME(o_)}));Ot(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(no),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ot(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ot(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ot(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ot(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Tf),this.SUBRULE(this.words)}));Ot(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(b_),this.SUBRULE(this.words)}));Ot(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Af),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ot(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(_l),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(ma)),this.CONSUME4(no),this.CONSUME4(vf)}}])}));Ot(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(_l),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(no),this.CONSUME(vf)}}])}));Ot(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(_l),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ot(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(no),this.CONSUME(Sf),this.CONSUME(Af),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(no),this.CONSUME(Sf),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(T_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(A_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(v_),this.SUBRULE(this.words)}));Ot(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(S_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(R_)}));Ot(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(I_)}));Ot(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(x_)}));Ot(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(k_)}));Ot(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(bf),this.SUBRULE2(this.and_test)})}));Ot(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(wf),this.SUBRULE2(this.not_test)})}));Ot(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Ef),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ot(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ot(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(l_)},{ALT:()=>this.CONSUME(u_)},{ALT:()=>this.CONSUME(h_)},{ALT:()=>this.CONSUME(f_)},{ALT:()=>this.CONSUME(d_)},{ALT:()=>this.CONSUME(p_)}])}));Ot(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(bf),this.SUBRULE2(this.and_test_value)})}));Ot(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(wf),this.SUBRULE2(this.not_test_value)})}));Ot(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Ef),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ot(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ot(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(xf)},{ALT:()=>this.CONSUME(kf)}]),this.SUBRULE(this.term)}));Ot(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ot(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(g_)},{ALT:()=>this.CONSUME(Tf)},{ALT:()=>this.CONSUME(y_)},{ALT:()=>this.CONSUME(__)}]),this.SUBRULE(this.factor)}));Ot(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(xf)},{ALT:()=>this.CONSUME(kf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ot(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(m_),this.SUBRULE(this.factor)})}));Ot(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ot(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(a_)},{ALT:()=>this.CONSUME(on)},{ALT:()=>this.CONSUME(c_)},{ALT:()=>{this.CONSUME(E_),this.SUBRULE(this.words),this.CONSUME(w_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=xM.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(Pb++).toString().padStart(3),c=s?"font-weight: bold;":"";if(Bb&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),Bb&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),Pb--},i)}}const fo=new kM;if(gL){const e=fo.getGAstProductions(),t=mL(e);console.info(t)}const TM=fo.getBaseCstVisitorConstructor();var yt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(yt||{}),ps=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(ps||{}),Yr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Yr||{}),Nl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Nl||{});function AM(e){return!!(e!=null&&e.tokenType)}function ar(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class vM extends TM{constructor(){super();Ot(this,"unique",0);Gr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&AM(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:ar(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:ar(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:ar(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:ar(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:ar(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,ar(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Oe(),i=Oe();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Oe(),i=Oe();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,ar(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Oe(),i=Oe();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Oe(),i=Oe(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Oe(),i=Oe(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Oe();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=ar(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}command_toast(n){const i=ar(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,"toast"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=ar(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=ar(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(ar(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.words)}):[]}}const SM=new vM,Cn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Ol="zss.js";function Qt(e,t){return new wM(e.startLine??1,e.startColumn??1,Ol,t)}function rd(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function id(e){return`'${rd(e)}'`}function Cl(e){if(e.startsWith('"'))return Cl(e.replaceAll(/(^"|"$)/g,""));const t=Hf(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Kf?`', api.get('${rd(r.image.substring(1))}'), '`:rd(r.image)).join("")}'].join('')`}function po(e){return e.filter(t=>t!==void 0).map(re)}function Db(e){return Qt(e,"")}function RM(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function Ye(e,t,n){return Qt(e,[`api.${t}(`,...RM(n,", "),")"])}function IM(e){if(e.type===yt.COMPARE&&e.compare.type===yt.COMPARE_ITEM)switch(e.compare.method){case ps.IS_EQ:return Ye(e,"isEq",[re(e.lhs),re(e.rhs)]);case ps.IS_NOT_EQ:return Ye(e,"isNotEq",[re(e.lhs),re(e.rhs)]);case ps.IS_LESS_THAN:return Ye(e,"isLessThan",[re(e.lhs),re(e.rhs)]);case ps.IS_GREATER_THAN:return Ye(e,"isGreaterThan",[re(e.lhs),re(e.rhs)]);case ps.IS_LESS_THAN_OR_EQ:return Ye(e,"isLessThanOrEq",[re(e.lhs),re(e.rhs)]);case ps.IS_GREATER_THAN_OR_EQ:return Ye(e,"isGreaterThanOrEq",[re(e.lhs),re(e.rhs)])}return Qt(e,"")}function ms(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",re(n),")"])}function $b(e,t,n){return e.prepend(`api.${t}(`),e.add([re(n),")"])}function NM(e,t){if(e.type===yt.OPERATOR_ITEM)switch(e.operator){case Yr.PLUS:return ms(t,"opPlus",e.rhs);case Yr.MINUS:return ms(t,"opMinus",e.rhs);case Yr.POWER:return ms(t,"opPower",e.rhs);case Yr.MULTIPLY:return ms(t,"opMultiply",e.rhs);case Yr.DIVIDE:return ms(t,"opDivide",e.rhs);case Yr.MOD_DIVIDE:return ms(t,"opModDivide",e.rhs);case Yr.FLOOR_DIVIDE:return ms(t,"opFloorDivide",e.rhs);case Yr.UNI_PLUS:return $b(t,"opUniPlus",e.rhs);case Yr.UNI_MINUS:return $b(t,"opUniMinus",e.rhs)}return Qt(e,"")}function OM(e){if(e.type===yt.OPERATOR){const t=e.lhs?re(e.lhs):Qt(e,"");return e.items.forEach(n=>NM(n,t)),t}return Qt(e,"")}function Ll(e,t){return Qt(e,[Ye(e,"jump",[`${t}`]),"; continue;"])}function xi(e){return Cn.linelookup[e??""]??-1}function sd(e,t){Cn.linelookup[e]=t}function mo(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===t&&(i.done=n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===t&&(i.skip=n);break;case yt.LINE:mo(i.stmts,t,n);break}}}function jb(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.ELSE_IF:i.type===t&&sd(i.done,n);break;case yt.IF_BLOCK:case yt.IF_CHECK:i.type===t&&sd(i.skip,n);break;case yt.LINE:jb(i.stmts,t,n);break}}}function re(e){var t;switch(e.type){case yt.PROGRAM:return Qt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(re).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Ol}`]);case yt.API:return Qt(e,["  ",Ye(e,e.method,po(e.words)),`;
`]);case yt.LINE:return Qt(e,[`case ${e.lineindex}:
`,...e.stmts.map(re).flat(),`  break;
`]);case yt.MARK:return Qt(e,`  // ${e.comment}
`);case yt.GOTO:{const n=xi(e.id);return Qt(e,["  ",Ll(e,n),`
`])}case yt.COUNT:return Qt(e,`${e.index}`);case yt.LITERAL:switch(e.literal){case Nl.NUMBER:return Qt(e,`${e.value}`);case Nl.STRING:return Qt(e,id(e.value));case Nl.TEMPLATE:return Qt(e,Cl(e.value))}return Db(e);case yt.TEXT:return Qt(e,["  ",Ye(e,"text",[Cl(e.value)]),`;
`]);case yt.STAT:if(Cn.isfirststat){Cn.isfirststat=!1;const n=e.value.trim().split(" ").map(id);return Qt(e,["  ",Ye(e,"stat",n),`;
`])}return Qt(e,`  // skipped ${e.value}
`);case yt.LABEL:{const n=Ct(e.name),r=e.active?"label":"comment";Cn.labels[n]||(Cn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Cn.labels[n].push(i),Qt(e,`  // ${i} '${n}' ${r}
`)}case yt.HYPERLINK:return Qt(e,["  ",Ye(e,"hyperlink",[Cl(e.text),...po(e.link)]),`;
`]);case yt.MOVE:{const n=Ye(e,"command",[id("go"),po(e.words)].flat());return e.wait?Qt(e,["  if (",n,`) { continue; };
`]):Qt(e,["  ",n,`;
`])}case yt.COMMAND:return Qt(e,["  if (",Ye(e,"command",po(e.words)),`) { continue; };
`]);case yt.IF:{const n=((t=e.block)==null?void 0:t.type)===yt.IF_BLOCK?e.block:void 0;if(k(n)){mo([e.check],yt.IF_CHECK,n.skip);const r=Qt(e,re(e.check));return n.lines.forEach(i=>r.add(re(i))),jb(n.altlines,yt.ELSE_IF,xi(n.done)),n.altlines.forEach(i=>r.add(re(i))),r}return Qt(e,re(e.check))}case yt.IF_CHECK:{const n=xi(e.skip);return n===-1?Qt(e,["  ",Ye(e,e.method,po(e.words)),`;
`]):Qt(e,["  if (!",Ye(e,e.method,po(e.words)),") { ",Ll(e,n),` }
`])}case yt.ELSE_IF:case yt.ELSE:{const n=Qt(e,"");return e.lines.forEach(r=>n.add(re(r))),n}case yt.WHILE:{const n=xi(e.loop),r=xi(e.done),i=Qt(e,"");return mo(e.lines,yt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case yt.REPEAT:{const n=xi(e.loop),r=xi(e.done),i=Qt(e,"");return mo(e.lines,yt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case yt.WAITFOR:{const n=Qt(e,"");return mo(e.lines,yt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(re(r))}),n}case yt.FOREACH:{const n=xi(e.loop),r=xi(e.done),i=Qt(e,"");return mo(e.lines,yt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case yt.BREAK:s.goto=r;break;case yt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case yt.BREAK:return Qt(e,["  ",Ll(e,e.goto),`
`]);case yt.CONTINUE:return Qt(e,["  ",Ll(e,e.goto),`
`]);case yt.OR:return Ye(e,"or",e.items.map(re));case yt.AND:return Ye(e,"and",e.items.map(re));case yt.NOT:return Ye(e,"not",e.items.map(re));case yt.COMPARE:return IM(e);case yt.OPERATOR:return OM(e);case yt.EXPR:return Ye(e,"expr",e.words.map(re));default:return console.error("<unsupported node>",e.type,e),Db(e)}}function Vr(e){if(k(e))switch(e.type===yt.LINE&&++Cn.lineindex,e.lineindex=Cn.lineindex,e.type){case yt.PROGRAM:e.lines.forEach(Vr);break;case yt.LINE:e.stmts.forEach(Vr);break;case yt.MARK:sd(e.id,e.lineindex);break;case yt.IF:Vr(e.check),Vr(e.block);break;case yt.IF_BLOCK:e.lines.forEach(Vr),e.altlines.forEach(Vr);break;case yt.ELSE_IF:e.lines.forEach(Vr);break;case yt.ELSE:case yt.WHILE:case yt.REPEAT:case yt.FOREACH:case yt.WAITFOR:e.lines.forEach(Vr);break;case yt.MOVE:case yt.COMMAND:case yt.IF_CHECK:e.words.forEach(Vr);break}}function CM(e){return Cn.labels={},Cn.internal=1,Cn.lineindex=0,Cn.isfirststat=!0,Vr(e),{...re(e).toStringWithSourceMap({file:`${Ol}.map`}),...Cn}}function zb(e){return oe(e)?e.length>0?1:0:e??0}function LM(e){return`${e}_chip`}function Wb(e=""){return`vm:${e??""}`}function MM(e,t,n){var l,u;const r=LM(e),i=gs(r);let s;const o=Xe(Object.entries(n.labels??{}));(!oe(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(h,d){_.words=d;const f=X6(t,h);return k(f)?f(c,d):h!=="send"?a("send",[h,...d]):0}const c={halt(){qM(r)},id(){return e},set(h,d){const[f,p]=J6(t,c,h,d);if(f)return p},get(h){const[d,f]=q6(t,c,h);if(d)return f},tick(h){const d=Rt(i.ps)?i.ps:0,f=d%h===0;if(i.ps=d+1,f===!1)return!1;if(c.shouldtick()===!1)return kb(t,c),!1;i.lc=0,i.ys=0,_.get=c.get,Z6(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ge(G,_.elementfocus,"crash",p.message),i.es=1}return kb(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Rt(i.lc)?++i.lc>pi.HALT_AT_COUNT:!0},hm(){if(oe(i.mg)&&oe(i.lb)){const[h]=i.mg;if(k(h))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)return p.find(m=>Rt(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,d,f,p){G.emit(h,`${Wb(d)}:${f}`,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(oe(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h){const m=p.findIndex(x=>x>0);m>=0&&(p[m]*=-1)}}},restore(h){if(oe(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)for(let m=0;m<p.length;m++)p[d]=Math.abs(p[d])}},getcase(){i.ec=Rt(i.ec)?i.ec:1;const h=c.hm();if(h&&oe(i.mg)){const[,d,f,p]=i.mg;c.set("sender",f),k(d)&&c.set("arg",d),p&&(c.set("player",p),_.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Rt(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const d=jL.parse(h),[f]=d.filter(p=>p.fileName===Ol);return{line:(f==null?void 0:f.lineNumber)??0,column:(f==null?void 0:f.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[d,...f]=h;return a(Ct(be(d)),f)},if(...h){const[d,f]=rt(h,0,[H.ANY]),p=zb(d);return p&&f<h.length&&c.command(...h.slice(f)),p?1:0},try(...h){const[,d]=rt(h,0,[H.DIR]),f=c.command("go",...h);return f&&d<h.length&&c.command(...h.slice(d)),f?1:0},take(...h){const[d,f,p]=rt(h,0,[H.NAME,H.ANY]),m=Rt(f),x=m?p:1,w=c.get(d),T=m?f:1;if(!Rt(w))return x<h.length&&c.command(...h.slice(x)),1;const v=w-T;return v<0?(x<h.length&&c.command(...h.slice(x)),1):(c.set(d,v),0)},give(...h){const[d,f,p]=rt(h,0,[H.NAME,H.ANY]),m=Rt(f),x=m?p:1,w=c.get(d),T=m?f:1,v=w===void 0?1:0;return v&&x<h.length&&c.command(...h.slice(x)),c.set(d,_a(w,0)+T),v},repeatstart(h,...d){const[f,p]=rt(d,0,[H.NUMBER]),m=`repeatcount${h}`,x=`repeatwords${h}`;i[m]=f,i[x]=p<d.length?d.slice(p):void 0},repeat(h){const d=`repeatcount${h}`,f=`repeatwords${h}`;if(!Rt(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,x=i[f];return m&&oe(x)&&c.command(...x),m?1:0},foreachstart(h,...d){const[f,p,m,x]=rt(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let w=Math.min(p,m),T=Math.max(p,m);const v=(x??0)||1;if(v<0){const I=w;w=T,T=I}return c.set(f,w-v),0},foreach(h,...d){const[f,p,m,x,w]=rt(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let T=Math.min(p,m),v=Math.max(p,m);const I=(x??0)||1;if(I<0){const L=T;T=v,v=L}let U=c.get(f);!Rt(U)||U<T||U>v?U=T:U+=I;const R=U<=v?1:0;return R&&(c.set(f,U),w<d.length&&c.command(...d.slice(w))),R},waitfor(...h){const[d]=rt(h,0,[H.ANY]),f=zb(d);return f||c.yield(),f?1:0},or(...h){let d=0;for(let f=0;f<h.length;){const[p,m]=rt(h,f,[H.ANY]);if(d=p,d)break;f=m}return d},and(...h){let d=0;for(let f=0;f<h.length;){const[p,m]=rt(h,f,[H.ANY]);if(d=p,!d)break;f=m}return d},not(...h){const[d]=rt(h,0,[H.ANY]);return d?0:1},expr(...h){const[d]=rt(h,0,[H.ANY]);return d},isEq(h,d){const[f]=rt([h],0,[H.ANY]),[p]=rt([d],0,[H.ANY]);return typeof f=="object"||typeof p=="object"?H1(f,p)?1:0:f===p?1:0},isNotEq(h,d){return this.isEq(h,d)?0:1},isLessThan(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return f<p?1:0},isGreaterThan(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return f>p?1:0},isLessThanOrEq(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return f<=p?1:0},isGreaterThanOrEq(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return f>=p?1:0},opPlus(h,d){const[f]=rt([h],0,[H.ANY]),[p]=rt([d],0,[H.ANY]);return f+p},opMinus(h,d){const[f]=rt([h],0,[H.ANY]),[p]=rt([d],0,[H.ANY]);return f-p},opPower(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return Math.pow(f,p)},opMultiply(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return f*p},opDivide(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return f/p},opModDivide(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return f%p},opFloorDivide(h,d){const[f]=rt([h],0,[H.NUMBER]),[p]=rt([d],0,[H.NUMBER]);return Math.floor(f/p)},opUniPlus(h){const[d]=rt([h],0,[H.NUMBER]);return+d},opUniMinus(h){const[d]=rt([h],0,[H.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function od(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];oe(r)?r.forEach(i=>{t.push(od(i))}):t.push(od(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function UM(e){const t=Rf(`${e}
`);if(t.errors.length>0)return t;fo.input=t.tokens;const n=fo.program();if(fo.errors.length>0)return{tokens:t.tokens,errors:fo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=SM.go(n);return r?(od(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const ad=Object.getPrototypeOf(function*(){}).constructor;function FM(e,t){const n=`compile-${e}`;console.time(n);const r=UM(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=CM(r.ast);if(i.code){yL&&console.info(i.code);try{return{...r,...i,source:i.code,code:new ad("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new ad("api"," ")}}}return{...r,...i,source:"",code:new ad("api"," ")}}function PM(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=FM(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return k(s)?s.isended():!0},halt(i){const s=t[i];return k(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];k(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!k(t[i])){const h=n(a,c);if(l=t[i]=MM(i,s,h),(u=h.errors)!=null&&u.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((w,T)=>[w,T]);p.slice(f-5,f).forEach(([w,T])=>{ge(G,Xr(),"build",`$grey${T+1} $grey${w}`)});const[m,x]=p[f]??[];if(At(m)&&k(x)){const w=(d.column??1)-1,T=w+d.length,v=w<m.length?m:`${m}*`,I=v.substring(0,w),U=v.substring(w,T),R=v.substring(T);ge(G,Xr(),"build",`$red${x+1} $grey${I}$red${U}$grey${R}`)}return d.message.split(`
`).forEach(w=>{ge(G,Xr(),"build",w)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=lr(i.target),a=t[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}let Kb=0;function BM(){switch(Kb++){case 0:return Wt.BLUE;case 1:return Wt.GREEN;case 2:return Wt.CYAN;case 3:return Wt.RED;case 4:return Wt.PURPLE;case 5:return Wt.YELLOW;default:return Kb=0,Wt.WHITE}}const je=new $o,_n={},Ml={};function Gb(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return k(_n[s])||(_n[s]=UT(e,t,n,r,i)),_n[s]}function DM(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return k(Ml[s])||(Ml[s]=FT(e,t,n)),Ml[s].id=i,Ml[s]}function $M(e,t){const n=`sprites:${e}:${t}`;return k(_n[n])||(_n[n]=PT(e,t)),_n[n]}function jM(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return k(_n[s])||(_n[s]=BT(e,t,n,r,i)),_n[s]}function cd(e,t,n,r){const i=`media:${e}:${t}`;k(_n[i])||(_n[i]=DT(e,t,n,r));const s=_n[i];return s.mime=n,s.media=r,s}function zM(e,t){const n=`control:${e}:${t}`;return k(_n[n])||(_n[n]=$T(e,t)),_n[n]}const ji=.4;function Hb(e,t){const n=[];je.x=e-ji,je.y=t-ji,n.push(je.angle()),je.x=e+ji,je.y=t-ji,n.push(je.angle()),je.x=e-ji,je.y=t+ji,n.push(je.angle()),je.x=e+ji,je.y=t+ji,n.push(je.angle());const r=Math.round(rh(Math.min(...n))),i=Math.round(rh(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function WM(e,t,n,r,i){var L;if(!k(r)||!k(r.terrain)||!k(r.objects))return[];const s=[];let o=t;const a=o===0,c=zt,l=ye,u=a?Wt.BLACK:Wt.ONCLEAR,h=Gb(e,o++,c,l,u);s.push(h);const d=o++,f=$M(e,d);f.sprites=[],s.push(f);const p=r.isdark?1:0,m=jM(e,o++,c,l,p);s.push(m),m.alphas.fill(p);const x=Gb(e,o++,c,l,Wt.ONCLEAR);s.push(x),x.char.fill(0);const w={...Yf(zt,ye,BM(),Wt.ONCLEAR),...x},T=zM(e,o++);if(i&&(s.push(T),At(r.camera)))switch(Ct(r.camera)){default:T.viewscale=1.5;break;case"near":T.viewscale=3;break;case"far":T.viewscale=1;break}for(let B=0;B<r.terrain.length;++B){const O=r.terrain[B],Y=z_(n,O,0,Wt.BLACK,Wt.ONCLEAR);h.char[B]=Y.char,h.color[B]=Y.color,h.bg[B]=Y.bg}const v=Object.values(r.objects??{});for(let B=0;B<v.length;++B){const O=v[B];if(k(O.removed))continue;const Y=O.id??"",et=z_(n,O,1,Wt.WHITE,Wt.BLACK),C=DM(e,d,Y,B);if(C.x=O.x??0,C.y=O.y??0,C.char=et.char,C.color=et.color,C.bg=et.bg,f.sprites.push(C),p){if(et.light>0){const S=[],b=nn(Math.round(et.light),1,10),P=b*.5,X=fr(r,C),D=1/P;if(m.alphas[X]=0,b>1)for(let ct=1;ct<=b;++ct)for(let tt=C.y-ct;tt<=C.y+ct;++tt)for(let ft=C.x-ct;ft<=C.x+ct;++ft){if(ft===C.x&&tt===C.y)continue;je.x=ft-C.x,je.y=tt-C.y;const V=je.length();if(V>b)continue;const z=fr(r,{x:ft,y:tt});if(z===-1)continue;const Et=Math.round(rh(je.angle()));let ot=0;for(let kt=0;kt<S.length;++kt){const Bt=S[kt];Et>=Bt[0]&&Et<=Bt[1]&&(ot=Math.max(ot,Bt[2]))}m.alphas[z]=Math.min(m.alphas[z],ot+(V<P?0:(V-P)*D)),m.alphas[z]=nn(m.alphas[z],0,1);const lt=pn(r,((L=r.lookup)==null?void 0:L[z])??"");if(k(lt)){const kt=[...Hb(je.x,je.y),.25];S.push(kt)}const Lt=r.terrain[z],Xt=wr(n,Lt),Mt=(Lt==null?void 0:Lt.collision)??(Xt==null?void 0:Xt.collision);if(kc(Ht.ISBULLET,Mt)){const kt=[...Hb(je.x,je.y),1];let Bt=0;for(Bt=0;Bt<S.length;++Bt){const Ut=S[Bt];if(Ut[1]>Ut[0]&&kt[1]>=Ut[0]&&kt[0]<=Ut[1]&&kt[2]>=1&&Ut[2]>=1){S[Bt]=[Math.min(kt[0],Ut[0]),Math.max(kt[1],Ut[1]),1];break}}Bt===S.length&&S.push(kt)}}}else if(Tr(Y)){const S=fr(r,C);m.alphas[S]=0}}if(At(O.tickertext)&&Rt(O.tickertime)&&O.tickertext.length){const S=zt,b=fb(O.tickertext,S,ye-1),P=(b==null?void 0:b.measuredwidth)??1,X=O.x??0,D=O.y??0,ct=D<ye*.5;w.x=X-Math.floor(P*.5),w.y=D+(ct?1:-1),w.x+P>zt&&(w.x=zt-P),w.x<0&&(w.x=0),hb(O.tickertext,w,!0)}Y===e&&(T.focusx=C.x,T.focusy=C.y,T.focusid=Y)}const I=le(Pt.MAIN),U=_i(I,Pt.MAIN);if(At(U.palette)){const B=On(I,bt.PALETTE,U.palette),O=ln(B);k(O==null?void 0:O.bits)&&s.push(cd(e,o++,"image/palette",Array.from(O.bits)))}if(At(U.charset)){const B=On(I,bt.CHARSET,U.charset),O=ln(B);k(O==null?void 0:O.bits)&&s.push(cd(e,o++,"image/charset",Array.from(O.bits)))}const R=Object.keys(r.objects).filter(Tr);return s.push(cd(e,o++,"text/players",R.join(","))),s}const Wn=PM();var Pt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Pt||{});const Ee={halt:!1,session:Oe(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function KM(){return Ee.session}function Xr(){return Ee.operator}function GM(e){Ee.operator=e}function HM(e){Ee.halt=e}function YM(){return Ee.halt}function go(){return[...Ee.books.values()]}function VM(){const[e]=Ee.books.values();return e}function kr(e){const t=Ct(e);return Ee.books.get(e)??go().find(n=>n.name===t)}function Ul(e,t){k(kr(t))&&(Ee.software[e]=t)}function le(e){return kr(Ee.software[e])}function Yb(e){const t=P_([]);return At(e)&&(t.name=e),ld(t),Zr(G,Ee.operator,`created [book] ${t.name}`),t}function XM(e){let t=kr(e);return k(t)||(t=P_([]),t.name=e),ld(t),Zr(G,Ee.operator,`created [book] ${t.name}`),t}function bn(e,t){let n=k(t)?XM(t):le(e);return k(n)||(k(n)||(n=VM()),k(n)||(n=Yb(t)),k(n)&&Zr(G,Ee.operator,`opened [book] ${n.name} for ${e}`)),Ul(e,n.id),n}function zi(e,t,n){return Lf(bn(e),n,t)}function gs(e){const t=bn("main");return _i(t,e)}function Vb(){const e=bn("main");return _i(e,"main")}function qM(e){const t=bn("main");return W_(t,e)}function JM(e,t){Ee.books.clear(),e.forEach(r=>{Ee.books.set(r.id,r),r.name==="main"&&(Ee.software.main=r.id)});const n=kr(t);if(k(n)&&Ul("main",n.id),!Ee.software.main){const r=Ee.books.values().next();r.value&&(Ee.software.main=r.value.id)}}function ld(e){return Ee.books.set(e.id,e),e.id}function ZM(e){const t=kr(e);t&&Ee.books.delete(t.id)}function QM(e){if(!At(e)||!e)return ge(G,e,"login",`failed for playerid ==>${e}<==`);const t=le("main");if(!k(t))return ge(G,e,"login:main","login failed to find book 'main'");const n=fs(t,e);if(k(n))return!0;const r=Er(t,bt.BOARD,"title");if(r.length===0)return ge(G,e,"login:title","login failed to find board with 'title' stat");const i=ya(t,"player");if(!k(i))return ge(G,e,"login:player","login failed to find object type 'player'");const s=zp(e,r),o=ln(s);if(k(o)){const a=F_(s,"startx"),c=F_(s,"starty"),l=Rt(a)?a:Math.round(zt*.5),u=Rt(c)?c:Math.round(ye*.5),h=i.name??"player",d=bh(o,{x:l,y:u},h,e);if(k(d==null?void 0:d.id))return d.player=e,wl(t,e,o.id),!0}return!1}function t8(e){const t=le("main"),n=fs(t,e);wl(t,e,""),Ff(t,n,pn(n,e)),vm(n,e),Wn.halt(e),W_(t,e)}function Kn(e){const t=le("main");return fs(t,e)}function e8(e){const t=le("main"),n=NL(t,e),r=fs(t,e),i=pn(r,e);return n&&k(i)}function n8(e){const t=le("main"),n=Uf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Tr(c)&&k(e[c])===!1&&(e[c]=0,wl(t,c,i.id))}}}function Xb(e){Wn.message(e)}function Aa(e,t,n,r){const i=Fr(t);At(n.id)&&G.emit(e,"vm:touched",[n.id,i,r])}function ud(e,t,n,r){if(!k(n==null?void 0:n.id))return!1;const i=q_(e,t,n,r);if(k(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=Er(e,bt.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=Le(o);so(e,n.id,a.id,{x:zt-1,y:r.y})}}else if(r.x>=zt){const o=Er(e,bt.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=Le(o);so(e,n.id,a.id,{x:0,y:r.y})}}else if(r.y<0){const o=Er(e,bt.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=Le(o);so(e,n.id,a.id,{x:r.x,y:ye-1})}}else if(r.y>=ye){const o=Er(e,bt.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=Le(o);so(e,n.id,a.id,{x:r.x,y:0})}}}else Aa("",i,n,"thud");if(n.kind==="player"){const o=Tr(i.id);Aa(n.id,n,i,o?"bump":"touch")}else if(n.collision===Ht.ISBULLET){const o=Tr(n.party),a=Tr(i.id);o!==a?Aa(n.party??"",n,i,"shot"):Aa("",n,i,"thud")}else Aa("",n,i,"bump");const s=wr(e,i);return i.destructible??(s==null?void 0:s.destructible)?(k(i==null?void 0:i.id)?Hr(_.book,_.board,i,_.timestamp):dr(t,{x:r.x,y:r.y}),!0):!1}return!0}function qb(e,t,n,r,i=PE){var h;if(!k(e)||!k(t)||!k(n))return;const s={..._};_.book=e,_.board=t,_.element=n,_.elementid=n.id??"",_.elementisplayer=Tr(_.elementid);const o=_.element.player??Ee.operator;_.elementfocus=_.elementisplayer?_.elementid:o;const a=wr(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=Ct(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Wn.tick(l,$i.RUNTIME,Rt(c)?c:i,u,r),Rt(n==null?void 0:n.tickertime)&&_.timestamp-n.tickertime>La*5&&(n.tickertime=0,n.tickertext=""),_.elementisplayer){const d=gs(_.elementid);Rt(d.inputcurrent)&&(d.inputcurrent=0)}Gn(s).forEach(d=>{_[d]=s[d]})}function r8(e,t){Ee.loaders.set(e,t)}function i8(e){Wn.halt(e)}function s8(){const e=Wn.ids();for(let n=0;n<e.length;++n)Wn.halt(e[n]);const t=le("main");k(t)&&(t.flags={})}function o8(){const e=le("main");if(!k(e))return;const t=e.timestamp+1,n=pi.HALT_AT_COUNT;pi.HALT_AT_COUNT=n*2,Ee.loaders.forEach((i,s)=>{const o={..._};_.timestamp=e.timestamp,_.book=e,_.board=void 0,_.element=void 0,_.elementid=s,_.elementisplayer=!1,_.elementfocus="";const a=A6(s);k(a)&&Wn.arg(s,a),Wn.tick(s,$i.LOADER,1,"loader",i),Wn.isended(s)&&(Wn.halt(s),Ee.loaders.delete(s)),Gn(o).forEach(c=>{_[c]=o[c]})}),pi.HALT_AT_COUNT=n,e.timestamp=t,_.timestamp=t;const r=Uf(e);for(let i=0;i<r.length;++i){const s=r[i],o=BL(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:h}=o[a];l===bt.ERROR?Wn.halt(c):qb(e,s,h,u)}}}function hd(e,t){const n=le("main");if(!k(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(k(u.id)){const h=`${Wb(u.id)}:${c}`;G.emit("",h,t)}}}const{target:i,path:s}=lr(e),o=Uf(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Ct(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(Rm(c,[i]),s);break}}}}function a8(e,t=""){var s;const n=bn("main");if(!k(n))return;const r=`${e}_cli`;_.timestamp=n.timestamp,_.book=n,_.board=fs(n,e),_.element=pn(_.board,e),_.elementid=((s=_.element)==null?void 0:s.id)??"",_.elementisplayer=!0,_.elementfocus=_.elementid||e;const i=pi.HALT_AT_COUNT;pi.HALT_AT_COUNT=i*8,Nd(G,e,"running",n.timestamp,r,t),Wn.once(r,$i.CLI,"cli",t),pi.HALT_AT_COUNT=i}function Fl(e){var o;const t=bn("main"),n=yi(t,e);if(!k(t)||!k(n)||!k(_.element))return;const r=`${e}_run`,i=Ct(_.element.name??((o=_.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";Wn.once(r,$i.RUNTIME,i,s)}function c8(e){const t=le("main"),n=fs(t,e),r=[];if(!k(t)||!k(n))return r;const i=io(t,n.over??""),s=io(t,n.under??""),o=[i,n,s];let a=0;for(let c=0;c<o.length;++c){const l=o[c],u=WM(e,a,t,l,l===n);a+=u.length,r.push(...u)}return r}function yo(e,t=0){const n=[];let r=e;for(;r<_.words.length;){const[i,s]=Ln(r);if(oe(i)&&!ts(i)&&!ba(i)&&!kl(i)&&!Mr(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Ln(e){var r,i,s,o,a;const t=_.words[e],n=e+1;if(gb(t)){const[c,l]=g6(e);if(k(c))return[c,l]}if(y6(t)){const[c,l]=_6(e);if(k(c))return[c,l]}if(oh(t)){const[c,l]=ah(e);if(k(c))return[c,l]}if(At(t)&&Ct(t)==="rnd"){const[c,l]=Ln(n),[u,h]=Ln(l);return Rt(c)&&Rt(u)?[Jn(c,u),h]:Rt(c)?[Jn(0,c),l]:[Jn(0,1),n]}if(sh(t)){const[c,l]=Gp(e);if(k(c))return[c,l]}if(!k(t))return[void 0,e];if(Rt(t)||oe(t))return[t,n];if(At(t)){const c=Ct(t),l=(r=_.get)==null?void 0:r.call(_,t);if(k(l))return[l,n];switch(c){case"aligned":case"alligned":{const u=Vo(_.board,_.element,_.elementfocus);return!k(_.element)||!k(u)?[0,n]:[_.element.x===u.x||_.element.y===u.y?1:0,n]}case"contact":{const u=Vo(_.board,_.element,_.elementfocus);if(!k(_.element)||!k(u))return[0,n];const h=(u.x??0)-(((i=_.element)==null?void 0:i.x)??0),d=(u.y??0)-(((s=_.element)==null?void 0:s.y)??0);return[h===0&&Math.abs(d)<2||d===0&&Math.abs(h)<2?1:0,n]}case"blocked":{const[u,h]=rt(_.words,n,[H.DIR]);return[FL(_.book,_.board,_.element,u)?1:0,h]}case"any":{const[u,h]=rt(_.words,n,[H.KIND]);return[Sm(_.board,u).length?1:0,h]}case"rnd":return[Jn(0,1),n];case"abs":{const[u,h]=rt(_.words,n,[H.NUMBER]);return[Math.abs(u),h]}case"ceil":{const[u,h]=rt(_.words,n,[H.NUMBER]);return[Math.ceil(u),h]}case"floor":{const[u,h]=rt(_.words,n,[H.NUMBER]);return[Math.floor(u),h]}case"round":{const[u,h]=rt(_.words,n,[H.NUMBER]);return[Math.round(u),h]}case"clamp":{const[u,h,d,f]=rt(_.words,n,[H.NUMBER,H.NUMBER,H.NUMBER]);return[nn(u,h,d),f]}case"min":{const[u,h]=yo(n);return[Math.min(...u),h]}case"max":{const[u,h]=yo(n);return[Math.max(...u),h]}case"pick":{const[u,h]=yo(n);return[Le(u),h]}case"pickwith":{const[u,h]=rt(_.words,n,[H.NUMBER_OR_STRING]),[d,f]=yo(h);return[zp(`${u}`,d),f]}case"random":{const[u,h]=yo(n,2),[d,f]=u;return[Jn(d,f??0),h]}case"randomwith":{const[u,h]=rt(_.words,n,[H.NUMBER_OR_STRING]),[d,f]=yo(h,2),[p,m]=d;return[$p(`${u}`,p,m??0),f]}case"run":{const[u,h]=rt(_.words,n,[H.NAME]);return Fl(u),[(o=_.get)==null?void 0:o.call(_,"arg"),h]}case"runwith":{const[u,h,d]=rt(_.words,n,[H.ANY,H.NAME]);return k(_.element)&&(_.element.arg=u),Fl(h),[(a=_.get)==null?void 0:a.call(_,"arg"),d]}}}return[t,n]}const _={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var H=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.MAYBE_KIND=7]="MAYBE_KIND",e[e.MAYBE_NAME=8]="MAYBE_NAME",e[e.MAYBE_NUMBER=9]="MAYBE_NUMBER",e[e.MAYBE_STRING=10]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",e[e.ANY=12]="ANY",e))(H||{});function hn(e,t,n){throw console.info(n,_.element,_.elementid,_.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function Jb(e){var r,i;const t={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};return k(_.board)&&k(_.element)?X_(_.book,_.board,_.element,_.elementfocus,e,t):t}function rt(e,t,n){const r=_.words;_.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=qp(s);Hs(a)?(s=c,i.push(a)):hn("kind",a,e);break}case 0:{if(oh(e[0])===void 0){const[a,c]=Ln(s);Mr(a)?(s=c,i.push(a)):hn("color",a,e)}else{const[a,c]=ah(s);Mr(a)?(s=c,i.push(a)):hn("color",a,e)}break}case 2:{if(sh(e[0])===void 0){const[a,c]=Ln(s);ts(a)?(s=c,i.push(Jb(a))):hn("direction",a,e)}else{const[a,c]=Gp(s);ts(a)?(s=c,i.push(Jb(a))):hn("direction",a,e)}break}case 3:{const a=_.words[s];At(a)||hn("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Ln(s);if(At(a)){const l=parseFloat(a);Rt(l)?i.push(l):hn("number",a,e)}else Rt(a)?i.push(a):hn("number",a,e);s=c;break}case 5:{const[a,c]=Ln(s);At(a)||hn("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Ln(s);let l=a;if(At(l)){const u=parseFloat(l);Rt(u)&&(l=u)}else Rt(l)||hn("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=qp(s);a!==void 0&&!Hs(a)&&hn("optional kind",a,e),s=c,i.push(a);break}case 8:{const a=_.words[s];a!==void 0&&!At(a)&&hn("optional string",a,e),++s,i.push(a);break}case 9:{const[a,c]=Ln(s);if(At(a)){const l=parseFloat(a);Rt(l)?i.push(l):hn("optional number",a,e)}else Rt(a)||a===void 0?i.push(a):hn("optional number",a,e);s=c;break}case 10:{const[a,c]=Ln(s);a!==void 0&&!At(a)&&hn("optional string",a,e),s=c,i.push(a);break}case 11:{const[a,c]=Ln(s);let l=a;if(At(l)){const u=parseFloat(l);Rt(u)&&(l=u)}else l!==void 0&&!Rt(l)&&hn("number or string",l,e);s=c,i.push(l);break}case 12:{const[a,c]=Ln(s);s=c,i.push(a);break}}return _.words=r,[...i,s]}const Pl={},_o={};function fd(){return{id:Oe(),layers:[],scroll:[],sidebar:[]}}const l8=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),u8=new Set(["tx","text"]),h8={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Zb={};let Qb=e=>{let t=Zb[e];return k(t)||(Zb[e]=t=fd()),t};function f8(e){Qb=e}function En(e){return Qb(e)}function dd(e){return k(Pl[e])||(Pl[e]=[]),Pl[e]}function d8(e){const t=En(e);t.scroll=[]}function p8(e,t,n){Object.values(_o).forEach(r=>{if(r[t]!==void 0){const i=Om(e.id(),t);Rt(n)&&Mk(i,n),At(n)&&Uk(i,n)}})}function qr(e){const t=dd(e);return Pl[e]=[],t}function ie(e,t){dd(e).push(t)}function Dt(e,t,n,r,i=()=>0,s=Jl){const o=[t,n,...r],a=Ct(`${o[3]}`),c={..._};function l(u,h){k(h)&&h!==i(u)&&(_.board=c.board,_.element=c.element,_.elementfocus=c.elementfocus,s(u,h))}if(l8.has(a)){const u=`${o[2]}`;_o[t]=_o[t]??{};const h=i(u)??h8[a];if(_o[t][u]===void 0){const d=Om(t,u);Rt(h)&&Lk(d,h),At(h)&&qu(d,h),u8.has(a)?_o[t][u]=Rp(d,f=>{l(u,f)}):_o[t][u]=Fk(d,f=>{l(u,f)})}}dd(e).push(o)}f8(e=>{if(Tr(e)){const t=le(Pt.MAIN),n=_i(t,Pt.GADGETSTORE);let r=n[e];return k(r)||(n[e]=r=fd()),r}return fd()});const Bl=xs("gadgetserver",["tock","second"],e=>{if(!Bl.session(e))return;const t=le(Pt.MAIN),n=(t==null?void 0:t.activelist)??[],r=_i(t,Pt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=En(s);o.layers=c8(s);const a=r[s]??{},c=Id(a,o);c.length&&(r[s]=Xe(o),lE(Bl,s,c))}break;case"second":{for(let i=0;i<n.length;++i){const s=n[i],o=Kn(s);k(o)&&xE(Bl,s,o.id)}break}case"desync":cE(Bl,e.player,En(e.player));break;case"clearscroll":d8(e.player);break;case"clearplayer":{const i=le(Pt.MAIN),s=_i(i,Pt.GADGETSTORE);delete s[e.player];const o=_i(i,Pt.GADGETSYNC);delete o[e.player];break}}});function Dl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var t1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof Dl=="function"&&Dl;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};r[l][0].call(f.exports,function(p){var m=r[l][1][p];return o(m||p)},f,f.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Dl=="function"&&Dl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,f,p,m,x=[],w=0,T=c.length,v=T,I=s.getTypeOf(c)!=="string";w<c.length;)v=T-w,h=I?(l=c[w++],u=w<T?c[w++]:0,w<T?c[w++]:0):(l=c.charCodeAt(w++),u=w<T?c.charCodeAt(w++):0,w<T?c.charCodeAt(w++):0),d=l>>2,f=(3&l)<<4|u>>4,p=1<v?(15&u)<<2|h>>6:64,m=2<v?63&h:64,x.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return x.join("")},i.decode=function(c){var l,u,h,d,f,p,m=0,x=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var T,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(f=a.indexOf(c.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(c.charAt(m++))),T[x++]=l,f!==64&&(T[x++]=u),p!==64&&(T[x++]=h);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,h,d,f,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(f,p){var m,x="";for(m=0;m<p;m++)x+=String.fromCharCode(255&f),f>>>=8;return x}function o(f,p,m,x,w,T){var v,I,U=f.file,R=f.compression,L=T!==l.utf8encode,B=a.transformTo("string",T(U.name)),O=a.transformTo("string",l.utf8encode(U.name)),Y=U.comment,et=a.transformTo("string",T(Y)),C=a.transformTo("string",l.utf8encode(Y)),S=O.length!==U.name.length,b=C.length!==Y.length,P="",X="",D="",ct=U.dir,tt=U.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=f.crc32,ft.compressedSize=f.compressedSize,ft.uncompressedSize=f.uncompressedSize);var V=0;p&&(V|=8),L||!S&&!b||(V|=2048);var z=0,Et=0;ct&&(z|=16),w==="UNIX"?(Et=798,z|=function(lt,Lt){var Xt=lt;return lt||(Xt=Lt?16893:33204),(65535&Xt)<<16}(U.unixPermissions,ct)):(Et=20,z|=function(lt){return 63&(lt||0)}(U.dosPermissions)),v=tt.getUTCHours(),v<<=6,v|=tt.getUTCMinutes(),v<<=5,v|=tt.getUTCSeconds()/2,I=tt.getUTCFullYear()-1980,I<<=4,I|=tt.getUTCMonth()+1,I<<=5,I|=tt.getUTCDate(),S&&(X=s(1,1)+s(u(B),4)+O,P+="up"+s(X.length,2)+X),b&&(D=s(1,1)+s(u(et),4)+C,P+="uc"+s(D.length,2)+D);var ot="";return ot+=`
\0`,ot+=s(V,2),ot+=R.magic,ot+=s(v,2),ot+=s(I,2),ot+=s(ft.crc32,4),ot+=s(ft.compressedSize,4),ot+=s(ft.uncompressedSize,4),ot+=s(B.length,2),ot+=s(P.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ot+B+P,dirRecord:h.CENTRAL_FILE_HEADER+s(Et,2)+ot+s(et.length,2)+"\0\0\0\0"+s(z,4)+s(x,4)+B+P+et}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),h=n("../signature");function d(f,p,m,x){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=x,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,x=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-x-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(x){return h.DATA_DESCRIPTOR+s(x.crc32,4)+s(x.compressedSize,4)+s(x.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,x=function(w,T,v,I,U){var R=a.transformTo("string",U(I));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(T,4)+s(v,4)+s(R.length,2)+R}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:x,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(T,v){var I=T||v,U=s[I];if(!U)throw new Error(I+" is not a valid compression method !");return U}(f.options.compression,c.compression),m=f.options.compressionOptions||c.compressionOptions||{},x=f.dir,w=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:x,date:w,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(x){p(x)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(d,f){var p=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var x=new c(f);return x.load(m),x}).then(function(m){var x=[o.Promise.resolve(m)],w=m.files;if(f.checkCRC32)for(var T=0;T<w.length;T++)x.push(h(w[T]));return o.Promise.all(x)}).then(function(m){for(var x=m.shift(),w=x.files,T=0;T<w.length;T++){var v=w[T],I=v.fileNameStr,U=s.resolve(v.fileNameStr);p.file(U,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:f.createFolders}),v.dir||(p.file(U).unsafeOriginalName=I)}return x.zipComment.length&&(p.comment=x.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof tn<"u",newBufferFrom:function(s,o){if(tn.from&&tn.from!==Uint8Array.from)return tn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new tn(s,o)},allocBuffer:function(s){if(tn.alloc)return tn.alloc(s);var o=new tn(s);return o.fill(0),o},isBuffer:function(s){return tn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,R,L){var B,O=a.getTypeOf(R),Y=a.extend(L||{},u);Y.date=Y.date||new Date,Y.compression!==null&&(Y.compression=Y.compression.toUpperCase()),typeof Y.unixPermissions=="string"&&(Y.unixPermissions=parseInt(Y.unixPermissions,8)),Y.unixPermissions&&16384&Y.unixPermissions&&(Y.dir=!0),Y.dosPermissions&&16&Y.dosPermissions&&(Y.dir=!0),Y.dir&&(U=w(U)),Y.createFolders&&(B=x(U))&&T.call(this,B,!0);var et=O==="string"&&Y.binary===!1&&Y.base64===!1;L&&L.binary!==void 0||(Y.binary=!et),(R instanceof h&&R.uncompressedSize===0||Y.dir||!R||R.length===0)&&(Y.base64=!1,Y.binary=!0,R="",Y.compression="STORE",O="string");var C=null;C=R instanceof h||R instanceof c?R:p.isNode&&p.isStream(R)?new m(U,R):a.prepareContent(U,R,Y.binary,Y.optimizedBinaryString,Y.base64);var S=new d(U,C,Y);this.files[U]=S}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),h=n("./compressedObject"),d=n("./zipObject"),f=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),x=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var R=U.lastIndexOf("/");return 0<R?U.substring(0,R):""},w=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,R){return R=R!==void 0?R:u.createFolders,U=w(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:R}),this.files[U]};function v(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var R,L,B;for(R in this.files)B=this.files[R],(L=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&U(L,B)},filter:function(U){var R=[];return this.forEach(function(L,B){U(L,B)&&R.push(B)}),R},file:function(U,R,L){if(arguments.length!==1)return U=this.root+U,s.call(this,U,R,L),this;if(v(U)){var B=U;return this.filter(function(Y,et){return!et.dir&&B.test(Y)})}var O=this.files[this.root+U];return O&&!O.dir?O:null},folder:function(U){if(!U)return this;if(v(U))return this.filter(function(O,Y){return Y.dir&&U.test(O)});var R=this.root+U,L=T.call(this,R),B=this.clone();return B.root=L.name,B},remove:function(U){U=this.root+U;var R=this.files[U];if(R||(U.slice(-1)!=="/"&&(U+="/"),R=this.files[U]),R&&!R.dir)delete this.files[U];else for(var L=this.filter(function(O,Y){return Y.name.slice(0,U.length)===U}),B=0;B<L.length;B++)delete this.files[L[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var R,L={};try{if((L=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");a.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var B=L.comment||this.comment||"";R=f.generateWorker(this,L,B)}catch(O){(R=new c("error")).error(O)}return new l(R,L.type||"string",L.mimeType)},generateAsync:function(U,R){return this.generateInternalStream(U).accumulate(R)},generateNodeStream:function(U,R){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(R)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),h=null;if(l.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(x,w){var T=[],v=p._internalType,I=p._outputType,U=p._mimeType;p.on("data",function(R,L){T.push(R),m&&m(L)}).on("error",function(R){T=[],w(R)}).on("end",function(){try{var R=function(L,B,O){switch(L){case"blob":return s.newBlob(s.transformTo("arraybuffer",B),O);case"base64":return c.encode(B);default:return s.transformTo(L,B)}}(I,function(L,B){var O,Y=0,et=null,C=0;for(O=0;O<B.length;O++)C+=B[O].length;switch(L){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(et=new Uint8Array(C),O=0;O<B.length;O++)et.set(B[O],Y),Y+=B[O].length;return et;case"nodebuffer":return tn.concat(B);default:throw new Error("concat : unsupported type '"+L+"'")}}(v,T),U);x(R)}catch(L){w(L)}T=[]}).resume()})}function f(p,m,x){var w=m;switch(m){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=m,this._mimeType=x,s.checkSupport(w),this._worker=p.pipe(new o(w)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var x=this;return p==="data"?this._worker.on(p,function(w){m.call(x,w.data,w.meta)}):this._worker.on(p,function(){s.delay(m,arguments,x)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof tn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,x,w,T,v,I=p.length,U=0;for(T=0;T<I;T++)(64512&(x=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(w=p.charCodeAt(T+1)))==56320&&(x=65536+(x-55296<<10)+(w-56320),T++),U+=x<128?1:x<2048?2:x<65536?3:4;for(m=o.uint8array?new Uint8Array(U):new Array(U),T=v=0;v<U;T++)(64512&(x=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(w=p.charCodeAt(T+1)))==56320&&(x=65536+(x-55296<<10)+(w-56320),T++),x<128?m[v++]=x:(x<2048?m[v++]=192|x>>>6:(x<65536?m[v++]=224|x>>>12:(m[v++]=240|x>>>18,m[v++]=128|x>>>12&63),m[v++]=128|x>>>6&63),m[v++]=128|63&x);return m}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,x,w,T,v=p.length,I=new Array(2*v);for(m=x=0;m<v;)if((w=p[m++])<128)I[x++]=w;else if(4<(T=l[w]))I[x++]=65533,m+=T-1;else{for(w&=T===2?31:T===3?15:7;1<T&&m<v;)w=w<<6|63&p[m++],T--;1<T?I[x++]=65533:w<65536?I[x++]=w:(w-=65536,I[x++]=55296|w>>10&1023,I[x++]=56320|1023&w)}return I.length!==x&&(I.subarray?I=I.subarray(0,x):I.length=x),s.applyFromCharCode(I)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var p=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var x=function(T,v){var I;for((v=v||T.length)>T.length&&(v=T.length),I=v-1;0<=I&&(192&T[I])==128;)I--;return I<0||I===0?v:I+l[T[I]]>v?I:v}(p),w=p;x!==p.length&&(o.uint8array?(w=p.subarray(0,x),this.leftOver=p.subarray(x,p.length)):(w=p.slice(0,x),this.leftOver=p.slice(x,p.length))),this.push({data:i.utf8decode(w),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,x){for(var w=0;w<m.length;++w)x[w]=255&m.charCodeAt(w);return x}n("setimmediate"),i.newBlob=function(m,x){i.checkSupport("blob");try{return new Blob([m],{type:x})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(m),w.getBlob(x)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,x,w){var T=[],v=0,I=m.length;if(I<=w)return String.fromCharCode.apply(null,m);for(;v<I;)x==="array"||x==="nodebuffer"?T.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+w,I)))):T.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+w,I)))),v+=w;return T.join("")},stringifyByChar:function(m){for(var x="",w=0;w<m.length;w++)x+=String.fromCharCode(m[w]);return x},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var x=65536,w=i.getTypeOf(m),T=!0;if(w==="uint8array"?T=h.applyCanBeUsed.uint8array:w==="nodebuffer"&&(T=h.applyCanBeUsed.nodebuffer),T)for(;1<x;)try{return h.stringifyByChunk(m,w,x)}catch{x=Math.floor(x/2)}return h.stringifyByChar(m)}function f(m,x){for(var w=0;w<m.length;w++)x[w]=m[w];return x}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,x){if(x=x||"",!m)return x;i.checkSupport(m);var w=i.getTypeOf(x);return p[w][m](x)},i.resolve=function(m){for(var x=m.split("/"),w=[],T=0;T<x.length;T++){var v=x[T];v==="."||v===""&&T!==0&&T!==x.length-1||(v===".."?w.pop():w.push(v))}return w.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var x,w,T="";for(w=0;w<(m||"").length;w++)T+="\\x"+((x=m.charCodeAt(w))<16?"0":"")+x.toString(16).toUpperCase();return T},i.delay=function(m,x,w){setImmediate(function(){m.apply(w||null,x||[])})},i.inherits=function(m,x){function w(){}w.prototype=x.prototype,m.prototype=new w},i.extend=function(){var m,x,w={};for(m=0;m<arguments.length;m++)for(x in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],x)&&w[x]===void 0&&(w[x]=arguments[m][x]);return w},i.prepareContent=function(m,x,w,T,v){return c.Promise.resolve(x).then(function(I){return s.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,R){var L=new FileReader;L.onload=function(B){U(B.target.result)},L.onerror=function(B){R(B.target.error)},L.readAsArrayBuffer(I)}):I}).then(function(I){var U=i.getTypeOf(I);return U?(U==="arraybuffer"?I=i.transformTo("uint8array",I):U==="string"&&(v?I=o.decode(I):w&&T!==!0&&(I=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(I))),I):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),h=n("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(x){for(var w in u)if(Object.prototype.hasOwnProperty.call(u,w)&&u[w].magic===x)return u[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,x,w=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<w;)p=f.readInt(2),m=f.readInt(2),x=f.readData(m),this.extraFields[p]={id:p,length:m,value:x};f.setIndex(w)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var x=this.findExtraFieldUnicodeComment();if(x!==null)this.fileCommentStr=x;else{var w=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,x){this.name=p,this.dir=x.dir,this.date=x.date,this.comment=x.comment,this.unixPermissions=x.unixPermissions,this.dosPermissions=x.dosPermissions,this._data=m,this._dataBinary=x.binary,this.options={compression:x.compression,compressionOptions:x.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,x="string";try{if(!p)throw new Error("No output type specified.");var w=(x=p.toLowerCase())==="string"||x==="text";x!=="binarystring"&&x!=="text"||(x="string"),m=this._decompressWorker();var T=!this._dataBinary;T&&!w&&(m=m.pipe(new c.Utf8EncodeWorker)),!T&&w&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(v){(m=new u("error")).error(v)}return new o(m,x,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var x=this._decompressWorker();return this._dataBinary||(x=x.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(x,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,x;a=!0;for(var w=f.length;w;){for(x=f,f=[],m=-1;++m<w;)x[m]();w=f.length}a=!1}r.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof wn<"u"?wn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,w!==o&&m(this,w)}function d(w,T,v){this.promise=w,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function f(w,T,v){s(function(){var I;try{I=T(v)}catch(U){return a.reject(w,U)}I===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,I)})}function p(w){var T=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof T=="function")return function(){T.apply(w,arguments)}}function m(w,T){var v=!1;function I(L){v||(v=!0,a.reject(w,L))}function U(L){v||(v=!0,a.resolve(w,L))}var R=x(function(){T(U,I)});R.status==="error"&&I(R.value)}function x(w,T){var v={};try{v.value=w(T),v.status="success"}catch(I){v.status="error",v.value=I}return v}(r.exports=h).prototype.finally=function(w){if(typeof w!="function")return this;var T=this.constructor;return this.then(function(v){return T.resolve(w()).then(function(){return v})},function(v){return T.resolve(w()).then(function(){throw v})})},h.prototype.catch=function(w){return this.then(null,w)},h.prototype.then=function(w,T){if(typeof w!="function"&&this.state===l||typeof T!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==u?f(v,this.state===l?w:T,this.outcome):this.queue.push(new d(v,w,T)),v},d.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},d.prototype.otherCallFulfilled=function(w){f(this.promise,this.onFulfilled,w)},d.prototype.callRejected=function(w){a.reject(this.promise,w)},d.prototype.otherCallRejected=function(w){f(this.promise,this.onRejected,w)},a.resolve=function(w,T){var v=x(p,T);if(v.status==="error")return a.reject(w,v.value);var I=v.value;if(I)m(w,I);else{w.state=l,w.outcome=T;for(var U=-1,R=w.queue.length;++U<R;)w.queue[U].callFulfilled(T)}return w},a.reject=function(w,T){w.state=c,w.outcome=T;for(var v=-1,I=w.queue.length;++v<I;)w.queue[v].callRejected(T);return w},h.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},h.reject=function(w){var T=new this(o);return a.reject(T,w)},h.all=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=w.length,I=!1;if(!v)return this.resolve([]);for(var U=new Array(v),R=0,L=-1,B=new this(o);++L<v;)O(w[L],L);return B;function O(Y,et){T.resolve(Y).then(function(C){U[et]=C,++R!==v||I||(I=!0,a.resolve(B,U))},function(C){I||(I=!0,a.reject(B,C))})}},h.race=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=w.length,I=!1;if(!v)return this.resolve([]);for(var U=-1,R=new this(o);++U<v;)L=w[U],T.resolve(L).then(function(B){I||(I=!0,a.resolve(R,B))},function(B){I||(I=!0,a.reject(R,B))});var L;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(w){if(!(this instanceof m))return new m(w);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},w||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(v!==h)throw new Error(c[v]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var I;if(I=typeof T.dictionary=="string"?a.string2buf(T.dictionary):u.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(v=s.deflateSetDictionary(this.strm,I))!==h)throw new Error(c[v]);this._dict_set=!0}}function x(w,T){var v=new m(T);if(v.push(w,!0),v.err)throw v.msg||c[v.err];return v.result}m.prototype.push=function(w,T){var v,I,U=this.strm,R=this.options.chunkSize;if(this.ended)return!1;I=T===~~T?T:T===!0?4:0,typeof w=="string"?U.input=a.string2buf(w):u.call(w)==="[object ArrayBuffer]"?U.input=new Uint8Array(w):U.input=w,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(R),U.next_out=0,U.avail_out=R),(v=s.deflate(U,I))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&v!==1);return I===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):I!==2||(this.onEnd(h),!(U.avail_out=0))},m.prototype.onData=function(w){this.chunks.push(w)},m.prototype.onEnd=function(w){w===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=m,i.deflate=x,i.deflateRaw=function(w,T){return(T=T||{}).raw=!0,x(w,T)},i.gzip=function(w,T){return(T=T||{}).gzip=!0,x(w,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),h=n("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var x=this.options;x.raw&&0<=x.windowBits&&x.windowBits<16&&(x.windowBits=-x.windowBits,x.windowBits===0&&(x.windowBits=-15)),!(0<=x.windowBits&&x.windowBits<16)||m&&m.windowBits||(x.windowBits+=32),15<x.windowBits&&x.windowBits<48&&!(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,x.windowBits);if(w!==c.Z_OK)throw new Error(l[w]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,x){var w=new f(x);if(w.push(m,!0),w.err)throw w.msg||l[w.err];return w.result}f.prototype.push=function(m,x){var w,T,v,I,U,R,L=this.strm,B=this.options.chunkSize,O=this.options.dictionary,Y=!1;if(this.ended)return!1;T=x===~~x?x:x===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?L.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?L.input=new Uint8Array(m):L.input=m,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new o.Buf8(B),L.next_out=0,L.avail_out=B),(w=s.inflate(L,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&O&&(R=typeof O=="string"?a.string2buf(O):d.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,w=s.inflateSetDictionary(this.strm,R)),w===c.Z_BUF_ERROR&&Y===!0&&(w=c.Z_OK,Y=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&w!==c.Z_STREAM_END&&(L.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(L.output,L.next_out),I=L.next_out-v,U=a.buf2string(L.output,v),L.next_out=I,L.avail_out=B-I,I&&o.arraySet(L.output,L.output,v,I,0),this.onData(U)):this.onData(o.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(Y=!0)}while((0<L.avail_in||L.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(L.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(m,x){return(x=x||{}).raw=!0,p(m,x)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){var l,u,h,d,f,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)f=c[l],p.set(f,d),d+=f.length;return p}},a={arraySet:function(c,l,u,h,d){for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,p,m,x,w=h.length,T=0;for(m=0;m<w;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),T+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(T),m=x=0;x<T;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[x++]=f:(f<2048?d[x++]=192|f>>>6:(f<65536?d[x++]=224|f>>>12:(d[x++]=240|f>>>18,d[x++]=128|f>>>12&63),d[x++]=128|f>>>6&63),d[x++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,p,m,x,w=d||h.length,T=new Array(2*w);for(f=p=0;f<w;)if((m=h[f++])<128)T[p++]=m;else if(4<(x=c[m]))T[p++]=65533,f+=x-1;else{for(m&=x===2?31:x===3?15:7;1<x&&f<w;)m=m<<6|63&h[f++],x--;1<x?T[p++]=65533:m<65536?T[p++]=m:(m-=65536,T[p++]=55296|m>>10&1023,T[p++]=56320|1023&m)}return u(T,p)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),h=0,d=4,f=0,p=-2,m=-1,x=4,w=2,T=8,v=9,I=286,U=30,R=19,L=2*I+1,B=15,O=3,Y=258,et=Y+O+1,C=42,S=113,b=1,P=2,X=3,D=4;function ct(E,st){return E.msg=u[st],st}function tt(E){return(E<<1)-(4<E?9:0)}function ft(E){for(var st=E.length;0<=--st;)E[st]=0}function V(E){var st=E.state,nt=st.pending;nt>E.avail_out&&(nt=E.avail_out),nt!==0&&(o.arraySet(E.output,st.pending_buf,st.pending_out,nt,E.next_out),E.next_out+=nt,st.pending_out+=nt,E.total_out+=nt,E.avail_out-=nt,st.pending-=nt,st.pending===0&&(st.pending_out=0))}function z(E,st){a._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,st),E.block_start=E.strstart,V(E.strm)}function Et(E,st){E.pending_buf[E.pending++]=st}function ot(E,st){E.pending_buf[E.pending++]=st>>>8&255,E.pending_buf[E.pending++]=255&st}function lt(E,st){var nt,F,M=E.max_chain_length,K=E.strstart,at=E.prev_length,ht=E.nice_match,Z=E.strstart>E.w_size-et?E.strstart-(E.w_size-et):0,pt=E.window,_t=E.w_mask,dt=E.prev,vt=E.strstart+Y,ce=pt[K+at-1],Ft=pt[K+at];E.prev_length>=E.good_match&&(M>>=2),ht>E.lookahead&&(ht=E.lookahead);do if(pt[(nt=st)+at]===Ft&&pt[nt+at-1]===ce&&pt[nt]===pt[K]&&pt[++nt]===pt[K+1]){K+=2,nt++;do;while(pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&K<vt);if(F=Y-(vt-K),K=vt-Y,at<F){if(E.match_start=st,ht<=(at=F))break;ce=pt[K+at-1],Ft=pt[K+at]}}while((st=dt[st&_t])>Z&&--M!=0);return at<=E.lookahead?at:E.lookahead}function Lt(E){var st,nt,F,M,K,at,ht,Z,pt,_t,dt=E.w_size;do{if(M=E.window_size-E.lookahead-E.strstart,E.strstart>=dt+(dt-et)){for(o.arraySet(E.window,E.window,dt,dt,0),E.match_start-=dt,E.strstart-=dt,E.block_start-=dt,st=nt=E.hash_size;F=E.head[--st],E.head[st]=dt<=F?F-dt:0,--nt;);for(st=nt=dt;F=E.prev[--st],E.prev[st]=dt<=F?F-dt:0,--nt;);M+=dt}if(E.strm.avail_in===0)break;if(at=E.strm,ht=E.window,Z=E.strstart+E.lookahead,pt=M,_t=void 0,_t=at.avail_in,pt<_t&&(_t=pt),nt=_t===0?0:(at.avail_in-=_t,o.arraySet(ht,at.input,at.next_in,_t,Z),at.state.wrap===1?at.adler=c(at.adler,ht,_t,Z):at.state.wrap===2&&(at.adler=l(at.adler,ht,_t,Z)),at.next_in+=_t,at.total_in+=_t,_t),E.lookahead+=nt,E.lookahead+E.insert>=O)for(K=E.strstart-E.insert,E.ins_h=E.window[K],E.ins_h=(E.ins_h<<E.hash_shift^E.window[K+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[K+O-1])&E.hash_mask,E.prev[K&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=K,K++,E.insert--,!(E.lookahead+E.insert<O)););}while(E.lookahead<et&&E.strm.avail_in!==0)}function Xt(E,st){for(var nt,F;;){if(E.lookahead<et){if(Lt(E),E.lookahead<et&&st===h)return b;if(E.lookahead===0)break}if(nt=0,E.lookahead>=O&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+O-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),nt!==0&&E.strstart-nt<=E.w_size-et&&(E.match_length=lt(E,nt)),E.match_length>=O)if(F=a._tr_tally(E,E.strstart-E.match_start,E.match_length-O),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=O){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+O-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else F=a._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(F&&(z(E,!1),E.strm.avail_out===0))return b}return E.insert=E.strstart<O-1?E.strstart:O-1,st===d?(z(E,!0),E.strm.avail_out===0?X:D):E.last_lit&&(z(E,!1),E.strm.avail_out===0)?b:P}function Mt(E,st){for(var nt,F,M;;){if(E.lookahead<et){if(Lt(E),E.lookahead<et&&st===h)return b;if(E.lookahead===0)break}if(nt=0,E.lookahead>=O&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+O-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=O-1,nt!==0&&E.prev_length<E.max_lazy_match&&E.strstart-nt<=E.w_size-et&&(E.match_length=lt(E,nt),E.match_length<=5&&(E.strategy===1||E.match_length===O&&4096<E.strstart-E.match_start)&&(E.match_length=O-1)),E.prev_length>=O&&E.match_length<=E.prev_length){for(M=E.strstart+E.lookahead-O,F=a._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-O),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=M&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+O-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=O-1,E.strstart++,F&&(z(E,!1),E.strm.avail_out===0))return b}else if(E.match_available){if((F=a._tr_tally(E,0,E.window[E.strstart-1]))&&z(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return b}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(F=a._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<O-1?E.strstart:O-1,st===d?(z(E,!0),E.strm.avail_out===0?X:D):E.last_lit&&(z(E,!1),E.strm.avail_out===0)?b:P}function kt(E,st,nt,F,M){this.good_length=E,this.max_lazy=st,this.nice_length=nt,this.max_chain=F,this.func=M}function Bt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*L),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(B+1),this.heap=new o.Buf16(2*I+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*I+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ut(E){var st;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=w,(st=E.state).pending=0,st.pending_out=0,st.wrap<0&&(st.wrap=-st.wrap),st.status=st.wrap?C:S,E.adler=st.wrap===2?0:1,st.last_flush=h,a._tr_init(st),f):ct(E,p)}function we(E){var st=Ut(E);return st===f&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,nt.ins_h=0}(E.state),st}function Ne(E,st,nt,F,M,K){if(!E)return p;var at=1;if(st===m&&(st=6),F<0?(at=0,F=-F):15<F&&(at=2,F-=16),M<1||v<M||nt!==T||F<8||15<F||st<0||9<st||K<0||x<K)return ct(E,p);F===8&&(F=9);var ht=new Bt;return(E.state=ht).strm=E,ht.wrap=at,ht.gzhead=null,ht.w_bits=F,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=M+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+O-1)/O),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<M+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=st,ht.strategy=K,ht.method=nt,we(E)}s=[new kt(0,0,0,0,function(E,st){var nt=65535;for(nt>E.pending_buf_size-5&&(nt=E.pending_buf_size-5);;){if(E.lookahead<=1){if(Lt(E),E.lookahead===0&&st===h)return b;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var F=E.block_start+nt;if((E.strstart===0||E.strstart>=F)&&(E.lookahead=E.strstart-F,E.strstart=F,z(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-et&&(z(E,!1),E.strm.avail_out===0))return b}return E.insert=0,st===d?(z(E,!0),E.strm.avail_out===0?X:D):(E.strstart>E.block_start&&(z(E,!1),E.strm.avail_out),b)}),new kt(4,4,8,4,Xt),new kt(4,5,16,8,Xt),new kt(4,6,32,32,Xt),new kt(4,4,16,16,Mt),new kt(8,16,32,32,Mt),new kt(8,16,128,128,Mt),new kt(8,32,128,256,Mt),new kt(32,128,258,1024,Mt),new kt(32,258,258,4096,Mt)],i.deflateInit=function(E,st){return Ne(E,st,T,15,8,0)},i.deflateInit2=Ne,i.deflateReset=we,i.deflateResetKeep=Ut,i.deflateSetHeader=function(E,st){return E&&E.state?E.state.wrap!==2?p:(E.state.gzhead=st,f):p},i.deflate=function(E,st){var nt,F,M,K;if(!E||!E.state||5<st||st<0)return E?ct(E,p):p;if(F=E.state,!E.output||!E.input&&E.avail_in!==0||F.status===666&&st!==d)return ct(E,E.avail_out===0?-5:p);if(F.strm=E,nt=F.last_flush,F.last_flush=st,F.status===C)if(F.wrap===2)E.adler=0,Et(F,31),Et(F,139),Et(F,8),F.gzhead?(Et(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),Et(F,255&F.gzhead.time),Et(F,F.gzhead.time>>8&255),Et(F,F.gzhead.time>>16&255),Et(F,F.gzhead.time>>24&255),Et(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),Et(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(Et(F,255&F.gzhead.extra.length),Et(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(E.adler=l(E.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(Et(F,0),Et(F,0),Et(F,0),Et(F,0),Et(F,0),Et(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),Et(F,3),F.status=S);else{var at=T+(F.w_bits-8<<4)<<8;at|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(at|=32),at+=31-at%31,F.status=S,ot(F,at),F.strstart!==0&&(ot(F,E.adler>>>16),ot(F,65535&E.adler)),E.adler=1}if(F.status===69)if(F.gzhead.extra){for(M=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>M&&(E.adler=l(E.adler,F.pending_buf,F.pending-M,M)),V(E),M=F.pending,F.pending!==F.pending_buf_size));)Et(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>M&&(E.adler=l(E.adler,F.pending_buf,F.pending-M,M)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(E.adler=l(E.adler,F.pending_buf,F.pending-M,M)),V(E),M=F.pending,F.pending===F.pending_buf_size)){K=1;break}K=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,Et(F,K)}while(K!==0);F.gzhead.hcrc&&F.pending>M&&(E.adler=l(E.adler,F.pending_buf,F.pending-M,M)),K===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(E.adler=l(E.adler,F.pending_buf,F.pending-M,M)),V(E),M=F.pending,F.pending===F.pending_buf_size)){K=1;break}K=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,Et(F,K)}while(K!==0);F.gzhead.hcrc&&F.pending>M&&(E.adler=l(E.adler,F.pending_buf,F.pending-M,M)),K===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&V(E),F.pending+2<=F.pending_buf_size&&(Et(F,255&E.adler),Et(F,E.adler>>8&255),E.adler=0,F.status=S)):F.status=S),F.pending!==0){if(V(E),E.avail_out===0)return F.last_flush=-1,f}else if(E.avail_in===0&&tt(st)<=tt(nt)&&st!==d)return ct(E,-5);if(F.status===666&&E.avail_in!==0)return ct(E,-5);if(E.avail_in!==0||F.lookahead!==0||st!==h&&F.status!==666){var ht=F.strategy===2?function(Z,pt){for(var _t;;){if(Z.lookahead===0&&(Lt(Z),Z.lookahead===0)){if(pt===h)return b;break}if(Z.match_length=0,_t=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,_t&&(z(Z,!1),Z.strm.avail_out===0))return b}return Z.insert=0,pt===d?(z(Z,!0),Z.strm.avail_out===0?X:D):Z.last_lit&&(z(Z,!1),Z.strm.avail_out===0)?b:P}(F,st):F.strategy===3?function(Z,pt){for(var _t,dt,vt,ce,Ft=Z.window;;){if(Z.lookahead<=Y){if(Lt(Z),Z.lookahead<=Y&&pt===h)return b;if(Z.lookahead===0)break}if(Z.match_length=0,Z.lookahead>=O&&0<Z.strstart&&(dt=Ft[vt=Z.strstart-1])===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]){ce=Z.strstart+Y;do;while(dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&vt<ce);Z.match_length=Y-(ce-vt),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=O?(_t=a._tr_tally(Z,1,Z.match_length-O),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(_t=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),_t&&(z(Z,!1),Z.strm.avail_out===0))return b}return Z.insert=0,pt===d?(z(Z,!0),Z.strm.avail_out===0?X:D):Z.last_lit&&(z(Z,!1),Z.strm.avail_out===0)?b:P}(F,st):s[F.level].func(F,st);if(ht!==X&&ht!==D||(F.status=666),ht===b||ht===X)return E.avail_out===0&&(F.last_flush=-1),f;if(ht===P&&(st===1?a._tr_align(F):st!==5&&(a._tr_stored_block(F,0,0,!1),st===3&&(ft(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),V(E),E.avail_out===0))return F.last_flush=-1,f}return st!==d?f:F.wrap<=0?1:(F.wrap===2?(Et(F,255&E.adler),Et(F,E.adler>>8&255),Et(F,E.adler>>16&255),Et(F,E.adler>>24&255),Et(F,255&E.total_in),Et(F,E.total_in>>8&255),Et(F,E.total_in>>16&255),Et(F,E.total_in>>24&255)):(ot(F,E.adler>>>16),ot(F,65535&E.adler)),V(E),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?f:1)},i.deflateEnd=function(E){var st;return E&&E.state?(st=E.state.status)!==C&&st!==69&&st!==73&&st!==91&&st!==103&&st!==S&&st!==666?ct(E,p):(E.state=null,st===S?ct(E,-3):f):p},i.deflateSetDictionary=function(E,st){var nt,F,M,K,at,ht,Z,pt,_t=st.length;if(!E||!E.state||(K=(nt=E.state).wrap)===2||K===1&&nt.status!==C||nt.lookahead)return p;for(K===1&&(E.adler=c(E.adler,st,_t,0)),nt.wrap=0,_t>=nt.w_size&&(K===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),pt=new o.Buf8(nt.w_size),o.arraySet(pt,st,_t-nt.w_size,nt.w_size,0),st=pt,_t=nt.w_size),at=E.avail_in,ht=E.next_in,Z=E.input,E.avail_in=_t,E.next_in=0,E.input=st,Lt(nt);nt.lookahead>=O;){for(F=nt.strstart,M=nt.lookahead-(O-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[F+O-1])&nt.hash_mask,nt.prev[F&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=F,F++,--M;);nt.strstart=F,nt.lookahead=O-1,Lt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,E.next_in=ht,E.input=Z,E.avail_in=at,nt.wrap=K,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,h,d,f,p,m,x,w,T,v,I,U,R,L,B,O,Y,et,C,S,b,P;a=s.state,c=s.next_in,b=s.input,l=c+(s.avail_in-5),u=s.next_out,P=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,x=a.wnext,w=a.window,T=a.hold,v=a.bits,I=a.lencode,U=a.distcode,R=(1<<a.lenbits)-1,L=(1<<a.distbits)-1;t:do{v<15&&(T+=b[c++]<<v,v+=8,T+=b[c++]<<v,v+=8),B=I[T&R];e:for(;;){if(T>>>=O=B>>>24,v-=O,(O=B>>>16&255)===0)P[u++]=65535&B;else{if(!(16&O)){if(!(64&O)){B=I[(65535&B)+(T&(1<<O)-1)];continue e}if(32&O){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}Y=65535&B,(O&=15)&&(v<O&&(T+=b[c++]<<v,v+=8),Y+=T&(1<<O)-1,T>>>=O,v-=O),v<15&&(T+=b[c++]<<v,v+=8,T+=b[c++]<<v,v+=8),B=U[T&L];n:for(;;){if(T>>>=O=B>>>24,v-=O,!(16&(O=B>>>16&255))){if(!(64&O)){B=U[(65535&B)+(T&(1<<O)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(et=65535&B,v<(O&=15)&&(T+=b[c++]<<v,(v+=8)<O&&(T+=b[c++]<<v,v+=8)),f<(et+=T&(1<<O)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=O,v-=O,(O=u-h)<et){if(m<(O=et-O)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(S=w,(C=0)===x){if(C+=p-O,O<Y){for(Y-=O;P[u++]=w[C++],--O;);C=u-et,S=P}}else if(x<O){if(C+=p+x-O,(O-=x)<Y){for(Y-=O;P[u++]=w[C++],--O;);if(C=0,x<Y){for(Y-=O=x;P[u++]=w[C++],--O;);C=u-et,S=P}}}else if(C+=x-O,O<Y){for(Y-=O;P[u++]=w[C++],--O;);C=u-et,S=P}for(;2<Y;)P[u++]=S[C++],P[u++]=S[C++],P[u++]=S[C++],Y-=3;Y&&(P[u++]=S[C++],1<Y&&(P[u++]=S[C++]))}else{for(C=u-et;P[u++]=P[C++],P[u++]=P[C++],P[u++]=P[C++],2<(Y-=3););Y&&(P[u++]=P[C++],1<Y&&(P[u++]=P[C++]))}break}}break}}while(c<l&&u<d);c-=Y=v>>3,T&=(1<<(v-=Y<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=T,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,h=2,d=0,f=-2,p=1,m=852,x=592;function w(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(C){var S;return C&&C.state?(S=C.state,C.total_in=C.total_out=S.total=0,C.msg="",S.wrap&&(C.adler=1&S.wrap),S.mode=p,S.last=0,S.havedict=0,S.dmax=32768,S.head=null,S.hold=0,S.bits=0,S.lencode=S.lendyn=new s.Buf32(m),S.distcode=S.distdyn=new s.Buf32(x),S.sane=1,S.back=-1,d):f}function I(C){var S;return C&&C.state?((S=C.state).wsize=0,S.whave=0,S.wnext=0,v(C)):f}function U(C,S){var b,P;return C&&C.state?(P=C.state,S<0?(b=0,S=-S):(b=1+(S>>4),S<48&&(S&=15)),S&&(S<8||15<S)?f:(P.window!==null&&P.wbits!==S&&(P.window=null),P.wrap=b,P.wbits=S,I(C))):f}function R(C,S){var b,P;return C?(P=new T,(C.state=P).window=null,(b=U(C,S))!==d&&(C.state=null),b):f}var L,B,O=!0;function Y(C){if(O){var S;for(L=new s.Buf32(512),B=new s.Buf32(32),S=0;S<144;)C.lens[S++]=8;for(;S<256;)C.lens[S++]=9;for(;S<280;)C.lens[S++]=7;for(;S<288;)C.lens[S++]=8;for(l(u,C.lens,0,288,L,0,C.work,{bits:9}),S=0;S<32;)C.lens[S++]=5;l(h,C.lens,0,32,B,0,C.work,{bits:5}),O=!1}C.lencode=L,C.lenbits=9,C.distcode=B,C.distbits=5}function et(C,S,b,P){var X,D=C.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new s.Buf8(D.wsize)),P>=D.wsize?(s.arraySet(D.window,S,b-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(P<(X=D.wsize-D.wnext)&&(X=P),s.arraySet(D.window,S,b-P,X,D.wnext),(P-=X)?(s.arraySet(D.window,S,b-P,P,0),D.wnext=P,D.whave=D.wsize):(D.wnext+=X,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=X))),0}i.inflateReset=I,i.inflateReset2=U,i.inflateResetKeep=v,i.inflateInit=function(C){return R(C,15)},i.inflateInit2=R,i.inflate=function(C,S){var b,P,X,D,ct,tt,ft,V,z,Et,ot,lt,Lt,Xt,Mt,kt,Bt,Ut,we,Ne,E,st,nt,F,M=0,K=new s.Buf8(4),at=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return f;(b=C.state).mode===12&&(b.mode=13),ct=C.next_out,X=C.output,ft=C.avail_out,D=C.next_in,P=C.input,tt=C.avail_in,V=b.hold,z=b.bits,Et=tt,ot=ft,st=d;t:for(;;)switch(b.mode){case p:if(b.wrap===0){b.mode=13;break}for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(2&b.wrap&&V===35615){K[b.check=0]=255&V,K[1]=V>>>8&255,b.check=a(b.check,K,2,0),z=V=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&V)<<8)+(V>>8))%31){C.msg="incorrect header check",b.mode=30;break}if((15&V)!=8){C.msg="unknown compression method",b.mode=30;break}if(z-=4,E=8+(15&(V>>>=4)),b.wbits===0)b.wbits=E;else if(E>b.wbits){C.msg="invalid window size",b.mode=30;break}b.dmax=1<<E,C.adler=b.check=1,b.mode=512&V?10:12,z=V=0;break;case 2:for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(b.flags=V,(255&b.flags)!=8){C.msg="unknown compression method",b.mode=30;break}if(57344&b.flags){C.msg="unknown header flags set",b.mode=30;break}b.head&&(b.head.text=V>>8&1),512&b.flags&&(K[0]=255&V,K[1]=V>>>8&255,b.check=a(b.check,K,2,0)),z=V=0,b.mode=3;case 3:for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.head&&(b.head.time=V),512&b.flags&&(K[0]=255&V,K[1]=V>>>8&255,K[2]=V>>>16&255,K[3]=V>>>24&255,b.check=a(b.check,K,4,0)),z=V=0,b.mode=4;case 4:for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.head&&(b.head.xflags=255&V,b.head.os=V>>8),512&b.flags&&(K[0]=255&V,K[1]=V>>>8&255,b.check=a(b.check,K,2,0)),z=V=0,b.mode=5;case 5:if(1024&b.flags){for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.length=V,b.head&&(b.head.extra_len=V),512&b.flags&&(K[0]=255&V,K[1]=V>>>8&255,b.check=a(b.check,K,2,0)),z=V=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(tt<(lt=b.length)&&(lt=tt),lt&&(b.head&&(E=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Array(b.head.extra_len)),s.arraySet(b.head.extra,P,D,lt,E)),512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,b.length-=lt),b.length))break t;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(tt===0)break t;for(lt=0;E=P[D+lt++],b.head&&E&&b.length<65536&&(b.head.name+=String.fromCharCode(E)),E&&lt<tt;);if(512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,E)break t}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(tt===0)break t;for(lt=0;E=P[D+lt++],b.head&&E&&b.length<65536&&(b.head.comment+=String.fromCharCode(E)),E&&lt<tt;);if(512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,E)break t}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V!==(65535&b.check)){C.msg="header crc mismatch",b.mode=30;break}z=V=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),C.adler=b.check=0,b.mode=12;break;case 10:for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}C.adler=b.check=w(V),z=V=0,b.mode=11;case 11:if(b.havedict===0)return C.next_out=ct,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,2;C.adler=b.check=1,b.mode=12;case 12:if(S===5||S===6)break t;case 13:if(b.last){V>>>=7&z,z-=7&z,b.mode=27;break}for(;z<3;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}switch(b.last=1&V,z-=1,3&(V>>>=1)){case 0:b.mode=14;break;case 1:if(Y(b),b.mode=20,S!==6)break;V>>>=2,z-=2;break t;case 2:b.mode=17;break;case 3:C.msg="invalid block type",b.mode=30}V>>>=2,z-=2;break;case 14:for(V>>>=7&z,z-=7&z;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if((65535&V)!=(V>>>16^65535)){C.msg="invalid stored block lengths",b.mode=30;break}if(b.length=65535&V,z=V=0,b.mode=15,S===6)break t;case 15:b.mode=16;case 16:if(lt=b.length){if(tt<lt&&(lt=tt),ft<lt&&(lt=ft),lt===0)break t;s.arraySet(X,P,D,lt,ct),tt-=lt,D+=lt,ft-=lt,ct+=lt,b.length-=lt;break}b.mode=12;break;case 17:for(;z<14;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(b.nlen=257+(31&V),V>>>=5,z-=5,b.ndist=1+(31&V),V>>>=5,z-=5,b.ncode=4+(15&V),V>>>=4,z-=4,286<b.nlen||30<b.ndist){C.msg="too many length or distance symbols",b.mode=30;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;z<3;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.lens[at[b.have++]]=7&V,V>>>=3,z-=3}for(;b.have<19;)b.lens[at[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,nt={bits:b.lenbits},st=l(0,b.lens,0,19,b.lencode,0,b.work,nt),b.lenbits=nt.bits,st){C.msg="invalid code lengths set",b.mode=30;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;kt=(M=b.lencode[V&(1<<b.lenbits)-1])>>>16&255,Bt=65535&M,!((Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(Bt<16)V>>>=Mt,z-=Mt,b.lens[b.have++]=Bt;else{if(Bt===16){for(F=Mt+2;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V>>>=Mt,z-=Mt,b.have===0){C.msg="invalid bit length repeat",b.mode=30;break}E=b.lens[b.have-1],lt=3+(3&V),V>>>=2,z-=2}else if(Bt===17){for(F=Mt+3;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}z-=Mt,E=0,lt=3+(7&(V>>>=Mt)),V>>>=3,z-=3}else{for(F=Mt+7;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}z-=Mt,E=0,lt=11+(127&(V>>>=Mt)),V>>>=7,z-=7}if(b.have+lt>b.nlen+b.ndist){C.msg="invalid bit length repeat",b.mode=30;break}for(;lt--;)b.lens[b.have++]=E}}if(b.mode===30)break;if(b.lens[256]===0){C.msg="invalid code -- missing end-of-block",b.mode=30;break}if(b.lenbits=9,nt={bits:b.lenbits},st=l(u,b.lens,0,b.nlen,b.lencode,0,b.work,nt),b.lenbits=nt.bits,st){C.msg="invalid literal/lengths set",b.mode=30;break}if(b.distbits=6,b.distcode=b.distdyn,nt={bits:b.distbits},st=l(h,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,nt),b.distbits=nt.bits,st){C.msg="invalid distances set",b.mode=30;break}if(b.mode=20,S===6)break t;case 20:b.mode=21;case 21:if(6<=tt&&258<=ft){C.next_out=ct,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,c(C,ot),ct=C.next_out,X=C.output,ft=C.avail_out,D=C.next_in,P=C.input,tt=C.avail_in,V=b.hold,z=b.bits,b.mode===12&&(b.back=-1);break}for(b.back=0;kt=(M=b.lencode[V&(1<<b.lenbits)-1])>>>16&255,Bt=65535&M,!((Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(kt&&!(240&kt)){for(Ut=Mt,we=kt,Ne=Bt;kt=(M=b.lencode[Ne+((V&(1<<Ut+we)-1)>>Ut)])>>>16&255,Bt=65535&M,!(Ut+(Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}V>>>=Ut,z-=Ut,b.back+=Ut}if(V>>>=Mt,z-=Mt,b.back+=Mt,b.length=Bt,kt===0){b.mode=26;break}if(32&kt){b.back=-1,b.mode=12;break}if(64&kt){C.msg="invalid literal/length code",b.mode=30;break}b.extra=15&kt,b.mode=22;case 22:if(b.extra){for(F=b.extra;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.length+=V&(1<<b.extra)-1,V>>>=b.extra,z-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;kt=(M=b.distcode[V&(1<<b.distbits)-1])>>>16&255,Bt=65535&M,!((Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(!(240&kt)){for(Ut=Mt,we=kt,Ne=Bt;kt=(M=b.distcode[Ne+((V&(1<<Ut+we)-1)>>Ut)])>>>16&255,Bt=65535&M,!(Ut+(Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}V>>>=Ut,z-=Ut,b.back+=Ut}if(V>>>=Mt,z-=Mt,b.back+=Mt,64&kt){C.msg="invalid distance code",b.mode=30;break}b.offset=Bt,b.extra=15&kt,b.mode=24;case 24:if(b.extra){for(F=b.extra;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.offset+=V&(1<<b.extra)-1,V>>>=b.extra,z-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){C.msg="invalid distance too far back",b.mode=30;break}b.mode=25;case 25:if(ft===0)break t;if(lt=ot-ft,b.offset>lt){if((lt=b.offset-lt)>b.whave&&b.sane){C.msg="invalid distance too far back",b.mode=30;break}Lt=lt>b.wnext?(lt-=b.wnext,b.wsize-lt):b.wnext-lt,lt>b.length&&(lt=b.length),Xt=b.window}else Xt=X,Lt=ct-b.offset,lt=b.length;for(ft<lt&&(lt=ft),ft-=lt,b.length-=lt;X[ct++]=Xt[Lt++],--lt;);b.length===0&&(b.mode=21);break;case 26:if(ft===0)break t;X[ct++]=b.length,ft--,b.mode=21;break;case 27:if(b.wrap){for(;z<32;){if(tt===0)break t;tt--,V|=P[D++]<<z,z+=8}if(ot-=ft,C.total_out+=ot,b.total+=ot,ot&&(C.adler=b.check=b.flags?a(b.check,X,ot,ct-ot):o(b.check,X,ot,ct-ot)),ot=ft,(b.flags?V:w(V))!==b.check){C.msg="incorrect data check",b.mode=30;break}z=V=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V!==(4294967295&b.total)){C.msg="incorrect length check",b.mode=30;break}z=V=0}b.mode=29;case 29:st=1;break t;case 30:st=-3;break t;case 31:return-4;case 32:default:return f}return C.next_out=ct,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,(b.wsize||ot!==C.avail_out&&b.mode<30&&(b.mode<27||S!==4))&&et(C,C.output,C.next_out,ot-C.avail_out)?(b.mode=31,-4):(Et-=C.avail_in,ot-=C.avail_out,C.total_in+=Et,C.total_out+=ot,b.total+=ot,b.wrap&&ot&&(C.adler=b.check=b.flags?a(b.check,X,ot,C.next_out-ot):o(b.check,X,ot,C.next_out-ot)),C.data_type=b.bits+(b.last?64:0)+(b.mode===12?128:0)+(b.mode===20||b.mode===15?256:0),(Et==0&&ot===0||S===4)&&st===d&&(st=-5),st)},i.inflateEnd=function(C){if(!C||!C.state)return f;var S=C.state;return S.window&&(S.window=null),C.state=null,d},i.inflateGetHeader=function(C,S){var b;return C&&C.state&&2&(b=C.state).wrap?((b.head=S).done=!1,d):f},i.inflateSetDictionary=function(C,S){var b,P=S.length;return C&&C.state?(b=C.state).wrap!==0&&b.mode!==11?f:b.mode===11&&o(1,S,P,0)!==b.check?-3:et(C,S,P,P)?(b.mode=31,-4):(b.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,d,f,p,m,x,w){var T,v,I,U,R,L,B,O,Y,et=w.bits,C=0,S=0,b=0,P=0,X=0,D=0,ct=0,tt=0,ft=0,V=0,z=null,Et=0,ot=new s.Buf16(16),lt=new s.Buf16(16),Lt=null,Xt=0;for(C=0;C<=15;C++)ot[C]=0;for(S=0;S<f;S++)ot[h[d+S]]++;for(X=et,P=15;1<=P&&ot[P]===0;P--);if(P<X&&(X=P),P===0)return p[m++]=20971520,p[m++]=20971520,w.bits=1,0;for(b=1;b<P&&ot[b]===0;b++);for(X<b&&(X=b),C=tt=1;C<=15;C++)if(tt<<=1,(tt-=ot[C])<0)return-1;if(0<tt&&(u===0||P!==1))return-1;for(lt[1]=0,C=1;C<15;C++)lt[C+1]=lt[C]+ot[C];for(S=0;S<f;S++)h[d+S]!==0&&(x[lt[h[d+S]]++]=S);if(L=u===0?(z=Lt=x,19):u===1?(z=o,Et-=257,Lt=a,Xt-=257,256):(z=c,Lt=l,-1),C=b,R=m,ct=S=V=0,I=-1,U=(ft=1<<(D=X))-1,u===1&&852<ft||u===2&&592<ft)return 1;for(;;){for(B=C-ct,Y=x[S]<L?(O=0,x[S]):x[S]>L?(O=Lt[Xt+x[S]],z[Et+x[S]]):(O=96,0),T=1<<C-ct,b=v=1<<D;p[R+(V>>ct)+(v-=T)]=B<<24|O<<16|Y|0,v!==0;);for(T=1<<C-1;V&T;)T>>=1;if(T!==0?(V&=T-1,V+=T):V=0,S++,--ot[C]==0){if(C===P)break;C=h[d+x[S]]}if(X<C&&(V&U)!==I){for(ct===0&&(ct=X),R+=b,tt=1<<(D=C-ct);D+ct<P&&!((tt-=ot[D+ct])<=0);)D++,tt<<=1;if(ft+=1<<D,u===1&&852<ft||u===2&&592<ft)return 1;p[I=V&U]=X<<24|D<<16|R-m|0}}return V!==0&&(p[R+V]=C-ct<<24|64<<16|0),w.bits=X,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(M){for(var K=M.length;0<=--K;)M[K]=0}var l=0,u=29,h=256,d=h+1+u,f=30,p=19,m=2*d+1,x=15,w=16,T=7,v=256,I=16,U=17,R=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],et=new Array(2*(d+2));c(et);var C=new Array(2*f);c(C);var S=new Array(512);c(S);var b=new Array(256);c(b);var P=new Array(u);c(P);var X,D,ct,tt=new Array(f);function ft(M,K,at,ht,Z){this.static_tree=M,this.extra_bits=K,this.extra_base=at,this.elems=ht,this.max_length=Z,this.has_stree=M&&M.length}function V(M,K){this.dyn_tree=M,this.max_code=0,this.stat_desc=K}function z(M){return M<256?S[M]:S[256+(M>>>7)]}function Et(M,K){M.pending_buf[M.pending++]=255&K,M.pending_buf[M.pending++]=K>>>8&255}function ot(M,K,at){M.bi_valid>w-at?(M.bi_buf|=K<<M.bi_valid&65535,Et(M,M.bi_buf),M.bi_buf=K>>w-M.bi_valid,M.bi_valid+=at-w):(M.bi_buf|=K<<M.bi_valid&65535,M.bi_valid+=at)}function lt(M,K,at){ot(M,at[2*K],at[2*K+1])}function Lt(M,K){for(var at=0;at|=1&M,M>>>=1,at<<=1,0<--K;);return at>>>1}function Xt(M,K,at){var ht,Z,pt=new Array(x+1),_t=0;for(ht=1;ht<=x;ht++)pt[ht]=_t=_t+at[ht-1]<<1;for(Z=0;Z<=K;Z++){var dt=M[2*Z+1];dt!==0&&(M[2*Z]=Lt(pt[dt]++,dt))}}function Mt(M){var K;for(K=0;K<d;K++)M.dyn_ltree[2*K]=0;for(K=0;K<f;K++)M.dyn_dtree[2*K]=0;for(K=0;K<p;K++)M.bl_tree[2*K]=0;M.dyn_ltree[2*v]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}function kt(M){8<M.bi_valid?Et(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}function Bt(M,K,at,ht){var Z=2*K,pt=2*at;return M[Z]<M[pt]||M[Z]===M[pt]&&ht[K]<=ht[at]}function Ut(M,K,at){for(var ht=M.heap[at],Z=at<<1;Z<=M.heap_len&&(Z<M.heap_len&&Bt(K,M.heap[Z+1],M.heap[Z],M.depth)&&Z++,!Bt(K,ht,M.heap[Z],M.depth));)M.heap[at]=M.heap[Z],at=Z,Z<<=1;M.heap[at]=ht}function we(M,K,at){var ht,Z,pt,_t,dt=0;if(M.last_lit!==0)for(;ht=M.pending_buf[M.d_buf+2*dt]<<8|M.pending_buf[M.d_buf+2*dt+1],Z=M.pending_buf[M.l_buf+dt],dt++,ht===0?lt(M,Z,K):(lt(M,(pt=b[Z])+h+1,K),(_t=L[pt])!==0&&ot(M,Z-=P[pt],_t),lt(M,pt=z(--ht),at),(_t=B[pt])!==0&&ot(M,ht-=tt[pt],_t)),dt<M.last_lit;);lt(M,v,K)}function Ne(M,K){var at,ht,Z,pt=K.dyn_tree,_t=K.stat_desc.static_tree,dt=K.stat_desc.has_stree,vt=K.stat_desc.elems,ce=-1;for(M.heap_len=0,M.heap_max=m,at=0;at<vt;at++)pt[2*at]!==0?(M.heap[++M.heap_len]=ce=at,M.depth[at]=0):pt[2*at+1]=0;for(;M.heap_len<2;)pt[2*(Z=M.heap[++M.heap_len]=ce<2?++ce:0)]=1,M.depth[Z]=0,M.opt_len--,dt&&(M.static_len-=_t[2*Z+1]);for(K.max_code=ce,at=M.heap_len>>1;1<=at;at--)Ut(M,pt,at);for(Z=vt;at=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Ut(M,pt,1),ht=M.heap[1],M.heap[--M.heap_max]=at,M.heap[--M.heap_max]=ht,pt[2*Z]=pt[2*at]+pt[2*ht],M.depth[Z]=(M.depth[at]>=M.depth[ht]?M.depth[at]:M.depth[ht])+1,pt[2*at+1]=pt[2*ht+1]=Z,M.heap[1]=Z++,Ut(M,pt,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],function(Ft,Mn){var A,g,y,N,$,Q,it=Mn.dyn_tree,jt=Mn.max_code,xe=Mn.stat_desc.static_tree,me=Mn.stat_desc.has_stree,ke=Mn.stat_desc.extra_bits,ae=Mn.stat_desc.extra_base,Ra=Mn.stat_desc.max_length,jl=0;for(N=0;N<=x;N++)Ft.bl_count[N]=0;for(it[2*Ft.heap[Ft.heap_max]+1]=0,A=Ft.heap_max+1;A<m;A++)Ra<(N=it[2*it[2*(g=Ft.heap[A])+1]+1]+1)&&(N=Ra,jl++),it[2*g+1]=N,jt<g||(Ft.bl_count[N]++,$=0,ae<=g&&($=ke[g-ae]),Q=it[2*g],Ft.opt_len+=Q*(N+$),me&&(Ft.static_len+=Q*(xe[2*g+1]+$)));if(jl!==0){do{for(N=Ra-1;Ft.bl_count[N]===0;)N--;Ft.bl_count[N]--,Ft.bl_count[N+1]+=2,Ft.bl_count[Ra]--,jl-=2}while(0<jl);for(N=Ra;N!==0;N--)for(g=Ft.bl_count[N];g!==0;)jt<(y=Ft.heap[--A])||(it[2*y+1]!==N&&(Ft.opt_len+=(N-it[2*y+1])*it[2*y],it[2*y+1]=N),g--)}}(M,K),Xt(pt,ce,M.bl_count)}function E(M,K,at){var ht,Z,pt=-1,_t=K[1],dt=0,vt=7,ce=4;for(_t===0&&(vt=138,ce=3),K[2*(at+1)+1]=65535,ht=0;ht<=at;ht++)Z=_t,_t=K[2*(ht+1)+1],++dt<vt&&Z===_t||(dt<ce?M.bl_tree[2*Z]+=dt:Z!==0?(Z!==pt&&M.bl_tree[2*Z]++,M.bl_tree[2*I]++):dt<=10?M.bl_tree[2*U]++:M.bl_tree[2*R]++,pt=Z,ce=(dt=0)===_t?(vt=138,3):Z===_t?(vt=6,3):(vt=7,4))}function st(M,K,at){var ht,Z,pt=-1,_t=K[1],dt=0,vt=7,ce=4;for(_t===0&&(vt=138,ce=3),ht=0;ht<=at;ht++)if(Z=_t,_t=K[2*(ht+1)+1],!(++dt<vt&&Z===_t)){if(dt<ce)for(;lt(M,Z,M.bl_tree),--dt!=0;);else Z!==0?(Z!==pt&&(lt(M,Z,M.bl_tree),dt--),lt(M,I,M.bl_tree),ot(M,dt-3,2)):dt<=10?(lt(M,U,M.bl_tree),ot(M,dt-3,3)):(lt(M,R,M.bl_tree),ot(M,dt-11,7));pt=Z,ce=(dt=0)===_t?(vt=138,3):Z===_t?(vt=6,3):(vt=7,4)}}c(tt);var nt=!1;function F(M,K,at,ht){ot(M,(l<<1)+(ht?1:0),3),function(Z,pt,_t,dt){kt(Z),Et(Z,_t),Et(Z,~_t),s.arraySet(Z.pending_buf,Z.window,pt,_t,Z.pending),Z.pending+=_t}(M,K,at)}i._tr_init=function(M){nt||(function(){var K,at,ht,Z,pt,_t=new Array(x+1);for(Z=ht=0;Z<u-1;Z++)for(P[Z]=ht,K=0;K<1<<L[Z];K++)b[ht++]=Z;for(b[ht-1]=Z,Z=pt=0;Z<16;Z++)for(tt[Z]=pt,K=0;K<1<<B[Z];K++)S[pt++]=Z;for(pt>>=7;Z<f;Z++)for(tt[Z]=pt<<7,K=0;K<1<<B[Z]-7;K++)S[256+pt++]=Z;for(at=0;at<=x;at++)_t[at]=0;for(K=0;K<=143;)et[2*K+1]=8,K++,_t[8]++;for(;K<=255;)et[2*K+1]=9,K++,_t[9]++;for(;K<=279;)et[2*K+1]=7,K++,_t[7]++;for(;K<=287;)et[2*K+1]=8,K++,_t[8]++;for(Xt(et,d+1,_t),K=0;K<f;K++)C[2*K+1]=5,C[2*K]=Lt(K,5);X=new ft(et,L,h+1,d,x),D=new ft(C,B,0,f,x),ct=new ft(new Array(0),O,0,p,T)}(),nt=!0),M.l_desc=new V(M.dyn_ltree,X),M.d_desc=new V(M.dyn_dtree,D),M.bl_desc=new V(M.bl_tree,ct),M.bi_buf=0,M.bi_valid=0,Mt(M)},i._tr_stored_block=F,i._tr_flush_block=function(M,K,at,ht){var Z,pt,_t=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=function(dt){var vt,ce=4093624447;for(vt=0;vt<=31;vt++,ce>>>=1)if(1&ce&&dt.dyn_ltree[2*vt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(dt.dyn_ltree[2*vt]!==0)return a;return o}(M)),Ne(M,M.l_desc),Ne(M,M.d_desc),_t=function(dt){var vt;for(E(dt,dt.dyn_ltree,dt.l_desc.max_code),E(dt,dt.dyn_dtree,dt.d_desc.max_code),Ne(dt,dt.bl_desc),vt=p-1;3<=vt&&dt.bl_tree[2*Y[vt]+1]===0;vt--);return dt.opt_len+=3*(vt+1)+5+5+4,vt}(M),Z=M.opt_len+3+7>>>3,(pt=M.static_len+3+7>>>3)<=Z&&(Z=pt)):Z=pt=at+5,at+4<=Z&&K!==-1?F(M,K,at,ht):M.strategy===4||pt===Z?(ot(M,2+(ht?1:0),3),we(M,et,C)):(ot(M,4+(ht?1:0),3),function(dt,vt,ce,Ft){var Mn;for(ot(dt,vt-257,5),ot(dt,ce-1,5),ot(dt,Ft-4,4),Mn=0;Mn<Ft;Mn++)ot(dt,dt.bl_tree[2*Y[Mn]+1],3);st(dt,dt.dyn_ltree,vt-1),st(dt,dt.dyn_dtree,ce-1)}(M,M.l_desc.max_code+1,M.d_desc.max_code+1,_t+1),we(M,M.dyn_ltree,M.dyn_dtree)),Mt(M),ht&&kt(M)},i._tr_tally=function(M,K,at){return M.pending_buf[M.d_buf+2*M.last_lit]=K>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&K,M.pending_buf[M.l_buf+M.last_lit]=255&at,M.last_lit++,K===0?M.dyn_ltree[2*at]++:(M.matches++,K--,M.dyn_ltree[2*(b[at]+h+1)]++,M.dyn_dtree[2*z(K)]++),M.last_lit===M.lit_bufsize-1},i._tr_align=function(M){ot(M,2,3),lt(M,v,et),function(K){K.bi_valid===16?(Et(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):8<=K.bi_valid&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)}(M)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,f={},p=!1,m=o.document,x=Object.getPrototypeOf&&Object.getPrototypeOf(o);x=x&&x.setTimeout?x:o,c={}.toString.call(o.process)==="[object process]"?function(I){vi.nextTick(function(){T(I)})}:function(){if(o.postMessage&&!o.importScripts){var I=!0,U=o.onmessage;return o.onmessage=function(){I=!1},o.postMessage("","*"),o.onmessage=U,I}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(I){o.postMessage(h+I,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(I){T(I.data)},function(I){u.port2.postMessage(I)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(I){var U=m.createElement("script");U.onreadystatechange=function(){T(I),U.onreadystatechange=null,l.removeChild(U),U=null},l.appendChild(U)}):function(I){setTimeout(T,0,I)},x.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var U=new Array(arguments.length-1),R=0;R<U.length;R++)U[R]=arguments[R+1];var L={callback:I,args:U};return f[d]=L,c(d),d++},x.clearImmediate=w}function w(I){delete f[I]}function T(I){if(p)setTimeout(T,0,I);else{var U=f[I];if(U){p=!0;try{(function(R){var L=R.callback,B=R.args;switch(B.length){case 0:L();break;case 1:L(B[0]);break;case 2:L(B[0],B[1]);break;case 3:L(B[0],B[1],B[2]);break;default:L.apply(a,B)}})(U)}finally{w(I),p=!1}}}}function v(I){I.source===o&&typeof I.data=="string"&&I.data.indexOf(h)===0&&T(+I.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof wn<"u"?wn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(t1);var m8=t1.exports,pd=Es(m8);const e1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(e1);var cr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},bo,va,ys;class g8{constructor(...t){bo.set(this,new Map),va.set(this,new Map),ys.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),cr(this,ys,"f").has(r)||cr(this,ys,"f").set(r,new Set);const s=cr(this,ys,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&cr(this,va,"f").set(r,a),o=!1,c)continue;const l=cr(this,bo,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);cr(this,bo,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:cr(this,bo,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&cr(this,va,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:cr(this,ys,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of cr(this,ys,"f").values())Object.freeze(t);return this}_getTestState(){return{types:cr(this,bo,"f"),extensions:cr(this,va,"f")}}}bo=new WeakMap,va=new WeakMap,ys=new WeakMap;var y8=new g8(e1)._freeze();function n1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return y8.getType(e)??"application/octet-stream"}async function _8(e,t,n){try{Zr(G,e,t.name);const r=await t.arrayBuffer();(await new pd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=n1(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{ge(G,e,"crash",c.message)})})}catch(r){ge(G,e,"crash",r.message)}}async function b8(e,t,n){try{Zr(G,t,e.name);const r=await e.arrayBuffer();n(new Uint8Array(r))}catch(r){ge(G,t,"crash",r.message)}}function r1(e,t){function n(r){if(k(t))switch(r){case"text/plain":t.text().then(i=>eu(G,e,void 0,"text",`file:${t.name}`,i)).catch(i=>ge(G,e,"crash",i.message));break;case"application/json":t.text().then(i=>eu(G,e,void 0,"json",`file:${t.name}`,i)).catch(i=>ge(G,e,"crash",i.message));break;case"application/zip":_8(e,t,i=>r1(e,i)).catch(i=>ge(G,e,"crash",i.message));break;case"application/octet-stream":b8(t,e,i=>eu(G,e,void 0,"binary",`file:${t.name}`,i)).catch(i=>ge(G,e,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=n1(t.name,new Uint8Array(i));if(s)n(s);else return ge(G,e,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>ge(G,e,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function Eo(e,t,n){function r(i){ge(e,t,"crash",i.message)}n().catch(r)}function E8(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function w8(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const x8=new Date("1980/09/02");async function i1(e){return console.info("saved",e),new Promise((t,n)=>{const r=new pd;for(let i=0;i<e.length;++i){const s=e[i],o=SL(s);if(o){const a=xT(o);k(a)&&r.file(s.id,a,{date:x8})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(w8(i))}).catch(n)})}async function k8(e){return new Promise((t,n)=>{const r=new pd;r.loadAsync(E8(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=RL(kT(c));k(l)&&i.push(l)}t(i)}).catch(n)})}const s1="$yellow$205$205$205$196";function o1(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Ve;function T8(){return!!Ve}function A8(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let h=i;h<=o;++h)for(let d=r;d<=s;++d){const f={x:d-r,y:h-i},p=Tn(e,{x:d,y:h});(p==null?void 0:p.category)===Hn.ISOBJECT?(l.push(Xe(xc(e,d,h))),Fr(p)!=="player"&&u.push({...Xe(p),...f,id:"blank"})):l.push({...Xe(p),...f})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}function v8(e,t,n,r){const i=Kn(e);if(k(i))switch(Ve=A8(i,t,n),r){case"copyobjects":Ve.terrain=[];break;case"copyterrain":Ve.objects=[];break}}function S8(e,t,n){const r=o1(t,n);ie(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ie(e,s1),Dt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Dt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Dt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=En(e);i.scroll=qr(e)}function R8(e,t,n,r){const i=Kn(e);if(!k(i)||!k(Ve))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),l=a-s+1,u=c-o+1,h=Math.min(Ve.width,l),d=Math.min(Ve.height,u);switch(r){case"pasteall":{for(let f=0;f<d;++f)for(let p=0;p<h;++p){const m=js({x:p,y:f},Ve.width);dr(i,{...Ve.terrain[m],x:s+p,y:o+f})}for(let f=0;f<Ve.objects.length;++f){const p=Ve.objects[f];k(p.x)&&k(p.y)&&Ju(p.x,p.y,0,l-1,u-1,0)&&_h(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let f=0;f<Ve.objects.length;++f){const p=Ve.objects[f];k(p.x)&&k(p.y)&&Ju(p.x,p.y,0,l-1,u-1,0)&&_h(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let f=0;f<d;++f)for(let p=0;p<h;++p){const m=js({x:p,y:f},Ve.width);dr(i,{...Ve.terrain[m],x:s+p,y:o+f})}break;case"pasteterraintiled":for(let f=o;f<=c;++f)for(let p=s;p<=a;++p){const m=(p-s)%Ve.width,x=(f-o)%Ve.height,w=js({x:m,y:x},Ve.width);dr(i,{...Ve.terrain[w],x:p,y:f})}break}}function I8(e,t,n){const r=o1(t,n);ie(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ie(e,s1),Dt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Dt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Dt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Dt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=En(e);i.scroll=qr(e)}const _s="$yellow$205$205$205$196";function $l(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function N8(e,t,n,r){const i=Kn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){Rt(u)&&(s=u,Np(t.x,t.y,n.x,n.y).forEach(h=>{const d=Tn(i,h);k(d)&&(d[l]=u)}))}ie(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ie(e,_s),Dt(e,`batch:${$l(t,n)}`,"char",[r,"charedit"],o,a);const c=En(e);c.scroll=qr(e)}function O8(e,t,n,r){const i=Kn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){if(Rt(u)){s=u;for(let h=t.y;h<=n.y;++h)for(let d=t.x;d<=n.x;++d){const f=Tn(i,{x:d,y:h});k(f)&&(f[l]=u)}}}ie(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ie(e,_s),Dt(e,`batch:${$l(t,n)}`,"color",[r,"coloredit"],o,a);const c=En(e);c.scroll=qr(e)}function C8(e,t,n,r){const i=Kn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){Rt(u)&&(s=u,Np(t.x,t.y,n.x,n.y).forEach(h=>{const d=Tn(i,h);k(d)&&(d[l]=u)}))}ie(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ie(e,_s),Dt(e,`batch:${$l(t,n)}`,"color",[r,"coloredit"],o,a);const c=En(e);c.scroll=qr(e)}const Sa={stat:"",patternsize:2,mirror:1};function L8(e,t,n){const r=bn(Pt.MAIN);if(!k(r))return;const i=Kn(e);if(!k(i))return;const s=$l(t,n);ie(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ie(e,_s),Dt(e,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),T8()&&Dt(e,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),Dt(e,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(f){const{target:p}=lr(f);return Sa[p]}function a(f,p){if(Rt(p)||At(p)){const{target:m}=lr(f);Sa[m]=p}}Dt(e,"batch","remix",[`stat:${s}`,"text"],o,a),Dt(e,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),Dt(e,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),Dt(e,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),ie(e,_s),Dt(e,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),Dt(e,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),Dt(e,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),ie(e,_s),Dt(e,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),ie(e,_s),ie(e,"codepages:");const c=Math.min(t.x,n.x),l=Math.min(t.y,n.y),u=Math.max(t.x,n.x),h=Math.max(t.y,n.y),d=new Set;for(let f=l;f<=h;++f)for(let p=c;p<=u;++p){const m=Tn(i,{x:p,y:f}),x=D_(r,m);k(x)&&!d.has(x.id)&&(d.add(x.id),Dt(e,"batch",`edit @${Ue(x)}`,[`pageopen:${x.id}`]))}}const wo="$yellow$205$205$205$196";function md(e,t){return`inspect:${t!=null&&t.id?t.id:fr(e,t)}`}function M8(e,t,n){const r=bn(Pt.MAIN);if(!k(r))return;const i=Kn(e);if(!k(i))return;function s(d){var p;return(t==null?void 0:t[d])??((p=t==null?void 0:t.kinddata)==null?void 0:p[d])??0}function o(d,f){k(t)&&(t[d]=f)}const a=t.category===Hn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=md(i,t);ie(e,`${a}: ${c} ${l}`),ie(e,wo),Dt(e,u,"color",[n,"coloredit"],s,o);const h=En(e);h.scroll=qr(e)}function U8(e,t,n){const r=bn(Pt.MAIN);if(!k(r))return;const i=Kn(e);if(!k(i))return;function s(d){var p;return(t==null?void 0:t[d])??((p=t==null?void 0:t.kinddata)==null?void 0:p[d])??0}function o(d,f){k(t)&&(t[d]=f)}const a=t.category===Hn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=md(i,t);ie(e,`${a}: ${c} ${l}`),ie(e,wo),Dt(e,u,"char",[n,"charedit"],s,o);const h=En(e);h.scroll=qr(e)}function F8(e,t,n,r,i,s){var h,d,f;function o(p){var x;const m=(r==null?void 0:r[p])??((x=r==null?void 0:r.kinddata)==null?void 0:x[p]);if(!k(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Ht.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){k(r)&&(r[p]=m)}s?ie(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ie(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ie(e,wo);const c=md(t,r);s?(Dt(e,c,"cycle",["cycle","number","1","255"],o,a),Dt(e,c,"collision",["collision","select","iswalking",`${Ht.ISWALK}`,"isswimming",`${Ht.ISSWIM}`],o,a)):Dt(e,c,"collision",["collision","select","iswalkable",`${Ht.ISWALK}`,"isswimable",`${Ht.ISSWIM}`,"issolid",`${Ht.ISSOLID}`],o,a),s&&Dt(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Dt(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const l=ga(n),u=Gn(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(oe(l[m])){const[x,w,...T]=l[m];At(w)&&Dt(e,c,w||m,[m,x,...T],o,a)}break}}Dt(e,c,"copy coords",["copycoords","hk","5"," 5 "]),ie(e,wo),Dt(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),Dt(e,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),Dt(e,c,`bg: ${r.bg??((f=r.kinddata)==null?void 0:f.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ie(e,wo),Dt(e,c,"make empty",["empty","hk","0"],o,a),ie(e,wo),Dt(e,"batch",`edit @${Ue(n)}`,[`pageopen:${n.id}`])}const a1="$yellow$205$205$205$196";function P8(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function B8(e,t,n,r){const i=bn(Pt.MAIN);if(!k(i))return;const s=Kn(e);if(k(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Tn(s,{x:a,y:o});(c==null?void 0:c.category)===Hn.ISOBJECT&&Hr(i,s,c,i.timestamp),dr(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Tn(s,{x:a,y:o});(c==null?void 0:c.category)===Hn.ISOBJECT&&Hr(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)dr(s,{x:a,y:o});break}}}function D8(e,t,n){const r=P8(t,n);ie(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ie(e,a1),Dt(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Dt(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Dt(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=En(e);i.scroll=qr(e)}function $8(e,t,n){const r=bn(Pt.MAIN);if(!k(r))return;const i=Kn(e);if(!k(i))return;if(xr(r,i),t.x===n.x&&t.y===n.y){const o=Tn(i,t),a=D_(r,o);k(o)&&k(a)&&F8(e,i,a,o,t,Yo(o)),o!=null&&o.kind||(ie(e,`empty: ${t.x}, ${t.y}`),ie(e,a1),Dt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]))}else L8(e,t,n);const s=En(e);s.scroll=qr(e)}function j8(e,t){const n=le(Pt.MAIN);if(!k(n))return;const r=Kn(t);if(!k(r))return;const i=lr(e),s=RT(r,i.target);if(k(s))switch(i.path){case"copycoords":Ql(G,Xr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":M8(t,s,i.path);break;case"char":U8(t,s,i.path);break;case"empty":Hr(n,r,s,n.timestamp);break;case"code":Eo(G,t,async()=>{const o=Fr(s),a="object";De(G,t,`opened [${a}] ${o}`);const c=[r.id,s.id];qu(Ca(n.id,c),s.code??""),uE(G,t),await Fd(800),Ld(G,t,n.id,c,a,`${o} - ${n.name}`,[])});break;default:console.info("unknown inspect",i);break}}function z8(e,t){const n=Kn(t);if(!k(n))return;const r=lr(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:i,y:s},l={x:o,y:a};switch(r.target){case"copy":S8(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":v8(t,c,l,r.target);break;case"paste":I8(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":R8(t,c,l,r.target);break;case"empty":D8(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":B8(t,c,l,r.target);break;case"chars":N8(t,c,l,"char");break;case"colors":O8(t,c,l,"color");break;case"bgs":C8(t,c,l,"bg");break;case"copycoords":Ql(G,t,[i,s,o,a].join(" "));break;case"remixrun":$f(n.id,Sa.stat,Sa.patternsize,Sa.mirror,c,l);break;case"pageopen":Eo(G,t,async()=>{await Fd(800),IE(G,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const W8=16,bs={},K8=15*60*5;let c1=0;const xo={},ko={};async function l1(e){const t=go(),n=le(Pt.MAIN);if(t.length&&k(n)){const r=await i1(t),i=e?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;dE(se,Xr(),i,r)}}async function G8(){const e=go(),t=le(Pt.MAIN);if(e.length&&k(t)){const n=await i1(e);pE(se,Xr(),n)}}const se=xs("vm",["tick","second"],e=>{var n;if(!se.session(e))return;const t=Xr();switch(e.target){case"operator":GM(e.player),$t(se,e.player,`operator set to ${e.player}`),se.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=le(Pt.MAIN);se.replynext(e,"ackzsswords",{cli:Qf($i.CLI),loader:Qf($i.LOADER),runtime:Qf($i.RUNTIME),flags:[...Gn(gs(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...hs(r,bt.OBJECT).map(i=>Ue(i)),...Gn(Xf)],altkinds:[...hs(r,bt.TERRAIN),...hs(r,bt.BOARD),...hs(r,bt.PALETTE),...hs(r,bt.CHARSET),...hs(r,bt.LOADER)].map(i=>Ue(i)),colors:[...Gn(zo)],dirs:[...Gn(ih).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Gn(qf)]});break}case"books":e.player===t&&Eo(se,e.player,async()=>{if(oe(e.data)){const[r,i]=e.data,s=await k8(r),o=s.map(a=>a.name);JM(s,i),$t(se,e.player,`loading ${o.join(", ")}`),Zl(se,e.player)}});break;case"search":e8(e.player)||Zl(se,e.player);break;case"logout":t8(e.player),delete bs[e.player],$t(se,t,`player ${e.player} logout`),Zl(se,e.player);break;case"login":QM(e.player)?(bs[e.player]=0,$t(se,Xr(),`login from ${e.player}`),se.replynext(e,"acklogin",!0)):fE(se,e.player);break;case"doot":bs[e.player]=0,Nd(se,e.player,"active");break;case"input":{const r=gs(e.player),[i=mn.NONE,s=0]=e.data??[mn.NONE,0];oe(r.inputqueue)||(r.inputqueue=[]),i!==mn.NONE&&r.inputqueue.push([i,s]);break}case"codewatch":if(oe(e.data)){const[r,i]=e.data,s=Ca(r,i);k(ko[s])||(ko[s]=Rp(s,o=>{const[a,c]=i,l=kr(r),u=yi(l,a);if(k(u))if(mi(u)===bt.BOARD&&k(c)){const h=ln(u),d=pn(h,c);k(d)&&(d.code=o,Of(M_(o),d))}else u.code=o,vL(u)})),xo[s]=xo[s]??new Set,xo[s].add(e.player)}break;case"coderelease":if(oe(e.data)){const[r,i]=e.data,[,s]=i,o=Ca(r,i);k(xo[o])&&(xo[o].delete(e.player),xo[o].size===0&&((n=ko[o])==null||n.call(ko),ko[o]=void 0,At(s)&&i8(s)))}break;case"halt":e.player===t&&Y1(e.data)&&HM(e.data);break;case"tick":YM()||o8();break;case"synthsend":At(e.data)&&hd(e.data,void 0);break;case"second":{n8(bs);const r=Object.keys(bs);for(let i=0;i<r.length;++i)++bs[r[i]];for(let i=0;i<r.length;++i){const s=r[i];bs[s]>=W8&&Md(se,s)}++c1>=K8&&(c1=0,Eo(se,e.player,async()=>{await l1(!0)}));break}case"copyjsonfile":if(e.player===t){const r=le(Pt.MAIN);if(k(r)&&oe(e.data)){const[i]=e.data,s=yi(r,i);k(s)&&mE(se,t,s,`${Ue(s)}.${gi(s)}.json`)}}break;case"refsheet":{const r=le(Pt.MAIN),i=El(r);k(r)&&oe(e.data)&&(RE(se,e.player),ds(se,e.player,"use as refsheet"),i.forEach(s=>{const o=Ue(s),a=gi(s);$t(se,e.player,`!pageopenwith ${s.id} ${e.data.join(" ")};$blue[${a}]$white ${o}`)}));break}case"fork":e.player===t&&Eo(se,e.player,async()=>{await G8()});break;case"flush":e.player===t&&Eo(se,e.player,async()=>{await l1()});break;case"cli":a8(e.player,e.data);break;case"restart":e.player===t&&(s8(),Ud(se,e.player));break;case"inspect":if(oe(e.data)){const[r,i]=e.data;$8(e.player,r,i)}break;case"loader":if(oe(e.data)){const[r,i,s,o]=e.data;if(i==="file")r1(e.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){$t(se,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=le(Pt.MAIN);k(c)&&k(a.data)&&At(a.exported)&&(ld(a.data),$t(se,e.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){$t(se,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=le(Pt.MAIN);k(c)&&k(a.data)&&At(a.exported)&&($_(c,a.data),$t(se,e.player,`loaded ${a.exported}`))}else S6(r,i,s,o,e.player)}break;default:{const{target:r,path:i}=lr(e.target);switch(Ct(r)){case"batch":z8(i,e.player);break;case"empty":{const s=lr(i);switch(s.target){case"copycoords":Ql(se,Xr(),s.path.split(",").join(" "));break}break}case"inspect":j8(i,e.player);break;case"touched":if(oe(e.data)){const[s,o,a]=e.data;Xb({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:Xb(e);break}break}}},KM());function H8(){hE(se)}const{forward:Y8}=UE(e=>{FE(e)&&postMessage(e)});onmessage=function(t){Y8(t.data)},setTimeout(H8,100)})();

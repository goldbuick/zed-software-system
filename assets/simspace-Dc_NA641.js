var Y$=Object.defineProperty;var V$=(fi,qn,Un)=>qn in fi?Y$(fi,qn,{enumerable:!0,configurable:!0,writable:!0,value:Un}):fi[qn]=Un;var Et=(fi,qn,Un)=>V$(fi,typeof qn!="symbol"?qn+"":qn,Un);(function(){"use strict";const fi=new Set,qn={emit(e,t,n,r,i){qn.invoke(ME(e,t,n,r,i))},invoke(e){fi.forEach(t=>t.handle(e))},connect(e){fi.add(e)},disconnect(e){fi.delete(e)}};var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Qw(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Dd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Un,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Dd);var tE=Dd.exports,jd=Fs(tE),zd={};(function(e){var t=Un&&Un.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,m;d<h;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,k=l.addAdverb,y=k===void 0?!1:k,v=t(t(t([],t([],Array(p),!0).map(function(T){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),y?[n(e.adverbs)]:[],!0);return h&&(v=v.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),v.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return r(e.adjectives).length*f+f*p.length+r(e.nouns).length+p.length+r(e.verbs).length+(h?r(e.adverbs).length+p.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(e.adjectives).length*f+f*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(h?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(zd);var Wd=Fs(zd);const eE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nE=e=>crypto.getRandomValues(new Uint8Array(e)),rE=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Gd=(e,t=21)=>rE(e,t,nE),iE=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=eE[n[e]&63];return t};var Kd="abcdefghijklmnopqrstuvwxyz",Hd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Yd="0123456789",sE="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",oE="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const aE=Yd,cE=Kd,lE=Hd;var uE=aE+cE+lE,au={lowercase:Kd,uppercase:Hd,numbers:Yd,nolookalikes:sE,nolookalikesSafe:oE,alphanumeric:uE};function De(){return`sid_${iE(12).replaceAll("-",".")}`}Gd(au.numbers,4),Gd(`${au.numbers}${au.lowercase}`,16);function yn(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function hE(){return Wd({capitalize:!1,adjectiveCount:1})}function fE(){return Wd({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var dE=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),pE=Object.prototype.hasOwnProperty;function cu(e,t){return pE.call(e,t)}function lu(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)cu(e,i)&&r.push(i);return r}function Fn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function uu(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function ss(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Vd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function hu(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(hu(e[t]))return!0}else if(typeof e=="object"){for(var r=lu(e),i=r.length,s=0;s<i;s++)if(hu(e[r[s]]))return!0}}return!1}function Xd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var qd=function(e){dE(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Xd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Xd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Fe=qd,mE=Fn,Bs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Ga(n,this.path);r&&(r=Fn(r));var i=os(n,{op:"remove",path:this.from}).removed;return os(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Ga(n,this.from);return os(n,{op:"add",path:this.path,value:Fn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Mo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},gE={add:function(e,t,n){return uu(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Bs.move,copy:Bs.copy,test:Bs.test,_get:Bs._get};function Ga(e,t){if(t=="")return e;var n={op:"_get",path:t};return os(e,n),n.value}function os(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ka(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Ga(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Mo(e,t.value),o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Fn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,m=void 0;for(typeof n=="function"?m=n:m=Ka;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Vd(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!uu(h))throw new Fe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);uu(h)&&(h=~~h)}if(u>=f){if(n&&t.op==="add"&&h>l.length)throw new Fe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=gE[t.op].call(t,l,h,e);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Bs[t.op].call(t,l,h,e);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Fe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function fu(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Fn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=os(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function _E(e,t,n){var r=os(e,t);if(r.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ka(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Fe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Bs[e.op]){if(typeof e.path!="string")throw new Fe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Fe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Fe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&hu(e.value))throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Fe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Fe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Jd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Fe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Jd(e,t,n){try{if(!Array.isArray(e))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)fu(Fn(t),Fn(e),n||!0);else{n=n||Ka;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Fe)return i;throw i}}function Mo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Mo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Mo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var yE=Object.freeze({__proto__:null,JsonPatchError:Fe,_areEquals:Mo,applyOperation:os,applyPatch:fu,applyReducer:_E,deepClone:mE,getValueByPointer:Ga,validate:Jd,validator:Ka});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var du=new WeakMap,bE=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),kE=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function wE(e){return du.get(e)}function EE(e,t){return e.observers.get(t)}function xE(e,t){e.observers.delete(t.callback)}function vE(e,t){t.unobserve()}function TE(e,t){var n=[],r,i=wE(e);if(!i)i=new bE(e),du.set(e,i);else{var s=EE(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Fn(e),t){r.callback=t,r.next=null;var o=function(){pu(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){pu(r),clearTimeout(r.next),xE(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new kE(t,r)),r}function pu(e,t){t===void 0&&(t=!1);var n=du.get(e.object);mu(n.value,e.object,e.patches,"",t),e.patches.length&&fu(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function mu(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=lu(t),o=lu(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(cu(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?mu(u,f,n,r+"/"+ss(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+ss(l),value:Fn(u)}),n.push({op:"replace",path:r+"/"+ss(l),value:Fn(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+ss(l),value:Fn(u)}),n.push({op:"remove",path:r+"/"+ss(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!cu(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+ss(l),value:Fn(t[l])})}}}function Zd(e,t,n){n===void 0&&(n=!1);var r=[];return mu(e,t,r,"",n),r}var AE=Object.freeze({__proto__:null,compare:Zd,generate:pu,observe:TE,unobserve:vE});Object.assign({},yE,AE,{JsonPatchError:qd,deepClone:Fn,escapePathComponent:ss,unescapePathComponent:Vd});var SE=typeof Element<"u",RE=typeof Map=="function",OE=typeof Set=="function",NE=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ha(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ha(e[r],t[r]))return!1;return!0}var s;if(RE&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ha(r.value[1],t.get(r.value[0])))return!1;return!0}if(OE&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(NE&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(SE&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ha(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var IE=function(t,n){try{return Ha(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},CE=Fs(IE);function b(e){return e!=null}const Jn=Object.keys;function xr(e){return Fn(e)}function LE(e){return typeof e=="boolean"}function xt(e){return typeof e=="number"&&isNaN(e)===!1}function yt(e){return typeof e=="string"}function ue(e){return Array.isArray(e)}function gu(e){return e}var Lt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e[e.NON=1]="NON",e))(Lt||{}),Wt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Wt||{}),Bn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Bn||{}),mt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e[e.MID=22]="MID",e[e.OVER=23]="OVER",e[e.UNDER=24]="UNDER",e))(mt||{}),At=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.ZSSEDIT=14]="ZSSEDIT",e[e.CHAREDIT=15]="CHAREDIT",e[e.COLOREDIT=16]="COLOREDIT",e))(At||{});function It(e){return(e==null?void 0:e.toLowerCase().trim())??""}function ME(e,t,n,r,i){return{session:e,player:t,id:De(),sender:n,target:r,data:i}}function Pn(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Ps(e,t=[],n=gu,r=""){const i=De(),s=It(e),o=t.map(It);let a=r;const c={id(){return i},name(){return e},session(l){return b(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,f){qn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Pn(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&b(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return qn.connect(c),c}function UE(e){return typeof e=="object"&&yt(e.session)&&yt(e.player)&&yt(e.id)&&yt(e.sender)&&yt(e.target)}function de(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function FE(e,t,...n){return e.emit(t,"info",n),!0}function xe(e,t,...n){return e.emit(t,"log",n),!0}function Qd(e,t,n){e.emit(t,"toast",n)}function BE(e,t,n){e.emit(t,"bridge:streamstart",n)}function PE(e,t){e.emit(t,"bridge:streamstop",void 0)}function $E(e,t,n){e.emit(t,"bridge:chatstart",n)}function DE(e,t){e.emit(t,"bridge:chatstop")}function jE(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function zE(e,t){e.emit(t,"bridge:talkstart",t)}function WE(e,t){e.emit(t,"bridge:talkstop",t)}function GE(e,t){e.emit(t,"bridge:mediastart",t)}function KE(e,t){e.emit(t,"bridge:mediastop",t)}function HE(e,t,n){e.emit(t,"bridge:start",n)}function YE(e,t,n){e.emit(t,"bridge:tab",n)}function VE(e,t,n){e.emit(t,"gadgetclient:paint",n)}function XE(e,t,n){e.emit(t,"gadgetclient:patch",n)}function qE(e,t){e.emit(t,"gadgetserver:clearscroll")}function JE(e){e.emit("","ready")}function t0(e,t){e.emit(t,"register:loginfail")}function _u(e,t){e.emit(t,"register:loginready",!0)}function ZE(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function QE(e,t,n){e.emit(t,"register:forkmem",[n])}function tx(e,t,n,r){e.emit(t,"register:itchiopublishmem",[n,r])}function yu(e,t,n){e.emit(t,"register:copy",n)}function ex(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function e0(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function nx(e,t){e.emit(t,"register:dev",void 0)}function rx(e,t){e.emit(t,"register:share",void 0)}function ix(e,t){e.emit(t,"register:nuke",void 0)}function sx(e,t){e.emit(t,"register:enterar",void 0)}function ox(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function ax(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function cx(e,t,n){e.emit(t,"synth:focus",n)}function lx(e,t,n){e.emit(t,"synth:bpm",n)}function ux(e,t,n){e.emit(t,"synth:playvolume",n)}function hx(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function fx(e,t,n){e.emit(t,"synth:ttsvolume",n)}function bu(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function n0(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function r0(e,t,n,r){e.emit(t,"register:config",[n,r])}function dx(e,t){e.emit(t,"register:configshow")}function px(e,t){e.emit(t,"register:inspector")}function i0(e,t,n,r,i,s){e.emit(t,"register:editor:open",[n,r,i,s])}function mx(e,t){e.emit(t,"vm:local")}function s0(e,t){e.emit(t,"vm:logout")}function Ya(e,t){const[n,r]=t;return`${e}:${[n,r].filter(b).join(":")}`}function gx(e,t,n){e.emit(t,"vm:cli",n)}function _x(e,t){e.emit(t,"vm:restart")}function o0(e,t){e.emit(t,"vm:flush")}function yx(e,t){e.emit(t,"vm:fork")}function bx(e,t){e.emit(t,"vm:itchiopublish")}function kx(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function wx(e,t){return{filename:e,json:t}}function Ex(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function ku(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=kx(i,s);break;case"json":o=wx(i,s);break;case"binary":o=Ex(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function xx(e){const t=new Set;function n(s){UE(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),qn.invoke(s))}const r=Ps("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){qn.disconnect(r)}return{forward:n,disconnect:i}}function vx(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=Pn(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const wu=66.666,Va=Math.round(1e3/wu),Tx=3;function a0(e){return new Promise(t=>setTimeout(t,e))}const Eu=Ps("clock");let xu=0,Xa=0,vu=0,c0=performance.now();function l0(){const e=performance.now(),t=e-c0;vu+=t,vu>=wu&&(vu%=wu,Eu.emit("","tick",Xa),Eu.emit("","tock",Xa),++xu,++Xa,xu>=Va&&(xu%=Va,Eu.emit("","second",Xa))),c0=e,setTimeout(l0,2)}l0();function Ax(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u0={exports:{}},je=u0.exports={},zr,Wr;function Tu(){throw new Error("setTimeout has not been defined")}function Au(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?zr=setTimeout:zr=Tu}catch{zr=Tu}try{typeof clearTimeout=="function"?Wr=clearTimeout:Wr=Au}catch{Wr=Au}})();function h0(e){if(zr===setTimeout)return setTimeout(e,0);if((zr===Tu||!zr)&&setTimeout)return zr=setTimeout,setTimeout(e,0);try{return zr(e,0)}catch{try{return zr.call(null,e,0)}catch{return zr.call(this,e,0)}}}function Sx(e){if(Wr===clearTimeout)return clearTimeout(e);if((Wr===Au||!Wr)&&clearTimeout)return Wr=clearTimeout,clearTimeout(e);try{return Wr(e)}catch{try{return Wr.call(null,e)}catch{return Wr.call(this,e)}}}var di=[],$s=!1,as,qa=-1;function Rx(){!$s||!as||($s=!1,as.length?di=as.concat(di):qa=-1,di.length&&f0())}function f0(){if(!$s){var e=h0(Rx);$s=!0;for(var t=di.length;t;){for(as=di,di=[];++qa<t;)as&&as[qa].run();qa=-1,t=di.length}as=null,$s=!1,Sx(e)}}je.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];di.push(new d0(e,t)),di.length===1&&!$s&&h0(f0)};function d0(e,t){this.fun=e,this.array=t}d0.prototype.run=function(){this.fun.apply(null,this.array)},je.title="browser",je.browser=!0,je.env={},je.argv=[],je.version="",je.versions={};function pi(){}je.on=pi,je.addListener=pi,je.once=pi,je.off=pi,je.removeListener=pi,je.removeAllListeners=pi,je.emit=pi,je.prependListener=pi,je.prependOnceListener=pi,je.listeners=function(e){return[]},je.binding=function(e){throw new Error("process.binding is not supported")},je.cwd=function(){return"/"},je.chdir=function(e){throw new Error("process.chdir is not supported")},je.umask=function(){return 0};var Ox=u0.exports;const vr=Ax(Ox);var Yt={},Su=Symbol.for("react.transitional.element"),Nx=Symbol.for("react.portal"),Ix=Symbol.for("react.fragment"),Cx=Symbol.for("react.strict_mode"),Lx=Symbol.for("react.profiler"),Mx=Symbol.for("react.consumer"),Ux=Symbol.for("react.context"),Fx=Symbol.for("react.forward_ref"),Bx=Symbol.for("react.suspense"),Px=Symbol.for("react.memo"),p0=Symbol.for("react.lazy"),m0=Symbol.iterator;function $x(e){return e===null||typeof e!="object"?null:(e=m0&&e[m0]||e["@@iterator"],typeof e=="function"?e:null)}var g0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_0=Object.assign,y0={};function Ds(e,t,n){this.props=e,this.context=t,this.refs=y0,this.updater=n||g0}Ds.prototype.isReactComponent={},Ds.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Ds.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function b0(){}b0.prototype=Ds.prototype;function Ru(e,t,n){this.props=e,this.context=t,this.refs=y0,this.updater=n||g0}var Ou=Ru.prototype=new b0;Ou.constructor=Ru,_0(Ou,Ds.prototype),Ou.isPureReactComponent=!0;var k0=Array.isArray,ve={H:null,A:null,T:null,S:null,V:null},w0=Object.prototype.hasOwnProperty;function Nu(e,t,n,r,i,s){return n=s.ref,{$$typeof:Su,type:e,key:t,ref:n!==void 0?n:null,props:s}}function Dx(e,t){return Nu(e.type,t,void 0,void 0,void 0,e.props)}function Iu(e){return typeof e=="object"&&e!==null&&e.$$typeof===Su}function jx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var E0=/\/+/g;function Cu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?jx(""+e.key):t.toString(36)}function x0(){}function zx(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(x0,x0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function js(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Su:case Nx:o=!0;break;case p0:return o=e._init,js(o(e._payload),t,n,r,i)}}if(o)return i=i(e),o=r===""?"."+Cu(e,0):r,k0(i)?(n="",o!=null&&(n=o.replace(E0,"$&/")+"/"),js(i,t,n,"",function(l){return l})):i!=null&&(Iu(i)&&(i=Dx(i,n+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(E0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=r===""?".":r+":";if(k0(e))for(var c=0;c<e.length;c++)r=e[c],s=a+Cu(r,c),o+=js(r,t,n,s,i);else if(c=$x(e),typeof c=="function")for(e=c.call(e),c=0;!(r=e.next()).done;)r=r.value,s=a+Cu(r,c++),o+=js(r,t,n,s,i);else if(s==="object"){if(typeof e.then=="function")return js(zx(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function Ja(e,t,n){if(e==null)return e;var r=[],i=0;return js(e,r,"","",function(s){return t.call(n,s,i++)}),r}function Wx(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var v0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof vr=="object"&&typeof vr.emit=="function"){vr.emit("uncaughtException",e);return}console.error(e)};function Gx(){}Yt.Children={map:Ja,forEach:function(e,t,n){Ja(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ja(e,function(){t++}),t},toArray:function(e){return Ja(e,function(t){return t})||[]},only:function(e){if(!Iu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Yt.Component=Ds,Yt.Fragment=Ix,Yt.Profiler=Lx,Yt.PureComponent=Ru,Yt.StrictMode=Cx,Yt.Suspense=Bx,Yt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ve,Yt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return ve.H.useMemoCache(e)}},Yt.cache=function(e){return function(){return e.apply(null,arguments)}},Yt.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=_0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!w0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(r[o]=t[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return Nu(e.type,i,void 0,void 0,s,r)},Yt.createContext=function(e){return e={$$typeof:Ux,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:Mx,_context:e},e},Yt.createElement=function(e,t,n){var r,i={},s=null;if(t!=null)for(r in t.key!==void 0&&(s=""+t.key),t)w0.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return Nu(e,s,void 0,void 0,null,i)},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(e){return{$$typeof:Fx,render:e}},Yt.isValidElement=Iu,Yt.lazy=function(e){return{$$typeof:p0,_payload:{_status:-1,_result:e},_init:Wx}},Yt.memo=function(e,t){return{$$typeof:Px,type:e,compare:t===void 0?null:t}},Yt.startTransition=function(e){var t=ve.T,n={};ve.T=n;try{var r=e(),i=ve.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(Gx,v0)}catch(s){v0(s)}finally{ve.T=t}},Yt.unstable_useCacheRefresh=function(){return ve.H.useCacheRefresh()},Yt.use=function(e){return ve.H.use(e)},Yt.useActionState=function(e,t,n){return ve.H.useActionState(e,t,n)},Yt.useCallback=function(e,t){return ve.H.useCallback(e,t)},Yt.useContext=function(e){return ve.H.useContext(e)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(e,t){return ve.H.useDeferredValue(e,t)},Yt.useEffect=function(e,t,n){var r=ve.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Yt.useId=function(){return ve.H.useId()},Yt.useImperativeHandle=function(e,t,n){return ve.H.useImperativeHandle(e,t,n)},Yt.useInsertionEffect=function(e,t){return ve.H.useInsertionEffect(e,t)},Yt.useLayoutEffect=function(e,t){return ve.H.useLayoutEffect(e,t)},Yt.useMemo=function(e,t){return ve.H.useMemo(e,t)},Yt.useOptimistic=function(e,t){return ve.H.useOptimistic(e,t)},Yt.useReducer=function(e,t,n){return ve.H.useReducer(e,t,n)},Yt.useRef=function(e){return ve.H.useRef(e)},Yt.useState=function(e){return ve.H.useState(e)},Yt.useSyncExternalStore=function(e,t,n){return ve.H.useSyncExternalStore(e,t,n)},Yt.useTransition=function(){return ve.H.useTransition()},Yt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const T0="0123456789abcdef",A0=[],Za=[];for(let e=0;e<256;e++)A0[e]=T0[e>>4&15]+T0[e&15],e<16&&(e<10?Za[48+e]=e:Za[87+e]=e);const S0=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=A0[e[r++]];return n},Qa=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=Za[e.charCodeAt(s++)]<<4|Za[e.charCodeAt(s++)];return r};for(var R0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Kx=typeof Uint8Array>"u"?[]:new Uint8Array(256),tc=0;tc<R0.length;tc++)Kx[R0.charCodeAt(tc)]=tc;new TextDecoder,new TextEncoder;const O0=typeof window<"u"?window:self,N0=O0.crypto||O0.msCrypto||{};N0.subtle||N0.webkitSubtle;const zs=globalThis||void 0||self,Tr=()=>new Map,Lu=e=>{const t=Tr();return e.forEach((n,r)=>{t.set(r,n)}),t},Mi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},Hx=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},Yx=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Ws=()=>new Set,Mu=e=>e[e.length-1],Vx=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},cs=Array.from,Xx=Array.isArray;class qx{constructor(){this._observers=Tr()}on(t,n){return Mi(this._observers,t,Ws).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return cs((this._observers.get(t)||Tr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Tr()}}const Ui=Math.floor,ec=Math.abs,I0=(e,t)=>e<t?e:t,ls=(e,t)=>e>t?e:t,C0=e=>e!==0?e<0:1/e<0,L0=1,M0=2,Uu=4,Fu=8,Uo=32,mi=64,Zn=128,nc=31,Bu=63,us=127,Jx=2147483647,U0=Number.MAX_SAFE_INTEGER,Zx=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ui(e)===e),Qx=e=>e.toLowerCase(),tv=/^\s*/g,ev=e=>e.replace(tv,""),nv=/([A-Z])/g,F0=(e,t)=>ev(e.replace(nv,n=>`${t}${Qx(n)}`)),rv=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Fo=typeof TextEncoder<"u"?new TextEncoder:null,iv=Fo?e=>Fo.encode(e):rv;let Bo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Bo&&Bo.decode(new Uint8Array).length===1&&(Bo=null);class Po{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const rc=()=>new Po,sv=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Gr=e=>{const t=new Uint8Array(sv(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},ov=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(ls(n,t)*2),e.cpos=0)},rn=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Pu=rn,oe=(e,t)=>{for(;t>us;)rn(e,Zn|us&t),t=Ui(t/128);rn(e,us&t)},$u=(e,t)=>{const n=C0(t);for(n&&(t=-t),rn(e,(t>Bu?Zn:0)|(n?mi:0)|Bu&t),t=Ui(t/64);t>0;)rn(e,(t>us?Zn:0)|us&t),t=Ui(t/128)},Du=new Uint8Array(3e4),av=Du.length/3,cv=(e,t)=>{if(t.length<av){const n=Fo.encodeInto(t,Du).written||0;oe(e,n);for(let r=0;r<n;r++)rn(e,Du[r])}else Qn(e,iv(t))},lv=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;oe(e,r);for(let i=0;i<r;i++)rn(e,n.codePointAt(i))},Gs=Fo&&Fo.encodeInto?cv:lv,ic=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=I0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ls(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},Qn=(e,t)=>{oe(e,t.byteLength),ic(e,t)},ju=(e,t)=>{ov(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},uv=(e,t)=>ju(e,4).setFloat32(0,t,!1),hv=(e,t)=>ju(e,8).setFloat64(0,t,!1),fv=(e,t)=>ju(e,8).setBigInt64(0,t,!1),B0=new DataView(new ArrayBuffer(4)),dv=e=>(B0.setFloat32(0,e),B0.getFloat32(0)===e),$o=(e,t)=>{switch(typeof t){case"string":rn(e,119),Gs(e,t);break;case"number":Zx(t)&&ec(t)<=Jx?(rn(e,125),$u(e,t)):dv(t)?(rn(e,124),uv(e,t)):(rn(e,123),hv(e,t));break;case"bigint":rn(e,122),fv(e,t);break;case"object":if(t===null)rn(e,126);else if(Xx(t)){rn(e,117),oe(e,t.length);for(let n=0;n<t.length;n++)$o(e,t[n])}else if(t instanceof Uint8Array)rn(e,116),Qn(e,t);else{rn(e,118);const n=Object.keys(t);oe(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Gs(e,i),$o(e,t[i])}}break;case"boolean":rn(e,t?120:121);break;default:rn(e,127)}};class P0 extends Po{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&oe(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const $0=e=>{e.count>0&&($u(e.encoder,e.count===1?e.s:-e.s),e.count>1&&oe(e.encoder,e.count-2))};class sc{constructor(){this.encoder=new Po,this.s=0,this.count=0}write(t){this.s===t?this.count++:($0(this),this.count=1,this.s=t)}toUint8Array(){return $0(this),Gr(this.encoder)}}const D0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);$u(e.encoder,t),e.count>1&&oe(e.encoder,e.count-2)}};class zu{constructor(){this.encoder=new Po,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(D0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return D0(this),Gr(this.encoder)}}class pv{constructor(){this.sarr=[],this.s="",this.lensE=new sc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Po;return this.sarr.push(this.s),this.s="",Gs(t,this.sarr.join("")),ic(t,this.lensE.toUint8Array()),Gr(t)}}const Fi=e=>new Error(e),Kr=()=>{throw Fi("Method unimplemented")},Hr=()=>{throw Fi("Unexpected case")},j0=Fi("Unexpected end of array"),z0=Fi("Integer out of Range");class oc{constructor(t){this.arr=t,this.pos=0}}const Ks=e=>new oc(e),mv=e=>e.pos!==e.arr.length,gv=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},tr=e=>gv(e,Xt(e)),Hs=e=>e.arr[e.pos++],Xt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&us)*n,n*=128,i<Zn)return t;if(t>U0)throw z0}throw j0},Wu=e=>{let t=e.arr[e.pos++],n=t&Bu,r=64;const i=(t&mi)>0?-1:1;if(!(t&Zn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&us)*r,r*=128,t<Zn)return i*n;if(n>U0)throw z0}throw j0},Ys=Bo?e=>Bo.decode(tr(e)):e=>{let t=Xt(e);if(t===0)return"";{let n=String.fromCodePoint(Hs(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Hs(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Gu=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},_v=[e=>{},e=>null,Wu,e=>Gu(e,4).getFloat32(0,!1),e=>Gu(e,8).getFloat64(0,!1),e=>Gu(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Ys,e=>{const t=Xt(e),n={};for(let r=0;r<t;r++){const i=Ys(e);n[i]=Do(e)}return n},e=>{const t=Xt(e),n=[];for(let r=0;r<t;r++)n.push(Do(e));return n},tr],Do=e=>_v[127-Hs(e)](e);class W0 extends oc{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),mv(this)?this.count=Xt(this)+1:this.count=-1),this.count--,this.s}}class ac extends oc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Wu(this);const t=C0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Xt(this)+2)}return this.count--,this.s}}class Ku extends oc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Wu(this),n=t&1;this.diff=Ui(t/2),this.count=1,n&&(this.count=Xt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class yv{constructor(t){this.decoder=new ac(t),this.str=Ys(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const bv=crypto.getRandomValues.bind(crypto),G0=()=>bv(new Uint32Array(1))[0],kv="10000000-1000-4000-8000"+-1e11,wv=()=>kv.replace(/[018]/g,e=>(e^G0()&15>>e/4).toString(16)),K0=e=>new Promise(e);Promise.all.bind(Promise);var H0={},cc={};cc.byteLength=vv,cc.toByteArray=Av,cc.fromByteArray=Ov;for(var Yr=[],cr=[],Ev=typeof Uint8Array<"u"?Uint8Array:Array,Hu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vs=0,xv=Hu.length;Vs<xv;++Vs)Yr[Vs]=Hu[Vs],cr[Hu.charCodeAt(Vs)]=Vs;cr[45]=62,cr[95]=63;function Y0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function vv(e){var t=Y0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Tv(e,t,n){return(t+n)*3/4-n}function Av(e){var t,n=Y0(e),r=n[0],i=n[1],s=new Ev(Tv(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=cr[e.charCodeAt(c)]<<18|cr[e.charCodeAt(c+1)]<<12|cr[e.charCodeAt(c+2)]<<6|cr[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=cr[e.charCodeAt(c)]<<2|cr[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=cr[e.charCodeAt(c)]<<10|cr[e.charCodeAt(c+1)]<<4|cr[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Sv(e){return Yr[e>>18&63]+Yr[e>>12&63]+Yr[e>>6&63]+Yr[e&63]}function Rv(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Sv(r));return i.join("")}function Ov(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Rv(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Yr[t>>2]+Yr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Yr[t>>10]+Yr[t>>4&63]+Yr[t<<2&63]+"=")),i.join("")}var Yu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Yu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+e[t+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Yu.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,m=r?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=d/c:t+=d*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(t*c-1)*Math.pow(2,i),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+h]=o&255,h+=m,o/=256,l-=8);e[n+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=cc,n=Yu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=L,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const R=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(R,g),R.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(R){if(R>i)throw new RangeError('The value "'+R+'" is invalid for option "size"');const g=new s(R);return Object.setPrototypeOf(g,u.prototype),g}function u(R,g,_){if(typeof R=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(R)}return f(R,g,_)}u.poolSize=8192;function f(R,g,_){if(typeof R=="string")return p(R,g);if(o.isView(R))return y(R);if(R==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R);if(gt(R,o)||R&&gt(R.buffer,o)||typeof a<"u"&&(gt(R,a)||R&&gt(R.buffer,a)))return v(R,g,_);if(typeof R=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const U=R.valueOf&&R.valueOf();if(U!=null&&U!==R)return u.from(U,g,_);const G=T(R);if(G)return G;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof R[Symbol.toPrimitive]=="function")return u.from(R[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R)}u.from=function(R,g,_){return f(R,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(R){if(typeof R!="number")throw new TypeError('"size" argument must be of type number');if(R<0)throw new RangeError('The value "'+R+'" is invalid for option "size"')}function h(R,g,_){return d(R),R<=0?l(R):g!==void 0?typeof _=="string"?l(R).fill(g,_):l(R).fill(g):l(R)}u.alloc=function(R,g,_){return h(R,g,_)};function m(R){return d(R),l(R<0?0:A(R)|0)}u.allocUnsafe=function(R){return m(R)},u.allocUnsafeSlow=function(R){return m(R)};function p(R,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=S(R,g)|0;let U=l(_);const G=U.write(R,g);return G!==_&&(U=U.slice(0,G)),U}function k(R){const g=R.length<0?0:A(R.length)|0,_=l(g);for(let U=0;U<g;U+=1)_[U]=R[U]&255;return _}function y(R){if(gt(R,s)){const g=new s(R);return v(g.buffer,g.byteOffset,g.byteLength)}return k(R)}function v(R,g,_){if(g<0||R.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(R.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let U;return g===void 0&&_===void 0?U=new s(R):_===void 0?U=new s(R,g):U=new s(R,g,_),Object.setPrototypeOf(U,u.prototype),U}function T(R){if(u.isBuffer(R)){const g=A(R.length)|0,_=l(g);return _.length===0||R.copy(_,0,0,g),_}if(R.length!==void 0)return typeof R.length!="number"||Ct(R.length)?l(0):k(R);if(R.type==="Buffer"&&Array.isArray(R.data))return k(R.data)}function A(R){if(R>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return R|0}function L(R){return+R!=R&&(R=0),u.alloc(+R)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(gt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),gt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let U=g.length,G=_.length;for(let tt=0,ot=Math.min(U,G);tt<ot;++tt)if(g[tt]!==_[tt]){U=g[tt],G=_[tt];break}return U<G?-1:G<U?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let U;if(_===void 0)for(_=0,U=0;U<g.length;++U)_+=g[U].length;const G=u.allocUnsafe(_);let tt=0;for(U=0;U<g.length;++U){let ot=g[U];if(gt(ot,s))tt+ot.length>G.length?(u.isBuffer(ot)||(ot=u.from(ot)),ot.copy(G,tt)):s.prototype.set.call(G,ot,tt);else if(u.isBuffer(ot))ot.copy(G,tt);else throw new TypeError('"list" argument must be an Array of Buffers');tt+=ot.length}return G};function S(R,g){if(u.isBuffer(R))return R.length;if(o.isView(R)||gt(R,o))return R.byteLength;if(typeof R!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof R);const _=R.length,U=arguments.length>2&&arguments[2]===!0;if(!U&&_===0)return 0;let G=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ht(R).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return _t(R).length;default:if(G)return U?-1:ht(R).length;g=(""+g).toLowerCase(),G=!0}}u.byteLength=S;function I(R,g,_){let U=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(R||(R="utf8");;)switch(R){case"hex":return P(this,g,_);case"utf8":case"utf-8":return B(this,g,_);case"ascii":return rt(this,g,_);case"latin1":case"binary":return z(this,g,_);case"base64":return $(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ft(this,g,_);default:if(U)throw new TypeError("Unknown encoding: "+R);R=(R+"").toLowerCase(),U=!0}}u.prototype._isBuffer=!0;function D(R,g,_){const U=R[g];R[g]=R[_],R[_]=U}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)D(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)D(this,_,_+3),D(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)D(this,_,_+7),D(this,_+1,_+6),D(this,_+2,_+5),D(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?B(this,0,g):I.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,U,G,tt){if(gt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),U===void 0&&(U=g?g.length:0),G===void 0&&(G=0),tt===void 0&&(tt=this.length),_<0||U>g.length||G<0||tt>this.length)throw new RangeError("out of range index");if(G>=tt&&_>=U)return 0;if(G>=tt)return-1;if(_>=U)return 1;if(_>>>=0,U>>>=0,G>>>=0,tt>>>=0,this===g)return 0;let ot=tt-G,Ht=U-_;const Ie=Math.min(ot,Ht),we=this.slice(G,tt),Ce=g.slice(_,U);for(let he=0;he<Ie;++he)if(we[he]!==Ce[he]){ot=we[he],Ht=Ce[he];break}return ot<Ht?-1:Ht<ot?1:0};function N(R,g,_,U,G){if(R.length===0)return-1;if(typeof _=="string"?(U=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,Ct(_)&&(_=G?0:R.length-1),_<0&&(_=R.length+_),_>=R.length){if(G)return-1;_=R.length-1}else if(_<0)if(G)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,U)),u.isBuffer(g))return g.length===0?-1:W(R,g,_,U,G);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?G?s.prototype.indexOf.call(R,g,_):s.prototype.lastIndexOf.call(R,g,_):W(R,[g],_,U,G);throw new TypeError("val must be string, number or Buffer")}function W(R,g,_,U,G){let tt=1,ot=R.length,Ht=g.length;if(U!==void 0&&(U=String(U).toLowerCase(),U==="ucs2"||U==="ucs-2"||U==="utf16le"||U==="utf-16le")){if(R.length<2||g.length<2)return-1;tt=2,ot/=2,Ht/=2,_/=2}function Ie(Ce,he){return tt===1?Ce[he]:Ce.readUInt16BE(he*tt)}let we;if(G){let Ce=-1;for(we=_;we<ot;we++)if(Ie(R,we)===Ie(g,Ce===-1?0:we-Ce)){if(Ce===-1&&(Ce=we),we-Ce+1===Ht)return Ce*tt}else Ce!==-1&&(we-=we-Ce),Ce=-1}else for(_+Ht>ot&&(_=ot-Ht),we=_;we>=0;we--){let Ce=!0;for(let he=0;he<Ht;he++)if(Ie(R,we+he)!==Ie(g,he)){Ce=!1;break}if(Ce)return we}return-1}u.prototype.includes=function(g,_,U){return this.indexOf(g,_,U)!==-1},u.prototype.indexOf=function(g,_,U){return N(this,g,_,U,!0)},u.prototype.lastIndexOf=function(g,_,U){return N(this,g,_,U,!1)};function q(R,g,_,U){_=Number(_)||0;const G=R.length-_;U?(U=Number(U),U>G&&(U=G)):U=G;const tt=g.length;U>tt/2&&(U=tt/2);let ot;for(ot=0;ot<U;++ot){const Ht=parseInt(g.substr(ot*2,2),16);if(Ct(Ht))return ot;R[_+ot]=Ht}return ot}function M(R,g,_,U){return vt(ht(g,R.length-_),R,_,U)}function O(R,g,_,U){return vt(pt(g),R,_,U)}function E(R,g,_,U){return vt(_t(g),R,_,U)}function C(R,g,_,U){return vt(Z(g,R.length-_),R,_,U)}u.prototype.write=function(g,_,U,G){if(_===void 0)G="utf8",U=this.length,_=0;else if(U===void 0&&typeof _=="string")G=_,U=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(U)?(U=U>>>0,G===void 0&&(G="utf8")):(G=U,U=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const tt=this.length-_;if((U===void 0||U>tt)&&(U=tt),g.length>0&&(U<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");G||(G="utf8");let ot=!1;for(;;)switch(G){case"hex":return q(this,g,_,U);case"utf8":case"utf-8":return M(this,g,_,U);case"ascii":case"latin1":case"binary":return O(this,g,_,U);case"base64":return E(this,g,_,U);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,g,_,U);default:if(ot)throw new TypeError("Unknown encoding: "+G);G=(""+G).toLowerCase(),ot=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function $(R,g,_){return g===0&&_===R.length?t.fromByteArray(R):t.fromByteArray(R.slice(g,_))}function B(R,g,_){_=Math.min(R.length,_);const U=[];let G=g;for(;G<_;){const tt=R[G];let ot=null,Ht=tt>239?4:tt>223?3:tt>191?2:1;if(G+Ht<=_){let Ie,we,Ce,he;switch(Ht){case 1:tt<128&&(ot=tt);break;case 2:Ie=R[G+1],(Ie&192)===128&&(he=(tt&31)<<6|Ie&63,he>127&&(ot=he));break;case 3:Ie=R[G+1],we=R[G+2],(Ie&192)===128&&(we&192)===128&&(he=(tt&15)<<12|(Ie&63)<<6|we&63,he>2047&&(he<55296||he>57343)&&(ot=he));break;case 4:Ie=R[G+1],we=R[G+2],Ce=R[G+3],(Ie&192)===128&&(we&192)===128&&(Ce&192)===128&&(he=(tt&15)<<18|(Ie&63)<<12|(we&63)<<6|Ce&63,he>65535&&he<1114112&&(ot=he))}}ot===null?(ot=65533,Ht=1):ot>65535&&(ot-=65536,U.push(ot>>>10&1023|55296),ot=56320|ot&1023),U.push(ot),G+=Ht}return Q(U)}const st=4096;function Q(R){const g=R.length;if(g<=st)return String.fromCharCode.apply(String,R);let _="",U=0;for(;U<g;)_+=String.fromCharCode.apply(String,R.slice(U,U+=st));return _}function rt(R,g,_){let U="";_=Math.min(R.length,_);for(let G=g;G<_;++G)U+=String.fromCharCode(R[G]&127);return U}function z(R,g,_){let U="";_=Math.min(R.length,_);for(let G=g;G<_;++G)U+=String.fromCharCode(R[G]);return U}function P(R,g,_){const U=R.length;(!g||g<0)&&(g=0),(!_||_<0||_>U)&&(_=U);let G="";for(let tt=g;tt<_;++tt)G+=fe[R[tt]];return G}function ft(R,g,_){const U=R.slice(g,_);let G="";for(let tt=0;tt<U.length-1;tt+=2)G+=String.fromCharCode(U[tt]+U[tt+1]*256);return G}u.prototype.slice=function(g,_){const U=this.length;g=~~g,_=_===void 0?U:~~_,g<0?(g+=U,g<0&&(g=0)):g>U&&(g=U),_<0?(_+=U,_<0&&(_=0)):_>U&&(_=U),_<g&&(_=g);const G=this.subarray(g,_);return Object.setPrototypeOf(G,u.prototype),G};function lt(R,g,_){if(R%1!==0||R<0)throw new RangeError("offset is not uint");if(R+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,U){g=g>>>0,_=_>>>0,U||lt(g,_,this.length);let G=this[g],tt=1,ot=0;for(;++ot<_&&(tt*=256);)G+=this[g+ot]*tt;return G},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,U){g=g>>>0,_=_>>>0,U||lt(g,_,this.length);let G=this[g+--_],tt=1;for(;_>0&&(tt*=256);)G+=this[g+--_]*tt;return G},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||lt(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||lt(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||lt(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=zt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,tt=this[++g]+this[++g]*2**8+this[++g]*2**16+U*2**24;return BigInt(G)+(BigInt(tt)<<BigInt(32))}),u.prototype.readBigUInt64BE=zt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],tt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U;return(BigInt(G)<<BigInt(32))+BigInt(tt)}),u.prototype.readIntLE=function(g,_,U){g=g>>>0,_=_>>>0,U||lt(g,_,this.length);let G=this[g],tt=1,ot=0;for(;++ot<_&&(tt*=256);)G+=this[g+ot]*tt;return tt*=128,G>=tt&&(G-=Math.pow(2,8*_)),G},u.prototype.readIntBE=function(g,_,U){g=g>>>0,_=_>>>0,U||lt(g,_,this.length);let G=_,tt=1,ot=this[g+--G];for(;G>0&&(tt*=256);)ot+=this[g+--G]*tt;return tt*=128,ot>=tt&&(ot-=Math.pow(2,8*_)),ot},u.prototype.readInt8=function(g,_){return g=g>>>0,_||lt(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||lt(g,2,this.length);const U=this[g]|this[g+1]<<8;return U&32768?U|4294901760:U},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||lt(g,2,this.length);const U=this[g+1]|this[g]<<8;return U&32768?U|4294901760:U},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=zt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(U<<24);return(BigInt(G)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=zt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(G)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||lt(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||lt(g,8,this.length),n.read(this,g,!1,52,8)};function ut(R,g,_,U,G,tt){if(!u.isBuffer(R))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>G||g<tt)throw new RangeError('"value" argument is out of bounds');if(_+U>R.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,U,G){if(g=+g,_=_>>>0,U=U>>>0,!G){const Ht=Math.pow(2,8*U)-1;ut(this,g,_,U,Ht,0)}let tt=1,ot=0;for(this[_]=g&255;++ot<U&&(tt*=256);)this[_+ot]=g/tt&255;return _+U},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,U,G){if(g=+g,_=_>>>0,U=U>>>0,!G){const Ht=Math.pow(2,8*U)-1;ut(this,g,_,U,Ht,0)}let tt=U-1,ot=1;for(this[_+tt]=g&255;--tt>=0&&(ot*=256);)this[_+tt]=g/ot&255;return _+U},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function jt(R,g,_,U,G){at(g,U,G,R,_,7);let tt=Number(g&BigInt(4294967295));R[_++]=tt,tt=tt>>8,R[_++]=tt,tt=tt>>8,R[_++]=tt,tt=tt>>8,R[_++]=tt;let ot=Number(g>>BigInt(32)&BigInt(4294967295));return R[_++]=ot,ot=ot>>8,R[_++]=ot,ot=ot>>8,R[_++]=ot,ot=ot>>8,R[_++]=ot,_}function Qt(R,g,_,U,G){at(g,U,G,R,_,7);let tt=Number(g&BigInt(4294967295));R[_+7]=tt,tt=tt>>8,R[_+6]=tt,tt=tt>>8,R[_+5]=tt,tt=tt>>8,R[_+4]=tt;let ot=Number(g>>BigInt(32)&BigInt(4294967295));return R[_+3]=ot,ot=ot>>8,R[_+2]=ot,ot=ot>>8,R[_+1]=ot,ot=ot>>8,R[_]=ot,_+8}u.prototype.writeBigUInt64LE=zt(function(g,_=0){return jt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=zt(function(g,_=0){return Qt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,U,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*U-1);ut(this,g,_,U,Ie-1,-Ie)}let tt=0,ot=1,Ht=0;for(this[_]=g&255;++tt<U&&(ot*=256);)g<0&&Ht===0&&this[_+tt-1]!==0&&(Ht=1),this[_+tt]=(g/ot>>0)-Ht&255;return _+U},u.prototype.writeIntBE=function(g,_,U,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*U-1);ut(this,g,_,U,Ie-1,-Ie)}let tt=U-1,ot=1,Ht=0;for(this[_+tt]=g&255;--tt>=0&&(ot*=256);)g<0&&Ht===0&&this[_+tt+1]!==0&&(Ht=1),this[_+tt]=(g/ot>>0)-Ht&255;return _+U},u.prototype.writeInt8=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,U){return g=+g,_=_>>>0,U||ut(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=zt(function(g,_=0){return jt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=zt(function(g,_=0){return Qt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Dt(R,g,_,U,G,tt){if(_+U>R.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function Pt(R,g,_,U,G){return g=+g,_=_>>>0,G||Dt(R,g,_,4),n.write(R,g,_,U,23,4),_+4}u.prototype.writeFloatLE=function(g,_,U){return Pt(this,g,_,!0,U)},u.prototype.writeFloatBE=function(g,_,U){return Pt(this,g,_,!1,U)};function le(R,g,_,U,G){return g=+g,_=_>>>0,G||Dt(R,g,_,8),n.write(R,g,_,U,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,U){return le(this,g,_,!0,U)},u.prototype.writeDoubleBE=function(g,_,U){return le(this,g,_,!1,U)},u.prototype.copy=function(g,_,U,G){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(U||(U=0),!G&&G!==0&&(G=this.length),_>=g.length&&(_=g.length),_||(_=0),G>0&&G<U&&(G=U),G===U||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(U<0||U>=this.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("sourceEnd out of bounds");G>this.length&&(G=this.length),g.length-_<G-U&&(G=g.length-_+U);const tt=G-U;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,U,G):s.prototype.set.call(g,this.subarray(U,G),_),tt},u.prototype.fill=function(g,_,U,G){if(typeof g=="string"){if(typeof _=="string"?(G=_,_=0,U=this.length):typeof U=="string"&&(G=U,U=this.length),G!==void 0&&typeof G!="string")throw new TypeError("encoding must be a string");if(typeof G=="string"&&!u.isEncoding(G))throw new TypeError("Unknown encoding: "+G);if(g.length===1){const ot=g.charCodeAt(0);(G==="utf8"&&ot<128||G==="latin1")&&(g=ot)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<U)throw new RangeError("Out of range index");if(U<=_)return this;_=_>>>0,U=U===void 0?this.length:U>>>0,g||(g=0);let tt;if(typeof g=="number")for(tt=_;tt<U;++tt)this[tt]=g;else{const ot=u.isBuffer(g)?g:u.from(g,G),Ht=ot.length;if(Ht===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(tt=0;tt<U-_;++tt)this[tt+_]=ot[tt%Ht]}return this};const qt={};function Ne(R,g,_){qt[R]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${R}]`,this.stack,delete this.name}get code(){return R}set code(G){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:G,writable:!0})}toString(){return`${this.name} [${R}]: ${this.message}`}}}Ne("ERR_BUFFER_OUT_OF_BOUNDS",function(R){return R?`${R} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ne("ERR_INVALID_ARG_TYPE",function(R,g){return`The "${R}" argument must be of type number. Received type ${typeof g}`},TypeError),Ne("ERR_OUT_OF_RANGE",function(R,g,_){let U=`The value of "${R}" is out of range.`,G=_;return Number.isInteger(_)&&Math.abs(_)>2**32?G=$e(String(_)):typeof _=="bigint"&&(G=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(G=$e(G)),G+="n"),U+=` It must be ${g}. Received ${G}`,U},RangeError);function $e(R){let g="",_=R.length;const U=R[0]==="-"?1:0;for(;_>=U+4;_-=3)g=`_${R.slice(_-3,_)}${g}`;return`${R.slice(0,_)}${g}`}function x(R,g,_){nt(g,"offset"),(R[g]===void 0||R[g+_]===void 0)&&j(g,R.length-(_+1))}function at(R,g,_,U,G,tt){if(R>_||R<g){const ot=typeof g=="bigint"?"n":"";let Ht;throw g===0||g===BigInt(0)?Ht=`>= 0${ot} and < 2${ot} ** ${(tt+1)*8}${ot}`:Ht=`>= -(2${ot} ** ${(tt+1)*8-1}${ot}) and < 2 ** ${(tt+1)*8-1}${ot}`,new qt.ERR_OUT_OF_RANGE("value",Ht,R)}x(U,G,tt)}function nt(R,g){if(typeof R!="number")throw new qt.ERR_INVALID_ARG_TYPE(g,"number",R)}function j(R,g,_){throw Math.floor(R)!==R?(nt(R,_),new qt.ERR_OUT_OF_RANGE("offset","an integer",R)):g<0?new qt.ERR_BUFFER_OUT_OF_BOUNDS:new qt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,R)}const F=/[^+/0-9A-Za-z-_]/g;function V(R){if(R=R.split("=")[0],R=R.trim().replace(F,""),R.length<2)return"";for(;R.length%4!==0;)R=R+"=";return R}function ht(R,g){g=g||1/0;let _;const U=R.length;let G=null;const tt=[];for(let ot=0;ot<U;++ot){if(_=R.charCodeAt(ot),_>55295&&_<57344){if(!G){if(_>56319){(g-=3)>-1&&tt.push(239,191,189);continue}else if(ot+1===U){(g-=3)>-1&&tt.push(239,191,189);continue}G=_;continue}if(_<56320){(g-=3)>-1&&tt.push(239,191,189),G=_;continue}_=(G-55296<<10|_-56320)+65536}else G&&(g-=3)>-1&&tt.push(239,191,189);if(G=null,_<128){if((g-=1)<0)break;tt.push(_)}else if(_<2048){if((g-=2)<0)break;tt.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;tt.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;tt.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return tt}function pt(R){const g=[];for(let _=0;_<R.length;++_)g.push(R.charCodeAt(_)&255);return g}function Z(R,g){let _,U,G;const tt=[];for(let ot=0;ot<R.length&&!((g-=2)<0);++ot)_=R.charCodeAt(ot),U=_>>8,G=_%256,tt.push(G),tt.push(U);return tt}function _t(R){return t.toByteArray(V(R))}function vt(R,g,_,U){let G;for(G=0;G<U&&!(G+_>=g.length||G>=R.length);++G)g[G+_]=R[G];return G}function gt(R,g){return R instanceof g||R!=null&&R.constructor!=null&&R.constructor.name!=null&&R.constructor.name===g.name}function Ct(R){return R!==R}const fe=function(){const R="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const U=_*16;for(let G=0;G<16;++G)g[U+G]=R[_]+R[G]}return g}();function zt(R){return typeof BigInt>"u"?Xn:R}function Xn(){throw new Error("BigInt not supported")}})(H0);const dn=H0.Buffer,V0=e=>e===void 0?null:e;class Nv{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let X0=new Nv,Iv=!0;try{typeof localStorage<"u"&&localStorage&&(X0=localStorage,Iv=!1)}catch{}const Cv=X0,Lv=Object.assign,Mv=Object.keys,Uv=(e,t)=>{for(const n in e)t(e[n],n)},q0=e=>Mv(e).length,Fv=e=>{for(const t in e)return!1;return!0},Bv=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Pv=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),$v=(e,t)=>e===t||q0(e)===q0(t)&&Bv(e,(n,r)=>(n!==void 0||Pv(t,r))&&t[r]===n),Dv=Object.freeze,J0=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&J0(e[t])}return Dv(e)},Vu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Vu(e,t,n+1)}},jv=e=>e,zv=(e,t)=>t.includes(e);var Z0={};const jo=typeof vr<"u"&&vr.release&&/node|io\.js/.test(vr.release.name)&&Object.prototype.toString.call(typeof vr<"u"?vr:0)==="[object process]";let Vr;const Wv=()=>{if(Vr===void 0)if(jo){Vr=Tr();const e=vr.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Vr.set(t,""),t=r):t!==null&&(Vr.set(t,r),t=null)}t!==null&&Vr.set(t,"")}else typeof location=="object"?(Vr=Tr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Vr.set(`--${F0(t,"-")}`,n),Vr.set(`-${F0(t,"-")}`,n)}})):Vr=Tr();return Vr},Xu=e=>Wv().has(e),lc=e=>V0(jo?Z0[e.toUpperCase().replaceAll("-","_")]:Cv.getItem(e)),Q0=e=>Xu("--"+e)||lc(e)!==null;Q0("production");const Gv=jo&&zv(Z0.FORCE_COLOR,["true","1","2"])||!Xu("--no-colors")&&!Q0("no-color")&&(!jo||vr.stdout.isTTY)&&(!jo||Xu("--color")||lc("COLORTERM")!==null||(lc("TERM")||"").includes("color")),Kv=e=>new Uint8Array(e),Hv=e=>{const t=Kv(e.byteLength);return t.set(e),t};class Yv{constructor(t,n){this.left=t,this.right=n}}const gi=(e,t)=>new Yv(e,t);typeof DOMParser<"u"&&new DOMParser;const Vv=e=>Hx(e,(t,n)=>`${n}:${t};`).join(""),_i=Symbol,tp=_i(),ep=_i(),Xv=_i(),qv=_i(),Jv=_i(),np=_i(),Zv=_i(),qu=_i(),Qv=_i(),tT=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},eT={[tp]:gi("font-weight","bold"),[ep]:gi("font-weight","normal"),[Xv]:gi("color","blue"),[Jv]:gi("color","green"),[qv]:gi("color","grey"),[np]:gi("color","red"),[Zv]:gi("color","purple"),[qu]:gi("color","orange"),[Qv]:gi("color","black")},rp=Gv?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Tr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=eT[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=Vv(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:tT,nT=(...e)=>{console.log(...rp(e)),ip.forEach(t=>t.print(e))},rT=(...e)=>{console.warn(...rp(e)),e.unshift(qu),ip.forEach(t=>t.print(e))},ip=Ws(),sp=e=>({[Symbol.iterator](){return this},next:e}),iT=(e,t)=>sp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Ju=(e,t)=>sp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Zu{constructor(t,n){this.clock=t,this.len=n}}class zo{constructor(){this.clients=new Map}}const op=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Ep(e,s,a.clock,a.len,n)}}),sT=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ui((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},ap=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&sT(n,t.clock)!==null},Qu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=ls(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},oT=e=>{const t=new zo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)Vx(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Qu(t),t},uc=(e,t,n,r)=>{Mi(e.clients,t,()=>[]).push(new Zu(n,r))},aT=()=>new zo,cT=e=>{const t=aT();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Zu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Xs=(e,t)=>{oe(e.restEncoder,t.clients.size),cs(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),oe(e.restEncoder,n);const i=r.length;oe(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},th=e=>{const t=new zo,n=Xt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Xt(e.restDecoder),s=Xt(e.restDecoder);if(s>0){const o=Mi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Zu(e.readDsClock(),e.readDsLen()))}}return t},cp=(e,t,n)=>{const r=new zo,i=Xt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Xt(e.restDecoder),a=Xt(e.restDecoder),c=n.clients.get(o)||[],l=sn(n,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&uc(r,o,l,d-l);let h=Xr(c,f),m=c[h];for(!m.deleted&&m.id.clock<f&&(c.splice(h+1,0,vc(t,m,f-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(h,0,vc(t,m,d-m.id.clock)),m.delete(t))}else uc(r,o,f,d-f)}}if(r.clients.size>0){const s=new hs;return oe(s.restEncoder,0),Xs(s,r),s.toUint8Array()}return null},lp=G0;class qs extends qx{constructor({guid:t=wv(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=lp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new bp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=K0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>K0(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&pe(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(cs(this.subdocs).map(t=>t.guid))}transact(t,n=null){return pe(this,t,n)}get(t,n=pn){const r=Mi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==pn&&i!==n)if(i===pn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,to)}getText(t=""){return this.get(t,yi)}getMap(t=""){return this.get(t,eo)}getXmlElement(t=""){return this.get(t,ro)}getXmlFragment(t=""){return this.get(t,fs)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,cs(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new qs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,pe(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class up{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Xt(this.restDecoder)}readDsLen(){return Xt(this.restDecoder)}}class hp extends up{readLeftID(){return te(Xt(this.restDecoder),Xt(this.restDecoder))}readRightID(){return te(Xt(this.restDecoder),Xt(this.restDecoder))}readClient(){return Xt(this.restDecoder)}readInfo(){return Hs(this.restDecoder)}readString(){return Ys(this.restDecoder)}readParentInfo(){return Xt(this.restDecoder)===1}readTypeRef(){return Xt(this.restDecoder)}readLen(){return Xt(this.restDecoder)}readAny(){return Do(this.restDecoder)}readBuf(){return Hv(tr(this.restDecoder))}readJSON(){return JSON.parse(Ys(this.restDecoder))}readKey(){return Ys(this.restDecoder)}}class lT{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Xt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Xt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Js extends lT{constructor(t){super(t),this.keys=[],Xt(t),this.keyClockDecoder=new Ku(tr(t)),this.clientDecoder=new ac(tr(t)),this.leftClockDecoder=new Ku(tr(t)),this.rightClockDecoder=new Ku(tr(t)),this.infoDecoder=new W0(tr(t),Hs),this.stringDecoder=new yv(tr(t)),this.parentInfoDecoder=new W0(tr(t),Hs),this.typeRefDecoder=new ac(tr(t)),this.lenDecoder=new ac(tr(t))}readLeftID(){return new Zs(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Zs(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Do(this.restDecoder)}readBuf(){return tr(this.restDecoder)}readJSON(){return Do(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class uT{constructor(){this.restEncoder=rc()}toUint8Array(){return Gr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){oe(this.restEncoder,t)}writeDsLen(t){oe(this.restEncoder,t)}}class Wo extends uT{writeLeftID(t){oe(this.restEncoder,t.client),oe(this.restEncoder,t.clock)}writeRightID(t){oe(this.restEncoder,t.client),oe(this.restEncoder,t.clock)}writeClient(t){oe(this.restEncoder,t)}writeInfo(t){Pu(this.restEncoder,t)}writeString(t){Gs(this.restEncoder,t)}writeParentInfo(t){oe(this.restEncoder,t?1:0)}writeTypeRef(t){oe(this.restEncoder,t)}writeLen(t){oe(this.restEncoder,t)}writeAny(t){$o(this.restEncoder,t)}writeBuf(t){Qn(this.restEncoder,t)}writeJSON(t){Gs(this.restEncoder,JSON.stringify(t))}writeKey(t){Gs(this.restEncoder,t)}}class hT{constructor(){this.restEncoder=rc(),this.dsCurrVal=0}toUint8Array(){return Gr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,oe(this.restEncoder,n)}writeDsLen(t){t===0&&Hr(),oe(this.restEncoder,t-1),this.dsCurrVal+=t}}class hs extends hT{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new zu,this.clientEncoder=new sc,this.leftClockEncoder=new zu,this.rightClockEncoder=new zu,this.infoEncoder=new P0(Pu),this.stringEncoder=new pv,this.parentInfoEncoder=new P0(Pu),this.typeRefEncoder=new sc,this.lenEncoder=new sc}toUint8Array(){const t=rc();return oe(t,0),Qn(t,this.keyClockEncoder.toUint8Array()),Qn(t,this.clientEncoder.toUint8Array()),Qn(t,this.leftClockEncoder.toUint8Array()),Qn(t,this.rightClockEncoder.toUint8Array()),Qn(t,Gr(this.infoEncoder)),Qn(t,this.stringEncoder.toUint8Array()),Qn(t,Gr(this.parentInfoEncoder)),Qn(t,this.typeRefEncoder.toUint8Array()),Qn(t,this.lenEncoder.toUint8Array()),ic(t,Gr(this.restEncoder)),Gr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){$o(this.restEncoder,t)}writeBuf(t){Qn(this.restEncoder,t)}writeJSON(t){$o(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const fT=(e,t,n,r)=>{r=ls(r,t[0].id.clock);const i=Xr(t,r);oe(e.restEncoder,t.length-i),e.writeClient(n),oe(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},eh=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{sn(t,s)>i&&r.set(s,i)}),rh(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),oe(e.restEncoder,r.size),cs(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{fT(e,t.clients.get(i),i,s)})},dT=(e,t)=>{const n=Tr(),r=Xt(e.restDecoder);for(let i=0;i<r;i++){const s=Xt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Xt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(nc&u){case 0:{const f=e.readLen();o[l]=new lr(te(a,c),f),c+=f;break}case 10:{const f=Xt(e.restDecoder);o[l]=new ur(te(a,c),f),c+=f;break}default:{const f=(u&(mi|Zn))===0,d=new Ze(te(a,c),null,(u&Zn)===Zn?e.readLeftID():null,null,(u&mi)===mi?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&Uo)===Uo?e.readString():null,Yp(e,u));o[l]=d,c+=d.length}}}}return n},pT=(e,t,n)=>{const r=[];let i=cs(n.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new bp,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const m=h.id.client,p=n.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),n.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(k=>k!==m)}r.length=0};for(;;){if(u.constructor!==ur){const m=Mi(f,u.id.client,()=>sn(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(e,t);if(p!==null){r.push(u);const k=n.get(p)||{refs:[],i:0};if(k.refs.length===k.i)l(p,sn(t,p)),d();else{u=k.refs[k.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new hs;return eh(h,a,new Map),oe(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},mT=(e,t)=>eh(e,t.doc.store,t.beforeState),gT=(e,t,n,r=new Js(e))=>pe(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=dT(r,o),l=pT(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<sn(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const m=u.missing.get(d);(m==null||m>h)&&u.missing.set(d,h)}u.update=dc([u.update,l.update])}}else a.pendingStructs=l;const f=cp(r,i,a);if(a.pendingDs){const d=new Js(Ks(a.pendingDs));Xt(d.restDecoder);const h=cp(d,i,a);f&&h?a.pendingDs=dc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,fp(i.doc,d)}},n,!1),fp=(e,t,n,r=Js)=>{const i=Ks(t);gT(i,e,n,new r(i))},dp=(e,t,n)=>fp(e,t,n,hp),_T=(e,t,n=new Map)=>{eh(e,t.store,n),Xs(e,cT(t.store))},yT=(e,t=new Uint8Array([0]),n=new hs)=>{const r=pp(t);_T(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(NT(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Wo)return RT(i.map((s,o)=>o===0?s:CT(s)));if(n.constructor===hs)return dc(i)}return i[0]},bT=(e,t)=>yT(e,t,new Wo),kT=e=>{const t=new Map,n=Xt(e.restDecoder);for(let r=0;r<n;r++){const i=Xt(e.restDecoder),s=Xt(e.restDecoder);t.set(i,s)}return t},pp=e=>kT(new up(Ks(e)));class wT{constructor(){this.l=[]}}const mp=()=>new wT,gp=(e,t)=>e.l.push(t),_p=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},yp=(e,t,n)=>Vu(e.l,[t,n]);class Zs{constructor(t,n){this.client=t,this.clock=n}}const hc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,te=(e,t)=>new Zs(e,t),ET=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Hr()},Qs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!ap(t.ds,e.id),nh=(e,t)=>{const n=Mi(e.meta,nh,Ws),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<sn(r,s)&&Bi(e,te(s,i))}),op(e,t.ds,i=>{}),n.add(t))};class bp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const rh=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},sn=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},kp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Hr()}n.push(t)},Xr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ui(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ui((n+r)/2)}throw Hr()},ih=(e,t)=>{const n=e.clients.get(t.client);return n[Xr(n,t.clock)]},sh=(e,t,n)=>{const r=Xr(t,n),i=t[r];return i.id.clock<n&&i instanceof Ze?(t.splice(r+1,0,vc(e,i,n-i.id.clock)),r+1):r},Bi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[sh(e,n,t.clock)]},wp=(e,t,n)=>{const r=t.clients.get(n.client),i=Xr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==lr&&r.splice(i+1,0,vc(e,s,n.clock-s.id.clock+1)),s},xT=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Xr(r,t.id.clock)]=n},Ep=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=sh(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&sh(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class vT{constructor(t,n,r){this.doc=t,this.deleteSet=new zo,this.beforeState=rh(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const xp=(e,t)=>t.deleteSet.clients.size===0&&!Yx(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Qu(t.deleteSet),mT(e,t),Xs(e,t.deleteSet),!0),vp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Mi(e.changed,t,Ws).add(n)},fc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},TT=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Xr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Ze&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},AT=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=I0(i.length-1,1+Xr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+fc(i,c)}})},Tp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Qu(s),n.afterState=rh(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),yp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Vu(a,[]),n._needFormattingCleanup&&HT(n)}finally{r.gc&&TT(s,i,r.gcFilter),AT(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),m=ls(Xr(h,d),1);for(let p=h.length-1;p>=m;)p-=1+fc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),m=Xr(h,d);m+1<h.length&&fc(h,m+1)>1||m>0&&fc(h,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(nT(qu,tp,"[yjs] ",ep,np,"Changed the client-id because another client seems to be using it."),r.clientID=lp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Wo;xp(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new hs;xp(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Tp(e,t+1)}}},pe=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new vT(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Tp(i,0)}}return o};function*ST(e){const t=Xt(e.restDecoder);for(let n=0;n<t;n++){const r=Xt(e.restDecoder),i=e.readClient();let s=Xt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Xt(e.restDecoder);yield new ur(te(i,s),c),s+=c}else if(nc&a){const c=(a&(mi|Zn))===0,l=new Ze(te(i,s),null,(a&Zn)===Zn?e.readLeftID():null,null,(a&mi)===mi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&Uo)===Uo?e.readString():null,Yp(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new lr(te(i,s),c),s+=c}}}}class oh{constructor(t,n){this.gen=ST(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ur);return this.curr}}class ah{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const RT=e=>dc(e,hp,Wo),OT=(e,t)=>{if(e.constructor===lr){const{client:n,clock:r}=e.id;return new lr(te(n,r+t),e.length-t)}else if(e.constructor===ur){const{client:n,clock:r}=e.id;return new ur(te(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Ze(te(r,i+t),null,te(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},dc=(e,t=Js,n=hs)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Ks(u)));let i=r.map(u=>new oh(u,!0)),s=null;const o=new n,a=new ah(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const m=d.curr.id.clock-h.curr.id.clock;return m===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===ur?1:-1:m}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===ur)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ur(te(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===ur?s.struct.length-=m:d=OT(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==ur;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),ch(a);const c=r.map(u=>th(u)),l=oT(c);return Xs(o,l),o.toUint8Array()},NT=(e,t,n=Js,r=hs)=>{const i=pp(t),s=new r,o=new ah(s),a=new n(Ks(e)),c=new oh(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===ur){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,ls(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}ch(o);const l=th(a);return Xs(s,l),s.toUint8Array()},Ap=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Gr(e.encoder.restEncoder)}),e.encoder.restEncoder=rc(),e.written=0)},Pi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Ap(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),oe(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},ch=e=>{Ap(e);const t=e.encoder.restEncoder;oe(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];oe(t,r.written),ic(t,r.restEncoder)}},IT=(e,t,n,r)=>{const i=new n(Ks(e)),s=new oh(i,!1),o=new r,a=new ah(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,t(l),0);ch(a);const c=th(i);return Xs(o,c),o.toUint8Array()},CT=e=>IT(e,jv,Js,Wo),Sp="You must not compute changes after the event-handler fired.";class pc{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=LT(this.currentTarget,this.target))}deletes(t){return ap(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(Sp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Mu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Mu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Mu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(Sp);const n=this.target,r=Ws(),i=Ws(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const LT=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},bn=()=>{rT("Invalid access: Add Yjs type to a document before reading data.")},Rp=80;let lh=0;class MT{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=lh++}}const UT=e=>{e.timestamp=lh++},Op=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=lh++},FT=(e,t,n)=>{if(e.length>=Rp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Op(r,t,n),r}else{const r=new MT(t,n);return e.push(r),r}},mc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>ec(t-s.index)<ec(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,UT(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ec(n.index-i)<r.parent.length/Rp?(Op(n,r,i),n):FT(e._searchMarker,r,i)},Go=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=ls(t,i.index+n))}},gc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Mi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;yp(r._eH,n,t)};class pn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=mp(),this._dEH=mp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Kr()}clone(){throw Kr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){gp(this._eH,t)}observeDeep(t){gp(this._dEH,t)}unobserve(t){_p(this._eH,t)}unobserveDeep(t){_p(this._dEH,t)}toJSON(){}}const Np=(e,t,n)=>{e.doc??bn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Ip=e=>{e.doc??bn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Ko=(e,t)=>{let n=0,r=e._start;for(e.doc??bn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Cp=(e,t)=>{const n=[];return Ko(e,(r,i)=>{n.push(t(r,i,e))}),n},BT=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Lp=(e,t)=>{e.doc??bn();const n=mc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},_c=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ze(te(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ps(l)),i.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Ze(te(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ho(new Uint8Array(f))),i.integrate(e,0);break;case qs:i=new Ze(te(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Vo(f)),i.integrate(e,0);break;default:if(f instanceof pn)i=new Ze(te(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new bi(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Mp=()=>Fi("Length exceeded!"),Up=(e,t,n,r)=>{if(n>t._length)throw Mp();if(n===0)return t._searchMarker&&Go(t._searchMarker,n,r.length),_c(e,t,null,r);const i=n,s=mc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Bi(e,te(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Go(t._searchMarker,i,r.length),_c(e,t,o,r)},PT=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return _c(e,t,i,n)},Fp=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=mc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Bi(e,te(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Bi(e,te(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Mp();t._searchMarker&&Go(t._searchMarker,i,-s+r)},yc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},uh=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ps([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ps([r]);break;case Uint8Array:a=new Ho(r);break;case qs:a=new Vo(r);break;default:if(r instanceof pn)a=new bi(r);else throw new Error("Unexpected content type")}new Ze(te(o,sn(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},hh=(e,t)=>{e.doc??bn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Bp=e=>{const t={};return e.doc??bn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Pp=(e,t)=>{e.doc??bn();const n=e._map.get(t);return n!==void 0&&!n.deleted},$T=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Qs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},bc=e=>(e.doc??bn(),iT(e._map.entries(),t=>!t[1].deleted));class DT extends pc{}class to extends pn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new to;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new to}clone(){const t=new to;return t.insert(0,this.toArray().map(n=>n instanceof pn?n.clone():n)),t}get length(){return this.doc??bn(),this._length}_callObserver(t,n){super._callObserver(t,n),gc(this,t,new DT(this,t))}insert(t,n){this.doc!==null?pe(this.doc,r=>{Up(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?pe(this.doc,n=>{PT(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{Fp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Lp(this,t)}toArray(){return Ip(this)}slice(t=0,n=this.length){return Np(this,t,n)}toJSON(){return this.map(t=>t instanceof pn?t.toJSON():t)}map(t){return Cp(this,t)}forEach(t){Ko(this,t)}[Symbol.iterator](){return BT(this)}_write(t){t.writeTypeRef(hA)}}const jT=e=>new to;class zT extends pc{constructor(t,n,r){super(t,n),this.keysChanged=r}}class eo extends pn{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new eo}clone(){const t=new eo;return this.forEach((n,r)=>{t.set(r,n instanceof pn?n.clone():n)}),t}_callObserver(t,n){gc(this,t,new zT(this,t,n))}toJSON(){this.doc??bn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof pn?i.toJSON():i}}),t}get size(){return[...bc(this)].length}keys(){return Ju(bc(this),t=>t[0])}values(){return Ju(bc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Ju(bc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??bn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?pe(this.doc,n=>{yc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?pe(this.doc,r=>{uh(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return hh(this,t)}has(t){return Pp(this,t)}clear(){this.doc!==null?pe(this.doc,t=>{this.forEach(function(n,r,i){yc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(fA)}}const WT=e=>new eo,$i=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&$v(e,t);class fh{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Hr(),this.right.content.constructor){case Je:this.right.deleted||no(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const $p=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Je:t.right.deleted||no(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Bi(e,te(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},kc=(e,t,n,r)=>{const i=new Map,s=r?mc(t,n):null;if(s){const o=new fh(s.p.left,s.p,s.index,i);return $p(e,o,n-s.index)}else{const o=new fh(null,t._start,0,i);return $p(e,o,n)}},Dp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Je&&$i(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ze(te(s,sn(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new Je(a,o));u.integrate(e,0),n.right=u,n.forward()})},no=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},jp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Je&&$i(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},zp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!$i(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Ze(te(s,sn(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new Je(a,c)),n.right.integrate(e,0),n.forward()}}return o},dh=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;jp(n,i);const a=zp(e,t,n,i),c=r.constructor===String?new qr(r):r instanceof pn?new bi(r):new ds(r);let{left:l,right:u,index:f}=n;t._searchMarker&&Go(t._searchMarker,n.index,c.getLength()),u=new Ze(te(o,sn(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=f,n.forward(),Dp(e,t,n,a)},Wp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;jp(n,i);const a=zp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Je));){if(!n.right.deleted)switch(n.right.content.constructor){case Je:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if($i(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Bi(e,te(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ze(te(o,sn(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new qr(c)),n.right.integrate(e,0),n.forward()}Dp(e,t,n,a)},Gp=(e,t,n,r,i)=>{let s=t;const o=Tr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case Je:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&no(i,l);break}}}t=t.right}return a},GT=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Je){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},KT=e=>{let t=0;return pe(e.doc,n=>{let r=e._start,i=e._start,s=Tr();const o=Lu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:no(o,i.content);break;default:t+=Gp(n,r,i,s,o),s=Lu(o),r=i;break}i=i.right}}),t},HT=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Ep(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==lr&&t.add(o.parent)})}pe(n,r=>{op(e,e.deleteSet,i=>{if(i instanceof lr||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Je?t.add(s):GT(r,i)});for(const i of t)KT(i)})},Kp=(e,t,n)=>{const r=n,i=Lu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case bi:case ds:case qr:n<t.right.length&&Bi(e,te(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Gp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Go(o._searchMarker,t.index,-r+n),t};class YT extends pc{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];pe(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},Fv(c)||(h.attributes=Lv({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case bi:case ds:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case qr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;$i(p,m)?m!==null&&o.delete(r):(a==="retain"&&d(),$i(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;$i(p,m)||(a==="retain"&&d(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&($i(p,m)?p!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&d(),no(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class yi extends pn{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??bn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new yi}clone(){const t=new yi;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new YT(this,t,n);gc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??bn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===qr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?pe(this.doc,r=>{const i=new fh(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&dh(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Wp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Kp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??bn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((m,p)=>{d=!0,f[p]=m});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Qs(c,t)||n!==void 0&&Qs(c,n))switch(c.content.constructor){case qr:{const f=s.get("ychange");t!==void 0&&!Qs(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Qs(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case bi:case ds:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,m)=>{d[m]=h})}i.push(f);break}case Je:Qs(c,t)&&(l(),no(s,c.content));break}c=c.right}l()};return t||n?pe(o,f=>{t&&nh(f,t),n&&nh(f,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?pe(i,s=>{const o=kc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),dh(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?pe(i,s=>{const o=kc(s,this,t,!r);dh(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?pe(r,i=>{Kp(i,kc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?pe(i,s=>{const o=kc(s,this,t,!1);o.right!==null&&Wp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{yc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{uh(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return hh(this,t)}getAttributes(){return Bp(this)}_write(t){t.writeTypeRef(dA)}}const VT=e=>new yi;class ph{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??bn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===ro||n.constructor===fs)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class fs extends pn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new fs}clone(){const t=new fs;return t.insert(0,this.toArray().map(n=>n instanceof pn?n.clone():n)),t}get length(){return this.doc??bn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new ph(this,t)}querySelector(t){t=t.toUpperCase();const r=new ph(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),cs(new ph(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){gc(this,t,new JT(this,n,t))}toString(){return Cp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ko(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?pe(this.doc,r=>{Up(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)pe(this.doc,r=>{const i=t&&t instanceof pn?t._item:t;_c(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Fi("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{Fp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Ip(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Lp(this,t)}slice(t=0,n=this.length){return Np(this,t,n)}forEach(t){Ko(this,t)}_write(t){t.writeTypeRef(mA)}}const XT=e=>new fs;class ro extends fs{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new ro(this.nodeName)}clone(){const t=new ro(this.nodeName),n=this.getAttributes();return Uv(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof pn?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{yc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{uh(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return hh(this,t)}hasAttribute(t){return Pp(this,t)}getAttributes(t){return t?$T(this,t):Bp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ko(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(pA),t.writeKey(this.nodeName)}}const qT=e=>new ro(e.readKey());class JT extends pc{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class wc extends eo{constructor(t){super(),this.hookName=t}_copy(){return new wc(this.hookName)}clone(){const t=new wc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(gA),t.writeKey(this.hookName)}}const ZT=e=>new wc(e.readKey());class Ec extends yi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Ec}clone(){const t=new Ec;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(_A)}}const QT=e=>new Ec;class mh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Kr()}mergeWith(t){return!1}write(t,n,r){throw Kr()}integrate(t,n){throw Kr()}}const tA=0;class lr extends mh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),kp(t.doc.store,this)}write(t,n){t.writeInfo(tA),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ho{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ho(this.content)}splice(t){throw Kr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const eA=e=>new Ho(e.readBuf());class Yo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Yo(this.len)}splice(t){const n=new Yo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){uc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const nA=e=>new Yo(e.readLen()),Hp=(e,t)=>new qs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Vo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Vo(Hp(this.doc.guid,this.opts))}splice(t){throw Kr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const rA=e=>new Vo(Hp(e.readString(),e.readAny()));class ds{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ds(this.embed)}splice(t){throw Kr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const iA=e=>new ds(e.readJSON());class Je{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(t){throw Kr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const sA=e=>new Je(e.readKey(),e.readJSON());class xc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xc(this.arr)}splice(t){const n=new xc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const oA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new xc(n)},aA=lc("node_env")==="development";class ps{constructor(t){this.arr=t,aA&&J0(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ps(this.arr)}splice(t){const n=new ps(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const cA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ps(n)};class qr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new qr(this.str)}splice(t){const n=new qr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const lA=e=>new qr(e.readString()),uA=[jT,WT,VT,qT,XT,ZT,QT],hA=0,fA=1,dA=2,pA=3,mA=4,gA=5,_A=6;class bi{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new bi(this.type._copy())}splice(t){throw Kr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const yA=e=>new bi(uA[e.readTypeRef()](e)),vc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Ze(te(r,i+n),t,te(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=te(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Ze extends mh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?M0:0}set marker(t){(this.info&Fu)>0!==t&&(this.info^=Fu)}get marker(){return(this.info&Fu)>0}get keep(){return(this.info&L0)>0}set keep(t){this.keep!==t&&(this.info^=L0)}get countable(){return(this.info&M0)>0}get deleted(){return(this.info&Uu)>0}set deleted(t){this.deleted!==t&&(this.info^=Uu)}markDeleted(){this.info|=Uu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=sn(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=sn(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Zs&&this.id.client!==this.parent.client&&this.parent.clock>=sn(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=wp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Bi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===lr||this.right&&this.right.constructor===lr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Zs){const r=ih(n,this.parent);r.constructor===lr?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=wp(t,t.doc.store,te(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),hc(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(hc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(ih(t.doc.store,i.origin)))s.has(ih(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),kp(t.doc.store,this),this.content.integrate(t,this),vp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new lr(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:te(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&hc(t.origin,this.lastId)&&this.right===t&&hc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),uc(t.deleteSet,this.id.client,this.id.clock,this.length),vp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Hr();this.content.gc(t),n?xT(t,this,new lr(this.id,this.length)):this.content=new Yo(this.length)}write(t,n){const r=n>0?te(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&nc|(r===null?0:Zn)|(i===null?0:mi)|(s===null?0:Uo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=ET(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Zs?(t.writeParentInfo(!1),t.writeLeftID(a)):Hr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const Yp=(e,t)=>bA[t&nc](e),bA=[()=>{Hr()},nA,oA,eA,lA,iA,sA,yA,cA,rA,()=>{Hr()}],kA=10;class ur extends mh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Hr()}write(t,n){t.writeInfo(kA),oe(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Vp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof zs<"u"?zs:{},Xp="__ $YJS$ __";Vp[Xp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Vp[Xp]=!0;let qp=!1;const er=new qs;function Jp(e,t,n){const r=er.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function wA(e,t){Jp(e,0,t)}function gh(e,t){const n=new yi(t);Jp(e,1,n)}function EA(e,t){er.getMap().set(e,t)}function xA(e,t){const n=er.getMap(),r=new yi(t);n.set(e,r)}function Zp(e,t){const n=er.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function vA(e,t){return Zp(e,n=>{xt(n)&&t(n)})}function Qp(e,t){return Zp(e,n=>{n instanceof yi&&t(n.toJSON())})}const ms=Ps("modem",["second"],e=>{if(ms.session(e))switch(e.target){case"second":!qp&&e.data%2===0&&ms.emit(e.player,"modem:join");break;case"join":e.sender!==ms.id()&&ms.reply(e,"joinack",S0(bT(er)));break;case"joinack":e.sender!==ms.id()&&(qp=!0,dp(er,Qa(e.data),er));break;case"sync":{e.sender!==ms.id()&&b(e.data)&&dp(er,Qa(e.data),er);break}}});function tm(e,t){t!==er&&ms.emit("","modem:sync",S0(e))}er.on("update",tm),er.on("destroy",()=>{er.off("update",tm)});function TA(e,t){return e%t}function AA(e,t){return Math.floor(e/t)}function SA(e,t){return{x:TA(e,t),y:AA(e,t)}}function hr(e,t){return e.x+e.y*t}function io(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function _h(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function em(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function nm(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const rm="176",RA="",Ar="srgb",im="srgb-linear",sm="linear",yh="srgb";function Sr(e,t,n){return Math.max(t,Math.min(n,e))}function OA(e,t){return(e%t+t)%t}function bh(e,t,n){return(1-n)*e+n*t}class Xo{constructor(t=0,n=0){Xo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Sr(this.x,t.x,n.x),this.y=Sr(this.y,t.y,n.y),this}clampScalar(t,n){return this.x=Sr(this.x,t,n),this.y=Sr(this.y,t,n),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Sr(r,t,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Sr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qo{constructor(t,n,r,i,s,o,a,c,l){qo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],m=r[8],p=i[0],k=i[3],y=i[6],v=i[1],T=i[4],A=i[7],L=i[2],S=i[5],I=i[8];return s[0]=o*p+a*v+c*L,s[3]=o*k+a*T+c*S,s[6]=o*y+a*A+c*I,s[1]=l*p+u*v+f*L,s[4]=l*k+u*T+f*S,s[7]=l*y+u*A+f*I,s[2]=d*p+h*v+m*L,s[5]=d*k+h*T+m*S,s[8]=d*y+h*A+m*I,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,m=n*f+r*d+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=f*p,t[1]=(i*l-u*r)*p,t[2]=(a*r-i*o)*p,t[3]=d*p,t[4]=(u*n-i*c)*p,t[5]=(i*s-a*n)*p,t[6]=h*p,t[7]=(r*c-l*n)*p,t[8]=(o*n-r*s)*p,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(kh.makeScale(t,n)),this}rotate(t){return this.premultiply(kh.makeRotation(-t)),this}translate(t,n){return this.premultiply(kh.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const kh=new qo,om=new qo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),am=new qo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function NA(){const e={enabled:!0,workingColorSpace:im,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===yh&&(i.r=so(i.r),i.g=so(i.g),i.b=so(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===yh&&(i.r=oo(i.r),i.g=oo(i.g),i.b=oo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===RA?sm:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[im]:{primaries:t,whitePoint:r,transfer:sm,toXYZ:om,fromXYZ:am,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Ar},outputColorSpaceConfig:{drawingBufferColorSpace:Ar}},[Ar]:{primaries:t,whitePoint:r,transfer:yh,toXYZ:om,fromXYZ:am,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Ar}}}),e}const Rr=NA();function so(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function oo(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const cm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Di={h:0,s:0,l:0},Tc={h:0,s:0,l:0};function wh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class Eh{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=Ar){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Rr.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Rr.workingColorSpace){return this.r=t,this.g=n,this.b=r,Rr.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Rr.workingColorSpace){if(t=OA(t,1),n=Sr(n,0,1),r=Sr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=wh(o,s,t+1/3),this.g=wh(o,s,t),this.b=wh(o,s,t-1/3)}return Rr.toWorkingColorSpace(this,i),this}setStyle(t,n=Ar){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=Ar){const r=cm[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=so(t.r),this.g=so(t.g),this.b=so(t.b),this}copyLinearToSRGB(t){return this.r=oo(t.r),this.g=oo(t.g),this.b=oo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ar){return Rr.fromWorkingColorSpace(kn.copy(this),t),Math.round(Sr(kn.r*255,0,255))*65536+Math.round(Sr(kn.g*255,0,255))*256+Math.round(Sr(kn.b*255,0,255))}getHexString(t=Ar){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Rr.workingColorSpace){Rr.fromWorkingColorSpace(kn.copy(this),n);const r=kn.r,i=kn.g,s=kn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=Rr.workingColorSpace){return Rr.fromWorkingColorSpace(kn.copy(this),n),t.r=kn.r,t.g=kn.g,t.b=kn.b,t}getStyle(t=Ar){Rr.fromWorkingColorSpace(kn.copy(this),t);const n=kn.r,r=kn.g,i=kn.b;return t!==Ar?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Di),this.setHSL(Di.h+t,Di.s+n,Di.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Di),t.getHSL(Tc);const r=bh(Di.h,Tc.h,n),i=bh(Di.s,Tc.s,n),s=bh(Di.l,Tc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const kn=new Eh;Eh.NAMES=cm,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:rm}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=rm),new Xo,new Xo;function mn(e,t,n){return Math.max(t,Math.min(n,e))}function lm(e){return e/180*Math.PI}function um(e){return e*180/Math.PI}const IA=jd("089fad0j9awfem09wavefc09uwaef");function CA(){return IA()}function LA(e){return jd(e)()}function fr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(CA()*i)}function hm(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(LA(e)*s)}function fm(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function MA(e){return e[fr(0,e.length-1)]}function UA(e,t){return t[hm(e,0,t.length-1)]}function An(...e){return MA(e.flat())}function FA(e,...t){return UA(e,t.flat())}function BA(e){return[...new Set(e)].filter(b)}function gs(e){return b(e)&&b(e.x)&&b(e.y)}function ze(e,t){switch(t){case mt.NORTH:--e.y;break;case mt.SOUTH:++e.y;break;case mt.WEST:--e.x;break;case mt.EAST:++e.x;break}return e}function PA(e,t){return e<0?mt.WEST:e>0?mt.EAST:t<0?mt.NORTH:t>0?mt.SOUTH:mt.IDLE}function Or(e,t){return PA(t.x-e.x,t.y-e.y)}const xh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function nr(e){return ue(e)&&dm(e[0])}function dm(e){return b(mt[e])&&yt(e)}function $A(e){const t=mt[e];return b(t)?t:mt.IDLE}function vh(e){if(yt(e))return xh[It(e)]}function DA(e){if(nr(e))return e;if(dm(e))return[e];const t=vh(e);if(b(t))return[t]}function pm(e){const t=w.words[e],n=DA(t);return nr(n)?[n,e+1]:[void 0,e]}function mm(e){var i,s;const t=[];let[n,r]=pm(e);for(;nr(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=it(w.words,r,[H.NUMBER,H.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=it(w.words,r,[H.KIND]);console.info("kind",c),r=l;break}case"TO":{const[c,l,u]=it(w.words,r,[H.DIR,H.DIR]),f=((i=w.element)==null?void 0:i.x)??0,d=((s=w.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,t.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,r]}const[o,a]=pm(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function jA(e){return b(e)&&e<Lt.ONBLACK?e:void 0}function zA(e){return b(e)&&e>Lt.WHITE&&e<Lt.ONCLEAR?e-Lt.ONBLACK:void 0}const Jo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function wn(e){return ue(e)&&_m(e[0])}function gm(e){return wn(e)&&e[0].startsWith("ON")}function _m(e){return b(Lt[e])&&yt(e)}function Zo(e){if(yt(e))return Jo[It(e)]}function Ac(e){return e.map(t=>Lt[t]).find(t=>b(t)&&t<Lt.ONBLACK)}function Sc(e){return e.map(t=>Lt[t]).find(t=>b(t)&&t>=Lt.ONBLACK)}function WA(e){if(wn(e))return e;if(_m(e))return[e];const t=Zo(e);if(b(t))return[t]}function ym(e){const t=w.words[e],n=WA(t);return wn(n)?[n,e+1]:[void 0,e]}function Rc(e){const t=[];let n=e;const[r,i]=ym(e);if(wn(r)&&(t.push(...r),n=i),wn(t)&&!gm(t)){const[s,o]=ym(i);gm(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function bm(e){const t={};for(let n=0;n<e.length;++n){const r=e[n],i=Lt[r];b(i)&&(i<Lt.ONBLACK?t.color=i:t.bg=i-Lt.ONBLACK)}return t}var km={exports:{}},Th={exports:{}},wm;function GA(){return wm||(wm=1,function(e,t){(function(n,r){e.exports=r()})(Un,function(){function n(p){return!isNaN(parseFloat(p))&&isFinite(p)}function r(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(p){if(p)for(var k=0;k<u.length;k++)p[u[k]]!==void 0&&this["set"+r(u[k])](p[u[k]])}f.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof f)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new f(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",k=this.getLineNumber()||"",y=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+k+":"+y+")":"[eval]:"+k+":"+y:v?v+" ("+p+":"+k+":"+y+")":p+":"+k+":"+y}},f.fromString=function(k){var y=k.indexOf("("),v=k.lastIndexOf(")"),T=k.substring(0,y),A=k.substring(y+1,v).split(","),L=k.substring(v+1);if(L.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(L,""),I=S[1],D=S[2],N=S[3];return new f({functionName:T,args:A||void 0,fileName:I,lineNumber:D||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(p){return function(k){this[p]=!!k}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(p){return function(k){if(!n(k))throw new TypeError(p+" must be a Number");this[p]=Number(k)}}(o[h]);for(var m=0;m<a.length;m++)f.prototype["get"+r(a[m])]=i(a[m]),f.prototype["set"+r(a[m])]=function(p){return function(k){this[p]=String(k)}}(a[m]);return f})}(Th)),Th.exports}(function(e,t){(function(n,r){e.exports=r(GA())})(Un,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),m=d&&f||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var k=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new r({functionName:m,args:k,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(km);var KA=km.exports,HA=Fs(KA);const St=60,Vt=25,Ah=St*Vt;var bt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(bt||{});const Sh=14,Oc=3,ji=8,zi=14,Nc=16,YA=16,VA=16;var Ic=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(Ic||{});function Qo(e,t){return new Array(e).fill(t)}function XA(e,t,n,r,i,s=0){const o=r*i;return{id:`tiles:${e}:${t}`,type:1,tag:n,width:r,height:i,char:Qo(o,0),color:Qo(o,0),bg:Qo(o,s),wall:Qo(o,0)}}function qA(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Lt.ONCLEAR}}function JA(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function ZA(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:Qo(s,i)}}function QA(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function tS(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Em(e,t){return`${e}:${t}`}const eS=1,nS=16,rS=256;var Sn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Sn||{});const Jr=!!JSON.parse("false"),iS=!!JSON.parse("false");JSON.parse("false");const xm=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ki={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return ji*ki.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return zi*ki.DRAW_CHAR_SCALE}},et=Ps("SOFTWARE");function wi(e){const t={},n={tick(){},everytick(){},listcommands(){return Jn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Te(e){return`${e??""}`}function ta(e,t){const n=parseFloat(Te(e));return isNaN(n)?t:n}function vm(e,t,n){var i;const[r]=it(t,0,[H.MAYBE_NAME]);ax(et,e,((i=w.board)==null?void 0:i.id)??"",r??"",n)}function $n(e,t,n,r){const[i,s]=it(r,0,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);n0(et,e,t,n,i,s)}const sS=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Tm(e,t,n){const[r,i]=it(n,0,[H.NUMBER_OR_STRING]);if(xt(r))bu(et,e,t,"volume",r);else if(sS.includes(It(r))){const[s,o]=it(n,i,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);n0(et,e,t,r,s,o)}else{const[s]=it(n,i,[H.MAYBE_NUMBER_OR_STRING]);if(xt(s)){const o=n.length-i,a=new Array(o).fill(H.NUMBER),c=it(n,i,a).slice(0,o),l=c.length===1?c[0]:c;bu(et,e,t,r,l)}else{const[o]=it(n,i,[H.MAYBE_NUMBER_OR_STRING]);bu(et,e,t,r,o)}}}let Am="en-US-GuyNeural";const Rh=wi().command("talk",(e,t)=>{const[n]=it(t,0,[H.ANY]);switch(It(n)){default:zE(et,w.elementfocus);break;case"stop":WE(et,w.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=it(t,0,[H.ANY]);switch(It(n)){default:GE(et,w.elementfocus);break;case"stop":KE(et,w.elementfocus);break}return 0}).command("tts",(e,t)=>{const n=t.map(Te).join("");return ox(et,w.elementfocus,Am,n),0}).command("ttsvoice",(e,t)=>(Am=t.map(Te).join(""),0)).command("bpm",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return lx(et,w.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return ux(et,w.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return hx(et,w.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[H.NUMBER]);return fx(et,w.elementfocus,n),0}).command("play",(e,t)=>(vm(w.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(vm(w.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)Tm(w.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)$n(w.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)$n(w.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)$n(w.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)$n(w.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)$n(w.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)$n(w.elementfocus,n,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let n=0;n<3;++n)$n(w.elementfocus,n,"autowah",t);return 0});for(let e=0;e<8;++e)Rh.command(`synth${e+1}`,(t,n)=>(Tm(w.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Rh.command(`echo${t}`,(n,r)=>($n(w.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>($n(w.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>($n(w.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>($n(w.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>($n(w.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>($n(w.elementfocus,e,"vibrato",r),0)).command(`autowah${t}`,(n,r)=>($n(w.elementfocus,e,"autowah",r),0))}var Oh;try{Oh=new TextDecoder}catch{}var kt,dr,K=0,me={},ee,Wi,pr=0,Zr=0,on,Ei,Dn=[],Jt,Sm={useRecords:!1,mapsAsObjects:!0};class Rm{}const Om=new Rm;Om.name="MessagePack 0xC1";var Gi=!1,Nm=2,Im;try{new Function("")}catch{Nm=1/0}class ea{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(kt)return Gm(()=>(Mh(),this?this.unpack(t,n):ea.prototype.unpack.call(Sm,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof dn<"u"?dn.from(t):new Uint8Array(t)),typeof n=="object"?(dr=n.end||t.length,K=n.start||0):(K=0,dr=n>-1?n:t.length),Zr=0,Wi=null,on=null,kt=t;try{Jt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw kt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof ea){if(me=this,this.structures)return ee=this.structures,Cc(n);(!ee||ee.length>0)&&(ee=[])}else me=Sm,(!ee||ee.length>0)&&(ee=[]);return Cc(n)}unpackMultiple(t,n){let r,i=0;try{Gi=!0;let s=t.length,o=this?this.unpack(t,s):Lc.unpack(t,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Cc(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Cc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Gi=!1,Mh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Cc(e){try{if(!me.trusted&&!Gi){let n=ee.sharedLength||0;n<ee.length&&(ee.length=n)}let t;if(me.randomAccessStructure&&kt[K]<64&&kt[K]>=32&&Im?(t=Im(kt,K,dr,me),kt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),K=dr):t=We(),on&&(K=on.postBundlePosition,on=null),Gi&&(ee.restoreStructures=null),K==dr)ee&&ee.restoreStructures&&Cm(),ee=null,kt=null,Ei&&(Ei=null);else{if(K>dr)throw new Error("Unexpected end of MessagePack data");if(!Gi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw ee&&ee.restoreStructures&&Cm(),Mh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||K>dr)&&(t.incomplete=!0),t}}function Cm(){for(let e in ee.restoreStructures)ee[e]=ee.restoreStructures[e];ee.restoreStructures=null}function We(){let e=kt[K++];if(e<160)if(e<128){if(e<64)return e;{let t=ee[e&63]||me.getStructures&&Mm()[e&63];return t?(t.read||(t.read=Nh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Dm();r==="__proto__"&&(r="__proto_"),t[r]=We()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(We(),We());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=We();return me.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Zr>=K)return Wi.slice(K-pr,(K+=t)-pr);if(Zr==0&&dr<140){let n=t<16?Ch(t):Bm(t);if(n!=null)return n}return Ih(t)}else{let t;switch(e){case 192:return null;case 193:return on?(t=We(),t>0?on[1].slice(on.position1,on.position1+=t):on[0].slice(on.position0,on.position0-=t)):Om;case 194:return!1;case 195:return!0;case 196:if(t=kt[K++],t===void 0)throw new Error("Unexpected end of buffer");return Lh(t);case 197:return t=Jt.getUint16(K),K+=2,Lh(t);case 198:return t=Jt.getUint32(K),K+=4,Lh(t);case 199:return _s(kt[K++]);case 200:return t=Jt.getUint16(K),K+=2,_s(t);case 201:return t=Jt.getUint32(K),K+=4,_s(t);case 202:if(t=Jt.getFloat32(K),me.useFloat32>2){let n=Uh[(kt[K]&127)<<1|kt[K+1]>>7];return K+=4,(n*t+(t>0?.5:-.5)>>0)/n}return K+=4,t;case 203:return t=Jt.getFloat64(K),K+=8,t;case 204:return kt[K++];case 205:return t=Jt.getUint16(K),K+=2,t;case 206:return t=Jt.getUint32(K),K+=4,t;case 207:return me.int64AsType==="number"?(t=Jt.getUint32(K)*4294967296,t+=Jt.getUint32(K+4)):me.int64AsType==="string"?t=Jt.getBigUint64(K).toString():me.int64AsType==="auto"?(t=Jt.getBigUint64(K),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Jt.getBigUint64(K),K+=8,t;case 208:return Jt.getInt8(K++);case 209:return t=Jt.getInt16(K),K+=2,t;case 210:return t=Jt.getInt32(K),K+=4,t;case 211:return me.int64AsType==="number"?(t=Jt.getInt32(K)*4294967296,t+=Jt.getUint32(K+4)):me.int64AsType==="string"?t=Jt.getBigInt64(K).toString():me.int64AsType==="auto"?(t=Jt.getBigInt64(K),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Jt.getBigInt64(K),K+=8,t;case 212:if(t=kt[K++],t==114)return zm(kt[K++]&63);{let n=Dn[t];if(n)return n.read?(K++,n.read(We())):n.noBuffer?(K++,n()):n(kt.subarray(K,++K));throw new Error("Unknown extension "+t)}case 213:return t=kt[K],t==114?(K++,zm(kt[K++]&63,kt[K++])):_s(2);case 214:return _s(4);case 215:return _s(8);case 216:return _s(16);case 217:return t=kt[K++],Zr>=K?Wi.slice(K-pr,(K+=t)-pr):aS(t);case 218:return t=Jt.getUint16(K),K+=2,Zr>=K?Wi.slice(K-pr,(K+=t)-pr):cS(t);case 219:return t=Jt.getUint32(K),K+=4,Zr>=K?Wi.slice(K-pr,(K+=t)-pr):lS(t);case 220:return t=Jt.getUint16(K),K+=2,Um(t);case 221:return t=Jt.getUint32(K),K+=4,Um(t);case 222:return t=Jt.getUint16(K),K+=2,Fm(t);case 223:return t=Jt.getUint32(K),K+=4,Fm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const oS=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Nh(e,t){function n(){if(n.count++>Nm){let i=e.read=new Function("r","return function(){return "+(me.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":oS.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(We);return e.highByte===0&&(e.read=Lm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=We()}return me.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Lm(t,n):n}const Lm=(e,t)=>function(){let n=kt[K++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=ee[r]||Mm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Nh(i,e)),i.read()};function Mm(){let e=Gm(()=>(kt=null,me.getStructures()));return ee=me._mergeStructures(e,ee)}var Ih=na,aS=na,cS=na,lS=na;function na(e){let t;if(e<16&&(t=Ch(e)))return t;if(e>64&&Oh)return Oh.decode(kt.subarray(K,K+=e));const n=K+e,r=[];for(t="";K<n;){const i=kt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=kt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=kt[K++]&63,o=kt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=kt[K++]&63,o=kt[K++]&63,a=kt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=an.apply(String,r),r.length=0)}return r.length>0&&(t+=an.apply(String,r)),t}function Um(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=We();return me.freezeData?Object.freeze(t):t}function Fm(e){if(me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Dm();r==="__proto__"&&(r="__proto_"),t[r]=We()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(We(),We());return t}}var an=String.fromCharCode;function Bm(e){let t=K,n=new Array(e);for(let r=0;r<e;r++){const i=kt[K++];if((i&128)>0){K=t;return}n[r]=i}return an.apply(String,n)}function Ch(e){if(e<4)if(e<2){if(e===0)return"";{let t=kt[K++];if((t&128)>1){K-=1;return}return an(t)}}else{let t=kt[K++],n=kt[K++];if((t&128)>0||(n&128)>0){K-=2;return}if(e<3)return an(t,n);let r=kt[K++];if((r&128)>0){K-=3;return}return an(t,n,r)}else{let t=kt[K++],n=kt[K++],r=kt[K++],i=kt[K++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(e<6){if(e===4)return an(t,n,r,i);{let s=kt[K++];if((s&128)>0){K-=5;return}return an(t,n,r,i,s)}}else if(e<8){let s=kt[K++],o=kt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(e<7)return an(t,n,r,i,s,o);let a=kt[K++];if((a&128)>0){K-=7;return}return an(t,n,r,i,s,o,a)}else{let s=kt[K++],o=kt[K++],a=kt[K++],c=kt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(e<10){if(e===8)return an(t,n,r,i,s,o,a,c);{let l=kt[K++];if((l&128)>0){K-=9;return}return an(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=kt[K++],u=kt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(e<11)return an(t,n,r,i,s,o,a,c,l,u);let f=kt[K++];if((f&128)>0){K-=11;return}return an(t,n,r,i,s,o,a,c,l,u,f)}else{let l=kt[K++],u=kt[K++],f=kt[K++],d=kt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(e<14){if(e===12)return an(t,n,r,i,s,o,a,c,l,u,f,d);{let h=kt[K++];if((h&128)>0){K-=13;return}return an(t,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=kt[K++],m=kt[K++];if((h&128)>0||(m&128)>0){K-=14;return}if(e<15)return an(t,n,r,i,s,o,a,c,l,u,f,d,h,m);let p=kt[K++];if((p&128)>0){K-=15;return}return an(t,n,r,i,s,o,a,c,l,u,f,d,h,m,p)}}}}}function Pm(){let e=kt[K++],t;if(e<192)t=e-160;else switch(e){case 217:t=kt[K++];break;case 218:t=Jt.getUint16(K),K+=2;break;case 219:t=Jt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return na(t)}function Lh(e){return me.copyBuffers?Uint8Array.prototype.slice.call(kt,K,K+=e):kt.subarray(K,K+=e)}function _s(e){let t=kt[K++];if(Dn[t]){let n;return Dn[t](kt.subarray(K,n=K+=e),r=>{K=r;try{return We()}finally{K=n}})}else throw new Error("Unknown extension type "+t)}var $m=new Array(4096);function Dm(){let e=kt[K++];if(e>=160&&e<192){if(e=e-160,Zr>=K)return Wi.slice(K-pr,(K+=e)-pr);if(!(Zr==0&&dr<180))return Ih(e)}else return K--,jm(We());let t=(e<<5^(e>1?Jt.getUint16(K):e>0?kt[K]:0))&4095,n=$m[t],r=K,i=K+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Jt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=kt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],$m[t]=n,n.bytes=e;r<i;)s=Jt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=kt[r++],n.push(s);let a=e<16?Ch(e):Bm(e);return a!=null?n.string=a:n.string=Ih(e)}function jm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const zm=(e,t)=>{let n=We().map(jm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=ee[e];return i&&(i.isShared||Gi)&&((ee.restoreStructures||(ee.restoreStructures=[]))[e]=i),ee[e]=n,n.read=Nh(n,r),n.read()};Dn[0]=()=>{},Dn[0].noBuffer=!0,Dn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let uS={Error,TypeError,ReferenceError};Dn[101]=()=>{let e=We();return(uS[e[0]]||Error)(e[1],{cause:e[2]})},Dn[105]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Jt.getUint32(K-4);Ei||(Ei=new Map);let n=kt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Ei.set(t,i);let s=We();return i.used?Object.assign(r,s):(i.target=s,s)},Dn[112]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Jt.getUint32(K-4),n=Ei.get(t);return n.used=!0,n.target},Dn[115]=()=>new Set(We());const Wm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let hS=typeof globalThis=="object"?globalThis:window;Dn[116]=e=>{let t=e[0],n=Wm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new hS[n](Uint8Array.prototype.slice.call(e,1).buffer)},Dn[120]=()=>{let e=We();return new RegExp(e[0],e[1])};const fS=[];Dn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=K;return K+=t-e.length,on=fS,on=[Pm(),Pm()],on.position0=0,on.position1=0,on.postBundlePosition=K,K=n,We()},Dn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Gm(e){let t=dr,n=K,r=pr,i=Zr,s=Wi,o=Ei,a=on,c=new Uint8Array(kt.slice(0,dr)),l=ee,u=ee.slice(0,ee.length),f=me,d=Gi,h=e();return dr=t,K=n,pr=r,Zr=i,Wi=s,Ei=o,on=a,kt=c,Gi=d,ee=l,ee.splice(0,ee.length,...u),me=f,Jt=new DataView(kt.buffer,kt.byteOffset,kt.byteLength),h}function Mh(){kt=null,Ei=null,ee=null}const Uh=new Array(147);for(let e=0;e<256;e++)Uh[e]=+("1e"+Math.floor(45.15-e*.30103));var Lc=new ea({useRecords:!1});const dS=Lc.unpack;Lc.unpackMultiple,Lc.unpack;let pS=new Float32Array(1);new Uint8Array(pS.buffer,0,4);let Mc;try{Mc=new TextEncoder}catch{}let Fh,Km;const Uc=typeof dn<"u",Fc=Uc?function(e){return dn.allocUnsafeSlow(e)}:Uint8Array,Hm=Uc?dn:Uint8Array,Ym=Uc?4294967296:2144337920;let J,ra,ge,Y=0,Rn,Le=null,mS;const gS=21760,_S=/[\u0080-\uFFFF]/,ao=Symbol("record-id");class yS extends ea{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Hm.prototype.utf8Write?function(O,E){return J.utf8Write(O,E,J.byteLength-E)}:Mc&&Mc.encodeInto?function(O,E){return Mc.encodeInto(O,J.subarray(E)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,m=u+f+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],k=0,y=0;this.pack=this.encode=function(O,E){if(J||(J=new Fc(8192),ge=J.dataView||(J.dataView=new DataView(J.buffer,0,8192)),Y=0),Rn=J.length-10,Rn-Y<2048?(J=new Fc(J.length),ge=J.dataView||(J.dataView=new DataView(J.buffer,0,J.length)),Rn=J.length-10,Y=0):Y=Y+7&2147483640,n=Y,E&TS&&(Y+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof O!="string"?(Le=[],Le.size=1/0):Le=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let $=i.sharedLength||0;if($>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let B=0;B<$;B++){let st=i[B];if(!st)continue;let Q,rt=i.transitions;for(let z=0,P=st.length;z<P;z++){let ft=st[z];Q=rt[ft],Q||(Q=rt[ft]=Object.create(null)),rt=Q}rt[ao]=B+64}this.lastNamedStructuresLength=$}c||(i.nextId=$+64)}r&&(r=!1);let C;try{a.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?M(O):A(O);let $=Le;if(Le&&qm(n,A,0),s&&s.idsToInsert){let B=s.idsToInsert.sort((z,P)=>z.offset>P.offset?1:-1),st=B.length,Q=-1;for(;$&&st>0;){let z=B[--st].offset+n;z<$.stringsPosition+n&&Q===-1&&(Q=0),z>$.position+n?Q>=0&&(Q+=6):(Q>=0&&(ge.setUint32($.position+n,ge.getUint32($.position+n)+Q),Q=-1),$=$.previous,st++)}Q>=0&&$&&ge.setUint32($.position+n,ge.getUint32($.position+n)+Q),Y+=B.length*6,Y>Rn&&N(Y),a.offset=Y;let rt=kS(J.subarray(n,Y),B);return s=null,rt}return a.offset=Y,E&xS?(J.start=n,J.end=Y,J):J.subarray(n,Y)}catch($){throw C=$,$}finally{if(i&&(v(),r&&a.saveStructures)){let $=i.sharedLength||0,B=J.subarray(n,Y),st=wS(i,a);if(!C)return a.saveStructures(st,st.isCompatible)===!1?a.pack(O,E):(a.lastNamedStructuresLength=$,J.length>1073741824&&(J=null),B)}J.length>1073741824&&(J=null),E&vS&&(Y=n)}};const v=()=>{y<10&&y++;let O=i.sharedLength||0;if(i.length>O&&!c&&(i.length=O),k>1e4)i.transitions=null,y=0,k=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let E=0,C=p.length;E<C;E++)p[E][ao]=0;p=[]}},T=O=>{var E=O.length;E<16?J[Y++]=144|E:E<65536?(J[Y++]=220,J[Y++]=E>>8,J[Y++]=E&255):(J[Y++]=221,ge.setUint32(Y,E),Y+=4);for(let C=0;C<E;C++)A(O[C])},A=O=>{Y>Rn&&(J=N(Y));var E=typeof O,C;if(E==="string"){let $=O.length;if(Le&&$>=4&&$<4096){if((Le.size+=$)>gS){let rt,z=(Le[0]?Le[0].length*3+Le[1].length:0)+10;Y+z>Rn&&(J=N(Y+z));let P;Le.position?(P=Le,J[Y]=200,Y+=3,J[Y++]=98,rt=Y-n,Y+=4,qm(n,A,0),ge.setUint16(rt+n-3,Y-n-rt)):(J[Y++]=214,J[Y++]=98,rt=Y-n,Y+=4),Le=["",""],Le.previous=P,Le.size=0,Le.position=rt}let Q=_S.test(O);Le[Q?0:1]+=O,J[Y++]=193,A(Q?-$:$);return}let B;$<32?B=1:$<256?B=2:$<65536?B=3:B=5;let st=$*3;if(Y+st>Rn&&(J=N(Y+st)),$<64||!o){let Q,rt,z,P=Y+B;for(Q=0;Q<$;Q++)rt=O.charCodeAt(Q),rt<128?J[P++]=rt:rt<2048?(J[P++]=rt>>6|192,J[P++]=rt&63|128):(rt&64512)===55296&&((z=O.charCodeAt(Q+1))&64512)===56320?(rt=65536+((rt&1023)<<10)+(z&1023),Q++,J[P++]=rt>>18|240,J[P++]=rt>>12&63|128,J[P++]=rt>>6&63|128,J[P++]=rt&63|128):(J[P++]=rt>>12|224,J[P++]=rt>>6&63|128,J[P++]=rt&63|128);C=P-Y-B}else C=o(O,Y+B);C<32?J[Y++]=160|C:C<256?(B<2&&J.copyWithin(Y+2,Y+1,Y+1+C),J[Y++]=217,J[Y++]=C):C<65536?(B<3&&J.copyWithin(Y+3,Y+2,Y+2+C),J[Y++]=218,J[Y++]=C>>8,J[Y++]=C&255):(B<5&&J.copyWithin(Y+5,Y+3,Y+3+C),J[Y++]=219,ge.setUint32(Y,C),Y+=4),Y+=C}else if(E==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?J[Y++]=O:O<256?(J[Y++]=204,J[Y++]=O):O<65536?(J[Y++]=205,J[Y++]=O>>8,J[Y++]=O&255):(J[Y++]=206,ge.setUint32(Y,O),Y+=4);else if(O>>0===O)O>=-32?J[Y++]=256+O:O>=-128?(J[Y++]=208,J[Y++]=O+256):O>=-32768?(J[Y++]=209,ge.setInt16(Y,O),Y+=2):(J[Y++]=210,ge.setInt32(Y,O),Y+=4);else{let $;if(($=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){J[Y++]=202,ge.setFloat32(Y,O);let B;if($<4||(B=O*Uh[(J[Y]&127)<<1|J[Y+1]>>7])>>0===B){Y+=4;return}else Y--}J[Y++]=203,ge.setFloat64(Y,O),Y+=8}else if(E==="object"||E==="function")if(!O)J[Y++]=192;else{if(s){let B=s.get(O);if(B){if(!B.id){let st=s.idsToInsert||(s.idsToInsert=[]);B.id=st.push(B)}J[Y++]=214,J[Y++]=112,ge.setUint32(Y,B.id),Y+=4;return}else s.set(O,{offset:Y-n})}let $=O.constructor;if($===Object)D(O);else if($===Array)T(O);else if($===Map)if(this.mapAsEmptyObject)J[Y++]=128;else{C=O.size,C<16?J[Y++]=128|C:C<65536?(J[Y++]=222,J[Y++]=C>>8,J[Y++]=C&255):(J[Y++]=223,ge.setUint32(Y,C),Y+=4);for(let[B,st]of O)A(B),A(st)}else{for(let B=0,st=Fh.length;B<st;B++){let Q=Km[B];if(O instanceof Q){let rt=Fh[B];if(rt.write){rt.type&&(J[Y++]=212,J[Y++]=rt.type,J[Y++]=0);let ut=rt.write.call(this,O);ut===O?Array.isArray(O)?T(O):D(O):A(ut);return}let z=J,P=ge,ft=Y;J=null;let lt;try{lt=rt.pack.call(this,O,ut=>(J=z,z=null,Y+=ut,Y>Rn&&N(Y),{target:J,targetView:ge,position:Y-ut}),A)}finally{z&&(J=z,ge=P,Y=ft,Rn=J.length-10)}lt&&(lt.length+Y>Rn&&N(lt.length+Y),Y=bS(lt,J,Y,rt.type));return}}if(Array.isArray(O))T(O);else{if(O.toJSON){const B=O.toJSON();if(B!==O)return A(B)}if(E==="function")return A(this.writeFunction&&this.writeFunction(O));D(O)}}}else if(E==="boolean")J[Y++]=O?195:194;else if(E==="bigint"){if(O<BigInt(1)<<BigInt(63)&&O>=-(BigInt(1)<<BigInt(63)))J[Y++]=211,ge.setBigInt64(Y,O);else if(O<BigInt(1)<<BigInt(64)&&O>0)J[Y++]=207,ge.setBigUint64(Y,O);else if(this.largeBigIntToFloat)J[Y++]=203,ge.setFloat64(Y,Number(O));else{if(this.largeBigIntToString)return A(O.toString());if(this.useBigIntExtension&&O<BigInt(2)**BigInt(1023)&&O>-(BigInt(2)**BigInt(1023))){J[Y++]=199,Y++,J[Y++]=66;let $=[],B;do{let st=O&BigInt(255);B=(st&BigInt(128))===(O<BigInt(0)?BigInt(128):BigInt(0)),$.push(st),O>>=BigInt(8)}while(!((O===BigInt(0)||O===BigInt(-1))&&B));J[Y-2]=$.length;for(let st=$.length;st>0;)J[Y++]=Number($[--st]);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Y+=8}else if(E==="undefined")this.encodeUndefinedAsNil?J[Y++]=192:(J[Y++]=212,J[Y++]=0,J[Y++]=0);else throw new Error("Unknown type: "+E)},L=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let E;if(this.skipValues){E=[];for(let B in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(B))&&!this.skipValues.includes(O[B])&&E.push(B)}else E=Object.keys(O);let C=E.length;C<16?J[Y++]=128|C:C<65536?(J[Y++]=222,J[Y++]=C>>8,J[Y++]=C&255):(J[Y++]=223,ge.setUint32(Y,C),Y+=4);let $;if(this.coercibleKeyAsNumber)for(let B=0;B<C;B++){$=E[B];let st=Number($);A(isNaN(st)?$:st),A(O[$])}else for(let B=0;B<C;B++)A($=E[B]),A(O[$])}:O=>{J[Y++]=222;let E=Y-n;Y+=2;let C=0;for(let $ in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty($))&&(A($),A(O[$]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');J[E+++n]=C>>8,J[E+n]=C&255},S=this.useRecords===!1?L:t.progressiveRecords&&!d?O=>{let E,C=i.transitions||(i.transitions=Object.create(null)),$=Y++-n,B;for(let st in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(st)){if(E=C[st],E)C=E;else{let Q=Object.keys(O),rt=C;C=i.transitions;let z=0;for(let P=0,ft=Q.length;P<ft;P++){let lt=Q[P];E=C[lt],E||(E=C[lt]=Object.create(null),z++),C=E}$+n+1==Y?(Y--,W(C,Q,z)):q(C,Q,$,z),B=!0,C=rt[st]}A(O[st])}if(!B){let st=C[ao];st?J[$+n]=st:q(C,Object.keys(O),$,0)}}:O=>{let E,C=i.transitions||(i.transitions=Object.create(null)),$=0;for(let st in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(st))&&(E=C[st],E||(E=C[st]=Object.create(null),$++),C=E);let B=C[ao];B?B>=96&&d?(J[Y++]=((B-=96)&31)+96,J[Y++]=B>>5):J[Y++]=B:W(C,C.__keys__||Object.keys(O),$);for(let st in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(st))&&A(O[st])},I=typeof this.useRecords=="function"&&this.useRecords,D=I?O=>{I(O)?S(O):L(O)}:S,N=O=>{let E;if(O>16777216){if(O-n>Ym)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(Ym,Math.round(Math.max((O-n)*(O>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(O-n<<2,J.length-1)>>12)+1<<12;let C=new Fc(E);return ge=C.dataView||(C.dataView=new DataView(C.buffer,0,E)),O=Math.min(O,J.length),J.copy?J.copy(C,0,n,O):C.set(J.slice(n,O)),Y-=n,n=0,Rn=C.length-10,J=C},W=(O,E,C)=>{let $=i.nextId;$||($=64),$<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?($=i.nextOwnId,$<m||($=h),i.nextOwnId=$+1):($>=m&&($=h),i.nextId=$+1);let B=E.highByte=$>=96&&d?$-96>>5:-1;O[ao]=$,O.__keys__=E,i[$-64]=E,$<h?(E.isShared=!0,i.sharedLength=$-63,r=!0,B>=0?(J[Y++]=($&31)+96,J[Y++]=B):J[Y++]=$):(B>=0?(J[Y++]=213,J[Y++]=114,J[Y++]=($&31)+96,J[Y++]=B):(J[Y++]=212,J[Y++]=114,J[Y++]=$),C&&(k+=y*C),p.length>=f&&(p.shift()[ao]=0),p.push(O),A(E))},q=(O,E,C,$)=>{let B=J,st=Y,Q=Rn,rt=n;J=ra,Y=0,n=0,J||(ra=J=new Fc(8192)),Rn=J.length-10,W(O,E,$),ra=J;let z=Y;if(J=B,Y=st,Rn=Q,n=rt,z>1){let P=Y+z-1;P>Rn&&N(P);let ft=C+n;J.copyWithin(ft+z,ft+1,Y),J.set(ra.slice(0,z),ft),Y=P}else J[C+n]=ra[0]},M=O=>{let E=mS(O,J,n,Y,i,N,(C,$,B)=>{if(B)return r=!0;Y=$;let st=J;return A(C),v(),st!==J?{position:Y,targetView:ge,target:J}:Y},this);if(E===0)return D(O);Y=E}}useBuffer(t){J=t,J.dataView||(J.dataView=new DataView(J.buffer,J.byteOffset,J.byteLength)),Y=0}set position(t){Y=t}get position(){return Y}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Km=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Rm],Fh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Vm(e,16,t):Xm(Uc?dn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Hm&&this.moreTypes?Vm(e,Wm.indexOf(n.name),t):Xm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Vm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Xm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function bS(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function kS(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function qm(e,t,n){if(Le.length>0){ge.setUint32(Le.position+e,Y+n-Le.position-e),Le.stringsPosition=Y-e;let r=Le;Le=null,t(r[0]),t(r[1])}}function wS(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Jm=new yS({useRecords:!1});const ES=Jm.pack;Jm.pack;const xS=512,vS=1024,TS=2048;function Ae(){return null}function co(e,t,n={}){if(!b(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];b(c)&&(a=c(a));const l=t[o];b(l)&&(o=l),a!==null&&r.push(o,a)}return r}function ia(e,t,n={}){if(b(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];b(a)&&(s=a);const c=n[s];b(c)&&(o=c(o)),r[s]=o}return r}catch(r){de(et,"","binary",r.message)}}function AS(e){try{const t=xr(e);return ES(t)}catch(t){de(et,"","binary",t.message)}}function SS(e){try{return dS(e)}catch(t){de(et,"","binary",t.message)}}function Zm(){return{id:De()}}var Bc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e))(Bc||{});function Pc(e){return b(e==null?void 0:e.id)?co(e,Bc,{category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae}):co(e,Bc,{id:Ae,x:Ae,y:Ae,lx:Ae,ly:Ae,code:Ae,category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae})}function $c(e){return ia(e,Bc)}function Ge(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function sa(e,t){if(!b(e)||!wn(t))return;const{color:n,bg:r}=bm(t);b(n)&&(e.color=n),b(r)&&(e.bg=r)}function Qr(e){var t;return It((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function Se(e){var o;if(!b(e)||b(e.lookup)&&b(e.named))return;const t=new Array(St*Vt).fill(void 0),n={},r=Object.values(e.objects);for(let a=0;a<r.length;++a){const c=r[a];if(b(c.x)&&b(c.y)&&b(c.id)&&!b(c.removed)){c.category=Bn.ISOBJECT,t[c.x+c.y*St]=c.id;const l=It(c.name??((o=c.kinddata)==null?void 0:o.name)??"");n[l]||(n[l]=new Set),n[l].add(c.id)}}let i=0,s=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(b(c)){c.x=i,c.y=s,c.category=Bn.ISTERRAIN;const l=Qr(c);n[l]||(n[l]=new Set),n[l].add(a)}++i,i>=St&&(i=0,++s)}e.lookup=t,e.named=n}function oa(e){b(e)&&(delete e.named,delete e.lookup,Se(e))}function Qm(e,t,n){var i;if(!b(e)||!b(e.named)||!b(t))return;const r=It(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[r]||(e.named[r]=new Set),e.named[r].add((t==null?void 0:t.id)??n??"")}function RS(e,t){if(!(!b(e)||!b(e.lookup)||!b(t==null?void 0:t.id))&&!b(t.removed)){const n=t.x??0,r=t.y??0;e.lookup[n+r*St]=t.id}}function OS(e,t){var n;if(b(e)&&b(t==null?void 0:t.x)&&b(t.y)){const r=Qr(t),i=jr(e,t);b((n=e.named)==null?void 0:n[r])&&e.named[r].delete(i)}}function Bh(e,t){var n;if(b(e)&&b(t==null?void 0:t.id)){if(b(e.lookup)&&b(t.x)&&b(t.y)){const i=t.x+t.y*St;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const r=Qr(t);b((n=e.named)==null?void 0:n[r])&&b(t.id)&&e.named[r].delete(t.id)}}function Ph(e,t,n,r=!1){if(!b(e)||!b(e.lookup)||n.x<0||n.x>=St||n.y<0||n.y>=Vt)return!0;const i=n.x+n.y*St,s=Mn(e,e.lookup[i]??"404");if(b(s))return!(r&&yn(s.id));const o=e.terrain[i];return b(o)?$a(t,Gt(o,"collision")):!1}function NS(e,t,n){const r=Mn(e,(t==null?void 0:t.id)??""),i=(r==null?void 0:r.x)??-1,s=(r==null?void 0:r.y)??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=Gt(r,"collision");return Ph(e,o,n)}function $h(e,t,n){var d;const r=Mn(e,(t==null?void 0:t.id)??"");if(!b(e)||!b(r)||!b(r.x)||!b(r.y)||!b(e.lookup)||n.x<0||n.x>=St||n.y<0||n.y>=Vt)return{name:"edge",kind:"edge",collision:Wt.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=jr(e,r),s=jr(e,n),o=Gt(r,"collision"),a=yn(r==null?void 0:r.id),c=Gt(r,"collision")===Wt.ISBULLET,l=Mn(e,e.lookup[s]??""),u=yn((l==null?void 0:l.id)??"");if(b(l)&&(!a||!u)){const h=Gt(r,"group"),m=Gt(l,"group");if((h||m)&&h!=m)return{...l};const p=!!Gt(l,"item");if(a&&p)return r.x=n.x,r.y=n.y,{...l};const k=!!Gt(l,"breakable");if(c&&k)return r.x=n.x,r.y=n.y,{...l};if(o===Wt.ISBULLET)return{...l};if(!!Gt(l,"pushable")){const v=Or({x:r.x,y:r.y},n),T=ze({x:l.x??0,y:l.y??0},v),A=$h(e,l,T);if(b(A))return{...l}}else return{...l}}const f=e.terrain[s];if(b(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??Wt.ISWALK;if($a(o,h))return{...f,x:n.x,y:n.y}}r.x=n.x,r.y=n.y,b(r.removed)||(e.lookup[i]=void 0,e.lookup[s]=r.id??"")}function IS(e,t){const n=[];if(!b(e))return n;const r=Object.values(e.objects);for(let i=0;i<r.length;++i){const s=r[i];b(s.id)&&b(s.removed)&&t-s.removed>Va*5&&(n.push(s.id),Iw(e,s.id))}return n}function CS(e,t){const n=[];if(!b(e))return n;e.lookup=void 0,Se(e);const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const o=r[s];if(!b(o.id))continue;o.lx=o.x,o.ly=o.y;const a=$r(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=Gt(o,"cycle");if(l>u)continue}n.push({id:o.id,type:bt.OBJECT,code:c,object:o,terrain:void 0})}}const i=IS(e,t);for(let s=0;s<i.length;++s)n.push({id:i[s],type:bt.ERROR,code:"",object:void 0,terrain:void 0});return n}function tg(e,t,n){const r=[],i=[];if(!b(e))return{objectelements:r,terrainelements:i};function s(a,c){switch(n){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=Gt(a,n);return b(l)||Qr(a)===n||Gt(a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&r.push(c)}for(let a=0;a<Ah;++a){const c=e.terrain[a];b(c)&&s(c,!0)&&i.push(c)}return{objectelements:r,terrainelements:i}}function eg(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function ng(e){const t=Math.floor(e.length/Oc);if(t*Oc!==e.length)return;const n=eg(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function LS(e,t){return e&1<<t?255:0}function rg(e){const t=Math.floor(e.length/Sh);if(t*Sh!==e.length)return;const n=Math.ceil(t/Nc),r=ji*Nc,i=eg(r,zi*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*zi+a,u=e[c];for(let f=0;f<ji;++f){const d=s*ji+f;i.bits[d+l*r]=LS(u,7-f)}++a,a===zi&&(a=0,++s,s===Nc&&(s=0,++o))}return i}const MS=Qa("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),US=Qa("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ig=typeof zs=="object"&&zs&&zs.Object===Object&&zs,FS=typeof self=="object"&&self&&self.Object===Object&&self,ti=ig||FS||Function("return this")(),mr=ti.Symbol,sg=Object.prototype,BS=sg.hasOwnProperty,PS=sg.toString,aa=mr?mr.toStringTag:void 0;function $S(e){var t=BS.call(e,aa),n=e[aa];try{e[aa]=void 0;var r=!0}catch{}var i=PS.call(e);return r&&(t?e[aa]=n:delete e[aa]),i}var DS=Object.prototype,jS=DS.toString;function zS(e){return jS.call(e)}var WS="[object Null]",GS="[object Undefined]",og=mr?mr.toStringTag:void 0;function Ki(e){return e==null?e===void 0?GS:WS:og&&og in Object(e)?$S(e):zS(e)}function Nr(e){return e!=null&&typeof e=="object"}var KS="[object Symbol]";function Dc(e){return typeof e=="symbol"||Nr(e)&&Ki(e)==KS}function jc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var se=Array.isArray,HS=1/0,ag=mr?mr.prototype:void 0,cg=ag?ag.toString:void 0;function lg(e){if(typeof e=="string")return e;if(se(e))return jc(e,lg)+"";if(Dc(e))return cg?cg.call(e):"";var t=e+"";return t=="0"&&1/e==-HS?"-0":t}var YS=/\s/;function VS(e){for(var t=e.length;t--&&YS.test(e.charAt(t)););return t}var XS=/^\s+/;function qS(e){return e&&e.slice(0,VS(e)+1).replace(XS,"")}function gr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var ug=NaN,JS=/^[-+]0x[0-9a-f]+$/i,ZS=/^0b[01]+$/i,QS=/^0o[0-7]+$/i,tR=parseInt;function eR(e){if(typeof e=="number")return e;if(Dc(e))return ug;if(gr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=gr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=qS(e);var n=ZS.test(e);return n||QS.test(e)?tR(e.slice(2),n?2:8):JS.test(e)?ug:+e}var hg=1/0,nR=17976931348623157e292;function rR(e){if(!e)return e===0?e:0;if(e=eR(e),e===hg||e===-hg){var t=e<0?-1:1;return t*nR}return e===e?e:0}function zc(e){var t=rR(e),n=t%1;return t===t?n?t-n:t:0}function lo(e){return e}var iR="[object AsyncFunction]",sR="[object Function]",oR="[object GeneratorFunction]",aR="[object Proxy]";function xi(e){if(!gr(e))return!1;var t=Ki(e);return t==sR||t==oR||t==iR||t==aR}var Dh=ti["__core-js_shared__"],fg=function(){var e=/[^.]+$/.exec(Dh&&Dh.keys&&Dh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function cR(e){return!!fg&&fg in e}var lR=Function.prototype,uR=lR.toString;function ys(e){if(e!=null){try{return uR.call(e)}catch{}try{return e+""}catch{}}return""}var hR=/[\\^$.*+?()[\]{}|]/g,fR=/^\[object .+?Constructor\]$/,dR=Function.prototype,pR=Object.prototype,mR=dR.toString,gR=pR.hasOwnProperty,_R=RegExp("^"+mR.call(gR).replace(hR,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function yR(e){if(!gr(e)||cR(e))return!1;var t=xi(e)?_R:fR;return t.test(ys(e))}function bR(e,t){return e==null?void 0:e[t]}function bs(e,t){var n=bR(e,t);return yR(n)?n:void 0}var jh=bs(ti,"WeakMap"),dg=Object.create,kR=function(){function e(){}return function(t){if(!gr(t))return{};if(dg)return dg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function wR(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Qe(){}function ER(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var xR=800,vR=16,TR=Date.now;function AR(e){var t=0,n=0;return function(){var r=TR(),i=vR-(r-n);if(n=r,i>0){if(++t>=xR)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function SR(e){return function(){return e}}var Wc=function(){try{var e=bs(Object,"defineProperty");return e({},"",{}),e}catch{}}(),RR=Wc?function(e,t){return Wc(e,"toString",{configurable:!0,enumerable:!1,value:SR(t),writable:!0})}:lo,OR=AR(RR);function pg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function mg(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function NR(e){return e!==e}function IR(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function zh(e,t,n){return t===t?IR(e,t,n):mg(e,NR,n)}function gg(e,t){var n=e==null?0:e.length;return!!n&&zh(e,t,0)>-1}var CR=9007199254740991,LR=/^(?:0|[1-9]\d*)$/;function Gc(e,t){var n=typeof e;return t=t??CR,!!t&&(n=="number"||n!="symbol"&&LR.test(e))&&e>-1&&e%1==0&&e<t}function Wh(e,t,n){t=="__proto__"&&Wc?Wc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ca(e,t){return e===t||e!==e&&t!==t}var MR=Object.prototype,UR=MR.hasOwnProperty;function Kc(e,t,n){var r=e[t];(!(UR.call(e,t)&&ca(r,n))||n===void 0&&!(t in e))&&Wh(e,t,n)}function Gh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Wh(n,a,c):Kc(n,a,c)}return n}var _g=Math.max;function FR(e,t,n){return t=_g(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=_g(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),wR(e,this,a)}}function Kh(e,t){return OR(FR(e,t,lo),e+"")}var BR=9007199254740991;function Hh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=BR}function ei(e){return e!=null&&Hh(e.length)&&!xi(e)}function yg(e,t,n){if(!gr(n))return!1;var r=typeof t;return(r=="number"?ei(n)&&Gc(t,n.length):r=="string"&&t in n)?ca(n[t],e):!1}function PR(e){return Kh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&yg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var $R=Object.prototype;function la(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||$R;return e===n}function DR(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var jR="[object Arguments]";function bg(e){return Nr(e)&&Ki(e)==jR}var kg=Object.prototype,zR=kg.hasOwnProperty,WR=kg.propertyIsEnumerable,Hc=bg(function(){return arguments}())?bg:function(e){return Nr(e)&&zR.call(e,"callee")&&!WR.call(e,"callee")};function GR(){return!1}var wg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Eg=wg&&typeof module=="object"&&module&&!module.nodeType&&module,KR=Eg&&Eg.exports===wg,xg=KR?ti.Buffer:void 0,HR=xg?xg.isBuffer:void 0,ua=HR||GR,YR="[object Arguments]",VR="[object Array]",XR="[object Boolean]",qR="[object Date]",JR="[object Error]",ZR="[object Function]",QR="[object Map]",tO="[object Number]",eO="[object Object]",nO="[object RegExp]",rO="[object Set]",iO="[object String]",sO="[object WeakMap]",oO="[object ArrayBuffer]",aO="[object DataView]",cO="[object Float32Array]",lO="[object Float64Array]",uO="[object Int8Array]",hO="[object Int16Array]",fO="[object Int32Array]",dO="[object Uint8Array]",pO="[object Uint8ClampedArray]",mO="[object Uint16Array]",gO="[object Uint32Array]",Ee={};Ee[cO]=Ee[lO]=Ee[uO]=Ee[hO]=Ee[fO]=Ee[dO]=Ee[pO]=Ee[mO]=Ee[gO]=!0,Ee[YR]=Ee[VR]=Ee[oO]=Ee[XR]=Ee[aO]=Ee[qR]=Ee[JR]=Ee[ZR]=Ee[QR]=Ee[tO]=Ee[eO]=Ee[nO]=Ee[rO]=Ee[iO]=Ee[sO]=!1;function _O(e){return Nr(e)&&Hh(e.length)&&!!Ee[Ki(e)]}function Yc(e){return function(t){return e(t)}}var vg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ha=vg&&typeof module=="object"&&module&&!module.nodeType&&module,yO=ha&&ha.exports===vg,Yh=yO&&ig.process,Hi=function(){try{var e=ha&&ha.require&&ha.require("util").types;return e||Yh&&Yh.binding&&Yh.binding("util")}catch{}}(),Tg=Hi&&Hi.isTypedArray,Vh=Tg?Yc(Tg):_O,bO=Object.prototype,kO=bO.hasOwnProperty;function Ag(e,t){var n=se(e),r=!n&&Hc(e),i=!n&&!r&&ua(e),s=!n&&!r&&!i&&Vh(e),o=n||r||i||s,a=o?DR(e.length,String):[],c=a.length;for(var l in e)(t||kO.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Gc(l,c)))&&a.push(l);return a}function Sg(e,t){return function(n){return e(t(n))}}var wO=Sg(Object.keys,Object),EO=Object.prototype,xO=EO.hasOwnProperty;function Rg(e){if(!la(e))return wO(e);var t=[];for(var n in Object(e))xO.call(e,n)&&n!="constructor"&&t.push(n);return t}function _r(e){return ei(e)?Ag(e):Rg(e)}var vO=Object.prototype,TO=vO.hasOwnProperty,jn=PR(function(e,t){if(la(t)||ei(t)){Gh(t,_r(t),e);return}for(var n in t)TO.call(t,n)&&Kc(e,n,t[n])});function AO(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var SO=Object.prototype,RO=SO.hasOwnProperty;function OO(e){if(!gr(e))return AO(e);var t=la(e),n=[];for(var r in e)r=="constructor"&&(t||!RO.call(e,r))||n.push(r);return n}function Og(e){return ei(e)?Ag(e,!0):OO(e)}var NO=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,IO=/^\w*$/;function Xh(e,t){if(se(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Dc(e)?!0:IO.test(e)||!NO.test(e)||t!=null&&e in Object(t)}var fa=bs(Object,"create");function CO(){this.__data__=fa?fa(null):{},this.size=0}function LO(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var MO="__lodash_hash_undefined__",UO=Object.prototype,FO=UO.hasOwnProperty;function BO(e){var t=this.__data__;if(fa){var n=t[e];return n===MO?void 0:n}return FO.call(t,e)?t[e]:void 0}var PO=Object.prototype,$O=PO.hasOwnProperty;function DO(e){var t=this.__data__;return fa?t[e]!==void 0:$O.call(t,e)}var jO="__lodash_hash_undefined__";function zO(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=fa&&t===void 0?jO:t,this}function ks(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ks.prototype.clear=CO,ks.prototype.delete=LO,ks.prototype.get=BO,ks.prototype.has=DO,ks.prototype.set=zO;function WO(){this.__data__=[],this.size=0}function Vc(e,t){for(var n=e.length;n--;)if(ca(e[n][0],t))return n;return-1}var GO=Array.prototype,KO=GO.splice;function HO(e){var t=this.__data__,n=Vc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():KO.call(t,n,1),--this.size,!0}function YO(e){var t=this.__data__,n=Vc(t,e);return n<0?void 0:t[n][1]}function VO(e){return Vc(this.__data__,e)>-1}function XO(e,t){var n=this.__data__,r=Vc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function vi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vi.prototype.clear=WO,vi.prototype.delete=HO,vi.prototype.get=YO,vi.prototype.has=VO,vi.prototype.set=XO;var da=bs(ti,"Map");function qO(){this.size=0,this.__data__={hash:new ks,map:new(da||vi),string:new ks}}function JO(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Xc(e,t){var n=e.__data__;return JO(t)?n[typeof t=="string"?"string":"hash"]:n.map}function ZO(e){var t=Xc(this,e).delete(e);return this.size-=t?1:0,t}function QO(e){return Xc(this,e).get(e)}function tN(e){return Xc(this,e).has(e)}function eN(e,t){var n=Xc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Ti(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ti.prototype.clear=qO,Ti.prototype.delete=ZO,Ti.prototype.get=QO,Ti.prototype.has=tN,Ti.prototype.set=eN;var nN="Expected a function";function qh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(nN);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(qh.Cache||Ti),n}qh.Cache=Ti;var rN=500;function iN(e){var t=qh(e,function(r){return n.size===rN&&n.clear(),r}),n=t.cache;return t}var sN=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oN=/\\(\\)?/g,aN=iN(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(sN,function(n,r,i,s){t.push(i?s.replace(oN,"$1"):r||n)}),t});function Ng(e){return e==null?"":lg(e)}function qc(e,t){return se(e)?e:Xh(e,t)?[e]:aN(Ng(e))}var cN=1/0;function pa(e){if(typeof e=="string"||Dc(e))return e;var t=e+"";return t=="0"&&1/e==-cN?"-0":t}function Jh(e,t){t=qc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[pa(t[n++])];return n&&n==r?e:void 0}function lN(e,t,n){var r=e==null?void 0:Jh(e,t);return r===void 0?n:r}function Zh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Ig=mr?mr.isConcatSpreadable:void 0;function uN(e){return se(e)||Hc(e)||!!(Ig&&e&&e[Ig])}function Qh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=uN),i||(i=[]);++s<o;){var a=e[s];n(a)?Zh(i,a):r||(i[i.length]=a)}return i}function rr(e){var t=e==null?0:e.length;return t?Qh(e):[]}var Cg=Sg(Object.getPrototypeOf,Object);function tf(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function hN(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:tf(e,t,n)}var fN="\\ud800-\\udfff",dN="\\u0300-\\u036f",pN="\\ufe20-\\ufe2f",mN="\\u20d0-\\u20ff",gN=dN+pN+mN,_N="\\ufe0e\\ufe0f",yN="\\u200d",bN=RegExp("["+yN+fN+gN+_N+"]");function Lg(e){return bN.test(e)}function kN(e){return e.split("")}var Mg="\\ud800-\\udfff",wN="\\u0300-\\u036f",EN="\\ufe20-\\ufe2f",xN="\\u20d0-\\u20ff",vN=wN+EN+xN,TN="\\ufe0e\\ufe0f",AN="["+Mg+"]",ef="["+vN+"]",nf="\\ud83c[\\udffb-\\udfff]",SN="(?:"+ef+"|"+nf+")",Ug="[^"+Mg+"]",Fg="(?:\\ud83c[\\udde6-\\uddff]){2}",Bg="[\\ud800-\\udbff][\\udc00-\\udfff]",RN="\\u200d",Pg=SN+"?",$g="["+TN+"]?",ON="(?:"+RN+"(?:"+[Ug,Fg,Bg].join("|")+")"+$g+Pg+")*",NN=$g+Pg+ON,IN="(?:"+[Ug+ef+"?",ef,Fg,Bg,AN].join("|")+")",CN=RegExp(nf+"(?="+nf+")|"+IN+NN,"g");function LN(e){return e.match(CN)||[]}function MN(e){return Lg(e)?LN(e):kN(e)}function UN(e){return function(t){t=Ng(t);var n=Lg(t)?MN(t):void 0,r=n?n[0]:t.charAt(0),i=n?hN(n,1).join(""):t.slice(1);return r[e]()+i}}var Dg=UN("toUpperCase");function FN(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function BN(){this.__data__=new vi,this.size=0}function PN(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function $N(e){return this.__data__.get(e)}function DN(e){return this.__data__.has(e)}var jN=200;function zN(e,t){var n=this.__data__;if(n instanceof vi){var r=n.__data__;if(!da||r.length<jN-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ti(r)}return n.set(e,t),this.size=n.size,this}function ni(e){var t=this.__data__=new vi(e);this.size=t.size}ni.prototype.clear=BN,ni.prototype.delete=PN,ni.prototype.get=$N,ni.prototype.has=DN,ni.prototype.set=zN;function WN(e,t){return e&&Gh(t,_r(t),e)}var jg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zg=jg&&typeof module=="object"&&module&&!module.nodeType&&module,GN=zg&&zg.exports===jg,Wg=GN?ti.Buffer:void 0,Gg=Wg?Wg.allocUnsafe:void 0;function KN(e,t){var n=e.length,r=Gg?Gg(n):new e.constructor(n);return e.copy(r),r}function rf(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Kg(){return[]}var HN=Object.prototype,YN=HN.propertyIsEnumerable,Hg=Object.getOwnPropertySymbols,sf=Hg?function(e){return e==null?[]:(e=Object(e),rf(Hg(e),function(t){return YN.call(e,t)}))}:Kg;function VN(e,t){return Gh(e,sf(e),t)}var XN=Object.getOwnPropertySymbols,qN=XN?function(e){for(var t=[];e;)Zh(t,sf(e)),e=Cg(e);return t}:Kg;function Yg(e,t,n){var r=t(e);return se(e)?r:Zh(r,n(e))}function of(e){return Yg(e,_r,sf)}function JN(e){return Yg(e,Og,qN)}var af=bs(ti,"DataView"),cf=bs(ti,"Promise"),uo=bs(ti,"Set"),Vg="[object Map]",ZN="[object Object]",Xg="[object Promise]",qg="[object Set]",Jg="[object WeakMap]",Zg="[object DataView]",QN=ys(af),tI=ys(da),eI=ys(cf),nI=ys(uo),rI=ys(jh),yr=Ki;(af&&yr(new af(new ArrayBuffer(1)))!=Zg||da&&yr(new da)!=Vg||cf&&yr(cf.resolve())!=Xg||uo&&yr(new uo)!=qg||jh&&yr(new jh)!=Jg)&&(yr=function(e){var t=Ki(e),n=t==ZN?e.constructor:void 0,r=n?ys(n):"";if(r)switch(r){case QN:return Zg;case tI:return Vg;case eI:return Xg;case nI:return qg;case rI:return Jg}return t});var iI=Object.prototype,sI=iI.hasOwnProperty;function oI(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&sI.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Jc=ti.Uint8Array;function aI(e){var t=new e.constructor(e.byteLength);return new Jc(t).set(new Jc(e)),t}function cI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var lI=/\w*$/;function uI(e){var t=new e.constructor(e.source,lI.exec(e));return t.lastIndex=e.lastIndex,t}var Qg=mr?mr.prototype:void 0,t_=Qg?Qg.valueOf:void 0;function hI(e){return t_?Object(t_.call(e)):{}}function fI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var dI="[object Boolean]",pI="[object Date]",mI="[object Map]",gI="[object Number]",_I="[object RegExp]",yI="[object Set]",bI="[object String]",kI="[object Symbol]",wI="[object ArrayBuffer]",EI="[object DataView]",xI="[object Float32Array]",vI="[object Float64Array]",TI="[object Int8Array]",AI="[object Int16Array]",SI="[object Int32Array]",RI="[object Uint8Array]",OI="[object Uint8ClampedArray]",NI="[object Uint16Array]",II="[object Uint32Array]";function CI(e,t,n){var r=e.constructor;switch(t){case wI:return aI(e);case dI:case pI:return new r(+e);case EI:return cI(e);case xI:case vI:case TI:case AI:case SI:case RI:case OI:case NI:case II:return fI(e);case mI:return new r;case gI:case bI:return new r(e);case _I:return uI(e);case yI:return new r;case kI:return hI(e)}}function LI(e){return typeof e.constructor=="function"&&!la(e)?kR(Cg(e)):{}}var MI="[object Map]";function UI(e){return Nr(e)&&yr(e)==MI}var e_=Hi&&Hi.isMap,FI=e_?Yc(e_):UI,BI="[object Set]";function PI(e){return Nr(e)&&yr(e)==BI}var n_=Hi&&Hi.isSet,$I=n_?Yc(n_):PI,r_="[object Arguments]",DI="[object Array]",jI="[object Boolean]",zI="[object Date]",WI="[object Error]",i_="[object Function]",GI="[object GeneratorFunction]",KI="[object Map]",HI="[object Number]",s_="[object Object]",YI="[object RegExp]",VI="[object Set]",XI="[object String]",qI="[object Symbol]",JI="[object WeakMap]",ZI="[object ArrayBuffer]",QI="[object DataView]",tC="[object Float32Array]",eC="[object Float64Array]",nC="[object Int8Array]",rC="[object Int16Array]",iC="[object Int32Array]",sC="[object Uint8Array]",oC="[object Uint8ClampedArray]",aC="[object Uint16Array]",cC="[object Uint32Array]",_e={};_e[r_]=_e[DI]=_e[ZI]=_e[QI]=_e[jI]=_e[zI]=_e[tC]=_e[eC]=_e[nC]=_e[rC]=_e[iC]=_e[KI]=_e[HI]=_e[s_]=_e[YI]=_e[VI]=_e[XI]=_e[qI]=_e[sC]=_e[oC]=_e[aC]=_e[cC]=!0,_e[WI]=_e[i_]=_e[JI]=!1;function Zc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!gr(e))return e;var a=se(e);if(a)return o=oI(e),ER(e,o);var c=yr(e),l=c==i_||c==GI;if(ua(e))return KN(e);if(c==s_||c==r_||l&&!i)return o=l?{}:LI(e),VN(e,WN(o,e));if(!_e[c])return i?e:{};o=CI(e,c),s||(s=new ni);var u=s.get(e);if(u)return u;s.set(e,o),$I(e)?e.forEach(function(h){o.add(Zc(h,t,n,h,e,s))}):FI(e)&&e.forEach(function(h,m){o.set(m,Zc(h,t,n,m,e,s))});var f=of,d=a?void 0:f(e);return pg(d||e,function(h,m){d&&(m=h,h=e[m]),Kc(o,m,Zc(h,t,n,m,e,s))}),o}var lC=4;function gn(e){return Zc(e,lC)}function ma(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var uC="__lodash_hash_undefined__";function hC(e){return this.__data__.set(e,uC),this}function fC(e){return this.__data__.has(e)}function ho(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Ti;++t<n;)this.add(e[t])}ho.prototype.add=ho.prototype.push=hC,ho.prototype.has=fC;function o_(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function lf(e,t){return e.has(t)}var dC=1,pC=2;function a_(e,t,n,r,i,s){var o=n&dC,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=n&pC?new ho:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var m=e[f],p=t[f];if(r)var k=o?r(p,m,f,t,e,s):r(m,p,f,e,t,s);if(k!==void 0){if(k)continue;d=!1;break}if(h){if(!o_(t,function(y,v){if(!lf(h,v)&&(m===y||i(m,y,n,r,s)))return h.push(v)})){d=!1;break}}else if(!(m===p||i(m,p,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function mC(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function uf(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var gC=1,_C=2,yC="[object Boolean]",bC="[object Date]",kC="[object Error]",wC="[object Map]",EC="[object Number]",xC="[object RegExp]",vC="[object Set]",TC="[object String]",AC="[object Symbol]",SC="[object ArrayBuffer]",RC="[object DataView]",c_=mr?mr.prototype:void 0,hf=c_?c_.valueOf:void 0;function OC(e,t,n,r,i,s,o){switch(n){case RC:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case SC:return!(e.byteLength!=t.byteLength||!s(new Jc(e),new Jc(t)));case yC:case bC:case EC:return ca(+e,+t);case kC:return e.name==t.name&&e.message==t.message;case xC:case TC:return e==t+"";case wC:var a=mC;case vC:var c=r&gC;if(a||(a=uf),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=_C,o.set(e,t);var u=a_(a(e),a(t),r,i,s,o);return o.delete(e),u;case AC:if(hf)return hf.call(e)==hf.call(t)}return!1}var NC=1,IC=Object.prototype,CC=IC.hasOwnProperty;function LC(e,t,n,r,i,s){var o=n&NC,a=of(e),c=a.length,l=of(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:CC.call(t,d)))return!1}var h=s.get(e),m=s.get(t);if(h&&m)return h==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var k=o;++f<c;){d=a[f];var y=e[d],v=t[d];if(r)var T=o?r(v,y,d,t,e,s):r(y,v,d,e,t,s);if(!(T===void 0?y===v||i(y,v,n,r,s):T)){p=!1;break}k||(k=d=="constructor")}if(p&&!k){var A=e.constructor,L=t.constructor;A!=L&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof L=="function"&&L instanceof L)&&(p=!1)}return s.delete(e),s.delete(t),p}var MC=1,l_="[object Arguments]",u_="[object Array]",Qc="[object Object]",UC=Object.prototype,h_=UC.hasOwnProperty;function FC(e,t,n,r,i,s){var o=se(e),a=se(t),c=o?u_:yr(e),l=a?u_:yr(t);c=c==l_?Qc:c,l=l==l_?Qc:l;var u=c==Qc,f=l==Qc,d=c==l;if(d&&ua(e)){if(!ua(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ni),o||Vh(e)?a_(e,t,n,r,i,s):OC(e,t,c,n,r,i,s);if(!(n&MC)){var h=u&&h_.call(e,"__wrapped__"),m=f&&h_.call(t,"__wrapped__");if(h||m){var p=h?e.value():e,k=m?t.value():t;return s||(s=new ni),i(p,k,n,r,s)}}return d?(s||(s=new ni),LC(e,t,n,r,i,s)):!1}function ff(e,t,n,r,i){return e===t?!0:e==null||t==null||!Nr(e)&&!Nr(t)?e!==e&&t!==t:FC(e,t,n,r,ff,i)}var BC=1,PC=2;function $C(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ni,f;if(!(f===void 0?ff(l,c,BC|PC,r,u):f))return!1}}return!0}function f_(e){return e===e&&!gr(e)}function DC(e){for(var t=_r(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,f_(i)]}return t}function d_(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function jC(e){var t=DC(e);return t.length==1&&t[0][2]?d_(t[0][0],t[0][1]):function(n){return n===e||$C(n,e,t)}}function zC(e,t){return e!=null&&t in Object(e)}function p_(e,t,n){t=qc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=pa(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Hh(i)&&Gc(o,i)&&(se(e)||Hc(e)))}function WC(e,t){return e!=null&&p_(e,t,zC)}var GC=1,KC=2;function HC(e,t){return Xh(e)&&f_(t)?d_(pa(e),t):function(n){var r=lN(n,e);return r===void 0&&r===t?WC(n,e):ff(t,r,GC|KC)}}function YC(e){return function(t){return t==null?void 0:t[e]}}function VC(e){return function(t){return Jh(t,e)}}function XC(e){return Xh(e)?YC(pa(e)):VC(e)}function ri(e){return typeof e=="function"?e:e==null?lo:typeof e=="object"?se(e)?HC(e[0],e[1]):jC(e):XC(e)}function qC(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function JC(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var ZC=JC();function QC(e,t){return e&&ZC(e,t,_r)}function tL(e,t){return function(n,r){if(n==null)return n;if(!ei(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var ws=tL(QC);function eL(e,t,n,r){return ws(e,function(i,s,o){t(r,i,n(i),o)}),r}function nL(e,t){return function(n,r){var i=se(n)?qC:eL,s=t?t():{};return i(n,e,ri(r),s)}}var m_=Object.prototype,rL=m_.hasOwnProperty,df=Kh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&yg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Og(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||ca(u,m_[l])&&!rL.call(e,l))&&(e[l]=s[l])}return e});function g_(e){return Nr(e)&&ei(e)}var iL=200;function sL(e,t,n,r){var i=-1,s=gg,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=iL&&(s=lf,o=!1,t=new ho(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var tl=Kh(function(e,t){return g_(e)?sL(e,Qh(t,1,g_,!0)):[]});function fo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function _n(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:zc(t),tf(e,t<0?0:t,r)):[]}function ga(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:zc(t),t=r-t,tf(e,0,t<0?0:t)):[]}function oL(e){return typeof e=="function"?e:lo}function Ft(e,t){var n=se(e)?pg:ws;return n(e,oL(t))}function aL(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function cL(e,t){var n=!0;return ws(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function Ir(e,t,n){var r=se(e)?aL:cL;return r(e,ri(t))}function __(e,t){var n=[];return ws(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function br(e,t){var n=se(e)?rf:__;return n(e,ri(t))}function lL(e){return function(t,n,r){var i=Object(t);if(!ei(t)){var s=ri(n);t=_r(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var uL=Math.max;function hL(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:zc(n);return i<0&&(i=uL(r+i,0)),mg(e,ri(t),i)}var po=lL(hL);function Cr(e){return e&&e.length?e[0]:void 0}function fL(e,t){var n=-1,r=ei(e)?Array(e.length):[];return ws(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function Tt(e,t){var n=se(e)?jc:fL;return n(e,ri(t))}function kr(e,t){return Qh(Tt(e,t))}var dL=Object.prototype,pL=dL.hasOwnProperty,y_=nL(function(e,t,n){pL.call(e,n)?e[n].push(t):Wh(e,n,[t])}),mL=Object.prototype,gL=mL.hasOwnProperty;function _L(e,t){return e!=null&&gL.call(e,t)}function Ut(e,t){return e!=null&&p_(e,t,_L)}var yL="[object String]";function zn(e){return typeof e=="string"||!se(e)&&Nr(e)&&Ki(e)==yL}function bL(e,t){return jc(t,function(n){return e[n]})}function Ve(e){return e==null?[]:bL(e,_r(e))}var kL=Math.max;function On(e,t,n,r){e=ei(e)?e:Ve(e),n=n&&!r?zc(n):0;var i=e.length;return n<0&&(n=kL(i+n,0)),zn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&zh(e,t,n)>-1}function b_(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return zh(e,t,i)}var wL="[object Map]",EL="[object Set]",xL=Object.prototype,vL=xL.hasOwnProperty;function ye(e){if(e==null)return!0;if(ei(e)&&(se(e)||typeof e=="string"||typeof e.splice=="function"||ua(e)||Vh(e)||Hc(e)))return!e.length;var t=yr(e);if(t==wL||t==EL)return!e.size;if(la(e))return!Rg(e).length;for(var n in e)if(vL.call(e,n))return!1;return!0}var TL="[object RegExp]";function AL(e){return Nr(e)&&Ki(e)==TL}var k_=Hi&&Hi.isRegExp,Ai=k_?Yc(k_):AL;function Si(e){return e===void 0}var SL="Expected a function";function RL(e){if(typeof e!="function")throw new TypeError(SL);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function OL(e,t,n,r){if(!gr(e))return e;t=qc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=pa(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=gr(u)?u:Gc(t[i+1])?[]:{})}Kc(a,c,l),a=a[c]}return e}function NL(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Jh(e,o);n(a,o)&&OL(s,qc(o,e),a)}return s}function Lr(e,t){if(e==null)return{};var n=jc(JN(e),function(r){return[r]});return t=ri(t),NL(e,n,function(r,i){return t(r,i[0])})}function IL(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Wn(e,t,n){var r=se(e)?FN:IL,i=arguments.length<3;return r(e,ri(t),n,i,ws)}function el(e,t){var n=se(e)?rf:__;return n(e,RL(ri(t)))}function CL(e,t){var n;return ws(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function pf(e,t,n){var r=se(e)?o_:CL;return r(e,ri(t))}var LL=1/0,ML=uo&&1/uf(new uo([,-0]))[1]==LL?function(e){return new uo(e)}:Qe,UL=200;function FL(e,t,n){var r=-1,i=gg,s=e.length,o=!0,a=[],c=a;if(s>=UL){var l=ML(e);if(l)return uf(l);o=!1,i=lf,c=new ho}else c=a;t:for(;++r<s;){var u=e[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function nl(e){return e&&e.length?FL(e):[]}function mf(e){console&&console.error&&console.error(`Error: ${e}`)}function w_(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function E_(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function x_(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function BL(e){return PL(e)?e.LABEL:e.name}function PL(e){return zn(e.LABEL)&&e.LABEL!==""}class ii{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Ft(this.definition,n=>{n.accept(t)})}}class Gn extends ii{constructor(t){super([]),this.idx=1,jn(this,Lr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class mo extends ii{constructor(t){super(t.definition),this.orgText="",jn(this,Lr(t,n=>n!==void 0))}}class Kn extends ii{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,jn(this,Lr(t,n=>n!==void 0))}}class Hn extends ii{constructor(t){super(t.definition),this.idx=1,jn(this,Lr(t,n=>n!==void 0))}}class si extends ii{constructor(t){super(t.definition),this.idx=1,jn(this,Lr(t,n=>n!==void 0))}}class oi extends ii{constructor(t){super(t.definition),this.idx=1,jn(this,Lr(t,n=>n!==void 0))}}class tn extends ii{constructor(t){super(t.definition),this.idx=1,jn(this,Lr(t,n=>n!==void 0))}}class Mr extends ii{constructor(t){super(t.definition),this.idx=1,jn(this,Lr(t,n=>n!==void 0))}}class Ur extends ii{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,jn(this,Lr(t,n=>n!==void 0))}}class Me{constructor(t){this.idx=1,jn(this,Lr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function $L(e){return Tt(e,rl)}function rl(e){function t(n){return Tt(n,rl)}if(e instanceof Gn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return zn(e.label)&&(n.label=e.label),n}else{if(e instanceof Kn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Hn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof si)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof oi)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:rl(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Mr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:rl(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof tn)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Ur)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Me){const n={type:"Terminal",name:e.terminalType.name,label:BL(e.terminalType),idx:e.idx};zn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ai(r)?r.source:r),n}else{if(e instanceof mo)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class Es{visit(t){const n=t;switch(n.constructor){case Gn:return this.visitNonTerminal(n);case Kn:return this.visitAlternative(n);case Hn:return this.visitOption(n);case si:return this.visitRepetitionMandatory(n);case oi:return this.visitRepetitionMandatoryWithSeparator(n);case Mr:return this.visitRepetitionWithSeparator(n);case tn:return this.visitRepetition(n);case Ur:return this.visitAlternation(n);case Me:return this.visitTerminal(n);case mo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function DL(e){return e instanceof Kn||e instanceof Hn||e instanceof tn||e instanceof si||e instanceof oi||e instanceof Mr||e instanceof Me||e instanceof mo}function il(e,t=[]){return e instanceof Hn||e instanceof tn||e instanceof Mr?!0:e instanceof Ur?pf(e.definition,r=>il(r,t)):e instanceof Gn&&On(t,e)?!1:e instanceof ii?(e instanceof Gn&&t.push(e),Ir(e.definition,r=>il(r,t))):!1}function jL(e){return e instanceof Ur}function ai(e){if(e instanceof Gn)return"SUBRULE";if(e instanceof Hn)return"OPTION";if(e instanceof Ur)return"OR";if(e instanceof si)return"AT_LEAST_ONE";if(e instanceof oi)return"AT_LEAST_ONE_SEP";if(e instanceof Mr)return"MANY_SEP";if(e instanceof tn)return"MANY";if(e instanceof Me)return"CONSUME";throw Error("non exhaustive match")}class sl{walk(t,n=[]){Ft(t.definition,(r,i)=>{const s=_n(t.definition,i+1);if(r instanceof Gn)this.walkProdRef(r,s,n);else if(r instanceof Me)this.walkTerminal(r,s,n);else if(r instanceof Kn)this.walkFlat(r,s,n);else if(r instanceof Hn)this.walkOption(r,s,n);else if(r instanceof si)this.walkAtLeastOne(r,s,n);else if(r instanceof oi)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Mr)this.walkManySep(r,s,n);else if(r instanceof tn)this.walkMany(r,s,n);else if(r instanceof Ur)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Hn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=v_(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Hn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=v_(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Ft(t.definition,s=>{const o=new Kn({definition:[s]});this.walk(o,i)})}}function v_(e,t,n){return[new Hn({definition:[new Me({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function _a(e){if(e instanceof Gn)return _a(e.referencedRule);if(e instanceof Me)return GL(e);if(DL(e))return zL(e);if(jL(e))return WL(e);throw Error("non exhaustive match")}function zL(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=il(s),t=t.concat(_a(s)),r=r+1,i=n.length>r;return nl(t)}function WL(e){const t=Tt(e.definition,n=>_a(n));return nl(rr(t))}function GL(e){return[e.terminalType]}const T_="_~IN~_";class KL extends sl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=YL(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Kn({definition:s}),a=_a(o);this.follows[i]=a}}function HL(e){const t={};return Ft(e,n=>{const r=new KL(n).startWalking();jn(t,r)}),t}function YL(e,t){return e.name+t+T_}function Bt(e){return e.charCodeAt(0)}function gf(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ya(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function go(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function VL(){throw Error("Internal Error - Should never get here!")}function A_(e){return e.type==="Character"}const ol=[];for(let e=Bt("0");e<=Bt("9");e++)ol.push(e);const al=[Bt("_")].concat(ol);for(let e=Bt("a");e<=Bt("z");e++)al.push(e);for(let e=Bt("A");e<=Bt("Z");e++)al.push(e);const S_=[Bt(" "),Bt("\f"),Bt(`
`),Bt("\r"),Bt("	"),Bt("\v"),Bt("	"),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt(" "),Bt("\u2028"),Bt("\u2029"),Bt(" "),Bt(" "),Bt("　"),Bt("\uFEFF")],XL=/[0-9a-fA-F]/,cl=/[0-9]/,qL=/[1-9]/;class JL{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ya(r,"global");break;case"i":ya(r,"ignoreCase");break;case"m":ya(r,"multiLine");break;case"u":ya(r,"unicode");break;case"y":ya(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}go(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return VL()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;go(n);break}if(!(t===!0&&n===void 0)&&go(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),go(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Bt(`
`),Bt("\r"),Bt("\u2028"),Bt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=ol;break;case"D":t=ol,n=!0;break;case"s":t=S_;break;case"S":t=S_,n=!0;break;case"w":t=al;break;case"W":t=al,n=!0;break}if(go(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Bt("\f");break;case"n":t=Bt(`
`);break;case"r":t=Bt("\r");break;case"t":t=Bt("	");break;case"v":t=Bt("\v");break}if(go(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Bt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Bt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Bt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,A_(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,A_(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else gf(r.value,t),t.push(Bt("-")),gf(i.value,t)}else gf(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Bt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(qL.test(t)===!1)throw Error("Expecting a positive integer");for(;cl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(cl.test(t)===!1)throw Error("Expecting an integer");for(;cl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Bt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return cl.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(XL.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class _f{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let ll={};const ZL=new JL;function ul(e){const t=e.toString();if(ll.hasOwnProperty(t))return ll[t];{const n=ZL.pattern(t);return ll[t]=n,n}}function QL(){ll={}}const R_="Complement Sets are not supported for first char optimization",hl=`Unable to use "first char" lexer optimizations:
`;function t6(e,t=!1){try{const n=ul(e);return yf(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===R_)t&&w_(`${hl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),mf(`${hl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function yf(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)yf(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":fl(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(R_);Ft(o.value,c=>{if(typeof c=="number")fl(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)fl(u,t,n);else{for(let u=l.from;u<=l.to&&u<ka;u++)fl(u,t,n);if(l.to>=ka){const u=l.from>=ka?l.from:ka,f=l.to,d=Yi(u),h=Yi(f);for(let m=d;m<=h;m++)t[m]=m}}}});break;case"Group":yf(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&bf(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ve(t)}function fl(e,t,n){const r=Yi(e);t[r]=r,n===!0&&e6(e,t)}function e6(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Yi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Yi(i.charCodeAt(0));t[s]=s}}}function O_(e,t){return po(e.value,n=>{if(typeof n=="number")return On(t,n);{const r=n;return po(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function bf(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?se(e.value)?Ir(e.value,bf):bf(e.value):!1}class n6 extends _f{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){On(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?O_(t,this.targetCharCodes)===void 0&&(this.found=!0):O_(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function kf(e,t){if(t instanceof RegExp){const n=ul(t),r=new n6(e);return r.visit(n),r.found}else return po(t,n=>On(e,n.charCodeAt(0)))!==void 0}const xs="PATTERN",ba="defaultMode",dl="modes";let N_=typeof new RegExp("(?:)").sticky=="boolean";function r6(e,t){t=df(t,{useSticky:N_,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{A6()});let r;n("Reject Lexer.NA",()=>{r=el(e,v=>v[xs]===cn.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Tt(r,v=>{const T=v[xs];if(Ai(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!On(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:t.useSticky?C_(T):I_(T)}else{if(xi(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),L=new RegExp(A);return t.useSticky?C_(L):I_(L)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Tt(r,v=>v.tokenTypeIdx),a=Tt(r,v=>{const T=v.GROUP;if(T!==cn.SKIPPED){if(zn(T))return T;if(Si(T))return!1;throw Error("non exhaustive match")}}),c=Tt(r,v=>{const T=v.LONGER_ALT;if(T)return se(T)?Tt(T,L=>b_(r,L)):[b_(r,T)]}),l=Tt(r,v=>v.PUSH_MODE),u=Tt(r,v=>Ut(v,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const v=U_(t.lineTerminatorCharacters);f=Tt(r,T=>!1),t.positionTracking!=="onlyOffset"&&(f=Tt(r,T=>Ut(T,"LINE_BREAKS")?!!T.LINE_BREAKS:M_(T,v)===!1&&kf(v,T.PATTERN)))});let d,h,m,p;n("Misc Mapping #2",()=>{d=Tt(r,L_),h=Tt(s,x6),m=Wn(r,(v,T)=>{const A=T.GROUP;return zn(A)&&A!==cn.SKIPPED&&(v[A]=[]),v},{}),p=Tt(s,(v,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let k=!0,y=[];return t.safeMode||n("First Char Optimization",()=>{y=Wn(r,(v,T,A)=>{if(typeof T.PATTERN=="string"){const L=T.PATTERN.charCodeAt(0),S=Yi(L);wf(v,S,p[A])}else if(se(T.START_CHARS_HINT)){let L;Ft(T.START_CHARS_HINT,S=>{const I=typeof S=="string"?S.charCodeAt(0):S,D=Yi(I);L!==D&&(L=D,wf(v,D,p[A]))})}else if(Ai(T.PATTERN))if(T.PATTERN.unicode)k=!1,t.ensureOptimizations&&mf(`${hl}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const L=t6(T.PATTERN,t.ensureOptimizations);ye(L)&&(k=!1),Ft(L,S=>{wf(v,S,p[A])})}else t.ensureOptimizations&&mf(`${hl}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),k=!1;return v},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:k}}function i6(e,t){let n=[];const r=o6(e);n=n.concat(r.errors);const i=a6(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(s6(s)),n=n.concat(m6(s)),n=n.concat(g6(s,t)),n=n.concat(_6(s)),n}function s6(e){let t=[];const n=br(e,r=>Ai(r[xs]));return t=t.concat(l6(n)),t=t.concat(f6(n)),t=t.concat(d6(n)),t=t.concat(p6(n)),t=t.concat(u6(n)),t}function o6(e){const t=br(e,i=>!Ut(i,xs)),n=Tt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Be.MISSING_PATTERN,tokenTypes:[i]})),r=tl(e,t);return{errors:n,valid:r}}function a6(e){const t=br(e,i=>{const s=i[xs];return!Ai(s)&&!xi(s)&&!Ut(s,"exec")&&!zn(s)}),n=Tt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Be.INVALID_PATTERN,tokenTypes:[i]})),r=tl(e,t);return{errors:n,valid:r}}const c6=/[^\\][$]/;function l6(e){class t extends _f{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=br(e,i=>{const s=i.PATTERN;try{const o=ul(s),a=new t;return a.visit(o),a.found}catch{return c6.test(s.source)}});return Tt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function u6(e){const t=br(e,r=>r.PATTERN.test(""));return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Be.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const h6=/[^\\[][\^]|^\^/;function f6(e){class t extends _f{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=br(e,i=>{const s=i.PATTERN;try{const o=ul(s),a=new t;return a.visit(o),a.found}catch{return h6.test(s.source)}});return Tt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function d6(e){const t=br(e,r=>{const i=r[xs];return i instanceof RegExp&&(i.multiline||i.global)});return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Be.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function p6(e){const t=[];let n=Tt(e,s=>Wn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!On(t,a)&&a.PATTERN!==cn.NA&&(t.push(a),o.push(a)),o),[]));n=ma(n);const r=br(n,s=>s.length>1);return Tt(r,s=>{const o=Tt(s,c=>c.name);return{message:`The same RegExp pattern ->${Cr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Be.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function m6(e){const t=br(e,r=>{if(!Ut(r,"GROUP"))return!1;const i=r.GROUP;return i!==cn.SKIPPED&&i!==cn.NA&&!zn(i)});return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Be.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function g6(e,t){const n=br(e,i=>i.PUSH_MODE!==void 0&&!On(t,i.PUSH_MODE));return Tt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Be.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function _6(e){const t=[],n=Wn(e,(r,i,s)=>{const o=i.PATTERN;return o===cn.NA||(zn(o)?r.push({str:o,idx:s,tokenType:i}):Ai(o)&&b6(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ft(e,(r,i)=>{Ft(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&y6(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Be.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function y6(e,t){if(Ai(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(xi(t))return t(e,0,[],{});if(Ut(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function b6(e){return po([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function I_(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function C_(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function k6(e,t,n){const r=[];return Ut(e,ba)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ba+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ut(e,dl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+dl+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ut(e,dl)&&Ut(e,ba)&&!Ut(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ba}: <${e.defaultMode}>which does not exist
`,type:Be.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ut(e,dl)&&Ft(e.modes,(i,s)=>{Ft(i,(o,a)=>{if(Si(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Be.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ut(o,"LONGER_ALT")){const c=se(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ft(c,l=>{!Si(l)&&!On(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Be.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function w6(e,t,n){const r=[];let i=!1;const s=ma(rr(Ve(e.modes))),o=el(s,c=>c[xs]===cn.NA),a=U_(n);return t&&Ft(o,c=>{const l=M_(c,a);if(l!==!1){const f={message:T6(c,l),type:l.issue,tokenType:c};r.push(f)}else Ut(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):kf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Be.NO_LINE_BREAKS_FLAGS}),r}function E6(e){const t={},n=_r(e);return Ft(n,r=>{const i=e[r];if(se(i))t[r]=[];else throw Error("non exhaustive match")}),t}function L_(e){const t=e.PATTERN;if(Ai(t))return!1;if(xi(t))return!0;if(Ut(t,"exec"))return!0;if(zn(t))return!1;throw Error("non exhaustive match")}function x6(e){return zn(e)&&e.length===1?e.charCodeAt(0):!1}const v6={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function M_(e,t){if(Ut(e,"LINE_BREAKS"))return!1;if(Ai(e.PATTERN)){try{kf(t,e.PATTERN)}catch(n){return{issue:Be.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(zn(e.PATTERN))return!1;if(L_(e))return{issue:Be.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function T6(e,t){if(t.issue===Be.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Be.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function U_(e){return Tt(e,n=>zn(n)?n.charCodeAt(0):n)}function wf(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const ka=256;let pl=[];function Yi(e){return e<ka?e:pl[e]}function A6(){if(ye(pl)){pl=new Array(65536);for(let e=0;e<65536;e++)pl[e]=e>255?255+~~(e/255):e}}function wa(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function ml(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let F_=1;const B_={};function Ea(e){const t=S6(e);R6(t),N6(t),O6(t),Ft(t,n=>{n.isParent=n.categoryMatches.length>0})}function S6(e){let t=gn(e),n=e,r=!0;for(;r;){n=ma(rr(Tt(n,s=>s.CATEGORIES)));const i=tl(n,t);t=t.concat(i),ye(i)?r=!1:n=i}return t}function R6(e){Ft(e,t=>{$_(t)||(B_[F_]=t,t.tokenTypeIdx=F_++),D_(t)&&!se(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),D_(t)||(t.CATEGORIES=[]),I6(t)||(t.categoryMatches=[]),C6(t)||(t.categoryMatchesMap={})})}function O6(e){Ft(e,t=>{t.categoryMatches=[],Ft(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(B_[r].tokenTypeIdx)})})}function N6(e){Ft(e,t=>{P_([],t)})}function P_(e,t){Ft(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ft(t.CATEGORIES,n=>{const r=e.concat(t);On(r,n)||P_(r,n)})}function $_(e){return Ut(e,"tokenTypeIdx")}function D_(e){return Ut(e,"CATEGORIES")}function I6(e){return Ut(e,"categoryMatches")}function C6(e){return Ut(e,"categoryMatchesMap")}function L6(e){return Ut(e,"tokenTypeIdx")}const M6={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Be;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Be||(Be={}));const xa={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:M6,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(xa);let cn=class{constructor(t,n=xa){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=E_(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=jn({},xa,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===xa.lineTerminatorsPattern)this.config.lineTerminatorsPattern=v6;else if(this.config.lineTerminatorCharacters===xa.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),se(t)?i={modes:{defaultMode:gn(t)},defaultMode:ba}:(s=!1,i=gn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(k6(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(w6(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ft(i.modes,(a,c)=>{i.modes[c]=el(a,l=>Si(l))});const o=_r(i.modes);if(Ft(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(i6(a,o))}),ye(this.lexerDefinitionErrors)){Ea(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=r6(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=jn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ye(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Tt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ft(this.lexerDefinitionWarning,a=>{w_(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(N_?(this.chopInput=lo,this.match=this.matchWithTest):(this.updateLastIndex=Qe,this.match=this.matchWithExec),s&&(this.handleModes=Qe),this.trackStartLines===!1&&(this.computeNewColumn=lo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Qe),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Wn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ye(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{QL()}),this.TRACE_INIT("toFastProperties",()=>{x_(this)})})}tokenize(t,n=this.defaultMode){if(!ye(this.lexerDefinitionErrors)){const i=Tt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,f,d,h,m,p,k,y;const v=t,T=v.length;let A=0,L=0;const S=this.hasCustom?0:Math.floor(t.length/10),I=new Array(S),D=[];let N=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const q=E6(this.emptyGroups),M=this.trackStartLines,O=this.config.lineTerminatorsPattern;let E=0,C=[],$=[];const B=[],st=[];Object.freeze(st);let Q;function rt(){return C}function z(jt){const Qt=Yi(jt),Dt=$[Qt];return Dt===void 0?st:Dt}const P=jt=>{if(B.length===1&&jt.tokenType.PUSH_MODE===void 0){const Qt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(jt);D.push({offset:jt.startOffset,line:jt.startLine,column:jt.startColumn,length:jt.image.length,message:Qt})}else{B.pop();const Qt=fo(B);C=this.patternIdxToConfig[Qt],$=this.charCodeToPatternIdxToConfig[Qt],E=C.length;const Dt=this.canModeBeOptimized[Qt]&&this.config.safeMode===!1;$&&Dt?Q=z:Q=rt}};function ft(jt){B.push(jt),$=this.charCodeToPatternIdxToConfig[jt],C=this.patternIdxToConfig[jt],E=C.length,E=C.length;const Qt=this.canModeBeOptimized[jt]&&this.config.safeMode===!1;$&&Qt?Q=z:Q=rt}ft.call(this,n);let lt;const ut=this.config.recoveryEnabled;for(;A<T;){c=null;const jt=v.charCodeAt(A),Qt=Q(jt),Dt=Qt.length;for(r=0;r<Dt;r++){lt=Qt[r];const Pt=lt.pattern;l=null;const le=lt.short;if(le!==!1?jt===le&&(c=Pt):lt.isCustom===!0?(y=Pt.exec(v,A,I,q),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(Pt,A),c=this.match(Pt,t,A)),c!==null){if(a=lt.longerAlt,a!==void 0){const qt=a.length;for(s=0;s<qt;s++){const Ne=C[a[s]],$e=Ne.pattern;if(u=null,Ne.isCustom===!0?(y=$e.exec(v,A,I,q),y!==null?(o=y[0],y.payload!==void 0&&(u=y.payload)):o=null):(this.updateLastIndex($e,A),o=this.match($e,t,A)),o&&o.length>c.length){c=o,l=u,lt=Ne;break}}}break}}if(c!==null){if(f=c.length,d=lt.group,d!==void 0&&(h=lt.tokenTypeIdx,m=this.createTokenInstance(c,A,h,lt.tokenType,N,W,f),this.handlePayload(m,l),d===!1?L=this.addToken(I,L,m):q[d].push(m)),t=this.chopInput(t,f),A=A+f,W=this.computeNewColumn(W,f),M===!0&&lt.canLineTerminator===!0){let Pt=0,le,qt;O.lastIndex=0;do le=O.test(c),le===!0&&(qt=O.lastIndex-1,Pt++);while(le===!0);Pt!==0&&(N=N+Pt,W=f-qt,this.updateTokenEndLineColumnLocation(m,d,qt,Pt,N,W,f))}this.handleModes(lt,P,ft,m)}else{const Pt=A,le=N,qt=W;let Ne=ut===!1;for(;Ne===!1&&A<T;)for(t=this.chopInput(t,1),A++,i=0;i<E;i++){const $e=C[i],x=$e.pattern,at=$e.short;if(at!==!1?v.charCodeAt(A)===at&&(Ne=!0):$e.isCustom===!0?Ne=x.exec(v,A,I,q)!==null:(this.updateLastIndex(x,A),Ne=x.exec(t)!==null),Ne===!0)break}if(p=A-Pt,W=this.computeNewColumn(W,p),k=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Pt,p,le,qt),D.push({offset:Pt,line:le,column:qt,length:p,message:k}),ut===!1)break}}return this.hasCustom||(I.length=L),{tokens:I,groups:q,errors:D}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};cn.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",cn.NA=/NOT_APPLICABLE/;function va(e){return j_(e)?e.LABEL:e.name}function j_(e){return zn(e.LABEL)&&e.LABEL!==""}const U6="parent",z_="categories",W_="label",G_="group",K_="push_mode",H_="pop_mode",Y_="longer_alt",V_="line_breaks",X_="start_chars_hint";function ir(e){return F6(e)}function F6(e){const t=e.pattern,n={};if(n.name=e.name,Si(t)||(n.PATTERN=t),Ut(e,U6))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ut(e,z_)&&(n.CATEGORIES=e[z_]),Ea([n]),Ut(e,W_)&&(n.LABEL=e[W_]),Ut(e,G_)&&(n.GROUP=e[G_]),Ut(e,H_)&&(n.POP_MODE=e[H_]),Ut(e,K_)&&(n.PUSH_MODE=e[K_]),Ut(e,Y_)&&(n.LONGER_ALT=e[Y_]),Ut(e,V_)&&(n.LINE_BREAKS=e[V_]),Ut(e,X_)&&(n.START_CHARS_HINT=e[X_]),n}const vs=ir({name:"EOF",pattern:cn.NA});Ea([vs]);function gl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function B6(e,t){return wa(e,t)}const q_={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${j_(e)?`--> ${va(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Cr(t).image+"'";if(r)return s+r+a;{const c=Wn(e,(d,h)=>d.concat(h),[]),l=Tt(c,d=>`[${Tt(d,h=>va(h)).join(", ")}]`),f=`one of these possible Token sequences:
${Tt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Cr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Tt(e,l=>`[${Tt(l,u=>va(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(q_);const P6={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},Ts={buildDuplicateFoundError(e,t){function n(u){return u instanceof Me?u.terminalType.name:u instanceof Gn?u.nonTerminalName:""}const r=e.name,i=Cr(t),s=i.idx,o=ai(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Tt(e.prefixPath,i=>va(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Tt(e.prefixPath,i=>va(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=ai(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=Tt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof mo?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function $6(e,t){const n=new D6(e,t);return n.resolveRefs(),n.errors}class D6 extends Es{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ft(Ve(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:Nn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class j6 extends sl{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=gn(this.path.ruleStack).reverse(),this.occurrenceStack=gn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){ye(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class z6 extends j6{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Kn({definition:i});this.possibleTokTypes=_a(s),this.found=!0}}}class _l extends sl{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class W6 extends _l{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Cr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class J_ extends _l{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Cr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class G6 extends _l{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Cr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Z_ extends _l{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Cr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Ef(e,t,n=[]){n=gn(n);let r=[],i=0;function s(a){return a.concat(_n(e,i+1))}function o(a){const c=Ef(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Kn)return o(a.definition);if(a instanceof Gn)return o(a.definition);if(a instanceof Hn)r=o(a.definition);else if(a instanceof si){const c=a.definition.concat([new tn({definition:a.definition})]);return o(c)}else if(a instanceof oi){const c=[new Kn({definition:a.definition}),new tn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Mr){const c=a.definition.concat([new tn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof tn){const c=a.definition.concat([new tn({definition:a.definition})]);r=o(c)}else{if(a instanceof Ur)return Ft(a.definition,c=>{ye(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Me)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:_n(e,i)}),r}function Q_(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ye(f);){const d=f.pop();if(d===o){a&&fo(f).idx<=l&&f.pop();continue}const h=d.def,m=d.idx,p=d.ruleStack,k=d.occurrenceStack;if(ye(h))continue;const y=h[0];if(y===i){const v={idx:m,def:_n(h),ruleStack:ga(p),occurrenceStack:ga(k)};f.push(v)}else if(y instanceof Me)if(m<c-1){const v=m+1,T=t[v];if(n(T,y.terminalType)){const A={idx:v,def:_n(h),ruleStack:p,occurrenceStack:k};f.push(A)}}else if(m===c-1)u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:p,occurrenceStack:k}),a=!0;else throw Error("non exhaustive match");else if(y instanceof Gn){const v=gn(p);v.push(y.nonTerminalName);const T=gn(k);T.push(y.idx);const A={idx:m,def:y.definition.concat(s,_n(h)),ruleStack:v,occurrenceStack:T};f.push(A)}else if(y instanceof Hn){const v={idx:m,def:_n(h),ruleStack:p,occurrenceStack:k};f.push(v),f.push(o);const T={idx:m,def:y.definition.concat(_n(h)),ruleStack:p,occurrenceStack:k};f.push(T)}else if(y instanceof si){const v=new tn({definition:y.definition,idx:y.idx}),T=y.definition.concat([v],_n(h)),A={idx:m,def:T,ruleStack:p,occurrenceStack:k};f.push(A)}else if(y instanceof oi){const v=new Me({terminalType:y.separator}),T=new tn({definition:[v].concat(y.definition),idx:y.idx}),A=y.definition.concat([T],_n(h)),L={idx:m,def:A,ruleStack:p,occurrenceStack:k};f.push(L)}else if(y instanceof Mr){const v={idx:m,def:_n(h),ruleStack:p,occurrenceStack:k};f.push(v),f.push(o);const T=new Me({terminalType:y.separator}),A=new tn({definition:[T].concat(y.definition),idx:y.idx}),L=y.definition.concat([A],_n(h)),S={idx:m,def:L,ruleStack:p,occurrenceStack:k};f.push(S)}else if(y instanceof tn){const v={idx:m,def:_n(h),ruleStack:p,occurrenceStack:k};f.push(v),f.push(o);const T=new tn({definition:y.definition,idx:y.idx}),A=y.definition.concat([T],_n(h)),L={idx:m,def:A,ruleStack:p,occurrenceStack:k};f.push(L)}else if(y instanceof Ur)for(let v=y.definition.length-1;v>=0;v--){const T=y.definition[v],A={idx:m,def:T.definition.concat(_n(h)),ruleStack:p,occurrenceStack:k};f.push(A),f.push(o)}else if(y instanceof Kn)f.push({idx:m,def:y.definition.concat(_n(h)),ruleStack:p,occurrenceStack:k});else if(y instanceof mo)f.push(K6(y,m,p,k));else throw Error("non exhaustive match")}return u}function K6(e,t,n,r){const i=gn(n);i.push(e.name);const s=gn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Pe;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Pe||(Pe={}));function ty(e){if(e instanceof Hn||e==="Option")return Pe.OPTION;if(e instanceof tn||e==="Repetition")return Pe.REPETITION;if(e instanceof si||e==="RepetitionMandatory")return Pe.REPETITION_MANDATORY;if(e instanceof oi||e==="RepetitionMandatoryWithSeparator")return Pe.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Mr||e==="RepetitionWithSeparator")return Pe.REPETITION_WITH_SEPARATOR;if(e instanceof Ur||e==="Alternation")return Pe.ALTERNATION;throw Error("non exhaustive match")}function H6(e,t,n,r,i,s){const o=vf(e,t,n),a=iy(o)?ml:wa;return s(o,r,a,i)}function Y6(e,t,n,r,i,s){const o=Tf(e,t,i,n),a=iy(o)?ml:wa;return s(o[0],a,r)}function V6(e,t,n,r){const i=e.length,s=Ir(e,o=>Ir(o,a=>a.length===1));if(t)return function(o){const a=Tt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],m=h.length;for(let p=0;p<m;p++){const k=this.LA(p+1);if(n(k,h[p])===!1)continue t}return c}}};if(s&&!r){const o=Tt(e,c=>rr(c)),a=Wn(o,(c,l,u)=>(Ft(l,f=>{Ut(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Ft(f.categoryMatches,d=>{Ut(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function X6(e,t,n){const r=Ir(e,s=>s.length===1),i=e.length;if(r&&!n){const s=rr(e);if(s.length===1&&ye(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Wn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ft(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class q6 extends sl{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Pe.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Pe.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class ey extends Es{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Pe.OPTION)}visitRepetition(t){this.checkIsTarget(t,Pe.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Pe.ALTERNATION)}}function ny(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function xf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function J6(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function ry(e,t){const n=Tt(e,o=>Ef([o],1)),r=ny(n.length),i=Tt(n,o=>{const a={};return Ft(o,c=>{const l=xf(c.partialPath);Ft(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=ny(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=xf(f);if(J6(i,h,c)||ye(d)||f.length===t){const p=r[c];if(Af(p,f)===!1){p.push(f);for(let k=0;k<h.length;k++){const y=h[k];i[c][y]=!0}}}else{const p=Ef(d,o+1,f);s[c]=s[c].concat(p),Ft(p,k=>{const y=xf(k.partialPath);Ft(y,v=>{i[c][v]=!0})})}}}}return r}function vf(e,t,n,r){const i=new ey(e,Pe.ALTERNATION,r);return t.accept(i),ry(i.result,n)}function Tf(e,t,n,r){const i=new ey(e,n);t.accept(i);const s=i.result,a=new q6(t,e,n).startWalking(),c=new Kn({definition:s}),l=new Kn({definition:a});return ry([c,l],r)}function Af(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function Z6(e,t){return e.length<t.length&&Ir(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function iy(e){return Ir(e,t=>Ir(t,n=>Ir(n,r=>ye(r.categoryMatches))))}function Q6(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Tt(t,n=>Object.assign({type:Nn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function tM(e,t,n,r){const i=kr(e,c=>eM(c,n)),s=dM(e,t,n),o=kr(e,c=>lM(c,n)),a=kr(e,c=>iM(c,e,r,n));return i.concat(s,o,a)}function eM(e,t){const n=new rM;e.accept(n);const r=n.allProductions,i=y_(r,nM),s=Lr(i,a=>a.length>1);return Tt(Ve(s),a=>{const c=Cr(a),l=t.buildDuplicateFoundError(e,a),u=ai(c),f={message:l,type:Nn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=sy(c);return d&&(f.parameter=d),f})}function nM(e){return`${ai(e)}_#_${e.idx}_#_${sy(e)}`}function sy(e){return e instanceof Me?e.terminalType.name:e instanceof Gn?e.nonTerminalName:""}class rM extends Es{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function iM(e,t,n,r){const i=[];if(Wn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:Nn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function sM(e,t,n){const r=[];let i;return On(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Nn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function oy(e,t,n,r=[]){const i=[],s=yl(t.definition);if(ye(s))return[];{const o=e.name;On(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:Nn.LEFT_RECURSION,ruleName:o});const c=tl(s,r.concat([e])),l=kr(c,u=>{const f=gn(r);return f.push(u),oy(e,u,n,f)});return i.concat(l)}}function yl(e){let t=[];if(ye(e))return t;const n=Cr(e);if(n instanceof Gn)t.push(n.referencedRule);else if(n instanceof Kn||n instanceof Hn||n instanceof si||n instanceof oi||n instanceof Mr||n instanceof tn)t=t.concat(yl(n.definition));else if(n instanceof Ur)t=rr(Tt(n.definition,s=>yl(s.definition)));else if(!(n instanceof Me))throw Error("non exhaustive match");const r=il(n),i=e.length>1;if(r&&i){const s=_n(e);return t.concat(yl(s))}else return t}class Sf extends Es{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function oM(e,t){const n=new Sf;e.accept(n);const r=n.alternations;return kr(r,s=>{const o=ga(s.definition);return kr(o,(a,c)=>{const l=Q_([a],[],wa,1);return ye(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:Nn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function aM(e,t,n){const r=new Sf;e.accept(r);let i=r.alternations;return i=el(i,o=>o.ignoreAmbiguities===!0),kr(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=vf(a,e,c,o),u=hM(l,o,e,n),f=fM(l,o,e,n);return u.concat(f)})}class cM extends Es{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function lM(e,t){const n=new Sf;e.accept(n);const r=n.alternations;return kr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:Nn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function uM(e,t,n){const r=[];return Ft(e,i=>{const s=new cM;i.accept(s);const o=s.allProductions;Ft(o,a=>{const c=ty(a),l=a.maxLookahead||t,u=a.idx,d=Tf(u,i,c,l)[0];if(ye(rr(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:Nn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function hM(e,t,n,r){const i=[],s=Wn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Ft(c,u=>{const f=[l];Ft(e,(d,h)=>{l!==h&&Af(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!Af(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return Tt(s,a=>{const c=Tt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Nn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function fM(e,t,n,r){const i=Wn(e,(o,a,c)=>{const l=Tt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return ma(kr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=br(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&Z6(d.path,l));return Tt(u,d=>{const h=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:Nn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:h}})}))}function dM(e,t,n){const r=[],i=Tt(t,s=>s.name);return Ft(e,s=>{const o=s.name;if(On(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Nn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function pM(e){const t=df(e,{errMsgProvider:P6}),n={};return Ft(e.rules,r=>{n[r.name]=r}),$6(n,t.errMsgProvider)}function mM(e){return e=df(e,{errMsgProvider:Ts}),tM(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const ay="MismatchedTokenException",cy="NoViableAltException",ly="EarlyExitException",uy="NotAllInputParsedException",hy=[ay,cy,ly,uy];Object.freeze(hy);function bl(e){return On(hy,e.name)}class kl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class fy extends kl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ay}}class gM extends kl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=cy}}class _M extends kl{constructor(t,n){super(t,n),this.name=uy}}class yM extends kl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ly}}const Rf={},dy="InRuleRecoveryException";class bM extends Error{constructor(t){super(t),this.name=dy}}class kM{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ut(t,"recoveryEnabled")?t.recoveryEnabled:Ri.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=wM)}getTokenToInsert(t){const n=gl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new fy(h,l,this.LA(0));m.resyncedTokens=ga(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new bM("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||ye(n))return!1;const r=this.LA(1);return po(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return On(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=po(t,s=>B6(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Rf;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Tt(t,(r,i)=>i===0?Rf:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Tt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return rr(t)}getFollowSetFromFollowKey(t){if(t===Rf)return[vs];const n=t.ruleName+t.idxInCallingRule+T_+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,vs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ga(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=gn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Tt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function wM(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=vs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const EM=4,Vi=8,py=1<<Vi,my=2<<Vi,Of=3<<Vi,Nf=4<<Vi,If=5<<Vi,wl=6<<Vi;function Cf(e,t,n){return n|t|e}class xM{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ri.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(ye(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return kr(t,n=>oy(n,n,Ts))}validateEmptyOrAlternatives(t){return kr(t,n=>oM(n,Ts))}validateAmbiguousAlternationAlternatives(t,n){return kr(t,r=>aM(r,n,Ts))}validateSomeNonEmptyLookaheadPath(t,n){return uM(t,n,Ts)}buildLookaheadForAlternation(t){return H6(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,V6)}buildLookaheadForOptional(t){return Y6(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,ty(t.prodType),X6)}}class vM{initLooksAhead(t){this.dynamicTokensEnabled=Ut(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ri.dynamicTokensEnabled,this.maxLookahead=Ut(t,"maxLookahead")?t.maxLookahead:Ri.maxLookahead,this.lookaheadStrategy=Ut(t,"lookaheadStrategy")?t.lookaheadStrategy:new xM({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Ft(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=AM(n);Ft(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${ai(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Cf(this.fullRuleNameToShort[n.name],py,l.idx);this.setLaFuncCache(d,f)})}),Ft(i,l=>{this.computeLookaheadFunc(n,l.idx,Of,"Repetition",l.maxLookahead,ai(l))}),Ft(s,l=>{this.computeLookaheadFunc(n,l.idx,my,"Option",l.maxLookahead,ai(l))}),Ft(o,l=>{this.computeLookaheadFunc(n,l.idx,Nf,"RepetitionMandatory",l.maxLookahead,ai(l))}),Ft(a,l=>{this.computeLookaheadFunc(n,l.idx,wl,"RepetitionMandatoryWithSeparator",l.maxLookahead,ai(l))}),Ft(c,l=>{this.computeLookaheadFunc(n,l.idx,If,"RepetitionWithSeparator",l.maxLookahead,ai(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Cf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return Cf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class TM extends Es{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const El=new TM;function AM(e){El.reset(),e.accept(El);const t=El.dslMethods;return El.reset(),t}function gy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function _y(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function SM(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function RM(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const OM="name";function yy(e,t){Object.defineProperty(e,OM,{enumerable:!1,configurable:!0,writable:!1,value:t})}function NM(e,t){const n=_r(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function IM(e,t){const n=function(){};yy(n,e+"BaseSemantics");const r={visit:function(i,s){if(se(i)&&(i=i[0]),!Si(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=LM(this,t);if(!ye(i)){const s=Tt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function CM(e,t,n){const r=function(){};yy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ft(t,s=>{i[s]=NM}),r.prototype=i,r.prototype.constructor=r,r}var Lf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Lf||(Lf={}));function LM(e,t){return MM(e,t)}function MM(e,t){const n=br(t,i=>xi(e[i])===!1),r=Tt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Lf.MISSING_METHOD,methodName:i}));return ma(r)}class UM{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Ut(t,"nodeLocationTracking")?t.nodeLocationTracking:Ri.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Qe,this.cstFinallyStateUpdate=Qe,this.cstPostTerminal=Qe,this.cstPostNonTerminal=Qe,this.cstPostRule=Qe;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=_y,this.setNodeLocationFromNode=_y,this.cstPostRule=Qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=gy,this.setNodeLocationFromNode=gy,this.cstPostRule=Qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=Qe,this.setInitialNodeLocation=Qe;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];SM(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];RM(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Si(this.baseCstVisitorConstructor)){const t=IM(this.className,_r(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Si(this.baseCstVisitorWithDefaultsConstructor)){const t=CM(this.className,_r(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class FM{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Tl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?Tl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class BM{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=Al){if(On(this.definedRulesNames,t)){const o={message:Ts.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Nn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=Al){const i=sM(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(bl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return $L(Ve(this.gastProductionsCache))}}class PM{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ml,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ut(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(se(t)){if(ye(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(se(t))this.tokensMap=Wn(t,(s,o)=>(s[o.name]=o,s),{});else if(Ut(t,"modes")&&Ir(rr(Ve(t.modes)),L6)){const s=rr(Ve(t.modes)),o=nl(s);this.tokensMap=Wn(o,(a,c)=>(a[c.name]=c,a),{})}else if(gr(t))this.tokensMap=gn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=vs;const r=Ut(t,"modes")?rr(Ve(t.modes)):Ve(t),i=Ir(r,s=>ye(s.categoryMatches));this.tokenMatcher=i?ml:wa,Ea(Ve(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ut(r,"resyncEnabled")?r.resyncEnabled:Al.resyncEnabled,s=Ut(r,"recoveryValueFunc")?r.recoveryValueFunc:Al.recoveryValueFunc,o=this.ruleShortNameIdx<<EM+Vi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(bl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(my,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Nf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Nf,t,G6)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(wl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Z_],a,wl,t,Z_)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Of,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Of,t,W6,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(If,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,J_],a,If,t,J_)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,wl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(py,n),i=se(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new _M(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw bl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new fy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===dy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=gn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),vs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class $M{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Ut(t,"errorMessageProvider")?t.errorMessageProvider:Ri.errorMessageProvider}SAVE_ERROR(t){if(bl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:gn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return gn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Tf(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new yM(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=vf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new gM(c,this.LA(1),a))}}class DM{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Si(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Q_([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Cr(t.ruleStack),i=this.getGAstProductions()[n];return new z6(i,t).startWalking()}}const xl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(xl);const by=!0,ky=Math.pow(2,Vi)-1,wy=ir({name:"RECORDING_PHASE_TOKEN",pattern:cn.NA});Ea([wy]);const Ey=gl(wy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Ey);const jM={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class zM{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return Tl}topLevelRuleRecord(t,n){try{const r=new mo({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Ta.call(this,Hn,t,n)}atLeastOneInternalRecord(t,n){Ta.call(this,si,n,t)}atLeastOneSepFirstInternalRecord(t,n){Ta.call(this,oi,n,t,by)}manyInternalRecord(t,n){Ta.call(this,tn,n,t)}manySepFirstInternalRecord(t,n){Ta.call(this,Mr,n,t,by)}orInternalRecord(t,n){return WM.call(this,t,n)}subruleInternalRecord(t,n,r){if(vl(n),!t||Ut(t,"ruleName")===!1){const a=new Error(`<SUBRULE${xy(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=fo(this.recordingProdStack),s=t.ruleName,o=new Gn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?jM:xl}consumeInternalRecord(t,n,r){if(vl(n),!$_(t)){const o=new Error(`<CONSUME${xy(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=fo(this.recordingProdStack),s=new Me({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Ey}}function Ta(e,t,n,r=!1){vl(n);const i=fo(this.recordingProdStack),s=xi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Ut(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),xl}function WM(e,t){vl(t);const n=fo(this.recordingProdStack),r=se(e)===!1,i=r===!1?e:e.DEF,s=new Ur({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Ut(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=pf(i,a=>xi(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ft(i,a=>{const c=new Kn({definition:[]});s.definition.push(c),Ut(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ut(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),xl}function xy(e){return e===0?"":`${e}`}function vl(e){if(e<0||e>ky){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${ky+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class GM{initPerformanceTracer(t){if(Ut(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ri.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=E_(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function KM(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const Tl=gl(vs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Tl);const Ri=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:q_,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Al=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Nn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Nn||(Nn={}));let Mf=class qw{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{x_(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ft(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=pM({rules:Ve(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ye(r)&&this.skipValidations===!1){const i=mM({rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),errMsgProvider:Ts,grammarName:n}),s=Q6({lookaheadStrategy:this.lookaheadStrategy,rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ye(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=HL(Ve(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ve(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ve(this.gastProductionsCache))})),!qw.DEFER_DEFINITION_ERRORS_HANDLING&&!ye(this.definitionErrors))throw t=Tt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Ut(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ut(n,"skipValidations")?n.skipValidations:Ri.skipValidations}};Mf.DEFER_DEFINITION_ERRORS_HANDLING=!1,KM(Mf,[kM,vM,UM,FM,PM,BM,$M,DM,zM,GM]);class HM extends Mf{constructor(t,n=Ri){const r=gn(n);r.outputCst=!0,super(t,r)}}function YM(e){const t=new VM,n=Ve(e);return Tt(n,r=>t.visitRule(r))}class VM extends Es{visitRule(t){const n=this.visitEach(t.definition),r=y_(n,s=>s.propertyName),i=Tt(r,(s,o)=>{const a=!pf(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Tt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:Sl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:Sl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:Sl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:Sl(t)}]}visitEachAndOverrideWith(t,n){return Tt(this.visitEach(t),r=>jn({},r,n))}visitEach(t){return rr(Tt(t,n=>this.visit(n)))}}function Sl(e){return e instanceof Gn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function XM(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(rr(Tt(e,r=>qM(r)))),t.includeVisitorInterface&&(n=n.concat(tU(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function qM(e){const t=JM(e),n=ZM(e);return[t,n]}function JM(e){const t=Ty(e.name),n=Uf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function ZM(e){return`export type ${Uf(e.name)} = {
  ${Tt(e.properties,n=>QM(n)).join(`
  `)}
};`}function QM(e){const t=nU(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function tU(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Tt(t,n=>eU(n)).join(`
  `)}
}`}function eU(e){const t=Uf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function nU(e){if(se(e)){const t=nl(Tt(e,r=>vy(r)));return"("+Wn(t,(r,i)=>r+" | "+i)+")"}else return vy(e)}function vy(e){return e.kind==="token"?"IToken":Ty(e.name)}function Ty(e){return Dg(e)+"CstNode"}function Uf(e){return Dg(e)+"CstChildren"}const rU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function iU(e,t){const n=Object.assign(Object.assign({},rU),t),r=YM(e);return XM(r,n)}const Aa=fm(32,126).map(e=>String.fromCharCode(e));function Kt(e){return ir({...e,name:`token_${e.name}`})}function ct(e){return Kt({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Xe})}const Sa=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),sU=Kt({name:"whitespace",pattern:/ +/,group:cn.SKIPPED}),oU=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:cn.SKIPPED}),Ff=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),_o=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Ay=!1;function aU(e,t,n){if(!Ay)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Sa)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const Sy=Kt({name:"text",pattern:aU,line_breaks:!1,start_chars_hint:Aa.filter(e=>"@#/?':!".includes(e)===!1)}),Ry=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Bf=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Oy=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Ny=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Xe=Kt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Aa}),Rl=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Pf=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Iy=ct("isterrain"),Cy=ct("isobject"),Ly=ct("issolid"),My=ct("iswalk"),Uy=ct("isswim"),Fy=ct("isbullet"),By=ct("iswalking"),Py=ct("iswalkable"),$y=ct("isswimming"),Dy=ct("isswimmable"),jy=ct("black"),zy=ct("dkblue"),Wy=ct("dkgreen"),Gy=ct("dkcyan"),Ky=ct("dkred"),Hy=ct("dkpurple"),Yy=ct("dkyellow"),Vy=ct("ltgray"),Xy=ct("dkgray"),qy=ct("blue"),Jy=ct("green"),Zy=ct("cyan"),Qy=ct("red"),tb=ct("purple"),eb=ct("yellow"),nb=ct("white"),rb=ct("brown"),ib=ct("dkwhite"),sb=ct("ltgrey"),ob=ct("gray"),ab=ct("grey"),cb=ct("dkgrey"),lb=ct("ltblack"),ub=ct("onblack"),hb=ct("ondkblue"),fb=ct("ondkgreen"),db=ct("ondkcyan"),pb=ct("ondkred"),mb=ct("ondkpurple"),gb=ct("ondkyellow"),_b=ct("onltgray"),yb=ct("ondkgray"),bb=ct("onblue"),kb=ct("ongreen"),wb=ct("oncyan"),Eb=ct("onred"),xb=ct("onpurple"),vb=ct("onyellow"),Tb=ct("onwhite"),Ab=ct("onbrown"),Sb=ct("ondkwhite"),Rb=ct("onltgrey"),Ob=ct("ongray"),Nb=ct("ongrey"),Ib=ct("ondkgrey"),Cb=ct("onltblack"),Lb=ct("onclear"),Mb=ct("idle"),Ub=ct("up"),Fb=ct("down"),Bb=ct("left"),Pb=ct("right"),$b=ct("by"),Db=ct("at"),jb=ct("flow"),zb=ct("seek"),Wb=ct("rndns"),Gb=ct("rndne"),Kb=ct("rnd"),Hb=ct("cw"),Yb=ct("ccw"),Vb=ct("opp"),Xb=ct("rndp"),qb=ct("away"),Jb=ct("toward"),Zb=ct("find"),Qb=ct("flee"),t1=ct("to"),e1=ct("i"),n1=ct("u"),r1=ct("north"),i1=ct("n"),s1=ct("d"),o1=ct("south"),a1=ct("s"),c1=ct("l"),l1=ct("west"),u1=ct("w"),h1=ct("r"),f1=ct("east"),d1=ct("e"),p1=ct("over"),m1=ct("under"),g1=Kt({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:Xe}),_1=ct("contact"),y1=ct("blocked"),b1=ct("any"),k1=ct("count"),w1=ct("abs"),E1=ct("intceil"),x1=ct("intfloor"),v1=ct("intround"),T1=ct("clamp"),A1=ct("min"),S1=ct("max"),R1=ct("pick"),O1=ct("pickwith"),N1=ct("random"),I1=ct("randomwith"),C1=ct("run"),L1=ct("runwith"),M1=Kt({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),U1=Kt({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:Xe}),F1=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:Xe}),B1=Kt({name:"islessthan",pattern:/<|below/i,longer_alt:Xe}),P1=Kt({name:"isgreaterthan",pattern:/>|above/i,longer_alt:Xe}),$1=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:Xe}),D1=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:Xe}),$f=Kt({name:"or",pattern:/or/i,longer_alt:Xe}),Df=Kt({name:"not",pattern:/not/i,longer_alt:Xe}),jf=Kt({name:"and",pattern:/and/i,longer_alt:Xe}),zf=Kt({name:"plus",pattern:/\+/}),Wf=Kt({name:"minus",pattern:/-/}),j1=Kt({name:"power",pattern:/\*\*/}),z1=Kt({name:"multiply",pattern:/\*/}),Gf=Kt({name:"divide",pattern:/\//}),W1=Kt({name:"moddivide",pattern:/%/}),G1=Kt({name:"floordivide",pattern:/%%/}),K1=Kt({name:"query",pattern:/\?/}),H1=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Y1=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),V1=Kt({name:"command_play",pattern:/(play|bgplay) .*/i,start_chars_hint:Aa,longer_alt:Xe}),X1=Kt({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Aa,longer_alt:Xe}),q1=Kt({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Aa,longer_alt:Xe}),Kf=Kt({name:"if",pattern:/if|try|take|give/i,longer_alt:Xe}),Ol=ct("do"),Hf=ct("done"),Yf=ct("else"),J1=ct("while"),Z1=ct("repeat"),Q1=ct("waitfor"),tk=Kt({name:"foreach",pattern:/foreach|for/i,longer_alt:Xe}),ek=ct("break"),nk=ct("continue");function rk(e){return[Fb,...e,Pf,Iy,Cy,Ly,Py,By,My,Dy,$y,Uy,Fy,jy,zy,Wy,Gy,Ky,Hy,Yy,Vy,Xy,qy,Jy,Zy,Qy,tb,eb,nb,rb,ib,sb,ob,ab,cb,lb,ub,hb,fb,db,pb,mb,gb,_b,yb,bb,kb,wb,Eb,xb,vb,Tb,Ab,Sb,Rb,Ob,Nb,Ib,Cb,Lb,Mb,Ub,Bb,Pb,$b,Db,jb,zb,Xb,Wb,Gb,Kb,Hb,Yb,Vb,qb,Jb,Zb,Qb,t1,r1,o1,l1,f1,p1,m1,g1,_1,y1,b1,k1,w1,E1,x1,v1,T1,A1,S1,O1,R1,I1,N1,L1,C1,M1,U1,F1,$1,B1,D1,P1,$f,Df,jf,zf,Wf,j1,z1,Gf,G1,W1,K1,H1,Y1,e1,n1,i1,s1,a1,c1,u1,h1,d1,Rl,Xe]}const ik=rk([Sy,Ff,V1,X1,q1,_o,Ry,Bf,Oy,Ny,Sa,sU,ek,nk,Hf,Ol,Yf,tk,Kf,Z1,Q1,J1]),cU=new cn({defaultMode:"use_newlines",modes:{use_newlines:ik,ignore_newlines:rk([oU])}},{skipValidations:!Jr,ensureOptimizations:Jr,positionTracking:"full"});function sk(e){Ay=!0;const t=cU.tokenize(e||` 
`),[n]=(ue(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(gl(Sa,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function lU(e,t,n=!0){if(n){const[r,...i]=t;switch(It(r??"")){default:return{type:At.OBJECT,values:t};case"loader":return{type:At.LOADER,values:i};case"board":return{type:At.BOARD,values:i};case"object":return{type:At.OBJECT,values:i};case"terrain":return{type:At.TERRAIN,values:i};case"charset":return{type:At.CHARSET,values:i};case"palette":return{type:At.PALETTE,values:i}}}else{const[r,i,...s]=t,o=It(i??""),a=[r,e,...s];switch(o){default:return{type:At.CONST,values:t};case"rn":case"range":return{type:At.RANGE,values:a};case"sl":case"select":return{type:At.SELECT,values:a};case"nm":case"number":return{type:At.NUMBER,values:a};case"tx":case"text":return{type:At.TEXT,values:a};case"hk":case"hotkey":return{type:At.HOTKEY,values:a};case"copyit":return{type:At.COPYIT,values:a};case"openit":return{type:At.OPENIT,values:a};case"zssedit":return{type:At.ZSSEDIT,values:a};case"charedit":return{type:At.CHAREDIT,values:a};case"coloredit":return{type:At.COLOREDIT,values:a}}}}function sr(e){switch(e){case At.LOADER:return"loader";case At.BOARD:return"board";case At.OBJECT:return"object";case At.TERRAIN:return"terrain";case At.CHARSET:return"charset";case At.PALETTE:return"palette";case At.CONST:return"const";case At.RANGE:return"range";case At.SELECT:return"select";case At.NUMBER:return"number";case At.TEXT:return"text";case At.HOTKEY:return"hotkey";case At.COPYIT:return"copyit";case At.OPENIT:return"openit";case At.ZSSEDIT:return"zssedit";case At.CHAREDIT:return"charedit";case At.COLOREDIT:return"coloredit"}}var Vf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Vf||{});function ok(e){return co(e,Vf,{bits:t=>Array.from(t)})}function ak(e){return ia(e,Vf,{bits:t=>new Uint8Array(t)})}function ck(e,t){return{id:De(),code:e,...t}}var Xf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Xf||{});function uU(e){return co(e,Xf,{board:KP,object:Pc,terrain:Pc,charset:ok,palette:ok,stats:Ae})}function hU(e){return ia(e,Xf,{board:HP,object:$c,terrain:$c,charset:ak,palette:ak})}function Ra(e){const t={...As(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function fU(e){return b(e)?(e.stats=void 0,As(e)):{}}function lk(e){const t=sk(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Ff){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=lU(yt(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case At.LOADER:n.type=bt.LOADER,n.name=f;break;case At.BOARD:n.type=bt.BOARD,n.name=f;break;case At.OBJECT:n.type=bt.OBJECT,n.name=f||"object";break;case At.TERRAIN:n.type=bt.TERRAIN,n.name=f;break;case At.CHARSET:n.type=bt.CHARSET,n.name=f;break;case At.PALETTE:n.type=bt.PALETTE,n.name=f;break;case At.CONST:{const[d,h]=u.values;if(yt(d)){const m=It(d);if(yt(h)){const p=parseFloat(h);n[m]=xt(p)?p:h}else xt(h)?n[m]=h:n[m]=1}break}case At.RANGE:case At.SELECT:case At.NUMBER:case At.TEXT:case At.HOTKEY:case At.ZSSEDIT:case At.CHAREDIT:case At.COLOREDIT:{const[d,...h]=u.values;if(yt(d)){const m=It(d);n[m]=[sr(u.type),...h]}break}}}}return n}function As(e){var t;return b(e)?(b((t=e.stats)==null?void 0:t.type)||(e.stats=lk(e.code),b(e.stats.type)||(e.stats.type=bt.OBJECT)),e.stats):{}}function uk(e){switch(e){default:case bt.ERROR:return"error";case bt.LOADER:return sr(At.LOADER);case bt.BOARD:return sr(At.BOARD);case bt.OBJECT:return sr(At.OBJECT);case bt.TERRAIN:return sr(At.TERRAIN);case bt.CHARSET:return sr(At.CHARSET);case bt.PALETTE:return sr(At.PALETTE)}}function ci(e){return As(e).type??bt.ERROR}function Oi(e){return uk(ci(e))}function Ue(e){return As(e).name??""}function qf(e,t){return As(e)[t]}const Nl=new Eh;function dU(e){if(!yt(e))return;const t=Zo(e);if(b(t)&&b(Lt[t]))return Lt[t];const n=It(e),r=mt[n];if(b(r))return r}function Jf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ue(s))switch(i){case"name":case"char":case"displaychar":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"color":case"bg":case"displaycolor":case"displaybg":case"lightdir":t[i]=dU(e[i])??e[i];break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=1;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Wt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Wt.ISSWIM;break;case"issolid":t.collision=Wt.ISSOLID;break;case"isbullet":t.collision=Wt.ISBULLET;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Re(e){var t;if(b(e))switch(ci(e)){default:return;case bt.ERROR:return e.code??"";case bt.LOADER:return e.code??"";case bt.BOARD:{b(e.board)||(e.board=Ql()),e.board.id=e.id;const n=Ra(e);return n.isdark&&(e.board.isdark=1),n.notdark&&(e.board.isdark=0),xt(n.startx)&&(e.board.startx=n.startx),xt(n.starty)&&(e.board.starty=n.starty),yt(n.over)&&(It(n.over)==="empty"?e.board.over=void 0:e.board.over=n.over,e.board.overboard=void 0),yt(n.under)&&(It(n.under)==="empty"?e.board.under=void 0:e.board.under=n.under,e.board.underboard=void 0),yt(n.camera)&&(It(n.camera)==="empty"?e.board.camera=void 0:e.board.camera=n.camera),yt(n.graphics)&&(It(n.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=n.graphics),xt(n.facing)&&(e.board.facing=n.facing),yt(n.facing)&&It(n.facing)==="empty"&&(e.board.facing=void 0),yt(n.exitnorth)&&(e.board.exitnorth=n.exitnorth),yt(n.exitsouth)&&(e.board.exitsouth=n.exitsouth),yt(n.exitwest)&&(e.board.exitwest=n.exitwest),yt(n.exiteast)&&(e.board.exiteast=n.exiteast),xt(n.timelimit)&&(e.board.timelimit=n.timelimit),n.restartonzap&&(e.board.restartonzap=1),n.norestartonzap&&(e.board.restartonzap=0),xt(n.maxplayershots)&&(e.board.maxplayershots=n.maxplayershots),e.board}case bt.OBJECT:return b(e.object)||(e.object=Zm()),e.object.id=e.id,e.object.code=e.code,e.object.name=Ue(e),e.object.category=Bn.ISOBJECT,Jf(Ra(e),e.object),e.object;case bt.TERRAIN:return b(e.terrain)||(e.terrain=Zm()),e.terrain.id=e.id,e.terrain.name=Ue(e),e.terrain.category=Bn.ISTERRAIN,Jf(Ra(e),e.terrain),e.terrain;case bt.PALETTE:{if(b(e.palette)||(e.palette=ng(US)),b((t=e.palette)==null?void 0:t.bits)){const n=Ra(e),r=Jn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&yt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Nl.set(o);const c=a*Oc,l=Nl.r*63,u=Nl.g*63,f=Nl.b*63;e.palette.bits[c+0]=mn(l,0,63),e.palette.bits[c+1]=mn(u,0,63),e.palette.bits[c+2]=mn(f,0,63)}}}}return e.palette}case bt.CHARSET:return b(e.charset)||(e.charset=rg(MS)),e.charset}}function Zf(e){return{id:De(),name:hE(),timestamp:0,activelist:[],pages:e,flags:{}}}var Qf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(Qf||{});function pU(e){return co(e,Qf,{pages:t=>t.map(uU),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function mU(e){return ia(e,Qf,{pages:t=>t.map(hU)})}function hk(e){b(e)&&(e.token=`${fE()}${fr(1111,9999)}`)}function Ss(e,t){if(!b(e))return;const n=It(t);return e.pages.find(i=>i.id===t||n===Ue(i))}function en(e,t,n){if(!b(e))return;const r=It(n);return e.pages.find(s=>ci(s)===t&&(s.id===n||r===Ue(s)))}function td(e,t,n){let r=en(e,t,n);if(!b(r)){const i=uk(t);return r=ck(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),ed(e,r),[r,!0]}return[r,!1]}function Rs(e,t){return b(e)?e.pages.filter(n=>ci(n)===t):[]}function fk(e,t,n){if(!b(e))return[];const r=It(n);return e.pages.filter(s=>ci(s)===t).filter(s=>{const o=As(s),a=It(Ue(s));return s.id===n||r===a||b(o[n])})}function Oa(e){return b(e)?xr(e.pages).sort((n,r)=>{const i=ci(n),s=ci(r);return i===s?Ue(n).localeCompare(Ue(r)):s-i}):[]}function dk(e,t){if(b(t)){const n=en(e,bt.TERRAIN,t.kind??"");if(b(n))return n;const r=en(e,bt.OBJECT,t.kind??"");if(b(r))return r}}function ed(e,t){if(!b(e)||!b(t))return!1;const n=Ss(e,t.id);return b(n)?!1:(e.pages.push(t),hk(e),!0)}function pk(e,t){const n=Ss(e,t);if(b(e)&&b(n)){const r=It(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Ue(i)),hk(e),n}}function Xi(e,t=1,n=Lt.WHITE,r=Lt.BLACK){const i=e==null?void 0:e.kinddata;return{name:It((e==null?void 0:e.name)??(i==null?void 0:i.name)),char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??n,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??r,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function gU(e,t){return!!(e!=null&&e.flags[t])}function Ni(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function mk(e,t){e&&delete e.flags[t]}function gk(e,t,n){const r=Ni(e,t);return r==null?void 0:r[n]}function _U(e,t,n,r){const i=Ni(e,t);return i&&(i[n]=r),r}function _k(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ie(t,{x:s,y:i});Ge(o)&&vn(t,o,e.timestamp),Oe(t,{x:s,y:i})}}function yU(e,t,n){for(let r=t.y;r<=n.y;++r)for(let i=t.x;i<=n.x;++i)Oe(e,{x:i,y:r})}function yk(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ie(t,{x:s,y:i});Ge(o)&&vn(t,o,e.timestamp),Oe(t,{x:s,y:i})}}function yo(e,t){b(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function Il(e,t,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return bU(e,t,n,"",i)}if(!b(w.book))return;const s=w.book,o=en(s,bt.BOARD,e),a=Re(o);if(!b(a))return;const c=en(s,bt.BOARD,t),l=Re(c);if(!b(l))return;Se(a),Se(l);let u=!1;if(b(a)&&b(l)){switch(i){case"all":_k(s,l,n,r);break;case"object":yk(s,l,n,r);break;case"terrain":yU(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:d,y:f};let k,y=ie(a,p);if(Ge(y)?(k=ns(a,d,f),yn(y==null?void 0:y.id)&&(y=void 0)):(k=y,y=void 0),b(k)&&(m||u&&Gt(k,"group")===i)){u&&_k(s,l,p,p);const v=Dr(l,[k.kind??""],p);yo(v,k)}if(b(y)&&(h||u&&Gt(y,"group")===i)){u&&yk(s,l,p,p);const v=Dr(l,[y.kind??""],p);yo(v,y)}}oa(l)}}function bU(e,t,n,r,i){if(!b(w.book))return;const s=w.book,o=en(s,bt.BOARD,e),a=Re(o);if(!b(a))return;const c=en(s,bt.BOARD,t),l=Re(c);if(b(l)&&(Se(a),Se(l),b(a)&&b(l))){const{terrainelements:u,objectelements:f}=tg(a,r,i);if(u.length===0&&f.length===0)return;const d={x:St,y:Vt};for(let h=0;h<u.length;++h){const m=u[h];xt(m.x)&&(d.x=Math.min(d.x,m.x)),xt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<f.length;++h){const m=f[h];xt(m.x)&&(d.x=Math.min(d.x,m.x)),xt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},k=ie(l,p);b(k)&&(Ge(k)&&vn(l,k,s.timestamp),Oe(l,p));const y=Dr(l,[m.kind??""],p);yo(y,m)}for(let h=0;h<f.length;++h){const m=f[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},k=Dr(l,[m.kind??""],p);yo(k,m)}oa(l)}}function Na(e,t){const n=gk(e,t,"board"),r=Pr(bt.BOARD,n);return Re(r)}function kU(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Cl(e,t,n){if(!b(e))return;_U(e,t,"board",n);const r=un(n);b(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function bo(e,t,n,r,i=!1){if(!b(e))return;const s=hn(t);if(!b(s))return;const o=Mn(s,t);if(!Ge(o)||!(o!=null&&o.id))return;const a=un(n);if(!b(a)||(Se(a),i===!1&&Ph(a,Wt.ISWALK,r,!0)))return;delete s.objects[o.id];const c=jr(s,o);s.lookup&&(s.lookup[c]=void 0),o.x=r.x,o.y=r.y,a.objects[o.id]=o;const l=jr(a,o);a.lookup&&(a.lookup[l]=o.id),Cl(e,t,a.id)}function wU(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=gk(e,r,"board");return yt(i)?i:""});return BA(n)}function ko(e){const t=wU(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=un(t[i]);if(b(s)&&!n.has(s.id)){if(yt(s.over))if(yt(s.overboard)){const o=un(s.overboard);b(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=un(s.over);b(o)&&(s.overboard=o.id)}else yt(s.overboard)&&delete s.overboard;if(r.push(s),yt(s.under))if(yt(s.underboard)){const o=un(s.underboard);b(o)||delete s.underboard}else{const o=un(s.under);b(o)&&(s.underboard=o.id)}else yt(s.underboard)&&delete s.underboard}}return r}const EU=fm(32,126).map(e=>String.fromCharCode(e)),xU=ir({name:"Whitespace",pattern:/ +/}),vU=ir({name:"WhitespaceSkipped",pattern:/ +/,group:cn.SKIPPED}),nd=ir({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),bk=ir({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:EU}),rd=ir({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),id=ir({name:"EscapedDollar",pattern:"$$"}),sd=ir({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),od=ir({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),kk=ir({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function TU(e,t=""){return ir({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const wk=Object.keys(Jo).map(e=>TU(`\\$(${e})`,e)),AU=[xU,nd,...wk,rd,bk,od,id,kk,sd],SU=new cn(AU,{skipValidations:!Jr,ensureOptimizations:Jr}),RU=new cn([vU,nd,...wk,rd,bk,od,id,kk,sd],{skipValidations:!Jr,ensureOptimizations:Jr});function ad(e,t=!1){return t?RU.tokenize(e):SU.tokenize(e)}function cd(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Ek(e){e.active={...e.reset}}function xk(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case id:s("$");break;case od:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case rd:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case nd:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=Jo[l],f=jA(Lt[u]),d=zA(Lt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):b(f)?t.active.color=f:b(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(b(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Ek(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;NU(u,u+l.length,t.active.color,t.active.bg,t),OU(u,l,t)}}}function vk(e,t,n){const r=ad(e);r.tokens&&(xk(r.tokens,t),n&&Ek(t),t.changed())}function Tk(e,t,n){const r=ad(e);if(!r.tokens)return;const i=cd(t,n,Lt.WHITE,Lt.BLACK);return i.measureonly=!0,xk(r.tokens,i),i.x>0&&++i.y,i}function OU(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function NU(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Ll(e,t,n){if(!gs(w.element))return 0;const[r,i]=it(t,0,[H.DIR,H.MAYBE_KIND]),s=i??["bullet"],o=SP(w.board,s,{x:w.element.x,y:w.element.y});if(b(o)){b(n)&&(o.arg=n),o.cycle=1,o.party=w.elementid,o.collision=Wt.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-w.element.x,o.stepy=r.destpt.y-w.element.y,o.bg=Lt.ONCLEAR;const a=$r(o),c=o.code??(a==null?void 0:a.code)??"";xw(w.book,w.board,o,c)}return e.yield(),0}function Ml(e,t,n,r){var l,u;if(!gs(w.element)||!b(w.book)||!b(w.board)||!b(w.element))return 0;Se(w.board);const[i,s]=it(t,0,[H.DIR,H.KIND]),o=ie(w.board,i.destpt);if((o==null?void 0:o.category)===Bn.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((l=w.element)==null?void 0:l.x)??0,y:((u=w.element)==null?void 0:u.y)??0},d=ze(i.destpt,Or(f,i.destpt));$h(w.board,o,d)}const[a]=s,c=$r({kind:a});if(Ge(c)||Dr(w.board,s,i.destpt,n),Ge(c)){const f=Gt(c,"collision");if(!Ph(w.board,f,i.destpt)){const h=Dr(w.board,s,i.destpt,n);b(h)&&b(r)&&(h.arg=r)}}return 0}function IU(e,t,n){if(!b(w.book)||!b(w.board))return 0;Se(w.board);const[r,i]=it(t,0,[H.DIR,H.DIR]),s=ie(w.board,r.destpt);return Ge(s),0}const CU={x:0,y:0},LU={x:St-1,y:Vt-1},MU="all",UU=wi().command("goto",(e,t)=>{var a,c;if(!b(w.book)||!b(w.board))return 0;const[n,r]=it(t,0,[H.STRING]),[i,s]=it(t,r,[H.MAYBE_NUMBER,H.MAYBE_NUMBER]),o=un(n);if(b(o)){Se(o);const l={x:((a=w.element)==null?void 0:a.x)??i??Math.round(St*.5),y:((c=w.element)==null?void 0:c.y)??s??Math.round(Vt*.5)},u=Qr(w.element),{color:f}=Xi(w.element),d=[];f>Lt.NON&&d.push(...Zl(o,[u,[Lt[f]]]));const[h]=d.sort((m,p)=>{const k=m.y??1e4,v=(p.y??1e4)-k;if(v!==0)return v;const T=m.x??1e4;return(p.x??1e4)-T});b(h)&&xt(h.x)&&xt(h.y)&&(l.x=h.x,l.y=h.y),bo(w.book,w.elementfocus,o.id,l,!0)}return 0}).command("build",(e,t)=>{if(!b(w.book)||!b(w.board)||!b(w.element))return 0;const[n,r]=it(t,0,[H.NAME,H.MAYBE_STRING]),i=Ql();if(b(i)){if(yt(r)){const s=un(r);b(s)&&Il(s.id,i.id,CU,LU,MU)}e.set(n,i.id)}return 0}).command("shove",(e,t)=>{if(!b(w.book)||!b(w.board))return 0;Se(w.board);const[n,r]=it(t,0,[H.DIR,H.DIR]),i=ie(w.board,n.destpt);return Ge(i)&&es(w.book,w.board,i,r.destpt),0}).command("duplicate",IU).command("write",(e,t)=>{var d;if(!b(w.book)||!b(w.board))return 0;Se(w.board);const[n,r,i]=it(t,0,[H.DIR,H.COLOR]),s=t.slice(i).map(Te).join(" "),{color:o,bg:a}=bm(r),c=((d=Tk(s,256,1))==null?void 0:d.measuredwidth)??1,l=cd(256,1,o??Lt.WHITE,a??Lt.BLACK);vk(s,l,!1);const u=c-1;switch(Or(n.startpt,n.destpt)){case mt.EAST:for(let h=0;h<c;++h)Oe(w.board,{x:n.destpt.x+h,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case mt.WEST:for(let h=0;h<c;++h)Oe(w.board,{x:n.destpt.x+h-u,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case mt.NORTH:for(let h=0;h<c;++h)Oe(w.board,{x:n.destpt.x,y:n.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case mt.SOUTH:for(let h=0;h<c;++h)Oe(w.board,{x:n.destpt.x,y:n.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(e,t)=>{if(!b(w.book)||!b(w.board))return 0;Se(w.board);const[n,r]=it(t,0,[H.KIND,H.KIND]);(Pa(n)??"")==="empty"&&zP(w.board).forEach(c=>{Dr(w.board,r,c)});const s=Pa(r),o=Jl(r),a=Tw(r);return Zl(w.board,n).forEach(c=>{if(b(o)&&(c.color=o),b(a)&&(c.bg=a),Qr(c)!==s){const l=Gt(c,"color"),u=Gt(c,"bg");if(vn(w.board,c,w.timestamp),s!=="empty"){const f={x:c.x??0,y:c.y??0},d=Dr(w.board,r,f);b(d)&&(d.color=l,d.bg=u)}}}),0}).command("put",(e,t)=>Ml(e,t)).command("putwith",(e,t)=>{const[n,r]=it(t,0,[H.ANY]);return Ml(e,t.slice(r),void 0,n)}).command("oneof",(e,t)=>{const[n,r]=it(t,0,[H.ANY]);return b(w.board)&&Mn(w.board,n)?0:Ml(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=it(t,0,[H.ANY,H.ANY]);return b(w.board)&&Mn(w.board,r)?0:Ml(e,t.slice(i),r,n)}).command("shoot",Ll).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[H.ANY]);return Ll(e,t.slice(r),n)}).command("throwstar",(e,t)=>Ll(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[n,r]=it(t,0,[H.ANY]);return Ll(e,[...t.slice(r),"star"],n)}),qi="$dkpurple",FU="$196",BU="$205",Ke="$yellow$205$205$205$196";function be(e,t,n){FE(e,t,n)}function PU(e,t,n){const r=FU.repeat(n);be(e,t,`${qi}${r}`)}function ld(e,t,n){const r=BU.repeat(n);be(e,t,`${qi}${r}`)}function ud(e,t,n){be(e,t,`${qi} ${" ".repeat(n.length)} `),PU(e,t,n.length+2),be(e,t,`${qi} $white${n} `),ld(e,t,n.length+2)}function Os(e,t,n){be(e,t,`${qi} ${" ".repeat(n.length)} `),be(e,t,`${qi} $gray${n} `),ld(e,t,n.length+2)}function Ns(e,t,n,r){be(e,t,`${qi} $white${n} $blue${r}`)}function Yn(e,t,n){be(e,t,`${qi}$blue${n}`)}function $U(e,t,n,r){be(e,t,`!${n};${r}`)}var DU=`desc;$DKGRAYname and type of codepage
`,jU=Object.freeze({__proto__:null,default:DU}),zU="desc;changes object into specified element",WU=Object.freeze({__proto__:null,default:zU}),GU="desc;like #play but for sound effects",KU=Object.freeze({__proto__:null,default:GU}),HU="",YU=Object.freeze({__proto__:null,default:HU}),VU="",XU=Object.freeze({__proto__:null,default:VU}),qU="",JU=Object.freeze({__proto__:null,default:qU}),ZU="",QU=Object.freeze({__proto__:null,default:ZU}),t3="",e3=Object.freeze({__proto__:null,default:t3}),n3="",r3=Object.freeze({__proto__:null,default:n3}),i3="",s3=Object.freeze({__proto__:null,default:i3}),o3="",a3=Object.freeze({__proto__:null,default:o3}),c3="",l3=Object.freeze({__proto__:null,default:c3}),u3="",h3=Object.freeze({__proto__:null,default:u3}),f3="",d3=Object.freeze({__proto__:null,default:f3}),p3="",m3=Object.freeze({__proto__:null,default:p3}),g3="",_3=Object.freeze({__proto__:null,default:g3}),y3="",b3=Object.freeze({__proto__:null,default:y3}),k3="",w3=Object.freeze({__proto__:null,default:k3}),E3=`desc;$DKGRAYstarts a section of an if-do-done block
`,x3=Object.freeze({__proto__:null,default:E3}),v3=`desc;$DKGRAYcompletes an if-do-done block
`,T3=Object.freeze({__proto__:null,default:v3}),A3="",S3=Object.freeze({__proto__:null,default:A3}),R3="",O3=Object.freeze({__proto__:null,default:R3}),N3="",I3=Object.freeze({__proto__:null,default:N3}),C3=`desc;$DKGRAYelse logic in an if-do-done block
`,L3=Object.freeze({__proto__:null,default:C3}),M3=`desc;$DKGRAYconditional else logic in an if-do-done block
`,U3=Object.freeze({__proto__:null,default:M3}),F3="",B3=Object.freeze({__proto__:null,default:F3}),P3="",$3=Object.freeze({__proto__:null,default:P3}),D3="",j3=Object.freeze({__proto__:null,default:D3}),z3="",W3=Object.freeze({__proto__:null,default:z3}),G3="",K3=Object.freeze({__proto__:null,default:G3}),H3="",Y3=Object.freeze({__proto__:null,default:H3}),V3="",X3=Object.freeze({__proto__:null,default:V3}),q3="",J3=Object.freeze({__proto__:null,default:q3}),Z3=`desc;$DKGRAYhalt until the next cycle
`,Q3=Object.freeze({__proto__:null,default:Z3}),t8=`desc;$DKGRAYevals condition for true or false
`,e8=Object.freeze({__proto__:null,default:t8}),n8="",r8=Object.freeze({__proto__:null,default:n8}),i8="",s8=Object.freeze({__proto__:null,default:i8}),o8="",a8=Object.freeze({__proto__:null,default:o8}),c8="",l8=Object.freeze({__proto__:null,default:c8}),u8="",h8=Object.freeze({__proto__:null,default:u8}),f8="",d8=Object.freeze({__proto__:null,default:f8}),p8="",m8=Object.freeze({__proto__:null,default:p8}),g8="",_8=Object.freeze({__proto__:null,default:g8}),y8="",b8=Object.freeze({__proto__:null,default:y8}),k8="",w8=Object.freeze({__proto__:null,default:k8}),E8="",x8=Object.freeze({__proto__:null,default:E8}),v8="",T8=Object.freeze({__proto__:null,default:v8}),A8="",S8=Object.freeze({__proto__:null,default:A8}),R8="",O8=Object.freeze({__proto__:null,default:R8}),N8="",I8=Object.freeze({__proto__:null,default:N8}),C8="",L8=Object.freeze({__proto__:null,default:C8}),M8="",U8=Object.freeze({__proto__:null,default:M8}),F8="",B8=Object.freeze({__proto__:null,default:F8}),P8="",$8=Object.freeze({__proto__:null,default:P8}),D8="",j8=Object.freeze({__proto__:null,default:D8}),z8="",W8=Object.freeze({__proto__:null,default:z8}),G8=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,K8=Object.freeze({__proto__:null,default:G8}),H8="",Y8=Object.freeze({__proto__:null,default:H8}),V8="",X8=Object.freeze({__proto__:null,default:V8}),q8="",J8=Object.freeze({__proto__:null,default:q8}),Z8="",Q8=Object.freeze({__proto__:null,default:Z8}),t2="",e2=Object.freeze({__proto__:null,default:t2}),n2="",r2=Object.freeze({__proto__:null,default:n2}),i2="",s2=Object.freeze({__proto__:null,default:i2}),o2="",a2=Object.freeze({__proto__:null,default:o2}),c2="",l2=Object.freeze({__proto__:null,default:c2}),u2="",h2=Object.freeze({__proto__:null,default:u2}),f2="",d2=Object.freeze({__proto__:null,default:f2}),p2="",m2=Object.freeze({__proto__:null,default:p2}),g2="",_2=Object.freeze({__proto__:null,default:g2}),y2="",b2=Object.freeze({__proto__:null,default:y2}),k2="",w2=Object.freeze({__proto__:null,default:k2}),E2="",x2=Object.freeze({__proto__:null,default:E2}),v2="",T2=Object.freeze({__proto__:null,default:v2}),A2="",S2=Object.freeze({__proto__:null,default:A2}),R2="",O2=Object.freeze({__proto__:null,default:R2}),N2=`desc;$DKGRAYdesignates an inactive label or comment
`,I2=Object.freeze({__proto__:null,default:N2}),C2=`desc;$DKGRAYadds hyperlink text

`,L2=Object.freeze({__proto__:null,default:C2}),M2=`desc;$DKGRAYsends the given message when hotkey is pressed

`,U2=Object.freeze({__proto__:null,default:M2}),F2=`desc;$DKGRAYread number input into given stat/flag
`,B2=Object.freeze({__proto__:null,default:F2}),P2=`desc;$DKGRAYa slider input from 1 to 9 

`,$2=Object.freeze({__proto__:null,default:P2}),D2=`desc;$DKGRAYlist with label value pairs to pick from
`,j2=Object.freeze({__proto__:null,default:D2}),z2=`desc;$DKGRAYread text input into given stat/flag
`,W2=Object.freeze({__proto__:null,default:z2}),G2=`desc;$DKGRAYdesignates a starting point for running code
`,K2=Object.freeze({__proto__:null,default:G2}),H2=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,Y2=Object.freeze({__proto__:null,default:H2}),V2=`desc;$DKGRAYwill move the object in the given direction
`,X2=Object.freeze({__proto__:null,default:V2}),q2=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,J2=Object.freeze({__proto__:null,default:q2}),Z2=`desc;$DKGRAYcustom 8x14 charset
`,Q2=Object.freeze({__proto__:null,default:Z2}),tF=`desc;$DKGRAYsets stat to given value

`,eF=Object.freeze({__proto__:null,default:tF}),nF=`desc;$DKGRAYsends the given message when hotkey is pressed

`,rF=Object.freeze({__proto__:null,default:nF}),iF=`desc;$DKGRAYread external content and/or handle events
`,sF=Object.freeze({__proto__:null,default:iF}),oF=`desc;$DKGRAYread number input into given stat/flag
`,aF=Object.freeze({__proto__:null,default:oF}),cF=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,lF=Object.freeze({__proto__:null,default:cF}),uF=`desc;$DKGRAYcustom palette colors
`,hF=Object.freeze({__proto__:null,default:uF}),fF=`desc;$DKGRAYa slider input from 1 to 9 

`,dF=Object.freeze({__proto__:null,default:fF}),pF=`desc;$DKGRAYlist with label value pairs to pick from
`,mF=Object.freeze({__proto__:null,default:pF}),gF=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,_F=Object.freeze({__proto__:null,default:gF}),yF=`desc;$DKGRAYread text input into given stat/flag
`,bF=Object.freeze({__proto__:null,default:yF}),kF=`desc;$DKGRAYadds text
`,wF=Object.freeze({__proto__:null,default:kF}),EF=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,xF=Object.freeze({__proto__:null,default:EF}),vF=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,TF=Object.freeze({__proto__:null,default:vF}),AF=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,SF=Object.freeze({__proto__:null,default:AF}),RF=`header;player settings
#set user "name goes here"
`,OF=Object.freeze({__proto__:null,default:RF}),NF=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,IF=Object.freeze({__proto__:null,default:NF});const Ak=Object.assign({"./editor/codepagename.txt":jU,"./editor/command/become.txt":WU,"./editor/command/bgplay.txt":KU,"./editor/command/bgvol.txt":YU,"./editor/command/bind.txt":XU,"./editor/command/board.txt":JU,"./editor/command/bpm.txt":QU,"./editor/command/break.txt":e3,"./editor/command/change.txt":r3,"./editor/command/char.txt":s3,"./editor/command/charset.txt":a3,"./editor/command/clear.txt":l3,"./editor/command/color.txt":h3,"./editor/command/continue.txt":d3,"./editor/command/copy.txt":m3,"./editor/command/cycle.txt":_3,"./editor/command/die.txt":b3,"./editor/command/distort.txt":w3,"./editor/command/do.txt":x3,"./editor/command/done.txt":T3,"./editor/command/duplicate.txt":S3,"./editor/command/echo.txt":O3,"./editor/command/edge.txt":I3,"./editor/command/else.txt":L3,"./editor/command/elseif.txt":U3,"./editor/command/end.txt":B3,"./editor/command/endgame.txt":$3,"./editor/command/endwith.txt":j3,"./editor/command/fcrush.txt":W3,"./editor/command/fetch.txt":K3,"./editor/command/fetchwith.txt":Y3,"./editor/command/foreach.txt":X3,"./editor/command/go.txt":J3,"./editor/command/idle.txt":Q3,"./editor/command/if.txt":e8,"./editor/command/lock.txt":r8,"./editor/command/oneof.txt":s8,"./editor/command/oneofwith.txt":a8,"./editor/command/palette.txt":l8,"./editor/command/phaser.txt":h8,"./editor/command/pivot.txt":d8,"./editor/command/play.txt":m8,"./editor/command/put.txt":_8,"./editor/command/putwith.txt":b8,"./editor/command/readbin.txt":w8,"./editor/command/readjson.txt":x8,"./editor/command/readline.txt":T8,"./editor/command/readrexpaint.txt":S8,"./editor/command/remix.txt":O8,"./editor/command/repeat.txt":I8,"./editor/command/restore.txt":L8,"./editor/command/reverb.txt":U8,"./editor/command/revert.txt":B8,"./editor/command/run.txt":$8,"./editor/command/runwith.txt":j8,"./editor/command/set.txt":W8,"./editor/command/shoot.txt":K8,"./editor/command/shootwith.txt":Y8,"./editor/command/shove.txt":X8,"./editor/command/snapshot.txt":J8,"./editor/command/synth.txt":Q8,"./editor/command/toast.txt":e2,"./editor/command/tts.txt":r2,"./editor/command/ttsvol.txt":s2,"./editor/command/twitchbroadcast.txt":a2,"./editor/command/twitchchat.txt":l2,"./editor/command/unlock.txt":h2,"./editor/command/vibrato.txt":d2,"./editor/command/vol.txt":m2,"./editor/command/waitfor.txt":_2,"./editor/command/walk.txt":b2,"./editor/command/weave.txt":w2,"./editor/command/while.txt":x2,"./editor/command/with.txt":T2,"./editor/command/write.txt":S2,"./editor/command/zap.txt":O2,"./editor/comment.txt":I2,"./editor/hyperlink.txt":L2,"./editor/hyperlink/hotkey.txt":U2,"./editor/hyperlink/number.txt":B2,"./editor/hyperlink/range.txt":$2,"./editor/hyperlink/select.txt":j2,"./editor/hyperlink/text.txt":W2,"./editor/label.txt":K2,"./editor/shortgo.txt":Y2,"./editor/shorttry.txt":X2,"./editor/stat/board.txt":J2,"./editor/stat/charset.txt":Q2,"./editor/stat/const.txt":eF,"./editor/stat/hotkey.txt":rF,"./editor/stat/loader.txt":sF,"./editor/stat/number.txt":aF,"./editor/stat/object.txt":lF,"./editor/stat/palette.txt":hF,"./editor/stat/range.txt":dF,"./editor/stat/select.txt":mF,"./editor/stat/terrain.txt":_F,"./editor/stat/text.txt":bF,"./editor/text.txt":wF,"./help/controls.txt":xF,"./help/developer.txt":TF,"./help/menu.txt":SF,"./help/player.txt":OF,"./help/text.txt":IF}),Sk={};Jn(Ak).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");Sk[t]=Ak[e].default});function CF(e){const t=It(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Sk[t];if(b(n))return n;const{target:r,path:i}=Pn(t);switch(r){case"editor":{const s=Pn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function LF(e,t){const n=(e??"").split(`
`);for(let r=0;r<n.length;++r)t(n[r].split(";"))}function MF(e,t){const[n,...r]=t,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":ud(et,e,i);break;case"section":Os(et,e,i);break;case"option":Ns(et,e,i,s);break;default:n.trimStart().startsWith("!")?$U(et,e,n.trimStart().slice(1),i):be(et,e,n);break}}function Ii(e){const[t,n]=it(e,0,[H.NAME,H.ANY]);if(It(t)==="send"&&nr(n)){const[,r,i,s]=it(e,0,[H.NAME,H.DIR,H.MAYBE_NAME]);return yt(i)&&i.startsWith(":")?{targetdir:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:r,label:e.slice(s-1).join(" ")}}else if(yt(t)){const[r,i,s]=it(e,0,[H.NAME,H.MAYBE_NAME]);return yt(i)&&i.startsWith(":")?{targetname:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetname:"self",label:[r,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Is(){o0(et,ar())}function Ia(e){LF(CF(`help:${e}`),t=>MF(w.elementfocus,t))}function Rk(e){switch(e.label){case"helpmenu":Ia("menu");break;case"helpcontrols":Ia("controls");break;case"helptext":Ia("text");break;case"helpdeveloper":Ia("developer");break;case"helpplayer":Ia("player");break;default:{const t=ce($t.MAIN),n=ko(t);b(e.targetname)?Oo(e.targetname,e.label,void 0,n):b(e.targetdir)&&Oo(e.targetdir.destpt,e.label,void 0,n);break}}}const UF=wi().command("shortsend",(e,t)=>{const n=Ii(t);return Rk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Rk(n),0}).command("stat",(e,t)=>{const[n,...r]=t.map(Te),i=r.join(" ");function s(o,a){if(b(o)&&(e.command("pageopen",o.id),a)){const c=Ue(o),l=Oi(o);be(et,w.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(It(n)){case sr(At.LOADER):{const[o,a]=ts($t.MAIN,i,bt.LOADER);s(o,a);break}default:{const[o,a]=ts($t.MAIN,[n,...r].join(" "),bt.OBJECT);s(o,a);break}case sr(At.BOARD):{const[o,a]=ts($t.MAIN,i,bt.BOARD);s(o,a);break}case sr(At.OBJECT):{const[o,a]=ts($t.MAIN,i,bt.OBJECT);s(o,a);break}case sr(At.TERRAIN):{const[o,a]=ts($t.MAIN,i,bt.TERRAIN);s(o,a);break}case sr(At.CHARSET):{const[o,a]=ts($t.MAIN,i,bt.CHARSET);s(o,a);break}case sr(At.PALETTE):{const[o,a]=ts($t.MAIN,i,bt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const n=t.map(Te).join(" ");if(b(w.element)&&w.elementisplayer){const{user:r}=wr(w.elementid),i=yt(r)?r:"player";w.element.tickertext=`${i}: ${n}`,w.element.tickertime=w.timestamp;const s=Xi(w.element);xe(et,w.elementid,`$${Lt[s.color]}$ON${Lt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),ku(et,w.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);if(b(s.targetname)){const{user:o}=wr(w.elementid),a=yt(o)?o:"player",c=Xi(w.element),l=`$${Lt[c.color]}$ON${Lt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;xe(et,w.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[n,r]=it(t,0,[H.MAYBE_NAME,H.MAYBE_STRING]);return yt(n)&&yt(r)?r0(et,w.elementfocus,n,r):dx(et,w.elementfocus),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[H.MAYBE_NAME]),r=yw(n);return b(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=Br(n);return b(r)?(r0(et,w.elementfocus,"selected",r.id),Is()):de(et,w.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=ce($t.MAIN),i=Br(n);return b(i)&&(r===i&&_w($t.MAIN,""),NP(n),xe(et,w.elementfocus,`trashed [book] ${i.name}`),Is(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=un(n);return b(r)&&bo(w.book,w.elementfocus,r.id,{x:fr(0,St-1),y:fr(0,Vt-1)},!0),0}).command("pageopen",(e,t)=>{const[n,r]=it(t,0,[H.NAME,H.MAYBE_NAME]);let i,s;const o=Fr();for(let a=0;a<o.length&&(s=o[a],i=Ss(s,n),!b(i));++a);if(b(i)&&b(s)){const a=Ue(i),c=Oi(i);xe(et,w.elementfocus,`opened [${c}] ${a}`);const l=[i.id,r];gh(Ya(s.id,l),i.code);const u=Oi(i);i0(et,w.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else de(et,"pageopen",`page ${n} not found`,w.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=ln($t.MAIN),i=pk(r,n);if(b(n)){const s=Ue(i),o=Oi(i);xe(et,w.elementfocus,`trashed [${o}] ${s}`),Is(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Te).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Os(et,w.elementfocus,"books");const e=ce($t.MAIN);Ns(et,w.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ce($t.MAIN);Ns(et,w.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),ld(et,w.elementfocus,7);const n=Fr();return n.length?n.forEach(r=>{be(et,w.elementfocus,`!bookopen ${r.id};${r.name}`)}):Yn(et,w.elementfocus,"no books found"),be(et,w.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=ln($t.MAIN);if(!b(e))return 0;Os(et,w.elementfocus,"pages"),Ns(et,w.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Oa(e).forEach(r=>{const i=Ue(r),s=Oi(r);be(et,w.elementfocus,`!pageopen ${r.id};$blue[${s}]$white ${i}`)}):(be(et,w.elementfocus,""),Yn(et,w.elementfocus,"$white no pages found"),Yn(et,w.elementfocus,"$white use @ to create a page"),Yn(et,w.elementfocus,"$white @board name of board"),Yn(et,w.elementfocus,"$white @object name of object"),Yn(et,w.elementfocus,"$white @terrain name of terrain"),Yn(et,w.elementfocus,"$white You can omit the type and it will default to object"),Yn(et,w.elementfocus,"$white @object name of object"),Yn(et,w.elementfocus,"$white @name of object"));const t=Fr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Ns(et,w.elementfocus,"content",`${r.name} $GREEN${r.id}`),Oa(r).forEach(s=>{const o=Ue(s),a=Oi(s);be(et,w.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Os(et,w.elementfocus,"boards");const e=ln($t.MAIN);if(b(e)){Ns(et,w.elementfocus,"main",`${e.name} $GREEN${e.id}`);const n=Oa(e);n.filter(r=>ci(r)===bt.BOARD).forEach(r=>{const i=Ue(r);be(et,w.elementfocus,`!boardopen ${r.id};$blue#goto $white $34 ${i} $34`)}),n.length===0&&(be(et,w.elementfocus,""),Yn(et,w.elementfocus,"$white no boards found"),Yn(et,w.elementfocus,"$white use @ to create a board"),Yn(et,w.elementfocus,"$white @board name of board"))}const t=Fr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Ns(et,w.elementfocus,"content",`${r.name} $GREEN${r.id}`),Oa(r).filter(s=>ci(s)===bt.BOARD).forEach(s=>{const o=Ue(s);be(et,w.elementfocus,`!boardopen ${s.id};$blue#goto $white$34 ${o} $34`)}))}return 0}).command("trash",()=>{Os(et,w.elementfocus,"$REDTRASH"),Yn(et,w.elementfocus,"books");const e=Fr();e.length&&(e.forEach(n=>{be(et,w.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),be(et,w.elementfocus,""));const t=ce($t.MAIN);return b(t)&&(Yn(et,w.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Ue(n);be(et,w.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),be(et,w.elementfocus,"")),0}).command("dev",()=>(Is(),nx(et,w.elementfocus),0)).command("share",()=>(Is(),rx(et,w.elementfocus),0)).command("save",()=>(Is(),0)).command("fork",()=>(yx(et,w.elementfocus),0)).command("itchiopublish",()=>(bx(et,w.elementfocus),0)).command("nuke",()=>(ix(et,w.elementfocus),0)).command("restart",()=>(_x(et,w.elementfocus),Is(),0)).command("export",()=>{ud(et,w.elementfocus,"E X P O R T"),Os(et,w.elementfocus,"books");const e=Fr();return e.length&&e.forEach(t=>be(et,w.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=Br(n);return b(r)&&(ud(et,w.elementfocus,"E X P O R T"),Os(et,w.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=Oa(r);be(et,w.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ue(s),a=Oi(s);be(et,w.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=Br(n);return b(r)&&e0(et,w.elementfocus,xr(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=it(t,0,[H.NAME]),{target:r,path:i}=Pn(n),s=Br(r),o=Ss(s,i);return b(o)&&e0(et,w.elementfocus,xr(o),`${Ue(o)}.${Oi(o)}.json`),0}).command("gadget",()=>(px(et,w.elementfocus),0)).command("joincode",(e,t)=>{const[n]=it(t,0,[H.MAYBE_NAME]);return HE(et,w.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=it(t,0,[H.MAYBE_NAME]);return YE(et,w.elementfocus,!!n),0}).command("startlookingglass",()=>(sx(et,w.elementfocus),0)),FF=wi().command("toast",(e,t)=>{const n=t.map(Te).join("");return Qd(et,w.elementfocus,n),0}).command("ticker",(e,t)=>{const n=t.map(Te).join("");return b(w.element)&&(w.element.tickertext=n,w.element.tickertime=w.timestamp),0}).command("palette",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=kw(),i=en(w.book,bt.PALETTE,n);return b(i)?(r.palette=i.id,xe(et,w.elementfocus,`loaded palette ${n}`)):de(et,w.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=it(t,0,[H.NAME]),r=kw(),i=en(w.book,bt.CHARSET,n);return b(i)?(r.charset=i.id,xe(et,w.elementfocus,`loaded charset ${n}`)):de(et,w.elementfocus,"not-found",`unabled to find charset ${n}`),0}),hd={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Wt.ISSOLID,Wt.ISWALK,Wt.ISSWIM,Wt.ISBULLET,Wt.ISWALK,Wt.ISSWIM;function Ul(e){return ue(e)&&fd(e[0])}function fd(e){return b(Wt[e])&&yt(e)}function BF(e){if(yt(e))return hd[It(e)]}function PF(e){const t=w.words[e];if(Ul(t))return[t,e+1];if(fd(t))return[[t],e+1];const[n,r]=In(e);return Ul(n)?[n,r]:fd(n)?[[n],r]:[void 0,e]}function wo(e,t=0){const n=[];let r=e;for(;r<w.words.length;){const[i,s]=In(r);if(ue(i)&&!nr(i)&&!Ca(i)&&!Ul(i)&&!wn(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function In(e){var r,i,s,o,a,c,l,u,f;const t=w.words[e],n=e+1;if(Nk(t)){const[d,h]=$F(e);if(b(d))return[d,h]}if(BF(t)){const[d,h]=PF(e);if(b(d))return[d,h]}if(Zo(t)){const[d,h]=Rc(e);if(b(d))return[d,h]}if(yt(t)&&It(t)==="rnd"){const[d,h]=In(n),[m,p]=In(h);return xt(d)&&xt(m)?[fr(d,m),p]:xt(d)?[fr(0,d),h]:[fr(0,1),n]}if(vh(t)){const[d,h]=mm(e);if(b(d))return[d,h]}if(!b(t))return[void 0,e];if(xt(t)||ue(t))return[t,n];if(yt(t)){const d=It(t),h=(r=w.get)==null?void 0:r.call(w,t);if(b(h))return[h,n];switch(d){case"aligned":case"alligned":{const m=Da(w.board,{x:((i=w.element)==null?void 0:i.x)??-1,y:((s=w.element)==null?void 0:s.y)??-1},w.elementfocus);return!b(w.element)||!b(m)?[0,n]:[w.element.x===m.x||w.element.y===m.y?1:0,n]}case"contact":{const m=Da(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus);if(!b(w.element)||!b(m))return[0,n];const p=(m.x??0)-(((c=w.element)==null?void 0:c.x)??0),k=(m.y??0)-(((l=w.element)==null?void 0:l.y)??0);return[p===0&&Math.abs(k)<2||k===0&&Math.abs(p)<2?1:0,n]}case"blocked":{const[m,p]=it(w.words,n,[H.DIR]);return[NS(w.board,w.element,m.destpt)?1:0,p]}case"any":{const[m]=it(w.words,n,[H.ANY]);if(nr(m)){const[v,T,A]=it(w.words,n,[H.DIR,H.COLOR_OR_KIND]),L=v.layer===mt.MID?ie(w.board,v.destpt):ns(w.board,v.destpt.x,v.destpt.y);if(b(L)){const S=Xi(L);if(wn(T))return[Ac(T)===S.color||Sc(T)===S.bg?[L]:[],A];const I=It(Pa(T)),D=Jl(T);if((I.length&&I!==S.name||b(D)&&D!==S.color)===!1)return[[L],A]}return[[],A]}const[p,k]=it(w.words,n,[H.COLOR_OR_KIND]);return wn(p)?[Aw(w.board,p),k]:[Zl(w.board,p),k]}case"count":{const[m]=it(w.words,n,[H.ANY]);if(nr(m)){const[v,T,A]=it(w.words,n,[H.DIR,H.COLOR_OR_KIND]),L=v.layer===mt.MID?ie(w.board,v.destpt):ns(w.board,v.destpt.x,v.destpt.y);if(b(L)){const S=Xi(L);if(wn(T))return[Ac(T)===S.color||Sc(T)===S.bg?1:0,A];const I=It(Pa(T)),D=Jl(T),N=I.length?I===S.name:!0,W=b(D)?D===S.color:!0;if(N&&W)return[1,A]}return[0,A]}const[p,k]=it(w.words,n,[H.COLOR_OR_KIND]);return wn(p)?[Aw(w.board,p).length,k]:[Zl(w.board,p).length,k]}case"rnd":return[fr(0,1),n];case"abs":{const[m,p]=it(w.words,n,[H.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=it(w.words,n,[H.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=it(w.words,n,[H.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=it(w.words,n,[H.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,k,y]=it(w.words,n,[H.NUMBER,H.NUMBER,H.NUMBER]);return[mn(m,p,k),y]}case"min":{const[m,p]=wo(n);return[Math.min(...m),p]}case"max":{const[m,p]=wo(n);return[Math.max(...m),p]}case"pick":{const[m,p]=wo(n);return[An(m),p]}case"pickwith":{const[m,p]=it(w.words,n,[H.NUMBER_OR_STRING]),[k,y]=wo(p);return[FA(`${m}`,k),y]}case"random":{const[m,p]=wo(n,2),[k,y]=m;return[fr(k,y??0),p]}case"randomwith":{const[m,p]=it(w.words,n,[H.NUMBER_OR_STRING]),[k,y]=wo(p,2),[v,T]=k;return[hm(`${m}`,v,T??0),y]}case"run":{const[m,p]=it(w.words,n,[H.NAME]);return ql(m),[(u=w.get)==null?void 0:u.call(w,"arg"),p]}case"runwith":{const[m,p,k]=it(w.words,n,[H.ANY,H.NAME]);return b(w.element)&&(w.element.arg=m),ql(p),[(f=w.get)==null?void 0:f.call(w,"arg"),k]}}}return[t,n]}const dd={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ca(e){return ue(e)&&Ok(e[0])}function Ok(e){return b(Bn[e])&&yt(e)}function Nk(e){if(yt(e))return dd[It(e)]}function Ik(e){if(Ca(e))return e;if(Ok(e))return[e];const t=Nk(e);if(b(t))return[t]}function $F(e){const t=w.words[e],n=Ik(t);if(Ca(n))return[n,e+1];const[r,i]=In(e),s=Ik(r);return Ca(s)?[s,i]:[void 0,e]}const DF=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Ck=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"]),jF=["NORTH","SOUTH","WEST","EAST"];function zF(e){const t=wr(e);if(xt(t.inputcurrent)||(t.inputcurrent=0),ue(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=Sn.NONE,i=0]=n??[Sn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&eS?1:0,t.inputctrl=i&nS?1:0,t.inputshift=i&rS?1:0,r){case Sn.MOVE_UP:case Sn.MOVE_DOWN:case Sn.MOVE_LEFT:case Sn.MOVE_RIGHT:t.inputmove=[jF[r-Sn.MOVE_UP]];break;case Sn.OK_BUTTON:t.inputok=1;break;case Sn.CANCEL_BUTTON:t.inputcancel=1;break;case Sn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Sn.NONE&&o!==r}),t}function WF(e){const t=dd[e];if(b(t))return t;const n=hd[e];if(b(n))return n;const r=Jo[e];if(b(r))return r;const i=xh[e];if(b(i))return i}const GF=wi({get(e,t){var o,a,c,l,u,f,d,h,m,p,k,y,v,T,A,L,S,I,D,N,W;const n=WF(t);if(b(n))return[!0,n];if(w.elementisplayer&&DF.has(t)){const q=zF(w.elementid)[t];return[b(q),q]}const r=Da(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus??ar();switch(t){case"camera":case"graphics":case"facing":if(b((c=w.board)==null?void 0:c[t]))return[!0,(l=w.board)==null?void 0:l[t]];break;case"isdark":return[!0,(u=w.board)!=null&&u.isdark?1:0];case"startx":return[!0,((f=w.board)==null?void 0:f.startx)??0];case"starty":return[!0,((d=w.board)==null?void 0:d.starty)??0];case"over":return[!0,((h=w.board)==null?void 0:h.over)??""];case"under":return[!0,((m=w.board)==null?void 0:m.under)??""];case"exitnorth":return[!0,((p=w.board)==null?void 0:p.exitnorth)??""];case"exitsouth":return[!0,((k=w.board)==null?void 0:k.exitsouth)??""];case"exitwest":return[!0,((y=w.board)==null?void 0:y.exitwest)??""];case"exiteast":return[!0,((v=w.board)==null?void 0:v.exiteast)??""];case"timelimit":return[!0,((T=w.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=w.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((L=w.board)==null?void 0:L.maxplayershots)??0];case"currenttick":return[!0,w.timestamp];case"boardid":return[!0,((S=w.board)==null?void 0:S.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((I=w.element)==null?void 0:I.id)??""];case"thisx":return[!0,((D=w.element)==null?void 0:D.x)??-1];case"thisy":return[!0,((N=w.element)==null?void 0:N.y)??-1];default:{if(Ck.has(t)){const q=(W=w.element)==null?void 0:W[t];return t==="color"&&console.info("reading color",q),[!0,q]}break}}const s=wr(i)[t];return[b(s),s]},set(e,t,n){var o,a;const r=Da(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(b(w.board))return w.board.isdark=n?1:0,[!0,w.board.isdark];break;case"startx":if(b(w.board))return w.board.startx=ta(n,0),[!0,w.board.startx];break;case"starty":if(b(w.board))return w.board.starty=ta(n,0),[!0,w.board.starty];break;case"over":if(b(w.board))return w.board.over=Te(n),[!0,w.board.over];break;case"under":if(b(w.board))return[!0,w.board.under=Te(n)];break;case"exitnorth":if(b(w.board))return[!0,w.board.exitnorth=Te(n)];break;case"exitsouth":if(b(w.board))return[!0,w.board.exitsouth=Te(n)];break;case"exitwest":if(b(w.board))return[!0,w.board.exitwest=Te(n)];break;case"exiteast":if(b(w.board))return[!0,w.board.exiteast=Te(n)];break;case"timelimit":if(b(w.board))return[!0,w.board.timelimit=ta(n,0)];break;case"restartonzap":if(b(w.board))return[!0,w.board.restartonzap=n?1:0];break;case"maxplayershots":if(b(w.board))return[!0,w.board.maxplayershots=ta(n,0)];break;case"currenttick":return[!1,n];case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(Ck.has(t))return b(w.element)&&(w.element[t]=n),[!0,n];break}}const s=wr(i);return b(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=w.element)!=null&&e.removed)&&(b((t=w.element)==null?void 0:t.stepx)||b((n=w.element)==null?void 0:n.stepy))){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};es(w.book,w.board,w.element,{x:s.x+(w.element.stepx??0),y:s.y+(w.element.stepy??0)})===!1&&(w.element.stepx=0,w.element.stepy=0,Gt(w.element,"breakable")&&vn(w.board,w.element,w.timestamp))}}}).command("clear",(e,t)=>{for(let n=0;n<t.length;++n)e.set(Te(t[n]),0);return 0}).command("set",(e,t)=>{const[n,r]=it(t,0,[H.NAME,H.ANY]);return e.set(n,r??1),0}).command("become",(e,t)=>{var r,i;const[n]=it(t,0,[H.KIND]);if(Se(w.board),Bh(w.board,w.element),vn(w.board,w.element,w.timestamp)){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};Dr(w.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[H.ANY]);if(nr(n)){const[r,i]=it(t,0,[H.DIR,H.NUMBER]),s=ie(w.board,r.destpt);b(s)&&(s.char=i)}else b(w.element)&&xt(n)&&(w.element.char=n);return 0}).command("color",(e,t)=>{const[n]=it(t,0,[H.ANY]);if(nr(n)){const[r,i]=it(t,0,[H.DIR,H.COLOR]),s=ie(w.board,r.destpt);b(s)&&sa(w.element,i)}else{const[r]=it(t,0,[H.COLOR]);b(w.element)&&b(r)&&sa(w.element,r)}return 0}).command("go",(e,t)=>{if(b(w.element)){const[n]=it(t,0,[H.DIR]);if(es(w.book,w.board,w.element,n.destpt),e.yield(),w.element.x===n.destpt.x&&w.element.y===n.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!b(w.element))return 0;const[n]=it(t,0,[H.DIR]),r=w.element.x??0,i=w.element.y??0;return w.element.stepx=n.destpt.x-r,w.element.stepy=n.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[H.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Te(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Te(t[0])),0)).command("cycle",(e,t)=>{if(b(w.element)){const[n]=it(t,0,[H.NUMBER]);w.element.cycle=mn(Math.round(n),1,255)}return 0}).command("die",e=>(vn(w.board,w.element,w.timestamp),e.endofprogram(),0)).command("endgame",()=>(s0(et,w.elementfocus),0)).command("run",(e,t)=>{const[n]=it(t,0,[H.NAME]);return ql(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[H.ANY,H.NAME]);return e.set("arg",n),ql(r),0}),Fl={};function KF(e){var t;return(t=Fl[e])==null?void 0:t.arg}function HF(e){var t;return(t=Fl[e])==null?void 0:t.format}function Eo(e){var t;return(t=Fl[e])==null?void 0:t.content}function Lk(e,t,n,r,i){const s=ce($t.MAIN);if(!b(s))return;const o=Rs(s,bt.LOADER).filter(a=>{const c=As(a),l=c.format,u=yt(l)?new RegExp(l).test(t):!1,f=c.event,d=yt(f)?new RegExp(f).test(n):!1;return yt(l)&&yt(f)?u&&d:yt(l)?u:yt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${De()}_loader`;Fl[c]={arg:e,format:t,content:r,player:i},UP(c,o[a].code)}}function Mk(e,t){if(!b(e))return;const n=It(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const YF=(e,t)=>{const n=Eo(e.id());if(!b(n))return 0;const[r,i]=it(t,0,[H.NAME]),s=It(r);switch(s){case"seek":{const[o]=it(t,i,[H.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[H.NAME]);e.set(o,Mk(n,s));break}case"text":{const[o,a]=it(t,i,[H.NAME,H.NAME]),c=Mk(n,o);if(xt(c)&&yt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);e.set(a,f),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[H.NAME]),[a]=td(w.book,bt.PALETTE,o),c=Re(a);if(b(c)){const l=VA*Oc,u=ng(new Uint8Array(n.bytes.buffer,n.cursor,l));b(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=it(t,i,[H.NAME]),[a]=td(w.book,bt.CHARSET,o),c=Re(a);if(b(c)){const l=Nc*YA*Sh,u=rg(new Uint8Array(n.bytes.buffer,n.cursor,l));b(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},xo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Bl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Bl(e[n],t[n]))return!1;return!0}if(xo(e)&&xo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Bl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Pl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(xo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},VF=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Uk=e=>e>="0"&&e<="9"||e==="-",XF=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var X;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(X||(X={}));const Fk={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},qF={"!":!0,"<":!0,"=":!0,">":!0},JF={"	":!0,"\n":!0,"\r":!0," ":!0};class ZF{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(VF(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Fk[t[this._current]]!==void 0)n.push({start:this._current,type:Fk[t[this._current]],value:t[this._current]}),this._current+=1;else if(Uk(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(qF[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(JF[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&XF(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Uk(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const QF=new ZF,En={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class tB{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...QF.tokenize(t),{type:X.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<En[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case X.TOK_LITERAL:return{type:"Literal",value:t.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(En.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(En.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(t.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(En.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(En.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(En.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case X.TOK_DOT:const i=En.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(En.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(En.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(En.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(En.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(En.Flatten);return{type:"Projection",children:[u,f]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,t);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(En.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(En.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(En[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(t);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(En[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const eB=new tB;var dt;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(dt||(dt={}));class nB{constructor(t){this.TYPE_NAME_TABLE={[dt.TYPE_NUMBER]:"number",[dt.TYPE_ANY]:"any",[dt.TYPE_STRING]:"string",[dt.TYPE_ARRAY]:"array",[dt.TYPE_OBJECT]:"object",[dt.TYPE_BOOLEAN]:"boolean",[dt.TYPE_EXPREF]:"expression",[dt.TYPE_NULL]:"null",[dt.TYPE_ARRAY_NUMBER]:"Array<number>",[dt.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>xo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===dt.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[dt.TYPE_NUMBER,dt.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===dt.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[dt.TYPE_NUMBER,dt.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==dt.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===dt.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![dt.TYPE_NUMBER,dt.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===dt.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===dt.TYPE_NUMBER?n:r===dt.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===dt.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case dt.TYPE_NUMBER:return"number";case dt.TYPE_STRING:return"string";case dt.TYPE_ARRAY:return"array";case dt.TYPE_OBJECT:return"object";case dt.TYPE_BOOLEAN:return"boolean";case dt.TYPE_EXPREF:return"expref";case dt.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[dt.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[dt.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[dt.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[dt.TYPE_STRING,dt.TYPE_ARRAY]},{types:[dt.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[dt.TYPE_STRING]},{types:[dt.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[dt.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[dt.TYPE_STRING]},{types:[dt.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[dt.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[dt.TYPE_STRING,dt.TYPE_ARRAY,dt.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[dt.TYPE_EXPREF]},{types:[dt.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[dt.TYPE_ARRAY_NUMBER,dt.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[dt.TYPE_ARRAY]},{types:[dt.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[dt.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[dt.TYPE_ARRAY_NUMBER,dt.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[dt.TYPE_ARRAY]},{types:[dt.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[dt.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[dt.TYPE_STRING,dt.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[dt.TYPE_ARRAY_STRING,dt.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[dt.TYPE_ARRAY]},{types:[dt.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[dt.TYPE_STRING]},{types:[dt.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[dt.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[dt.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[dt.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[dt.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[dt.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[dt.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(p=>{var k;return(k=!p.optional)!==null&&k!==void 0?k:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,m;for(let p=0;p<r.length;p+=1){m=!1,d=r[p].types,h=this.getTypeName(n[p]);let k;for(k=0;k<d.length;k+=1)if(h!==void 0&&this.typeMatches(h,d[k],n[p])){m=!0;break}if(!m&&h!==void 0){const y=d.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(t,n,r){if(n===dt.TYPE_ANY)return!0;if(n===dt.TYPE_ARRAY_STRING||n===dt.TYPE_ARRAY_NUMBER||n===dt.TYPE_ARRAY){if(n===dt.TYPE_ARRAY)return t===dt.TYPE_ARRAY;if(t===dt.TYPE_ARRAY){let i;n===dt.TYPE_ARRAY_NUMBER?i=dt.TYPE_NUMBER:n===dt.TYPE_ARRAY_STRING&&(i=dt.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return dt.TYPE_STRING;case"[object Number]":return dt.TYPE_NUMBER;case"[object Array]":return dt.TYPE_ARRAY;case"[object Boolean]":return dt.TYPE_BOOLEAN;case"[object Null]":return dt.TYPE_NULL;case"[object Object]":return t.jmespathType===X.TOK_EXPREF?dt.TYPE_EXPREF:dt.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class rB{constructor(){this._rootValue=null,this.runtime=new nB(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,f,d,h;switch(t.type){case"Field":return n===null?null:xo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let m=t.value;return m<0&&(m=n.length+m),s=n[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const p=[...t.children],k=this.computeSliceParams(n.length,p),[y,v,T]=k;if(s=[],T>0)for(d=y;d<v;d+=T)s.push(n[d]);else for(d=y;d>v;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(t.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(t.children[0],n),!xo(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(t.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;const L=[],S=[];for(d=0;d<h.length;d+=1)r=this.visit(t.children[2],h[d]),Pl(r)||L.push(h[d]);for(let M=0;M<L.length;M+=1)i=this.visit(t.children[1],L[M]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case X.TOK_EQ:s=Bl(o,a);break;case X.TOK_NE:s=!Bl(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case X.TOK_FLATTEN:const I=this.visit(t.children[0],n);if(!Array.isArray(I))return null;let D=[];for(d=0;d<I.length;d+=1)i=I[d],Array.isArray(i)?D=[...D,...i]:D.push(i);return D;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<t.children.length;d+=1)f.push(this.visit(t.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let N;for(d=0;d<t.children.length;d+=1)N=t.children[d],f[N.name]=this.visit(N.value,n);return f;case"OrExpression":return r=this.visit(t.children[0],n),Pl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Pl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Pl(o);case"Literal":return t.value;case X.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const W=[];for(let M=0;M<t.children.length;M+=1)W.push(this.visit(t.children[M],n));return this.runtime.callFunction(t.name,W);case"ExpressionReference":const q=t.children[0];return q.jmespathType=X.TOK_EXPREF,q;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const iB=new rB;dt.TYPE_ANY,dt.TYPE_ARRAY,dt.TYPE_ARRAY_NUMBER,dt.TYPE_ARRAY_STRING,dt.TYPE_BOOLEAN,dt.TYPE_EXPREF,dt.TYPE_NULL,dt.TYPE_NUMBER,dt.TYPE_OBJECT,dt.TYPE_STRING;function sB(e,t){const n=eB.parse(t);return iB.search(n,e)}const oB=(e,t)=>{const n=Eo(e.id());if(!b(n))return 0;const[r,i]=it(t,0,[H.NAME,H.NAME]),s=sB(n.json,r);return e.set(i,s),0},aB=(e,t)=>{const n=Eo(e.id());if(!b(n))return 0;const[r,i]=it(t,0,[H.NAME]);switch(It(r)){case"seek":{const[o]=it(t,i,[H.NUMBER]);n.cursor=mn(o,0,n.lines.length-1);break}case"line":n.cursor=mn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[f,d]=it(t,u,[H.NAME]);e.set(f,c[l]??0),++l,u=d}break}}return 0};function Bk(e){const t=ce($t.MAIN),n=ko(t);b(e.targetdir)?Oo(e.targetdir.destpt,e.label,void 0,n):b(e.targetname)&&Oo(e.targetname,e.label,void 0,n)}const cB=wi({get(e,t){const n=HF(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const n=Ii(t);return Bk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Bk(n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join(" ");return xe(et,w.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);return b(s.targetname)&&xe(et,w.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",aB).command("readjson",oB).command("readbin",YF).command("withboard",(e,t)=>{const[n]=it(t,0,[H.STRING]),r=un(n);return b(r)&&(w.board=r,w.element={x:-1,y:-1}),0});function Pk(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=it(i,a,[H.ANY]);ue(c)&&!nr(c)&&!Ca(c)&&!Ul(c)&&!wn(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":jE(et,w.elementfocus,e,t,n,r,o);break}return 0}const lB=wi().command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[H.NAME,H.NAME,H.MAYBE_STRING]);return Pk(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[H.ANY,H.NAME,H.NAME,H.MAYBE_STRING]);return Pk(n,r,i,s,t,o),0}).command("chat",(e,t)=>{const[n]=it(t,0,[H.MAYBE_NAME]);return n?$E(et,w.elementfocus,n):DE(et,w.elementfocus),0}).command("broadcast",(e,t)=>{const[n]=it(t,0,[H.MAYBE_NAME]);return n?BE(et,w.elementfocus,n):PE(et,w.elementfocus),0});function $k(e,t){var n,r;if(b(t.targetname))switch(t.targetname){case"all":for(const i of Object.keys(((n=w.board)==null?void 0:n.objects)??{}))e.send(w.elementfocus,i,t.label);break;case"self":e.message({session:et.session(),player:w.elementfocus,id:De(),sender:e.id(),target:t.label});break;case"others":for(const i of Object.keys(((r=w.board)==null?void 0:r.objects)??{}))i!==e.id()&&e.send(w.elementfocus,i,t.label);break;default:{const i=Sw(w.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];b(o.id)&&e.send(w.elementfocus,o.id,t.label)}break}}else if(b(t.targetdir)){const i=ie(w.board,t.targetdir.destpt);b(i==null?void 0:i.id)&&e.send(w.elementfocus,i.id,t.label)}}const uB=wi({set(e,t,n){return n$(e,t,n),[!1,void 0]},everytick(){const e=Tn(w.elementid),[t]=e;if(e.length===1&&yt(t)){if(b(w.element))if(t.trim().length===0){const n=Ye(w.elementid);n.sidebar=[]}else w.element.tickertext=t,w.element.tickertime=w.timestamp}else if(e.length>1)if(w.elementisplayer){const n=Ye(w.elementid);n.sidebar=e}else{const n=Ye(w.elementfocus);n.scroll=e}}}).command("shortsend",(e,t)=>{const n=Ii(t);return $k(e,n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return $k(e,n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join("");return Rt(w.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);return b(s.targetname)&&Mt(w.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function hB(e,t,n,r,i){if(!b(w.book))return;const s=w.book,o=en(s,bt.BOARD,e),a=Re(o);if(!b(a))return;const c=Ql(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Se(a),Se(c);const f=-Math.tan(t*.5),d=Math.sin(t),h=Math.round(12.5*f),m=Math.round(12.5*d),p=new Array(Vt).fill(0);nm(h,0,-h,Vt-1).forEach(A=>{A.x<0?p[A.y]=Math.min(p[A.y],A.x):p[A.y]=Math.max(p[A.y],A.x)});const y=new Array(St).fill(0);nm(0,m,St-1,-m).forEach(A=>{A.y<0?y[A.x]=Math.min(y[A.x],A.y):y[A.x]=Math.max(y[A.x],A.y)});const T=[p,y,p];for(let A=0;A<T.length;++A){const L=T[A];if(A!==1){for(let S=0;S<Vt;++S){const I=L[S],D=S*St;for(let N=0;N<St;N++){const W=(N+I+St)%St;u&&(c.terrain[W+D]=a.terrain[N+D])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const D=S[I],{x:N,y:W}=a.objects[D];if(b(N)&&b(W)){const q=L[W];a.objects[D].x=(N+q+St)%St,a.objects[D].lx=a.objects[D].x}}}}if(A===1){for(let S=0;S<St;++S){const I=L[S];for(let D=0;D<Vt;++D){const N=(D+I+Vt)%Vt;u&&(c.terrain[S+N*St]=a.terrain[S+D*St])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const D=S[I],{x:N,y:W}=a.objects[D];if(b(N)&&b(W)){const q=L[N];a.objects[D].y=(W+q+Vt)%Vt,a.objects[D].ly=a.objects[D].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Se(c),Se(a)}}function fB(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var dB=fB;const pB=dB,ne=function(){};ne.prototype.FMX=0,ne.prototype.FMY=0,ne.prototype.FMXxFMY=0,ne.prototype.T=0,ne.prototype.N=0,ne.prototype.initiliazedField=!1,ne.prototype.generationComplete=!1,ne.prototype.wave=null,ne.prototype.compatible=null,ne.prototype.weightLogWeights=null,ne.prototype.sumOfWeights=0,ne.prototype.sumOfWeightLogWeights=0,ne.prototype.startingEntropy=0,ne.prototype.sumsOfOnes=null,ne.prototype.sumsOfWeights=null,ne.prototype.sumsOfWeightLogWeights=null,ne.prototype.entropies=null,ne.prototype.propagator=null,ne.prototype.observed=null,ne.prototype.distribution=null,ne.prototype.stack=null,ne.prototype.stackSize=0,ne.prototype.DX=[-1,0,1,0],ne.prototype.DY=[0,1,0,-1],ne.prototype.opposite=[2,3,0,1],ne.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},ne.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=pB(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},ne.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],m=f[h];m[i]--,m[i]==0&&this.ban(l,h)}}}},ne.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},ne.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},ne.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},ne.prototype.isGenerationComplete=function(){return this.generationComplete},ne.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},ne.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Dk=ne;const jk=Dk,Ci=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let N=0;N<f;N++)d[N]=new Array(r);this.colors=[];const h={};for(let N=0;N<r;N++)for(let W=0;W<n;W++){const q=(N*n+W)*4,M=[t[q],t[q+1],t[q+2],t[q+3]],O=M.join("-");h.hasOwnProperty(O)||(h[O]=this.colors.length,this.colors.push(M)),d[W][N]=h[O]}const m=this.colors.length,p=Math.pow(m,i*i),k=function(W){let q=new Array(i*i);for(let M=0;M<i;M++)for(let O=0;O<i;O++)q[O+M*i]=W(O,M);return q},y=function(W,q){return k(function(M,O){return d[(W+M)%n][(q+O)%r]})},v=function(W){return k(function(q,M){return W[i-1-M+q*i]})},T=function(W){return k(function(q,M){return W[i-1-q+M*i]})},A=function(W){let q=0,M=1;for(let O=0;O<W.length;O++)q+=W[W.length-1-O]*M,M*=m;return q},L=function(W){let q=W,M=p;const O=new Array(i*i);for(let E=0;E<O.length;E++){M/=m;let C=0;for(;q>=M;)q-=M,C++;O[E]=C}return O},S={},I=[];for(let N=0;N<(a?r:r-i+1);N++)for(let W=0;W<(a?n:n-i+1);W++){const q=new Array(8);q[0]=y(W,N),q[1]=T(q[0]),q[2]=v(q[0]),q[3]=T(q[2]),q[4]=v(q[2]),q[5]=T(q[4]),q[6]=v(q[4]),q[7]=T(q[6]);for(let M=0;M<l;M++){const O=A(q[M]);S[O]?S[O]++:(I.push(O),S[O]=1)}}this.T=I.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const W=parseInt(I[N],10);this.patterns[N]=L(W),this.weights[N]=S[W]}const D=function(W,q,M,O){const E=M<0?0:M,C=M<0?M+i:i,$=O<0?0:O,B=O<0?O+i:i;for(let st=$;st<B;st++)for(let Q=E;Q<C;Q++)if(W[Q+i*st]!=q[Q-M+i*(st-O)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let W=0;W<this.T;W++){const q=[];for(let M=0;M<this.T;M++)D(this.patterns[W],this.patterns[M],this.DX[N],this.DY[N])&&q.push(M);this.propagator[N][W]=q}}};Ci.prototype=Object.create(jk.prototype),Ci.prototype.constructor=Ci,Ci.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ci.prototype.clear=function(){if(jk.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ci.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ci.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ci.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const m=d+h*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const k=this.colors[this.patterns[p][f+u*this.N]];s+=k[0],o+=k[1],a+=k[2],c+=k[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var mB=Ci;const gB=Dk,Ji=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(A){const L=new Array(o*o);for(let S=0;S<o;S++)for(let I=0;I<o;I++)L[I+S*o]=A(I,S);return L},u=function(A){return l(function(L,S){return A[o-1-S+L*o]})},f=function(A){return l(function(L,S){return A[o-1-L+S*o]})};this.tiles=[];const d=[],h=[],m={};let p,k,y;for(let T=0;T<t.tiles.length;T++){const A=t.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":y=4,p=function(S){return(S+1)%4},k=function(S){return S%2===0?S+1:S-1};break;case"T":y=4,p=function(S){return(S+1)%4},k=function(S){return S%2===0?S:4-S};break;case"I":y=2,p=function(S){return 1-S},k=function(S){return S};break;case"\\":y=2,p=function(S){return 1-S},k=function(S){return 1-S};break;case"F":y=8,p=function(S){return S<4?(S+1)%4:4+(S-1)%4},k=function(S){return S<4?S+4:S-4};break;default:y=1,p=function(S){return S},k=function(S){return S};break}this.T=h.length,m[A.name]=this.T;for(let S=0;S<y;S++)h.push([this.T+S,this.T+p(S),this.T+p(p(S)),this.T+p(p(p(S))),this.T+k(S),this.T+k(p(S)),this.T+k(p(p(S))),this.T+k(p(p(p(S))))]);let L;if(a)for(let S=0;S<y;S++)L=A.bitmap[S],this.tiles.push(l(function(I,D){return[L[(o*D+I)*4],L[(o*D+I)*4+1],L[(o*D+I)*4+2],L[(o*D+I)*4+3]]}));else{L=A.bitmap,this.tiles.push(l(function(S,I){return[L[(o*I+S)*4],L[(o*I+S)*4+1],L[(o*I+S)*4+2],L[(o*I+S)*4+3]]}));for(let S=1;S<y;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):f(this.tiles[this.T+S-4]))}for(let S=0;S<y;S++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const v=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),v[T]=new Array(this.T);for(let A=0;A<this.T;A++){v[T][A]=new Array(this.T);for(let L=0;L<this.T;L++)v[T][A][L]=!1}}for(let T=0;T<t.neighbors.length;T++){const A=t.neighbors[T],L=A.left.split(" ").filter(function(q){return q.length}),S=A.right.split(" ").filter(function(q){return q.length});if(c!==null&&(c.indexOf(L[0])===-1||c.indexOf(S[0])===-1))continue;const I=h[m[L[0]]][L.length==1?0:parseInt(L[1],10)],D=h[I][1],N=h[m[S[0]]][S.length==1?0:parseInt(S[1],10)],W=h[N][1];v[0][N][I]=!0,v[0][h[N][6]][h[I][6]]=!0,v[0][h[I][4]][h[N][4]]=!0,v[0][h[I][2]][h[N][2]]=!0,v[1][W][D]=!0,v[1][h[D][6]][h[W][6]]=!0,v[1][h[W][4]][h[D][4]]=!0,v[1][h[D][2]][h[W][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)v[2][T][A]=v[0][A][T],v[3][T][A]=v[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const L=[],S=v[T][A];for(let I=0;I<this.T;I++)S[I]&&L.push(I);this.propagator[T][A]=L}};Ji.prototype=Object.create(gB.prototype),Ji.prototype.constructor=Ji,Ji.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Ji.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Ji.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Ji.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let f=0,d=0,h=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const k=this.tiles[p][l+c*this.tilesize],y=this.weights[p]*a;f+=k[0]*y,d+=k[1]*y,h+=k[2]*y,m+=k[3]*y}e[u]=f,e[u+1]=d,e[u+2]=h,e[u+3]=m}}}};var _B=Ji,yB={OverlappingModel:mB,SimpleTiledModel:_B},bB=Fs(yB);const zk=5;function Wk(e,t,n,r,i,s,o){if(!b(w.book))return!1;const a=w.book,c=en(a,bt.BOARD,e),l=en(a,bt.BOARD,t),u=Re(c),f=Re(l);if(!b(u)||!b(f))return!1;Se(u),Se(f);let d=0;const h=new Map,m=new Map;let p=0;const k=32,y=new Uint8Array(Ah*4);for(let I=0;I<Vt;++I)for(let D=0;D<St;++D){const N=ie(f,{x:D,y:I}),W=(N==null?void 0:N.char)??0,q=(N==null?void 0:N.color)??k,M=(N==null?void 0:N.bg)??k;y[p++]=W,y[p++]=q,y[p++]=M;const O=$r(N),E=It((O==null?void 0:O.name)??"empty"),C=h.get(E);xt(C)?y[p++]=C:(h.set(E,d),m.set(d,E),y[p++]=d++)}const v=s.x-i.x+1,T=s.y-i.y+1,A=new bB.OverlappingModel(y,St,Vt,n,v,T,!1,!1,r,0);let L=0;for(;L<zk&&!A.generate();++L);if(L===zk)return!1;p=0;const S=A.graphics();for(let I=i.y;I<=s.y;++I)for(let D=i.x;D<=s.x;++D){const N={x:D,y:I},W=S[p++],q=S[p++],M=S[p++];switch(d=S[p++],o){case"all":{const $=ie(u,{x:D,y:I});Ge($)&&vn(u,$,a.timestamp),Oe(u,{x:D,y:I});break}case"object":{const $=ie(u,{x:D,y:I});Ge($)&&vn(u,$,a.timestamp);break}case"terrain":Oe(u,{x:D,y:I});break}let O=m.get(d)??"";const E=$r({kind:O});switch(o){case"all":break;case"object":Ge(E)||(O="");break;case"terrain":Ge(E)&&(O="");break;default:if(Gt(E,"group")!==o&&(O=""),O){const $=ie(u,{x:D,y:I});Ge($)&&vn(u,$,a.timestamp),Oe(u,{x:D,y:I})}break}const C=O?Dr(u,[O],N):void 0;if(!(!b(C)||!b(E))&&(yo(C,E),W>0&&(C.char=W),q<k&&(C.color=q),M<k&&(C.bg=M),Ge(C))){const $=An(ja(f,O));b($)&&(Oe(u,{...ns(f,$.x??0,$.y??0),x:D,y:I}),yo(C,$))}}return!0}function Gk(e){return`zss_snapshot_${e}`}const Kk={x:0,y:0},Hk={x:St-1,y:Vt-1},Yk="all";function kB(e){const t=en(w.book,bt.BOARD,e),n=Re(t);if(!b(n))return;const r=Gk(n.id);pk(w.book,r);const[i]=ts($t.MAIN,r,bt.BOARD),s=Re(i);if(b(s))return Il(e,s.id,Kk,Hk,Yk),s}function wB(e){const t=en(w.book,bt.BOARD,e),n=Re(t);if(!b(n))return;const r=Gk(n.id),i=en(w.book,bt.BOARD,r),s=Re(i);if(b(s))return Il(s.id,e,Kk,Hk,Yk),s}function EB(e,t,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return xB(e,t,i,s)}if(!b(w.book))return;const o=w.book,a=en(o,bt.BOARD,e),c=Re(a);if(!b(c))return;const l=Ql();Se(c);for(let u=n.y;u<=r.y;++u)for(let f=n.x;f<=r.x;++f){let d=!1,h=!1;switch(s){case"all":d=!0,h=!0;break;case"object":d=!0;break;case"terrain":h=!0;break}const m=(f+t.x+St)%St,p=(u+t.y+Vt)%Vt;if(d){const k=ie(c,{x:f,y:u});Ge(k)&&b(k==null?void 0:k.x)&&b(k==null?void 0:k.y)&&(k.x=m,k.lx=m,k.y=p,k.ly=p)}h&&(l.terrain[m+p*St]=c.terrain[f+u*St])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),oa(c)}function xB(e,t,n,r){if(!b(w.book))return;const i=w.book,s=en(i,bt.BOARD,e),o=Re(s);if(!b(o))return;Se(o);const{terrainelements:a,objectelements:c}=tg(o,n,r);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>hr({x:p.x??0,y:p.y??0},St)),f=[],d=[];for(let p=0;p<a.length;++p){const k=a[p],y={x:k.x??-1,y:k.y??-1},v=ie(o,y);b(v)&&Ge(v)&&(f.push(v.id??""),f.push(v.id??""),d.push(hr({x:v.x??0,y:v.y??0},St)))}let h=!1;for(let p=0;p<a.length;++p){const k=a[p],y=Gt(k,"collision"),v={x:k.x??-1,y:k.y??-1},T=hr(v,St),A={x:v.x+t.x,y:v.y+t.y};if(tu(A)){const L=ie(o,A),S=(L==null?void 0:L.id)??"",I=hr({x:(L==null?void 0:L.x)??0,y:(L==null?void 0:L.y)??0},St),D=Gt(L,"collision");if(b(L)&&Ge(L)&&f.includes(S)!==!0&&l.includes(S)!==!0){let N=!1;const W=d.includes(T),q=W?ie(o,v):void 0,M=W?Gt(q,"pushable"):!1,O=W&&M;if(Gt(L,"pushable")&&(y!==Wt.ISWALK||W)){let E=W;b(q)&&M&&(h=es(i,o,q,{x:(q.x??0)-t.x,y:(q.y??0)-t.y})!==!0,h||(E=!1)),(E||y!==Wt.ISWALK)&&(h=es(i,o,L,{x:(L.x??0)+t.x,y:(L.y??0)+t.y})!==!0,h&&(N=O))}else(y!==Wt.ISWALK||O)&&(h=!0,N=O);N&&b(q)&&(h=es(i,o,q,{x:(q.x??0)-t.x,y:(q.y??0)-t.y})!==!0)}else D===Wt.ISSOLID&&u.includes(I)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const k=c[p],y=Gt(k,"collision"),v={x:k.x??0,y:k.y??0},T={x:v.x+t.x,y:v.y+t.y};if(tu(T)){const A=ie(o,T),L=(A==null?void 0:A.id)??"",S=Gt(A,"collision"),I=Gt(A,"group");b(A)&&Ge(A)&&f.includes(L)&&l.includes(L)!==!0?Gt(A,"pushable")?h=es(i,o,A,T)!==!0:h=!0:$a(y,S)&&r!==I&&(h=!0)}else h=!0}if(h)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const k=a[p],y={x:k.x??-1,y:k.y??-1},v={x:y.x+t.x,y:y.y+t.y},T=ns(o,v.x,v.y);if(b(k)&&b(T)){Oe(o,{...k,x:v.x,y:v.y}),Oe(o,{...T,x:y.x,y:y.y});const A=ie(o,y);Ge(A)&&b(A)&&(A.x=(A.x??0)+t.x,A.y=(A.y??0)+t.y,A.lx=(A.lx??0)+t.x,A.ly=(A.ly??0)+t.y)}}oa(o);for(let p=0;p<c.length;++p){const k=c[p],y={x:k.x??-1,y:k.y??-1},v={x:y.x+t.x,y:y.y+t.y};if(!es(i,o,k,v))break}oa(o)}function $l(e,t){let n="all";const r={x:0,y:0},i={x:St-1,y:Vt-1};for(let s=t;s<e.length;){const[o,a]=it(e,s,[H.MAYBE_NUMBER_OR_STRING]);if(yt(o))n=It(o),s=a;else if(xt(o)){const[c,l,u,f]=it(e,a,[H.NUMBER,H.MAYBE_NUMBER,H.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const vB=wi().command("snapshot",()=>(!b(w.book)||!b(w.board)||kB(w.board.id),0)).command("revert",()=>(!b(w.book)||!b(w.board)||wB(w.board.id),0)).command("copy",(e,t)=>{if(!b(w.book)||!b(w.board))return 0;const[n,r]=it(t,0,[H.STRING]),i=bookreadcodepagesbytypeandstat(w.book,bt.BOARD,n),s=An(...i);if(b(s)){const o=$l(t,r);Il(s.id,w.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!b(w.book)||!b(w.board))return 0;const[n,r,i,s]=it(t,0,[H.STRING,H.NUMBER,H.NUMBER]),o=bookreadcodepagesbytypeandstat(w.book,bt.BOARD,n),a=An(...o);if(b(a)){const c=$l(t,s);Wk(w.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!b(w.book)||!b(w.board))return 0;const[n,r]=it(t,0,[H.DIR]),i={x:n.destpt.x-(((o=w.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=w.element)==null?void 0:a.y)??0)},s=$l(t,r);return EB(w.board.id,i,s.pt1,s.pt2,w.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!b(w.book)||!b(w.board))return 0;const[n,r]=it(t,0,[H.NUMBER]),i=$l(t,r);return hB(w.board.id,lm(n),i.pt1,i.pt2,i.targetset),0});var Zi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Zi||{});const TB={audio:Rh,board:UU,cli:UF,display:FF,element:GF,runtime:uB,loader:cB,network:lB,transform:vB},pd=["audio","board","display","network","transform","element"],AB={0:[],1:["cli",...pd],2:["loader",...pd],3:["runtime",...pd]},SB={0:new Map,1:new Map,2:new Map,3:new Map};function vo(e){return(AB[e]??[]).map(n=>TB[n]).filter(b)}function md(e){const t=[],n=vo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function RB(e,t){const n=SB[e];if(!n.has(t)){let r;const i=vo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!b(r));++s);n.set(t,r)}return n.get(t)}function OB(e,t,n){const r=vo(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function NB(e,t,n,r){const i=vo(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function IB(e,t){const n=vo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function Vk(e,t){const n=vo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var Xk={},qk={},Jk={};const Zk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Jk.encode=function(e){if(0<=e&&e<Zk.length)return Zk[e];throw new TypeError("Must be between 0 and 63: "+e)};const CB=Jk,Qk=5,tw=1<<Qk,LB=tw-1,MB=tw;function UB(e){return e<0?(-e<<1)+1:(e<<1)+0}qk.encode=function(t){let n="",r,i=UB(t);do r=i&LB,i>>>=Qk,i>0&&(r|=MB),n+=CB.encode(r);while(i>0);return n};var La={};(function(e){function t(S,I,D){if(I in S)return S[I];if(arguments.length===3)return D;throw new Error('"'+I+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const I=S.match(n);return I?{scheme:I[1],auth:I[2],host:I[3],port:I[4],path:I[5]}:null}e.urlParse=i;function s(S){let I="";return S.scheme&&(I+=S.scheme+":"),I+="//",S.auth&&(I+=S.auth+"@"),S.host&&(I+=S.host),S.port&&(I+=":"+S.port),S.path&&(I+=S.path),I}e.urlGenerate=s;const o=32;function a(S){const I=[];return function(D){for(let W=0;W<I.length;W++)if(I[W].input===D){const q=I[0];return I[0]=I[W],I[W]=q,I[0].result}const N=S(D);return I.unshift({input:D,result:N}),I.length>o&&I.pop(),N}}const c=a(function(I){let D=I;const N=i(I);if(N){if(!N.path)return I;D=N.path}const W=e.isAbsolute(D),q=[];let M=0,O=0;for(;;)if(M=O,O=D.indexOf("/",M),O===-1){q.push(D.slice(M));break}else for(q.push(D.slice(M,O));O<D.length&&D[O]==="/";)O++;let E=0;for(O=q.length-1;O>=0;O--){const C=q[O];C==="."?q.splice(O,1):C===".."?E++:E>0&&(C===""?(q.splice(O+1,E),E=0):(q.splice(O,2),E--))}return D=q.join("/"),D===""&&(D=W?"/":"."),N?(N.path=D,s(N)):D});e.normalize=c;function l(S,I){S===""&&(S="."),I===""&&(I=".");const D=i(I),N=i(S);if(N&&(S=N.path||"/"),D&&!D.scheme)return N&&(D.scheme=N.scheme),s(D);if(D||I.match(r))return I;if(N&&!N.host&&!N.path)return N.host=I,s(N);const W=I.charAt(0)==="/"?I:c(S.replace(/\/+$/,"")+"/"+I);return N?(N.path=W,s(N)):W}e.join=l,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function u(S,I){S===""&&(S="."),S=S.replace(/\/$/,"");let D=0;for(;I.indexOf(S+"/")!==0;){const N=S.lastIndexOf("/");if(N<0||(S=S.slice(0,N),S.match(/^([^\/]+:\/)?\/*$/)))return I;++D}return Array(D+1).join("../")+I.substr(S.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function h(S){return p(S)?"$"+S:S}e.toSetString=f?d:h;function m(S){return p(S)?S.slice(1):S}e.fromSetString=f?d:m;function p(S){if(!S)return!1;const I=S.length;if(I<9||S.charCodeAt(I-1)!==95||S.charCodeAt(I-2)!==95||S.charCodeAt(I-3)!==111||S.charCodeAt(I-4)!==116||S.charCodeAt(I-5)!==111||S.charCodeAt(I-6)!==114||S.charCodeAt(I-7)!==112||S.charCodeAt(I-8)!==95||S.charCodeAt(I-9)!==95)return!1;for(let D=I-10;D>=0;D--)if(S.charCodeAt(D)!==36)return!1;return!0}function k(S,I,D){let N=v(S.source,I.source);return N!==0||(N=S.originalLine-I.originalLine,N!==0)||(N=S.originalColumn-I.originalColumn,N!==0||D)||(N=S.generatedColumn-I.generatedColumn,N!==0)||(N=S.generatedLine-I.generatedLine,N!==0)?N:v(S.name,I.name)}e.compareByOriginalPositions=k;function y(S,I,D){let N=S.generatedLine-I.generatedLine;return N!==0||(N=S.generatedColumn-I.generatedColumn,N!==0||D)||(N=v(S.source,I.source),N!==0)||(N=S.originalLine-I.originalLine,N!==0)||(N=S.originalColumn-I.originalColumn,N!==0)?N:v(S.name,I.name)}e.compareByGeneratedPositionsDeflated=y;function v(S,I){return S===I?0:S===null?1:I===null?-1:S>I?1:-1}function T(S,I){let D=S.generatedLine-I.generatedLine;return D!==0||(D=S.generatedColumn-I.generatedColumn,D!==0)||(D=v(S.source,I.source),D!==0)||(D=S.originalLine-I.originalLine,D!==0)||(D=S.originalColumn-I.originalColumn,D!==0)?D:v(S.name,I.name)}e.compareByGeneratedPositionsInflated=T;function A(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=A;function L(S,I,D){if(I=I||"",S&&(S[S.length-1]!=="/"&&I[0]!=="/"&&(S+="/"),I=S+I),D){const N=i(D);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const W=N.path.lastIndexOf("/");W>=0&&(N.path=N.path.substring(0,W+1))}I=l(s(N),I)}return c(I)}e.computeSourceURL=L})(La);var gd={};let FB=class Jw{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new Jw;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};gd.ArraySet=FB;var ew={};const nw=La;function BB(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||nw.compareByGeneratedPositionsInflated(e,t)<=0}let PB=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){BB(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(nw.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};ew.MappingList=PB;const Ma=qk,qe=La,Dl=gd.ArraySet,$B=ew.MappingList;let rw=class Zw{constructor(t){t||(t={}),this._file=qe.getArg(t,"file",null),this._sourceRoot=qe.getArg(t,"sourceRoot",null),this._skipValidation=qe.getArg(t,"skipValidation",!1),this._sources=new Dl,this._names=new Dl,this._mappings=new $B,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new Zw({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=qe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=qe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=qe.getArg(t,"generated"),r=qe.getArg(t,"original",null);let i=qe.getArg(t,"source",null),s=qe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=qe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[qe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[qe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=qe.relative(s,i));const o=this._mappings.toArray().length>0?new Dl:this._sources,a=new Dl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=qe.join(r,c.source)),s!=null&&(c.source=qe.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=qe.join(r,c)),s!=null&&(c=qe.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,m=d.length;h<m;h++){if(l=d[h],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!qe.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Ma.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Ma.encode(f-o),o=f,c+=Ma.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Ma.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Ma.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=qe.relative(n,r));const i=qe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};rw.prototype._version=3,Xk.SourceMapGenerator=rw;var iw={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(iw);var Ua={exports:{}},DB={},jB=Object.freeze({__proto__:null,default:DB}),sw=Qw(jB);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Ua.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Ua.exports.initialize=t=>e=t}else{const e=sw,t=sw;Ua.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Ua.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var ow=Ua.exports;const zB=ow;function WB(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Fa=null;var GB=function(){if(Fa)return Fa;const t=[];return Fa=zB().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new WB;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Fa=null,n}),Fa};const Ot=La,_d=iw,jl=gd.ArraySet,KB=ow,HB=GB,yd=Symbol("smcInternal");class He{constructor(t,n){return t==yd?Promise.resolve(this):VB(t,n)}static initialize(t){KB.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return XB(t,n)}static async with(t,n,r){const i=await new He(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}He.prototype._version=3,He.GENERATED_ORDER=1,He.ORIGINAL_ORDER=2,He.GREATEST_LOWER_BOUND=1,He.LEAST_UPPER_BOUND=2;class Ba extends He{constructor(t,n){return super(yd).then(r=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version");let o=Ot.getArg(i,"sources");const a=Ot.getArg(i,"names",[]);let c=Ot.getArg(i,"sourceRoot",null);const l=Ot.getArg(i,"sourcesContent",null),u=Ot.getArg(i,"mappings"),f=Ot.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Ot.normalize(c)),o=o.map(String).map(Ot.normalize).map(function(d){return c&&Ot.isAbsolute(c)&&Ot.isAbsolute(d)?Ot.relative(c,d):d}),r._names=jl.fromArray(a.map(String),!0),r._sources=jl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return Ot.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,HB().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Ot.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ba(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||He.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Ot.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case He.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case He.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Ot.getArg(t,"source");const r=Ot.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Ot.getArg(t,"bias",He.GREATEST_LOWER_BOUND);r==null&&(r=He.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Ot.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Ot.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Ot.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Ot.getArg(i,"originalLine",null),column:Ot.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Ot.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Ot.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Ot.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Ot.getArg(t,"line"),originalColumn:Ot.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Ot.getArg(t,"bias",He.GREATEST_LOWER_BOUND);i==null&&(i=He.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Ot.getArg(s,"generatedLine",null),column:Ot.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ba.prototype.consumer=He;class YB extends He{constructor(t,n){return super(yd).then(r=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version"),o=Ot.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new jl,r._names=new jl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Ot.getArg(c,"offset"),u=Ot.getArg(l,"line"),f=Ot.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new He(Ot.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Ot.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Ot.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")},r=_d.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Ot.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Ot.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||He.GENERATED_ORDER;let o;switch(s){case He.GENERATED_ORDER:o=this._generatedMappings;break;case He.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Ot.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return _d.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Ot.getArg(t,"line"),r={source:Ot.getArg(t,"source"),originalLine:n,originalColumn:Ot.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Ot.compareByOriginalPositions,_d.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function VB(e,t){let n=e;typeof e=="string"&&(n=Ot.parseSourceMapInput(e));const r=n.sections!=null?new YB(n,t):new Ba(n,t);return Promise.resolve(r)}function XB(e,t){return Ba.fromSourceMap(e,t)}var aw={};const qB=Xk.SourceMapGenerator,zl=La,JB=/(\r?\n)/,ZB=10,To="$$$isSourceNode$$$";let QB=class $d{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[To]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new $d,s=t.split(JB);let o=0;const a=function(){const h=p(),m=p()||"";return h+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const m=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,m),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const m=n.sourceContentFor(h);m!=null&&(r!=null&&(h=zl.join(r,h)),i.setSourceContent(h,m))}),i;function d(h,m){if(h===null||h.source===void 0)i.add(m);else{const p=r?zl.join(r,h.source):h.source;i.add(new $d(h.originalLine,h.originalColumn,p,m,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[To]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[To]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[To]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[To]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[zl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][To]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(zl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new qB(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===ZB?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};aw.SourceNode=QB;var tP=aw.SourceNode;let cw=0;const lw=Jr,eP=["Command","lines"];class nP extends HM{constructor(){super(ik,{traceInitPerf:Jr,skipValidations:!Jr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Et(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Et(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Sa)}])}));Et(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Et(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Et(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Bf)}));Et(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Ff)}));Et(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Sy)}])}));Et(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Ry)}));Et(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Oy),this.OPTION(()=>{this.SUBRULE(this.words)}),this.CONSUME(Ny)}));Et(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(_o),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Et(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Et(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Gf),this.SUBRULE(this.words)}));Et(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(K1),this.SUBRULE(this.words)}));Et(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Kf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Et(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ol),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Sa)),this.CONSUME4(_o),this.CONSUME4(Hf)}}])}));Et(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ol),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(_o),this.CONSUME(Hf)}}])}));Et(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ol),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Et(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(_o),this.CONSUME(Yf),this.CONSUME(Kf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Et(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(_o),this.CONSUME(Yf),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));Et(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(J1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Et(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(Z1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Et(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Q1),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Et(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(tk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Et(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(ek)}));Et(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(nk)}));Et(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(V1)}));Et(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(X1)}));Et(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(q1)}));Et(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME($f),this.SUBRULE2(this.and_test)})}));Et(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(jf),this.SUBRULE2(this.not_test)})}));Et(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Df),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Et(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Et(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(U1)},{ALT:()=>this.CONSUME(F1)},{ALT:()=>this.CONSUME(B1)},{ALT:()=>this.CONSUME(P1)},{ALT:()=>this.CONSUME($1)},{ALT:()=>this.CONSUME(D1)}])}));Et(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME($f),this.SUBRULE2(this.and_test_value)})}));Et(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(jf),this.SUBRULE2(this.not_test_value)})}));Et(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Df),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Et(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Et(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(zf)},{ALT:()=>this.CONSUME(Wf)}]),this.SUBRULE(this.term)}));Et(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Et(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(z1)},{ALT:()=>this.CONSUME(Gf)},{ALT:()=>this.CONSUME(W1)},{ALT:()=>this.CONSUME(G1)}]),this.SUBRULE(this.factor)}));Et(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(zf)},{ALT:()=>this.CONSUME(Wf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Et(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(j1),this.SUBRULE(this.factor)})}));Et(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Et(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));Et(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(Iy)},{ALT:()=>this.CONSUME(Cy)}])}));Et(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(Ly)},{ALT:()=>this.CONSUME(My)},{ALT:()=>this.CONSUME(Uy)},{ALT:()=>this.CONSUME(Fy)},{ALT:()=>this.CONSUME(By)},{ALT:()=>this.CONSUME(Py)},{ALT:()=>this.CONSUME($y)},{ALT:()=>this.CONSUME(Dy)}])}));Et(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(jy)},{ALT:()=>this.CONSUME(zy)},{ALT:()=>this.CONSUME(Wy)},{ALT:()=>this.CONSUME(Gy)},{ALT:()=>this.CONSUME(Ky)},{ALT:()=>this.CONSUME(Hy)},{ALT:()=>this.CONSUME(Yy)},{ALT:()=>this.CONSUME(Vy)},{ALT:()=>this.CONSUME(Xy)},{ALT:()=>this.CONSUME(qy)},{ALT:()=>this.CONSUME(Jy)},{ALT:()=>this.CONSUME(Zy)},{ALT:()=>this.CONSUME(Qy)},{ALT:()=>this.CONSUME(tb)},{ALT:()=>this.CONSUME(eb)},{ALT:()=>this.CONSUME(nb)},{ALT:()=>this.CONSUME(rb)},{ALT:()=>this.CONSUME(ib)},{ALT:()=>this.CONSUME(sb)},{ALT:()=>this.CONSUME(ob)},{ALT:()=>this.CONSUME(ab)},{ALT:()=>this.CONSUME(cb)},{ALT:()=>this.CONSUME(lb)},{ALT:()=>this.CONSUME(ub)},{ALT:()=>this.CONSUME(hb)},{ALT:()=>this.CONSUME(fb)},{ALT:()=>this.CONSUME(db)},{ALT:()=>this.CONSUME(pb)},{ALT:()=>this.CONSUME(mb)},{ALT:()=>this.CONSUME(gb)},{ALT:()=>this.CONSUME(_b)},{ALT:()=>this.CONSUME(yb)},{ALT:()=>this.CONSUME(bb)},{ALT:()=>this.CONSUME(kb)},{ALT:()=>this.CONSUME(wb)},{ALT:()=>this.CONSUME(Eb)},{ALT:()=>this.CONSUME(xb)},{ALT:()=>this.CONSUME(vb)},{ALT:()=>this.CONSUME(Tb)},{ALT:()=>this.CONSUME(Ab)},{ALT:()=>this.CONSUME(Sb)},{ALT:()=>this.CONSUME(Rb)},{ALT:()=>this.CONSUME(Ob)},{ALT:()=>this.CONSUME(Nb)},{ALT:()=>this.CONSUME(Ib)},{ALT:()=>this.CONSUME(Cb)},{ALT:()=>this.CONSUME(Lb)}])}));Et(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Hb)},{ALT:()=>this.CONSUME(Yb)},{ALT:()=>this.CONSUME(Vb)},{ALT:()=>this.CONSUME(Xb)},{ALT:()=>this.CONSUME(p1)},{ALT:()=>this.CONSUME(m1)}])}));Et(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(Mb)},{ALT:()=>this.CONSUME(Ub)},{ALT:()=>this.CONSUME(Fb)},{ALT:()=>this.CONSUME(Bb)},{ALT:()=>this.CONSUME(Pb)},{ALT:()=>{this.CONSUME($b),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}},{ALT:()=>{this.CONSUME(Db),this.SUBRULE3(this.simple_token),this.SUBRULE4(this.simple_token)}},{ALT:()=>{this.CONSUME(qb),this.SUBRULE5(this.simple_token),this.SUBRULE6(this.simple_token)}},{ALT:()=>{this.CONSUME(Jb),this.SUBRULE7(this.simple_token),this.SUBRULE8(this.simple_token)}},{ALT:()=>this.CONSUME(jb)},{ALT:()=>this.CONSUME(zb)},{ALT:()=>this.CONSUME(Wb)},{ALT:()=>this.CONSUME(Gb)},{ALT:()=>this.CONSUME(Kb)},{ALT:()=>{this.CONSUME(Zb),this.SUBRULE1(this.kind)}},{ALT:()=>{this.CONSUME(Qb),this.SUBRULE2(this.kind)}},{ALT:()=>{this.CONSUME(t1),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}},{ALT:()=>this.CONSUME(e1)},{ALT:()=>this.CONSUME(n1)},{ALT:()=>this.CONSUME(r1)},{ALT:()=>this.CONSUME(i1)},{ALT:()=>this.CONSUME(s1)},{ALT:()=>this.CONSUME(o1)},{ALT:()=>this.CONSUME(a1)},{ALT:()=>this.CONSUME(c1)},{ALT:()=>this.CONSUME(l1)},{ALT:()=>this.CONSUME(u1)},{ALT:()=>this.CONSUME(h1)},{ALT:()=>this.CONSUME(f1)},{ALT:()=>this.CONSUME(d1)}])}));Et(this,"expr_any",this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])}));Et(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(b1),this.SUBRULE(this.expr_any)}));Et(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(k1),this.SUBRULE(this.expr_any)}));Et(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(w1),this.SUBRULE(this.simple_token)}));Et(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(E1),this.SUBRULE(this.simple_token)}));Et(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(x1),this.SUBRULE(this.simple_token)}));Et(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(v1),this.SUBRULE(this.simple_token)}));Et(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(T1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));Et(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(A1),this.SUBRULE(this.simple_tokens)}));Et(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(S1),this.SUBRULE(this.simple_tokens)}));Et(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(R1),this.SUBRULE(this.simple_tokens)}));Et(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME(O1),this.SUBRULE(this.simple_token),this.SUBRULE(this.simple_tokens)}));Et(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(N1),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));Et(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(I1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));Et(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME(C1),this.SUBRULE(this.string_token)}));Et(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(L1),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));Et(this,"token_expr",this.RULED("token_expr",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(g1)},{ALT:()=>this.CONSUME(_1)},{ALT:()=>this.CONSUME(y1)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])})}));Et(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Rl)}])}));Et(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(Pf)},{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Rl)}])}));Et(this,"simple_tokens",this.RULED("simple_tokens",()=>{this.AT_LEAST_ONE(this.simple_token)}));Et(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.token_expr)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(Bf)},{ALT:()=>this.CONSUME(Rl)},{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Pf)},{ALT:()=>this.CONSUME(M1)},{ALT:()=>{this.CONSUME(H1),this.SUBRULE(this.expr),this.CONSUME(Y1)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=eP.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(cw++).toString().padStart(3),c=s?"font-weight: bold;":"";if(lw&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),lw&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),cw--},i)}}const Ao=new nP;if(iS){const e=Ao.getGAstProductions(),t=iU(e);console.info(t)}const rP=Ao.getBaseCstVisitorConstructor();var wt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(wt||{}),Cs=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Cs||{}),li=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(li||{}),Wl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Wl||{});function Nt(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class iP extends rP{constructor(){super();Et(this,"unique",0);Jr&&this.validateVisitor()}visit(n){if(ue(n)&&(n=n[0]),!!b(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createtemplatenode(n,r){return this.createcodenode(n,{type:12,literal:2,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():b(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.stmt_command?this.go(n.stmt_command):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}inline(n){return n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.stmt_command?this.go(n.stmt_command):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.structured_cmd?this.go(n.structured_cmd):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Nt(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Nt(n.token_stat,"@").slice(1)}))}stmt_text(n,r){const i=Nt(n.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:i}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Nt(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:Nt(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n,r){return n.structured_cmd?this.go(n.structured_cmd):this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,Nt(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=De(),s=De();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=De(),s=De();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,Nt(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){const i=[];return n.words&&i.push(...this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))),n.command_fork&&i.push(...this.go(n.command_fork)),this.createcodenode(r,{type:17,lines:i})}command_while(n,r){const i=De(),s=De();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=De(),s=De(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=De(),s=De(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=De();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=Nt(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}command_toast(n,r){const s=Nt(n.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(r,"toast"),this.createtemplatenode(r,s)].flat()}command_ticker(n,r){const s=Nt(n.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(r,"ticker"),this.createtemplatenode(r,s)].flat()}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}kind(n){return[this.go(n.color),this.go(n.string_token)].flat()}category(n,r){if(n.token_isterrain){const i=Nt(n.token_isterrain,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isobject){const i=Nt(n.token_isobject,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}collision(n,r){if(n.token_iswalkable){const i=Nt(n.token_iswalkable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalking){const i=Nt(n.token_iswalking,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalk){const i=Nt(n.token_iswalk,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimmable){const i=Nt(n.token_isswimmable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimming){const i=Nt(n.token_isswimming,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswim){const i=Nt(n.token_isswim,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_issolid){const i=Nt(n.token_issolid,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isbullet){const i=Nt(n.token_isbullet,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}color(n,r){let i="ERROR";return n.token_black&&(i="black"),n.token_dkblue&&(i="dkblue"),n.token_dkgreen&&(i="dkgreen"),n.token_dkcyan&&(i="dkcyan"),n.token_dkred&&(i="dkred"),n.token_dkpurple&&(i="dkpurple"),n.token_dkyellow&&(i="dkyellow"),n.token_ltgray&&(i="ltgray"),n.token_dkgray&&(i="dkgray"),n.token_blue&&(i="blue"),n.token_green&&(i="green"),n.token_cyan&&(i="cyan"),n.token_red&&(i="red"),n.token_purple&&(i="purple"),n.token_yellow&&(i="yellow"),n.token_white&&(i="white"),n.token_brown&&(i="brown"),n.token_dkwhite&&(i="dkwhite"),n.token_ltgrey&&(i="ltgrey"),n.token_gray&&(i="gray"),n.token_grey&&(i="grey"),n.token_dkgrey&&(i="dkgrey"),n.token_ltblack&&(i="ltblack"),n.token_onblack&&(i="onblack"),n.token_ondkblue&&(i="ondkblue"),n.token_ondkgreen&&(i="ondkgreen"),n.token_ondkcyan&&(i="ondkcyan"),n.token_ondkred&&(i="ondkred"),n.token_ondkpurple&&(i="ondkpurple"),n.token_ondkyellow&&(i="ondkyellow"),n.token_onltgray&&(i="onltgray"),n.token_ondkgray&&(i="ondkgray"),n.token_onblue&&(i="onblue"),n.token_ongreen&&(i="ongreen"),n.token_oncyan&&(i="oncyan"),n.token_onred&&(i="onred"),n.token_onpurple&&(i="onpurple"),n.token_onyellow&&(i="onyellow"),n.token_onwhite&&(i="onwhite"),n.token_onbrown&&(i="onbrown"),n.token_ondkwhite&&(i="ondkwhite"),n.token_onltgrey&&(i="onltgrey"),n.token_ongray&&(i="ongray"),n.token_ongrey&&(i="ongrey"),n.token_ondkgrey&&(i="ondkgrey"),n.token_onltblack&&(i="onltblack"),n.token_onclear&&(i="onclear"),this.createcodenode(r,{type:12,literal:1,value:i})}dir_mod(n,r){let i="ERROR";return n.token_cw&&(i="cw"),n.token_ccw&&(i="ccw"),n.token_opp&&(i="opp"),n.token_rndp&&(i="rndp"),n.token_over&&(i="over"),n.token_under&&(i="under"),this.createcodenode(r,{type:12,literal:1,value:i})}dir(n,r){const i=this.go(n.dir_mod)??[];return n.token_i&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_i,"")})),n.token_idle&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_idle,"")})),n.token_n&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_n,"")})),n.token_u&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_u,"")})),n.token_north&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_north,"")})),n.token_up&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_up,"")})),n.token_s&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_s,"")})),n.token_d&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_d,"")})),n.token_south&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_south,"")})),n.token_down&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_down,"")})),n.token_w&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_w,"")})),n.token_l&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_l,"")})),n.token_west&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_west,"")})),n.token_e&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_e,"")})),n.token_r&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_r,"")})),n.token_east&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_east,"")})),n.token_right&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_right,"")})),n.token_rnd&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rnd"})),n.token_rndne&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rndne"})),n.token_rndns&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rndtoken_rndns"})),n.token_by&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_by,"")}),...this.go(n.simple_token)),n.token_at&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_at,"")}),...this.go(n.simple_token)),n.token_away&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_away,"")}),...this.go(n.simple_token)),n.token_toward&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_toward,"")}),...this.go(n.simple_token)),n.token_find&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_find,"")}),...this.go(n.kind)),n.token_flee&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_flee,"")}),...this.go(n.kind)),n.token_to&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_to,"")}),...this.go(n.dir)),i.flat()}expr_any(n){return[this.go(n.dir),this.go(n.kind),this.go(n.color)].flat()}token_expr_any(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"any"}),this.go(n.expr_any)].flat()}token_expr_count(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"count"}),this.go(n.expr_any)].flat()}token_expr_abs(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"abs"}),...this.go(n.simple_token)]}token_expr_intceil(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intceil"}),...this.go(n.simple_token)]}token_expr_intfloor(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intfloor"}),...this.go(n.simple_token)]}token_expr_intround(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intround"}),...this.go(n.simple_token)]}token_expr_clamp(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"clamp"}),...this.go(n.simple_token)]}token_expr_min(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"min"}),...this.go(n.simple_tokens)]}token_expr_max(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"max"}),...this.go(n.simple_tokens)]}token_expr_pick(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pick"}),...this.go(n.simple_tokens)]}token_expr_pickwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pickwith"}),...this.go(n.simple_tokens)]}token_expr_random(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"random"}),...this.go(n.simple_token)]}token_expr_randomwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"randomwith"}),...this.go(n.simple_token)]}token_expr_run(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"run"}),...this.go(n.string_token)]}token_expr_runwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"runwith"}),...this.go(n.simple_token),...this.go(n.string_token)]}token_expr(n,r){const i=[];return n.token_expr_aligned&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"aligned"})),n.token_contact&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"contact"})),n.token_blocked&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"blocked"})),n.token_expr_any?this.go(n.token_expr_any):n.token_expr_count?this.go(n.token_expr_count):n.token_expr_abs?this.go(n.token_expr_abs):n.token_expr_intceil?this.go(n.token_expr_intceil):n.token_expr_intfloor?this.go(n.token_expr_intfloor):n.token_expr_intround?this.go(n.token_expr_intround):n.token_expr_clamp?this.go(n.token_expr_clamp):n.token_expr_min?this.go(n.token_expr_min):n.token_expr_max?this.go(n.token_expr_max):n.token_expr_pick?this.go(n.token_expr_pick):n.token_expr_pickwith?this.go(n.token_expr_pickwith):n.token_expr_random?this.go(n.token_expr_random):n.token_expr_randomwith?this.go(n.token_expr_randomwith):n.token_expr_run?this.go(n.token_expr_run):n.token_expr_runwith?this.go(n.token_expr_runwith):i}string_token(n,r){if(n.token_stringliteraldouble){const i=Nt(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Nt(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}simple_token(n,r){if(n.token_stringliteraldouble){const i=Nt(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Nt(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Nt(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return[]}simple_tokens(n,r){if(n.token_stringliteraldouble){const i=Nt(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Nt(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Nt(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return[]}token(n,r){if(n.category)return this.go(n.category);if(n.collision)return this.go(n.collision);if(n.color)return this.go(n.color);if(n.dir)return this.go(n.dir);if(n.token_expr)return this.go(n.token_expr);if(n.command_play)return this.go(n.command_play);if(n.command_toast)return this.go(n.command_toast);if(n.command_ticker)return this.go(n.command_ticker);if(n.token_label){const i=Nt(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=Nt(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Nt(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Nt(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}if(n.token_lparen)return this.createcodenode(r,{type:31,words:this.go(n.expr)});if(n.token_stop){const i=Nt(n.token_stop,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}}const sP=new iP,Vn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Gl="zss.js";function re(e,t){return new tP(e.startLine??1,e.startColumn??1,Gl,t)}function bd(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function kd(e){return`'${bd(e)}'`}function wd(e){const t=ad(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===sd?`', api.get('${bd(r.image.substring(1))}'), '`:bd(r.image)).join("")}'].join('')`}function So(e){return e.filter(t=>t!==void 0).map(ae)}function uw(e){return re(e,"")}function oP(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function nn(e,t,n){return re(e,[`api.${t}(`,...oP(n,", "),")"])}function aP(e){if(e.type===wt.COMPARE&&e.compare.type===wt.COMPARE_ITEM)switch(e.compare.method){case Cs.IS_EQ:return nn(e,"isEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_NOT_EQ:return nn(e,"isNotEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_LESS_THAN:return nn(e,"isLessThan",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_GREATER_THAN:return nn(e,"isGreaterThan",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_LESS_THAN_OR_EQ:return nn(e,"isLessThanOrEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_GREATER_THAN_OR_EQ:return nn(e,"isGreaterThanOrEq",[ae(e.lhs),ae(e.rhs)])}return re(e,"")}function Ls(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ae(n),")"])}function hw(e,t,n){return e.prepend(`api.${t}(`),e.add([ae(n),")"])}function cP(e,t){if(e.type===wt.OPERATOR_ITEM)switch(e.operator){case li.PLUS:return Ls(t,"opPlus",e.rhs);case li.MINUS:return Ls(t,"opMinus",e.rhs);case li.POWER:return Ls(t,"opPower",e.rhs);case li.MULTIPLY:return Ls(t,"opMultiply",e.rhs);case li.DIVIDE:return Ls(t,"opDivide",e.rhs);case li.MOD_DIVIDE:return Ls(t,"opModDivide",e.rhs);case li.FLOOR_DIVIDE:return Ls(t,"opFloorDivide",e.rhs);case li.UNI_PLUS:return hw(t,"opUniPlus",e.rhs);case li.UNI_MINUS:return hw(t,"opUniMinus",e.rhs)}return re(e,"")}function lP(e){if(e.type===wt.OPERATOR){const t=e.lhs?ae(e.lhs):re(e,"");return e.items.forEach(n=>cP(n,t)),t}return re(e,"")}function Kl(e,t){return re(e,[nn(e,"jump",[`${t}`]),"; continue;"])}function Li(e){return Vn.linelookup[e??""]??-1}function Ed(e,t){Vn.linelookup[e]=t}function Ro(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&(i.done=n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&(i.skip=n);break;case wt.LINE:Ro(i.stmts,t,n);break}}}function fw(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&Ed(i.done,n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&Ed(i.skip,n);break;case wt.LINE:fw(i.stmts,t,n);break}}}function ae(e){var t;switch(e.type){case wt.PROGRAM:return re(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ae).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Gl}`]);case wt.API:return re(e,["  ",nn(e,e.method,So(e.words)),`;
`]);case wt.LINE:return re(e,[`case ${e.lineindex}:
`,...e.stmts.map(ae).flat(),`  break;
`]);case wt.MARK:return re(e,`  // ${e.comment}
`);case wt.GOTO:{const n=Li(e.id);return re(e,["  ",Kl(e,n),`
`])}case wt.COUNT:return re(e,`${e.index}`);case wt.LITERAL:switch(e.literal){case Wl.NUMBER:return re(e,`${e.value}`);case Wl.STRING:return re(e,kd(e.value));case Wl.TEMPLATE:return re(e,wd(e.value))}return uw(e);case wt.TEXT:return re(e,["  ",nn(e,"text",[wd(e.value)]),`;
`]);case wt.STAT:if(Vn.isfirststat){Vn.isfirststat=!1;const n=e.value.trim().split(" ").map(kd);return re(e,["  ",nn(e,"stat",n),`;
`])}return re(e,`  // skipped ${e.value}
`);case wt.LABEL:{const n=It(e.name),r=e.active?"label":"comment";Vn.labels[n]||(Vn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Vn.labels[n].push(i),re(e,`  // ${i} '${n}' ${r}
`)}case wt.HYPERLINK:return re(e,["  ",nn(e,"hyperlink",[wd(e.text),...So(e.link)]),`;
`]);case wt.MOVE:{const n=nn(e,"command",[kd("go"),So(e.words)].flat());return e.wait?re(e,["  if (",n,`) { continue; };
`]):re(e,["  ",n,`;
`])}case wt.COMMAND:return re(e,["  if (",nn(e,"command",So(e.words)),`) { continue; };
`]);case wt.IF:{const n=((t=e.block)==null?void 0:t.type)===wt.IF_BLOCK?e.block:void 0;if(b(n)){Ro([e.check],wt.IF_CHECK,n.skip);const r=re(e,ae(e.check));return n.lines.forEach(i=>r.add(ae(i))),fw(n.altlines,wt.ELSE_IF,Li(n.done)),n.altlines.forEach(i=>r.add(ae(i))),r}return re(e,ae(e.check))}case wt.IF_CHECK:{const n=Li(e.skip);return n===-1?re(e,["  ",nn(e,e.method,So(e.words)),`;
`]):re(e,["  if (!",nn(e,e.method,So(e.words)),") { ",Kl(e,n),` }
`])}case wt.ELSE_IF:case wt.ELSE:{const n=re(e,"");return e.lines.forEach(r=>n.add(ae(r))),n}case wt.WHILE:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.REPEAT:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.WAITFOR:{const n=re(e,"");return Ro(e.lines,wt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ae(r))}),n}case wt.FOREACH:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.BREAK:return re(e,["  ",Kl(e,e.goto),`
`]);case wt.CONTINUE:return re(e,["  ",Kl(e,e.goto),`
`]);case wt.OR:return nn(e,"or",e.items.map(ae));case wt.AND:return nn(e,"and",e.items.map(ae));case wt.NOT:return nn(e,"not",e.items.map(ae));case wt.COMPARE:return aP(e);case wt.OPERATOR:return lP(e);case wt.EXPR:return nn(e,"expr",e.words.map(ae));default:return console.error("<unsupported node>",e.type,e),uw(e)}}function ui(e){if(b(e))switch(e.type===wt.LINE&&++Vn.lineindex,e.lineindex=Vn.lineindex,e.type){case wt.PROGRAM:e.lines.forEach(ui);break;case wt.LINE:e.stmts.forEach(ui);break;case wt.MARK:Ed(e.id,e.lineindex);break;case wt.IF:ui(e.check),ui(e.block);break;case wt.IF_BLOCK:e.lines.forEach(ui),e.altlines.forEach(ui);break;case wt.ELSE_IF:e.lines.forEach(ui);break;case wt.ELSE:case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.WAITFOR:e.lines.forEach(ui);break;case wt.MOVE:case wt.COMMAND:case wt.IF_CHECK:e.words.forEach(ui);break}}function uP(e){Vn.labels={},Vn.internal=1,Vn.lineindex=0,Vn.isfirststat=!0,ui(e)}function hP(e){return uP(e),{...ae(e).toStringWithSourceMap({file:`${Gl}.map`}),...Vn}}function dw(e){return ue(e)?e.length>0?1:0:e??0}function fP(e){return`${e}_chip`}function pw(e=""){return`vm:${e??""}`}function dP(e,t,n){var l,u;const r=fP(e),i=wr(r);let s;const o=xr(Object.entries(n.labels??{}));(!ue(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){w.words=d;const h=RB(t,f);return b(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){RP(r)},id(){return e},set(f,d){const[h,m]=NB(t,c,f,d);if(h)return m},get(f){const[d,h]=OB(t,c,f);if(d)return h},tick(f){const d=xt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return Vk(t,c),!1;i.lc=0,i.ys=0,w.get=c.get,IB(t,c);try{const m=s==null?void 0:s.next();m!=null&&m.done&&(i.es=1)}catch(m){de(et,w.elementfocus,"crash",m.message),i.es=1}return Vk(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return xt(i.lc)?++i.lc>ki.HALT_AT_COUNT:!0},hm(){if(ue(i.mg)&&ue(i.lb)){const[f]=i.mg;if(b(f))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return m.find(p=>xt(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,m){et.emit(f,`${pw(d)}:${h}`,m)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const m=h[1].findIndex(p=>p>0);if(m>=0&&b(h[1])){h[1][m]*=-1;break}}}},restore(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let m=0;m<h[1].length;m++)h[1][m]=Math.abs(h[1][m])}},getcase(){i.ec=xt(i.ec)?i.ec:1;const f=c.hm();if(f&&ue(i.mg)){const[,d,h,m]=i.mg;c.set("sender",h),b(d)&&c.set("arg",d),m&&(c.set("player",m),w.elementfocus=m),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=xt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=HA.parse(f),[h]=d.filter(m=>m.fileName===Gl);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(Te(d)),h)},if(...f){const[d,h]=it(f,0,[H.ANY]),m=dw(d);return m&&h<f.length&&c.command(...f.slice(h)),m?1:0},try(...f){const[,d]=it(f,0,[H.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,m]=it(f,0,[H.NAME,H.ANY]),p=xt(h),k=p?m:1,y=c.get(d),v=p?h:1;if(!xt(y))return k<f.length&&c.command(...f.slice(k)),1;const T=y-v;return T<0?(k<f.length&&c.command(...f.slice(k)),1):(c.set(d,T),0)},give(...f){const[d,h,m]=it(f,0,[H.NAME,H.ANY]),p=xt(h),k=p?m:1,y=c.get(d),v=p?h:1,T=y===void 0?1:0;return T&&k<f.length&&c.command(...f.slice(k)),c.set(d,ta(y,0)+v),T},repeatstart(f,...d){const[h,m]=it(d,0,[H.NUMBER]),p=`repeatcount${f}`,k=`repeatwords${f}`;i[p]=h,i[k]=m<d.length?d.slice(m):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!xt(i[d]))return 0;const m=i[d];i[d]=m-1;const p=m>0,k=i[h];return p&&ue(k)&&c.command(...k),p?1:0},foreachstart(f,...d){const[h,m,p,k]=it(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let y=Math.min(m,p),v=Math.max(m,p);const T=(k??0)||1;if(T<0){const A=y;y=v,v=A}return c.set(h,y-T),0},foreach(f,...d){const[h,m,p,k,y]=it(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let v=Math.min(m,p),T=Math.max(m,p);const A=(k??0)||1;if(A<0){const I=v;v=T,T=I}let L=c.get(h);!xt(L)||L<v||L>T?L=v:L+=A;const S=L<=T?1:0;return S&&(c.set(h,L),y<d.length&&c.command(...d.slice(y))),S},waitfor(...f){const[d]=it(f,0,[H.ANY]),h=dw(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=it(f,h,[H.ANY]);if(d=m,d)break;h=p}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=it(f,h,[H.ANY]);if(d=m,!d)break;h=p}return d},not(...f){const[d]=it(f,0,[H.ANY]);return d?0:1},expr(...f){const[d]=it(f,0,[H.ANY]);return d},isEq(f,d){const[h]=it([f],0,[H.ANY]),[m]=it([d],0,[H.ANY]);return typeof h=="object"||typeof m=="object"?CE(h,m)?1:0:h===m?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return h<m?1:0},isGreaterThan(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return h>m?1:0},isLessThanOrEq(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return h<=m?1:0},isGreaterThanOrEq(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return h>=m?1:0},opPlus(f,d){const[h]=it([f],0,[H.ANY]),[m]=it([d],0,[H.ANY]);return h+m},opMinus(f,d){const[h]=it([f],0,[H.ANY]),[m]=it([d],0,[H.ANY]);return h-m},opPower(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return Math.pow(h,m)},opMultiply(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return h*m},opDivide(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return h/m},opModDivide(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return h%m},opFloorDivide(f,d){const[h]=it([f],0,[H.NUMBER]),[m]=it([d],0,[H.NUMBER]);return Math.floor(h/m)},opUniPlus(f){const[d]=it([f],0,[H.NUMBER]);return+d},opUniMinus(f){const[d]=it([f],0,[H.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function xd(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ue(r)?r.forEach(i=>{t.push(xd(i))}):t.push(xd(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function pP(e){const t=sk(`${e}
`);if(t.errors.length>0)return t;Ao.input=t.tokens;const n=Ao.program();if(Ao.errors.length>0)return{tokens:t.tokens,errors:Ao.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=sP.go(n);return r?(xd(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const vd=Object.getPrototypeOf(function*(){}).constructor;function mP(e,t){const n=`compile-${e}`;console.time(n);const r=pP(t);if(console.timeEnd(n),xm&&console.info(t,r.errors),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=hP(r.ast);if(i.code){xm&&console.info(i.code);try{return{...r,...i,source:i.code,code:new vd("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new vd("api"," ")}}}return{...r,...i,source:"",code:new vd("api"," ")}}function gP(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=mP(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return b(s)?s.isended():!0},halt(i){const s=t[i];return b(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];b(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!b(t[i])){const f=n(a,c);if(l=t[i]=dP(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((y,v)=>[y,v]);m.slice(h-5,h).forEach(([y,v])=>{de(et,ar(),"build",`$grey${v+1} $grey${y}`)});const[p,k]=m[h]??[];if(yt(p)&&b(k)){const y=(d.column??1)-1,v=y+d.length,T=y<p.length?p:`${p}*`,A=T.substring(0,y),L=T.substring(y,v),S=T.substring(v);de(et,ar(),"build",`$red${k+1} $grey${A}$red${L}$grey${S}`)}return d.message.split(`
`).forEach(y=>{de(et,ar(),"build",y)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Pn(i.target),a=t[s];if(b(a)){const c={...i,target:o};a.message(c)}}};return r}const xn=new Xo,Cn={},Hl={};function mw(e,t,n,r,i,s=0){const o=`tiles:${e}:${t}`;return b(Cn[o])||(Cn[o]=XA(e,t,n,r,i,s)),Cn[o]}function _P(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return b(Hl[s])||(Hl[s]=qA(e,t,n)),Hl[s].id=i,Hl[s]}function yP(e,t){const n=`sprites:${e}:${t}`;return b(Cn[n])||(Cn[n]=JA(e,t)),Cn[n]}function bP(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return b(Cn[s])||(Cn[s]=ZA(e,t,n,r,i)),Cn[s]}function Yl(e,t,n,r){const i=`media:${e}:${t}`;b(Cn[i])||(Cn[i]=QA(e,t,n,r));const s=Cn[i];return s.mime=n,s.media=r,s}function kP(e,t){const n=`control:${e}:${t}`;return b(Cn[n])||(Cn[n]=tS(e,t)),Cn[n]}const Qi=3;function gw(e,t){const n=[],r=(e.x+.5)*ji,i=(e.y+.5)*zi,s=t.x*ji,o=t.y*zi,a=s-r,c=o-i;xn.x=a-Qi,xn.y=c-Qi,n.push(xn.angle()),xn.x=a+ji+Qi,xn.y=c-Qi,n.push(xn.angle()),xn.x=a-Qi,xn.y=c+zi+Qi,n.push(xn.angle()),xn.x=a+ji+Qi,xn.y=c+zi+Qi,n.push(xn.angle());const l=n.map(h=>Math.round(um(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(y=>y<180),m=l.filter(y=>y>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,f]}function Vl(e,t,n,r,i,s,o,a,c){var T;const l={x:a,y:c},u=jr(e,l);if(u===-1)return;xn.x=a-i.x,xn.y=c-i.y;const f=xn.length();if(f>s)return;const d=Math.round(um(xn.angle()));let h=0;for(let A=0;A<n.length;++A){const[L,S,I]=n[A];L>S?(d>=L||d<=S)&&(h=Math.max(h,I)):d>=L&&d<=S&&(h=Math.max(h,I))}const m=s*.5;t[u]=Math.min(t[u],h+(f<m?0:(f-m)*o)),t[u]=mn(t[u],0,1);const p=Mn(e,((T=e.lookup)==null?void 0:T[u])??"");if(b(p)){const A=[...gw(i,l),.25];r.push(A)}const k=e.terrain[u],y=$r(k),v=(k==null?void 0:k.collision)??(y==null?void 0:y.collision);if($a(Wt.ISBULLET,v)){const A=[...gw(i,l),1];r.push(A)}}function Td(e,t,n,r,i,s){if(!b(n)||!b(n.terrain)||!b(n.objects))return[];const o=[];let a=t;const c=St,l=Vt,u=s?Lt.BLACK:Lt.ONCLEAR,f=mw(e,a++,"terrain",c,l,u);o.push(f);const d=a++,h=yP(e,d);h.sprites=[],o.push(h);const m=n.isdark?1:0,p=bP(e,a++,c,l,m);o.push(p),p.alphas.fill(m);const k=mw(e,a++,"tickers",c,l,Lt.ONCLEAR);o.push(k),k.char.fill(0);const y={...cd(St,Vt,r,Lt.ONCLEAR),...k},v=kP(e,a++);if(i){o.push(v);const{graphics:D,camera:N,facing:W}=wr(e),q=n.graphics??D??"",M=n.camera??N??"",O=n.facing??W??"";if(yt(q)){const E=It(q);switch(E){case"fpv":case"iso":case"mode7":v.graphics=E;break;default:case"flat":v.graphics="flat";break}}if(yt(M))switch(It(M)){default:case"mid":v.viewscale=Ic.MID;break;case"near":v.viewscale=Ic.NEAR;break;case"far":v.viewscale=Ic.FAR;break}xt(O)&&(v.facing=lm(O%360))}for(let D=0;D<n.terrain.length;++D){const N=n.terrain[D],W=Xi(N,0,Lt.WHITE,s?Lt.BLACK:Lt.ONCLEAR),q=Gt(N,"collision");f.char[D]=W.char,f.color[D]=W.color,f.bg[D]=W.bg,f.wall[D]=q===Wt.ISSOLID?1:0}const T=Object.values(n.objects??{}),A=new Set;for(let D=0;D<T.length;++D){const N=T[D];yn(N.id)&&xt(N.x)&&xt(N.y)&&A.add(hr(N,St))}for(let D=0;D<T.length;++D){const N=T[D];if(yt(N.tickertext)&&xt(N.tickertime)&&N.tickertext.length){const O=St,E=Tk(N.tickertext,O,Vt-1),C=(E==null?void 0:E.measuredwidth)??1,$=N.x??0,B=N.y??0,st=B<Vt*.5;y.x=$-Math.floor(C*.5),y.y=B+(st?1:-1),y.x+C>St&&(y.x=St-C),y.x<0&&(y.x=0),vk(N.tickertext,y,!0)}if(b(N.removed))continue;const W=N.id??"";if(yn(W)===!1&&xt(N.x)&&xt(N.y)&&A.has(hr(N,St))===!0)continue;const q=Xi(N),M=_P(e,d,W,D);if(M.x=N.x??0,M.y=N.y??0,M.char=q.char,M.color=q.color,M.bg=q.bg,h.sprites.push(M),m){if(q.light>0){const O=jr(n,M),E=mn(Math.round(q.light),1,Vt),C=1/(E*.5);if(p.alphas[O]=0,E>1){const $=[];for(let B=1;B<=E;++B){if(B===2){const rt=Gt(N,"lightdir");if(nr(rt)){const z=eu(n,N,"",rt,M);switch(Or(M,z.destpt)){case mt.EAST:$.push([45,315,1]);break;case mt.WEST:$.push([225,135,1]);break;case mt.NORTH:$.push([315,225,1]);break;case mt.SOUTH:$.push([135,45,1]);break}}}const st=[];for(let rt=M.y-B;rt<=M.y+B;++rt)Vl(n,p.alphas,$,st,M,E,C,M.x-B,rt),Vl(n,p.alphas,$,st,M,E,C,M.x+B,rt);const Q=B-1;for(let rt=M.x-Q;rt<=M.x+Q;++rt)Vl(n,p.alphas,$,st,M,E,C,rt,M.y-B),Vl(n,p.alphas,$,st,M,E,C,rt,M.y+B);for(let rt=0;rt<st.length;++rt){const z=st[rt];let P=0;for(P=0;P<$.length;++P){const ft=$[P];if(ft[1]>ft[0]&&z[1]>=ft[0]&&z[0]<=ft[1]&&z[2]>=1&&ft[2]>=1){$[P]=[Math.min(z[0],ft[0]),Math.max(z[1],ft[1]),1];break}}P===$.length&&$.push(z)}}}}else if(yn(W)){const O=jr(n,M);p.alphas[O]=0}}W===e&&(v.focusx=M.x,v.focusy=M.y,v.focusid=W)}o.push(Yl(e,a++,"text/mood",m?"dark":"bright"));const L=ce($t.MAIN),S=Ni(L,$t.MAIN);if(yt(S.palette)){const D=en(L,bt.PALETTE,S.palette),N=Re(D);b(N==null?void 0:N.bits)&&o.push(Yl(e,a++,"image/palette",Array.from(N.bits)))}if(yt(S.charset)){const D=en(L,bt.CHARSET,S.charset),N=Re(D);b(N==null?void 0:N.bits)&&o.push(Yl(e,a++,"image/charset",Array.from(N.bits)))}const I=Object.keys(n.objects).filter(yn);return o.push(Yl(e,a++,"text/players",I.join(","))),o}const or=gP();var $t=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))($t||{});const ke={halt:!1,session:De(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function wP(){return ke.session}function ar(){return ke.operator}function EP(e){ke.operator=e}function xP(e){ke.halt=e}function vP(){return ke.halt}function Fr(){return[...ke.books.values()]}function TP(){const[e]=ke.books.values();return e}function Br(e){const t=It(e);return ke.books.get(e)??Fr().find(n=>n.name===t)}function _w(e,t){b(Br(t))&&(ke.software[e]=t)}function ce(e){return Br(ke.software[e])}function yw(e){const t=Zf([]);return yt(e)&&(t.name=e),Xl(t),xe(et,ke.operator,`created [book] ${t.name}`),t}function AP(e){let t=Br(e);return b(t)||(t=Zf([]),t.name=e),Xl(t),xe(et,ke.operator,`created [book] ${t.name}`),t}function ln(e,t){let n=b(t)?AP(t):ce(e);return b(n)||(b(n)||(n=TP()),b(n)||(n=yw(t)),b(n)&&xe(et,ke.operator,`opened [book] ${n.name} for ${e}`)),_w(e,n.id),n}function ts(e,t,n){return td(ln(e),n,t)}function Pr(e,t){const n=ce("main"),r=An(fk(n,e,t));if(b(r))return r;const i=Fr();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(n==null?void 0:n.id)){const a=An(fk(o,e,t));if(b(a))return a}}}function $r(e){if(b(e==null?void 0:e.kinddata))return e.kinddata;if(!yt(e==null?void 0:e.kind)||!e.kind)return;const t=Pr(bt.OBJECT,e.kind);if(b(t))return e.kinddata=Re(t),e.kinddata;const n=Pr(bt.TERRAIN,e.kind);if(b(n))return e.kinddata=Re(n),e.kinddata}function Gt(e,t){const n=e==null?void 0:e.kinddata,r=(n==null?void 0:n.id)??"",i=e==null?void 0:e[t];if(b(i))return i;const s=n==null?void 0:n[t];if(b(s))return s;const o=Pr(bt.OBJECT,r)??Pr(bt.TERRAIN,r),a=qf(o,t);if(b(a))return a;switch(t){case"group":return"";case"cycle":return Tx;case"item":return 0;case"pushable":return 0;case"breakable":return 0;case"collision":return Wt.ISWALK;default:return}}function Dr(e,t,n,r){if(!b(e)||!b(t))return;const[i,s]=t,o=Pr(bt.OBJECT,i);if(b(o)){const c=Nd(e,n,i,r);if(b(c))return sa(c,s),RS(e,c),$r(c),Qm(e,c),c}const a=Pr(bt.TERRAIN,i);if(b(a)){const c=VP(e,n,i);if(b(c)){sa(c,s);const l=hr(n,St);return $r(c),Qm(e,c,l),c}}}function SP(e,t,n){if(!b(e)||!b(t))return;const[r,i]=t,s=Pr(bt.OBJECT,r);if(b(s)){const o=Nd(e,n,r);return sa(o,i),o}}function un(e){const t=Pr(bt.BOARD,e);return Re(t)}function wr(e){const t=ln("main");return Ni(t,e)}function bw(e){const t=ln("main");return gU(t,e)}function kw(){const e=ln("main");return Ni(e,"main")}function RP(e){const t=ln("main");return mk(t,e)}function OP(e,t){ke.books.clear(),e.forEach(r=>{ke.books.set(r.id,r),r.name==="main"&&(ke.software.main=r.id)});const n=Br(t);if(b(n)&&(ke.software.main=n.id),!ke.software.main){const r=ke.books.values().next();r.value&&(ke.software.main=r.value.id)}}function Xl(e){return ke.books.set(e.id,e),e.id}function NP(e){const t=Br(e);t&&ke.books.delete(t.id)}function ww(e){if(!yt(e)||!e)return de(et,e,"login",`failed for playerid ==>${e}<==`);const t=ce("main");if(!b(t))return de(et,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);const n=hn(e),r=Pr(bt.BOARD,"title");if(!b(n)&&!b(r))return de(et,e,"login:title","login failed to find board with 'title' stat");const i=Pr(bt.OBJECT,"player");if(!b(i))return de(et,e,"login:player","login failed to find object type 'player'");const s=Re(r);if(b(s)){const o=qf(r,"startx"),a=qf(r,"starty"),c=xt(o)?o:Math.round(St*.5),l=xt(a)?a:Math.round(Vt*.5),u=Nd(s,{x:c,y:l},"player",e);if(b(u==null?void 0:u.id))return u.player=e,Cl(t,e,s.id),!0}return!1}function IP(e){const t=ce("main"),n=Na(t,e);if(!b(t))return;const r=[e];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Cl(t,s,""),Bh(n,Mn(n,s)),Iw(n,s),or.halt(s),mk(t,s)}}function hn(e){const t=ce("main");return Na(t,e)}function CP(e){const t=ce("main"),n=kU(t,e),r=Na(t,e),i=Mn(r,e);return n&&b(i)}function LP(e){const t=ce("main"),n=ko(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;yn(c)&&b(e[c])===!1&&(e[c]=0,Cl(t,c,i.id))}}}function Ew(e){or.message(e)}function Ln(e,t,n,r){const i=Qr(t);yt(n.id)&&et.emit(e,"vm:touched",[n.id,i,r])}function MP(e,t,n,r){const i=n.id??"";if(r.x<0){const s=un((t==null?void 0:t.exitwest)??"");b(s)&&bo(e,i,s.id,{x:St-1,y:r.y})}else if(r.x>=St){const s=un((t==null?void 0:t.exiteast)??"");b(s)&&bo(e,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=un((t==null?void 0:t.exitnorth)??"");b(s)&&bo(e,i,s.id,{x:r.x,y:Vt-1})}else if(r.y>=Vt){const s=un((t==null?void 0:t.exitsouth)??"");b(s)&&bo(e,i,s.id,{x:r.x,y:0})}}function es(e,t,n,r){if(!b(n==null?void 0:n.id))return!1;const i=$h(t,n,r);if(b(i)){const s=yn(n.id),o=yn(n.party??n.id),a=Gt(n,"collision")===Wt.ISBULLET;let c="";n.party&&o&&(c=n.party),s&&(c=n.id);const l=yn(i.id),u=yn(i.party??i.id),f=Gt(i,"collision")===Wt.ISBULLET,d=o===u;let h="";if(i.party&&u&&(h=i.party),l&&(h=i.id??""),s&&i.kind==="edge"?MP(e,t,n,r):s?l?(Ln("",i,n,"bump"),Ln("",n,i,"bump")):f?(Ln("",i,n,d?"partyshot":"shot"),Ln(c,n,i,"touch")):(Ln("",i,n,"thud"),Ln(c,n,i,"touch")):a?f?(Ln("",i,n,"thud"),Ln("",n,i,"thud")):(Ln("",i,n,l?"touch":"thud"),Ln(d?"":c,n,i,d?"partyshot":"shot")):l?Ln(h,i,n,"touch"):f?(Ln(d?"":h,i,n,d?"partyshot":"shot"),Ln("",n,i,d?"thud":"touch")):(Ln("",i,n,"thud"),Ln("",n,i,"bump")),s&&Gt(i,"item")||a&&Gt(i,"breakable")){if(b(i==null?void 0:i.id)){const m=ie(t,{x:i.x??-1,y:i.y??-1});b(m)&&vn(w.board,m,w.timestamp)}else Oe(t,{x:r.x,y:r.y});return!0}return!1}return!0}function xw(e,t,n,r){var l;if(!b(e)||!b(t)||!b(n))return;const i={...w};w.book=e,w.board=t,w.element=n,w.elementid=n.id??"",w.elementisplayer=yn(w.elementid);const s=w.element.player??ke.operator;w.elementfocus=w.elementisplayer?w.elementid:s;const o=Gt(n,"cycle"),a=n.id??"",c=It(n.name??((l=n.kinddata)==null?void 0:l.name)??"");if(or.tick(a,Zi.RUNTIME,o,c,r),xt(n==null?void 0:n.tickertime)&&w.timestamp-n.tickertime>Va*5&&(n.tickertime=0,n.tickertext=""),w.elementisplayer){const u=wr(w.elementid);xt(u.inputcurrent)&&(u.inputcurrent=0)}Jn(i).forEach(u=>{w[u]=i[u]})}function UP(e,t){ke.loaders.set(e,t)}function FP(e){or.halt(e)}function BP(){const e=or.ids();for(let n=0;n<e.length;++n)or.halt(e[n]);const t=ce("main");b(t)&&(t.flags={})}function PP(e=!1){const t=ce("main");if(!b(t))return;const n=t.timestamp+1,r=ki.HALT_AT_COUNT;ki.HALT_AT_COUNT=r*2,ke.loaders.forEach((s,o)=>{const a={...w};w.timestamp=t.timestamp,w.book=t,w.board=void 0,w.element=void 0,w.elementid=o,w.elementisplayer=!1,w.elementfocus=ar();const c=KF(o);b(c)&&or.arg(o,c),or.tick(o,Zi.LOADER,1,"loader",s),or.isended(o)&&(or.halt(o),ke.loaders.delete(o)),Jn(a).forEach(l=>{w[l]=a[l]})}),ki.HALT_AT_COUNT=r,t.timestamp=n,w.timestamp=n;const i=ko(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)$r(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];$r(o.objects[u])}const c=CS(o,n);for(let l=0;l<c.length;++l){const{id:u,type:f,code:d,object:h}=c[l];f===bt.ERROR?or.halt(u):(!e||yn((h==null?void 0:h.id)??""))&&xw(t,o,h,d)}}}function Oo(e,t,n,r){const i=ce("main");if(!b(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(b(c.id)){const l=`${pw(c.id)}:${t}`;et.emit("",l,n)}}}if(gs(e)){for(let o=0;o<r.length;++o){const a=r[o],c=ie(a,e);b(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(It(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(Sw(a,[e]));break}}}}function $P(e){const t=wr(e),n=t.playbuffer=yt(t.playbuffer)?t.playbuffer:"";n&&vw(e,n,!1)}function vw(e,t,n=!0){var o;const r=ln("main");if(!b(r))return;const i=`${e}_cli`;w.timestamp=r.timestamp,w.book=r,w.board=Na(r,e),w.element=Mn(w.board,e),w.elementid=((o=w.element)==null?void 0:o.id)??"",w.elementisplayer=!0,w.elementfocus=w.elementid||e;const s=ki.HALT_AT_COUNT;if(ki.HALT_AT_COUNT=s*8,or.once(i,Zi.CLI,"cli",t),n){const a=wr(e);a.playbuffer=t}ki.HALT_AT_COUNT=s}function ql(e){var a;const t=ln("main"),n=Ss(t,e);if(!b(t)||!b(n)||!b(w.element))return;const r={...w},i=`${e}_run`,s=It(w.element.name??((a=w.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";or.once(i,Zi.RUNTIME,s,o),Jn(r).forEach(c=>{w[c]=r[c]})}function DP(e,t){const n=ce("main"),r=Na(n,e),i=[],s=[],o=[];if(!b(n)||!b(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=un(r.overboard??""),l=un(r.underboard??"");return s.push(...Td(e,0,l,t,!1,!0)),o.push(...Td(e,s.length,r,t,!0,a!=="flat")),i.push(...Td(e,s.length+o.length,c,t,!1,!1)),{over:i,under:s,layers:o}}function Ms(e){return ue(e)&&typeof e[0]=="string"}function jP(e){const t=w.words[e];return yt(t)?[t,e+1]:[void 0,e]}function Ad(e){const t=w.words[e];if(Ms(t))return[t,e+1];const[n,r]=Rc(e),[i,s]=jP(r);return yt(i)&&(i==="empty"||$r({kind:i}))?[[i,n],s]:[void 0,e]}function Pa(e){if(!Ms(e))return;const[t]=e;return t}function Jl(e){if(!Ms(e))return;const[,t]=e,n=b(t)?Ac(t):void 0;return b(n)?n:void 0}function Tw(e){if(!Ms(e))return;const[,t]=e,n=b(t)?Sc(t):void 0;return b(n)?n:void 0}function $a(e,t){const n=e??Wt.ISWALK,r=t??Wt.ISWALK;switch(n){case Wt.ISWALK:return r!==Wt.ISWALK;case Wt.ISSWIM:return r!==Wt.ISSWIM;case Wt.ISSOLID:return!0;case Wt.ISBULLET:return r!==Wt.ISWALK&&r!==Wt.ISSWIM}}function Da(e,t,n){const r=e==null?void 0:e.objects[n];if(b(r))return r;const i=ja(e,"player");return b(t)?(t.x<0&&(t.x=fr(0,St-1)),t.y<0&&(t.y=fr(0,Vt-1)),Rw(t,i)):An(...i)}function ja(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(b)}function zP(e){const t=[];for(let n=0;n<Vt;++n)for(let r=0;r<St;++r){const i={x:r,y:n},s=ie(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Sd(e,t,n,r){const i=Xi(e);return!(b(t)&&t!==i.name||b(n)&&n!==i.color||b(r)&&r!==i.bg)}function Zl(e,t){const n=Pa(t),r=Jl(t),i=Tw(t);return ja(e,n??"").filter(s=>Sd(s,n,r,i)).filter(b)}function Aw(e,t){const n=b(t)?Ac(t):void 0,r=b(t)?Sc(t):void 0,i=[];if(b(e)){for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];b(a)&&Sd(e.terrain[o],void 0,n,r)&&i.push(a)}const s=Object.values(e.objects);for(let o=0;o<s.length;++o){const a=s[o];Sd(a,void 0,n,r)&&i.push(a)}}return i}function Sw(e,t){return b(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(b(i))return i;const s=ja(e,It(n));if(s.length)return s}else if(gs(n)&&n.x>=0&&n.x<St&&n.y>=0&&n.y<Vt){const i=n.x+n.y*St,s=(r=e.lookup)==null?void 0:r[i];return b(s)?e.objects[s]:e.terrain[i]}}).flat().filter(b):[]}function Rw(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function WP(e,t,n,r){if(!b(e))return;b(e.distmaps)||(e.distmaps={});const i=`${t}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=e.distmaps[i];if(!b(s)){s=new Array(Ah).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(b(c)&&tu(c)){const l=hr(c,St);if(s[l]===-2){const u=ns(e,c.x,c.y);$a(t,Gt(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function Ow(e,t){return tu(e)?t[hr(e,St)]:-1}function Nw(e,t,n,r,i){if(!b(e))return;const s=WP(e,t,n,r);if(!b(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=Ow(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=Ow(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function GP(){return new Array(St*Vt).map(()=>{})}function Ql(e=gu){const t={terrain:GP(),objects:{},id:""};return e(t)}var Rd=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(Rd||{});function KP(e){return co(e,Rd,{terrain:t=>t.map(Pc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Pc),id:Ae,named:Ae,lookup:Ae,codepage:Ae,distmaps:Ae,overboard:Ae,underboard:Ae})}function HP(e){return ia(e,Rd,{terrain:t=>t.map($c),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=$c(t[r]);b(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function tu(e){return _h(e.x,e.y,0,St-1,Vt-1,0)}function jr(e,t){return!b(e)||!b(t==null?void 0:t.x)||!b(t==null?void 0:t.y)||t.x<0||t.x>=St||t.y<0||t.y>=Vt?-1:t.x+t.y*St}function ie(e,t){const n=jr(e,t);if(n<0||!b(e==null?void 0:e.lookup))return;const r=Mn(e,e.lookup[n]??"");return b(r)?r:e.terrain[n]}function YP(e,t){const n=Mn(e,t);if(b(n))return n;const r=parseFloat(t),i=SA(isNaN(r)?-1:r,St);return ns(e,i.x,i.y)}function ns(e,t,n){return(t>=0&&t<St)??(n>=0&&n<Vt)?e==null?void 0:e.terrain[t+n*St]:void 0}function Oe(e,t){if(!b(e)||!b(t)||!b(t.x)||!b(t.y)||t.x<0||t.x>=St||t.y<0||t.y>=Vt)return;const n=xr(t),r=t.x+t.y*St;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function Od(e,t){if(!b(e)||!b(t))return;const n=xr(t);return n.id=n.id??De(),e.objects[n.id]=n,e.objects[n.id]}function VP(e,t,n){return Oe(e,{...t,kind:n})}function Nd(e,t,n,r){return Od(e,{...t,kind:n,id:r})}function Mn(e,t){if(e)return e.objects[t]}function XP(e,t){const n=jr(e,t);if(n<0||!b(e==null?void 0:e.lookup))return;const r=Mn(e,e.lookup[n]??"");if(b(r))return r}function vn(e,t,n){return!b(t)||Qr(t)==="player"?!1:(t.id?(t.removed=n,Bh(e,t)):(Oe(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),OS(e,t)),!0)}function Iw(e,t){return b(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function qP(e,t,n){if(!b(e)||!b(t))return;const r=e.objects[n];if(b(r))return r;if(gs(t))return Rw(t,ja(e,"player"))}function eu(e,t,n,r,i){const s=mt.MID;if(!b(e)||!b(t))return{dir:r,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:t.lx??o.x,y:t.ly??o.y},c=Or(a,o),l=St-1,u=Vt-1;for(let f=0;f<r.length;++f){const d=$A(r[f]);switch(d){case mt.IDLE:break;case mt.NORTH:case mt.SOUTH:case mt.WEST:case mt.EAST:ze(o,d);break;case mt.BY:{const[h,m]=r.slice(f+1);xt(h)&&xt(m)&&(o.x=mn(o.x+h,0,l),o.y=mn(o.y+m,0,u)),f+=2;break}case mt.TO:case mt.AT:{const[h,m]=r.slice(f+1);xt(h)&&xt(m)&&(o.x=mn(h,0,l),o.y=mn(m,0,u)),f+=2;break}case mt.FLOW:ze(o,c);break;case mt.SEEK:{const h=qP(e,t,n);gs(h)&&ze(o,Or(i,h));break}case mt.RNDNS:ze(o,An(mt.NORTH,mt.SOUTH));break;case mt.RNDNE:ze(o,An(mt.NORTH,mt.EAST));break;case mt.RND:ze(o,An(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));break;case mt.CW:case mt.CCW:case mt.OPP:case mt.RNDP:{const h=eu(e,t,n,r.slice(f+1),i);switch(o.x=i.x,o.y=i.y,d){case mt.CW:switch(Or(i,h.destpt)){case mt.NORTH:ze(o,mt.EAST);break;case mt.SOUTH:ze(o,mt.WEST);break;case mt.EAST:ze(o,mt.SOUTH);break;case mt.WEST:ze(o,mt.NORTH);break}break;case mt.CCW:switch(Or(i,h.destpt)){case mt.NORTH:ze(o,mt.WEST);break;case mt.SOUTH:ze(o,mt.EAST);break;case mt.EAST:ze(o,mt.NORTH);break;case mt.WEST:ze(o,mt.SOUTH);break}break;case mt.OPP:switch(Or(i,h.destpt)){case mt.NORTH:ze(o,mt.SOUTH);break;case mt.SOUTH:ze(o,mt.NORTH);break;case mt.EAST:ze(o,mt.WEST);break;case mt.WEST:ze(o,mt.EAST);break}break;case mt.RNDP:switch(Or(i,h.destpt)){case mt.NORTH:case mt.SOUTH:o.x+=An(-1,1);break;case mt.WEST:case mt.EAST:o.y+=An(-1,1);break}break}break}case mt.FLEE:case mt.AWAY:{const[h,m]=r.slice(f+1);if(xt(h)&&xt(m)){const p={x:mn(h,0,l),y:mn(m,0,u)},k=Gt(t,"collision"),y=Nw(e,k,o,p,!0);b(y)&&(o.x=y.x,o.y=y.y)}f+=2;break}case mt.FIND:case mt.TOWARD:{const[h,m]=r.slice(f+1);if(xt(h)&&xt(m)){const p={x:mn(h,0,l),y:mn(m,0,u)};if(fr(1,100)<5)ze(o,An(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));else{const k=Gt(t,"collision"),y=Nw(e,k,o,p,!1);if(b(y))if(y.x!==h&&y.y!==m&&XP(e,y))switch(Or(i,y)){case mt.EAST:case mt.WEST:o.y+=An(-1,1);break;case mt.NORTH:case mt.SOUTH:o.x+=An(-1,1);break}else o.x=y.x,o.y=y.y}}f+=2;break}case mt.PLAYER:{const h=Da(e,i,n);gs(h)&&(o.x=h.x,o.y=h.y);break}case mt.OVER:case mt.UNDER:{const h=eu(e,t,n,r.slice(f+1),i);return h.layer=d,h}}}return{dir:r,startpt:i,destpt:o,layer:s}}const w={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var H=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.COLOR_OR_KIND=7]="COLOR_OR_KIND",e[e.MAYBE_KIND=8]="MAYBE_KIND",e[e.MAYBE_NAME=9]="MAYBE_NAME",e[e.MAYBE_NUMBER=10]="MAYBE_NUMBER",e[e.MAYBE_STRING=11]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",e[e.ANY=13]="ANY",e))(H||{});function fn(e,t,n){throw console.info(n,w.element,w.elementid,w.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function Cw(e){var n,r;const t={x:((n=w.element)==null?void 0:n.x)??0,y:((r=w.element)==null?void 0:r.y)??0};return eu(w.board,w.element,w.elementfocus,e,t)}function it(e,t,n){const r=w.words;w.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=Ad(s);Ms(a)?(s=c,i.push(a)):fn("kind",a,e);break}case 0:{if(Zo(e[s])===void 0){const[a,c]=In(s);wn(a)?(s=c,i.push(a)):fn("color",a,e)}else{const[a,c]=Rc(s);wn(a)?(s=c,i.push(a)):fn("color",a,e)}break}case 2:{if(vh(e[s])===void 0){const[a,c]=In(s);nr(a)?(s=c,i.push(Cw(a))):fn("direction",a,e)}else{const[a,c]=mm(s);nr(a)?(s=c,i.push(Cw(a))):fn("direction",a,e)}break}case 3:{const a=w.words[s];yt(a)||fn("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=In(s);if(yt(a)){const l=parseFloat(a);xt(l)?i.push(l):fn("number",a,e)}else xt(a)?i.push(a):fn("number",a,e);s=c;break}case 5:{const[a,c]=In(s);yt(a)||fn("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=In(s);let l=a;if(yt(l)){const u=parseFloat(l);xt(u)&&(l=u)}else xt(l)||fn("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=Ad(s);if(Ms(a))s=c,i.push(a);else if(Zo(e[s])===void 0){const[l,u]=In(s);wn(l)?(s=u,i.push(l)):fn("color",l,e)}else{const[l,u]=Rc(s);wn(l)?(s=u,i.push(l)):fn("color or kind",l,e)}break}case 8:{const[a,c]=Ad(s);a!==void 0&&!Ms(a)&&fn("optional kind",a,e),s=c,i.push(a);break}case 9:{const a=w.words[s];a!==void 0&&!yt(a)&&fn("optional string",a,e),++s,i.push(a);break}case 10:{const[a,c]=In(s);if(yt(a)){const l=parseFloat(a);xt(l)?i.push(l):fn("optional number",a,e)}else xt(a)||a===void 0?i.push(a):fn("optional number",a,e);s=c;break}case 11:{const[a,c]=In(s);a!==void 0&&!yt(a)&&fn("optional string",a,e),s=c,i.push(a);break}case 12:{const[a,c]=In(s);let l=a;if(yt(l)){const u=parseFloat(l);xt(u)&&(l=u)}else l!==void 0&&!xt(l)&&fn("number or string",l,e);s=c,i.push(l);break}case 13:{const[a,c]=In(s);s=c,i.push(a);break}}return w.words=r,[...i,s]}const nu={},No={};function Id(){return{id:De(),layers:[],scroll:[],sidebar:[]}}const JP=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),ZP=new Set(["tx","text"]),QP={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Lw={};let Mw=e=>{let t=Lw[e];return b(t)||(Lw[e]=t=Id()),t};function t$(e){Mw=e}function Ye(e){return Mw(e)}function Cd(e){return b(nu[e])||(nu[e]=[]),nu[e]}function e$(e){const t=Ye(e);t.scroll=[]}function n$(e,t,n){Object.values(No).forEach(r=>{if(r[t]!==void 0){const i=Em(e.id(),t);xt(n)&&EA(i,n),yt(n)&&xA(i,n)}})}function Tn(e){const t=Cd(e);return nu[e]=[],t}function Rt(e,t){Cd(e).push(t)}function Mt(e,t,n,r,i=()=>0,s=gu){const o=[t,n,...r],a=It(`${o[3]}`),c={...w};function l(u,f){b(f)&&f!==i(u)&&(w.board=c.board,w.element=c.element,w.elementfocus=c.elementfocus,s(u,f))}if(JP.has(a)){const u=`${o[2]}`;No[t]=No[t]??{};const f=i(u)??QP[a];if(No[t][u]===void 0){const d=Em(t,u);xt(f)&&wA(d,f),yt(f)&&gh(d,f),ZP.has(a)?No[t][u]=Qp(d,h=>{l(u,h)}):No[t][u]=vA(d,h=>{l(u,h)})}}Cd(e).push(o)}t$(e=>{if(yn(e)){const t=ce($t.MAIN),n=Ni(t,$t.GADGETSTORE);let r=n[e];return b(r)||(n[e]=r=Id()),r}return Id()});let Uw=0;function r$(){switch(Uw++){case 0:return Lt.BLUE;case 1:return Lt.BLACK;case 2:return Lt.GREEN;case 3:return Lt.BLACK;case 4:return Lt.CYAN;case 5:return Lt.BLACK;case 6:return Lt.RED;case 7:return Lt.BLACK;case 8:return Lt.PURPLE;case 9:return Lt.BLACK;case 10:return Lt.YELLOW;case 11:return Lt.BLACK;case 12:return Lt.WHITE;default:return Uw=0,Lt.BLACK}}const ru=Ps("gadgetserver",["tock","second"],e=>{if(!ru.session(e))return;const t=ce($t.MAIN),n=(t==null?void 0:t.activelist)??[],r=Ni(t,$t.GADGETSYNC);switch(e.target){case"tock":{const i=r$();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=DP(o,i),u=Ye(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=Zd(f,u);d.length&&(r[o]=xr(u),XE(ru,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=hn(s);b(o)&&cx(ru,s,o.id)}break;case"desync":VE(ru,e.player,Ye(e.player));break;case"clearscroll":e$(e.player);break;case"clearplayer":{const i=Ni(t,$t.GADGETSTORE);delete i[e.player];const s=Ni(t,$t.GADGETSYNC);delete s[e.player];break}}});function iu(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Fw={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof iu=="function"&&iu;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(m){var p=r[l][1][m];return o(p||m)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof iu=="function"&&iu,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,m,p,k=[],y=0,v=c.length,T=v,A=s.getTypeOf(c)!=="string";y<c.length;)T=v-y,f=A?(l=c[y++],u=y<v?c[y++]:0,y<v?c[y++]:0):(l=c.charCodeAt(y++),u=y<v?c.charCodeAt(y++):0,y<v?c.charCodeAt(y++):0),d=l>>2,h=(3&l)<<4|u>>4,m=1<T?(15&u)<<2|f>>6:64,p=2<T?63&f:64,k.push(a.charAt(d)+a.charAt(h)+a.charAt(m)+a.charAt(p));return k.join("")},i.decode=function(c){var l,u,f,d,h,m,p=0,k=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|T):new Array(0|T);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(p++)))>>2,f=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),v[k++]=l,h!==64&&(v[k++]=u),m!==64&&(v[k++]=f);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,m){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,m){var p,k="";for(p=0;p<m;p++)k+=String.fromCharCode(255&h),h>>>=8;return k}function o(h,m,p,k,y,v){var T,A,L=h.file,S=h.compression,I=v!==l.utf8encode,D=a.transformTo("string",v(L.name)),N=a.transformTo("string",l.utf8encode(L.name)),W=L.comment,q=a.transformTo("string",v(W)),M=a.transformTo("string",l.utf8encode(W)),O=N.length!==L.name.length,E=M.length!==W.length,C="",$="",B="",st=L.dir,Q=L.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(rt.crc32=h.crc32,rt.compressedSize=h.compressedSize,rt.uncompressedSize=h.uncompressedSize);var z=0;m&&(z|=8),I||!O&&!E||(z|=2048);var P=0,ft=0;st&&(P|=16),y==="UNIX"?(ft=798,P|=function(ut,jt){var Qt=ut;return ut||(Qt=jt?16893:33204),(65535&Qt)<<16}(L.unixPermissions,st)):(ft=20,P|=function(ut){return 63&(ut||0)}(L.dosPermissions)),T=Q.getUTCHours(),T<<=6,T|=Q.getUTCMinutes(),T<<=5,T|=Q.getUTCSeconds()/2,A=Q.getUTCFullYear()-1980,A<<=4,A|=Q.getUTCMonth()+1,A<<=5,A|=Q.getUTCDate(),O&&($=s(1,1)+s(u(D),4)+N,C+="up"+s($.length,2)+$),E&&(B=s(1,1)+s(u(q),4)+M,C+="uc"+s(B.length,2)+B);var lt="";return lt+=`
\0`,lt+=s(z,2),lt+=S.magic,lt+=s(T,2),lt+=s(A,2),lt+=s(rt.crc32,4),lt+=s(rt.compressedSize,4),lt+=s(rt.uncompressedSize,4),lt+=s(D.length,2),lt+=s(C.length,2),{fileRecord:f.LOCAL_FILE_HEADER+lt+D+C,dirRecord:f.CENTRAL_FILE_HEADER+s(ft,2)+lt+s(q.length,2)+"\0\0\0\0"+s(P,4)+s(k,4)+D+C+q}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,m,p,k){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=k,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,k=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-k-1))/p:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(k){return f.DATA_DESCRIPTOR+s(k.crc32,4)+s(k.compressedSize,4)+s(k.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,k=function(y,v,T,A,L){var S=a.transformTo("string",L(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(v,4)+s(T,4)+s(S.length,2)+S}(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:k,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var m=function(v,T){var A=v||T,L=s[A];if(!L)throw new Error(A+" is not a valid compression method !");return L}(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},k=h.dir,y=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:d,dir:k,date:y,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(k){m(k)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(p){var k=new c(h);return k.load(p),k}).then(function(p){var k=[o.Promise.resolve(p)],y=p.files;if(h.checkCRC32)for(var v=0;v<y.length;v++)k.push(f(y[v]));return o.Promise.all(k)}).then(function(p){for(var k=p.shift(),y=k.files,v=0;v<y.length;v++){var T=y[v],A=T.fileNameStr,L=s.resolve(T.fileNameStr);m.file(L,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(m.file(L).unsafeOriginalName=A)}return k.zipComment.length&&(m.comment=k.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof dn<"u",newBufferFrom:function(s,o){if(dn.from&&dn.from!==Uint8Array.from)return dn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new dn(s,o)},allocBuffer:function(s){if(dn.alloc)return dn.alloc(s);var o=new dn(s);return o.fill(0),o},isBuffer:function(s){return dn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(L,S,I){var D,N=a.getTypeOf(S),W=a.extend(I||{},u);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(L=y(L)),W.createFolders&&(D=k(L))&&v.call(this,D,!0);var q=N==="string"&&W.binary===!1&&W.base64===!1;I&&I.binary!==void 0||(W.binary=!q),(S instanceof f&&S.uncompressedSize===0||W.dir||!S||S.length===0)&&(W.base64=!1,W.binary=!0,S="",W.compression="STORE",N="string");var M=null;M=S instanceof f||S instanceof c?S:m.isNode&&m.isStream(S)?new p(L,S):a.prepareContent(L,S,W.binary,W.optimizedBinaryString,W.base64);var O=new d(L,M,W);this.files[L]=O}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),m=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),k=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var S=L.lastIndexOf("/");return 0<S?L.substring(0,S):""},y=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},v=function(L,S){return S=S!==void 0?S:u.createFolders,L=y(L),this.files[L]||s.call(this,L,null,{dir:!0,createFolders:S}),this.files[L]};function T(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var S,I,D;for(S in this.files)D=this.files[S],(I=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&L(I,D)},filter:function(L){var S=[];return this.forEach(function(I,D){L(I,D)&&S.push(D)}),S},file:function(L,S,I){if(arguments.length!==1)return L=this.root+L,s.call(this,L,S,I),this;if(T(L)){var D=L;return this.filter(function(W,q){return!q.dir&&D.test(W)})}var N=this.files[this.root+L];return N&&!N.dir?N:null},folder:function(L){if(!L)return this;if(T(L))return this.filter(function(N,W){return W.dir&&L.test(N)});var S=this.root+L,I=v.call(this,S),D=this.clone();return D.root=I.name,D},remove:function(L){L=this.root+L;var S=this.files[L];if(S||(L.slice(-1)!=="/"&&(L+="/"),S=this.files[L]),S&&!S.dir)delete this.files[L];else for(var I=this.filter(function(N,W){return W.name.slice(0,L.length)===L}),D=0;D<I.length;D++)delete this.files[I[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var S,I={};try{if((I=a.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");a.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var D=I.comment||this.comment||"";S=h.generateWorker(this,I,D)}catch(N){(S=new c("error")).error(N)}return new l(S,I.type||"string",I.mimeType)},generateAsync:function(L,S){return this.generateInternalStream(L).accumulate(S)},generateNodeStream:function(L,S){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(S)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(k,y){var v=[],T=m._internalType,A=m._outputType,L=m._mimeType;m.on("data",function(S,I){v.push(S),p&&p(I)}).on("error",function(S){v=[],y(S)}).on("end",function(){try{var S=function(I,D,N){switch(I){case"blob":return s.newBlob(s.transformTo("arraybuffer",D),N);case"base64":return c.encode(D);default:return s.transformTo(I,D)}}(A,function(I,D){var N,W=0,q=null,M=0;for(N=0;N<D.length;N++)M+=D[N].length;switch(I){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(q=new Uint8Array(M),N=0;N<D.length;N++)q.set(D[N],W),W+=D[N].length;return q;case"nodebuffer":return dn.concat(D);default:throw new Error("concat : unsupported type '"+I+"'")}}(T,v),L);k(S)}catch(I){y(I)}v=[]}).resume()})}function h(m,p,k){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=k,s.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var k=this;return m==="data"?this._worker.on(m,function(y){p.call(k,y.data,y.meta)}):this._worker.on(m,function(){s.delay(p,arguments,k)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof dn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(m){var p,k,y,v,T,A=m.length,L=0;for(v=0;v<A;v++)(64512&(k=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(y=m.charCodeAt(v+1)))==56320&&(k=65536+(k-55296<<10)+(y-56320),v++),L+=k<128?1:k<2048?2:k<65536?3:4;for(p=o.uint8array?new Uint8Array(L):new Array(L),v=T=0;T<L;v++)(64512&(k=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(y=m.charCodeAt(v+1)))==56320&&(k=65536+(k-55296<<10)+(y-56320),v++),k<128?p[T++]=k:(k<2048?p[T++]=192|k>>>6:(k<65536?p[T++]=224|k>>>12:(p[T++]=240|k>>>18,p[T++]=128|k>>>12&63),p[T++]=128|k>>>6&63),p[T++]=128|63&k);return p}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(m){var p,k,y,v,T=m.length,A=new Array(2*T);for(p=k=0;p<T;)if((y=m[p++])<128)A[k++]=y;else if(4<(v=l[y]))A[k++]=65533,p+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&p<T;)y=y<<6|63&m[p++],v--;1<v?A[k++]=65533:y<65536?A[k++]=y:(y-=65536,A[k++]=55296|y>>10&1023,A[k++]=56320|1023&y)}return A.length!==k&&(A.subarray?A=A.subarray(0,k):A.length=k),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var k=function(v,T){var A;for((T=T||v.length)>v.length&&(T=v.length),A=T-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?T:A+l[v[A]]>T?A:T}(m),y=m;k!==m.length&&(o.uint8array?(y=m.subarray(0,k),this.leftOver=m.subarray(k,m.length)):(y=m.slice(0,k),this.leftOver=m.slice(k,m.length))),this.push({data:i.utf8decode(y),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(p){return p}function u(p,k){for(var y=0;y<p.length;++y)k[y]=255&p.charCodeAt(y);return k}n("setimmediate"),i.newBlob=function(p,k){i.checkSupport("blob");try{return new Blob([p],{type:k})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(k)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,k,y){var v=[],T=0,A=p.length;if(A<=y)return String.fromCharCode.apply(null,p);for(;T<A;)k==="array"||k==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(T,Math.min(T+y,A)))):v.push(String.fromCharCode.apply(null,p.subarray(T,Math.min(T+y,A)))),T+=y;return v.join("")},stringifyByChar:function(p){for(var k="",y=0;y<p.length;y++)k+=String.fromCharCode(p[y]);return k},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var k=65536,y=i.getTypeOf(p),v=!0;if(y==="uint8array"?v=f.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<k;)try{return f.stringifyByChunk(p,y,k)}catch{k=Math.floor(k/2)}return f.stringifyByChar(p)}function h(p,k){for(var y=0;y<p.length;y++)k[y]=p[y];return k}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,k){if(k=k||"",!p)return k;i.checkSupport(p);var y=i.getTypeOf(k);return m[y][p](k)},i.resolve=function(p){for(var k=p.split("/"),y=[],v=0;v<k.length;v++){var T=k[v];T==="."||T===""&&v!==0&&v!==k.length-1||(T===".."?y.pop():y.push(T))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var k,y,v="";for(y=0;y<(p||"").length;y++)v+="\\x"+((k=p.charCodeAt(y))<16?"0":"")+k.toString(16).toUpperCase();return v},i.delay=function(p,k,y){setImmediate(function(){p.apply(y||null,k||[])})},i.inherits=function(p,k){function y(){}y.prototype=k.prototype,p.prototype=new y},i.extend=function(){var p,k,y={};for(p=0;p<arguments.length;p++)for(k in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],k)&&y[k]===void 0&&(y[k]=arguments[p][k]);return y},i.prepareContent=function(p,k,y,v,T){return c.Promise.resolve(k).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(L,S){var I=new FileReader;I.onload=function(D){L(D.target.result)},I.onerror=function(D){S(D.target.error)},I.readAsArrayBuffer(A)}):A}).then(function(A){var L=i.getTypeOf(A);return L?(L==="arraybuffer"?A=i.transformTo("uint8array",A):L==="string"&&(T?A=o.decode(A):y&&v!==!0&&(A=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=d-h;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,m){this.options=h,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(k){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===k)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,k,y=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<y;)m=h.readInt(2),p=h.readInt(2),k=h.readData(p),this.extraFields[m]={id:m,length:p,value:k};h.setIndex(y)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var k=this.findExtraFieldUnicodeComment();if(k!==null)this.fileCommentStr=k;else{var y=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(m,p,k){this.name=m,this.dir=k.dir,this.date=k.date,this.comment=k.comment,this.unixPermissions=k.unixPermissions,this.dosPermissions=k.dosPermissions,this._data=p,this._dataBinary=k.binary,this.options={compression:k.compression,compressionOptions:k.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,k="string";try{if(!m)throw new Error("No output type specified.");var y=(k=m.toLowerCase())==="string"||k==="text";k!=="binarystring"&&k!=="text"||(k="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(p=p.pipe(new c.Utf8EncodeWorker)),!v&&y&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(T){(p=new u("error")).error(T)}return new o(p,k,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var k=this._decompressWorker();return this._dataBinary||(k=k.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(k,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var h=[];function m(){var p,k;a=!0;for(var y=h.length;y;){for(k=h,h=[],p=-1;++p<y;)k[p]();y=h.length}a=!1}r.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof Un<"u"?Un:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function d(y,v,T){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(y,v,T){s(function(){var A;try{A=v(T)}catch(L){return a.reject(y,L)}A===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,A)})}function m(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function p(y,v){var T=!1;function A(I){T||(T=!0,a.reject(y,I))}function L(I){T||(T=!0,a.resolve(y,I))}var S=k(function(){v(L,A)});S.status==="error"&&A(S.value)}function k(y,v){var T={};try{T.value=y(v),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(T){return v.resolve(y()).then(function(){return T})},function(T){return v.resolve(y()).then(function(){throw T})})},f.prototype.catch=function(y){return this.then(null,y)},f.prototype.then=function(y,v){if(typeof y!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?y:v,this.outcome):this.queue.push(new d(T,y,v)),T},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){h(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){h(this.promise,this.onRejected,y)},a.resolve=function(y,v){var T=k(m,v);if(T.status==="error")return a.reject(y,T.value);var A=T.value;if(A)p(y,A);else{y.state=l,y.outcome=v;for(var L=-1,S=y.queue.length;++L<S;)y.queue[L].callFulfilled(v)}return y},a.reject=function(y,v){y.state=c,y.outcome=v;for(var T=-1,A=y.queue.length;++T<A;)y.queue[T].callRejected(v);return y},f.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},f.reject=function(y){var v=new this(o);return a.reject(v,y)},f.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,A=!1;if(!T)return this.resolve([]);for(var L=new Array(T),S=0,I=-1,D=new this(o);++I<T;)N(y[I],I);return D;function N(W,q){v.resolve(W).then(function(M){L[q]=M,++S!==T||A||(A=!0,a.resolve(D,L))},function(M){A||(A=!0,a.reject(D,M))})}},f.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,A=!1;if(!T)return this.resolve([]);for(var L=-1,S=new this(o);++L<T;)I=y[L],v.resolve(I).then(function(D){A||(A=!0,a.resolve(S,D))},function(D){A||(A=!0,a.reject(S,D))});var I;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(T!==f)throw new Error(c[T]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function k(y,v){var T=new p(v);if(T.push(y,!0),T.err)throw T.msg||c[T.err];return T.result}p.prototype.push=function(y,v){var T,A,L=this.strm,S=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof y=="string"?L.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?L.input=new Uint8Array(y):L.input=y,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new o.Buf8(S),L.next_out=0,L.avail_out=S),(T=s.deflate(L,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(L.output,L.next_out))):this.onData(o.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(L.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=k,i.deflateRaw=function(y,v){return(v=v||{}).raw=!0,k(y,v)},i.gzip=function(y,v){return(v=v||{}).gzip=!0,k(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var k=this.options;k.raw&&0<=k.windowBits&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15)),!(0<=k.windowBits&&k.windowBits<16)||p&&p.windowBits||(k.windowBits+=32),15<k.windowBits&&k.windowBits<48&&!(15&k.windowBits)&&(k.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,k.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function m(p,k){var y=new h(k);if(y.push(p,!0),y.err)throw y.msg||l[y.err];return y.result}h.prototype.push=function(p,k){var y,v,T,A,L,S,I=this.strm,D=this.options.chunkSize,N=this.options.dictionary,W=!1;if(this.ended)return!1;v=k===~~k?k:k===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?I.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?I.input=new Uint8Array(p):I.input=p,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8(D),I.next_out=0,I.avail_out=D),(y=s.inflate(I,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(S=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,y=s.inflateSetDictionary(this.strm,S)),y===c.Z_BUF_ERROR&&W===!0&&(y=c.Z_OK,W=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&y!==c.Z_STREAM_END&&(I.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(I.output,I.next_out),A=I.next_out-T,L=a.buf2string(I.output,T),I.next_out=A,I.avail_out=D-A,A&&o.arraySet(I.output,I.output,T,A,0),this.onData(L)):this.onData(o.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(W=!0)}while((0<I.avail_in||I.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(I.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,k){return(k=k||{}).raw=!0,m(p,k)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,m;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(m=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],m.set(h,d),d+=h.length;return m}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",m=0;m<d;m++)h+=String.fromCharCode(f[m]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,m,p,k,y=f.length,v=0;for(p=0;p<y;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),v+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(v),p=k=0;k<v;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?d[k++]=h:(h<2048?d[k++]=192|h>>>6:(h<65536?d[k++]=224|h>>>12:(d[k++]=240|h>>>18,d[k++]=128|h>>>12&63),d[k++]=128|h>>>6&63),d[k++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,m=d.length;h<m;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,m,p,k,y=d||f.length,v=new Array(2*y);for(h=m=0;h<y;)if((p=f[h++])<128)v[m++]=p;else if(4<(k=c[p]))v[m++]=65533,h+=k-1;else{for(p&=k===2?31:k===3?15:7;1<k&&h<y;)p=p<<6|63&f[h++],k--;1<k?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return u(v,m)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,m=-2,p=-1,k=4,y=2,v=8,T=9,A=286,L=30,S=19,I=2*A+1,D=15,N=3,W=258,q=W+N+1,M=42,O=113,E=1,C=2,$=3,B=4;function st(x,at){return x.msg=u[at],at}function Q(x){return(x<<1)-(4<x?9:0)}function rt(x){for(var at=x.length;0<=--at;)x[at]=0}function z(x){var at=x.state,nt=at.pending;nt>x.avail_out&&(nt=x.avail_out),nt!==0&&(o.arraySet(x.output,at.pending_buf,at.pending_out,nt,x.next_out),x.next_out+=nt,at.pending_out+=nt,x.total_out+=nt,x.avail_out-=nt,at.pending-=nt,at.pending===0&&(at.pending_out=0))}function P(x,at){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,at),x.block_start=x.strstart,z(x.strm)}function ft(x,at){x.pending_buf[x.pending++]=at}function lt(x,at){x.pending_buf[x.pending++]=at>>>8&255,x.pending_buf[x.pending++]=255&at}function ut(x,at){var nt,j,F=x.max_chain_length,V=x.strstart,ht=x.prev_length,pt=x.nice_match,Z=x.strstart>x.w_size-q?x.strstart-(x.w_size-q):0,_t=x.window,vt=x.w_mask,gt=x.prev,Ct=x.strstart+W,fe=_t[V+ht-1],zt=_t[V+ht];x.prev_length>=x.good_match&&(F>>=2),pt>x.lookahead&&(pt=x.lookahead);do if(_t[(nt=at)+ht]===zt&&_t[nt+ht-1]===fe&&_t[nt]===_t[V]&&_t[++nt]===_t[V+1]){V+=2,nt++;do;while(_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&V<Ct);if(j=W-(Ct-V),V=Ct-W,ht<j){if(x.match_start=at,pt<=(ht=j))break;fe=_t[V+ht-1],zt=_t[V+ht]}}while((at=gt[at&vt])>Z&&--F!=0);return ht<=x.lookahead?ht:x.lookahead}function jt(x){var at,nt,j,F,V,ht,pt,Z,_t,vt,gt=x.w_size;do{if(F=x.window_size-x.lookahead-x.strstart,x.strstart>=gt+(gt-q)){for(o.arraySet(x.window,x.window,gt,gt,0),x.match_start-=gt,x.strstart-=gt,x.block_start-=gt,at=nt=x.hash_size;j=x.head[--at],x.head[at]=gt<=j?j-gt:0,--nt;);for(at=nt=gt;j=x.prev[--at],x.prev[at]=gt<=j?j-gt:0,--nt;);F+=gt}if(x.strm.avail_in===0)break;if(ht=x.strm,pt=x.window,Z=x.strstart+x.lookahead,_t=F,vt=void 0,vt=ht.avail_in,_t<vt&&(vt=_t),nt=vt===0?0:(ht.avail_in-=vt,o.arraySet(pt,ht.input,ht.next_in,vt,Z),ht.state.wrap===1?ht.adler=c(ht.adler,pt,vt,Z):ht.state.wrap===2&&(ht.adler=l(ht.adler,pt,vt,Z)),ht.next_in+=vt,ht.total_in+=vt,vt),x.lookahead+=nt,x.lookahead+x.insert>=N)for(V=x.strstart-x.insert,x.ins_h=x.window[V],x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+N-1])&x.hash_mask,x.prev[V&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=V,V++,x.insert--,!(x.lookahead+x.insert<N)););}while(x.lookahead<q&&x.strm.avail_in!==0)}function Qt(x,at){for(var nt,j;;){if(x.lookahead<q){if(jt(x),x.lookahead<q&&at===f)return E;if(x.lookahead===0)break}if(nt=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),nt!==0&&x.strstart-nt<=x.w_size-q&&(x.match_length=ut(x,nt)),x.match_length>=N)if(j=a._tr_tally(x,x.strstart-x.match_start,x.match_length-N),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=N){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else j=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(j&&(P(x,!1),x.strm.avail_out===0))return E}return x.insert=x.strstart<N-1?x.strstart:N-1,at===d?(P(x,!0),x.strm.avail_out===0?$:B):x.last_lit&&(P(x,!1),x.strm.avail_out===0)?E:C}function Dt(x,at){for(var nt,j,F;;){if(x.lookahead<q){if(jt(x),x.lookahead<q&&at===f)return E;if(x.lookahead===0)break}if(nt=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=N-1,nt!==0&&x.prev_length<x.max_lazy_match&&x.strstart-nt<=x.w_size-q&&(x.match_length=ut(x,nt),x.match_length<=5&&(x.strategy===1||x.match_length===N&&4096<x.strstart-x.match_start)&&(x.match_length=N-1)),x.prev_length>=N&&x.match_length<=x.prev_length){for(F=x.strstart+x.lookahead-N,j=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-N),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=F&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=N-1,x.strstart++,j&&(P(x,!1),x.strm.avail_out===0))return E}else if(x.match_available){if((j=a._tr_tally(x,0,x.window[x.strstart-1]))&&P(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return E}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(j=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<N-1?x.strstart:N-1,at===d?(P(x,!0),x.strm.avail_out===0?$:B):x.last_lit&&(P(x,!1),x.strm.avail_out===0)?E:C}function Pt(x,at,nt,j,F){this.good_length=x,this.max_lazy=at,this.nice_length=nt,this.max_chain=j,this.func=F}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*I),this.dyn_dtree=new o.Buf16(2*(2*L+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(D+1),this.heap=new o.Buf16(2*A+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function qt(x){var at;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=y,(at=x.state).pending=0,at.pending_out=0,at.wrap<0&&(at.wrap=-at.wrap),at.status=at.wrap?M:O,x.adler=at.wrap===2?0:1,at.last_flush=f,a._tr_init(at),h):st(x,m)}function Ne(x){var at=qt(x);return at===h&&function(nt){nt.window_size=2*nt.w_size,rt(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=N-1,nt.match_available=0,nt.ins_h=0}(x.state),at}function $e(x,at,nt,j,F,V){if(!x)return m;var ht=1;if(at===p&&(at=6),j<0?(ht=0,j=-j):15<j&&(ht=2,j-=16),F<1||T<F||nt!==v||j<8||15<j||at<0||9<at||V<0||k<V)return st(x,m);j===8&&(j=9);var pt=new le;return(x.state=pt).strm=x,pt.wrap=ht,pt.gzhead=null,pt.w_bits=j,pt.w_size=1<<pt.w_bits,pt.w_mask=pt.w_size-1,pt.hash_bits=F+7,pt.hash_size=1<<pt.hash_bits,pt.hash_mask=pt.hash_size-1,pt.hash_shift=~~((pt.hash_bits+N-1)/N),pt.window=new o.Buf8(2*pt.w_size),pt.head=new o.Buf16(pt.hash_size),pt.prev=new o.Buf16(pt.w_size),pt.lit_bufsize=1<<F+6,pt.pending_buf_size=4*pt.lit_bufsize,pt.pending_buf=new o.Buf8(pt.pending_buf_size),pt.d_buf=1*pt.lit_bufsize,pt.l_buf=3*pt.lit_bufsize,pt.level=at,pt.strategy=V,pt.method=nt,Ne(x)}s=[new Pt(0,0,0,0,function(x,at){var nt=65535;for(nt>x.pending_buf_size-5&&(nt=x.pending_buf_size-5);;){if(x.lookahead<=1){if(jt(x),x.lookahead===0&&at===f)return E;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var j=x.block_start+nt;if((x.strstart===0||x.strstart>=j)&&(x.lookahead=x.strstart-j,x.strstart=j,P(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-q&&(P(x,!1),x.strm.avail_out===0))return E}return x.insert=0,at===d?(P(x,!0),x.strm.avail_out===0?$:B):(x.strstart>x.block_start&&(P(x,!1),x.strm.avail_out),E)}),new Pt(4,4,8,4,Qt),new Pt(4,5,16,8,Qt),new Pt(4,6,32,32,Qt),new Pt(4,4,16,16,Dt),new Pt(8,16,32,32,Dt),new Pt(8,16,128,128,Dt),new Pt(8,32,128,256,Dt),new Pt(32,128,258,1024,Dt),new Pt(32,258,258,4096,Dt)],i.deflateInit=function(x,at){return $e(x,at,v,15,8,0)},i.deflateInit2=$e,i.deflateReset=Ne,i.deflateResetKeep=qt,i.deflateSetHeader=function(x,at){return x&&x.state?x.state.wrap!==2?m:(x.state.gzhead=at,h):m},i.deflate=function(x,at){var nt,j,F,V;if(!x||!x.state||5<at||at<0)return x?st(x,m):m;if(j=x.state,!x.output||!x.input&&x.avail_in!==0||j.status===666&&at!==d)return st(x,x.avail_out===0?-5:m);if(j.strm=x,nt=j.last_flush,j.last_flush=at,j.status===M)if(j.wrap===2)x.adler=0,ft(j,31),ft(j,139),ft(j,8),j.gzhead?(ft(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),ft(j,255&j.gzhead.time),ft(j,j.gzhead.time>>8&255),ft(j,j.gzhead.time>>16&255),ft(j,j.gzhead.time>>24&255),ft(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),ft(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(ft(j,255&j.gzhead.extra.length),ft(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(x.adler=l(x.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(ft(j,0),ft(j,0),ft(j,0),ft(j,0),ft(j,0),ft(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),ft(j,3),j.status=O);else{var ht=v+(j.w_bits-8<<4)<<8;ht|=(2<=j.strategy||j.level<2?0:j.level<6?1:j.level===6?2:3)<<6,j.strstart!==0&&(ht|=32),ht+=31-ht%31,j.status=O,lt(j,ht),j.strstart!==0&&(lt(j,x.adler>>>16),lt(j,65535&x.adler)),x.adler=1}if(j.status===69)if(j.gzhead.extra){for(F=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),z(x),F=j.pending,j.pending!==j.pending_buf_size));)ft(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(j.status===73)if(j.gzhead.name){F=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),z(x),F=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,ft(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),V===0&&(j.gzindex=0,j.status=91)}else j.status=91;if(j.status===91)if(j.gzhead.comment){F=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),z(x),F=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,ft(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>F&&(x.adler=l(x.adler,j.pending_buf,j.pending-F,F)),V===0&&(j.status=103)}else j.status=103;if(j.status===103&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&z(x),j.pending+2<=j.pending_buf_size&&(ft(j,255&x.adler),ft(j,x.adler>>8&255),x.adler=0,j.status=O)):j.status=O),j.pending!==0){if(z(x),x.avail_out===0)return j.last_flush=-1,h}else if(x.avail_in===0&&Q(at)<=Q(nt)&&at!==d)return st(x,-5);if(j.status===666&&x.avail_in!==0)return st(x,-5);if(x.avail_in!==0||j.lookahead!==0||at!==f&&j.status!==666){var pt=j.strategy===2?function(Z,_t){for(var vt;;){if(Z.lookahead===0&&(jt(Z),Z.lookahead===0)){if(_t===f)return E;break}if(Z.match_length=0,vt=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,vt&&(P(Z,!1),Z.strm.avail_out===0))return E}return Z.insert=0,_t===d?(P(Z,!0),Z.strm.avail_out===0?$:B):Z.last_lit&&(P(Z,!1),Z.strm.avail_out===0)?E:C}(j,at):j.strategy===3?function(Z,_t){for(var vt,gt,Ct,fe,zt=Z.window;;){if(Z.lookahead<=W){if(jt(Z),Z.lookahead<=W&&_t===f)return E;if(Z.lookahead===0)break}if(Z.match_length=0,Z.lookahead>=N&&0<Z.strstart&&(gt=zt[Ct=Z.strstart-1])===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]){fe=Z.strstart+W;do;while(gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&Ct<fe);Z.match_length=W-(fe-Ct),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=N?(vt=a._tr_tally(Z,1,Z.match_length-N),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(vt=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),vt&&(P(Z,!1),Z.strm.avail_out===0))return E}return Z.insert=0,_t===d?(P(Z,!0),Z.strm.avail_out===0?$:B):Z.last_lit&&(P(Z,!1),Z.strm.avail_out===0)?E:C}(j,at):s[j.level].func(j,at);if(pt!==$&&pt!==B||(j.status=666),pt===E||pt===$)return x.avail_out===0&&(j.last_flush=-1),h;if(pt===C&&(at===1?a._tr_align(j):at!==5&&(a._tr_stored_block(j,0,0,!1),at===3&&(rt(j.head),j.lookahead===0&&(j.strstart=0,j.block_start=0,j.insert=0))),z(x),x.avail_out===0))return j.last_flush=-1,h}return at!==d?h:j.wrap<=0?1:(j.wrap===2?(ft(j,255&x.adler),ft(j,x.adler>>8&255),ft(j,x.adler>>16&255),ft(j,x.adler>>24&255),ft(j,255&x.total_in),ft(j,x.total_in>>8&255),ft(j,x.total_in>>16&255),ft(j,x.total_in>>24&255)):(lt(j,x.adler>>>16),lt(j,65535&x.adler)),z(x),0<j.wrap&&(j.wrap=-j.wrap),j.pending!==0?h:1)},i.deflateEnd=function(x){var at;return x&&x.state?(at=x.state.status)!==M&&at!==69&&at!==73&&at!==91&&at!==103&&at!==O&&at!==666?st(x,m):(x.state=null,at===O?st(x,-3):h):m},i.deflateSetDictionary=function(x,at){var nt,j,F,V,ht,pt,Z,_t,vt=at.length;if(!x||!x.state||(V=(nt=x.state).wrap)===2||V===1&&nt.status!==M||nt.lookahead)return m;for(V===1&&(x.adler=c(x.adler,at,vt,0)),nt.wrap=0,vt>=nt.w_size&&(V===0&&(rt(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),_t=new o.Buf8(nt.w_size),o.arraySet(_t,at,vt-nt.w_size,nt.w_size,0),at=_t,vt=nt.w_size),ht=x.avail_in,pt=x.next_in,Z=x.input,x.avail_in=vt,x.next_in=0,x.input=at,jt(nt);nt.lookahead>=N;){for(j=nt.strstart,F=nt.lookahead-(N-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[j+N-1])&nt.hash_mask,nt.prev[j&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=j,j++,--F;);nt.strstart=j,nt.lookahead=N-1,jt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=N-1,nt.match_available=0,x.next_in=pt,x.input=Z,x.avail_in=ht,nt.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,m,p,k,y,v,T,A,L,S,I,D,N,W,q,M,O,E,C;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,C=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,k=a.wnext,y=a.window,v=a.hold,T=a.bits,A=a.lencode,L=a.distcode,S=(1<<a.lenbits)-1,I=(1<<a.distbits)-1;t:do{T<15&&(v+=E[c++]<<T,T+=8,v+=E[c++]<<T,T+=8),D=A[v&S];e:for(;;){if(v>>>=N=D>>>24,T-=N,(N=D>>>16&255)===0)C[u++]=65535&D;else{if(!(16&N)){if(!(64&N)){D=A[(65535&D)+(v&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}W=65535&D,(N&=15)&&(T<N&&(v+=E[c++]<<T,T+=8),W+=v&(1<<N)-1,v>>>=N,T-=N),T<15&&(v+=E[c++]<<T,T+=8,v+=E[c++]<<T,T+=8),D=L[v&I];n:for(;;){if(v>>>=N=D>>>24,T-=N,!(16&(N=D>>>16&255))){if(!(64&N)){D=L[(65535&D)+(v&(1<<N)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(q=65535&D,T<(N&=15)&&(v+=E[c++]<<T,(T+=8)<N&&(v+=E[c++]<<T,T+=8)),h<(q+=v&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=N,T-=N,(N=u-f)<q){if(p<(N=q-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(O=y,(M=0)===k){if(M+=m-N,N<W){for(W-=N;C[u++]=y[M++],--N;);M=u-q,O=C}}else if(k<N){if(M+=m+k-N,(N-=k)<W){for(W-=N;C[u++]=y[M++],--N;);if(M=0,k<W){for(W-=N=k;C[u++]=y[M++],--N;);M=u-q,O=C}}}else if(M+=k-N,N<W){for(W-=N;C[u++]=y[M++],--N;);M=u-q,O=C}for(;2<W;)C[u++]=O[M++],C[u++]=O[M++],C[u++]=O[M++],W-=3;W&&(C[u++]=O[M++],1<W&&(C[u++]=O[M++]))}else{for(M=u-q;C[u++]=C[M++],C[u++]=C[M++],C[u++]=C[M++],2<(W-=3););W&&(C[u++]=C[M++],1<W&&(C[u++]=C[M++]))}break}}break}}while(c<l&&u<d);c-=W=T>>3,v&=(1<<(T-=W<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=v,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,m=1,p=852,k=592;function y(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(M){var O;return M&&M.state?(O=M.state,M.total_in=M.total_out=O.total=0,M.msg="",O.wrap&&(M.adler=1&O.wrap),O.mode=m,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(p),O.distcode=O.distdyn=new s.Buf32(k),O.sane=1,O.back=-1,d):h}function A(M){var O;return M&&M.state?((O=M.state).wsize=0,O.whave=0,O.wnext=0,T(M)):h}function L(M,O){var E,C;return M&&M.state?(C=M.state,O<0?(E=0,O=-O):(E=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:(C.window!==null&&C.wbits!==O&&(C.window=null),C.wrap=E,C.wbits=O,A(M))):h}function S(M,O){var E,C;return M?(C=new v,(M.state=C).window=null,(E=L(M,O))!==d&&(M.state=null),E):h}var I,D,N=!0;function W(M){if(N){var O;for(I=new s.Buf32(512),D=new s.Buf32(32),O=0;O<144;)M.lens[O++]=8;for(;O<256;)M.lens[O++]=9;for(;O<280;)M.lens[O++]=7;for(;O<288;)M.lens[O++]=8;for(l(u,M.lens,0,288,I,0,M.work,{bits:9}),O=0;O<32;)M.lens[O++]=5;l(f,M.lens,0,32,D,0,M.work,{bits:5}),N=!1}M.lencode=I,M.lenbits=9,M.distcode=D,M.distbits=5}function q(M,O,E,C){var $,B=M.state;return B.window===null&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new s.Buf8(B.wsize)),C>=B.wsize?(s.arraySet(B.window,O,E-B.wsize,B.wsize,0),B.wnext=0,B.whave=B.wsize):(C<($=B.wsize-B.wnext)&&($=C),s.arraySet(B.window,O,E-C,$,B.wnext),(C-=$)?(s.arraySet(B.window,O,E-C,C,0),B.wnext=C,B.whave=B.wsize):(B.wnext+=$,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=$))),0}i.inflateReset=A,i.inflateReset2=L,i.inflateResetKeep=T,i.inflateInit=function(M){return S(M,15)},i.inflateInit2=S,i.inflate=function(M,O){var E,C,$,B,st,Q,rt,z,P,ft,lt,ut,jt,Qt,Dt,Pt,le,qt,Ne,$e,x,at,nt,j,F=0,V=new s.Buf8(4),ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return h;(E=M.state).mode===12&&(E.mode=13),st=M.next_out,$=M.output,rt=M.avail_out,B=M.next_in,C=M.input,Q=M.avail_in,z=E.hold,P=E.bits,ft=Q,lt=rt,at=d;t:for(;;)switch(E.mode){case m:if(E.wrap===0){E.mode=13;break}for(;P<16;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(2&E.wrap&&z===35615){V[E.check=0]=255&z,V[1]=z>>>8&255,E.check=a(E.check,V,2,0),P=z=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&z)<<8)+(z>>8))%31){M.msg="incorrect header check",E.mode=30;break}if((15&z)!=8){M.msg="unknown compression method",E.mode=30;break}if(P-=4,x=8+(15&(z>>>=4)),E.wbits===0)E.wbits=x;else if(x>E.wbits){M.msg="invalid window size",E.mode=30;break}E.dmax=1<<x,M.adler=E.check=1,E.mode=512&z?10:12,P=z=0;break;case 2:for(;P<16;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(E.flags=z,(255&E.flags)!=8){M.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){M.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=z>>8&1),512&E.flags&&(V[0]=255&z,V[1]=z>>>8&255,E.check=a(E.check,V,2,0)),P=z=0,E.mode=3;case 3:for(;P<32;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}E.head&&(E.head.time=z),512&E.flags&&(V[0]=255&z,V[1]=z>>>8&255,V[2]=z>>>16&255,V[3]=z>>>24&255,E.check=a(E.check,V,4,0)),P=z=0,E.mode=4;case 4:for(;P<16;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}E.head&&(E.head.xflags=255&z,E.head.os=z>>8),512&E.flags&&(V[0]=255&z,V[1]=z>>>8&255,E.check=a(E.check,V,2,0)),P=z=0,E.mode=5;case 5:if(1024&E.flags){for(;P<16;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}E.length=z,E.head&&(E.head.extra_len=z),512&E.flags&&(V[0]=255&z,V[1]=z>>>8&255,E.check=a(E.check,V,2,0)),P=z=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(Q<(ut=E.length)&&(ut=Q),ut&&(E.head&&(x=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,C,B,ut,x)),512&E.flags&&(E.check=a(E.check,C,ut,B)),Q-=ut,B+=ut,E.length-=ut),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(Q===0)break t;for(ut=0;x=C[B+ut++],E.head&&x&&E.length<65536&&(E.head.name+=String.fromCharCode(x)),x&&ut<Q;);if(512&E.flags&&(E.check=a(E.check,C,ut,B)),Q-=ut,B+=ut,x)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(Q===0)break t;for(ut=0;x=C[B+ut++],E.head&&x&&E.length<65536&&(E.head.comment+=String.fromCharCode(x)),x&&ut<Q;);if(512&E.flags&&(E.check=a(E.check,C,ut,B)),Q-=ut,B+=ut,x)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;P<16;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(z!==(65535&E.check)){M.msg="header crc mismatch",E.mode=30;break}P=z=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),M.adler=E.check=0,E.mode=12;break;case 10:for(;P<32;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}M.adler=E.check=y(z),P=z=0,E.mode=11;case 11:if(E.havedict===0)return M.next_out=st,M.avail_out=rt,M.next_in=B,M.avail_in=Q,E.hold=z,E.bits=P,2;M.adler=E.check=1,E.mode=12;case 12:if(O===5||O===6)break t;case 13:if(E.last){z>>>=7&P,P-=7&P,E.mode=27;break}for(;P<3;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}switch(E.last=1&z,P-=1,3&(z>>>=1)){case 0:E.mode=14;break;case 1:if(W(E),E.mode=20,O!==6)break;z>>>=2,P-=2;break t;case 2:E.mode=17;break;case 3:M.msg="invalid block type",E.mode=30}z>>>=2,P-=2;break;case 14:for(z>>>=7&P,P-=7&P;P<32;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if((65535&z)!=(z>>>16^65535)){M.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&z,P=z=0,E.mode=15,O===6)break t;case 15:E.mode=16;case 16:if(ut=E.length){if(Q<ut&&(ut=Q),rt<ut&&(ut=rt),ut===0)break t;s.arraySet($,C,B,ut,st),Q-=ut,B+=ut,rt-=ut,st+=ut,E.length-=ut;break}E.mode=12;break;case 17:for(;P<14;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(E.nlen=257+(31&z),z>>>=5,P-=5,E.ndist=1+(31&z),z>>>=5,P-=5,E.ncode=4+(15&z),z>>>=4,P-=4,286<E.nlen||30<E.ndist){M.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;P<3;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}E.lens[ht[E.have++]]=7&z,z>>>=3,P-=3}for(;E.have<19;)E.lens[ht[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,nt={bits:E.lenbits},at=l(0,E.lens,0,19,E.lencode,0,E.work,nt),E.lenbits=nt.bits,at){M.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Pt=(F=E.lencode[z&(1<<E.lenbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(le<16)z>>>=Dt,P-=Dt,E.lens[E.have++]=le;else{if(le===16){for(j=Dt+2;P<j;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(z>>>=Dt,P-=Dt,E.have===0){M.msg="invalid bit length repeat",E.mode=30;break}x=E.lens[E.have-1],ut=3+(3&z),z>>>=2,P-=2}else if(le===17){for(j=Dt+3;P<j;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}P-=Dt,x=0,ut=3+(7&(z>>>=Dt)),z>>>=3,P-=3}else{for(j=Dt+7;P<j;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}P-=Dt,x=0,ut=11+(127&(z>>>=Dt)),z>>>=7,P-=7}if(E.have+ut>E.nlen+E.ndist){M.msg="invalid bit length repeat",E.mode=30;break}for(;ut--;)E.lens[E.have++]=x}}if(E.mode===30)break;if(E.lens[256]===0){M.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,nt={bits:E.lenbits},at=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,nt),E.lenbits=nt.bits,at){M.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,nt={bits:E.distbits},at=l(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,nt),E.distbits=nt.bits,at){M.msg="invalid distances set",E.mode=30;break}if(E.mode=20,O===6)break t;case 20:E.mode=21;case 21:if(6<=Q&&258<=rt){M.next_out=st,M.avail_out=rt,M.next_in=B,M.avail_in=Q,E.hold=z,E.bits=P,c(M,lt),st=M.next_out,$=M.output,rt=M.avail_out,B=M.next_in,C=M.input,Q=M.avail_in,z=E.hold,P=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Pt=(F=E.lencode[z&(1<<E.lenbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(Pt&&!(240&Pt)){for(qt=Dt,Ne=Pt,$e=le;Pt=(F=E.lencode[$e+((z&(1<<qt+Ne)-1)>>qt)])>>>16&255,le=65535&F,!(qt+(Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}z>>>=qt,P-=qt,E.back+=qt}if(z>>>=Dt,P-=Dt,E.back+=Dt,E.length=le,Pt===0){E.mode=26;break}if(32&Pt){E.back=-1,E.mode=12;break}if(64&Pt){M.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Pt,E.mode=22;case 22:if(E.extra){for(j=E.extra;P<j;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}E.length+=z&(1<<E.extra)-1,z>>>=E.extra,P-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Pt=(F=E.distcode[z&(1<<E.distbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(!(240&Pt)){for(qt=Dt,Ne=Pt,$e=le;Pt=(F=E.distcode[$e+((z&(1<<qt+Ne)-1)>>qt)])>>>16&255,le=65535&F,!(qt+(Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}z>>>=qt,P-=qt,E.back+=qt}if(z>>>=Dt,P-=Dt,E.back+=Dt,64&Pt){M.msg="invalid distance code",E.mode=30;break}E.offset=le,E.extra=15&Pt,E.mode=24;case 24:if(E.extra){for(j=E.extra;P<j;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}E.offset+=z&(1<<E.extra)-1,z>>>=E.extra,P-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){M.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(rt===0)break t;if(ut=lt-rt,E.offset>ut){if((ut=E.offset-ut)>E.whave&&E.sane){M.msg="invalid distance too far back",E.mode=30;break}jt=ut>E.wnext?(ut-=E.wnext,E.wsize-ut):E.wnext-ut,ut>E.length&&(ut=E.length),Qt=E.window}else Qt=$,jt=st-E.offset,ut=E.length;for(rt<ut&&(ut=rt),rt-=ut,E.length-=ut;$[st++]=Qt[jt++],--ut;);E.length===0&&(E.mode=21);break;case 26:if(rt===0)break t;$[st++]=E.length,rt--,E.mode=21;break;case 27:if(E.wrap){for(;P<32;){if(Q===0)break t;Q--,z|=C[B++]<<P,P+=8}if(lt-=rt,M.total_out+=lt,E.total+=lt,lt&&(M.adler=E.check=E.flags?a(E.check,$,lt,st-lt):o(E.check,$,lt,st-lt)),lt=rt,(E.flags?z:y(z))!==E.check){M.msg="incorrect data check",E.mode=30;break}P=z=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;P<32;){if(Q===0)break t;Q--,z+=C[B++]<<P,P+=8}if(z!==(4294967295&E.total)){M.msg="incorrect length check",E.mode=30;break}P=z=0}E.mode=29;case 29:at=1;break t;case 30:at=-3;break t;case 31:return-4;case 32:default:return h}return M.next_out=st,M.avail_out=rt,M.next_in=B,M.avail_in=Q,E.hold=z,E.bits=P,(E.wsize||lt!==M.avail_out&&E.mode<30&&(E.mode<27||O!==4))&&q(M,M.output,M.next_out,lt-M.avail_out)?(E.mode=31,-4):(ft-=M.avail_in,lt-=M.avail_out,M.total_in+=ft,M.total_out+=lt,E.total+=lt,E.wrap&&lt&&(M.adler=E.check=E.flags?a(E.check,$,lt,M.next_out-lt):o(E.check,$,lt,M.next_out-lt)),M.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(ft==0&&lt===0||O===4)&&at===d&&(at=-5),at)},i.inflateEnd=function(M){if(!M||!M.state)return h;var O=M.state;return O.window&&(O.window=null),M.state=null,d},i.inflateGetHeader=function(M,O){var E;return M&&M.state&&2&(E=M.state).wrap?((E.head=O).done=!1,d):h},i.inflateSetDictionary=function(M,O){var E,C=O.length;return M&&M.state?(E=M.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,O,C,0)!==E.check?-3:q(M,O,C,C)?(E.mode=31,-4):(E.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,m,p,k,y){var v,T,A,L,S,I,D,N,W,q=y.bits,M=0,O=0,E=0,C=0,$=0,B=0,st=0,Q=0,rt=0,z=0,P=null,ft=0,lt=new s.Buf16(16),ut=new s.Buf16(16),jt=null,Qt=0;for(M=0;M<=15;M++)lt[M]=0;for(O=0;O<h;O++)lt[f[d+O]]++;for($=q,C=15;1<=C&&lt[C]===0;C--);if(C<$&&($=C),C===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(E=1;E<C&&lt[E]===0;E++);for($<E&&($=E),M=Q=1;M<=15;M++)if(Q<<=1,(Q-=lt[M])<0)return-1;if(0<Q&&(u===0||C!==1))return-1;for(ut[1]=0,M=1;M<15;M++)ut[M+1]=ut[M]+lt[M];for(O=0;O<h;O++)f[d+O]!==0&&(k[ut[f[d+O]]++]=O);if(I=u===0?(P=jt=k,19):u===1?(P=o,ft-=257,jt=a,Qt-=257,256):(P=c,jt=l,-1),M=E,S=p,st=O=z=0,A=-1,L=(rt=1<<(B=$))-1,u===1&&852<rt||u===2&&592<rt)return 1;for(;;){for(D=M-st,W=k[O]<I?(N=0,k[O]):k[O]>I?(N=jt[Qt+k[O]],P[ft+k[O]]):(N=96,0),v=1<<M-st,E=T=1<<B;m[S+(z>>st)+(T-=v)]=D<<24|N<<16|W|0,T!==0;);for(v=1<<M-1;z&v;)v>>=1;if(v!==0?(z&=v-1,z+=v):z=0,O++,--lt[M]==0){if(M===C)break;M=f[d+k[O]]}if($<M&&(z&L)!==A){for(st===0&&(st=$),S+=E,Q=1<<(B=M-st);B+st<C&&!((Q-=lt[B+st])<=0);)B++,Q<<=1;if(rt+=1<<B,u===1&&852<rt||u===2&&592<rt)return 1;m[A=z&L]=$<<24|B<<16|S-p|0}}return z!==0&&(m[S+z]=M-st<<24|64<<16|0),y.bits=$,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var V=F.length;0<=--V;)F[V]=0}var l=0,u=29,f=256,d=f+1+u,h=30,m=19,p=2*d+1,k=15,y=16,v=7,T=256,A=16,L=17,S=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(d+2));c(q);var M=new Array(2*h);c(M);var O=new Array(512);c(O);var E=new Array(256);c(E);var C=new Array(u);c(C);var $,B,st,Q=new Array(h);function rt(F,V,ht,pt,Z){this.static_tree=F,this.extra_bits=V,this.extra_base=ht,this.elems=pt,this.max_length=Z,this.has_stree=F&&F.length}function z(F,V){this.dyn_tree=F,this.max_code=0,this.stat_desc=V}function P(F){return F<256?O[F]:O[256+(F>>>7)]}function ft(F,V){F.pending_buf[F.pending++]=255&V,F.pending_buf[F.pending++]=V>>>8&255}function lt(F,V,ht){F.bi_valid>y-ht?(F.bi_buf|=V<<F.bi_valid&65535,ft(F,F.bi_buf),F.bi_buf=V>>y-F.bi_valid,F.bi_valid+=ht-y):(F.bi_buf|=V<<F.bi_valid&65535,F.bi_valid+=ht)}function ut(F,V,ht){lt(F,ht[2*V],ht[2*V+1])}function jt(F,V){for(var ht=0;ht|=1&F,F>>>=1,ht<<=1,0<--V;);return ht>>>1}function Qt(F,V,ht){var pt,Z,_t=new Array(k+1),vt=0;for(pt=1;pt<=k;pt++)_t[pt]=vt=vt+ht[pt-1]<<1;for(Z=0;Z<=V;Z++){var gt=F[2*Z+1];gt!==0&&(F[2*Z]=jt(_t[gt]++,gt))}}function Dt(F){var V;for(V=0;V<d;V++)F.dyn_ltree[2*V]=0;for(V=0;V<h;V++)F.dyn_dtree[2*V]=0;for(V=0;V<m;V++)F.bl_tree[2*V]=0;F.dyn_ltree[2*T]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Pt(F){8<F.bi_valid?ft(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function le(F,V,ht,pt){var Z=2*V,_t=2*ht;return F[Z]<F[_t]||F[Z]===F[_t]&&pt[V]<=pt[ht]}function qt(F,V,ht){for(var pt=F.heap[ht],Z=ht<<1;Z<=F.heap_len&&(Z<F.heap_len&&le(V,F.heap[Z+1],F.heap[Z],F.depth)&&Z++,!le(V,pt,F.heap[Z],F.depth));)F.heap[ht]=F.heap[Z],ht=Z,Z<<=1;F.heap[ht]=pt}function Ne(F,V,ht){var pt,Z,_t,vt,gt=0;if(F.last_lit!==0)for(;pt=F.pending_buf[F.d_buf+2*gt]<<8|F.pending_buf[F.d_buf+2*gt+1],Z=F.pending_buf[F.l_buf+gt],gt++,pt===0?ut(F,Z,V):(ut(F,(_t=E[Z])+f+1,V),(vt=I[_t])!==0&&lt(F,Z-=C[_t],vt),ut(F,_t=P(--pt),ht),(vt=D[_t])!==0&&lt(F,pt-=Q[_t],vt)),gt<F.last_lit;);ut(F,T,V)}function $e(F,V){var ht,pt,Z,_t=V.dyn_tree,vt=V.stat_desc.static_tree,gt=V.stat_desc.has_stree,Ct=V.stat_desc.elems,fe=-1;for(F.heap_len=0,F.heap_max=p,ht=0;ht<Ct;ht++)_t[2*ht]!==0?(F.heap[++F.heap_len]=fe=ht,F.depth[ht]=0):_t[2*ht+1]=0;for(;F.heap_len<2;)_t[2*(Z=F.heap[++F.heap_len]=fe<2?++fe:0)]=1,F.depth[Z]=0,F.opt_len--,gt&&(F.static_len-=vt[2*Z+1]);for(V.max_code=fe,ht=F.heap_len>>1;1<=ht;ht--)qt(F,_t,ht);for(Z=Ct;ht=F.heap[1],F.heap[1]=F.heap[F.heap_len--],qt(F,_t,1),pt=F.heap[1],F.heap[--F.heap_max]=ht,F.heap[--F.heap_max]=pt,_t[2*Z]=_t[2*ht]+_t[2*pt],F.depth[Z]=(F.depth[ht]>=F.depth[pt]?F.depth[ht]:F.depth[pt])+1,_t[2*ht+1]=_t[2*pt+1]=Z,F.heap[1]=Z++,qt(F,_t,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(zt,Xn){var R,g,_,U,G,tt,ot=Xn.dyn_tree,Ht=Xn.max_code,Ie=Xn.stat_desc.static_tree,we=Xn.stat_desc.has_stree,Ce=Xn.stat_desc.extra_bits,he=Xn.stat_desc.extra_base,Wa=Xn.stat_desc.max_length,ou=0;for(U=0;U<=k;U++)zt.bl_count[U]=0;for(ot[2*zt.heap[zt.heap_max]+1]=0,R=zt.heap_max+1;R<p;R++)Wa<(U=ot[2*ot[2*(g=zt.heap[R])+1]+1]+1)&&(U=Wa,ou++),ot[2*g+1]=U,Ht<g||(zt.bl_count[U]++,G=0,he<=g&&(G=Ce[g-he]),tt=ot[2*g],zt.opt_len+=tt*(U+G),we&&(zt.static_len+=tt*(Ie[2*g+1]+G)));if(ou!==0){do{for(U=Wa-1;zt.bl_count[U]===0;)U--;zt.bl_count[U]--,zt.bl_count[U+1]+=2,zt.bl_count[Wa]--,ou-=2}while(0<ou);for(U=Wa;U!==0;U--)for(g=zt.bl_count[U];g!==0;)Ht<(_=zt.heap[--R])||(ot[2*_+1]!==U&&(zt.opt_len+=(U-ot[2*_+1])*ot[2*_],ot[2*_+1]=U),g--)}}(F,V),Qt(_t,fe,F.bl_count)}function x(F,V,ht){var pt,Z,_t=-1,vt=V[1],gt=0,Ct=7,fe=4;for(vt===0&&(Ct=138,fe=3),V[2*(ht+1)+1]=65535,pt=0;pt<=ht;pt++)Z=vt,vt=V[2*(pt+1)+1],++gt<Ct&&Z===vt||(gt<fe?F.bl_tree[2*Z]+=gt:Z!==0?(Z!==_t&&F.bl_tree[2*Z]++,F.bl_tree[2*A]++):gt<=10?F.bl_tree[2*L]++:F.bl_tree[2*S]++,_t=Z,fe=(gt=0)===vt?(Ct=138,3):Z===vt?(Ct=6,3):(Ct=7,4))}function at(F,V,ht){var pt,Z,_t=-1,vt=V[1],gt=0,Ct=7,fe=4;for(vt===0&&(Ct=138,fe=3),pt=0;pt<=ht;pt++)if(Z=vt,vt=V[2*(pt+1)+1],!(++gt<Ct&&Z===vt)){if(gt<fe)for(;ut(F,Z,F.bl_tree),--gt!=0;);else Z!==0?(Z!==_t&&(ut(F,Z,F.bl_tree),gt--),ut(F,A,F.bl_tree),lt(F,gt-3,2)):gt<=10?(ut(F,L,F.bl_tree),lt(F,gt-3,3)):(ut(F,S,F.bl_tree),lt(F,gt-11,7));_t=Z,fe=(gt=0)===vt?(Ct=138,3):Z===vt?(Ct=6,3):(Ct=7,4)}}c(Q);var nt=!1;function j(F,V,ht,pt){lt(F,(l<<1)+(pt?1:0),3),function(Z,_t,vt,gt){Pt(Z),ft(Z,vt),ft(Z,~vt),s.arraySet(Z.pending_buf,Z.window,_t,vt,Z.pending),Z.pending+=vt}(F,V,ht)}i._tr_init=function(F){nt||(function(){var V,ht,pt,Z,_t,vt=new Array(k+1);for(Z=pt=0;Z<u-1;Z++)for(C[Z]=pt,V=0;V<1<<I[Z];V++)E[pt++]=Z;for(E[pt-1]=Z,Z=_t=0;Z<16;Z++)for(Q[Z]=_t,V=0;V<1<<D[Z];V++)O[_t++]=Z;for(_t>>=7;Z<h;Z++)for(Q[Z]=_t<<7,V=0;V<1<<D[Z]-7;V++)O[256+_t++]=Z;for(ht=0;ht<=k;ht++)vt[ht]=0;for(V=0;V<=143;)q[2*V+1]=8,V++,vt[8]++;for(;V<=255;)q[2*V+1]=9,V++,vt[9]++;for(;V<=279;)q[2*V+1]=7,V++,vt[7]++;for(;V<=287;)q[2*V+1]=8,V++,vt[8]++;for(Qt(q,d+1,vt),V=0;V<h;V++)M[2*V+1]=5,M[2*V]=jt(V,5);$=new rt(q,I,f+1,d,k),B=new rt(M,D,0,h,k),st=new rt(new Array(0),N,0,m,v)}(),nt=!0),F.l_desc=new z(F.dyn_ltree,$),F.d_desc=new z(F.dyn_dtree,B),F.bl_desc=new z(F.bl_tree,st),F.bi_buf=0,F.bi_valid=0,Dt(F)},i._tr_stored_block=j,i._tr_flush_block=function(F,V,ht,pt){var Z,_t,vt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(gt){var Ct,fe=4093624447;for(Ct=0;Ct<=31;Ct++,fe>>>=1)if(1&fe&&gt.dyn_ltree[2*Ct]!==0)return o;if(gt.dyn_ltree[18]!==0||gt.dyn_ltree[20]!==0||gt.dyn_ltree[26]!==0)return a;for(Ct=32;Ct<f;Ct++)if(gt.dyn_ltree[2*Ct]!==0)return a;return o}(F)),$e(F,F.l_desc),$e(F,F.d_desc),vt=function(gt){var Ct;for(x(gt,gt.dyn_ltree,gt.l_desc.max_code),x(gt,gt.dyn_dtree,gt.d_desc.max_code),$e(gt,gt.bl_desc),Ct=m-1;3<=Ct&&gt.bl_tree[2*W[Ct]+1]===0;Ct--);return gt.opt_len+=3*(Ct+1)+5+5+4,Ct}(F),Z=F.opt_len+3+7>>>3,(_t=F.static_len+3+7>>>3)<=Z&&(Z=_t)):Z=_t=ht+5,ht+4<=Z&&V!==-1?j(F,V,ht,pt):F.strategy===4||_t===Z?(lt(F,2+(pt?1:0),3),Ne(F,q,M)):(lt(F,4+(pt?1:0),3),function(gt,Ct,fe,zt){var Xn;for(lt(gt,Ct-257,5),lt(gt,fe-1,5),lt(gt,zt-4,4),Xn=0;Xn<zt;Xn++)lt(gt,gt.bl_tree[2*W[Xn]+1],3);at(gt,gt.dyn_ltree,Ct-1),at(gt,gt.dyn_dtree,fe-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,vt+1),Ne(F,F.dyn_ltree,F.dyn_dtree)),Dt(F),pt&&Pt(F)},i._tr_tally=function(F,V,ht){return F.pending_buf[F.d_buf+2*F.last_lit]=V>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&V,F.pending_buf[F.l_buf+F.last_lit]=255&ht,F.last_lit++,V===0?F.dyn_ltree[2*ht]++:(F.matches++,V--,F.dyn_ltree[2*(E[ht]+f+1)]++,F.dyn_dtree[2*P(V)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){lt(F,2,3),ut(F,T,q),function(V){V.bi_valid===16?(ft(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},m=!1,p=o.document,k=Object.getPrototypeOf&&Object.getPrototypeOf(o);k=k&&k.setTimeout?k:o,c={}.toString.call(o.process)==="[object process]"?function(A){vr.nextTick(function(){v(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,L=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=L,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){u.port2.postMessage(A)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(A){var L=p.createElement("script");L.onreadystatechange=function(){v(A),L.onreadystatechange=null,l.removeChild(L),L=null},l.appendChild(L)}):function(A){setTimeout(v,0,A)},k.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var L=new Array(arguments.length-1),S=0;S<L.length;S++)L[S]=arguments[S+1];var I={callback:A,args:L};return h[d]=I,c(d),d++},k.clearImmediate=y}function y(A){delete h[A]}function v(A){if(m)setTimeout(v,0,A);else{var L=h[A];if(L){m=!0;try{(function(S){var I=S.callback,D=S.args;switch(D.length){case 0:I();break;case 1:I(D[0]);break;case 2:I(D[0],D[1]);break;case 3:I(D[0],D[1],D[2]);break;default:I.apply(a,D)}})(L)}finally{y(A),m=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&v(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Un<"u"?Un:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Fw);var i$=Fw.exports,Ld=Fs(i$);const Bw={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Bw);var Er=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Io,za,Us;class s${constructor(...t){Io.set(this,new Map),za.set(this,new Map),Us.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Er(this,Us,"f").has(r)||Er(this,Us,"f").set(r,new Set);const s=Er(this,Us,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Er(this,za,"f").set(r,a),o=!1,c)continue;const l=Er(this,Io,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Er(this,Io,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:Er(this,Io,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&Er(this,za,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Er(this,Us,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of Er(this,Us,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Er(this,Io,"f"),extensions:Er(this,za,"f")}}}Io=new WeakMap,za=new WeakMap,Us=new WeakMap;var o$=new s$(Bw)._freeze();function a$(e,t){console.info(t)}function c$(e,t){console.info(t)}const Pw=60,l$=Pw*25;function u$(e,t){let n=0;const r=new DataView(t.buffer);function i(){const C=r.getUint8(n);return n++,C}function s(){const C=r.getInt16(n,!0);return n+=2,C}function o(){const C=r.getInt32(n,!0);return n+=4,C}function a(C){let $="";const B=t.subarray(n,n+C);for(let st=0;st<B.length;++st)$+=String.fromCharCode(B[st]);return n+=C,$.replace("\r",`
`)}function c(C,$,B,st){const Q=Dr(C,$,B);if(b(Q)&&b(st)){const rt=Jn(st);for(let z=0;z<rt.length;++z){const P=rt[z];Q[P]=st[P]}}if(b($)){const[rt]=$;rt==="scroll"&&console.info("writefromkind",rt,"-",Q,"-")}}function l(C){let $="";for(let B=0;B<C.length;++B){const st=C.charCodeAt(B);st<32||st>127?$+=`$${st}`:$+=C[B]}return $}function u(C){return C.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map($=>{if($.includes("$")){const[B,...st]=$.split("$");return`${B??""}"$CENTER ${l(st.join("$"))}"`}return l($)}).join(`
`)}function f(C,$,B,st,Q){const z=[Lt[st.color%16]],P={},ft=Q.find(lt=>lt.x===$&&lt.y===B);switch(b(ft)&&(xt(ft.cycle)&&ft.cycle>0&&(P.cycle=ft.cycle),b(ft.p1)&&(P.p1=ft.p1),b(ft.p2)&&(P.p2=ft.p2),b(ft.p3)&&(P.p3=ft.p3),b(ft.code)&&ft.code&&(P.code=u(ft.code))),st.element){case 0:case 1:case 2:case 3:case 4:break;case 5:c(C,["ammo",z],{x:$,y:B},P);break;case 6:c(C,["torch",z],{x:$,y:B},P);break;case 7:c(C,["gem",z],{x:$,y:B},P);break;case 8:c(C,["key",z],{x:$,y:B},P);break;case 9:c(C,["door",z],{x:$,y:B},P);break;case 10:c(C,["scroll",z],{x:$,y:B},P);break;case 11:c(C,["passage",z],{x:$,y:B},{...P,p3:d(ft==null?void 0:ft.p3)??""});break;case 12:c(C,["duplicator",z],{x:$,y:B},P);break;case 13:c(C,["bomb",z],{x:$,y:B},P);break;case 14:c(C,["energize",z],{x:$,y:B},P);break;case 15:c(C,["star",z],{x:$,y:B},P);break;case 16:c(C,["clockwise",z],{x:$,y:B},P);break;case 17:c(C,["counter",z],{x:$,y:B},P);break;case 18:c(C,["bullet",z],{x:$,y:B},P);break;case 19:c(C,["water",z],{x:$,y:B},P);break;case 20:c(C,["forest",z],{x:$,y:B},P);break;case 21:c(C,["solid",z],{x:$,y:B},P);break;case 22:c(C,["normal",z],{x:$,y:B},P);break;case 23:c(C,["breakable",z],{x:$,y:B},P);break;case 24:c(C,["boulder",z],{x:$,y:B},P);break;case 25:c(C,["sliderns",z],{x:$,y:B},P);break;case 26:c(C,["sliderew",z],{x:$,y:B},P);break;case 27:c(C,["fake",z],{x:$,y:B},P);break;case 28:c(C,["invisible",z],{x:$,y:B},P);break;case 29:c(C,["blinkwall",z],{x:$,y:B},P);break;case 30:c(C,["transporter",z],{x:$,y:B},P);break;case 31:c(C,["line",z],{x:$,y:B},P);break;case 32:c(C,["ricochet",z],{x:$,y:B},P);break;case 33:c(C,["blinkns",z],{x:$,y:B},P);break;case 34:c(C,["bear",z],{x:$,y:B},P);break;case 35:c(C,["ruffian",z],{x:$,y:B},P);break;case 36:c(C,["object",z],{x:$,y:B},{...P,char:(ft==null?void 0:ft.p1)??1});break;case 37:c(C,["slime",z],{x:$,y:B},P);break;case 38:c(C,["shark",z],{x:$,y:B},P);break;case 39:c(C,["spinninggun",z],{x:$,y:B},P);break;case 40:c(C,["pusher",z],{x:$,y:B},P);break;case 41:c(C,["lion",z],{x:$,y:B},P);break;case 42:c(C,["tiger",z],{x:$,y:B},P);break;case 43:c(C,["blinkns",z],{x:$,y:B},P);break;case 44:c(C,["head",z],{x:$,y:B},P);break;case 45:c(C,["segment",z],{x:$,y:B},P);break;case 46:break;case 47:c(C,["text",["WHITE","ONDKBLUE"]],{x:$,y:B},{...P,char:st.color});break;case 48:c(C,["text",["WHITE","ONDKGREEN"]],{x:$,y:B},{...P,char:st.color});break;case 49:c(C,["text",["WHITE","ONDKCYAN"]],{x:$,y:B},{...P,char:st.color});break;case 50:c(C,["text",["WHITE","ONDKRED"]],{x:$,y:B},{...P,char:st.color});break;case 51:c(C,["text",["WHITE","ONDKPURPLE"]],{x:$,y:B},{...P,char:st.color});break;case 52:c(C,["text",["WHITE","ONDKYELLOW"]],{x:$,y:B},{...P,char:st.color});break;case 53:c(C,["text",["WHITE","ONBLACK"]],{x:$,y:B},{...P,char:st.color});break}}function d(C){if(xt(C)&&C>0)return`zztboard${C}`}if(s()!=-1)return;const m=s(),p=s(),k=s(),y=a(7),v=s(),T=s(),A=s(),L=s(),S=s();s();const I=s(),D=i(),N=a(20).slice(0,D);for(let C=0;C<9;C++){const $=i();a(20).slice(0,$)}const W=s(),q=s(),M=i();console.info(p,k,y,v,T,A,L,S,I,W,q,M),n=512;const O=[];for(let C=0;C<m;++C){const $=s(),B=n,st=i(),rt={boardname:a(50).slice(0,st),elements:[],stats:[]};for(;rt.elements.length<l$;){let P=i();P===0&&(P=255);const ft=i(),lt=i();for(let ut=0;ut<P;++ut)rt.elements.push({element:ft,color:lt})}rt.maxplayershots=i(),rt.isdark=i(),rt.exitnorth=i(),rt.exitsouth=i(),rt.exitwest=i(),rt.exiteast=i(),rt.restartonzap=i(),rt.messagelength=i(),rt.message=a(58).slice(0,rt.messagelength),rt.playerenterx=i(),rt.playerentery=i(),rt.timelimit=s(),n+=16;const z=s()+1;for(;rt.stats.length<z;){const P={};P.x=i()-1,P.y=i()-1,P.stepx=s(),P.stepy=s(),P.cycle=s(),P.p1=i(),P.p2=i(),P.p3=i(),P.follower=s(),P.leader=s(),P.underelement=i(),P.undercolor=i(),P.pointer=o(),P.currentinstruction=s();const ft=s();n+=8,ft<0?P.bind=Math.abs(ft):P.code=a(ft),rt.stats.push(P)}O.push(rt),n=B+$}const E=Zf([]);E.name=N;for(let C=0;C<O.length;++C){const $=O[C],B=[`@zztboard${C}`,""];C===T&&B.push("@title"),xt($.maxplayershots)&&B.push(`@maxplayershots ${$.maxplayershots}`),$.isdark&&B.push("@isdark"),$.restartonzap&&B.push("@restartonzap"),xt($.timelimit)&&B.push(`@timelimit ${$.timelimit}`);const st=d($.exitnorth);yt(st)&&B.push(`@exitnorth ${st}`);const Q=d($.exitsouth);yt(Q)&&B.push(`@exitsouth ${Q}`);const rt=d($.exitwest);yt(rt)&&B.push(`@exitwest ${rt}`);const z=d($.exiteast);yt(z)&&B.push(`@exiteast ${z}`);const P=`@board ${String(C).padStart(3,"0")}. ${$.boardname}
${B.join(`
`)}`,ft=ck(P,{});ed(E,ft);const lt=Re(ft);if(!b(lt))continue;let ut=0,jt=0;for(let Qt=0;Qt<$.elements.length;++Qt){const Dt=$.elements[Qt];f(lt,ut,jt,Dt,$.stats),++ut,ut===Pw&&(ut=0,++jt)}Se(lt)}Xl(E),Qd(et,e,`imported zzt file into ${E.name} book`)}function $w(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return o$.getType(e)??"application/octet-stream"}async function h$(e,t,n){try{xe(et,e,"parsezipfile",t.name);const r=await t.arrayBuffer();(await new Ld().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=$w(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{de(et,e,"crash",c.message)})})}catch(r){de(et,e,"crash",r.message)}}function Dw(e,t,n){if(b(n))switch(t){case"text/plain":n.text().then(r=>ku(et,e,void 0,"text",`file:${n.name}`,r)).catch(r=>de(et,e,"crash",r.message));break;case"application/json":n.text().then(r=>ku(et,e,void 0,"json",`file:${n.name}`,r)).catch(r=>de(et,e,"crash",r.message));break;case"application/zip":h$(e,n,r=>jw(e,r)).catch(r=>de(et,e,"crash",r.message));break;case"application/octet-stream":/.zzt$/i.test(n.name)&&n.arrayBuffer().then(r=>{u$(e,new Uint8Array(r))}).catch(r=>de(et,e,"crash",r.message)),/.zzl$/i.test(n.name)&&n.text().then(r=>{a$(e,r)}).catch(r=>de(et,e,"crash",r.message)),/.zzm$/i.test(n.name)&&n.text().then(r=>{c$(e,r)}).catch(r=>de(et,e,"crash",r.message));break;default:n.arrayBuffer().then(r=>{const i=$w(n.name,new Uint8Array(r));if(i)Dw(e,i,n);else return de(et,e,"parsewebfile",`unsupported file ${n.name}`)}).catch(r=>de(et,e,"crash",r.message));return}}function jw(e,t){Dw(e,(t==null?void 0:t.type)??"",t)}function hi(e,t,n){n().catch(r=>{console.error(r),de(e,t,"crash",r==null?void 0:r.message)})}function f$(e){const[t,n]=e.split(":"),r=b(n);return[r?t:"self",r?n:e]}function d$(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function p$(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const m$=new Date("1980/09/02");async function Md(e){return console.info("saved",e),new Promise((t,n)=>{const r=new Ld;for(let i=0;i<e.length;++i){const s=e[i],o=pU(s);if(o){const a=AS(o);b(a)&&r.file(s.id,a,{date:m$})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(p$(i))}).catch(n)})}async function g$(e){return new Promise((t,n)=>{const r=new Ld;r.loadAsync(d$(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=mU(SS(c));b(l)&&i.push(l)}t(i)}).catch(n)})}function _$(e,t,n,r){const i=hn(e);if(!b(i))return;let s=0;function o(){return s}function a(l,u){xt(u)&&(s=u,em(t.x,t.y,n.x,n.y).forEach(f=>{const d=ie(i,f);b(d)&&(d[l]=u)}))}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Mt(e,`batch:${io(t,n)}`,"char",[r,"charedit"],o,a);const c=Ye(e);c.scroll=Tn(e)}function y$(e,t,n,r){const i=hn(e);if(!b(i))return;let s=0;function o(){return s}function a(l,u){if(xt(u)){s=u;for(let f=t.y;f<=n.y;++f)for(let d=t.x;d<=n.x;++d){const h=ie(i,{x:d,y:f});b(h)&&(h[l]=u)}}}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Mt(e,`batch:${io(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scroll=Tn(e)}function b$(e,t,n,r){const i=hn(e);if(!b(i))return;let s=0;function o(){return s}function a(l,u){xt(u)&&(s=u,em(t.x,t.y,n.x,n.y).forEach(f=>{const d=ie(i,f);b(d)&&(d[l]=u)}))}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Mt(e,`batch:${io(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scroll=Tn(e)}function k$(e,t,n,r){const i=ln($t.MAIN);if(!b(i))return;const s=hn(e);if(!b(s))return;const o=io(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Mt(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Mt(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),r&&Mt(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Mt(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),Mt(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Rt(e,Ke),Mt(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Mt(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Mt(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Rt(e,Ke),Mt(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Rt(e,Ke),Rt(e,"codepages:"),Mt(e,"batch","edit @board codepage",[`pageopen:${s.id}`]);const a=Math.min(t.x,n.x),c=Math.min(t.y,n.y),l=Math.max(t.x,n.x),u=Math.max(t.y,n.y),f=new Set;for(let d=c;d<=u;++d)for(let h=a;h<=l;++h){const m=ie(s,{x:h,y:d}),p=dk(i,m);b(p)&&!f.has(p.id)&&(f.add(p.id),Mt(e,"batch",`edit @${Ue(p)}`,[`pageopen:${p.id}`]))}Mt(e,"batch",`board id ${s.id}`,["","copyit",s.id])}function Ud(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function w$(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Ud(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let Fd;function zw(){return Fd||(Fd=w$("keyval-store","keyval")),Fd}function Ww(e,t=zw()){return t("readonly",n=>Ud(n.get(e)))}function Gw(e,t,n=zw()){return n("readwrite",r=>new Promise((i,s)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),i(Ud(r.transaction))}catch(o){s(o)}}}))}function Bd(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function Kw(){return Ww("secretheap")}async function Hw(e){return Gw("secretheap",e)}async function E$(){return!!await Kw()}function Yw(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},m=ie(e,{x:d,y:f});(m==null?void 0:m.category)===Bn.ISOBJECT?(l.push(xr(ns(e,d,f))),Qr(m)!=="player"&&u.push({...xr(m),...h,id:"blank"})):l.push({...xr(m),...h})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function x$(e,t,n,r){const i=hn(e);if(!b(i))return;const s=Yw(i,t,n);switch(r){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await Hw(()=>s)}function v$(e,t,n){const r=Bd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Mt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Mt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Mt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=Ye(e);i.scroll=Tn(e)}async function T$(e,t,n,r){const i=ln($t.MAIN);if(!b(i))return;const s=hn(e);if(!b(s))return;const o=Yw(s,t,n);switch(r){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(r){case"cutall":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ie(s,{x:c,y:a});(l==null?void 0:l.category)===Bn.ISOBJECT&&vn(s,l,i.timestamp),Oe(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ie(s,{x:c,y:a});(l==null?void 0:l.category)===Bn.ISOBJECT&&vn(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c)Oe(s,{x:c,y:a});break}}await Hw(()=>o)}function A$(e,t,n){const r=Bd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Mt(e,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Mt(e,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Mt(e,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=Ye(e);i.scroll=Tn(e)}async function S$(e,t,n,r){const i=hn(e),s=await Kw();if(!b(i)||!b(s))return;const o=Math.min(t.x,n.x),a=Math.min(t.y,n.y),c=Math.max(t.x,n.x),l=Math.max(t.y,n.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(r){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<d;++p){const k=hr({x:p,y:m},s.width);Oe(i,{...s.terrain[k],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];b(p.x)&&b(p.y)&&_h(p.x,p.y,0,u-1,f-1,0)&&Od(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];b(p.x)&&b(p.y)&&_h(p.x,p.y,0,u-1,f-1,0)&&Od(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<d;++p){const k=hr({x:p,y:m},s.width);Oe(i,{...s.terrain[k],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const k=(p-o)%s.width,y=(m-a)%s.height,v=hr({x:k,y},s.width);Oe(i,{...s.terrain[v],x:p,y:m})}break}}function R$(e,t,n){const r=Bd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Mt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Mt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Mt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Mt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=Ye(e);i.scroll=Tn(e)}function Pd(e,t){return`inspect:${t!=null&&t.id?t.id:jr(e,t)}`}function O$(e,t,n){const r=ln($t.MAIN);if(!b(r))return;const i=hn(e);if(!b(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){b(t)&&(t[d]=h)}const a=t.category===Bn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Pd(i,t);Rt(e,`${a}: ${c} ${l}`),Rt(e,Ke),Mt(e,u,"color",[n,"coloredit"],s,o);const f=Ye(e);f.scroll=Tn(e)}function N$(e,t,n){const r=ln($t.MAIN);if(!b(r))return;const i=hn(e);if(!b(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){b(t)&&(t[d]=h)}const a=t.category===Bn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Pd(i,t);Rt(e,`${a}: ${c} ${l}`),Rt(e,Ke),Mt(e,u,"char",[n,"charedit"],s,o);const f=Ye(e);f.scroll=Tn(e)}function I$(e,t,n,r,i,s){var h,m,p;const o=ln($t.MAIN);if(!b(o))return;function a(k){var v;const y=(r==null?void 0:r[k])??((v=r==null?void 0:r.kinddata)==null?void 0:v[k]);if(!b(y))switch(k){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Wt.ISWALK;case"pushable":return 0;case"breakable":return 0}return y}function c(k,y){b(r)&&(r[k]=y)}s?Rt(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):Rt(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`);const l=Pd(t,r);switch(s&&Rt(e,`cycle: ${Gt(r,"cycle")}`),Gt(r,"collision")){case Wt.ISWALK:Rt(e,"collision: iswalk");break;case Wt.ISSWIM:Rt(e,"collision: isswim");break;case Wt.ISSOLID:Rt(e,"collision: issolid");break;case Wt.ISBULLET:Rt(e,"collision: isbullet");break}s&&Rt(e,`ispushable: ${Gt(r,"pushable")?"yes":"no"}`),Rt(e,`isbreakable: ${Gt(r,"breakable")?"yes":"no"}`),Rt(e,Ke);const f=Ra(n),d=Jn(f);for(let k=0;k<d.length;++k){const y=d[k];switch(y){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ue(f[y])){const[v,T,...A]=f[y];yt(T)&&Mt(e,l,T||y,[y,v,...A],a,c)}break}}Mt(e,l,"copy coords",["copycoords","hk","5"," 5 "]),Rt(e,Ke),Mt(e,l,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],a,c),Mt(e,l,`color: ${r.color??((m=r.kinddata)==null?void 0:m.color)??15}`,["color","hk","c"," C ","next"],a,c),Mt(e,l,`bg: ${r.bg??((p=r.kinddata)==null?void 0:p.bg)??0}`,["bg","hk","b"," B ","next"],a,c),Rt(e,Ke),Mt(e,l,"make empty",["empty","hk","0"],a,c),Rt(e,Ke),Mt(e,"batch","edit @board codepage",[`pageopen:${t.id}`]),Mt(e,"batch",`edit @${Ue(n)}`,[`pageopen:${n.id}`]),Mt(e,"batch",`board id ${t.id}`,["","copyit",t.id])}function C$(e,t,n,r){const i=ln($t.MAIN);if(!b(i))return;const s=hn(e);if(b(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ie(s,{x:a,y:o});(c==null?void 0:c.category)===Bn.ISOBJECT&&vn(s,c,i.timestamp),Oe(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ie(s,{x:a,y:o});(c==null?void 0:c.category)===Bn.ISOBJECT&&vn(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Oe(s,{x:a,y:o});break}}}function L$(e,t,n){const r=ln($t.MAIN);if(!b(r))return;const i=hn(e);if(!b(i))return;const s=io(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Mt(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Mt(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Mt(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Ye(e);o.scroll=Tn(e)}async function M$(e,t,n){const r=ln($t.MAIN),i=await E$();if(!b(r))return;const s=hn(e);if(!b(s))return;if(Se(s),t.x===n.x&&t.y===n.y){const a=ie(s,t),c=dk(r,a);b(a)&&b(c)&&I$(e,s,c,a,t,Ge(a)),a!=null&&a.kind||(Rt(e,`empty: ${t.x}, ${t.y}`),Rt(e,Ke),Mt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]),Mt(e,"batch","edit @board codepage",[`pageopen:${s.id}`]),Mt(e,"batch",`board id ${s.id}`,["","copyit",s.id]))}else k$(e,t,n,i);const o=Ye(e);o.scroll=Tn(e)}function U$(e,t){const n=ce($t.MAIN);if(!b(n))return;const r=hn(t);if(!b(r))return;const i=Pn(e),s=YP(r,i.target);if(b(s))switch(i.path){case"copycoords":yu(et,ar(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":O$(t,s,i.path);break;case"char":N$(t,s,i.path);break;case"empty":vn(r,s,n.timestamp);break;case"code":hi(et,t,async()=>{const o=Qr(s),a="object";xe(et,t,`opened [${a}] ${o}`);const c=[r.id,s.id];gh(Ya(n.id,c),s.code??""),qE(et,t),await a0(800),i0(et,t,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}async function F$(e,t){const n=hn(t);if(!b(n))return;const r=Pn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":v$(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await x$(t,c,l,r.target);break;case"cut":A$(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await T$(t,c,l,r.target);break;case"paste":R$(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await S$(t,c,l,r.target);break;case"empty":L$(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":C$(t,c,l,r.target);break;case"chars":_$(t,c,l,"char");break;case"colors":y$(t,c,l,"color");break;case"bgs":b$(t,c,l,"bg");break;case"copycoords":yu(et,t,[i,s,o,a].join(" "));break;case"pageopen":hi(et,t,async()=>{await a0(800),gx(et,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}async function B$(){return Ww("remixconfig")}async function P$(e){return Gw("remixconfig",e)}let rs={stat:"",patternsize:2,mirror:1};async function $$(e,t){const n=hn(t);if(!b(n))return;const r=Pn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"remix":{await D$(t,c,l);break}case"remixrun":{const u=un(rs.stat);b(u)&&Wk(n.id,u.id,rs.patternsize,rs.mirror,c,l,"all"),await P$(()=>rs);break}default:console.info("unknown remix",r);break}}async function D$(e,t,n){const r=await B$();rs={...rs,...r};const i=io(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke);function s(c){const{target:l}=Pn(c);return rs[l]}function o(c,l){if(xt(l)||yt(l)){const{target:u}=Pn(c);rs[u]=l}}Mt(e,"remix","source board",[`stat:${i}`,"text"],s,o),Mt(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),Mt(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Rt(e,Ke),Mt(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Ye(e);a.scroll=Tn(e)}const j$=16,is={},su={},z$=60;let Vw=0;const Co={},Lo={};async function Xw(e){const t=Fr(),n=ce($t.MAIN);if(t.length&&b(n)){const r=await Md(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;ZE(Zt,ar(),i,r)}}async function W$(){const e=Fr(),t=ce($t.MAIN);if(e.length&&b(t)){const n=await Md(e);QE(Zt,ar(),n)}}async function G$(){const e=Fr(),t=ce($t.MAIN);return e.length&&b(t)?Md(e):""}const Zt=Ps("vm",["tick","second"],e=>{var n;if(!Zt.session(e))return;const t=ar();switch(e.target){case"operator":EP(e.player),xe(Zt,e.player,`operator set to ${e.player}`),Zt.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=ce($t.MAIN);Zt.replynext(e,"ackzsswords",{cli:md(Zi.CLI),loader:md(Zi.LOADER),runtime:md(Zi.RUNTIME),flags:[...Jn(wr(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...Rs(r,bt.OBJECT).map(i=>Ue(i)),...Jn(dd)],altkinds:[...Rs(r,bt.TERRAIN),...Rs(r,bt.BOARD),...Rs(r,bt.PALETTE),...Rs(r,bt.CHARSET),...Rs(r,bt.LOADER)].map(i=>Ue(i)),colors:[...Jn(Jo)],dirs:[...Jn(xh).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Jn(hd)],exprs:["aligned","alligned","contact","blocked","any","count","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&hi(Zt,e.player,async()=>{if(ue(e.data)){const[r,i]=e.data,s=await g$(r),o=s.map(a=>a.name);OP(s,i),xe(Zt,e.player,`loading ${o.join(", ")}`),_u(Zt,e.player)}});break;case"search":CP(e.player)||_u(Zt,e.player);break;case"logout":IP(e.player),delete is[e.player],xe(Zt,t,`player ${e.player} logout`),_u(Zt,e.player);break;case"login":ww(e.player)?(is[e.player]=0,xe(Zt,ar(),`login from ${e.player}`),Zt.replynext(e,"acklogin",!0)):t0(Zt,e.player);break;case"local":ww(e.player)?(is[e.player]=0,xe(Zt,ar(),`login from ${e.player}`)):t0(Zt,e.player);break;case"doot":is[e.player]=0,su[e.player]=su[e.player]??0,su[e.player]%32===0&&xe(Zt,e.player,`$whiteactive $blue${e.player}`),++su[e.player];break;case"input":{if(e.player.includes("local")&&!bw(e.player)&&mx(Zt,e.player),!e.player.includes("local")||bw(e.player)){const r=wr(e.player),[i=Sn.NONE,s=0]=e.data??[Sn.NONE,0];ue(r.inputqueue)||(r.inputqueue=[]),i!==Sn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ue(e.data)){const[r,i]=e.data,s=Ya(r,i);b(Lo[s])||(Lo[s]=Qp(s,o=>{const[a,c]=i,l=Br(r),u=Ss(l,a);if(b(u))if(ci(u)===bt.BOARD&&b(c)){const f=Re(u),d=Mn(f,c);b(d)&&(d.code=o,Jf(lk(o),d))}else u.code=o,fU(u)})),Co[s]=Co[s]??new Set,Co[s].add(e.player)}break;case"coderelease":if(ue(e.data)){const[r,i]=e.data,[,s]=i,o=Ya(r,i);b(Co[o])&&(Co[o].delete(e.player),Co[o].size===0&&((n=Lo[o])==null||n.call(Lo),Lo[o]=void 0,yt(s)&&FP(s)))}break;case"halt":e.player===t&&LE(e.data)&&xP(e.data);break;case"tick":PP(vP());break;case"synthsend":if(yt(e.data)){const[r,i]=f$(e.data),s=ce($t.MAIN);Oo(r,i,void 0,ko(s))}break;case"second":{LP(is);const r=Object.keys(is);for(let i=0;i<r.length;++i)++is[r[i]];for(let i=0;i<r.length;++i){const s=r[i];is[s]>=j$&&s0(Zt,s)}++Vw>=z$&&(Vw=0,hi(Zt,e.player,async()=>{await Xw(!0)}));break}case"copyjsonfile":if(e.player===t){const r=ce($t.MAIN);if(b(r)&&ue(e.data)){const[i]=e.data,s=Ss(r,i);b(s)&&ex(Zt,t,s,`${Ue(s)}.${Oi(s)}.json`)}}break;case"refscroll":{Rt(e.player,"stat refs"),Rt(e.player,Ke),Mt(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Mt(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Mt(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=Ye(e.player);r.scroll=Tn(e.player);break}case"fork":e.player===t&&hi(Zt,e.player,async()=>{await W$()});break;case"itchiopublish":hi(Zt,e.player,async()=>{if(e.player===t){const r=ce($t.MAIN);if(b(r)){const i=await G$();tx(Zt,e.player,r.name,i)}}});break;case"flush":e.player===t&&hi(Zt,e.player,async()=>{await Xw()});break;case"cli":vw(e.player,e.data);break;case"clirepeatlast":$P(e.player);break;case"restart":e.player===t&&(BP(),o0(Zt,e.player));break;case"inspect":hi(Zt,e.player,async()=>{if(ue(e.data)){const[r,i]=e.data;await M$(e.player,r,i)}});break;case"loader":if(ue(e.data)){const[r,i,s,o]=e.data;switch(i){case"file":jw(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){xe(Zt,e.player,`loading ${s}`);const a=JSON.parse(o.json);b(a.data)&&yt(a.exported)&&(Xl(a.data),xe(Zt,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){xe(Zt,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ce($t.MAIN);b(c)&&b(a.data)&&yt(a.exported)&&(ed(c,a.data),xe(Zt,e.player,`loaded ${a.exported}`))}else Lk(r,i,s,o,e.player);break;default:Lk(r,i,s,o,e.player);break}}break;default:{const{target:r,path:i}=Pn(e.target);switch(It(r)){case"refscroll":switch(i){case"charscroll":{Mt(e.player,"refscroll","char",["char","charedit"]);const s=Ye(e.player);s.scroll=Tn(e.player);break}case"colorscroll":{Mt(e.player,"refscroll","color",["color","coloredit"]);const s=Ye(e.player);s.scroll=Tn(e.player);break}case"notesscroll":{Rt(e.player,"duration             cdefgab - notes "),Rt(e.player,"y - 64th note        x - rest"),Rt(e.player,"t - 32nd note        "),Rt(e.player,"s - 16th note.       drums"),Rt(e.player,"i - eight note.      0 - tick"),Rt(e.player,"q - quarter note     1 - tweet"),Rt(e.player,"h - half note        2 - cowbell"),Rt(e.player,"w - whole note       p - clap"),Rt(e.player,"                     4 - high snare"),Rt(e.player,"mods                 5 - high woodblock"),Rt(e.player,"3 - triplet          6 - low snare"),Rt(e.player,". - time and a half  7 - low tom"),Rt(e.player,"# - sharp            8 - low woodblock"),Rt(e.player,"! - flat             9 - bass drum");const s=Ye(e.player);s.scroll=Tn(e.player);break}}break;case"batch":hi(Zt,e.player,async()=>{await F$(i,e.player)});break;case"remix":hi(Zt,e.player,async()=>{await $$(i,e.player)});break;case"empty":{const s=Pn(i);switch(s.target){case"copycoords":yu(Zt,ar(),s.path.split(",").join(" "));break}break}case"inspect":U$(i,e.player);break;case"touched":if(ue(e.data)){const[s,o,a]=e.data;Ew({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:{const s=Pn(i);if(It(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),Ew(e);else{const o=ce($t.MAIN);Oo(s.target,s.path,void 0,ko(o))}break}}break}}},wP());function K$(){JE(Zt)}const{forward:H$}=xx(e=>{vx(e)&&postMessage(e)});onmessage=function(t){H$(t.data)},setTimeout(K$,100)})();

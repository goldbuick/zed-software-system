var o3=Object.defineProperty;var a3=(ni,Dn,An)=>Dn in ni?o3(ni,Dn,{enumerable:!0,configurable:!0,writable:!0,value:An}):ni[Dn]=An;var Lt=(ni,Dn,An)=>a3(ni,typeof Dn!="symbol"?Dn+"":Dn,An);(function(){"use strict";const ni=new Set,Dn={emit(e,t,n,r,i){Dn.invoke(nE(e,t,n,r,i))},invoke(e){ni.forEach(t=>t.handle(e))},connect(e){ni.add(e)},disconnect(e){ni.delete(e)}};var An=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function w1(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var vd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(An,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(vd);var x1=vd.exports,Rd=vs(x1),Sd={};(function(e){var t=An&&An.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,w=l.addAdverb,b=w===void 0?!1:w,T=t(t(t([],t([],Array(m),!0).map(function(A){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),b?[n(e.adverbs)]:[],!0);return f&&(T=T.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),T.join(h)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(f?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(e.adjectives).length*h+h*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(f?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(f?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(Sd);var Id=vs(Sd);const k1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let T1=e=>crypto.getRandomValues(new Uint8Array(e)),A1=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Nd=(e,t=21)=>A1(e,t,T1),v1=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=k1[n[e]&63];return t};var Od="abcdefghijklmnopqrstuvwxyz",Cd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Ld="0123456789",R1="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",S1="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const I1=Ld,N1=Od,O1=Cd;var C1=I1+N1+O1,Vl={lowercase:Od,uppercase:Cd,numbers:Ld,nolookalikes:R1,nolookalikesSafe:S1,alphanumeric:C1};function Ue(){return`sid_${v1(12).replaceAll("-",".")}`}Nd(Vl.numbers,4),Nd(`${Vl.numbers}${Vl.lowercase}`,16);function dr(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function L1(){return Id({capitalize:!1,adjectiveCount:1})}function M1(){return Id({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var U1=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),F1=Object.prototype.hasOwnProperty;function Xl(e,t){return F1.call(e,t)}function ql(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Xl(e,i)&&r.push(i);return r}function vn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Jl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Xi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Md(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Zl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Zl(e[t]))return!0}else if(typeof e=="object"){for(var r=ql(e),i=r.length,s=0;s<i;s++)if(Zl(e[r[s]]))return!0}}return!1}function Ud(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Fd=function(e){U1(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Ud(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Ud(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Oe=Fd,P1=vn,Rs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Ma(n,this.path);r&&(r=vn(r));var i=qi(n,{op:"remove",path:this.from}).removed;return qi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Ma(n,this.from);return qi(n,{op:"add",path:this.path,value:vn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Co(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},B1={add:function(e,t,n){return Jl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Rs.move,copy:Rs.copy,test:Rs.test,_get:Rs._get};function Ma(e,t){if(t=="")return e;var n={op:"_get",path:t};return qi(e,n),n.value}function qi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ua(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Ma(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Co(e,t.value),o.test===!1)throw new Oe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Oe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=vn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=Ua;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=Md(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=t.path),d!==void 0&&p(t,0,e,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!Jl(f))throw new Oe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Jl(f)&&(f=~~f)}if(u>=h){if(n&&t.op==="add"&&f>l.length)throw new Oe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=B1[t.op].call(t,l,f,e);if(o.test===!1)throw new Oe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=h){var o=Rs[t.op].call(t,l,f,e);if(o.test===!1)throw new Oe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new Oe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Ql(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Oe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=vn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=qi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function D1(e,t,n){var r=qi(e,t);if(r.test===!1)throw new Oe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ua(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Oe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Rs[e.op]){if(typeof e.path!="string")throw new Oe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Oe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Oe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Oe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Zl(e.value))throw new Oe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Oe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Oe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Pd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Oe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Oe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Pd(e,t,n){try{if(!Array.isArray(e))throw new Oe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Ql(vn(t),vn(e),n||!0);else{n=n||Ua;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Oe)return i;throw i}}function Co(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Co(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Co(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var $1=Object.freeze({__proto__:null,JsonPatchError:Oe,_areEquals:Co,applyOperation:qi,applyPatch:Ql,applyReducer:D1,deepClone:P1,getValueByPointer:Ma,validate:Pd,validator:Ua});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var tu=new WeakMap,j1=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),z1=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function W1(e){return tu.get(e)}function K1(e,t){return e.observers.get(t)}function G1(e,t){e.observers.delete(t.callback)}function H1(e,t){t.unobserve()}function Y1(e,t){var n=[],r,i=W1(e);if(!i)i=new j1(e),tu.set(e,i);else{var s=K1(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=vn(e),t){r.callback=t,r.next=null;var o=function(){eu(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){eu(r),clearTimeout(r.next),G1(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new z1(t,r)),r}function eu(e,t){t===void 0&&(t=!1);var n=tu.get(e.object);nu(n.value,e.object,e.patches,"",t),e.patches.length&&Ql(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function nu(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=ql(t),o=ql(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(Xl(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var h=t[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?nu(u,h,n,r+"/"+Xi(l),i):u!==h&&(i&&n.push({op:"test",path:r+"/"+Xi(l),value:vn(u)}),n.push({op:"replace",path:r+"/"+Xi(l),value:vn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Xi(l),value:vn(u)}),n.push({op:"remove",path:r+"/"+Xi(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Xl(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+Xi(l),value:vn(t[l])})}}}function Bd(e,t,n){n===void 0&&(n=!1);var r=[];return nu(e,t,r,"",n),r}var V1=Object.freeze({__proto__:null,compare:Bd,generate:eu,observe:Y1,unobserve:H1});Object.assign({},$1,V1,{JsonPatchError:Fd,deepClone:vn,escapePathComponent:Xi,unescapePathComponent:Md});var X1=typeof Element<"u",q1=typeof Map=="function",J1=typeof Set=="function",Z1=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Fa(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Fa(e[r],t[r]))return!1;return!0}var s;if(q1&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Fa(r.value[1],t.get(r.value[0])))return!1;return!0}if(J1&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(Z1&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(X1&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Fa(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var Q1=function(t,n){try{return Fa(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},tE=vs(Q1);function x(e){return e!=null}const Nr=Object.keys;function $n(e){return vn(e)}function eE(e){return typeof e=="boolean"}function St(e){return typeof e=="number"&&isNaN(e)===!1}function kt(e){return typeof e=="string"}function ae(e){return Array.isArray(e)}function ru(e){return e}var Wt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Wt||{}),Gt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Gt||{}),Jn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Jn||{}),mt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e))(mt||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Ot(e){return(e==null?void 0:e.toLowerCase().trim())??""}function nE(e,t,n,r,i){return{session:e,player:t,id:Ue(),sender:n,target:r,data:i}}function pr(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Ss(e,t=[],n=ru,r=""){const i=Ue(),s=Ot(e),o=t.map(Ot);let a=r;const c={id(){return i},name(){return e},session(l){return x(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,h){Dn.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=pr(l.target),d=Ot(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&x(l.session)&&(a=l.session),o.findIndex(f=>f==="all"||f===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:h})}};return Dn.connect(c),c}function rE(e){return typeof e=="object"&&kt(e.session)&&kt(e.player)&&kt(e.id)&&kt(e.sender)&&kt(e.target)}function _e(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function ri(e,t,...n){return e.emit(t,"info",n),!0}function Dd(e,t,...n){return e.emit(t,"debug",n),!0}function iE(e,t,n){e.emit(t,"toast",n)}function sE(e,t,n){e.emit(t,"bridge:streamstart",n)}function oE(e,t){e.emit(t,"bridge:streamstop",void 0)}function aE(e,t,n){e.emit(t,"bridge:chatstart",n)}function cE(e,t){e.emit(t,"bridge:chatstop")}function lE(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function uE(e,t){e.emit(t,"bridge:talkstart",t)}function hE(e,t){e.emit(t,"bridge:talkstop",t)}function fE(e,t){e.emit(t,"bridge:mediastart",t)}function dE(e,t){e.emit(t,"bridge:mediastop",t)}function pE(e,t,n){e.emit(t,"bridge:start",n)}function mE(e,t,n){e.emit(t,"bridge:tab",n)}function gE(e,t,n){e.emit(t,"gadgetclient:paint",n)}function yE(e,t,n){e.emit(t,"gadgetclient:patch",n)}function _E(e,t){e.emit(t,"gadgetserver:clearscroll")}function bE(e){e.emit("","ready")}function EE(e,t){e.emit(t,"register:loginfail")}function iu(e,t){e.emit(t,"register:loginready",!0)}function wE(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function xE(e,t,n){e.emit(t,"register:forkmem",[n])}function su(e,t,n){e.emit(t,"register:copy",n)}function kE(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function $d(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function TE(e,t){e.emit(t,"register:dev",void 0)}function AE(e,t){e.emit(t,"register:share",void 0)}function vE(e,t){e.emit(t,"register:nuke",void 0)}function RE(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function SE(e,t,n){e.emit(t,"synth:tta",[n])}function IE(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function NE(e,t,n){e.emit(t,"synth:focus",n)}function OE(e,t,n){e.emit(t,"synth:bpm",n)}function CE(e,t,n){e.emit(t,"synth:playvolume",n)}function LE(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function ME(e,t,n){e.emit(t,"synth:ttsvolume",n)}function ou(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function jd(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function UE(e,t){e.emit(t,"register:inspector")}function zd(e,t,n,r,i,s,o){e.emit(t,"register:editor:open",[n,r,i,s,o])}function FE(e,t){e.emit(t,"register:editor:close")}function Wd(e,t){e.emit(t,"vm:logout")}function Pa(e,t){const[n,r]=t;return`${e}:${[n,r].filter(x).join(":")}`}function PE(e,t,n){e.emit(t,"vm:cli",n)}function BE(e,t){e.emit(t,"vm:restart")}function Kd(e,t){e.emit(t,"vm:flush")}function DE(e,t){e.emit(t,"vm:fork")}function $E(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function jE(e,t){return{filename:e,json:t}}function zE(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function au(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=$E(i,s);break;case"json":o=jE(i,s);break;case"binary":o=zE(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function WE(e){const t=new Set;function n(s){rE(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Dn.invoke(s))}const r=Ss("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Dn.disconnect(r)}return{forward:n,disconnect:i}}function KE(e){switch(e.target){case"info":case"debug":case"error":case"tick":case"tock":case"ready":case"second":return!0;default:{const t=pr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const cu=66.666,Ba=Math.round(1e3/cu),GE=3;function Gd(e){return new Promise(t=>setTimeout(t,e))}const lu=Ss("clock");let uu=0,Da=0,hu=0,Hd=performance.now();function Yd(){const e=performance.now(),t=e-Hd;hu+=t,hu>=cu&&(hu%=cu,lu.emit("","tick",Da),lu.emit("","tock",Da),++uu,++Da,uu>=Ba&&(uu%=Ba,lu.emit("","second",Da))),Hd=e,setTimeout(Yd,2)}Yd();function HE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Vd={exports:{}},Fe=Vd.exports={},Or,Cr;function fu(){throw new Error("setTimeout has not been defined")}function du(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Or=setTimeout:Or=fu}catch{Or=fu}try{typeof clearTimeout=="function"?Cr=clearTimeout:Cr=du}catch{Cr=du}})();function Xd(e){if(Or===setTimeout)return setTimeout(e,0);if((Or===fu||!Or)&&setTimeout)return Or=setTimeout,setTimeout(e,0);try{return Or(e,0)}catch{try{return Or.call(null,e,0)}catch{return Or.call(this,e,0)}}}function YE(e){if(Cr===clearTimeout)return clearTimeout(e);if((Cr===du||!Cr)&&clearTimeout)return Cr=clearTimeout,clearTimeout(e);try{return Cr(e)}catch{try{return Cr.call(null,e)}catch{return Cr.call(this,e)}}}var ii=[],Is=!1,Ji,$a=-1;function VE(){!Is||!Ji||(Is=!1,Ji.length?ii=Ji.concat(ii):$a=-1,ii.length&&qd())}function qd(){if(!Is){var e=Xd(VE);Is=!0;for(var t=ii.length;t;){for(Ji=ii,ii=[];++$a<t;)Ji&&Ji[$a].run();$a=-1,t=ii.length}Ji=null,Is=!1,YE(e)}}Fe.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ii.push(new Jd(e,t)),ii.length===1&&!Is&&Xd(qd)};function Jd(e,t){this.fun=e,this.array=t}Jd.prototype.run=function(){this.fun.apply(null,this.array)},Fe.title="browser",Fe.browser=!0,Fe.env={},Fe.argv=[],Fe.version="",Fe.versions={};function si(){}Fe.on=si,Fe.addListener=si,Fe.once=si,Fe.off=si,Fe.removeListener=si,Fe.removeAllListeners=si,Fe.emit=si,Fe.prependListener=si,Fe.prependOnceListener=si,Fe.listeners=function(e){return[]},Fe.binding=function(e){throw new Error("process.binding is not supported")},Fe.cwd=function(){return"/"},Fe.chdir=function(e){throw new Error("process.chdir is not supported")},Fe.umask=function(){return 0};var XE=Vd.exports;const mr=HE(XE);var Kt={},pu=Symbol.for("react.transitional.element"),qE=Symbol.for("react.portal"),JE=Symbol.for("react.fragment"),ZE=Symbol.for("react.strict_mode"),QE=Symbol.for("react.profiler"),tw=Symbol.for("react.consumer"),ew=Symbol.for("react.context"),nw=Symbol.for("react.forward_ref"),rw=Symbol.for("react.suspense"),iw=Symbol.for("react.memo"),Zd=Symbol.for("react.lazy"),Qd=Symbol.iterator;function sw(e){return e===null||typeof e!="object"?null:(e=Qd&&e[Qd]||e["@@iterator"],typeof e=="function"?e:null)}var t0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},e0=Object.assign,n0={};function Ns(e,t,n){this.props=e,this.context=t,this.refs=n0,this.updater=n||t0}Ns.prototype.isReactComponent={},Ns.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Ns.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function r0(){}r0.prototype=Ns.prototype;function mu(e,t,n){this.props=e,this.context=t,this.refs=n0,this.updater=n||t0}var gu=mu.prototype=new r0;gu.constructor=mu,e0(gu,Ns.prototype),gu.isPureReactComponent=!0;var i0=Array.isArray,we={H:null,A:null,T:null,S:null,V:null},s0=Object.prototype.hasOwnProperty;function yu(e,t,n,r,i,s){return n=s.ref,{$$typeof:pu,type:e,key:t,ref:n!==void 0?n:null,props:s}}function ow(e,t){return yu(e.type,t,void 0,void 0,void 0,e.props)}function _u(e){return typeof e=="object"&&e!==null&&e.$$typeof===pu}function aw(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var o0=/\/+/g;function bu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?aw(""+e.key):t.toString(36)}function a0(){}function cw(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(a0,a0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function Os(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case pu:case qE:o=!0;break;case Zd:return o=e._init,Os(o(e._payload),t,n,r,i)}}if(o)return i=i(e),o=r===""?"."+bu(e,0):r,i0(i)?(n="",o!=null&&(n=o.replace(o0,"$&/")+"/"),Os(i,t,n,"",function(l){return l})):i!=null&&(_u(i)&&(i=ow(i,n+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(o0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=r===""?".":r+":";if(i0(e))for(var c=0;c<e.length;c++)r=e[c],s=a+bu(r,c),o+=Os(r,t,n,s,i);else if(c=sw(e),typeof c=="function")for(e=c.call(e),c=0;!(r=e.next()).done;)r=r.value,s=a+bu(r,c++),o+=Os(r,t,n,s,i);else if(s==="object"){if(typeof e.then=="function")return Os(cw(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function ja(e,t,n){if(e==null)return e;var r=[],i=0;return Os(e,r,"","",function(s){return t.call(n,s,i++)}),r}function lw(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var c0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof mr=="object"&&typeof mr.emit=="function"){mr.emit("uncaughtException",e);return}console.error(e)};function uw(){}Kt.Children={map:ja,forEach:function(e,t,n){ja(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return ja(e,function(){t++}),t},toArray:function(e){return ja(e,function(t){return t})||[]},only:function(e){if(!_u(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Kt.Component=Ns,Kt.Fragment=JE,Kt.Profiler=QE,Kt.PureComponent=mu,Kt.StrictMode=ZE,Kt.Suspense=rw,Kt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=we,Kt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return we.H.useMemoCache(e)}},Kt.cache=function(e){return function(){return e.apply(null,arguments)}},Kt.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=e0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!s0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(r[o]=t[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return yu(e.type,i,void 0,void 0,s,r)},Kt.createContext=function(e){return e={$$typeof:ew,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:tw,_context:e},e},Kt.createElement=function(e,t,n){var r,i={},s=null;if(t!=null)for(r in t.key!==void 0&&(s=""+t.key),t)s0.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return yu(e,s,void 0,void 0,null,i)},Kt.createRef=function(){return{current:null}},Kt.forwardRef=function(e){return{$$typeof:nw,render:e}},Kt.isValidElement=_u,Kt.lazy=function(e){return{$$typeof:Zd,_payload:{_status:-1,_result:e},_init:lw}},Kt.memo=function(e,t){return{$$typeof:iw,type:e,compare:t===void 0?null:t}},Kt.startTransition=function(e){var t=we.T,n={};we.T=n;try{var r=e(),i=we.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(uw,c0)}catch(s){c0(s)}finally{we.T=t}},Kt.unstable_useCacheRefresh=function(){return we.H.useCacheRefresh()},Kt.use=function(e){return we.H.use(e)},Kt.useActionState=function(e,t,n){return we.H.useActionState(e,t,n)},Kt.useCallback=function(e,t){return we.H.useCallback(e,t)},Kt.useContext=function(e){return we.H.useContext(e)},Kt.useDebugValue=function(){},Kt.useDeferredValue=function(e,t){return we.H.useDeferredValue(e,t)},Kt.useEffect=function(e,t,n){var r=we.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Kt.useId=function(){return we.H.useId()},Kt.useImperativeHandle=function(e,t,n){return we.H.useImperativeHandle(e,t,n)},Kt.useInsertionEffect=function(e,t){return we.H.useInsertionEffect(e,t)},Kt.useLayoutEffect=function(e,t){return we.H.useLayoutEffect(e,t)},Kt.useMemo=function(e,t){return we.H.useMemo(e,t)},Kt.useOptimistic=function(e,t){return we.H.useOptimistic(e,t)},Kt.useReducer=function(e,t,n){return we.H.useReducer(e,t,n)},Kt.useRef=function(e){return we.H.useRef(e)},Kt.useState=function(e){return we.H.useState(e)},Kt.useSyncExternalStore=function(e,t,n){return we.H.useSyncExternalStore(e,t,n)},Kt.useTransition=function(){return we.H.useTransition()},Kt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const l0="0123456789abcdef",u0=[],za=[];for(let e=0;e<256;e++)u0[e]=l0[e>>4&15]+l0[e&15],e<16&&(e<10?za[48+e]=e:za[87+e]=e);const h0=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=u0[e[r++]];return n},Wa=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=za[e.charCodeAt(s++)]<<4|za[e.charCodeAt(s++)];return r};for(var f0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hw=typeof Uint8Array>"u"?[]:new Uint8Array(256),Ka=0;Ka<f0.length;Ka++)hw[f0.charCodeAt(Ka)]=Ka;new TextDecoder,new TextEncoder;const d0=typeof window<"u"?window:self,p0=d0.crypto||d0.msCrypto||{};p0.subtle||p0.webkitSubtle;const Cs=globalThis||void 0||self,gr=()=>new Map,Eu=e=>{const t=gr();return e.forEach((n,r)=>{t.set(r,n)}),t},Si=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},fw=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},dw=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Ls=()=>new Set,wu=e=>e[e.length-1],pw=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Zi=Array.from,mw=Array.isArray;class gw{constructor(){this._observers=gr()}on(t,n){return Si(this._observers,t,Ls).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Zi((this._observers.get(t)||gr()).values()).forEach(r=>r(...n))}destroy(){this._observers=gr()}}const Ii=Math.floor,Ga=Math.abs,m0=(e,t)=>e<t?e:t,Qi=(e,t)=>e>t?e:t,g0=e=>e!==0?e<0:1/e<0,y0=1,_0=2,xu=4,ku=8,Lo=32,oi=64,jn=128,Ha=31,Tu=63,ts=127,yw=2147483647,b0=Number.MAX_SAFE_INTEGER,_w=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ii(e)===e),bw=e=>e.toLowerCase(),Ew=/^\s*/g,ww=e=>e.replace(Ew,""),xw=/([A-Z])/g,E0=(e,t)=>ww(e.replace(xw,n=>`${t}${bw(n)}`)),kw=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Mo=typeof TextEncoder<"u"?new TextEncoder:null,Tw=Mo?e=>Mo.encode(e):kw;let Uo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Uo&&Uo.decode(new Uint8Array).length===1&&(Uo=null);class Fo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ya=()=>new Fo,Aw=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Lr=e=>{const t=new Uint8Array(Aw(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},vw=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Qi(n,t)*2),e.cpos=0)},tn=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Au=tn,re=(e,t)=>{for(;t>ts;)tn(e,jn|ts&t),t=Ii(t/128);tn(e,ts&t)},vu=(e,t)=>{const n=g0(t);for(n&&(t=-t),tn(e,(t>Tu?jn:0)|(n?oi:0)|Tu&t),t=Ii(t/64);t>0;)tn(e,(t>ts?jn:0)|ts&t),t=Ii(t/128)},Ru=new Uint8Array(3e4),Rw=Ru.length/3,Sw=(e,t)=>{if(t.length<Rw){const n=Mo.encodeInto(t,Ru).written||0;re(e,n);for(let r=0;r<n;r++)tn(e,Ru[r])}else zn(e,Tw(t))},Iw=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;re(e,r);for(let i=0;i<r;i++)tn(e,n.codePointAt(i))},Ms=Mo&&Mo.encodeInto?Sw:Iw,Va=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=m0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Qi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},zn=(e,t)=>{re(e,t.byteLength),Va(e,t)},Su=(e,t)=>{vw(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Nw=(e,t)=>Su(e,4).setFloat32(0,t,!1),Ow=(e,t)=>Su(e,8).setFloat64(0,t,!1),Cw=(e,t)=>Su(e,8).setBigInt64(0,t,!1),w0=new DataView(new ArrayBuffer(4)),Lw=e=>(w0.setFloat32(0,e),w0.getFloat32(0)===e),Po=(e,t)=>{switch(typeof t){case"string":tn(e,119),Ms(e,t);break;case"number":_w(t)&&Ga(t)<=yw?(tn(e,125),vu(e,t)):Lw(t)?(tn(e,124),Nw(e,t)):(tn(e,123),Ow(e,t));break;case"bigint":tn(e,122),Cw(e,t);break;case"object":if(t===null)tn(e,126);else if(mw(t)){tn(e,117),re(e,t.length);for(let n=0;n<t.length;n++)Po(e,t[n])}else if(t instanceof Uint8Array)tn(e,116),zn(e,t);else{tn(e,118);const n=Object.keys(t);re(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ms(e,i),Po(e,t[i])}}break;case"boolean":tn(e,t?120:121);break;default:tn(e,127)}};class x0 extends Fo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&re(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const k0=e=>{e.count>0&&(vu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&re(e.encoder,e.count-2))};class Xa{constructor(){this.encoder=new Fo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(k0(this),this.count=1,this.s=t)}toUint8Array(){return k0(this),Lr(this.encoder)}}const T0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);vu(e.encoder,t),e.count>1&&re(e.encoder,e.count-2)}};class Iu{constructor(){this.encoder=new Fo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(T0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return T0(this),Lr(this.encoder)}}class Mw{constructor(){this.sarr=[],this.s="",this.lensE=new Xa}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Fo;return this.sarr.push(this.s),this.s="",Ms(t,this.sarr.join("")),Va(t,this.lensE.toUint8Array()),Lr(t)}}const Ni=e=>new Error(e),Mr=()=>{throw Ni("Method unimplemented")},Ur=()=>{throw Ni("Unexpected case")},A0=Ni("Unexpected end of array"),v0=Ni("Integer out of Range");class qa{constructor(t){this.arr=t,this.pos=0}}const Us=e=>new qa(e),Uw=e=>e.pos!==e.arr.length,Fw=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Wn=e=>Fw(e,Ht(e)),Fs=e=>e.arr[e.pos++],Ht=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&ts)*n,n*=128,i<jn)return t;if(t>b0)throw v0}throw A0},Nu=e=>{let t=e.arr[e.pos++],n=t&Tu,r=64;const i=(t&oi)>0?-1:1;if(!(t&jn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&ts)*r,r*=128,t<jn)return i*n;if(n>b0)throw v0}throw A0},Ps=Uo?e=>Uo.decode(Wn(e)):e=>{let t=Ht(e);if(t===0)return"";{let n=String.fromCodePoint(Fs(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Fs(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Ou=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Pw=[e=>{},e=>null,Nu,e=>Ou(e,4).getFloat32(0,!1),e=>Ou(e,8).getFloat64(0,!1),e=>Ou(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Ps,e=>{const t=Ht(e),n={};for(let r=0;r<t;r++){const i=Ps(e);n[i]=Bo(e)}return n},e=>{const t=Ht(e),n=[];for(let r=0;r<t;r++)n.push(Bo(e));return n},Wn],Bo=e=>Pw[127-Fs(e)](e);class R0 extends qa{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Uw(this)?this.count=Ht(this)+1:this.count=-1),this.count--,this.s}}class Ja extends qa{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Nu(this);const t=g0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Ht(this)+2)}return this.count--,this.s}}class Cu extends qa{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Nu(this),n=t&1;this.diff=Ii(t/2),this.count=1,n&&(this.count=Ht(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Bw{constructor(t){this.decoder=new Ja(t),this.str=Ps(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Dw=crypto.getRandomValues.bind(crypto),S0=()=>Dw(new Uint32Array(1))[0],$w="10000000-1000-4000-8000"+-1e11,jw=()=>$w.replace(/[018]/g,e=>(e^S0()&15>>e/4).toString(16)),I0=e=>new Promise(e);Promise.all.bind(Promise);var N0={},Za={};Za.byteLength=Kw,Za.toByteArray=Hw,Za.fromByteArray=Xw;for(var Fr=[],Zn=[],zw=typeof Uint8Array<"u"?Uint8Array:Array,Lu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Bs=0,Ww=Lu.length;Bs<Ww;++Bs)Fr[Bs]=Lu[Bs],Zn[Lu.charCodeAt(Bs)]=Bs;Zn[45]=62,Zn[95]=63;function O0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Kw(e){var t=O0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Gw(e,t,n){return(t+n)*3/4-n}function Hw(e){var t,n=O0(e),r=n[0],i=n[1],s=new zw(Gw(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=Zn[e.charCodeAt(c)]<<18|Zn[e.charCodeAt(c+1)]<<12|Zn[e.charCodeAt(c+2)]<<6|Zn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Zn[e.charCodeAt(c)]<<2|Zn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=Zn[e.charCodeAt(c)]<<10|Zn[e.charCodeAt(c+1)]<<4|Zn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Yw(e){return Fr[e>>18&63]+Fr[e>>12&63]+Fr[e>>6&63]+Fr[e&63]}function Vw(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Yw(r));return i.join("")}function Xw(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Vw(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Fr[t>>2]+Fr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Fr[t>>10]+Fr[t>>4&63]+Fr[t<<2&63]+"=")),i.join("")}var Mu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Mu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+h],h+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(f?-1:1)*o*Math.pow(2,s-r)},Mu.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=d/c:t+=d*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=a&255,f+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+f]=o&255,f+=p,o/=256,l-=8);e[n+f-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Za,n=Mu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const v=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(v,g),v.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(v){if(v>i)throw new RangeError('The value "'+v+'" is invalid for option "size"');const g=new s(v);return Object.setPrototypeOf(g,u.prototype),g}function u(v,g,_){if(typeof v=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(v)}return h(v,g,_)}u.poolSize=8192;function h(v,g,_){if(typeof v=="string")return m(v,g);if(o.isView(v))return b(v);if(v==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v);if(dt(v,o)||v&&dt(v.buffer,o)||typeof a<"u"&&(dt(v,a)||v&&dt(v.buffer,a)))return T(v,g,_);if(typeof v=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const C=v.valueOf&&v.valueOf();if(C!=null&&C!==v)return u.from(C,g,_);const $=A(v);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof v[Symbol.toPrimitive]=="function")return u.from(v[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof v)}u.from=function(v,g,_){return h(v,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(v){if(typeof v!="number")throw new TypeError('"size" argument must be of type number');if(v<0)throw new RangeError('The value "'+v+'" is invalid for option "size"')}function f(v,g,_){return d(v),v<=0?l(v):g!==void 0?typeof _=="string"?l(v).fill(g,_):l(v).fill(g):l(v)}u.alloc=function(v,g,_){return f(v,g,_)};function p(v){return d(v),l(v<0?0:I(v)|0)}u.allocUnsafe=function(v){return p(v)},u.allocUnsafeSlow=function(v){return p(v)};function m(v,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=R(v,g)|0;let C=l(_);const $=C.write(v,g);return $!==_&&(C=C.slice(0,$)),C}function w(v){const g=v.length<0?0:I(v.length)|0,_=l(g);for(let C=0;C<g;C+=1)_[C]=v[C]&255;return _}function b(v){if(dt(v,s)){const g=new s(v);return T(g.buffer,g.byteOffset,g.byteLength)}return w(v)}function T(v,g,_){if(g<0||v.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(v.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let C;return g===void 0&&_===void 0?C=new s(v):_===void 0?C=new s(v,g):C=new s(v,g,_),Object.setPrototypeOf(C,u.prototype),C}function A(v){if(u.isBuffer(v)){const g=I(v.length)|0,_=l(g);return _.length===0||v.copy(_,0,0,g),_}if(v.length!==void 0)return typeof v.length!="number"||vt(v.length)?l(0):w(v);if(v.type==="Buffer"&&Array.isArray(v.data))return w(v.data)}function I(v){if(v>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return v|0}function U(v){return+v!=v&&(v=0),u.alloc(+v)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),dt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let C=g.length,$=_.length;for(let Q=0,it=Math.min(C,$);Q<it;++Q)if(g[Q]!==_[Q]){C=g[Q],$=_[Q];break}return C<$?-1:$<C?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let C;if(_===void 0)for(_=0,C=0;C<g.length;++C)_+=g[C].length;const $=u.allocUnsafe(_);let Q=0;for(C=0;C<g.length;++C){let it=g[C];if(dt(it,s))Q+it.length>$.length?(u.isBuffer(it)||(it=u.from(it)),it.copy($,Q)):s.prototype.set.call($,it,Q);else if(u.isBuffer(it))it.copy($,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return $};function R(v,g){if(u.isBuffer(v))return v.length;if(o.isView(v)||dt(v,o))return v.byteLength;if(typeof v!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof v);const _=v.length,C=arguments.length>2&&arguments[2]===!0;if(!C&&_===0)return 0;let $=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ct(v).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return pt(v).length;default:if($)return C?-1:ct(v).length;g=(""+g).toLowerCase(),$=!0}}u.byteLength=R;function O(v,g,_){let C=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(v||(v="utf8");;)switch(v){case"hex":return z(this,g,_);case"utf8":case"utf-8":return D(this,g,_);case"ascii":return ft(this,g,_);case"latin1":case"binary":return V(this,g,_);case"base64":return Z(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Et(this,g,_);default:if(C)throw new TypeError("Unknown encoding: "+v);v=(v+"").toLowerCase(),C=!0}}u.prototype._isBuffer=!0;function P(v,g,_){const C=v[g];v[g]=v[_],v[_]=C}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)P(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)P(this,_,_+3),P(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)P(this,_,_+7),P(this,_+1,_+6),P(this,_+2,_+5),P(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?D(this,0,g):O.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,C,$,Q){if(dt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),C===void 0&&(C=g?g.length:0),$===void 0&&($=0),Q===void 0&&(Q=this.length),_<0||C>g.length||$<0||Q>this.length)throw new RangeError("out of range index");if($>=Q&&_>=C)return 0;if($>=Q)return-1;if(_>=C)return 1;if(_>>>=0,C>>>=0,$>>>=0,Q>>>=0,this===g)return 0;let it=Q-$,zt=C-_;const ve=Math.min(it,zt),ye=this.slice($,Q),Re=g.slice(_,C);for(let ce=0;ce<ve;++ce)if(ye[ce]!==Re[ce]){it=ye[ce],zt=Re[ce];break}return it<zt?-1:zt<it?1:0};function N(v,g,_,C,$){if(v.length===0)return-1;if(typeof _=="string"?(C=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,vt(_)&&(_=$?0:v.length-1),_<0&&(_=v.length+_),_>=v.length){if($)return-1;_=v.length-1}else if(_<0)if($)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,C)),u.isBuffer(g))return g.length===0?-1:W(v,g,_,C,$);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?$?s.prototype.indexOf.call(v,g,_):s.prototype.lastIndexOf.call(v,g,_):W(v,[g],_,C,$);throw new TypeError("val must be string, number or Buffer")}function W(v,g,_,C,$){let Q=1,it=v.length,zt=g.length;if(C!==void 0&&(C=String(C).toLowerCase(),C==="ucs2"||C==="ucs-2"||C==="utf16le"||C==="utf-16le")){if(v.length<2||g.length<2)return-1;Q=2,it/=2,zt/=2,_/=2}function ve(Re,ce){return Q===1?Re[ce]:Re.readUInt16BE(ce*Q)}let ye;if($){let Re=-1;for(ye=_;ye<it;ye++)if(ve(v,ye)===ve(g,Re===-1?0:ye-Re)){if(Re===-1&&(Re=ye),ye-Re+1===zt)return Re*Q}else Re!==-1&&(ye-=ye-Re),Re=-1}else for(_+zt>it&&(_=it-zt),ye=_;ye>=0;ye--){let Re=!0;for(let ce=0;ce<zt;ce++)if(ve(v,ye+ce)!==ve(g,ce)){Re=!1;break}if(Re)return ye}return-1}u.prototype.includes=function(g,_,C){return this.indexOf(g,_,C)!==-1},u.prototype.indexOf=function(g,_,C){return N(this,g,_,C,!0)},u.prototype.lastIndexOf=function(g,_,C){return N(this,g,_,C,!1)};function et(v,g,_,C){_=Number(_)||0;const $=v.length-_;C?(C=Number(C),C>$&&(C=$)):C=$;const Q=g.length;C>Q/2&&(C=Q/2);let it;for(it=0;it<C;++it){const zt=parseInt(g.substr(it*2,2),16);if(vt(zt))return it;v[_+it]=zt}return it}function L(v,g,_,C){return bt(ct(g,v.length-_),v,_,C)}function S(v,g,_,C){return bt(ht(g),v,_,C)}function E(v,g,_,C){return bt(pt(g),v,_,C)}function B(v,g,_,C){return bt(J(g,v.length-_),v,_,C)}u.prototype.write=function(g,_,C,$){if(_===void 0)$="utf8",C=this.length,_=0;else if(C===void 0&&typeof _=="string")$=_,C=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(C)?(C=C>>>0,$===void 0&&($="utf8")):($=C,C=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-_;if((C===void 0||C>Q)&&(C=Q),g.length>0&&(C<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");let it=!1;for(;;)switch($){case"hex":return et(this,g,_,C);case"utf8":case"utf-8":return L(this,g,_,C);case"ascii":case"latin1":case"binary":return S(this,g,_,C);case"base64":return E(this,g,_,C);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,g,_,C);default:if(it)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),it=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(v,g,_){return g===0&&_===v.length?t.fromByteArray(v):t.fromByteArray(v.slice(g,_))}function D(v,g,_){_=Math.min(v.length,_);const C=[];let $=g;for(;$<_;){const Q=v[$];let it=null,zt=Q>239?4:Q>223?3:Q>191?2:1;if($+zt<=_){let ve,ye,Re,ce;switch(zt){case 1:Q<128&&(it=Q);break;case 2:ve=v[$+1],(ve&192)===128&&(ce=(Q&31)<<6|ve&63,ce>127&&(it=ce));break;case 3:ve=v[$+1],ye=v[$+2],(ve&192)===128&&(ye&192)===128&&(ce=(Q&15)<<12|(ve&63)<<6|ye&63,ce>2047&&(ce<55296||ce>57343)&&(it=ce));break;case 4:ve=v[$+1],ye=v[$+2],Re=v[$+3],(ve&192)===128&&(ye&192)===128&&(Re&192)===128&&(ce=(Q&15)<<18|(ve&63)<<12|(ye&63)<<6|Re&63,ce>65535&&ce<1114112&&(it=ce))}}it===null?(it=65533,zt=1):it>65535&&(it-=65536,C.push(it>>>10&1023|55296),it=56320|it&1023),C.push(it),$+=zt}return tt(C)}const st=4096;function tt(v){const g=v.length;if(g<=st)return String.fromCharCode.apply(String,v);let _="",C=0;for(;C<g;)_+=String.fromCharCode.apply(String,v.slice(C,C+=st));return _}function ft(v,g,_){let C="";_=Math.min(v.length,_);for(let $=g;$<_;++$)C+=String.fromCharCode(v[$]&127);return C}function V(v,g,_){let C="";_=Math.min(v.length,_);for(let $=g;$<_;++$)C+=String.fromCharCode(v[$]);return C}function z(v,g,_){const C=v.length;(!g||g<0)&&(g=0),(!_||_<0||_>C)&&(_=C);let $="";for(let Q=g;Q<_;++Q)$+=le[v[Q]];return $}function Et(v,g,_){const C=v.slice(g,_);let $="";for(let Q=0;Q<C.length-1;Q+=2)$+=String.fromCharCode(C[Q]+C[Q+1]*256);return $}u.prototype.slice=function(g,_){const C=this.length;g=~~g,_=_===void 0?C:~~_,g<0?(g+=C,g<0&&(g=0)):g>C&&(g=C),_<0?(_+=C,_<0&&(_=0)):_>C&&(_=C),_<g&&(_=g);const $=this.subarray(g,_);return Object.setPrototypeOf($,u.prototype),$};function at(v,g,_){if(v%1!==0||v<0)throw new RangeError("offset is not uint");if(v+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,C){g=g>>>0,_=_>>>0,C||at(g,_,this.length);let $=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)$+=this[g+it]*Q;return $},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,C){g=g>>>0,_=_>>>0,C||at(g,_,this.length);let $=this[g+--_],Q=1;for(;_>0&&(Q*=256);)$+=this[g+--_]*Q;return $},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||at(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||at(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||at(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||at(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Pt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],C=this[g+7];(_===void 0||C===void 0)&&F(g,this.length-8);const $=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+C*2**24;return BigInt($)+(BigInt(Q)<<BigInt(32))}),u.prototype.readBigUInt64BE=Pt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],C=this[g+7];(_===void 0||C===void 0)&&F(g,this.length-8);const $=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+C;return(BigInt($)<<BigInt(32))+BigInt(Q)}),u.prototype.readIntLE=function(g,_,C){g=g>>>0,_=_>>>0,C||at(g,_,this.length);let $=this[g],Q=1,it=0;for(;++it<_&&(Q*=256);)$+=this[g+it]*Q;return Q*=128,$>=Q&&($-=Math.pow(2,8*_)),$},u.prototype.readIntBE=function(g,_,C){g=g>>>0,_=_>>>0,C||at(g,_,this.length);let $=_,Q=1,it=this[g+--$];for(;$>0&&(Q*=256);)it+=this[g+--$]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*_)),it},u.prototype.readInt8=function(g,_){return g=g>>>0,_||at(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||at(g,2,this.length);const C=this[g]|this[g+1]<<8;return C&32768?C|4294901760:C},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||at(g,2,this.length);const C=this[g+1]|this[g]<<8;return C&32768?C|4294901760:C},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||at(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Pt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],C=this[g+7];(_===void 0||C===void 0)&&F(g,this.length-8);const $=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(C<<24);return(BigInt($)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Pt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],C=this[g+7];(_===void 0||C===void 0)&&F(g,this.length-8);const $=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt($)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+C)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||at(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||at(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||at(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||at(g,8,this.length),n.read(this,g,!1,52,8)};function lt(v,g,_,C,$,Q){if(!u.isBuffer(v))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>$||g<Q)throw new RangeError('"value" argument is out of bounds');if(_+C>v.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,C,$){if(g=+g,_=_>>>0,C=C>>>0,!$){const zt=Math.pow(2,8*C)-1;lt(this,g,_,C,zt,0)}let Q=1,it=0;for(this[_]=g&255;++it<C&&(Q*=256);)this[_+it]=g/Q&255;return _+C},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,C,$){if(g=+g,_=_>>>0,C=C>>>0,!$){const zt=Math.pow(2,8*C)-1;lt(this,g,_,C,zt,0)}let Q=C-1,it=1;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)this[_+Q]=g/it&255;return _+C},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function Mt(v,g,_,C,$){ot(g,C,$,v,_,7);let Q=Number(g&BigInt(4294967295));v[_++]=Q,Q=Q>>8,v[_++]=Q,Q=Q>>8,v[_++]=Q,Q=Q>>8,v[_++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return v[_++]=it,it=it>>8,v[_++]=it,it=it>>8,v[_++]=it,it=it>>8,v[_++]=it,_}function Xt(v,g,_,C,$){ot(g,C,$,v,_,7);let Q=Number(g&BigInt(4294967295));v[_+7]=Q,Q=Q>>8,v[_+6]=Q,Q=Q>>8,v[_+5]=Q,Q=Q>>8,v[_+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return v[_+3]=it,it=it>>8,v[_+2]=it,it=it>>8,v[_+1]=it,it=it>>8,v[_]=it,_+8}u.prototype.writeBigUInt64LE=Pt(function(g,_=0){return Mt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Pt(function(g,_=0){return Xt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,C,$){if(g=+g,_=_>>>0,!$){const ve=Math.pow(2,8*C-1);lt(this,g,_,C,ve-1,-ve)}let Q=0,it=1,zt=0;for(this[_]=g&255;++Q<C&&(it*=256);)g<0&&zt===0&&this[_+Q-1]!==0&&(zt=1),this[_+Q]=(g/it>>0)-zt&255;return _+C},u.prototype.writeIntBE=function(g,_,C,$){if(g=+g,_=_>>>0,!$){const ve=Math.pow(2,8*C-1);lt(this,g,_,C,ve-1,-ve)}let Q=C-1,it=1,zt=0;for(this[_+Q]=g&255;--Q>=0&&(it*=256);)g<0&&zt===0&&this[_+Q+1]!==0&&(zt=1),this[_+Q]=(g/it>>0)-zt&255;return _+C},u.prototype.writeInt8=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,C){return g=+g,_=_>>>0,C||lt(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=Pt(function(g,_=0){return Mt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Pt(function(g,_=0){return Xt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ut(v,g,_,C,$,Q){if(_+C>v.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function Tt(v,g,_,C,$){return g=+g,_=_>>>0,$||Ut(v,g,_,4),n.write(v,g,_,C,23,4),_+4}u.prototype.writeFloatLE=function(g,_,C){return Tt(this,g,_,!0,C)},u.prototype.writeFloatBE=function(g,_,C){return Tt(this,g,_,!1,C)};function Dt(v,g,_,C,$){return g=+g,_=_>>>0,$||Ut(v,g,_,8),n.write(v,g,_,C,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,C){return Dt(this,g,_,!0,C)},u.prototype.writeDoubleBE=function(g,_,C){return Dt(this,g,_,!1,C)},u.prototype.copy=function(g,_,C,$){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(C||(C=0),!$&&$!==0&&($=this.length),_>=g.length&&(_=g.length),_||(_=0),$>0&&$<C&&($=C),$===C||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(C<0||C>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),g.length-_<$-C&&($=g.length-_+C);const Q=$-C;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,C,$):s.prototype.set.call(g,this.subarray(C,$),_),Q},u.prototype.fill=function(g,_,C,$){if(typeof g=="string"){if(typeof _=="string"?($=_,_=0,C=this.length):typeof C=="string"&&($=C,C=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!u.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(g.length===1){const it=g.charCodeAt(0);($==="utf8"&&it<128||$==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<C)throw new RangeError("Out of range index");if(C<=_)return this;_=_>>>0,C=C===void 0?this.length:C>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=_;Q<C;++Q)this[Q]=g;else{const it=u.isBuffer(g)?g:u.from(g,$),zt=it.length;if(zt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<C-_;++Q)this[Q+_]=it[Q%zt]}return this};const Ft={};function Ae(v,g,_){Ft[v]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${v}]`,this.stack,delete this.name}get code(){return v}set code($){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:$,writable:!0})}toString(){return`${this.name} [${v}]: ${this.message}`}}}Ae("ERR_BUFFER_OUT_OF_BOUNDS",function(v){return v?`${v} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ae("ERR_INVALID_ARG_TYPE",function(v,g){return`The "${v}" argument must be of type number. Received type ${typeof g}`},TypeError),Ae("ERR_OUT_OF_RANGE",function(v,g,_){let C=`The value of "${v}" is out of range.`,$=_;return Number.isInteger(_)&&Math.abs(_)>2**32?$=Me(String(_)):typeof _=="bigint"&&($=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&($=Me($)),$+="n"),C+=` It must be ${g}. Received ${$}`,C},RangeError);function Me(v){let g="",_=v.length;const C=v[0]==="-"?1:0;for(;_>=C+4;_-=3)g=`_${v.slice(_-3,_)}${g}`;return`${v.slice(0,_)}${g}`}function k(v,g,_){nt(g,"offset"),(v[g]===void 0||v[g+_]===void 0)&&F(g,v.length-(_+1))}function ot(v,g,_,C,$,Q){if(v>_||v<g){const it=typeof g=="bigint"?"n":"";let zt;throw g===0||g===BigInt(0)?zt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:zt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Ft.ERR_OUT_OF_RANGE("value",zt,v)}k(C,$,Q)}function nt(v,g){if(typeof v!="number")throw new Ft.ERR_INVALID_ARG_TYPE(g,"number",v)}function F(v,g,_){throw Math.floor(v)!==v?(nt(v,_),new Ft.ERR_OUT_OF_RANGE("offset","an integer",v)):g<0?new Ft.ERR_BUFFER_OUT_OF_BOUNDS:new Ft.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,v)}const M=/[^+/0-9A-Za-z-_]/g;function G(v){if(v=v.split("=")[0],v=v.trim().replace(M,""),v.length<2)return"";for(;v.length%4!==0;)v=v+"=";return v}function ct(v,g){g=g||1/0;let _;const C=v.length;let $=null;const Q=[];for(let it=0;it<C;++it){if(_=v.charCodeAt(it),_>55295&&_<57344){if(!$){if(_>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===C){(g-=3)>-1&&Q.push(239,191,189);continue}$=_;continue}if(_<56320){(g-=3)>-1&&Q.push(239,191,189),$=_;continue}_=($-55296<<10|_-56320)+65536}else $&&(g-=3)>-1&&Q.push(239,191,189);if($=null,_<128){if((g-=1)<0)break;Q.push(_)}else if(_<2048){if((g-=2)<0)break;Q.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;Q.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;Q.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return Q}function ht(v){const g=[];for(let _=0;_<v.length;++_)g.push(v.charCodeAt(_)&255);return g}function J(v,g){let _,C,$;const Q=[];for(let it=0;it<v.length&&!((g-=2)<0);++it)_=v.charCodeAt(it),C=_>>8,$=_%256,Q.push($),Q.push(C);return Q}function pt(v){return t.toByteArray(G(v))}function bt(v,g,_,C){let $;for($=0;$<C&&!($+_>=g.length||$>=v.length);++$)g[$+_]=v[$];return $}function dt(v,g){return v instanceof g||v!=null&&v.constructor!=null&&v.constructor.name!=null&&v.constructor.name===g.name}function vt(v){return v!==v}const le=function(){const v="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const C=_*16;for(let $=0;$<16;++$)g[C+$]=v[_]+v[$]}return g}();function Pt(v){return typeof BigInt>"u"?Bn:v}function Bn(){throw new Error("BigInt not supported")}})(N0);const on=N0.Buffer,C0=e=>e===void 0?null:e;class qw{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let L0=new qw,Jw=!0;try{typeof localStorage<"u"&&localStorage&&(L0=localStorage,Jw=!1)}catch{}const Zw=L0,Qw=Object.assign,tx=Object.keys,ex=(e,t)=>{for(const n in e)t(e[n],n)},M0=e=>tx(e).length,nx=e=>{for(const t in e)return!1;return!0},rx=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},ix=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),sx=(e,t)=>e===t||M0(e)===M0(t)&&rx(e,(n,r)=>(n!==void 0||ix(t,r))&&t[r]===n),ox=Object.freeze,U0=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&U0(e[t])}return ox(e)},Uu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Uu(e,t,n+1)}},ax=e=>e,cx=(e,t)=>t.includes(e);var F0={};const Do=typeof mr<"u"&&mr.release&&/node|io\.js/.test(mr.release.name)&&Object.prototype.toString.call(typeof mr<"u"?mr:0)==="[object process]";let Pr;const lx=()=>{if(Pr===void 0)if(Do){Pr=gr();const e=mr.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Pr.set(t,""),t=r):t!==null&&(Pr.set(t,r),t=null)}t!==null&&Pr.set(t,"")}else typeof location=="object"?(Pr=gr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Pr.set(`--${E0(t,"-")}`,n),Pr.set(`-${E0(t,"-")}`,n)}})):Pr=gr();return Pr},Fu=e=>lx().has(e),Qa=e=>C0(Do?F0[e.toUpperCase().replaceAll("-","_")]:Zw.getItem(e)),P0=e=>Fu("--"+e)||Qa(e)!==null;P0("production");const ux=Do&&cx(F0.FORCE_COLOR,["true","1","2"])||!Fu("--no-colors")&&!P0("no-color")&&(!Do||mr.stdout.isTTY)&&(!Do||Fu("--color")||Qa("COLORTERM")!==null||(Qa("TERM")||"").includes("color")),hx=e=>new Uint8Array(e),fx=e=>{const t=hx(e.byteLength);return t.set(e),t};class dx{constructor(t,n){this.left=t,this.right=n}}const ai=(e,t)=>new dx(e,t);typeof DOMParser<"u"&&new DOMParser;const px=e=>fw(e,(t,n)=>`${n}:${t};`).join(""),ci=Symbol,B0=ci(),D0=ci(),mx=ci(),gx=ci(),yx=ci(),$0=ci(),_x=ci(),Pu=ci(),bx=ci(),Ex=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},wx={[B0]:ai("font-weight","bold"),[D0]:ai("font-weight","normal"),[mx]:ai("color","blue"),[yx]:ai("color","green"),[gx]:ai("color","grey"),[$0]:ai("color","red"),[_x]:ai("color","purple"),[Pu]:ai("color","orange"),[bx]:ai("color","black")},j0=ux?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=gr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=wx[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=px(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:Ex,xx=(...e)=>{console.log(...j0(e)),z0.forEach(t=>t.print(e))},kx=(...e)=>{console.warn(...j0(e)),e.unshift(Pu),z0.forEach(t=>t.print(e))},z0=Ls(),W0=e=>({[Symbol.iterator](){return this},next:e}),Tx=(e,t)=>W0(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Bu=(e,t)=>W0(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Du{constructor(t,n){this.clock=t,this.len=n}}class $o{constructor(){this.clients=new Map}}const K0=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];op(e,s,a.clock,a.len,n)}}),Ax=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ii((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},G0=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Ax(n,t.clock)!==null},$u=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Qi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},vx=e=>{const t=new $o;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)pw(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return $u(t),t},tc=(e,t,n,r)=>{Si(e.clients,t,()=>[]).push(new Du(n,r))},Rx=()=>new $o,Sx=e=>{const t=Rx();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Du(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Ds=(e,t)=>{re(e.restEncoder,t.clients.size),Zi(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),re(e.restEncoder,n);const i=r.length;re(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},ju=e=>{const t=new $o,n=Ht(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Ht(e.restDecoder),s=Ht(e.restDecoder);if(s>0){const o=Si(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Du(e.readDsClock(),e.readDsLen()))}}return t},H0=(e,t,n)=>{const r=new $o,i=Ht(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Ht(e.restDecoder),a=Ht(e.restDecoder),c=n.clients.get(o)||[],l=en(n,o);for(let u=0;u<a;u++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<l){l<d&&tc(r,o,l,d-l);let f=Br(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,pc(t,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,pc(t,p,d-p.id.clock)),p.delete(t))}else tc(r,o,h,d-h)}}if(r.clients.size>0){const s=new es;return re(s.restEncoder,0),Ds(s,r),s.toUint8Array()}return null},Y0=S0;class $s extends gw{constructor({guid:t=jw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Y0(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new rp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=I0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>I0(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&fe(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Zi(this.subdocs).map(t=>t.guid))}transact(t,n=null){return fe(this,t,n)}get(t,n=an){const r=Si(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==an&&i!==n)if(i===an){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Ks)}getText(t=""){return this.get(t,li)}getMap(t=""){return this.get(t,Gs)}getXmlElement(t=""){return this.get(t,Ys)}getXmlFragment(t=""){return this.get(t,ns)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Zi(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new $s({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,fe(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class V0{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Ht(this.restDecoder)}readDsLen(){return Ht(this.restDecoder)}}class X0 extends V0{readLeftID(){return qt(Ht(this.restDecoder),Ht(this.restDecoder))}readRightID(){return qt(Ht(this.restDecoder),Ht(this.restDecoder))}readClient(){return Ht(this.restDecoder)}readInfo(){return Fs(this.restDecoder)}readString(){return Ps(this.restDecoder)}readParentInfo(){return Ht(this.restDecoder)===1}readTypeRef(){return Ht(this.restDecoder)}readLen(){return Ht(this.restDecoder)}readAny(){return Bo(this.restDecoder)}readBuf(){return fx(Wn(this.restDecoder))}readJSON(){return JSON.parse(Ps(this.restDecoder))}readKey(){return Ps(this.restDecoder)}}class Ix{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ht(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Ht(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class js extends Ix{constructor(t){super(t),this.keys=[],Ht(t),this.keyClockDecoder=new Cu(Wn(t)),this.clientDecoder=new Ja(Wn(t)),this.leftClockDecoder=new Cu(Wn(t)),this.rightClockDecoder=new Cu(Wn(t)),this.infoDecoder=new R0(Wn(t),Fs),this.stringDecoder=new Bw(Wn(t)),this.parentInfoDecoder=new R0(Wn(t),Fs),this.typeRefDecoder=new Ja(Wn(t)),this.lenDecoder=new Ja(Wn(t))}readLeftID(){return new zs(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new zs(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Bo(this.restDecoder)}readBuf(){return Wn(this.restDecoder)}readJSON(){return Bo(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Nx{constructor(){this.restEncoder=Ya()}toUint8Array(){return Lr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){re(this.restEncoder,t)}writeDsLen(t){re(this.restEncoder,t)}}class jo extends Nx{writeLeftID(t){re(this.restEncoder,t.client),re(this.restEncoder,t.clock)}writeRightID(t){re(this.restEncoder,t.client),re(this.restEncoder,t.clock)}writeClient(t){re(this.restEncoder,t)}writeInfo(t){Au(this.restEncoder,t)}writeString(t){Ms(this.restEncoder,t)}writeParentInfo(t){re(this.restEncoder,t?1:0)}writeTypeRef(t){re(this.restEncoder,t)}writeLen(t){re(this.restEncoder,t)}writeAny(t){Po(this.restEncoder,t)}writeBuf(t){zn(this.restEncoder,t)}writeJSON(t){Ms(this.restEncoder,JSON.stringify(t))}writeKey(t){Ms(this.restEncoder,t)}}class Ox{constructor(){this.restEncoder=Ya(),this.dsCurrVal=0}toUint8Array(){return Lr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,re(this.restEncoder,n)}writeDsLen(t){t===0&&Ur(),re(this.restEncoder,t-1),this.dsCurrVal+=t}}class es extends Ox{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Iu,this.clientEncoder=new Xa,this.leftClockEncoder=new Iu,this.rightClockEncoder=new Iu,this.infoEncoder=new x0(Au),this.stringEncoder=new Mw,this.parentInfoEncoder=new x0(Au),this.typeRefEncoder=new Xa,this.lenEncoder=new Xa}toUint8Array(){const t=Ya();return re(t,0),zn(t,this.keyClockEncoder.toUint8Array()),zn(t,this.clientEncoder.toUint8Array()),zn(t,this.leftClockEncoder.toUint8Array()),zn(t,this.rightClockEncoder.toUint8Array()),zn(t,Lr(this.infoEncoder)),zn(t,this.stringEncoder.toUint8Array()),zn(t,Lr(this.parentInfoEncoder)),zn(t,this.typeRefEncoder.toUint8Array()),zn(t,this.lenEncoder.toUint8Array()),Va(t,Lr(this.restEncoder)),Lr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Po(this.restEncoder,t)}writeBuf(t){zn(this.restEncoder,t)}writeJSON(t){Po(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Cx=(e,t,n,r)=>{r=Qi(r,t[0].id.clock);const i=Br(t,r);re(e.restEncoder,t.length-i),e.writeClient(n),re(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},zu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{en(t,s)>i&&r.set(s,i)}),Ku(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),re(e.restEncoder,r.size),Zi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Cx(e,t.clients.get(i),i,s)})},Lx=(e,t)=>{const n=gr(),r=Ht(e.restDecoder);for(let i=0;i<r;i++){const s=Ht(e.restDecoder),o=new Array(s),a=e.readClient();let c=Ht(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(Ha&u){case 0:{const h=e.readLen();o[l]=new Qn(qt(a,c),h),c+=h;break}case 10:{const h=Ht(e.restDecoder);o[l]=new tr(qt(a,c),h),c+=h;break}default:{const h=(u&(oi|jn))===0,d=new Ye(qt(a,c),null,(u&jn)===jn?e.readLeftID():null,null,(u&oi)===oi?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(u&Lo)===Lo?e.readString():null,Op(e,u));o[l]=d,c+=d.length}}}}return n},Mx=(e,t,n)=>{const r=[];let i=Zi(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new rp,c=new Map,l=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),i=i.filter(w=>w!==p)}r.length=0};for(;;){if(u.constructor!==tr){const p=Si(h,u.id.client,()=>en(t,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(e,t);if(m!==null){r.push(u);const w=n.get(m)||{refs:[],i:0};if(w.refs.length===w.i)l(m,en(t,m)),d();else{u=w.refs[w.i++];continue}}else(p===0||p<u.length)&&(u.integrate(e,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new es;return zu(f,a,new Map),re(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},Ux=(e,t)=>zu(e,t.doc.store,t.beforeState),Fx=(e,t,n,r=new js(e))=>fe(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=Lx(r,o),l=Mx(i,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<en(a,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=rc([u.update,l.update])}}else a.pendingStructs=l;const h=H0(r,i,a);if(a.pendingDs){const d=new js(Us(a.pendingDs));Ht(d.restDecoder);const f=H0(d,i,a);h&&f?a.pendingDs=rc([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,q0(i.doc,d)}},n,!1),q0=(e,t,n,r=js)=>{const i=Us(t);Fx(i,e,n,new r(i))},J0=(e,t,n)=>q0(e,t,n,X0),Px=(e,t,n=new Map)=>{zu(e,t.store,n),Ds(e,Sx(t.store))},Bx=(e,t=new Uint8Array([0]),n=new es)=>{const r=Z0(t);Px(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(qx(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===jo)return Vx(i.map((s,o)=>o===0?s:Zx(s)));if(n.constructor===es)return rc(i)}return i[0]},Dx=(e,t)=>Bx(e,t,new jo),$x=e=>{const t=new Map,n=Ht(e.restDecoder);for(let r=0;r<n;r++){const i=Ht(e.restDecoder),s=Ht(e.restDecoder);t.set(i,s)}return t},Z0=e=>$x(new V0(Us(e)));class jx{constructor(){this.l=[]}}const Q0=()=>new jx,tp=(e,t)=>e.l.push(t),ep=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},np=(e,t,n)=>Uu(e.l,[t,n]);class zs{constructor(t,n){this.client=t,this.clock=n}}const ec=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,qt=(e,t)=>new zs(e,t),zx=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Ur()},Ws=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!G0(t.ds,e.id),Wu=(e,t)=>{const n=Si(e.meta,Wu,Ls),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<en(r,s)&&Oi(e,qt(s,i))}),K0(e,t.ds,i=>{}),n.add(t))};class rp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ku=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},en=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ip=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Ur()}n.push(t)},Br=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ii(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ii((n+r)/2)}throw Ur()},Gu=(e,t)=>{const n=e.clients.get(t.client);return n[Br(n,t.clock)]},Hu=(e,t,n)=>{const r=Br(t,n),i=t[r];return i.id.clock<n&&i instanceof Ye?(t.splice(r+1,0,pc(e,i,n-i.id.clock)),r+1):r},Oi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Hu(e,n,t.clock)]},sp=(e,t,n)=>{const r=t.clients.get(n.client),i=Br(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Qn&&r.splice(i+1,0,pc(e,s,n.clock-s.id.clock+1)),s},Wx=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Br(r,t.id.clock)]=n},op=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Hu(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Hu(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class Kx{constructor(t,n,r){this.doc=t,this.deleteSet=new $o,this.beforeState=Ku(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ap=(e,t)=>t.deleteSet.clients.size===0&&!dw(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:($u(t.deleteSet),Ux(e,t),Ds(e,t.deleteSet),!0),cp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Si(e.changed,t,Ls).add(n)},nc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ye&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},Gx=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Br(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof Ye&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Hx=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=m0(i.length-1,1+Br(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+nc(i,c)}})},lp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{$u(s),n.afterState=Ku(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),np(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Uu(a,[]),n._needFormattingCleanup&&fk(n)}finally{r.gc&&Gx(s,i,r.gcFilter),Hx(s,i),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),p=Qi(Br(f,d),1);for(let m=f.length-1;m>=p;)m-=1+nc(f,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=i.clients.get(h),p=Br(f,d);p+1<f.length&&nc(f,p+1)>1||p>0&&nc(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(xx(Pu,B0,"[yjs] ",D0,$0,"Changed the client-id because another client seems to be using it."),r.clientID=Y0()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new jo;ap(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new es;ap(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):lp(e,t+1)}}},fe=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new Kx(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&lp(i,0)}}return o};function*Yx(e){const t=Ht(e.restDecoder);for(let n=0;n<t;n++){const r=Ht(e.restDecoder),i=e.readClient();let s=Ht(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Ht(e.restDecoder);yield new tr(qt(i,s),c),s+=c}else if(Ha&a){const c=(a&(oi|jn))===0,l=new Ye(qt(i,s),null,(a&jn)===jn?e.readLeftID():null,null,(a&oi)===oi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&Lo)===Lo?e.readString():null,Op(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new Qn(qt(i,s),c),s+=c}}}}class Yu{constructor(t,n){this.gen=Yx(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===tr);return this.curr}}class Vu{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Vx=e=>rc(e,X0,jo),Xx=(e,t)=>{if(e.constructor===Qn){const{client:n,clock:r}=e.id;return new Qn(qt(n,r+t),e.length-t)}else if(e.constructor===tr){const{client:n,clock:r}=e.id;return new tr(qt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Ye(qt(r,i+t),null,qt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},rc=(e,t=js,n=es)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Us(u)));let i=r.map(u=>new Yu(u,!0)),s=null;const o=new n,a=new Vu(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===tr?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Ci(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===tr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Ci(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new tr(qt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===tr?s.struct.length-=p:d=Xx(d,p)),s.struct.mergeWith(d)||(Ci(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==tr;d=u.next())Ci(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Ci(a,s.struct,s.offset),s=null),Xu(a);const c=r.map(u=>ju(u)),l=vx(c);return Ds(o,l),o.toUint8Array()},qx=(e,t,n=js,r=es)=>{const i=Z0(t),s=new r,o=new Vu(s),a=new n(Us(e)),c=new Yu(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===tr){c.next();continue}if(u.id.clock+u.length>d)for(Ci(o,u,Qi(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Ci(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Xu(o);const l=ju(a);return Ds(s,l),s.toUint8Array()},up=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Lr(e.encoder.restEncoder)}),e.encoder.restEncoder=Ya(),e.written=0)},Ci=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&up(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),re(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Xu=e=>{up(e);const t=e.encoder.restEncoder;re(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];re(t,r.written),Va(t,r.restEncoder)}},Jx=(e,t,n,r)=>{const i=new n(Us(e)),s=new Yu(i,!1),o=new r,a=new Vu(o);for(let l=s.curr;l!==null;l=s.next())Ci(a,t(l),0);Xu(a);const c=ju(i);return Ds(o,c),o.toUint8Array()},Zx=e=>Jx(e,ax,js,jo),hp="You must not compute changes after the event-handler fired.";class ic{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Qx(this.currentTarget,this.target))}deletes(t){return G0(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ni(hp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=wu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=wu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=wu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ni(hp);const n=this.target,r=Ls(),i=Ls(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const Qx=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},fn=()=>{kx("Invalid access: Add Yjs type to a document before reading data.")},fp=80;let qu=0;class tk{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=qu++}}const ek=e=>{e.timestamp=qu++},dp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=qu++},nk=(e,t,n)=>{if(e.length>=fp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return dp(r,t,n),r}else{const r=new tk(t,n);return e.push(r),r}},sc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Ga(t-s.index)<Ga(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,ek(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Ga(n.index-i)<r.parent.length/fp?(dp(n,r,i),n):nk(e._searchMarker,r,i)},zo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Qi(t,i.index+n))}},oc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Si(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;np(r._eH,n,t)};class an{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Q0(),this._dEH=Q0(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Mr()}clone(){throw Mr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){tp(this._eH,t)}observeDeep(t){tp(this._dEH,t)}unobserve(t){ep(this._eH,t)}unobserveDeep(t){ep(this._dEH,t)}toJSON(){}}const pp=(e,t,n)=>{e.doc??fn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},mp=e=>{e.doc??fn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Wo=(e,t)=>{let n=0,r=e._start;for(e.doc??fn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},gp=(e,t)=>{const n=[];return Wo(e,(r,i)=>{n.push(t(r,i,e))}),n},rk=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},yp=(e,t)=>{e.doc??fn();const n=sc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},ac=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ye(qt(o,en(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new is(l)),i.integrate(e,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new Ye(qt(o,en(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ko(new Uint8Array(h))),i.integrate(e,0);break;case $s:i=new Ye(qt(o,en(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ho(h)),i.integrate(e,0);break;default:if(h instanceof an)i=new Ye(qt(o,en(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ui(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},_p=()=>Ni("Length exceeded!"),bp=(e,t,n,r)=>{if(n>t._length)throw _p();if(n===0)return t._searchMarker&&zo(t._searchMarker,n,r.length),ac(e,t,null,r);const i=n,s=sc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Oi(e,qt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&zo(t._searchMarker,i,r.length),ac(e,t,o,r)},ik=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return ac(e,t,i,n)},Ep=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=sc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Oi(e,qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Oi(e,qt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw _p();t._searchMarker&&zo(t._searchMarker,i,-s+r)},cc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Ju=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new is([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new is([r]);break;case Uint8Array:a=new Ko(r);break;case $s:a=new Ho(r);break;default:if(r instanceof an)a=new ui(r);else throw new Error("Unexpected content type")}new Ye(qt(o,en(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Zu=(e,t)=>{e.doc??fn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},wp=e=>{const t={};return e.doc??fn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},xp=(e,t)=>{e.doc??fn();const n=e._map.get(t);return n!==void 0&&!n.deleted},sk=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Ws(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},lc=e=>(e.doc??fn(),Tx(e._map.entries(),t=>!t[1].deleted));class ok extends ic{}class Ks extends an{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Ks;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ks}clone(){const t=new Ks;return t.insert(0,this.toArray().map(n=>n instanceof an?n.clone():n)),t}get length(){return this.doc??fn(),this._length}_callObserver(t,n){super._callObserver(t,n),oc(this,t,new ok(this,t))}insert(t,n){this.doc!==null?fe(this.doc,r=>{bp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?fe(this.doc,n=>{ik(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?fe(this.doc,r=>{Ep(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return yp(this,t)}toArray(){return mp(this)}slice(t=0,n=this.length){return pp(this,t,n)}toJSON(){return this.map(t=>t instanceof an?t.toJSON():t)}map(t){return gp(this,t)}forEach(t){Wo(this,t)}[Symbol.iterator](){return rk(this)}_write(t){t.writeTypeRef(Ok)}}const ak=e=>new Ks;class ck extends ic{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Gs extends an{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Gs}clone(){const t=new Gs;return this.forEach((n,r)=>{t.set(r,n instanceof an?n.clone():n)}),t}_callObserver(t,n){oc(this,t,new ck(this,t,n))}toJSON(){this.doc??fn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof an?i.toJSON():i}}),t}get size(){return[...lc(this)].length}keys(){return Bu(lc(this),t=>t[0])}values(){return Bu(lc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Bu(lc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??fn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?fe(this.doc,n=>{cc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?fe(this.doc,r=>{Ju(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Zu(this,t)}has(t){return xp(this,t)}clear(){this.doc!==null?fe(this.doc,t=>{this.forEach(function(n,r,i){cc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ck)}}const lk=e=>new Gs,Li=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&sx(e,t);class Qu{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Ur(),this.right.content.constructor){case He:this.right.deleted||Hs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const kp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case He:t.right.deleted||Hs(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Oi(e,qt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},uc=(e,t,n,r)=>{const i=new Map,s=r?sc(t,n):null;if(s){const o=new Qu(s.p.left,s.p,s.index,i);return kp(e,o,n-s.index)}else{const o=new Qu(null,t._start,0,i);return kp(e,o,n)}},Tp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===He&&Li(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ye(qt(s,en(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new He(a,o));u.integrate(e,0),n.right=u,n.forward()})},Hs=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Ap=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===He&&Li(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},vp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Li(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new Ye(qt(s,en(i.store,s)),u,u&&u.lastId,h,h&&h.id,t,null,new He(a,c)),n.right.integrate(e,0),n.forward()}}return o},th=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=e.doc,o=s.clientID;Ap(n,i);const a=vp(e,t,n,i),c=r.constructor===String?new Dr(r):r instanceof an?new ui(r):new rs(r);let{left:l,right:u,index:h}=n;t._searchMarker&&zo(t._searchMarker,n.index,c.getLength()),u=new Ye(qt(o,en(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=h,n.forward(),Tp(e,t,n,a)},Rp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Ap(n,i);const a=vp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===He));){if(!n.right.deleted)switch(n.right.content.constructor){case He:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Li(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Oi(e,qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ye(qt(o,en(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Dr(c)),n.right.integrate(e,0),n.forward()}Tp(e,t,n,a)},Sp=(e,t,n,r,i)=>{let s=t;const o=gr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===He){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case He:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(t.delete(e),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&Hs(i,l);break}}}t=t.right}return a},uk=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===He){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},hk=e=>{let t=0;return fe(e.doc,n=>{let r=e._start,i=e._start,s=gr();const o=Eu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case He:Hs(o,i.content);break;default:t+=Sp(n,r,i,s,o),s=Eu(o),r=i;break}i=i.right}}),t},fk=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&op(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===He&&o.constructor!==Qn&&t.add(o.parent)})}fe(n,r=>{K0(e,e.deleteSet,i=>{if(i instanceof Qn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===He?t.add(s):uk(r,i)});for(const i of t)hk(i)})},Ip=(e,t,n)=>{const r=n,i=Eu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case ui:case rs:case Dr:n<t.right.length&&Oi(e,qt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Sp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&zo(o._searchMarker,t.index,-r+n),t};class dk extends ic{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];fe(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},nx(c)||(f.attributes=Qw({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case ui:case rs:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Dr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case He:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(f)??null;Li(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Li(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const m=i.get(f)??null;Li(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){s.set(f,p);const m=c[f];m!==void 0&&(Li(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),Hs(i,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class li extends an{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??fn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new li}clone(){const t=new li;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new dk(this,t,n);oc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??fn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Dr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?fe(this.doc,r=>{const i=new Qu(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&th(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Rp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Ip(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??fn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const u=()=>{for(;c!==null;){if(Ws(c,t)||n!==void 0&&Ws(c,n))switch(c.content.constructor){case Dr:{const h=s.get("ychange");t!==void 0&&!Ws(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Ws(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case ui:case rs:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case He:Ws(c,t)&&(l(),Hs(s,c.content));break}c=c.right}l()};return t||n?fe(o,h=>{t&&Wu(h,t),n&&Wu(h,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?fe(i,s=>{const o=uc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),th(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?fe(i,s=>{const o=uc(s,this,t,!r);th(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?fe(r,i=>{Ip(i,uc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?fe(i,s=>{const o=uc(s,this,t,!1);o.right!==null&&Rp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?fe(this.doc,n=>{cc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?fe(this.doc,r=>{Ju(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Zu(this,t)}getAttributes(){return wp(this)}_write(t){t.writeTypeRef(Lk)}}const pk=e=>new li;class eh{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??fn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Ys||n.constructor===ns)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class ns extends an{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ns}clone(){const t=new ns;return t.insert(0,this.toArray().map(n=>n instanceof an?n.clone():n)),t}get length(){return this.doc??fn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new eh(this,t)}querySelector(t){t=t.toUpperCase();const r=new eh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Zi(new eh(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){oc(this,t,new yk(this,n,t))}toString(){return gp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Wo(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?fe(this.doc,r=>{bp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)fe(this.doc,r=>{const i=t&&t instanceof an?t._item:t;ac(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ni("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?fe(this.doc,r=>{Ep(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return mp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return yp(this,t)}slice(t=0,n=this.length){return pp(this,t,n)}forEach(t){Wo(this,t)}_write(t){t.writeTypeRef(Uk)}}const mk=e=>new ns;class Ys extends ns{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Ys(this.nodeName)}clone(){const t=new Ys(this.nodeName),n=this.getAttributes();return ex(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof an?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?fe(this.doc,n=>{cc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?fe(this.doc,r=>{Ju(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Zu(this,t)}hasAttribute(t){return xp(this,t)}getAttributes(t){return t?sk(this,t):wp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Wo(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Mk),t.writeKey(this.nodeName)}}const gk=e=>new Ys(e.readKey());class yk extends ic{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class hc extends Gs{constructor(t){super(),this.hookName=t}_copy(){return new hc(this.hookName)}clone(){const t=new hc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Fk),t.writeKey(this.hookName)}}const _k=e=>new hc(e.readKey());class fc extends li{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new fc}clone(){const t=new fc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Pk)}}const bk=e=>new fc;class nh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Mr()}mergeWith(t){return!1}write(t,n,r){throw Mr()}integrate(t,n){throw Mr()}}const Ek=0;class Qn extends nh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),ip(t.doc.store,this)}write(t,n){t.writeInfo(Ek),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ko{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ko(this.content)}splice(t){throw Mr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const wk=e=>new Ko(e.readBuf());class Go{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Go(this.len)}splice(t){const n=new Go(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){tc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const xk=e=>new Go(e.readLen()),Np=(e,t)=>new $s({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ho{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ho(Np(this.doc.guid,this.opts))}splice(t){throw Mr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const kk=e=>new Ho(Np(e.readString(),e.readAny()));class rs{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new rs(this.embed)}splice(t){throw Mr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Tk=e=>new rs(e.readJSON());class He{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new He(this.key,this.value)}splice(t){throw Mr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Ak=e=>new He(e.readKey(),e.readJSON());class dc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new dc(this.arr)}splice(t){const n=new dc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const vk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new dc(n)},Rk=Qa("node_env")==="development";class is{constructor(t){this.arr=t,Rk&&U0(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new is(this.arr)}splice(t){const n=new is(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const Sk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new is(n)};class Dr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Dr(this.str)}splice(t){const n=new Dr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Ik=e=>new Dr(e.readString()),Nk=[ak,lk,pk,gk,mk,_k,bk],Ok=0,Ck=1,Lk=2,Mk=3,Uk=4,Fk=5,Pk=6;class ui{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ui(this.type._copy())}splice(t){throw Mr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Bk=e=>new ui(Nk[e.readTypeRef()](e)),pc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Ye(qt(r,i+n),t,qt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=qt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Ye extends nh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?_0:0}set marker(t){(this.info&ku)>0!==t&&(this.info^=ku)}get marker(){return(this.info&ku)>0}get keep(){return(this.info&y0)>0}set keep(t){this.keep!==t&&(this.info^=y0)}get countable(){return(this.info&_0)>0}get deleted(){return(this.info&xu)>0}set deleted(t){this.deleted!==t&&(this.info^=xu)}markDeleted(){this.info|=xu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=en(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=en(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===zs&&this.id.client!==this.parent.client&&this.parent.clock>=en(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=sp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Oi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Qn||this.right&&this.right.constructor===Qn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ye?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ye&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===zs){const r=Gu(n,this.parent);r.constructor===Qn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=sp(t,t.doc.store,qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),ec(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(ec(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Gu(t.doc.store,i.origin)))s.has(Gu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ip(t.doc.store,this),this.content.integrate(t,this),cp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Qn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:qt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&ec(t.origin,this.lastId)&&this.right===t&&ec(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),tc(t.deleteSet,this.id.client,this.id.clock,this.length),cp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Ur();this.content.gc(t),n?Wx(t,this,new Qn(this.id,this.length)):this.content=new Go(this.length)}write(t,n){const r=n>0?qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Ha|(r===null?0:jn)|(i===null?0:oi)|(s===null?0:Lo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=zx(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===zs?(t.writeParentInfo(!1),t.writeLeftID(a)):Ur();s!==null&&t.writeString(s)}this.content.write(t,n)}}const Op=(e,t)=>Dk[t&Ha](e),Dk=[()=>{Ur()},xk,vk,wk,Ik,Tk,Ak,Bk,Sk,kk,()=>{Ur()}],$k=10;class tr extends nh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Ur()}write(t,n){t.writeInfo($k),re(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Cp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Cs<"u"?Cs:{},Lp="__ $YJS$ __";Cp[Lp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Cp[Lp]=!0;let Mp=!1;const Kn=new $s;function Up(e,t,n){const r=Kn.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function jk(e,t){Up(e,0,t)}function rh(e,t){const n=new li(t);Up(e,1,n)}function zk(e,t){Kn.getMap().set(e,t)}function Wk(e,t){const n=Kn.getMap(),r=new li(t);n.set(e,r)}function Fp(e,t){const n=Kn.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function Kk(e,t){return Fp(e,n=>{St(n)&&t(n)})}function Pp(e,t){return Fp(e,n=>{n instanceof li&&t(n.toJSON())})}const ss=Ss("modem",["second"],e=>{if(ss.session(e))switch(e.target){case"second":!Mp&&e.data%2===0&&ss.emit(e.player,"modem:join");break;case"join":e.sender!==ss.id()&&ss.reply(e,"joinack",h0(Dx(Kn)));break;case"joinack":e.sender!==ss.id()&&(Mp=!0,J0(Kn,Wa(e.data),Kn));break;case"sync":{e.sender!==ss.id()&&x(e.data)&&J0(Kn,Wa(e.data),Kn);break}}});function Bp(e,t){t!==Kn&&ss.emit("","modem:sync",h0(e))}Kn.on("update",Bp),Kn.on("destroy",()=>{Kn.off("update",Bp)});function Gk(e,t){return e%t}function Hk(e,t){return Math.floor(e/t)}function Yk(e,t){return{x:Gk(e,t),y:Hk(e,t)}}function Vs(e,t){return e.x+e.y*t}function ih(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function Dp(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function $p(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const jp="176",Vk="",yr="srgb",zp="srgb-linear",Wp="linear",sh="srgb";function _r(e,t,n){return Math.max(t,Math.min(n,e))}function Xk(e,t){return(e%t+t)%t}function oh(e,t,n){return(1-n)*e+n*t}class Yo{constructor(t=0,n=0){Yo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=_r(this.x,t.x,n.x),this.y=_r(this.y,t.y,n.y),this}clampScalar(t,n){return this.x=_r(this.x,t,n),this.y=_r(this.y,t,n),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(_r(r,t,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(_r(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Vo{constructor(t,n,r,i,s,o,a,c,l){Vo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],m=i[0],w=i[3],b=i[6],T=i[1],A=i[4],I=i[7],U=i[2],R=i[5],O=i[8];return s[0]=o*m+a*T+c*U,s[3]=o*w+a*A+c*R,s[6]=o*b+a*I+c*O,s[1]=l*m+u*T+h*U,s[4]=l*w+u*A+h*R,s[7]=l*b+u*I+h*O,s[2]=d*m+f*T+p*U,s[5]=d*w+f*A+p*R,s[8]=d*b+f*I+p*O,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,p=n*h+r*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*l-u*r)*m,t[2]=(a*r-i*o)*m,t[3]=d*m,t[4]=(u*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=f*m,t[7]=(r*c-l*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(ah.makeScale(t,n)),this}rotate(t){return this.premultiply(ah.makeRotation(-t)),this}translate(t,n){return this.premultiply(ah.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const ah=new Vo,Kp=new Vo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Gp=new Vo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function qk(){const e={enabled:!0,workingColorSpace:zp,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===sh&&(i.r=Xs(i.r),i.g=Xs(i.g),i.b=Xs(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===sh&&(i.r=qs(i.r),i.g=qs(i.g),i.b=qs(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Vk?Wp:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[zp]:{primaries:t,whitePoint:r,transfer:Wp,toXYZ:Kp,fromXYZ:Gp,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:yr},outputColorSpaceConfig:{drawingBufferColorSpace:yr}},[yr]:{primaries:t,whitePoint:r,transfer:sh,toXYZ:Kp,fromXYZ:Gp,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:yr}}}),e}const br=qk();function Xs(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function qs(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const Hp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mi={h:0,s:0,l:0},mc={h:0,s:0,l:0};function ch(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class lh{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=yr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,br.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=br.workingColorSpace){return this.r=t,this.g=n,this.b=r,br.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=br.workingColorSpace){if(t=Xk(t,1),n=_r(n,0,1),r=_r(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=ch(o,s,t+1/3),this.g=ch(o,s,t),this.b=ch(o,s,t-1/3)}return br.toWorkingColorSpace(this,i),this}setStyle(t,n=yr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=yr){const r=Hp[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Xs(t.r),this.g=Xs(t.g),this.b=Xs(t.b),this}copyLinearToSRGB(t){return this.r=qs(t.r),this.g=qs(t.g),this.b=qs(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=yr){return br.fromWorkingColorSpace(dn.copy(this),t),Math.round(_r(dn.r*255,0,255))*65536+Math.round(_r(dn.g*255,0,255))*256+Math.round(_r(dn.b*255,0,255))}getHexString(t=yr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=br.workingColorSpace){br.fromWorkingColorSpace(dn.copy(this),n);const r=dn.r,i=dn.g,s=dn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=br.workingColorSpace){return br.fromWorkingColorSpace(dn.copy(this),n),t.r=dn.r,t.g=dn.g,t.b=dn.b,t}getStyle(t=yr){br.fromWorkingColorSpace(dn.copy(this),t);const n=dn.r,r=dn.g,i=dn.b;return t!==yr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Mi),this.setHSL(Mi.h+t,Mi.s+n,Mi.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Mi),t.getHSL(mc);const r=oh(Mi.h,mc.h,n),i=oh(Mi.s,mc.s,n),s=oh(Mi.l,mc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const dn=new lh;lh.NAMES=Hp,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:jp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=jp),new Yo,new Yo;function cn(e,t,n){return Math.max(t,Math.min(n,e))}function Yp(e){return e/180*Math.PI}function uh(e){return e*180/Math.PI}const Jk=Rd("089fad0j9awfem09wavefc09uwaef");function Zk(){return Jk()}function Qk(e){return Rd(e)()}function er(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Zk()*i)}function Vp(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(Qk(e)*s)}function Xp(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function tT(e){return e[er(0,e.length-1)]}function eT(e,t){return t[Vp(e,0,t.length-1)]}function xe(...e){return tT(e.flat())}function qp(e,...t){return eT(e,t.flat())}function nT(e){return[...new Set(e)].filter(x)}function Js(e){return x(e)&&x(e.x)&&x(e.y)}function $e(e,t){switch(t){case mt.NORTH:--e.y;break;case mt.SOUTH:++e.y;break;case mt.WEST:--e.x;break;case mt.EAST:++e.x;break}return e}function hi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return mt.WEST;if(n>0)return mt.EAST;if(r<0)return mt.NORTH;if(r>0)return mt.SOUTH}const hh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function os(e){return ae(e)&&Jp(e[0])}function Jp(e){return x(mt[e])&&kt(e)}function rT(e){const t=mt[e];return x(t)?t:mt.IDLE}function fh(e){if(kt(e))return hh[Ot(e)]}function iT(e){if(os(e))return e;if(Jp(e))return[e];const t=fh(e);if(x(t))return[t]}function Zp(e){const t=y.words[e],n=iT(t);return os(n)?[n,e+1]:[void 0,e]}function Qp(e){var i,s;const t=[];let[n,r]=Zp(e);for(;os(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(y.words,r,[Y.NUMBER,Y.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(y.words,r,[Y.DIR]);t.push(c.x,c.y),r=l;break}case"TO":{const[c,l,u]=rt(y.words,r,[Y.DIR,Y.DIR]),h=((i=y.element)==null?void 0:i.x)??0,d=((s=y.element)==null?void 0:s.y)??0;c.x-=h,c.y-=d,l.x-=h,l.y-=d,t.push(h+c.x+l.x,d+c.y+l.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":break;default:return[t,r]}const[o,a]=Zp(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function sT(e){return x(e)&&e<Wt.ONBLACK?e:void 0}function oT(e){return x(e)&&e>Wt.WHITE&&e<Wt.ONCLEAR?e-Wt.ONBLACK:void 0}const Xo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function $r(e){return ae(e)&&em(e[0])}function tm(e){return $r(e)&&e[0].startsWith("ON")}function em(e){return x(Wt[e])&&kt(e)}function dh(e){if(kt(e))return Xo[Ot(e)]}function aT(e){return e.map(t=>Wt[t]).find(t=>x(t)&&t<Wt.ONBLACK)}function cT(e){return e.map(t=>Wt[t]).find(t=>x(t)&&t>=Wt.ONBLACK)}function lT(e){if($r(e))return e;if(em(e))return[e];const t=dh(e);if(x(t))return[t]}function nm(e){const t=y.words[e],n=lT(t);return $r(n)?[n,e+1]:[void 0,e]}function ph(e){const t=[];let n=e;const[r,i]=nm(e);if($r(r)&&(t.push(...r),n=i),$r(t)&&!tm(t)){const[s,o]=nm(i);tm(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function rm(e){const t={};return e.every(n=>{const r=Wt[n];x(r)&&(r<Wt.ONBLACK?t.color=r:t.bg=r-Wt.ONBLACK)}),t}function Zs(e){return ae(e)&&typeof e[0]=="string"}function uT(e){const t=y.words[e];return kt(t)?[t,e+1]:[void 0,e]}function im(e){const t=y.words[e];if(Zs(t))return[t,e+1];const[n,r]=ph(e),[i,s]=uT(r);return kt(i)?[[i,n],s]:[void 0,e]}function mh(e){if(!Zs(e))return;const[t]=e;return t}function sm(e){if(!Zs(e))return;const[,t]=e,n=x(t)?aT(t):void 0;return x(n)?n:void 0}function om(e){if(!Zs(e))return;const[,t]=e,n=x(t)?cT(t):void 0;return x(n)?n:void 0}var gh;try{gh=new TextDecoder}catch{}var gt,nr,j=0,de={},Jt,Ui,rr=0,jr=0,nn,fi,Rn=[],Vt,am={useRecords:!1,mapsAsObjects:!0};class cm{}const lm=new cm;lm.name="MessagePack 0xC1";var Fi=!1,um=2,hm;try{new Function("")}catch{um=1/0}class qo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(gt)return Tm(()=>(wh(),this?this.unpack(t,n):qo.prototype.unpack.call(am,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof on<"u"?on.from(t):new Uint8Array(t)),typeof n=="object"?(nr=n.end||t.length,j=n.start||0):(j=0,nr=n>-1?n:t.length),jr=0,Ui=null,nn=null,gt=t;try{Vt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw gt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof qo){if(de=this,this.structures)return Jt=this.structures,gc(n);(!Jt||Jt.length>0)&&(Jt=[])}else de=am,(!Jt||Jt.length>0)&&(Jt=[]);return gc(n)}unpackMultiple(t,n){let r,i=0;try{Fi=!0;let s=t.length,o=this?this.unpack(t,s):yc.unpack(t,s);if(n){if(n(o,i,j)===!1)return;for(;j<s;)if(i=j,n(gc(),i,j)===!1)return}else{for(r=[o];j<s;)i=j,r.push(gc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Fi=!1,wh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function gc(e){try{if(!de.trusted&&!Fi){let n=Jt.sharedLength||0;n<Jt.length&&(Jt.length=n)}let t;if(de.randomAccessStructure&&gt[j]<64&&gt[j]>=32&&hm?(t=hm(gt,j,nr,de),gt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),j=nr):t=Pe(),nn&&(j=nn.postBundlePosition,nn=null),Fi&&(Jt.restoreStructures=null),j==nr)Jt&&Jt.restoreStructures&&fm(),Jt=null,gt=null,fi&&(fi=null);else{if(j>nr)throw new Error("Unexpected end of MessagePack data");if(!Fi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Jt&&Jt.restoreStructures&&fm(),wh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||j>nr)&&(t.incomplete=!0),t}}function fm(){for(let e in Jt.restoreStructures)Jt[e]=Jt.restoreStructures[e];Jt.restoreStructures=null}function Pe(){let e=gt[j++];if(e<160)if(e<128){if(e<64)return e;{let t=Jt[e&63]||de.getStructures&&pm()[e&63];return t?(t.read||(t.read=yh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,de.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Em();r==="__proto__"&&(r="__proto_"),t[r]=Pe()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Pe(),Pe());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Pe();return de.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(jr>=j)return Ui.slice(j-rr,(j+=t)-rr);if(jr==0&&nr<140){let n=t<16?bh(t):ym(t);if(n!=null)return n}return _h(t)}else{let t;switch(e){case 192:return null;case 193:return nn?(t=Pe(),t>0?nn[1].slice(nn.position1,nn.position1+=t):nn[0].slice(nn.position0,nn.position0-=t)):lm;case 194:return!1;case 195:return!0;case 196:if(t=gt[j++],t===void 0)throw new Error("Unexpected end of buffer");return Eh(t);case 197:return t=Vt.getUint16(j),j+=2,Eh(t);case 198:return t=Vt.getUint32(j),j+=4,Eh(t);case 199:return as(gt[j++]);case 200:return t=Vt.getUint16(j),j+=2,as(t);case 201:return t=Vt.getUint32(j),j+=4,as(t);case 202:if(t=Vt.getFloat32(j),de.useFloat32>2){let n=xh[(gt[j]&127)<<1|gt[j+1]>>7];return j+=4,(n*t+(t>0?.5:-.5)>>0)/n}return j+=4,t;case 203:return t=Vt.getFloat64(j),j+=8,t;case 204:return gt[j++];case 205:return t=Vt.getUint16(j),j+=2,t;case 206:return t=Vt.getUint32(j),j+=4,t;case 207:return de.int64AsType==="number"?(t=Vt.getUint32(j)*4294967296,t+=Vt.getUint32(j+4)):de.int64AsType==="string"?t=Vt.getBigUint64(j).toString():de.int64AsType==="auto"?(t=Vt.getBigUint64(j),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigUint64(j),j+=8,t;case 208:return Vt.getInt8(j++);case 209:return t=Vt.getInt16(j),j+=2,t;case 210:return t=Vt.getInt32(j),j+=4,t;case 211:return de.int64AsType==="number"?(t=Vt.getInt32(j)*4294967296,t+=Vt.getUint32(j+4)):de.int64AsType==="string"?t=Vt.getBigInt64(j).toString():de.int64AsType==="auto"?(t=Vt.getBigInt64(j),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigInt64(j),j+=8,t;case 212:if(t=gt[j++],t==114)return xm(gt[j++]&63);{let n=Rn[t];if(n)return n.read?(j++,n.read(Pe())):n.noBuffer?(j++,n()):n(gt.subarray(j,++j));throw new Error("Unknown extension "+t)}case 213:return t=gt[j],t==114?(j++,xm(gt[j++]&63,gt[j++])):as(2);case 214:return as(4);case 215:return as(8);case 216:return as(16);case 217:return t=gt[j++],jr>=j?Ui.slice(j-rr,(j+=t)-rr):fT(t);case 218:return t=Vt.getUint16(j),j+=2,jr>=j?Ui.slice(j-rr,(j+=t)-rr):dT(t);case 219:return t=Vt.getUint32(j),j+=4,jr>=j?Ui.slice(j-rr,(j+=t)-rr):pT(t);case 220:return t=Vt.getUint16(j),j+=2,mm(t);case 221:return t=Vt.getUint32(j),j+=4,mm(t);case 222:return t=Vt.getUint16(j),j+=2,gm(t);case 223:return t=Vt.getUint32(j),j+=4,gm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const hT=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function yh(e,t){function n(){if(n.count++>um){let i=e.read=new Function("r","return function(){return "+(de.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":hT.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Pe);return e.highByte===0&&(e.read=dm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Pe()}return de.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?dm(t,n):n}const dm=(e,t)=>function(){let n=gt[j++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Jt[r]||pm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=yh(i,e)),i.read()};function pm(){let e=Tm(()=>(gt=null,de.getStructures()));return Jt=de._mergeStructures(e,Jt)}var _h=Jo,fT=Jo,dT=Jo,pT=Jo;function Jo(e){let t;if(e<16&&(t=bh(e)))return t;if(e>64&&gh)return gh.decode(gt.subarray(j,j+=e));const n=j+e,r=[];for(t="";j<n;){const i=gt[j++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gt[j++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gt[j++]&63,o=gt[j++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=gt[j++]&63,o=gt[j++]&63,a=gt[j++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=rn.apply(String,r),r.length=0)}return r.length>0&&(t+=rn.apply(String,r)),t}function mm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Pe();return de.freezeData?Object.freeze(t):t}function gm(e){if(de.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Em();r==="__proto__"&&(r="__proto_"),t[r]=Pe()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Pe(),Pe());return t}}var rn=String.fromCharCode;function ym(e){let t=j,n=new Array(e);for(let r=0;r<e;r++){const i=gt[j++];if((i&128)>0){j=t;return}n[r]=i}return rn.apply(String,n)}function bh(e){if(e<4)if(e<2){if(e===0)return"";{let t=gt[j++];if((t&128)>1){j-=1;return}return rn(t)}}else{let t=gt[j++],n=gt[j++];if((t&128)>0||(n&128)>0){j-=2;return}if(e<3)return rn(t,n);let r=gt[j++];if((r&128)>0){j-=3;return}return rn(t,n,r)}else{let t=gt[j++],n=gt[j++],r=gt[j++],i=gt[j++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){j-=4;return}if(e<6){if(e===4)return rn(t,n,r,i);{let s=gt[j++];if((s&128)>0){j-=5;return}return rn(t,n,r,i,s)}}else if(e<8){let s=gt[j++],o=gt[j++];if((s&128)>0||(o&128)>0){j-=6;return}if(e<7)return rn(t,n,r,i,s,o);let a=gt[j++];if((a&128)>0){j-=7;return}return rn(t,n,r,i,s,o,a)}else{let s=gt[j++],o=gt[j++],a=gt[j++],c=gt[j++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){j-=8;return}if(e<10){if(e===8)return rn(t,n,r,i,s,o,a,c);{let l=gt[j++];if((l&128)>0){j-=9;return}return rn(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=gt[j++],u=gt[j++];if((l&128)>0||(u&128)>0){j-=10;return}if(e<11)return rn(t,n,r,i,s,o,a,c,l,u);let h=gt[j++];if((h&128)>0){j-=11;return}return rn(t,n,r,i,s,o,a,c,l,u,h)}else{let l=gt[j++],u=gt[j++],h=gt[j++],d=gt[j++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){j-=12;return}if(e<14){if(e===12)return rn(t,n,r,i,s,o,a,c,l,u,h,d);{let f=gt[j++];if((f&128)>0){j-=13;return}return rn(t,n,r,i,s,o,a,c,l,u,h,d,f)}}else{let f=gt[j++],p=gt[j++];if((f&128)>0||(p&128)>0){j-=14;return}if(e<15)return rn(t,n,r,i,s,o,a,c,l,u,h,d,f,p);let m=gt[j++];if((m&128)>0){j-=15;return}return rn(t,n,r,i,s,o,a,c,l,u,h,d,f,p,m)}}}}}function _m(){let e=gt[j++],t;if(e<192)t=e-160;else switch(e){case 217:t=gt[j++];break;case 218:t=Vt.getUint16(j),j+=2;break;case 219:t=Vt.getUint32(j),j+=4;break;default:throw new Error("Expected string")}return Jo(t)}function Eh(e){return de.copyBuffers?Uint8Array.prototype.slice.call(gt,j,j+=e):gt.subarray(j,j+=e)}function as(e){let t=gt[j++];if(Rn[t]){let n;return Rn[t](gt.subarray(j,n=j+=e),r=>{j=r;try{return Pe()}finally{j=n}})}else throw new Error("Unknown extension type "+t)}var bm=new Array(4096);function Em(){let e=gt[j++];if(e>=160&&e<192){if(e=e-160,jr>=j)return Ui.slice(j-rr,(j+=e)-rr);if(!(jr==0&&nr<180))return _h(e)}else return j--,wm(Pe());let t=(e<<5^(e>1?Vt.getUint16(j):e>0?gt[j]:0))&4095,n=bm[t],r=j,i=j+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return j=r,n.string;i-=3,r=j}for(n=[],bm[t]=n,n.bytes=e;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gt[r++],n.push(s);let a=e<16?bh(e):ym(e);return a!=null?n.string=a:n.string=_h(e)}function wm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const xm=(e,t)=>{let n=Pe().map(wm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Jt[e];return i&&(i.isShared||Fi)&&((Jt.restoreStructures||(Jt.restoreStructures=[]))[e]=i),Jt[e]=n,n.read=yh(n,r),n.read()};Rn[0]=()=>{},Rn[0].noBuffer=!0,Rn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let mT={Error,TypeError,ReferenceError};Rn[101]=()=>{let e=Pe();return(mT[e[0]]||Error)(e[1],{cause:e[2]})},Rn[105]=e=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4);fi||(fi=new Map);let n=gt[j],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};fi.set(t,i);let s=Pe();return i.used?Object.assign(r,s):(i.target=s,s)},Rn[112]=e=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4),n=fi.get(t);return n.used=!0,n.target},Rn[115]=()=>new Set(Pe());const km=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let gT=typeof globalThis=="object"?globalThis:window;Rn[116]=e=>{let t=e[0],n=km[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new gT[n](Uint8Array.prototype.slice.call(e,1).buffer)},Rn[120]=()=>{let e=Pe();return new RegExp(e[0],e[1])};const yT=[];Rn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=j;return j+=t-e.length,nn=yT,nn=[_m(),_m()],nn.position0=0,nn.position1=0,nn.postBundlePosition=j,j=n,Pe()},Rn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Tm(e){let t=nr,n=j,r=rr,i=jr,s=Ui,o=fi,a=nn,c=new Uint8Array(gt.slice(0,nr)),l=Jt,u=Jt.slice(0,Jt.length),h=de,d=Fi,f=e();return nr=t,j=n,rr=r,jr=i,Ui=s,fi=o,nn=a,gt=c,Fi=d,Jt=l,Jt.splice(0,Jt.length,...u),de=h,Vt=new DataView(gt.buffer,gt.byteOffset,gt.byteLength),f}function wh(){gt=null,fi=null,Jt=null}const xh=new Array(147);for(let e=0;e<256;e++)xh[e]=+("1e"+Math.floor(45.15-e*.30103));var yc=new qo({useRecords:!1});const _T=yc.unpack;yc.unpackMultiple,yc.unpack;let bT=new Float32Array(1);new Uint8Array(bT.buffer,0,4);let _c;try{_c=new TextEncoder}catch{}let kh,Am;const bc=typeof on<"u",Ec=bc?function(e){return on.allocUnsafeSlow(e)}:Uint8Array,vm=bc?on:Uint8Array,Rm=bc?4294967296:2144337920;let q,Zo,pe,K=0,yn,Se=null,ET;const wT=21760,xT=/[\u0080-\uFFFF]/,Qs=Symbol("record-id");class kT extends qo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=vm.prototype.utf8Write?function(S,E){return q.utf8Write(S,E,q.byteLength-E)}:_c&&_c.encodeInto?function(S,E){return _c.encodeInto(S,q.subarray(E)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],w=0,b=0;this.pack=this.encode=function(S,E){if(q||(q=new Ec(8192),pe=q.dataView||(q.dataView=new DataView(q.buffer,0,8192)),K=0),yn=q.length-10,yn-K<2048?(q=new Ec(q.length),pe=q.dataView||(q.dataView=new DataView(q.buffer,0,q.length)),yn=q.length-10,K=0):K=K+7&2147483640,n=K,E&NT&&(K+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof S!="string"?(Se=[],Se.size=1/0):Se=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Z=i.sharedLength||0;if(Z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let D=0;D<Z;D++){let st=i[D];if(!st)continue;let tt,ft=i.transitions;for(let V=0,z=st.length;V<z;V++){let Et=st[V];tt=ft[Et],tt||(tt=ft[Et]=Object.create(null)),ft=tt}ft[Qs]=D+64}this.lastNamedStructuresLength=Z}c||(i.nextId=Z+64)}r&&(r=!1);let B;try{a.randomAccessStructure&&S&&S.constructor&&S.constructor===Object?L(S):I(S);let Z=Se;if(Se&&Nm(n,I,0),s&&s.idsToInsert){let D=s.idsToInsert.sort((V,z)=>V.offset>z.offset?1:-1),st=D.length,tt=-1;for(;Z&&st>0;){let V=D[--st].offset+n;V<Z.stringsPosition+n&&tt===-1&&(tt=0),V>Z.position+n?tt>=0&&(tt+=6):(tt>=0&&(pe.setUint32(Z.position+n,pe.getUint32(Z.position+n)+tt),tt=-1),Z=Z.previous,st++)}tt>=0&&Z&&pe.setUint32(Z.position+n,pe.getUint32(Z.position+n)+tt),K+=D.length*6,K>yn&&N(K),a.offset=K;let ft=AT(q.subarray(n,K),D);return s=null,ft}return a.offset=K,E&ST?(q.start=n,q.end=K,q):q.subarray(n,K)}catch(Z){throw B=Z,Z}finally{if(i&&(T(),r&&a.saveStructures)){let Z=i.sharedLength||0,D=q.subarray(n,K),st=vT(i,a);if(!B)return a.saveStructures(st,st.isCompatible)===!1?a.pack(S,E):(a.lastNamedStructuresLength=Z,q.length>1073741824&&(q=null),D)}q.length>1073741824&&(q=null),E&IT&&(K=n)}};const T=()=>{b<10&&b++;let S=i.sharedLength||0;if(i.length>S&&!c&&(i.length=S),w>1e4)i.transitions=null,b=0,w=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,B=m.length;E<B;E++)m[E][Qs]=0;m=[]}},A=S=>{var E=S.length;E<16?q[K++]=144|E:E<65536?(q[K++]=220,q[K++]=E>>8,q[K++]=E&255):(q[K++]=221,pe.setUint32(K,E),K+=4);for(let B=0;B<E;B++)I(S[B])},I=S=>{K>yn&&(q=N(K));var E=typeof S,B;if(E==="string"){let Z=S.length;if(Se&&Z>=4&&Z<4096){if((Se.size+=Z)>wT){let ft,V=(Se[0]?Se[0].length*3+Se[1].length:0)+10;K+V>yn&&(q=N(K+V));let z;Se.position?(z=Se,q[K]=200,K+=3,q[K++]=98,ft=K-n,K+=4,Nm(n,I,0),pe.setUint16(ft+n-3,K-n-ft)):(q[K++]=214,q[K++]=98,ft=K-n,K+=4),Se=["",""],Se.previous=z,Se.size=0,Se.position=ft}let tt=xT.test(S);Se[tt?0:1]+=S,q[K++]=193,I(tt?-Z:Z);return}let D;Z<32?D=1:Z<256?D=2:Z<65536?D=3:D=5;let st=Z*3;if(K+st>yn&&(q=N(K+st)),Z<64||!o){let tt,ft,V,z=K+D;for(tt=0;tt<Z;tt++)ft=S.charCodeAt(tt),ft<128?q[z++]=ft:ft<2048?(q[z++]=ft>>6|192,q[z++]=ft&63|128):(ft&64512)===55296&&((V=S.charCodeAt(tt+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(V&1023),tt++,q[z++]=ft>>18|240,q[z++]=ft>>12&63|128,q[z++]=ft>>6&63|128,q[z++]=ft&63|128):(q[z++]=ft>>12|224,q[z++]=ft>>6&63|128,q[z++]=ft&63|128);B=z-K-D}else B=o(S,K+D);B<32?q[K++]=160|B:B<256?(D<2&&q.copyWithin(K+2,K+1,K+1+B),q[K++]=217,q[K++]=B):B<65536?(D<3&&q.copyWithin(K+3,K+2,K+2+B),q[K++]=218,q[K++]=B>>8,q[K++]=B&255):(D<5&&q.copyWithin(K+5,K+3,K+3+B),q[K++]=219,pe.setUint32(K,B),K+=4),K+=B}else if(E==="number")if(S>>>0===S)S<32||S<128&&this.useRecords===!1||S<64&&!this.randomAccessStructure?q[K++]=S:S<256?(q[K++]=204,q[K++]=S):S<65536?(q[K++]=205,q[K++]=S>>8,q[K++]=S&255):(q[K++]=206,pe.setUint32(K,S),K+=4);else if(S>>0===S)S>=-32?q[K++]=256+S:S>=-128?(q[K++]=208,q[K++]=S+256):S>=-32768?(q[K++]=209,pe.setInt16(K,S),K+=2):(q[K++]=210,pe.setInt32(K,S),K+=4);else{let Z;if((Z=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){q[K++]=202,pe.setFloat32(K,S);let D;if(Z<4||(D=S*xh[(q[K]&127)<<1|q[K+1]>>7])>>0===D){K+=4;return}else K--}q[K++]=203,pe.setFloat64(K,S),K+=8}else if(E==="object"||E==="function")if(!S)q[K++]=192;else{if(s){let D=s.get(S);if(D){if(!D.id){let st=s.idsToInsert||(s.idsToInsert=[]);D.id=st.push(D)}q[K++]=214,q[K++]=112,pe.setUint32(K,D.id),K+=4;return}else s.set(S,{offset:K-n})}let Z=S.constructor;if(Z===Object)P(S);else if(Z===Array)A(S);else if(Z===Map)if(this.mapAsEmptyObject)q[K++]=128;else{B=S.size,B<16?q[K++]=128|B:B<65536?(q[K++]=222,q[K++]=B>>8,q[K++]=B&255):(q[K++]=223,pe.setUint32(K,B),K+=4);for(let[D,st]of S)I(D),I(st)}else{for(let D=0,st=kh.length;D<st;D++){let tt=Am[D];if(S instanceof tt){let ft=kh[D];if(ft.write){ft.type&&(q[K++]=212,q[K++]=ft.type,q[K++]=0);let lt=ft.write.call(this,S);lt===S?Array.isArray(S)?A(S):P(S):I(lt);return}let V=q,z=pe,Et=K;q=null;let at;try{at=ft.pack.call(this,S,lt=>(q=V,V=null,K+=lt,K>yn&&N(K),{target:q,targetView:pe,position:K-lt}),I)}finally{V&&(q=V,pe=z,K=Et,yn=q.length-10)}at&&(at.length+K>yn&&N(at.length+K),K=TT(at,q,K,ft.type));return}}if(Array.isArray(S))A(S);else{if(S.toJSON){const D=S.toJSON();if(D!==S)return I(D)}if(E==="function")return I(this.writeFunction&&this.writeFunction(S));P(S)}}}else if(E==="boolean")q[K++]=S?195:194;else if(E==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))q[K++]=211,pe.setBigInt64(K,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)q[K++]=207,pe.setBigUint64(K,S);else if(this.largeBigIntToFloat)q[K++]=203,pe.setFloat64(K,Number(S));else{if(this.largeBigIntToString)return I(S.toString());if(this.useBigIntExtension&&S<BigInt(2)**BigInt(1023)&&S>-(BigInt(2)**BigInt(1023))){q[K++]=199,K++,q[K++]=66;let Z=[],D;do{let st=S&BigInt(255);D=(st&BigInt(128))===(S<BigInt(0)?BigInt(128):BigInt(0)),Z.push(st),S>>=BigInt(8)}while(!((S===BigInt(0)||S===BigInt(-1))&&D));q[K-2]=Z.length;for(let st=Z.length;st>0;)q[K++]=Number(Z[--st]);return}else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}K+=8}else if(E==="undefined")this.encodeUndefinedAsNil?q[K++]=192:(q[K++]=212,q[K++]=0,q[K++]=0);else throw new Error("Unknown type: "+E)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?S=>{let E;if(this.skipValues){E=[];for(let D in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(D))&&!this.skipValues.includes(S[D])&&E.push(D)}else E=Object.keys(S);let B=E.length;B<16?q[K++]=128|B:B<65536?(q[K++]=222,q[K++]=B>>8,q[K++]=B&255):(q[K++]=223,pe.setUint32(K,B),K+=4);let Z;if(this.coercibleKeyAsNumber)for(let D=0;D<B;D++){Z=E[D];let st=Number(Z);I(isNaN(st)?Z:st),I(S[Z])}else for(let D=0;D<B;D++)I(Z=E[D]),I(S[Z])}:S=>{q[K++]=222;let E=K-n;K+=2;let B=0;for(let Z in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(Z))&&(I(Z),I(S[Z]),B++);if(B>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');q[E+++n]=B>>8,q[E+n]=B&255},R=this.useRecords===!1?U:t.progressiveRecords&&!d?S=>{let E,B=i.transitions||(i.transitions=Object.create(null)),Z=K++-n,D;for(let st in S)if(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(st)){if(E=B[st],E)B=E;else{let tt=Object.keys(S),ft=B;B=i.transitions;let V=0;for(let z=0,Et=tt.length;z<Et;z++){let at=tt[z];E=B[at],E||(E=B[at]=Object.create(null),V++),B=E}Z+n+1==K?(K--,W(B,tt,V)):et(B,tt,Z,V),D=!0,B=ft[st]}I(S[st])}if(!D){let st=B[Qs];st?q[Z+n]=st:et(B,Object.keys(S),Z,0)}}:S=>{let E,B=i.transitions||(i.transitions=Object.create(null)),Z=0;for(let st in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(st))&&(E=B[st],E||(E=B[st]=Object.create(null),Z++),B=E);let D=B[Qs];D?D>=96&&d?(q[K++]=((D-=96)&31)+96,q[K++]=D>>5):q[K++]=D:W(B,B.__keys__||Object.keys(S),Z);for(let st in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(st))&&I(S[st])},O=typeof this.useRecords=="function"&&this.useRecords,P=O?S=>{O(S)?R(S):U(S)}:R,N=S=>{let E;if(S>16777216){if(S-n>Rm)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(Rm,Math.round(Math.max((S-n)*(S>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(S-n<<2,q.length-1)>>12)+1<<12;let B=new Ec(E);return pe=B.dataView||(B.dataView=new DataView(B.buffer,0,E)),S=Math.min(S,q.length),q.copy?q.copy(B,0,n,S):B.set(q.slice(n,S)),K-=n,n=0,yn=B.length-10,q=B},W=(S,E,B)=>{let Z=i.nextId;Z||(Z=64),Z<f&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(Z=i.nextOwnId,Z<p||(Z=f),i.nextOwnId=Z+1):(Z>=p&&(Z=f),i.nextId=Z+1);let D=E.highByte=Z>=96&&d?Z-96>>5:-1;S[Qs]=Z,S.__keys__=E,i[Z-64]=E,Z<f?(E.isShared=!0,i.sharedLength=Z-63,r=!0,D>=0?(q[K++]=(Z&31)+96,q[K++]=D):q[K++]=Z):(D>=0?(q[K++]=213,q[K++]=114,q[K++]=(Z&31)+96,q[K++]=D):(q[K++]=212,q[K++]=114,q[K++]=Z),B&&(w+=b*B),m.length>=h&&(m.shift()[Qs]=0),m.push(S),I(E))},et=(S,E,B,Z)=>{let D=q,st=K,tt=yn,ft=n;q=Zo,K=0,n=0,q||(Zo=q=new Ec(8192)),yn=q.length-10,W(S,E,Z),Zo=q;let V=K;if(q=D,K=st,yn=tt,n=ft,V>1){let z=K+V-1;z>yn&&N(z);let Et=B+n;q.copyWithin(Et+V,Et+1,K),q.set(Zo.slice(0,V),Et),K=z}else q[B+n]=Zo[0]},L=S=>{let E=ET(S,q,n,K,i,N,(B,Z,D)=>{if(D)return r=!0;K=Z;let st=q;return I(B),T(),st!==q?{position:K,targetView:pe,target:q}:K},this);if(E===0)return P(S);K=E}}useBuffer(t){q=t,q.dataView||(q.dataView=new DataView(q.buffer,q.byteOffset,q.byteLength)),K=0}set position(t){K=t}get position(){return K}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Am=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,cm],kh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Sm(e,16,t):Im(bc?on.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==vm&&this.moreTypes?Sm(e,km.indexOf(n.name),t):Im(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Sm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Im(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function TT(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function AT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Nm(e,t,n){if(Se.length>0){pe.setUint32(Se.position+e,K+n-Se.position-e),Se.stringsPosition=K-e;let r=Se;Se=null,t(r[0]),t(r[1])}}function vT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Om=new kT({useRecords:!1});const RT=Om.pack;Om.pack;const ST=512,IT=1024,NT=2048,H=Ss("SOFTWARE");function ke(){return null}function to(e,t,n={}){if(!x(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];x(c)&&(a=c(a));const l=t[o];x(l)&&(o=l),a!==null&&r.push(o,a)}return r}function Qo(e,t,n={}){if(x(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){_e(H,"","binary",r.message)}}function OT(e){try{const t=$n(e);return RT(t)}catch(t){_e(H,"","binary",t.message)}}function CT(e){try{return _T(e)}catch(t){_e(H,"","binary",t.message)}}function Cm(){return{id:Ue()}}var wc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e))(wc||{});function xc(e){return x(e==null?void 0:e.id)?to(e,wc,{category:ke,kinddata:ke,stopped:ke,removed:ke,bucket:ke}):to(e,wc,{id:ke,x:ke,y:ke,lx:ke,ly:ke,code:ke,category:ke,kinddata:ke,stopped:ke,removed:ke,bucket:ke})}function kc(e){return Qo(e,wc)}function pn(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function Tc(e,t){if(!x(e)||!$r(t))return;const{color:n,bg:r}=rm(t);x(n)&&(e.color=n),x(r)&&(e.bg=r)}function Pi(e){var t;return Ot((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}const Rt=60,Zt=25,Th=Rt*Zt;var yt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(yt||{});function LT(){return new Array(Rt*Zt).map(()=>{})}function Ah(e=ru){const t={terrain:LT(),objects:{},id:""};return e(t)}var vh=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(vh||{});function MT(e){return to(e,vh,{terrain:t=>t.map(xc),objects:t=>Object.values(t).filter(n=>!n.removed).map(xc),id:ke,named:ke,lookup:ke,codepage:ke,distmaps:ke,overboard:ke,underboard:ke})}function UT(e){return Qo(e,vh,{terrain:t=>t.map(kc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=kc(t[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Ac(e){return ih(e.x,e.y,0,Rt-1,Zt-1,0)}function Er(e,t){return!x(e)||!x(t==null?void 0:t.x)||!x(t==null?void 0:t.y)||t.x<0||t.x>=Rt||t.y<0||t.y>=Zt?-1:t.x+t.y*Rt}function Te(e,t){const n=Er(e,t);if(n<0||!x(e==null?void 0:e.lookup))return;const r=_n(e,e.lookup[n]??"");return x(r)?r:e.terrain[n]}function FT(e,t){const n=_n(e,t);if(x(n))return n;const r=parseFloat(t),i=Yk(isNaN(r)?-1:r,Rt);return eo(e,i.x,i.y)}function eo(e,t,n){return(t>=0&&t<Rt)??(n>=0&&n<Zt)?e==null?void 0:e.terrain[t+n*Rt]:void 0}function sn(e,t){if(!x(e)||!x(t)||!x(t.x)||!x(t.y)||t.x<0||t.x>=Rt||t.y<0||t.y>=Zt)return;const n=$n(t),r=t.x+t.y*Rt;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function Rh(e,t){if(!x(e)||!x(t))return;const n=$n(t);return n.id=n.id??Ue(),e.objects[n.id]=n,e.objects[n.id]}function PT(e,t,n){return sn(e,{...t,kind:n})}function Sh(e,t,n,r){return Rh(e,{...t,kind:n,id:r})}function _n(e,t){if(e)return e.objects[t]}function BT(e,t){const n=Er(e,t);if(n<0||!x(e==null?void 0:e.lookup))return;const r=_n(e,e.lookup[n]??"");if(x(r))return r}function Lm(e,t){return x(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function DT(e,t,n){if(!x(e)||!x(t))return;const r=e.objects[n];if(x(r))return r;if(Js(t))return Fm(t,ea(e,"player"))}function no(e,t){const n=e??Gt.ISWALK,r=t??Gt.ISWALK;switch(n){case Gt.ISWALK:return r!==Gt.ISWALK;case Gt.ISSWIM:return r!==Gt.ISSWIM;case Gt.ISSOLID:return!0;case Gt.ISBULLET:return r!==Gt.ISWALK&&r!==Gt.ISSWIM}}function ta(e,t,n){const r=e==null?void 0:e.objects[n];if(x(r))return r;const i=ea(e,"player");return x(t)?(t.x<0&&(t.x=er(0,Rt-1)),t.y<0&&(t.y=er(0,Zt-1)),Fm(t,i)):xe(...i)}function ea(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(x)}function $T(e){const t=[];for(let n=0;n<Zt;++n)for(let r=0;r<Rt;++r){const i={x:r,y:n},s=Te(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Mm(e,t){const n=mh(t),r=sm(t),i=om(t);return ea(e,n??"").filter(s=>{var o,a,c;return!(x(n)&&Ot((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Wt.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Wt.BLACK)!==i)}).filter(x)}function Um(e,t){return x(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(x(i))return i;const s=ea(e,Ot(n));if(s.length)return s}else if(Js(n)&&n.x>=0&&n.x<Rt&&n.y>=0&&n.y<Zt){const i=n.x+n.y*Rt,s=(r=e.lookup)==null?void 0:r[i];return x(s)?e.objects[s]:e.terrain[i]}}).flat().filter(x):[]}function Fm(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function ue(e){return`${e??""}`}function na(e,t){const n=parseFloat(ue(e));return isNaN(n)?t:n}function Pm(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}const Ih=14,vc=3,Rc=8,Sc=14,Ic=16,jT=16,zT=16;var Nc=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(Nc||{});function Oc(e,t){return new Array(e).fill(t)}function WT(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:Oc(s,0),color:Oc(s,0),bg:Oc(s,i)}}function KT(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Wt.ONCLEAR}}function GT(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function HT(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:Oc(s,i)}}function YT(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function VT(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Bm(e,t){return`${e}:${t}`}const XT=1,qT=16,JT=256;var bn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(bn||{});function Dm(e){const t=Math.floor(e.length/vc);if(t*vc!==e.length)return;const n=Pm(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function ZT(e,t){return e&1<<t?255:0}function $m(e){const t=Math.floor(e.length/Ih);if(t*Ih!==e.length)return;const n=Math.ceil(t/Ic),r=Rc*Ic,i=Pm(r,Sc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*Sc+a,u=e[c];for(let h=0;h<Rc;++h){const d=s*Rc+h;i.bits[d+l*r]=ZT(u,7-h)}++a,a===Sc&&(a=0,++s,s===Ic&&(s=0,++o))}return i}const QT=Wa("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),tA=Wa("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var jm=typeof Cs=="object"&&Cs&&Cs.Object===Object&&Cs,eA=typeof self=="object"&&self&&self.Object===Object&&self,zr=jm||eA||Function("return this")(),ir=zr.Symbol,zm=Object.prototype,nA=zm.hasOwnProperty,rA=zm.toString,ra=ir?ir.toStringTag:void 0;function iA(e){var t=nA.call(e,ra),n=e[ra];try{e[ra]=void 0;var r=!0}catch{}var i=rA.call(e);return r&&(t?e[ra]=n:delete e[ra]),i}var sA=Object.prototype,oA=sA.toString;function aA(e){return oA.call(e)}var cA="[object Null]",lA="[object Undefined]",Wm=ir?ir.toStringTag:void 0;function Bi(e){return e==null?e===void 0?lA:cA:Wm&&Wm in Object(e)?iA(e):aA(e)}function wr(e){return e!=null&&typeof e=="object"}var uA="[object Symbol]";function Cc(e){return typeof e=="symbol"||wr(e)&&Bi(e)==uA}function Lc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var ee=Array.isArray,hA=1/0,Km=ir?ir.prototype:void 0,Gm=Km?Km.toString:void 0;function Hm(e){if(typeof e=="string")return e;if(ee(e))return Lc(e,Hm)+"";if(Cc(e))return Gm?Gm.call(e):"";var t=e+"";return t=="0"&&1/e==-hA?"-0":t}var fA=/\s/;function dA(e){for(var t=e.length;t--&&fA.test(e.charAt(t)););return t}var pA=/^\s+/;function mA(e){return e&&e.slice(0,dA(e)+1).replace(pA,"")}function sr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ym=NaN,gA=/^[-+]0x[0-9a-f]+$/i,yA=/^0b[01]+$/i,_A=/^0o[0-7]+$/i,bA=parseInt;function EA(e){if(typeof e=="number")return e;if(Cc(e))return Ym;if(sr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=sr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=mA(e);var n=yA.test(e);return n||_A.test(e)?bA(e.slice(2),n?2:8):gA.test(e)?Ym:+e}var Vm=1/0,wA=17976931348623157e292;function xA(e){if(!e)return e===0?e:0;if(e=EA(e),e===Vm||e===-Vm){var t=e<0?-1:1;return t*wA}return e===e?e:0}function Mc(e){var t=xA(e),n=t%1;return t===t?n?t-n:t:0}function ro(e){return e}var kA="[object AsyncFunction]",TA="[object Function]",AA="[object GeneratorFunction]",vA="[object Proxy]";function di(e){if(!sr(e))return!1;var t=Bi(e);return t==TA||t==AA||t==kA||t==vA}var Nh=zr["__core-js_shared__"],Xm=function(){var e=/[^.]+$/.exec(Nh&&Nh.keys&&Nh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function RA(e){return!!Xm&&Xm in e}var SA=Function.prototype,IA=SA.toString;function cs(e){if(e!=null){try{return IA.call(e)}catch{}try{return e+""}catch{}}return""}var NA=/[\\^$.*+?()[\]{}|]/g,OA=/^\[object .+?Constructor\]$/,CA=Function.prototype,LA=Object.prototype,MA=CA.toString,UA=LA.hasOwnProperty,FA=RegExp("^"+MA.call(UA).replace(NA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function PA(e){if(!sr(e)||RA(e))return!1;var t=di(e)?FA:OA;return t.test(cs(e))}function BA(e,t){return e==null?void 0:e[t]}function ls(e,t){var n=BA(e,t);return PA(n)?n:void 0}var Oh=ls(zr,"WeakMap"),qm=Object.create,DA=function(){function e(){}return function(t){if(!sr(t))return{};if(qm)return qm(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function $A(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Ve(){}function jA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var zA=800,WA=16,KA=Date.now;function GA(e){var t=0,n=0;return function(){var r=KA(),i=WA-(r-n);if(n=r,i>0){if(++t>=zA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function HA(e){return function(){return e}}var Uc=function(){try{var e=ls(Object,"defineProperty");return e({},"",{}),e}catch{}}(),YA=Uc?function(e,t){return Uc(e,"toString",{configurable:!0,enumerable:!1,value:HA(t),writable:!0})}:ro,VA=GA(YA);function Jm(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Zm(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function XA(e){return e!==e}function qA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function Ch(e,t,n){return t===t?qA(e,t,n):Zm(e,XA,n)}function Qm(e,t){var n=e==null?0:e.length;return!!n&&Ch(e,t,0)>-1}var JA=9007199254740991,ZA=/^(?:0|[1-9]\d*)$/;function Fc(e,t){var n=typeof e;return t=t??JA,!!t&&(n=="number"||n!="symbol"&&ZA.test(e))&&e>-1&&e%1==0&&e<t}function Lh(e,t,n){t=="__proto__"&&Uc?Uc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ia(e,t){return e===t||e!==e&&t!==t}var QA=Object.prototype,tv=QA.hasOwnProperty;function Pc(e,t,n){var r=e[t];(!(tv.call(e,t)&&ia(r,n))||n===void 0&&!(t in e))&&Lh(e,t,n)}function Mh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Lh(n,a,c):Pc(n,a,c)}return n}var tg=Math.max;function ev(e,t,n){return t=tg(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=tg(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),$A(e,this,a)}}function Uh(e,t){return VA(ev(e,t,ro),e+"")}var nv=9007199254740991;function Fh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=nv}function Wr(e){return e!=null&&Fh(e.length)&&!di(e)}function eg(e,t,n){if(!sr(n))return!1;var r=typeof t;return(r=="number"?Wr(n)&&Fc(t,n.length):r=="string"&&t in n)?ia(n[t],e):!1}function rv(e){return Uh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&eg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var iv=Object.prototype;function sa(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||iv;return e===n}function sv(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var ov="[object Arguments]";function ng(e){return wr(e)&&Bi(e)==ov}var rg=Object.prototype,av=rg.hasOwnProperty,cv=rg.propertyIsEnumerable,Bc=ng(function(){return arguments}())?ng:function(e){return wr(e)&&av.call(e,"callee")&&!cv.call(e,"callee")};function lv(){return!1}var ig=typeof exports=="object"&&exports&&!exports.nodeType&&exports,sg=ig&&typeof module=="object"&&module&&!module.nodeType&&module,uv=sg&&sg.exports===ig,og=uv?zr.Buffer:void 0,hv=og?og.isBuffer:void 0,oa=hv||lv,fv="[object Arguments]",dv="[object Array]",pv="[object Boolean]",mv="[object Date]",gv="[object Error]",yv="[object Function]",_v="[object Map]",bv="[object Number]",Ev="[object Object]",wv="[object RegExp]",xv="[object Set]",kv="[object String]",Tv="[object WeakMap]",Av="[object ArrayBuffer]",vv="[object DataView]",Rv="[object Float32Array]",Sv="[object Float64Array]",Iv="[object Int8Array]",Nv="[object Int16Array]",Ov="[object Int32Array]",Cv="[object Uint8Array]",Lv="[object Uint8ClampedArray]",Mv="[object Uint16Array]",Uv="[object Uint32Array]",be={};be[Rv]=be[Sv]=be[Iv]=be[Nv]=be[Ov]=be[Cv]=be[Lv]=be[Mv]=be[Uv]=!0,be[fv]=be[dv]=be[Av]=be[pv]=be[vv]=be[mv]=be[gv]=be[yv]=be[_v]=be[bv]=be[Ev]=be[wv]=be[xv]=be[kv]=be[Tv]=!1;function Fv(e){return wr(e)&&Fh(e.length)&&!!be[Bi(e)]}function Dc(e){return function(t){return e(t)}}var ag=typeof exports=="object"&&exports&&!exports.nodeType&&exports,aa=ag&&typeof module=="object"&&module&&!module.nodeType&&module,Pv=aa&&aa.exports===ag,Ph=Pv&&jm.process,Di=function(){try{var e=aa&&aa.require&&aa.require("util").types;return e||Ph&&Ph.binding&&Ph.binding("util")}catch{}}(),cg=Di&&Di.isTypedArray,Bh=cg?Dc(cg):Fv,Bv=Object.prototype,Dv=Bv.hasOwnProperty;function lg(e,t){var n=ee(e),r=!n&&Bc(e),i=!n&&!r&&oa(e),s=!n&&!r&&!i&&Bh(e),o=n||r||i||s,a=o?sv(e.length,String):[],c=a.length;for(var l in e)(t||Dv.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Fc(l,c)))&&a.push(l);return a}function ug(e,t){return function(n){return e(t(n))}}var $v=ug(Object.keys,Object),jv=Object.prototype,zv=jv.hasOwnProperty;function hg(e){if(!sa(e))return $v(e);var t=[];for(var n in Object(e))zv.call(e,n)&&n!="constructor"&&t.push(n);return t}function or(e){return Wr(e)?lg(e):hg(e)}var Wv=Object.prototype,Kv=Wv.hasOwnProperty,Sn=rv(function(e,t){if(sa(t)||Wr(t)){Mh(t,or(t),e);return}for(var n in t)Kv.call(t,n)&&Pc(e,n,t[n])});function Gv(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var Hv=Object.prototype,Yv=Hv.hasOwnProperty;function Vv(e){if(!sr(e))return Gv(e);var t=sa(e),n=[];for(var r in e)r=="constructor"&&(t||!Yv.call(e,r))||n.push(r);return n}function fg(e){return Wr(e)?lg(e,!0):Vv(e)}var Xv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qv=/^\w*$/;function Dh(e,t){if(ee(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Cc(e)?!0:qv.test(e)||!Xv.test(e)||t!=null&&e in Object(t)}var ca=ls(Object,"create");function Jv(){this.__data__=ca?ca(null):{},this.size=0}function Zv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Qv="__lodash_hash_undefined__",tR=Object.prototype,eR=tR.hasOwnProperty;function nR(e){var t=this.__data__;if(ca){var n=t[e];return n===Qv?void 0:n}return eR.call(t,e)?t[e]:void 0}var rR=Object.prototype,iR=rR.hasOwnProperty;function sR(e){var t=this.__data__;return ca?t[e]!==void 0:iR.call(t,e)}var oR="__lodash_hash_undefined__";function aR(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ca&&t===void 0?oR:t,this}function us(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}us.prototype.clear=Jv,us.prototype.delete=Zv,us.prototype.get=nR,us.prototype.has=sR,us.prototype.set=aR;function cR(){this.__data__=[],this.size=0}function $c(e,t){for(var n=e.length;n--;)if(ia(e[n][0],t))return n;return-1}var lR=Array.prototype,uR=lR.splice;function hR(e){var t=this.__data__,n=$c(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():uR.call(t,n,1),--this.size,!0}function fR(e){var t=this.__data__,n=$c(t,e);return n<0?void 0:t[n][1]}function dR(e){return $c(this.__data__,e)>-1}function pR(e,t){var n=this.__data__,r=$c(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function pi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}pi.prototype.clear=cR,pi.prototype.delete=hR,pi.prototype.get=fR,pi.prototype.has=dR,pi.prototype.set=pR;var la=ls(zr,"Map");function mR(){this.size=0,this.__data__={hash:new us,map:new(la||pi),string:new us}}function gR(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function jc(e,t){var n=e.__data__;return gR(t)?n[typeof t=="string"?"string":"hash"]:n.map}function yR(e){var t=jc(this,e).delete(e);return this.size-=t?1:0,t}function _R(e){return jc(this,e).get(e)}function bR(e){return jc(this,e).has(e)}function ER(e,t){var n=jc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function mi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}mi.prototype.clear=mR,mi.prototype.delete=yR,mi.prototype.get=_R,mi.prototype.has=bR,mi.prototype.set=ER;var wR="Expected a function";function $h(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(wR);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new($h.Cache||mi),n}$h.Cache=mi;var xR=500;function kR(e){var t=$h(e,function(r){return n.size===xR&&n.clear(),r}),n=t.cache;return t}var TR=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,AR=/\\(\\)?/g,vR=kR(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(TR,function(n,r,i,s){t.push(i?s.replace(AR,"$1"):r||n)}),t});function dg(e){return e==null?"":Hm(e)}function zc(e,t){return ee(e)?e:Dh(e,t)?[e]:vR(dg(e))}var RR=1/0;function ua(e){if(typeof e=="string"||Cc(e))return e;var t=e+"";return t=="0"&&1/e==-RR?"-0":t}function jh(e,t){t=zc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ua(t[n++])];return n&&n==r?e:void 0}function SR(e,t,n){var r=e==null?void 0:jh(e,t);return r===void 0?n:r}function zh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var pg=ir?ir.isConcatSpreadable:void 0;function IR(e){return ee(e)||Bc(e)||!!(pg&&e&&e[pg])}function Wh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=IR),i||(i=[]);++s<o;){var a=e[s];n(a)?zh(i,a):r||(i[i.length]=a)}return i}function Gn(e){var t=e==null?0:e.length;return t?Wh(e):[]}var mg=ug(Object.getPrototypeOf,Object);function Kh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function NR(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Kh(e,t,n)}var OR="\\ud800-\\udfff",CR="\\u0300-\\u036f",LR="\\ufe20-\\ufe2f",MR="\\u20d0-\\u20ff",UR=CR+LR+MR,FR="\\ufe0e\\ufe0f",PR="\\u200d",BR=RegExp("["+PR+OR+UR+FR+"]");function gg(e){return BR.test(e)}function DR(e){return e.split("")}var yg="\\ud800-\\udfff",$R="\\u0300-\\u036f",jR="\\ufe20-\\ufe2f",zR="\\u20d0-\\u20ff",WR=$R+jR+zR,KR="\\ufe0e\\ufe0f",GR="["+yg+"]",Gh="["+WR+"]",Hh="\\ud83c[\\udffb-\\udfff]",HR="(?:"+Gh+"|"+Hh+")",_g="[^"+yg+"]",bg="(?:\\ud83c[\\udde6-\\uddff]){2}",Eg="[\\ud800-\\udbff][\\udc00-\\udfff]",YR="\\u200d",wg=HR+"?",xg="["+KR+"]?",VR="(?:"+YR+"(?:"+[_g,bg,Eg].join("|")+")"+xg+wg+")*",XR=xg+wg+VR,qR="(?:"+[_g+Gh+"?",Gh,bg,Eg,GR].join("|")+")",JR=RegExp(Hh+"(?="+Hh+")|"+qR+XR,"g");function ZR(e){return e.match(JR)||[]}function QR(e){return gg(e)?ZR(e):DR(e)}function tS(e){return function(t){t=dg(t);var n=gg(t)?QR(t):void 0,r=n?n[0]:t.charAt(0),i=n?NR(n,1).join(""):t.slice(1);return r[e]()+i}}var kg=tS("toUpperCase");function eS(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function nS(){this.__data__=new pi,this.size=0}function rS(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function iS(e){return this.__data__.get(e)}function sS(e){return this.__data__.has(e)}var oS=200;function aS(e,t){var n=this.__data__;if(n instanceof pi){var r=n.__data__;if(!la||r.length<oS-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new mi(r)}return n.set(e,t),this.size=n.size,this}function Kr(e){var t=this.__data__=new pi(e);this.size=t.size}Kr.prototype.clear=nS,Kr.prototype.delete=rS,Kr.prototype.get=iS,Kr.prototype.has=sS,Kr.prototype.set=aS;function cS(e,t){return e&&Mh(t,or(t),e)}var Tg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ag=Tg&&typeof module=="object"&&module&&!module.nodeType&&module,lS=Ag&&Ag.exports===Tg,vg=lS?zr.Buffer:void 0,Rg=vg?vg.allocUnsafe:void 0;function uS(e,t){var n=e.length,r=Rg?Rg(n):new e.constructor(n);return e.copy(r),r}function Yh(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Sg(){return[]}var hS=Object.prototype,fS=hS.propertyIsEnumerable,Ig=Object.getOwnPropertySymbols,Vh=Ig?function(e){return e==null?[]:(e=Object(e),Yh(Ig(e),function(t){return fS.call(e,t)}))}:Sg;function dS(e,t){return Mh(e,Vh(e),t)}var pS=Object.getOwnPropertySymbols,mS=pS?function(e){for(var t=[];e;)zh(t,Vh(e)),e=mg(e);return t}:Sg;function Ng(e,t,n){var r=t(e);return ee(e)?r:zh(r,n(e))}function Xh(e){return Ng(e,or,Vh)}function gS(e){return Ng(e,fg,mS)}var qh=ls(zr,"DataView"),Jh=ls(zr,"Promise"),io=ls(zr,"Set"),Og="[object Map]",yS="[object Object]",Cg="[object Promise]",Lg="[object Set]",Mg="[object WeakMap]",Ug="[object DataView]",_S=cs(qh),bS=cs(la),ES=cs(Jh),wS=cs(io),xS=cs(Oh),ar=Bi;(qh&&ar(new qh(new ArrayBuffer(1)))!=Ug||la&&ar(new la)!=Og||Jh&&ar(Jh.resolve())!=Cg||io&&ar(new io)!=Lg||Oh&&ar(new Oh)!=Mg)&&(ar=function(e){var t=Bi(e),n=t==yS?e.constructor:void 0,r=n?cs(n):"";if(r)switch(r){case _S:return Ug;case bS:return Og;case ES:return Cg;case wS:return Lg;case xS:return Mg}return t});var kS=Object.prototype,TS=kS.hasOwnProperty;function AS(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&TS.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Wc=zr.Uint8Array;function vS(e){var t=new e.constructor(e.byteLength);return new Wc(t).set(new Wc(e)),t}function RS(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var SS=/\w*$/;function IS(e){var t=new e.constructor(e.source,SS.exec(e));return t.lastIndex=e.lastIndex,t}var Fg=ir?ir.prototype:void 0,Pg=Fg?Fg.valueOf:void 0;function NS(e){return Pg?Object(Pg.call(e)):{}}function OS(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var CS="[object Boolean]",LS="[object Date]",MS="[object Map]",US="[object Number]",FS="[object RegExp]",PS="[object Set]",BS="[object String]",DS="[object Symbol]",$S="[object ArrayBuffer]",jS="[object DataView]",zS="[object Float32Array]",WS="[object Float64Array]",KS="[object Int8Array]",GS="[object Int16Array]",HS="[object Int32Array]",YS="[object Uint8Array]",VS="[object Uint8ClampedArray]",XS="[object Uint16Array]",qS="[object Uint32Array]";function JS(e,t,n){var r=e.constructor;switch(t){case $S:return vS(e);case CS:case LS:return new r(+e);case jS:return RS(e);case zS:case WS:case KS:case GS:case HS:case YS:case VS:case XS:case qS:return OS(e);case MS:return new r;case US:case BS:return new r(e);case FS:return IS(e);case PS:return new r;case DS:return NS(e)}}function ZS(e){return typeof e.constructor=="function"&&!sa(e)?DA(mg(e)):{}}var QS="[object Map]";function tI(e){return wr(e)&&ar(e)==QS}var Bg=Di&&Di.isMap,eI=Bg?Dc(Bg):tI,nI="[object Set]";function rI(e){return wr(e)&&ar(e)==nI}var Dg=Di&&Di.isSet,iI=Dg?Dc(Dg):rI,$g="[object Arguments]",sI="[object Array]",oI="[object Boolean]",aI="[object Date]",cI="[object Error]",jg="[object Function]",lI="[object GeneratorFunction]",uI="[object Map]",hI="[object Number]",zg="[object Object]",fI="[object RegExp]",dI="[object Set]",pI="[object String]",mI="[object Symbol]",gI="[object WeakMap]",yI="[object ArrayBuffer]",_I="[object DataView]",bI="[object Float32Array]",EI="[object Float64Array]",wI="[object Int8Array]",xI="[object Int16Array]",kI="[object Int32Array]",TI="[object Uint8Array]",AI="[object Uint8ClampedArray]",vI="[object Uint16Array]",RI="[object Uint32Array]",me={};me[$g]=me[sI]=me[yI]=me[_I]=me[oI]=me[aI]=me[bI]=me[EI]=me[wI]=me[xI]=me[kI]=me[uI]=me[hI]=me[zg]=me[fI]=me[dI]=me[pI]=me[mI]=me[TI]=me[AI]=me[vI]=me[RI]=!0,me[cI]=me[jg]=me[gI]=!1;function Kc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!sr(e))return e;var a=ee(e);if(a)return o=AS(e),jA(e,o);var c=ar(e),l=c==jg||c==lI;if(oa(e))return uS(e);if(c==zg||c==$g||l&&!i)return o=l?{}:ZS(e),dS(e,cS(o,e));if(!me[c])return i?e:{};o=JS(e,c),s||(s=new Kr);var u=s.get(e);if(u)return u;s.set(e,o),iI(e)?e.forEach(function(f){o.add(Kc(f,t,n,f,e,s))}):eI(e)&&e.forEach(function(f,p){o.set(p,Kc(f,t,n,p,e,s))});var h=Xh,d=a?void 0:h(e);return Jm(d||e,function(f,p){d&&(p=f,f=e[p]),Pc(o,p,Kc(f,t,n,p,e,s))}),o}var SI=4;function ln(e){return Kc(e,SI)}function ha(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var II="__lodash_hash_undefined__";function NI(e){return this.__data__.set(e,II),this}function OI(e){return this.__data__.has(e)}function so(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new mi;++t<n;)this.add(e[t])}so.prototype.add=so.prototype.push=NI,so.prototype.has=OI;function Wg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Zh(e,t){return e.has(t)}var CI=1,LI=2;function Kg(e,t,n,r,i,s){var o=n&CI,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var h=-1,d=!0,f=n&LI?new so:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(r)var w=o?r(m,p,h,t,e,s):r(p,m,h,e,t,s);if(w!==void 0){if(w)continue;d=!1;break}if(f){if(!Wg(t,function(b,T){if(!Zh(f,T)&&(p===b||i(p,b,n,r,s)))return f.push(T)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function MI(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Qh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var UI=1,FI=2,PI="[object Boolean]",BI="[object Date]",DI="[object Error]",$I="[object Map]",jI="[object Number]",zI="[object RegExp]",WI="[object Set]",KI="[object String]",GI="[object Symbol]",HI="[object ArrayBuffer]",YI="[object DataView]",Gg=ir?ir.prototype:void 0,tf=Gg?Gg.valueOf:void 0;function VI(e,t,n,r,i,s,o){switch(n){case YI:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case HI:return!(e.byteLength!=t.byteLength||!s(new Wc(e),new Wc(t)));case PI:case BI:case jI:return ia(+e,+t);case DI:return e.name==t.name&&e.message==t.message;case zI:case KI:return e==t+"";case $I:var a=MI;case WI:var c=r&UI;if(a||(a=Qh),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=FI,o.set(e,t);var u=Kg(a(e),a(t),r,i,s,o);return o.delete(e),u;case GI:if(tf)return tf.call(e)==tf.call(t)}return!1}var XI=1,qI=Object.prototype,JI=qI.hasOwnProperty;function ZI(e,t,n,r,i,s){var o=n&XI,a=Xh(e),c=a.length,l=Xh(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:JI.call(t,d)))return!1}var f=s.get(e),p=s.get(t);if(f&&p)return f==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var w=o;++h<c;){d=a[h];var b=e[d],T=t[d];if(r)var A=o?r(T,b,d,t,e,s):r(b,T,d,e,t,s);if(!(A===void 0?b===T||i(b,T,n,r,s):A)){m=!1;break}w||(w=d=="constructor")}if(m&&!w){var I=e.constructor,U=t.constructor;I!=U&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(m=!1)}return s.delete(e),s.delete(t),m}var QI=1,Hg="[object Arguments]",Yg="[object Array]",Gc="[object Object]",tN=Object.prototype,Vg=tN.hasOwnProperty;function eN(e,t,n,r,i,s){var o=ee(e),a=ee(t),c=o?Yg:ar(e),l=a?Yg:ar(t);c=c==Hg?Gc:c,l=l==Hg?Gc:l;var u=c==Gc,h=l==Gc,d=c==l;if(d&&oa(e)){if(!oa(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new Kr),o||Bh(e)?Kg(e,t,n,r,i,s):VI(e,t,c,n,r,i,s);if(!(n&QI)){var f=u&&Vg.call(e,"__wrapped__"),p=h&&Vg.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,w=p?t.value():t;return s||(s=new Kr),i(m,w,n,r,s)}}return d?(s||(s=new Kr),ZI(e,t,n,r,i,s)):!1}function ef(e,t,n,r,i){return e===t?!0:e==null||t==null||!wr(e)&&!wr(t)?e!==e&&t!==t:eN(e,t,n,r,ef,i)}var nN=1,rN=2;function iN(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new Kr,h;if(!(h===void 0?ef(l,c,nN|rN,r,u):h))return!1}}return!0}function Xg(e){return e===e&&!sr(e)}function sN(e){for(var t=or(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Xg(i)]}return t}function qg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function oN(e){var t=sN(e);return t.length==1&&t[0][2]?qg(t[0][0],t[0][1]):function(n){return n===e||iN(n,e,t)}}function aN(e,t){return e!=null&&t in Object(e)}function Jg(e,t,n){t=zc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ua(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Fh(i)&&Fc(o,i)&&(ee(e)||Bc(e)))}function cN(e,t){return e!=null&&Jg(e,t,aN)}var lN=1,uN=2;function hN(e,t){return Dh(e)&&Xg(t)?qg(ua(e),t):function(n){var r=SR(n,e);return r===void 0&&r===t?cN(n,e):ef(t,r,lN|uN)}}function fN(e){return function(t){return t==null?void 0:t[e]}}function dN(e){return function(t){return jh(t,e)}}function pN(e){return Dh(e)?fN(ua(e)):dN(e)}function Gr(e){return typeof e=="function"?e:e==null?ro:typeof e=="object"?ee(e)?hN(e[0],e[1]):oN(e):pN(e)}function mN(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function gN(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var yN=gN();function _N(e,t){return e&&yN(e,t,or)}function bN(e,t){return function(n,r){if(n==null)return n;if(!Wr(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var hs=bN(_N);function EN(e,t,n,r){return hs(e,function(i,s,o){t(r,i,n(i),o)}),r}function wN(e,t){return function(n,r){var i=ee(n)?mN:EN,s=t?t():{};return i(n,e,Gr(r),s)}}var Zg=Object.prototype,xN=Zg.hasOwnProperty,nf=Uh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&eg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=fg(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||ia(u,Zg[l])&&!xN.call(e,l))&&(e[l]=s[l])}return e});function Qg(e){return wr(e)&&Wr(e)}var kN=200;function TN(e,t,n,r){var i=-1,s=Qm,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=kN&&(s=Zh,o=!1,t=new so(t));t:for(;++i<a;){var u=e[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(t[d]===h)continue t;c.push(u)}else s(t,h,r)||c.push(u)}return c}var Hc=Uh(function(e,t){return Qg(e)?TN(e,Wh(t,1,Qg,!0)):[]});function oo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function un(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Mc(t),Kh(e,t<0?0:t,r)):[]}function fa(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Mc(t),t=r-t,Kh(e,0,t<0?0:t)):[]}function AN(e){return typeof e=="function"?e:ro}function Nt(e,t){var n=ee(e)?Jm:hs;return n(e,AN(t))}function vN(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function RN(e,t){var n=!0;return hs(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function xr(e,t,n){var r=ee(e)?vN:RN;return r(e,Gr(t))}function ty(e,t){var n=[];return hs(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function cr(e,t){var n=ee(e)?Yh:ty;return n(e,Gr(t))}function SN(e){return function(t,n,r){var i=Object(t);if(!Wr(t)){var s=Gr(n);t=or(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var IN=Math.max;function NN(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Mc(n);return i<0&&(i=IN(r+i,0)),Zm(e,Gr(t),i)}var ao=SN(NN);function kr(e){return e&&e.length?e[0]:void 0}function ON(e,t){var n=-1,r=Wr(e)?Array(e.length):[];return hs(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function xt(e,t){var n=ee(e)?Lc:ON;return n(e,Gr(t))}function lr(e,t){return Wh(xt(e,t))}var CN=Object.prototype,LN=CN.hasOwnProperty,ey=wN(function(e,t,n){LN.call(e,n)?e[n].push(t):Lh(e,n,[t])}),MN=Object.prototype,UN=MN.hasOwnProperty;function FN(e,t){return e!=null&&UN.call(e,t)}function It(e,t){return e!=null&&Jg(e,t,FN)}var PN="[object String]";function In(e){return typeof e=="string"||!ee(e)&&wr(e)&&Bi(e)==PN}function BN(e,t){return Lc(t,function(n){return e[n]})}function je(e){return e==null?[]:BN(e,or(e))}var DN=Math.max;function En(e,t,n,r){e=Wr(e)?e:je(e),n=n&&!r?Mc(n):0;var i=e.length;return n<0&&(n=DN(i+n,0)),In(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Ch(e,t,n)>-1}function ny(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return Ch(e,t,i)}var $N="[object Map]",jN="[object Set]",zN=Object.prototype,WN=zN.hasOwnProperty;function ge(e){if(e==null)return!0;if(Wr(e)&&(ee(e)||typeof e=="string"||typeof e.splice=="function"||oa(e)||Bh(e)||Bc(e)))return!e.length;var t=ar(e);if(t==$N||t==jN)return!e.size;if(sa(e))return!hg(e).length;for(var n in e)if(WN.call(e,n))return!1;return!0}var KN="[object RegExp]";function GN(e){return wr(e)&&Bi(e)==KN}var ry=Di&&Di.isRegExp,gi=ry?Dc(ry):GN;function yi(e){return e===void 0}var HN="Expected a function";function YN(e){if(typeof e!="function")throw new TypeError(HN);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function VN(e,t,n,r){if(!sr(e))return e;t=zc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ua(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=sr(u)?u:Fc(t[i+1])?[]:{})}Pc(a,c,l),a=a[c]}return e}function XN(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=jh(e,o);n(a,o)&&VN(s,zc(o,e),a)}return s}function Tr(e,t){if(e==null)return{};var n=Lc(gS(e),function(r){return[r]});return t=Gr(t),XN(e,n,function(r,i){return t(r,i[0])})}function qN(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Nn(e,t,n){var r=ee(e)?eS:qN,i=arguments.length<3;return r(e,Gr(t),n,i,hs)}function Yc(e,t){var n=ee(e)?Yh:ty;return n(e,YN(Gr(t)))}function JN(e,t){var n;return hs(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function rf(e,t,n){var r=ee(e)?Wg:JN;return r(e,Gr(t))}var ZN=1/0,QN=io&&1/Qh(new io([,-0]))[1]==ZN?function(e){return new io(e)}:Ve,tO=200;function eO(e,t,n){var r=-1,i=Qm,s=e.length,o=!0,a=[],c=a;if(s>=tO){var l=QN(e);if(l)return Qh(l);o=!1,i=Zh,c=new so}else c=a;t:for(;++r<s;){var u=e[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(u)}else i(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function Vc(e){return e&&e.length?eO(e):[]}function sf(e){console&&console.error&&console.error(`Error: ${e}`)}function iy(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function sy(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function oy(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function nO(e){return rO(e)?e.LABEL:e.name}function rO(e){return In(e.LABEL)&&e.LABEL!==""}class Hr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Nt(this.definition,n=>{n.accept(t)})}}class On extends Hr{constructor(t){super([]),this.idx=1,Sn(this,Tr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class co extends Hr{constructor(t){super(t.definition),this.orgText="",Sn(this,Tr(t,n=>n!==void 0))}}class Cn extends Hr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Sn(this,Tr(t,n=>n!==void 0))}}class Ln extends Hr{constructor(t){super(t.definition),this.idx=1,Sn(this,Tr(t,n=>n!==void 0))}}class Yr extends Hr{constructor(t){super(t.definition),this.idx=1,Sn(this,Tr(t,n=>n!==void 0))}}class Vr extends Hr{constructor(t){super(t.definition),this.idx=1,Sn(this,Tr(t,n=>n!==void 0))}}class Xe extends Hr{constructor(t){super(t.definition),this.idx=1,Sn(this,Tr(t,n=>n!==void 0))}}class Ar extends Hr{constructor(t){super(t.definition),this.idx=1,Sn(this,Tr(t,n=>n!==void 0))}}class vr extends Hr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Sn(this,Tr(t,n=>n!==void 0))}}class Ie{constructor(t){this.idx=1,Sn(this,Tr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function iO(e){return xt(e,Xc)}function Xc(e){function t(n){return xt(n,Xc)}if(e instanceof On){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return In(e.label)&&(n.label=e.label),n}else{if(e instanceof Cn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Ln)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Yr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Vr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Xc(new Ie({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ar)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Xc(new Ie({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Xe)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof vr)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ie){const n={type:"Terminal",name:e.terminalType.name,label:nO(e.terminalType),idx:e.idx};In(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=gi(r)?r.source:r),n}else{if(e instanceof co)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class fs{visit(t){const n=t;switch(n.constructor){case On:return this.visitNonTerminal(n);case Cn:return this.visitAlternative(n);case Ln:return this.visitOption(n);case Yr:return this.visitRepetitionMandatory(n);case Vr:return this.visitRepetitionMandatoryWithSeparator(n);case Ar:return this.visitRepetitionWithSeparator(n);case Xe:return this.visitRepetition(n);case vr:return this.visitAlternation(n);case Ie:return this.visitTerminal(n);case co:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function sO(e){return e instanceof Cn||e instanceof Ln||e instanceof Xe||e instanceof Yr||e instanceof Vr||e instanceof Ar||e instanceof Ie||e instanceof co}function qc(e,t=[]){return e instanceof Ln||e instanceof Xe||e instanceof Ar?!0:e instanceof vr?rf(e.definition,r=>qc(r,t)):e instanceof On&&En(t,e)?!1:e instanceof Hr?(e instanceof On&&t.push(e),xr(e.definition,r=>qc(r,t))):!1}function oO(e){return e instanceof vr}function Xr(e){if(e instanceof On)return"SUBRULE";if(e instanceof Ln)return"OPTION";if(e instanceof vr)return"OR";if(e instanceof Yr)return"AT_LEAST_ONE";if(e instanceof Vr)return"AT_LEAST_ONE_SEP";if(e instanceof Ar)return"MANY_SEP";if(e instanceof Xe)return"MANY";if(e instanceof Ie)return"CONSUME";throw Error("non exhaustive match")}class Jc{walk(t,n=[]){Nt(t.definition,(r,i)=>{const s=un(t.definition,i+1);if(r instanceof On)this.walkProdRef(r,s,n);else if(r instanceof Ie)this.walkTerminal(r,s,n);else if(r instanceof Cn)this.walkFlat(r,s,n);else if(r instanceof Ln)this.walkOption(r,s,n);else if(r instanceof Yr)this.walkAtLeastOne(r,s,n);else if(r instanceof Vr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Ar)this.walkManySep(r,s,n);else if(r instanceof Xe)this.walkMany(r,s,n);else if(r instanceof vr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Ln({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=ay(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Ln({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=ay(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Nt(t.definition,s=>{const o=new Cn({definition:[s]});this.walk(o,i)})}}function ay(e,t,n){return[new Ln({definition:[new Ie({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function da(e){if(e instanceof On)return da(e.referencedRule);if(e instanceof Ie)return lO(e);if(sO(e))return aO(e);if(oO(e))return cO(e);throw Error("non exhaustive match")}function aO(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=qc(s),t=t.concat(da(s)),r=r+1,i=n.length>r;return Vc(t)}function cO(e){const t=xt(e.definition,n=>da(n));return Vc(Gn(t))}function lO(e){return[e.terminalType]}const cy="_~IN~_";class uO extends Jc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=fO(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Cn({definition:s}),a=da(o);this.follows[i]=a}}function hO(e){const t={};return Nt(e,n=>{const r=new uO(n).startWalking();Sn(t,r)}),t}function fO(e,t){return e.name+t+cy}function Ct(e){return e.charCodeAt(0)}function of(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function pa(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function lo(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function dO(){throw Error("Internal Error - Should never get here!")}function ly(e){return e.type==="Character"}const Zc=[];for(let e=Ct("0");e<=Ct("9");e++)Zc.push(e);const Qc=[Ct("_")].concat(Zc);for(let e=Ct("a");e<=Ct("z");e++)Qc.push(e);for(let e=Ct("A");e<=Ct("Z");e++)Qc.push(e);const uy=[Ct(" "),Ct("\f"),Ct(`
`),Ct("\r"),Ct("	"),Ct("\v"),Ct("	"),Ct("Â "),Ct("á"),Ct("â"),Ct("â"),Ct("â"),Ct("â"),Ct("â"),Ct("â"),Ct("â"),Ct("â"),Ct("â"),Ct("â"),Ct("â"),Ct("\u2028"),Ct("\u2029"),Ct("â¯"),Ct("â"),Ct("ã"),Ct("\uFEFF")],pO=/[0-9a-fA-F]/,tl=/[0-9]/,mO=/[1-9]/;class gO{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":pa(r,"global");break;case"i":pa(r,"ignoreCase");break;case"m":pa(r,"multiLine");break;case"u":pa(r,"unicode");break;case"y":pa(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}lo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return dO()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;lo(n);break}if(!(t===!0&&n===void 0)&&lo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),lo(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ct(`
`),Ct("\r"),Ct("\u2028"),Ct("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Zc;break;case"D":t=Zc,n=!0;break;case"s":t=uy;break;case"S":t=uy,n=!0;break;case"w":t=Qc;break;case"W":t=Qc,n=!0;break}if(lo(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Ct("\f");break;case"n":t=Ct(`
`);break;case"r":t=Ct("\r");break;case"t":t=Ct("	");break;case"v":t=Ct("\v");break}if(lo(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ct("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Ct(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Ct(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,ly(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,ly(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else of(r.value,t),t.push(Ct("-")),of(i.value,t)}else of(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ct("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(mO.test(t)===!1)throw Error("Expecting a positive integer");for(;tl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(tl.test(t)===!1)throw Error("Expecting an integer");for(;tl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ct(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return tl.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(pO.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class af{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let el={};const yO=new gO;function nl(e){const t=e.toString();if(el.hasOwnProperty(t))return el[t];{const n=yO.pattern(t);return el[t]=n,n}}function _O(){el={}}const hy="Complement Sets are not supported for first char optimization",rl=`Unable to use "first char" lexer optimizations:
`;function bO(e,t=!1){try{const n=nl(e);return cf(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===hy)t&&iy(`${rl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),sf(`${rl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function cf(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)cf(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":il(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(hy);Nt(o.value,c=>{if(typeof c=="number")il(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)il(u,t,n);else{for(let u=l.from;u<=l.to&&u<ga;u++)il(u,t,n);if(l.to>=ga){const u=l.from>=ga?l.from:ga,h=l.to,d=$i(u),f=$i(h);for(let p=d;p<=f;p++)t[p]=p}}}});break;case"Group":cf(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&lf(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return je(t)}function il(e,t,n){const r=$i(e);t[r]=r,n===!0&&EO(e,t)}function EO(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=$i(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=$i(i.charCodeAt(0));t[s]=s}}}function fy(e,t){return ao(e.value,n=>{if(typeof n=="number")return En(t,n);{const r=n;return ao(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function lf(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?ee(e.value)?xr(e.value,lf):lf(e.value):!1}class wO extends af{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){En(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?fy(t,this.targetCharCodes)===void 0&&(this.found=!0):fy(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function uf(e,t){if(t instanceof RegExp){const n=nl(t),r=new wO(e);return r.visit(n),r.found}else return ao(t,n=>En(e,n.charCodeAt(0)))!==void 0}const ds="PATTERN",ma="defaultMode",sl="modes";let dy=typeof new RegExp("(?:)").sticky=="boolean";function xO(e,t){t=nf(t,{useSticky:dy,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,A)=>A()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{GO()});let r;n("Reject Lexer.NA",()=>{r=Yc(e,T=>T[ds]===qe.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=xt(r,T=>{const A=T[ds];if(gi(A)){const I=A.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!A.ignoreCase?I:I.length===2&&I[0]==="\\"&&!En(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:t.useSticky?my(A):py(A)}else{if(di(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const I=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(I);return t.useSticky?my(U):py(U)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=xt(r,T=>T.tokenTypeIdx),a=xt(r,T=>{const A=T.GROUP;if(A!==qe.SKIPPED){if(In(A))return A;if(yi(A))return!1;throw Error("non exhaustive match")}}),c=xt(r,T=>{const A=T.LONGER_ALT;if(A)return ee(A)?xt(A,U=>ny(r,U)):[ny(r,A)]}),l=xt(r,T=>T.PUSH_MODE),u=xt(r,T=>It(T,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const T=_y(t.lineTerminatorCharacters);h=xt(r,A=>!1),t.positionTracking!=="onlyOffset"&&(h=xt(r,A=>It(A,"LINE_BREAKS")?!!A.LINE_BREAKS:yy(A,T)===!1&&uf(T,A.PATTERN)))});let d,f,p,m;n("Misc Mapping #2",()=>{d=xt(r,gy),f=xt(s,zO),p=Nn(r,(T,A)=>{const I=A.GROUP;return In(I)&&I!==qe.SKIPPED&&(T[I]=[]),T},{}),m=xt(s,(T,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:d[A],short:f[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:r[A]}))});let w=!0,b=[];return t.safeMode||n("First Char Optimization",()=>{b=Nn(r,(T,A,I)=>{if(typeof A.PATTERN=="string"){const U=A.PATTERN.charCodeAt(0),R=$i(U);hf(T,R,m[I])}else if(ee(A.START_CHARS_HINT)){let U;Nt(A.START_CHARS_HINT,R=>{const O=typeof R=="string"?R.charCodeAt(0):R,P=$i(O);U!==P&&(U=P,hf(T,P,m[I]))})}else if(gi(A.PATTERN))if(A.PATTERN.unicode)w=!1,t.ensureOptimizations&&sf(`${rl}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=bO(A.PATTERN,t.ensureOptimizations);ge(U)&&(w=!1),Nt(U,R=>{hf(T,R,m[I])})}else t.ensureOptimizations&&sf(`${rl}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:b,hasCustom:i,canBeOptimized:w}}function kO(e,t){let n=[];const r=AO(e);n=n.concat(r.errors);const i=vO(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(TO(s)),n=n.concat(MO(s)),n=n.concat(UO(s,t)),n=n.concat(FO(s)),n}function TO(e){let t=[];const n=cr(e,r=>gi(r[ds]));return t=t.concat(SO(n)),t=t.concat(OO(n)),t=t.concat(CO(n)),t=t.concat(LO(n)),t=t.concat(IO(n)),t}function AO(e){const t=cr(e,i=>!It(i,ds)),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ce.MISSING_PATTERN,tokenTypes:[i]})),r=Hc(e,t);return{errors:n,valid:r}}function vO(e){const t=cr(e,i=>{const s=i[ds];return!gi(s)&&!di(s)&&!It(s,"exec")&&!In(s)}),n=xt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ce.INVALID_PATTERN,tokenTypes:[i]})),r=Hc(e,t);return{errors:n,valid:r}}const RO=/[^\\][$]/;function SO(e){class t extends af{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=cr(e,i=>{const s=i.PATTERN;try{const o=nl(s),a=new t;return a.visit(o),a.found}catch{return RO.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ce.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function IO(e){const t=cr(e,r=>r.PATTERN.test(""));return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ce.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const NO=/[^\\[][\^]|^\^/;function OO(e){class t extends af{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=cr(e,i=>{const s=i.PATTERN;try{const o=nl(s),a=new t;return a.visit(o),a.found}catch{return NO.test(s.source)}});return xt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ce.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function CO(e){const t=cr(e,r=>{const i=r[ds];return i instanceof RegExp&&(i.multiline||i.global)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ce.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function LO(e){const t=[];let n=xt(e,s=>Nn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!En(t,a)&&a.PATTERN!==qe.NA&&(t.push(a),o.push(a)),o),[]));n=ha(n);const r=cr(n,s=>s.length>1);return xt(r,s=>{const o=xt(s,c=>c.name);return{message:`The same RegExp pattern ->${kr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ce.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function MO(e){const t=cr(e,r=>{if(!It(r,"GROUP"))return!1;const i=r.GROUP;return i!==qe.SKIPPED&&i!==qe.NA&&!In(i)});return xt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ce.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function UO(e,t){const n=cr(e,i=>i.PUSH_MODE!==void 0&&!En(t,i.PUSH_MODE));return xt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ce.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function FO(e){const t=[],n=Nn(e,(r,i,s)=>{const o=i.PATTERN;return o===qe.NA||(In(o)?r.push({str:o,idx:s,tokenType:i}):gi(o)&&BO(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Nt(e,(r,i)=>{Nt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&PO(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Ce.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function PO(e,t){if(gi(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(di(t))return t(e,0,[],{});if(It(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function BO(e){return ao([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function py(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function my(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function DO(e,t,n){const r=[];return It(e,ma)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ma+`> property in its definition
`,type:Ce.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),It(e,sl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+sl+`> property in its definition
`,type:Ce.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),It(e,sl)&&It(e,ma)&&!It(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ma}: <${e.defaultMode}>which does not exist
`,type:Ce.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),It(e,sl)&&Nt(e.modes,(i,s)=>{Nt(i,(o,a)=>{if(yi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ce.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(It(o,"LONGER_ALT")){const c=ee(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Nt(c,l=>{!yi(l)&&!En(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ce.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function $O(e,t,n){const r=[];let i=!1;const s=ha(Gn(je(e.modes))),o=Yc(s,c=>c[ds]===qe.NA),a=_y(n);return t&&Nt(o,c=>{const l=yy(c,a);if(l!==!1){const h={message:KO(c,l),type:l.issue,tokenType:c};r.push(h)}else It(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):uf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ce.NO_LINE_BREAKS_FLAGS}),r}function jO(e){const t={},n=or(e);return Nt(n,r=>{const i=e[r];if(ee(i))t[r]=[];else throw Error("non exhaustive match")}),t}function gy(e){const t=e.PATTERN;if(gi(t))return!1;if(di(t))return!0;if(It(t,"exec"))return!0;if(In(t))return!1;throw Error("non exhaustive match")}function zO(e){return In(e)&&e.length===1?e.charCodeAt(0):!1}const WO={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function yy(e,t){if(It(e,"LINE_BREAKS"))return!1;if(gi(e.PATTERN)){try{uf(t,e.PATTERN)}catch(n){return{issue:Ce.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(In(e.PATTERN))return!1;if(gy(e))return{issue:Ce.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function KO(e,t){if(t.issue===Ce.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Ce.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function _y(e){return xt(e,n=>In(n)?n.charCodeAt(0):n)}function hf(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const ga=256;let ol=[];function $i(e){return e<ga?e:ol[e]}function GO(){if(ge(ol)){ol=new Array(65536);for(let e=0;e<65536;e++)ol[e]=e>255?255+~~(e/255):e}}function ya(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function al(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let by=1;const Ey={};function _a(e){const t=HO(e);YO(t),XO(t),VO(t),Nt(t,n=>{n.isParent=n.categoryMatches.length>0})}function HO(e){let t=ln(e),n=e,r=!0;for(;r;){n=ha(Gn(xt(n,s=>s.CATEGORIES)));const i=Hc(n,t);t=t.concat(i),ge(i)?r=!1:n=i}return t}function YO(e){Nt(e,t=>{xy(t)||(Ey[by]=t,t.tokenTypeIdx=by++),ky(t)&&!ee(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),ky(t)||(t.CATEGORIES=[]),qO(t)||(t.categoryMatches=[]),JO(t)||(t.categoryMatchesMap={})})}function VO(e){Nt(e,t=>{t.categoryMatches=[],Nt(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(Ey[r].tokenTypeIdx)})})}function XO(e){Nt(e,t=>{wy([],t)})}function wy(e,t){Nt(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Nt(t.CATEGORIES,n=>{const r=e.concat(t);En(r,n)||wy(r,n)})}function xy(e){return It(e,"tokenTypeIdx")}function ky(e){return It(e,"CATEGORIES")}function qO(e){return It(e,"categoryMatches")}function JO(e){return It(e,"categoryMatchesMap")}function ZO(e){return It(e,"tokenTypeIdx")}const QO={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Ce;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ce||(Ce={}));const ba={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:QO,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(ba);let qe=class{constructor(t,n=ba){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=sy(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Sn({},ba,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===ba.lineTerminatorsPattern)this.config.lineTerminatorsPattern=WO;else if(this.config.lineTerminatorCharacters===ba.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),ee(t)?i={modes:{defaultMode:ln(t)},defaultMode:ma}:(s=!1,i=ln(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(DO(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat($O(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Nt(i.modes,(a,c)=>{i.modes[c]=Yc(a,l=>yi(l))});const o=or(i.modes);if(Nt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(kO(a,o))}),ge(this.lexerDefinitionErrors)){_a(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=xO(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Sn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ge(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=xt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Nt(this.lexerDefinitionWarning,a=>{iy(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(dy?(this.chopInput=ro,this.match=this.matchWithTest):(this.updateLastIndex=Ve,this.match=this.matchWithExec),s&&(this.handleModes=Ve),this.trackStartLines===!1&&(this.computeNewColumn=ro),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Ve),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Nn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ge(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{_O()}),this.TRACE_INIT("toFastProperties",()=>{oy(this)})})}tokenize(t,n=this.defaultMode){if(!ge(this.lexerDefinitionErrors)){const i=xt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,h,d,f,p,m,w,b;const T=t,A=T.length;let I=0,U=0;const R=this.hasCustom?0:Math.floor(t.length/10),O=new Array(R),P=[];let N=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const et=jO(this.emptyGroups),L=this.trackStartLines,S=this.config.lineTerminatorsPattern;let E=0,B=[],Z=[];const D=[],st=[];Object.freeze(st);let tt;function ft(){return B}function V(Mt){const Xt=$i(Mt),Ut=Z[Xt];return Ut===void 0?st:Ut}const z=Mt=>{if(D.length===1&&Mt.tokenType.PUSH_MODE===void 0){const Xt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Mt);P.push({offset:Mt.startOffset,line:Mt.startLine,column:Mt.startColumn,length:Mt.image.length,message:Xt})}else{D.pop();const Xt=oo(D);B=this.patternIdxToConfig[Xt],Z=this.charCodeToPatternIdxToConfig[Xt],E=B.length;const Ut=this.canModeBeOptimized[Xt]&&this.config.safeMode===!1;Z&&Ut?tt=V:tt=ft}};function Et(Mt){D.push(Mt),Z=this.charCodeToPatternIdxToConfig[Mt],B=this.patternIdxToConfig[Mt],E=B.length,E=B.length;const Xt=this.canModeBeOptimized[Mt]&&this.config.safeMode===!1;Z&&Xt?tt=V:tt=ft}Et.call(this,n);let at;const lt=this.config.recoveryEnabled;for(;I<A;){c=null;const Mt=T.charCodeAt(I),Xt=tt(Mt),Ut=Xt.length;for(r=0;r<Ut;r++){at=Xt[r];const Tt=at.pattern;l=null;const Dt=at.short;if(Dt!==!1?Mt===Dt&&(c=Tt):at.isCustom===!0?(b=Tt.exec(T,I,O,et),b!==null?(c=b[0],b.payload!==void 0&&(l=b.payload)):c=null):(this.updateLastIndex(Tt,I),c=this.match(Tt,t,I)),c!==null){if(a=at.longerAlt,a!==void 0){const Ft=a.length;for(s=0;s<Ft;s++){const Ae=B[a[s]],Me=Ae.pattern;if(u=null,Ae.isCustom===!0?(b=Me.exec(T,I,O,et),b!==null?(o=b[0],b.payload!==void 0&&(u=b.payload)):o=null):(this.updateLastIndex(Me,I),o=this.match(Me,t,I)),o&&o.length>c.length){c=o,l=u,at=Ae;break}}}break}}if(c!==null){if(h=c.length,d=at.group,d!==void 0&&(f=at.tokenTypeIdx,p=this.createTokenInstance(c,I,f,at.tokenType,N,W,h),this.handlePayload(p,l),d===!1?U=this.addToken(O,U,p):et[d].push(p)),t=this.chopInput(t,h),I=I+h,W=this.computeNewColumn(W,h),L===!0&&at.canLineTerminator===!0){let Tt=0,Dt,Ft;S.lastIndex=0;do Dt=S.test(c),Dt===!0&&(Ft=S.lastIndex-1,Tt++);while(Dt===!0);Tt!==0&&(N=N+Tt,W=h-Ft,this.updateTokenEndLineColumnLocation(p,d,Ft,Tt,N,W,h))}this.handleModes(at,z,Et,p)}else{const Tt=I,Dt=N,Ft=W;let Ae=lt===!1;for(;Ae===!1&&I<A;)for(t=this.chopInput(t,1),I++,i=0;i<E;i++){const Me=B[i],k=Me.pattern,ot=Me.short;if(ot!==!1?T.charCodeAt(I)===ot&&(Ae=!0):Me.isCustom===!0?Ae=k.exec(T,I,O,et)!==null:(this.updateLastIndex(k,I),Ae=k.exec(t)!==null),Ae===!0)break}if(m=I-Tt,W=this.computeNewColumn(W,m),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,Tt,m,Dt,Ft),P.push({offset:Tt,line:Dt,column:Ft,length:m,message:w}),lt===!1)break}}return this.hasCustom||(O.length=U),{tokens:O,groups:et,errors:P}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};qe.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",qe.NA=/NOT_APPLICABLE/;function Ea(e){return Ty(e)?e.LABEL:e.name}function Ty(e){return In(e.LABEL)&&e.LABEL!==""}const tC="parent",Ay="categories",vy="label",Ry="group",Sy="push_mode",Iy="pop_mode",Ny="longer_alt",Oy="line_breaks",Cy="start_chars_hint";function Hn(e){return eC(e)}function eC(e){const t=e.pattern,n={};if(n.name=e.name,yi(t)||(n.PATTERN=t),It(e,tC))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return It(e,Ay)&&(n.CATEGORIES=e[Ay]),_a([n]),It(e,vy)&&(n.LABEL=e[vy]),It(e,Ry)&&(n.GROUP=e[Ry]),It(e,Iy)&&(n.POP_MODE=e[Iy]),It(e,Sy)&&(n.PUSH_MODE=e[Sy]),It(e,Ny)&&(n.LONGER_ALT=e[Ny]),It(e,Oy)&&(n.LINE_BREAKS=e[Oy]),It(e,Cy)&&(n.START_CHARS_HINT=e[Cy]),n}const ps=Hn({name:"EOF",pattern:qe.NA});_a([ps]);function cl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function nC(e,t){return ya(e,t)}const Ly={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${Ty(e)?`--> ${Ea(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+kr(t).image+"'";if(r)return s+r+a;{const c=Nn(e,(d,f)=>d.concat(f),[]),l=xt(c,d=>`[${xt(d,f=>Ea(f)).join(", ")}]`),h=`one of these possible Token sequences:
${xt(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+kr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${xt(e,l=>`[${xt(l,u=>Ea(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Ly);const rC={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},ms={buildDuplicateFoundError(e,t){function n(u){return u instanceof Ie?u.terminalType.name:u instanceof On?u.nonTerminalName:""}const r=e.name,i=kr(t),s=i.idx,o=Xr(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=xt(e.prefixPath,i=>Ea(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=xt(e.prefixPath,i=>Ea(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Xr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=xt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof co?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function iC(e,t){const n=new sC(e,t);return n.resolveRefs(),n.errors}class sC extends fs{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Nt(je(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:wn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class oC extends Jc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=ln(this.path.ruleStack).reverse(),this.occurrenceStack=ln(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){ge(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class aC extends oC{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Cn({definition:i});this.possibleTokTypes=da(s),this.found=!0}}}class ll extends Jc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class cC extends ll{walkMany(t,n,r){if(t.idx===this.occurrence){const i=kr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ie&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class My extends ll{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=kr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ie&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class lC extends ll{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=kr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ie&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Uy extends ll{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=kr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ie&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function ff(e,t,n=[]){n=ln(n);let r=[],i=0;function s(a){return a.concat(un(e,i+1))}function o(a){const c=ff(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Cn)return o(a.definition);if(a instanceof On)return o(a.definition);if(a instanceof Ln)r=o(a.definition);else if(a instanceof Yr){const c=a.definition.concat([new Xe({definition:a.definition})]);return o(c)}else if(a instanceof Vr){const c=[new Cn({definition:a.definition}),new Xe({definition:[new Ie({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Ar){const c=a.definition.concat([new Xe({definition:[new Ie({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Xe){const c=a.definition.concat([new Xe({definition:a.definition})]);r=o(c)}else{if(a instanceof vr)return Nt(a.definition,c=>{ge(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ie)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:un(e,i)}),r}function Fy(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ge(h);){const d=h.pop();if(d===o){a&&oo(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,w=d.occurrenceStack;if(ge(f))continue;const b=f[0];if(b===i){const T={idx:p,def:un(f),ruleStack:fa(m),occurrenceStack:fa(w)};h.push(T)}else if(b instanceof Ie)if(p<c-1){const T=p+1,A=t[T];if(n(A,b.terminalType)){const I={idx:T,def:un(f),ruleStack:m,occurrenceStack:w};h.push(I)}}else if(p===c-1)u.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:m,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(b instanceof On){const T=ln(m);T.push(b.nonTerminalName);const A=ln(w);A.push(b.idx);const I={idx:p,def:b.definition.concat(s,un(f)),ruleStack:T,occurrenceStack:A};h.push(I)}else if(b instanceof Ln){const T={idx:p,def:un(f),ruleStack:m,occurrenceStack:w};h.push(T),h.push(o);const A={idx:p,def:b.definition.concat(un(f)),ruleStack:m,occurrenceStack:w};h.push(A)}else if(b instanceof Yr){const T=new Xe({definition:b.definition,idx:b.idx}),A=b.definition.concat([T],un(f)),I={idx:p,def:A,ruleStack:m,occurrenceStack:w};h.push(I)}else if(b instanceof Vr){const T=new Ie({terminalType:b.separator}),A=new Xe({definition:[T].concat(b.definition),idx:b.idx}),I=b.definition.concat([A],un(f)),U={idx:p,def:I,ruleStack:m,occurrenceStack:w};h.push(U)}else if(b instanceof Ar){const T={idx:p,def:un(f),ruleStack:m,occurrenceStack:w};h.push(T),h.push(o);const A=new Ie({terminalType:b.separator}),I=new Xe({definition:[A].concat(b.definition),idx:b.idx}),U=b.definition.concat([I],un(f)),R={idx:p,def:U,ruleStack:m,occurrenceStack:w};h.push(R)}else if(b instanceof Xe){const T={idx:p,def:un(f),ruleStack:m,occurrenceStack:w};h.push(T),h.push(o);const A=new Xe({definition:b.definition,idx:b.idx}),I=b.definition.concat([A],un(f)),U={idx:p,def:I,ruleStack:m,occurrenceStack:w};h.push(U)}else if(b instanceof vr)for(let T=b.definition.length-1;T>=0;T--){const A=b.definition[T],I={idx:p,def:A.definition.concat(un(f)),ruleStack:m,occurrenceStack:w};h.push(I),h.push(o)}else if(b instanceof Cn)h.push({idx:p,def:b.definition.concat(un(f)),ruleStack:m,occurrenceStack:w});else if(b instanceof co)h.push(uC(b,p,m,w));else throw Error("non exhaustive match")}return u}function uC(e,t,n,r){const i=ln(n);i.push(e.name);const s=ln(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Le;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Le||(Le={}));function Py(e){if(e instanceof Ln||e==="Option")return Le.OPTION;if(e instanceof Xe||e==="Repetition")return Le.REPETITION;if(e instanceof Yr||e==="RepetitionMandatory")return Le.REPETITION_MANDATORY;if(e instanceof Vr||e==="RepetitionMandatoryWithSeparator")return Le.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Ar||e==="RepetitionWithSeparator")return Le.REPETITION_WITH_SEPARATOR;if(e instanceof vr||e==="Alternation")return Le.ALTERNATION;throw Error("non exhaustive match")}function hC(e,t,n,r,i,s){const o=pf(e,t,n),a=jy(o)?al:ya;return s(o,r,a,i)}function fC(e,t,n,r,i,s){const o=mf(e,t,i,n),a=jy(o)?al:ya;return s(o[0],a,r)}function dC(e,t,n,r){const i=e.length,s=xr(e,o=>xr(o,a=>a.length===1));if(t)return function(o){const a=xt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let m=0;m<p;m++){const w=this.LA(m+1);if(n(w,f[m])===!1)continue t}return c}}};if(s&&!r){const o=xt(e,c=>Gn(c)),a=Nn(o,(c,l,u)=>(Nt(l,h=>{It(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Nt(h.categoryMatches,d=>{It(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue t}return o}}}}function pC(e,t,n){const r=xr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Gn(e);if(s.length===1&&ge(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Nn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Nt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class mC extends Jc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Le.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Le.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Le.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Le.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Le.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class By extends fs{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Le.OPTION)}visitRepetition(t){this.checkIsTarget(t,Le.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Le.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Le.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Le.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Le.ALTERNATION)}}function Dy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function df(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function gC(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function $y(e,t){const n=xt(e,o=>ff([o],1)),r=Dy(n.length),i=xt(n,o=>{const a={};return Nt(o,c=>{const l=df(c.partialPath);Nt(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=Dy(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=df(h);if(gC(i,f,c)||ge(d)||h.length===t){const m=r[c];if(gf(m,h)===!1){m.push(h);for(let w=0;w<f.length;w++){const b=f[w];i[c][b]=!0}}}else{const m=ff(d,o+1,h);s[c]=s[c].concat(m),Nt(m,w=>{const b=df(w.partialPath);Nt(b,T=>{i[c][T]=!0})})}}}}return r}function pf(e,t,n,r){const i=new By(e,Le.ALTERNATION,r);return t.accept(i),$y(i.result,n)}function mf(e,t,n,r){const i=new By(e,n);t.accept(i);const s=i.result,a=new mC(t,e,n).startWalking(),c=new Cn({definition:s}),l=new Cn({definition:a});return $y([c,l],r)}function gf(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function yC(e,t){return e.length<t.length&&xr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function jy(e){return xr(e,t=>xr(t,n=>xr(n,r=>ge(r.categoryMatches))))}function _C(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return xt(t,n=>Object.assign({type:wn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function bC(e,t,n,r){const i=lr(e,c=>EC(c,n)),s=CC(e,t,n),o=lr(e,c=>SC(c,n)),a=lr(e,c=>kC(c,e,r,n));return i.concat(s,o,a)}function EC(e,t){const n=new xC;e.accept(n);const r=n.allProductions,i=ey(r,wC),s=Tr(i,a=>a.length>1);return xt(je(s),a=>{const c=kr(a),l=t.buildDuplicateFoundError(e,a),u=Xr(c),h={message:l,type:wn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=zy(c);return d&&(h.parameter=d),h})}function wC(e){return`${Xr(e)}_#_${e.idx}_#_${zy(e)}`}function zy(e){return e instanceof Ie?e.terminalType.name:e instanceof On?e.nonTerminalName:""}class xC extends fs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function kC(e,t,n,r){const i=[];if(Nn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:wn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function TC(e,t,n){const r=[];let i;return En(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:wn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Wy(e,t,n,r=[]){const i=[],s=ul(t.definition);if(ge(s))return[];{const o=e.name;En(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:wn.LEFT_RECURSION,ruleName:o});const c=Hc(s,r.concat([e])),l=lr(c,u=>{const h=ln(r);return h.push(u),Wy(e,u,n,h)});return i.concat(l)}}function ul(e){let t=[];if(ge(e))return t;const n=kr(e);if(n instanceof On)t.push(n.referencedRule);else if(n instanceof Cn||n instanceof Ln||n instanceof Yr||n instanceof Vr||n instanceof Ar||n instanceof Xe)t=t.concat(ul(n.definition));else if(n instanceof vr)t=Gn(xt(n.definition,s=>ul(s.definition)));else if(!(n instanceof Ie))throw Error("non exhaustive match");const r=qc(n),i=e.length>1;if(r&&i){const s=un(e);return t.concat(ul(s))}else return t}class yf extends fs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function AC(e,t){const n=new yf;e.accept(n);const r=n.alternations;return lr(r,s=>{const o=fa(s.definition);return lr(o,(a,c)=>{const l=Fy([a],[],ya,1);return ge(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:wn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function vC(e,t,n){const r=new yf;e.accept(r);let i=r.alternations;return i=Yc(i,o=>o.ignoreAmbiguities===!0),lr(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=pf(a,e,c,o),u=NC(l,o,e,n),h=OC(l,o,e,n);return u.concat(h)})}class RC extends fs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function SC(e,t){const n=new yf;e.accept(n);const r=n.alternations;return lr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:wn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function IC(e,t,n){const r=[];return Nt(e,i=>{const s=new RC;i.accept(s);const o=s.allProductions;Nt(o,a=>{const c=Py(a),l=a.maxLookahead||t,u=a.idx,d=mf(u,i,c,l)[0];if(ge(Gn(d))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:f,type:wn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function NC(e,t,n,r){const i=[],s=Nn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Nt(c,u=>{const h=[l];Nt(e,(d,f)=>{l!==f&&gf(d,u)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!gf(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return xt(s,a=>{const c=xt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:wn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function OC(e,t,n,r){const i=Nn(e,(o,a,c)=>{const l=xt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return ha(lr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=cr(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&yC(d.path,l));return xt(u,d=>{const f=[d.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:wn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function CC(e,t,n){const r=[],i=xt(t,s=>s.name);return Nt(e,s=>{const o=s.name;if(En(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:wn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function LC(e){const t=nf(e,{errMsgProvider:rC}),n={};return Nt(e.rules,r=>{n[r.name]=r}),iC(n,t.errMsgProvider)}function MC(e){return e=nf(e,{errMsgProvider:ms}),bC(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const Ky="MismatchedTokenException",Gy="NoViableAltException",Hy="EarlyExitException",Yy="NotAllInputParsedException",Vy=[Ky,Gy,Hy,Yy];Object.freeze(Vy);function hl(e){return En(Vy,e.name)}class fl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Xy extends fl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ky}}class UC extends fl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Gy}}class FC extends fl{constructor(t,n){super(t,n),this.name=Yy}}class PC extends fl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Hy}}const _f={},qy="InRuleRecoveryException";class BC extends Error{constructor(t){super(t),this.name=qy}}class DC{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=It(t,"recoveryEnabled")?t.recoveryEnabled:_i.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=$C)}getTokenToInsert(t){const n=cl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new Xy(f,l,this.LA(0));p.resyncedTokens=fa(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new BC("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||ge(n))return!1;const r=this.LA(1);return ao(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return En(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=ao(t,s=>nC(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return _f;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return xt(t,(r,i)=>i===0?_f:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=xt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Gn(t)}getFollowSetFromFollowKey(t){if(t===_f)return[ps];const n=t.ruleName+t.idxInCallingRule+cy+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,ps)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return fa(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=ln(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return xt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function $C(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=ps,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const jC=4,ji=8,Jy=1<<ji,Zy=2<<ji,bf=3<<ji,Ef=4<<ji,wf=5<<ji,dl=6<<ji;function xf(e,t,n){return n|t|e}class zC{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:_i.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(ge(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return lr(t,n=>Wy(n,n,ms))}validateEmptyOrAlternatives(t){return lr(t,n=>AC(n,ms))}validateAmbiguousAlternationAlternatives(t,n){return lr(t,r=>vC(r,n,ms))}validateSomeNonEmptyLookaheadPath(t,n){return IC(t,n,ms)}buildLookaheadForAlternation(t){return hC(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,dC)}buildLookaheadForOptional(t){return fC(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Py(t.prodType),pC)}}class WC{initLooksAhead(t){this.dynamicTokensEnabled=It(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:_i.dynamicTokensEnabled,this.maxLookahead=It(t,"maxLookahead")?t.maxLookahead:_i.maxLookahead,this.lookaheadStrategy=It(t,"lookaheadStrategy")?t.lookaheadStrategy:new zC({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Nt(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=GC(n);Nt(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Xr(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=xf(this.fullRuleNameToShort[n.name],Jy,l.idx);this.setLaFuncCache(d,h)})}),Nt(i,l=>{this.computeLookaheadFunc(n,l.idx,bf,"Repetition",l.maxLookahead,Xr(l))}),Nt(s,l=>{this.computeLookaheadFunc(n,l.idx,Zy,"Option",l.maxLookahead,Xr(l))}),Nt(o,l=>{this.computeLookaheadFunc(n,l.idx,Ef,"RepetitionMandatory",l.maxLookahead,Xr(l))}),Nt(a,l=>{this.computeLookaheadFunc(n,l.idx,dl,"RepetitionMandatoryWithSeparator",l.maxLookahead,Xr(l))}),Nt(c,l=>{this.computeLookaheadFunc(n,l.idx,wf,"RepetitionWithSeparator",l.maxLookahead,Xr(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=xf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return xf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class KC extends fs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const pl=new KC;function GC(e){pl.reset(),e.accept(pl);const t=pl.dslMethods;return pl.reset(),t}function Qy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function t_(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function HC(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function YC(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const VC="name";function e_(e,t){Object.defineProperty(e,VC,{enumerable:!1,configurable:!0,writable:!1,value:t})}function XC(e,t){const n=or(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function qC(e,t){const n=function(){};e_(n,e+"BaseSemantics");const r={visit:function(i,s){if(ee(i)&&(i=i[0]),!yi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=ZC(this,t);if(!ge(i)){const s=xt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function JC(e,t,n){const r=function(){};e_(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Nt(t,s=>{i[s]=XC}),r.prototype=i,r.prototype.constructor=r,r}var kf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(kf||(kf={}));function ZC(e,t){return QC(e,t)}function QC(e,t){const n=cr(t,i=>di(e[i])===!1),r=xt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:kf.MISSING_METHOD,methodName:i}));return ha(r)}class tL{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=It(t,"nodeLocationTracking")?t.nodeLocationTracking:_i.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Ve,this.cstFinallyStateUpdate=Ve,this.cstPostTerminal=Ve,this.cstPostNonTerminal=Ve,this.cstPostRule=Ve;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=t_,this.setNodeLocationFromNode=t_,this.cstPostRule=Ve,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Ve,this.setNodeLocationFromNode=Ve,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Qy,this.setNodeLocationFromNode=Qy,this.cstPostRule=Ve,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Ve,this.setNodeLocationFromNode=Ve,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Ve,this.setNodeLocationFromNode=Ve,this.cstPostRule=Ve,this.setInitialNodeLocation=Ve;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];HC(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];YC(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(yi(this.baseCstVisitorConstructor)){const t=qC(this.className,or(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(yi(this.baseCstVisitorWithDefaultsConstructor)){const t=JC(this.className,or(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class eL{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):yl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?yl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class nL{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=_l){if(En(this.definedRulesNames,t)){const o={message:ms.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:wn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=_l){const i=TC(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(hl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return iO(je(this.gastProductionsCache))}}class rL{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=al,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},It(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(ee(t)){if(ge(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(ee(t))this.tokensMap=Nn(t,(s,o)=>(s[o.name]=o,s),{});else if(It(t,"modes")&&xr(Gn(je(t.modes)),ZO)){const s=Gn(je(t.modes)),o=Vc(s);this.tokensMap=Nn(o,(a,c)=>(a[c.name]=c,a),{})}else if(sr(t))this.tokensMap=ln(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=ps;const r=It(t,"modes")?Gn(je(t.modes)):je(t),i=xr(r,s=>ge(s.categoryMatches));this.tokenMatcher=i?al:ya,_a(je(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=It(r,"resyncEnabled")?r.resyncEnabled:_l.resyncEnabled,s=It(r,"recoveryValueFunc")?r.recoveryValueFunc:_l.recoveryValueFunc,o=this.ruleShortNameIdx<<jC+ji;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(hl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Zy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ef,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Le.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Ef,t,lC)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(dl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Uy],a,dl,t,Uy)}else throw this.raiseEarlyExitException(t,Le.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(bf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,bf,t,cC,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(wf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,My],a,wf,t,My)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,dl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Jy,n),i=ee(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new FC(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw hl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Xy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===qy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=ln(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),ps)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class iL{initErrorHandler(t){this._errors=[],this.errorMessageProvider=It(t,"errorMessageProvider")?t.errorMessageProvider:_i.errorMessageProvider}SAVE_ERROR(t){if(hl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:ln(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return ln(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=mf(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new PC(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=pf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new UC(c,this.LA(1),a))}}class sL{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(yi(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Fy([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=kr(t.ruleStack),i=this.getGAstProductions()[n];return new aC(i,t).startWalking()}}const ml={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ml);const n_=!0,r_=Math.pow(2,ji)-1,i_=Hn({name:"RECORDING_PHASE_TOKEN",pattern:qe.NA});_a([i_]);const s_=cl(i_,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(s_);const oL={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class aL{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return yl}topLevelRuleRecord(t,n){try{const r=new co({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return wa.call(this,Ln,t,n)}atLeastOneInternalRecord(t,n){wa.call(this,Yr,n,t)}atLeastOneSepFirstInternalRecord(t,n){wa.call(this,Vr,n,t,n_)}manyInternalRecord(t,n){wa.call(this,Xe,n,t)}manySepFirstInternalRecord(t,n){wa.call(this,Ar,n,t,n_)}orInternalRecord(t,n){return cL.call(this,t,n)}subruleInternalRecord(t,n,r){if(gl(n),!t||It(t,"ruleName")===!1){const a=new Error(`<SUBRULE${o_(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=oo(this.recordingProdStack),s=t.ruleName,o=new On({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?oL:ml}consumeInternalRecord(t,n,r){if(gl(n),!xy(t)){const o=new Error(`<CONSUME${o_(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=oo(this.recordingProdStack),s=new Ie({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),s_}}function wa(e,t,n,r=!1){gl(n);const i=oo(this.recordingProdStack),s=di(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),It(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),ml}function cL(e,t){gl(t);const n=oo(this.recordingProdStack),r=ee(e)===!1,i=r===!1?e:e.DEF,s=new vr({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});It(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=rf(i,a=>di(a.GATE));return s.hasPredicates=o,n.definition.push(s),Nt(i,a=>{const c=new Cn({definition:[]});s.definition.push(c),It(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:It(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),ml}function o_(e){return e===0?"":`${e}`}function gl(e){if(e<0||e>r_){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${r_+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class lL{initPerformanceTracer(t){if(It(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=_i.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=sy(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function uL(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const yl=cl(ps,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(yl);const _i=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Ly,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),_l=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var wn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(wn||(wn={}));let Tf=class _1{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{oy(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Nt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=LC({rules:je(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ge(r)&&this.skipValidations===!1){const i=MC({rules:je(this.gastProductionsCache),tokenTypes:je(this.tokensMap),errMsgProvider:ms,grammarName:n}),s=_C({lookaheadStrategy:this.lookaheadStrategy,rules:je(this.gastProductionsCache),tokenTypes:je(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ge(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=hO(je(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:je(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(je(this.gastProductionsCache))})),!_1.DEFER_DEFINITION_ERRORS_HANDLING&&!ge(this.definitionErrors))throw t=xt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),It(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=It(n,"skipValidations")?n.skipValidations:_i.skipValidations}};Tf.DEFER_DEFINITION_ERRORS_HANDLING=!1,uL(Tf,[DC,WC,tL,eL,rL,nL,iL,sL,aL,lL]);class hL extends Tf{constructor(t,n=_i){const r=ln(n);r.outputCst=!0,super(t,r)}}function fL(e){const t=new dL,n=je(e);return xt(n,r=>t.visitRule(r))}class dL extends fs{visitRule(t){const n=this.visitEach(t.definition),r=ey(n,s=>s.propertyName),i=xt(r,(s,o)=>{const a=!rf(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=xt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:bl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:bl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:bl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:bl(t)}]}visitEachAndOverrideWith(t,n){return xt(this.visitEach(t),r=>Sn({},r,n))}visitEach(t){return Gn(xt(t,n=>this.visit(n)))}}function bl(e){return e instanceof On?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function pL(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Gn(xt(e,r=>mL(r)))),t.includeVisitorInterface&&(n=n.concat(bL(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function mL(e){const t=gL(e),n=yL(e);return[t,n]}function gL(e){const t=c_(e.name),n=Af(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function yL(e){return`export type ${Af(e.name)} = {
  ${xt(e.properties,n=>_L(n)).join(`
  `)}
};`}function _L(e){const t=wL(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function bL(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${xt(t,n=>EL(n)).join(`
  `)}
}`}function EL(e){const t=Af(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function wL(e){if(ee(e)){const t=Vc(xt(e,r=>a_(r)));return"("+Nn(t,(r,i)=>r+" | "+i)+")"}else return a_(e)}function a_(e){return e.kind==="token"?"IToken":c_(e.name)}function c_(e){return kg(e)+"CstNode"}function Af(e){return kg(e)+"CstChildren"}const xL={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function kL(e,t){const n=Object.assign(Object.assign({},xL),t),r=fL(e);return pL(r,n)}const qr=!!JSON.parse("false"),TL=!!JSON.parse("false");JSON.parse("false");const AL=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const bi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Rc*bi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Sc*bi.DRAW_CHAR_SCALE}},El=Xp(32,126).map(e=>String.fromCharCode(e));function Yt(e){return Hn({...e,name:`token_${e.name}`})}function zi(e,t=!1){return Yt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:hn,group:qe.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:hn})}const xa=Yt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),vL=Yt({name:"whitespace",pattern:/ +/,group:qe.SKIPPED}),RL=Yt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:qe.SKIPPED}),vf=Yt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),uo=Yt({name:"command",pattern:/#/,start_chars_hint:["#"]});let l_=!1;function SL(e,t,n){if(!l_)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==xa)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const Rf=Yt({name:"text",pattern:SL,line_breaks:!1,start_chars_hint:El.filter(e=>"@#/?':!".includes(e)===!1)}),u_=Yt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),h_=Yt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),f_=Yt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),d_=Yt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),hn=Yt({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:El}),p_=Yt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),m_=Yt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),g_=Yt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:hn}),y_=Yt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:hn}),__=Yt({name:"islessthan",pattern:/<|below/,longer_alt:hn}),b_=Yt({name:"isgreaterthan",pattern:/>|above/,longer_alt:hn}),E_=Yt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:hn}),w_=Yt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:hn}),Sf=Yt({name:"or",pattern:/or/i,longer_alt:hn}),If=Yt({name:"not",pattern:/not/i,longer_alt:hn}),Nf=Yt({name:"and",pattern:/and/i,longer_alt:hn}),Of=Yt({name:"plus",pattern:/\+/}),Cf=Yt({name:"minus",pattern:/-/}),x_=Yt({name:"power",pattern:/\*\*/}),k_=Yt({name:"multiply",pattern:/\*/}),Lf=Yt({name:"divide",pattern:/\//}),T_=Yt({name:"moddivide",pattern:/%/}),A_=Yt({name:"floordivide",pattern:/%%/}),v_=Yt({name:"query",pattern:/\?/}),R_=Yt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),S_=Yt({name:"rparen",pattern:/\)/,pop_mode:!0}),I_=Yt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:El,longer_alt:hn}),N_=Yt({name:"command_toast",pattern:/toast .*/,start_chars_hint:El,longer_alt:hn}),Mf=Yt({name:"if",pattern:/if|try|take|give/,longer_alt:hn}),wl=zi("do"),Uf=zi("done"),Ff=zi("else"),O_=zi("while"),C_=zi("repeat"),L_=zi("waitfor"),M_=Yt({name:"foreach",pattern:/foreach|for/,longer_alt:hn}),U_=zi("break"),F_=zi("continue");function P_(e){return[...e,m_,g_,y_,E_,__,w_,b_,Sf,If,Nf,Of,Cf,x_,k_,Lf,A_,T_,v_,R_,S_,p_,hn]}const B_=P_([Rf,vf,I_,N_,uo,u_,h_,f_,d_,xa,vL,U_,F_,Uf,wl,Ff,M_,Mf,C_,L_,O_]),IL=new qe({defaultMode:"use_newlines",modes:{use_newlines:B_,ignore_newlines:P_([RL])}},{skipValidations:!qr,ensureOptimizations:qr});function Pf(e){l_=!0;const t=IL.tokenize(e||` 
`),[n]=(ae(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(cl(xa,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function NL(e,t,n=!0){if(n){const[r,...i]=t;switch(Ot(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:i};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Ot(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function Yn(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var Bf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Bf||{});function D_(e){return to(e,Bf,{bits:t=>Array.from(t)})}function $_(e){return Qo(e,Bf,{bits:t=>new Uint8Array(t)})}function OL(e,t){return{id:Ue(),code:e,...t}}var Df=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Df||{});function CL(e){return to(e,Df,{board:MT,object:xc,terrain:xc,charset:D_,palette:D_,stats:ke})}function LL(e){return Qo(e,Df,{board:UT,object:kc,terrain:kc,charset:$_,palette:$_})}function ka(e){const t={...gs(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function ML(e){return x(e)?(e.stats=void 0,gs(e)):{}}function j_(e){const t=Pf(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===vf){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=NL(kt(c)?c:"",l,r),h=Ot(u.values.join(" "));switch(r=!1,u.type){case wt.LOADER:n.type=yt.LOADER,n.name=h;break;case wt.BOARD:n.type=yt.BOARD,n.name=h;break;case wt.OBJECT:n.type=yt.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=yt.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=yt.CHARSET,n.name=h;break;case wt.PALETTE:n.type=yt.PALETTE,n.name=h;break;case wt.CONST:{const[d,f]=u.values;if(kt(d)){const p=Ot(d);if(kt(f)){const m=parseFloat(f);n[p]=St(m)?m:f}else St(f)?n[p]=f:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[d,...f]=u.values;if(kt(d)){const p=Ot(d);n[p]=[Yn(u.type),...f]}break}}}}return n}function gs(e){var t;return x(e)?(x((t=e.stats)==null?void 0:t.type)||(e.stats=j_(e.code),x(e.stats.type)||(e.stats.type=yt.OBJECT)),e.stats):{}}function z_(e){switch(e){default:case yt.ERROR:return"error";case yt.LOADER:return Yn(wt.LOADER);case yt.BOARD:return Yn(wt.BOARD);case yt.OBJECT:return Yn(wt.OBJECT);case yt.TERRAIN:return Yn(wt.TERRAIN);case yt.CHARSET:return Yn(wt.CHARSET);case yt.PALETTE:return Yn(wt.PALETTE)}}function Ei(e){return gs(e).type??yt.ERROR}function wi(e){return z_(Ei(e))}function Be(e){return gs(e).name??""}function W_(e,t){return gs(e)[t]}const xl=new lh;function $f(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ae(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Gt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Gt.ISSWIM;break;case"issolid":t.collision=Gt.ISSOLID;break;case"isbullet":t.collision=Gt.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function Ne(e){var t;if(x(e))switch(Ei(e)){default:return;case yt.ERROR:return e.code??"";case yt.LOADER:return e.code??"";case yt.BOARD:{x(e.board)||(e.board=Ah()),e.board.id=e.id;const n=ka(e);return e.board.isdark=n.isdark??e.board.isdark?1:0,e.board.startx=n.startx??e.board.startx,e.board.starty=n.starty??e.board.starty,e.board.over=n.over??e.board.over,e.board.under=n.under??e.board.under,e.board.camera=n.camera??e.board.camera,e.board.graphics=n.graphics??e.board.graphics,e.board.facing=n.facing??e.board.facing,e.board.exitnorth=n.exitnorth??e.board.exitnorth,e.board.exitsouth=n.exitsouth??e.board.exitsouth,e.board.exitwest=n.exitwest??e.board.exitwest,e.board.exiteast=n.exiteast??e.board.exiteast,e.board.timelimit=n.timelimit??e.board.timelimit,e.board.restartonzap=n.restartonzap??e.board.restartonzap,e.board.maxplayershots=n.maxplayershots??e.board.maxplayershots,e.board}case yt.OBJECT:return x(e.object)||(e.object=Cm()),e.object.name=Be(e),e.object.category=Jn.ISOBJECT,$f(ka(e),e.object),e.object;case yt.TERRAIN:return x(e.terrain)||(e.terrain=Cm()),e.terrain.name=Be(e),e.terrain.category=Jn.ISTERRAIN,$f(ka(e),e.terrain),e.terrain;case yt.PALETTE:{if(x(e.palette)||(e.palette=Dm(tA)),x((t=e.palette)==null?void 0:t.bits)){const n=ka(e),r=Nr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&kt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){xl.set(o);const c=a*vc,l=xl.r*63,u=xl.g*63,h=xl.b*63;e.palette.bits[c+0]=cn(l,0,63),e.palette.bits[c+1]=cn(u,0,63),e.palette.bits[c+2]=cn(h,0,63)}}}}return e.palette}case yt.CHARSET:return x(e.charset)||(e.charset=$m(QT)),e.charset}}function K_(e){return{id:Ue(),name:L1(),timestamp:0,activelist:[],pages:e,flags:{}}}var jf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(jf||{});function UL(e){return to(e,jf,{pages:t=>t.map(CL),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function FL(e){return Qo(e,jf,{pages:t=>t.map(LL)})}function G_(e){x(e)&&(e.token=`${M1()}${er(1111,9999)}`)}function xi(e,t){if(!x(e))return;const n=Ot(t);return e.pages.find(i=>i.id===t||n===Be(i))}function Je(e,t,n){if(!x(e))return;const r=Ot(n);return e.pages.find(s=>Ei(s)===t&&(s.id===n||r===Be(s)))}function zf(e,t,n){let r=Je(e,t,n);if(!x(r)){const i=z_(t);r=OL(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),Y_(e,r)}return r}function ys(e,t){return x(e)?e.pages.filter(n=>Ei(n)===t):[]}function Mn(e,t,n){if(!x(e))return[];const r=Ot(n);return e.pages.filter(s=>Ei(s)===t).filter(s=>{const o=gs(s),a=Ot(Be(s));return s.id===n||r===a||x(o[n])})}function kl(e){return x(e)?$n(e.pages).sort((n,r)=>{const i=Ei(n),s=Ei(r);return i===s?Be(n).localeCompare(Be(r)):s-i}):[]}function H_(e,t){if(x(t)){const n=Je(e,yt.TERRAIN,t.kind??"");if(x(n))return n;const r=Je(e,yt.OBJECT,t.kind??"");if(x(r))return r}}function Y_(e,t){if(!x(e)||!x(t))return!1;const n=xi(e,t.id);return x(n)?!1:(e.pages.push(t),G_(e),!0)}function V_(e,t){const n=xi(e,t);if(x(e)&&x(n)){const r=Ot(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Be(i)),G_(e),n}}function Rr(e,t){if(x(t)&&x(t.kind))return x(t.kinddata)||(t.kinddata=x(t.id)?ho(e,t.kind):Tl(e,t.kind)),t.kinddata}function Un(e,t,n){const r=Rr(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function ki(e,t){return ue(Un(e,t,"group"))}function X_(e,t,n,r,i){const s=Rr(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function ho(e,t){const n=t??"",r=Je(e,yt.OBJECT,n);if(x(r)){const i=Ne(r);return{...$n(i),name:n,code:r.code}}}function Tl(e,t){const n=t??"",r=Je(e,yt.TERRAIN,n);if(x(r)){const i=Ne(r);return{...$n(i),name:n,code:r.code}}}function Wi(e,t){const n=xi(e,t);return Ne(n)}function Ti(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function q_(e,t){e&&delete e.flags[t]}function J_(e,t,n){const r=Ti(e,t);return r==null?void 0:r[n]}function PL(e,t,n,r){const i=Ti(e,t);return i&&(i[n]=r),r}function _s(e,t){const n=J_(e,t,"board");return Wi(e,kt(n)?n:"")}function BL(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Al(e,t,n){if(!x(e))return;PL(e,t,"board",n);const r=Wi(e,n);x(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function fo(e,t,n,r){if(!x(e))return;const i=_s(e,t);if(!x(i))return;const s=_n(i,t);if(!pn(s)||!(s!=null&&s.id))return;const o=Wi(e,n);if(!x(o)||(ze(e,o),Gf(e,o,Gt.ISWALK,r)))return;delete i.objects[s.id];const a=Er(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Er(o,s);o.lookup&&(o.lookup[c]=s.id),Al(e,t,o.id)}function DL(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=J_(e,r,"board");return kt(i)?i:""});return nT(n)}function Wf(e){const t=DL(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=Wi(e,t[i]);if(x(s)&&!n.has(s.id)){if(kt(s.over))if(kt(s.overboard)){const o=Wi(e,s.overboard);x(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=Mn(e,yt.BOARD,s.over);if(o.length){const a=xe(o),c=Ne(a);x(c)&&(s.overboard=c.id)}}else kt(s.overboard)&&delete s.overboard;if(r.push(s),kt(s.under))if(kt(s.underboard)){const o=Wi(e,s.underboard);x(o)||delete s.underboard}else{const o=Mn(e,yt.BOARD,s.under);if(o.length){const a=xe(o),c=Ne(a);x(c)&&(s.underboard=c.id)}}else kt(s.underboard)&&delete s.underboard}}return r}function $L(e,t,n,r,i){if(!x(t))return;x(t.distmaps)||(t.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let o=t.distmaps[s];if(!x(o)){o=new Array(Th).fill(-2);const a=[{...i}];let c=0;for(;a.length;){const l=a.shift();if(x(l)&&Ac(l)){const u=Vs(l,Rt);if(o[u]===-2){const h=eo(t,l.x,l.y);no(n,Un(e,h,"collision")??Gt.ISWALK)||(o[u]=c,a.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}t.distmaps[s]=o}return o}function Z_(e,t){return Ac(e)?t[Vs(e,Rt)]:-1}function Q_(e,t,n,r,i,s){if(!x(e)||!x(t))return;const o=$L(e,t,n,r,i);if(!x(o))return;const a=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<a.length;++u){const h=Z_(a[u],o);h>=0&&h>l&&(l=h,c=a[u])}}else{let l=1e5;for(let u=0;u<a.length;++u){const h=Z_(a[u],o);h>=0&&h<l&&(l=h,c=a[u])}}return c}function ze(e,t){var a;if(!x(e)||!x(t)||x(t.lookup)&&x(t.named))return;const n=new Array(Rt*Zt).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const l=i[c];if(x(l.x)&&x(l.y)&&x(l.id)&&!x(l.removed)){l.category=Jn.ISOBJECT,n[l.x+l.y*Rt]=l.id;const u=Ot(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const l=t.terrain[c];if(x(l)){l.x=s,l.y=o,l.category=Jn.ISTERRAIN;const u=Pi(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=Rt&&(s=0,++o)}t.lookup=n,t.named=r}function vl(e,t){x(t)&&(delete t.named,delete t.lookup,ze(e,t))}function tb(e,t,n,r){var s;if(!x(e)||!x(t)||!x(t.named)||!x(n))return;const i=Ot(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function jL(e,t,n){if(!(!x(e)||!x(t)||!x(t.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*Rt]=n.id}}function zL(e,t,n){var r;if(x(e)&&x(t)&&x(n==null?void 0:n.x)&&x(n.y)){const i=Pi(n),s=Er(t,n);x((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function Kf(e,t,n){var r;if(x(e)&&x(t)&&x(n==null?void 0:n.id)){if(x(t.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*Rt;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Pi(n);x((r=t.named)==null?void 0:r[i])&&x(n.id)&&t.named[i].delete(n.id)}}function eb(e,t,n,r,i,s){if(!x(e)||!x(t)||!x(n))return{x:0,y:0};const o={x:n.x??0,y:n.y??0},a={x:n.lx??o.x,y:n.ly??o.y},c=hi(a,o),l=Rt-1,u=Zt-1;for(let h=0;h<i.length;++h){const d=rT(i[h]);switch(d){case mt.IDLE:break;case mt.NORTH:case mt.SOUTH:case mt.WEST:case mt.EAST:$e(o,d);break;case mt.BY:{const[f,p]=i.slice(h+1);St(f)&&St(p)&&(o.x=cn(o.x+f,0,l),o.y=cn(o.y+p,0,u)),h+=2;break}case mt.TO:case mt.AT:{const[f,p]=i.slice(h+1);St(f)&&St(p)&&(o.x=cn(f,0,l),o.y=cn(p,0,u)),h+=2;break}case mt.FLOW:$e(o,c);break;case mt.SEEK:{const f=DT(t,n,r);Js(f)&&$e(o,hi(s,f));break}case mt.RNDNS:$e(o,xe(mt.NORTH,mt.SOUTH));break;case mt.RNDNE:$e(o,xe(mt.NORTH,mt.EAST));break;case mt.RND:$e(o,xe(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));break;case mt.CW:case mt.CCW:case mt.OPP:case mt.RNDP:{const f=eb(e,t,n,r,i.slice(h+1),s);switch(o.x=s.x,o.y=s.y,d){case mt.CW:switch(hi(s,f)){case mt.NORTH:$e(o,mt.EAST);break;case mt.SOUTH:$e(o,mt.WEST);break;case mt.EAST:$e(o,mt.SOUTH);break;case mt.WEST:$e(o,mt.NORTH);break}break;case mt.CCW:switch(hi(s,f)){case mt.NORTH:$e(o,mt.WEST);break;case mt.SOUTH:$e(o,mt.EAST);break;case mt.EAST:$e(o,mt.NORTH);break;case mt.WEST:$e(o,mt.SOUTH);break}break;case mt.OPP:switch(hi(s,f)){case mt.NORTH:$e(o,mt.SOUTH);break;case mt.SOUTH:$e(o,mt.NORTH);break;case mt.EAST:$e(o,mt.WEST);break;case mt.WEST:$e(o,mt.EAST);break}break;case mt.RNDP:switch(hi(s,f)){case mt.NORTH:case mt.SOUTH:o.x+=xe(-1,1);break;case mt.WEST:case mt.EAST:o.y+=xe(-1,1);break}break}break}case mt.FLEE:case mt.AWAY:{const[f,p]=i.slice(h+1);if(St(f)&&St(p)){const m={x:cn(f,0,l),y:cn(p,0,u)},w=Un(e,n,"collision"),b=Q_(e,t,w,o,m,!0);x(b)&&(o.x=b.x,o.y=b.y)}h+=2;break}case mt.FIND:case mt.TOWARD:{const[f,p]=i.slice(h+1);if(St(f)&&St(p)){const m={x:cn(f,0,l),y:cn(p,0,u)};if(er(1,100)<5)$e(o,xe(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));else{const w=Un(e,n,"collision"),b=Q_(e,t,w,o,m,!1);if(x(b))if(b.x!==f&&b.y!==p&&BT(t,b))switch(hi(s,b)){case mt.EAST:case mt.WEST:o.y+=xe(-1,1);break;case mt.NORTH:case mt.SOUTH:o.x+=xe(-1,1);break}else o.x=b.x,o.y=b.y}}h+=2;break}case mt.PLAYER:{const f=ta(t,s,r);Js(f)&&(o.x=f.x,o.y=f.y);break}}}return o}function WL(e,t,n,r){if(x(e)&&x(t)&&x(n)){const[i,s]=n,o=ho(e,i);if(x(o)&&x(o.name)){const a=Sh(t,r,i);return Tc(a,s),a}}}function bs(e,t,n,r,i){if(x(e)&&x(t)&&x(n)){const[s,o]=n,a=Tl(e,s);if(x(a)){const l=PT(t,r,s);if(x(l)){Tc(l,o);const u=Vs(r,Rt);return Rr(e,l),tb(e,t,l,u),l}}const c=ho(e,s);if(x(c)&&x(c.name)){const l=Sh(t,r,s,i);if(x(l))return Tc(l,o),jL(e,t,l),Rr(e,l),tb(e,t,l),l}}}function Vn(e,t,n,r){return!x(n)||Pi(n)==="player"?!1:(n.id?(n.removed=r,Kf(e,t,n)):(sn(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),zL(e,t,n)),!0)}function Gf(e,t,n,r){if(!x(e)||!x(t)||!x(t.lookup)||r.x<0||r.x>=Rt||r.y<0||r.y>=Zt)return!0;const i=r.x+r.y*Rt,s=_n(t,t.lookup[i]??"404");if(x(s))return!0;const o=t.terrain[i];if(x(o)){const a=Rr(e,o),c=o.collision??(a==null?void 0:a.collision);return no(n,c)}return!1}function KL(e,t,n,r){const i=_n(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=Un(e,i,"collision");return Gf(e,t,a,r)}function Hf(e,t,n,r){var d;const i=_n(t,(n==null?void 0:n.id)??"");if(!x(e)||!x(t)||!x(i)||!x(i.x)||!x(i.y)||!x(t.lookup)||!x(n)||r.x<0||r.x>=Rt||r.y<0||r.y>=Zt)return{name:"edge",kind:"edge",collision:Gt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Er(t,i),o=Er(t,r),a=Un(e,i,"collision")??Gt.ISWALK,c=dr(i==null?void 0:i.id),l=_n(t,t.lookup[o]??""),u=dr((l==null?void 0:l.id)??"");if(x(l)&&(!c||!u)&&ki(e,n)!==ki(e,l)){if(!!Un(e,l,"pushable")){const p={x:r.x-(n.x??0),y:r.y-(n.y??0)};Hf(e,t,l,p)}return{...l}}const h=t.terrain[o];if(x(h)){const f=h.collision??((d=h==null?void 0:h.kinddata)==null?void 0:d.collision)??Gt.ISWALK;if(no(a,f))return{...h,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function GL(e,t,n){const r=[];if(!x(e)||!x(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>Ba*5&&(r.push(o.id),Lm(t,o.id))}return r}function HL(e,t,n){const r=[];if(!x(e)||!x(t))return r;t.lookup=void 0,ze(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!x(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Rr(e,a),l=`${(c==null?void 0:c.code)??""}
${a.code??""}`;l&&r.push({id:a.id,type:yt.OBJECT,code:l,object:a,terrain:void 0})}const s=GL(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:yt.ERROR,code:"",object:void 0,terrain:void 0});return r}function YL(e,t,n){const r=[],i=[];if(!x(e)||!x(t))return{objectelements:r,terrainelements:i};const s=Object.values(t.objects);for(let o=0;o<s.length;++o){const a=s[o];ki(e,a)===n&&r.push(a)}for(let o=0;o<Th;++o){const a=t.terrain[o];x(a)&&ki(e,a)===n&&i.push(a)}return{objectelements:r,terrainelements:i}}var nb={exports:{}},Yf={exports:{}},rb;function VL(){return rb||(rb=1,function(e,t){(function(n,r){e.exports=r()})(An,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(m){if(m)for(var w=0;w<u.length;w++)m[u[w]]!==void 0&&this["set"+r(u[w])](m[u[w]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",w=this.getLineNumber()||"",b=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+w+":"+b+")":"[eval]:"+w+":"+b:T?T+" ("+m+":"+w+":"+b+")":m+":"+w+":"+b}},h.fromString=function(w){var b=w.indexOf("("),T=w.lastIndexOf(")"),A=w.substring(0,b),I=w.substring(b+1,T).split(","),U=w.substring(T+1);if(U.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),O=R[1],P=R[2],N=R[3];return new h({functionName:A,args:I||void 0,fileName:O,lineNumber:P||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(m){return function(w){this[m]=!!w}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=i(o[f]),h.prototype["set"+r(o[f])]=function(m){return function(w){if(!n(w))throw new TypeError(m+" must be a Number");this[m]=Number(w)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(w){this[m]=String(w)}}(a[p]);return h})}(Yf)),Yf.exports}(function(e,t){(function(n,r){e.exports=r(VL())})(An,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:w,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(nb);var XL=nb.exports,qL=vs(XL);function Jr(e){const t={},n={tick(){},everytick(){},listcommands(){return Nr(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function ib(e,t,n){var i;const[r]=rt(t,0,[Y.MAYBE_NAME]);IE(H,e,((i=y.board)==null?void 0:i.id)??"",r??"",n)}function ur(e,t,n,r){const[i,s]=rt(r,0,[Y.NUMBER_OR_STRING,Y.MAYBE_NUMBER_OR_STRING]);jd(H,e,t,n,i,s)}const JL=["echo","reverb","phaser","distortion","vibrato","fc"];function sb(e,t,n){const[r,i]=rt(n,0,[Y.NUMBER_OR_STRING]);if(St(r))ou(H,e,t,"volume",r);else if(JL.includes(Ot(r))){const[s,o]=rt(n,i,[Y.NUMBER_OR_STRING,Y.MAYBE_NUMBER_OR_STRING]);jd(H,e,t,r,s,o)}else{const[s]=rt(n,i,[Y.MAYBE_NUMBER_OR_STRING]);if(St(s)){const o=n.length-i,a=new Array(o).fill(Y.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;ou(H,e,t,r,l)}else{const[o]=rt(n,i,[Y.MAYBE_NUMBER_OR_STRING]);ou(H,e,t,r,o)}}}const Vf=Jr().command("talk",(e,t)=>{const[n]=rt(t,0,[Y.ANY]);switch(Ot(n)){default:uE(H,y.elementfocus);break;case"stop":hE(H,y.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=rt(t,0,[Y.ANY]);switch(Ot(n)){default:fE(H,y.elementfocus);break;case"stop":dE(H,y.elementfocus);break}return 0}).command("tts",(e,t)=>{const[n,r]=rt(t,0,[Y.STRING]),i=t.slice(r).map(ue).join("");return RE(H,y.elementfocus,n,i),0}).command("tta",(e,t)=>{const n=t.map(ue).join("");return SE(H,y.elementfocus,n),0}).command("bpm",(e,t)=>{const[n]=rt(t,0,[Y.NUMBER]);return OE(H,y.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=rt(t,0,[Y.NUMBER]);return CE(H,y.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=rt(t,0,[Y.NUMBER]);return LE(H,y.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=rt(t,0,[Y.NUMBER]);return ME(H,y.elementfocus,n),0}).command("play",(e,t)=>(ib(y.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(ib(y.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)sb(y.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)ur(y.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)ur(y.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)ur(y.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)ur(y.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)ur(y.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)ur(y.elementfocus,n,"vibrato",t);return 0});for(let e=0;e<8;++e)Vf.command(`synth${e+1}`,(t,n)=>(sb(y.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Vf.command(`echo${t}`,(n,r)=>(ur(y.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(ur(y.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(ur(y.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(ur(y.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(ur(y.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(ur(y.elementfocus,e,"vibrato",r),0))}const ZL=Xp(32,126).map(e=>String.fromCharCode(e)),QL=Hn({name:"Whitespace",pattern:/ +/}),t6=Hn({name:"WhitespaceSkipped",pattern:/ +/,group:qe.SKIPPED}),Xf=Hn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),ob=Hn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:ZL}),qf=Hn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Jf=Hn({name:"EscapedDollar",pattern:"$$"}),Zf=Hn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Qf=Hn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),ab=Hn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function e6(e,t=""){return Hn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const cb=Object.keys(Xo).map(e=>e6(`\\$(${e})`,e)),n6=[QL,Xf,...cb,qf,ob,Qf,Jf,ab,Zf],r6=new qe(n6,{skipValidations:!qr,ensureOptimizations:qr}),i6=new qe([t6,Xf,...cb,qf,ob,Qf,Jf,ab,Zf],{skipValidations:!qr,ensureOptimizations:qr});function td(e,t=!1){return t?i6.tokenize(e):r6.tokenize(e)}function ed(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function lb(e){e.active={...e.reset}}function ub(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Jf:s("$");break;case Qf:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case qf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Xf:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=Xo[l],h=sT(Wt[u]),d=oT(Wt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):x(h)?t.active.color=h:x(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(x(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){lb(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;o6(u,u+l.length,t.active.color,t.active.bg,t),s6(u,l,t)}}}function hb(e,t,n){const r=td(e);r.tokens&&(ub(r.tokens,t),n&&lb(t),t.changed())}function fb(e,t,n){const r=td(e);if(!r.tokens)return;const i=ed(t,n,Wt.WHITE,Wt.BLACK);return i.measureonly=!0,ub(r.tokens,i),i.x>0&&++i.y,i}function s6(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function o6(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function db(e,t,n){if(!Js(y.element))return 0;const[r,i]=rt(t,0,[Y.DIR,Y.MAYBE_KIND]),s=i??["bullet"],o=WL(y.book,y.board,s,{x:y.element.x,y:y.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=y.elementid,o.collision=Gt.ISBULLET,o.destructible=1,o.stepx=r.x-y.element.x,o.stepy=r.y-y.element.y,o.bg=Wt.ONCLEAR;const a=Rr(y.book,o),c=o.code??(a==null?void 0:a.code)??"";r1(y.book,y.board,o,c,1)}return e.yield(),0}function Rl(e,t,n,r){var h,d;if(!Js(y.element)||!x(y.book)||!x(y.board)||!x(y.element))return 0;ze(y.book,y.board);const[i,s]=rt(t,0,[Y.DIR,Y.KIND]),o=Te(y.board,i);if((o==null?void 0:o.category)===Jn.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((h=y.element)==null?void 0:h.x)??0,y:((d=y.element)==null?void 0:d.y)??0},p=$e(i,hi(f,i));Hf(y.book,y.board,o,p)}const[a]=s,c=ho(y.book,a)??Tl(y.book,a),l=(c==null?void 0:c.collision)??Gt.ISWALK;if(!Gf(y.book,y.board,l,i)){const f=bs(y.book,y.board,s,i,n);x(f)&&x(r)&&(f.arg=r)}return 0}const a6=Jr().command("board",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;const[n,r]=rt(t,0,[Y.NAME]),[i,s]=rt(t,r,[Y.MAYBE_NUMBER,Y.MAYBE_NUMBER]),o=Mn(y.book,yt.BOARD,n);if(o.length){const a=xe(...o);x(a)&&fo(y.book,y.elementfocus,a.id,{x:i??Math.round(Rt*.5),y:s??Math.round(Zt*.5)})}return 0}).command("edge",(e,t)=>{var s,o;if(!x(y.book)||!x(y.board)||!x(y.element))return 0;const[n,r]=rt(t,0,[Y.DIR,Y.NAME]),i=Mn(y.book,yt.BOARD,r);if(i.length){const a={x:((s=y.element)==null?void 0:s.x)??0,y:((o=y.element)==null?void 0:o.y)??0},c=hi(a,n),l=xe(...i);switch(c){case mt.NORTH:y.board.exitnorth=l.id;break;case mt.SOUTH:y.board.exitsouth=l.id;break;case mt.WEST:y.board.exitwest=l.id;break;case mt.EAST:y.board.exiteast=l.id;break}}return 0}).command("shove",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;ze(y.book,y.board);const[n,r]=rt(t,0,[Y.DIR,Y.DIR]),i=Te(y.board,n);return pn(i)&&To(y.book,y.board,i,r),0}).command("duplicate",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;ze(y.book,y.board);const[n,r]=rt(t,0,[Y.DIR,Y.DIR]),i=Te(y.board,n);return pn(i),0}).command("write",(e,t)=>{var l;if(!x(y.book)||!x(y.board))return 0;ze(y.book,y.board);const[n,r,i]=rt(t,0,[Y.DIR,Y.COLOR,Y.STRING]),{color:s,bg:o}=rm(r),a=((l=fb(i,256,1))==null?void 0:l.measuredwidth)??1,c=ed(256,1,s??Wt.WHITE,o??Wt.BLACK);hb(i,c,!1);for(let u=0;u<a;++u)sn(y.board,{x:n.x+u,y:n.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;ze(y.book,y.board);const[n,r]=rt(t,0,[Y.KIND,Y.KIND]);(mh(n)??"")==="empty"&&$T(y.board).forEach(c=>{bs(y.book,y.board,r,c)});const s=mh(r),o=sm(r),a=om(r);return Mm(y.board,n).forEach(c=>{if(Pi(c)===s)x(o)&&(c.color=o),x(a)&&(c.bg=a);else if(Vn(y.book,y.board,c,y.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};bs(y.book,y.board,r,l)}}),0}).command("put",(e,t)=>Rl(e,t)).command("putwith",(e,t)=>{const[n,r]=rt(t,0,[Y.ANY]);return Rl(e,t.slice(r),void 0,n)}).command("oneof",(e,t)=>{const[n,r]=rt(t,0,[Y.ANY]);return x(y.board)&&_n(y.board,n)?0:Rl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=rt(t,0,[Y.ANY,Y.ANY]);return x(y.board)&&_n(y.board,r)?0:Rl(e,t.slice(i),r,n)}).command("shoot",db).command("shootwith",(e,t)=>{const[n,r]=rt(t,0,[Y.ANY]);return db(e,t.slice(r),n)}),Ki="$dkpurple",c6="$196",l6="$205";function jt(e,t,n){ri(e,t,n)}function u6(e,t,n){const r=c6.repeat(n);jt(e,t,`${Ki}${r}`)}function nd(e,t,n){const r=l6.repeat(n);jt(e,t,`${Ki}${r}`)}function Es(e,t,n){jt(e,t,`${Ki} ${" ".repeat(n.length)} `),u6(e,t,n.length+2),jt(e,t,`${Ki} $white${n} `),nd(e,t,n.length+2)}function Ai(e,t,n){jt(e,t,`${Ki} ${" ".repeat(n.length)} `),jt(e,t,`${Ki} $gray${n} `),nd(e,t,n.length+2)}function ne(e,t,n,r){jt(e,t,`${Ki} $white${n} $blue${r}`)}function We(e,t,n){jt(e,t,`${Ki}$blue${n}`)}function pb(e){const[t,n]=e.split(":"),r=x(n);return[r?t:"self",r?n:e]}const h6=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function po(){Kd(H,Sr())}const f6=Jr().command("send",(e,t)=>{const[n,r]=rt(t,0,[Y.NAME,Y.ANY]);switch(Ot(n)){case"helpmenu":Es(H,y.elementfocus,"H E L P"),jt(H,y.elementfocus,""),ne(H,y.elementfocus,"#help controls","zss controls and inputs"),jt(H,y.elementfocus,"!helpcontrols;read help controls"),jt(H,y.elementfocus,""),ne(H,y.elementfocus,"#help text","text formatting"),jt(H,y.elementfocus,"!helptext;read help text"),jt(H,y.elementfocus,""),ne(H,y.elementfocus,"#help developer","developer commands"),jt(H,y.elementfocus,"!helpdeveloper;read help developer"),jt(H,y.elementfocus,""),ne(H,y.elementfocus,"#help player","player settings"),jt(H,y.elementfocus,"!helpplayer;read help player"),Ai(H,y.elementfocus,"keyboard input"),ne(H,y.elementfocus,"?","open console"),ne(H,y.elementfocus,"esc","close console"),ne(H,y.elementfocus,"tab","move console"),ne(H,y.elementfocus,"up / down arrow keys","navigate console items"),ne(H,y.elementfocus,"left / right arrow keys","change console items"),ne(H,y.elementfocus,"enter","interact with console items"),ne(H,y.elementfocus,"alt + arrow keys","skip words and console lines"),ne(H,y.elementfocus,`${h6} + up / down arrow keys`,"input history");break;case"helpcontrols":Es(H,y.elementfocus,"zss controls and inputs"),Ai(H,y.elementfocus,"keyboard input"),ne(H,y.elementfocus,"arrow keys","move"),ne(H,y.elementfocus,"shift + arrow keys","shoot"),ne(H,y.elementfocus,"enter","ok / accept"),ne(H,y.elementfocus,"escape","cancel / close"),ne(H,y.elementfocus,"tab","menu / action"),Ai(H,y.elementfocus,"controller input"),ne(H,y.elementfocus,"left stick","move"),ne(H,y.elementfocus,"right stick","aim"),ne(H,y.elementfocus,"a","ok / accept"),ne(H,y.elementfocus,"b","cancel / close"),ne(H,y.elementfocus,"y","menu / action"),ne(H,y.elementfocus,"x","shoot"),ne(H,y.elementfocus,"triggers","shoot");break;case"helptext":break;case"helpdeveloper":Es(H,y.elementfocus,"developer commands"),ne(H,y.elementfocus,"#books","list books in memory"),ne(H,y.elementfocus,"#pages","list pages in opened book"),ne(H,y.elementfocus,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ne(H,y.elementfocus,"#trash","list books and pages from open book you can delete"),ne(H,y.elementfocus,"#save","flush state to register"),ne(H,y.elementfocus,"#share","creates a click to copy share url and QR code");break;case"helpplayer":Es(H,y.elementfocus,"player settings"),We(H,y.elementfocus,"todo");break;default:{const[i,s]=pb(n);Ed(i==="self"&&y.elementisplayer?`${y.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(ue),s=i.join(" ");switch(Ot(r)){case Yn(wt.LOADER):n=Vi(Bt.CONTENT,s,yt.LOADER);break;default:n=Vi(Bt.CONTENT,[r,...i].join(" "),yt.OBJECT);break;case Yn(wt.BOARD):n=Vi(Bt.CONTENT,s,yt.BOARD);break;case Yn(wt.OBJECT):n=Vi(Bt.CONTENT,s,yt.OBJECT);break;case Yn(wt.TERRAIN):n=Vi(Bt.CONTENT,s,yt.TERRAIN);break;case Yn(wt.CHARSET):n=Vi(Bt.CONTENT,s,yt.CHARSET);break;case Yn(wt.PALETTE):n=Vi(Bt.CONTENT,s,yt.PALETTE);break}return x(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(ue).join(" ");return x(y.element)&&(y.element.tickertext=n,y.element.tickertime=y.timestamp),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=ue(n),s=r.map(ue).join(" ");return ri(H,y.elementfocus,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=rt(t,0,[Y.MAYBE_NAME]),r=t1(n);return x(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=Ir(n);return x(r)?(We(H,y.elementfocus,`opened [book] ${r.name}`),jl(Bt.MAIN,r.id),e.command("pages")):_e(H,y.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=he(Bt.MAIN),i=Ir(n);return x(i)&&(r===i&&jl(Bt.MAIN,""),u8(n),We(H,y.elementfocus,`trashed [book] ${i.name}`),po(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=Mn(y.book,yt.BOARD,n);if(r.length){const i=xe(...r);x(i)&&fo(y.book,y.elementfocus,i.id,{x:er(0,Rt-1),y:er(0,Zt-1)})}return 0}).command("pageopenwith",(e,t)=>{const[n,r,i]=rt(t,0,[Y.NAME,Y.MAYBE_NAME,Y.MAYBE_NAME]);return e.command("pageopen",r,i,n)}).command("pageopen",(e,t)=>{const[n,r,i]=rt(t,0,[Y.NAME,Y.MAYBE_NAME,Y.MAYBE_NAME]),s=kn(Bt.MAIN);if(!x(s))return 0;const o=xi(s,n);if(x(o)){const a=Be(o),c=wi(o);We(H,y.elementfocus,`opened [${c}] ${a}`);const l=[],u=xi(s,i??""),h=x(u)?Pf(u.code):void 0;if(x(h))for(let p=0;p<h.tokens.length;++p){const m=h.tokens[p];m.tokenType===Rf&&l.push(m.image.startsWith('"')?m.image.slice(1):m.image)}const d=[o.id,r];rh(Pa(s.id,d),o.code);const f=wi(o);zd(H,y.elementfocus,s.id,d,f,`${a} - ${s.name}`,l)}else _e(H,"pageopen",`page ${n} not found`,y.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=kn(Bt.MAIN),i=V_(r,n);if(x(n)){const s=Be(i),o=wi(i);We(H,y.elementfocus,`trashed [${o}] ${s}`),po(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(ue).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Ai(H,y.elementfocus,"books");const e=he(Bt.MAIN);ne(H,y.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=he(Bt.CONTENT);ne(H,y.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),nd(H,y.elementfocus,7);const n=ko();return n.length?n.forEach(r=>{jt(H,y.elementfocus,`!bookopen ${r.id};${r.name}`)}):We(H,y.elementfocus,"no books found"),jt(H,y.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=kn(Bt.MAIN);return x(e)&&(Ai(H,y.elementfocus,"pages"),ne(H,y.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?kl(e).forEach(n=>{const r=Be(n),i=wi(n);jt(H,y.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(jt(H,y.elementfocus,""),We(H,y.elementfocus,"$white no pages found"),We(H,y.elementfocus,"$white use @ to create a page"),We(H,y.elementfocus,"$white @board name of board"),We(H,y.elementfocus,"$white @object name of object"),We(H,y.elementfocus,"$white @terrain name of terrain"),We(H,y.elementfocus,"$white You can omit the type and it will default to object"),We(H,y.elementfocus,"$white @object name of object"),We(H,y.elementfocus,"$white @name of object"))),0}).command("boards",()=>{Ai(H,y.elementfocus,"boards");const e=kn(Bt.MAIN);if(x(e)){ne(H,y.elementfocus,"main",`${e.name} $GREEN${e.id}`);const t=kl(e);t.filter(n=>Ei(n)===yt.BOARD).forEach(n=>{const r=Be(n),i=wi(n);jt(H,y.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),t.length===0&&(jt(H,y.elementfocus,""),We(H,y.elementfocus,"$white no boards found"),We(H,y.elementfocus,"$white use @ to create a board"),We(H,y.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{Ai(H,y.elementfocus,"$REDTRASH"),We(H,y.elementfocus,"books");const e=ko();e.length&&(e.forEach(n=>{jt(H,y.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),jt(H,y.elementfocus,""));const t=he(Bt.MAIN);return x(t)&&(We(H,y.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Be(n);jt(H,y.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),jt(H,y.elementfocus,"")),0}).command("dev",()=>(po(),TE(H,y.elementfocus),0)).command("share",()=>(po(),AE(H,y.elementfocus),0)).command("save",()=>(po(),0)).command("fork",()=>(DE(H,y.elementfocus),0)).command("nuke",()=>(vE(H,y.elementfocus),0)).command("restart",()=>(BE(H,y.elementfocus),po(),0)).command("export",()=>{Es(H,y.elementfocus,"E X P O R T"),Ai(H,y.elementfocus,"books");const e=ko();return e.length&&e.forEach(t=>jt(H,y.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=Ir(n);return x(r)&&(Es(H,y.elementfocus,"E X P O R T"),Ai(H,y.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=kl(r);jt(H,y.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Be(s),a=wi(s);jt(H,y.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=Ir(n);return x(r)&&$d(H,y.elementfocus,$n(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),{target:r,path:i}=pr(n),s=Ir(r),o=xi(s,i);return x(o)&&$d(H,y.elementfocus,$n(o),`${Be(o)}.${wi(o)}.json`),0}).command("gadget",()=>(UE(H,y.elementfocus),0)).command("joincode",(e,t)=>{const[n]=rt(t,0,[Y.MAYBE_NAME]);return pE(H,y.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=rt(t,0,[Y.MAYBE_NAME]);return mE(H,y.elementfocus,!!n),0}),d6=Jr().command("toast",(e,t)=>{const n=t.map(ue).join("");return iE(H,y.elementfocus,n),0}).command("palette",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=e1(),i=Je(y.book,yt.PALETTE,n);return x(i)?(r.palette=i.id,jt(H,y.elementfocus,`loaded palette ${n}`)):_e(H,y.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=e1(),i=Je(y.book,yt.CHARSET,n);return x(i)?(r.charset=i.id,jt(H,y.elementfocus,`loaded charset ${n}`)):_e(H,y.elementfocus,"not-found",`unabled to find charset ${n}`),0}),rd={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ta(e){return ae(e)&&mb(e[0])}function mb(e){return x(Jn[e])&&kt(e)}function gb(e){if(kt(e))return rd[Ot(e)]}function yb(e){if(Ta(e))return e;if(mb(e))return[e];const t=gb(e);if(x(t))return[t]}function p6(e){const t=y.words[e],n=yb(t);if(Ta(n))return[n,e+1];const[r,i]=Pn(e),s=yb(r);return Ta(s)?[s,i]:[void 0,e]}const id={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Gt.ISSOLID,Gt.ISWALK,Gt.ISSWIM,Gt.ISBULLET,Gt.ISWALK,Gt.ISSWIM;function Sl(e){return ae(e)&&sd(e[0])}function sd(e){return x(Gt[e])&&kt(e)}function m6(e){if(kt(e))return id[Ot(e)]}function g6(e){const t=y.words[e];if(Sl(t))return[t,e+1];if(sd(t))return[[t],e+1];const[n,r]=Pn(e);return Sl(n)?[n,r]:sd(n)?[[n],r]:[void 0,e]}const y6=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),_b=new Set(["group","party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),_6=["NORTH","SOUTH","WEST","EAST"];function b6(e){const t=ti(e);if(St(t.inputcurrent)||(t.inputcurrent=0),ae(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=bn.NONE,i=0]=n??[bn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&XT?1:0,t.inputctrl=i&qT?1:0,t.inputshift=i&JT?1:0,r){case bn.MOVE_UP:case bn.MOVE_DOWN:case bn.MOVE_LEFT:case bn.MOVE_RIGHT:t.inputmove=[_6[r-bn.MOVE_UP]];break;case bn.OK_BUTTON:t.inputok=1;break;case bn.CANCEL_BUTTON:t.inputcancel=1;break;case bn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==bn.NONE&&o!==r}),t}function E6(e){const t=rd[e];if(x(t))return t;const n=id[e];if(x(n))return n;const r=Xo[e];if(x(r))return r;const i=hh[e];if(x(i))return i}const w6=Jr({get(e,t){var o,a,c,l,u,h,d,f,p,m,w,b,T,A,I,U,R,O,P,N,W;const n=E6(t);if(x(n))return[!0,n];if(y.elementisplayer&&y6.has(t)){const et=b6(y.elementid)[t];return[x(et),et]}const r=ta(y.board,{x:((o=y.element)==null?void 0:o.x)??-1,y:((a=y.element)==null?void 0:a.y)??-1},y.elementfocus),i=(r==null?void 0:r.id)??y.elementfocus??Sr();switch(t){case"isdark":return[!0,(c=y.board)!=null&&c.isdark?1:0];case"startx":return[!0,((l=y.board)==null?void 0:l.startx)??0];case"starty":return[!0,((u=y.board)==null?void 0:u.starty)??0];case"over":return[!0,((h=y.board)==null?void 0:h.over)??""];case"under":return[!0,((d=y.board)==null?void 0:d.under)??""];case"camera":return[!0,((f=y.board)==null?void 0:f.camera)??""];case"graphics":return[!0,((p=y.board)==null?void 0:p.graphics)??""];case"facing":break;case"exitnorth":return[!0,((m=y.board)==null?void 0:m.exitnorth)??""];case"exitsouth":return[!0,((w=y.board)==null?void 0:w.exitsouth)??""];case"exitwest":return[!0,((b=y.board)==null?void 0:b.exitwest)??""];case"exiteast":return[!0,((T=y.board)==null?void 0:T.exiteast)??""];case"timelimit":return[!0,((A=y.board)==null?void 0:A.timelimit)??0];case"restartonzap":return[!0,((I=y.board)==null?void 0:I.restartonzap)??0];case"maxplayershots":return[!0,((U=y.board)==null?void 0:U.maxplayershots)??0];case"boardid":return[!0,((R=y.board)==null?void 0:R.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((O=y.element)==null?void 0:O.id)??""];case"thisx":return[!0,((P=y.element)==null?void 0:P.x)??-1];case"thisy":return[!0,((N=y.element)==null?void 0:N.y)??-1];default:{const et=(W=y.element)==null?void 0:W[t];if(_b.has(t))return[!0,et];break}}const s=ti(i)[t];return[x(s),s]},set(e,t,n){var o,a;const r=ta(y.board,{x:((o=y.element)==null?void 0:o.x)??-1,y:((a=y.element)==null?void 0:a.y)??-1},y.elementfocus),i=(r==null?void 0:r.id)??y.elementfocus;switch(t){case"isdark":if(x(y.board))return y.board.isdark=n?1:0,[!0,y.board.isdark];break;case"startx":if(x(y.board))return y.board.startx=na(n,0),[!0,y.board.startx];break;case"starty":if(x(y.board))return y.board.starty=na(n,0),[!0,y.board.starty];break;case"over":if(x(y.board))return y.board.over=St(n)?n:ue(n),[!0,y.board.over];break;case"under":if(x(y.board))return y.board.under=St(n)?n:ue(n),[!0,y.board.under];break;case"camera":if(x(y.board))return[!0,y.board.camera=ue(n)];break;case"graphics":if(x(y.board))return[!0,y.board.graphics=ue(n)];break;case"facing":break;case"exitnorth":if(x(y.board))return y.board.exitnorth=ue(n),[!0,y.board.exitnorth];break;case"exitsouth":if(x(y.board))return y.board.exitsouth=ue(n),[!0,y.board.exitsouth];break;case"exitwest":if(x(y.board))return y.board.exitwest=ue(n),[!0,y.board.exitwest];break;case"exiteast":if(x(y.board))return y.board.exiteast=ue(n),[!0,y.board.exiteast];break;case"timelimit":if(x(y.board))return y.board.timelimit=na(n,0),[!0,y.board.timelimit];break;case"restartonzap":if(x(y.board))return y.board.restartonzap=n?1:0,[!0,y.board.restartonzap];break;case"maxplayershots":if(x(y.board))return y.board.maxplayershots=na(n,0),[!0,y.board.maxplayershots];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(_b.has(t))return x(y.element)&&(y.element[t]=n),[!0,n];break}}const s=ti(i);return x(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=y.element)!=null&&e.removed)&&(x((t=y.element)==null?void 0:t.stepx)||x((n=y.element)==null?void 0:n.stepy))){const s={x:((r=y.element)==null?void 0:r.x)??0,y:((i=y.element)==null?void 0:i.y)??0};To(y.book,y.board,y.element,{x:s.x+(y.element.stepx??0),y:s.y+(y.element.stepy??0)})===!1&&(y.element.stepx=0,y.element.stepy=0,Un(y.book,y.element,"destructible")&&Vn(y.book,y.board,y.element,y.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(ue(n),0)),0)).command("set",(e,t)=>{const[n,r]=rt(t,0,[Y.NAME,Y.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=rt(t,0,[Y.KIND]);if(ze(y.book,y.board),Kf(y.book,y.board,y.element),Vn(y.book,y.board,y.element,y.timestamp)){const s={x:((r=y.element)==null?void 0:r.x)??0,y:((i=y.element)==null?void 0:i.y)??0};bs(y.book,y.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=rt(t,0,[Y.NUMBER]);return x(y.element)&&(y.element.char=n),0}).command("color",(e,t)=>{const[n]=rt(t,0,[Y.COLOR]);return x(y.element)&&x(n)&&Tc(y.element,n),0}).command("go",(e,t)=>{if(x(y.element)){const[n]=rt(t,0,[Y.DIR]);if(To(y.book,y.board,y.element,n),e.yield(),y.element.x===n.x&&y.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!x(y.element))return 0;const[n]=rt(t,0,[Y.DIR]),r=y.element.x??0,i=y.element.y??0;return y.element.stepx=n.x-r,y.element.stepy=n.y-i,0}),x6=Jr().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=rt(t,0,[Y.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(ue(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(ue(t[0])),0)).command("cycle",(e,t)=>{if(x(y.element)){const[n]=rt(t,0,[Y.NUMBER]);y.element.cycle=cn(Math.round(n),1,255)}return 0}).command("die",e=>(Vn(y.book,y.board,y.element,y.timestamp),e.endofprogram(),0)).command("endgame",()=>(Wd(H,y.elementfocus),0)).command("run",(e,t)=>{const[n]=rt(t,0,[Y.NAME]);return zl(n),0}).command("runwith",(e,t)=>{const[n,r]=rt(t,0,[Y.ANY,Y.NAME]);return e.set("arg",n),zl(r),0}),Il={};function k6(e){var t;return(t=Il[e])==null?void 0:t.arg}function T6(e){var t;return(t=Il[e])==null?void 0:t.format}function mo(e){var t;return(t=Il[e])==null?void 0:t.content}function A6(e,t,n,r,i){const s=he(Bt.MAIN);if(!x(s))return;const o=ys(s,yt.LOADER).filter(a=>{const c=gs(a),l=c.format,u=kt(l)?new RegExp(l).test(t):!1,h=c.event,d=kt(h)?new RegExp(h).test(n):!1;return kt(l)&&kt(h)?u&&d:kt(l)?u:kt(h)?d:!1});for(let a=0;a<o.length;++a){const c=`${Ue()}_loader`;Il[c]={arg:e,format:t,content:r,player:i},m8(c,o[a].code)}}function bb(e,t){if(!x(e))return;const n=Ot(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const v6=(e,t)=>{const n=mo(e.id());if(!x(n))return 0;const[r,i]=rt(t,0,[Y.NAME]),s=Ot(r);switch(s){case"seek":{const[o]=rt(t,i,[Y.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(t,i,[Y.NAME]);e.set(o,bb(n,s));break}case"text":{const[o,a]=rt(t,i,[Y.NAME,Y.NAME]),c=bb(n,o);if(St(c)&&kt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(l);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=rt(t,i,[Y.NAME]),a=zf(y.book,yt.PALETTE,o),c=Ne(a);if(x(c)){const l=zT*vc,u=Dm(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(t,i,[Y.NAME]),a=zf(y.book,yt.CHARSET,o),c=Ne(a);if(x(c)){const l=Ic*jT*Ih,u=$m(new Uint8Array(n.bytes.buffer,n.cursor,l));x(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},go=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Nl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Nl(e[n],t[n]))return!1;return!0}if(go(e)&&go(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Nl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Ol=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(go(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},R6=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Eb=e=>e>="0"&&e<="9"||e==="-",S6=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var X;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(X||(X={}));const wb={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},I6={"!":!0,"<":!0,"=":!0,">":!0},N6={"	":!0,"\n":!0,"\r":!0," ":!0};class O6{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(R6(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(wb[t[this._current]]!==void 0)n.push({start:this._current,type:wb[t[this._current]],value:t[this._current]}),this._current+=1;else if(Eb(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(I6[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(N6[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&S6(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Eb(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const C6=new O6,mn={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class L6{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...C6.tokenize(t),{type:X.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<mn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case X.TOK_LITERAL:return{type:"Literal",value:t.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(mn.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(mn.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(t.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(mn.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(mn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(mn.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case X.TOK_DOT:const i=mn.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(mn.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(mn.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(mn.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(mn.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(mn.Flatten);return{type:"Projection",children:[u,h]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,t);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(mn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(mn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(mn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(t);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(mn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const M6=new L6;var ut;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class U6{constructor(t){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>go(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(m=>{var w;return(w=!m.optional)!==null&&w!==void 0?w:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let d,f,p;for(let m=0;m<r.length;m+=1){p=!1,d=r[m].types,f=this.getTypeName(n[m]);let w;for(w=0;w<d.length;w+=1)if(f!==void 0&&this.typeMatches(f,d[w],n[m])){p=!0;break}if(!p&&f!==void 0){const b=d.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${m+1} to be type (${b}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(t,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return t===ut.TYPE_ARRAY;if(t===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return t.jmespathType===X.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class F6{constructor(){this._rootValue=null,this.runtime=new U6(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,h,d,f;switch(t.type){case"Field":return n===null?null:go(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...t.children],w=this.computeSliceParams(n.length,m),[b,T,A]=w;if(s=[],A>0)for(d=b;d<T;d+=A)s.push(n[d]);else for(d=b;d>T;d+=A)s.push(n[d]);return s;case"Projection":if(f=this.visit(t.children[0],n),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(t.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(t.children[0],n),!go(f))return null;h=[];const I=Object.values(f);for(d=0;d<I.length;d+=1)i=this.visit(t.children[1],I[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(t.children[0],n),!Array.isArray(f))return null;const U=[],R=[];for(d=0;d<f.length;d+=1)r=this.visit(t.children[2],f[d]),Ol(r)||U.push(f[d]);for(let L=0;L<U.length;L+=1)i=this.visit(t.children[1],U[L]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case X.TOK_EQ:s=Nl(o,a);break;case X.TOK_NE:s=!Nl(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case X.TOK_FLATTEN:const O=this.visit(t.children[0],n);if(!Array.isArray(O))return null;let P=[];for(d=0;d<O.length;d+=1)i=O[d],Array.isArray(i)?P=[...P,...i]:P.push(i);return P;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],d=0;d<t.children.length;d+=1)h.push(this.visit(t.children[d],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let N;for(d=0;d<t.children.length;d+=1)N=t.children[d],h[N.name]=this.visit(N.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),Ol(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Ol(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Ol(o);case"Literal":return t.value;case X.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const W=[];for(let L=0;L<t.children.length;L+=1)W.push(this.visit(t.children[L],n));return this.runtime.callFunction(t.name,W);case"ExpressionReference":const et=t.children[0];return et.jmespathType=X.TOK_EXPREF,et;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const P6=new F6;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function B6(e,t){const n=M6.parse(t);return P6.search(n,e)}const D6=(e,t)=>{const n=mo(e.id());if(!x(n))return 0;const[r,i]=rt(t,0,[Y.NAME,Y.NAME]),s=B6(n.json,r);return e.set(i,s),0},$6=(e,t)=>{const n=mo(e.id());if(!x(n))return 0;const[r,i]=rt(t,0,[Y.NAME]);switch(Ot(r)){case"seek":{const[o]=rt(t,i,[Y.NUMBER]);n.cursor=cn(o,0,n.lines.length-1);break}case"line":n.cursor=cn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[h,d]=rt(t,u,[Y.NAME]);e.set(h,c[l]??0),++l,u=d}break}}return 0},j6=Jr({get(e,t){const n=T6(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=mo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=mo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=mo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=rt(t,0,[Y.NAME,Y.ANY]);return Ed(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(ue).join(" ");return ri(H,y.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=ue(n),s=r.map(ue).join(" ");return ri(H,y.elementfocus,"$175",`!${s};${i}`),0}).command("readline",$6).command("readjson",D6).command("readbin",v6).command("with",(e,t)=>{const[n]=rt(t,0,[Y.NAME]),r=Mn(y.book,yt.BOARD,n);if(r.length){const i=xe(...r);x(i)&&(y.board=Ne(i),y.element={x:-1,y:-1})}return 0});function xb(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[Y.ANY]);ae(c)&&!os(c)&&!Ta(c)&&!Sl(c)&&!$r(c)?o.push(...c):o.push(c),a=l}switch(Ot(r)){case"get":case"post:json":lE(H,y.elementfocus,e,t,n,r,o);break}return 0}const z6=Jr().command("fetch",(e,t)=>{const[n,r,i="get",s]=rt(t,0,[Y.NAME,Y.NAME,Y.MAYBE_STRING]);return xb(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=rt(t,0,[Y.ANY,Y.NAME,Y.NAME,Y.MAYBE_STRING]);return xb(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=rt(t,0,[Y.ANY]);switch(Ot(n)){default:aE(H,y.elementfocus,n);break;case"stop":cE(H,y.elementfocus);break}return 0}).command("twitchbroadcast",(e,t)=>{const[n]=rt(t,0,[Y.NAME]);switch(Ot(n)){default:sE(H,y.elementfocus,n);break;case"stop":oE(H,y.elementfocus);break}return 0}),W6=Jr({set(e,t,n){return v8(e,t,n),[!1,void 0]},everytick(){const e=ei(y.elementid),[t]=e;if(e.length===1&&kt(t)){if(x(y.element))if(t.trim().length===0){const n=Tn(y.elementid);n.sidebar=[]}else y.element.tickertext=t,y.element.tickertime=y.timestamp}else if(e.length>1)if(y.elementisplayer){const n=Tn(y.elementid);n.sidebar=e}else{const n=Tn(y.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var a,c;const[n,r]=rt(t,0,[Y.NAME,Y.ANY]),[i,s]=pb(n);switch(Ot(i)){case"all":for(const l of Object.keys(((a=y.board)==null?void 0:a.objects)??{}))e.send(y.elementfocus,l,s,r);break;case"self":e.message({session:H.session(),player:y.elementfocus,id:Ue(),sender:e.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((c=y.board)==null?void 0:c.objects)??{}))l!==e.id()&&e.send(y.elementfocus,l,s,r);break;default:{const l=Um(y.board,[i]);for(let u=0;u<l.length;++u){const h=l[u];x(h.id)&&e.send(y.elementfocus,h.id,s,r)}break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(ue).join("");return se(y.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=ue(n);return $t(y.elementid,e.id(),i,r,e.get,e.set),0});function kb(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=Te(t,{x:s,y:i});pn(o)&&Vn(e,t,o,e.timestamp),sn(t,{x:s,y:i})}}function K6(e,t,n){for(let r=t.y;r<=n.y;++r)for(let i=t.x;i<=n.x;++i)sn(e,{x:i,y:r})}function Tb(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=Te(t,{x:s,y:i});pn(o)&&Vn(e,t,o,e.timestamp),sn(t,{x:s,y:i})}}function Cl(e,t){x(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.destructible=t.destructible,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function od(e,t,n,r,i){if(!x(y.book))return;const s=y.book,o=Je(s,yt.BOARD,e),a=Ne(o);if(!x(a))return;const c=Je(s,yt.BOARD,t),l=Ne(c);if(!x(l))return;ze(s,a),ze(s,l);let u=!1;if(x(a)&&x(l)){switch(i){case"all":kb(s,l,n,r);break;case"object":Tb(s,l,n,r);break;case"terrain":K6(l,n,r);break;default:u=!0;break}for(let h=n.y;h<=r.y;++h)for(let d=n.x;d<=r.x;++d){let f=!1,p=!1;switch(i){case"all":f=!0,p=!0;break;case"object":f=!0;break;case"terrain":p=!0;break}const m={x:d,y:h};let w,b=Te(a,m);if(pn(b)?(w=eo(a,d,h),dr(b==null?void 0:b.id)&&(b=void 0)):(w=b,b=void 0),x(w)&&(p||u&&ki(s,w)===i)){u&&kb(s,l,m,m);const T=bs(s,l,[w.kind??""],m);Cl(T,w)}if(x(b)&&(f||u&&ki(s,b)===i)){u&&Tb(s,l,m,m);const T=bs(s,l,[b.kind??""],m);Cl(T,b)}}vl(s,l)}}function G6(e,t,n,r,i){if(!x(y.book))return;const s=y.book,o=Je(s,yt.BOARD,e),a=Ne(o);if(!x(a))return;const c=Ah(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";ze(s,a),ze(s,c);const h=-Math.tan(t*.5),d=Math.sin(t),f=Math.round(12.5*h),p=Math.round(12.5*d),m=new Array(Zt).fill(0);$p(f,0,-f,Zt-1).forEach(I=>{I.x<0?m[I.y]=Math.min(m[I.y],I.x):m[I.y]=Math.max(m[I.y],I.x)});const b=new Array(Rt).fill(0);$p(0,p,Rt-1,-p).forEach(I=>{I.y<0?b[I.x]=Math.min(b[I.x],I.y):b[I.x]=Math.max(b[I.x],I.y)});const A=[m,b,m];for(let I=0;I<A.length;++I){const U=A[I];if(I!==1){for(let R=0;R<Zt;++R){const O=U[R],P=R*Rt;for(let N=0;N<Rt;N++){const W=(N+O+Rt)%Rt;u&&(c.terrain[W+P]=a.terrain[N+P])}}if(l){const R=Object.keys(a.objects);for(let O=0;O<R.length;++O){const P=R[O],{x:N,y:W}=a.objects[P];if(x(N)&&x(W)){const et=U[W];a.objects[P].x=(N+et+Rt)%Rt,a.objects[P].lx=a.objects[P].x}}}}if(I===1){for(let R=0;R<Rt;++R){const O=U[R];for(let P=0;P<Zt;++P){const N=(P+O+Zt)%Zt;u&&(c.terrain[R+N*Rt]=a.terrain[R+P*Rt])}}if(l){const R=Object.keys(a.objects);for(let O=0;O<R.length;++O){const P=R[O],{x:N,y:W}=a.objects[P];if(x(N)&&x(W)){const et=U[N];a.objects[P].y=(W+et+Zt)%Zt,a.objects[P].ly=a.objects[P].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,ze(s,c),ze(s,a)}}function H6(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var Y6=H6;const V6=Y6,Qt=function(){};Qt.prototype.FMX=0,Qt.prototype.FMY=0,Qt.prototype.FMXxFMY=0,Qt.prototype.T=0,Qt.prototype.N=0,Qt.prototype.initiliazedField=!1,Qt.prototype.generationComplete=!1,Qt.prototype.wave=null,Qt.prototype.compatible=null,Qt.prototype.weightLogWeights=null,Qt.prototype.sumOfWeights=0,Qt.prototype.sumOfWeightLogWeights=0,Qt.prototype.startingEntropy=0,Qt.prototype.sumsOfOnes=null,Qt.prototype.sumsOfWeights=null,Qt.prototype.sumsOfWeightLogWeights=null,Qt.prototype.entropies=null,Qt.prototype.propagator=null,Qt.prototype.observed=null,Qt.prototype.distribution=null,Qt.prototype.stack=null,Qt.prototype.stackSize=0,Qt.prototype.DX=[-1,0,1,0],Qt.prototype.DY=[0,1,0,-1],Qt.prototype.opposite=[2,3,0,1],Qt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Qt.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=V6(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Qt.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],h=this.compatible[l];for(let d=0;d<u.length;d++){const f=u[d],p=h[f];p[i]--,p[i]==0&&this.ban(l,f)}}}},Qt.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},Qt.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},Qt.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},Qt.prototype.isGenerationComplete=function(){return this.generationComplete},Qt.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},Qt.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Ab=Qt;const vb=Ab,vi=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=n,d=new Array(h);for(let N=0;N<h;N++)d[N]=new Array(r);this.colors=[];const f={};for(let N=0;N<r;N++)for(let W=0;W<n;W++){const et=(N*n+W)*4,L=[t[et],t[et+1],t[et+2],t[et+3]],S=L.join("-");f.hasOwnProperty(S)||(f[S]=this.colors.length,this.colors.push(L)),d[W][N]=f[S]}const p=this.colors.length,m=Math.pow(p,i*i),w=function(W){let et=new Array(i*i);for(let L=0;L<i;L++)for(let S=0;S<i;S++)et[S+L*i]=W(S,L);return et},b=function(W,et){return w(function(L,S){return d[(W+L)%n][(et+S)%r]})},T=function(W){return w(function(et,L){return W[i-1-L+et*i]})},A=function(W){return w(function(et,L){return W[i-1-et+L*i]})},I=function(W){let et=0,L=1;for(let S=0;S<W.length;S++)et+=W[W.length-1-S]*L,L*=p;return et},U=function(W){let et=W,L=m;const S=new Array(i*i);for(let E=0;E<S.length;E++){L/=p;let B=0;for(;et>=L;)et-=L,B++;S[E]=B}return S},R={},O=[];for(let N=0;N<(a?r:r-i+1);N++)for(let W=0;W<(a?n:n-i+1);W++){const et=new Array(8);et[0]=b(W,N),et[1]=A(et[0]),et[2]=T(et[0]),et[3]=A(et[2]),et[4]=T(et[2]),et[5]=A(et[4]),et[6]=T(et[4]),et[7]=A(et[6]);for(let L=0;L<l;L++){const S=I(et[L]);R[S]?R[S]++:(O.push(S),R[S]=1)}}this.T=O.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const W=parseInt(O[N],10);this.patterns[N]=U(W),this.weights[N]=R[W]}const P=function(W,et,L,S){const E=L<0?0:L,B=L<0?L+i:i,Z=S<0?0:S,D=S<0?S+i:i;for(let st=Z;st<D;st++)for(let tt=E;tt<B;tt++)if(W[tt+i*st]!=et[tt-L+i*(st-S)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let W=0;W<this.T;W++){const et=[];for(let L=0;L<this.T;L++)P(this.patterns[W],this.patterns[L],this.DX[N],this.DY[N])&&et.push(L);this.propagator[N][W]=et}}};vi.prototype=Object.create(vb.prototype),vi.prototype.constructor=vi,vi.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},vi.prototype.clear=function(){if(vb.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},vi.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},vi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},vi.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let h=0;h<this.N;h++){let d=n-h;d<0&&(d+=this.FMX);let f=r-u;if(f<0&&(f+=this.FMY),this.onBoundary(d,f))continue;const p=d+f*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const w=this.colors[this.patterns[m][h+u*this.N]];s+=w[0],o+=w[1],a+=w[2],c+=w[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var X6=vi;const q6=Ab,Gi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(I){const U=new Array(o*o);for(let R=0;R<o;R++)for(let O=0;O<o;O++)U[O+R*o]=I(O,R);return U},u=function(I){return l(function(U,R){return I[o-1-R+U*o]})},h=function(I){return l(function(U,R){return I[o-1-U+R*o]})};this.tiles=[];const d=[],f=[],p={};let m,w,b;for(let A=0;A<t.tiles.length;A++){const I=t.tiles[A];if(c!==null&&c.indexOf(I.name)===-1)continue;switch(I.symmetry){case"L":b=4,m=function(R){return(R+1)%4},w=function(R){return R%2===0?R+1:R-1};break;case"T":b=4,m=function(R){return(R+1)%4},w=function(R){return R%2===0?R:4-R};break;case"I":b=2,m=function(R){return 1-R},w=function(R){return R};break;case"\\":b=2,m=function(R){return 1-R},w=function(R){return 1-R};break;case"F":b=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},w=function(R){return R<4?R+4:R-4};break;default:b=1,m=function(R){return R},w=function(R){return R};break}this.T=f.length,p[I.name]=this.T;for(let R=0;R<b;R++)f.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+w(R),this.T+w(m(R)),this.T+w(m(m(R))),this.T+w(m(m(m(R))))]);let U;if(a)for(let R=0;R<b;R++)U=I.bitmap[R],this.tiles.push(l(function(O,P){return[U[(o*P+O)*4],U[(o*P+O)*4+1],U[(o*P+O)*4+2],U[(o*P+O)*4+3]]}));else{U=I.bitmap,this.tiles.push(l(function(R,O){return[U[(o*O+R)*4],U[(o*O+R)*4+1],U[(o*O+R)*4+2],U[(o*O+R)*4+3]]}));for(let R=1;R<b;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):h(this.tiles[this.T+R-4]))}for(let R=0;R<b;R++)d.push(I.weight||1)}this.T=f.length,this.weights=d,this.propagator=new Array(4);const T=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),T[A]=new Array(this.T);for(let I=0;I<this.T;I++){T[A][I]=new Array(this.T);for(let U=0;U<this.T;U++)T[A][I][U]=!1}}for(let A=0;A<t.neighbors.length;A++){const I=t.neighbors[A],U=I.left.split(" ").filter(function(et){return et.length}),R=I.right.split(" ").filter(function(et){return et.length});if(c!==null&&(c.indexOf(U[0])===-1||c.indexOf(R[0])===-1))continue;const O=f[p[U[0]]][U.length==1?0:parseInt(U[1],10)],P=f[O][1],N=f[p[R[0]]][R.length==1?0:parseInt(R[1],10)],W=f[N][1];T[0][N][O]=!0,T[0][f[N][6]][f[O][6]]=!0,T[0][f[O][4]][f[N][4]]=!0,T[0][f[O][2]][f[N][2]]=!0,T[1][W][P]=!0,T[1][f[P][6]][f[W][6]]=!0,T[1][f[W][4]][f[P][4]]=!0,T[1][f[P][2]][f[W][2]]=!0}for(let A=0;A<this.T;A++)for(let I=0;I<this.T;I++)T[2][A][I]=T[0][I][A],T[3][A][I]=T[1][I][A];for(let A=0;A<4;A++)for(let I=0;I<this.T;I++){const U=[],R=T[A][I];for(let O=0;O<this.T;O++)R[O]&&U.push(O);this.propagator[A][I]=U}};Gi.prototype=Object.create(q6.prototype),Gi.prototype.constructor=Gi,Gi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Gi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Gi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Gi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let h=0,d=0,f=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const w=this.tiles[m][l+c*this.tilesize],b=this.weights[m]*a;h+=w[0]*b,d+=w[1]*b,f+=w[2]*b,p+=w[3]*b}e[u]=h,e[u+1]=d,e[u+2]=f,e[u+3]=p}}}};var J6=Gi,Z6={OverlappingModel:X6,SimpleTiledModel:J6},Q6=vs(Z6);const Rb=5;function Sb(e,t,n,r,i,s,o){if(!x(y.book))return!1;const a=y.book,c=Je(a,yt.BOARD,e),l=Je(a,yt.BOARD,t),u=Ne(c),h=Ne(l);if(!x(u)||!x(h))return!1;ze(a,u),ze(a,h);let d=0;const f=new Map,p=new Map;let m=0;const w=32,b=new Uint8Array(Th*4);for(let O=0;O<Zt;++O)for(let P=0;P<Rt;++P){const N=Te(h,{x:P,y:O}),W=(N==null?void 0:N.char)??0,et=(N==null?void 0:N.color)??w,L=(N==null?void 0:N.bg)??w;b[m++]=W,b[m++]=et,b[m++]=L;const S=Rr(a,N),E=Ot((S==null?void 0:S.name)??"empty"),B=f.get(E);St(B)?b[m++]=B:(f.set(E,d),p.set(d,E),b[m++]=d++)}const T=s.x-i.x+1,A=s.y-i.y+1,I=new Q6.OverlappingModel(b,Rt,Zt,n,T,A,!1,!1,r,0);let U=0;for(;U<Rb&&!I.generate();++U);if(U===Rb)return!1;m=0;const R=I.graphics();for(let O=i.y;O<=s.y;++O)for(let P=i.x;P<=s.x;++P){const N={x:P,y:O},W=R[m++],et=R[m++],L=R[m++];switch(d=R[m++],o){case"all":{const st=Te(u,{x:P,y:O});pn(st)&&Vn(a,u,st,a.timestamp),sn(u,{x:P,y:O});break}case"object":{const st=Te(u,{x:P,y:O});pn(st)&&Vn(a,u,st,a.timestamp);break}case"terrain":sn(u,{x:P,y:O});break}let S=p.get(d)??"";const E=ho(a,S),B=Tl(a,S),Z=E??B;switch(o){case"all":break;case"object":x(B)&&(S="");break;case"terrain":x(E)&&(S="");break;default:if(ki(a,Z)!==o&&(S=""),S){const st=Te(u,{x:P,y:O});pn(st)&&Vn(a,u,st,a.timestamp),sn(u,{x:P,y:O})}break}const D=S?bs(a,u,[S],N):void 0;if(!(!x(D)||!x(Z))&&(Cl(D,Z),W>0&&(D.char=W),et<w&&(D.color=et),L<w&&(D.bg=L),pn(D))){const st=xe(ea(h,S));x(st)&&(sn(u,{...eo(h,st.x??0,st.y??0),x:P,y:O}),Cl(D,st))}}return!0}function Ib(e){return`zss_snapshot_${e}`}function tM(e,t,n,r){const i=Je(y.book,yt.BOARD,e),s=Ne(i);if(!x(s))return;const o=Ib(s.id);V_(y.book,o);const a=Vi(Bt.CONTENT,o,yt.BOARD),c=Ne(a);if(x(c))return od(e,c.id,t,n,r),c}function eM(e,t,n,r){const i=Je(y.book,yt.BOARD,e),s=Ne(i);if(!x(s))return;const o=Ib(s.id),a=Je(y.book,yt.BOARD,o),c=Ne(a);if(x(c))return od(c.id,e,t,n,r),c}function nM(e,t,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return rM(e,t,i)}if(!x(y.book))return;const s=y.book,o=Je(s,yt.BOARD,e),a=Ne(o);if(!x(a))return;const c=Ah();ze(s,a);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let h=!1,d=!1;switch(i){case"all":h=!0,d=!0;break;case"object":h=!0;break;case"terrain":d=!0;break}const f=(u+t.x+Rt)%Rt,p=(l+t.y+Zt)%Zt;if(h){const m=Te(a,{x:u,y:l});pn(m)&&x(m==null?void 0:m.x)&&x(m==null?void 0:m.y)&&(m.x=f,m.lx=f,m.y=p,m.ly=p)}d&&(c.terrain[f+p*Rt]=a.terrain[u+l*Rt])}(i==="all"||i==="terrain")&&(a.terrain=[...c.terrain]),vl(s,a)}function rM(e,t,n){if(!x(y.book))return;const r=y.book,i=Je(r,yt.BOARD,e),s=Ne(i);if(!x(s))return;ze(r,s);const{objectelements:o,terrainelements:a}=YL(r,s,n);let c=!1;const l={};for(let h=0;h<a.length;++h){const d=a[h],f=Un(r,d,"collision"),p={x:d.x??-1,y:d.y??-1},m=Te(s,p);pn(m)&&x(m)&&(l[m.id??""]=!0);const w={x:p.x+t.x,y:p.y+t.y};if(Ac(w)){const b=Te(s,w),T=ki(r,b),A=Un(r,b,"collision");pn(b)&&n!==T?no(f,A)?c=!0:Un(r,b,"pushable")?c=To(r,s,b,w)!==!0:c=!1:A===Gt.ISSOLID&&n!==T&&(c=!0)}else c=!0}if(c)return;for(let h=0;h<o.length;++h){const d=o[h],f=Un(r,d,"collision"),p={x:d.x??0,y:d.y??0},m={x:p.x+t.x,y:p.y+t.y};if(Ac(m)){const w=Te(s,m),b=ki(r,w),T=Un(r,w,"collision");pn(w)&&x(w)&&n!==b&&!l[w.id??""]?Un(r,w,"pushable")?c=To(r,s,w,m)!==!0:c=!0:no(f,T)&&n!==b&&(c=!0)}else c=!0}if(c)return;(t.x>0||t.y>0)&&a.reverse();for(let h=0;h<a.length;++h){const d=a[h],f={x:d.x??-1,y:d.y??-1},p={x:f.x+t.x,y:f.y+t.y},m=eo(s,p.x,p.y);if(x(d)&&x(m)){sn(s,{...d,x:p.x,y:p.y}),sn(s,{...m,x:f.x,y:f.y});const w=Te(s,f);pn(w)&&x(w)&&(w.x=(w.x??0)+t.x,w.y=(w.y??0)+t.y,w.lx=(w.lx??0)+t.x,w.ly=(w.ly??0)+t.y)}}vl(r,s);for(let h=0;h<o.length;++h){const d=o[h],f={x:d.x??-1,y:d.y??-1},p={x:f.x+t.x,y:f.y+t.y};if(!To(r,s,d,p))break}vl(r,s)}function yo(e,t){let n="all";const r={x:0,y:0},i={x:Rt-1,y:Zt-1};for(let s=t;s<e.length;){const[o,a]=rt(e,s,[Y.MAYBE_NUMBER_OR_STRING]);if(kt(o))n=Ot(o),s=a;else if(St(o)){const[c,l,u,h]=rt(e,a,[Y.NUMBER,Y.NUMBER,Y.NUMBER]);r.x=Math.min(o,l),r.y=Math.min(c,u),i.x=Math.max(o,l),i.y=Math.max(c,u),s=h}else break}return{targetset:n,pt1:r,pt2:i}}const iM=Jr().command("snapshot",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;const n=yo(t,0);return tM(y.board.id,n.pt1,n.pt2,n.targetset),0}).command("revert",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;const n=yo(t,0);return eM(y.board.id,n.pt1,n.pt2,n.targetset),0}).command("copy",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;const[n,r]=rt(t,0,[Y.NAME]),i=Mn(y.book,yt.BOARD,n),s=xe(...i);if(x(s)){const o=yo(t,r);od(s.id,y.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;const[n,r,i,s]=rt(t,0,[Y.NAME,Y.NUMBER,Y.NUMBER]),o=Mn(y.book,yt.BOARD,n),a=xe(...o);if(x(a)){const c=yo(t,s);Sb(y.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!x(y.book)||!x(y.board))return 0;const[n,r]=rt(t,0,[Y.DIR]),i={x:n.x-(((o=y.element)==null?void 0:o.x)??0),y:n.y-(((a=y.element)==null?void 0:a.y)??0)},s=yo(t,r);return nM(y.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(e,t)=>{if(!x(y.book)||!x(y.board))return 0;const[n,r]=rt(t,0,[Y.NUMBER]),i=yo(t,r);return G6(y.board.id,Yp(n),i.pt1,i.pt2,i.targetset),0});var Hi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Hi||{});const sM={audio:Vf,board:a6,cli:f6,display:d6,element:w6,runtime:W6,lifecycle:x6,loader:j6,network:z6,transform:iM},ad=["audio","board","display","network","transform","lifecycle","element"],oM={0:[],1:["cli",...ad],2:["loader",...ad],3:["runtime",...ad]},aM={0:new Map,1:new Map,2:new Map,3:new Map};function _o(e){return(oM[e]??[]).map(n=>sM[n]).filter(x)}function cd(e){const t=[],n=_o(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function cM(e,t){const n=aM[e];if(!n.has(t)){let r;const i=_o(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!x(r));++s);n.set(t,r)}return n.get(t)}function lM(e,t,n){const r=_o(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function uM(e,t,n,r){const i=_o(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function hM(e,t){const n=_o(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function Nb(e,t){const n=_o(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var Ob={},Cb={},Lb={};const Mb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Lb.encode=function(e){if(0<=e&&e<Mb.length)return Mb[e];throw new TypeError("Must be between 0 and 63: "+e)};const fM=Lb,Ub=5,Fb=1<<Ub,dM=Fb-1,pM=Fb;function mM(e){return e<0?(-e<<1)+1:(e<<1)+0}Cb.encode=function(t){let n="",r,i=mM(t);do r=i&dM,i>>>=Ub,i>0&&(r|=pM),n+=fM.encode(r);while(i>0);return n};var Aa={};(function(e){function t(R,O,P){if(O in R)return R[O];if(arguments.length===3)return P;throw new Error('"'+O+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const O=R.match(n);return O?{scheme:O[1],auth:O[2],host:O[3],port:O[4],path:O[5]}:null}e.urlParse=i;function s(R){let O="";return R.scheme&&(O+=R.scheme+":"),O+="//",R.auth&&(O+=R.auth+"@"),R.host&&(O+=R.host),R.port&&(O+=":"+R.port),R.path&&(O+=R.path),O}e.urlGenerate=s;const o=32;function a(R){const O=[];return function(P){for(let W=0;W<O.length;W++)if(O[W].input===P){const et=O[0];return O[0]=O[W],O[W]=et,O[0].result}const N=R(P);return O.unshift({input:P,result:N}),O.length>o&&O.pop(),N}}const c=a(function(O){let P=O;const N=i(O);if(N){if(!N.path)return O;P=N.path}const W=e.isAbsolute(P),et=[];let L=0,S=0;for(;;)if(L=S,S=P.indexOf("/",L),S===-1){et.push(P.slice(L));break}else for(et.push(P.slice(L,S));S<P.length&&P[S]==="/";)S++;let E=0;for(S=et.length-1;S>=0;S--){const B=et[S];B==="."?et.splice(S,1):B===".."?E++:E>0&&(B===""?(et.splice(S+1,E),E=0):(et.splice(S,2),E--))}return P=et.join("/"),P===""&&(P=W?"/":"."),N?(N.path=P,s(N)):P});e.normalize=c;function l(R,O){R===""&&(R="."),O===""&&(O=".");const P=i(O),N=i(R);if(N&&(R=N.path||"/"),P&&!P.scheme)return N&&(P.scheme=N.scheme),s(P);if(P||O.match(r))return O;if(N&&!N.host&&!N.path)return N.host=O,s(N);const W=O.charAt(0)==="/"?O:c(R.replace(/\/+$/,"")+"/"+O);return N?(N.path=W,s(N)):W}e.join=l,e.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,O){R===""&&(R="."),R=R.replace(/\/$/,"");let P=0;for(;O.indexOf(R+"/")!==0;){const N=R.lastIndexOf("/");if(N<0||(R=R.slice(0,N),R.match(/^([^\/]+:\/)?\/*$/)))return O;++P}return Array(P+1).join("../")+O.substr(R.length+1)}e.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(R){return R}function f(R){return m(R)?"$"+R:R}e.toSetString=h?d:f;function p(R){return m(R)?R.slice(1):R}e.fromSetString=h?d:p;function m(R){if(!R)return!1;const O=R.length;if(O<9||R.charCodeAt(O-1)!==95||R.charCodeAt(O-2)!==95||R.charCodeAt(O-3)!==111||R.charCodeAt(O-4)!==116||R.charCodeAt(O-5)!==111||R.charCodeAt(O-6)!==114||R.charCodeAt(O-7)!==112||R.charCodeAt(O-8)!==95||R.charCodeAt(O-9)!==95)return!1;for(let P=O-10;P>=0;P--)if(R.charCodeAt(P)!==36)return!1;return!0}function w(R,O,P){let N=T(R.source,O.source);return N!==0||(N=R.originalLine-O.originalLine,N!==0)||(N=R.originalColumn-O.originalColumn,N!==0||P)||(N=R.generatedColumn-O.generatedColumn,N!==0)||(N=R.generatedLine-O.generatedLine,N!==0)?N:T(R.name,O.name)}e.compareByOriginalPositions=w;function b(R,O,P){let N=R.generatedLine-O.generatedLine;return N!==0||(N=R.generatedColumn-O.generatedColumn,N!==0||P)||(N=T(R.source,O.source),N!==0)||(N=R.originalLine-O.originalLine,N!==0)||(N=R.originalColumn-O.originalColumn,N!==0)?N:T(R.name,O.name)}e.compareByGeneratedPositionsDeflated=b;function T(R,O){return R===O?0:R===null?1:O===null?-1:R>O?1:-1}function A(R,O){let P=R.generatedLine-O.generatedLine;return P!==0||(P=R.generatedColumn-O.generatedColumn,P!==0)||(P=T(R.source,O.source),P!==0)||(P=R.originalLine-O.originalLine,P!==0)||(P=R.originalColumn-O.originalColumn,P!==0)?P:T(R.name,O.name)}e.compareByGeneratedPositionsInflated=A;function I(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=I;function U(R,O,P){if(O=O||"",R&&(R[R.length-1]!=="/"&&O[0]!=="/"&&(R+="/"),O=R+O),P){const N=i(P);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const W=N.path.lastIndexOf("/");W>=0&&(N.path=N.path.substring(0,W+1))}O=l(s(N),O)}return c(O)}e.computeSourceURL=U})(Aa);var ld={};let gM=class b1{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new b1;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};ld.ArraySet=gM;var Pb={};const Bb=Aa;function yM(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||Bb.compareByGeneratedPositionsInflated(e,t)<=0}let _M=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){yM(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Bb.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Pb.MappingList=_M;const va=Cb,Ke=Aa,Ll=ld.ArraySet,bM=Pb.MappingList;let Db=class E1{constructor(t){t||(t={}),this._file=Ke.getArg(t,"file",null),this._sourceRoot=Ke.getArg(t,"sourceRoot",null),this._skipValidation=Ke.getArg(t,"skipValidation",!1),this._sources=new Ll,this._names=new Ll,this._mappings=new bM,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new E1({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ke.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Ke.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Ke.getArg(t,"generated"),r=Ke.getArg(t,"original",null);let i=Ke.getArg(t,"source",null),s=Ke.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Ke.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ke.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ke.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Ke.relative(s,i));const o=this._mappings.toArray().length>0?new Ll:this._sources,a=new Ll;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Ke.join(r,c.source)),s!=null&&(c.source=Ke.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=Ke.join(r,c)),s!=null&&(c=Ke.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!Ke.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=va.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=va.encode(h-o),o=h,c+=va.encode(l.originalLine-1-i),i=l.originalLine-1,c+=va.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=va.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ke.relative(n,r));const i=Ke.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Db.prototype._version=3,Ob.SourceMapGenerator=Db;var $b={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})($b);var Ra={exports:{}},EM={},wM=Object.freeze({__proto__:null,default:EM}),jb=w1(wM);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Ra.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Ra.exports.initialize=t=>e=t}else{const e=jb,t=jb;Ra.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Ra.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var zb=Ra.exports;const xM=zb;function kM(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Sa=null;var TM=function(){if(Sa)return Sa;const t=[];return Sa=xM().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,h,d){const f=new kM;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Sa=null,n}),Sa};const At=Aa,ud=$b,Ml=ld.ArraySet,AM=zb,vM=TM,hd=Symbol("smcInternal");class De{constructor(t,n){return t==hd?Promise.resolve(this):SM(t,n)}static initialize(t){AM.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return IM(t,n)}static async with(t,n,r){const i=await new De(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}De.prototype._version=3,De.GENERATED_ORDER=1,De.ORIGINAL_ORDER=2,De.GREATEST_LOWER_BOUND=1,De.LEAST_UPPER_BOUND=2;class Ia extends De{constructor(t,n){return super(hd).then(r=>{let i=t;typeof t=="string"&&(i=At.parseSourceMapInput(t));const s=At.getArg(i,"version");let o=At.getArg(i,"sources");const a=At.getArg(i,"names",[]);let c=At.getArg(i,"sourceRoot",null);const l=At.getArg(i,"sourcesContent",null),u=At.getArg(i,"mappings"),h=At.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=At.normalize(c)),o=o.map(String).map(At.normalize).map(function(d){return c&&At.isAbsolute(c)&&At.isAbsolute(d)?At.relative(c,d):d}),r._names=Ml.fromArray(a.map(String),!0),r._sources=Ml.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return At.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,vM().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=At.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ia(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||De.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=At.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case De.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case De.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=At.getArg(t,"source");const r=At.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:At.getArg(t,"line"),generatedColumn:At.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=At.getArg(t,"bias",De.GREATEST_LOWER_BOUND);r==null&&(r=De.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=At.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=At.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=At.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:At.getArg(i,"originalLine",null),column:At.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=At.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=At.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=At.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:At.getArg(t,"line"),originalColumn:At.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=At.getArg(t,"bias",De.GREATEST_LOWER_BOUND);i==null&&(i=De.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:At.getArg(s,"generatedLine",null),column:At.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ia.prototype.consumer=De;class RM extends De{constructor(t,n){return super(hd).then(r=>{let i=t;typeof t=="string"&&(i=At.parseSourceMapInput(t));const s=At.getArg(i,"version"),o=At.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Ml,r._names=new Ml,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=At.getArg(c,"offset"),u=At.getArg(l,"line"),h=At.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new De(At.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(At.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(At.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:At.getArg(t,"line"),generatedColumn:At.getArg(t,"column")},r=ud.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(At.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=At.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||De.GENERATED_ORDER;let o;switch(s){case De.GENERATED_ORDER:o=this._generatedMappings;break;case De.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=At.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return ud.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=At.getArg(t,"line"),r={source:At.getArg(t,"source"),originalLine:n,originalColumn:At.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",At.compareByOriginalPositions,ud.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:At.getArg(o,"generatedLine",null),column:At.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:At.getArg(o,"generatedLine",null),column:At.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function SM(e,t){let n=e;typeof e=="string"&&(n=At.parseSourceMapInput(e));const r=n.sections!=null?new RM(n,t):new Ia(n,t);return Promise.resolve(r)}function IM(e,t){return Ia.fromSourceMap(e,t)}var Wb={};const NM=Ob.SourceMapGenerator,Ul=Aa,OM=/(\r?\n)/,CM=10,bo="$$$isSourceNode$$$";let LM=class Ad{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[bo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new Ad,s=t.split(OM);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=s[o]||"";const p=h.substr(0,f.generatedColumn-l);s[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)i.add(a()),c++;l<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=Ul.join(r,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const m=r?Ul.join(r,f.source):f.source;i.add(new Ad(f.originalLine,f.originalColumn,m,p,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[bo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[bo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[bo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[bo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Ul.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][bo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Ul.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new NM(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===CM?(n.line++,n.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};Wb.SourceNode=LM;var MM=Wb.SourceNode;let Kb=0;const Gb=qr,UM=["Command","lines"];class FM extends hL{constructor(){super(B_,{traceInitPerf:qr,skipValidations:!qr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Lt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Lt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(xa)}])}));Lt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Lt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Lt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Lt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(h_)}));Lt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(vf)}));Lt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Rf)}])}));Lt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(u_)}));Lt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(f_),this.SUBRULE(this.words),this.CONSUME(d_)}));Lt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(uo),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Lt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Lt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Lt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Lt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Lf),this.SUBRULE(this.words)}));Lt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(v_),this.SUBRULE(this.words)}));Lt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Mf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Lt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(wl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(xa)),this.CONSUME4(uo),this.CONSUME4(Uf)}}])}));Lt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(wl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(uo),this.CONSUME(Uf)}}])}));Lt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(wl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Lt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(uo),this.CONSUME(Ff),this.CONSUME(Mf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Lt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(uo),this.CONSUME(Ff),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Lt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(O_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(C_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(L_),this.SUBRULE(this.words)}));Lt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(M_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Lt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(U_)}));Lt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(F_)}));Lt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(I_)}));Lt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(N_)}));Lt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Sf),this.SUBRULE2(this.and_test)})}));Lt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Nf),this.SUBRULE2(this.not_test)})}));Lt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(If),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Lt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Lt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(g_)},{ALT:()=>this.CONSUME(y_)},{ALT:()=>this.CONSUME(__)},{ALT:()=>this.CONSUME(b_)},{ALT:()=>this.CONSUME(E_)},{ALT:()=>this.CONSUME(w_)}])}));Lt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Sf),this.SUBRULE2(this.and_test_value)})}));Lt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Nf),this.SUBRULE2(this.not_test_value)})}));Lt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(If),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Lt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Lt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Of)},{ALT:()=>this.CONSUME(Cf)}]),this.SUBRULE(this.term)}));Lt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Lt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(k_)},{ALT:()=>this.CONSUME(Lf)},{ALT:()=>this.CONSUME(T_)},{ALT:()=>this.CONSUME(A_)}]),this.SUBRULE(this.factor)}));Lt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Of)},{ALT:()=>this.CONSUME(Cf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Lt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(x_),this.SUBRULE(this.factor)})}));Lt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Lt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(p_)},{ALT:()=>this.CONSUME(hn)},{ALT:()=>this.CONSUME(m_)},{ALT:()=>{this.CONSUME(R_),this.SUBRULE(this.words),this.CONSUME(S_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=UM.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(Kb++).toString().padStart(3),c=s?"font-weight: bold;":"";if(Gb&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),Gb&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),Kb--},i)}}const Eo=new FM;if(TL){const e=Eo.getGAstProductions(),t=kL(e);console.info(t)}const PM=Eo.getBaseCstVisitorConstructor();var _t=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(_t||{}),ws=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(ws||{}),Zr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Zr||{}),Fl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Fl||{});function BM(e){return!!(e!=null&&e.tokenType)}function hr(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class DM extends PM{constructor(){super();Lt(this,"unique",0);qr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&BM(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:hr(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:hr(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:hr(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:hr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:hr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,hr(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Ue(),i=Ue();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Ue(),i=Ue();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,hr(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Ue(),i=Ue();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Ue(),i=Ue(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Ue(),i=Ue(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Ue();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=hr(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}command_toast(n){const i=hr(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,"toast"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=hr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=hr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(hr(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.words)}):[]}}const $M=new DM,Fn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Pl="zss.js";function te(e,t){return new MM(e.startLine??1,e.startColumn??1,Pl,t)}function fd(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function dd(e){return`'${fd(e)}'`}function Bl(e){if(e.startsWith('"'))return Bl(e.replaceAll(/(^"|"$)/g,""));const t=td(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Zf?`', api.get('${fd(r.image.substring(1))}'), '`:fd(r.image)).join("")}'].join('')`}function wo(e){return e.filter(t=>t!==void 0).map(ie)}function Hb(e){return te(e,"")}function jM(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function Ze(e,t,n){return te(e,[`api.${t}(`,...jM(n,", "),")"])}function zM(e){if(e.type===_t.COMPARE&&e.compare.type===_t.COMPARE_ITEM)switch(e.compare.method){case ws.IS_EQ:return Ze(e,"isEq",[ie(e.lhs),ie(e.rhs)]);case ws.IS_NOT_EQ:return Ze(e,"isNotEq",[ie(e.lhs),ie(e.rhs)]);case ws.IS_LESS_THAN:return Ze(e,"isLessThan",[ie(e.lhs),ie(e.rhs)]);case ws.IS_GREATER_THAN:return Ze(e,"isGreaterThan",[ie(e.lhs),ie(e.rhs)]);case ws.IS_LESS_THAN_OR_EQ:return Ze(e,"isLessThanOrEq",[ie(e.lhs),ie(e.rhs)]);case ws.IS_GREATER_THAN_OR_EQ:return Ze(e,"isGreaterThanOrEq",[ie(e.lhs),ie(e.rhs)])}return te(e,"")}function xs(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ie(n),")"])}function Yb(e,t,n){return e.prepend(`api.${t}(`),e.add([ie(n),")"])}function WM(e,t){if(e.type===_t.OPERATOR_ITEM)switch(e.operator){case Zr.PLUS:return xs(t,"opPlus",e.rhs);case Zr.MINUS:return xs(t,"opMinus",e.rhs);case Zr.POWER:return xs(t,"opPower",e.rhs);case Zr.MULTIPLY:return xs(t,"opMultiply",e.rhs);case Zr.DIVIDE:return xs(t,"opDivide",e.rhs);case Zr.MOD_DIVIDE:return xs(t,"opModDivide",e.rhs);case Zr.FLOOR_DIVIDE:return xs(t,"opFloorDivide",e.rhs);case Zr.UNI_PLUS:return Yb(t,"opUniPlus",e.rhs);case Zr.UNI_MINUS:return Yb(t,"opUniMinus",e.rhs)}return te(e,"")}function KM(e){if(e.type===_t.OPERATOR){const t=e.lhs?ie(e.lhs):te(e,"");return e.items.forEach(n=>WM(n,t)),t}return te(e,"")}function Dl(e,t){return te(e,[Ze(e,"jump",[`${t}`]),"; continue;"])}function Ri(e){return Fn.linelookup[e??""]??-1}function pd(e,t){Fn.linelookup[e]=t}function xo(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case _t.WHILE:case _t.REPEAT:case _t.FOREACH:case _t.ELSE_IF:i.type===t&&(i.done=n);break;case _t.IF_BLOCK:case _t.IF_CHECK:i.type===t&&(i.skip=n);break;case _t.LINE:xo(i.stmts,t,n);break}}}function Vb(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case _t.WHILE:case _t.REPEAT:case _t.FOREACH:case _t.ELSE_IF:i.type===t&&pd(i.done,n);break;case _t.IF_BLOCK:case _t.IF_CHECK:i.type===t&&pd(i.skip,n);break;case _t.LINE:Vb(i.stmts,t,n);break}}}function ie(e){var t;switch(e.type){case _t.PROGRAM:return te(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ie).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Pl}`]);case _t.API:return te(e,["  ",Ze(e,e.method,wo(e.words)),`;
`]);case _t.LINE:return te(e,[`case ${e.lineindex}:
`,...e.stmts.map(ie).flat(),`  break;
`]);case _t.MARK:return te(e,`  // ${e.comment}
`);case _t.GOTO:{const n=Ri(e.id);return te(e,["  ",Dl(e,n),`
`])}case _t.COUNT:return te(e,`${e.index}`);case _t.LITERAL:switch(e.literal){case Fl.NUMBER:return te(e,`${e.value}`);case Fl.STRING:return te(e,dd(e.value));case Fl.TEMPLATE:return te(e,Bl(e.value))}return Hb(e);case _t.TEXT:return te(e,["  ",Ze(e,"text",[Bl(e.value)]),`;
`]);case _t.STAT:if(Fn.isfirststat){Fn.isfirststat=!1;const n=e.value.trim().split(" ").map(dd);return te(e,["  ",Ze(e,"stat",n),`;
`])}return te(e,`  // skipped ${e.value}
`);case _t.LABEL:{const n=Ot(e.name),r=e.active?"label":"comment";Fn.labels[n]||(Fn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Fn.labels[n].push(i),te(e,`  // ${i} '${n}' ${r}
`)}case _t.HYPERLINK:return te(e,["  ",Ze(e,"hyperlink",[Bl(e.text),...wo(e.link)]),`;
`]);case _t.MOVE:{const n=Ze(e,"command",[dd("go"),wo(e.words)].flat());return e.wait?te(e,["  if (",n,`) { continue; };
`]):te(e,["  ",n,`;
`])}case _t.COMMAND:return te(e,["  if (",Ze(e,"command",wo(e.words)),`) { continue; };
`]);case _t.IF:{const n=((t=e.block)==null?void 0:t.type)===_t.IF_BLOCK?e.block:void 0;if(x(n)){xo([e.check],_t.IF_CHECK,n.skip);const r=te(e,ie(e.check));return n.lines.forEach(i=>r.add(ie(i))),Vb(n.altlines,_t.ELSE_IF,Ri(n.done)),n.altlines.forEach(i=>r.add(ie(i))),r}return te(e,ie(e.check))}case _t.IF_CHECK:{const n=Ri(e.skip);return n===-1?te(e,["  ",Ze(e,e.method,wo(e.words)),`;
`]):te(e,["  if (!",Ze(e,e.method,wo(e.words)),") { ",Dl(e,n),` }
`])}case _t.ELSE_IF:case _t.ELSE:{const n=te(e,"");return e.lines.forEach(r=>n.add(ie(r))),n}case _t.WHILE:{const n=Ri(e.loop),r=Ri(e.done),i=te(e,"");return xo(e.lines,_t.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case _t.BREAK:s.goto=r;break;case _t.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case _t.REPEAT:{const n=Ri(e.loop),r=Ri(e.done),i=te(e,"");return xo(e.lines,_t.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case _t.BREAK:s.goto=r;break;case _t.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case _t.WAITFOR:{const n=te(e,"");return xo(e.lines,_t.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ie(r))}),n}case _t.FOREACH:{const n=Ri(e.loop),r=Ri(e.done),i=te(e,"");return xo(e.lines,_t.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case _t.BREAK:s.goto=r;break;case _t.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case _t.BREAK:return te(e,["  ",Dl(e,e.goto),`
`]);case _t.CONTINUE:return te(e,["  ",Dl(e,e.goto),`
`]);case _t.OR:return Ze(e,"or",e.items.map(ie));case _t.AND:return Ze(e,"and",e.items.map(ie));case _t.NOT:return Ze(e,"not",e.items.map(ie));case _t.COMPARE:return zM(e);case _t.OPERATOR:return KM(e);case _t.EXPR:return Ze(e,"expr",e.words.map(ie));default:return console.error("<unsupported node>",e.type,e),Hb(e)}}function Qr(e){if(x(e))switch(e.type===_t.LINE&&++Fn.lineindex,e.lineindex=Fn.lineindex,e.type){case _t.PROGRAM:e.lines.forEach(Qr);break;case _t.LINE:e.stmts.forEach(Qr);break;case _t.MARK:pd(e.id,e.lineindex);break;case _t.IF:Qr(e.check),Qr(e.block);break;case _t.IF_BLOCK:e.lines.forEach(Qr),e.altlines.forEach(Qr);break;case _t.ELSE_IF:e.lines.forEach(Qr);break;case _t.ELSE:case _t.WHILE:case _t.REPEAT:case _t.FOREACH:case _t.WAITFOR:e.lines.forEach(Qr);break;case _t.MOVE:case _t.COMMAND:case _t.IF_CHECK:e.words.forEach(Qr);break}}function GM(e){return Fn.labels={},Fn.internal=1,Fn.lineindex=0,Fn.isfirststat=!0,Qr(e),{...ie(e).toStringWithSourceMap({file:`${Pl}.map`}),...Fn}}function Xb(e){return ae(e)?e.length>0?1:0:e??0}function HM(e){return`${e}_chip`}function qb(e=""){return`vm:${e??""}`}function YM(e,t,n){var l,u;const r=HM(e),i=ti(r);let s;const o=$n(Object.entries(n.labels??{}));(!ae(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(h,d){y.words=d;const f=cM(t,h);return x(f)?f(c,d):h!=="send"?a("send",[h,...d]):0}const c={halt(){c8(r)},id(){return e},set(h,d){const[f,p]=uM(t,c,h,d);if(f)return p},get(h){const[d,f]=lM(t,c,h);if(d)return f},tick(h){const d=St(i.ps)?i.ps:0,f=d%h===0;if(i.ps=d+1,f===!1)return!1;if(c.shouldtick()===!1)return Nb(t,c),!1;i.lc=0,i.ys=0,y.get=c.get,hM(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){_e(H,y.elementfocus,"crash",p.message),i.es=1}return Nb(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return St(i.lc)?++i.lc>bi.HALT_AT_COUNT:!0},hm(){if(ae(i.mg)&&ae(i.lb)){const[h]=i.mg;if(x(h))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)return p.find(m=>St(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,d,f,p){H.emit(h,`${qb(d)}:${f}`,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h){const m=p.findIndex(w=>w>0);m>=0&&(p[m]*=-1)}}},restore(h){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)for(let m=0;m<p.length;m++)p[d]=Math.abs(p[d])}},getcase(){i.ec=St(i.ec)?i.ec:1;const h=c.hm();if(h&&ae(i.mg)){const[,d,f,p]=i.mg;c.set("sender",f),x(d)&&c.set("arg",d),p&&(c.set("player",p),y.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=St(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const d=qL.parse(h),[f]=d.filter(p=>p.fileName===Pl);return{line:(f==null?void 0:f.lineNumber)??0,column:(f==null?void 0:f.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[d,...f]=h;return a(Ot(ue(d)),f)},if(...h){const[d,f]=rt(h,0,[Y.ANY]),p=Xb(d);return p&&f<h.length&&c.command(...h.slice(f)),p?1:0},try(...h){const[,d]=rt(h,0,[Y.DIR]),f=c.command("go",...h);return f&&d<h.length&&c.command(...h.slice(d)),f?1:0},take(...h){const[d,f,p]=rt(h,0,[Y.NAME,Y.ANY]),m=St(f),w=m?p:1,b=c.get(d),T=m?f:1;if(!St(b))return w<h.length&&c.command(...h.slice(w)),1;const A=b-T;return A<0?(w<h.length&&c.command(...h.slice(w)),1):(c.set(d,A),0)},give(...h){const[d,f,p]=rt(h,0,[Y.NAME,Y.ANY]),m=St(f),w=m?p:1,b=c.get(d),T=m?f:1,A=b===void 0?1:0;return A&&w<h.length&&c.command(...h.slice(w)),c.set(d,na(b,0)+T),A},repeatstart(h,...d){const[f,p]=rt(d,0,[Y.NUMBER]),m=`repeatcount${h}`,w=`repeatwords${h}`;i[m]=f,i[w]=p<d.length?d.slice(p):void 0},repeat(h){const d=`repeatcount${h}`,f=`repeatwords${h}`;if(!St(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,w=i[f];return m&&ae(w)&&c.command(...w),m?1:0},foreachstart(h,...d){const[f,p,m,w]=rt(d,0,[Y.NAME,Y.NUMBER,Y.NUMBER,Y.MAYBE_NUMBER]);let b=Math.min(p,m),T=Math.max(p,m);const A=(w??0)||1;if(A<0){const I=b;b=T,T=I}return c.set(f,b-A),0},foreach(h,...d){const[f,p,m,w,b]=rt(d,0,[Y.NAME,Y.NUMBER,Y.NUMBER,Y.MAYBE_NUMBER]);let T=Math.min(p,m),A=Math.max(p,m);const I=(w??0)||1;if(I<0){const O=T;T=A,A=O}let U=c.get(f);!St(U)||U<T||U>A?U=T:U+=I;const R=U<=A?1:0;return R&&(c.set(f,U),b<d.length&&c.command(...d.slice(b))),R},waitfor(...h){const[d]=rt(h,0,[Y.ANY]),f=Xb(d);return f||c.yield(),f?1:0},or(...h){let d=0;for(let f=0;f<h.length;){const[p,m]=rt(h,f,[Y.ANY]);if(d=p,d)break;f=m}return d},and(...h){let d=0;for(let f=0;f<h.length;){const[p,m]=rt(h,f,[Y.ANY]);if(d=p,!d)break;f=m}return d},not(...h){const[d]=rt(h,0,[Y.ANY]);return d?0:1},expr(...h){const[d]=rt(h,0,[Y.ANY]);return d},isEq(h,d){const[f]=rt([h],0,[Y.ANY]),[p]=rt([d],0,[Y.ANY]);return typeof f=="object"||typeof p=="object"?tE(f,p)?1:0:f===p?1:0},isNotEq(h,d){return this.isEq(h,d)?0:1},isLessThan(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return f<p?1:0},isGreaterThan(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return f>p?1:0},isLessThanOrEq(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return f<=p?1:0},isGreaterThanOrEq(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return f>=p?1:0},opPlus(h,d){const[f]=rt([h],0,[Y.ANY]),[p]=rt([d],0,[Y.ANY]);return f+p},opMinus(h,d){const[f]=rt([h],0,[Y.ANY]),[p]=rt([d],0,[Y.ANY]);return f-p},opPower(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return Math.pow(f,p)},opMultiply(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return f*p},opDivide(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return f/p},opModDivide(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return f%p},opFloorDivide(h,d){const[f]=rt([h],0,[Y.NUMBER]),[p]=rt([d],0,[Y.NUMBER]);return Math.floor(f/p)},opUniPlus(h){const[d]=rt([h],0,[Y.NUMBER]);return+d},opUniMinus(h){const[d]=rt([h],0,[Y.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function md(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ae(r)?r.forEach(i=>{t.push(md(i))}):t.push(md(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function VM(e){const t=Pf(`${e}
`);if(t.errors.length>0)return t;Eo.input=t.tokens;const n=Eo.program();if(Eo.errors.length>0)return{tokens:t.tokens,errors:Eo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=$M.go(n);return r?(md(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const gd=Object.getPrototypeOf(function*(){}).constructor;function XM(e,t){const n=`compile-${e}`;console.time(n);const r=VM(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=GM(r.ast);if(i.code){AL&&console.info(i.code);try{return{...r,...i,source:i.code,code:new gd("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new gd("api"," ")}}}return{...r,...i,source:"",code:new gd("api"," ")}}function qM(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=XM(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return x(s)?s.isended():!0},halt(i){const s=t[i];return x(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!x(t[i])){const h=n(a,c);if(l=t[i]=YM(i,s,h),(u=h.errors)!=null&&u.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((b,T)=>[b,T]);p.slice(f-5,f).forEach(([b,T])=>{_e(H,Sr(),"build",`$grey${T+1} $grey${b}`)});const[m,w]=p[f]??[];if(kt(m)&&x(w)){const b=(d.column??1)-1,T=b+d.length,A=b<m.length?m:`${m}*`,I=A.substring(0,b),U=A.substring(b,T),R=A.substring(T);_e(H,Sr(),"build",`$red${w+1} $grey${I}$red${U}$grey${R}`)}return d.message.split(`
`).forEach(b=>{_e(H,Sr(),"build",b)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=pr(i.target),a=t[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}let Jb=0;function JM(){switch(Jb++){case 0:return Wt.BLUE;case 1:return Wt.GREEN;case 2:return Wt.CYAN;case 3:return Wt.RED;case 4:return Wt.PURPLE;case 5:return Wt.YELLOW;default:return Jb=0,Wt.WHITE}}const Ge=new Yo,xn={},$l={};function Zb(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return x(xn[s])||(xn[s]=WT(e,t,n,r,i)),xn[s]}function ZM(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return x($l[s])||($l[s]=KT(e,t,n)),$l[s].id=i,$l[s]}function QM(e,t){const n=`sprites:${e}:${t}`;return x(xn[n])||(xn[n]=GT(e,t)),xn[n]}function t8(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return x(xn[s])||(xn[s]=HT(e,t,n,r,i)),xn[s]}function yd(e,t,n,r){const i=`media:${e}:${t}`;x(xn[i])||(xn[i]=YT(e,t,n,r));const s=xn[i];return s.mime=n,s.media=r,s}function e8(e,t){const n=`control:${e}:${t}`;return x(xn[n])||(xn[n]=VT(e,t)),xn[n]}const Yi=.4;function Qb(e,t){const n=[];Ge.x=e-Yi,Ge.y=t-Yi,n.push(Ge.angle()),Ge.x=e+Yi,Ge.y=t-Yi,n.push(Ge.angle()),Ge.x=e-Yi,Ge.y=t+Yi,n.push(Ge.angle()),Ge.x=e+Yi,Ge.y=t+Yi,n.push(Ge.angle());const r=Math.round(uh(Math.min(...n))),i=Math.round(uh(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function _d(e,t,n,r,i,s){var O;if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const o=[];let a=t;const c=Rt,l=Zt,u=s?Wt.BLACK:Wt.ONCLEAR,h=Zb(e,a++,c,l,u);o.push(h);const d=a++,f=QM(e,d);f.sprites=[],o.push(f);const p=r.isdark?1:0,m=t8(e,a++,c,l,p);o.push(m),m.alphas.fill(p);const w=Zb(e,a++,c,l,Wt.ONCLEAR);o.push(w),w.char.fill(0);const b={...ed(Rt,Zt,JM(),Wt.ONCLEAR),...w},T=e8(e,a++);if(i){if(o.push(T),kt(r.camera))switch(Ot(r.camera)){default:case"mid":T.viewscale=Nc.MID;break;case"near":T.viewscale=Nc.NEAR;break;case"far":T.viewscale=Nc.FAR;break}if(kt(r.graphics)){const N=Ot(r.graphics);switch(N){case"mode7":case"firstperson":T.graphics=N;break;default:case"flat":T.graphics="flat";break}}const{facing:P}=ti(e);St(P)&&(T.facing=Yp(P%360))}for(let P=0;P<r.terrain.length;++P){const N=r.terrain[P],W=X_(n,N,0,Wt.WHITE,s?Wt.BLACK:Wt.ONCLEAR);h.char[P]=W.char,h.color[P]=W.color,h.bg[P]=W.bg}const A=Object.values(r.objects??{});for(let P=0;P<A.length;++P){const N=A[P];if(x(N.removed))continue;const W=N.id??"",et=X_(n,N,1,Wt.WHITE,Wt.ONCLEAR),L=ZM(e,d,W,P);if(L.x=N.x??0,L.y=N.y??0,L.char=et.char,L.color=et.color,L.bg=et.bg,f.sprites.push(L),p){if(et.light>0){const S=[],E=cn(Math.round(et.light),1,Rt),B=E*.5,Z=Er(r,L),D=1/B;if(m.alphas[Z]=0,E>1)for(let st=1;st<=E;++st)for(let tt=L.y-st;tt<=L.y+st;++tt)for(let ft=L.x-st;ft<=L.x+st;++ft){if(ft===L.x&&tt===L.y)continue;Ge.x=ft-L.x,Ge.y=tt-L.y;const V=Ge.length();if(V>E)continue;const z=Er(r,{x:ft,y:tt});if(z===-1)continue;const Et=Math.round(uh(Ge.angle()));let at=0;for(let Tt=0;Tt<S.length;++Tt){const Dt=S[Tt];Et>=Dt[0]&&Et<=Dt[1]&&(at=Math.max(at,Dt[2]))}m.alphas[z]=Math.min(m.alphas[z],at+(V<B?0:(V-B)*D)),m.alphas[z]=cn(m.alphas[z],0,1);const lt=_n(r,((O=r.lookup)==null?void 0:O[z])??"");if(x(lt)){const Tt=[...Qb(Ge.x,Ge.y),.25];S.push(Tt)}const Mt=r.terrain[z],Xt=Rr(n,Mt),Ut=(Mt==null?void 0:Mt.collision)??(Xt==null?void 0:Xt.collision);if(no(Gt.ISBULLET,Ut)){const Tt=[...Qb(Ge.x,Ge.y),1];let Dt=0;for(Dt=0;Dt<S.length;++Dt){const Ft=S[Dt];if(Ft[1]>Ft[0]&&Tt[1]>=Ft[0]&&Tt[0]<=Ft[1]&&Tt[2]>=1&&Ft[2]>=1){S[Dt]=[Math.min(Tt[0],Ft[0]),Math.max(Tt[1],Ft[1]),1];break}}Dt===S.length&&S.push(Tt)}}}else if(dr(W)){const S=Er(r,L);m.alphas[S]=0}}if(kt(N.tickertext)&&St(N.tickertime)&&N.tickertext.length){const S=Rt,E=fb(N.tickertext,S,Zt-1),B=(E==null?void 0:E.measuredwidth)??1,Z=N.x??0,D=N.y??0,st=D<Zt*.5;b.x=Z-Math.floor(B*.5),b.y=D+(st?1:-1),b.x+B>Rt&&(b.x=Rt-B),b.x<0&&(b.x=0),hb(N.tickertext,b,!0)}W===e&&(T.focusx=L.x,T.focusy=L.y,T.focusid=W)}const I=he(Bt.MAIN),U=Ti(I,Bt.MAIN);if(kt(U.palette)){const P=Je(I,yt.PALETTE,U.palette),N=Ne(P);x(N==null?void 0:N.bits)&&o.push(yd(e,a++,"image/palette",Array.from(N.bits)))}if(kt(U.charset)){const P=Je(I,yt.CHARSET,U.charset),N=Ne(P);x(N==null?void 0:N.bits)&&o.push(yd(e,a++,"image/charset",Array.from(N.bits)))}const R=Object.keys(r.objects).filter(dr);return o.push(yd(e,a++,"text/players",R.join(","))),o}const Xn=qM();var Bt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Bt||{});const Ee={halt:!1,session:Ue(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function n8(){return Ee.session}function Sr(){return Ee.operator}function r8(e){Ee.operator=e}function i8(e){Ee.halt=e}function s8(){return Ee.halt}function ko(){return[...Ee.books.values()]}function o8(){const[e]=Ee.books.values();return e}function Ir(e){const t=Ot(e);return Ee.books.get(e)??ko().find(n=>n.name===t)}function jl(e,t){x(Ir(t))&&(Ee.software[e]=t)}function he(e){return Ir(Ee.software[e])}function t1(e){const t=K_([]);return kt(e)&&(t.name=e),bd(t),ri(H,Ee.operator,`created [book] ${t.name}`),t}function a8(e){let t=Ir(e);return x(t)||(t=K_([]),t.name=e),bd(t),ri(H,Ee.operator,`created [book] ${t.name}`),t}function kn(e,t){let n=x(t)?a8(t):he(e);return x(n)||(x(n)||(n=o8()),x(n)||(n=t1(t)),x(n)&&ri(H,Ee.operator,`opened [book] ${n.name} for ${e}`)),jl(e,n.id),n}function Vi(e,t,n){return zf(kn(e),n,t)}function ti(e){const t=kn("main");return Ti(t,e)}function e1(){const e=kn("main");return Ti(e,"main")}function c8(e){const t=kn("main");return q_(t,e)}function l8(e,t){Ee.books.clear(),e.forEach(r=>{Ee.books.set(r.id,r),r.name==="main"&&(Ee.software.main=r.id)});const n=Ir(t);if(x(n)&&jl("main",n.id),!Ee.software.main){const r=Ee.books.values().next();r.value&&(Ee.software.main=r.value.id)}}function bd(e){return Ee.books.set(e.id,e),e.id}function u8(e){const t=Ir(e);t&&Ee.books.delete(t.id)}function h8(e){if(!kt(e)||!e)return _e(H,e,"login",`failed for playerid ==>${e}<==`);const t=he("main");if(!x(t))return _e(H,e,"login:main","login failed to find book 'main'");const n=_s(t,e);if(x(n))return!0;const r=Mn(t,yt.BOARD,"title");if(r.length===0)return _e(H,e,"login:title","login failed to find board with 'title' stat");const i=ho(t,"player");if(!x(i))return _e(H,e,"login:player","login failed to find object type 'player'");const s=qp(e,r),o=Ne(s);if(x(o)){const a=W_(s,"startx"),c=W_(s,"starty"),l=St(a)?a:Math.round(Rt*.5),u=St(c)?c:Math.round(Zt*.5),h=i.name??"player",d=Sh(o,{x:l,y:u},h,e);if(x(d==null?void 0:d.id))return d.player=e,Al(t,e,o.id),!0}return!1}function f8(e){const t=he("main"),n=_s(t,e);Al(t,e,""),Kf(t,n,_n(n,e)),Lm(n,e),Xn.halt(e),q_(t,e)}function qn(e){const t=he("main");return _s(t,e)}function d8(e){const t=he("main"),n=BL(t,e),r=_s(t,e),i=_n(r,e);return n&&x(i)}function p8(e){const t=he("main"),n=Wf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;dr(c)&&x(e[c])===!1&&(e[c]=0,Al(t,c,i.id))}}}function n1(e){Xn.message(e)}function Na(e,t,n,r){const i=Pi(t);kt(n.id)&&H.emit(e,"vm:touched",[n.id,i,r])}function To(e,t,n,r){if(!x(n==null?void 0:n.id))return!1;const i=Hf(e,t,n,r);if(x(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=Mn(e,yt.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=xe(o);fo(e,n.id,a.id,{x:Rt-1,y:r.y})}}else if(r.x>=Rt){const o=Mn(e,yt.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=xe(o);fo(e,n.id,a.id,{x:0,y:r.y})}}else if(r.y<0){const o=Mn(e,yt.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=xe(o);fo(e,n.id,a.id,{x:r.x,y:Zt-1})}}else if(r.y>=Zt){const o=Mn(e,yt.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=xe(o);fo(e,n.id,a.id,{x:r.x,y:0})}}}else Na("",i,n,"thud");if(n.kind==="player"){const o=dr(i.id);Na(n.id,n,i,o?"bump":"touch")}else if(n.collision===Gt.ISBULLET){const o=dr(n.party),a=dr(i.id);o!==a?Na(n.party??"",n,i,"shot"):Na("",n,i,"thud")}else Na("",n,i,"bump");const s=Rr(e,i);return i.destructible??(s==null?void 0:s.destructible)?(x(i==null?void 0:i.id)?Vn(y.book,y.board,i,y.timestamp):sn(t,{x:r.x,y:r.y}),!0):!1}return!0}function r1(e,t,n,r,i=GE){var h;if(!x(e)||!x(t)||!x(n))return;const s={...y};y.book=e,y.board=t,y.element=n,y.elementid=n.id??"",y.elementisplayer=dr(y.elementid);const o=y.element.player??Ee.operator;y.elementfocus=y.elementisplayer?y.elementid:o;const a=Rr(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=Ot(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Xn.tick(l,Hi.RUNTIME,St(c)?c:i,u,r),St(n==null?void 0:n.tickertime)&&y.timestamp-n.tickertime>Ba*5&&(n.tickertime=0,n.tickertext=""),y.elementisplayer){const d=ti(y.elementid);St(d.inputcurrent)&&(d.inputcurrent=0)}Nr(s).forEach(d=>{y[d]=s[d]})}function m8(e,t){Ee.loaders.set(e,t)}function g8(e){Xn.halt(e)}function y8(){const e=Xn.ids();for(let n=0;n<e.length;++n)Xn.halt(e[n]);const t=he("main");x(t)&&(t.flags={})}function _8(){const e=he("main");if(!x(e))return;const t=e.timestamp+1,n=bi.HALT_AT_COUNT;bi.HALT_AT_COUNT=n*2,Ee.loaders.forEach((i,s)=>{const o={...y};y.timestamp=e.timestamp,y.book=e,y.board=void 0,y.element=void 0,y.elementid=s,y.elementisplayer=!1,y.elementfocus="";const a=k6(s);x(a)&&Xn.arg(s,a),Xn.tick(s,Hi.LOADER,1,"loader",i),Xn.isended(s)&&(Xn.halt(s),Ee.loaders.delete(s)),Nr(o).forEach(c=>{y[c]=o[c]})}),bi.HALT_AT_COUNT=n,e.timestamp=t,y.timestamp=t;const r=Wf(e);for(let i=0;i<r.length;++i){const s=r[i],o=HL(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:l,code:u,object:h}=o[a];l===yt.ERROR?Xn.halt(c):r1(e,s,h,u)}}}function Ed(e,t){const n=he("main");if(!x(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(x(u.id)){const h=`${qb(u.id)}:${c}`;H.emit("",h,t)}}}const{target:i,path:s}=pr(e),o=Wf(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Ot(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(Um(c,[i]),s);break}}}}function b8(e){const t=ti(e).playbuffer;kt(t)&&t&&i1(e,t)}function i1(e,t=""){var s;const n=kn("main");if(!x(n))return;const r=`${e}_cli`;y.timestamp=n.timestamp,y.book=n,y.board=_s(n,e),y.element=_n(y.board,e),y.elementid=((s=y.element)==null?void 0:s.id)??"",y.elementisplayer=!0,y.elementfocus=y.elementid||e;const i=bi.HALT_AT_COUNT;bi.HALT_AT_COUNT=i*8,Dd(H,e,"running",n.timestamp,r,t),Xn.once(r,Hi.CLI,"cli",t),ti(e).playbuffer=t,bi.HALT_AT_COUNT=i}function zl(e){var o;const t=kn("main"),n=xi(t,e);if(!x(t)||!x(n)||!x(y.element))return;const r=`${e}_run`,i=Ot(y.element.name??((o=y.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";Xn.once(r,Hi.RUNTIME,i,s)}function E8(e){const t=he("main"),n=_s(t,e),r=[],i=[],s=[];if(!x(t)||!x(n))return{over:r,under:i,layers:s};const o=n.graphics??"flat",a=Wi(t,n.overboard??""),c=Wi(t,n.underboard??"");return i.push(..._d(e,0,t,c,!1,!0)),s.push(..._d(e,i.length,t,n,!0,o!=="flat")),r.push(..._d(e,i.length+s.length,t,a,!1,!1)),{over:r,under:i,layers:s}}function Ao(e,t=0){const n=[];let r=e;for(;r<y.words.length;){const[i,s]=Pn(r);if(ae(i)&&!os(i)&&!Ta(i)&&!Sl(i)&&!$r(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Pn(e){var r,i,s,o,a,c,l,u,h;const t=y.words[e],n=e+1;if(gb(t)){const[d,f]=p6(e);if(x(d))return[d,f]}if(m6(t)){const[d,f]=g6(e);if(x(d))return[d,f]}if(dh(t)){const[d,f]=ph(e);if(x(d))return[d,f]}if(kt(t)&&Ot(t)==="rnd"){const[d,f]=Pn(n),[p,m]=Pn(f);return St(d)&&St(p)?[er(d,p),m]:St(d)?[er(0,d),f]:[er(0,1),n]}if(fh(t)){const[d,f]=Qp(e);if(x(d))return[d,f]}if(!x(t))return[void 0,e];if(St(t)||ae(t))return[t,n];if(kt(t)){const d=Ot(t),f=(r=y.get)==null?void 0:r.call(y,t);if(x(f))return[f,n];switch(d){case"aligned":case"alligned":{const p=ta(y.board,{x:((i=y.element)==null?void 0:i.x)??-1,y:((s=y.element)==null?void 0:s.y)??-1},y.elementfocus);return!x(y.element)||!x(p)?[0,n]:[y.element.x===p.x||y.element.y===p.y?1:0,n]}case"contact":{const p=ta(y.board,{x:((o=y.element)==null?void 0:o.x)??-1,y:((a=y.element)==null?void 0:a.y)??-1},y.elementfocus);if(!x(y.element)||!x(p))return[0,n];const m=(p.x??0)-(((c=y.element)==null?void 0:c.x)??0),w=(p.y??0)-(((l=y.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(w)<2||w===0&&Math.abs(m)<2?1:0,n]}case"blocked":{const[p,m]=rt(y.words,n,[Y.DIR]);return[KL(y.book,y.board,y.element,p)?1:0,m]}case"any":{const[p,m]=rt(y.words,n,[Y.KIND]);return[Mm(y.board,p).length?1:0,m]}case"rnd":return[er(0,1),n];case"abs":{const[p,m]=rt(y.words,n,[Y.NUMBER]);return[Math.abs(p),m]}case"ceil":{const[p,m]=rt(y.words,n,[Y.NUMBER]);return[Math.ceil(p),m]}case"floor":{const[p,m]=rt(y.words,n,[Y.NUMBER]);return[Math.floor(p),m]}case"round":{const[p,m]=rt(y.words,n,[Y.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,w,b]=rt(y.words,n,[Y.NUMBER,Y.NUMBER,Y.NUMBER]);return[cn(p,m,w),b]}case"min":{const[p,m]=Ao(n);return[Math.min(...p),m]}case"max":{const[p,m]=Ao(n);return[Math.max(...p),m]}case"pick":{const[p,m]=Ao(n);return[xe(p),m]}case"pickwith":{const[p,m]=rt(y.words,n,[Y.NUMBER_OR_STRING]),[w,b]=Ao(m);return[qp(`${p}`,w),b]}case"random":{const[p,m]=Ao(n,2),[w,b]=p;return[er(w,b??0),m]}case"randomwith":{const[p,m]=rt(y.words,n,[Y.NUMBER_OR_STRING]),[w,b]=Ao(m,2),[T,A]=w;return[Vp(`${p}`,T,A??0),b]}case"run":{const[p,m]=rt(y.words,n,[Y.NAME]);return zl(p),[(u=y.get)==null?void 0:u.call(y,"arg"),m]}case"runwith":{const[p,m,w]=rt(y.words,n,[Y.ANY,Y.NAME]);return x(y.element)&&(y.element.arg=p),zl(m),[(h=y.get)==null?void 0:h.call(y,"arg"),w]}}}return[t,n]}const y={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var Y=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.MAYBE_KIND=7]="MAYBE_KIND",e[e.MAYBE_NAME=8]="MAYBE_NAME",e[e.MAYBE_NUMBER=9]="MAYBE_NUMBER",e[e.MAYBE_STRING=10]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",e[e.ANY=12]="ANY",e))(Y||{});function gn(e,t,n){throw console.info(n,y.element,y.elementid,y.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function s1(e){var r,i;const t={x:((r=y.element)==null?void 0:r.x)??0,y:((i=y.element)==null?void 0:i.y)??0};return x(y.board)&&x(y.element)?eb(y.book,y.board,y.element,y.elementfocus,e,t):t}function rt(e,t,n){const r=y.words;y.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=im(s);Zs(a)?(s=c,i.push(a)):gn("kind",a,e);break}case 0:{if(dh(e[0])===void 0){const[a,c]=Pn(s);$r(a)?(s=c,i.push(a)):gn("color",a,e)}else{const[a,c]=ph(s);$r(a)?(s=c,i.push(a)):gn("color",a,e)}break}case 2:{if(fh(e[0])===void 0){const[a,c]=Pn(s);os(a)?(s=c,i.push(s1(a))):gn("direction",a,e)}else{const[a,c]=Qp(s);os(a)?(s=c,i.push(s1(a))):gn("direction",a,e)}break}case 3:{const a=y.words[s];kt(a)||gn("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Pn(s);if(kt(a)){const l=parseFloat(a);St(l)?i.push(l):gn("number",a,e)}else St(a)?i.push(a):gn("number",a,e);s=c;break}case 5:{const[a,c]=Pn(s);kt(a)||gn("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Pn(s);let l=a;if(kt(l)){const u=parseFloat(l);St(u)&&(l=u)}else St(l)||gn("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=im(s);a!==void 0&&!Zs(a)&&gn("optional kind",a,e),s=c,i.push(a);break}case 8:{const a=y.words[s];a!==void 0&&!kt(a)&&gn("optional string",a,e),++s,i.push(a);break}case 9:{const[a,c]=Pn(s);if(kt(a)){const l=parseFloat(a);St(l)?i.push(l):gn("optional number",a,e)}else St(a)||a===void 0?i.push(a):gn("optional number",a,e);s=c;break}case 10:{const[a,c]=Pn(s);a!==void 0&&!kt(a)&&gn("optional string",a,e),s=c,i.push(a);break}case 11:{const[a,c]=Pn(s);let l=a;if(kt(l)){const u=parseFloat(l);St(u)&&(l=u)}else l!==void 0&&!St(l)&&gn("number or string",l,e);s=c,i.push(l);break}case 12:{const[a,c]=Pn(s);s=c,i.push(a);break}}return y.words=r,[...i,s]}const Wl={},vo={};function wd(){return{id:Ue(),layers:[],scroll:[],sidebar:[]}}const w8=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),x8=new Set(["tx","text"]),k8={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},o1={};let a1=e=>{let t=o1[e];return x(t)||(o1[e]=t=wd()),t};function T8(e){a1=e}function Tn(e){return a1(e)}function xd(e){return x(Wl[e])||(Wl[e]=[]),Wl[e]}function A8(e){const t=Tn(e);t.scroll=[]}function v8(e,t,n){Object.values(vo).forEach(r=>{if(r[t]!==void 0){const i=Bm(e.id(),t);St(n)&&zk(i,n),kt(n)&&Wk(i,n)}})}function ei(e){const t=xd(e);return Wl[e]=[],t}function se(e,t){xd(e).push(t)}function $t(e,t,n,r,i=()=>0,s=ru){const o=[t,n,...r],a=Ot(`${o[3]}`),c={...y};function l(u,h){x(h)&&h!==i(u)&&(y.board=c.board,y.element=c.element,y.elementfocus=c.elementfocus,s(u,h))}if(w8.has(a)){const u=`${o[2]}`;vo[t]=vo[t]??{};const h=i(u)??k8[a];if(vo[t][u]===void 0){const d=Bm(t,u);St(h)&&jk(d,h),kt(h)&&rh(d,h),x8.has(a)?vo[t][u]=Pp(d,f=>{l(u,f)}):vo[t][u]=Kk(d,f=>{l(u,f)})}}xd(e).push(o)}T8(e=>{if(dr(e)){const t=he(Bt.MAIN),n=Ti(t,Bt.GADGETSTORE);let r=n[e];return x(r)||(n[e]=r=wd()),r}return wd()});const Kl=Ss("gadgetserver",["tock","second"],e=>{if(!Kl.session(e))return;const t=he(Bt.MAIN),n=(t==null?void 0:t.activelist)??[],r=Ti(t,Bt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=Tn(s),{over:a,under:c,layers:l}=E8(s);o.over=a,o.under=c,o.layers=l;const u=r[s]??{},h=Bd(u,o);h.length&&(r[s]=$n(o),yE(Kl,s,h))}break;case"second":{for(let i=0;i<n.length;++i){const s=n[i],o=qn(s);x(o)&&NE(Kl,s,o.id)}break}case"desync":gE(Kl,e.player,Tn(e.player));break;case"clearscroll":A8(e.player);break;case"clearplayer":{const i=he(Bt.MAIN),s=Ti(i,Bt.GADGETSTORE);delete s[e.player];const o=Ti(i,Bt.GADGETSYNC);delete o[e.player];break}}});function Gl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var c1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof Gl=="function"&&Gl;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};r[l][0].call(f.exports,function(p){var m=r[l][1][p];return o(m||p)},f,f.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Gl=="function"&&Gl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,f,p,m,w=[],b=0,T=c.length,A=T,I=s.getTypeOf(c)!=="string";b<c.length;)A=T-b,h=I?(l=c[b++],u=b<T?c[b++]:0,b<T?c[b++]:0):(l=c.charCodeAt(b++),u=b<T?c.charCodeAt(b++):0,b<T?c.charCodeAt(b++):0),d=l>>2,f=(3&l)<<4|u>>4,p=1<A?(15&u)<<2|h>>6:64,m=2<A?63&h:64,w.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return w.join("")},i.decode=function(c){var l,u,h,d,f,p,m=0,w=0,b="data:";if(c.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|A):new Array(0|A);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(f=a.indexOf(c.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(c.charAt(m++))),T[w++]=l,f!==64&&(T[w++]=u),p!==64&&(T[w++]=h);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,h,d,f,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(f,p){var m,w="";for(m=0;m<p;m++)w+=String.fromCharCode(255&f),f>>>=8;return w}function o(f,p,m,w,b,T){var A,I,U=f.file,R=f.compression,O=T!==l.utf8encode,P=a.transformTo("string",T(U.name)),N=a.transformTo("string",l.utf8encode(U.name)),W=U.comment,et=a.transformTo("string",T(W)),L=a.transformTo("string",l.utf8encode(W)),S=N.length!==U.name.length,E=L.length!==W.length,B="",Z="",D="",st=U.dir,tt=U.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=f.crc32,ft.compressedSize=f.compressedSize,ft.uncompressedSize=f.uncompressedSize);var V=0;p&&(V|=8),O||!S&&!E||(V|=2048);var z=0,Et=0;st&&(z|=16),b==="UNIX"?(Et=798,z|=function(lt,Mt){var Xt=lt;return lt||(Xt=Mt?16893:33204),(65535&Xt)<<16}(U.unixPermissions,st)):(Et=20,z|=function(lt){return 63&(lt||0)}(U.dosPermissions)),A=tt.getUTCHours(),A<<=6,A|=tt.getUTCMinutes(),A<<=5,A|=tt.getUTCSeconds()/2,I=tt.getUTCFullYear()-1980,I<<=4,I|=tt.getUTCMonth()+1,I<<=5,I|=tt.getUTCDate(),S&&(Z=s(1,1)+s(u(P),4)+N,B+="up"+s(Z.length,2)+Z),E&&(D=s(1,1)+s(u(et),4)+L,B+="uc"+s(D.length,2)+D);var at="";return at+=`
\0`,at+=s(V,2),at+=R.magic,at+=s(A,2),at+=s(I,2),at+=s(ft.crc32,4),at+=s(ft.compressedSize,4),at+=s(ft.uncompressedSize,4),at+=s(P.length,2),at+=s(B.length,2),{fileRecord:h.LOCAL_FILE_HEADER+at+P+B,dirRecord:h.CENTRAL_FILE_HEADER+s(Et,2)+at+s(et.length,2)+"\0\0\0\0"+s(z,4)+s(w,4)+P+B+et}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),h=n("../signature");function d(f,p,m,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=w,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-w-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(w){return h.DATA_DESCRIPTOR+s(w.crc32,4)+s(w.compressedSize,4)+s(w.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,w=function(b,T,A,I,U){var R=a.transformTo("string",U(I));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(b,2)+s(b,2)+s(T,4)+s(A,4)+s(R.length,2)+R}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(T,A){var I=T||A,U=s[I];if(!U)throw new Error(I+" is not a valid compression method !");return U}(f.options.compression,c.compression),m=f.options.compressionOptions||c.compressionOptions||{},w=f.dir,b=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:w,date:b,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(w){p(w)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(d,f){var p=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var w=new c(f);return w.load(m),w}).then(function(m){var w=[o.Promise.resolve(m)],b=m.files;if(f.checkCRC32)for(var T=0;T<b.length;T++)w.push(h(b[T]));return o.Promise.all(w)}).then(function(m){for(var w=m.shift(),b=w.files,T=0;T<b.length;T++){var A=b[T],I=A.fileNameStr,U=s.resolve(A.fileNameStr);p.file(U,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:f.createFolders}),A.dir||(p.file(U).unsafeOriginalName=I)}return w.zipComment.length&&(p.comment=w.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof on<"u",newBufferFrom:function(s,o){if(on.from&&on.from!==Uint8Array.from)return on.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new on(s,o)},allocBuffer:function(s){if(on.alloc)return on.alloc(s);var o=new on(s);return o.fill(0),o},isBuffer:function(s){return on.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,R,O){var P,N=a.getTypeOf(R),W=a.extend(O||{},u);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(U=b(U)),W.createFolders&&(P=w(U))&&T.call(this,P,!0);var et=N==="string"&&W.binary===!1&&W.base64===!1;O&&O.binary!==void 0||(W.binary=!et),(R instanceof h&&R.uncompressedSize===0||W.dir||!R||R.length===0)&&(W.base64=!1,W.binary=!0,R="",W.compression="STORE",N="string");var L=null;L=R instanceof h||R instanceof c?R:p.isNode&&p.isStream(R)?new m(U,R):a.prepareContent(U,R,W.binary,W.optimizedBinaryString,W.base64);var S=new d(U,L,W);this.files[U]=S}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),h=n("./compressedObject"),d=n("./zipObject"),f=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),w=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var R=U.lastIndexOf("/");return 0<R?U.substring(0,R):""},b=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,R){return R=R!==void 0?R:u.createFolders,U=b(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:R}),this.files[U]};function A(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var R,O,P;for(R in this.files)P=this.files[R],(O=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&U(O,P)},filter:function(U){var R=[];return this.forEach(function(O,P){U(O,P)&&R.push(P)}),R},file:function(U,R,O){if(arguments.length!==1)return U=this.root+U,s.call(this,U,R,O),this;if(A(U)){var P=U;return this.filter(function(W,et){return!et.dir&&P.test(W)})}var N=this.files[this.root+U];return N&&!N.dir?N:null},folder:function(U){if(!U)return this;if(A(U))return this.filter(function(N,W){return W.dir&&U.test(N)});var R=this.root+U,O=T.call(this,R),P=this.clone();return P.root=O.name,P},remove:function(U){U=this.root+U;var R=this.files[U];if(R||(U.slice(-1)!=="/"&&(U+="/"),R=this.files[U]),R&&!R.dir)delete this.files[U];else for(var O=this.filter(function(N,W){return W.name.slice(0,U.length)===U}),P=0;P<O.length;P++)delete this.files[O[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var R,O={};try{if((O=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");a.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var P=O.comment||this.comment||"";R=f.generateWorker(this,O,P)}catch(N){(R=new c("error")).error(N)}return new l(R,O.type||"string",O.mimeType)},generateAsync:function(U,R){return this.generateInternalStream(U).accumulate(R)},generateNodeStream:function(U,R){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(R)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),h=null;if(l.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(w,b){var T=[],A=p._internalType,I=p._outputType,U=p._mimeType;p.on("data",function(R,O){T.push(R),m&&m(O)}).on("error",function(R){T=[],b(R)}).on("end",function(){try{var R=function(O,P,N){switch(O){case"blob":return s.newBlob(s.transformTo("arraybuffer",P),N);case"base64":return c.encode(P);default:return s.transformTo(O,P)}}(I,function(O,P){var N,W=0,et=null,L=0;for(N=0;N<P.length;N++)L+=P[N].length;switch(O){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(et=new Uint8Array(L),N=0;N<P.length;N++)et.set(P[N],W),W+=P[N].length;return et;case"nodebuffer":return on.concat(P);default:throw new Error("concat : unsupported type '"+O+"'")}}(A,T),U);w(R)}catch(O){b(O)}T=[]}).resume()})}function f(p,m,w){var b=m;switch(m){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=m,this._mimeType=w,s.checkSupport(b),this._worker=p.pipe(new o(b)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var w=this;return p==="data"?this._worker.on(p,function(b){m.call(w,b.data,b.meta)}):this._worker.on(p,function(){s.delay(m,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof on<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,w,b,T,A,I=p.length,U=0;for(T=0;T<I;T++)(64512&(w=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(b=p.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(b-56320),T++),U+=w<128?1:w<2048?2:w<65536?3:4;for(m=o.uint8array?new Uint8Array(U):new Array(U),T=A=0;A<U;T++)(64512&(w=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(b=p.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(b-56320),T++),w<128?m[A++]=w:(w<2048?m[A++]=192|w>>>6:(w<65536?m[A++]=224|w>>>12:(m[A++]=240|w>>>18,m[A++]=128|w>>>12&63),m[A++]=128|w>>>6&63),m[A++]=128|63&w);return m}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,w,b,T,A=p.length,I=new Array(2*A);for(m=w=0;m<A;)if((b=p[m++])<128)I[w++]=b;else if(4<(T=l[b]))I[w++]=65533,m+=T-1;else{for(b&=T===2?31:T===3?15:7;1<T&&m<A;)b=b<<6|63&p[m++],T--;1<T?I[w++]=65533:b<65536?I[w++]=b:(b-=65536,I[w++]=55296|b>>10&1023,I[w++]=56320|1023&b)}return I.length!==w&&(I.subarray?I=I.subarray(0,w):I.length=w),s.applyFromCharCode(I)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var p=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var w=function(T,A){var I;for((A=A||T.length)>T.length&&(A=T.length),I=A-1;0<=I&&(192&T[I])==128;)I--;return I<0||I===0?A:I+l[T[I]]>A?I:A}(p),b=p;w!==p.length&&(o.uint8array?(b=p.subarray(0,w),this.leftOver=p.subarray(w,p.length)):(b=p.slice(0,w),this.leftOver=p.slice(w,p.length))),this.push({data:i.utf8decode(b),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,w){for(var b=0;b<m.length;++b)w[b]=255&m.charCodeAt(b);return w}n("setimmediate"),i.newBlob=function(m,w){i.checkSupport("blob");try{return new Blob([m],{type:w})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(m),b.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,w,b){var T=[],A=0,I=m.length;if(I<=b)return String.fromCharCode.apply(null,m);for(;A<I;)w==="array"||w==="nodebuffer"?T.push(String.fromCharCode.apply(null,m.slice(A,Math.min(A+b,I)))):T.push(String.fromCharCode.apply(null,m.subarray(A,Math.min(A+b,I)))),A+=b;return T.join("")},stringifyByChar:function(m){for(var w="",b=0;b<m.length;b++)w+=String.fromCharCode(m[b]);return w},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var w=65536,b=i.getTypeOf(m),T=!0;if(b==="uint8array"?T=h.applyCanBeUsed.uint8array:b==="nodebuffer"&&(T=h.applyCanBeUsed.nodebuffer),T)for(;1<w;)try{return h.stringifyByChunk(m,b,w)}catch{w=Math.floor(w/2)}return h.stringifyByChar(m)}function f(m,w){for(var b=0;b<m.length;b++)w[b]=m[b];return w}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,w){if(w=w||"",!m)return w;i.checkSupport(m);var b=i.getTypeOf(w);return p[b][m](w)},i.resolve=function(m){for(var w=m.split("/"),b=[],T=0;T<w.length;T++){var A=w[T];A==="."||A===""&&T!==0&&T!==w.length-1||(A===".."?b.pop():b.push(A))}return b.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var w,b,T="";for(b=0;b<(m||"").length;b++)T+="\\x"+((w=m.charCodeAt(b))<16?"0":"")+w.toString(16).toUpperCase();return T},i.delay=function(m,w,b){setImmediate(function(){m.apply(b||null,w||[])})},i.inherits=function(m,w){function b(){}b.prototype=w.prototype,m.prototype=new b},i.extend=function(){var m,w,b={};for(m=0;m<arguments.length;m++)for(w in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],w)&&b[w]===void 0&&(b[w]=arguments[m][w]);return b},i.prepareContent=function(m,w,b,T,A){return c.Promise.resolve(w).then(function(I){return s.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,R){var O=new FileReader;O.onload=function(P){U(P.target.result)},O.onerror=function(P){R(P.target.error)},O.readAsArrayBuffer(I)}):I}).then(function(I){var U=i.getTypeOf(I);return U?(U==="arraybuffer"?I=i.transformTo("uint8array",I):U==="string"&&(A?I=o.decode(I):b&&T!==!0&&(I=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(I))),I):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),h=n("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(w){for(var b in u)if(Object.prototype.hasOwnProperty.call(u,b)&&u[b].magic===w)return u[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,w,b=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<b;)p=f.readInt(2),m=f.readInt(2),w=f.readData(m),this.extraFields[p]={id:p,length:m,value:w};f.setIndex(b)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var b=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,w){this.name=p,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=m,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,w="string";try{if(!p)throw new Error("No output type specified.");var b=(w=p.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),m=this._decompressWorker();var T=!this._dataBinary;T&&!b&&(m=m.pipe(new c.Utf8EncodeWorker)),!T&&b&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(A){(m=new u("error")).error(A)}return new o(m,w,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(w,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,w;a=!0;for(var b=f.length;b;){for(w=f,f=[],m=-1;++m<b;)w[m]();b=f.length}a=!1}r.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof An<"u"?An:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,b!==o&&m(this,b)}function d(b,T,A){this.promise=b,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function f(b,T,A){s(function(){var I;try{I=T(A)}catch(U){return a.reject(b,U)}I===b?a.reject(b,new TypeError("Cannot resolve promise with itself")):a.resolve(b,I)})}function p(b){var T=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof T=="function")return function(){T.apply(b,arguments)}}function m(b,T){var A=!1;function I(O){A||(A=!0,a.reject(b,O))}function U(O){A||(A=!0,a.resolve(b,O))}var R=w(function(){T(U,I)});R.status==="error"&&I(R.value)}function w(b,T){var A={};try{A.value=b(T),A.status="success"}catch(I){A.status="error",A.value=I}return A}(r.exports=h).prototype.finally=function(b){if(typeof b!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(b()).then(function(){return A})},function(A){return T.resolve(b()).then(function(){throw A})})},h.prototype.catch=function(b){return this.then(null,b)},h.prototype.then=function(b,T){if(typeof b!="function"&&this.state===l||typeof T!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?f(A,this.state===l?b:T,this.outcome):this.queue.push(new d(A,b,T)),A},d.prototype.callFulfilled=function(b){a.resolve(this.promise,b)},d.prototype.otherCallFulfilled=function(b){f(this.promise,this.onFulfilled,b)},d.prototype.callRejected=function(b){a.reject(this.promise,b)},d.prototype.otherCallRejected=function(b){f(this.promise,this.onRejected,b)},a.resolve=function(b,T){var A=w(p,T);if(A.status==="error")return a.reject(b,A.value);var I=A.value;if(I)m(b,I);else{b.state=l,b.outcome=T;for(var U=-1,R=b.queue.length;++U<R;)b.queue[U].callFulfilled(T)}return b},a.reject=function(b,T){b.state=c,b.outcome=T;for(var A=-1,I=b.queue.length;++A<I;)b.queue[A].callRejected(T);return b},h.resolve=function(b){return b instanceof this?b:a.resolve(new this(o),b)},h.reject=function(b){var T=new this(o);return a.reject(T,b)},h.all=function(b){var T=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=b.length,I=!1;if(!A)return this.resolve([]);for(var U=new Array(A),R=0,O=-1,P=new this(o);++O<A;)N(b[O],O);return P;function N(W,et){T.resolve(W).then(function(L){U[et]=L,++R!==A||I||(I=!0,a.resolve(P,U))},function(L){I||(I=!0,a.reject(P,L))})}},h.race=function(b){var T=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=b.length,I=!1;if(!A)return this.resolve([]);for(var U=-1,R=new this(o);++U<A;)O=b[U],T.resolve(O).then(function(P){I||(I=!0,a.resolve(R,P))},function(P){I||(I=!0,a.reject(R,P))});var O;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(b){if(!(this instanceof m))return new m(b);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},b||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==h)throw new Error(c[A]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var I;if(I=typeof T.dictionary=="string"?a.string2buf(T.dictionary):u.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=s.deflateSetDictionary(this.strm,I))!==h)throw new Error(c[A]);this._dict_set=!0}}function w(b,T){var A=new m(T);if(A.push(b,!0),A.err)throw A.msg||c[A.err];return A.result}m.prototype.push=function(b,T){var A,I,U=this.strm,R=this.options.chunkSize;if(this.ended)return!1;I=T===~~T?T:T===!0?4:0,typeof b=="string"?U.input=a.string2buf(b):u.call(b)==="[object ArrayBuffer]"?U.input=new Uint8Array(b):U.input=b,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(R),U.next_out=0,U.avail_out=R),(A=s.deflate(U,I))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&A!==1);return I===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):I!==2||(this.onEnd(h),!(U.avail_out=0))},m.prototype.onData=function(b){this.chunks.push(b)},m.prototype.onEnd=function(b){b===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=m,i.deflate=w,i.deflateRaw=function(b,T){return(T=T||{}).raw=!0,w(b,T)},i.gzip=function(b,T){return(T=T||{}).gzip=!0,w(b,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),h=n("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||m&&m.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var b=s.inflateInit2(this.strm,w.windowBits);if(b!==c.Z_OK)throw new Error(l[b]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,w){var b=new f(w);if(b.push(m,!0),b.err)throw b.msg||l[b.err];return b.result}f.prototype.push=function(m,w){var b,T,A,I,U,R,O=this.strm,P=this.options.chunkSize,N=this.options.dictionary,W=!1;if(this.ended)return!1;T=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?O.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?O.input=new Uint8Array(m):O.input=m,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new o.Buf8(P),O.next_out=0,O.avail_out=P),(b=s.inflate(O,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(R=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,b=s.inflateSetDictionary(this.strm,R)),b===c.Z_BUF_ERROR&&W===!0&&(b=c.Z_OK,W=!1),b!==c.Z_STREAM_END&&b!==c.Z_OK)return this.onEnd(b),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&b!==c.Z_STREAM_END&&(O.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(O.output,O.next_out),I=O.next_out-A,U=a.buf2string(O.output,A),O.next_out=I,O.avail_out=P-I,I&&o.arraySet(O.output,O.output,A,I,0),this.onData(U)):this.onData(o.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(W=!0)}while((0<O.avail_in||O.avail_out===0)&&b!==c.Z_STREAM_END);return b===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(b=s.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(O.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(m,w){return(w=w||{}).raw=!0,p(m,w)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){var l,u,h,d,f,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)f=c[l],p.set(f,d),d+=f.length;return p}},a={arraySet:function(c,l,u,h,d){for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,p,m,w,b=h.length,T=0;for(m=0;m<b;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),T+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(T),m=w=0;w<T;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[w++]=f:(f<2048?d[w++]=192|f>>>6:(f<65536?d[w++]=224|f>>>12:(d[w++]=240|f>>>18,d[w++]=128|f>>>12&63),d[w++]=128|f>>>6&63),d[w++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,p,m,w,b=d||h.length,T=new Array(2*b);for(f=p=0;f<b;)if((m=h[f++])<128)T[p++]=m;else if(4<(w=c[m]))T[p++]=65533,f+=w-1;else{for(m&=w===2?31:w===3?15:7;1<w&&f<b;)m=m<<6|63&h[f++],w--;1<w?T[p++]=65533:m<65536?T[p++]=m:(m-=65536,T[p++]=55296|m>>10&1023,T[p++]=56320|1023&m)}return u(T,p)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),h=0,d=4,f=0,p=-2,m=-1,w=4,b=2,T=8,A=9,I=286,U=30,R=19,O=2*I+1,P=15,N=3,W=258,et=W+N+1,L=42,S=113,E=1,B=2,Z=3,D=4;function st(k,ot){return k.msg=u[ot],ot}function tt(k){return(k<<1)-(4<k?9:0)}function ft(k){for(var ot=k.length;0<=--ot;)k[ot]=0}function V(k){var ot=k.state,nt=ot.pending;nt>k.avail_out&&(nt=k.avail_out),nt!==0&&(o.arraySet(k.output,ot.pending_buf,ot.pending_out,nt,k.next_out),k.next_out+=nt,ot.pending_out+=nt,k.total_out+=nt,k.avail_out-=nt,ot.pending-=nt,ot.pending===0&&(ot.pending_out=0))}function z(k,ot){a._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,ot),k.block_start=k.strstart,V(k.strm)}function Et(k,ot){k.pending_buf[k.pending++]=ot}function at(k,ot){k.pending_buf[k.pending++]=ot>>>8&255,k.pending_buf[k.pending++]=255&ot}function lt(k,ot){var nt,F,M=k.max_chain_length,G=k.strstart,ct=k.prev_length,ht=k.nice_match,J=k.strstart>k.w_size-et?k.strstart-(k.w_size-et):0,pt=k.window,bt=k.w_mask,dt=k.prev,vt=k.strstart+W,le=pt[G+ct-1],Pt=pt[G+ct];k.prev_length>=k.good_match&&(M>>=2),ht>k.lookahead&&(ht=k.lookahead);do if(pt[(nt=ot)+ct]===Pt&&pt[nt+ct-1]===le&&pt[nt]===pt[G]&&pt[++nt]===pt[G+1]){G+=2,nt++;do;while(pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&pt[++G]===pt[++nt]&&G<vt);if(F=W-(vt-G),G=vt-W,ct<F){if(k.match_start=ot,ht<=(ct=F))break;le=pt[G+ct-1],Pt=pt[G+ct]}}while((ot=dt[ot&bt])>J&&--M!=0);return ct<=k.lookahead?ct:k.lookahead}function Mt(k){var ot,nt,F,M,G,ct,ht,J,pt,bt,dt=k.w_size;do{if(M=k.window_size-k.lookahead-k.strstart,k.strstart>=dt+(dt-et)){for(o.arraySet(k.window,k.window,dt,dt,0),k.match_start-=dt,k.strstart-=dt,k.block_start-=dt,ot=nt=k.hash_size;F=k.head[--ot],k.head[ot]=dt<=F?F-dt:0,--nt;);for(ot=nt=dt;F=k.prev[--ot],k.prev[ot]=dt<=F?F-dt:0,--nt;);M+=dt}if(k.strm.avail_in===0)break;if(ct=k.strm,ht=k.window,J=k.strstart+k.lookahead,pt=M,bt=void 0,bt=ct.avail_in,pt<bt&&(bt=pt),nt=bt===0?0:(ct.avail_in-=bt,o.arraySet(ht,ct.input,ct.next_in,bt,J),ct.state.wrap===1?ct.adler=c(ct.adler,ht,bt,J):ct.state.wrap===2&&(ct.adler=l(ct.adler,ht,bt,J)),ct.next_in+=bt,ct.total_in+=bt,bt),k.lookahead+=nt,k.lookahead+k.insert>=N)for(G=k.strstart-k.insert,k.ins_h=k.window[G],k.ins_h=(k.ins_h<<k.hash_shift^k.window[G+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[G+N-1])&k.hash_mask,k.prev[G&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=G,G++,k.insert--,!(k.lookahead+k.insert<N)););}while(k.lookahead<et&&k.strm.avail_in!==0)}function Xt(k,ot){for(var nt,F;;){if(k.lookahead<et){if(Mt(k),k.lookahead<et&&ot===h)return E;if(k.lookahead===0)break}if(nt=0,k.lookahead>=N&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+N-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),nt!==0&&k.strstart-nt<=k.w_size-et&&(k.match_length=lt(k,nt)),k.match_length>=N)if(F=a._tr_tally(k,k.strstart-k.match_start,k.match_length-N),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=N){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+N-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else F=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(F&&(z(k,!1),k.strm.avail_out===0))return E}return k.insert=k.strstart<N-1?k.strstart:N-1,ot===d?(z(k,!0),k.strm.avail_out===0?Z:D):k.last_lit&&(z(k,!1),k.strm.avail_out===0)?E:B}function Ut(k,ot){for(var nt,F,M;;){if(k.lookahead<et){if(Mt(k),k.lookahead<et&&ot===h)return E;if(k.lookahead===0)break}if(nt=0,k.lookahead>=N&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+N-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=N-1,nt!==0&&k.prev_length<k.max_lazy_match&&k.strstart-nt<=k.w_size-et&&(k.match_length=lt(k,nt),k.match_length<=5&&(k.strategy===1||k.match_length===N&&4096<k.strstart-k.match_start)&&(k.match_length=N-1)),k.prev_length>=N&&k.match_length<=k.prev_length){for(M=k.strstart+k.lookahead-N,F=a._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-N),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=M&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+N-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=N-1,k.strstart++,F&&(z(k,!1),k.strm.avail_out===0))return E}else if(k.match_available){if((F=a._tr_tally(k,0,k.window[k.strstart-1]))&&z(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return E}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(F=a._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<N-1?k.strstart:N-1,ot===d?(z(k,!0),k.strm.avail_out===0?Z:D):k.last_lit&&(z(k,!1),k.strm.avail_out===0)?E:B}function Tt(k,ot,nt,F,M){this.good_length=k,this.max_lazy=ot,this.nice_length=nt,this.max_chain=F,this.func=M}function Dt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*O),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*I+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*I+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ft(k){var ot;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=b,(ot=k.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?L:S,k.adler=ot.wrap===2?0:1,ot.last_flush=h,a._tr_init(ot),f):st(k,p)}function Ae(k){var ot=Ft(k);return ot===f&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=N-1,nt.match_available=0,nt.ins_h=0}(k.state),ot}function Me(k,ot,nt,F,M,G){if(!k)return p;var ct=1;if(ot===m&&(ot=6),F<0?(ct=0,F=-F):15<F&&(ct=2,F-=16),M<1||A<M||nt!==T||F<8||15<F||ot<0||9<ot||G<0||w<G)return st(k,p);F===8&&(F=9);var ht=new Dt;return(k.state=ht).strm=k,ht.wrap=ct,ht.gzhead=null,ht.w_bits=F,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=M+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+N-1)/N),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<M+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=ot,ht.strategy=G,ht.method=nt,Ae(k)}s=[new Tt(0,0,0,0,function(k,ot){var nt=65535;for(nt>k.pending_buf_size-5&&(nt=k.pending_buf_size-5);;){if(k.lookahead<=1){if(Mt(k),k.lookahead===0&&ot===h)return E;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var F=k.block_start+nt;if((k.strstart===0||k.strstart>=F)&&(k.lookahead=k.strstart-F,k.strstart=F,z(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-et&&(z(k,!1),k.strm.avail_out===0))return E}return k.insert=0,ot===d?(z(k,!0),k.strm.avail_out===0?Z:D):(k.strstart>k.block_start&&(z(k,!1),k.strm.avail_out),E)}),new Tt(4,4,8,4,Xt),new Tt(4,5,16,8,Xt),new Tt(4,6,32,32,Xt),new Tt(4,4,16,16,Ut),new Tt(8,16,32,32,Ut),new Tt(8,16,128,128,Ut),new Tt(8,32,128,256,Ut),new Tt(32,128,258,1024,Ut),new Tt(32,258,258,4096,Ut)],i.deflateInit=function(k,ot){return Me(k,ot,T,15,8,0)},i.deflateInit2=Me,i.deflateReset=Ae,i.deflateResetKeep=Ft,i.deflateSetHeader=function(k,ot){return k&&k.state?k.state.wrap!==2?p:(k.state.gzhead=ot,f):p},i.deflate=function(k,ot){var nt,F,M,G;if(!k||!k.state||5<ot||ot<0)return k?st(k,p):p;if(F=k.state,!k.output||!k.input&&k.avail_in!==0||F.status===666&&ot!==d)return st(k,k.avail_out===0?-5:p);if(F.strm=k,nt=F.last_flush,F.last_flush=ot,F.status===L)if(F.wrap===2)k.adler=0,Et(F,31),Et(F,139),Et(F,8),F.gzhead?(Et(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),Et(F,255&F.gzhead.time),Et(F,F.gzhead.time>>8&255),Et(F,F.gzhead.time>>16&255),Et(F,F.gzhead.time>>24&255),Et(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),Et(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(Et(F,255&F.gzhead.extra.length),Et(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(k.adler=l(k.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(Et(F,0),Et(F,0),Et(F,0),Et(F,0),Et(F,0),Et(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),Et(F,3),F.status=S);else{var ct=T+(F.w_bits-8<<4)<<8;ct|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(ct|=32),ct+=31-ct%31,F.status=S,at(F,ct),F.strstart!==0&&(at(F,k.adler>>>16),at(F,65535&k.adler)),k.adler=1}if(F.status===69)if(F.gzhead.extra){for(M=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>M&&(k.adler=l(k.adler,F.pending_buf,F.pending-M,M)),V(k),M=F.pending,F.pending!==F.pending_buf_size));)Et(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>M&&(k.adler=l(k.adler,F.pending_buf,F.pending-M,M)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(k.adler=l(k.adler,F.pending_buf,F.pending-M,M)),V(k),M=F.pending,F.pending===F.pending_buf_size)){G=1;break}G=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,Et(F,G)}while(G!==0);F.gzhead.hcrc&&F.pending>M&&(k.adler=l(k.adler,F.pending_buf,F.pending-M,M)),G===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(k.adler=l(k.adler,F.pending_buf,F.pending-M,M)),V(k),M=F.pending,F.pending===F.pending_buf_size)){G=1;break}G=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,Et(F,G)}while(G!==0);F.gzhead.hcrc&&F.pending>M&&(k.adler=l(k.adler,F.pending_buf,F.pending-M,M)),G===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&V(k),F.pending+2<=F.pending_buf_size&&(Et(F,255&k.adler),Et(F,k.adler>>8&255),k.adler=0,F.status=S)):F.status=S),F.pending!==0){if(V(k),k.avail_out===0)return F.last_flush=-1,f}else if(k.avail_in===0&&tt(ot)<=tt(nt)&&ot!==d)return st(k,-5);if(F.status===666&&k.avail_in!==0)return st(k,-5);if(k.avail_in!==0||F.lookahead!==0||ot!==h&&F.status!==666){var ht=F.strategy===2?function(J,pt){for(var bt;;){if(J.lookahead===0&&(Mt(J),J.lookahead===0)){if(pt===h)return E;break}if(J.match_length=0,bt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++,bt&&(z(J,!1),J.strm.avail_out===0))return E}return J.insert=0,pt===d?(z(J,!0),J.strm.avail_out===0?Z:D):J.last_lit&&(z(J,!1),J.strm.avail_out===0)?E:B}(F,ot):F.strategy===3?function(J,pt){for(var bt,dt,vt,le,Pt=J.window;;){if(J.lookahead<=W){if(Mt(J),J.lookahead<=W&&pt===h)return E;if(J.lookahead===0)break}if(J.match_length=0,J.lookahead>=N&&0<J.strstart&&(dt=Pt[vt=J.strstart-1])===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]){le=J.strstart+W;do;while(dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&dt===Pt[++vt]&&vt<le);J.match_length=W-(le-vt),J.match_length>J.lookahead&&(J.match_length=J.lookahead)}if(J.match_length>=N?(bt=a._tr_tally(J,1,J.match_length-N),J.lookahead-=J.match_length,J.strstart+=J.match_length,J.match_length=0):(bt=a._tr_tally(J,0,J.window[J.strstart]),J.lookahead--,J.strstart++),bt&&(z(J,!1),J.strm.avail_out===0))return E}return J.insert=0,pt===d?(z(J,!0),J.strm.avail_out===0?Z:D):J.last_lit&&(z(J,!1),J.strm.avail_out===0)?E:B}(F,ot):s[F.level].func(F,ot);if(ht!==Z&&ht!==D||(F.status=666),ht===E||ht===Z)return k.avail_out===0&&(F.last_flush=-1),f;if(ht===B&&(ot===1?a._tr_align(F):ot!==5&&(a._tr_stored_block(F,0,0,!1),ot===3&&(ft(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),V(k),k.avail_out===0))return F.last_flush=-1,f}return ot!==d?f:F.wrap<=0?1:(F.wrap===2?(Et(F,255&k.adler),Et(F,k.adler>>8&255),Et(F,k.adler>>16&255),Et(F,k.adler>>24&255),Et(F,255&k.total_in),Et(F,k.total_in>>8&255),Et(F,k.total_in>>16&255),Et(F,k.total_in>>24&255)):(at(F,k.adler>>>16),at(F,65535&k.adler)),V(k),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?f:1)},i.deflateEnd=function(k){var ot;return k&&k.state?(ot=k.state.status)!==L&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==S&&ot!==666?st(k,p):(k.state=null,ot===S?st(k,-3):f):p},i.deflateSetDictionary=function(k,ot){var nt,F,M,G,ct,ht,J,pt,bt=ot.length;if(!k||!k.state||(G=(nt=k.state).wrap)===2||G===1&&nt.status!==L||nt.lookahead)return p;for(G===1&&(k.adler=c(k.adler,ot,bt,0)),nt.wrap=0,bt>=nt.w_size&&(G===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),pt=new o.Buf8(nt.w_size),o.arraySet(pt,ot,bt-nt.w_size,nt.w_size,0),ot=pt,bt=nt.w_size),ct=k.avail_in,ht=k.next_in,J=k.input,k.avail_in=bt,k.next_in=0,k.input=ot,Mt(nt);nt.lookahead>=N;){for(F=nt.strstart,M=nt.lookahead-(N-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[F+N-1])&nt.hash_mask,nt.prev[F&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=F,F++,--M;);nt.strstart=F,nt.lookahead=N-1,Mt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=N-1,nt.match_available=0,k.next_in=ht,k.input=J,k.avail_in=ct,nt.wrap=G,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,h,d,f,p,m,w,b,T,A,I,U,R,O,P,N,W,et,L,S,E,B;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,B=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,w=a.wnext,b=a.window,T=a.hold,A=a.bits,I=a.lencode,U=a.distcode,R=(1<<a.lenbits)-1,O=(1<<a.distbits)-1;t:do{A<15&&(T+=E[c++]<<A,A+=8,T+=E[c++]<<A,A+=8),P=I[T&R];e:for(;;){if(T>>>=N=P>>>24,A-=N,(N=P>>>16&255)===0)B[u++]=65535&P;else{if(!(16&N)){if(!(64&N)){P=I[(65535&P)+(T&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}W=65535&P,(N&=15)&&(A<N&&(T+=E[c++]<<A,A+=8),W+=T&(1<<N)-1,T>>>=N,A-=N),A<15&&(T+=E[c++]<<A,A+=8,T+=E[c++]<<A,A+=8),P=U[T&O];n:for(;;){if(T>>>=N=P>>>24,A-=N,!(16&(N=P>>>16&255))){if(!(64&N)){P=U[(65535&P)+(T&(1<<N)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(et=65535&P,A<(N&=15)&&(T+=E[c++]<<A,(A+=8)<N&&(T+=E[c++]<<A,A+=8)),f<(et+=T&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=N,A-=N,(N=u-h)<et){if(m<(N=et-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(S=b,(L=0)===w){if(L+=p-N,N<W){for(W-=N;B[u++]=b[L++],--N;);L=u-et,S=B}}else if(w<N){if(L+=p+w-N,(N-=w)<W){for(W-=N;B[u++]=b[L++],--N;);if(L=0,w<W){for(W-=N=w;B[u++]=b[L++],--N;);L=u-et,S=B}}}else if(L+=w-N,N<W){for(W-=N;B[u++]=b[L++],--N;);L=u-et,S=B}for(;2<W;)B[u++]=S[L++],B[u++]=S[L++],B[u++]=S[L++],W-=3;W&&(B[u++]=S[L++],1<W&&(B[u++]=S[L++]))}else{for(L=u-et;B[u++]=B[L++],B[u++]=B[L++],B[u++]=B[L++],2<(W-=3););W&&(B[u++]=B[L++],1<W&&(B[u++]=B[L++]))}break}}break}}while(c<l&&u<d);c-=W=A>>3,T&=(1<<(A-=W<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=T,a.bits=A}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,h=2,d=0,f=-2,p=1,m=852,w=592;function b(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(L){var S;return L&&L.state?(S=L.state,L.total_in=L.total_out=S.total=0,L.msg="",S.wrap&&(L.adler=1&S.wrap),S.mode=p,S.last=0,S.havedict=0,S.dmax=32768,S.head=null,S.hold=0,S.bits=0,S.lencode=S.lendyn=new s.Buf32(m),S.distcode=S.distdyn=new s.Buf32(w),S.sane=1,S.back=-1,d):f}function I(L){var S;return L&&L.state?((S=L.state).wsize=0,S.whave=0,S.wnext=0,A(L)):f}function U(L,S){var E,B;return L&&L.state?(B=L.state,S<0?(E=0,S=-S):(E=1+(S>>4),S<48&&(S&=15)),S&&(S<8||15<S)?f:(B.window!==null&&B.wbits!==S&&(B.window=null),B.wrap=E,B.wbits=S,I(L))):f}function R(L,S){var E,B;return L?(B=new T,(L.state=B).window=null,(E=U(L,S))!==d&&(L.state=null),E):f}var O,P,N=!0;function W(L){if(N){var S;for(O=new s.Buf32(512),P=new s.Buf32(32),S=0;S<144;)L.lens[S++]=8;for(;S<256;)L.lens[S++]=9;for(;S<280;)L.lens[S++]=7;for(;S<288;)L.lens[S++]=8;for(l(u,L.lens,0,288,O,0,L.work,{bits:9}),S=0;S<32;)L.lens[S++]=5;l(h,L.lens,0,32,P,0,L.work,{bits:5}),N=!1}L.lencode=O,L.lenbits=9,L.distcode=P,L.distbits=5}function et(L,S,E,B){var Z,D=L.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new s.Buf8(D.wsize)),B>=D.wsize?(s.arraySet(D.window,S,E-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(B<(Z=D.wsize-D.wnext)&&(Z=B),s.arraySet(D.window,S,E-B,Z,D.wnext),(B-=Z)?(s.arraySet(D.window,S,E-B,B,0),D.wnext=B,D.whave=D.wsize):(D.wnext+=Z,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=Z))),0}i.inflateReset=I,i.inflateReset2=U,i.inflateResetKeep=A,i.inflateInit=function(L){return R(L,15)},i.inflateInit2=R,i.inflate=function(L,S){var E,B,Z,D,st,tt,ft,V,z,Et,at,lt,Mt,Xt,Ut,Tt,Dt,Ft,Ae,Me,k,ot,nt,F,M=0,G=new s.Buf8(4),ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return f;(E=L.state).mode===12&&(E.mode=13),st=L.next_out,Z=L.output,ft=L.avail_out,D=L.next_in,B=L.input,tt=L.avail_in,V=E.hold,z=E.bits,Et=tt,at=ft,ot=d;t:for(;;)switch(E.mode){case p:if(E.wrap===0){E.mode=13;break}for(;z<16;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(2&E.wrap&&V===35615){G[E.check=0]=255&V,G[1]=V>>>8&255,E.check=a(E.check,G,2,0),z=V=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&V)<<8)+(V>>8))%31){L.msg="incorrect header check",E.mode=30;break}if((15&V)!=8){L.msg="unknown compression method",E.mode=30;break}if(z-=4,k=8+(15&(V>>>=4)),E.wbits===0)E.wbits=k;else if(k>E.wbits){L.msg="invalid window size",E.mode=30;break}E.dmax=1<<k,L.adler=E.check=1,E.mode=512&V?10:12,z=V=0;break;case 2:for(;z<16;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(E.flags=V,(255&E.flags)!=8){L.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){L.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=V>>8&1),512&E.flags&&(G[0]=255&V,G[1]=V>>>8&255,E.check=a(E.check,G,2,0)),z=V=0,E.mode=3;case 3:for(;z<32;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}E.head&&(E.head.time=V),512&E.flags&&(G[0]=255&V,G[1]=V>>>8&255,G[2]=V>>>16&255,G[3]=V>>>24&255,E.check=a(E.check,G,4,0)),z=V=0,E.mode=4;case 4:for(;z<16;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}E.head&&(E.head.xflags=255&V,E.head.os=V>>8),512&E.flags&&(G[0]=255&V,G[1]=V>>>8&255,E.check=a(E.check,G,2,0)),z=V=0,E.mode=5;case 5:if(1024&E.flags){for(;z<16;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}E.length=V,E.head&&(E.head.extra_len=V),512&E.flags&&(G[0]=255&V,G[1]=V>>>8&255,E.check=a(E.check,G,2,0)),z=V=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(tt<(lt=E.length)&&(lt=tt),lt&&(E.head&&(k=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,B,D,lt,k)),512&E.flags&&(E.check=a(E.check,B,lt,D)),tt-=lt,D+=lt,E.length-=lt),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(tt===0)break t;for(lt=0;k=B[D+lt++],E.head&&k&&E.length<65536&&(E.head.name+=String.fromCharCode(k)),k&&lt<tt;);if(512&E.flags&&(E.check=a(E.check,B,lt,D)),tt-=lt,D+=lt,k)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(tt===0)break t;for(lt=0;k=B[D+lt++],E.head&&k&&E.length<65536&&(E.head.comment+=String.fromCharCode(k)),k&&lt<tt;);if(512&E.flags&&(E.check=a(E.check,B,lt,D)),tt-=lt,D+=lt,k)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;z<16;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(V!==(65535&E.check)){L.msg="header crc mismatch",E.mode=30;break}z=V=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),L.adler=E.check=0,E.mode=12;break;case 10:for(;z<32;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}L.adler=E.check=b(V),z=V=0,E.mode=11;case 11:if(E.havedict===0)return L.next_out=st,L.avail_out=ft,L.next_in=D,L.avail_in=tt,E.hold=V,E.bits=z,2;L.adler=E.check=1,E.mode=12;case 12:if(S===5||S===6)break t;case 13:if(E.last){V>>>=7&z,z-=7&z,E.mode=27;break}for(;z<3;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}switch(E.last=1&V,z-=1,3&(V>>>=1)){case 0:E.mode=14;break;case 1:if(W(E),E.mode=20,S!==6)break;V>>>=2,z-=2;break t;case 2:E.mode=17;break;case 3:L.msg="invalid block type",E.mode=30}V>>>=2,z-=2;break;case 14:for(V>>>=7&z,z-=7&z;z<32;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if((65535&V)!=(V>>>16^65535)){L.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&V,z=V=0,E.mode=15,S===6)break t;case 15:E.mode=16;case 16:if(lt=E.length){if(tt<lt&&(lt=tt),ft<lt&&(lt=ft),lt===0)break t;s.arraySet(Z,B,D,lt,st),tt-=lt,D+=lt,ft-=lt,st+=lt,E.length-=lt;break}E.mode=12;break;case 17:for(;z<14;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(E.nlen=257+(31&V),V>>>=5,z-=5,E.ndist=1+(31&V),V>>>=5,z-=5,E.ncode=4+(15&V),V>>>=4,z-=4,286<E.nlen||30<E.ndist){L.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;z<3;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}E.lens[ct[E.have++]]=7&V,V>>>=3,z-=3}for(;E.have<19;)E.lens[ct[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,nt={bits:E.lenbits},ot=l(0,E.lens,0,19,E.lencode,0,E.work,nt),E.lenbits=nt.bits,ot){L.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Tt=(M=E.lencode[V&(1<<E.lenbits)-1])>>>16&255,Dt=65535&M,!((Ut=M>>>24)<=z);){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(Dt<16)V>>>=Ut,z-=Ut,E.lens[E.have++]=Dt;else{if(Dt===16){for(F=Ut+2;z<F;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(V>>>=Ut,z-=Ut,E.have===0){L.msg="invalid bit length repeat",E.mode=30;break}k=E.lens[E.have-1],lt=3+(3&V),V>>>=2,z-=2}else if(Dt===17){for(F=Ut+3;z<F;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}z-=Ut,k=0,lt=3+(7&(V>>>=Ut)),V>>>=3,z-=3}else{for(F=Ut+7;z<F;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}z-=Ut,k=0,lt=11+(127&(V>>>=Ut)),V>>>=7,z-=7}if(E.have+lt>E.nlen+E.ndist){L.msg="invalid bit length repeat",E.mode=30;break}for(;lt--;)E.lens[E.have++]=k}}if(E.mode===30)break;if(E.lens[256]===0){L.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,nt={bits:E.lenbits},ot=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,nt),E.lenbits=nt.bits,ot){L.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,nt={bits:E.distbits},ot=l(h,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,nt),E.distbits=nt.bits,ot){L.msg="invalid distances set",E.mode=30;break}if(E.mode=20,S===6)break t;case 20:E.mode=21;case 21:if(6<=tt&&258<=ft){L.next_out=st,L.avail_out=ft,L.next_in=D,L.avail_in=tt,E.hold=V,E.bits=z,c(L,at),st=L.next_out,Z=L.output,ft=L.avail_out,D=L.next_in,B=L.input,tt=L.avail_in,V=E.hold,z=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Tt=(M=E.lencode[V&(1<<E.lenbits)-1])>>>16&255,Dt=65535&M,!((Ut=M>>>24)<=z);){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(Tt&&!(240&Tt)){for(Ft=Ut,Ae=Tt,Me=Dt;Tt=(M=E.lencode[Me+((V&(1<<Ft+Ae)-1)>>Ft)])>>>16&255,Dt=65535&M,!(Ft+(Ut=M>>>24)<=z);){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}V>>>=Ft,z-=Ft,E.back+=Ft}if(V>>>=Ut,z-=Ut,E.back+=Ut,E.length=Dt,Tt===0){E.mode=26;break}if(32&Tt){E.back=-1,E.mode=12;break}if(64&Tt){L.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Tt,E.mode=22;case 22:if(E.extra){for(F=E.extra;z<F;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}E.length+=V&(1<<E.extra)-1,V>>>=E.extra,z-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Tt=(M=E.distcode[V&(1<<E.distbits)-1])>>>16&255,Dt=65535&M,!((Ut=M>>>24)<=z);){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(!(240&Tt)){for(Ft=Ut,Ae=Tt,Me=Dt;Tt=(M=E.distcode[Me+((V&(1<<Ft+Ae)-1)>>Ft)])>>>16&255,Dt=65535&M,!(Ft+(Ut=M>>>24)<=z);){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}V>>>=Ft,z-=Ft,E.back+=Ft}if(V>>>=Ut,z-=Ut,E.back+=Ut,64&Tt){L.msg="invalid distance code",E.mode=30;break}E.offset=Dt,E.extra=15&Tt,E.mode=24;case 24:if(E.extra){for(F=E.extra;z<F;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}E.offset+=V&(1<<E.extra)-1,V>>>=E.extra,z-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){L.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(ft===0)break t;if(lt=at-ft,E.offset>lt){if((lt=E.offset-lt)>E.whave&&E.sane){L.msg="invalid distance too far back",E.mode=30;break}Mt=lt>E.wnext?(lt-=E.wnext,E.wsize-lt):E.wnext-lt,lt>E.length&&(lt=E.length),Xt=E.window}else Xt=Z,Mt=st-E.offset,lt=E.length;for(ft<lt&&(lt=ft),ft-=lt,E.length-=lt;Z[st++]=Xt[Mt++],--lt;);E.length===0&&(E.mode=21);break;case 26:if(ft===0)break t;Z[st++]=E.length,ft--,E.mode=21;break;case 27:if(E.wrap){for(;z<32;){if(tt===0)break t;tt--,V|=B[D++]<<z,z+=8}if(at-=ft,L.total_out+=at,E.total+=at,at&&(L.adler=E.check=E.flags?a(E.check,Z,at,st-at):o(E.check,Z,at,st-at)),at=ft,(E.flags?V:b(V))!==E.check){L.msg="incorrect data check",E.mode=30;break}z=V=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;z<32;){if(tt===0)break t;tt--,V+=B[D++]<<z,z+=8}if(V!==(4294967295&E.total)){L.msg="incorrect length check",E.mode=30;break}z=V=0}E.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return f}return L.next_out=st,L.avail_out=ft,L.next_in=D,L.avail_in=tt,E.hold=V,E.bits=z,(E.wsize||at!==L.avail_out&&E.mode<30&&(E.mode<27||S!==4))&&et(L,L.output,L.next_out,at-L.avail_out)?(E.mode=31,-4):(Et-=L.avail_in,at-=L.avail_out,L.total_in+=Et,L.total_out+=at,E.total+=at,E.wrap&&at&&(L.adler=E.check=E.flags?a(E.check,Z,at,L.next_out-at):o(E.check,Z,at,L.next_out-at)),L.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(Et==0&&at===0||S===4)&&ot===d&&(ot=-5),ot)},i.inflateEnd=function(L){if(!L||!L.state)return f;var S=L.state;return S.window&&(S.window=null),L.state=null,d},i.inflateGetHeader=function(L,S){var E;return L&&L.state&&2&(E=L.state).wrap?((E.head=S).done=!1,d):f},i.inflateSetDictionary=function(L,S){var E,B=S.length;return L&&L.state?(E=L.state).wrap!==0&&E.mode!==11?f:E.mode===11&&o(1,S,B,0)!==E.check?-3:et(L,S,B,B)?(E.mode=31,-4):(E.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,d,f,p,m,w,b){var T,A,I,U,R,O,P,N,W,et=b.bits,L=0,S=0,E=0,B=0,Z=0,D=0,st=0,tt=0,ft=0,V=0,z=null,Et=0,at=new s.Buf16(16),lt=new s.Buf16(16),Mt=null,Xt=0;for(L=0;L<=15;L++)at[L]=0;for(S=0;S<f;S++)at[h[d+S]]++;for(Z=et,B=15;1<=B&&at[B]===0;B--);if(B<Z&&(Z=B),B===0)return p[m++]=20971520,p[m++]=20971520,b.bits=1,0;for(E=1;E<B&&at[E]===0;E++);for(Z<E&&(Z=E),L=tt=1;L<=15;L++)if(tt<<=1,(tt-=at[L])<0)return-1;if(0<tt&&(u===0||B!==1))return-1;for(lt[1]=0,L=1;L<15;L++)lt[L+1]=lt[L]+at[L];for(S=0;S<f;S++)h[d+S]!==0&&(w[lt[h[d+S]]++]=S);if(O=u===0?(z=Mt=w,19):u===1?(z=o,Et-=257,Mt=a,Xt-=257,256):(z=c,Mt=l,-1),L=E,R=m,st=S=V=0,I=-1,U=(ft=1<<(D=Z))-1,u===1&&852<ft||u===2&&592<ft)return 1;for(;;){for(P=L-st,W=w[S]<O?(N=0,w[S]):w[S]>O?(N=Mt[Xt+w[S]],z[Et+w[S]]):(N=96,0),T=1<<L-st,E=A=1<<D;p[R+(V>>st)+(A-=T)]=P<<24|N<<16|W|0,A!==0;);for(T=1<<L-1;V&T;)T>>=1;if(T!==0?(V&=T-1,V+=T):V=0,S++,--at[L]==0){if(L===B)break;L=h[d+w[S]]}if(Z<L&&(V&U)!==I){for(st===0&&(st=Z),R+=E,tt=1<<(D=L-st);D+st<B&&!((tt-=at[D+st])<=0);)D++,tt<<=1;if(ft+=1<<D,u===1&&852<ft||u===2&&592<ft)return 1;p[I=V&U]=Z<<24|D<<16|R-m|0}}return V!==0&&(p[R+V]=L-st<<24|64<<16|0),b.bits=Z,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(M){for(var G=M.length;0<=--G;)M[G]=0}var l=0,u=29,h=256,d=h+1+u,f=30,p=19,m=2*d+1,w=15,b=16,T=7,A=256,I=16,U=17,R=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],et=new Array(2*(d+2));c(et);var L=new Array(2*f);c(L);var S=new Array(512);c(S);var E=new Array(256);c(E);var B=new Array(u);c(B);var Z,D,st,tt=new Array(f);function ft(M,G,ct,ht,J){this.static_tree=M,this.extra_bits=G,this.extra_base=ct,this.elems=ht,this.max_length=J,this.has_stree=M&&M.length}function V(M,G){this.dyn_tree=M,this.max_code=0,this.stat_desc=G}function z(M){return M<256?S[M]:S[256+(M>>>7)]}function Et(M,G){M.pending_buf[M.pending++]=255&G,M.pending_buf[M.pending++]=G>>>8&255}function at(M,G,ct){M.bi_valid>b-ct?(M.bi_buf|=G<<M.bi_valid&65535,Et(M,M.bi_buf),M.bi_buf=G>>b-M.bi_valid,M.bi_valid+=ct-b):(M.bi_buf|=G<<M.bi_valid&65535,M.bi_valid+=ct)}function lt(M,G,ct){at(M,ct[2*G],ct[2*G+1])}function Mt(M,G){for(var ct=0;ct|=1&M,M>>>=1,ct<<=1,0<--G;);return ct>>>1}function Xt(M,G,ct){var ht,J,pt=new Array(w+1),bt=0;for(ht=1;ht<=w;ht++)pt[ht]=bt=bt+ct[ht-1]<<1;for(J=0;J<=G;J++){var dt=M[2*J+1];dt!==0&&(M[2*J]=Mt(pt[dt]++,dt))}}function Ut(M){var G;for(G=0;G<d;G++)M.dyn_ltree[2*G]=0;for(G=0;G<f;G++)M.dyn_dtree[2*G]=0;for(G=0;G<p;G++)M.bl_tree[2*G]=0;M.dyn_ltree[2*A]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}function Tt(M){8<M.bi_valid?Et(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}function Dt(M,G,ct,ht){var J=2*G,pt=2*ct;return M[J]<M[pt]||M[J]===M[pt]&&ht[G]<=ht[ct]}function Ft(M,G,ct){for(var ht=M.heap[ct],J=ct<<1;J<=M.heap_len&&(J<M.heap_len&&Dt(G,M.heap[J+1],M.heap[J],M.depth)&&J++,!Dt(G,ht,M.heap[J],M.depth));)M.heap[ct]=M.heap[J],ct=J,J<<=1;M.heap[ct]=ht}function Ae(M,G,ct){var ht,J,pt,bt,dt=0;if(M.last_lit!==0)for(;ht=M.pending_buf[M.d_buf+2*dt]<<8|M.pending_buf[M.d_buf+2*dt+1],J=M.pending_buf[M.l_buf+dt],dt++,ht===0?lt(M,J,G):(lt(M,(pt=E[J])+h+1,G),(bt=O[pt])!==0&&at(M,J-=B[pt],bt),lt(M,pt=z(--ht),ct),(bt=P[pt])!==0&&at(M,ht-=tt[pt],bt)),dt<M.last_lit;);lt(M,A,G)}function Me(M,G){var ct,ht,J,pt=G.dyn_tree,bt=G.stat_desc.static_tree,dt=G.stat_desc.has_stree,vt=G.stat_desc.elems,le=-1;for(M.heap_len=0,M.heap_max=m,ct=0;ct<vt;ct++)pt[2*ct]!==0?(M.heap[++M.heap_len]=le=ct,M.depth[ct]=0):pt[2*ct+1]=0;for(;M.heap_len<2;)pt[2*(J=M.heap[++M.heap_len]=le<2?++le:0)]=1,M.depth[J]=0,M.opt_len--,dt&&(M.static_len-=bt[2*J+1]);for(G.max_code=le,ct=M.heap_len>>1;1<=ct;ct--)Ft(M,pt,ct);for(J=vt;ct=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Ft(M,pt,1),ht=M.heap[1],M.heap[--M.heap_max]=ct,M.heap[--M.heap_max]=ht,pt[2*J]=pt[2*ct]+pt[2*ht],M.depth[J]=(M.depth[ct]>=M.depth[ht]?M.depth[ct]:M.depth[ht])+1,pt[2*ct+1]=pt[2*ht+1]=J,M.heap[1]=J++,Ft(M,pt,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],function(Pt,Bn){var v,g,_,C,$,Q,it=Bn.dyn_tree,zt=Bn.max_code,ve=Bn.stat_desc.static_tree,ye=Bn.stat_desc.has_stree,Re=Bn.stat_desc.extra_bits,ce=Bn.stat_desc.extra_base,La=Bn.stat_desc.max_length,Yl=0;for(C=0;C<=w;C++)Pt.bl_count[C]=0;for(it[2*Pt.heap[Pt.heap_max]+1]=0,v=Pt.heap_max+1;v<m;v++)La<(C=it[2*it[2*(g=Pt.heap[v])+1]+1]+1)&&(C=La,Yl++),it[2*g+1]=C,zt<g||(Pt.bl_count[C]++,$=0,ce<=g&&($=Re[g-ce]),Q=it[2*g],Pt.opt_len+=Q*(C+$),ye&&(Pt.static_len+=Q*(ve[2*g+1]+$)));if(Yl!==0){do{for(C=La-1;Pt.bl_count[C]===0;)C--;Pt.bl_count[C]--,Pt.bl_count[C+1]+=2,Pt.bl_count[La]--,Yl-=2}while(0<Yl);for(C=La;C!==0;C--)for(g=Pt.bl_count[C];g!==0;)zt<(_=Pt.heap[--v])||(it[2*_+1]!==C&&(Pt.opt_len+=(C-it[2*_+1])*it[2*_],it[2*_+1]=C),g--)}}(M,G),Xt(pt,le,M.bl_count)}function k(M,G,ct){var ht,J,pt=-1,bt=G[1],dt=0,vt=7,le=4;for(bt===0&&(vt=138,le=3),G[2*(ct+1)+1]=65535,ht=0;ht<=ct;ht++)J=bt,bt=G[2*(ht+1)+1],++dt<vt&&J===bt||(dt<le?M.bl_tree[2*J]+=dt:J!==0?(J!==pt&&M.bl_tree[2*J]++,M.bl_tree[2*I]++):dt<=10?M.bl_tree[2*U]++:M.bl_tree[2*R]++,pt=J,le=(dt=0)===bt?(vt=138,3):J===bt?(vt=6,3):(vt=7,4))}function ot(M,G,ct){var ht,J,pt=-1,bt=G[1],dt=0,vt=7,le=4;for(bt===0&&(vt=138,le=3),ht=0;ht<=ct;ht++)if(J=bt,bt=G[2*(ht+1)+1],!(++dt<vt&&J===bt)){if(dt<le)for(;lt(M,J,M.bl_tree),--dt!=0;);else J!==0?(J!==pt&&(lt(M,J,M.bl_tree),dt--),lt(M,I,M.bl_tree),at(M,dt-3,2)):dt<=10?(lt(M,U,M.bl_tree),at(M,dt-3,3)):(lt(M,R,M.bl_tree),at(M,dt-11,7));pt=J,le=(dt=0)===bt?(vt=138,3):J===bt?(vt=6,3):(vt=7,4)}}c(tt);var nt=!1;function F(M,G,ct,ht){at(M,(l<<1)+(ht?1:0),3),function(J,pt,bt,dt){Tt(J),Et(J,bt),Et(J,~bt),s.arraySet(J.pending_buf,J.window,pt,bt,J.pending),J.pending+=bt}(M,G,ct)}i._tr_init=function(M){nt||(function(){var G,ct,ht,J,pt,bt=new Array(w+1);for(J=ht=0;J<u-1;J++)for(B[J]=ht,G=0;G<1<<O[J];G++)E[ht++]=J;for(E[ht-1]=J,J=pt=0;J<16;J++)for(tt[J]=pt,G=0;G<1<<P[J];G++)S[pt++]=J;for(pt>>=7;J<f;J++)for(tt[J]=pt<<7,G=0;G<1<<P[J]-7;G++)S[256+pt++]=J;for(ct=0;ct<=w;ct++)bt[ct]=0;for(G=0;G<=143;)et[2*G+1]=8,G++,bt[8]++;for(;G<=255;)et[2*G+1]=9,G++,bt[9]++;for(;G<=279;)et[2*G+1]=7,G++,bt[7]++;for(;G<=287;)et[2*G+1]=8,G++,bt[8]++;for(Xt(et,d+1,bt),G=0;G<f;G++)L[2*G+1]=5,L[2*G]=Mt(G,5);Z=new ft(et,O,h+1,d,w),D=new ft(L,P,0,f,w),st=new ft(new Array(0),N,0,p,T)}(),nt=!0),M.l_desc=new V(M.dyn_ltree,Z),M.d_desc=new V(M.dyn_dtree,D),M.bl_desc=new V(M.bl_tree,st),M.bi_buf=0,M.bi_valid=0,Ut(M)},i._tr_stored_block=F,i._tr_flush_block=function(M,G,ct,ht){var J,pt,bt=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=function(dt){var vt,le=4093624447;for(vt=0;vt<=31;vt++,le>>>=1)if(1&le&&dt.dyn_ltree[2*vt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(dt.dyn_ltree[2*vt]!==0)return a;return o}(M)),Me(M,M.l_desc),Me(M,M.d_desc),bt=function(dt){var vt;for(k(dt,dt.dyn_ltree,dt.l_desc.max_code),k(dt,dt.dyn_dtree,dt.d_desc.max_code),Me(dt,dt.bl_desc),vt=p-1;3<=vt&&dt.bl_tree[2*W[vt]+1]===0;vt--);return dt.opt_len+=3*(vt+1)+5+5+4,vt}(M),J=M.opt_len+3+7>>>3,(pt=M.static_len+3+7>>>3)<=J&&(J=pt)):J=pt=ct+5,ct+4<=J&&G!==-1?F(M,G,ct,ht):M.strategy===4||pt===J?(at(M,2+(ht?1:0),3),Ae(M,et,L)):(at(M,4+(ht?1:0),3),function(dt,vt,le,Pt){var Bn;for(at(dt,vt-257,5),at(dt,le-1,5),at(dt,Pt-4,4),Bn=0;Bn<Pt;Bn++)at(dt,dt.bl_tree[2*W[Bn]+1],3);ot(dt,dt.dyn_ltree,vt-1),ot(dt,dt.dyn_dtree,le-1)}(M,M.l_desc.max_code+1,M.d_desc.max_code+1,bt+1),Ae(M,M.dyn_ltree,M.dyn_dtree)),Ut(M),ht&&Tt(M)},i._tr_tally=function(M,G,ct){return M.pending_buf[M.d_buf+2*M.last_lit]=G>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&G,M.pending_buf[M.l_buf+M.last_lit]=255&ct,M.last_lit++,G===0?M.dyn_ltree[2*ct]++:(M.matches++,G--,M.dyn_ltree[2*(E[ct]+h+1)]++,M.dyn_dtree[2*z(G)]++),M.last_lit===M.lit_bufsize-1},i._tr_align=function(M){at(M,2,3),lt(M,A,et),function(G){G.bi_valid===16?(Et(G,G.bi_buf),G.bi_buf=0,G.bi_valid=0):8<=G.bi_valid&&(G.pending_buf[G.pending++]=255&G.bi_buf,G.bi_buf>>=8,G.bi_valid-=8)}(M)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,f={},p=!1,m=o.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(o);w=w&&w.setTimeout?w:o,c={}.toString.call(o.process)==="[object process]"?function(I){mr.nextTick(function(){T(I)})}:function(){if(o.postMessage&&!o.importScripts){var I=!0,U=o.onmessage;return o.onmessage=function(){I=!1},o.postMessage("","*"),o.onmessage=U,I}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(I){o.postMessage(h+I,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(I){T(I.data)},function(I){u.port2.postMessage(I)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(I){var U=m.createElement("script");U.onreadystatechange=function(){T(I),U.onreadystatechange=null,l.removeChild(U),U=null},l.appendChild(U)}):function(I){setTimeout(T,0,I)},w.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var U=new Array(arguments.length-1),R=0;R<U.length;R++)U[R]=arguments[R+1];var O={callback:I,args:U};return f[d]=O,c(d),d++},w.clearImmediate=b}function b(I){delete f[I]}function T(I){if(p)setTimeout(T,0,I);else{var U=f[I];if(U){p=!0;try{(function(R){var O=R.callback,P=R.args;switch(P.length){case 0:O();break;case 1:O(P[0]);break;case 2:O(P[0],P[1]);break;case 3:O(P[0],P[1],P[2]);break;default:O.apply(a,P)}})(U)}finally{b(I),p=!1}}}}function A(I){I.source===o&&typeof I.data=="string"&&I.data.indexOf(h)===0&&T(+I.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof An<"u"?An:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(c1);var R8=c1.exports,kd=vs(R8);const l1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(l1);var fr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Ro,Oa,ks;class S8{constructor(...t){Ro.set(this,new Map),Oa.set(this,new Map),ks.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),fr(this,ks,"f").has(r)||fr(this,ks,"f").set(r,new Set);const s=fr(this,ks,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&fr(this,Oa,"f").set(r,a),o=!1,c)continue;const l=fr(this,Ro,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);fr(this,Ro,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:fr(this,Ro,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&fr(this,Oa,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:fr(this,ks,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of fr(this,ks,"f").values())Object.freeze(t);return this}_getTestState(){return{types:fr(this,Ro,"f"),extensions:fr(this,Oa,"f")}}}Ro=new WeakMap,Oa=new WeakMap,ks=new WeakMap;var I8=new S8(l1)._freeze();function u1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return I8.getType(e)??"application/octet-stream"}async function N8(e,t,n){try{ri(H,e,t.name);const r=await t.arrayBuffer();(await new kd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=u1(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{_e(H,e,"crash",c.message)})})}catch(r){_e(H,e,"crash",r.message)}}async function O8(e,t,n){try{ri(H,t,e.name);const r=await e.arrayBuffer();n(new Uint8Array(r))}catch(r){_e(H,t,"crash",r.message)}}function h1(e,t){function n(r){if(x(t))switch(r){case"text/plain":t.text().then(i=>au(H,e,void 0,"text",`file:${t.name}`,i)).catch(i=>_e(H,e,"crash",i.message));break;case"application/json":t.text().then(i=>au(H,e,void 0,"json",`file:${t.name}`,i)).catch(i=>_e(H,e,"crash",i.message));break;case"application/zip":N8(e,t,i=>h1(e,i)).catch(i=>_e(H,e,"crash",i.message));break;case"application/octet-stream":O8(t,e,i=>au(H,e,void 0,"binary",`file:${t.name}`,i)).catch(i=>_e(H,e,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=u1(t.name,new Uint8Array(i));if(s)n(s);else return _e(H,e,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>_e(H,e,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function So(e,t,n){function r(i){_e(e,t,"crash",i.message)}n().catch(r)}function C8(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function L8(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const M8=new Date("1980/09/02");async function f1(e){return console.info("saved",e),new Promise((t,n)=>{const r=new kd;for(let i=0;i<e.length;++i){const s=e[i],o=UL(s);if(o){const a=OT(o);x(a)&&r.file(s.id,a,{date:M8})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(L8(i))}).catch(n)})}async function U8(e){return new Promise((t,n)=>{const r=new kd;r.loadAsync(C8(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=FL(CT(c));x(l)&&i.push(l)}t(i)}).catch(n)})}const d1="$yellow$205$205$205$196";function p1(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Qe;function F8(){return!!Qe}function P8(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let h=i;h<=o;++h)for(let d=r;d<=s;++d){const f={x:d-r,y:h-i},p=Te(e,{x:d,y:h});(p==null?void 0:p.category)===Jn.ISOBJECT?(l.push($n(eo(e,d,h))),Pi(p)!=="player"&&u.push({...$n(p),...f,id:"blank"})):l.push({...$n(p),...f})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}function B8(e,t,n,r){const i=qn(e);if(x(i))switch(Qe=P8(i,t,n),r){case"copyobjects":Qe.terrain=[];break;case"copyterrain":Qe.objects=[];break}}function D8(e,t,n){const r=p1(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,d1),$t(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),$t(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),$t(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=Tn(e);i.scroll=ei(e)}function $8(e,t,n,r){const i=qn(e);if(!x(i)||!x(Qe))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),l=a-s+1,u=c-o+1,h=Math.min(Qe.width,l),d=Math.min(Qe.height,u);switch(r){case"pasteall":{for(let f=0;f<d;++f)for(let p=0;p<h;++p){const m=Vs({x:p,y:f},Qe.width);sn(i,{...Qe.terrain[m],x:s+p,y:o+f})}for(let f=0;f<Qe.objects.length;++f){const p=Qe.objects[f];x(p.x)&&x(p.y)&&ih(p.x,p.y,0,l-1,u-1,0)&&Rh(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let f=0;f<Qe.objects.length;++f){const p=Qe.objects[f];x(p.x)&&x(p.y)&&ih(p.x,p.y,0,l-1,u-1,0)&&Rh(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let f=0;f<d;++f)for(let p=0;p<h;++p){const m=Vs({x:p,y:f},Qe.width);sn(i,{...Qe.terrain[m],x:s+p,y:o+f})}break;case"pasteterraintiled":for(let f=o;f<=c;++f)for(let p=s;p<=a;++p){const m=(p-s)%Qe.width,w=(f-o)%Qe.height,b=Vs({x:m,y:w},Qe.width);sn(i,{...Qe.terrain[b],x:p,y:f})}break}}function j8(e,t,n){const r=p1(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,d1),$t(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),$t(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),$t(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),$t(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=Tn(e);i.scroll=ei(e)}const Ts="$yellow$205$205$205$196";function Hl(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function z8(e,t,n,r){const i=qn(e);if(!x(i))return;let s=0;function o(){return s}function a(l,u){St(u)&&(s=u,Dp(t.x,t.y,n.x,n.y).forEach(h=>{const d=Te(i,h);x(d)&&(d[l]=u)}))}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,Ts),$t(e,`batch:${Hl(t,n)}`,"char",[r,"charedit"],o,a);const c=Tn(e);c.scroll=ei(e)}function W8(e,t,n,r){const i=qn(e);if(!x(i))return;let s=0;function o(){return s}function a(l,u){if(St(u)){s=u;for(let h=t.y;h<=n.y;++h)for(let d=t.x;d<=n.x;++d){const f=Te(i,{x:d,y:h});x(f)&&(f[l]=u)}}}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,Ts),$t(e,`batch:${Hl(t,n)}`,"color",[r,"coloredit"],o,a);const c=Tn(e);c.scroll=ei(e)}function K8(e,t,n,r){const i=qn(e);if(!x(i))return;let s=0;function o(){return s}function a(l,u){St(u)&&(s=u,Dp(t.x,t.y,n.x,n.y).forEach(h=>{const d=Te(i,h);x(d)&&(d[l]=u)}))}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,Ts),$t(e,`batch:${Hl(t,n)}`,"color",[r,"coloredit"],o,a);const c=Tn(e);c.scroll=ei(e)}const Ca={stat:"",patternsize:2,mirror:1};function G8(e,t,n){const r=kn(Bt.MAIN);if(!x(r))return;const i=qn(e);if(!x(i))return;const s=Hl(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,Ts),$t(e,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),F8()&&$t(e,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),$t(e,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(f){const{target:p}=pr(f);return Ca[p]}function a(f,p){if(St(p)||kt(p)){const{target:m}=pr(f);Ca[m]=p}}$t(e,"batch","remix",[`stat:${s}`,"text"],o,a),$t(e,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),$t(e,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),$t(e,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),se(e,Ts),$t(e,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),$t(e,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),$t(e,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),se(e,Ts),$t(e,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),se(e,Ts),se(e,"codepages:");const c=Math.min(t.x,n.x),l=Math.min(t.y,n.y),u=Math.max(t.x,n.x),h=Math.max(t.y,n.y),d=new Set;for(let f=l;f<=h;++f)for(let p=c;p<=u;++p){const m=Te(i,{x:p,y:f}),w=H_(r,m);x(w)&&!d.has(w.id)&&(d.add(w.id),$t(e,"batch",`edit @${Be(w)}`,[`pageopen:${w.id}`]))}}const Io="$yellow$205$205$205$196";function Td(e,t){return`inspect:${t!=null&&t.id?t.id:Er(e,t)}`}function H8(e,t,n){const r=kn(Bt.MAIN);if(!x(r))return;const i=qn(e);if(!x(i))return;function s(d){var p;return(t==null?void 0:t[d])??((p=t==null?void 0:t.kinddata)==null?void 0:p[d])??0}function o(d,f){x(t)&&(t[d]=f)}const a=t.category===Jn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Td(i,t);se(e,`${a}: ${c} ${l}`),se(e,Io),$t(e,u,"color",[n,"coloredit"],s,o);const h=Tn(e);h.scroll=ei(e)}function Y8(e,t,n){const r=kn(Bt.MAIN);if(!x(r))return;const i=qn(e);if(!x(i))return;function s(d){var p;return(t==null?void 0:t[d])??((p=t==null?void 0:t.kinddata)==null?void 0:p[d])??0}function o(d,f){x(t)&&(t[d]=f)}const a=t.category===Jn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Td(i,t);se(e,`${a}: ${c} ${l}`),se(e,Io),$t(e,u,"char",[n,"charedit"],s,o);const h=Tn(e);h.scroll=ei(e)}function V8(e,t,n,r,i,s){var h,d,f;function o(p){var w;const m=(r==null?void 0:r[p])??((w=r==null?void 0:r.kinddata)==null?void 0:w[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Gt.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?se(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):se(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),se(e,Io);const c=Td(t,r);s?($t(e,c,"cycle",["cycle","number","1","255"],o,a),$t(e,c,"collision",["collision","select","iswalking",`${Gt.ISWALK}`,"isswimming",`${Gt.ISSWIM}`],o,a)):$t(e,c,"collision",["collision","select","iswalkable",`${Gt.ISWALK}`,"isswimable",`${Gt.ISSWIM}`,"issolid",`${Gt.ISSOLID}`],o,a),s&&$t(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),$t(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const l=ka(n),u=Nr(l);for(let p=0;p<u.length;++p){const m=u[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ae(l[m])){const[w,b,...T]=l[m];kt(b)&&$t(e,c,b||m,[m,w,...T],o,a)}break}}$t(e,c,"copy coords",["copycoords","hk","5"," 5 "]),se(e,Io),$t(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),$t(e,c,`color: ${r.color??((d=r.kinddata)==null?void 0:d.color)??15}`,["color","hk","c"," C ","next"],o,a),$t(e,c,`bg: ${r.bg??((f=r.kinddata)==null?void 0:f.bg)??0}`,["bg","hk","b"," B ","next"],o,a),se(e,Io),$t(e,c,"make empty",["empty","hk","0"],o,a),se(e,Io),$t(e,"batch",`edit @${Be(n)}`,[`pageopen:${n.id}`])}const m1="$yellow$205$205$205$196";function X8(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function q8(e,t,n,r){const i=kn(Bt.MAIN);if(!x(i))return;const s=qn(e);if(x(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Te(s,{x:a,y:o});(c==null?void 0:c.category)===Jn.ISOBJECT&&Vn(i,s,c,i.timestamp),sn(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Te(s,{x:a,y:o});(c==null?void 0:c.category)===Jn.ISOBJECT&&Vn(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)sn(s,{x:a,y:o});break}}}function J8(e,t,n){const r=X8(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,m1),$t(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),$t(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),$t(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=Tn(e);i.scroll=ei(e)}function Z8(e,t,n){const r=kn(Bt.MAIN);if(!x(r))return;const i=qn(e);if(!x(i))return;if(ze(r,i),t.x===n.x&&t.y===n.y){const o=Te(i,t),a=H_(r,o);x(o)&&x(a)&&V8(e,i,a,o,t,pn(o)),o!=null&&o.kind||(se(e,`empty: ${t.x}, ${t.y}`),se(e,m1),$t(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]))}else G8(e,t,n);const s=Tn(e);s.scroll=ei(e)}function Q8(e,t){const n=he(Bt.MAIN);if(!x(n))return;const r=qn(t);if(!x(r))return;const i=pr(e),s=FT(r,i.target);if(x(s))switch(i.path){case"copycoords":su(H,Sr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":H8(t,s,i.path);break;case"char":Y8(t,s,i.path);break;case"empty":Vn(n,r,s,n.timestamp);break;case"code":So(H,t,async()=>{const o=Pi(s),a="object";We(H,t,`opened [${a}] ${o}`);const c=[r.id,s.id];rh(Pa(n.id,c),s.code??""),_E(H,t),await Gd(800),zd(H,t,n.id,c,a,`${o} - ${n.name}`,[])});break;default:console.info("unknown inspect",i);break}}function t3(e,t){const n=qn(t);if(!x(n))return;const r=pr(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":D8(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":B8(t,c,l,r.target);break;case"paste":j8(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":$8(t,c,l,r.target);break;case"empty":J8(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":q8(t,c,l,r.target);break;case"chars":z8(t,c,l,"char");break;case"colors":W8(t,c,l,"color");break;case"bgs":K8(t,c,l,"bg");break;case"copycoords":su(H,t,[i,s,o,a].join(" "));break;case"remixrun":{const u=Mn(y.book,yt.BOARD,Ca.stat),h=xe(...u);x(h)&&Sb(n.id,h.id,Ca.patternsize,Ca.mirror,c,l,"all");break}case"pageopen":So(H,t,async()=>{await Gd(800),PE(H,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const e3=16,As={},n3=15*60*5;let g1=0;const No={},Oo={};async function y1(e){const t=ko(),n=he(Bt.MAIN);if(t.length&&x(n)){const r=await f1(t),i=e?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;wE(oe,Sr(),i,r)}}async function r3(){const e=ko(),t=he(Bt.MAIN);if(e.length&&x(t)){const n=await f1(e);xE(oe,Sr(),n)}}const oe=Ss("vm",["tick","second"],e=>{var n;if(!oe.session(e))return;const t=Sr();switch(e.target){case"operator":r8(e.player),jt(oe,e.player,`operator set to ${e.player}`),oe.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=he(Bt.MAIN);oe.replynext(e,"ackzsswords",{cli:cd(Hi.CLI),loader:cd(Hi.LOADER),runtime:cd(Hi.RUNTIME),flags:[...Nr(ti(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...ys(r,yt.OBJECT).map(i=>Be(i)),...Nr(rd)],altkinds:[...ys(r,yt.TERRAIN),...ys(r,yt.BOARD),...ys(r,yt.PALETTE),...ys(r,yt.CHARSET),...ys(r,yt.LOADER)].map(i=>Be(i)),colors:[...Nr(Xo)],dirs:[...Nr(hh).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Nr(id)]});break}case"books":e.player===t&&So(oe,e.player,async()=>{if(ae(e.data)){const[r,i]=e.data,s=await U8(r),o=s.map(a=>a.name);l8(s,i),jt(oe,e.player,`loading ${o.join(", ")}`),iu(oe,e.player)}});break;case"search":d8(e.player)||iu(oe,e.player);break;case"logout":f8(e.player),delete As[e.player],jt(oe,t,`player ${e.player} logout`),iu(oe,e.player);break;case"login":h8(e.player)?(As[e.player]=0,jt(oe,Sr(),`login from ${e.player}`),oe.replynext(e,"acklogin",!0)):EE(oe,e.player);break;case"doot":As[e.player]=0,Dd(oe,e.player,"active");break;case"input":{const r=ti(e.player),[i=bn.NONE,s=0]=e.data??[bn.NONE,0];ae(r.inputqueue)||(r.inputqueue=[]),i!==bn.NONE&&r.inputqueue.push([i,s]);break}case"codewatch":if(ae(e.data)){const[r,i]=e.data,s=Pa(r,i);x(Oo[s])||(Oo[s]=Pp(s,o=>{const[a,c]=i,l=Ir(r),u=xi(l,a);if(x(u))if(Ei(u)===yt.BOARD&&x(c)){const h=Ne(u),d=_n(h,c);x(d)&&(d.code=o,$f(j_(o),d))}else u.code=o,ML(u)})),No[s]=No[s]??new Set,No[s].add(e.player)}break;case"coderelease":if(ae(e.data)){const[r,i]=e.data,[,s]=i,o=Pa(r,i);x(No[o])&&(No[o].delete(e.player),No[o].size===0&&((n=Oo[o])==null||n.call(Oo),Oo[o]=void 0,kt(s)&&g8(s)))}break;case"halt":e.player===t&&eE(e.data)&&i8(e.data);break;case"tick":s8()||_8();break;case"synthsend":kt(e.data)&&Ed(e.data,void 0);break;case"second":{p8(As);const r=Object.keys(As);for(let i=0;i<r.length;++i)++As[r[i]];for(let i=0;i<r.length;++i){const s=r[i];As[s]>=e3&&Wd(oe,s)}++g1>=n3&&(g1=0,So(oe,e.player,async()=>{await y1(!0)}));break}case"copyjsonfile":if(e.player===t){const r=he(Bt.MAIN);if(x(r)&&ae(e.data)){const[i]=e.data,s=xi(r,i);x(s)&&kE(oe,t,s,`${Be(s)}.${wi(s)}.json`)}}break;case"refsheet":{const r=he(Bt.MAIN),i=kl(r);x(r)&&ae(e.data)&&(FE(oe,e.player),Es(oe,e.player,"use as refsheet"),i.forEach(s=>{const o=Be(s),a=wi(s);jt(oe,e.player,`!pageopenwith ${s.id} ${e.data.join(" ")};$blue[${a}]$white ${o}`)}));break}case"fork":e.player===t&&So(oe,e.player,async()=>{await r3()});break;case"flush":e.player===t&&So(oe,e.player,async()=>{await y1()});break;case"cli":i1(e.player,e.data);break;case"clirepeatlast":b8(e.player);break;case"restart":e.player===t&&(y8(),Kd(oe,e.player));break;case"inspect":if(ae(e.data)){const[r,i]=e.data;Z8(e.player,r,i)}break;case"loader":if(ae(e.data)){const[r,i,s,o]=e.data;if(i==="file")h1(e.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){jt(oe,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=he(Bt.MAIN);x(c)&&x(a.data)&&kt(a.exported)&&(bd(a.data),jt(oe,e.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){jt(oe,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=he(Bt.MAIN);x(c)&&x(a.data)&&kt(a.exported)&&(Y_(c,a.data),jt(oe,e.player,`loaded ${a.exported}`))}else A6(r,i,s,o,e.player)}break;default:{const{target:r,path:i}=pr(e.target);switch(Ot(r)){case"batch":t3(i,e.player);break;case"empty":{const s=pr(i);switch(s.target){case"copycoords":su(oe,Sr(),s.path.split(",").join(" "));break}break}case"inspect":Q8(i,e.player);break;case"touched":if(ae(e.data)){const[s,o,a]=e.data;n1({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:n1(e);break}break}}},n8());function i3(){bE(oe)}const{forward:s3}=WE(e=>{KE(e)&&postMessage(e)});onmessage=function(t){s3(t.data)},setTimeout(i3,100)})();

var q$=Object.defineProperty;var J$=(fi,Jn,Fn)=>Jn in fi?q$(fi,Jn,{enumerable:!0,configurable:!0,writable:!0,value:Fn}):fi[Jn]=Fn;var xt=(fi,Jn,Fn)=>J$(fi,typeof Jn!="symbol"?Jn+"":Jn,Fn);(function(){"use strict";const fi=new Set,Jn={emit(e,t,n,r,i){Jn.invoke($w(e,t,n,r,i))},invoke(e){fi.forEach(t=>t.handle(e))},connect(e){fi.add(e)},disconnect(e){fi.delete(e)}};var Fn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Us(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function iw(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Wd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Fn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Wd);var sw=Wd.exports,Gd=Us(sw),Kd={};(function(e){var t=Fn&&Fn.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,m;d<h;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,k=l.addAdverb,b=k===void 0?!1:k,v=t(t(t([],t([],Array(p),!0).map(function(T){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),b?[n(e.adverbs)]:[],!0);return h&&(v=v.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),v.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return r(e.adjectives).length*f+f*p.length+r(e.nouns).length+p.length+r(e.verbs).length+(h?r(e.adverbs).length+p.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(e.adjectives).length*f+f*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(h?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(Kd);var Hd=Us(Kd);const ow="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let aw=e=>crypto.getRandomValues(new Uint8Array(e)),cw=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Yd=(e,t=21)=>cw(e,t,aw),lw=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=ow[n[e]&63];return t};var Vd="abcdefghijklmnopqrstuvwxyz",Xd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",qd="0123456789",uw="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",hw="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const fw=qd,dw=Vd,pw=Xd;var mw=fw+dw+pw,cu={lowercase:Vd,uppercase:Xd,numbers:qd,nolookalikes:uw,nolookalikesSafe:hw,alphanumeric:mw};function De(){return`sid_${lw(12).replaceAll("-",".")}`}Yd(cu.numbers,4),Yd(`${cu.numbers}${cu.lowercase}`,16);function bn(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function gw(){return Hd({capitalize:!1,adjectiveCount:1})}function _w(){return Hd({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var yw=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),bw=Object.prototype.hasOwnProperty;function lu(e,t){return bw.call(e,t)}function uu(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)lu(e,i)&&r.push(i);return r}function Bn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function hu(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function is(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Jd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function fu(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(fu(e[t]))return!0}else if(typeof e=="object"){for(var r=uu(e),i=r.length,s=0;s<i;s++)if(fu(e[r[s]]))return!0}}return!1}function Zd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Qd=function(e){yw(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Zd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Zd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Fe=Qd,kw=Bn,Fs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Wa(n,this.path);r&&(r=Bn(r));var i=ss(n,{op:"remove",path:this.from}).removed;return ss(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Wa(n,this.from);return ss(n,{op:"add",path:this.path,value:Bn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Lo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Ew={add:function(e,t,n){return hu(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Fs.move,copy:Fs.copy,test:Fs.test,_get:Fs._get};function Wa(e,t){if(t=="")return e;var n={op:"_get",path:t};return ss(e,n),n.value}function ss(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ga(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Wa(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Lo(e,t.value),o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Bn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,m=void 0;for(typeof n=="function"?m=n:m=Ga;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Jd(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!hu(h))throw new Fe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);hu(h)&&(h=~~h)}if(u>=f){if(n&&t.op==="add"&&h>l.length)throw new Fe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=Ew[t.op].call(t,l,h,e);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Fs[t.op].call(t,l,h,e);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Fe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function du(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Bn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=ss(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function ww(e,t,n){var r=ss(e,t);if(r.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ga(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Fe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Fs[e.op]){if(typeof e.path!="string")throw new Fe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Fe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Fe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&fu(e.value))throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Fe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Fe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=t0([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Fe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function t0(e,t,n){try{if(!Array.isArray(e))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)du(Bn(t),Bn(e),n||!0);else{n=n||Ga;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Fe)return i;throw i}}function Lo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Lo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Lo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var xw=Object.freeze({__proto__:null,JsonPatchError:Fe,_areEquals:Lo,applyOperation:ss,applyPatch:du,applyReducer:ww,deepClone:kw,getValueByPointer:Wa,validate:t0,validator:Ga});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var pu=new WeakMap,vw=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Tw=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Aw(e){return pu.get(e)}function Sw(e,t){return e.observers.get(t)}function Rw(e,t){e.observers.delete(t.callback)}function Ow(e,t){t.unobserve()}function Nw(e,t){var n=[],r,i=Aw(e);if(!i)i=new vw(e),pu.set(e,i);else{var s=Sw(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Bn(e),t){r.callback=t,r.next=null;var o=function(){mu(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){mu(r),clearTimeout(r.next),Rw(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new Tw(t,r)),r}function mu(e,t){t===void 0&&(t=!1);var n=pu.get(e.object);gu(n.value,e.object,e.patches,"",t),e.patches.length&&du(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function gu(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=uu(t),o=uu(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(lu(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?gu(u,f,n,r+"/"+is(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+is(l),value:Bn(u)}),n.push({op:"replace",path:r+"/"+is(l),value:Bn(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+is(l),value:Bn(u)}),n.push({op:"remove",path:r+"/"+is(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!lu(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+is(l),value:Bn(t[l])})}}}function e0(e,t,n){n===void 0&&(n=!1);var r=[];return gu(e,t,r,"",n),r}var Iw=Object.freeze({__proto__:null,compare:e0,generate:mu,observe:Nw,unobserve:Ow});Object.assign({},xw,Iw,{JsonPatchError:Qd,deepClone:Bn,escapePathComponent:is,unescapePathComponent:Jd});var Cw=typeof Element<"u",Lw=typeof Map=="function",Mw=typeof Set=="function",Uw=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ka(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ka(e[r],t[r]))return!1;return!0}var s;if(Lw&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ka(r.value[1],t.get(r.value[0])))return!1;return!0}if(Mw&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(Uw&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(Cw&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ka(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var Fw=function(t,n){try{return Ka(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Bw=Us(Fw);function y(e){return e!=null}const Zn=Object.keys;function Tr(e){return Bn(e)}function Pw(e){return typeof e=="boolean"}function wt(e){return typeof e=="number"&&isNaN(e)===!1}function gt(e){return typeof e=="string"}function ue(e){return Array.isArray(e)}function _u(e){return e}var Mt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Mt||{}),Gt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Gt||{}),Pn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Pn||{}),pt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e[e.MID=22]="MID",e[e.OVER=23]="OVER",e[e.UNDER=24]="UNDER",e))(pt||{}),At=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.ZSSEDIT=14]="ZSSEDIT",e[e.CHAREDIT=15]="CHAREDIT",e[e.COLOREDIT=16]="COLOREDIT",e))(At||{});function Ct(e){return(e==null?void 0:e.toLowerCase().trim())??""}function $w(e,t,n,r,i){return{session:e,player:t,id:De(),sender:n,target:r,data:i}}function $n(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Bs(e,t=[],n=_u,r=""){const i=De(),s=Ct(e),o=t.map(Ct);let a=r;const c={id(){return i},name(){return e},session(l){return y(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,f){Jn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=$n(l.target),d=Ct(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&y(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Jn.connect(c),c}function Dw(e){return typeof e=="object"&&gt(e.session)&&gt(e.player)&&gt(e.id)&&gt(e.sender)&&gt(e.target)}function de(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function jw(e,t,...n){return e.emit(t,"info",n),!0}function xe(e,t,...n){return e.emit(t,"log",n),!0}function n0(e,t,n){e.emit(t,"toast",n)}function zw(e,t,n){e.emit(t,"bridge:streamstart",n)}function Ww(e,t){e.emit(t,"bridge:streamstop",void 0)}function Gw(e,t,n){e.emit(t,"bridge:chatstart",n)}function Kw(e,t){e.emit(t,"bridge:chatstop")}function Hw(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function Yw(e,t){e.emit(t,"bridge:talkstart",t)}function Vw(e,t){e.emit(t,"bridge:talkstop",t)}function Xw(e,t){e.emit(t,"bridge:mediastart",t)}function qw(e,t){e.emit(t,"bridge:mediastop",t)}function Jw(e,t,n){e.emit(t,"bridge:start",n)}function Zw(e,t,n){e.emit(t,"bridge:tab",n)}function Qw(e,t,n){e.emit(t,"gadgetclient:paint",n)}function tx(e,t,n){e.emit(t,"gadgetclient:patch",n)}function ex(e,t){e.emit(t,"gadgetserver:clearscroll")}function nx(e){e.emit("","ready")}function r0(e,t){e.emit(t,"register:loginfail")}function yu(e,t){e.emit(t,"register:loginready",!0)}function rx(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function ix(e,t,n){e.emit(t,"register:forkmem",[n])}function sx(e,t,n,r){e.emit(t,"register:itchiopublishmem",[n,r])}function bu(e,t,n){e.emit(t,"register:copy",n)}function ox(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function i0(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function ax(e,t){e.emit(t,"register:dev",void 0)}function cx(e,t){e.emit(t,"register:share",void 0)}function lx(e,t){e.emit(t,"register:nuke",void 0)}function ux(e,t){e.emit(t,"register:enterar",void 0)}function hx(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function fx(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function dx(e,t,n){e.emit(t,"synth:focus",n)}function px(e,t,n){e.emit(t,"synth:bpm",n)}function mx(e,t,n){e.emit(t,"synth:playvolume",n)}function gx(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function _x(e,t,n){e.emit(t,"synth:ttsvolume",n)}function ku(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function s0(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function o0(e,t,n,r){e.emit(t,"register:config",[n,r])}function yx(e,t){e.emit(t,"register:configshow")}function bx(e,t){e.emit(t,"register:inspector")}function a0(e,t,n,r,i,s){e.emit(t,"register:editor:open",[n,r,i,s])}function kx(e,t){e.emit(t,"vm:local")}function c0(e,t){e.emit(t,"vm:logout")}function Ha(e,t){const[n,r]=t;return`${e}:${[n,r].filter(y).join(":")}`}function Ex(e,t,n){e.emit(t,"vm:cli",n)}function wx(e,t){e.emit(t,"vm:restart")}function l0(e,t){e.emit(t,"vm:flush")}function xx(e,t){e.emit(t,"vm:fork")}function vx(e,t){e.emit(t,"vm:itchiopublish")}function Tx(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function Ax(e,t){return{filename:e,json:t}}function Sx(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Eu(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=Tx(i,s);break;case"json":o=Ax(i,s);break;case"binary":o=Sx(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function Rx(e){const t=new Set;function n(s){Dw(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Jn.invoke(s))}const r=Bs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Jn.disconnect(r)}return{forward:n,disconnect:i}}function Ox(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=$n(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const wu=66.666,Ya=Math.round(1e3/wu),Nx=3;function u0(e){return new Promise(t=>setTimeout(t,e))}const xu=Bs("clock");let vu=0,Va=0,Tu=0,h0=performance.now();function f0(){const e=performance.now(),t=e-h0;Tu+=t,Tu>=wu&&(Tu%=wu,xu.emit("","tick",Va),xu.emit("","tock",Va),++vu,++Va,vu>=Ya&&(vu%=Ya,xu.emit("","second",Va))),h0=e,setTimeout(f0,2)}f0();function Ix(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d0={exports:{}},je=d0.exports={},Wr,Gr;function Au(){throw new Error("setTimeout has not been defined")}function Su(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Wr=setTimeout:Wr=Au}catch{Wr=Au}try{typeof clearTimeout=="function"?Gr=clearTimeout:Gr=Su}catch{Gr=Su}})();function p0(e){if(Wr===setTimeout)return setTimeout(e,0);if((Wr===Au||!Wr)&&setTimeout)return Wr=setTimeout,setTimeout(e,0);try{return Wr(e,0)}catch{try{return Wr.call(null,e,0)}catch{return Wr.call(this,e,0)}}}function Cx(e){if(Gr===clearTimeout)return clearTimeout(e);if((Gr===Su||!Gr)&&clearTimeout)return Gr=clearTimeout,clearTimeout(e);try{return Gr(e)}catch{try{return Gr.call(null,e)}catch{return Gr.call(this,e)}}}var di=[],Ps=!1,os,Xa=-1;function Lx(){!Ps||!os||(Ps=!1,os.length?di=os.concat(di):Xa=-1,di.length&&m0())}function m0(){if(!Ps){var e=p0(Lx);Ps=!0;for(var t=di.length;t;){for(os=di,di=[];++Xa<t;)os&&os[Xa].run();Xa=-1,t=di.length}os=null,Ps=!1,Cx(e)}}je.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];di.push(new g0(e,t)),di.length===1&&!Ps&&p0(m0)};function g0(e,t){this.fun=e,this.array=t}g0.prototype.run=function(){this.fun.apply(null,this.array)},je.title="browser",je.browser=!0,je.env={},je.argv=[],je.version="",je.versions={};function pi(){}je.on=pi,je.addListener=pi,je.once=pi,je.off=pi,je.removeListener=pi,je.removeAllListeners=pi,je.emit=pi,je.prependListener=pi,je.prependOnceListener=pi,je.listeners=function(e){return[]},je.binding=function(e){throw new Error("process.binding is not supported")},je.cwd=function(){return"/"},je.chdir=function(e){throw new Error("process.chdir is not supported")},je.umask=function(){return 0};var Mx=d0.exports;const Ar=Ix(Mx);var Vt={},Ru=Symbol.for("react.transitional.element"),Ux=Symbol.for("react.portal"),Fx=Symbol.for("react.fragment"),Bx=Symbol.for("react.strict_mode"),Px=Symbol.for("react.profiler"),$x=Symbol.for("react.consumer"),Dx=Symbol.for("react.context"),jx=Symbol.for("react.forward_ref"),zx=Symbol.for("react.suspense"),Wx=Symbol.for("react.memo"),_0=Symbol.for("react.lazy"),y0=Symbol.iterator;function Gx(e){return e===null||typeof e!="object"?null:(e=y0&&e[y0]||e["@@iterator"],typeof e=="function"?e:null)}var b0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k0=Object.assign,E0={};function $s(e,t,n){this.props=e,this.context=t,this.refs=E0,this.updater=n||b0}$s.prototype.isReactComponent={},$s.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},$s.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function w0(){}w0.prototype=$s.prototype;function Ou(e,t,n){this.props=e,this.context=t,this.refs=E0,this.updater=n||b0}var Nu=Ou.prototype=new w0;Nu.constructor=Ou,k0(Nu,$s.prototype),Nu.isPureReactComponent=!0;var x0=Array.isArray,ve={H:null,A:null,T:null,S:null,V:null},v0=Object.prototype.hasOwnProperty;function Iu(e,t,n,r,i,s){return n=s.ref,{$$typeof:Ru,type:e,key:t,ref:n!==void 0?n:null,props:s}}function Kx(e,t){return Iu(e.type,t,void 0,void 0,void 0,e.props)}function Cu(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ru}function Hx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var T0=/\/+/g;function Lu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Hx(""+e.key):t.toString(36)}function A0(){}function Yx(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(A0,A0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function Ds(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Ru:case Ux:o=!0;break;case _0:return o=e._init,Ds(o(e._payload),t,n,r,i)}}if(o)return i=i(e),o=r===""?"."+Lu(e,0):r,x0(i)?(n="",o!=null&&(n=o.replace(T0,"$&/")+"/"),Ds(i,t,n,"",function(l){return l})):i!=null&&(Cu(i)&&(i=Kx(i,n+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(T0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=r===""?".":r+":";if(x0(e))for(var c=0;c<e.length;c++)r=e[c],s=a+Lu(r,c),o+=Ds(r,t,n,s,i);else if(c=Gx(e),typeof c=="function")for(e=c.call(e),c=0;!(r=e.next()).done;)r=r.value,s=a+Lu(r,c++),o+=Ds(r,t,n,s,i);else if(s==="object"){if(typeof e.then=="function")return Ds(Yx(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function qa(e,t,n){if(e==null)return e;var r=[],i=0;return Ds(e,r,"","",function(s){return t.call(n,s,i++)}),r}function Vx(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var S0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Ar=="object"&&typeof Ar.emit=="function"){Ar.emit("uncaughtException",e);return}console.error(e)};function Xx(){}Vt.Children={map:qa,forEach:function(e,t,n){qa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return qa(e,function(){t++}),t},toArray:function(e){return qa(e,function(t){return t})||[]},only:function(e){if(!Cu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Vt.Component=$s,Vt.Fragment=Fx,Vt.Profiler=Px,Vt.PureComponent=Ou,Vt.StrictMode=Bx,Vt.Suspense=zx,Vt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ve,Vt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return ve.H.useMemoCache(e)}},Vt.cache=function(e){return function(){return e.apply(null,arguments)}},Vt.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=k0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!v0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(r[o]=t[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return Iu(e.type,i,void 0,void 0,s,r)},Vt.createContext=function(e){return e={$$typeof:Dx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:$x,_context:e},e},Vt.createElement=function(e,t,n){var r,i={},s=null;if(t!=null)for(r in t.key!==void 0&&(s=""+t.key),t)v0.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return Iu(e,s,void 0,void 0,null,i)},Vt.createRef=function(){return{current:null}},Vt.forwardRef=function(e){return{$$typeof:jx,render:e}},Vt.isValidElement=Cu,Vt.lazy=function(e){return{$$typeof:_0,_payload:{_status:-1,_result:e},_init:Vx}},Vt.memo=function(e,t){return{$$typeof:Wx,type:e,compare:t===void 0?null:t}},Vt.startTransition=function(e){var t=ve.T,n={};ve.T=n;try{var r=e(),i=ve.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(Xx,S0)}catch(s){S0(s)}finally{ve.T=t}},Vt.unstable_useCacheRefresh=function(){return ve.H.useCacheRefresh()},Vt.use=function(e){return ve.H.use(e)},Vt.useActionState=function(e,t,n){return ve.H.useActionState(e,t,n)},Vt.useCallback=function(e,t){return ve.H.useCallback(e,t)},Vt.useContext=function(e){return ve.H.useContext(e)},Vt.useDebugValue=function(){},Vt.useDeferredValue=function(e,t){return ve.H.useDeferredValue(e,t)},Vt.useEffect=function(e,t,n){var r=ve.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Vt.useId=function(){return ve.H.useId()},Vt.useImperativeHandle=function(e,t,n){return ve.H.useImperativeHandle(e,t,n)},Vt.useInsertionEffect=function(e,t){return ve.H.useInsertionEffect(e,t)},Vt.useLayoutEffect=function(e,t){return ve.H.useLayoutEffect(e,t)},Vt.useMemo=function(e,t){return ve.H.useMemo(e,t)},Vt.useOptimistic=function(e,t){return ve.H.useOptimistic(e,t)},Vt.useReducer=function(e,t,n){return ve.H.useReducer(e,t,n)},Vt.useRef=function(e){return ve.H.useRef(e)},Vt.useState=function(e){return ve.H.useState(e)},Vt.useSyncExternalStore=function(e,t,n){return ve.H.useSyncExternalStore(e,t,n)},Vt.useTransition=function(){return ve.H.useTransition()},Vt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const R0="0123456789abcdef",O0=[],Ja=[];for(let e=0;e<256;e++)O0[e]=R0[e>>4&15]+R0[e&15],e<16&&(e<10?Ja[48+e]=e:Ja[87+e]=e);const N0=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=O0[e[r++]];return n},Za=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=Ja[e.charCodeAt(s++)]<<4|Ja[e.charCodeAt(s++)];return r};for(var I0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qx=typeof Uint8Array>"u"?[]:new Uint8Array(256),Qa=0;Qa<I0.length;Qa++)qx[I0.charCodeAt(Qa)]=Qa;new TextDecoder,new TextEncoder;const C0=typeof window<"u"?window:self,L0=C0.crypto||C0.msCrypto||{};L0.subtle||L0.webkitSubtle;const js=globalThis||void 0||self,Sr=()=>new Map,Mu=e=>{const t=Sr();return e.forEach((n,r)=>{t.set(r,n)}),t},Mi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},Jx=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},Zx=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},zs=()=>new Set,Uu=e=>e[e.length-1],Qx=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},as=Array.from,tv=Array.isArray;class ev{constructor(){this._observers=Sr()}on(t,n){return Mi(this._observers,t,zs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return as((this._observers.get(t)||Sr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Sr()}}const Ui=Math.floor,tc=Math.abs,M0=(e,t)=>e<t?e:t,cs=(e,t)=>e>t?e:t,U0=e=>e!==0?e<0:1/e<0,F0=1,B0=2,Fu=4,Bu=8,Mo=32,mi=64,Qn=128,ec=31,Pu=63,ls=127,nv=2147483647,P0=Number.MAX_SAFE_INTEGER,rv=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ui(e)===e),iv=e=>e.toLowerCase(),sv=/^\s*/g,ov=e=>e.replace(sv,""),av=/([A-Z])/g,$0=(e,t)=>ov(e.replace(av,n=>`${t}${iv(n)}`)),cv=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Uo=typeof TextEncoder<"u"?new TextEncoder:null,lv=Uo?e=>Uo.encode(e):cv;let Fo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Fo&&Fo.decode(new Uint8Array).length===1&&(Fo=null);class Bo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const nc=()=>new Bo,uv=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Kr=e=>{const t=new Uint8Array(uv(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},hv=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(cs(n,t)*2),e.cpos=0)},sn=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},$u=sn,oe=(e,t)=>{for(;t>ls;)sn(e,Qn|ls&t),t=Ui(t/128);sn(e,ls&t)},Du=(e,t)=>{const n=U0(t);for(n&&(t=-t),sn(e,(t>Pu?Qn:0)|(n?mi:0)|Pu&t),t=Ui(t/64);t>0;)sn(e,(t>ls?Qn:0)|ls&t),t=Ui(t/128)},ju=new Uint8Array(3e4),fv=ju.length/3,dv=(e,t)=>{if(t.length<fv){const n=Uo.encodeInto(t,ju).written||0;oe(e,n);for(let r=0;r<n;r++)sn(e,ju[r])}else tr(e,lv(t))},pv=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;oe(e,r);for(let i=0;i<r;i++)sn(e,n.codePointAt(i))},Ws=Uo&&Uo.encodeInto?dv:pv,rc=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=M0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(cs(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},tr=(e,t)=>{oe(e,t.byteLength),rc(e,t)},zu=(e,t)=>{hv(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},mv=(e,t)=>zu(e,4).setFloat32(0,t,!1),gv=(e,t)=>zu(e,8).setFloat64(0,t,!1),_v=(e,t)=>zu(e,8).setBigInt64(0,t,!1),D0=new DataView(new ArrayBuffer(4)),yv=e=>(D0.setFloat32(0,e),D0.getFloat32(0)===e),Po=(e,t)=>{switch(typeof t){case"string":sn(e,119),Ws(e,t);break;case"number":rv(t)&&tc(t)<=nv?(sn(e,125),Du(e,t)):yv(t)?(sn(e,124),mv(e,t)):(sn(e,123),gv(e,t));break;case"bigint":sn(e,122),_v(e,t);break;case"object":if(t===null)sn(e,126);else if(tv(t)){sn(e,117),oe(e,t.length);for(let n=0;n<t.length;n++)Po(e,t[n])}else if(t instanceof Uint8Array)sn(e,116),tr(e,t);else{sn(e,118);const n=Object.keys(t);oe(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ws(e,i),Po(e,t[i])}}break;case"boolean":sn(e,t?120:121);break;default:sn(e,127)}};class j0 extends Bo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&oe(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const z0=e=>{e.count>0&&(Du(e.encoder,e.count===1?e.s:-e.s),e.count>1&&oe(e.encoder,e.count-2))};class ic{constructor(){this.encoder=new Bo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(z0(this),this.count=1,this.s=t)}toUint8Array(){return z0(this),Kr(this.encoder)}}const W0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Du(e.encoder,t),e.count>1&&oe(e.encoder,e.count-2)}};class Wu{constructor(){this.encoder=new Bo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(W0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return W0(this),Kr(this.encoder)}}class bv{constructor(){this.sarr=[],this.s="",this.lensE=new ic}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Bo;return this.sarr.push(this.s),this.s="",Ws(t,this.sarr.join("")),rc(t,this.lensE.toUint8Array()),Kr(t)}}const Fi=e=>new Error(e),Hr=()=>{throw Fi("Method unimplemented")},Yr=()=>{throw Fi("Unexpected case")},G0=Fi("Unexpected end of array"),K0=Fi("Integer out of Range");class sc{constructor(t){this.arr=t,this.pos=0}}const Gs=e=>new sc(e),kv=e=>e.pos!==e.arr.length,Ev=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},er=e=>Ev(e,qt(e)),Ks=e=>e.arr[e.pos++],qt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&ls)*n,n*=128,i<Qn)return t;if(t>P0)throw K0}throw G0},Gu=e=>{let t=e.arr[e.pos++],n=t&Pu,r=64;const i=(t&mi)>0?-1:1;if(!(t&Qn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&ls)*r,r*=128,t<Qn)return i*n;if(n>P0)throw K0}throw G0},Hs=Fo?e=>Fo.decode(er(e)):e=>{let t=qt(e);if(t===0)return"";{let n=String.fromCodePoint(Ks(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ks(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Ku=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},wv=[e=>{},e=>null,Gu,e=>Ku(e,4).getFloat32(0,!1),e=>Ku(e,8).getFloat64(0,!1),e=>Ku(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Hs,e=>{const t=qt(e),n={};for(let r=0;r<t;r++){const i=Hs(e);n[i]=$o(e)}return n},e=>{const t=qt(e),n=[];for(let r=0;r<t;r++)n.push($o(e));return n},er],$o=e=>wv[127-Ks(e)](e);class H0 extends sc{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),kv(this)?this.count=qt(this)+1:this.count=-1),this.count--,this.s}}class oc extends sc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Gu(this);const t=U0(this.s);this.count=1,t&&(this.s=-this.s,this.count=qt(this)+2)}return this.count--,this.s}}class Hu extends sc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Gu(this),n=t&1;this.diff=Ui(t/2),this.count=1,n&&(this.count=qt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class xv{constructor(t){this.decoder=new oc(t),this.str=Hs(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const vv=crypto.getRandomValues.bind(crypto),Y0=()=>vv(new Uint32Array(1))[0],Tv="10000000-1000-4000-8000"+-1e11,Av=()=>Tv.replace(/[018]/g,e=>(e^Y0()&15>>e/4).toString(16)),V0=e=>new Promise(e);Promise.all.bind(Promise);var X0={},ac={};ac.byteLength=Ov,ac.toByteArray=Iv,ac.fromByteArray=Mv;for(var Vr=[],ur=[],Sv=typeof Uint8Array<"u"?Uint8Array:Array,Yu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ys=0,Rv=Yu.length;Ys<Rv;++Ys)Vr[Ys]=Yu[Ys],ur[Yu.charCodeAt(Ys)]=Ys;ur[45]=62,ur[95]=63;function q0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Ov(e){var t=q0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Nv(e,t,n){return(t+n)*3/4-n}function Iv(e){var t,n=q0(e),r=n[0],i=n[1],s=new Sv(Nv(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=ur[e.charCodeAt(c)]<<18|ur[e.charCodeAt(c+1)]<<12|ur[e.charCodeAt(c+2)]<<6|ur[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=ur[e.charCodeAt(c)]<<2|ur[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=ur[e.charCodeAt(c)]<<10|ur[e.charCodeAt(c+1)]<<4|ur[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Cv(e){return Vr[e>>18&63]+Vr[e>>12&63]+Vr[e>>6&63]+Vr[e&63]}function Lv(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Cv(r));return i.join("")}function Mv(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Lv(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Vr[t>>2]+Vr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Vr[t>>10]+Vr[t>>4&63]+Vr[t<<2&63]+"=")),i.join("")}var Vu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Vu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+e[t+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Vu.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,m=r?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=d/c:t+=d*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(t*c-1)*Math.pow(2,i),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+h]=o&255,h+=m,o/=256,l-=8);e[n+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=ac,n=Vu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=L,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const R=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(R,g),R.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(R){if(R>i)throw new RangeError('The value "'+R+'" is invalid for option "size"');const g=new s(R);return Object.setPrototypeOf(g,u.prototype),g}function u(R,g,_){if(typeof R=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(R)}return f(R,g,_)}u.poolSize=8192;function f(R,g,_){if(typeof R=="string")return p(R,g);if(o.isView(R))return b(R);if(R==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R);if(mt(R,o)||R&&mt(R.buffer,o)||typeof a<"u"&&(mt(R,a)||R&&mt(R.buffer,a)))return v(R,g,_);if(typeof R=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const U=R.valueOf&&R.valueOf();if(U!=null&&U!==R)return u.from(U,g,_);const G=T(R);if(G)return G;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof R[Symbol.toPrimitive]=="function")return u.from(R[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R)}u.from=function(R,g,_){return f(R,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(R){if(typeof R!="number")throw new TypeError('"size" argument must be of type number');if(R<0)throw new RangeError('The value "'+R+'" is invalid for option "size"')}function h(R,g,_){return d(R),R<=0?l(R):g!==void 0?typeof _=="string"?l(R).fill(g,_):l(R).fill(g):l(R)}u.alloc=function(R,g,_){return h(R,g,_)};function m(R){return d(R),l(R<0?0:A(R)|0)}u.allocUnsafe=function(R){return m(R)},u.allocUnsafeSlow=function(R){return m(R)};function p(R,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=S(R,g)|0;let U=l(_);const G=U.write(R,g);return G!==_&&(U=U.slice(0,G)),U}function k(R){const g=R.length<0?0:A(R.length)|0,_=l(g);for(let U=0;U<g;U+=1)_[U]=R[U]&255;return _}function b(R){if(mt(R,s)){const g=new s(R);return v(g.buffer,g.byteOffset,g.byteLength)}return k(R)}function v(R,g,_){if(g<0||R.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(R.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let U;return g===void 0&&_===void 0?U=new s(R):_===void 0?U=new s(R,g):U=new s(R,g,_),Object.setPrototypeOf(U,u.prototype),U}function T(R){if(u.isBuffer(R)){const g=A(R.length)|0,_=l(g);return _.length===0||R.copy(_,0,0,g),_}if(R.length!==void 0)return typeof R.length!="number"||It(R.length)?l(0):k(R);if(R.type==="Buffer"&&Array.isArray(R.data))return k(R.data)}function A(R){if(R>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return R|0}function L(R){return+R!=R&&(R=0),u.alloc(+R)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),mt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let U=g.length,G=_.length;for(let et=0,ct=Math.min(U,G);et<ct;++et)if(g[et]!==_[et]){U=g[et],G=_[et];break}return U<G?-1:G<U?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let U;if(_===void 0)for(_=0,U=0;U<g.length;++U)_+=g[U].length;const G=u.allocUnsafe(_);let et=0;for(U=0;U<g.length;++U){let ct=g[U];if(mt(ct,s))et+ct.length>G.length?(u.isBuffer(ct)||(ct=u.from(ct)),ct.copy(G,et)):s.prototype.set.call(G,ct,et);else if(u.isBuffer(ct))ct.copy(G,et);else throw new TypeError('"list" argument must be an Array of Buffers');et+=ct.length}return G};function S(R,g){if(u.isBuffer(R))return R.length;if(o.isView(R)||mt(R,o))return R.byteLength;if(typeof R!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof R);const _=R.length,U=arguments.length>2&&arguments[2]===!0;if(!U&&_===0)return 0;let G=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ht(R).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return _t(R).length;default:if(G)return U?-1:ht(R).length;g=(""+g).toLowerCase(),G=!0}}u.byteLength=S;function I(R,g,_){let U=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(R||(R="utf8");;)switch(R){case"hex":return D(this,g,_);case"utf8":case"utf-8":return F(this,g,_);case"ascii":return it(this,g,_);case"latin1":case"binary":return W(this,g,_);case"base64":return P(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yt(this,g,_);default:if(U)throw new TypeError("Unknown encoding: "+R);R=(R+"").toLowerCase(),U=!0}}u.prototype._isBuffer=!0;function $(R,g,_){const U=R[g];R[g]=R[_],R[_]=U}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)$(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)$(this,_,_+3),$(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)$(this,_,_+7),$(this,_+1,_+6),$(this,_+2,_+5),$(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?F(this,0,g):I.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,U,G,et){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),U===void 0&&(U=g?g.length:0),G===void 0&&(G=0),et===void 0&&(et=this.length),_<0||U>g.length||G<0||et>this.length)throw new RangeError("out of range index");if(G>=et&&_>=U)return 0;if(G>=et)return-1;if(_>=U)return 1;if(_>>>=0,U>>>=0,G>>>=0,et>>>=0,this===g)return 0;let ct=et-G,Yt=U-_;const Ie=Math.min(ct,Yt),Ee=this.slice(G,et),Ce=g.slice(_,U);for(let he=0;he<Ie;++he)if(Ee[he]!==Ce[he]){ct=Ee[he],Yt=Ce[he];break}return ct<Yt?-1:Yt<ct?1:0};function N(R,g,_,U,G){if(R.length===0)return-1;if(typeof _=="string"?(U=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,It(_)&&(_=G?0:R.length-1),_<0&&(_=R.length+_),_>=R.length){if(G)return-1;_=R.length-1}else if(_<0)if(G)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,U)),u.isBuffer(g))return g.length===0?-1:z(R,g,_,U,G);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?G?s.prototype.indexOf.call(R,g,_):s.prototype.lastIndexOf.call(R,g,_):z(R,[g],_,U,G);throw new TypeError("val must be string, number or Buffer")}function z(R,g,_,U,G){let et=1,ct=R.length,Yt=g.length;if(U!==void 0&&(U=String(U).toLowerCase(),U==="ucs2"||U==="ucs-2"||U==="utf16le"||U==="utf-16le")){if(R.length<2||g.length<2)return-1;et=2,ct/=2,Yt/=2,_/=2}function Ie(Ce,he){return et===1?Ce[he]:Ce.readUInt16BE(he*et)}let Ee;if(G){let Ce=-1;for(Ee=_;Ee<ct;Ee++)if(Ie(R,Ee)===Ie(g,Ce===-1?0:Ee-Ce)){if(Ce===-1&&(Ce=Ee),Ee-Ce+1===Yt)return Ce*et}else Ce!==-1&&(Ee-=Ee-Ce),Ce=-1}else for(_+Yt>ct&&(_=ct-Yt),Ee=_;Ee>=0;Ee--){let Ce=!0;for(let he=0;he<Yt;he++)if(Ie(R,Ee+he)!==Ie(g,he)){Ce=!1;break}if(Ce)return Ee}return-1}u.prototype.includes=function(g,_,U){return this.indexOf(g,_,U)!==-1},u.prototype.indexOf=function(g,_,U){return N(this,g,_,U,!0)},u.prototype.lastIndexOf=function(g,_,U){return N(this,g,_,U,!1)};function J(R,g,_,U){_=Number(_)||0;const G=R.length-_;U?(U=Number(U),U>G&&(U=G)):U=G;const et=g.length;U>et/2&&(U=et/2);let ct;for(ct=0;ct<U;++ct){const Yt=parseInt(g.substr(ct*2,2),16);if(It(Yt))return ct;R[_+ct]=Yt}return ct}function M(R,g,_,U){return vt(ht(g,R.length-_),R,_,U)}function O(R,g,_,U){return vt(dt(g),R,_,U)}function w(R,g,_,U){return vt(_t(g),R,_,U)}function C(R,g,_,U){return vt(Q(g,R.length-_),R,_,U)}u.prototype.write=function(g,_,U,G){if(_===void 0)G="utf8",U=this.length,_=0;else if(U===void 0&&typeof _=="string")G=_,U=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(U)?(U=U>>>0,G===void 0&&(G="utf8")):(G=U,U=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const et=this.length-_;if((U===void 0||U>et)&&(U=et),g.length>0&&(U<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");G||(G="utf8");let ct=!1;for(;;)switch(G){case"hex":return J(this,g,_,U);case"utf8":case"utf-8":return M(this,g,_,U);case"ascii":case"latin1":case"binary":return O(this,g,_,U);case"base64":return w(this,g,_,U);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,g,_,U);default:if(ct)throw new TypeError("Unknown encoding: "+G);G=(""+G).toLowerCase(),ct=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(R,g,_){return g===0&&_===R.length?t.fromByteArray(R):t.fromByteArray(R.slice(g,_))}function F(R,g,_){_=Math.min(R.length,_);const U=[];let G=g;for(;G<_;){const et=R[G];let ct=null,Yt=et>239?4:et>223?3:et>191?2:1;if(G+Yt<=_){let Ie,Ee,Ce,he;switch(Yt){case 1:et<128&&(ct=et);break;case 2:Ie=R[G+1],(Ie&192)===128&&(he=(et&31)<<6|Ie&63,he>127&&(ct=he));break;case 3:Ie=R[G+1],Ee=R[G+2],(Ie&192)===128&&(Ee&192)===128&&(he=(et&15)<<12|(Ie&63)<<6|Ee&63,he>2047&&(he<55296||he>57343)&&(ct=he));break;case 4:Ie=R[G+1],Ee=R[G+2],Ce=R[G+3],(Ie&192)===128&&(Ee&192)===128&&(Ce&192)===128&&(he=(et&15)<<18|(Ie&63)<<12|(Ee&63)<<6|Ce&63,he>65535&&he<1114112&&(ct=he))}}ct===null?(ct=65533,Yt=1):ct>65535&&(ct-=65536,U.push(ct>>>10&1023|55296),ct=56320|ct&1023),U.push(ct),G+=Yt}return tt(U)}const ot=4096;function tt(R){const g=R.length;if(g<=ot)return String.fromCharCode.apply(String,R);let _="",U=0;for(;U<g;)_+=String.fromCharCode.apply(String,R.slice(U,U+=ot));return _}function it(R,g,_){let U="";_=Math.min(R.length,_);for(let G=g;G<_;++G)U+=String.fromCharCode(R[G]&127);return U}function W(R,g,_){let U="";_=Math.min(R.length,_);for(let G=g;G<_;++G)U+=String.fromCharCode(R[G]);return U}function D(R,g,_){const U=R.length;(!g||g<0)&&(g=0),(!_||_<0||_>U)&&(_=U);let G="";for(let et=g;et<_;++et)G+=fe[R[et]];return G}function yt(R,g,_){const U=R.slice(g,_);let G="";for(let et=0;et<U.length-1;et+=2)G+=String.fromCharCode(U[et]+U[et+1]*256);return G}u.prototype.slice=function(g,_){const U=this.length;g=~~g,_=_===void 0?U:~~_,g<0?(g+=U,g<0&&(g=0)):g>U&&(g=U),_<0?(_+=U,_<0&&(_=0)):_>U&&(_=U),_<g&&(_=g);const G=this.subarray(g,_);return Object.setPrototypeOf(G,u.prototype),G};function X(R,g,_){if(R%1!==0||R<0)throw new RangeError("offset is not uint");if(R+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g],et=1,ct=0;for(;++ct<_&&(et*=256);)G+=this[g+ct]*et;return G},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g+--_],et=1;for(;_>0&&(et*=256);)G+=this[g+--_]*et;return G},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||X(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||X(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||X(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||X(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Wt(function(g){g=g>>>0,rt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,et=this[++g]+this[++g]*2**8+this[++g]*2**16+U*2**24;return BigInt(G)+(BigInt(et)<<BigInt(32))}),u.prototype.readBigUInt64BE=Wt(function(g){g=g>>>0,rt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],et=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U;return(BigInt(G)<<BigInt(32))+BigInt(et)}),u.prototype.readIntLE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g],et=1,ct=0;for(;++ct<_&&(et*=256);)G+=this[g+ct]*et;return et*=128,G>=et&&(G-=Math.pow(2,8*_)),G},u.prototype.readIntBE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=_,et=1,ct=this[g+--G];for(;G>0&&(et*=256);)ct+=this[g+--G]*et;return et*=128,ct>=et&&(ct-=Math.pow(2,8*_)),ct},u.prototype.readInt8=function(g,_){return g=g>>>0,_||X(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||X(g,2,this.length);const U=this[g]|this[g+1]<<8;return U&32768?U|4294901760:U},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||X(g,2,this.length);const U=this[g+1]|this[g]<<8;return U&32768?U|4294901760:U},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Wt(function(g){g=g>>>0,rt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(U<<24);return(BigInt(G)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Wt(function(g){g=g>>>0,rt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(G)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||X(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||X(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||X(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||X(g,8,this.length),n.read(this,g,!1,52,8)};function at(R,g,_,U,G,et){if(!u.isBuffer(R))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>G||g<et)throw new RangeError('"value" argument is out of bounds');if(_+U>R.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,U,G){if(g=+g,_=_>>>0,U=U>>>0,!G){const Yt=Math.pow(2,8*U)-1;at(this,g,_,U,Yt,0)}let et=1,ct=0;for(this[_]=g&255;++ct<U&&(et*=256);)this[_+ct]=g/et&255;return _+U},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,U,G){if(g=+g,_=_>>>0,U=U>>>0,!G){const Yt=Math.pow(2,8*U)-1;at(this,g,_,U,Yt,0)}let et=U-1,ct=1;for(this[_+et]=g&255;--et>=0&&(ct*=256);)this[_+et]=g/ct&255;return _+U},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function Pt(R,g,_,U,G){lt(g,U,G,R,_,7);let et=Number(g&BigInt(4294967295));R[_++]=et,et=et>>8,R[_++]=et,et=et>>8,R[_++]=et,et=et>>8,R[_++]=et;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return R[_++]=ct,ct=ct>>8,R[_++]=ct,ct=ct>>8,R[_++]=ct,ct=ct>>8,R[_++]=ct,_}function Kt(R,g,_,U,G){lt(g,U,G,R,_,7);let et=Number(g&BigInt(4294967295));R[_+7]=et,et=et>>8,R[_+6]=et,et=et>>8,R[_+5]=et,et=et>>8,R[_+4]=et;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return R[_+3]=ct,ct=ct>>8,R[_+2]=ct,ct=ct>>8,R[_+1]=ct,ct=ct>>8,R[_]=ct,_+8}u.prototype.writeBigUInt64LE=Wt(function(g,_=0){return Pt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Wt(function(g,_=0){return Kt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,U,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*U-1);at(this,g,_,U,Ie-1,-Ie)}let et=0,ct=1,Yt=0;for(this[_]=g&255;++et<U&&(ct*=256);)g<0&&Yt===0&&this[_+et-1]!==0&&(Yt=1),this[_+et]=(g/ct>>0)-Yt&255;return _+U},u.prototype.writeIntBE=function(g,_,U,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*U-1);at(this,g,_,U,Ie-1,-Ie)}let et=U-1,ct=1,Yt=0;for(this[_+et]=g&255;--et>=0&&(ct*=256);)g<0&&Yt===0&&this[_+et+1]!==0&&(Yt=1),this[_+et]=(g/ct>>0)-Yt&255;return _+U},u.prototype.writeInt8=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=Wt(function(g,_=0){return Pt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Wt(function(g,_=0){return Kt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function jt(R,g,_,U,G,et){if(_+U>R.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function $t(R,g,_,U,G){return g=+g,_=_>>>0,G||jt(R,g,_,4),n.write(R,g,_,U,23,4),_+4}u.prototype.writeFloatLE=function(g,_,U){return $t(this,g,_,!0,U)},u.prototype.writeFloatBE=function(g,_,U){return $t(this,g,_,!1,U)};function le(R,g,_,U,G){return g=+g,_=_>>>0,G||jt(R,g,_,8),n.write(R,g,_,U,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,U){return le(this,g,_,!0,U)},u.prototype.writeDoubleBE=function(g,_,U){return le(this,g,_,!1,U)},u.prototype.copy=function(g,_,U,G){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(U||(U=0),!G&&G!==0&&(G=this.length),_>=g.length&&(_=g.length),_||(_=0),G>0&&G<U&&(G=U),G===U||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(U<0||U>=this.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("sourceEnd out of bounds");G>this.length&&(G=this.length),g.length-_<G-U&&(G=g.length-_+U);const et=G-U;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,U,G):s.prototype.set.call(g,this.subarray(U,G),_),et},u.prototype.fill=function(g,_,U,G){if(typeof g=="string"){if(typeof _=="string"?(G=_,_=0,U=this.length):typeof U=="string"&&(G=U,U=this.length),G!==void 0&&typeof G!="string")throw new TypeError("encoding must be a string");if(typeof G=="string"&&!u.isEncoding(G))throw new TypeError("Unknown encoding: "+G);if(g.length===1){const ct=g.charCodeAt(0);(G==="utf8"&&ct<128||G==="latin1")&&(g=ct)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<U)throw new RangeError("Out of range index");if(U<=_)return this;_=_>>>0,U=U===void 0?this.length:U>>>0,g||(g=0);let et;if(typeof g=="number")for(et=_;et<U;++et)this[et]=g;else{const ct=u.isBuffer(g)?g:u.from(g,G),Yt=ct.length;if(Yt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(et=0;et<U-_;++et)this[et+_]=ct[et%Yt]}return this};const Jt={};function Ne(R,g,_){Jt[R]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${R}]`,this.stack,delete this.name}get code(){return R}set code(G){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:G,writable:!0})}toString(){return`${this.name} [${R}]: ${this.message}`}}}Ne("ERR_BUFFER_OUT_OF_BOUNDS",function(R){return R?`${R} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ne("ERR_INVALID_ARG_TYPE",function(R,g){return`The "${R}" argument must be of type number. Received type ${typeof g}`},TypeError),Ne("ERR_OUT_OF_RANGE",function(R,g,_){let U=`The value of "${R}" is out of range.`,G=_;return Number.isInteger(_)&&Math.abs(_)>2**32?G=$e(String(_)):typeof _=="bigint"&&(G=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(G=$e(G)),G+="n"),U+=` It must be ${g}. Received ${G}`,U},RangeError);function $e(R){let g="",_=R.length;const U=R[0]==="-"?1:0;for(;_>=U+4;_-=3)g=`_${R.slice(_-3,_)}${g}`;return`${R.slice(0,_)}${g}`}function x(R,g,_){rt(g,"offset"),(R[g]===void 0||R[g+_]===void 0)&&j(g,R.length-(_+1))}function lt(R,g,_,U,G,et){if(R>_||R<g){const ct=typeof g=="bigint"?"n":"";let Yt;throw g===0||g===BigInt(0)?Yt=`>= 0${ct} and < 2${ct} ** ${(et+1)*8}${ct}`:Yt=`>= -(2${ct} ** ${(et+1)*8-1}${ct}) and < 2 ** ${(et+1)*8-1}${ct}`,new Jt.ERR_OUT_OF_RANGE("value",Yt,R)}x(U,G,et)}function rt(R,g){if(typeof R!="number")throw new Jt.ERR_INVALID_ARG_TYPE(g,"number",R)}function j(R,g,_){throw Math.floor(R)!==R?(rt(R,_),new Jt.ERR_OUT_OF_RANGE("offset","an integer",R)):g<0?new Jt.ERR_BUFFER_OUT_OF_BOUNDS:new Jt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,R)}const B=/[^+/0-9A-Za-z-_]/g;function V(R){if(R=R.split("=")[0],R=R.trim().replace(B,""),R.length<2)return"";for(;R.length%4!==0;)R=R+"=";return R}function ht(R,g){g=g||1/0;let _;const U=R.length;let G=null;const et=[];for(let ct=0;ct<U;++ct){if(_=R.charCodeAt(ct),_>55295&&_<57344){if(!G){if(_>56319){(g-=3)>-1&&et.push(239,191,189);continue}else if(ct+1===U){(g-=3)>-1&&et.push(239,191,189);continue}G=_;continue}if(_<56320){(g-=3)>-1&&et.push(239,191,189),G=_;continue}_=(G-55296<<10|_-56320)+65536}else G&&(g-=3)>-1&&et.push(239,191,189);if(G=null,_<128){if((g-=1)<0)break;et.push(_)}else if(_<2048){if((g-=2)<0)break;et.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;et.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;et.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return et}function dt(R){const g=[];for(let _=0;_<R.length;++_)g.push(R.charCodeAt(_)&255);return g}function Q(R,g){let _,U,G;const et=[];for(let ct=0;ct<R.length&&!((g-=2)<0);++ct)_=R.charCodeAt(ct),U=_>>8,G=_%256,et.push(G),et.push(U);return et}function _t(R){return t.toByteArray(V(R))}function vt(R,g,_,U){let G;for(G=0;G<U&&!(G+_>=g.length||G>=R.length);++G)g[G+_]=R[G];return G}function mt(R,g){return R instanceof g||R!=null&&R.constructor!=null&&R.constructor.name!=null&&R.constructor.name===g.name}function It(R){return R!==R}const fe=function(){const R="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const U=_*16;for(let G=0;G<16;++G)g[U+G]=R[_]+R[G]}return g}();function Wt(R){return typeof BigInt>"u"?qn:R}function qn(){throw new Error("BigInt not supported")}})(X0);const pn=X0.Buffer,J0=e=>e===void 0?null:e;class Uv{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Z0=new Uv,Fv=!0;try{typeof localStorage<"u"&&localStorage&&(Z0=localStorage,Fv=!1)}catch{}const Bv=Z0,Pv=Object.assign,$v=Object.keys,Dv=(e,t)=>{for(const n in e)t(e[n],n)},Q0=e=>$v(e).length,jv=e=>{for(const t in e)return!1;return!0},zv=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Wv=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Gv=(e,t)=>e===t||Q0(e)===Q0(t)&&zv(e,(n,r)=>(n!==void 0||Wv(t,r))&&t[r]===n),Kv=Object.freeze,tp=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&tp(e[t])}return Kv(e)},Xu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Xu(e,t,n+1)}},Hv=e=>e,Yv=(e,t)=>t.includes(e);var ep={};const Do=typeof Ar<"u"&&Ar.release&&/node|io\.js/.test(Ar.release.name)&&Object.prototype.toString.call(typeof Ar<"u"?Ar:0)==="[object process]";let Xr;const Vv=()=>{if(Xr===void 0)if(Do){Xr=Sr();const e=Ar.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Xr.set(t,""),t=r):t!==null&&(Xr.set(t,r),t=null)}t!==null&&Xr.set(t,"")}else typeof location=="object"?(Xr=Sr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Xr.set(`--${$0(t,"-")}`,n),Xr.set(`-${$0(t,"-")}`,n)}})):Xr=Sr();return Xr},qu=e=>Vv().has(e),cc=e=>J0(Do?ep[e.toUpperCase().replaceAll("-","_")]:Bv.getItem(e)),np=e=>qu("--"+e)||cc(e)!==null;np("production");const Xv=Do&&Yv(ep.FORCE_COLOR,["true","1","2"])||!qu("--no-colors")&&!np("no-color")&&(!Do||Ar.stdout.isTTY)&&(!Do||qu("--color")||cc("COLORTERM")!==null||(cc("TERM")||"").includes("color")),qv=e=>new Uint8Array(e),Jv=e=>{const t=qv(e.byteLength);return t.set(e),t};class Zv{constructor(t,n){this.left=t,this.right=n}}const gi=(e,t)=>new Zv(e,t);typeof DOMParser<"u"&&new DOMParser;const Qv=e=>Jx(e,(t,n)=>`${n}:${t};`).join(""),_i=Symbol,rp=_i(),ip=_i(),tT=_i(),eT=_i(),nT=_i(),sp=_i(),rT=_i(),Ju=_i(),iT=_i(),sT=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},oT={[rp]:gi("font-weight","bold"),[ip]:gi("font-weight","normal"),[tT]:gi("color","blue"),[nT]:gi("color","green"),[eT]:gi("color","grey"),[sp]:gi("color","red"),[rT]:gi("color","purple"),[Ju]:gi("color","orange"),[iT]:gi("color","black")},op=Xv?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Sr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=oT[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=Qv(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:sT,aT=(...e)=>{console.log(...op(e)),ap.forEach(t=>t.print(e))},cT=(...e)=>{console.warn(...op(e)),e.unshift(Ju),ap.forEach(t=>t.print(e))},ap=zs(),cp=e=>({[Symbol.iterator](){return this},next:e}),lT=(e,t)=>cp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Zu=(e,t)=>cp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Qu{constructor(t,n){this.clock=t,this.len=n}}class jo{constructor(){this.clients=new Map}}const lp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Tp(e,s,a.clock,a.len,n)}}),uT=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ui((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},up=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&uT(n,t.clock)!==null},th=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=cs(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},hT=e=>{const t=new jo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)Qx(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return th(t),t},lc=(e,t,n,r)=>{Mi(e.clients,t,()=>[]).push(new Qu(n,r))},fT=()=>new jo,dT=e=>{const t=fT();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Qu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Vs=(e,t)=>{oe(e.restEncoder,t.clients.size),as(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),oe(e.restEncoder,n);const i=r.length;oe(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},eh=e=>{const t=new jo,n=qt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=qt(e.restDecoder),s=qt(e.restDecoder);if(s>0){const o=Mi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Qu(e.readDsClock(),e.readDsLen()))}}return t},hp=(e,t,n)=>{const r=new jo,i=qt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=qt(e.restDecoder),a=qt(e.restDecoder),c=n.clients.get(o)||[],l=on(n,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&lc(r,o,l,d-l);let h=qr(c,f),m=c[h];for(!m.deleted&&m.id.clock<f&&(c.splice(h+1,0,xc(t,m,f-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(h,0,xc(t,m,d-m.id.clock)),m.delete(t))}else lc(r,o,f,d-f)}}if(r.clients.size>0){const s=new us;return oe(s.restEncoder,0),Vs(s,r),s.toUint8Array()}return null},fp=Y0;class Xs extends ev{constructor({guid:t=Av(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=fp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new wp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=V0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>V0(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&pe(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(as(this.subdocs).map(t=>t.guid))}transact(t,n=null){return pe(this,t,n)}get(t,n=mn){const r=Mi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==mn&&i!==n)if(i===mn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Qs)}getText(t=""){return this.get(t,yi)}getMap(t=""){return this.get(t,to)}getXmlElement(t=""){return this.get(t,no)}getXmlFragment(t=""){return this.get(t,hs)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,as(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Xs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,pe(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class dp{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return qt(this.restDecoder)}readDsLen(){return qt(this.restDecoder)}}class pp extends dp{readLeftID(){return te(qt(this.restDecoder),qt(this.restDecoder))}readRightID(){return te(qt(this.restDecoder),qt(this.restDecoder))}readClient(){return qt(this.restDecoder)}readInfo(){return Ks(this.restDecoder)}readString(){return Hs(this.restDecoder)}readParentInfo(){return qt(this.restDecoder)===1}readTypeRef(){return qt(this.restDecoder)}readLen(){return qt(this.restDecoder)}readAny(){return $o(this.restDecoder)}readBuf(){return Jv(er(this.restDecoder))}readJSON(){return JSON.parse(Hs(this.restDecoder))}readKey(){return Hs(this.restDecoder)}}class pT{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=qt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=qt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class qs extends pT{constructor(t){super(t),this.keys=[],qt(t),this.keyClockDecoder=new Hu(er(t)),this.clientDecoder=new oc(er(t)),this.leftClockDecoder=new Hu(er(t)),this.rightClockDecoder=new Hu(er(t)),this.infoDecoder=new H0(er(t),Ks),this.stringDecoder=new xv(er(t)),this.parentInfoDecoder=new H0(er(t),Ks),this.typeRefDecoder=new oc(er(t)),this.lenDecoder=new oc(er(t))}readLeftID(){return new Js(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Js(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return $o(this.restDecoder)}readBuf(){return er(this.restDecoder)}readJSON(){return $o(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class mT{constructor(){this.restEncoder=nc()}toUint8Array(){return Kr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){oe(this.restEncoder,t)}writeDsLen(t){oe(this.restEncoder,t)}}class zo extends mT{writeLeftID(t){oe(this.restEncoder,t.client),oe(this.restEncoder,t.clock)}writeRightID(t){oe(this.restEncoder,t.client),oe(this.restEncoder,t.clock)}writeClient(t){oe(this.restEncoder,t)}writeInfo(t){$u(this.restEncoder,t)}writeString(t){Ws(this.restEncoder,t)}writeParentInfo(t){oe(this.restEncoder,t?1:0)}writeTypeRef(t){oe(this.restEncoder,t)}writeLen(t){oe(this.restEncoder,t)}writeAny(t){Po(this.restEncoder,t)}writeBuf(t){tr(this.restEncoder,t)}writeJSON(t){Ws(this.restEncoder,JSON.stringify(t))}writeKey(t){Ws(this.restEncoder,t)}}class gT{constructor(){this.restEncoder=nc(),this.dsCurrVal=0}toUint8Array(){return Kr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,oe(this.restEncoder,n)}writeDsLen(t){t===0&&Yr(),oe(this.restEncoder,t-1),this.dsCurrVal+=t}}class us extends gT{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Wu,this.clientEncoder=new ic,this.leftClockEncoder=new Wu,this.rightClockEncoder=new Wu,this.infoEncoder=new j0($u),this.stringEncoder=new bv,this.parentInfoEncoder=new j0($u),this.typeRefEncoder=new ic,this.lenEncoder=new ic}toUint8Array(){const t=nc();return oe(t,0),tr(t,this.keyClockEncoder.toUint8Array()),tr(t,this.clientEncoder.toUint8Array()),tr(t,this.leftClockEncoder.toUint8Array()),tr(t,this.rightClockEncoder.toUint8Array()),tr(t,Kr(this.infoEncoder)),tr(t,this.stringEncoder.toUint8Array()),tr(t,Kr(this.parentInfoEncoder)),tr(t,this.typeRefEncoder.toUint8Array()),tr(t,this.lenEncoder.toUint8Array()),rc(t,Kr(this.restEncoder)),Kr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Po(this.restEncoder,t)}writeBuf(t){tr(this.restEncoder,t)}writeJSON(t){Po(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const _T=(e,t,n,r)=>{r=cs(r,t[0].id.clock);const i=qr(t,r);oe(e.restEncoder,t.length-i),e.writeClient(n),oe(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},nh=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{on(t,s)>i&&r.set(s,i)}),ih(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),oe(e.restEncoder,r.size),as(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{_T(e,t.clients.get(i),i,s)})},yT=(e,t)=>{const n=Sr(),r=qt(e.restDecoder);for(let i=0;i<r;i++){const s=qt(e.restDecoder),o=new Array(s),a=e.readClient();let c=qt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(ec&u){case 0:{const f=e.readLen();o[l]=new hr(te(a,c),f),c+=f;break}case 10:{const f=qt(e.restDecoder);o[l]=new fr(te(a,c),f),c+=f;break}default:{const f=(u&(mi|Qn))===0,d=new Ze(te(a,c),null,(u&Qn)===Qn?e.readLeftID():null,null,(u&mi)===mi?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&Mo)===Mo?e.readString():null,qp(e,u));o[l]=d,c+=d.length}}}}return n},bT=(e,t,n)=>{const r=[];let i=as(n.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new wp,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const m=h.id.client,p=n.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),n.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(k=>k!==m)}r.length=0};for(;;){if(u.constructor!==fr){const m=Mi(f,u.id.client,()=>on(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(e,t);if(p!==null){r.push(u);const k=n.get(p)||{refs:[],i:0};if(k.refs.length===k.i)l(p,on(t,p)),d();else{u=k.refs[k.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new us;return nh(h,a,new Map),oe(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},kT=(e,t)=>nh(e,t.doc.store,t.beforeState),ET=(e,t,n,r=new qs(e))=>pe(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=yT(r,o),l=bT(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<on(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const m=u.missing.get(d);(m==null||m>h)&&u.missing.set(d,h)}u.update=fc([u.update,l.update])}}else a.pendingStructs=l;const f=hp(r,i,a);if(a.pendingDs){const d=new qs(Gs(a.pendingDs));qt(d.restDecoder);const h=hp(d,i,a);f&&h?a.pendingDs=fc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,mp(i.doc,d)}},n,!1),mp=(e,t,n,r=qs)=>{const i=Gs(t);ET(i,e,n,new r(i))},gp=(e,t,n)=>mp(e,t,n,pp),wT=(e,t,n=new Map)=>{nh(e,t.store,n),Vs(e,dT(t.store))},xT=(e,t=new Uint8Array([0]),n=new us)=>{const r=_p(t);wT(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(UT(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===zo)return LT(i.map((s,o)=>o===0?s:BT(s)));if(n.constructor===us)return fc(i)}return i[0]},vT=(e,t)=>xT(e,t,new zo),TT=e=>{const t=new Map,n=qt(e.restDecoder);for(let r=0;r<n;r++){const i=qt(e.restDecoder),s=qt(e.restDecoder);t.set(i,s)}return t},_p=e=>TT(new dp(Gs(e)));class AT{constructor(){this.l=[]}}const yp=()=>new AT,bp=(e,t)=>e.l.push(t),kp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Ep=(e,t,n)=>Xu(e.l,[t,n]);class Js{constructor(t,n){this.client=t,this.clock=n}}const uc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,te=(e,t)=>new Js(e,t),ST=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Yr()},Zs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!up(t.ds,e.id),rh=(e,t)=>{const n=Mi(e.meta,rh,zs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<on(r,s)&&Bi(e,te(s,i))}),lp(e,t.ds,i=>{}),n.add(t))};class wp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const ih=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},on=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},xp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Yr()}n.push(t)},qr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ui(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ui((n+r)/2)}throw Yr()},sh=(e,t)=>{const n=e.clients.get(t.client);return n[qr(n,t.clock)]},oh=(e,t,n)=>{const r=qr(t,n),i=t[r];return i.id.clock<n&&i instanceof Ze?(t.splice(r+1,0,xc(e,i,n-i.id.clock)),r+1):r},Bi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[oh(e,n,t.clock)]},vp=(e,t,n)=>{const r=t.clients.get(n.client),i=qr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==hr&&r.splice(i+1,0,xc(e,s,n.clock-s.id.clock+1)),s},RT=(e,t,n)=>{const r=e.clients.get(t.id.client);r[qr(r,t.id.clock)]=n},Tp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=oh(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&oh(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class OT{constructor(t,n,r){this.doc=t,this.deleteSet=new jo,this.beforeState=ih(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ap=(e,t)=>t.deleteSet.clients.size===0&&!Zx(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(th(t.deleteSet),kT(e,t),Vs(e,t.deleteSet),!0),Sp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Mi(e.changed,t,zs).add(n)},hc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},NT=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=qr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Ze&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},IT=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=M0(i.length-1,1+qr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+hc(i,c)}})},Rp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{th(s),n.afterState=ih(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),Ep(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Xu(a,[]),n._needFormattingCleanup&&JT(n)}finally{r.gc&&NT(s,i,r.gcFilter),IT(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),m=cs(qr(h,d),1);for(let p=h.length-1;p>=m;)p-=1+hc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),m=qr(h,d);m+1<h.length&&hc(h,m+1)>1||m>0&&hc(h,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(aT(Ju,rp,"[yjs] ",ip,sp,"Changed the client-id because another client seems to be using it."),r.clientID=fp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new zo;Ap(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new us;Ap(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Rp(e,t+1)}}},pe=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new OT(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Rp(i,0)}}return o};function*CT(e){const t=qt(e.restDecoder);for(let n=0;n<t;n++){const r=qt(e.restDecoder),i=e.readClient();let s=qt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=qt(e.restDecoder);yield new fr(te(i,s),c),s+=c}else if(ec&a){const c=(a&(mi|Qn))===0,l=new Ze(te(i,s),null,(a&Qn)===Qn?e.readLeftID():null,null,(a&mi)===mi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&Mo)===Mo?e.readString():null,qp(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new hr(te(i,s),c),s+=c}}}}class ah{constructor(t,n){this.gen=CT(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===fr);return this.curr}}class ch{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const LT=e=>fc(e,pp,zo),MT=(e,t)=>{if(e.constructor===hr){const{client:n,clock:r}=e.id;return new hr(te(n,r+t),e.length-t)}else if(e.constructor===fr){const{client:n,clock:r}=e.id;return new fr(te(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Ze(te(r,i+t),null,te(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},fc=(e,t=qs,n=us)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Gs(u)));let i=r.map(u=>new ah(u,!0)),s=null;const o=new n,a=new ch(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const m=d.curr.id.clock-h.curr.id.clock;return m===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===fr?1:-1:m}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===fr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new fr(te(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===fr?s.struct.length-=m:d=MT(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==fr;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),lh(a);const c=r.map(u=>eh(u)),l=hT(c);return Vs(o,l),o.toUint8Array()},UT=(e,t,n=qs,r=us)=>{const i=_p(t),s=new r,o=new ch(s),a=new n(Gs(e)),c=new ah(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===fr){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,cs(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}lh(o);const l=eh(a);return Vs(s,l),s.toUint8Array()},Op=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Kr(e.encoder.restEncoder)}),e.encoder.restEncoder=nc(),e.written=0)},Pi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Op(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),oe(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},lh=e=>{Op(e);const t=e.encoder.restEncoder;oe(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];oe(t,r.written),rc(t,r.restEncoder)}},FT=(e,t,n,r)=>{const i=new n(Gs(e)),s=new ah(i,!1),o=new r,a=new ch(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,t(l),0);lh(a);const c=eh(i);return Vs(o,c),o.toUint8Array()},BT=e=>FT(e,Hv,qs,zo),Np="You must not compute changes after the event-handler fired.";class dc{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=PT(this.currentTarget,this.target))}deletes(t){return up(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(Np);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Uu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Uu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Uu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(Np);const n=this.target,r=zs(),i=zs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const PT=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},kn=()=>{cT("Invalid access: Add Yjs type to a document before reading data.")},Ip=80;let uh=0;class $T{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=uh++}}const DT=e=>{e.timestamp=uh++},Cp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=uh++},jT=(e,t,n)=>{if(e.length>=Ip){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Cp(r,t,n),r}else{const r=new $T(t,n);return e.push(r),r}},pc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>tc(t-s.index)<tc(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,DT(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&tc(n.index-i)<r.parent.length/Ip?(Cp(n,r,i),n):jT(e._searchMarker,r,i)},Wo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=cs(t,i.index+n))}},mc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Mi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Ep(r._eH,n,t)};class mn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=yp(),this._dEH=yp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Hr()}clone(){throw Hr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){bp(this._eH,t)}observeDeep(t){bp(this._dEH,t)}unobserve(t){kp(this._eH,t)}unobserveDeep(t){kp(this._dEH,t)}toJSON(){}}const Lp=(e,t,n)=>{e.doc??kn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Mp=e=>{e.doc??kn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Go=(e,t)=>{let n=0,r=e._start;for(e.doc??kn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Up=(e,t)=>{const n=[];return Go(e,(r,i)=>{n.push(t(r,i,e))}),n},zT=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Fp=(e,t)=>{e.doc??kn();const n=pc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},gc=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ze(te(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ds(l)),i.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Ze(te(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ko(new Uint8Array(f))),i.integrate(e,0);break;case Xs:i=new Ze(te(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Yo(f)),i.integrate(e,0);break;default:if(f instanceof mn)i=new Ze(te(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new bi(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Bp=()=>Fi("Length exceeded!"),Pp=(e,t,n,r)=>{if(n>t._length)throw Bp();if(n===0)return t._searchMarker&&Wo(t._searchMarker,n,r.length),gc(e,t,null,r);const i=n,s=pc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Bi(e,te(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Wo(t._searchMarker,i,r.length),gc(e,t,o,r)},WT=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return gc(e,t,i,n)},$p=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=pc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Bi(e,te(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Bi(e,te(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Bp();t._searchMarker&&Wo(t._searchMarker,i,-s+r)},_c=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},hh=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ds([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ds([r]);break;case Uint8Array:a=new Ko(r);break;case Xs:a=new Yo(r);break;default:if(r instanceof mn)a=new bi(r);else throw new Error("Unexpected content type")}new Ze(te(o,on(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},fh=(e,t)=>{e.doc??kn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Dp=e=>{const t={};return e.doc??kn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},jp=(e,t)=>{e.doc??kn();const n=e._map.get(t);return n!==void 0&&!n.deleted},GT=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Zs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},yc=e=>(e.doc??kn(),lT(e._map.entries(),t=>!t[1].deleted));class KT extends dc{}class Qs extends mn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Qs;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Qs}clone(){const t=new Qs;return t.insert(0,this.toArray().map(n=>n instanceof mn?n.clone():n)),t}get length(){return this.doc??kn(),this._length}_callObserver(t,n){super._callObserver(t,n),mc(this,t,new KT(this,t))}insert(t,n){this.doc!==null?pe(this.doc,r=>{Pp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?pe(this.doc,n=>{WT(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{$p(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Fp(this,t)}toArray(){return Mp(this)}slice(t=0,n=this.length){return Lp(this,t,n)}toJSON(){return this.map(t=>t instanceof mn?t.toJSON():t)}map(t){return Up(this,t)}forEach(t){Go(this,t)}[Symbol.iterator](){return zT(this)}_write(t){t.writeTypeRef(gA)}}const HT=e=>new Qs;class YT extends dc{constructor(t,n,r){super(t,n),this.keysChanged=r}}class to extends mn{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new to}clone(){const t=new to;return this.forEach((n,r)=>{t.set(r,n instanceof mn?n.clone():n)}),t}_callObserver(t,n){mc(this,t,new YT(this,t,n))}toJSON(){this.doc??kn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof mn?i.toJSON():i}}),t}get size(){return[...yc(this)].length}keys(){return Zu(yc(this),t=>t[0])}values(){return Zu(yc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Zu(yc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??kn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?pe(this.doc,n=>{_c(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?pe(this.doc,r=>{hh(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return fh(this,t)}has(t){return jp(this,t)}clear(){this.doc!==null?pe(this.doc,t=>{this.forEach(function(n,r,i){_c(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(_A)}}const VT=e=>new to,$i=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Gv(e,t);class dh{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Yr(),this.right.content.constructor){case Je:this.right.deleted||eo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const zp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Je:t.right.deleted||eo(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Bi(e,te(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},bc=(e,t,n,r)=>{const i=new Map,s=r?pc(t,n):null;if(s){const o=new dh(s.p.left,s.p,s.index,i);return zp(e,o,n-s.index)}else{const o=new dh(null,t._start,0,i);return zp(e,o,n)}},Wp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Je&&$i(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ze(te(s,on(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new Je(a,o));u.integrate(e,0),n.right=u,n.forward()})},eo=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Gp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Je&&$i(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Kp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!$i(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Ze(te(s,on(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new Je(a,c)),n.right.integrate(e,0),n.forward()}}return o},ph=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;Gp(n,i);const a=Kp(e,t,n,i),c=r.constructor===String?new Jr(r):r instanceof mn?new bi(r):new fs(r);let{left:l,right:u,index:f}=n;t._searchMarker&&Wo(t._searchMarker,n.index,c.getLength()),u=new Ze(te(o,on(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=f,n.forward(),Wp(e,t,n,a)},Hp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Gp(n,i);const a=Kp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Je));){if(!n.right.deleted)switch(n.right.content.constructor){case Je:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if($i(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Bi(e,te(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ze(te(o,on(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Jr(c)),n.right.integrate(e,0),n.forward()}Wp(e,t,n,a)},Yp=(e,t,n,r,i)=>{let s=t;const o=Sr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case Je:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&eo(i,l);break}}}t=t.right}return a},XT=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Je){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},qT=e=>{let t=0;return pe(e.doc,n=>{let r=e._start,i=e._start,s=Sr();const o=Mu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:eo(o,i.content);break;default:t+=Yp(n,r,i,s,o),s=Mu(o),r=i;break}i=i.right}}),t},JT=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Tp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==hr&&t.add(o.parent)})}pe(n,r=>{lp(e,e.deleteSet,i=>{if(i instanceof hr||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Je?t.add(s):XT(r,i)});for(const i of t)qT(i)})},Vp=(e,t,n)=>{const r=n,i=Mu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case bi:case fs:case Jr:n<t.right.length&&Bi(e,te(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Yp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Wo(o._searchMarker,t.index,-r+n),t};class ZT extends dc{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];pe(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},jv(c)||(h.attributes=Pv({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case bi:case fs:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Jr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;$i(p,m)?m!==null&&o.delete(r):(a==="retain"&&d(),$i(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;$i(p,m)||(a==="retain"&&d(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&($i(p,m)?p!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&d(),eo(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class yi extends mn{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??kn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new yi}clone(){const t=new yi;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new ZT(this,t,n);mc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??kn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Jr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?pe(this.doc,r=>{const i=new dh(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ph(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Hp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Vp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??kn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((m,p)=>{d=!0,f[p]=m});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Zs(c,t)||n!==void 0&&Zs(c,n))switch(c.content.constructor){case Jr:{const f=s.get("ychange");t!==void 0&&!Zs(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Zs(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case bi:case fs:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,m)=>{d[m]=h})}i.push(f);break}case Je:Zs(c,t)&&(l(),eo(s,c.content));break}c=c.right}l()};return t||n?pe(o,f=>{t&&rh(f,t),n&&rh(f,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?pe(i,s=>{const o=bc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),ph(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?pe(i,s=>{const o=bc(s,this,t,!r);ph(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?pe(r,i=>{Vp(i,bc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?pe(i,s=>{const o=bc(s,this,t,!1);o.right!==null&&Hp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{_c(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{hh(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return fh(this,t)}getAttributes(){return Dp(this)}_write(t){t.writeTypeRef(yA)}}const QT=e=>new yi;class mh{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??kn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===no||n.constructor===hs)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class hs extends mn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new hs}clone(){const t=new hs;return t.insert(0,this.toArray().map(n=>n instanceof mn?n.clone():n)),t}get length(){return this.doc??kn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new mh(this,t)}querySelector(t){t=t.toUpperCase();const r=new mh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),as(new mh(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){mc(this,t,new nA(this,n,t))}toString(){return Up(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Go(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?pe(this.doc,r=>{Pp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)pe(this.doc,r=>{const i=t&&t instanceof mn?t._item:t;gc(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Fi("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{$p(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Mp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Fp(this,t)}slice(t=0,n=this.length){return Lp(this,t,n)}forEach(t){Go(this,t)}_write(t){t.writeTypeRef(kA)}}const tA=e=>new hs;class no extends hs{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new no(this.nodeName)}clone(){const t=new no(this.nodeName),n=this.getAttributes();return Dv(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof mn?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{_c(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{hh(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return fh(this,t)}hasAttribute(t){return jp(this,t)}getAttributes(t){return t?GT(this,t):Dp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Go(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(bA),t.writeKey(this.nodeName)}}const eA=e=>new no(e.readKey());class nA extends dc{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class kc extends to{constructor(t){super(),this.hookName=t}_copy(){return new kc(this.hookName)}clone(){const t=new kc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(EA),t.writeKey(this.hookName)}}const rA=e=>new kc(e.readKey());class Ec extends yi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Ec}clone(){const t=new Ec;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(wA)}}const iA=e=>new Ec;class gh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Hr()}mergeWith(t){return!1}write(t,n,r){throw Hr()}integrate(t,n){throw Hr()}}const sA=0;class hr extends gh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),xp(t.doc.store,this)}write(t,n){t.writeInfo(sA),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ko{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ko(this.content)}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const oA=e=>new Ko(e.readBuf());class Ho{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ho(this.len)}splice(t){const n=new Ho(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){lc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const aA=e=>new Ho(e.readLen()),Xp=(e,t)=>new Xs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Yo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Yo(Xp(this.doc.guid,this.opts))}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const cA=e=>new Yo(Xp(e.readString(),e.readAny()));class fs{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new fs(this.embed)}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const lA=e=>new fs(e.readJSON());class Je{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const uA=e=>new Je(e.readKey(),e.readJSON());class wc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new wc(this.arr)}splice(t){const n=new wc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const hA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new wc(n)},fA=cc("node_env")==="development";class ds{constructor(t){this.arr=t,fA&&tp(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ds(this.arr)}splice(t){const n=new ds(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const dA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ds(n)};class Jr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Jr(this.str)}splice(t){const n=new Jr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const pA=e=>new Jr(e.readString()),mA=[HT,VT,QT,eA,tA,rA,iA],gA=0,_A=1,yA=2,bA=3,kA=4,EA=5,wA=6;class bi{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new bi(this.type._copy())}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const xA=e=>new bi(mA[e.readTypeRef()](e)),xc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Ze(te(r,i+n),t,te(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=te(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Ze extends gh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?B0:0}set marker(t){(this.info&Bu)>0!==t&&(this.info^=Bu)}get marker(){return(this.info&Bu)>0}get keep(){return(this.info&F0)>0}set keep(t){this.keep!==t&&(this.info^=F0)}get countable(){return(this.info&B0)>0}get deleted(){return(this.info&Fu)>0}set deleted(t){this.deleted!==t&&(this.info^=Fu)}markDeleted(){this.info|=Fu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=on(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=on(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Js&&this.id.client!==this.parent.client&&this.parent.clock>=on(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=vp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Bi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===hr||this.right&&this.right.constructor===hr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Js){const r=sh(n,this.parent);r.constructor===hr?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=vp(t,t.doc.store,te(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),uc(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(uc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(sh(t.doc.store,i.origin)))s.has(sh(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),xp(t.doc.store,this),this.content.integrate(t,this),Sp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new hr(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:te(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&uc(t.origin,this.lastId)&&this.right===t&&uc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),lc(t.deleteSet,this.id.client,this.id.clock,this.length),Sp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Yr();this.content.gc(t),n?RT(t,this,new hr(this.id,this.length)):this.content=new Ho(this.length)}write(t,n){const r=n>0?te(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&ec|(r===null?0:Qn)|(i===null?0:mi)|(s===null?0:Mo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=ST(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Js?(t.writeParentInfo(!1),t.writeLeftID(a)):Yr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const qp=(e,t)=>vA[t&ec](e),vA=[()=>{Yr()},aA,hA,oA,pA,lA,uA,xA,dA,cA,()=>{Yr()}],TA=10;class fr extends gh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Yr()}write(t,n){t.writeInfo(TA),oe(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Jp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof js<"u"?js:{},Zp="__ $YJS$ __";Jp[Zp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Jp[Zp]=!0;let Qp=!1;const nr=new Xs;function tm(e,t,n){const r=nr.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function AA(e,t){tm(e,0,t)}function _h(e,t){const n=new yi(t);tm(e,1,n)}function SA(e,t){nr.getMap().set(e,t)}function RA(e,t){const n=nr.getMap(),r=new yi(t);n.set(e,r)}function em(e,t){const n=nr.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function OA(e,t){return em(e,n=>{wt(n)&&t(n)})}function nm(e,t){return em(e,n=>{n instanceof yi&&t(n.toJSON())})}const ps=Bs("modem",["second"],e=>{if(ps.session(e))switch(e.target){case"second":!Qp&&e.data%2===0&&ps.emit(e.player,"modem:join");break;case"join":e.sender!==ps.id()&&ps.reply(e,"joinack",N0(vT(nr)));break;case"joinack":e.sender!==ps.id()&&(Qp=!0,gp(nr,Za(e.data),nr));break;case"sync":{e.sender!==ps.id()&&y(e.data)&&gp(nr,Za(e.data),nr);break}}});function rm(e,t){t!==nr&&ps.emit("","modem:sync",N0(e))}nr.on("update",rm),nr.on("destroy",()=>{nr.off("update",rm)});function im(e,t){return e%t}function sm(e,t){return Math.floor(e/t)}function NA(e,t){return{x:im(e,t),y:sm(e,t)}}function dr(e,t){return e.x+e.y*t}function ro(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function yh(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function om(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function am(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const cm="176",IA="",Rr="srgb",lm="srgb-linear",um="linear",bh="srgb";function Or(e,t,n){return Math.max(t,Math.min(n,e))}function CA(e,t){return(e%t+t)%t}function kh(e,t,n){return(1-n)*e+n*t}class Vo{constructor(t=0,n=0){Vo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Or(this.x,t.x,n.x),this.y=Or(this.y,t.y,n.y),this}clampScalar(t,n){return this.x=Or(this.x,t,n),this.y=Or(this.y,t,n),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Or(r,t,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Or(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xo{constructor(t,n,r,i,s,o,a,c,l){Xo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],m=r[8],p=i[0],k=i[3],b=i[6],v=i[1],T=i[4],A=i[7],L=i[2],S=i[5],I=i[8];return s[0]=o*p+a*v+c*L,s[3]=o*k+a*T+c*S,s[6]=o*b+a*A+c*I,s[1]=l*p+u*v+f*L,s[4]=l*k+u*T+f*S,s[7]=l*b+u*A+f*I,s[2]=d*p+h*v+m*L,s[5]=d*k+h*T+m*S,s[8]=d*b+h*A+m*I,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,m=n*f+r*d+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=f*p,t[1]=(i*l-u*r)*p,t[2]=(a*r-i*o)*p,t[3]=d*p,t[4]=(u*n-i*c)*p,t[5]=(i*s-a*n)*p,t[6]=h*p,t[7]=(r*c-l*n)*p,t[8]=(o*n-r*s)*p,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(Eh.makeScale(t,n)),this}rotate(t){return this.premultiply(Eh.makeRotation(-t)),this}translate(t,n){return this.premultiply(Eh.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Eh=new Xo,hm=new Xo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),fm=new Xo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function LA(){const e={enabled:!0,workingColorSpace:lm,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===bh&&(i.r=io(i.r),i.g=io(i.g),i.b=io(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===bh&&(i.r=so(i.r),i.g=so(i.g),i.b=so(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===IA?um:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[lm]:{primaries:t,whitePoint:r,transfer:um,toXYZ:hm,fromXYZ:fm,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Rr},outputColorSpaceConfig:{drawingBufferColorSpace:Rr}},[Rr]:{primaries:t,whitePoint:r,transfer:bh,toXYZ:hm,fromXYZ:fm,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Rr}}}),e}const Nr=LA();function io(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function so(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const dm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Di={h:0,s:0,l:0},vc={h:0,s:0,l:0};function wh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class xh{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=Rr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Nr.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Nr.workingColorSpace){return this.r=t,this.g=n,this.b=r,Nr.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Nr.workingColorSpace){if(t=CA(t,1),n=Or(n,0,1),r=Or(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=wh(o,s,t+1/3),this.g=wh(o,s,t),this.b=wh(o,s,t-1/3)}return Nr.toWorkingColorSpace(this,i),this}setStyle(t,n=Rr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=Rr){const r=dm[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=io(t.r),this.g=io(t.g),this.b=io(t.b),this}copyLinearToSRGB(t){return this.r=so(t.r),this.g=so(t.g),this.b=so(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Rr){return Nr.fromWorkingColorSpace(En.copy(this),t),Math.round(Or(En.r*255,0,255))*65536+Math.round(Or(En.g*255,0,255))*256+Math.round(Or(En.b*255,0,255))}getHexString(t=Rr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Nr.workingColorSpace){Nr.fromWorkingColorSpace(En.copy(this),n);const r=En.r,i=En.g,s=En.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=Nr.workingColorSpace){return Nr.fromWorkingColorSpace(En.copy(this),n),t.r=En.r,t.g=En.g,t.b=En.b,t}getStyle(t=Rr){Nr.fromWorkingColorSpace(En.copy(this),t);const n=En.r,r=En.g,i=En.b;return t!==Rr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Di),this.setHSL(Di.h+t,Di.s+n,Di.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Di),t.getHSL(vc);const r=kh(Di.h,vc.h,n),i=kh(Di.s,vc.s,n),s=kh(Di.l,vc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const En=new xh;xh.NAMES=dm,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:cm}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=cm),new Vo,new Vo;function gn(e,t,n){return Math.max(t,Math.min(n,e))}function pm(e){return e/180*Math.PI}function mm(e){return e*180/Math.PI}const MA=Gd("089fad0j9awfem09wavefc09uwaef");function UA(){return MA()}function FA(e){return Gd(e)()}function pr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(UA()*i)}function gm(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(FA(e)*s)}function _m(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function BA(e){return e[pr(0,e.length-1)]}function PA(e,t){return t[gm(e,0,t.length-1)]}function Sn(...e){return BA(e.flat())}function $A(e,...t){return PA(e,t.flat())}function DA(e){return[...new Set(e)].filter(y)}function ms(e){return y(e)&&y(e.x)&&y(e.y)}function ze(e,t){switch(t){case pt.NORTH:--e.y;break;case pt.SOUTH:++e.y;break;case pt.WEST:--e.x;break;case pt.EAST:++e.x;break}return e}function jA(e,t){return e<0?pt.WEST:e>0?pt.EAST:t<0?pt.NORTH:t>0?pt.SOUTH:pt.IDLE}function Ir(e,t){return jA(t.x-e.x,t.y-e.y)}const vh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function rr(e){return ue(e)&&ym(e[0])}function ym(e){return y(pt[e])&&gt(e)}function zA(e){const t=pt[e];return y(t)?t:pt.IDLE}function Th(e){if(gt(e))return vh[Ct(e)]}function WA(e){if(rr(e))return e;if(ym(e))return[e];const t=Th(e);if(y(t))return[t]}function bm(e){const t=E.words[e],n=WA(t);return rr(n)?[n,e+1]:[void 0,e]}function km(e){var i,s;const t=[];let[n,r]=bm(e);for(;rr(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=st(E.words,r,[H.NUMBER,H.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=st(E.words,r,[H.KIND]);console.info("kind",c),r=l;break}case"TO":{const[c,l,u]=st(E.words,r,[H.DIR,H.DIR]),f=((i=E.element)==null?void 0:i.x)??0,d=((s=E.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,t.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,r]}const[o,a]=bm(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function GA(e){return y(e)&&e<Mt.ONBLACK?e:void 0}function Ah(e){return y(e)&&e>Mt.WHITE&&e<Mt.ONCLEAR?e-Mt.ONBLACK:void 0}const qo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function wn(e){return ue(e)&&wm(e[0])}function Em(e){return wn(e)&&e[0].startsWith("ON")}function wm(e){return y(Mt[e])&&gt(e)}function Jo(e){if(gt(e))return qo[Ct(e)]}function Sh(e,t){return[y(e)?`${Mt[e]}`:void 0,y(t)?`ON${Mt[t]}`:void 0].filter(y)}function Tc(e){return e.map(t=>Mt[t]).find(t=>y(t)&&t<Mt.ONBLACK)}function Ac(e){return e.map(t=>Mt[t]).find(t=>y(t)&&t>=Mt.ONBLACK)}function KA(e){if(wn(e))return e;if(wm(e))return[e];const t=Jo(e);if(y(t))return[t]}function xm(e){const t=E.words[e],n=KA(t);return wn(n)?[n,e+1]:[void 0,e]}function Sc(e){const t=[];let n=e;const[r,i]=xm(e);if(wn(r)&&(t.push(...r),n=i),wn(t)&&!Em(t)){const[s,o]=xm(i);Em(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function vm(e){const t={};for(let n=0;n<e.length;++n){const r=e[n],i=Mt[r];y(i)&&(i<Mt.ONBLACK?t.color=i:t.bg=Ah(i))}return t}var Tm={exports:{}},Rh={exports:{}},Am;function HA(){return Am||(Am=1,function(e,t){(function(n,r){e.exports=r()})(Fn,function(){function n(p){return!isNaN(parseFloat(p))&&isFinite(p)}function r(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(p){if(p)for(var k=0;k<u.length;k++)p[u[k]]!==void 0&&this["set"+r(u[k])](p[u[k]])}f.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof f)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new f(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",k=this.getLineNumber()||"",b=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+k+":"+b+")":"[eval]:"+k+":"+b:v?v+" ("+p+":"+k+":"+b+")":p+":"+k+":"+b}},f.fromString=function(k){var b=k.indexOf("("),v=k.lastIndexOf(")"),T=k.substring(0,b),A=k.substring(b+1,v).split(","),L=k.substring(v+1);if(L.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(L,""),I=S[1],$=S[2],N=S[3];return new f({functionName:T,args:A||void 0,fileName:I,lineNumber:$||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(p){return function(k){this[p]=!!k}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(p){return function(k){if(!n(k))throw new TypeError(p+" must be a Number");this[p]=Number(k)}}(o[h]);for(var m=0;m<a.length;m++)f.prototype["get"+r(a[m])]=i(a[m]),f.prototype["set"+r(a[m])]=function(p){return function(k){this[p]=String(k)}}(a[m]);return f})}(Rh)),Rh.exports}(function(e,t){(function(n,r){e.exports=r(HA())})(Fn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),m=d&&f||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var k=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new r({functionName:m,args:k,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Tm);var YA=Tm.exports,VA=Us(YA);const St=60,Xt=25,Oh=St*Xt;var bt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(bt||{});const Nh=14,Rc=3,ji=8,zi=14,Oc=16,XA=16,qA=16;var Nc=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(Nc||{});function Zo(e,t){return new Array(e).fill(t)}function JA(e,t,n,r,i,s=0){const o=r*i;return{id:`tiles:${e}:${t}`,type:1,tag:n,width:r,height:i,char:Zo(o,0),color:Zo(o,0),bg:Zo(o,s),wall:Zo(o,0)}}function ZA(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Mt.ONCLEAR}}function QA(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function tS(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:Zo(s,i)}}function eS(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function nS(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Sm(e,t){return`${e}:${t}`}const rS=1,iS=16,sS=256;var Rn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Rn||{});const Zr=!!JSON.parse("false"),oS=!!JSON.parse("false");JSON.parse("false");const Rm=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ki={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return ji*ki.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return zi*ki.DRAW_CHAR_SCALE}},nt=Bs("SOFTWARE");function Ei(e){const t={},n={tick(){},everytick(){},listcommands(){return Zn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Te(e){return`${e??""}`}function Qo(e,t){const n=parseFloat(Te(e));return isNaN(n)?t:n}function Om(e,t,n){var i;const[r]=st(t,0,[H.MAYBE_NAME]);fx(nt,e,((i=E.board)==null?void 0:i.id)??"",r??"",n)}function Dn(e,t,n,r){const[i,s]=st(r,0,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);s0(nt,e,t,n,i,s)}const aS=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Nm(e,t,n){const[r,i]=st(n,0,[H.NUMBER_OR_STRING]);if(wt(r))ku(nt,e,t,"volume",r);else if(aS.includes(Ct(r))){const[s,o]=st(n,i,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);s0(nt,e,t,r,s,o)}else{const[s]=st(n,i,[H.MAYBE_NUMBER_OR_STRING]);if(wt(s)){const o=n.length-i,a=new Array(o).fill(H.NUMBER),c=st(n,i,a).slice(0,o),l=c.length===1?c[0]:c;ku(nt,e,t,r,l)}else{const[o]=st(n,i,[H.MAYBE_NUMBER_OR_STRING]);ku(nt,e,t,r,o)}}}let Im="en-US-GuyNeural";const Ih=Ei().command("talk",(e,t)=>{const[n]=st(t,0,[H.ANY]);switch(Ct(n)){default:Yw(nt,E.elementfocus);break;case"stop":Vw(nt,E.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=st(t,0,[H.ANY]);switch(Ct(n)){default:Xw(nt,E.elementfocus);break;case"stop":qw(nt,E.elementfocus);break}return 0}).command("tts",(e,t)=>{const n=t.map(Te).join("");return hx(nt,E.elementfocus,Im,n),0}).command("ttsvoice",(e,t)=>(Im=t.map(Te).join(""),0)).command("bpm",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return px(nt,E.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return mx(nt,E.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return gx(nt,E.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return _x(nt,E.elementfocus,n),0}).command("play",(e,t)=>(Om(E.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(Om(E.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)Nm(E.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Dn(E.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Dn(E.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Dn(E.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Dn(E.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Dn(E.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Dn(E.elementfocus,n,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let n=0;n<3;++n)Dn(E.elementfocus,n,"autowah",t);return 0});for(let e=0;e<8;++e)Ih.command(`synth${e+1}`,(t,n)=>(Nm(E.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Ih.command(`echo${t}`,(n,r)=>(Dn(E.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Dn(E.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Dn(E.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Dn(E.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Dn(E.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Dn(E.elementfocus,e,"vibrato",r),0)).command(`autowah${t}`,(n,r)=>(Dn(E.elementfocus,e,"autowah",r),0))}var Ch;try{Ch=new TextDecoder}catch{}var kt,mr,K=0,me={},ee,Wi,gr=0,Qr=0,an,wi,jn=[],Zt,Cm={useRecords:!1,mapsAsObjects:!0};class Lm{}const Mm=new Lm;Mm.name="MessagePack 0xC1";var Gi=!1,Um=2,Fm;try{new Function("")}catch{Um=1/0}class ta{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(kt)return Xm(()=>(Bh(),this?this.unpack(t,n):ta.prototype.unpack.call(Cm,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof pn<"u"?pn.from(t):new Uint8Array(t)),typeof n=="object"?(mr=n.end||t.length,K=n.start||0):(K=0,mr=n>-1?n:t.length),Qr=0,Wi=null,an=null,kt=t;try{Zt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw kt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof ta){if(me=this,this.structures)return ee=this.structures,Ic(n);(!ee||ee.length>0)&&(ee=[])}else me=Cm,(!ee||ee.length>0)&&(ee=[]);return Ic(n)}unpackMultiple(t,n){let r,i=0;try{Gi=!0;let s=t.length,o=this?this.unpack(t,s):Cc.unpack(t,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Ic(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Ic());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Gi=!1,Bh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Ic(e){try{if(!me.trusted&&!Gi){let n=ee.sharedLength||0;n<ee.length&&(ee.length=n)}let t;if(me.randomAccessStructure&&kt[K]<64&&kt[K]>=32&&Fm?(t=Fm(kt,K,mr,me),kt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),K=mr):t=We(),an&&(K=an.postBundlePosition,an=null),Gi&&(ee.restoreStructures=null),K==mr)ee&&ee.restoreStructures&&Bm(),ee=null,kt=null,wi&&(wi=null);else{if(K>mr)throw new Error("Unexpected end of MessagePack data");if(!Gi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw ee&&ee.restoreStructures&&Bm(),Bh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||K>mr)&&(t.incomplete=!0),t}}function Bm(){for(let e in ee.restoreStructures)ee[e]=ee.restoreStructures[e];ee.restoreStructures=null}function We(){let e=kt[K++];if(e<160)if(e<128){if(e<64)return e;{let t=ee[e&63]||me.getStructures&&$m()[e&63];return t?(t.read||(t.read=Lh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Km();r==="__proto__"&&(r="__proto_"),t[r]=We()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(We(),We());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=We();return me.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Qr>=K)return Wi.slice(K-gr,(K+=t)-gr);if(Qr==0&&mr<140){let n=t<16?Uh(t):zm(t);if(n!=null)return n}return Mh(t)}else{let t;switch(e){case 192:return null;case 193:return an?(t=We(),t>0?an[1].slice(an.position1,an.position1+=t):an[0].slice(an.position0,an.position0-=t)):Mm;case 194:return!1;case 195:return!0;case 196:if(t=kt[K++],t===void 0)throw new Error("Unexpected end of buffer");return Fh(t);case 197:return t=Zt.getUint16(K),K+=2,Fh(t);case 198:return t=Zt.getUint32(K),K+=4,Fh(t);case 199:return gs(kt[K++]);case 200:return t=Zt.getUint16(K),K+=2,gs(t);case 201:return t=Zt.getUint32(K),K+=4,gs(t);case 202:if(t=Zt.getFloat32(K),me.useFloat32>2){let n=Ph[(kt[K]&127)<<1|kt[K+1]>>7];return K+=4,(n*t+(t>0?.5:-.5)>>0)/n}return K+=4,t;case 203:return t=Zt.getFloat64(K),K+=8,t;case 204:return kt[K++];case 205:return t=Zt.getUint16(K),K+=2,t;case 206:return t=Zt.getUint32(K),K+=4,t;case 207:return me.int64AsType==="number"?(t=Zt.getUint32(K)*4294967296,t+=Zt.getUint32(K+4)):me.int64AsType==="string"?t=Zt.getBigUint64(K).toString():me.int64AsType==="auto"?(t=Zt.getBigUint64(K),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Zt.getBigUint64(K),K+=8,t;case 208:return Zt.getInt8(K++);case 209:return t=Zt.getInt16(K),K+=2,t;case 210:return t=Zt.getInt32(K),K+=4,t;case 211:return me.int64AsType==="number"?(t=Zt.getInt32(K)*4294967296,t+=Zt.getUint32(K+4)):me.int64AsType==="string"?t=Zt.getBigInt64(K).toString():me.int64AsType==="auto"?(t=Zt.getBigInt64(K),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Zt.getBigInt64(K),K+=8,t;case 212:if(t=kt[K++],t==114)return Ym(kt[K++]&63);{let n=jn[t];if(n)return n.read?(K++,n.read(We())):n.noBuffer?(K++,n()):n(kt.subarray(K,++K));throw new Error("Unknown extension "+t)}case 213:return t=kt[K],t==114?(K++,Ym(kt[K++]&63,kt[K++])):gs(2);case 214:return gs(4);case 215:return gs(8);case 216:return gs(16);case 217:return t=kt[K++],Qr>=K?Wi.slice(K-gr,(K+=t)-gr):lS(t);case 218:return t=Zt.getUint16(K),K+=2,Qr>=K?Wi.slice(K-gr,(K+=t)-gr):uS(t);case 219:return t=Zt.getUint32(K),K+=4,Qr>=K?Wi.slice(K-gr,(K+=t)-gr):hS(t);case 220:return t=Zt.getUint16(K),K+=2,Dm(t);case 221:return t=Zt.getUint32(K),K+=4,Dm(t);case 222:return t=Zt.getUint16(K),K+=2,jm(t);case 223:return t=Zt.getUint32(K),K+=4,jm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const cS=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Lh(e,t){function n(){if(n.count++>Um){let i=e.read=new Function("r","return function(){return "+(me.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":cS.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(We);return e.highByte===0&&(e.read=Pm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=We()}return me.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Pm(t,n):n}const Pm=(e,t)=>function(){let n=kt[K++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=ee[r]||$m()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Lh(i,e)),i.read()};function $m(){let e=Xm(()=>(kt=null,me.getStructures()));return ee=me._mergeStructures(e,ee)}var Mh=ea,lS=ea,uS=ea,hS=ea;function ea(e){let t;if(e<16&&(t=Uh(e)))return t;if(e>64&&Ch)return Ch.decode(kt.subarray(K,K+=e));const n=K+e,r=[];for(t="";K<n;){const i=kt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=kt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=kt[K++]&63,o=kt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=kt[K++]&63,o=kt[K++]&63,a=kt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=cn.apply(String,r),r.length=0)}return r.length>0&&(t+=cn.apply(String,r)),t}function Dm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=We();return me.freezeData?Object.freeze(t):t}function jm(e){if(me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Km();r==="__proto__"&&(r="__proto_"),t[r]=We()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(We(),We());return t}}var cn=String.fromCharCode;function zm(e){let t=K,n=new Array(e);for(let r=0;r<e;r++){const i=kt[K++];if((i&128)>0){K=t;return}n[r]=i}return cn.apply(String,n)}function Uh(e){if(e<4)if(e<2){if(e===0)return"";{let t=kt[K++];if((t&128)>1){K-=1;return}return cn(t)}}else{let t=kt[K++],n=kt[K++];if((t&128)>0||(n&128)>0){K-=2;return}if(e<3)return cn(t,n);let r=kt[K++];if((r&128)>0){K-=3;return}return cn(t,n,r)}else{let t=kt[K++],n=kt[K++],r=kt[K++],i=kt[K++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(e<6){if(e===4)return cn(t,n,r,i);{let s=kt[K++];if((s&128)>0){K-=5;return}return cn(t,n,r,i,s)}}else if(e<8){let s=kt[K++],o=kt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(e<7)return cn(t,n,r,i,s,o);let a=kt[K++];if((a&128)>0){K-=7;return}return cn(t,n,r,i,s,o,a)}else{let s=kt[K++],o=kt[K++],a=kt[K++],c=kt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(e<10){if(e===8)return cn(t,n,r,i,s,o,a,c);{let l=kt[K++];if((l&128)>0){K-=9;return}return cn(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=kt[K++],u=kt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(e<11)return cn(t,n,r,i,s,o,a,c,l,u);let f=kt[K++];if((f&128)>0){K-=11;return}return cn(t,n,r,i,s,o,a,c,l,u,f)}else{let l=kt[K++],u=kt[K++],f=kt[K++],d=kt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(e<14){if(e===12)return cn(t,n,r,i,s,o,a,c,l,u,f,d);{let h=kt[K++];if((h&128)>0){K-=13;return}return cn(t,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=kt[K++],m=kt[K++];if((h&128)>0||(m&128)>0){K-=14;return}if(e<15)return cn(t,n,r,i,s,o,a,c,l,u,f,d,h,m);let p=kt[K++];if((p&128)>0){K-=15;return}return cn(t,n,r,i,s,o,a,c,l,u,f,d,h,m,p)}}}}}function Wm(){let e=kt[K++],t;if(e<192)t=e-160;else switch(e){case 217:t=kt[K++];break;case 218:t=Zt.getUint16(K),K+=2;break;case 219:t=Zt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return ea(t)}function Fh(e){return me.copyBuffers?Uint8Array.prototype.slice.call(kt,K,K+=e):kt.subarray(K,K+=e)}function gs(e){let t=kt[K++];if(jn[t]){let n;return jn[t](kt.subarray(K,n=K+=e),r=>{K=r;try{return We()}finally{K=n}})}else throw new Error("Unknown extension type "+t)}var Gm=new Array(4096);function Km(){let e=kt[K++];if(e>=160&&e<192){if(e=e-160,Qr>=K)return Wi.slice(K-gr,(K+=e)-gr);if(!(Qr==0&&mr<180))return Mh(e)}else return K--,Hm(We());let t=(e<<5^(e>1?Zt.getUint16(K):e>0?kt[K]:0))&4095,n=Gm[t],r=K,i=K+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Zt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=kt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],Gm[t]=n,n.bytes=e;r<i;)s=Zt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=kt[r++],n.push(s);let a=e<16?Uh(e):zm(e);return a!=null?n.string=a:n.string=Mh(e)}function Hm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const Ym=(e,t)=>{let n=We().map(Hm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=ee[e];return i&&(i.isShared||Gi)&&((ee.restoreStructures||(ee.restoreStructures=[]))[e]=i),ee[e]=n,n.read=Lh(n,r),n.read()};jn[0]=()=>{},jn[0].noBuffer=!0,jn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let fS={Error,TypeError,ReferenceError};jn[101]=()=>{let e=We();return(fS[e[0]]||Error)(e[1],{cause:e[2]})},jn[105]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Zt.getUint32(K-4);wi||(wi=new Map);let n=kt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};wi.set(t,i);let s=We();return i.used?Object.assign(r,s):(i.target=s,s)},jn[112]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Zt.getUint32(K-4),n=wi.get(t);return n.used=!0,n.target},jn[115]=()=>new Set(We());const Vm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let dS=typeof globalThis=="object"?globalThis:window;jn[116]=e=>{let t=e[0],n=Vm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new dS[n](Uint8Array.prototype.slice.call(e,1).buffer)},jn[120]=()=>{let e=We();return new RegExp(e[0],e[1])};const pS=[];jn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=K;return K+=t-e.length,an=pS,an=[Wm(),Wm()],an.position0=0,an.position1=0,an.postBundlePosition=K,K=n,We()},jn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Xm(e){let t=mr,n=K,r=gr,i=Qr,s=Wi,o=wi,a=an,c=new Uint8Array(kt.slice(0,mr)),l=ee,u=ee.slice(0,ee.length),f=me,d=Gi,h=e();return mr=t,K=n,gr=r,Qr=i,Wi=s,wi=o,an=a,kt=c,Gi=d,ee=l,ee.splice(0,ee.length,...u),me=f,Zt=new DataView(kt.buffer,kt.byteOffset,kt.byteLength),h}function Bh(){kt=null,wi=null,ee=null}const Ph=new Array(147);for(let e=0;e<256;e++)Ph[e]=+("1e"+Math.floor(45.15-e*.30103));var Cc=new ta({useRecords:!1});const mS=Cc.unpack;Cc.unpackMultiple,Cc.unpack;let gS=new Float32Array(1);new Uint8Array(gS.buffer,0,4);let Lc;try{Lc=new TextEncoder}catch{}let $h,qm;const Mc=typeof pn<"u",Uc=Mc?function(e){return pn.allocUnsafeSlow(e)}:Uint8Array,Jm=Mc?pn:Uint8Array,Zm=Mc?4294967296:2144337920;let Z,na,ge,Y=0,On,Le=null,_S;const yS=21760,bS=/[\u0080-\uFFFF]/,oo=Symbol("record-id");class kS extends ta{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Jm.prototype.utf8Write?function(O,w){return Z.utf8Write(O,w,Z.byteLength-w)}:Lc&&Lc.encodeInto?function(O,w){return Lc.encodeInto(O,Z.subarray(w)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,m=u+f+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],k=0,b=0;this.pack=this.encode=function(O,w){if(Z||(Z=new Uc(8192),ge=Z.dataView||(Z.dataView=new DataView(Z.buffer,0,8192)),Y=0),On=Z.length-10,On-Y<2048?(Z=new Uc(Z.length),ge=Z.dataView||(Z.dataView=new DataView(Z.buffer,0,Z.length)),On=Z.length-10,Y=0):Y=Y+7&2147483640,n=Y,w&SS&&(Y+=w&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof O!="string"?(Le=[],Le.size=1/0):Le=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let P=i.sharedLength||0;if(P>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let F=0;F<P;F++){let ot=i[F];if(!ot)continue;let tt,it=i.transitions;for(let W=0,D=ot.length;W<D;W++){let yt=ot[W];tt=it[yt],tt||(tt=it[yt]=Object.create(null)),it=tt}it[oo]=F+64}this.lastNamedStructuresLength=P}c||(i.nextId=P+64)}r&&(r=!1);let C;try{a.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?M(O):A(O);let P=Le;if(Le&&eg(n,A,0),s&&s.idsToInsert){let F=s.idsToInsert.sort((W,D)=>W.offset>D.offset?1:-1),ot=F.length,tt=-1;for(;P&&ot>0;){let W=F[--ot].offset+n;W<P.stringsPosition+n&&tt===-1&&(tt=0),W>P.position+n?tt>=0&&(tt+=6):(tt>=0&&(ge.setUint32(P.position+n,ge.getUint32(P.position+n)+tt),tt=-1),P=P.previous,ot++)}tt>=0&&P&&ge.setUint32(P.position+n,ge.getUint32(P.position+n)+tt),Y+=F.length*6,Y>On&&N(Y),a.offset=Y;let it=wS(Z.subarray(n,Y),F);return s=null,it}return a.offset=Y,w&TS?(Z.start=n,Z.end=Y,Z):Z.subarray(n,Y)}catch(P){throw C=P,P}finally{if(i&&(v(),r&&a.saveStructures)){let P=i.sharedLength||0,F=Z.subarray(n,Y),ot=xS(i,a);if(!C)return a.saveStructures(ot,ot.isCompatible)===!1?a.pack(O,w):(a.lastNamedStructuresLength=P,Z.length>1073741824&&(Z=null),F)}Z.length>1073741824&&(Z=null),w&AS&&(Y=n)}};const v=()=>{b<10&&b++;let O=i.sharedLength||0;if(i.length>O&&!c&&(i.length=O),k>1e4)i.transitions=null,b=0,k=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let w=0,C=p.length;w<C;w++)p[w][oo]=0;p=[]}},T=O=>{var w=O.length;w<16?Z[Y++]=144|w:w<65536?(Z[Y++]=220,Z[Y++]=w>>8,Z[Y++]=w&255):(Z[Y++]=221,ge.setUint32(Y,w),Y+=4);for(let C=0;C<w;C++)A(O[C])},A=O=>{Y>On&&(Z=N(Y));var w=typeof O,C;if(w==="string"){let P=O.length;if(Le&&P>=4&&P<4096){if((Le.size+=P)>yS){let it,W=(Le[0]?Le[0].length*3+Le[1].length:0)+10;Y+W>On&&(Z=N(Y+W));let D;Le.position?(D=Le,Z[Y]=200,Y+=3,Z[Y++]=98,it=Y-n,Y+=4,eg(n,A,0),ge.setUint16(it+n-3,Y-n-it)):(Z[Y++]=214,Z[Y++]=98,it=Y-n,Y+=4),Le=["",""],Le.previous=D,Le.size=0,Le.position=it}let tt=bS.test(O);Le[tt?0:1]+=O,Z[Y++]=193,A(tt?-P:P);return}let F;P<32?F=1:P<256?F=2:P<65536?F=3:F=5;let ot=P*3;if(Y+ot>On&&(Z=N(Y+ot)),P<64||!o){let tt,it,W,D=Y+F;for(tt=0;tt<P;tt++)it=O.charCodeAt(tt),it<128?Z[D++]=it:it<2048?(Z[D++]=it>>6|192,Z[D++]=it&63|128):(it&64512)===55296&&((W=O.charCodeAt(tt+1))&64512)===56320?(it=65536+((it&1023)<<10)+(W&1023),tt++,Z[D++]=it>>18|240,Z[D++]=it>>12&63|128,Z[D++]=it>>6&63|128,Z[D++]=it&63|128):(Z[D++]=it>>12|224,Z[D++]=it>>6&63|128,Z[D++]=it&63|128);C=D-Y-F}else C=o(O,Y+F);C<32?Z[Y++]=160|C:C<256?(F<2&&Z.copyWithin(Y+2,Y+1,Y+1+C),Z[Y++]=217,Z[Y++]=C):C<65536?(F<3&&Z.copyWithin(Y+3,Y+2,Y+2+C),Z[Y++]=218,Z[Y++]=C>>8,Z[Y++]=C&255):(F<5&&Z.copyWithin(Y+5,Y+3,Y+3+C),Z[Y++]=219,ge.setUint32(Y,C),Y+=4),Y+=C}else if(w==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?Z[Y++]=O:O<256?(Z[Y++]=204,Z[Y++]=O):O<65536?(Z[Y++]=205,Z[Y++]=O>>8,Z[Y++]=O&255):(Z[Y++]=206,ge.setUint32(Y,O),Y+=4);else if(O>>0===O)O>=-32?Z[Y++]=256+O:O>=-128?(Z[Y++]=208,Z[Y++]=O+256):O>=-32768?(Z[Y++]=209,ge.setInt16(Y,O),Y+=2):(Z[Y++]=210,ge.setInt32(Y,O),Y+=4);else{let P;if((P=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){Z[Y++]=202,ge.setFloat32(Y,O);let F;if(P<4||(F=O*Ph[(Z[Y]&127)<<1|Z[Y+1]>>7])>>0===F){Y+=4;return}else Y--}Z[Y++]=203,ge.setFloat64(Y,O),Y+=8}else if(w==="object"||w==="function")if(!O)Z[Y++]=192;else{if(s){let F=s.get(O);if(F){if(!F.id){let ot=s.idsToInsert||(s.idsToInsert=[]);F.id=ot.push(F)}Z[Y++]=214,Z[Y++]=112,ge.setUint32(Y,F.id),Y+=4;return}else s.set(O,{offset:Y-n})}let P=O.constructor;if(P===Object)$(O);else if(P===Array)T(O);else if(P===Map)if(this.mapAsEmptyObject)Z[Y++]=128;else{C=O.size,C<16?Z[Y++]=128|C:C<65536?(Z[Y++]=222,Z[Y++]=C>>8,Z[Y++]=C&255):(Z[Y++]=223,ge.setUint32(Y,C),Y+=4);for(let[F,ot]of O)A(F),A(ot)}else{for(let F=0,ot=$h.length;F<ot;F++){let tt=qm[F];if(O instanceof tt){let it=$h[F];if(it.write){it.type&&(Z[Y++]=212,Z[Y++]=it.type,Z[Y++]=0);let at=it.write.call(this,O);at===O?Array.isArray(O)?T(O):$(O):A(at);return}let W=Z,D=ge,yt=Y;Z=null;let X;try{X=it.pack.call(this,O,at=>(Z=W,W=null,Y+=at,Y>On&&N(Y),{target:Z,targetView:ge,position:Y-at}),A)}finally{W&&(Z=W,ge=D,Y=yt,On=Z.length-10)}X&&(X.length+Y>On&&N(X.length+Y),Y=ES(X,Z,Y,it.type));return}}if(Array.isArray(O))T(O);else{if(O.toJSON){const F=O.toJSON();if(F!==O)return A(F)}if(w==="function")return A(this.writeFunction&&this.writeFunction(O));$(O)}}}else if(w==="boolean")Z[Y++]=O?195:194;else if(w==="bigint"){if(O<BigInt(1)<<BigInt(63)&&O>=-(BigInt(1)<<BigInt(63)))Z[Y++]=211,ge.setBigInt64(Y,O);else if(O<BigInt(1)<<BigInt(64)&&O>0)Z[Y++]=207,ge.setBigUint64(Y,O);else if(this.largeBigIntToFloat)Z[Y++]=203,ge.setFloat64(Y,Number(O));else{if(this.largeBigIntToString)return A(O.toString());if(this.useBigIntExtension&&O<BigInt(2)**BigInt(1023)&&O>-(BigInt(2)**BigInt(1023))){Z[Y++]=199,Y++,Z[Y++]=66;let P=[],F;do{let ot=O&BigInt(255);F=(ot&BigInt(128))===(O<BigInt(0)?BigInt(128):BigInt(0)),P.push(ot),O>>=BigInt(8)}while(!((O===BigInt(0)||O===BigInt(-1))&&F));Z[Y-2]=P.length;for(let ot=P.length;ot>0;)Z[Y++]=Number(P[--ot]);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Y+=8}else if(w==="undefined")this.encodeUndefinedAsNil?Z[Y++]=192:(Z[Y++]=212,Z[Y++]=0,Z[Y++]=0);else throw new Error("Unknown type: "+w)},L=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let w;if(this.skipValues){w=[];for(let F in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(F))&&!this.skipValues.includes(O[F])&&w.push(F)}else w=Object.keys(O);let C=w.length;C<16?Z[Y++]=128|C:C<65536?(Z[Y++]=222,Z[Y++]=C>>8,Z[Y++]=C&255):(Z[Y++]=223,ge.setUint32(Y,C),Y+=4);let P;if(this.coercibleKeyAsNumber)for(let F=0;F<C;F++){P=w[F];let ot=Number(P);A(isNaN(ot)?P:ot),A(O[P])}else for(let F=0;F<C;F++)A(P=w[F]),A(O[P])}:O=>{Z[Y++]=222;let w=Y-n;Y+=2;let C=0;for(let P in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(P))&&(A(P),A(O[P]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');Z[w+++n]=C>>8,Z[w+n]=C&255},S=this.useRecords===!1?L:t.progressiveRecords&&!d?O=>{let w,C=i.transitions||(i.transitions=Object.create(null)),P=Y++-n,F;for(let ot in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot)){if(w=C[ot],w)C=w;else{let tt=Object.keys(O),it=C;C=i.transitions;let W=0;for(let D=0,yt=tt.length;D<yt;D++){let X=tt[D];w=C[X],w||(w=C[X]=Object.create(null),W++),C=w}P+n+1==Y?(Y--,z(C,tt,W)):J(C,tt,P,W),F=!0,C=it[ot]}A(O[ot])}if(!F){let ot=C[oo];ot?Z[P+n]=ot:J(C,Object.keys(O),P,0)}}:O=>{let w,C=i.transitions||(i.transitions=Object.create(null)),P=0;for(let ot in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot))&&(w=C[ot],w||(w=C[ot]=Object.create(null),P++),C=w);let F=C[oo];F?F>=96&&d?(Z[Y++]=((F-=96)&31)+96,Z[Y++]=F>>5):Z[Y++]=F:z(C,C.__keys__||Object.keys(O),P);for(let ot in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot))&&A(O[ot])},I=typeof this.useRecords=="function"&&this.useRecords,$=I?O=>{I(O)?S(O):L(O)}:S,N=O=>{let w;if(O>16777216){if(O-n>Zm)throw new Error("Packed buffer would be larger than maximum buffer size");w=Math.min(Zm,Math.round(Math.max((O-n)*(O>67108864?1.25:2),4194304)/4096)*4096)}else w=(Math.max(O-n<<2,Z.length-1)>>12)+1<<12;let C=new Uc(w);return ge=C.dataView||(C.dataView=new DataView(C.buffer,0,w)),O=Math.min(O,Z.length),Z.copy?Z.copy(C,0,n,O):C.set(Z.slice(n,O)),Y-=n,n=0,On=C.length-10,Z=C},z=(O,w,C)=>{let P=i.nextId;P||(P=64),P<h&&this.shouldShareStructure&&!this.shouldShareStructure(w)?(P=i.nextOwnId,P<m||(P=h),i.nextOwnId=P+1):(P>=m&&(P=h),i.nextId=P+1);let F=w.highByte=P>=96&&d?P-96>>5:-1;O[oo]=P,O.__keys__=w,i[P-64]=w,P<h?(w.isShared=!0,i.sharedLength=P-63,r=!0,F>=0?(Z[Y++]=(P&31)+96,Z[Y++]=F):Z[Y++]=P):(F>=0?(Z[Y++]=213,Z[Y++]=114,Z[Y++]=(P&31)+96,Z[Y++]=F):(Z[Y++]=212,Z[Y++]=114,Z[Y++]=P),C&&(k+=b*C),p.length>=f&&(p.shift()[oo]=0),p.push(O),A(w))},J=(O,w,C,P)=>{let F=Z,ot=Y,tt=On,it=n;Z=na,Y=0,n=0,Z||(na=Z=new Uc(8192)),On=Z.length-10,z(O,w,P),na=Z;let W=Y;if(Z=F,Y=ot,On=tt,n=it,W>1){let D=Y+W-1;D>On&&N(D);let yt=C+n;Z.copyWithin(yt+W,yt+1,Y),Z.set(na.slice(0,W),yt),Y=D}else Z[C+n]=na[0]},M=O=>{let w=_S(O,Z,n,Y,i,N,(C,P,F)=>{if(F)return r=!0;Y=P;let ot=Z;return A(C),v(),ot!==Z?{position:Y,targetView:ge,target:Z}:Y},this);if(w===0)return $(O);Y=w}}useBuffer(t){Z=t,Z.dataView||(Z.dataView=new DataView(Z.buffer,Z.byteOffset,Z.byteLength)),Y=0}set position(t){Y=t}get position(){return Y}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}qm=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Lm],$h=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Qm(e,16,t):tg(Mc?pn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Jm&&this.moreTypes?Qm(e,Vm.indexOf(n.name),t):tg(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Qm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function tg(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function ES(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function wS(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function eg(e,t,n){if(Le.length>0){ge.setUint32(Le.position+e,Y+n-Le.position-e),Le.stringsPosition=Y-e;let r=Le;Le=null,t(r[0]),t(r[1])}}function xS(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let ng=new kS({useRecords:!1});const vS=ng.pack;ng.pack;const TS=512,AS=1024,SS=2048;function Ae(){return null}function ao(e,t,n={}){if(!y(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];y(c)&&(a=c(a));const l=t[o];y(l)&&(o=l),a!==null&&r.push(o,a)}return r}function ra(e,t,n={}){if(y(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];y(a)&&(s=a);const c=n[s];y(c)&&(o=c(o)),r[s]=o}return r}catch(r){de(nt,"","binary",r.message)}}function RS(e){try{const t=Tr(e);return vS(t)}catch(t){de(nt,"","binary",t.message)}}function OS(e){try{return mS(e)}catch(t){de(nt,"","binary",t.message)}}function rg(){return{id:De()}}var Fc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e))(Fc||{});function Bc(e){return y(e==null?void 0:e.id)?ao(e,Fc,{category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae}):ao(e,Fc,{id:Ae,x:Ae,y:Ae,lx:Ae,ly:Ae,code:Ae,category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae})}function Pc(e){return ra(e,Fc)}function Ge(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function ia(e,t){if(!y(e)||!wn(t))return;const{color:n,bg:r}=vm(t);y(n)&&(e.color=n),y(r)&&(e.bg=r)}function ig(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function sg(e){const t=Math.floor(e.length/Rc);if(t*Rc!==e.length)return;const n=ig(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function NS(e,t){return e&1<<t?255:0}function og(e){const t=Math.floor(e.length/Nh);if(t*Nh!==e.length)return;const n=Math.ceil(t/Oc),r=ji*Oc,i=ig(r,zi*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*zi+a,u=e[c];for(let f=0;f<ji;++f){const d=s*ji+f;i.bits[d+l*r]=NS(u,7-f)}++a,a===zi&&(a=0,++s,s===Oc&&(s=0,++o))}return i}const IS=Za("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),CS=Za("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ag=typeof js=="object"&&js&&js.Object===Object&&js,LS=typeof self=="object"&&self&&self.Object===Object&&self,ti=ag||LS||Function("return this")(),_r=ti.Symbol,cg=Object.prototype,MS=cg.hasOwnProperty,US=cg.toString,sa=_r?_r.toStringTag:void 0;function FS(e){var t=MS.call(e,sa),n=e[sa];try{e[sa]=void 0;var r=!0}catch{}var i=US.call(e);return r&&(t?e[sa]=n:delete e[sa]),i}var BS=Object.prototype,PS=BS.toString;function $S(e){return PS.call(e)}var DS="[object Null]",jS="[object Undefined]",lg=_r?_r.toStringTag:void 0;function Ki(e){return e==null?e===void 0?jS:DS:lg&&lg in Object(e)?FS(e):$S(e)}function Cr(e){return e!=null&&typeof e=="object"}var zS="[object Symbol]";function $c(e){return typeof e=="symbol"||Cr(e)&&Ki(e)==zS}function Dc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var se=Array.isArray,WS=1/0,ug=_r?_r.prototype:void 0,hg=ug?ug.toString:void 0;function fg(e){if(typeof e=="string")return e;if(se(e))return Dc(e,fg)+"";if($c(e))return hg?hg.call(e):"";var t=e+"";return t=="0"&&1/e==-WS?"-0":t}var GS=/\s/;function KS(e){for(var t=e.length;t--&&GS.test(e.charAt(t)););return t}var HS=/^\s+/;function YS(e){return e&&e.slice(0,KS(e)+1).replace(HS,"")}function yr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var dg=NaN,VS=/^[-+]0x[0-9a-f]+$/i,XS=/^0b[01]+$/i,qS=/^0o[0-7]+$/i,JS=parseInt;function ZS(e){if(typeof e=="number")return e;if($c(e))return dg;if(yr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=yr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=YS(e);var n=XS.test(e);return n||qS.test(e)?JS(e.slice(2),n?2:8):VS.test(e)?dg:+e}var pg=1/0,QS=17976931348623157e292;function tR(e){if(!e)return e===0?e:0;if(e=ZS(e),e===pg||e===-pg){var t=e<0?-1:1;return t*QS}return e===e?e:0}function jc(e){var t=tR(e),n=t%1;return t===t?n?t-n:t:0}function co(e){return e}var eR="[object AsyncFunction]",nR="[object Function]",rR="[object GeneratorFunction]",iR="[object Proxy]";function xi(e){if(!yr(e))return!1;var t=Ki(e);return t==nR||t==rR||t==eR||t==iR}var Dh=ti["__core-js_shared__"],mg=function(){var e=/[^.]+$/.exec(Dh&&Dh.keys&&Dh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function sR(e){return!!mg&&mg in e}var oR=Function.prototype,aR=oR.toString;function _s(e){if(e!=null){try{return aR.call(e)}catch{}try{return e+""}catch{}}return""}var cR=/[\\^$.*+?()[\]{}|]/g,lR=/^\[object .+?Constructor\]$/,uR=Function.prototype,hR=Object.prototype,fR=uR.toString,dR=hR.hasOwnProperty,pR=RegExp("^"+fR.call(dR).replace(cR,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mR(e){if(!yr(e)||sR(e))return!1;var t=xi(e)?pR:lR;return t.test(_s(e))}function gR(e,t){return e==null?void 0:e[t]}function ys(e,t){var n=gR(e,t);return mR(n)?n:void 0}var jh=ys(ti,"WeakMap"),gg=Object.create,_R=function(){function e(){}return function(t){if(!yr(t))return{};if(gg)return gg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function yR(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Qe(){}function bR(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var kR=800,ER=16,wR=Date.now;function xR(e){var t=0,n=0;return function(){var r=wR(),i=ER-(r-n);if(n=r,i>0){if(++t>=kR)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function vR(e){return function(){return e}}var zc=function(){try{var e=ys(Object,"defineProperty");return e({},"",{}),e}catch{}}(),TR=zc?function(e,t){return zc(e,"toString",{configurable:!0,enumerable:!1,value:vR(t),writable:!0})}:co,AR=xR(TR);function _g(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function yg(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function SR(e){return e!==e}function RR(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function zh(e,t,n){return t===t?RR(e,t,n):yg(e,SR,n)}function bg(e,t){var n=e==null?0:e.length;return!!n&&zh(e,t,0)>-1}var OR=9007199254740991,NR=/^(?:0|[1-9]\d*)$/;function Wc(e,t){var n=typeof e;return t=t??OR,!!t&&(n=="number"||n!="symbol"&&NR.test(e))&&e>-1&&e%1==0&&e<t}function Wh(e,t,n){t=="__proto__"&&zc?zc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function oa(e,t){return e===t||e!==e&&t!==t}var IR=Object.prototype,CR=IR.hasOwnProperty;function Gc(e,t,n){var r=e[t];(!(CR.call(e,t)&&oa(r,n))||n===void 0&&!(t in e))&&Wh(e,t,n)}function Gh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Wh(n,a,c):Gc(n,a,c)}return n}var kg=Math.max;function LR(e,t,n){return t=kg(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=kg(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),yR(e,this,a)}}function Kh(e,t){return AR(LR(e,t,co),e+"")}var MR=9007199254740991;function Hh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=MR}function ei(e){return e!=null&&Hh(e.length)&&!xi(e)}function Eg(e,t,n){if(!yr(n))return!1;var r=typeof t;return(r=="number"?ei(n)&&Wc(t,n.length):r=="string"&&t in n)?oa(n[t],e):!1}function UR(e){return Kh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Eg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var FR=Object.prototype;function aa(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||FR;return e===n}function BR(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var PR="[object Arguments]";function wg(e){return Cr(e)&&Ki(e)==PR}var xg=Object.prototype,$R=xg.hasOwnProperty,DR=xg.propertyIsEnumerable,Kc=wg(function(){return arguments}())?wg:function(e){return Cr(e)&&$R.call(e,"callee")&&!DR.call(e,"callee")};function jR(){return!1}var vg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Tg=vg&&typeof module=="object"&&module&&!module.nodeType&&module,zR=Tg&&Tg.exports===vg,Ag=zR?ti.Buffer:void 0,WR=Ag?Ag.isBuffer:void 0,ca=WR||jR,GR="[object Arguments]",KR="[object Array]",HR="[object Boolean]",YR="[object Date]",VR="[object Error]",XR="[object Function]",qR="[object Map]",JR="[object Number]",ZR="[object Object]",QR="[object RegExp]",tO="[object Set]",eO="[object String]",nO="[object WeakMap]",rO="[object ArrayBuffer]",iO="[object DataView]",sO="[object Float32Array]",oO="[object Float64Array]",aO="[object Int8Array]",cO="[object Int16Array]",lO="[object Int32Array]",uO="[object Uint8Array]",hO="[object Uint8ClampedArray]",fO="[object Uint16Array]",dO="[object Uint32Array]",we={};we[sO]=we[oO]=we[aO]=we[cO]=we[lO]=we[uO]=we[hO]=we[fO]=we[dO]=!0,we[GR]=we[KR]=we[rO]=we[HR]=we[iO]=we[YR]=we[VR]=we[XR]=we[qR]=we[JR]=we[ZR]=we[QR]=we[tO]=we[eO]=we[nO]=!1;function pO(e){return Cr(e)&&Hh(e.length)&&!!we[Ki(e)]}function Hc(e){return function(t){return e(t)}}var Sg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,la=Sg&&typeof module=="object"&&module&&!module.nodeType&&module,mO=la&&la.exports===Sg,Yh=mO&&ag.process,Hi=function(){try{var e=la&&la.require&&la.require("util").types;return e||Yh&&Yh.binding&&Yh.binding("util")}catch{}}(),Rg=Hi&&Hi.isTypedArray,Vh=Rg?Hc(Rg):pO,gO=Object.prototype,_O=gO.hasOwnProperty;function Og(e,t){var n=se(e),r=!n&&Kc(e),i=!n&&!r&&ca(e),s=!n&&!r&&!i&&Vh(e),o=n||r||i||s,a=o?BR(e.length,String):[],c=a.length;for(var l in e)(t||_O.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Wc(l,c)))&&a.push(l);return a}function Ng(e,t){return function(n){return e(t(n))}}var yO=Ng(Object.keys,Object),bO=Object.prototype,kO=bO.hasOwnProperty;function Ig(e){if(!aa(e))return yO(e);var t=[];for(var n in Object(e))kO.call(e,n)&&n!="constructor"&&t.push(n);return t}function br(e){return ei(e)?Og(e):Ig(e)}var EO=Object.prototype,wO=EO.hasOwnProperty,zn=UR(function(e,t){if(aa(t)||ei(t)){Gh(t,br(t),e);return}for(var n in t)wO.call(t,n)&&Gc(e,n,t[n])});function xO(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var vO=Object.prototype,TO=vO.hasOwnProperty;function AO(e){if(!yr(e))return xO(e);var t=aa(e),n=[];for(var r in e)r=="constructor"&&(t||!TO.call(e,r))||n.push(r);return n}function Cg(e){return ei(e)?Og(e,!0):AO(e)}var SO=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,RO=/^\w*$/;function Xh(e,t){if(se(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||$c(e)?!0:RO.test(e)||!SO.test(e)||t!=null&&e in Object(t)}var ua=ys(Object,"create");function OO(){this.__data__=ua?ua(null):{},this.size=0}function NO(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var IO="__lodash_hash_undefined__",CO=Object.prototype,LO=CO.hasOwnProperty;function MO(e){var t=this.__data__;if(ua){var n=t[e];return n===IO?void 0:n}return LO.call(t,e)?t[e]:void 0}var UO=Object.prototype,FO=UO.hasOwnProperty;function BO(e){var t=this.__data__;return ua?t[e]!==void 0:FO.call(t,e)}var PO="__lodash_hash_undefined__";function $O(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ua&&t===void 0?PO:t,this}function bs(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}bs.prototype.clear=OO,bs.prototype.delete=NO,bs.prototype.get=MO,bs.prototype.has=BO,bs.prototype.set=$O;function DO(){this.__data__=[],this.size=0}function Yc(e,t){for(var n=e.length;n--;)if(oa(e[n][0],t))return n;return-1}var jO=Array.prototype,zO=jO.splice;function WO(e){var t=this.__data__,n=Yc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():zO.call(t,n,1),--this.size,!0}function GO(e){var t=this.__data__,n=Yc(t,e);return n<0?void 0:t[n][1]}function KO(e){return Yc(this.__data__,e)>-1}function HO(e,t){var n=this.__data__,r=Yc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function vi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vi.prototype.clear=DO,vi.prototype.delete=WO,vi.prototype.get=GO,vi.prototype.has=KO,vi.prototype.set=HO;var ha=ys(ti,"Map");function YO(){this.size=0,this.__data__={hash:new bs,map:new(ha||vi),string:new bs}}function VO(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Vc(e,t){var n=e.__data__;return VO(t)?n[typeof t=="string"?"string":"hash"]:n.map}function XO(e){var t=Vc(this,e).delete(e);return this.size-=t?1:0,t}function qO(e){return Vc(this,e).get(e)}function JO(e){return Vc(this,e).has(e)}function ZO(e,t){var n=Vc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Ti(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ti.prototype.clear=YO,Ti.prototype.delete=XO,Ti.prototype.get=qO,Ti.prototype.has=JO,Ti.prototype.set=ZO;var QO="Expected a function";function qh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(QO);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(qh.Cache||Ti),n}qh.Cache=Ti;var tN=500;function eN(e){var t=qh(e,function(r){return n.size===tN&&n.clear(),r}),n=t.cache;return t}var nN=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rN=/\\(\\)?/g,iN=eN(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(nN,function(n,r,i,s){t.push(i?s.replace(rN,"$1"):r||n)}),t});function Lg(e){return e==null?"":fg(e)}function Xc(e,t){return se(e)?e:Xh(e,t)?[e]:iN(Lg(e))}var sN=1/0;function fa(e){if(typeof e=="string"||$c(e))return e;var t=e+"";return t=="0"&&1/e==-sN?"-0":t}function Jh(e,t){t=Xc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[fa(t[n++])];return n&&n==r?e:void 0}function oN(e,t,n){var r=e==null?void 0:Jh(e,t);return r===void 0?n:r}function Zh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Mg=_r?_r.isConcatSpreadable:void 0;function aN(e){return se(e)||Kc(e)||!!(Mg&&e&&e[Mg])}function Qh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=aN),i||(i=[]);++s<o;){var a=e[s];n(a)?Zh(i,a):r||(i[i.length]=a)}return i}function ir(e){var t=e==null?0:e.length;return t?Qh(e):[]}var Ug=Ng(Object.getPrototypeOf,Object);function tf(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function cN(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:tf(e,t,n)}var lN="\\ud800-\\udfff",uN="\\u0300-\\u036f",hN="\\ufe20-\\ufe2f",fN="\\u20d0-\\u20ff",dN=uN+hN+fN,pN="\\ufe0e\\ufe0f",mN="\\u200d",gN=RegExp("["+mN+lN+dN+pN+"]");function Fg(e){return gN.test(e)}function _N(e){return e.split("")}var Bg="\\ud800-\\udfff",yN="\\u0300-\\u036f",bN="\\ufe20-\\ufe2f",kN="\\u20d0-\\u20ff",EN=yN+bN+kN,wN="\\ufe0e\\ufe0f",xN="["+Bg+"]",ef="["+EN+"]",nf="\\ud83c[\\udffb-\\udfff]",vN="(?:"+ef+"|"+nf+")",Pg="[^"+Bg+"]",$g="(?:\\ud83c[\\udde6-\\uddff]){2}",Dg="[\\ud800-\\udbff][\\udc00-\\udfff]",TN="\\u200d",jg=vN+"?",zg="["+wN+"]?",AN="(?:"+TN+"(?:"+[Pg,$g,Dg].join("|")+")"+zg+jg+")*",SN=zg+jg+AN,RN="(?:"+[Pg+ef+"?",ef,$g,Dg,xN].join("|")+")",ON=RegExp(nf+"(?="+nf+")|"+RN+SN,"g");function NN(e){return e.match(ON)||[]}function IN(e){return Fg(e)?NN(e):_N(e)}function CN(e){return function(t){t=Lg(t);var n=Fg(t)?IN(t):void 0,r=n?n[0]:t.charAt(0),i=n?cN(n,1).join(""):t.slice(1);return r[e]()+i}}var Wg=CN("toUpperCase");function LN(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function MN(){this.__data__=new vi,this.size=0}function UN(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function FN(e){return this.__data__.get(e)}function BN(e){return this.__data__.has(e)}var PN=200;function $N(e,t){var n=this.__data__;if(n instanceof vi){var r=n.__data__;if(!ha||r.length<PN-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ti(r)}return n.set(e,t),this.size=n.size,this}function ni(e){var t=this.__data__=new vi(e);this.size=t.size}ni.prototype.clear=MN,ni.prototype.delete=UN,ni.prototype.get=FN,ni.prototype.has=BN,ni.prototype.set=$N;function DN(e,t){return e&&Gh(t,br(t),e)}var Gg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Kg=Gg&&typeof module=="object"&&module&&!module.nodeType&&module,jN=Kg&&Kg.exports===Gg,Hg=jN?ti.Buffer:void 0,Yg=Hg?Hg.allocUnsafe:void 0;function zN(e,t){var n=e.length,r=Yg?Yg(n):new e.constructor(n);return e.copy(r),r}function rf(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Vg(){return[]}var WN=Object.prototype,GN=WN.propertyIsEnumerable,Xg=Object.getOwnPropertySymbols,sf=Xg?function(e){return e==null?[]:(e=Object(e),rf(Xg(e),function(t){return GN.call(e,t)}))}:Vg;function KN(e,t){return Gh(e,sf(e),t)}var HN=Object.getOwnPropertySymbols,YN=HN?function(e){for(var t=[];e;)Zh(t,sf(e)),e=Ug(e);return t}:Vg;function qg(e,t,n){var r=t(e);return se(e)?r:Zh(r,n(e))}function of(e){return qg(e,br,sf)}function VN(e){return qg(e,Cg,YN)}var af=ys(ti,"DataView"),cf=ys(ti,"Promise"),lo=ys(ti,"Set"),Jg="[object Map]",XN="[object Object]",Zg="[object Promise]",Qg="[object Set]",t_="[object WeakMap]",e_="[object DataView]",qN=_s(af),JN=_s(ha),ZN=_s(cf),QN=_s(lo),tI=_s(jh),kr=Ki;(af&&kr(new af(new ArrayBuffer(1)))!=e_||ha&&kr(new ha)!=Jg||cf&&kr(cf.resolve())!=Zg||lo&&kr(new lo)!=Qg||jh&&kr(new jh)!=t_)&&(kr=function(e){var t=Ki(e),n=t==XN?e.constructor:void 0,r=n?_s(n):"";if(r)switch(r){case qN:return e_;case JN:return Jg;case ZN:return Zg;case QN:return Qg;case tI:return t_}return t});var eI=Object.prototype,nI=eI.hasOwnProperty;function rI(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&nI.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var qc=ti.Uint8Array;function iI(e){var t=new e.constructor(e.byteLength);return new qc(t).set(new qc(e)),t}function sI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var oI=/\w*$/;function aI(e){var t=new e.constructor(e.source,oI.exec(e));return t.lastIndex=e.lastIndex,t}var n_=_r?_r.prototype:void 0,r_=n_?n_.valueOf:void 0;function cI(e){return r_?Object(r_.call(e)):{}}function lI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var uI="[object Boolean]",hI="[object Date]",fI="[object Map]",dI="[object Number]",pI="[object RegExp]",mI="[object Set]",gI="[object String]",_I="[object Symbol]",yI="[object ArrayBuffer]",bI="[object DataView]",kI="[object Float32Array]",EI="[object Float64Array]",wI="[object Int8Array]",xI="[object Int16Array]",vI="[object Int32Array]",TI="[object Uint8Array]",AI="[object Uint8ClampedArray]",SI="[object Uint16Array]",RI="[object Uint32Array]";function OI(e,t,n){var r=e.constructor;switch(t){case yI:return iI(e);case uI:case hI:return new r(+e);case bI:return sI(e);case kI:case EI:case wI:case xI:case vI:case TI:case AI:case SI:case RI:return lI(e);case fI:return new r;case dI:case gI:return new r(e);case pI:return aI(e);case mI:return new r;case _I:return cI(e)}}function NI(e){return typeof e.constructor=="function"&&!aa(e)?_R(Ug(e)):{}}var II="[object Map]";function CI(e){return Cr(e)&&kr(e)==II}var i_=Hi&&Hi.isMap,LI=i_?Hc(i_):CI,MI="[object Set]";function UI(e){return Cr(e)&&kr(e)==MI}var s_=Hi&&Hi.isSet,FI=s_?Hc(s_):UI,o_="[object Arguments]",BI="[object Array]",PI="[object Boolean]",$I="[object Date]",DI="[object Error]",a_="[object Function]",jI="[object GeneratorFunction]",zI="[object Map]",WI="[object Number]",c_="[object Object]",GI="[object RegExp]",KI="[object Set]",HI="[object String]",YI="[object Symbol]",VI="[object WeakMap]",XI="[object ArrayBuffer]",qI="[object DataView]",JI="[object Float32Array]",ZI="[object Float64Array]",QI="[object Int8Array]",tC="[object Int16Array]",eC="[object Int32Array]",nC="[object Uint8Array]",rC="[object Uint8ClampedArray]",iC="[object Uint16Array]",sC="[object Uint32Array]",_e={};_e[o_]=_e[BI]=_e[XI]=_e[qI]=_e[PI]=_e[$I]=_e[JI]=_e[ZI]=_e[QI]=_e[tC]=_e[eC]=_e[zI]=_e[WI]=_e[c_]=_e[GI]=_e[KI]=_e[HI]=_e[YI]=_e[nC]=_e[rC]=_e[iC]=_e[sC]=!0,_e[DI]=_e[a_]=_e[VI]=!1;function Jc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!yr(e))return e;var a=se(e);if(a)return o=rI(e),bR(e,o);var c=kr(e),l=c==a_||c==jI;if(ca(e))return zN(e);if(c==c_||c==o_||l&&!i)return o=l?{}:NI(e),KN(e,DN(o,e));if(!_e[c])return i?e:{};o=OI(e,c),s||(s=new ni);var u=s.get(e);if(u)return u;s.set(e,o),FI(e)?e.forEach(function(h){o.add(Jc(h,t,n,h,e,s))}):LI(e)&&e.forEach(function(h,m){o.set(m,Jc(h,t,n,m,e,s))});var f=of,d=a?void 0:f(e);return _g(d||e,function(h,m){d&&(m=h,h=e[m]),Gc(o,m,Jc(h,t,n,m,e,s))}),o}var oC=4;function _n(e){return Jc(e,oC)}function da(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var aC="__lodash_hash_undefined__";function cC(e){return this.__data__.set(e,aC),this}function lC(e){return this.__data__.has(e)}function uo(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Ti;++t<n;)this.add(e[t])}uo.prototype.add=uo.prototype.push=cC,uo.prototype.has=lC;function l_(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function lf(e,t){return e.has(t)}var uC=1,hC=2;function u_(e,t,n,r,i,s){var o=n&uC,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=n&hC?new uo:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var m=e[f],p=t[f];if(r)var k=o?r(p,m,f,t,e,s):r(m,p,f,e,t,s);if(k!==void 0){if(k)continue;d=!1;break}if(h){if(!l_(t,function(b,v){if(!lf(h,v)&&(m===b||i(m,b,n,r,s)))return h.push(v)})){d=!1;break}}else if(!(m===p||i(m,p,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function fC(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function uf(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var dC=1,pC=2,mC="[object Boolean]",gC="[object Date]",_C="[object Error]",yC="[object Map]",bC="[object Number]",kC="[object RegExp]",EC="[object Set]",wC="[object String]",xC="[object Symbol]",vC="[object ArrayBuffer]",TC="[object DataView]",h_=_r?_r.prototype:void 0,hf=h_?h_.valueOf:void 0;function AC(e,t,n,r,i,s,o){switch(n){case TC:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case vC:return!(e.byteLength!=t.byteLength||!s(new qc(e),new qc(t)));case mC:case gC:case bC:return oa(+e,+t);case _C:return e.name==t.name&&e.message==t.message;case kC:case wC:return e==t+"";case yC:var a=fC;case EC:var c=r&dC;if(a||(a=uf),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=pC,o.set(e,t);var u=u_(a(e),a(t),r,i,s,o);return o.delete(e),u;case xC:if(hf)return hf.call(e)==hf.call(t)}return!1}var SC=1,RC=Object.prototype,OC=RC.hasOwnProperty;function NC(e,t,n,r,i,s){var o=n&SC,a=of(e),c=a.length,l=of(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:OC.call(t,d)))return!1}var h=s.get(e),m=s.get(t);if(h&&m)return h==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var k=o;++f<c;){d=a[f];var b=e[d],v=t[d];if(r)var T=o?r(v,b,d,t,e,s):r(b,v,d,e,t,s);if(!(T===void 0?b===v||i(b,v,n,r,s):T)){p=!1;break}k||(k=d=="constructor")}if(p&&!k){var A=e.constructor,L=t.constructor;A!=L&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof L=="function"&&L instanceof L)&&(p=!1)}return s.delete(e),s.delete(t),p}var IC=1,f_="[object Arguments]",d_="[object Array]",Zc="[object Object]",CC=Object.prototype,p_=CC.hasOwnProperty;function LC(e,t,n,r,i,s){var o=se(e),a=se(t),c=o?d_:kr(e),l=a?d_:kr(t);c=c==f_?Zc:c,l=l==f_?Zc:l;var u=c==Zc,f=l==Zc,d=c==l;if(d&&ca(e)){if(!ca(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ni),o||Vh(e)?u_(e,t,n,r,i,s):AC(e,t,c,n,r,i,s);if(!(n&IC)){var h=u&&p_.call(e,"__wrapped__"),m=f&&p_.call(t,"__wrapped__");if(h||m){var p=h?e.value():e,k=m?t.value():t;return s||(s=new ni),i(p,k,n,r,s)}}return d?(s||(s=new ni),NC(e,t,n,r,i,s)):!1}function ff(e,t,n,r,i){return e===t?!0:e==null||t==null||!Cr(e)&&!Cr(t)?e!==e&&t!==t:LC(e,t,n,r,ff,i)}var MC=1,UC=2;function FC(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ni,f;if(!(f===void 0?ff(l,c,MC|UC,r,u):f))return!1}}return!0}function m_(e){return e===e&&!yr(e)}function BC(e){for(var t=br(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,m_(i)]}return t}function g_(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function PC(e){var t=BC(e);return t.length==1&&t[0][2]?g_(t[0][0],t[0][1]):function(n){return n===e||FC(n,e,t)}}function $C(e,t){return e!=null&&t in Object(e)}function __(e,t,n){t=Xc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=fa(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Hh(i)&&Wc(o,i)&&(se(e)||Kc(e)))}function DC(e,t){return e!=null&&__(e,t,$C)}var jC=1,zC=2;function WC(e,t){return Xh(e)&&m_(t)?g_(fa(e),t):function(n){var r=oN(n,e);return r===void 0&&r===t?DC(n,e):ff(t,r,jC|zC)}}function GC(e){return function(t){return t==null?void 0:t[e]}}function KC(e){return function(t){return Jh(t,e)}}function HC(e){return Xh(e)?GC(fa(e)):KC(e)}function ri(e){return typeof e=="function"?e:e==null?co:typeof e=="object"?se(e)?WC(e[0],e[1]):PC(e):HC(e)}function YC(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function VC(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var XC=VC();function qC(e,t){return e&&XC(e,t,br)}function JC(e,t){return function(n,r){if(n==null)return n;if(!ei(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var ks=JC(qC);function ZC(e,t,n,r){return ks(e,function(i,s,o){t(r,i,n(i),o)}),r}function QC(e,t){return function(n,r){var i=se(n)?YC:ZC,s=t?t():{};return i(n,e,ri(r),s)}}var y_=Object.prototype,tL=y_.hasOwnProperty,df=Kh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Eg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Cg(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||oa(u,y_[l])&&!tL.call(e,l))&&(e[l]=s[l])}return e});function b_(e){return Cr(e)&&ei(e)}var eL=200;function nL(e,t,n,r){var i=-1,s=bg,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=eL&&(s=lf,o=!1,t=new uo(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var Qc=Kh(function(e,t){return b_(e)?nL(e,Qh(t,1,b_,!0)):[]});function ho(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function yn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:jc(t),tf(e,t<0?0:t,r)):[]}function pa(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:jc(t),t=r-t,tf(e,0,t<0?0:t)):[]}function rL(e){return typeof e=="function"?e:co}function Ft(e,t){var n=se(e)?_g:ks;return n(e,rL(t))}function iL(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function sL(e,t){var n=!0;return ks(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function Lr(e,t,n){var r=se(e)?iL:sL;return r(e,ri(t))}function k_(e,t){var n=[];return ks(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function Er(e,t){var n=se(e)?rf:k_;return n(e,ri(t))}function oL(e){return function(t,n,r){var i=Object(t);if(!ei(t)){var s=ri(n);t=br(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var aL=Math.max;function cL(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:jc(n);return i<0&&(i=aL(r+i,0)),yg(e,ri(t),i)}var fo=oL(cL);function Mr(e){return e&&e.length?e[0]:void 0}function lL(e,t){var n=-1,r=ei(e)?Array(e.length):[];return ks(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function Tt(e,t){var n=se(e)?Dc:lL;return n(e,ri(t))}function wr(e,t){return Qh(Tt(e,t))}var uL=Object.prototype,hL=uL.hasOwnProperty,E_=QC(function(e,t,n){hL.call(e,n)?e[n].push(t):Wh(e,n,[t])}),fL=Object.prototype,dL=fL.hasOwnProperty;function pL(e,t){return e!=null&&dL.call(e,t)}function Ut(e,t){return e!=null&&__(e,t,pL)}var mL="[object String]";function Wn(e){return typeof e=="string"||!se(e)&&Cr(e)&&Ki(e)==mL}function gL(e,t){return Dc(t,function(n){return e[n]})}function Ve(e){return e==null?[]:gL(e,br(e))}var _L=Math.max;function Nn(e,t,n,r){e=ei(e)?e:Ve(e),n=n&&!r?jc(n):0;var i=e.length;return n<0&&(n=_L(i+n,0)),Wn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&zh(e,t,n)>-1}function w_(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return zh(e,t,i)}var yL="[object Map]",bL="[object Set]",kL=Object.prototype,EL=kL.hasOwnProperty;function ye(e){if(e==null)return!0;if(ei(e)&&(se(e)||typeof e=="string"||typeof e.splice=="function"||ca(e)||Vh(e)||Kc(e)))return!e.length;var t=kr(e);if(t==yL||t==bL)return!e.size;if(aa(e))return!Ig(e).length;for(var n in e)if(EL.call(e,n))return!1;return!0}var wL="[object RegExp]";function xL(e){return Cr(e)&&Ki(e)==wL}var x_=Hi&&Hi.isRegExp,Ai=x_?Hc(x_):xL;function Si(e){return e===void 0}var vL="Expected a function";function TL(e){if(typeof e!="function")throw new TypeError(vL);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function AL(e,t,n,r){if(!yr(e))return e;t=Xc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=fa(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=yr(u)?u:Wc(t[i+1])?[]:{})}Gc(a,c,l),a=a[c]}return e}function SL(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Jh(e,o);n(a,o)&&AL(s,Xc(o,e),a)}return s}function Ur(e,t){if(e==null)return{};var n=Dc(VN(e),function(r){return[r]});return t=ri(t),SL(e,n,function(r,i){return t(r,i[0])})}function RL(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Gn(e,t,n){var r=se(e)?LN:RL,i=arguments.length<3;return r(e,ri(t),n,i,ks)}function tl(e,t){var n=se(e)?rf:k_;return n(e,TL(ri(t)))}function OL(e,t){var n;return ks(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function pf(e,t,n){var r=se(e)?l_:OL;return r(e,ri(t))}var NL=1/0,IL=lo&&1/uf(new lo([,-0]))[1]==NL?function(e){return new lo(e)}:Qe,CL=200;function LL(e,t,n){var r=-1,i=bg,s=e.length,o=!0,a=[],c=a;if(s>=CL){var l=IL(e);if(l)return uf(l);o=!1,i=lf,c=new uo}else c=a;t:for(;++r<s;){var u=e[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function el(e){return e&&e.length?LL(e):[]}function mf(e){console&&console.error&&console.error(`Error: ${e}`)}function v_(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function T_(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function A_(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function ML(e){return UL(e)?e.LABEL:e.name}function UL(e){return Wn(e.LABEL)&&e.LABEL!==""}class ii{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Ft(this.definition,n=>{n.accept(t)})}}class Kn extends ii{constructor(t){super([]),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class po extends ii{constructor(t){super(t.definition),this.orgText="",zn(this,Ur(t,n=>n!==void 0))}}class Hn extends ii{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,zn(this,Ur(t,n=>n!==void 0))}}class Yn extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class si extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class oi extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class tn extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class Fr extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class Br extends ii{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,zn(this,Ur(t,n=>n!==void 0))}}class Me{constructor(t){this.idx=1,zn(this,Ur(t,n=>n!==void 0))}accept(t){t.visit(this)}}function FL(e){return Tt(e,nl)}function nl(e){function t(n){return Tt(n,nl)}if(e instanceof Kn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Wn(e.label)&&(n.label=e.label),n}else{if(e instanceof Hn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Yn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof si)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof oi)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:nl(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Fr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:nl(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof tn)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Br)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Me){const n={type:"Terminal",name:e.terminalType.name,label:ML(e.terminalType),idx:e.idx};Wn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ai(r)?r.source:r),n}else{if(e instanceof po)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class Es{visit(t){const n=t;switch(n.constructor){case Kn:return this.visitNonTerminal(n);case Hn:return this.visitAlternative(n);case Yn:return this.visitOption(n);case si:return this.visitRepetitionMandatory(n);case oi:return this.visitRepetitionMandatoryWithSeparator(n);case Fr:return this.visitRepetitionWithSeparator(n);case tn:return this.visitRepetition(n);case Br:return this.visitAlternation(n);case Me:return this.visitTerminal(n);case po:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function BL(e){return e instanceof Hn||e instanceof Yn||e instanceof tn||e instanceof si||e instanceof oi||e instanceof Fr||e instanceof Me||e instanceof po}function rl(e,t=[]){return e instanceof Yn||e instanceof tn||e instanceof Fr?!0:e instanceof Br?pf(e.definition,r=>rl(r,t)):e instanceof Kn&&Nn(t,e)?!1:e instanceof ii?(e instanceof Kn&&t.push(e),Lr(e.definition,r=>rl(r,t))):!1}function PL(e){return e instanceof Br}function ai(e){if(e instanceof Kn)return"SUBRULE";if(e instanceof Yn)return"OPTION";if(e instanceof Br)return"OR";if(e instanceof si)return"AT_LEAST_ONE";if(e instanceof oi)return"AT_LEAST_ONE_SEP";if(e instanceof Fr)return"MANY_SEP";if(e instanceof tn)return"MANY";if(e instanceof Me)return"CONSUME";throw Error("non exhaustive match")}class il{walk(t,n=[]){Ft(t.definition,(r,i)=>{const s=yn(t.definition,i+1);if(r instanceof Kn)this.walkProdRef(r,s,n);else if(r instanceof Me)this.walkTerminal(r,s,n);else if(r instanceof Hn)this.walkFlat(r,s,n);else if(r instanceof Yn)this.walkOption(r,s,n);else if(r instanceof si)this.walkAtLeastOne(r,s,n);else if(r instanceof oi)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Fr)this.walkManySep(r,s,n);else if(r instanceof tn)this.walkMany(r,s,n);else if(r instanceof Br)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Yn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=S_(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Yn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=S_(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Ft(t.definition,s=>{const o=new Hn({definition:[s]});this.walk(o,i)})}}function S_(e,t,n){return[new Yn({definition:[new Me({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function ma(e){if(e instanceof Kn)return ma(e.referencedRule);if(e instanceof Me)return jL(e);if(BL(e))return $L(e);if(PL(e))return DL(e);throw Error("non exhaustive match")}function $L(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=rl(s),t=t.concat(ma(s)),r=r+1,i=n.length>r;return el(t)}function DL(e){const t=Tt(e.definition,n=>ma(n));return el(ir(t))}function jL(e){return[e.terminalType]}const R_="_~IN~_";class zL extends il{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=GL(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Hn({definition:s}),a=ma(o);this.follows[i]=a}}function WL(e){const t={};return Ft(e,n=>{const r=new zL(n).startWalking();zn(t,r)}),t}function GL(e,t){return e.name+t+R_}function Bt(e){return e.charCodeAt(0)}function gf(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ga(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function mo(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function KL(){throw Error("Internal Error - Should never get here!")}function O_(e){return e.type==="Character"}const sl=[];for(let e=Bt("0");e<=Bt("9");e++)sl.push(e);const ol=[Bt("_")].concat(sl);for(let e=Bt("a");e<=Bt("z");e++)ol.push(e);for(let e=Bt("A");e<=Bt("Z");e++)ol.push(e);const N_=[Bt(" "),Bt("\f"),Bt(`
`),Bt("\r"),Bt("	"),Bt("\v"),Bt("	"),Bt("Â "),Bt("á"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("\u2028"),Bt("\u2029"),Bt("â¯"),Bt("â"),Bt("ã"),Bt("\uFEFF")],HL=/[0-9a-fA-F]/,al=/[0-9]/,YL=/[1-9]/;class VL{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ga(r,"global");break;case"i":ga(r,"ignoreCase");break;case"m":ga(r,"multiLine");break;case"u":ga(r,"unicode");break;case"y":ga(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}mo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return KL()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;mo(n);break}if(!(t===!0&&n===void 0)&&mo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),mo(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Bt(`
`),Bt("\r"),Bt("\u2028"),Bt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=sl;break;case"D":t=sl,n=!0;break;case"s":t=N_;break;case"S":t=N_,n=!0;break;case"w":t=ol;break;case"W":t=ol,n=!0;break}if(mo(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Bt("\f");break;case"n":t=Bt(`
`);break;case"r":t=Bt("\r");break;case"t":t=Bt("	");break;case"v":t=Bt("\v");break}if(mo(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Bt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Bt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Bt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,O_(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,O_(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else gf(r.value,t),t.push(Bt("-")),gf(i.value,t)}else gf(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Bt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(YL.test(t)===!1)throw Error("Expecting a positive integer");for(;al.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(al.test(t)===!1)throw Error("Expecting an integer");for(;al.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Bt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return al.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(HL.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class _f{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let cl={};const XL=new VL;function ll(e){const t=e.toString();if(cl.hasOwnProperty(t))return cl[t];{const n=XL.pattern(t);return cl[t]=n,n}}function qL(){cl={}}const I_="Complement Sets are not supported for first char optimization",ul=`Unable to use "first char" lexer optimizations:
`;function JL(e,t=!1){try{const n=ll(e);return yf(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===I_)t&&v_(`${ul}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),mf(`${ul}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function yf(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)yf(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":hl(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(I_);Ft(o.value,c=>{if(typeof c=="number")hl(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)hl(u,t,n);else{for(let u=l.from;u<=l.to&&u<ya;u++)hl(u,t,n);if(l.to>=ya){const u=l.from>=ya?l.from:ya,f=l.to,d=Yi(u),h=Yi(f);for(let m=d;m<=h;m++)t[m]=m}}}});break;case"Group":yf(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&bf(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ve(t)}function hl(e,t,n){const r=Yi(e);t[r]=r,n===!0&&ZL(e,t)}function ZL(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Yi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Yi(i.charCodeAt(0));t[s]=s}}}function C_(e,t){return fo(e.value,n=>{if(typeof n=="number")return Nn(t,n);{const r=n;return fo(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function bf(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?se(e.value)?Lr(e.value,bf):bf(e.value):!1}class QL extends _f{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Nn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?C_(t,this.targetCharCodes)===void 0&&(this.found=!0):C_(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function kf(e,t){if(t instanceof RegExp){const n=ll(t),r=new QL(e);return r.visit(n),r.found}else return fo(t,n=>Nn(e,n.charCodeAt(0)))!==void 0}const ws="PATTERN",_a="defaultMode",fl="modes";let L_=typeof new RegExp("(?:)").sticky=="boolean";function t6(e,t){t=df(t,{useSticky:L_,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{x6()});let r;n("Reject Lexer.NA",()=>{r=tl(e,v=>v[ws]===ln.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Tt(r,v=>{const T=v[ws];if(Ai(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!Nn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:t.useSticky?U_(T):M_(T)}else{if(xi(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),L=new RegExp(A);return t.useSticky?U_(L):M_(L)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Tt(r,v=>v.tokenTypeIdx),a=Tt(r,v=>{const T=v.GROUP;if(T!==ln.SKIPPED){if(Wn(T))return T;if(Si(T))return!1;throw Error("non exhaustive match")}}),c=Tt(r,v=>{const T=v.LONGER_ALT;if(T)return se(T)?Tt(T,L=>w_(r,L)):[w_(r,T)]}),l=Tt(r,v=>v.PUSH_MODE),u=Tt(r,v=>Ut(v,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const v=P_(t.lineTerminatorCharacters);f=Tt(r,T=>!1),t.positionTracking!=="onlyOffset"&&(f=Tt(r,T=>Ut(T,"LINE_BREAKS")?!!T.LINE_BREAKS:B_(T,v)===!1&&kf(v,T.PATTERN)))});let d,h,m,p;n("Misc Mapping #2",()=>{d=Tt(r,F_),h=Tt(s,k6),m=Gn(r,(v,T)=>{const A=T.GROUP;return Wn(A)&&A!==ln.SKIPPED&&(v[A]=[]),v},{}),p=Tt(s,(v,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let k=!0,b=[];return t.safeMode||n("First Char Optimization",()=>{b=Gn(r,(v,T,A)=>{if(typeof T.PATTERN=="string"){const L=T.PATTERN.charCodeAt(0),S=Yi(L);Ef(v,S,p[A])}else if(se(T.START_CHARS_HINT)){let L;Ft(T.START_CHARS_HINT,S=>{const I=typeof S=="string"?S.charCodeAt(0):S,$=Yi(I);L!==$&&(L=$,Ef(v,$,p[A]))})}else if(Ai(T.PATTERN))if(T.PATTERN.unicode)k=!1,t.ensureOptimizations&&mf(`${ul}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const L=JL(T.PATTERN,t.ensureOptimizations);ye(L)&&(k=!1),Ft(L,S=>{Ef(v,S,p[A])})}else t.ensureOptimizations&&mf(`${ul}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),k=!1;return v},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:b,hasCustom:i,canBeOptimized:k}}function e6(e,t){let n=[];const r=r6(e);n=n.concat(r.errors);const i=i6(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(n6(s)),n=n.concat(f6(s)),n=n.concat(d6(s,t)),n=n.concat(p6(s)),n}function n6(e){let t=[];const n=Er(e,r=>Ai(r[ws]));return t=t.concat(o6(n)),t=t.concat(l6(n)),t=t.concat(u6(n)),t=t.concat(h6(n)),t=t.concat(a6(n)),t}function r6(e){const t=Er(e,i=>!Ut(i,ws)),n=Tt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Be.MISSING_PATTERN,tokenTypes:[i]})),r=Qc(e,t);return{errors:n,valid:r}}function i6(e){const t=Er(e,i=>{const s=i[ws];return!Ai(s)&&!xi(s)&&!Ut(s,"exec")&&!Wn(s)}),n=Tt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Be.INVALID_PATTERN,tokenTypes:[i]})),r=Qc(e,t);return{errors:n,valid:r}}const s6=/[^\\][$]/;function o6(e){class t extends _f{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Er(e,i=>{const s=i.PATTERN;try{const o=ll(s),a=new t;return a.visit(o),a.found}catch{return s6.test(s.source)}});return Tt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function a6(e){const t=Er(e,r=>r.PATTERN.test(""));return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Be.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const c6=/[^\\[][\^]|^\^/;function l6(e){class t extends _f{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Er(e,i=>{const s=i.PATTERN;try{const o=ll(s),a=new t;return a.visit(o),a.found}catch{return c6.test(s.source)}});return Tt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function u6(e){const t=Er(e,r=>{const i=r[ws];return i instanceof RegExp&&(i.multiline||i.global)});return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Be.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function h6(e){const t=[];let n=Tt(e,s=>Gn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Nn(t,a)&&a.PATTERN!==ln.NA&&(t.push(a),o.push(a)),o),[]));n=da(n);const r=Er(n,s=>s.length>1);return Tt(r,s=>{const o=Tt(s,c=>c.name);return{message:`The same RegExp pattern ->${Mr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Be.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function f6(e){const t=Er(e,r=>{if(!Ut(r,"GROUP"))return!1;const i=r.GROUP;return i!==ln.SKIPPED&&i!==ln.NA&&!Wn(i)});return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Be.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function d6(e,t){const n=Er(e,i=>i.PUSH_MODE!==void 0&&!Nn(t,i.PUSH_MODE));return Tt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Be.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function p6(e){const t=[],n=Gn(e,(r,i,s)=>{const o=i.PATTERN;return o===ln.NA||(Wn(o)?r.push({str:o,idx:s,tokenType:i}):Ai(o)&&g6(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ft(e,(r,i)=>{Ft(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&m6(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Be.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function m6(e,t){if(Ai(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(xi(t))return t(e,0,[],{});if(Ut(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function g6(e){return fo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function M_(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function U_(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function _6(e,t,n){const r=[];return Ut(e,_a)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+_a+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ut(e,fl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+fl+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ut(e,fl)&&Ut(e,_a)&&!Ut(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${_a}: <${e.defaultMode}>which does not exist
`,type:Be.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ut(e,fl)&&Ft(e.modes,(i,s)=>{Ft(i,(o,a)=>{if(Si(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Be.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ut(o,"LONGER_ALT")){const c=se(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ft(c,l=>{!Si(l)&&!Nn(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Be.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function y6(e,t,n){const r=[];let i=!1;const s=da(ir(Ve(e.modes))),o=tl(s,c=>c[ws]===ln.NA),a=P_(n);return t&&Ft(o,c=>{const l=B_(c,a);if(l!==!1){const f={message:w6(c,l),type:l.issue,tokenType:c};r.push(f)}else Ut(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):kf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Be.NO_LINE_BREAKS_FLAGS}),r}function b6(e){const t={},n=br(e);return Ft(n,r=>{const i=e[r];if(se(i))t[r]=[];else throw Error("non exhaustive match")}),t}function F_(e){const t=e.PATTERN;if(Ai(t))return!1;if(xi(t))return!0;if(Ut(t,"exec"))return!0;if(Wn(t))return!1;throw Error("non exhaustive match")}function k6(e){return Wn(e)&&e.length===1?e.charCodeAt(0):!1}const E6={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function B_(e,t){if(Ut(e,"LINE_BREAKS"))return!1;if(Ai(e.PATTERN)){try{kf(t,e.PATTERN)}catch(n){return{issue:Be.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Wn(e.PATTERN))return!1;if(F_(e))return{issue:Be.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function w6(e,t){if(t.issue===Be.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Be.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function P_(e){return Tt(e,n=>Wn(n)?n.charCodeAt(0):n)}function Ef(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const ya=256;let dl=[];function Yi(e){return e<ya?e:dl[e]}function x6(){if(ye(dl)){dl=new Array(65536);for(let e=0;e<65536;e++)dl[e]=e>255?255+~~(e/255):e}}function ba(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function pl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let $_=1;const D_={};function ka(e){const t=v6(e);T6(t),S6(t),A6(t),Ft(t,n=>{n.isParent=n.categoryMatches.length>0})}function v6(e){let t=_n(e),n=e,r=!0;for(;r;){n=da(ir(Tt(n,s=>s.CATEGORIES)));const i=Qc(n,t);t=t.concat(i),ye(i)?r=!1:n=i}return t}function T6(e){Ft(e,t=>{z_(t)||(D_[$_]=t,t.tokenTypeIdx=$_++),W_(t)&&!se(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),W_(t)||(t.CATEGORIES=[]),R6(t)||(t.categoryMatches=[]),O6(t)||(t.categoryMatchesMap={})})}function A6(e){Ft(e,t=>{t.categoryMatches=[],Ft(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(D_[r].tokenTypeIdx)})})}function S6(e){Ft(e,t=>{j_([],t)})}function j_(e,t){Ft(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ft(t.CATEGORIES,n=>{const r=e.concat(t);Nn(r,n)||j_(r,n)})}function z_(e){return Ut(e,"tokenTypeIdx")}function W_(e){return Ut(e,"CATEGORIES")}function R6(e){return Ut(e,"categoryMatches")}function O6(e){return Ut(e,"categoryMatchesMap")}function N6(e){return Ut(e,"tokenTypeIdx")}const I6={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Be;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Be||(Be={}));const Ea={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:I6,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Ea);let ln=class{constructor(t,n=Ea){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=T_(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=zn({},Ea,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Ea.lineTerminatorsPattern)this.config.lineTerminatorsPattern=E6;else if(this.config.lineTerminatorCharacters===Ea.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),se(t)?i={modes:{defaultMode:_n(t)},defaultMode:_a}:(s=!1,i=_n(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(_6(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(y6(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ft(i.modes,(a,c)=>{i.modes[c]=tl(a,l=>Si(l))});const o=br(i.modes);if(Ft(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(e6(a,o))}),ye(this.lexerDefinitionErrors)){ka(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=t6(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=zn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ye(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Tt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ft(this.lexerDefinitionWarning,a=>{v_(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(L_?(this.chopInput=co,this.match=this.matchWithTest):(this.updateLastIndex=Qe,this.match=this.matchWithExec),s&&(this.handleModes=Qe),this.trackStartLines===!1&&(this.computeNewColumn=co),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Qe),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Gn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ye(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{qL()}),this.TRACE_INIT("toFastProperties",()=>{A_(this)})})}tokenize(t,n=this.defaultMode){if(!ye(this.lexerDefinitionErrors)){const i=Tt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,f,d,h,m,p,k,b;const v=t,T=v.length;let A=0,L=0;const S=this.hasCustom?0:Math.floor(t.length/10),I=new Array(S),$=[];let N=this.trackStartLines?1:void 0,z=this.trackStartLines?1:void 0;const J=b6(this.emptyGroups),M=this.trackStartLines,O=this.config.lineTerminatorsPattern;let w=0,C=[],P=[];const F=[],ot=[];Object.freeze(ot);let tt;function it(){return C}function W(Pt){const Kt=Yi(Pt),jt=P[Kt];return jt===void 0?ot:jt}const D=Pt=>{if(F.length===1&&Pt.tokenType.PUSH_MODE===void 0){const Kt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Pt);$.push({offset:Pt.startOffset,line:Pt.startLine,column:Pt.startColumn,length:Pt.image.length,message:Kt})}else{F.pop();const Kt=ho(F);C=this.patternIdxToConfig[Kt],P=this.charCodeToPatternIdxToConfig[Kt],w=C.length;const jt=this.canModeBeOptimized[Kt]&&this.config.safeMode===!1;P&&jt?tt=W:tt=it}};function yt(Pt){F.push(Pt),P=this.charCodeToPatternIdxToConfig[Pt],C=this.patternIdxToConfig[Pt],w=C.length,w=C.length;const Kt=this.canModeBeOptimized[Pt]&&this.config.safeMode===!1;P&&Kt?tt=W:tt=it}yt.call(this,n);let X;const at=this.config.recoveryEnabled;for(;A<T;){c=null;const Pt=v.charCodeAt(A),Kt=tt(Pt),jt=Kt.length;for(r=0;r<jt;r++){X=Kt[r];const $t=X.pattern;l=null;const le=X.short;if(le!==!1?Pt===le&&(c=$t):X.isCustom===!0?(b=$t.exec(v,A,I,J),b!==null?(c=b[0],b.payload!==void 0&&(l=b.payload)):c=null):(this.updateLastIndex($t,A),c=this.match($t,t,A)),c!==null){if(a=X.longerAlt,a!==void 0){const Jt=a.length;for(s=0;s<Jt;s++){const Ne=C[a[s]],$e=Ne.pattern;if(u=null,Ne.isCustom===!0?(b=$e.exec(v,A,I,J),b!==null?(o=b[0],b.payload!==void 0&&(u=b.payload)):o=null):(this.updateLastIndex($e,A),o=this.match($e,t,A)),o&&o.length>c.length){c=o,l=u,X=Ne;break}}}break}}if(c!==null){if(f=c.length,d=X.group,d!==void 0&&(h=X.tokenTypeIdx,m=this.createTokenInstance(c,A,h,X.tokenType,N,z,f),this.handlePayload(m,l),d===!1?L=this.addToken(I,L,m):J[d].push(m)),t=this.chopInput(t,f),A=A+f,z=this.computeNewColumn(z,f),M===!0&&X.canLineTerminator===!0){let $t=0,le,Jt;O.lastIndex=0;do le=O.test(c),le===!0&&(Jt=O.lastIndex-1,$t++);while(le===!0);$t!==0&&(N=N+$t,z=f-Jt,this.updateTokenEndLineColumnLocation(m,d,Jt,$t,N,z,f))}this.handleModes(X,D,yt,m)}else{const $t=A,le=N,Jt=z;let Ne=at===!1;for(;Ne===!1&&A<T;)for(t=this.chopInput(t,1),A++,i=0;i<w;i++){const $e=C[i],x=$e.pattern,lt=$e.short;if(lt!==!1?v.charCodeAt(A)===lt&&(Ne=!0):$e.isCustom===!0?Ne=x.exec(v,A,I,J)!==null:(this.updateLastIndex(x,A),Ne=x.exec(t)!==null),Ne===!0)break}if(p=A-$t,z=this.computeNewColumn(z,p),k=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,$t,p,le,Jt),$.push({offset:$t,line:le,column:Jt,length:p,message:k}),at===!1)break}}return this.hasCustom||(I.length=L),{tokens:I,groups:J,errors:$}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};ln.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",ln.NA=/NOT_APPLICABLE/;function wa(e){return G_(e)?e.LABEL:e.name}function G_(e){return Wn(e.LABEL)&&e.LABEL!==""}const C6="parent",K_="categories",H_="label",Y_="group",V_="push_mode",X_="pop_mode",q_="longer_alt",J_="line_breaks",Z_="start_chars_hint";function sr(e){return L6(e)}function L6(e){const t=e.pattern,n={};if(n.name=e.name,Si(t)||(n.PATTERN=t),Ut(e,C6))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ut(e,K_)&&(n.CATEGORIES=e[K_]),ka([n]),Ut(e,H_)&&(n.LABEL=e[H_]),Ut(e,Y_)&&(n.GROUP=e[Y_]),Ut(e,X_)&&(n.POP_MODE=e[X_]),Ut(e,V_)&&(n.PUSH_MODE=e[V_]),Ut(e,q_)&&(n.LONGER_ALT=e[q_]),Ut(e,J_)&&(n.LINE_BREAKS=e[J_]),Ut(e,Z_)&&(n.START_CHARS_HINT=e[Z_]),n}const xs=sr({name:"EOF",pattern:ln.NA});ka([xs]);function ml(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function M6(e,t){return ba(e,t)}const Q_={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${G_(e)?`--> ${wa(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Mr(t).image+"'";if(r)return s+r+a;{const c=Gn(e,(d,h)=>d.concat(h),[]),l=Tt(c,d=>`[${Tt(d,h=>wa(h)).join(", ")}]`),f=`one of these possible Token sequences:
${Tt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Mr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Tt(e,l=>`[${Tt(l,u=>wa(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Q_);const U6={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},vs={buildDuplicateFoundError(e,t){function n(u){return u instanceof Me?u.terminalType.name:u instanceof Kn?u.nonTerminalName:""}const r=e.name,i=Mr(t),s=i.idx,o=ai(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Tt(e.prefixPath,i=>wa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Tt(e.prefixPath,i=>wa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=ai(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=Tt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof po?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function F6(e,t){const n=new B6(e,t);return n.resolveRefs(),n.errors}class B6 extends Es{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ft(Ve(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:In.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class P6 extends il{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=_n(this.path.ruleStack).reverse(),this.occurrenceStack=_n(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){ye(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class $6 extends P6{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Hn({definition:i});this.possibleTokTypes=ma(s),this.found=!0}}}class gl extends il{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class D6 extends gl{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class ty extends gl{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class j6 extends gl{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class ey extends gl{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function wf(e,t,n=[]){n=_n(n);let r=[],i=0;function s(a){return a.concat(yn(e,i+1))}function o(a){const c=wf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Hn)return o(a.definition);if(a instanceof Kn)return o(a.definition);if(a instanceof Yn)r=o(a.definition);else if(a instanceof si){const c=a.definition.concat([new tn({definition:a.definition})]);return o(c)}else if(a instanceof oi){const c=[new Hn({definition:a.definition}),new tn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Fr){const c=a.definition.concat([new tn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof tn){const c=a.definition.concat([new tn({definition:a.definition})]);r=o(c)}else{if(a instanceof Br)return Ft(a.definition,c=>{ye(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Me)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:yn(e,i)}),r}function ny(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ye(f);){const d=f.pop();if(d===o){a&&ho(f).idx<=l&&f.pop();continue}const h=d.def,m=d.idx,p=d.ruleStack,k=d.occurrenceStack;if(ye(h))continue;const b=h[0];if(b===i){const v={idx:m,def:yn(h),ruleStack:pa(p),occurrenceStack:pa(k)};f.push(v)}else if(b instanceof Me)if(m<c-1){const v=m+1,T=t[v];if(n(T,b.terminalType)){const A={idx:v,def:yn(h),ruleStack:p,occurrenceStack:k};f.push(A)}}else if(m===c-1)u.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:p,occurrenceStack:k}),a=!0;else throw Error("non exhaustive match");else if(b instanceof Kn){const v=_n(p);v.push(b.nonTerminalName);const T=_n(k);T.push(b.idx);const A={idx:m,def:b.definition.concat(s,yn(h)),ruleStack:v,occurrenceStack:T};f.push(A)}else if(b instanceof Yn){const v={idx:m,def:yn(h),ruleStack:p,occurrenceStack:k};f.push(v),f.push(o);const T={idx:m,def:b.definition.concat(yn(h)),ruleStack:p,occurrenceStack:k};f.push(T)}else if(b instanceof si){const v=new tn({definition:b.definition,idx:b.idx}),T=b.definition.concat([v],yn(h)),A={idx:m,def:T,ruleStack:p,occurrenceStack:k};f.push(A)}else if(b instanceof oi){const v=new Me({terminalType:b.separator}),T=new tn({definition:[v].concat(b.definition),idx:b.idx}),A=b.definition.concat([T],yn(h)),L={idx:m,def:A,ruleStack:p,occurrenceStack:k};f.push(L)}else if(b instanceof Fr){const v={idx:m,def:yn(h),ruleStack:p,occurrenceStack:k};f.push(v),f.push(o);const T=new Me({terminalType:b.separator}),A=new tn({definition:[T].concat(b.definition),idx:b.idx}),L=b.definition.concat([A],yn(h)),S={idx:m,def:L,ruleStack:p,occurrenceStack:k};f.push(S)}else if(b instanceof tn){const v={idx:m,def:yn(h),ruleStack:p,occurrenceStack:k};f.push(v),f.push(o);const T=new tn({definition:b.definition,idx:b.idx}),A=b.definition.concat([T],yn(h)),L={idx:m,def:A,ruleStack:p,occurrenceStack:k};f.push(L)}else if(b instanceof Br)for(let v=b.definition.length-1;v>=0;v--){const T=b.definition[v],A={idx:m,def:T.definition.concat(yn(h)),ruleStack:p,occurrenceStack:k};f.push(A),f.push(o)}else if(b instanceof Hn)f.push({idx:m,def:b.definition.concat(yn(h)),ruleStack:p,occurrenceStack:k});else if(b instanceof po)f.push(z6(b,m,p,k));else throw Error("non exhaustive match")}return u}function z6(e,t,n,r){const i=_n(n);i.push(e.name);const s=_n(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Pe;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Pe||(Pe={}));function ry(e){if(e instanceof Yn||e==="Option")return Pe.OPTION;if(e instanceof tn||e==="Repetition")return Pe.REPETITION;if(e instanceof si||e==="RepetitionMandatory")return Pe.REPETITION_MANDATORY;if(e instanceof oi||e==="RepetitionMandatoryWithSeparator")return Pe.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Fr||e==="RepetitionWithSeparator")return Pe.REPETITION_WITH_SEPARATOR;if(e instanceof Br||e==="Alternation")return Pe.ALTERNATION;throw Error("non exhaustive match")}function W6(e,t,n,r,i,s){const o=vf(e,t,n),a=ay(o)?pl:ba;return s(o,r,a,i)}function G6(e,t,n,r,i,s){const o=Tf(e,t,i,n),a=ay(o)?pl:ba;return s(o[0],a,r)}function K6(e,t,n,r){const i=e.length,s=Lr(e,o=>Lr(o,a=>a.length===1));if(t)return function(o){const a=Tt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],m=h.length;for(let p=0;p<m;p++){const k=this.LA(p+1);if(n(k,h[p])===!1)continue t}return c}}};if(s&&!r){const o=Tt(e,c=>ir(c)),a=Gn(o,(c,l,u)=>(Ft(l,f=>{Ut(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Ft(f.categoryMatches,d=>{Ut(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function H6(e,t,n){const r=Lr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=ir(e);if(s.length===1&&ye(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Gn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ft(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class Y6 extends il{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Pe.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Pe.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class iy extends Es{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Pe.OPTION)}visitRepetition(t){this.checkIsTarget(t,Pe.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Pe.ALTERNATION)}}function sy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function xf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function V6(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function oy(e,t){const n=Tt(e,o=>wf([o],1)),r=sy(n.length),i=Tt(n,o=>{const a={};return Ft(o,c=>{const l=xf(c.partialPath);Ft(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=sy(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=xf(f);if(V6(i,h,c)||ye(d)||f.length===t){const p=r[c];if(Af(p,f)===!1){p.push(f);for(let k=0;k<h.length;k++){const b=h[k];i[c][b]=!0}}}else{const p=wf(d,o+1,f);s[c]=s[c].concat(p),Ft(p,k=>{const b=xf(k.partialPath);Ft(b,v=>{i[c][v]=!0})})}}}}return r}function vf(e,t,n,r){const i=new iy(e,Pe.ALTERNATION,r);return t.accept(i),oy(i.result,n)}function Tf(e,t,n,r){const i=new iy(e,n);t.accept(i);const s=i.result,a=new Y6(t,e,n).startWalking(),c=new Hn({definition:s}),l=new Hn({definition:a});return oy([c,l],r)}function Af(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function X6(e,t){return e.length<t.length&&Lr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function ay(e){return Lr(e,t=>Lr(t,n=>Lr(n,r=>ye(r.categoryMatches))))}function q6(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Tt(t,n=>Object.assign({type:In.CUSTOM_LOOKAHEAD_VALIDATION},n))}function J6(e,t,n,r){const i=wr(e,c=>Z6(c,n)),s=uM(e,t,n),o=wr(e,c=>oM(c,n)),a=wr(e,c=>eM(c,e,r,n));return i.concat(s,o,a)}function Z6(e,t){const n=new tM;e.accept(n);const r=n.allProductions,i=E_(r,Q6),s=Ur(i,a=>a.length>1);return Tt(Ve(s),a=>{const c=Mr(a),l=t.buildDuplicateFoundError(e,a),u=ai(c),f={message:l,type:In.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=cy(c);return d&&(f.parameter=d),f})}function Q6(e){return`${ai(e)}_#_${e.idx}_#_${cy(e)}`}function cy(e){return e instanceof Me?e.terminalType.name:e instanceof Kn?e.nonTerminalName:""}class tM extends Es{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function eM(e,t,n,r){const i=[];if(Gn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:In.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function nM(e,t,n){const r=[];let i;return Nn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:In.INVALID_RULE_OVERRIDE,ruleName:e})),r}function ly(e,t,n,r=[]){const i=[],s=_l(t.definition);if(ye(s))return[];{const o=e.name;Nn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:In.LEFT_RECURSION,ruleName:o});const c=Qc(s,r.concat([e])),l=wr(c,u=>{const f=_n(r);return f.push(u),ly(e,u,n,f)});return i.concat(l)}}function _l(e){let t=[];if(ye(e))return t;const n=Mr(e);if(n instanceof Kn)t.push(n.referencedRule);else if(n instanceof Hn||n instanceof Yn||n instanceof si||n instanceof oi||n instanceof Fr||n instanceof tn)t=t.concat(_l(n.definition));else if(n instanceof Br)t=ir(Tt(n.definition,s=>_l(s.definition)));else if(!(n instanceof Me))throw Error("non exhaustive match");const r=rl(n),i=e.length>1;if(r&&i){const s=yn(e);return t.concat(_l(s))}else return t}class Sf extends Es{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function rM(e,t){const n=new Sf;e.accept(n);const r=n.alternations;return wr(r,s=>{const o=pa(s.definition);return wr(o,(a,c)=>{const l=ny([a],[],ba,1);return ye(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:In.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function iM(e,t,n){const r=new Sf;e.accept(r);let i=r.alternations;return i=tl(i,o=>o.ignoreAmbiguities===!0),wr(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=vf(a,e,c,o),u=cM(l,o,e,n),f=lM(l,o,e,n);return u.concat(f)})}class sM extends Es{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function oM(e,t){const n=new Sf;e.accept(n);const r=n.alternations;return wr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:In.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function aM(e,t,n){const r=[];return Ft(e,i=>{const s=new sM;i.accept(s);const o=s.allProductions;Ft(o,a=>{const c=ry(a),l=a.maxLookahead||t,u=a.idx,d=Tf(u,i,c,l)[0];if(ye(ir(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:In.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function cM(e,t,n,r){const i=[],s=Gn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Ft(c,u=>{const f=[l];Ft(e,(d,h)=>{l!==h&&Af(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!Af(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return Tt(s,a=>{const c=Tt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:In.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function lM(e,t,n,r){const i=Gn(e,(o,a,c)=>{const l=Tt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return da(wr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Er(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&X6(d.path,l));return Tt(u,d=>{const h=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:In.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:h}})}))}function uM(e,t,n){const r=[],i=Tt(t,s=>s.name);return Ft(e,s=>{const o=s.name;if(Nn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:In.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function hM(e){const t=df(e,{errMsgProvider:U6}),n={};return Ft(e.rules,r=>{n[r.name]=r}),F6(n,t.errMsgProvider)}function fM(e){return e=df(e,{errMsgProvider:vs}),J6(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const uy="MismatchedTokenException",hy="NoViableAltException",fy="EarlyExitException",dy="NotAllInputParsedException",py=[uy,hy,fy,dy];Object.freeze(py);function yl(e){return Nn(py,e.name)}class bl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class my extends bl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=uy}}class dM extends bl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=hy}}class pM extends bl{constructor(t,n){super(t,n),this.name=dy}}class mM extends bl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=fy}}const Rf={},gy="InRuleRecoveryException";class gM extends Error{constructor(t){super(t),this.name=gy}}class _M{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ut(t,"recoveryEnabled")?t.recoveryEnabled:Ri.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=yM)}getTokenToInsert(t){const n=ml(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new my(h,l,this.LA(0));m.resyncedTokens=pa(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new gM("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||ye(n))return!1;const r=this.LA(1);return fo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Nn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=fo(t,s=>M6(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Rf;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Tt(t,(r,i)=>i===0?Rf:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Tt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return ir(t)}getFollowSetFromFollowKey(t){if(t===Rf)return[xs];const n=t.ruleName+t.idxInCallingRule+R_+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,xs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return pa(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=_n(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Tt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function yM(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=xs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const bM=4,Vi=8,_y=1<<Vi,yy=2<<Vi,Of=3<<Vi,Nf=4<<Vi,If=5<<Vi,kl=6<<Vi;function Cf(e,t,n){return n|t|e}class kM{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ri.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(ye(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return wr(t,n=>ly(n,n,vs))}validateEmptyOrAlternatives(t){return wr(t,n=>rM(n,vs))}validateAmbiguousAlternationAlternatives(t,n){return wr(t,r=>iM(r,n,vs))}validateSomeNonEmptyLookaheadPath(t,n){return aM(t,n,vs)}buildLookaheadForAlternation(t){return W6(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,K6)}buildLookaheadForOptional(t){return G6(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,ry(t.prodType),H6)}}class EM{initLooksAhead(t){this.dynamicTokensEnabled=Ut(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ri.dynamicTokensEnabled,this.maxLookahead=Ut(t,"maxLookahead")?t.maxLookahead:Ri.maxLookahead,this.lookaheadStrategy=Ut(t,"lookaheadStrategy")?t.lookaheadStrategy:new kM({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Ft(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=xM(n);Ft(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${ai(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Cf(this.fullRuleNameToShort[n.name],_y,l.idx);this.setLaFuncCache(d,f)})}),Ft(i,l=>{this.computeLookaheadFunc(n,l.idx,Of,"Repetition",l.maxLookahead,ai(l))}),Ft(s,l=>{this.computeLookaheadFunc(n,l.idx,yy,"Option",l.maxLookahead,ai(l))}),Ft(o,l=>{this.computeLookaheadFunc(n,l.idx,Nf,"RepetitionMandatory",l.maxLookahead,ai(l))}),Ft(a,l=>{this.computeLookaheadFunc(n,l.idx,kl,"RepetitionMandatoryWithSeparator",l.maxLookahead,ai(l))}),Ft(c,l=>{this.computeLookaheadFunc(n,l.idx,If,"RepetitionWithSeparator",l.maxLookahead,ai(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Cf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return Cf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class wM extends Es{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const El=new wM;function xM(e){El.reset(),e.accept(El);const t=El.dslMethods;return El.reset(),t}function by(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function ky(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function vM(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function TM(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const AM="name";function Ey(e,t){Object.defineProperty(e,AM,{enumerable:!1,configurable:!0,writable:!1,value:t})}function SM(e,t){const n=br(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function RM(e,t){const n=function(){};Ey(n,e+"BaseSemantics");const r={visit:function(i,s){if(se(i)&&(i=i[0]),!Si(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=NM(this,t);if(!ye(i)){const s=Tt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function OM(e,t,n){const r=function(){};Ey(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ft(t,s=>{i[s]=SM}),r.prototype=i,r.prototype.constructor=r,r}var Lf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Lf||(Lf={}));function NM(e,t){return IM(e,t)}function IM(e,t){const n=Er(t,i=>xi(e[i])===!1),r=Tt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Lf.MISSING_METHOD,methodName:i}));return da(r)}class CM{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Ut(t,"nodeLocationTracking")?t.nodeLocationTracking:Ri.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Qe,this.cstFinallyStateUpdate=Qe,this.cstPostTerminal=Qe,this.cstPostNonTerminal=Qe,this.cstPostRule=Qe;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=ky,this.setNodeLocationFromNode=ky,this.cstPostRule=Qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=by,this.setNodeLocationFromNode=by,this.cstPostRule=Qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=Qe,this.setInitialNodeLocation=Qe;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];vM(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];TM(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Si(this.baseCstVisitorConstructor)){const t=RM(this.className,br(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Si(this.baseCstVisitorWithDefaultsConstructor)){const t=OM(this.className,br(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class LM{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):vl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?vl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class MM{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=Tl){if(Nn(this.definedRulesNames,t)){const o={message:vs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:In.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=Tl){const i=nM(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(yl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return FL(Ve(this.gastProductionsCache))}}class UM{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=pl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ut(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(se(t)){if(ye(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(se(t))this.tokensMap=Gn(t,(s,o)=>(s[o.name]=o,s),{});else if(Ut(t,"modes")&&Lr(ir(Ve(t.modes)),N6)){const s=ir(Ve(t.modes)),o=el(s);this.tokensMap=Gn(o,(a,c)=>(a[c.name]=c,a),{})}else if(yr(t))this.tokensMap=_n(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=xs;const r=Ut(t,"modes")?ir(Ve(t.modes)):Ve(t),i=Lr(r,s=>ye(s.categoryMatches));this.tokenMatcher=i?pl:ba,ka(Ve(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ut(r,"resyncEnabled")?r.resyncEnabled:Tl.resyncEnabled,s=Ut(r,"recoveryValueFunc")?r.recoveryValueFunc:Tl.recoveryValueFunc,o=this.ruleShortNameIdx<<bM+Vi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(yl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(yy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Nf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Nf,t,j6)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(kl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,ey],a,kl,t,ey)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Of,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Of,t,D6,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(If,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,ty],a,If,t,ty)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,kl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(_y,n),i=se(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new pM(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw yl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new my(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===gy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=_n(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),xs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class FM{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Ut(t,"errorMessageProvider")?t.errorMessageProvider:Ri.errorMessageProvider}SAVE_ERROR(t){if(yl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:_n(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return _n(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Tf(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new mM(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=vf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new dM(c,this.LA(1),a))}}class BM{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Si(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return ny([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Mr(t.ruleStack),i=this.getGAstProductions()[n];return new $6(i,t).startWalking()}}const wl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(wl);const wy=!0,xy=Math.pow(2,Vi)-1,vy=sr({name:"RECORDING_PHASE_TOKEN",pattern:ln.NA});ka([vy]);const Ty=ml(vy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Ty);const PM={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class $M{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return vl}topLevelRuleRecord(t,n){try{const r=new po({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return xa.call(this,Yn,t,n)}atLeastOneInternalRecord(t,n){xa.call(this,si,n,t)}atLeastOneSepFirstInternalRecord(t,n){xa.call(this,oi,n,t,wy)}manyInternalRecord(t,n){xa.call(this,tn,n,t)}manySepFirstInternalRecord(t,n){xa.call(this,Fr,n,t,wy)}orInternalRecord(t,n){return DM.call(this,t,n)}subruleInternalRecord(t,n,r){if(xl(n),!t||Ut(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Ay(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=ho(this.recordingProdStack),s=t.ruleName,o=new Kn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?PM:wl}consumeInternalRecord(t,n,r){if(xl(n),!z_(t)){const o=new Error(`<CONSUME${Ay(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=ho(this.recordingProdStack),s=new Me({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Ty}}function xa(e,t,n,r=!1){xl(n);const i=ho(this.recordingProdStack),s=xi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Ut(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),wl}function DM(e,t){xl(t);const n=ho(this.recordingProdStack),r=se(e)===!1,i=r===!1?e:e.DEF,s=new Br({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Ut(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=pf(i,a=>xi(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ft(i,a=>{const c=new Hn({definition:[]});s.definition.push(c),Ut(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ut(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),wl}function Ay(e){return e===0?"":`${e}`}function xl(e){if(e<0||e>xy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${xy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class jM{initPerformanceTracer(t){if(Ut(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ri.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=T_(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function zM(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const vl=ml(xs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(vl);const Ri=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Q_,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Tl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var In;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(In||(In={}));let Mf=class ew{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{A_(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ft(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=hM({rules:Ve(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ye(r)&&this.skipValidations===!1){const i=fM({rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),errMsgProvider:vs,grammarName:n}),s=q6({lookaheadStrategy:this.lookaheadStrategy,rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ye(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=WL(Ve(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ve(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ve(this.gastProductionsCache))})),!ew.DEFER_DEFINITION_ERRORS_HANDLING&&!ye(this.definitionErrors))throw t=Tt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Ut(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ut(n,"skipValidations")?n.skipValidations:Ri.skipValidations}};Mf.DEFER_DEFINITION_ERRORS_HANDLING=!1,zM(Mf,[_M,EM,CM,LM,UM,MM,FM,BM,$M,jM]);class WM extends Mf{constructor(t,n=Ri){const r=_n(n);r.outputCst=!0,super(t,r)}}function GM(e){const t=new KM,n=Ve(e);return Tt(n,r=>t.visitRule(r))}class KM extends Es{visitRule(t){const n=this.visitEach(t.definition),r=E_(n,s=>s.propertyName),i=Tt(r,(s,o)=>{const a=!pf(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Tt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:Al(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:Al(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:Al(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:Al(t)}]}visitEachAndOverrideWith(t,n){return Tt(this.visitEach(t),r=>zn({},r,n))}visitEach(t){return ir(Tt(t,n=>this.visit(n)))}}function Al(e){return e instanceof Kn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function HM(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(ir(Tt(e,r=>YM(r)))),t.includeVisitorInterface&&(n=n.concat(JM(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function YM(e){const t=VM(e),n=XM(e);return[t,n]}function VM(e){const t=Ry(e.name),n=Uf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function XM(e){return`export type ${Uf(e.name)} = {
  ${Tt(e.properties,n=>qM(n)).join(`
  `)}
};`}function qM(e){const t=QM(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function JM(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Tt(t,n=>ZM(n)).join(`
  `)}
}`}function ZM(e){const t=Uf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function QM(e){if(se(e)){const t=el(Tt(e,r=>Sy(r)));return"("+Gn(t,(r,i)=>r+" | "+i)+")"}else return Sy(e)}function Sy(e){return e.kind==="token"?"IToken":Ry(e.name)}function Ry(e){return Wg(e)+"CstNode"}function Uf(e){return Wg(e)+"CstChildren"}const tU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function eU(e,t){const n=Object.assign(Object.assign({},tU),t),r=GM(e);return HM(r,n)}const va=_m(32,126).map(e=>String.fromCharCode(e));function Ht(e){return sr({...e,name:`token_${e.name}`})}function ut(e){return Ht({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Xe})}const Ta=Ht({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),nU=Ht({name:"whitespace",pattern:/ +/,group:ln.SKIPPED}),rU=Ht({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:ln.SKIPPED}),Ff=Ht({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),go=Ht({name:"command",pattern:/#/,start_chars_hint:["#"]});let Oy=!1;function iU(e,t,n){if(!Oy)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Ta)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const Ny=Ht({name:"text",pattern:iU,line_breaks:!1,start_chars_hint:va.filter(e=>"@#/?':!".includes(e)===!1)}),Iy=Ht({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Bf=Ht({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Cy=Ht({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Ly=Ht({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Xe=Ht({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:va}),Sl=Ht({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Pf=Ht({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),My=ut("isterrain"),Uy=ut("isobject"),Fy=ut("issolid"),By=ut("iswalk"),Py=ut("isswim"),$y=ut("isbullet"),Dy=ut("iswalking"),jy=ut("iswalkable"),zy=ut("isswimming"),Wy=ut("isswimmable"),Gy=ut("black"),Ky=ut("dkblue"),Hy=ut("dkgreen"),Yy=ut("dkcyan"),Vy=ut("dkred"),Xy=ut("dkpurple"),qy=ut("dkyellow"),Jy=ut("ltgray"),Zy=ut("dkgray"),Qy=ut("blue"),tb=ut("green"),eb=ut("cyan"),nb=ut("red"),rb=ut("purple"),ib=ut("yellow"),sb=ut("white"),ob=ut("brown"),ab=ut("dkwhite"),cb=ut("ltgrey"),lb=ut("gray"),ub=ut("grey"),hb=ut("dkgrey"),fb=ut("ltblack"),db=ut("onblack"),pb=ut("ondkblue"),mb=ut("ondkgreen"),gb=ut("ondkcyan"),_b=ut("ondkred"),yb=ut("ondkpurple"),bb=ut("ondkyellow"),kb=ut("onltgray"),Eb=ut("ondkgray"),wb=ut("onblue"),xb=ut("ongreen"),vb=ut("oncyan"),Tb=ut("onred"),Ab=ut("onpurple"),Sb=ut("onyellow"),Rb=ut("onwhite"),Ob=ut("onbrown"),Nb=ut("ondkwhite"),Ib=ut("onltgrey"),Cb=ut("ongray"),Lb=ut("ongrey"),Mb=ut("ondkgrey"),Ub=ut("onltblack"),Fb=ut("onclear"),Bb=ut("idle"),Pb=ut("up"),$b=ut("down"),Db=ut("left"),jb=ut("right"),zb=ut("by"),Wb=ut("at"),Gb=ut("flow"),Kb=ut("seek"),Hb=ut("rndns"),Yb=ut("rndne"),Vb=ut("rnd"),Xb=ut("cw"),qb=ut("ccw"),Jb=ut("opp"),Zb=ut("rndp"),Qb=ut("away"),t1=ut("toward"),e1=ut("find"),n1=ut("flee"),r1=ut("to"),i1=ut("i"),s1=ut("u"),o1=ut("north"),a1=ut("n"),c1=ut("d"),l1=ut("south"),u1=ut("s"),h1=ut("l"),f1=ut("west"),d1=ut("w"),p1=ut("r"),m1=ut("east"),g1=ut("e"),_1=ut("over"),y1=ut("under"),b1=Ht({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:Xe}),k1=ut("contact"),E1=ut("blocked"),w1=ut("any"),x1=ut("count"),v1=ut("abs"),T1=ut("intceil"),A1=ut("intfloor"),S1=ut("intround"),R1=ut("clamp"),O1=ut("min"),N1=ut("max"),I1=ut("pick"),C1=ut("pickwith"),L1=ut("random"),M1=ut("randomwith"),U1=ut("run"),F1=ut("runwith"),B1=Ht({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),P1=Ht({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:Xe}),$1=Ht({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:Xe}),D1=Ht({name:"islessthan",pattern:/<|below/i,longer_alt:Xe}),j1=Ht({name:"isgreaterthan",pattern:/>|above/i,longer_alt:Xe}),z1=Ht({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:Xe}),W1=Ht({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:Xe}),$f=Ht({name:"or",pattern:/or/i,longer_alt:Xe}),Df=Ht({name:"not",pattern:/not/i,longer_alt:Xe}),jf=Ht({name:"and",pattern:/and/i,longer_alt:Xe}),zf=Ht({name:"plus",pattern:/\+/}),Wf=Ht({name:"minus",pattern:/-/}),G1=Ht({name:"power",pattern:/\*\*/}),K1=Ht({name:"multiply",pattern:/\*/}),Gf=Ht({name:"divide",pattern:/\//}),H1=Ht({name:"moddivide",pattern:/%/}),Y1=Ht({name:"floordivide",pattern:/%%/}),V1=Ht({name:"query",pattern:/\?/}),X1=Ht({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),q1=Ht({name:"rparen",pattern:/\)/,pop_mode:!0}),J1=Ht({name:"command_play",pattern:/(play|bgplay) .*/i,start_chars_hint:va,longer_alt:Xe}),Z1=Ht({name:"command_toast",pattern:/toast .*/i,start_chars_hint:va,longer_alt:Xe}),Q1=Ht({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:va,longer_alt:Xe}),Kf=Ht({name:"if",pattern:/if|try|take|give/i,longer_alt:Xe}),Rl=ut("do"),Hf=ut("done"),Yf=ut("else"),tk=ut("while"),ek=ut("repeat"),nk=ut("waitfor"),rk=Ht({name:"foreach",pattern:/foreach|for/i,longer_alt:Xe}),ik=ut("break"),sk=ut("continue");function ok(e){return[$b,...e,Pf,My,Uy,Fy,jy,Dy,By,Wy,zy,Py,$y,Gy,Ky,Hy,Yy,Vy,Xy,qy,Jy,Zy,Qy,tb,eb,nb,rb,ib,sb,ob,ab,cb,lb,ub,hb,fb,db,pb,mb,gb,_b,yb,bb,kb,Eb,wb,xb,vb,Tb,Ab,Sb,Rb,Ob,Nb,Ib,Cb,Lb,Mb,Ub,Fb,Bb,Pb,Db,jb,zb,Wb,Gb,Kb,Zb,Hb,Yb,Vb,Xb,qb,Jb,Qb,t1,e1,n1,r1,o1,l1,f1,m1,_1,y1,b1,k1,E1,w1,x1,v1,T1,A1,S1,R1,O1,N1,C1,I1,M1,L1,F1,U1,B1,P1,$1,z1,D1,W1,j1,$f,Df,jf,zf,Wf,G1,K1,Gf,Y1,H1,V1,X1,q1,i1,s1,a1,c1,u1,h1,d1,p1,g1,Sl,Xe]}const ak=ok([Ny,Ff,J1,Z1,Q1,go,Iy,Bf,Cy,Ly,Ta,nU,ik,sk,Hf,Rl,Yf,rk,Kf,ek,nk,tk]),sU=new ln({defaultMode:"use_newlines",modes:{use_newlines:ak,ignore_newlines:ok([rU])}},{skipValidations:!Zr,ensureOptimizations:Zr,positionTracking:"full"});function ck(e){Oy=!0;const t=sU.tokenize(e||` 
`),[n]=(ue(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(ml(Ta,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function oU(e,t,n=!0){if(n){const[r,...i]=t;switch(Ct(r??"")){default:return{type:At.OBJECT,values:t};case"loader":return{type:At.LOADER,values:i};case"board":return{type:At.BOARD,values:i};case"object":return{type:At.OBJECT,values:i};case"terrain":return{type:At.TERRAIN,values:i};case"charset":return{type:At.CHARSET,values:i};case"palette":return{type:At.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Ct(i??""),a=[r,e,...s];switch(o){default:return{type:At.CONST,values:t};case"rn":case"range":return{type:At.RANGE,values:a};case"sl":case"select":return{type:At.SELECT,values:a};case"nm":case"number":return{type:At.NUMBER,values:a};case"tx":case"text":return{type:At.TEXT,values:a};case"hk":case"hotkey":return{type:At.HOTKEY,values:a};case"copyit":return{type:At.COPYIT,values:a};case"openit":return{type:At.OPENIT,values:a};case"zssedit":return{type:At.ZSSEDIT,values:a};case"charedit":return{type:At.CHAREDIT,values:a};case"coloredit":return{type:At.COLOREDIT,values:a}}}}function or(e){switch(e){case At.LOADER:return"loader";case At.BOARD:return"board";case At.OBJECT:return"object";case At.TERRAIN:return"terrain";case At.CHARSET:return"charset";case At.PALETTE:return"palette";case At.CONST:return"const";case At.RANGE:return"range";case At.SELECT:return"select";case At.NUMBER:return"number";case At.TEXT:return"text";case At.HOTKEY:return"hotkey";case At.COPYIT:return"copyit";case At.OPENIT:return"openit";case At.ZSSEDIT:return"zssedit";case At.CHAREDIT:return"charedit";case At.COLOREDIT:return"coloredit"}}var Vf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Vf||{});function lk(e){return ao(e,Vf,{bits:t=>Array.from(t)})}function uk(e){return ra(e,Vf,{bits:t=>new Uint8Array(t)})}function hk(e,t){return{id:De(),code:e,...t}}var Xf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Xf||{});function aU(e){return ao(e,Xf,{board:VP,object:Bc,terrain:Bc,charset:lk,palette:lk,stats:Ae})}function cU(e){return ra(e,Xf,{board:XP,object:Pc,terrain:Pc,charset:uk,palette:uk})}function Aa(e){const t={...Ts(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function lU(e){return y(e)?(e.stats=void 0,Ts(e)):{}}function qf(e){const t=ck(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Ff){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=oU(gt(c)?c:"",l,r),f=Ct(u.values.join(" "));switch(r=!1,u.type){case At.LOADER:n.type=bt.LOADER,n.name=f;break;case At.BOARD:n.type=bt.BOARD,n.name=f;break;case At.OBJECT:n.type=bt.OBJECT,n.name=f||"object";break;case At.TERRAIN:n.type=bt.TERRAIN,n.name=f;break;case At.CHARSET:n.type=bt.CHARSET,n.name=f;break;case At.PALETTE:n.type=bt.PALETTE,n.name=f;break;case At.CONST:{const[d,h]=u.values;if(gt(d)){const m=Ct(d);if(gt(h)){const p=parseFloat(h);n[m]=wt(p)?p:h}else wt(h)?n[m]=h:n[m]=1}break}case At.RANGE:case At.SELECT:case At.NUMBER:case At.TEXT:case At.HOTKEY:case At.ZSSEDIT:case At.CHAREDIT:case At.COLOREDIT:{const[d,...h]=u.values;if(gt(d)){const m=Ct(d);n[m]=[or(u.type),...h]}break}}}}return n}function Ts(e){var t;return y(e)?(y((t=e.stats)==null?void 0:t.type)||(e.stats=qf(e.code),y(e.stats.type)||(e.stats.type=bt.OBJECT)),e.stats):{}}function fk(e){switch(e){default:case bt.ERROR:return"error";case bt.LOADER:return or(At.LOADER);case bt.BOARD:return or(At.BOARD);case bt.OBJECT:return or(At.OBJECT);case bt.TERRAIN:return or(At.TERRAIN);case bt.CHARSET:return or(At.CHARSET);case bt.PALETTE:return or(At.PALETTE)}}function ci(e){return Ts(e).type??bt.ERROR}function Oi(e){return fk(ci(e))}function Ue(e){return Ts(e).name??""}function Jf(e,t){return Ts(e)[t]}const Ol=new xh;function uU(e){if(!gt(e))return;const t=Jo(e);if(y(t)&&y(Mt[t]))return Mt[t];const n=Ct(e),r=pt[n];if(y(r))return r}function Nl(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ue(s))switch(i){case"name":case"char":case"displaychar":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"color":case"bg":case"displaycolor":case"displaybg":case"lightdir":t[i]=uU(e[i])??e[i];break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=1;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Gt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Gt.ISSWIM;break;case"issolid":t.collision=Gt.ISSOLID;break;case"isbullet":t.collision=Gt.ISBULLET;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Se(e){var t;if(y(e))switch(ci(e)){default:return;case bt.ERROR:return e.code??"";case bt.LOADER:return e.code??"";case bt.BOARD:{y(e.board)||(e.board=Ql()),e.board.id=e.id;const n=Aa(e);return n.isdark&&(e.board.isdark=1),n.notdark&&(e.board.isdark=0),wt(n.startx)&&(e.board.startx=n.startx),wt(n.starty)&&(e.board.starty=n.starty),gt(n.over)&&(Ct(n.over)==="empty"?e.board.over=void 0:e.board.over=n.over,e.board.overboard=void 0),gt(n.under)&&(Ct(n.under)==="empty"?e.board.under=void 0:e.board.under=n.under,e.board.underboard=void 0),gt(n.camera)&&(Ct(n.camera)==="empty"?e.board.camera=void 0:e.board.camera=n.camera),gt(n.graphics)&&(Ct(n.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=n.graphics),wt(n.facing)&&(e.board.facing=n.facing),gt(n.facing)&&Ct(n.facing)==="empty"&&(e.board.facing=void 0),gt(n.exitnorth)&&(e.board.exitnorth=n.exitnorth),gt(n.exitsouth)&&(e.board.exitsouth=n.exitsouth),gt(n.exitwest)&&(e.board.exitwest=n.exitwest),gt(n.exiteast)&&(e.board.exiteast=n.exiteast),wt(n.timelimit)&&(e.board.timelimit=n.timelimit),n.restartonzap&&(e.board.restartonzap=1),n.norestartonzap&&(e.board.restartonzap=0),wt(n.maxplayershots)&&(e.board.maxplayershots=n.maxplayershots),e.board}case bt.OBJECT:return y(e.object)||(e.object=rg()),e.object.id=e.id,e.object.code=e.code,e.object.name=Ue(e),e.object.category=Pn.ISOBJECT,Nl(Aa(e),e.object),e.object;case bt.TERRAIN:return y(e.terrain)||(e.terrain=rg()),e.terrain.id=e.id,e.terrain.name=Ue(e),e.terrain.category=Pn.ISTERRAIN,Nl(Aa(e),e.terrain),e.terrain;case bt.PALETTE:{if(y(e.palette)||(e.palette=sg(CS)),y((t=e.palette)==null?void 0:t.bits)){const n=Aa(e),r=Zn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&gt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Ol.set(o);const c=a*Rc,l=Ol.r*63,u=Ol.g*63,f=Ol.b*63;e.palette.bits[c+0]=gn(l,0,63),e.palette.bits[c+1]=gn(u,0,63),e.palette.bits[c+2]=gn(f,0,63)}}}}return e.palette}case bt.CHARSET:return y(e.charset)||(e.charset=og(IS)),e.charset}}function Zf(e){return{id:De(),name:gw(),timestamp:0,activelist:[],pages:e,flags:{}}}var Qf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(Qf||{});function hU(e){return ao(e,Qf,{pages:t=>t.map(aU),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function fU(e){return ra(e,Qf,{pages:t=>t.map(cU)})}function dk(e){y(e)&&(e.token=`${_w()}${pr(1111,9999)}`)}function As(e,t){if(!y(e))return;const n=Ct(t);return e.pages.find(i=>i.id===t||n===Ue(i))}function en(e,t,n){if(!y(e))return;const r=Ct(n);return e.pages.find(s=>ci(s)===t&&(s.id===n||r===Ue(s)))}function td(e,t,n){let r=en(e,t,n);if(!y(r)){const i=fk(t);return r=hk(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),ed(e,r),[r,!0]}return[r,!1]}function Ss(e,t){return y(e)?e.pages.filter(n=>ci(n)===t):[]}function pk(e,t,n){if(!y(e))return[];const r=Ct(n);return e.pages.filter(s=>ci(s)===t).filter(s=>{const o=Ts(s),a=Ct(Ue(s));return s.id===n||r===a||y(o[n])})}function Sa(e){return y(e)?Tr(e.pages).sort((n,r)=>{const i=ci(n),s=ci(r);return i===s?Ue(n).localeCompare(Ue(r)):s-i}):[]}function mk(e,t){if(y(t)){const n=en(e,bt.TERRAIN,t.kind??"");if(y(n))return n;const r=en(e,bt.OBJECT,t.kind??"");if(y(r))return r}}function ed(e,t){if(!y(e)||!y(t))return!1;const n=As(e,t.id);return y(n)?!1:(e.pages.push(t),dk(e),!0)}function gk(e,t){const n=As(e,t);if(y(e)&&y(n)){const r=Ct(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Ue(i)),dk(e),n}}function nn(e,t=1,n=Mt.WHITE,r=Mt.BLACK){const i=e==null?void 0:e.kinddata;return{name:Ct((e==null?void 0:e.name)??(i==null?void 0:i.name)),char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??n,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??r,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function dU(e,t){return!!(e!=null&&e.flags[t])}function Ni(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function _k(e,t){e&&delete e.flags[t]}function yk(e,t,n){const r=Ni(e,t);return r==null?void 0:r[n]}function pU(e,t,n,r){const i=Ni(e,t);return i&&(i[n]=r),r}function Re(e){if(!y(e)||y(e.lookup)&&y(e.named))return;const t=new Array(St*Xt).fill(void 0),n={},r=Object.values(e.objects);for(let o=0;o<r.length;++o){const a=r[o];if(y(a.x)&&y(a.y)&&y(a.id)&&!y(a.removed)){a.category=Pn.ISOBJECT,t[a.x+a.y*St]=a.id,gt(a.code)&&!y(a.name)&&Nl(qf(a.code),a);const c=nn(lr(a));n[c.name]||(n[c.name]=new Set),n[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];if(y(a)){a.x=i,a.y=s,a.category=Pn.ISTERRAIN;const c=nn(lr(a));n[c.name]||(n[c.name]=new Set),n[c.name].add(o)}++i,i>=St&&(i=0,++s)}e.lookup=t,e.named=n}function Ra(e){y(e)&&(delete e.named,delete e.lookup,Re(e))}function bk(e,t,n){var i;if(!y(e)||!y(e.named)||!y(t))return;const r=Ct(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[r]||(e.named[r]=new Set),e.named[r].add((t==null?void 0:t.id)??n??"")}function mU(e,t){if(!(!y(e)||!y(e.lookup)||!y(t==null?void 0:t.id))&&!y(t.removed)){const n=t.x??0,r=t.y??0;e.lookup[n+r*St]=t.id}}function gU(e,t){var n;if(y(e)&&y(t==null?void 0:t.x)&&y(t.y)){const r=nn(t),i=zr(e,t);y((n=e.named)==null?void 0:n[r.name])&&e.named[r.name].delete(i)}}function nd(e,t){var n;if(y(e)&&y(t==null?void 0:t.id)){if(y(e.lookup)&&y(t.x)&&y(t.y)){const i=t.x+t.y*St;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const r=nn(t);y((n=e.named)==null?void 0:n[r.name])&&y(t.id)&&e.named[r.name].delete(t.id)}}function rd(e,t,n,r=!1){if(!y(e)||!y(e.lookup)||n.x<0||n.x>=St||n.y<0||n.y>=Xt)return!0;const i=n.x+n.y*St,s=Un(e,e.lookup[i]??"404");if(y(s))return!(r&&bn(s.id));const o=e.terrain[i];return y(o)?Pa(t,zt(o,"collision")):!1}function _U(e,t,n){const r=Un(e,(t==null?void 0:t.id)??""),i=(r==null?void 0:r.x)??-1,s=(r==null?void 0:r.y)??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=zt(r,"collision");return rd(e,o,n)}function id(e,t,n){var d;const r=Un(e,(t==null?void 0:t.id)??"");if(!y(e)||!y(r)||!y(r.x)||!y(r.y)||!y(e.lookup)||n.x<0||n.x>=St||n.y<0||n.y>=Xt)return{name:"edge",kind:"edge",collision:Gt.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=zr(e,r),s=zr(e,n),o=zt(r,"collision"),a=bn(r==null?void 0:r.id),c=zt(r,"collision")===Gt.ISBULLET,l=Un(e,e.lookup[s]??""),u=bn((l==null?void 0:l.id)??"");if(y(l)&&(!a||!u)){const h=zt(r,"group"),m=zt(l,"group");if((h||m)&&h!=m)return{...l};const p=!!zt(l,"item");if(a&&p)return r.x=n.x,r.y=n.y,{...l};const k=!!zt(l,"breakable");if(c&&k)return r.x=n.x,r.y=n.y,{...l};if(o===Gt.ISBULLET)return{...l};if(!!zt(l,"pushable")){const v=Ir({x:r.x,y:r.y},n),T=ze({x:l.x??0,y:l.y??0},v),A=id(e,l,T);if(y(A))return{...l}}else return{...l}}const f=e.terrain[s];if(y(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??Gt.ISWALK;if(Pa(o,h))return{...f,x:n.x,y:n.y}}r.x=n.x,r.y=n.y,y(r.removed)||(e.lookup[i]=void 0,e.lookup[s]=r.id??"")}function yU(e,t){const n=[];if(!y(e))return n;const r=Object.values(e.objects);for(let i=0;i<r.length;++i){const s=r[i];y(s.id)&&y(s.removed)&&t-s.removed>Ya*5&&(n.push(s.id),FE(e,s.id))}return n}function bU(e,t){const n=[];if(!y(e))return n;e.lookup=void 0,Re(e);const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const o=r[s];if(!y(o.id))continue;o.lx=o.x,o.ly=o.y;const a=lr(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=zt(o,"cycle");if(l>u)continue}n.push({id:o.id,type:bt.OBJECT,code:c,object:o,terrain:void 0})}}const i=yU(e,t);for(let s=0;s<i.length;++s)n.push({id:i[s],type:bt.ERROR,code:"",object:void 0,terrain:void 0});return n}function kk(e,t,n){const r=[],i=[];if(!y(e))return{objectelements:r,terrainelements:i};function s(a,c){switch(n){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=zt(a,n);return y(l)||nn(a).name===n||zt(a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&r.push(c)}for(let a=0;a<Oh;++a){const c=e.terrain[a];y(c)&&s(c,!0)&&i.push(c)}return{objectelements:r,terrainelements:i}}function Ek(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ie(t,{x:s,y:i});Ge(o)&&Tn(t,o,e.timestamp),Oe(t,{x:s,y:i})}}function kU(e,t,n){for(let r=t.y;r<=n.y;++r)for(let i=t.x;i<=n.x;++i)Oe(e,{x:i,y:r})}function wk(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ie(t,{x:s,y:i});Ge(o)&&Tn(t,o,e.timestamp),Oe(t,{x:s,y:i})}}function _o(e,t){y(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function Il(e,t,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return EU(e,t,n,"",i)}if(!y(E.book))return;const s=E.book,o=en(s,bt.BOARD,e),a=Se(o);if(!y(a))return;const c=en(s,bt.BOARD,t),l=Se(c);if(!y(l))return;Re(a),Re(l);let u=!1;if(y(a)&&y(l)){switch(i){case"all":Ek(s,l,n,r);break;case"object":wk(s,l,n,r);break;case"terrain":kU(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:d,y:f};let k,b=ie(a,p);if(Ge(b)?(k=es(a,d,f),bn(b==null?void 0:b.id)&&(b=void 0)):(k=b,b=void 0),y(k)&&(m||u&&zt(k,"group")===i)){u&&Ek(s,l,p,p);const v=jr(l,[k.kind??""],p);_o(v,k)}if(y(b)&&(h||u&&zt(b,"group")===i)){u&&wk(s,l,p,p);const v=jr(l,[b.kind??""],p);_o(v,b)}}Ra(l)}}function EU(e,t,n,r,i){if(!y(E.book))return;const s=E.book,o=en(s,bt.BOARD,e),a=Se(o);if(!y(a))return;const c=en(s,bt.BOARD,t),l=Se(c);if(y(l)&&(Re(a),Re(l),y(a)&&y(l))){const{terrainelements:u,objectelements:f}=kk(a,r,i);if(u.length===0&&f.length===0)return;const d={x:St,y:Xt};for(let h=0;h<u.length;++h){const m=u[h];wt(m.x)&&(d.x=Math.min(d.x,m.x)),wt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<f.length;++h){const m=f[h];wt(m.x)&&(d.x=Math.min(d.x,m.x)),wt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},k=ie(l,p);y(k)&&(Ge(k)&&Tn(l,k,s.timestamp),Oe(l,p));const b=jr(l,[m.kind??""],p);_o(b,m)}for(let h=0;h<f.length;++h){const m=f[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},k=jr(l,[m.kind??""],p);_o(k,m)}Ra(l)}}function Oa(e,t){const n=yk(e,t,"board"),r=Dr(bt.BOARD,n);return Se(r)}function wU(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Cl(e,t,n){if(!y(e))return;pU(e,t,"board",n);const r=hn(n);y(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function yo(e,t,n,r,i=!1){if(!y(e))return;const s=fn(t);if(!y(s))return;const o=Un(s,t);if(!Ge(o)||!(o!=null&&o.id))return;const a=hn(n);if(!y(a)||(Re(a),i===!1&&rd(a,Gt.ISWALK,r,!0)))return;delete s.objects[o.id];const c=zr(s,o);s.lookup&&(s.lookup[c]=void 0),o.x=r.x,o.y=r.y,a.objects[o.id]=o;const l=zr(a,o);a.lookup&&(a.lookup[l]=o.id),Cl(e,t,a.id)}function xU(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=yk(e,r,"board");return gt(i)?i:""});return DA(n)}function bo(e){const t=xU(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=hn(t[i]);if(y(s)&&!n.has(s.id)){if(gt(s.over))if(gt(s.overboard)){const o=hn(s.overboard);y(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=hn(s.over);y(o)&&(s.overboard=o.id)}else gt(s.overboard)&&delete s.overboard;if(r.push(s),gt(s.under))if(gt(s.underboard)){const o=hn(s.underboard);y(o)||delete s.underboard}else{const o=hn(s.under);y(o)&&(s.underboard=o.id)}else gt(s.underboard)&&delete s.underboard}}return r}const vU=_m(32,126).map(e=>String.fromCharCode(e)),TU=sr({name:"Whitespace",pattern:/ +/}),AU=sr({name:"WhitespaceSkipped",pattern:/ +/,group:ln.SKIPPED}),sd=sr({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),xk=sr({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:vU}),od=sr({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),ad=sr({name:"EscapedDollar",pattern:"$$"}),cd=sr({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),ld=sr({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),vk=sr({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function SU(e,t=""){return sr({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const Tk=Object.keys(qo).map(e=>SU(`\\$(${e})`,e)),RU=[TU,sd,...Tk,od,xk,ld,ad,vk,cd],OU=new ln(RU,{skipValidations:!Zr,ensureOptimizations:Zr}),NU=new ln([AU,sd,...Tk,od,xk,ld,ad,vk,cd],{skipValidations:!Zr,ensureOptimizations:Zr}),Ak=/\$CENTER/i;function IU(e){if(Ak.test(e))return e.replace(Ak,"")}function ud(e,t=!1){return t?NU.tokenize(e):OU.tokenize(e)}function hd(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Sk(e){e.active={...e.reset}}function Rk(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case ad:s("$");break;case ld:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case od:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case sd:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=qo[l],f=GA(Mt[u]),d=Ah(Mt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):y(f)?t.active.color=f:y(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(y(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Sk(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;LU(u,u+l.length,t.active.color,t.active.bg,t),CU(u,l,t)}}}function Ok(e,t,n){const r=ud(e);r.tokens&&(Rk(r.tokens,t),n&&Sk(t),t.changed())}function Nk(e,t,n){const r=ud(e);if(!r.tokens)return;const i=hd(t,n,Mt.WHITE,Mt.BLACK);return i.measureonly=!0,Rk(r.tokens,i),i.x>0&&++i.y,i}function CU(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function LU(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Ll(e,t,n){if(!ms(E.element))return 0;const[r,i]=st(t,0,[H.DIR,H.MAYBE_KIND]),s=i??["bullet"],o=NP(E.board,s,{x:E.element.x,y:E.element.y});if(y(o)){y(n)&&(o.arg=n),o.cycle=1,o.party=E.elementid,o.collision=Gt.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-E.element.x,o.stepy=r.destpt.y-E.element.y,o.bg=Mt.ONCLEAR;const a=lr(o),c=o.code??(a==null?void 0:a.code)??"";RE(E.book,E.board,o,c)}return e.yield(),0}function Ml(e,t,n,r){var l,u;if(!ms(E.element)||!y(E.book)||!y(E.board)||!y(E.element))return 0;Re(E.board);const[i,s]=st(t,0,[H.DIR,H.KIND]),o=ie(E.board,i.destpt);if((o==null?void 0:o.category)===Pn.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((l=E.element)==null?void 0:l.x)??0,y:((u=E.element)==null?void 0:u.y)??0},d=ze(i.destpt,Ir(f,i.destpt));id(E.board,o,d)}const[a]=s,c=lr({kind:a});if(Ge(c)||jr(E.board,s,i.destpt,n),Ge(c)){const f=zt(c,"collision");if(!rd(E.board,f,i.destpt)){const h=jr(E.board,s,i.destpt,n);y(h)&&y(r)&&(h.arg=r)}}return 0}function MU(e,t,n){if(!y(E.book)||!y(E.board))return 0;Re(E.board);const[r,i]=st(t,0,[H.DIR,H.DIR]),s=ie(E.board,r.destpt);return Ge(s),0}const UU={x:0,y:0},FU={x:St-1,y:Xt-1},BU="all",PU=Ei().command("goto",(e,t)=>{var a,c;if(!y(E.book)||!y(E.board))return 0;const[n,r]=st(t,0,[H.STRING]),[i,s]=st(t,r,[H.MAYBE_NUMBER,H.MAYBE_NUMBER]),o=hn(n);if(y(o)){Re(o);const l={x:((a=E.element)==null?void 0:a.x)??i??Math.round(St*.5),y:((c=E.element)==null?void 0:c.y)??s??Math.round(Xt*.5)},u=nn(E.element),f=zt(E.element,"color"),d=zt(E.element,"bg"),h=Sh(f,d),m=Zl(o,[u.name,h]),[p]=m.sort((k,b)=>{const v=k.y??1e4,T=b.y??1e4,A=v-T;if(A!==0)return A;const L=k.x??1e4,S=b.x??1e4;return L-S});y(p)&&wt(p.x)&&wt(p.y)&&(l.x=p.x,l.y=p.y),yo(E.book,E.elementfocus,o.id,l,!0)}return 0}).command("build",(e,t)=>{if(!y(E.book)||!y(E.board)||!y(E.element))return 0;const[n,r]=st(t,0,[H.NAME,H.MAYBE_STRING]),i=Ql();if(y(i)){if(gt(r)){const s=hn(r);y(s)&&Il(s.id,i.id,UU,FU,BU)}e.set(n,i.id)}return 0}).command("shove",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;Re(E.board);const[n,r]=st(t,0,[H.DIR,H.DIR]),i=ie(E.board,n.destpt);return Ge(i)&&ts(E.book,E.board,i,r.destpt),0}).command("duplicate",MU).command("write",(e,t)=>{var d;if(!y(E.book)||!y(E.board))return 0;Re(E.board);const[n,r,i]=st(t,0,[H.DIR,H.COLOR]),s=t.slice(i).map(Te).join(" "),{color:o,bg:a}=vm(r),c=((d=Nk(s,256,1))==null?void 0:d.measuredwidth)??1,l=hd(256,1,o??Mt.WHITE,a??Mt.BLACK);Ok(s,l,!1);const u=c-1;switch(Ir(n.startpt,n.destpt)){case pt.EAST:for(let h=0;h<c;++h)Oe(E.board,{x:n.destpt.x+h,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.WEST:for(let h=0;h<c;++h)Oe(E.board,{x:n.destpt.x+h-u,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.NORTH:for(let h=0;h<c;++h)Oe(E.board,{x:n.destpt.x,y:n.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.SOUTH:for(let h=0;h<c;++h)Oe(E.board,{x:n.destpt.x,y:n.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;Re(E.board);const[n,r]=st(t,0,[H.KIND,H.KIND]);(Ba(n)??"")==="empty"&&KP(E.board).forEach(c=>{jr(E.board,r,c)});const s=Ba(r),o=Jl(r),a=NE(r);return Zl(E.board,n).forEach(c=>{if(y(o)&&(c.color=o),y(a)&&(c.bg=a),nn(c).name!==s){const u=zt(c,"color"),f=zt(c,"bg");if(Tn(E.board,c,E.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},h=jr(E.board,r,d);y(h)&&(h.color=u,h.bg=f)}}}),0}).command("put",(e,t)=>Ml(e,t)).command("putwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Ml(e,t.slice(r),void 0,n)}).command("oneof",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return y(E.board)&&Un(E.board,n)?0:Ml(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=st(t,0,[H.ANY,H.ANY]);return y(E.board)&&Un(E.board,r)?0:Ml(e,t.slice(i),r,n)}).command("shoot",Ll).command("shootwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Ll(e,t.slice(r),n)}).command("throwstar",(e,t)=>Ll(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Ll(e,[...t.slice(r),"star"],n)}),Xi="$dkpurple",$U="$196",DU="$205",Ke="$yellow$205$205$205$196";function be(e,t,n){jw(e,t,n)}function jU(e,t,n){const r=$U.repeat(n);be(e,t,`${Xi}${r}`)}function fd(e,t,n){const r=DU.repeat(n);be(e,t,`${Xi}${r}`)}function dd(e,t,n){be(e,t,`${Xi} ${" ".repeat(n.length)} `),jU(e,t,n.length+2),be(e,t,`${Xi} $white${n} `),fd(e,t,n.length+2)}function Rs(e,t,n){be(e,t,`${Xi} ${" ".repeat(n.length)} `),be(e,t,`${Xi} $gray${n} `),fd(e,t,n.length+2)}function Os(e,t,n,r){be(e,t,`${Xi} $white${n} $blue${r}`)}function Vn(e,t,n){be(e,t,`${Xi}$blue${n}`)}function zU(e,t,n,r){be(e,t,`!${n};${r}`)}var WU=`desc;$DKGRAYname and type of codepage
`,GU=Object.freeze({__proto__:null,default:WU}),KU="desc;changes object into specified element",HU=Object.freeze({__proto__:null,default:KU}),YU="desc;like #play but for sound effects",VU=Object.freeze({__proto__:null,default:YU}),XU="",qU=Object.freeze({__proto__:null,default:XU}),JU="",ZU=Object.freeze({__proto__:null,default:JU}),QU="",t3=Object.freeze({__proto__:null,default:QU}),e3="",n3=Object.freeze({__proto__:null,default:e3}),r3="",i3=Object.freeze({__proto__:null,default:r3}),s3="",o3=Object.freeze({__proto__:null,default:s3}),a3="",c3=Object.freeze({__proto__:null,default:a3}),l3="",u3=Object.freeze({__proto__:null,default:l3}),h3="",f3=Object.freeze({__proto__:null,default:h3}),d3="",p3=Object.freeze({__proto__:null,default:d3}),m3="",g3=Object.freeze({__proto__:null,default:m3}),_3="",y3=Object.freeze({__proto__:null,default:_3}),b3="",k3=Object.freeze({__proto__:null,default:b3}),E3="",w3=Object.freeze({__proto__:null,default:E3}),x3="",v3=Object.freeze({__proto__:null,default:x3}),T3=`desc;$DKGRAYstarts a section of an if-do-done block
`,A3=Object.freeze({__proto__:null,default:T3}),S3=`desc;$DKGRAYcompletes an if-do-done block
`,R3=Object.freeze({__proto__:null,default:S3}),O3="",N3=Object.freeze({__proto__:null,default:O3}),I3="",C3=Object.freeze({__proto__:null,default:I3}),L3="",M3=Object.freeze({__proto__:null,default:L3}),U3=`desc;$DKGRAYelse logic in an if-do-done block
`,F3=Object.freeze({__proto__:null,default:U3}),B3=`desc;$DKGRAYconditional else logic in an if-do-done block
`,P3=Object.freeze({__proto__:null,default:B3}),$3="",D3=Object.freeze({__proto__:null,default:$3}),j3="",z3=Object.freeze({__proto__:null,default:j3}),W3="",G3=Object.freeze({__proto__:null,default:W3}),K3="",H3=Object.freeze({__proto__:null,default:K3}),Y3="",V3=Object.freeze({__proto__:null,default:Y3}),X3="",q3=Object.freeze({__proto__:null,default:X3}),J3="",Z3=Object.freeze({__proto__:null,default:J3}),Q3="",t8=Object.freeze({__proto__:null,default:Q3}),e8=`desc;$DKGRAYhalt until the next cycle
`,n8=Object.freeze({__proto__:null,default:e8}),r8=`desc;$DKGRAYevals condition for true or false
`,i8=Object.freeze({__proto__:null,default:r8}),s8="",o8=Object.freeze({__proto__:null,default:s8}),a8="",c8=Object.freeze({__proto__:null,default:a8}),l8="",u8=Object.freeze({__proto__:null,default:l8}),h8="",f8=Object.freeze({__proto__:null,default:h8}),d8="",p8=Object.freeze({__proto__:null,default:d8}),m8="",g8=Object.freeze({__proto__:null,default:m8}),_8="",y8=Object.freeze({__proto__:null,default:_8}),b8="",k8=Object.freeze({__proto__:null,default:b8}),E8="",w8=Object.freeze({__proto__:null,default:E8}),x8="",v8=Object.freeze({__proto__:null,default:x8}),T8="",A8=Object.freeze({__proto__:null,default:T8}),S8="",R8=Object.freeze({__proto__:null,default:S8}),O8="",N8=Object.freeze({__proto__:null,default:O8}),I8="",C8=Object.freeze({__proto__:null,default:I8}),L8="",M8=Object.freeze({__proto__:null,default:L8}),U8="",F8=Object.freeze({__proto__:null,default:U8}),B8="",P8=Object.freeze({__proto__:null,default:B8}),$8="",D8=Object.freeze({__proto__:null,default:$8}),j8="",z8=Object.freeze({__proto__:null,default:j8}),W8="",G8=Object.freeze({__proto__:null,default:W8}),K8="",H8=Object.freeze({__proto__:null,default:K8}),Y8=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,V8=Object.freeze({__proto__:null,default:Y8}),X8="",q8=Object.freeze({__proto__:null,default:X8}),J8="",Z8=Object.freeze({__proto__:null,default:J8}),Q8="",t2=Object.freeze({__proto__:null,default:Q8}),e2="",n2=Object.freeze({__proto__:null,default:e2}),r2="",i2=Object.freeze({__proto__:null,default:r2}),s2="",o2=Object.freeze({__proto__:null,default:s2}),a2="",c2=Object.freeze({__proto__:null,default:a2}),l2="",u2=Object.freeze({__proto__:null,default:l2}),h2="",f2=Object.freeze({__proto__:null,default:h2}),d2="",p2=Object.freeze({__proto__:null,default:d2}),m2="",g2=Object.freeze({__proto__:null,default:m2}),_2="",y2=Object.freeze({__proto__:null,default:_2}),b2="",k2=Object.freeze({__proto__:null,default:b2}),E2="",w2=Object.freeze({__proto__:null,default:E2}),x2="",v2=Object.freeze({__proto__:null,default:x2}),T2="",A2=Object.freeze({__proto__:null,default:T2}),S2="",R2=Object.freeze({__proto__:null,default:S2}),O2="",N2=Object.freeze({__proto__:null,default:O2}),I2="",C2=Object.freeze({__proto__:null,default:I2}),L2=`desc;$DKGRAYdesignates an inactive label or comment
`,M2=Object.freeze({__proto__:null,default:L2}),U2=`desc;$DKGRAYadds hyperlink text

`,F2=Object.freeze({__proto__:null,default:U2}),B2=`desc;$DKGRAYsends the given message when hotkey is pressed

`,P2=Object.freeze({__proto__:null,default:B2}),$2=`desc;$DKGRAYread number input into given stat/flag
`,D2=Object.freeze({__proto__:null,default:$2}),j2=`desc;$DKGRAYa slider input from 1 to 9 

`,z2=Object.freeze({__proto__:null,default:j2}),W2=`desc;$DKGRAYlist with label value pairs to pick from
`,G2=Object.freeze({__proto__:null,default:W2}),K2=`desc;$DKGRAYread text input into given stat/flag
`,H2=Object.freeze({__proto__:null,default:K2}),Y2=`desc;$DKGRAYdesignates a starting point for running code
`,V2=Object.freeze({__proto__:null,default:Y2}),X2=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,q2=Object.freeze({__proto__:null,default:X2}),J2=`desc;$DKGRAYwill move the object in the given direction
`,Z2=Object.freeze({__proto__:null,default:J2}),Q2=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,tF=Object.freeze({__proto__:null,default:Q2}),eF=`desc;$DKGRAYcustom 8x14 charset
`,nF=Object.freeze({__proto__:null,default:eF}),rF=`desc;$DKGRAYsets stat to given value

`,iF=Object.freeze({__proto__:null,default:rF}),sF=`desc;$DKGRAYsends the given message when hotkey is pressed

`,oF=Object.freeze({__proto__:null,default:sF}),aF=`desc;$DKGRAYread external content and/or handle events
`,cF=Object.freeze({__proto__:null,default:aF}),lF=`desc;$DKGRAYread number input into given stat/flag
`,uF=Object.freeze({__proto__:null,default:lF}),hF=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,fF=Object.freeze({__proto__:null,default:hF}),dF=`desc;$DKGRAYcustom palette colors
`,pF=Object.freeze({__proto__:null,default:dF}),mF=`desc;$DKGRAYa slider input from 1 to 9 

`,gF=Object.freeze({__proto__:null,default:mF}),_F=`desc;$DKGRAYlist with label value pairs to pick from
`,yF=Object.freeze({__proto__:null,default:_F}),bF=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,kF=Object.freeze({__proto__:null,default:bF}),EF=`desc;$DKGRAYread text input into given stat/flag
`,wF=Object.freeze({__proto__:null,default:EF}),xF=`desc;$DKGRAYadds text
`,vF=Object.freeze({__proto__:null,default:xF}),TF=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,AF=Object.freeze({__proto__:null,default:TF}),SF=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,RF=Object.freeze({__proto__:null,default:SF}),OF=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,NF=Object.freeze({__proto__:null,default:OF}),IF=`header;player settings
#set user "name goes here"
`,CF=Object.freeze({__proto__:null,default:IF}),LF=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,MF=Object.freeze({__proto__:null,default:LF});const Ik=Object.assign({"./editor/codepagename.txt":GU,"./editor/command/become.txt":HU,"./editor/command/bgplay.txt":VU,"./editor/command/bgvol.txt":qU,"./editor/command/bind.txt":ZU,"./editor/command/board.txt":t3,"./editor/command/bpm.txt":n3,"./editor/command/break.txt":i3,"./editor/command/change.txt":o3,"./editor/command/char.txt":c3,"./editor/command/charset.txt":u3,"./editor/command/clear.txt":f3,"./editor/command/color.txt":p3,"./editor/command/continue.txt":g3,"./editor/command/copy.txt":y3,"./editor/command/cycle.txt":k3,"./editor/command/die.txt":w3,"./editor/command/distort.txt":v3,"./editor/command/do.txt":A3,"./editor/command/done.txt":R3,"./editor/command/duplicate.txt":N3,"./editor/command/echo.txt":C3,"./editor/command/edge.txt":M3,"./editor/command/else.txt":F3,"./editor/command/elseif.txt":P3,"./editor/command/end.txt":D3,"./editor/command/endgame.txt":z3,"./editor/command/endwith.txt":G3,"./editor/command/fcrush.txt":H3,"./editor/command/fetch.txt":V3,"./editor/command/fetchwith.txt":q3,"./editor/command/foreach.txt":Z3,"./editor/command/go.txt":t8,"./editor/command/idle.txt":n8,"./editor/command/if.txt":i8,"./editor/command/lock.txt":o8,"./editor/command/oneof.txt":c8,"./editor/command/oneofwith.txt":u8,"./editor/command/palette.txt":f8,"./editor/command/phaser.txt":p8,"./editor/command/pivot.txt":g8,"./editor/command/play.txt":y8,"./editor/command/put.txt":k8,"./editor/command/putwith.txt":w8,"./editor/command/readbin.txt":v8,"./editor/command/readjson.txt":A8,"./editor/command/readline.txt":R8,"./editor/command/readrexpaint.txt":N8,"./editor/command/remix.txt":C8,"./editor/command/repeat.txt":M8,"./editor/command/restore.txt":F8,"./editor/command/reverb.txt":P8,"./editor/command/revert.txt":D8,"./editor/command/run.txt":z8,"./editor/command/runwith.txt":G8,"./editor/command/set.txt":H8,"./editor/command/shoot.txt":V8,"./editor/command/shootwith.txt":q8,"./editor/command/shove.txt":Z8,"./editor/command/snapshot.txt":t2,"./editor/command/synth.txt":n2,"./editor/command/toast.txt":i2,"./editor/command/tts.txt":o2,"./editor/command/ttsvol.txt":c2,"./editor/command/twitchbroadcast.txt":u2,"./editor/command/twitchchat.txt":f2,"./editor/command/unlock.txt":p2,"./editor/command/vibrato.txt":g2,"./editor/command/vol.txt":y2,"./editor/command/waitfor.txt":k2,"./editor/command/walk.txt":w2,"./editor/command/weave.txt":v2,"./editor/command/while.txt":A2,"./editor/command/with.txt":R2,"./editor/command/write.txt":N2,"./editor/command/zap.txt":C2,"./editor/comment.txt":M2,"./editor/hyperlink.txt":F2,"./editor/hyperlink/hotkey.txt":P2,"./editor/hyperlink/number.txt":D2,"./editor/hyperlink/range.txt":z2,"./editor/hyperlink/select.txt":G2,"./editor/hyperlink/text.txt":H2,"./editor/label.txt":V2,"./editor/shortgo.txt":q2,"./editor/shorttry.txt":Z2,"./editor/stat/board.txt":tF,"./editor/stat/charset.txt":nF,"./editor/stat/const.txt":iF,"./editor/stat/hotkey.txt":oF,"./editor/stat/loader.txt":cF,"./editor/stat/number.txt":uF,"./editor/stat/object.txt":fF,"./editor/stat/palette.txt":pF,"./editor/stat/range.txt":gF,"./editor/stat/select.txt":yF,"./editor/stat/terrain.txt":kF,"./editor/stat/text.txt":wF,"./editor/text.txt":vF,"./help/controls.txt":AF,"./help/developer.txt":RF,"./help/menu.txt":NF,"./help/player.txt":CF,"./help/text.txt":MF}),Ck={};Zn(Ik).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");Ck[t]=Ik[e].default});function UF(e){const t=Ct(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Ck[t];if(y(n))return n;const{target:r,path:i}=$n(t);switch(r){case"editor":{const s=$n(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function FF(e,t){const n=(e??"").split(`
`);for(let r=0;r<n.length;++r)t(n[r].split(";"))}function BF(e,t){const[n,...r]=t,i=r[0]??"",s=r[1]??"";switch(Ct(n.trim())){case"header":dd(nt,e,i);break;case"section":Rs(nt,e,i);break;case"option":Os(nt,e,i,s);break;default:n.trimStart().startsWith("!")?zU(nt,e,n.trimStart().slice(1),i):be(nt,e,n);break}}function Ii(e){const[t,n]=st(e,0,[H.NAME,H.ANY]);if(Ct(t)==="send"&&rr(n)){const[,r,i,s]=st(e,0,[H.NAME,H.DIR,H.MAYBE_NAME]);return gt(i)&&i.startsWith(":")?{targetdir:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:r,label:e.slice(s-1).join(" ")}}else if(gt(t)){const[r,i,s]=st(e,0,[H.NAME,H.MAYBE_NAME]);return gt(i)&&i.startsWith(":")?{targetname:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetname:"self",label:[r,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Ns(){l0(nt,cr())}function Na(e){FF(UF(`help:${e}`),t=>BF(E.elementfocus,t))}function Lk(e){switch(e.label){case"helpmenu":Na("menu");break;case"helpcontrols":Na("controls");break;case"helptext":Na("text");break;case"helpdeveloper":Na("developer");break;case"helpplayer":Na("player");break;default:{const t=ce(Dt.MAIN),n=bo(t);y(e.targetname)?Ro(e.targetname,e.label,void 0,n):y(e.targetdir)&&Ro(e.targetdir.destpt,e.label,void 0,n);break}}}const PF=Ei().command("shortsend",(e,t)=>{const n=Ii(t);return Lk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Lk(n),0}).command("stat",(e,t)=>{const[n,...r]=t.map(Te),i=r.join(" ");function s(o,a){if(y(o)&&(e.command("pageopen",o.id),a)){const c=Ue(o),l=Oi(o);be(nt,E.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(Ct(n)){case or(At.LOADER):{const[o,a]=Qi(Dt.MAIN,i,bt.LOADER);s(o,a);break}default:{const[o,a]=Qi(Dt.MAIN,[n,...r].join(" "),bt.OBJECT);s(o,a);break}case or(At.BOARD):{const[o,a]=Qi(Dt.MAIN,i,bt.BOARD);s(o,a);break}case or(At.OBJECT):{const[o,a]=Qi(Dt.MAIN,i,bt.OBJECT);s(o,a);break}case or(At.TERRAIN):{const[o,a]=Qi(Dt.MAIN,i,bt.TERRAIN);s(o,a);break}case or(At.CHARSET):{const[o,a]=Qi(Dt.MAIN,i,bt.CHARSET);s(o,a);break}case or(At.PALETTE):{const[o,a]=Qi(Dt.MAIN,i,bt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const n=t.map(Te).join(" ");if(y(E.element)&&E.elementisplayer){const{user:r}=xr(E.elementid),i=gt(r)?r:"player";E.element.tickertext=`${i}: ${n}`,E.element.tickertime=E.timestamp;const s=nn(E.element);xe(nt,E.elementid,`$${Mt[s.color]}$ON${Mt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),Eu(nt,E.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);if(y(s.targetname)){const{user:o}=xr(E.elementid),a=gt(o)?o:"player",c=nn(E.element),l=`$${Mt[c.color]}$ON${Mt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;xe(nt,E.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[n,r]=st(t,0,[H.MAYBE_NAME,H.MAYBE_STRING]);return gt(n)&&gt(r)?o0(nt,E.elementfocus,n,r):yx(nt,E.elementfocus),0}).command("bookcreate",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]),r=xE(n);return y(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=$r(n);return y(r)?(o0(nt,E.elementfocus,"selected",r.id),Ns()):de(nt,E.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=ce(Dt.MAIN),i=$r(n);return y(i)&&(r===i&&wE(Dt.MAIN,""),LP(n),xe(nt,E.elementfocus,`trashed [book] ${i.name}`),Ns(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=hn(n);return y(r)&&yo(E.book,E.elementfocus,r.id,{x:pr(0,St-1),y:pr(0,Xt-1)},!0),0}).command("pageopen",(e,t)=>{const[n,r]=st(t,0,[H.NAME,H.MAYBE_NAME]);let i,s;const o=Pr();for(let a=0;a<o.length&&(s=o[a],i=As(s,n),!y(i));++a);if(y(i)&&y(s)){const a=Ue(i),c=Oi(i);xe(nt,E.elementfocus,`opened [${c}] ${a}`);const l=[i.id,r];_h(Ha(s.id,l),i.code);const u=Oi(i);a0(nt,E.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else de(nt,"pageopen",`page ${n} not found`,E.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=un(Dt.MAIN),i=gk(r,n);if(y(n)){const s=Ue(i),o=Oi(i);xe(nt,E.elementfocus,`trashed [${o}] ${s}`),Ns(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Te).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Rs(nt,E.elementfocus,"books");const e=ce(Dt.MAIN);Os(nt,E.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ce(Dt.MAIN);Os(nt,E.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),fd(nt,E.elementfocus,7);const n=Pr();return n.length?n.forEach(r=>{be(nt,E.elementfocus,`!bookopen ${r.id};${r.name}`)}):Vn(nt,E.elementfocus,"no books found"),be(nt,E.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=un(Dt.MAIN);if(!y(e))return 0;Rs(nt,E.elementfocus,"pages"),Os(nt,E.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Sa(e).forEach(r=>{const i=Ue(r),s=Oi(r);be(nt,E.elementfocus,`!pageopen ${r.id};$blue[${s}]$white ${i}`)}):(be(nt,E.elementfocus,""),Vn(nt,E.elementfocus,"$white no pages found"),Vn(nt,E.elementfocus,"$white use @ to create a page"),Vn(nt,E.elementfocus,"$white @board name of board"),Vn(nt,E.elementfocus,"$white @object name of object"),Vn(nt,E.elementfocus,"$white @terrain name of terrain"),Vn(nt,E.elementfocus,"$white You can omit the type and it will default to object"),Vn(nt,E.elementfocus,"$white @object name of object"),Vn(nt,E.elementfocus,"$white @name of object"));const t=Pr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Os(nt,E.elementfocus,"content",`${r.name} $GREEN${r.id}`),Sa(r).forEach(s=>{const o=Ue(s),a=Oi(s);be(nt,E.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Rs(nt,E.elementfocus,"boards");const e=un(Dt.MAIN);if(y(e)){Os(nt,E.elementfocus,"main",`${e.name} $GREEN${e.id}`);const n=Sa(e);n.filter(r=>ci(r)===bt.BOARD).forEach(r=>{const i=Ue(r);be(nt,E.elementfocus,`!boardopen ${r.id};$blue#goto $white $34 ${i} $34`)}),n.length===0&&(be(nt,E.elementfocus,""),Vn(nt,E.elementfocus,"$white no boards found"),Vn(nt,E.elementfocus,"$white use @ to create a board"),Vn(nt,E.elementfocus,"$white @board name of board"))}const t=Pr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Os(nt,E.elementfocus,"content",`${r.name} $GREEN${r.id}`),Sa(r).filter(s=>ci(s)===bt.BOARD).forEach(s=>{const o=Ue(s);be(nt,E.elementfocus,`!boardopen ${s.id};$blue#goto $white$34 ${o} $34`)}))}return 0}).command("trash",()=>{Rs(nt,E.elementfocus,"$REDTRASH"),Vn(nt,E.elementfocus,"books");const e=Pr();e.length&&(e.forEach(n=>{be(nt,E.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),be(nt,E.elementfocus,""));const t=ce(Dt.MAIN);return y(t)&&(Vn(nt,E.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Ue(n);be(nt,E.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),be(nt,E.elementfocus,"")),0}).command("dev",()=>(Ns(),ax(nt,E.elementfocus),0)).command("share",()=>(Ns(),cx(nt,E.elementfocus),0)).command("save",()=>(Ns(),0)).command("fork",()=>(xx(nt,E.elementfocus),0)).command("itchiopublish",()=>(vx(nt,E.elementfocus),0)).command("nuke",()=>(lx(nt,E.elementfocus),0)).command("restart",()=>(wx(nt,E.elementfocus),Ns(),0)).command("export",()=>{dd(nt,E.elementfocus,"E X P O R T"),Rs(nt,E.elementfocus,"books");const e=Pr();return e.length&&e.forEach(t=>be(nt,E.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=$r(n);return y(r)&&(dd(nt,E.elementfocus,"E X P O R T"),Rs(nt,E.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=Sa(r);be(nt,E.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ue(s),a=Oi(s);be(nt,E.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=$r(n);return y(r)&&i0(nt,E.elementfocus,Tr(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),{target:r,path:i}=$n(n),s=$r(r),o=As(s,i);return y(o)&&i0(nt,E.elementfocus,Tr(o),`${Ue(o)}.${Oi(o)}.json`),0}).command("gadget",()=>(bx(nt,E.elementfocus),0)).command("joincode",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return Jw(nt,E.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return Zw(nt,E.elementfocus,!!n),0}).command("startlookingglass",()=>(ux(nt,E.elementfocus),0)),$F=Ei().command("toast",(e,t)=>{const n=t.map(Te).join("");return n0(nt,E.elementfocus,n),0}).command("ticker",(e,t)=>{const n=t.map(Te).join("");return y(E.element)&&(E.element.tickertext=n,E.element.tickertime=E.timestamp),0}).command("palette",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=TE(),i=en(E.book,bt.PALETTE,n);return y(i)?(r.palette=i.id,xe(nt,E.elementfocus,`loaded palette ${n}`)):de(nt,E.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=TE(),i=en(E.book,bt.CHARSET,n);return y(i)?(r.charset=i.id,xe(nt,E.elementfocus,`loaded charset ${n}`)):de(nt,E.elementfocus,"not-found",`unabled to find charset ${n}`),0}),pd={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Gt.ISSOLID,Gt.ISWALK,Gt.ISSWIM,Gt.ISBULLET,Gt.ISWALK,Gt.ISSWIM;function Ul(e){return ue(e)&&md(e[0])}function md(e){return y(Gt[e])&&gt(e)}function DF(e){if(gt(e))return pd[Ct(e)]}function jF(e){const t=E.words[e];if(Ul(t))return[t,e+1];if(md(t))return[[t],e+1];const[n,r]=Cn(e);return Ul(n)?[n,r]:md(n)?[[n],r]:[void 0,e]}function ko(e,t=0){const n=[];let r=e;for(;r<E.words.length;){const[i,s]=Cn(r);if(ue(i)&&!rr(i)&&!Ia(i)&&!Ul(i)&&!wn(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Cn(e){var r,i,s,o,a,c,l,u,f;const t=E.words[e],n=e+1;if(Uk(t)){const[d,h]=zF(e);if(y(d))return[d,h]}if(DF(t)){const[d,h]=jF(e);if(y(d))return[d,h]}if(Jo(t)){const[d,h]=Sc(e);if(y(d))return[d,h]}if(gt(t)&&Ct(t)==="rnd"){const[d,h]=Cn(n),[m,p]=Cn(h);return wt(d)&&wt(m)?[pr(d,m),p]:wt(d)?[pr(0,d),h]:[pr(0,1),n]}if(Th(t)){const[d,h]=km(e);if(y(d))return[d,h]}if(!y(t))return[void 0,e];if(wt(t)||ue(t))return[t,n];if(gt(t)){const d=Ct(t),h=(r=E.get)==null?void 0:r.call(E,t);if(y(h))return[h,n];switch(d){case"aligned":case"alligned":{const m=$a(E.board,{x:((i=E.element)==null?void 0:i.x)??-1,y:((s=E.element)==null?void 0:s.y)??-1},E.elementfocus);return!y(E.element)||!y(m)?[0,n]:[E.element.x===m.x||E.element.y===m.y?1:0,n]}case"contact":{const m=$a(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus);if(!y(E.element)||!y(m))return[0,n];const p=(m.x??0)-(((c=E.element)==null?void 0:c.x)??0),k=(m.y??0)-(((l=E.element)==null?void 0:l.y)??0);return[p===0&&Math.abs(k)<2||k===0&&Math.abs(p)<2?1:0,n]}case"blocked":{const[m,p]=st(E.words,n,[H.DIR]);return[_U(E.board,E.element,m.destpt)?1:0,p]}case"any":{const[m]=st(E.words,n,[H.ANY]);if(rr(m)){const[v,T,A]=st(E.words,n,[H.DIR,H.COLOR_OR_KIND]),L=v.layer===pt.MID?ie(E.board,v.destpt):es(E.board,v.destpt.x,v.destpt.y);if(y(L)){const S=nn(L);if(wn(T))return[Tc(T)===S.color||Ac(T)===S.bg?[L]:[],A];const I=Ct(Ba(T)),$=Jl(T);if((I.length&&I!==S.name||y($)&&$!==S.color)===!1)return[[L],A]}return[[],A]}const[p,k]=st(E.words,n,[H.COLOR_OR_KIND]);return wn(p)?[IE(E.board,p),k]:[Zl(E.board,p),k]}case"count":{const[m]=st(E.words,n,[H.ANY]);if(rr(m)){const[v,T,A]=st(E.words,n,[H.DIR,H.COLOR_OR_KIND]),L=v.layer===pt.MID?ie(E.board,v.destpt):es(E.board,v.destpt.x,v.destpt.y);if(y(L)){const S=nn(L);if(wn(T))return[Tc(T)===S.color||Ac(T)===S.bg?1:0,A];const I=Ct(Ba(T)),$=Jl(T),N=I.length?I===S.name:!0,z=y($)?$===S.color:!0;if(N&&z)return[1,A]}return[0,A]}const[p,k]=st(E.words,n,[H.COLOR_OR_KIND]);return wn(p)?[IE(E.board,p).length,k]:[Zl(E.board,p).length,k]}case"rnd":return[pr(0,1),n];case"abs":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,k,b]=st(E.words,n,[H.NUMBER,H.NUMBER,H.NUMBER]);return[gn(m,p,k),b]}case"min":{const[m,p]=ko(n);return[Math.min(...m),p]}case"max":{const[m,p]=ko(n);return[Math.max(...m),p]}case"pick":{const[m,p]=ko(n);return[Sn(m),p]}case"pickwith":{const[m,p]=st(E.words,n,[H.NUMBER_OR_STRING]),[k,b]=ko(p);return[$A(`${m}`,k),b]}case"random":{const[m,p]=ko(n,2),[k,b]=m;return[pr(k,b??0),p]}case"randomwith":{const[m,p]=st(E.words,n,[H.NUMBER_OR_STRING]),[k,b]=ko(p,2),[v,T]=k;return[gm(`${m}`,v,T??0),b]}case"run":{const[m,p]=st(E.words,n,[H.NAME]);return ql(m),[(u=E.get)==null?void 0:u.call(E,"arg"),p]}case"runwith":{const[m,p,k]=st(E.words,n,[H.ANY,H.NAME]);return y(E.element)&&(E.element.arg=m),ql(p),[(f=E.get)==null?void 0:f.call(E,"arg"),k]}}}return[t,n]}const gd={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ia(e){return ue(e)&&Mk(e[0])}function Mk(e){return y(Pn[e])&&gt(e)}function Uk(e){if(gt(e))return gd[Ct(e)]}function Fk(e){if(Ia(e))return e;if(Mk(e))return[e];const t=Uk(e);if(y(t))return[t]}function zF(e){const t=E.words[e],n=Fk(t);if(Ia(n))return[n,e+1];const[r,i]=Cn(e),s=Fk(r);return Ia(s)?[s,i]:[void 0,e]}const WF=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Bk=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"]),GF=["NORTH","SOUTH","WEST","EAST"];function KF(e){const t=xr(e);if(wt(t.inputcurrent)||(t.inputcurrent=0),ue(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=Rn.NONE,i=0]=n??[Rn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&rS?1:0,t.inputctrl=i&iS?1:0,t.inputshift=i&sS?1:0,r){case Rn.MOVE_UP:case Rn.MOVE_DOWN:case Rn.MOVE_LEFT:case Rn.MOVE_RIGHT:t.inputmove=[GF[r-Rn.MOVE_UP]];break;case Rn.OK_BUTTON:t.inputok=1;break;case Rn.CANCEL_BUTTON:t.inputcancel=1;break;case Rn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Rn.NONE&&o!==r}),t}function HF(e){const t=gd[e];if(y(t))return t;const n=pd[e];if(y(n))return n;const r=qo[e];if(y(r))return r;const i=vh[e];if(y(i))return i}const YF=Ei({get(e,t){var o,a,c,l,u,f,d,h,m,p,k,b,v,T,A,L,S,I,$,N,z;const n=HF(t);if(y(n))return[!0,n];if(E.elementisplayer&&WF.has(t)){const J=KF(E.elementid)[t];return[y(J),J]}const r=$a(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus),i=(r==null?void 0:r.id)??E.elementfocus??cr();switch(t){case"camera":case"graphics":case"facing":if(y((c=E.board)==null?void 0:c[t]))return[!0,(l=E.board)==null?void 0:l[t]];break;case"isdark":return[!0,(u=E.board)!=null&&u.isdark?1:0];case"startx":return[!0,((f=E.board)==null?void 0:f.startx)??0];case"starty":return[!0,((d=E.board)==null?void 0:d.starty)??0];case"over":return[!0,((h=E.board)==null?void 0:h.over)??""];case"under":return[!0,((m=E.board)==null?void 0:m.under)??""];case"exitnorth":return[!0,((p=E.board)==null?void 0:p.exitnorth)??""];case"exitsouth":return[!0,((k=E.board)==null?void 0:k.exitsouth)??""];case"exitwest":return[!0,((b=E.board)==null?void 0:b.exitwest)??""];case"exiteast":return[!0,((v=E.board)==null?void 0:v.exiteast)??""];case"timelimit":return[!0,((T=E.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=E.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((L=E.board)==null?void 0:L.maxplayershots)??0];case"currenttick":return[!0,E.timestamp];case"boardid":return[!0,((S=E.board)==null?void 0:S.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((I=E.element)==null?void 0:I.id)??""];case"thisx":return[!0,(($=E.element)==null?void 0:$.x)??-1];case"thisy":return[!0,((N=E.element)==null?void 0:N.y)??-1];default:{if(Bk.has(t)){const J=(z=E.element)==null?void 0:z[t];return t==="color"&&console.info("reading color",J),[!0,J]}break}}const s=xr(i)[t];return[y(s),s]},set(e,t,n){var o,a;const r=$a(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus),i=(r==null?void 0:r.id)??E.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(y(E.board))return E.board.isdark=n?1:0,[!0,E.board.isdark];break;case"startx":if(y(E.board))return E.board.startx=Qo(n,0),[!0,E.board.startx];break;case"starty":if(y(E.board))return E.board.starty=Qo(n,0),[!0,E.board.starty];break;case"over":if(y(E.board))return E.board.over=Te(n),[!0,E.board.over];break;case"under":if(y(E.board))return[!0,E.board.under=Te(n)];break;case"exitnorth":if(y(E.board))return[!0,E.board.exitnorth=Te(n)];break;case"exitsouth":if(y(E.board))return[!0,E.board.exitsouth=Te(n)];break;case"exitwest":if(y(E.board))return[!0,E.board.exitwest=Te(n)];break;case"exiteast":if(y(E.board))return[!0,E.board.exiteast=Te(n)];break;case"timelimit":if(y(E.board))return[!0,E.board.timelimit=Qo(n,0)];break;case"restartonzap":if(y(E.board))return[!0,E.board.restartonzap=n?1:0];break;case"maxplayershots":if(y(E.board))return[!0,E.board.maxplayershots=Qo(n,0)];break;case"currenttick":return[!1,n];case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(Bk.has(t))return y(E.element)&&(E.element[t]=n),[!0,n];break}}const s=xr(i);return y(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=E.element)!=null&&e.removed)&&(y((t=E.element)==null?void 0:t.stepx)||y((n=E.element)==null?void 0:n.stepy))){const s={x:((r=E.element)==null?void 0:r.x)??0,y:((i=E.element)==null?void 0:i.y)??0};ts(E.book,E.board,E.element,{x:s.x+(E.element.stepx??0),y:s.y+(E.element.stepy??0)})===!1&&(E.element.stepx=0,E.element.stepy=0,zt(E.element,"breakable")&&Tn(E.board,E.element,E.timestamp))}}}).command("clear",(e,t)=>{for(let n=0;n<t.length;++n)e.set(Te(t[n]),0);return 0}).command("set",(e,t)=>{const[n,r]=st(t,0,[H.NAME,H.ANY]);return e.set(n,r??1),0}).command("become",(e,t)=>{var r,i;const[n]=st(t,0,[H.KIND]);if(Re(E.board),nd(E.board,E.element),Tn(E.board,E.element,E.timestamp)){const s={x:((r=E.element)==null?void 0:r.x)??0,y:((i=E.element)==null?void 0:i.y)??0};jr(E.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=st(t,0,[H.ANY]);if(rr(n)){const[r,i]=st(t,0,[H.DIR,H.NUMBER]),s=ie(E.board,r.destpt);y(s)&&(s.char=i)}else y(E.element)&&wt(n)&&(E.element.char=n);return 0}).command("color",(e,t)=>{const[n]=st(t,0,[H.ANY]);if(rr(n)){const[r,i]=st(t,0,[H.DIR,H.COLOR]),s=ie(E.board,r.destpt);y(s)&&ia(E.element,i)}else{const[r]=st(t,0,[H.COLOR]);y(E.element)&&y(r)&&ia(E.element,r)}return 0}).command("go",(e,t)=>{if(y(E.element)){const[n]=st(t,0,[H.DIR]);if(ts(E.book,E.board,E.element,n.destpt),e.yield(),E.element.x===n.destpt.x&&E.element.y===n.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!y(E.element))return 0;const[n]=st(t,0,[H.DIR]),r=E.element.x??0,i=E.element.y??0;return E.element.stepx=n.destpt.x-r,E.element.stepy=n.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=st(t,0,[H.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Te(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Te(t[0])),0)).command("cycle",(e,t)=>{if(y(E.element)){const[n]=st(t,0,[H.NUMBER]);E.element.cycle=gn(Math.round(n),1,255)}return 0}).command("die",e=>(Tn(E.board,E.element,E.timestamp),e.endofprogram(),0)).command("endgame",()=>(c0(nt,E.elementfocus),0)).command("run",(e,t)=>{const[n]=st(t,0,[H.NAME]);return ql(n),0}).command("runwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY,H.NAME]);return e.set("arg",n),ql(r),0}),Fl={};function VF(e){var t;return(t=Fl[e])==null?void 0:t.arg}function XF(e){var t;return(t=Fl[e])==null?void 0:t.format}function Eo(e){var t;return(t=Fl[e])==null?void 0:t.content}function Pk(e,t,n,r,i){const s=ce(Dt.MAIN);if(!y(s))return;const o=Ss(s,bt.LOADER).filter(a=>{const c=Ts(a),l=c.format,u=gt(l)?new RegExp(l).test(t):!1,f=c.event,d=gt(f)?new RegExp(f).test(n):!1;return gt(l)&&gt(f)?u&&d:gt(l)?u:gt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${De()}_loader`;Fl[c]={arg:e,format:t,content:r,player:i},PP(c,o[a].code)}}function $k(e,t){if(!y(e))return;const n=Ct(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const qF=(e,t)=>{const n=Eo(e.id());if(!y(n))return 0;const[r,i]=st(t,0,[H.NAME]),s=Ct(r);switch(s){case"seek":{const[o]=st(t,i,[H.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=st(t,i,[H.NAME]);e.set(o,$k(n,s));break}case"text":{const[o,a]=st(t,i,[H.NAME,H.NAME]),c=$k(n,o);if(wt(c)&&gt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);e.set(a,f),n.cursor+=c}break}case"palette":{const[o]=st(t,i,[H.NAME]),[a]=td(E.book,bt.PALETTE,o),c=Se(a);if(y(c)){const l=qA*Rc,u=sg(new Uint8Array(n.bytes.buffer,n.cursor,l));y(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=st(t,i,[H.NAME]),[a]=td(E.book,bt.CHARSET,o),c=Se(a);if(y(c)){const l=Oc*XA*Nh,u=og(new Uint8Array(n.bytes.buffer,n.cursor,l));y(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},wo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Bl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Bl(e[n],t[n]))return!1;return!0}if(wo(e)&&wo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Bl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Pl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(wo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},JF=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Dk=e=>e>="0"&&e<="9"||e==="-",ZF=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var q;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(q||(q={}));const jk={"(":q.TOK_LPAREN,")":q.TOK_RPAREN,"*":q.TOK_STAR,",":q.TOK_COMMA,".":q.TOK_DOT,":":q.TOK_COLON,"@":q.TOK_CURRENT,$:q.TOK_ROOT,"]":q.TOK_RBRACKET,"{":q.TOK_LBRACE,"}":q.TOK_RBRACE},QF={"!":!0,"<":!0,"=":!0,">":!0},tB={"	":!0,"\n":!0,"\r":!0," ":!0};class eB{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(JF(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:q.TOK_UNQUOTEDIDENTIFIER,value:i});else if(jk[t[this._current]]!==void 0)n.push({start:this._current,type:jk[t[this._current]],value:t[this._current]}),this._current+=1;else if(Dk(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:q.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:q.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:q.TOK_LITERAL,value:o})}else if(QF[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(tB[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:q.TOK_AND,value:"&&"})):n.push({start:r,type:q.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:q.TOK_OR,value:"||"})):n.push({start:r,type:q.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&ZF(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Dk(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:q.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:q.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:q.TOK_FLATTEN,value:"[]"}):{start:n,type:q.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_NE,value:"!="}):{start:n,type:q.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_LTE,value:"<="}):{start:n,type:q.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_GTE,value:">="}):{start:n,type:q.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:q.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const nB=new eB,xn={[q.TOK_EOF]:0,[q.TOK_UNQUOTEDIDENTIFIER]:0,[q.TOK_QUOTEDIDENTIFIER]:0,[q.TOK_RBRACKET]:0,[q.TOK_RPAREN]:0,[q.TOK_COMMA]:0,[q.TOK_RBRACE]:0,[q.TOK_NUMBER]:0,[q.TOK_CURRENT]:0,[q.TOK_EXPREF]:0,[q.TOK_ROOT]:0,[q.TOK_PIPE]:1,[q.TOK_OR]:2,[q.TOK_AND]:3,[q.TOK_EQ]:5,[q.TOK_GT]:5,[q.TOK_LT]:5,[q.TOK_GTE]:5,[q.TOK_LTE]:5,[q.TOK_NE]:5,[q.TOK_FLATTEN]:9,[q.TOK_STAR]:20,[q.TOK_FILTER]:21,[q.TOK_DOT]:40,[q.TOK_NOT]:45,[q.TOK_LBRACE]:50,[q.TOK_LBRACKET]:55,[q.TOK_LPAREN]:60};class rB{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==q.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...nB.tokenize(t),{type:q.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<xn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case q.TOK_LITERAL:return{type:"Literal",value:t.value};case q.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case q.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===q.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case q.TOK_NOT:return r=this.expression(xn.Not),{type:"NotExpression",children:[r]};case q.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===q.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(xn.Star),{type:"ValueProjection",children:[n,r]};case q.TOK_FILTER:return this.led(t.type,{type:"Identity"});case q.TOK_LBRACE:return this.parseMultiselectHash();case q.TOK_FLATTEN:return n={type:q.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(xn.Flatten),{type:"Projection",children:[n,r]};case q.TOK_LBRACKET:return this.lookahead(0)===q.TOK_NUMBER||this.lookahead(0)===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===q.TOK_STAR&&this.lookahead(1)===q.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(xn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case q.TOK_CURRENT:return{type:q.TOK_CURRENT};case q.TOK_ROOT:return{type:q.TOK_ROOT};case q.TOK_EXPREF:return i=this.expression(xn.Expref),{type:"ExpressionReference",children:[i]};case q.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(i={type:q.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(q.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case q.TOK_DOT:const i=xn.Dot;return this.lookahead(0)!==q.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case q.TOK_PIPE:return r=this.expression(xn.Pipe),{type:q.TOK_PIPE,children:[n,r]};case q.TOK_OR:return r=this.expression(xn.Or),{type:"OrExpression",children:[n,r]};case q.TOK_AND:return r=this.expression(xn.And),{type:"AndExpression",children:[n,r]};case q.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(a={type:q.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===q.TOK_COMMA&&this.match(q.TOK_COMMA),o.push(a);return this.match(q.TOK_RPAREN),{name:s,type:"Function",children:o};case q.TOK_FILTER:const l=this.expression(0);return this.match(q.TOK_RBRACKET),r=this.lookahead(0)===q.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(xn.Filter),{type:"FilterProjection",children:[n,r,l]};case q.TOK_FLATTEN:const u={type:q.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(xn.Flatten);return{type:"Projection",children:[u,f]};case q.TOK_EQ:case q.TOK_NE:case q.TOK_GT:case q.TOK_GTE:case q.TOK_LT:case q.TOK_LTE:return this.parseComparator(n,t);case q.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===q.TOK_NUMBER||d.type===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(q.TOK_STAR),this.match(q.TOK_RBRACKET),r=this.parseProjectionRHS(xn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===q.TOK_COLON||this.lookahead(1)===q.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(q.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(xn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==q.TOK_RBRACKET&&n<3;){if(r===q.TOK_COLON)n+=1,this.advance();else if(r===q.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(q.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(xn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER,q.TOK_STAR].includes(n))return this.expression(t);if(n===q.TOK_LBRACKET)return this.match(q.TOK_LBRACKET),this.parseMultiselectList();if(n===q.TOK_LBRACE)return this.match(q.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(xn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===q.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===q.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===q.TOK_DOT)return this.match(q.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==q.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===q.TOK_COMMA&&(this.match(q.TOK_COMMA),this.lookahead(0)===q.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(q.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(q.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===q.TOK_COMMA)this.match(q.TOK_COMMA);else if(this.lookahead(0)===q.TOK_RBRACE){this.match(q.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const iB=new rB;var ft;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ft||(ft={}));class sB{constructor(t){this.TYPE_NAME_TABLE={[ft.TYPE_NUMBER]:"number",[ft.TYPE_ANY]:"any",[ft.TYPE_STRING]:"string",[ft.TYPE_ARRAY]:"array",[ft.TYPE_OBJECT]:"object",[ft.TYPE_BOOLEAN]:"boolean",[ft.TYPE_EXPREF]:"expression",[ft.TYPE_NULL]:"null",[ft.TYPE_ARRAY_NUMBER]:"Array<number>",[ft.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>wo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ft.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ft.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ft.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ft.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ft.TYPE_NUMBER,ft.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ft.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ft.TYPE_NUMBER?n:r===ft.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ft.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ft.TYPE_NUMBER:return"number";case ft.TYPE_STRING:return"string";case ft.TYPE_ARRAY:return"array";case ft.TYPE_OBJECT:return"object";case ft.TYPE_BOOLEAN:return"boolean";case ft.TYPE_EXPREF:return"expref";case ft.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ft.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ft.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]},{types:[ft.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ft.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ft.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY,ft.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ft.TYPE_EXPREF]},{types:[ft.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ft.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ft.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ft.TYPE_ARRAY_STRING,ft.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ft.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ft.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ft.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ft.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ft.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(p=>{var k;return(k=!p.optional)!==null&&k!==void 0?k:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,m;for(let p=0;p<r.length;p+=1){m=!1,d=r[p].types,h=this.getTypeName(n[p]);let k;for(k=0;k<d.length;k+=1)if(h!==void 0&&this.typeMatches(h,d[k],n[p])){m=!0;break}if(!m&&h!==void 0){const b=d.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${b}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(t,n,r){if(n===ft.TYPE_ANY)return!0;if(n===ft.TYPE_ARRAY_STRING||n===ft.TYPE_ARRAY_NUMBER||n===ft.TYPE_ARRAY){if(n===ft.TYPE_ARRAY)return t===ft.TYPE_ARRAY;if(t===ft.TYPE_ARRAY){let i;n===ft.TYPE_ARRAY_NUMBER?i=ft.TYPE_NUMBER:n===ft.TYPE_ARRAY_STRING&&(i=ft.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ft.TYPE_STRING;case"[object Number]":return ft.TYPE_NUMBER;case"[object Array]":return ft.TYPE_ARRAY;case"[object Boolean]":return ft.TYPE_BOOLEAN;case"[object Null]":return ft.TYPE_NULL;case"[object Object]":return t.jmespathType===q.TOK_EXPREF?ft.TYPE_EXPREF:ft.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class oB{constructor(){this._rootValue=null,this.runtime=new sB(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,f,d,h;switch(t.type){case"Field":return n===null?null:wo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let m=t.value;return m<0&&(m=n.length+m),s=n[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const p=[...t.children],k=this.computeSliceParams(n.length,p),[b,v,T]=k;if(s=[],T>0)for(d=b;d<v;d+=T)s.push(n[d]);else for(d=b;d>v;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(t.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(t.children[0],n),!wo(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(t.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;const L=[],S=[];for(d=0;d<h.length;d+=1)r=this.visit(t.children[2],h[d]),Pl(r)||L.push(h[d]);for(let M=0;M<L.length;M+=1)i=this.visit(t.children[1],L[M]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case q.TOK_EQ:s=Bl(o,a);break;case q.TOK_NE:s=!Bl(o,a);break;case q.TOK_GT:s=o>a;break;case q.TOK_GTE:s=o>=a;break;case q.TOK_LT:s=o<a;break;case q.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case q.TOK_FLATTEN:const I=this.visit(t.children[0],n);if(!Array.isArray(I))return null;let $=[];for(d=0;d<I.length;d+=1)i=I[d],Array.isArray(i)?$=[...$,...i]:$.push(i);return $;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<t.children.length;d+=1)f.push(this.visit(t.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let N;for(d=0;d<t.children.length;d+=1)N=t.children[d],f[N.name]=this.visit(N.value,n);return f;case"OrExpression":return r=this.visit(t.children[0],n),Pl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Pl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Pl(o);case"Literal":return t.value;case q.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case q.TOK_CURRENT:return n;case q.TOK_ROOT:return this._rootValue;case"Function":const z=[];for(let M=0;M<t.children.length;M+=1)z.push(this.visit(t.children[M],n));return this.runtime.callFunction(t.name,z);case"ExpressionReference":const J=t.children[0];return J.jmespathType=q.TOK_EXPREF,J;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const aB=new oB;ft.TYPE_ANY,ft.TYPE_ARRAY,ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING,ft.TYPE_BOOLEAN,ft.TYPE_EXPREF,ft.TYPE_NULL,ft.TYPE_NUMBER,ft.TYPE_OBJECT,ft.TYPE_STRING;function cB(e,t){const n=iB.parse(t);return aB.search(n,e)}const lB=(e,t)=>{const n=Eo(e.id());if(!y(n))return 0;const[r,i]=st(t,0,[H.NAME,H.NAME]),s=cB(n.json,r);return e.set(i,s),0},uB=(e,t)=>{const n=Eo(e.id());if(!y(n))return 0;const[r,i]=st(t,0,[H.NAME]);switch(Ct(r)){case"seek":{const[o]=st(t,i,[H.NUMBER]);n.cursor=gn(o,0,n.lines.length-1);break}case"line":n.cursor=gn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[f,d]=st(t,u,[H.NAME]);e.set(f,c[l]??0),++l,u=d}break}}return 0};function zk(e){const t=ce(Dt.MAIN),n=bo(t);y(e.targetdir)?Ro(e.targetdir.destpt,e.label,void 0,n):y(e.targetname)&&Ro(e.targetname,e.label,void 0,n)}const hB=Ei({get(e,t){const n=XF(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const n=Ii(t);return zk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return zk(n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join(" ");return xe(nt,E.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);return y(s.targetname)&&xe(nt,E.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",uB).command("readjson",lB).command("readbin",qF).command("withboard",(e,t)=>{const[n]=st(t,0,[H.STRING]),r=hn(n);return y(r)&&(E.board=r,E.element={x:-1,y:-1}),0});function Wk(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=st(i,a,[H.ANY]);ue(c)&&!rr(c)&&!Ia(c)&&!Ul(c)&&!wn(c)?o.push(...c):o.push(c),a=l}switch(Ct(r)){case"get":case"post:json":Hw(nt,E.elementfocus,e,t,n,r,o);break}return 0}const fB=Ei().command("fetch",(e,t)=>{const[n,r,i="get",s]=st(t,0,[H.NAME,H.NAME,H.MAYBE_STRING]);return Wk(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=st(t,0,[H.ANY,H.NAME,H.NAME,H.MAYBE_STRING]);return Wk(n,r,i,s,t,o),0}).command("chat",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return n?Gw(nt,E.elementfocus,n):Kw(nt,E.elementfocus),0}).command("broadcast",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return n?zw(nt,E.elementfocus,n):Ww(nt,E.elementfocus),0});function Gk(e,t){var n,r;if(y(t.targetname))switch(t.targetname){case"all":for(const i of Object.keys(((n=E.board)==null?void 0:n.objects)??{}))e.send(E.elementfocus,i,t.label);break;case"self":e.message({session:nt.session(),player:E.elementfocus,id:De(),sender:e.id(),target:t.label});break;case"others":for(const i of Object.keys(((r=E.board)==null?void 0:r.objects)??{}))i!==e.id()&&e.send(E.elementfocus,i,t.label);break;default:{const i=CE(E.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];y(o.id)&&e.send(E.elementfocus,o.id,t.label)}break}}else if(y(t.targetdir)){const i=ie(E.board,t.targetdir.destpt);y(i==null?void 0:i.id)&&e.send(E.elementfocus,i.id,t.label)}}const dB=Ei({set(e,t,n){return s$(e,t,n),[!1,void 0]},everytick(){const e=An(E.elementid),[t]=e;if(e.length===1&&gt(t)){if(y(E.element))if(t.trim().length===0){const n=Ye(E.elementid);n.sidebar=[]}else E.element.tickertext=t,E.element.tickertime=E.timestamp}else if(e.length>1)if(E.elementisplayer){const n=Ye(E.elementid);n.sidebar=DE(e)}else{const n=Ye(E.elementfocus);n.scrollname=nn(E.element).name,n.scroll=DE(e)}}}).command("shortsend",(e,t)=>{const n=Ii(t);return Gk(e,n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Gk(e,n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join("");return Rt(E.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);return y(s.targetname)&&Lt(E.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function pB(e,t,n,r,i){if(!y(E.book))return;const s=E.book,o=en(s,bt.BOARD,e),a=Se(o);if(!y(a))return;const c=Ql(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Re(a),Re(c);const f=-Math.tan(t*.5),d=Math.sin(t),h=Math.round(12.5*f),m=Math.round(12.5*d),p=new Array(Xt).fill(0);am(h,0,-h,Xt-1).forEach(A=>{A.x<0?p[A.y]=Math.min(p[A.y],A.x):p[A.y]=Math.max(p[A.y],A.x)});const b=new Array(St).fill(0);am(0,m,St-1,-m).forEach(A=>{A.y<0?b[A.x]=Math.min(b[A.x],A.y):b[A.x]=Math.max(b[A.x],A.y)});const T=[p,b,p];for(let A=0;A<T.length;++A){const L=T[A];if(A!==1){for(let S=0;S<Xt;++S){const I=L[S],$=S*St;for(let N=0;N<St;N++){const z=(N+I+St)%St;u&&(c.terrain[z+$]=a.terrain[N+$])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const $=S[I],{x:N,y:z}=a.objects[$];if(y(N)&&y(z)){const J=L[z];a.objects[$].x=(N+J+St)%St,a.objects[$].lx=a.objects[$].x}}}}if(A===1){for(let S=0;S<St;++S){const I=L[S];for(let $=0;$<Xt;++$){const N=($+I+Xt)%Xt;u&&(c.terrain[S+N*St]=a.terrain[S+$*St])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const $=S[I],{x:N,y:z}=a.objects[$];if(y(N)&&y(z)){const J=L[N];a.objects[$].y=(z+J+Xt)%Xt,a.objects[$].ly=a.objects[$].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Re(c),Re(a)}}function mB(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var gB=mB;const _B=gB,ne=function(){};ne.prototype.FMX=0,ne.prototype.FMY=0,ne.prototype.FMXxFMY=0,ne.prototype.T=0,ne.prototype.N=0,ne.prototype.initiliazedField=!1,ne.prototype.generationComplete=!1,ne.prototype.wave=null,ne.prototype.compatible=null,ne.prototype.weightLogWeights=null,ne.prototype.sumOfWeights=0,ne.prototype.sumOfWeightLogWeights=0,ne.prototype.startingEntropy=0,ne.prototype.sumsOfOnes=null,ne.prototype.sumsOfWeights=null,ne.prototype.sumsOfWeightLogWeights=null,ne.prototype.entropies=null,ne.prototype.propagator=null,ne.prototype.observed=null,ne.prototype.distribution=null,ne.prototype.stack=null,ne.prototype.stackSize=0,ne.prototype.DX=[-1,0,1,0],ne.prototype.DY=[0,1,0,-1],ne.prototype.opposite=[2,3,0,1],ne.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},ne.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=_B(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},ne.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],m=f[h];m[i]--,m[i]==0&&this.ban(l,h)}}}},ne.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},ne.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},ne.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},ne.prototype.isGenerationComplete=function(){return this.generationComplete},ne.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},ne.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Kk=ne;const Hk=Kk,Ci=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let N=0;N<f;N++)d[N]=new Array(r);this.colors=[];const h={};for(let N=0;N<r;N++)for(let z=0;z<n;z++){const J=(N*n+z)*4,M=[t[J],t[J+1],t[J+2],t[J+3]],O=M.join("-");h.hasOwnProperty(O)||(h[O]=this.colors.length,this.colors.push(M)),d[z][N]=h[O]}const m=this.colors.length,p=Math.pow(m,i*i),k=function(z){let J=new Array(i*i);for(let M=0;M<i;M++)for(let O=0;O<i;O++)J[O+M*i]=z(O,M);return J},b=function(z,J){return k(function(M,O){return d[(z+M)%n][(J+O)%r]})},v=function(z){return k(function(J,M){return z[i-1-M+J*i]})},T=function(z){return k(function(J,M){return z[i-1-J+M*i]})},A=function(z){let J=0,M=1;for(let O=0;O<z.length;O++)J+=z[z.length-1-O]*M,M*=m;return J},L=function(z){let J=z,M=p;const O=new Array(i*i);for(let w=0;w<O.length;w++){M/=m;let C=0;for(;J>=M;)J-=M,C++;O[w]=C}return O},S={},I=[];for(let N=0;N<(a?r:r-i+1);N++)for(let z=0;z<(a?n:n-i+1);z++){const J=new Array(8);J[0]=b(z,N),J[1]=T(J[0]),J[2]=v(J[0]),J[3]=T(J[2]),J[4]=v(J[2]),J[5]=T(J[4]),J[6]=v(J[4]),J[7]=T(J[6]);for(let M=0;M<l;M++){const O=A(J[M]);S[O]?S[O]++:(I.push(O),S[O]=1)}}this.T=I.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const z=parseInt(I[N],10);this.patterns[N]=L(z),this.weights[N]=S[z]}const $=function(z,J,M,O){const w=M<0?0:M,C=M<0?M+i:i,P=O<0?0:O,F=O<0?O+i:i;for(let ot=P;ot<F;ot++)for(let tt=w;tt<C;tt++)if(z[tt+i*ot]!=J[tt-M+i*(ot-O)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let z=0;z<this.T;z++){const J=[];for(let M=0;M<this.T;M++)$(this.patterns[z],this.patterns[M],this.DX[N],this.DY[N])&&J.push(M);this.propagator[N][z]=J}}};Ci.prototype=Object.create(Hk.prototype),Ci.prototype.constructor=Ci,Ci.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ci.prototype.clear=function(){if(Hk.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ci.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ci.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ci.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const m=d+h*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const k=this.colors[this.patterns[p][f+u*this.N]];s+=k[0],o+=k[1],a+=k[2],c+=k[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var yB=Ci;const bB=Kk,qi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(A){const L=new Array(o*o);for(let S=0;S<o;S++)for(let I=0;I<o;I++)L[I+S*o]=A(I,S);return L},u=function(A){return l(function(L,S){return A[o-1-S+L*o]})},f=function(A){return l(function(L,S){return A[o-1-L+S*o]})};this.tiles=[];const d=[],h=[],m={};let p,k,b;for(let T=0;T<t.tiles.length;T++){const A=t.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":b=4,p=function(S){return(S+1)%4},k=function(S){return S%2===0?S+1:S-1};break;case"T":b=4,p=function(S){return(S+1)%4},k=function(S){return S%2===0?S:4-S};break;case"I":b=2,p=function(S){return 1-S},k=function(S){return S};break;case"\\":b=2,p=function(S){return 1-S},k=function(S){return 1-S};break;case"F":b=8,p=function(S){return S<4?(S+1)%4:4+(S-1)%4},k=function(S){return S<4?S+4:S-4};break;default:b=1,p=function(S){return S},k=function(S){return S};break}this.T=h.length,m[A.name]=this.T;for(let S=0;S<b;S++)h.push([this.T+S,this.T+p(S),this.T+p(p(S)),this.T+p(p(p(S))),this.T+k(S),this.T+k(p(S)),this.T+k(p(p(S))),this.T+k(p(p(p(S))))]);let L;if(a)for(let S=0;S<b;S++)L=A.bitmap[S],this.tiles.push(l(function(I,$){return[L[(o*$+I)*4],L[(o*$+I)*4+1],L[(o*$+I)*4+2],L[(o*$+I)*4+3]]}));else{L=A.bitmap,this.tiles.push(l(function(S,I){return[L[(o*I+S)*4],L[(o*I+S)*4+1],L[(o*I+S)*4+2],L[(o*I+S)*4+3]]}));for(let S=1;S<b;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):f(this.tiles[this.T+S-4]))}for(let S=0;S<b;S++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const v=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),v[T]=new Array(this.T);for(let A=0;A<this.T;A++){v[T][A]=new Array(this.T);for(let L=0;L<this.T;L++)v[T][A][L]=!1}}for(let T=0;T<t.neighbors.length;T++){const A=t.neighbors[T],L=A.left.split(" ").filter(function(J){return J.length}),S=A.right.split(" ").filter(function(J){return J.length});if(c!==null&&(c.indexOf(L[0])===-1||c.indexOf(S[0])===-1))continue;const I=h[m[L[0]]][L.length==1?0:parseInt(L[1],10)],$=h[I][1],N=h[m[S[0]]][S.length==1?0:parseInt(S[1],10)],z=h[N][1];v[0][N][I]=!0,v[0][h[N][6]][h[I][6]]=!0,v[0][h[I][4]][h[N][4]]=!0,v[0][h[I][2]][h[N][2]]=!0,v[1][z][$]=!0,v[1][h[$][6]][h[z][6]]=!0,v[1][h[z][4]][h[$][4]]=!0,v[1][h[$][2]][h[z][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)v[2][T][A]=v[0][A][T],v[3][T][A]=v[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const L=[],S=v[T][A];for(let I=0;I<this.T;I++)S[I]&&L.push(I);this.propagator[T][A]=L}};qi.prototype=Object.create(bB.prototype),qi.prototype.constructor=qi,qi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},qi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},qi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},qi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let f=0,d=0,h=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const k=this.tiles[p][l+c*this.tilesize],b=this.weights[p]*a;f+=k[0]*b,d+=k[1]*b,h+=k[2]*b,m+=k[3]*b}e[u]=f,e[u+1]=d,e[u+2]=h,e[u+3]=m}}}};var kB=qi,EB={OverlappingModel:yB,SimpleTiledModel:kB},wB=Us(EB);const Yk=5;function Vk(e,t,n,r,i,s,o){if(!y(E.book))return!1;const a=E.book,c=en(a,bt.BOARD,e),l=en(a,bt.BOARD,t),u=Se(c),f=Se(l);if(!y(u)||!y(f))return!1;Re(u),Re(f);let d=0;const h=new Map,m=new Map;let p=0;const k=32,b=new Uint8Array(Oh*4);for(let I=0;I<Xt;++I)for(let $=0;$<St;++$){const N=ie(f,{x:$,y:I}),z=(N==null?void 0:N.char)??0,J=(N==null?void 0:N.color)??k,M=(N==null?void 0:N.bg)??k;b[p++]=z,b[p++]=J,b[p++]=M;const O=lr(N),w=Ct((O==null?void 0:O.name)??"empty"),C=h.get(w);wt(C)?b[p++]=C:(h.set(w,d),m.set(d,w),b[p++]=d++)}const v=s.x-i.x+1,T=s.y-i.y+1,A=new wB.OverlappingModel(b,St,Xt,n,v,T,!1,!1,r,0);let L=0;for(;L<Yk&&!A.generate();++L);if(L===Yk)return!1;p=0;const S=A.graphics();for(let I=i.y;I<=s.y;++I)for(let $=i.x;$<=s.x;++$){const N={x:$,y:I},z=S[p++],J=S[p++],M=S[p++];switch(d=S[p++],o){case"all":{const P=ie(u,{x:$,y:I});Ge(P)&&Tn(u,P,a.timestamp),Oe(u,{x:$,y:I});break}case"object":{const P=ie(u,{x:$,y:I});Ge(P)&&Tn(u,P,a.timestamp);break}case"terrain":Oe(u,{x:$,y:I});break}let O=m.get(d)??"";const w=lr({kind:O});switch(o){case"all":break;case"object":Ge(w)||(O="");break;case"terrain":Ge(w)&&(O="");break;default:if(zt(w,"group")!==o&&(O=""),O){const P=ie(u,{x:$,y:I});Ge(P)&&Tn(u,P,a.timestamp),Oe(u,{x:$,y:I})}break}const C=O?jr(u,[O],N):void 0;if(!(!y(C)||!y(w))&&(_o(C,w),z>0&&(C.char=z),J<k&&(C.color=J),M<k&&(C.bg=M),Ge(C))){const P=Sn(Da(f,O));y(P)&&(Oe(u,{...es(f,P.x??0,P.y??0),x:$,y:I}),_o(C,P))}}return!0}function Xk(e){return`zss_snapshot_${e}`}const qk={x:0,y:0},Jk={x:St-1,y:Xt-1},Zk="all";function xB(e){const t=en(E.book,bt.BOARD,e),n=Se(t);if(!y(n))return;const r=Xk(n.id);gk(E.book,r);const[i]=Qi(Dt.MAIN,r,bt.BOARD),s=Se(i);if(y(s))return Il(e,s.id,qk,Jk,Zk),s}function vB(e){const t=en(E.book,bt.BOARD,e),n=Se(t);if(!y(n))return;const r=Xk(n.id),i=en(E.book,bt.BOARD,r),s=Se(i);if(y(s))return Il(s.id,e,qk,Jk,Zk),s}function TB(e,t,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return AB(e,t,i,s)}if(!y(E.book))return;const o=E.book,a=en(o,bt.BOARD,e),c=Se(a);if(!y(c))return;const l=Ql();Re(c);for(let u=n.y;u<=r.y;++u)for(let f=n.x;f<=r.x;++f){let d=!1,h=!1;switch(s){case"all":d=!0,h=!0;break;case"object":d=!0;break;case"terrain":h=!0;break}const m=(f+t.x+St)%St,p=(u+t.y+Xt)%Xt;if(d){const k=ie(c,{x:f,y:u});Ge(k)&&y(k==null?void 0:k.x)&&y(k==null?void 0:k.y)&&(k.x=m,k.lx=m,k.y=p,k.ly=p)}h&&(l.terrain[m+p*St]=c.terrain[f+u*St])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),Ra(c)}function AB(e,t,n,r){if(!y(E.book))return;const i=E.book,s=en(i,bt.BOARD,e),o=Se(s);if(!y(o))return;Re(o);const{terrainelements:a,objectelements:c}=kk(o,n,r);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>dr({x:p.x??0,y:p.y??0},St)),f=[],d=[];for(let p=0;p<a.length;++p){const k=a[p],b={x:k.x??-1,y:k.y??-1},v=ie(o,b);y(v)&&Ge(v)&&(f.push(v.id??""),f.push(v.id??""),d.push(dr({x:v.x??0,y:v.y??0},St)))}let h=!1;for(let p=0;p<a.length;++p){const k=a[p],b=zt(k,"collision"),v={x:k.x??-1,y:k.y??-1},T=dr(v,St),A={x:v.x+t.x,y:v.y+t.y};if(tu(A)){const L=ie(o,A),S=(L==null?void 0:L.id)??"",I=dr({x:(L==null?void 0:L.x)??0,y:(L==null?void 0:L.y)??0},St),$=zt(L,"collision");if(y(L)&&Ge(L)&&f.includes(S)!==!0&&l.includes(S)!==!0){let N=!1;const z=d.includes(T),J=z?ie(o,v):void 0,M=z?zt(J,"pushable"):!1,O=z&&M;if(zt(L,"pushable")&&(b!==Gt.ISWALK||z)){let w=z;y(J)&&M&&(h=ts(i,o,J,{x:(J.x??0)-t.x,y:(J.y??0)-t.y})!==!0,h||(w=!1)),(w||b!==Gt.ISWALK)&&(h=ts(i,o,L,{x:(L.x??0)+t.x,y:(L.y??0)+t.y})!==!0,h&&(N=O))}else(b!==Gt.ISWALK||O)&&(h=!0,N=O);N&&y(J)&&(h=ts(i,o,J,{x:(J.x??0)-t.x,y:(J.y??0)-t.y})!==!0)}else $===Gt.ISSOLID&&u.includes(I)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const k=c[p],b=zt(k,"collision"),v={x:k.x??0,y:k.y??0},T={x:v.x+t.x,y:v.y+t.y};if(tu(T)){const A=ie(o,T),L=(A==null?void 0:A.id)??"",S=zt(A,"collision"),I=zt(A,"group");y(A)&&Ge(A)&&f.includes(L)&&l.includes(L)!==!0?zt(A,"pushable")?h=ts(i,o,A,T)!==!0:h=!0:Pa(b,S)&&r!==I&&(h=!0)}else h=!0}if(h)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const k=a[p],b={x:k.x??-1,y:k.y??-1},v={x:b.x+t.x,y:b.y+t.y},T=es(o,v.x,v.y);if(y(k)&&y(T)){Oe(o,{...k,x:v.x,y:v.y}),Oe(o,{...T,x:b.x,y:b.y});const A=ie(o,b);Ge(A)&&y(A)&&(A.x=(A.x??0)+t.x,A.y=(A.y??0)+t.y,A.lx=(A.lx??0)+t.x,A.ly=(A.ly??0)+t.y)}}Ra(o);for(let p=0;p<c.length;++p){const k=c[p],b={x:k.x??-1,y:k.y??-1},v={x:b.x+t.x,y:b.y+t.y};if(!ts(i,o,k,v))break}Ra(o)}function $l(e,t){let n="all";const r={x:0,y:0},i={x:St-1,y:Xt-1};for(let s=t;s<e.length;){const[o,a]=st(e,s,[H.MAYBE_NUMBER_OR_STRING]);if(gt(o))n=Ct(o),s=a;else if(wt(o)){const[c,l,u,f]=st(e,a,[H.NUMBER,H.MAYBE_NUMBER,H.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const SB=Ei().command("snapshot",()=>(!y(E.book)||!y(E.board)||xB(E.board.id),0)).command("revert",()=>(!y(E.book)||!y(E.board)||vB(E.board.id),0)).command("copy",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;const[n,r]=st(t,0,[H.STRING]),i=bookreadcodepagesbytypeandstat(E.book,bt.BOARD,n),s=Sn(...i);if(y(s)){const o=$l(t,r);Il(s.id,E.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;const[n,r,i,s]=st(t,0,[H.STRING,H.NUMBER,H.NUMBER]),o=bookreadcodepagesbytypeandstat(E.book,bt.BOARD,n),a=Sn(...o);if(y(a)){const c=$l(t,s);Vk(E.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!y(E.book)||!y(E.board))return 0;const[n,r]=st(t,0,[H.DIR]),i={x:n.destpt.x-(((o=E.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=E.element)==null?void 0:a.y)??0)},s=$l(t,r);return TB(E.board.id,i,s.pt1,s.pt2,E.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!y(E.book)||!y(E.board))return 0;const[n,r]=st(t,0,[H.NUMBER]),i=$l(t,r);return pB(E.board.id,pm(n),i.pt1,i.pt2,i.targetset),0});var Ji=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Ji||{});const RB={audio:Ih,board:PU,cli:PF,display:$F,element:YF,runtime:dB,loader:hB,network:fB,transform:SB},_d=["audio","board","display","network","transform","element"],OB={0:[],1:["cli",..._d],2:["loader",..._d],3:["runtime",..._d]},NB={0:new Map,1:new Map,2:new Map,3:new Map};function xo(e){return(OB[e]??[]).map(n=>RB[n]).filter(y)}function yd(e){const t=[],n=xo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function IB(e,t){const n=NB[e];if(!n.has(t)){let r;const i=xo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!y(r));++s);n.set(t,r)}return n.get(t)}function CB(e,t,n){const r=xo(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function LB(e,t,n,r){const i=xo(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function MB(e,t){const n=xo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function Qk(e,t){const n=xo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var tE={},eE={},nE={};const rE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");nE.encode=function(e){if(0<=e&&e<rE.length)return rE[e];throw new TypeError("Must be between 0 and 63: "+e)};const UB=nE,iE=5,sE=1<<iE,FB=sE-1,BB=sE;function PB(e){return e<0?(-e<<1)+1:(e<<1)+0}eE.encode=function(t){let n="",r,i=PB(t);do r=i&FB,i>>>=iE,i>0&&(r|=BB),n+=UB.encode(r);while(i>0);return n};var Ca={};(function(e){function t(S,I,$){if(I in S)return S[I];if(arguments.length===3)return $;throw new Error('"'+I+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const I=S.match(n);return I?{scheme:I[1],auth:I[2],host:I[3],port:I[4],path:I[5]}:null}e.urlParse=i;function s(S){let I="";return S.scheme&&(I+=S.scheme+":"),I+="//",S.auth&&(I+=S.auth+"@"),S.host&&(I+=S.host),S.port&&(I+=":"+S.port),S.path&&(I+=S.path),I}e.urlGenerate=s;const o=32;function a(S){const I=[];return function($){for(let z=0;z<I.length;z++)if(I[z].input===$){const J=I[0];return I[0]=I[z],I[z]=J,I[0].result}const N=S($);return I.unshift({input:$,result:N}),I.length>o&&I.pop(),N}}const c=a(function(I){let $=I;const N=i(I);if(N){if(!N.path)return I;$=N.path}const z=e.isAbsolute($),J=[];let M=0,O=0;for(;;)if(M=O,O=$.indexOf("/",M),O===-1){J.push($.slice(M));break}else for(J.push($.slice(M,O));O<$.length&&$[O]==="/";)O++;let w=0;for(O=J.length-1;O>=0;O--){const C=J[O];C==="."?J.splice(O,1):C===".."?w++:w>0&&(C===""?(J.splice(O+1,w),w=0):(J.splice(O,2),w--))}return $=J.join("/"),$===""&&($=z?"/":"."),N?(N.path=$,s(N)):$});e.normalize=c;function l(S,I){S===""&&(S="."),I===""&&(I=".");const $=i(I),N=i(S);if(N&&(S=N.path||"/"),$&&!$.scheme)return N&&($.scheme=N.scheme),s($);if($||I.match(r))return I;if(N&&!N.host&&!N.path)return N.host=I,s(N);const z=I.charAt(0)==="/"?I:c(S.replace(/\/+$/,"")+"/"+I);return N?(N.path=z,s(N)):z}e.join=l,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function u(S,I){S===""&&(S="."),S=S.replace(/\/$/,"");let $=0;for(;I.indexOf(S+"/")!==0;){const N=S.lastIndexOf("/");if(N<0||(S=S.slice(0,N),S.match(/^([^\/]+:\/)?\/*$/)))return I;++$}return Array($+1).join("../")+I.substr(S.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function h(S){return p(S)?"$"+S:S}e.toSetString=f?d:h;function m(S){return p(S)?S.slice(1):S}e.fromSetString=f?d:m;function p(S){if(!S)return!1;const I=S.length;if(I<9||S.charCodeAt(I-1)!==95||S.charCodeAt(I-2)!==95||S.charCodeAt(I-3)!==111||S.charCodeAt(I-4)!==116||S.charCodeAt(I-5)!==111||S.charCodeAt(I-6)!==114||S.charCodeAt(I-7)!==112||S.charCodeAt(I-8)!==95||S.charCodeAt(I-9)!==95)return!1;for(let $=I-10;$>=0;$--)if(S.charCodeAt($)!==36)return!1;return!0}function k(S,I,$){let N=v(S.source,I.source);return N!==0||(N=S.originalLine-I.originalLine,N!==0)||(N=S.originalColumn-I.originalColumn,N!==0||$)||(N=S.generatedColumn-I.generatedColumn,N!==0)||(N=S.generatedLine-I.generatedLine,N!==0)?N:v(S.name,I.name)}e.compareByOriginalPositions=k;function b(S,I,$){let N=S.generatedLine-I.generatedLine;return N!==0||(N=S.generatedColumn-I.generatedColumn,N!==0||$)||(N=v(S.source,I.source),N!==0)||(N=S.originalLine-I.originalLine,N!==0)||(N=S.originalColumn-I.originalColumn,N!==0)?N:v(S.name,I.name)}e.compareByGeneratedPositionsDeflated=b;function v(S,I){return S===I?0:S===null?1:I===null?-1:S>I?1:-1}function T(S,I){let $=S.generatedLine-I.generatedLine;return $!==0||($=S.generatedColumn-I.generatedColumn,$!==0)||($=v(S.source,I.source),$!==0)||($=S.originalLine-I.originalLine,$!==0)||($=S.originalColumn-I.originalColumn,$!==0)?$:v(S.name,I.name)}e.compareByGeneratedPositionsInflated=T;function A(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=A;function L(S,I,$){if(I=I||"",S&&(S[S.length-1]!=="/"&&I[0]!=="/"&&(S+="/"),I=S+I),$){const N=i($);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const z=N.path.lastIndexOf("/");z>=0&&(N.path=N.path.substring(0,z+1))}I=l(s(N),I)}return c(I)}e.computeSourceURL=L})(Ca);var bd={};let $B=class nw{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new nw;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};bd.ArraySet=$B;var oE={};const aE=Ca;function DB(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||aE.compareByGeneratedPositionsInflated(e,t)<=0}let jB=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){DB(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(aE.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};oE.MappingList=jB;const La=eE,qe=Ca,Dl=bd.ArraySet,zB=oE.MappingList;let cE=class rw{constructor(t){t||(t={}),this._file=qe.getArg(t,"file",null),this._sourceRoot=qe.getArg(t,"sourceRoot",null),this._skipValidation=qe.getArg(t,"skipValidation",!1),this._sources=new Dl,this._names=new Dl,this._mappings=new zB,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new rw({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=qe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=qe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=qe.getArg(t,"generated"),r=qe.getArg(t,"original",null);let i=qe.getArg(t,"source",null),s=qe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=qe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[qe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[qe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=qe.relative(s,i));const o=this._mappings.toArray().length>0?new Dl:this._sources,a=new Dl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=qe.join(r,c.source)),s!=null&&(c.source=qe.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=qe.join(r,c)),s!=null&&(c=qe.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,m=d.length;h<m;h++){if(l=d[h],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!qe.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=La.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=La.encode(f-o),o=f,c+=La.encode(l.originalLine-1-i),i=l.originalLine-1,c+=La.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=La.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=qe.relative(n,r));const i=qe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};cE.prototype._version=3,tE.SourceMapGenerator=cE;var lE={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(lE);var Ma={exports:{}},WB={},GB=Object.freeze({__proto__:null,default:WB}),uE=iw(GB);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Ma.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Ma.exports.initialize=t=>e=t}else{const e=uE,t=uE;Ma.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Ma.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var hE=Ma.exports;const KB=hE;function HB(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Ua=null;var YB=function(){if(Ua)return Ua;const t=[];return Ua=KB().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new HB;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Ua=null,n}),Ua};const Ot=Ca,kd=lE,jl=bd.ArraySet,VB=hE,XB=YB,Ed=Symbol("smcInternal");class He{constructor(t,n){return t==Ed?Promise.resolve(this):JB(t,n)}static initialize(t){VB.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return ZB(t,n)}static async with(t,n,r){const i=await new He(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}He.prototype._version=3,He.GENERATED_ORDER=1,He.ORIGINAL_ORDER=2,He.GREATEST_LOWER_BOUND=1,He.LEAST_UPPER_BOUND=2;class Fa extends He{constructor(t,n){return super(Ed).then(r=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version");let o=Ot.getArg(i,"sources");const a=Ot.getArg(i,"names",[]);let c=Ot.getArg(i,"sourceRoot",null);const l=Ot.getArg(i,"sourcesContent",null),u=Ot.getArg(i,"mappings"),f=Ot.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Ot.normalize(c)),o=o.map(String).map(Ot.normalize).map(function(d){return c&&Ot.isAbsolute(c)&&Ot.isAbsolute(d)?Ot.relative(c,d):d}),r._names=jl.fromArray(a.map(String),!0),r._sources=jl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return Ot.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,XB().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Ot.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Fa(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||He.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Ot.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case He.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case He.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Ot.getArg(t,"source");const r=Ot.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Ot.getArg(t,"bias",He.GREATEST_LOWER_BOUND);r==null&&(r=He.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Ot.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Ot.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Ot.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Ot.getArg(i,"originalLine",null),column:Ot.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Ot.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Ot.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Ot.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Ot.getArg(t,"line"),originalColumn:Ot.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Ot.getArg(t,"bias",He.GREATEST_LOWER_BOUND);i==null&&(i=He.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Ot.getArg(s,"generatedLine",null),column:Ot.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Fa.prototype.consumer=He;class qB extends He{constructor(t,n){return super(Ed).then(r=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version"),o=Ot.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new jl,r._names=new jl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Ot.getArg(c,"offset"),u=Ot.getArg(l,"line"),f=Ot.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new He(Ot.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Ot.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Ot.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")},r=kd.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Ot.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Ot.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||He.GENERATED_ORDER;let o;switch(s){case He.GENERATED_ORDER:o=this._generatedMappings;break;case He.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Ot.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return kd.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Ot.getArg(t,"line"),r={source:Ot.getArg(t,"source"),originalLine:n,originalColumn:Ot.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Ot.compareByOriginalPositions,kd.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function JB(e,t){let n=e;typeof e=="string"&&(n=Ot.parseSourceMapInput(e));const r=n.sections!=null?new qB(n,t):new Fa(n,t);return Promise.resolve(r)}function ZB(e,t){return Fa.fromSourceMap(e,t)}var fE={};const QB=tE.SourceMapGenerator,zl=Ca,tP=/(\r?\n)/,eP=10,vo="$$$isSourceNode$$$";let nP=class zd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[vo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new zd,s=t.split(tP);let o=0;const a=function(){const h=p(),m=p()||"";return h+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const m=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,m),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const m=n.sourceContentFor(h);m!=null&&(r!=null&&(h=zl.join(r,h)),i.setSourceContent(h,m))}),i;function d(h,m){if(h===null||h.source===void 0)i.add(m);else{const p=r?zl.join(r,h.source):h.source;i.add(new zd(h.originalLine,h.originalColumn,p,m,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[vo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[vo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[vo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[vo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[zl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][vo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(zl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new QB(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===eP?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};fE.SourceNode=nP;var rP=fE.SourceNode;let dE=0;const pE=Zr,iP=["Command","lines"];class sP extends WM{constructor(){super(ak,{traceInitPerf:Zr,skipValidations:!Zr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});xt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));xt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Ta)}])}));xt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));xt(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));xt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Bf)}));xt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Ff)}));xt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Ny)}])}));xt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Iy)}));xt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Cy),this.OPTION(()=>{this.SUBRULE(this.words)}),this.CONSUME(Ly)}));xt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(go),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));xt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));xt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Gf),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));xt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(V1),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));xt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Kf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));xt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Rl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Ta)),this.CONSUME4(go),this.CONSUME4(Hf)}}])}));xt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Rl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(go),this.CONSUME(Hf)}}])}));xt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Rl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));xt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(go),this.CONSUME(Yf),this.CONSUME(Kf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));xt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(go),this.CONSUME(Yf),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));xt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(tk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(ek),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(nk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(rk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(ik)}));xt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(sk)}));xt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(J1)}));xt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Z1)}));xt(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(Q1)}));xt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME($f),this.SUBRULE2(this.and_test)})}));xt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(jf),this.SUBRULE2(this.not_test)})}));xt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Df),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));xt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));xt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(P1)},{ALT:()=>this.CONSUME($1)},{ALT:()=>this.CONSUME(D1)},{ALT:()=>this.CONSUME(j1)},{ALT:()=>this.CONSUME(z1)},{ALT:()=>this.CONSUME(W1)}])}));xt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME($f),this.SUBRULE2(this.and_test_value)})}));xt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(jf),this.SUBRULE2(this.not_test_value)})}));xt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Df),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));xt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));xt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(zf)},{ALT:()=>this.CONSUME(Wf)}]),this.SUBRULE(this.term)}));xt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));xt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(K1)},{ALT:()=>this.CONSUME(Gf)},{ALT:()=>this.CONSUME(H1)},{ALT:()=>this.CONSUME(Y1)}]),this.SUBRULE(this.factor)}));xt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(zf)},{ALT:()=>this.CONSUME(Wf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));xt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(G1),this.SUBRULE(this.factor)})}));xt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));xt(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));xt(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(My)},{ALT:()=>this.CONSUME(Uy)}])}));xt(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(Fy)},{ALT:()=>this.CONSUME(By)},{ALT:()=>this.CONSUME(Py)},{ALT:()=>this.CONSUME($y)},{ALT:()=>this.CONSUME(Dy)},{ALT:()=>this.CONSUME(jy)},{ALT:()=>this.CONSUME(zy)},{ALT:()=>this.CONSUME(Wy)}])}));xt(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(Gy)},{ALT:()=>this.CONSUME(Ky)},{ALT:()=>this.CONSUME(Hy)},{ALT:()=>this.CONSUME(Yy)},{ALT:()=>this.CONSUME(Vy)},{ALT:()=>this.CONSUME(Xy)},{ALT:()=>this.CONSUME(qy)},{ALT:()=>this.CONSUME(Jy)},{ALT:()=>this.CONSUME(Zy)},{ALT:()=>this.CONSUME(Qy)},{ALT:()=>this.CONSUME(tb)},{ALT:()=>this.CONSUME(eb)},{ALT:()=>this.CONSUME(nb)},{ALT:()=>this.CONSUME(rb)},{ALT:()=>this.CONSUME(ib)},{ALT:()=>this.CONSUME(sb)},{ALT:()=>this.CONSUME(ob)},{ALT:()=>this.CONSUME(ab)},{ALT:()=>this.CONSUME(cb)},{ALT:()=>this.CONSUME(lb)},{ALT:()=>this.CONSUME(ub)},{ALT:()=>this.CONSUME(hb)},{ALT:()=>this.CONSUME(fb)},{ALT:()=>this.CONSUME(db)},{ALT:()=>this.CONSUME(pb)},{ALT:()=>this.CONSUME(mb)},{ALT:()=>this.CONSUME(gb)},{ALT:()=>this.CONSUME(_b)},{ALT:()=>this.CONSUME(yb)},{ALT:()=>this.CONSUME(bb)},{ALT:()=>this.CONSUME(kb)},{ALT:()=>this.CONSUME(Eb)},{ALT:()=>this.CONSUME(wb)},{ALT:()=>this.CONSUME(xb)},{ALT:()=>this.CONSUME(vb)},{ALT:()=>this.CONSUME(Tb)},{ALT:()=>this.CONSUME(Ab)},{ALT:()=>this.CONSUME(Sb)},{ALT:()=>this.CONSUME(Rb)},{ALT:()=>this.CONSUME(Ob)},{ALT:()=>this.CONSUME(Nb)},{ALT:()=>this.CONSUME(Ib)},{ALT:()=>this.CONSUME(Cb)},{ALT:()=>this.CONSUME(Lb)},{ALT:()=>this.CONSUME(Mb)},{ALT:()=>this.CONSUME(Ub)},{ALT:()=>this.CONSUME(Fb)}])}));xt(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Xb)},{ALT:()=>this.CONSUME(qb)},{ALT:()=>this.CONSUME(Jb)},{ALT:()=>this.CONSUME(Zb)},{ALT:()=>this.CONSUME(_1)},{ALT:()=>this.CONSUME(y1)}])}));xt(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(Bb)},{ALT:()=>this.CONSUME(Pb)},{ALT:()=>this.CONSUME($b)},{ALT:()=>this.CONSUME(Db)},{ALT:()=>this.CONSUME(jb)},{ALT:()=>{this.CONSUME(zb),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}},{ALT:()=>{this.CONSUME(Wb),this.SUBRULE3(this.simple_token),this.SUBRULE4(this.simple_token)}},{ALT:()=>{this.CONSUME(Qb),this.SUBRULE5(this.simple_token),this.SUBRULE6(this.simple_token)}},{ALT:()=>{this.CONSUME(t1),this.SUBRULE7(this.simple_token),this.SUBRULE8(this.simple_token)}},{ALT:()=>this.CONSUME(Gb)},{ALT:()=>this.CONSUME(Kb)},{ALT:()=>this.CONSUME(Hb)},{ALT:()=>this.CONSUME(Yb)},{ALT:()=>this.CONSUME(Vb)},{ALT:()=>{this.CONSUME(e1),this.SUBRULE1(this.kind)}},{ALT:()=>{this.CONSUME(n1),this.SUBRULE2(this.kind)}},{ALT:()=>{this.CONSUME(r1),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}},{ALT:()=>this.CONSUME(i1)},{ALT:()=>this.CONSUME(s1)},{ALT:()=>this.CONSUME(o1)},{ALT:()=>this.CONSUME(a1)},{ALT:()=>this.CONSUME(c1)},{ALT:()=>this.CONSUME(l1)},{ALT:()=>this.CONSUME(u1)},{ALT:()=>this.CONSUME(h1)},{ALT:()=>this.CONSUME(f1)},{ALT:()=>this.CONSUME(d1)},{ALT:()=>this.CONSUME(p1)},{ALT:()=>this.CONSUME(m1)},{ALT:()=>this.CONSUME(g1)}])}));xt(this,"expr_any",this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])}));xt(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(w1),this.SUBRULE(this.expr_any)}));xt(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(x1),this.SUBRULE(this.expr_any)}));xt(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(v1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(T1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(A1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(S1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(R1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));xt(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(O1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(N1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(I1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME(C1),this.SUBRULE(this.simple_token),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(L1),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));xt(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(M1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));xt(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME(U1),this.SUBRULE(this.string_token)}));xt(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(F1),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));xt(this,"token_expr",this.RULED("token_expr",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(b1)},{ALT:()=>this.CONSUME(k1)},{ALT:()=>this.CONSUME(E1)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])})}));xt(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Sl)}])}));xt(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(Pf)},{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Sl)}])}));xt(this,"simple_tokens",this.RULED("simple_tokens",()=>{this.AT_LEAST_ONE(this.simple_token)}));xt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.token_expr)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(Bf)},{ALT:()=>this.CONSUME(Sl)},{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Pf)},{ALT:()=>this.CONSUME(B1)},{ALT:()=>{this.CONSUME(X1),this.SUBRULE(this.expr),this.CONSUME(q1)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=iP.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(dE++).toString().padStart(3),c=s?"font-weight: bold;":"";if(pE&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),pE&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),dE--},i)}}const To=new sP;if(oS){const e=To.getGAstProductions(),t=eU(e);console.info(t)}const oP=To.getBaseCstVisitorConstructor();var Et=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(Et||{}),Is=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Is||{}),li=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(li||{}),Wl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Wl||{});function Nt(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class aP extends oP{constructor(){super();xt(this,"unique",0);Zr&&this.validateVisitor()}visit(n){if(ue(n)&&(n=n[0]),!!y(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createtemplatenode(n,r){return this.createcodenode(n,{type:12,literal:2,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():y(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.stmt_command?this.go(n.stmt_command):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}inline(n){return n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.stmt_command?this.go(n.stmt_command):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.structured_cmd?this.go(n.structured_cmd):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Nt(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Nt(n.token_stat,"@").slice(1)}))}stmt_text(n,r){const i=Nt(n.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:i}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Nt(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:Nt(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n,r){return n.structured_cmd?this.go(n.structured_cmd):this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:[this.go(n.string_token),this.go(n.dir)].flat()})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:[this.go(n.string_token),this.go(n.dir)].flat()})):[]}command_if(n,r){const[i]=this.createlogicnode(r,Nt(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=De(),s=De();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=De(),s=De();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,Nt(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){const i=[];return n.words&&i.push(...this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))),n.command_fork&&i.push(...this.go(n.command_fork)),this.createcodenode(r,{type:17,lines:i})}command_while(n,r){const i=De(),s=De();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=De(),s=De(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=De(),s=De(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=De();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=Nt(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}command_toast(n,r){const s=Nt(n.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(r,"toast"),this.createtemplatenode(r,s)].flat()}command_ticker(n,r){const s=Nt(n.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(r,"ticker"),this.createtemplatenode(r,s)].flat()}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}kind(n){return[this.go(n.color),this.go(n.string_token)].flat()}category(n,r){if(n.token_isterrain){const i=Nt(n.token_isterrain,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isobject){const i=Nt(n.token_isobject,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}collision(n,r){if(n.token_iswalkable){const i=Nt(n.token_iswalkable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalking){const i=Nt(n.token_iswalking,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalk){const i=Nt(n.token_iswalk,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimmable){const i=Nt(n.token_isswimmable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimming){const i=Nt(n.token_isswimming,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswim){const i=Nt(n.token_isswim,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_issolid){const i=Nt(n.token_issolid,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isbullet){const i=Nt(n.token_isbullet,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}color(n,r){let i="ERROR";return n.token_black&&(i="black"),n.token_dkblue&&(i="dkblue"),n.token_dkgreen&&(i="dkgreen"),n.token_dkcyan&&(i="dkcyan"),n.token_dkred&&(i="dkred"),n.token_dkpurple&&(i="dkpurple"),n.token_dkyellow&&(i="dkyellow"),n.token_ltgray&&(i="ltgray"),n.token_dkgray&&(i="dkgray"),n.token_blue&&(i="blue"),n.token_green&&(i="green"),n.token_cyan&&(i="cyan"),n.token_red&&(i="red"),n.token_purple&&(i="purple"),n.token_yellow&&(i="yellow"),n.token_white&&(i="white"),n.token_brown&&(i="brown"),n.token_dkwhite&&(i="dkwhite"),n.token_ltgrey&&(i="ltgrey"),n.token_gray&&(i="gray"),n.token_grey&&(i="grey"),n.token_dkgrey&&(i="dkgrey"),n.token_ltblack&&(i="ltblack"),n.token_onblack&&(i="onblack"),n.token_ondkblue&&(i="ondkblue"),n.token_ondkgreen&&(i="ondkgreen"),n.token_ondkcyan&&(i="ondkcyan"),n.token_ondkred&&(i="ondkred"),n.token_ondkpurple&&(i="ondkpurple"),n.token_ondkyellow&&(i="ondkyellow"),n.token_onltgray&&(i="onltgray"),n.token_ondkgray&&(i="ondkgray"),n.token_onblue&&(i="onblue"),n.token_ongreen&&(i="ongreen"),n.token_oncyan&&(i="oncyan"),n.token_onred&&(i="onred"),n.token_onpurple&&(i="onpurple"),n.token_onyellow&&(i="onyellow"),n.token_onwhite&&(i="onwhite"),n.token_onbrown&&(i="onbrown"),n.token_ondkwhite&&(i="ondkwhite"),n.token_onltgrey&&(i="onltgrey"),n.token_ongray&&(i="ongray"),n.token_ongrey&&(i="ongrey"),n.token_ondkgrey&&(i="ondkgrey"),n.token_onltblack&&(i="onltblack"),n.token_onclear&&(i="onclear"),this.createcodenode(r,{type:12,literal:1,value:i})}dir_mod(n,r){let i="ERROR";return n.token_cw&&(i="cw"),n.token_ccw&&(i="ccw"),n.token_opp&&(i="opp"),n.token_rndp&&(i="rndp"),n.token_over&&(i="over"),n.token_under&&(i="under"),this.createcodenode(r,{type:12,literal:1,value:i})}dir(n,r){const i=this.go(n.dir_mod)??[];return n.token_i&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_i,"")})),n.token_idle&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_idle,"")})),n.token_n&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_n,"")})),n.token_u&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_u,"")})),n.token_north&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_north,"")})),n.token_up&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_up,"")})),n.token_s&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_s,"")})),n.token_d&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_d,"")})),n.token_south&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_south,"")})),n.token_down&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_down,"")})),n.token_w&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_w,"")})),n.token_l&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_l,"")})),n.token_west&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_west,"")})),n.token_e&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_e,"")})),n.token_r&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_r,"")})),n.token_east&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_east,"")})),n.token_right&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_right,"")})),n.token_rnd&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rnd"})),n.token_rndne&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rndne"})),n.token_rndns&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rndtoken_rndns"})),n.token_by&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_by,"")}),...this.go(n.simple_token)),n.token_at&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_at,"")}),...this.go(n.simple_token)),n.token_away&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_away,"")}),...this.go(n.simple_token)),n.token_toward&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_toward,"")}),...this.go(n.simple_token)),n.token_find&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_find,"")}),...this.go(n.kind)),n.token_flee&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_flee,"")}),...this.go(n.kind)),n.token_to&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Nt(n.token_to,"")}),...this.go(n.dir)),i.flat()}expr_any(n){return[this.go(n.dir),this.go(n.kind),this.go(n.color)].flat()}token_expr_any(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"any"}),this.go(n.expr_any)].flat()}token_expr_count(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"count"}),this.go(n.expr_any)].flat()}token_expr_abs(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"abs"}),...this.go(n.simple_token)]}token_expr_intceil(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intceil"}),...this.go(n.simple_token)]}token_expr_intfloor(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intfloor"}),...this.go(n.simple_token)]}token_expr_intround(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intround"}),...this.go(n.simple_token)]}token_expr_clamp(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"clamp"}),...this.go(n.simple_token)]}token_expr_min(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"min"}),...this.go(n.simple_tokens)]}token_expr_max(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"max"}),...this.go(n.simple_tokens)]}token_expr_pick(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pick"}),...this.go(n.simple_tokens)]}token_expr_pickwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pickwith"}),...this.go(n.simple_tokens)]}token_expr_random(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"random"}),...this.go(n.simple_token)]}token_expr_randomwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"randomwith"}),...this.go(n.simple_token)]}token_expr_run(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"run"}),...this.go(n.string_token)]}token_expr_runwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"runwith"}),...this.go(n.simple_token),...this.go(n.string_token)]}token_expr(n,r){const i=[];return n.token_expr_aligned&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"aligned"})),n.token_contact&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"contact"})),n.token_blocked&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"blocked"})),n.token_expr_any?this.go(n.token_expr_any):n.token_expr_count?this.go(n.token_expr_count):n.token_expr_abs?this.go(n.token_expr_abs):n.token_expr_intceil?this.go(n.token_expr_intceil):n.token_expr_intfloor?this.go(n.token_expr_intfloor):n.token_expr_intround?this.go(n.token_expr_intround):n.token_expr_clamp?this.go(n.token_expr_clamp):n.token_expr_min?this.go(n.token_expr_min):n.token_expr_max?this.go(n.token_expr_max):n.token_expr_pick?this.go(n.token_expr_pick):n.token_expr_pickwith?this.go(n.token_expr_pickwith):n.token_expr_random?this.go(n.token_expr_random):n.token_expr_randomwith?this.go(n.token_expr_randomwith):n.token_expr_run?this.go(n.token_expr_run):n.token_expr_runwith?this.go(n.token_expr_runwith):i}string_token(n,r){if(n.token_stringliteraldouble){const i=Nt(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Nt(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}simple_token(n,r){if(n.token_stringliteraldouble){const i=Nt(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Nt(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Nt(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return[]}simple_tokens(n,r){if(n.token_stringliteraldouble){const i=Nt(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Nt(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Nt(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return[]}token(n,r){if(n.category)return this.go(n.category);if(n.collision)return this.go(n.collision);if(n.color)return this.go(n.color);if(n.dir)return this.go(n.dir);if(n.token_expr)return this.go(n.token_expr);if(n.command_play)return this.go(n.command_play);if(n.command_toast)return this.go(n.command_toast);if(n.command_ticker)return this.go(n.command_ticker);if(n.token_label){const i=Nt(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=Nt(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Nt(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Nt(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}if(n.token_lparen)return this.createcodenode(r,{type:31,words:this.go(n.expr)});if(n.token_stop){const i=Nt(n.token_stop,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}}const cP=new aP,Xn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Gl="zss.js";function re(e,t){return new rP(e.startLine??1,e.startColumn??1,Gl,t)}function wd(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function xd(e){return`'${wd(e)}'`}function vd(e){const t=ud(e);return t.errors.length?e:`['${t.tokens.map(r=>{if(r.tokenType===cd){const i=wd(r.image.substring(1));return Ct(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return wd(r.image)}).join("")}'].join('')`}function Ao(e){return e.filter(t=>t!==void 0).map(ae)}function mE(e){return re(e,"")}function lP(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function rn(e,t,n){return re(e,[`api.${t}(`,...lP(n,", "),")"])}function uP(e){if(e.type===Et.COMPARE&&e.compare.type===Et.COMPARE_ITEM)switch(e.compare.method){case Is.IS_EQ:return rn(e,"isEq",[ae(e.lhs),ae(e.rhs)]);case Is.IS_NOT_EQ:return rn(e,"isNotEq",[ae(e.lhs),ae(e.rhs)]);case Is.IS_LESS_THAN:return rn(e,"isLessThan",[ae(e.lhs),ae(e.rhs)]);case Is.IS_GREATER_THAN:return rn(e,"isGreaterThan",[ae(e.lhs),ae(e.rhs)]);case Is.IS_LESS_THAN_OR_EQ:return rn(e,"isLessThanOrEq",[ae(e.lhs),ae(e.rhs)]);case Is.IS_GREATER_THAN_OR_EQ:return rn(e,"isGreaterThanOrEq",[ae(e.lhs),ae(e.rhs)])}return re(e,"")}function Cs(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ae(n),")"])}function gE(e,t,n){return e.prepend(`api.${t}(`),e.add([ae(n),")"])}function hP(e,t){if(e.type===Et.OPERATOR_ITEM)switch(e.operator){case li.PLUS:return Cs(t,"opPlus",e.rhs);case li.MINUS:return Cs(t,"opMinus",e.rhs);case li.POWER:return Cs(t,"opPower",e.rhs);case li.MULTIPLY:return Cs(t,"opMultiply",e.rhs);case li.DIVIDE:return Cs(t,"opDivide",e.rhs);case li.MOD_DIVIDE:return Cs(t,"opModDivide",e.rhs);case li.FLOOR_DIVIDE:return Cs(t,"opFloorDivide",e.rhs);case li.UNI_PLUS:return gE(t,"opUniPlus",e.rhs);case li.UNI_MINUS:return gE(t,"opUniMinus",e.rhs)}return re(e,"")}function fP(e){if(e.type===Et.OPERATOR){const t=e.lhs?ae(e.lhs):re(e,"");return e.items.forEach(n=>hP(n,t)),t}return re(e,"")}function Kl(e,t){return re(e,[rn(e,"jump",[`${t}`]),"; continue;"])}function Li(e){return Xn.linelookup[e??""]??-1}function Td(e,t){Xn.linelookup[e]=t}function So(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case Et.WHILE:case Et.REPEAT:case Et.FOREACH:case Et.ELSE_IF:i.type===t&&(i.done=n);break;case Et.IF_BLOCK:case Et.IF_CHECK:i.type===t&&(i.skip=n);break;case Et.LINE:So(i.stmts,t,n);break}}}function _E(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case Et.WHILE:case Et.REPEAT:case Et.FOREACH:case Et.ELSE_IF:i.type===t&&Td(i.done,n);break;case Et.IF_BLOCK:case Et.IF_CHECK:i.type===t&&Td(i.skip,n);break;case Et.LINE:_E(i.stmts,t,n);break}}}function ae(e){var t;switch(e.type){case Et.PROGRAM:return re(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ae).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Gl}`]);case Et.API:return re(e,["  ",rn(e,e.method,Ao(e.words)),`;
`]);case Et.LINE:return re(e,[`case ${e.lineindex}:
`,...e.stmts.map(ae).flat(),`  break;
`]);case Et.MARK:return re(e,`  // ${e.comment}
`);case Et.GOTO:{const n=Li(e.id);return re(e,["  ",Kl(e,n),`
`])}case Et.COUNT:return re(e,`${e.index}`);case Et.LITERAL:switch(e.literal){case Wl.NUMBER:return re(e,`${e.value}`);case Wl.STRING:return re(e,xd(e.value));case Wl.TEMPLATE:return re(e,vd(e.value))}return mE(e);case Et.TEXT:return re(e,["  ",rn(e,"text",[vd(e.value)]),`;
`]);case Et.STAT:if(Xn.isfirststat){Xn.isfirststat=!1;const n=e.value.trim().split(" ").map(xd);return re(e,["  ",rn(e,"stat",n),`;
`])}return re(e,`  // skipped ${e.value}
`);case Et.LABEL:{const n=Ct(e.name),r=e.active?"label":"comment";Xn.labels[n]||(Xn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Xn.labels[n].push(i),re(e,`  // ${i} '${n}' ${r}
`)}case Et.HYPERLINK:return re(e,["  ",rn(e,"hyperlink",[vd(e.text),...Ao(e.link)]),`;
`]);case Et.MOVE:{const n=rn(e,"command",[xd("go"),Ao(e.words)].flat());return e.wait?re(e,["  if (",n,`) { continue; };
`]):re(e,["  ",n,`;
`])}case Et.COMMAND:return re(e,["  if (",rn(e,"command",Ao(e.words)),`) { continue; };
`]);case Et.IF:{const n=((t=e.block)==null?void 0:t.type)===Et.IF_BLOCK?e.block:void 0;if(y(n)){So([e.check],Et.IF_CHECK,n.skip);const r=re(e,ae(e.check));return n.lines.forEach(i=>r.add(ae(i))),_E(n.altlines,Et.ELSE_IF,Li(n.done)),n.altlines.forEach(i=>r.add(ae(i))),r}return re(e,ae(e.check))}case Et.IF_CHECK:{const n=Li(e.skip);return n===-1?re(e,["  ",rn(e,e.method,Ao(e.words)),`;
`]):re(e,["  if (!",rn(e,e.method,Ao(e.words)),") { ",Kl(e,n),` }
`])}case Et.ELSE_IF:case Et.ELSE:{const n=re(e,"");return e.lines.forEach(r=>n.add(ae(r))),n}case Et.WHILE:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return So(e.lines,Et.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case Et.BREAK:s.goto=r;break;case Et.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case Et.REPEAT:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return So(e.lines,Et.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case Et.BREAK:s.goto=r;break;case Et.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case Et.WAITFOR:{const n=re(e,"");return So(e.lines,Et.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ae(r))}),n}case Et.FOREACH:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return So(e.lines,Et.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case Et.BREAK:s.goto=r;break;case Et.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case Et.BREAK:return re(e,["  ",Kl(e,e.goto),`
`]);case Et.CONTINUE:return re(e,["  ",Kl(e,e.goto),`
`]);case Et.OR:return rn(e,"or",e.items.map(ae));case Et.AND:return rn(e,"and",e.items.map(ae));case Et.NOT:return rn(e,"not",e.items.map(ae));case Et.COMPARE:return uP(e);case Et.OPERATOR:return fP(e);case Et.EXPR:return rn(e,"expr",e.words.map(ae));default:return console.error("<unsupported node>",e.type,e),mE(e)}}function ui(e){if(y(e))switch(e.type===Et.LINE&&++Xn.lineindex,e.lineindex=Xn.lineindex,e.type){case Et.PROGRAM:e.lines.forEach(ui);break;case Et.LINE:e.stmts.forEach(ui);break;case Et.MARK:Td(e.id,e.lineindex);break;case Et.IF:ui(e.check),ui(e.block);break;case Et.IF_BLOCK:e.lines.forEach(ui),e.altlines.forEach(ui);break;case Et.ELSE_IF:e.lines.forEach(ui);break;case Et.ELSE:case Et.WHILE:case Et.REPEAT:case Et.FOREACH:case Et.WAITFOR:e.lines.forEach(ui);break;case Et.MOVE:case Et.COMMAND:case Et.IF_CHECK:e.words.forEach(ui);break}}function dP(e){Xn.labels={},Xn.internal=1,Xn.lineindex=0,Xn.isfirststat=!0,ui(e)}function pP(e){return dP(e),{...ae(e).toStringWithSourceMap({file:`${Gl}.map`}),...Xn}}function yE(e){return ue(e)?e.length>0?1:0:e??0}function mP(e){return`${e}_chip`}function bE(e=""){return`vm:${e??""}`}function gP(e,t,n){var l,u;const r=mP(e),i=xr(r);let s;const o=Tr(Object.entries(n.labels??{}));(!ue(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){E.words=d;const h=IB(t,f);return y(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){IP(r)},id(){return e},set(f,d){const[h,m]=LB(t,c,f,d);if(h)return m},get(f){const[d,h]=CB(t,c,f);if(d)return h},tick(f){const d=wt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return Qk(t,c),!1;i.lc=0,i.ys=0,E.get=c.get,MB(t,c);try{const m=s==null?void 0:s.next();m!=null&&m.done&&(i.es=1)}catch(m){de(nt,E.elementfocus,"crash",m.message),i.es=1}return Qk(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return wt(i.lc)?++i.lc>ki.HALT_AT_COUNT:!0},hm(){if(ue(i.mg)&&ue(i.lb)){const[f]=i.mg;if(y(f))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return m.find(p=>wt(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,m){nt.emit(f,`${bE(d)}:${h}`,m)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const m=h[1].findIndex(p=>p>0);if(m>=0&&y(h[1])){h[1][m]*=-1;break}}}},restore(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let m=0;m<h[1].length;m++)h[1][m]=Math.abs(h[1][m])}},getcase(){i.ec=wt(i.ec)?i.ec:1;const f=c.hm();if(f&&ue(i.mg)){const[,d,h,m]=i.mg;c.set("sender",h),y(d)&&c.set("arg",d),m&&(c.set("player",m),E.elementfocus=m),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=wt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=VA.parse(f),[h]=d.filter(m=>m.fileName===Gl);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(Ct(Te(d)),h)},if(...f){const[d,h]=st(f,0,[H.ANY]),m=yE(d);return m&&h<f.length&&c.command(...f.slice(h)),m?1:0},try(...f){const[,d]=st(f,0,[H.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,m]=st(f,0,[H.NAME,H.ANY]),p=wt(h),k=p?m:1,b=c.get(d),v=p?h:1;if(!wt(b))return k<f.length&&c.command(...f.slice(k)),1;const T=b-v;return T<0?(k<f.length&&c.command(...f.slice(k)),1):(c.set(d,T),0)},give(...f){const[d,h,m]=st(f,0,[H.NAME,H.ANY]),p=wt(h),k=p?m:1,b=c.get(d),v=p?h:1,T=b===void 0?1:0;return T&&k<f.length&&c.command(...f.slice(k)),c.set(d,Qo(b,0)+v),T},repeatstart(f,...d){const[h,m]=st(d,0,[H.NUMBER]),p=`repeatcount${f}`,k=`repeatwords${f}`;i[p]=h,i[k]=m<d.length?d.slice(m):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!wt(i[d]))return 0;const m=i[d];i[d]=m-1;const p=m>0,k=i[h];return p&&ue(k)&&c.command(...k),p?1:0},foreachstart(f,...d){const[h,m,p,k]=st(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let b=Math.min(m,p),v=Math.max(m,p);const T=(k??0)||1;if(T<0){const A=b;b=v,v=A}return c.set(h,b-T),0},foreach(f,...d){const[h,m,p,k,b]=st(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let v=Math.min(m,p),T=Math.max(m,p);const A=(k??0)||1;if(A<0){const I=v;v=T,T=I}let L=c.get(h);!wt(L)||L<v||L>T?L=v:L+=A;const S=L<=T?1:0;return S&&(c.set(h,L),b<d.length&&c.command(...d.slice(b))),S},waitfor(...f){const[d]=st(f,0,[H.ANY]),h=yE(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=st(f,h,[H.ANY]);if(d=m,d)break;h=p}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=st(f,h,[H.ANY]);if(d=m,!d)break;h=p}return d},not(...f){const[d]=st(f,0,[H.ANY]);return d?0:1},expr(...f){const[d]=st(f,0,[H.ANY]);return d},isEq(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return typeof h=="object"||typeof m=="object"?Bw(h,m)?1:0:h===m?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h<m?1:0},isGreaterThan(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h>m?1:0},isLessThanOrEq(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h<=m?1:0},isGreaterThanOrEq(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h>=m?1:0},opPlus(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return h+m},opMinus(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return h-m},opPower(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return Math.pow(h,m)},opMultiply(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h*m},opDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h/m},opModDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h%m},opFloorDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return Math.floor(h/m)},opUniPlus(f){const[d]=st([f],0,[H.NUMBER]);return+d},opUniMinus(f){const[d]=st([f],0,[H.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function Ad(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ue(r)?r.forEach(i=>{t.push(Ad(i))}):t.push(Ad(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function _P(e){const t=ck(`${e}
`);if(t.errors.length>0)return t;To.input=t.tokens;const n=To.program();if(To.errors.length>0)return{tokens:t.tokens,errors:To.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=cP.go(n);return r?(Ad(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Sd=Object.getPrototypeOf(function*(){}).constructor;function yP(e,t){const n=`compile-${e}`;console.time(n);const r=_P(t);if(console.timeEnd(n),Rm&&console.info(t,r.errors),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=pP(r.ast);if(i.code){Rm&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Sd("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Sd("api"," ")}}}return{...r,...i,source:"",code:new Sd("api"," ")}}function bP(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=yP(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return y(s)?s.isended():!0},halt(i){const s=t[i];return y(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];y(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!y(t[i])){const f=n(a,c);if(l=t[i]=gP(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((b,v)=>[b,v]);m.slice(h-5,h).forEach(([b,v])=>{de(nt,cr(),"build",`$grey${v+1} $grey${b}`)});const[p,k]=m[h]??[];if(gt(p)&&y(k)){const b=(d.column??1)-1,v=b+d.length,T=b<p.length?p:`${p}*`,A=T.substring(0,b),L=T.substring(b,v),S=T.substring(v);de(nt,cr(),"build",`$red${k+1} $grey${A}$red${L}$grey${S}`)}return d.message.split(`
`).forEach(b=>{de(nt,cr(),"build",b)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=$n(i.target),a=t[s];if(y(a)){const c={...i,target:o};a.message(c)}}};return r}const vn=new Vo,Ln={},Hl={};function kE(e,t,n,r,i,s=0){const o=`tiles:${e}:${t}`;return y(Ln[o])||(Ln[o]=JA(e,t,n,r,i,s)),Ln[o]}function kP(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return y(Hl[s])||(Hl[s]=ZA(e,t,n)),Hl[s].id=i,Hl[s]}function EP(e,t){const n=`sprites:${e}:${t}`;return y(Ln[n])||(Ln[n]=QA(e,t)),Ln[n]}function wP(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return y(Ln[s])||(Ln[s]=tS(e,t,n,r,i)),Ln[s]}function Yl(e,t,n,r){const i=`media:${e}:${t}`;y(Ln[i])||(Ln[i]=eS(e,t,n,r));const s=Ln[i];return s.mime=n,s.media=r,s}function xP(e,t){const n=`control:${e}:${t}`;return y(Ln[n])||(Ln[n]=nS(e,t)),Ln[n]}const Zi=3;function EE(e,t){const n=[],r=(e.x+.5)*ji,i=(e.y+.5)*zi,s=t.x*ji,o=t.y*zi,a=s-r,c=o-i;vn.x=a-Zi,vn.y=c-Zi,n.push(vn.angle()),vn.x=a+ji+Zi,vn.y=c-Zi,n.push(vn.angle()),vn.x=a-Zi,vn.y=c+zi+Zi,n.push(vn.angle()),vn.x=a+ji+Zi,vn.y=c+zi+Zi,n.push(vn.angle());const l=n.map(h=>Math.round(mm(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(b=>b<180),m=l.filter(b=>b>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,f]}function Vl(e,t,n,r,i,s,o,a,c){var T;const l={x:a,y:c},u=zr(e,l);if(u===-1)return;vn.x=a-i.x,vn.y=Math.round((c-i.y)*1.333);const f=vn.length();if(f>s)return;const d=Math.round(mm(vn.angle()));let h=0;for(let A=0;A<n.length;++A){const[L,S,I]=n[A];L>S?(d>=L||d<=S)&&(h=Math.max(h,I)):d>=L&&d<=S&&(h=Math.max(h,I))}const m=s*.5;t[u]=Math.min(t[u],h+(f<m?0:(f-m)*o)),t[u]=gn(t[u],0,1);const p=Un(e,((T=e.lookup)==null?void 0:T[u])??"");if(y(p)){const A=[...EE(i,l),.25];r.push(A)}const k=e.terrain[u],b=lr(k),v=(k==null?void 0:k.collision)??(b==null?void 0:b.collision);if(Pa(Gt.ISBULLET,v)){const A=[...EE(i,l),1];r.push(A)}}function Rd(e,t,n,r,i,s){if(!y(n)||!y(n.terrain)||!y(n.objects))return[];const o=[];let a=t;const c=St,l=Xt,u=s?Mt.BLACK:Mt.ONCLEAR,f=kE(e,a++,"terrain",c,l,u);o.push(f);const d=a++,h=EP(e,d);h.sprites=[],o.push(h);const m=n.isdark?1:0,p=wP(e,a++,c,l,m);o.push(p),p.alphas.fill(m);const k=kE(e,a++,"tickers",c,l,Mt.ONCLEAR);o.push(k),k.char.fill(0);const b={...hd(St,Xt,r,Mt.ONCLEAR),...k},v=xP(e,a++);if(i){o.push(v);const{graphics:$,camera:N,facing:z}=xr(e),J=n.graphics??$??"",M=n.camera??N??"",O=n.facing??z??"";if(gt(J)){const w=Ct(J);switch(w){case"fpv":case"iso":case"mode7":v.graphics=w;break;default:case"flat":v.graphics="flat";break}}if(gt(M))switch(Ct(M)){default:case"mid":v.viewscale=Nc.MID;break;case"near":v.viewscale=Nc.NEAR;break;case"far":v.viewscale=Nc.FAR;break}wt(O)&&(v.facing=pm(O%360))}for(let $=0;$<n.terrain.length;++$){const N=n.terrain[$],z=nn(N,0,Mt.WHITE,s?Mt.BLACK:Mt.ONCLEAR),J=zt(N,"collision");f.char[$]=z.char,f.color[$]=z.color,f.bg[$]=z.bg,f.wall[$]=J===Gt.ISSOLID?1:0}const T=Object.values(n.objects??{}),A=new Set;for(let $=0;$<T.length;++$){const N=T[$];bn(N.id)&&wt(N.x)&&wt(N.y)&&A.add(dr(N,St))}for(let $=0;$<T.length;++$){const N=T[$];if(gt(N.tickertext)&&wt(N.tickertime)&&N.tickertext.length){const O=St,w=Nk(N.tickertext,O,Xt-1),C=(w==null?void 0:w.measuredwidth)??1,P=N.x??0,F=N.y??0,ot=F<Xt*.5;b.x=P-Math.floor(C*.5),b.y=F+(ot?1:-1),b.x+C>St&&(b.x=St-C),b.x<0&&(b.x=0),Ok(N.tickertext,b,!0)}if(y(N.removed))continue;const z=N.id??"";if(bn(z)===!1&&wt(N.x)&&wt(N.y)&&A.has(dr(N,St))===!0)continue;const J=nn(N),M=kP(e,d,z,$);if(M.x=N.x??0,M.y=N.y??0,M.char=J.char,M.color=J.color,M.bg=J.bg,h.sprites.push(M),m){if(J.light>0){const O=zr(n,M),w=gn(Math.round(J.light),1,Xt),C=1/(w*.5);if(p.alphas[O]=0,w>1){const P=[];for(let F=1;F<=w;++F){if(F===2){const it=zt(N,"lightdir");if(rr(it)){const W=eu(n,N,"",it,M);switch(Ir(M,W.destpt)){case pt.EAST:P.push([45,315,1]);break;case pt.WEST:P.push([225,135,1]);break;case pt.NORTH:P.push([315,225,1]);break;case pt.SOUTH:P.push([135,45,1]);break}}}const ot=[];for(let it=M.y-F;it<=M.y+F;++it)Vl(n,p.alphas,P,ot,M,w,C,M.x-F,it),Vl(n,p.alphas,P,ot,M,w,C,M.x+F,it);const tt=F-1;for(let it=M.x-tt;it<=M.x+tt;++it)Vl(n,p.alphas,P,ot,M,w,C,it,M.y-F),Vl(n,p.alphas,P,ot,M,w,C,it,M.y+F);for(let it=0;it<ot.length;++it){const W=ot[it];let D=0;for(D=0;D<P.length;++D){const yt=P[D];if(yt[1]>yt[0]&&W[1]>=yt[0]&&W[0]<=yt[1]&&W[2]>=1&&yt[2]>=1){P[D]=[Math.min(W[0],yt[0]),Math.max(W[1],yt[1]),1];break}}D===P.length&&P.push(W)}}}}else if(bn(z)){const O=zr(n,M);p.alphas[O]=0}}z===e&&(v.focusx=M.x,v.focusy=M.y,v.focusid=z)}o.push(Yl(e,a++,"text/mood",m?"dark":"bright"));const L=ce(Dt.MAIN),S=Ni(L,Dt.MAIN);if(gt(S.palette)){const $=en(L,bt.PALETTE,S.palette),N=Se($);y(N==null?void 0:N.bits)&&o.push(Yl(e,a++,"image/palette",Array.from(N.bits)))}if(gt(S.charset)){const $=en(L,bt.CHARSET,S.charset),N=Se($);y(N==null?void 0:N.bits)&&o.push(Yl(e,a++,"image/charset",Array.from(N.bits)))}const I=Object.keys(n.objects).filter(bn);return o.push(Yl(e,a++,"text/players",I.join(","))),o}const ar=bP();var Dt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Dt||{});const ke={halt:!1,session:De(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function vP(){return ke.session}function cr(){return ke.operator}function TP(e){ke.operator=e}function AP(e){ke.halt=e}function SP(){return ke.halt}function Pr(){return[...ke.books.values()]}function RP(){const[e]=ke.books.values();return e}function $r(e){const t=Ct(e);return ke.books.get(e)??Pr().find(n=>n.name===t)}function wE(e,t){y($r(t))&&(ke.software[e]=t)}function ce(e){return $r(ke.software[e])}function xE(e){const t=Zf([]);return gt(e)&&(t.name=e),Xl(t),xe(nt,ke.operator,`created [book] ${t.name}`),t}function OP(e){let t=$r(e);return y(t)||(t=Zf([]),t.name=e),Xl(t),xe(nt,ke.operator,`created [book] ${t.name}`),t}function un(e,t){let n=y(t)?OP(t):ce(e);return y(n)||(y(n)||(n=RP()),y(n)||(n=xE(t)),y(n)&&xe(nt,ke.operator,`opened [book] ${n.name} for ${e}`)),wE(e,n.id),n}function Qi(e,t,n){return td(un(e),n,t)}function Dr(e,t){const n=ce("main"),r=Sn(pk(n,e,t));if(y(r))return r;const i=Pr();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(n==null?void 0:n.id)){const a=Sn(pk(o,e,t));if(y(a))return a}}}function lr(e){if(y(e==null?void 0:e.kinddata))return e.kinddata;if(!gt(e==null?void 0:e.kind)||!e.kind)return;const t=Dr(bt.OBJECT,e.kind);if(y(t))return e.kinddata=Se(t),e.kinddata;const n=Dr(bt.TERRAIN,e.kind);if(y(n))return e.kinddata=Se(n),e.kinddata}function zt(e,t){const n=e==null?void 0:e.kinddata,r=(n==null?void 0:n.id)??"",i=e==null?void 0:e[t];if(y(i))return i;const s=n==null?void 0:n[t];if(y(s))return s;const o=Dr(bt.OBJECT,r)??Dr(bt.TERRAIN,r),a=Jf(o,t);if(y(a))return a;switch(t){case"group":return"";case"cycle":return Nx;case"item":return 0;case"pushable":return 0;case"breakable":return 0;case"collision":return Gt.ISWALK;default:return}}function jr(e,t,n,r){if(!y(e)||!y(t))return;const[i,s]=t,o=Dr(bt.OBJECT,i);if(y(o)){const c=Ld(e,n,i,r);if(y(c))return ia(c,s),mU(e,c),lr(c),bk(e,c),c}const a=Dr(bt.TERRAIN,i);if(y(a)){const c=JP(e,n,i);if(y(c)){ia(c,s);const l=dr(n,St);return lr(c),bk(e,c,l),c}}}function NP(e,t,n){if(!y(e)||!y(t))return;const[r,i]=t,s=Dr(bt.OBJECT,r);if(y(s)){const o=Ld(e,n,r);return ia(o,i),o}}function hn(e){const t=Dr(bt.BOARD,e);return Se(t)}function xr(e){const t=un("main");return Ni(t,e)}function vE(e){const t=un("main");return dU(t,e)}function TE(){const e=un("main");return Ni(e,"main")}function IP(e){const t=un("main");return _k(t,e)}function CP(e,t){ke.books.clear(),e.forEach(r=>{ke.books.set(r.id,r),r.name==="main"&&(ke.software.main=r.id)});const n=$r(t);if(y(n)&&(ke.software.main=n.id),!ke.software.main){const r=ke.books.values().next();r.value&&(ke.software.main=r.value.id)}}function Xl(e){return ke.books.set(e.id,e),e.id}function LP(e){const t=$r(e);t&&ke.books.delete(t.id)}function AE(e){if(!gt(e)||!e)return de(nt,e,"login",`failed for playerid ==>${e}<==`);const t=ce("main");if(!y(t))return de(nt,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);const n=fn(e),r=Dr(bt.BOARD,"title");if(!y(n)&&!y(r))return de(nt,e,"login:title","login failed to find board with 'title' stat");const i=Dr(bt.OBJECT,"player");if(!y(i))return de(nt,e,"login:player","login failed to find object type 'player'");const s=Se(r);if(y(s)){const o=Jf(r,"startx"),a=Jf(r,"starty"),c=wt(o)?o:Math.round(St*.5),l=wt(a)?a:Math.round(Xt*.5),u=Ld(s,{x:c,y:l},"player",e);if(y(u==null?void 0:u.id))return u.player=e,Cl(t,e,s.id),!0}return!1}function MP(e){const t=ce("main"),n=Oa(t,e);if(!y(t))return;const r=[e];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Cl(t,s,""),nd(n,Un(n,s)),FE(n,s),ar.halt(s),_k(t,s)}}function fn(e){const t=ce("main");return Oa(t,e)}function UP(e){const t=ce("main"),n=wU(t,e),r=Oa(t,e),i=Un(r,e);return n&&y(i)}function FP(e){const t=ce("main"),n=bo(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;bn(c)&&y(e[c])===!1&&(e[c]=0,Cl(t,c,i.id))}}}function SE(e){ar.message(e)}function Mn(e,t,n,r){const i=nn(t);gt(n.id)&&nt.emit(e,"vm:touched",[n.id,i.name,r])}function BP(e,t,n,r){const i=n.id??"";if(r.x<0){const s=hn((t==null?void 0:t.exitwest)??"");y(s)&&yo(e,i,s.id,{x:St-1,y:r.y})}else if(r.x>=St){const s=hn((t==null?void 0:t.exiteast)??"");y(s)&&yo(e,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=hn((t==null?void 0:t.exitnorth)??"");y(s)&&yo(e,i,s.id,{x:r.x,y:Xt-1})}else if(r.y>=Xt){const s=hn((t==null?void 0:t.exitsouth)??"");y(s)&&yo(e,i,s.id,{x:r.x,y:0})}}function ts(e,t,n,r){if(!y(n==null?void 0:n.id))return!1;const i=id(t,n,r);if(y(i)){const s=bn(n.id),o=bn(n.party??n.id),a=zt(n,"collision")===Gt.ISBULLET;let c="";n.party&&o&&(c=n.party),s&&(c=n.id);const l=bn(i.id),u=bn(i.party??i.id),f=zt(i,"collision")===Gt.ISBULLET,d=o===u;let h="";if(i.party&&u&&(h=i.party),l&&(h=i.id??""),s&&i.kind==="edge"?BP(e,t,n,r):s?l?(Mn("",i,n,"bump"),Mn("",n,i,"bump")):f?(Mn("",i,n,d?"partyshot":"shot"),Mn(c,n,i,"touch")):(Mn("",i,n,"thud"),Mn(c,n,i,"touch")):a?f?(Mn("",i,n,"thud"),Mn("",n,i,"thud")):(Mn("",i,n,l?"touch":"thud"),Mn(d?"":c,n,i,d?"partyshot":"shot")):l?Mn(h,i,n,"touch"):f?(Mn(d?"":h,i,n,d?"partyshot":"shot"),Mn("",n,i,d?"thud":"touch")):(Mn("",i,n,"thud"),Mn("",n,i,"bump")),s&&zt(i,"item")||a&&zt(i,"breakable")){if(y(i==null?void 0:i.id)){const m=ie(t,{x:i.x??-1,y:i.y??-1});y(m)&&Tn(E.board,m,E.timestamp)}else Oe(t,{x:r.x,y:r.y});return!0}return!1}return!0}function RE(e,t,n,r){var l;if(!y(e)||!y(t)||!y(n))return;const i={...E};E.book=e,E.board=t,E.element=n,E.elementid=n.id??"",E.elementisplayer=bn(E.elementid);const s=E.element.player??ke.operator;E.elementfocus=E.elementisplayer?E.elementid:s;const o=zt(n,"cycle"),a=n.id??"",c=Ct(n.name??((l=n.kinddata)==null?void 0:l.name)??"");if(ar.tick(a,Ji.RUNTIME,o,c,r),wt(n==null?void 0:n.tickertime)&&E.timestamp-n.tickertime>Ya*5&&(n.tickertime=0,n.tickertext=""),E.elementisplayer){const u=xr(E.elementid);wt(u.inputcurrent)&&(u.inputcurrent=0)}Zn(i).forEach(u=>{E[u]=i[u]})}function PP(e,t){ke.loaders.set(e,t)}function $P(e){ar.halt(e)}function DP(){const e=ar.ids();for(let n=0;n<e.length;++n)ar.halt(e[n]);const t=ce("main");y(t)&&(t.flags={})}function jP(e=!1){const t=ce("main");if(!y(t))return;const n=t.timestamp+1,r=ki.HALT_AT_COUNT;ki.HALT_AT_COUNT=r*2,ke.loaders.forEach((s,o)=>{const a={...E};E.timestamp=t.timestamp,E.book=t,E.board=void 0,E.element=void 0,E.elementid=o,E.elementisplayer=!1,E.elementfocus=cr();const c=VF(o);y(c)&&ar.arg(o,c),ar.tick(o,Ji.LOADER,1,"loader",s),ar.isended(o)&&(ar.halt(o),ke.loaders.delete(o)),Zn(a).forEach(l=>{E[l]=a[l]})}),ki.HALT_AT_COUNT=r,t.timestamp=n,E.timestamp=n;const i=bo(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)lr(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];lr(o.objects[u])}const c=bU(o,n);for(let l=0;l<c.length;++l){const{id:u,type:f,code:d,object:h}=c[l];f===bt.ERROR?ar.halt(u):(!e||bn((h==null?void 0:h.id)??""))&&RE(t,o,h,d)}}}function Ro(e,t,n,r){const i=ce("main");if(!y(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(y(c.id)){const l=`${bE(c.id)}:${t}`;nt.emit("",l,n)}}}if(ms(e)){for(let o=0;o<r.length;++o){const a=r[o],c=ie(a,e);y(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(Ct(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(CE(a,[e]));break}}}}function zP(e){const t=xr(e),n=t.playbuffer=gt(t.playbuffer)?t.playbuffer:"";n&&OE(e,n,!1)}function OE(e,t,n=!0){var o;const r=un("main");if(!y(r))return;const i=`${e}_cli`;E.timestamp=r.timestamp,E.book=r,E.board=Oa(r,e),E.element=Un(E.board,e),E.elementid=((o=E.element)==null?void 0:o.id)??"",E.elementisplayer=!0,E.elementfocus=E.elementid||e;const s=ki.HALT_AT_COUNT;if(ki.HALT_AT_COUNT=s*8,ar.once(i,Ji.CLI,"cli",t),n){const a=xr(e);a.playbuffer=t}ki.HALT_AT_COUNT=s}function ql(e){var a;const t=un("main"),n=As(t,e);if(!y(t)||!y(n)||!y(E.element))return;const r={...E},i=`${e}_run`,s=Ct(E.element.name??((a=E.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";ar.once(i,Ji.RUNTIME,s,o),Zn(r).forEach(c=>{E[c]=r[c]})}function WP(e,t){const n=ce("main"),r=Oa(n,e),i=[],s=[],o=[];if(!y(n)||!y(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=hn(r.overboard??""),l=hn(r.underboard??"");return s.push(...Rd(e,0,l,t,!1,!0)),o.push(...Rd(e,s.length,r,t,!0,a!=="flat")),i.push(...Rd(e,s.length+o.length,c,t,!1,!1)),{over:i,under:s,layers:o}}function Ls(e){return ue(e)&&typeof e[0]=="string"}function GP(e){const t=E.words[e];return gt(t)?[t,e+1]:[void 0,e]}function Od(e){const t=E.words[e];if(Ls(t))return[t,e+1];const[n,r]=Sc(e),[i,s]=GP(r);return gt(i)&&(i==="empty"||lr({kind:i}))?[[i,n],s]:[void 0,e]}function Ba(e){if(!Ls(e))return;const[t]=e;return t}function Jl(e){if(!Ls(e))return;const[,t]=e,n=y(t)?Tc(t):void 0;return y(n)?n:void 0}function NE(e){if(!Ls(e))return;const[,t]=e,n=y(t)?Ac(t):void 0;return y(n)?Ah(n):void 0}function Pa(e,t){const n=e??Gt.ISWALK,r=t??Gt.ISWALK;switch(n){case Gt.ISWALK:return r!==Gt.ISWALK;case Gt.ISSWIM:return r!==Gt.ISSWIM;case Gt.ISSOLID:return!0;case Gt.ISBULLET:return r!==Gt.ISWALK&&r!==Gt.ISSWIM}}function $a(e,t,n){const r=e==null?void 0:e.objects[n];if(y(r))return r;const i=Da(e,"player");return y(t)?(t.x<0&&(t.x=pr(0,St-1)),t.y<0&&(t.y=pr(0,Xt-1)),LE(t,i)):Sn(...i)}function Da(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(y)}function KP(e){const t=[];for(let n=0;n<Xt;++n)for(let r=0;r<St;++r){const i={x:r,y:n},s=ie(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Nd(e,t,n,r){if(!y(e))return!1;const i=nn(e);return!(y(t)&&t!==i.name||y(n)&&n!==i.color||y(r)&&r!==i.bg)}function Zl(e,t){const n=Ba(t),r=Jl(t),i=NE(t);return Da(e,n??"").filter(s=>Nd(s,n,r,i))}function IE(e,t){const n=y(t)?Tc(t):void 0,r=y(t)?Ac(t):void 0,i=[];if(y(e)){for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];y(a)&&Nd(a,void 0,n,r)&&i.push(a)}const s=Object.values(e.objects);for(let o=0;o<s.length;++o){const a=s[o];Nd(a,void 0,n,r)&&i.push(a)}}return i}function CE(e,t){return y(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(y(i))return i;const s=Da(e,Ct(n));if(s.length)return s}else if(ms(n)&&n.x>=0&&n.x<St&&n.y>=0&&n.y<Xt){const i=n.x+n.y*St,s=(r=e.lookup)==null?void 0:r[i];return y(s)?e.objects[s]:e.terrain[i]}}).flat().filter(y):[]}function LE(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function HP(e,t,n,r){if(!y(e))return;y(e.distmaps)||(e.distmaps={});const i=`${t}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=e.distmaps[i];if(!y(s)){s=new Array(Oh).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(y(c)&&tu(c)){const l=dr(c,St);if(s[l]===-2){const u=es(e,c.x,c.y);Pa(t,zt(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function ME(e,t){return tu(e)?t[dr(e,St)]:-1}function UE(e,t,n,r,i){if(!y(e))return;const s=HP(e,t,n,r);if(!y(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=ME(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=ME(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function YP(){return new Array(St*Xt).map(()=>{})}function Ql(e=_u){const t={terrain:YP(),objects:{},id:""};return e(t)}var Id=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(Id||{});function VP(e){return ao(e,Id,{terrain:t=>t.map(Bc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Bc),id:Ae,named:Ae,lookup:Ae,codepage:Ae,distmaps:Ae,overboard:Ae,underboard:Ae})}function XP(e){return ra(e,Id,{terrain:t=>t.map(Pc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Pc(t[r]);y(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function tu(e){return yh(e.x,e.y,0,St-1,Xt-1,0)}function zr(e,t){return!y(e)||!y(t==null?void 0:t.x)||!y(t==null?void 0:t.y)||t.x<0||t.x>=St||t.y<0||t.y>=Xt?-1:t.x+t.y*St}function ie(e,t){const n=zr(e,t);if(n<0||!y(e==null?void 0:e.lookup))return;const r=Un(e,e.lookup[n]??"");return y(r)?r:e.terrain[n]}function qP(e,t){const n=Un(e,t);if(y(n))return n;const r=parseFloat(t),i=NA(isNaN(r)?-1:r,St);return es(e,i.x,i.y)}function es(e,t,n){return(t>=0&&t<St)??(n>=0&&n<Xt)?e==null?void 0:e.terrain[t+n*St]:void 0}function Oe(e,t){if(!y(e)||!y(t)||!y(t.x)||!y(t.y)||t.x<0||t.x>=St||t.y<0||t.y>=Xt)return;const n=Tr(t),r=t.x+t.y*St;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function Cd(e,t){if(!y(e)||!y(t))return;const n=Tr(t);return n.id=n.id??De(),e.objects[n.id]=n,e.objects[n.id]}function JP(e,t,n){return Oe(e,{...t,kind:n})}function Ld(e,t,n,r){return Cd(e,{...t,kind:n,id:r})}function Un(e,t){if(e)return e.objects[t]}function ZP(e,t){const n=zr(e,t);if(n<0||!y(e==null?void 0:e.lookup))return;const r=Un(e,e.lookup[n]??"");if(y(r))return r}function Tn(e,t,n){return!y(t)||nn(t).name==="player"?!1:(t.id?(t.removed=n,nd(e,t)):(Oe(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),gU(e,t)),!0)}function FE(e,t){return y(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function QP(e,t,n){if(!y(e)||!y(t))return;const r=e.objects[n];if(y(r))return r;if(ms(t))return LE(t,Da(e,"player"))}function eu(e,t,n,r,i){const s=pt.MID;if(!y(e)||!y(t))return{dir:r,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:t.lx??o.x,y:t.ly??o.y},c=Ir(a,o),l=St-1,u=Xt-1;for(let f=0;f<r.length;++f){const d=zA(r[f]);switch(d){case pt.IDLE:break;case pt.NORTH:case pt.SOUTH:case pt.WEST:case pt.EAST:ze(o,d);break;case pt.BY:{const[h,m]=r.slice(f+1);wt(h)&&wt(m)&&(o.x=gn(o.x+h,0,l),o.y=gn(o.y+m,0,u)),f+=2;break}case pt.TO:case pt.AT:{const[h,m]=r.slice(f+1);wt(h)&&wt(m)&&(o.x=gn(h,0,l),o.y=gn(m,0,u)),f+=2;break}case pt.FLOW:ze(o,c);break;case pt.SEEK:{const h=QP(e,t,n);ms(h)&&ze(o,Ir(i,h));break}case pt.RNDNS:ze(o,Sn(pt.NORTH,pt.SOUTH));break;case pt.RNDNE:ze(o,Sn(pt.NORTH,pt.EAST));break;case pt.RND:ze(o,Sn(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));break;case pt.CW:case pt.CCW:case pt.OPP:case pt.RNDP:{const h=eu(e,t,n,r.slice(f+1),i);switch(o.x=i.x,o.y=i.y,d){case pt.CW:switch(Ir(i,h.destpt)){case pt.NORTH:ze(o,pt.EAST);break;case pt.SOUTH:ze(o,pt.WEST);break;case pt.EAST:ze(o,pt.SOUTH);break;case pt.WEST:ze(o,pt.NORTH);break}break;case pt.CCW:switch(Ir(i,h.destpt)){case pt.NORTH:ze(o,pt.WEST);break;case pt.SOUTH:ze(o,pt.EAST);break;case pt.EAST:ze(o,pt.NORTH);break;case pt.WEST:ze(o,pt.SOUTH);break}break;case pt.OPP:switch(Ir(i,h.destpt)){case pt.NORTH:ze(o,pt.SOUTH);break;case pt.SOUTH:ze(o,pt.NORTH);break;case pt.EAST:ze(o,pt.WEST);break;case pt.WEST:ze(o,pt.EAST);break}break;case pt.RNDP:switch(Ir(i,h.destpt)){case pt.NORTH:case pt.SOUTH:o.x+=Sn(-1,1);break;case pt.WEST:case pt.EAST:o.y+=Sn(-1,1);break}break}break}case pt.FLEE:case pt.AWAY:{const[h,m]=r.slice(f+1);if(wt(h)&&wt(m)){const p={x:gn(h,0,l),y:gn(m,0,u)},k=zt(t,"collision"),b=UE(e,k,o,p,!0);y(b)&&(o.x=b.x,o.y=b.y)}f+=2;break}case pt.FIND:case pt.TOWARD:{const[h,m]=r.slice(f+1);if(wt(h)&&wt(m)){const p={x:gn(h,0,l),y:gn(m,0,u)};if(pr(1,100)<5)ze(o,Sn(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));else{const k=zt(t,"collision"),b=UE(e,k,o,p,!1);if(y(b))if(b.x!==h&&b.y!==m&&ZP(e,b))switch(Ir(i,b)){case pt.EAST:case pt.WEST:o.y+=Sn(-1,1);break;case pt.NORTH:case pt.SOUTH:o.x+=Sn(-1,1);break}else o.x=b.x,o.y=b.y}}f+=2;break}case pt.PLAYER:{const h=$a(e,i,n);ms(h)&&(o.x=h.x,o.y=h.y);break}case pt.OVER:case pt.UNDER:{const h=eu(e,t,n,r.slice(f+1),i);return h.layer=d,h}}}return{dir:r,startpt:i,destpt:o,layer:s}}const E={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var H=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.COLOR_OR_KIND=7]="COLOR_OR_KIND",e[e.MAYBE_KIND=8]="MAYBE_KIND",e[e.MAYBE_NAME=9]="MAYBE_NAME",e[e.MAYBE_NUMBER=10]="MAYBE_NUMBER",e[e.MAYBE_STRING=11]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",e[e.ANY=13]="ANY",e))(H||{});function dn(e,t,n){throw console.info(n,E.element,E.elementid,E.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function BE(e){var n,r;const t={x:((n=E.element)==null?void 0:n.x)??0,y:((r=E.element)==null?void 0:r.y)??0};return eu(E.board,E.element,E.elementfocus,e,t)}function st(e,t,n){const r=E.words;E.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=Od(s);Ls(a)?(s=c,i.push(a)):dn("kind",a,e);break}case 0:{if(Jo(e[s])===void 0){const[a,c]=Cn(s);wn(a)?(s=c,i.push(a)):dn("color",a,e)}else{const[a,c]=Sc(s);wn(a)?(s=c,i.push(a)):dn("color",a,e)}break}case 2:{if(Th(e[s])===void 0){const[a,c]=Cn(s);rr(a)?(s=c,i.push(BE(a))):dn("direction",a,e)}else{const[a,c]=km(s);rr(a)?(s=c,i.push(BE(a))):dn("direction",a,e)}break}case 3:{const a=E.words[s];gt(a)||dn("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Cn(s);if(gt(a)){const l=parseFloat(a);wt(l)?i.push(l):dn("number",a,e)}else wt(a)?i.push(a):dn("number",a,e);s=c;break}case 5:{const[a,c]=Cn(s);gt(a)||dn("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Cn(s);let l=a;if(gt(l)){const u=parseFloat(l);wt(u)&&(l=u)}else wt(l)||dn("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=Od(s);if(Ls(a))s=c,i.push(a);else if(Jo(e[s])===void 0){const[l,u]=Cn(s);wn(l)?(s=u,i.push(l)):dn("color",l,e)}else{const[l,u]=Sc(s);wn(l)?(s=u,i.push(l)):dn("color or kind",l,e)}break}case 8:{const[a,c]=Od(s);a!==void 0&&!Ls(a)&&dn("optional kind",a,e),s=c,i.push(a);break}case 9:{const a=E.words[s];a!==void 0&&!gt(a)&&dn("optional string",a,e),++s,i.push(a);break}case 10:{const[a,c]=Cn(s);if(gt(a)){const l=parseFloat(a);wt(l)?i.push(l):dn("optional number",a,e)}else wt(a)||a===void 0?i.push(a):dn("optional number",a,e);s=c;break}case 11:{const[a,c]=Cn(s);a!==void 0&&!gt(a)&&dn("optional string",a,e),s=c,i.push(a);break}case 12:{const[a,c]=Cn(s);let l=a;if(gt(l)){const u=parseFloat(l);wt(u)&&(l=u)}else l!==void 0&&!wt(l)&&dn("number or string",l,e);s=c,i.push(l);break}case 13:{const[a,c]=Cn(s);s=c,i.push(a);break}}return E.words=r,[...i,s]}const nu={},Oo={};function Md(){return{id:De(),layers:[],scroll:[],sidebar:[]}}const t$=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),e$=new Set(["tx","text"]),n$={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},PE={};let $E=e=>{let t=PE[e];return y(t)||(PE[e]=t=Md()),t};function r$(e){$E=e}function Ye(e){return $E(e)}function Ud(e){return y(nu[e])||(nu[e]=[]),nu[e]}function i$(e){const t=Ye(e);t.scrollname="",t.scroll=[]}function s$(e,t,n){Object.values(Oo).forEach(r=>{if(r[t]!==void 0){const i=Sm(e.id(),t);wt(n)&&SA(i,n),gt(n)&&RA(i,n)}})}function An(e){const t=Ud(e);return nu[e]=[],t}function DE(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n];gt(r)&&y(IU(r))?t.push(" ",r," "):t.push(r)}return t}function Rt(e,t){Ud(e).push(t)}function Lt(e,t,n,r,i=()=>0,s=_u){const o=[t,n,...r],a=Ct(`${o[3]}`),c={...E};function l(u,f){y(f)&&f!==i(u)&&(E.board=c.board,E.element=c.element,E.elementfocus=c.elementfocus,s(u,f))}if(t$.has(a)){const u=`${o[2]}`;Oo[t]=Oo[t]??{};const f=i(u)??n$[a];if(Oo[t][u]===void 0){const d=Sm(t,u);wt(f)&&AA(d,f),gt(f)&&_h(d,f),e$.has(a)?Oo[t][u]=nm(d,h=>{l(u,h)}):Oo[t][u]=OA(d,h=>{l(u,h)})}}Ud(e).push(o)}r$(e=>{if(bn(e)){const t=ce(Dt.MAIN),n=Ni(t,Dt.GADGETSTORE);let r=n[e];return y(r)||(n[e]=r=Md()),r}return Md()});let jE=0;function o$(){switch(jE++){case 0:return Mt.BLUE;case 1:return Mt.BLACK;case 2:return Mt.GREEN;case 3:return Mt.BLACK;case 4:return Mt.CYAN;case 5:return Mt.BLACK;case 6:return Mt.RED;case 7:return Mt.BLACK;case 8:return Mt.PURPLE;case 9:return Mt.BLACK;case 10:return Mt.YELLOW;case 11:return Mt.BLACK;case 12:return Mt.WHITE;default:return jE=0,Mt.BLACK}}const ru=Bs("gadgetserver",["tock","second"],e=>{if(!ru.session(e))return;const t=ce(Dt.MAIN),n=(t==null?void 0:t.activelist)??[],r=Ni(t,Dt.GADGETSYNC);switch(e.target){case"tock":{const i=o$();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=WP(o,i),u=Ye(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=e0(f,u);d.length&&(r[o]=Tr(u),tx(ru,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=fn(s);y(o)&&dx(ru,s,o.id)}break;case"desync":Qw(ru,e.player,Ye(e.player));break;case"clearscroll":i$(e.player);break;case"clearplayer":{const i=Ni(t,Dt.GADGETSTORE);delete i[e.player];const s=Ni(t,Dt.GADGETSYNC);delete s[e.player];break}}});function iu(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var zE={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof iu=="function"&&iu;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(m){var p=r[l][1][m];return o(p||m)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof iu=="function"&&iu,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,m,p,k=[],b=0,v=c.length,T=v,A=s.getTypeOf(c)!=="string";b<c.length;)T=v-b,f=A?(l=c[b++],u=b<v?c[b++]:0,b<v?c[b++]:0):(l=c.charCodeAt(b++),u=b<v?c.charCodeAt(b++):0,b<v?c.charCodeAt(b++):0),d=l>>2,h=(3&l)<<4|u>>4,m=1<T?(15&u)<<2|f>>6:64,p=2<T?63&f:64,k.push(a.charAt(d)+a.charAt(h)+a.charAt(m)+a.charAt(p));return k.join("")},i.decode=function(c){var l,u,f,d,h,m,p=0,k=0,b="data:";if(c.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var v,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|T):new Array(0|T);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(p++)))>>2,f=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),v[k++]=l,h!==64&&(v[k++]=u),m!==64&&(v[k++]=f);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,m){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,m){var p,k="";for(p=0;p<m;p++)k+=String.fromCharCode(255&h),h>>>=8;return k}function o(h,m,p,k,b,v){var T,A,L=h.file,S=h.compression,I=v!==l.utf8encode,$=a.transformTo("string",v(L.name)),N=a.transformTo("string",l.utf8encode(L.name)),z=L.comment,J=a.transformTo("string",v(z)),M=a.transformTo("string",l.utf8encode(z)),O=N.length!==L.name.length,w=M.length!==z.length,C="",P="",F="",ot=L.dir,tt=L.date,it={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(it.crc32=h.crc32,it.compressedSize=h.compressedSize,it.uncompressedSize=h.uncompressedSize);var W=0;m&&(W|=8),I||!O&&!w||(W|=2048);var D=0,yt=0;ot&&(D|=16),b==="UNIX"?(yt=798,D|=function(at,Pt){var Kt=at;return at||(Kt=Pt?16893:33204),(65535&Kt)<<16}(L.unixPermissions,ot)):(yt=20,D|=function(at){return 63&(at||0)}(L.dosPermissions)),T=tt.getUTCHours(),T<<=6,T|=tt.getUTCMinutes(),T<<=5,T|=tt.getUTCSeconds()/2,A=tt.getUTCFullYear()-1980,A<<=4,A|=tt.getUTCMonth()+1,A<<=5,A|=tt.getUTCDate(),O&&(P=s(1,1)+s(u($),4)+N,C+="up"+s(P.length,2)+P),w&&(F=s(1,1)+s(u(J),4)+M,C+="uc"+s(F.length,2)+F);var X="";return X+=`
\0`,X+=s(W,2),X+=S.magic,X+=s(T,2),X+=s(A,2),X+=s(it.crc32,4),X+=s(it.compressedSize,4),X+=s(it.uncompressedSize,4),X+=s($.length,2),X+=s(C.length,2),{fileRecord:f.LOCAL_FILE_HEADER+X+$+C,dirRecord:f.CENTRAL_FILE_HEADER+s(yt,2)+X+s(J.length,2)+"\0\0\0\0"+s(D,4)+s(k,4)+$+C+J}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,m,p,k){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=k,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,k=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-k-1))/p:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(k){return f.DATA_DESCRIPTOR+s(k.crc32,4)+s(k.compressedSize,4)+s(k.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,k=function(b,v,T,A,L){var S=a.transformTo("string",L(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(b,2)+s(b,2)+s(v,4)+s(T,4)+s(S.length,2)+S}(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:k,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var m=function(v,T){var A=v||T,L=s[A];if(!L)throw new Error(A+" is not a valid compression method !");return L}(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},k=h.dir,b=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:d,dir:k,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(k){m(k)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(p){var k=new c(h);return k.load(p),k}).then(function(p){var k=[o.Promise.resolve(p)],b=p.files;if(h.checkCRC32)for(var v=0;v<b.length;v++)k.push(f(b[v]));return o.Promise.all(k)}).then(function(p){for(var k=p.shift(),b=k.files,v=0;v<b.length;v++){var T=b[v],A=T.fileNameStr,L=s.resolve(T.fileNameStr);m.file(L,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(m.file(L).unsafeOriginalName=A)}return k.zipComment.length&&(m.comment=k.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof pn<"u",newBufferFrom:function(s,o){if(pn.from&&pn.from!==Uint8Array.from)return pn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new pn(s,o)},allocBuffer:function(s){if(pn.alloc)return pn.alloc(s);var o=new pn(s);return o.fill(0),o},isBuffer:function(s){return pn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(L,S,I){var $,N=a.getTypeOf(S),z=a.extend(I||{},u);z.date=z.date||new Date,z.compression!==null&&(z.compression=z.compression.toUpperCase()),typeof z.unixPermissions=="string"&&(z.unixPermissions=parseInt(z.unixPermissions,8)),z.unixPermissions&&16384&z.unixPermissions&&(z.dir=!0),z.dosPermissions&&16&z.dosPermissions&&(z.dir=!0),z.dir&&(L=b(L)),z.createFolders&&($=k(L))&&v.call(this,$,!0);var J=N==="string"&&z.binary===!1&&z.base64===!1;I&&I.binary!==void 0||(z.binary=!J),(S instanceof f&&S.uncompressedSize===0||z.dir||!S||S.length===0)&&(z.base64=!1,z.binary=!0,S="",z.compression="STORE",N="string");var M=null;M=S instanceof f||S instanceof c?S:m.isNode&&m.isStream(S)?new p(L,S):a.prepareContent(L,S,z.binary,z.optimizedBinaryString,z.base64);var O=new d(L,M,z);this.files[L]=O}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),m=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),k=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var S=L.lastIndexOf("/");return 0<S?L.substring(0,S):""},b=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},v=function(L,S){return S=S!==void 0?S:u.createFolders,L=b(L),this.files[L]||s.call(this,L,null,{dir:!0,createFolders:S}),this.files[L]};function T(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var S,I,$;for(S in this.files)$=this.files[S],(I=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&L(I,$)},filter:function(L){var S=[];return this.forEach(function(I,$){L(I,$)&&S.push($)}),S},file:function(L,S,I){if(arguments.length!==1)return L=this.root+L,s.call(this,L,S,I),this;if(T(L)){var $=L;return this.filter(function(z,J){return!J.dir&&$.test(z)})}var N=this.files[this.root+L];return N&&!N.dir?N:null},folder:function(L){if(!L)return this;if(T(L))return this.filter(function(N,z){return z.dir&&L.test(N)});var S=this.root+L,I=v.call(this,S),$=this.clone();return $.root=I.name,$},remove:function(L){L=this.root+L;var S=this.files[L];if(S||(L.slice(-1)!=="/"&&(L+="/"),S=this.files[L]),S&&!S.dir)delete this.files[L];else for(var I=this.filter(function(N,z){return z.name.slice(0,L.length)===L}),$=0;$<I.length;$++)delete this.files[I[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var S,I={};try{if((I=a.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");a.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var $=I.comment||this.comment||"";S=h.generateWorker(this,I,$)}catch(N){(S=new c("error")).error(N)}return new l(S,I.type||"string",I.mimeType)},generateAsync:function(L,S){return this.generateInternalStream(L).accumulate(S)},generateNodeStream:function(L,S){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(S)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(k,b){var v=[],T=m._internalType,A=m._outputType,L=m._mimeType;m.on("data",function(S,I){v.push(S),p&&p(I)}).on("error",function(S){v=[],b(S)}).on("end",function(){try{var S=function(I,$,N){switch(I){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),N);case"base64":return c.encode($);default:return s.transformTo(I,$)}}(A,function(I,$){var N,z=0,J=null,M=0;for(N=0;N<$.length;N++)M+=$[N].length;switch(I){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(J=new Uint8Array(M),N=0;N<$.length;N++)J.set($[N],z),z+=$[N].length;return J;case"nodebuffer":return pn.concat($);default:throw new Error("concat : unsupported type '"+I+"'")}}(T,v),L);k(S)}catch(I){b(I)}v=[]}).resume()})}function h(m,p,k){var b=p;switch(p){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=p,this._mimeType=k,s.checkSupport(b),this._worker=m.pipe(new o(b)),m.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var k=this;return m==="data"?this._worker.on(m,function(b){p.call(k,b.data,b.meta)}):this._worker.on(m,function(){s.delay(p,arguments,k)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof pn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(m){var p,k,b,v,T,A=m.length,L=0;for(v=0;v<A;v++)(64512&(k=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(b=m.charCodeAt(v+1)))==56320&&(k=65536+(k-55296<<10)+(b-56320),v++),L+=k<128?1:k<2048?2:k<65536?3:4;for(p=o.uint8array?new Uint8Array(L):new Array(L),v=T=0;T<L;v++)(64512&(k=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(b=m.charCodeAt(v+1)))==56320&&(k=65536+(k-55296<<10)+(b-56320),v++),k<128?p[T++]=k:(k<2048?p[T++]=192|k>>>6:(k<65536?p[T++]=224|k>>>12:(p[T++]=240|k>>>18,p[T++]=128|k>>>12&63),p[T++]=128|k>>>6&63),p[T++]=128|63&k);return p}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(m){var p,k,b,v,T=m.length,A=new Array(2*T);for(p=k=0;p<T;)if((b=m[p++])<128)A[k++]=b;else if(4<(v=l[b]))A[k++]=65533,p+=v-1;else{for(b&=v===2?31:v===3?15:7;1<v&&p<T;)b=b<<6|63&m[p++],v--;1<v?A[k++]=65533:b<65536?A[k++]=b:(b-=65536,A[k++]=55296|b>>10&1023,A[k++]=56320|1023&b)}return A.length!==k&&(A.subarray?A=A.subarray(0,k):A.length=k),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var k=function(v,T){var A;for((T=T||v.length)>v.length&&(T=v.length),A=T-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?T:A+l[v[A]]>T?A:T}(m),b=m;k!==m.length&&(o.uint8array?(b=m.subarray(0,k),this.leftOver=m.subarray(k,m.length)):(b=m.slice(0,k),this.leftOver=m.slice(k,m.length))),this.push({data:i.utf8decode(b),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(p){return p}function u(p,k){for(var b=0;b<p.length;++b)k[b]=255&p.charCodeAt(b);return k}n("setimmediate"),i.newBlob=function(p,k){i.checkSupport("blob");try{return new Blob([p],{type:k})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(p),b.getBlob(k)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,k,b){var v=[],T=0,A=p.length;if(A<=b)return String.fromCharCode.apply(null,p);for(;T<A;)k==="array"||k==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(T,Math.min(T+b,A)))):v.push(String.fromCharCode.apply(null,p.subarray(T,Math.min(T+b,A)))),T+=b;return v.join("")},stringifyByChar:function(p){for(var k="",b=0;b<p.length;b++)k+=String.fromCharCode(p[b]);return k},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var k=65536,b=i.getTypeOf(p),v=!0;if(b==="uint8array"?v=f.applyCanBeUsed.uint8array:b==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<k;)try{return f.stringifyByChunk(p,b,k)}catch{k=Math.floor(k/2)}return f.stringifyByChar(p)}function h(p,k){for(var b=0;b<p.length;b++)k[b]=p[b];return k}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,k){if(k=k||"",!p)return k;i.checkSupport(p);var b=i.getTypeOf(k);return m[b][p](k)},i.resolve=function(p){for(var k=p.split("/"),b=[],v=0;v<k.length;v++){var T=k[v];T==="."||T===""&&v!==0&&v!==k.length-1||(T===".."?b.pop():b.push(T))}return b.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var k,b,v="";for(b=0;b<(p||"").length;b++)v+="\\x"+((k=p.charCodeAt(b))<16?"0":"")+k.toString(16).toUpperCase();return v},i.delay=function(p,k,b){setImmediate(function(){p.apply(b||null,k||[])})},i.inherits=function(p,k){function b(){}b.prototype=k.prototype,p.prototype=new b},i.extend=function(){var p,k,b={};for(p=0;p<arguments.length;p++)for(k in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],k)&&b[k]===void 0&&(b[k]=arguments[p][k]);return b},i.prepareContent=function(p,k,b,v,T){return c.Promise.resolve(k).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(L,S){var I=new FileReader;I.onload=function($){L($.target.result)},I.onerror=function($){S($.target.error)},I.readAsArrayBuffer(A)}):A}).then(function(A){var L=i.getTypeOf(A);return L?(L==="arraybuffer"?A=i.transformTo("uint8array",A):L==="string"&&(T?A=o.decode(A):b&&v!==!0&&(A=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=d-h;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,m){this.options=h,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(k){for(var b in u)if(Object.prototype.hasOwnProperty.call(u,b)&&u[b].magic===k)return u[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,k,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)m=h.readInt(2),p=h.readInt(2),k=h.readData(p),this.extraFields[m]={id:m,length:p,value:k};h.setIndex(b)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var k=this.findExtraFieldUnicodeComment();if(k!==null)this.fileCommentStr=k;else{var b=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(m,p,k){this.name=m,this.dir=k.dir,this.date=k.date,this.comment=k.comment,this.unixPermissions=k.unixPermissions,this.dosPermissions=k.dosPermissions,this._data=p,this._dataBinary=k.binary,this.options={compression:k.compression,compressionOptions:k.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,k="string";try{if(!m)throw new Error("No output type specified.");var b=(k=m.toLowerCase())==="string"||k==="text";k!=="binarystring"&&k!=="text"||(k="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!b&&(p=p.pipe(new c.Utf8EncodeWorker)),!v&&b&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(T){(p=new u("error")).error(T)}return new o(p,k,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var k=this._decompressWorker();return this._dataBinary||(k=k.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(k,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var h=[];function m(){var p,k;a=!0;for(var b=h.length;b;){for(k=h,h=[],p=-1;++p<b;)k[p]();b=h.length}a=!1}r.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof Fn<"u"?Fn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,b!==o&&p(this,b)}function d(b,v,T){this.promise=b,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(b,v,T){s(function(){var A;try{A=v(T)}catch(L){return a.reject(b,L)}A===b?a.reject(b,new TypeError("Cannot resolve promise with itself")):a.resolve(b,A)})}function m(b){var v=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof v=="function")return function(){v.apply(b,arguments)}}function p(b,v){var T=!1;function A(I){T||(T=!0,a.reject(b,I))}function L(I){T||(T=!0,a.resolve(b,I))}var S=k(function(){v(L,A)});S.status==="error"&&A(S.value)}function k(b,v){var T={};try{T.value=b(v),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(b){if(typeof b!="function")return this;var v=this.constructor;return this.then(function(T){return v.resolve(b()).then(function(){return T})},function(T){return v.resolve(b()).then(function(){throw T})})},f.prototype.catch=function(b){return this.then(null,b)},f.prototype.then=function(b,v){if(typeof b!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?b:v,this.outcome):this.queue.push(new d(T,b,v)),T},d.prototype.callFulfilled=function(b){a.resolve(this.promise,b)},d.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},d.prototype.callRejected=function(b){a.reject(this.promise,b)},d.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},a.resolve=function(b,v){var T=k(m,v);if(T.status==="error")return a.reject(b,T.value);var A=T.value;if(A)p(b,A);else{b.state=l,b.outcome=v;for(var L=-1,S=b.queue.length;++L<S;)b.queue[L].callFulfilled(v)}return b},a.reject=function(b,v){b.state=c,b.outcome=v;for(var T=-1,A=b.queue.length;++T<A;)b.queue[T].callRejected(v);return b},f.resolve=function(b){return b instanceof this?b:a.resolve(new this(o),b)},f.reject=function(b){var v=new this(o);return a.reject(v,b)},f.all=function(b){var v=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=b.length,A=!1;if(!T)return this.resolve([]);for(var L=new Array(T),S=0,I=-1,$=new this(o);++I<T;)N(b[I],I);return $;function N(z,J){v.resolve(z).then(function(M){L[J]=M,++S!==T||A||(A=!0,a.resolve($,L))},function(M){A||(A=!0,a.reject($,M))})}},f.race=function(b){var v=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=b.length,A=!1;if(!T)return this.resolve([]);for(var L=-1,S=new this(o);++L<T;)I=b[L],v.resolve(I).then(function($){A||(A=!0,a.resolve(S,$))},function($){A||(A=!0,a.reject(S,$))});var I;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,m=8;function p(b){if(!(this instanceof p))return new p(b);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(T!==f)throw new Error(c[T]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function k(b,v){var T=new p(v);if(T.push(b,!0),T.err)throw T.msg||c[T.err];return T.result}p.prototype.push=function(b,v){var T,A,L=this.strm,S=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof b=="string"?L.input=a.string2buf(b):u.call(b)==="[object ArrayBuffer]"?L.input=new Uint8Array(b):L.input=b,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new o.Buf8(S),L.next_out=0,L.avail_out=S),(T=s.deflate(L,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(L.output,L.next_out))):this.onData(o.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(L.avail_out=0))},p.prototype.onData=function(b){this.chunks.push(b)},p.prototype.onEnd=function(b){b===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=p,i.deflate=k,i.deflateRaw=function(b,v){return(v=v||{}).raw=!0,k(b,v)},i.gzip=function(b,v){return(v=v||{}).gzip=!0,k(b,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var k=this.options;k.raw&&0<=k.windowBits&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15)),!(0<=k.windowBits&&k.windowBits<16)||p&&p.windowBits||(k.windowBits+=32),15<k.windowBits&&k.windowBits<48&&!(15&k.windowBits)&&(k.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var b=s.inflateInit2(this.strm,k.windowBits);if(b!==c.Z_OK)throw new Error(l[b]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function m(p,k){var b=new h(k);if(b.push(p,!0),b.err)throw b.msg||l[b.err];return b.result}h.prototype.push=function(p,k){var b,v,T,A,L,S,I=this.strm,$=this.options.chunkSize,N=this.options.dictionary,z=!1;if(this.ended)return!1;v=k===~~k?k:k===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?I.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?I.input=new Uint8Array(p):I.input=p,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8($),I.next_out=0,I.avail_out=$),(b=s.inflate(I,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(S=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,b=s.inflateSetDictionary(this.strm,S)),b===c.Z_BUF_ERROR&&z===!0&&(b=c.Z_OK,z=!1),b!==c.Z_STREAM_END&&b!==c.Z_OK)return this.onEnd(b),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&b!==c.Z_STREAM_END&&(I.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(I.output,I.next_out),A=I.next_out-T,L=a.buf2string(I.output,T),I.next_out=A,I.avail_out=$-A,A&&o.arraySet(I.output,I.output,T,A,0),this.onData(L)):this.onData(o.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(z=!0)}while((0<I.avail_in||I.avail_out===0)&&b!==c.Z_STREAM_END);return b===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(b=s.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(I.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,k){return(k=k||{}).raw=!0,m(p,k)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,m;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(m=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],m.set(h,d),d+=h.length;return m}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",m=0;m<d;m++)h+=String.fromCharCode(f[m]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,m,p,k,b=f.length,v=0;for(p=0;p<b;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<b&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),v+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(v),p=k=0;k<v;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<b&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?d[k++]=h:(h<2048?d[k++]=192|h>>>6:(h<65536?d[k++]=224|h>>>12:(d[k++]=240|h>>>18,d[k++]=128|h>>>12&63),d[k++]=128|h>>>6&63),d[k++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,m=d.length;h<m;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,m,p,k,b=d||f.length,v=new Array(2*b);for(h=m=0;h<b;)if((p=f[h++])<128)v[m++]=p;else if(4<(k=c[p]))v[m++]=65533,h+=k-1;else{for(p&=k===2?31:k===3?15:7;1<k&&h<b;)p=p<<6|63&f[h++],k--;1<k?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return u(v,m)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,m=-2,p=-1,k=4,b=2,v=8,T=9,A=286,L=30,S=19,I=2*A+1,$=15,N=3,z=258,J=z+N+1,M=42,O=113,w=1,C=2,P=3,F=4;function ot(x,lt){return x.msg=u[lt],lt}function tt(x){return(x<<1)-(4<x?9:0)}function it(x){for(var lt=x.length;0<=--lt;)x[lt]=0}function W(x){var lt=x.state,rt=lt.pending;rt>x.avail_out&&(rt=x.avail_out),rt!==0&&(o.arraySet(x.output,lt.pending_buf,lt.pending_out,rt,x.next_out),x.next_out+=rt,lt.pending_out+=rt,x.total_out+=rt,x.avail_out-=rt,lt.pending-=rt,lt.pending===0&&(lt.pending_out=0))}function D(x,lt){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,lt),x.block_start=x.strstart,W(x.strm)}function yt(x,lt){x.pending_buf[x.pending++]=lt}function X(x,lt){x.pending_buf[x.pending++]=lt>>>8&255,x.pending_buf[x.pending++]=255&lt}function at(x,lt){var rt,j,B=x.max_chain_length,V=x.strstart,ht=x.prev_length,dt=x.nice_match,Q=x.strstart>x.w_size-J?x.strstart-(x.w_size-J):0,_t=x.window,vt=x.w_mask,mt=x.prev,It=x.strstart+z,fe=_t[V+ht-1],Wt=_t[V+ht];x.prev_length>=x.good_match&&(B>>=2),dt>x.lookahead&&(dt=x.lookahead);do if(_t[(rt=lt)+ht]===Wt&&_t[rt+ht-1]===fe&&_t[rt]===_t[V]&&_t[++rt]===_t[V+1]){V+=2,rt++;do;while(_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&V<It);if(j=z-(It-V),V=It-z,ht<j){if(x.match_start=lt,dt<=(ht=j))break;fe=_t[V+ht-1],Wt=_t[V+ht]}}while((lt=mt[lt&vt])>Q&&--B!=0);return ht<=x.lookahead?ht:x.lookahead}function Pt(x){var lt,rt,j,B,V,ht,dt,Q,_t,vt,mt=x.w_size;do{if(B=x.window_size-x.lookahead-x.strstart,x.strstart>=mt+(mt-J)){for(o.arraySet(x.window,x.window,mt,mt,0),x.match_start-=mt,x.strstart-=mt,x.block_start-=mt,lt=rt=x.hash_size;j=x.head[--lt],x.head[lt]=mt<=j?j-mt:0,--rt;);for(lt=rt=mt;j=x.prev[--lt],x.prev[lt]=mt<=j?j-mt:0,--rt;);B+=mt}if(x.strm.avail_in===0)break;if(ht=x.strm,dt=x.window,Q=x.strstart+x.lookahead,_t=B,vt=void 0,vt=ht.avail_in,_t<vt&&(vt=_t),rt=vt===0?0:(ht.avail_in-=vt,o.arraySet(dt,ht.input,ht.next_in,vt,Q),ht.state.wrap===1?ht.adler=c(ht.adler,dt,vt,Q):ht.state.wrap===2&&(ht.adler=l(ht.adler,dt,vt,Q)),ht.next_in+=vt,ht.total_in+=vt,vt),x.lookahead+=rt,x.lookahead+x.insert>=N)for(V=x.strstart-x.insert,x.ins_h=x.window[V],x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+N-1])&x.hash_mask,x.prev[V&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=V,V++,x.insert--,!(x.lookahead+x.insert<N)););}while(x.lookahead<J&&x.strm.avail_in!==0)}function Kt(x,lt){for(var rt,j;;){if(x.lookahead<J){if(Pt(x),x.lookahead<J&&lt===f)return w;if(x.lookahead===0)break}if(rt=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,rt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),rt!==0&&x.strstart-rt<=x.w_size-J&&(x.match_length=at(x,rt)),x.match_length>=N)if(j=a._tr_tally(x,x.strstart-x.match_start,x.match_length-N),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=N){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,rt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else j=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(j&&(D(x,!1),x.strm.avail_out===0))return w}return x.insert=x.strstart<N-1?x.strstart:N-1,lt===d?(D(x,!0),x.strm.avail_out===0?P:F):x.last_lit&&(D(x,!1),x.strm.avail_out===0)?w:C}function jt(x,lt){for(var rt,j,B;;){if(x.lookahead<J){if(Pt(x),x.lookahead<J&&lt===f)return w;if(x.lookahead===0)break}if(rt=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,rt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=N-1,rt!==0&&x.prev_length<x.max_lazy_match&&x.strstart-rt<=x.w_size-J&&(x.match_length=at(x,rt),x.match_length<=5&&(x.strategy===1||x.match_length===N&&4096<x.strstart-x.match_start)&&(x.match_length=N-1)),x.prev_length>=N&&x.match_length<=x.prev_length){for(B=x.strstart+x.lookahead-N,j=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-N),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=B&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,rt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=N-1,x.strstart++,j&&(D(x,!1),x.strm.avail_out===0))return w}else if(x.match_available){if((j=a._tr_tally(x,0,x.window[x.strstart-1]))&&D(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return w}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(j=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<N-1?x.strstart:N-1,lt===d?(D(x,!0),x.strm.avail_out===0?P:F):x.last_lit&&(D(x,!1),x.strm.avail_out===0)?w:C}function $t(x,lt,rt,j,B){this.good_length=x,this.max_lazy=lt,this.nice_length=rt,this.max_chain=j,this.func=B}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*I),this.dyn_dtree=new o.Buf16(2*(2*L+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),it(this.dyn_ltree),it(this.dyn_dtree),it(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16($+1),this.heap=new o.Buf16(2*A+1),it(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),it(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Jt(x){var lt;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=b,(lt=x.state).pending=0,lt.pending_out=0,lt.wrap<0&&(lt.wrap=-lt.wrap),lt.status=lt.wrap?M:O,x.adler=lt.wrap===2?0:1,lt.last_flush=f,a._tr_init(lt),h):ot(x,m)}function Ne(x){var lt=Jt(x);return lt===h&&function(rt){rt.window_size=2*rt.w_size,it(rt.head),rt.max_lazy_match=s[rt.level].max_lazy,rt.good_match=s[rt.level].good_length,rt.nice_match=s[rt.level].nice_length,rt.max_chain_length=s[rt.level].max_chain,rt.strstart=0,rt.block_start=0,rt.lookahead=0,rt.insert=0,rt.match_length=rt.prev_length=N-1,rt.match_available=0,rt.ins_h=0}(x.state),lt}function $e(x,lt,rt,j,B,V){if(!x)return m;var ht=1;if(lt===p&&(lt=6),j<0?(ht=0,j=-j):15<j&&(ht=2,j-=16),B<1||T<B||rt!==v||j<8||15<j||lt<0||9<lt||V<0||k<V)return ot(x,m);j===8&&(j=9);var dt=new le;return(x.state=dt).strm=x,dt.wrap=ht,dt.gzhead=null,dt.w_bits=j,dt.w_size=1<<dt.w_bits,dt.w_mask=dt.w_size-1,dt.hash_bits=B+7,dt.hash_size=1<<dt.hash_bits,dt.hash_mask=dt.hash_size-1,dt.hash_shift=~~((dt.hash_bits+N-1)/N),dt.window=new o.Buf8(2*dt.w_size),dt.head=new o.Buf16(dt.hash_size),dt.prev=new o.Buf16(dt.w_size),dt.lit_bufsize=1<<B+6,dt.pending_buf_size=4*dt.lit_bufsize,dt.pending_buf=new o.Buf8(dt.pending_buf_size),dt.d_buf=1*dt.lit_bufsize,dt.l_buf=3*dt.lit_bufsize,dt.level=lt,dt.strategy=V,dt.method=rt,Ne(x)}s=[new $t(0,0,0,0,function(x,lt){var rt=65535;for(rt>x.pending_buf_size-5&&(rt=x.pending_buf_size-5);;){if(x.lookahead<=1){if(Pt(x),x.lookahead===0&&lt===f)return w;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var j=x.block_start+rt;if((x.strstart===0||x.strstart>=j)&&(x.lookahead=x.strstart-j,x.strstart=j,D(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-J&&(D(x,!1),x.strm.avail_out===0))return w}return x.insert=0,lt===d?(D(x,!0),x.strm.avail_out===0?P:F):(x.strstart>x.block_start&&(D(x,!1),x.strm.avail_out),w)}),new $t(4,4,8,4,Kt),new $t(4,5,16,8,Kt),new $t(4,6,32,32,Kt),new $t(4,4,16,16,jt),new $t(8,16,32,32,jt),new $t(8,16,128,128,jt),new $t(8,32,128,256,jt),new $t(32,128,258,1024,jt),new $t(32,258,258,4096,jt)],i.deflateInit=function(x,lt){return $e(x,lt,v,15,8,0)},i.deflateInit2=$e,i.deflateReset=Ne,i.deflateResetKeep=Jt,i.deflateSetHeader=function(x,lt){return x&&x.state?x.state.wrap!==2?m:(x.state.gzhead=lt,h):m},i.deflate=function(x,lt){var rt,j,B,V;if(!x||!x.state||5<lt||lt<0)return x?ot(x,m):m;if(j=x.state,!x.output||!x.input&&x.avail_in!==0||j.status===666&&lt!==d)return ot(x,x.avail_out===0?-5:m);if(j.strm=x,rt=j.last_flush,j.last_flush=lt,j.status===M)if(j.wrap===2)x.adler=0,yt(j,31),yt(j,139),yt(j,8),j.gzhead?(yt(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),yt(j,255&j.gzhead.time),yt(j,j.gzhead.time>>8&255),yt(j,j.gzhead.time>>16&255),yt(j,j.gzhead.time>>24&255),yt(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),yt(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(yt(j,255&j.gzhead.extra.length),yt(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(x.adler=l(x.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(yt(j,0),yt(j,0),yt(j,0),yt(j,0),yt(j,0),yt(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),yt(j,3),j.status=O);else{var ht=v+(j.w_bits-8<<4)<<8;ht|=(2<=j.strategy||j.level<2?0:j.level<6?1:j.level===6?2:3)<<6,j.strstart!==0&&(ht|=32),ht+=31-ht%31,j.status=O,X(j,ht),j.strstart!==0&&(X(j,x.adler>>>16),X(j,65535&x.adler)),x.adler=1}if(j.status===69)if(j.gzhead.extra){for(B=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),W(x),B=j.pending,j.pending!==j.pending_buf_size));)yt(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(j.status===73)if(j.gzhead.name){B=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),W(x),B=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,yt(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),V===0&&(j.gzindex=0,j.status=91)}else j.status=91;if(j.status===91)if(j.gzhead.comment){B=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),W(x),B=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,yt(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),V===0&&(j.status=103)}else j.status=103;if(j.status===103&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&W(x),j.pending+2<=j.pending_buf_size&&(yt(j,255&x.adler),yt(j,x.adler>>8&255),x.adler=0,j.status=O)):j.status=O),j.pending!==0){if(W(x),x.avail_out===0)return j.last_flush=-1,h}else if(x.avail_in===0&&tt(lt)<=tt(rt)&&lt!==d)return ot(x,-5);if(j.status===666&&x.avail_in!==0)return ot(x,-5);if(x.avail_in!==0||j.lookahead!==0||lt!==f&&j.status!==666){var dt=j.strategy===2?function(Q,_t){for(var vt;;){if(Q.lookahead===0&&(Pt(Q),Q.lookahead===0)){if(_t===f)return w;break}if(Q.match_length=0,vt=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,vt&&(D(Q,!1),Q.strm.avail_out===0))return w}return Q.insert=0,_t===d?(D(Q,!0),Q.strm.avail_out===0?P:F):Q.last_lit&&(D(Q,!1),Q.strm.avail_out===0)?w:C}(j,lt):j.strategy===3?function(Q,_t){for(var vt,mt,It,fe,Wt=Q.window;;){if(Q.lookahead<=z){if(Pt(Q),Q.lookahead<=z&&_t===f)return w;if(Q.lookahead===0)break}if(Q.match_length=0,Q.lookahead>=N&&0<Q.strstart&&(mt=Wt[It=Q.strstart-1])===Wt[++It]&&mt===Wt[++It]&&mt===Wt[++It]){fe=Q.strstart+z;do;while(mt===Wt[++It]&&mt===Wt[++It]&&mt===Wt[++It]&&mt===Wt[++It]&&mt===Wt[++It]&&mt===Wt[++It]&&mt===Wt[++It]&&mt===Wt[++It]&&It<fe);Q.match_length=z-(fe-It),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead)}if(Q.match_length>=N?(vt=a._tr_tally(Q,1,Q.match_length-N),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(vt=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),vt&&(D(Q,!1),Q.strm.avail_out===0))return w}return Q.insert=0,_t===d?(D(Q,!0),Q.strm.avail_out===0?P:F):Q.last_lit&&(D(Q,!1),Q.strm.avail_out===0)?w:C}(j,lt):s[j.level].func(j,lt);if(dt!==P&&dt!==F||(j.status=666),dt===w||dt===P)return x.avail_out===0&&(j.last_flush=-1),h;if(dt===C&&(lt===1?a._tr_align(j):lt!==5&&(a._tr_stored_block(j,0,0,!1),lt===3&&(it(j.head),j.lookahead===0&&(j.strstart=0,j.block_start=0,j.insert=0))),W(x),x.avail_out===0))return j.last_flush=-1,h}return lt!==d?h:j.wrap<=0?1:(j.wrap===2?(yt(j,255&x.adler),yt(j,x.adler>>8&255),yt(j,x.adler>>16&255),yt(j,x.adler>>24&255),yt(j,255&x.total_in),yt(j,x.total_in>>8&255),yt(j,x.total_in>>16&255),yt(j,x.total_in>>24&255)):(X(j,x.adler>>>16),X(j,65535&x.adler)),W(x),0<j.wrap&&(j.wrap=-j.wrap),j.pending!==0?h:1)},i.deflateEnd=function(x){var lt;return x&&x.state?(lt=x.state.status)!==M&&lt!==69&&lt!==73&&lt!==91&&lt!==103&&lt!==O&&lt!==666?ot(x,m):(x.state=null,lt===O?ot(x,-3):h):m},i.deflateSetDictionary=function(x,lt){var rt,j,B,V,ht,dt,Q,_t,vt=lt.length;if(!x||!x.state||(V=(rt=x.state).wrap)===2||V===1&&rt.status!==M||rt.lookahead)return m;for(V===1&&(x.adler=c(x.adler,lt,vt,0)),rt.wrap=0,vt>=rt.w_size&&(V===0&&(it(rt.head),rt.strstart=0,rt.block_start=0,rt.insert=0),_t=new o.Buf8(rt.w_size),o.arraySet(_t,lt,vt-rt.w_size,rt.w_size,0),lt=_t,vt=rt.w_size),ht=x.avail_in,dt=x.next_in,Q=x.input,x.avail_in=vt,x.next_in=0,x.input=lt,Pt(rt);rt.lookahead>=N;){for(j=rt.strstart,B=rt.lookahead-(N-1);rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[j+N-1])&rt.hash_mask,rt.prev[j&rt.w_mask]=rt.head[rt.ins_h],rt.head[rt.ins_h]=j,j++,--B;);rt.strstart=j,rt.lookahead=N-1,Pt(rt)}return rt.strstart+=rt.lookahead,rt.block_start=rt.strstart,rt.insert=rt.lookahead,rt.lookahead=0,rt.match_length=rt.prev_length=N-1,rt.match_available=0,x.next_in=dt,x.input=Q,x.avail_in=ht,rt.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,m,p,k,b,v,T,A,L,S,I,$,N,z,J,M,O,w,C;a=s.state,c=s.next_in,w=s.input,l=c+(s.avail_in-5),u=s.next_out,C=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,k=a.wnext,b=a.window,v=a.hold,T=a.bits,A=a.lencode,L=a.distcode,S=(1<<a.lenbits)-1,I=(1<<a.distbits)-1;t:do{T<15&&(v+=w[c++]<<T,T+=8,v+=w[c++]<<T,T+=8),$=A[v&S];e:for(;;){if(v>>>=N=$>>>24,T-=N,(N=$>>>16&255)===0)C[u++]=65535&$;else{if(!(16&N)){if(!(64&N)){$=A[(65535&$)+(v&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}z=65535&$,(N&=15)&&(T<N&&(v+=w[c++]<<T,T+=8),z+=v&(1<<N)-1,v>>>=N,T-=N),T<15&&(v+=w[c++]<<T,T+=8,v+=w[c++]<<T,T+=8),$=L[v&I];n:for(;;){if(v>>>=N=$>>>24,T-=N,!(16&(N=$>>>16&255))){if(!(64&N)){$=L[(65535&$)+(v&(1<<N)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(J=65535&$,T<(N&=15)&&(v+=w[c++]<<T,(T+=8)<N&&(v+=w[c++]<<T,T+=8)),h<(J+=v&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=N,T-=N,(N=u-f)<J){if(p<(N=J-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(O=b,(M=0)===k){if(M+=m-N,N<z){for(z-=N;C[u++]=b[M++],--N;);M=u-J,O=C}}else if(k<N){if(M+=m+k-N,(N-=k)<z){for(z-=N;C[u++]=b[M++],--N;);if(M=0,k<z){for(z-=N=k;C[u++]=b[M++],--N;);M=u-J,O=C}}}else if(M+=k-N,N<z){for(z-=N;C[u++]=b[M++],--N;);M=u-J,O=C}for(;2<z;)C[u++]=O[M++],C[u++]=O[M++],C[u++]=O[M++],z-=3;z&&(C[u++]=O[M++],1<z&&(C[u++]=O[M++]))}else{for(M=u-J;C[u++]=C[M++],C[u++]=C[M++],C[u++]=C[M++],2<(z-=3););z&&(C[u++]=C[M++],1<z&&(C[u++]=C[M++]))}break}}break}}while(c<l&&u<d);c-=z=T>>3,v&=(1<<(T-=z<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=v,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,m=1,p=852,k=592;function b(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(M){var O;return M&&M.state?(O=M.state,M.total_in=M.total_out=O.total=0,M.msg="",O.wrap&&(M.adler=1&O.wrap),O.mode=m,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(p),O.distcode=O.distdyn=new s.Buf32(k),O.sane=1,O.back=-1,d):h}function A(M){var O;return M&&M.state?((O=M.state).wsize=0,O.whave=0,O.wnext=0,T(M)):h}function L(M,O){var w,C;return M&&M.state?(C=M.state,O<0?(w=0,O=-O):(w=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:(C.window!==null&&C.wbits!==O&&(C.window=null),C.wrap=w,C.wbits=O,A(M))):h}function S(M,O){var w,C;return M?(C=new v,(M.state=C).window=null,(w=L(M,O))!==d&&(M.state=null),w):h}var I,$,N=!0;function z(M){if(N){var O;for(I=new s.Buf32(512),$=new s.Buf32(32),O=0;O<144;)M.lens[O++]=8;for(;O<256;)M.lens[O++]=9;for(;O<280;)M.lens[O++]=7;for(;O<288;)M.lens[O++]=8;for(l(u,M.lens,0,288,I,0,M.work,{bits:9}),O=0;O<32;)M.lens[O++]=5;l(f,M.lens,0,32,$,0,M.work,{bits:5}),N=!1}M.lencode=I,M.lenbits=9,M.distcode=$,M.distbits=5}function J(M,O,w,C){var P,F=M.state;return F.window===null&&(F.wsize=1<<F.wbits,F.wnext=0,F.whave=0,F.window=new s.Buf8(F.wsize)),C>=F.wsize?(s.arraySet(F.window,O,w-F.wsize,F.wsize,0),F.wnext=0,F.whave=F.wsize):(C<(P=F.wsize-F.wnext)&&(P=C),s.arraySet(F.window,O,w-C,P,F.wnext),(C-=P)?(s.arraySet(F.window,O,w-C,C,0),F.wnext=C,F.whave=F.wsize):(F.wnext+=P,F.wnext===F.wsize&&(F.wnext=0),F.whave<F.wsize&&(F.whave+=P))),0}i.inflateReset=A,i.inflateReset2=L,i.inflateResetKeep=T,i.inflateInit=function(M){return S(M,15)},i.inflateInit2=S,i.inflate=function(M,O){var w,C,P,F,ot,tt,it,W,D,yt,X,at,Pt,Kt,jt,$t,le,Jt,Ne,$e,x,lt,rt,j,B=0,V=new s.Buf8(4),ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return h;(w=M.state).mode===12&&(w.mode=13),ot=M.next_out,P=M.output,it=M.avail_out,F=M.next_in,C=M.input,tt=M.avail_in,W=w.hold,D=w.bits,yt=tt,X=it,lt=d;t:for(;;)switch(w.mode){case m:if(w.wrap===0){w.mode=13;break}for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(2&w.wrap&&W===35615){V[w.check=0]=255&W,V[1]=W>>>8&255,w.check=a(w.check,V,2,0),D=W=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&W)<<8)+(W>>8))%31){M.msg="incorrect header check",w.mode=30;break}if((15&W)!=8){M.msg="unknown compression method",w.mode=30;break}if(D-=4,x=8+(15&(W>>>=4)),w.wbits===0)w.wbits=x;else if(x>w.wbits){M.msg="invalid window size",w.mode=30;break}w.dmax=1<<x,M.adler=w.check=1,w.mode=512&W?10:12,D=W=0;break;case 2:for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(w.flags=W,(255&w.flags)!=8){M.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){M.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=W>>8&1),512&w.flags&&(V[0]=255&W,V[1]=W>>>8&255,w.check=a(w.check,V,2,0)),D=W=0,w.mode=3;case 3:for(;D<32;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}w.head&&(w.head.time=W),512&w.flags&&(V[0]=255&W,V[1]=W>>>8&255,V[2]=W>>>16&255,V[3]=W>>>24&255,w.check=a(w.check,V,4,0)),D=W=0,w.mode=4;case 4:for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}w.head&&(w.head.xflags=255&W,w.head.os=W>>8),512&w.flags&&(V[0]=255&W,V[1]=W>>>8&255,w.check=a(w.check,V,2,0)),D=W=0,w.mode=5;case 5:if(1024&w.flags){for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}w.length=W,w.head&&(w.head.extra_len=W),512&w.flags&&(V[0]=255&W,V[1]=W>>>8&255,w.check=a(w.check,V,2,0)),D=W=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(tt<(at=w.length)&&(at=tt),at&&(w.head&&(x=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),s.arraySet(w.head.extra,C,F,at,x)),512&w.flags&&(w.check=a(w.check,C,at,F)),tt-=at,F+=at,w.length-=at),w.length))break t;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(tt===0)break t;for(at=0;x=C[F+at++],w.head&&x&&w.length<65536&&(w.head.name+=String.fromCharCode(x)),x&&at<tt;);if(512&w.flags&&(w.check=a(w.check,C,at,F)),tt-=at,F+=at,x)break t}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(tt===0)break t;for(at=0;x=C[F+at++],w.head&&x&&w.length<65536&&(w.head.comment+=String.fromCharCode(x)),x&&at<tt;);if(512&w.flags&&(w.check=a(w.check,C,at,F)),tt-=at,F+=at,x)break t}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(W!==(65535&w.check)){M.msg="header crc mismatch",w.mode=30;break}D=W=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),M.adler=w.check=0,w.mode=12;break;case 10:for(;D<32;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}M.adler=w.check=b(W),D=W=0,w.mode=11;case 11:if(w.havedict===0)return M.next_out=ot,M.avail_out=it,M.next_in=F,M.avail_in=tt,w.hold=W,w.bits=D,2;M.adler=w.check=1,w.mode=12;case 12:if(O===5||O===6)break t;case 13:if(w.last){W>>>=7&D,D-=7&D,w.mode=27;break}for(;D<3;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}switch(w.last=1&W,D-=1,3&(W>>>=1)){case 0:w.mode=14;break;case 1:if(z(w),w.mode=20,O!==6)break;W>>>=2,D-=2;break t;case 2:w.mode=17;break;case 3:M.msg="invalid block type",w.mode=30}W>>>=2,D-=2;break;case 14:for(W>>>=7&D,D-=7&D;D<32;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if((65535&W)!=(W>>>16^65535)){M.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&W,D=W=0,w.mode=15,O===6)break t;case 15:w.mode=16;case 16:if(at=w.length){if(tt<at&&(at=tt),it<at&&(at=it),at===0)break t;s.arraySet(P,C,F,at,ot),tt-=at,F+=at,it-=at,ot+=at,w.length-=at;break}w.mode=12;break;case 17:for(;D<14;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(w.nlen=257+(31&W),W>>>=5,D-=5,w.ndist=1+(31&W),W>>>=5,D-=5,w.ncode=4+(15&W),W>>>=4,D-=4,286<w.nlen||30<w.ndist){M.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;D<3;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}w.lens[ht[w.have++]]=7&W,W>>>=3,D-=3}for(;w.have<19;)w.lens[ht[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,rt={bits:w.lenbits},lt=l(0,w.lens,0,19,w.lencode,0,w.work,rt),w.lenbits=rt.bits,lt){M.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;$t=(B=w.lencode[W&(1<<w.lenbits)-1])>>>16&255,le=65535&B,!((jt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(le<16)W>>>=jt,D-=jt,w.lens[w.have++]=le;else{if(le===16){for(j=jt+2;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(W>>>=jt,D-=jt,w.have===0){M.msg="invalid bit length repeat",w.mode=30;break}x=w.lens[w.have-1],at=3+(3&W),W>>>=2,D-=2}else if(le===17){for(j=jt+3;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}D-=jt,x=0,at=3+(7&(W>>>=jt)),W>>>=3,D-=3}else{for(j=jt+7;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}D-=jt,x=0,at=11+(127&(W>>>=jt)),W>>>=7,D-=7}if(w.have+at>w.nlen+w.ndist){M.msg="invalid bit length repeat",w.mode=30;break}for(;at--;)w.lens[w.have++]=x}}if(w.mode===30)break;if(w.lens[256]===0){M.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,rt={bits:w.lenbits},lt=l(u,w.lens,0,w.nlen,w.lencode,0,w.work,rt),w.lenbits=rt.bits,lt){M.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,rt={bits:w.distbits},lt=l(f,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,rt),w.distbits=rt.bits,lt){M.msg="invalid distances set",w.mode=30;break}if(w.mode=20,O===6)break t;case 20:w.mode=21;case 21:if(6<=tt&&258<=it){M.next_out=ot,M.avail_out=it,M.next_in=F,M.avail_in=tt,w.hold=W,w.bits=D,c(M,X),ot=M.next_out,P=M.output,it=M.avail_out,F=M.next_in,C=M.input,tt=M.avail_in,W=w.hold,D=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;$t=(B=w.lencode[W&(1<<w.lenbits)-1])>>>16&255,le=65535&B,!((jt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if($t&&!(240&$t)){for(Jt=jt,Ne=$t,$e=le;$t=(B=w.lencode[$e+((W&(1<<Jt+Ne)-1)>>Jt)])>>>16&255,le=65535&B,!(Jt+(jt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}W>>>=Jt,D-=Jt,w.back+=Jt}if(W>>>=jt,D-=jt,w.back+=jt,w.length=le,$t===0){w.mode=26;break}if(32&$t){w.back=-1,w.mode=12;break}if(64&$t){M.msg="invalid literal/length code",w.mode=30;break}w.extra=15&$t,w.mode=22;case 22:if(w.extra){for(j=w.extra;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}w.length+=W&(1<<w.extra)-1,W>>>=w.extra,D-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;$t=(B=w.distcode[W&(1<<w.distbits)-1])>>>16&255,le=65535&B,!((jt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(!(240&$t)){for(Jt=jt,Ne=$t,$e=le;$t=(B=w.distcode[$e+((W&(1<<Jt+Ne)-1)>>Jt)])>>>16&255,le=65535&B,!(Jt+(jt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}W>>>=Jt,D-=Jt,w.back+=Jt}if(W>>>=jt,D-=jt,w.back+=jt,64&$t){M.msg="invalid distance code",w.mode=30;break}w.offset=le,w.extra=15&$t,w.mode=24;case 24:if(w.extra){for(j=w.extra;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}w.offset+=W&(1<<w.extra)-1,W>>>=w.extra,D-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){M.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(it===0)break t;if(at=X-it,w.offset>at){if((at=w.offset-at)>w.whave&&w.sane){M.msg="invalid distance too far back",w.mode=30;break}Pt=at>w.wnext?(at-=w.wnext,w.wsize-at):w.wnext-at,at>w.length&&(at=w.length),Kt=w.window}else Kt=P,Pt=ot-w.offset,at=w.length;for(it<at&&(at=it),it-=at,w.length-=at;P[ot++]=Kt[Pt++],--at;);w.length===0&&(w.mode=21);break;case 26:if(it===0)break t;P[ot++]=w.length,it--,w.mode=21;break;case 27:if(w.wrap){for(;D<32;){if(tt===0)break t;tt--,W|=C[F++]<<D,D+=8}if(X-=it,M.total_out+=X,w.total+=X,X&&(M.adler=w.check=w.flags?a(w.check,P,X,ot-X):o(w.check,P,X,ot-X)),X=it,(w.flags?W:b(W))!==w.check){M.msg="incorrect data check",w.mode=30;break}D=W=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;D<32;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(W!==(4294967295&w.total)){M.msg="incorrect length check",w.mode=30;break}D=W=0}w.mode=29;case 29:lt=1;break t;case 30:lt=-3;break t;case 31:return-4;case 32:default:return h}return M.next_out=ot,M.avail_out=it,M.next_in=F,M.avail_in=tt,w.hold=W,w.bits=D,(w.wsize||X!==M.avail_out&&w.mode<30&&(w.mode<27||O!==4))&&J(M,M.output,M.next_out,X-M.avail_out)?(w.mode=31,-4):(yt-=M.avail_in,X-=M.avail_out,M.total_in+=yt,M.total_out+=X,w.total+=X,w.wrap&&X&&(M.adler=w.check=w.flags?a(w.check,P,X,M.next_out-X):o(w.check,P,X,M.next_out-X)),M.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(yt==0&&X===0||O===4)&&lt===d&&(lt=-5),lt)},i.inflateEnd=function(M){if(!M||!M.state)return h;var O=M.state;return O.window&&(O.window=null),M.state=null,d},i.inflateGetHeader=function(M,O){var w;return M&&M.state&&2&(w=M.state).wrap?((w.head=O).done=!1,d):h},i.inflateSetDictionary=function(M,O){var w,C=O.length;return M&&M.state?(w=M.state).wrap!==0&&w.mode!==11?h:w.mode===11&&o(1,O,C,0)!==w.check?-3:J(M,O,C,C)?(w.mode=31,-4):(w.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,m,p,k,b){var v,T,A,L,S,I,$,N,z,J=b.bits,M=0,O=0,w=0,C=0,P=0,F=0,ot=0,tt=0,it=0,W=0,D=null,yt=0,X=new s.Buf16(16),at=new s.Buf16(16),Pt=null,Kt=0;for(M=0;M<=15;M++)X[M]=0;for(O=0;O<h;O++)X[f[d+O]]++;for(P=J,C=15;1<=C&&X[C]===0;C--);if(C<P&&(P=C),C===0)return m[p++]=20971520,m[p++]=20971520,b.bits=1,0;for(w=1;w<C&&X[w]===0;w++);for(P<w&&(P=w),M=tt=1;M<=15;M++)if(tt<<=1,(tt-=X[M])<0)return-1;if(0<tt&&(u===0||C!==1))return-1;for(at[1]=0,M=1;M<15;M++)at[M+1]=at[M]+X[M];for(O=0;O<h;O++)f[d+O]!==0&&(k[at[f[d+O]]++]=O);if(I=u===0?(D=Pt=k,19):u===1?(D=o,yt-=257,Pt=a,Kt-=257,256):(D=c,Pt=l,-1),M=w,S=p,ot=O=W=0,A=-1,L=(it=1<<(F=P))-1,u===1&&852<it||u===2&&592<it)return 1;for(;;){for($=M-ot,z=k[O]<I?(N=0,k[O]):k[O]>I?(N=Pt[Kt+k[O]],D[yt+k[O]]):(N=96,0),v=1<<M-ot,w=T=1<<F;m[S+(W>>ot)+(T-=v)]=$<<24|N<<16|z|0,T!==0;);for(v=1<<M-1;W&v;)v>>=1;if(v!==0?(W&=v-1,W+=v):W=0,O++,--X[M]==0){if(M===C)break;M=f[d+k[O]]}if(P<M&&(W&L)!==A){for(ot===0&&(ot=P),S+=w,tt=1<<(F=M-ot);F+ot<C&&!((tt-=X[F+ot])<=0);)F++,tt<<=1;if(it+=1<<F,u===1&&852<it||u===2&&592<it)return 1;m[A=W&L]=P<<24|F<<16|S-p|0}}return W!==0&&(m[S+W]=M-ot<<24|64<<16|0),b.bits=P,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(B){for(var V=B.length;0<=--V;)B[V]=0}var l=0,u=29,f=256,d=f+1+u,h=30,m=19,p=2*d+1,k=15,b=16,v=7,T=256,A=16,L=17,S=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(d+2));c(J);var M=new Array(2*h);c(M);var O=new Array(512);c(O);var w=new Array(256);c(w);var C=new Array(u);c(C);var P,F,ot,tt=new Array(h);function it(B,V,ht,dt,Q){this.static_tree=B,this.extra_bits=V,this.extra_base=ht,this.elems=dt,this.max_length=Q,this.has_stree=B&&B.length}function W(B,V){this.dyn_tree=B,this.max_code=0,this.stat_desc=V}function D(B){return B<256?O[B]:O[256+(B>>>7)]}function yt(B,V){B.pending_buf[B.pending++]=255&V,B.pending_buf[B.pending++]=V>>>8&255}function X(B,V,ht){B.bi_valid>b-ht?(B.bi_buf|=V<<B.bi_valid&65535,yt(B,B.bi_buf),B.bi_buf=V>>b-B.bi_valid,B.bi_valid+=ht-b):(B.bi_buf|=V<<B.bi_valid&65535,B.bi_valid+=ht)}function at(B,V,ht){X(B,ht[2*V],ht[2*V+1])}function Pt(B,V){for(var ht=0;ht|=1&B,B>>>=1,ht<<=1,0<--V;);return ht>>>1}function Kt(B,V,ht){var dt,Q,_t=new Array(k+1),vt=0;for(dt=1;dt<=k;dt++)_t[dt]=vt=vt+ht[dt-1]<<1;for(Q=0;Q<=V;Q++){var mt=B[2*Q+1];mt!==0&&(B[2*Q]=Pt(_t[mt]++,mt))}}function jt(B){var V;for(V=0;V<d;V++)B.dyn_ltree[2*V]=0;for(V=0;V<h;V++)B.dyn_dtree[2*V]=0;for(V=0;V<m;V++)B.bl_tree[2*V]=0;B.dyn_ltree[2*T]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0}function $t(B){8<B.bi_valid?yt(B,B.bi_buf):0<B.bi_valid&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0}function le(B,V,ht,dt){var Q=2*V,_t=2*ht;return B[Q]<B[_t]||B[Q]===B[_t]&&dt[V]<=dt[ht]}function Jt(B,V,ht){for(var dt=B.heap[ht],Q=ht<<1;Q<=B.heap_len&&(Q<B.heap_len&&le(V,B.heap[Q+1],B.heap[Q],B.depth)&&Q++,!le(V,dt,B.heap[Q],B.depth));)B.heap[ht]=B.heap[Q],ht=Q,Q<<=1;B.heap[ht]=dt}function Ne(B,V,ht){var dt,Q,_t,vt,mt=0;if(B.last_lit!==0)for(;dt=B.pending_buf[B.d_buf+2*mt]<<8|B.pending_buf[B.d_buf+2*mt+1],Q=B.pending_buf[B.l_buf+mt],mt++,dt===0?at(B,Q,V):(at(B,(_t=w[Q])+f+1,V),(vt=I[_t])!==0&&X(B,Q-=C[_t],vt),at(B,_t=D(--dt),ht),(vt=$[_t])!==0&&X(B,dt-=tt[_t],vt)),mt<B.last_lit;);at(B,T,V)}function $e(B,V){var ht,dt,Q,_t=V.dyn_tree,vt=V.stat_desc.static_tree,mt=V.stat_desc.has_stree,It=V.stat_desc.elems,fe=-1;for(B.heap_len=0,B.heap_max=p,ht=0;ht<It;ht++)_t[2*ht]!==0?(B.heap[++B.heap_len]=fe=ht,B.depth[ht]=0):_t[2*ht+1]=0;for(;B.heap_len<2;)_t[2*(Q=B.heap[++B.heap_len]=fe<2?++fe:0)]=1,B.depth[Q]=0,B.opt_len--,mt&&(B.static_len-=vt[2*Q+1]);for(V.max_code=fe,ht=B.heap_len>>1;1<=ht;ht--)Jt(B,_t,ht);for(Q=It;ht=B.heap[1],B.heap[1]=B.heap[B.heap_len--],Jt(B,_t,1),dt=B.heap[1],B.heap[--B.heap_max]=ht,B.heap[--B.heap_max]=dt,_t[2*Q]=_t[2*ht]+_t[2*dt],B.depth[Q]=(B.depth[ht]>=B.depth[dt]?B.depth[ht]:B.depth[dt])+1,_t[2*ht+1]=_t[2*dt+1]=Q,B.heap[1]=Q++,Jt(B,_t,1),2<=B.heap_len;);B.heap[--B.heap_max]=B.heap[1],function(Wt,qn){var R,g,_,U,G,et,ct=qn.dyn_tree,Yt=qn.max_code,Ie=qn.stat_desc.static_tree,Ee=qn.stat_desc.has_stree,Ce=qn.stat_desc.extra_bits,he=qn.stat_desc.extra_base,za=qn.stat_desc.max_length,au=0;for(U=0;U<=k;U++)Wt.bl_count[U]=0;for(ct[2*Wt.heap[Wt.heap_max]+1]=0,R=Wt.heap_max+1;R<p;R++)za<(U=ct[2*ct[2*(g=Wt.heap[R])+1]+1]+1)&&(U=za,au++),ct[2*g+1]=U,Yt<g||(Wt.bl_count[U]++,G=0,he<=g&&(G=Ce[g-he]),et=ct[2*g],Wt.opt_len+=et*(U+G),Ee&&(Wt.static_len+=et*(Ie[2*g+1]+G)));if(au!==0){do{for(U=za-1;Wt.bl_count[U]===0;)U--;Wt.bl_count[U]--,Wt.bl_count[U+1]+=2,Wt.bl_count[za]--,au-=2}while(0<au);for(U=za;U!==0;U--)for(g=Wt.bl_count[U];g!==0;)Yt<(_=Wt.heap[--R])||(ct[2*_+1]!==U&&(Wt.opt_len+=(U-ct[2*_+1])*ct[2*_],ct[2*_+1]=U),g--)}}(B,V),Kt(_t,fe,B.bl_count)}function x(B,V,ht){var dt,Q,_t=-1,vt=V[1],mt=0,It=7,fe=4;for(vt===0&&(It=138,fe=3),V[2*(ht+1)+1]=65535,dt=0;dt<=ht;dt++)Q=vt,vt=V[2*(dt+1)+1],++mt<It&&Q===vt||(mt<fe?B.bl_tree[2*Q]+=mt:Q!==0?(Q!==_t&&B.bl_tree[2*Q]++,B.bl_tree[2*A]++):mt<=10?B.bl_tree[2*L]++:B.bl_tree[2*S]++,_t=Q,fe=(mt=0)===vt?(It=138,3):Q===vt?(It=6,3):(It=7,4))}function lt(B,V,ht){var dt,Q,_t=-1,vt=V[1],mt=0,It=7,fe=4;for(vt===0&&(It=138,fe=3),dt=0;dt<=ht;dt++)if(Q=vt,vt=V[2*(dt+1)+1],!(++mt<It&&Q===vt)){if(mt<fe)for(;at(B,Q,B.bl_tree),--mt!=0;);else Q!==0?(Q!==_t&&(at(B,Q,B.bl_tree),mt--),at(B,A,B.bl_tree),X(B,mt-3,2)):mt<=10?(at(B,L,B.bl_tree),X(B,mt-3,3)):(at(B,S,B.bl_tree),X(B,mt-11,7));_t=Q,fe=(mt=0)===vt?(It=138,3):Q===vt?(It=6,3):(It=7,4)}}c(tt);var rt=!1;function j(B,V,ht,dt){X(B,(l<<1)+(dt?1:0),3),function(Q,_t,vt,mt){$t(Q),yt(Q,vt),yt(Q,~vt),s.arraySet(Q.pending_buf,Q.window,_t,vt,Q.pending),Q.pending+=vt}(B,V,ht)}i._tr_init=function(B){rt||(function(){var V,ht,dt,Q,_t,vt=new Array(k+1);for(Q=dt=0;Q<u-1;Q++)for(C[Q]=dt,V=0;V<1<<I[Q];V++)w[dt++]=Q;for(w[dt-1]=Q,Q=_t=0;Q<16;Q++)for(tt[Q]=_t,V=0;V<1<<$[Q];V++)O[_t++]=Q;for(_t>>=7;Q<h;Q++)for(tt[Q]=_t<<7,V=0;V<1<<$[Q]-7;V++)O[256+_t++]=Q;for(ht=0;ht<=k;ht++)vt[ht]=0;for(V=0;V<=143;)J[2*V+1]=8,V++,vt[8]++;for(;V<=255;)J[2*V+1]=9,V++,vt[9]++;for(;V<=279;)J[2*V+1]=7,V++,vt[7]++;for(;V<=287;)J[2*V+1]=8,V++,vt[8]++;for(Kt(J,d+1,vt),V=0;V<h;V++)M[2*V+1]=5,M[2*V]=Pt(V,5);P=new it(J,I,f+1,d,k),F=new it(M,$,0,h,k),ot=new it(new Array(0),N,0,m,v)}(),rt=!0),B.l_desc=new W(B.dyn_ltree,P),B.d_desc=new W(B.dyn_dtree,F),B.bl_desc=new W(B.bl_tree,ot),B.bi_buf=0,B.bi_valid=0,jt(B)},i._tr_stored_block=j,i._tr_flush_block=function(B,V,ht,dt){var Q,_t,vt=0;0<B.level?(B.strm.data_type===2&&(B.strm.data_type=function(mt){var It,fe=4093624447;for(It=0;It<=31;It++,fe>>>=1)if(1&fe&&mt.dyn_ltree[2*It]!==0)return o;if(mt.dyn_ltree[18]!==0||mt.dyn_ltree[20]!==0||mt.dyn_ltree[26]!==0)return a;for(It=32;It<f;It++)if(mt.dyn_ltree[2*It]!==0)return a;return o}(B)),$e(B,B.l_desc),$e(B,B.d_desc),vt=function(mt){var It;for(x(mt,mt.dyn_ltree,mt.l_desc.max_code),x(mt,mt.dyn_dtree,mt.d_desc.max_code),$e(mt,mt.bl_desc),It=m-1;3<=It&&mt.bl_tree[2*z[It]+1]===0;It--);return mt.opt_len+=3*(It+1)+5+5+4,It}(B),Q=B.opt_len+3+7>>>3,(_t=B.static_len+3+7>>>3)<=Q&&(Q=_t)):Q=_t=ht+5,ht+4<=Q&&V!==-1?j(B,V,ht,dt):B.strategy===4||_t===Q?(X(B,2+(dt?1:0),3),Ne(B,J,M)):(X(B,4+(dt?1:0),3),function(mt,It,fe,Wt){var qn;for(X(mt,It-257,5),X(mt,fe-1,5),X(mt,Wt-4,4),qn=0;qn<Wt;qn++)X(mt,mt.bl_tree[2*z[qn]+1],3);lt(mt,mt.dyn_ltree,It-1),lt(mt,mt.dyn_dtree,fe-1)}(B,B.l_desc.max_code+1,B.d_desc.max_code+1,vt+1),Ne(B,B.dyn_ltree,B.dyn_dtree)),jt(B),dt&&$t(B)},i._tr_tally=function(B,V,ht){return B.pending_buf[B.d_buf+2*B.last_lit]=V>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&V,B.pending_buf[B.l_buf+B.last_lit]=255&ht,B.last_lit++,V===0?B.dyn_ltree[2*ht]++:(B.matches++,V--,B.dyn_ltree[2*(w[ht]+f+1)]++,B.dyn_dtree[2*D(V)]++),B.last_lit===B.lit_bufsize-1},i._tr_align=function(B){X(B,2,3),at(B,T,J),function(V){V.bi_valid===16?(yt(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(B)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},m=!1,p=o.document,k=Object.getPrototypeOf&&Object.getPrototypeOf(o);k=k&&k.setTimeout?k:o,c={}.toString.call(o.process)==="[object process]"?function(A){Ar.nextTick(function(){v(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,L=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=L,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){u.port2.postMessage(A)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(A){var L=p.createElement("script");L.onreadystatechange=function(){v(A),L.onreadystatechange=null,l.removeChild(L),L=null},l.appendChild(L)}):function(A){setTimeout(v,0,A)},k.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var L=new Array(arguments.length-1),S=0;S<L.length;S++)L[S]=arguments[S+1];var I={callback:A,args:L};return h[d]=I,c(d),d++},k.clearImmediate=b}function b(A){delete h[A]}function v(A){if(m)setTimeout(v,0,A);else{var L=h[A];if(L){m=!0;try{(function(S){var I=S.callback,$=S.args;switch($.length){case 0:I();break;case 1:I($[0]);break;case 2:I($[0],$[1]);break;case 3:I($[0],$[1],$[2]);break;default:I.apply(a,$)}})(L)}finally{b(A),m=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&v(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Fn<"u"?Fn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(zE);var a$=zE.exports,Fd=Us(a$);const WE={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(WE);var vr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},No,ja,Ms;class c${constructor(...t){No.set(this,new Map),ja.set(this,new Map),Ms.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),vr(this,Ms,"f").has(r)||vr(this,Ms,"f").set(r,new Set);const s=vr(this,Ms,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&vr(this,ja,"f").set(r,a),o=!1,c)continue;const l=vr(this,No,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);vr(this,No,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:vr(this,No,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&vr(this,ja,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:vr(this,Ms,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of vr(this,Ms,"f").values())Object.freeze(t);return this}_getTestState(){return{types:vr(this,No,"f"),extensions:vr(this,ja,"f")}}}No=new WeakMap,ja=new WeakMap,Ms=new WeakMap;var l$=new c$(WE)._freeze();function u$(e,t){console.info(t)}function h$(e,t){console.info(t)}const su=60,f$=su*25;function d$(e,t){let n=0;const r=new DataView(t.buffer);function i(){const C=r.getUint8(n);return n++,C}function s(){const C=r.getInt16(n,!0);return n+=2,C}function o(){const C=r.getInt32(n,!0);return n+=4,C}function a(C){let P="";const F=t.subarray(n,n+C);for(let ot=0;ot<F.length;++ot)P+=String.fromCharCode(F[ot]);return n+=C,P.replace("\r",`
`)}function c(C,P,F,ot){const tt=jr(C,P,F);if(y(tt)&&y(ot)){const it=Zn(ot);for(let W=0;W<it.length;++W){const D=it[W];tt[D]=ot[D]}}}function l(C){let P="";for(let F=0;F<C.length;++F){const ot=C.charCodeAt(F);ot<32||ot>127?P+=`$${ot}`:P+=C[F]}return P}function u(C){return C.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(P=>{if(P.includes("$")){const[F,...ot]=P.split("$");return`${F??""}"$CENTER ${l(ot.join("$"))}"`}return l(P)}).join(`
`)}function f(C,P,F,ot,tt){const it=ot.color%16,W=Math.floor(ot.color/16)%8,D=Sh(it,W),yt=Sh(W,it),X={},at=tt.find(Pt=>Pt.x===P&&Pt.y===F);switch(y(at)&&(wt(at.cycle)&&at.cycle>0&&(X.cycle=at.cycle),y(at.p1)&&(X.p1=at.p1),y(at.p2)&&(X.p2=at.p2),y(at.p3)&&(X.p3=at.p3),y(at.code)&&at.code&&(X.code=u(at.code)),y(at.stepx)&&(X.stepx=at.stepx),y(at.stepy)&&(X.stepy=at.stepy)),ot.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(C,["ammo",D],{x:P,y:F},X);break;case 6:c(C,["torch",D],{x:P,y:F},X);break;case 7:c(C,["gem",D],{x:P,y:F},X);break;case 8:c(C,["key",D],{x:P,y:F},X);break;case 9:c(C,["door",yt],{x:P,y:F},X);break;case 10:c(C,["scroll",D],{x:P,y:F},X);break;case 11:{X.p3=d(at==null?void 0:at.p3)??"",c(C,["passage",D],{x:P,y:F},X);break}case 12:c(C,["duplicator",D],{x:P,y:F},X);break;case 13:c(C,["bomb",D],{x:P,y:F},X);break;case 14:c(C,["energize",D],{x:P,y:F},X);break;case 15:c(C,["star",D],{x:P,y:F},X);break;case 16:c(C,["clockwise",D],{x:P,y:F},X);break;case 17:c(C,["counter",D],{x:P,y:F},X);break;case 18:c(C,["bullet",D],{x:P,y:F},X);break;case 19:c(C,["water",D],{x:P,y:F},X);break;case 20:c(C,["forest",D],{x:P,y:F},X);break;case 21:c(C,["solid",D],{x:P,y:F},X);break;case 22:c(C,["normal",D],{x:P,y:F},X);break;case 23:c(C,["breakable",D],{x:P,y:F},X);break;case 24:c(C,["boulder",D],{x:P,y:F},X);break;case 25:c(C,["sliderns",D],{x:P,y:F},X);break;case 26:c(C,["sliderew",D],{x:P,y:F},X);break;case 27:c(C,["fake",D],{x:P,y:F},X);break;case 28:c(C,["invisible",D],{x:P,y:F},X);break;case 29:c(C,["blinkwall",D],{x:P,y:F},X);break;case 30:c(C,["transporter",D],{x:P,y:F},X);break;case 31:c(C,["line",D],{x:P,y:F},X);break;case 32:c(C,["ricochet",D],{x:P,y:F},X);break;case 33:c(C,["blinkns",D],{x:P,y:F},X);break;case 34:c(C,["bear",D],{x:P,y:F},X);break;case 35:c(C,["ruffian",D],{x:P,y:F},X);break;case 36:c(C,["object",D],{x:P,y:F},{...X,char:(at==null?void 0:at.p1)??1});break;case 37:c(C,["slime",D],{x:P,y:F},X);break;case 38:c(C,["shark",D],{x:P,y:F},X);break;case 39:c(C,["spinninggun",D],{x:P,y:F},X);break;case 40:c(C,["pusher",D],{x:P,y:F},X);break;case 41:c(C,["lion",D],{x:P,y:F},X);break;case 42:c(C,["tiger",D],{x:P,y:F},X);break;case 43:c(C,["blinkns",D],{x:P,y:F},X);break;case 44:c(C,["head",D],{x:P,y:F},X);break;case 45:c(C,["segment",D],{x:P,y:F},X);break;case 46:break;case 47:c(C,["text",["WHITE","ONDKBLUE"]],{x:P,y:F},{...X,char:ot.color});break;case 48:c(C,["text",["WHITE","ONDKGREEN"]],{x:P,y:F},{...X,char:ot.color});break;case 49:c(C,["text",["WHITE","ONDKCYAN"]],{x:P,y:F},{...X,char:ot.color});break;case 50:c(C,["text",["WHITE","ONDKRED"]],{x:P,y:F},{...X,char:ot.color});break;case 51:c(C,["text",["WHITE","ONDKPURPLE"]],{x:P,y:F},{...X,char:ot.color});break;case 52:c(C,["text",["WHITE","ONDKYELLOW"]],{x:P,y:F},{...X,char:ot.color});break;case 53:c(C,["text",["WHITE","ONBLACK"]],{x:P,y:F},{...X,char:ot.color});break}}function d(C){if(wt(C)&&C>0)return`zztboard${C}`}if(s()!=-1)return;const m=s(),p=s(),k=s(),b=a(7),v=s(),T=s(),A=s(),L=s(),S=s();s();const I=s(),$=i(),N=a(20).slice(0,$);for(let C=0;C<9;C++){const P=i();a(20).slice(0,P)}const z=s(),J=s(),M=i();console.info(p,k,b,v,T,A,L,S,I,z,J,M),n=512;const O=[];for(let C=0;C<m;++C){const P=s(),F=n,ot=i(),it={boardname:a(50).slice(0,ot),elements:[],stats:[]};for(;it.elements.length<f$;){let D=i();D===0&&(D=255);const yt=i(),X=i();for(let at=0;at<D;++at)it.elements.push({element:yt,color:X})}it.maxplayershots=i(),it.isdark=i(),it.exitnorth=i(),it.exitsouth=i(),it.exitwest=i(),it.exiteast=i(),it.restartonzap=i(),it.messagelength=i(),it.message=a(58).slice(0,it.messagelength),it.playerenterx=i(),it.playerentery=i(),it.timelimit=s(),n+=16;const W=s()+1;for(;it.stats.length<W;){const D={};D.x=i()-1,D.y=i()-1,D.stepx=s(),D.stepy=s(),D.cycle=s(),D.p1=i(),D.p2=i(),D.p3=i(),D.follower=s(),D.leader=s(),D.underelement=i(),D.undercolor=i(),D.pointer=o(),D.currentinstruction=s();const yt=s();n+=8,yt<0?D.bind=Math.abs(yt):D.code=a(yt),it.stats.push(D)}O.push(it),n=F+P}const w=Zf([]);w.name=N;for(let C=0;C<O.length;++C){const P=O[C],F=[`@zztboard${C}`,""];C===T&&F.push("@title");for(let Kt=0;Kt<P.elements.length;++Kt)P.elements[Kt].element===4&&(F.push(`@startx ${im(Kt,su)}`),F.push(`@starty ${sm(Kt,su)}`));wt(P.maxplayershots)&&F.push(`@maxplayershots ${P.maxplayershots}`),wt(P.isdark)&&F.push(`@isdark ${P.isdark}`),wt(P.restartonzap)&&F.push(`@restartonzap ${P.restartonzap}`),wt(P.timelimit)&&F.push(`@timelimit ${P.timelimit}`);const ot=d(P.exitnorth);gt(ot)&&F.push(`@exitnorth ${ot}`);const tt=d(P.exitsouth);gt(tt)&&F.push(`@exitsouth ${tt}`);const it=d(P.exitwest);gt(it)&&F.push(`@exitwest ${it}`);const W=d(P.exiteast);gt(W)&&F.push(`@exiteast ${W}`);const D=`@board ${String(C).padStart(3,"0")}. ${P.boardname}
${F.join(`
`)}`,yt=hk(D,{});ed(w,yt);const X=Se(yt);if(!y(X))continue;let at=0,Pt=0;for(let Kt=0;Kt<P.elements.length;++Kt){const jt=P.elements[Kt];f(X,at,Pt,jt,P.stats),++at,at===su&&(at=0,++Pt)}Re(X)}Xl(w),n0(nt,e,`imported zzt file into ${w.name} book`)}function GE(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return l$.getType(e)??"application/octet-stream"}async function p$(e,t,n){try{xe(nt,e,"parsezipfile",t.name);const r=await t.arrayBuffer();(await new Fd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=GE(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{de(nt,e,"crash",c.message)})})}catch(r){de(nt,e,"crash",r.message)}}function KE(e,t,n){if(y(n))switch(t){case"text/plain":n.text().then(r=>Eu(nt,e,void 0,"text",`file:${n.name}`,r)).catch(r=>de(nt,e,"crash",r.message));break;case"application/json":n.text().then(r=>Eu(nt,e,void 0,"json",`file:${n.name}`,r)).catch(r=>de(nt,e,"crash",r.message));break;case"application/zip":p$(e,n,r=>HE(e,r)).catch(r=>de(nt,e,"crash",r.message));break;case"application/octet-stream":/.zzt$/i.test(n.name)&&n.arrayBuffer().then(r=>{d$(e,new Uint8Array(r))}).catch(r=>de(nt,e,"crash",r.message)),/.zzl$/i.test(n.name)&&n.text().then(r=>{u$(e,r)}).catch(r=>de(nt,e,"crash",r.message)),/.zzm$/i.test(n.name)&&n.text().then(r=>{h$(e,r)}).catch(r=>de(nt,e,"crash",r.message));break;default:n.arrayBuffer().then(r=>{const i=GE(n.name,new Uint8Array(r));if(i)KE(e,i,n);else return de(nt,e,"parsewebfile",`unsupported file ${n.name}`)}).catch(r=>de(nt,e,"crash",r.message));return}}function HE(e,t){KE(e,(t==null?void 0:t.type)??"",t)}function hi(e,t,n){n().catch(r=>{console.error(r),de(e,t,"crash",r==null?void 0:r.message)})}function m$(e){const[t,n]=e.split(":"),r=y(n);return[r?t:"self",r?n:e]}function g$(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function _$(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const y$=new Date("1980/09/02");async function Bd(e){return console.info("saved",e),new Promise((t,n)=>{const r=new Fd;for(let i=0;i<e.length;++i){const s=e[i],o=hU(s);if(o){const a=RS(o);y(a)&&r.file(s.id,a,{date:y$})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(_$(i))}).catch(n)})}async function b$(e){return new Promise((t,n)=>{const r=new Fd;r.loadAsync(g$(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=fU(OS(c));y(l)&&i.push(l)}t(i)}).catch(n)})}function k$(e,t,n,r){const i=fn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){wt(u)&&(s=u,om(t.x,t.y,n.x,n.y).forEach(f=>{const d=ie(i,f);y(d)&&(d[l]=u)}))}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,`batch:${ro(t,n)}`,"char",[r,"charedit"],o,a);const c=Ye(e);c.scrollname="bulk set char",c.scroll=An(e)}function E$(e,t,n,r){const i=fn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){if(wt(u)){s=u;for(let f=t.y;f<=n.y;++f)for(let d=t.x;d<=n.x;++d){const h=ie(i,{x:d,y:f});y(h)&&(h[l]=u)}}}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,`batch:${ro(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scrollname="bulk set color",c.scroll=An(e)}function w$(e,t,n,r){const i=fn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){wt(u)&&(s=u,om(t.x,t.y,n.x,n.y).forEach(f=>{const d=ie(i,f);y(d)&&(d[l]=u)}))}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,`batch:${ro(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scrollname="bulk set bg",c.scroll=An(e)}function x$(e,t,n,r){const i=un(Dt.MAIN);if(!y(i))return;const s=fn(e);if(!y(s))return;const o=ro(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Lt(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),r&&Lt(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Lt(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),Lt(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Rt(e,Ke),Lt(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Lt(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Lt(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Rt(e,Ke),Lt(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Rt(e,Ke),Rt(e,"codepages:"),Lt(e,"batch","edit @board codepage",[`pageopen:${s.id}`]);const a=Math.min(t.x,n.x),c=Math.min(t.y,n.y),l=Math.max(t.x,n.x),u=Math.max(t.y,n.y),f=new Set;for(let d=c;d<=u;++d)for(let h=a;h<=l;++h){const m=ie(s,{x:h,y:d}),p=mk(i,m);y(p)&&!f.has(p.id)&&(f.add(p.id),Lt(e,"batch",`edit @${Ue(p)}`,[`pageopen:${p.id}`]))}Lt(e,"batch",`board id ${s.id}`,["","copyit",s.id])}function Pd(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function v$(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Pd(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let $d;function YE(){return $d||($d=v$("keyval-store","keyval")),$d}function VE(e,t=YE()){return t("readonly",n=>Pd(n.get(e)))}function XE(e,t,n=YE()){return n("readwrite",r=>new Promise((i,s)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),i(Pd(r.transaction))}catch(o){s(o)}}}))}function Dd(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function qE(){return VE("secretheap")}async function JE(e){return XE("secretheap",e)}async function T$(){return!!await qE()}function ZE(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},m=ie(e,{x:d,y:f});(m==null?void 0:m.category)===Pn.ISOBJECT?(l.push(Tr(es(e,d,f))),nn(m).name!=="player"&&u.push({...Tr(m),...h,id:"blank"})):l.push({...Tr(m),...h})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function A$(e,t,n,r){const i=fn(e);if(!y(i))return;const s=ZE(i,t,n);switch(r){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await JE(()=>s)}function S$(e,t,n){const r=Dd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Lt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Lt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=Ye(e);i.scrollname="copy",i.scroll=An(e)}async function R$(e,t,n,r){const i=un(Dt.MAIN);if(!y(i))return;const s=fn(e);if(!y(s))return;const o=ZE(s,t,n);switch(r){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(r){case"cutall":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ie(s,{x:c,y:a});(l==null?void 0:l.category)===Pn.ISOBJECT&&Tn(s,l,i.timestamp),Oe(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ie(s,{x:c,y:a});(l==null?void 0:l.category)===Pn.ISOBJECT&&Tn(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c)Oe(s,{x:c,y:a});break}}await JE(()=>o)}function O$(e,t,n){const r=Dd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Lt(e,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Lt(e,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=Ye(e);i.scrollname="cut",i.scroll=An(e)}async function N$(e,t,n,r){const i=fn(e),s=await qE();if(!y(i)||!y(s))return;const o=Math.min(t.x,n.x),a=Math.min(t.y,n.y),c=Math.max(t.x,n.x),l=Math.max(t.y,n.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(r){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<d;++p){const k=dr({x:p,y:m},s.width);Oe(i,{...s.terrain[k],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];y(p.x)&&y(p.y)&&yh(p.x,p.y,0,u-1,f-1,0)&&Cd(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];y(p.x)&&y(p.y)&&yh(p.x,p.y,0,u-1,f-1,0)&&Cd(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<d;++p){const k=dr({x:p,y:m},s.width);Oe(i,{...s.terrain[k],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const k=(p-o)%s.width,b=(m-a)%s.height,v=dr({x:k,y:b},s.width);Oe(i,{...s.terrain[v],x:p,y:m})}break}}function I$(e,t,n){const r=Dd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Lt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Lt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Lt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=Ye(e);i.scrollname="paste",i.scroll=An(e)}function jd(e,t){return`inspect:${t!=null&&t.id?t.id:zr(e,t)}`}function C$(e,t,n){const r=un(Dt.MAIN);if(!y(r))return;const i=fn(e);if(!y(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){y(t)&&(t[d]=h)}const a=t.category===Pn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=jd(i,t);Rt(e,`${a}: ${c} ${l}`),Rt(e,Ke),Lt(e,u,"color",[n,"coloredit"],s,o);const f=Ye(e);f.scrollname="color",f.scroll=An(e)}function L$(e,t,n){const r=un(Dt.MAIN);if(!y(r))return;const i=fn(e);if(!y(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){y(t)&&(t[d]=h)}const a=t.category===Pn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=jd(i,t);Rt(e,`${a}: ${c} ${l}`),Rt(e,Ke),Lt(e,u,"char",[n,"charedit"],s,o);const f=Ye(e);f.scrollname="char",f.scroll=An(e)}function M$(e,t,n,r,i,s){var h,m,p;const o=un(Dt.MAIN);if(!y(o))return;function a(k){var v;const b=(r==null?void 0:r[k])??((v=r==null?void 0:r.kinddata)==null?void 0:v[k]);if(!y(b))switch(k){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Gt.ISWALK;case"pushable":return 0;case"breakable":return 0}return b}function c(k,b){y(r)&&(r[k]=b)}s?Rt(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):Rt(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`);const l=jd(t,r);switch(s&&Rt(e,`cycle: ${zt(r,"cycle")}`),zt(r,"collision")){case Gt.ISWALK:Rt(e,"collision: iswalk");break;case Gt.ISSWIM:Rt(e,"collision: isswim");break;case Gt.ISSOLID:Rt(e,"collision: issolid");break;case Gt.ISBULLET:Rt(e,"collision: isbullet");break}s&&Rt(e,`ispushable: ${zt(r,"pushable")?"yes":"no"}`),Rt(e,`isbreakable: ${zt(r,"breakable")?"yes":"no"}`),Rt(e,Ke);const f=Aa(n),d=Zn(f);for(let k=0;k<d.length;++k){const b=d[k];switch(b){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ue(f[b])){const[v,T,...A]=f[b];gt(T)&&Lt(e,l,T||b,[b,v,...A],a,c)}break}}Lt(e,l,"copy coords",["copycoords","hk","5"," 5 "]),Rt(e,Ke),Lt(e,l,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],a,c),Lt(e,l,`color: ${r.color??((m=r.kinddata)==null?void 0:m.color)??15}`,["color","hk","c"," C ","next"],a,c),Lt(e,l,`bg: ${r.bg??((p=r.kinddata)==null?void 0:p.bg)??0}`,["bg","hk","b"," B ","next"],a,c),Rt(e,Ke),Lt(e,l,"make empty",["empty","hk","0"],a,c),Rt(e,Ke),Lt(e,"batch","edit @board codepage",[`pageopen:${t.id}`]),Lt(e,"batch",`edit @${Ue(n)}`,[`pageopen:${n.id}`]),Lt(e,"batch",`board id ${t.id}`,["","copyit",t.id])}function U$(e,t,n,r){const i=un(Dt.MAIN);if(!y(i))return;const s=fn(e);if(y(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ie(s,{x:a,y:o});(c==null?void 0:c.category)===Pn.ISOBJECT&&Tn(s,c,i.timestamp),Oe(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ie(s,{x:a,y:o});(c==null?void 0:c.category)===Pn.ISOBJECT&&Tn(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Oe(s,{x:a,y:o});break}}}function F$(e,t,n){const r=un(Dt.MAIN);if(!y(r))return;const i=fn(e);if(!y(i))return;const s=ro(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Lt(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Lt(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Ye(e);o.scrollname="empty",o.scroll=An(e)}async function B$(e,t,n){const r=un(Dt.MAIN),i=await T$();if(!y(r))return;const s=fn(e);if(!y(s))return;if(Re(s),t.x===n.x&&t.y===n.y){const a=ie(s,t),c=mk(r,a);y(a)&&y(c)&&M$(e,s,c,a,t,Ge(a)),a!=null&&a.kind||(Rt(e,`empty: ${t.x}, ${t.y}`),Rt(e,Ke),Lt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]),Lt(e,"batch","edit @board codepage",[`pageopen:${s.id}`]),Lt(e,"batch",`board id ${s.id}`,["","copyit",s.id]))}else x$(e,t,n,i);const o=Ye(e);o.scrollname="inspect",o.scroll=An(e)}function P$(e,t){const n=ce(Dt.MAIN);if(!y(n))return;const r=fn(t);if(!y(r))return;const i=$n(e),s=qP(r,i.target);if(y(s))switch(i.path){case"copycoords":bu(nt,cr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":C$(t,s,i.path);break;case"char":L$(t,s,i.path);break;case"empty":Tn(r,s,n.timestamp);break;case"code":hi(nt,t,async()=>{const o=nn(s),a="object";xe(nt,t,`opened [${a}] ${o.name}`);const c=[r.id,s.id];_h(Ha(n.id,c),s.code??""),ex(nt,t),await u0(800),a0(nt,t,n.id,c,a,`${name} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}async function $$(e,t){const n=fn(t);if(!y(n))return;const r=$n(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":S$(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await A$(t,c,l,r.target);break;case"cut":O$(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await R$(t,c,l,r.target);break;case"paste":I$(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await N$(t,c,l,r.target);break;case"empty":F$(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":U$(t,c,l,r.target);break;case"chars":k$(t,c,l,"char");break;case"colors":E$(t,c,l,"color");break;case"bgs":w$(t,c,l,"bg");break;case"copycoords":bu(nt,t,[i,s,o,a].join(" "));break;case"pageopen":hi(nt,t,async()=>{await u0(800),Ex(nt,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}async function D$(){return VE("remixconfig")}async function j$(e){return XE("remixconfig",e)}let ns={stat:"",patternsize:2,mirror:1};async function z$(e,t){const n=fn(t);if(!y(n))return;const r=$n(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"remix":{await W$(t,c,l);break}case"remixrun":{const u=hn(ns.stat);y(u)&&Vk(n.id,u.id,ns.patternsize,ns.mirror,c,l,"all"),await j$(()=>ns);break}default:console.info("unknown remix",r);break}}async function W$(e,t,n){const r=await D$();ns={...ns,...r};const i=ro(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke);function s(c){const{target:l}=$n(c);return ns[l]}function o(c,l){if(wt(l)||gt(l)){const{target:u}=$n(c);ns[u]=l}}Lt(e,"remix","source board",[`stat:${i}`,"text"],s,o),Lt(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),Lt(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Rt(e,Ke),Lt(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Ye(e);a.scrollname="remix",a.scroll=An(e)}const G$=16,rs={},ou={},K$=60;let QE=0;const Io={},Co={};async function tw(e){const t=Pr(),n=ce(Dt.MAIN);if(t.length&&y(n)){const r=await Bd(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;rx(Qt,cr(),i,r)}}async function H$(){const e=Pr(),t=ce(Dt.MAIN);if(e.length&&y(t)){const n=await Bd(e);ix(Qt,cr(),n)}}async function Y$(){const e=Pr(),t=ce(Dt.MAIN);return e.length&&y(t)?Bd(e):""}const Qt=Bs("vm",["tick","second"],e=>{var n;if(!Qt.session(e))return;const t=cr();switch(e.target){case"operator":TP(e.player),xe(Qt,e.player,`operator set to ${e.player}`),Qt.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=ce(Dt.MAIN);Qt.replynext(e,"ackzsswords",{cli:yd(Ji.CLI),loader:yd(Ji.LOADER),runtime:yd(Ji.RUNTIME),flags:[...Zn(xr(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...Ss(r,bt.OBJECT).map(i=>Ue(i)),...Zn(gd)],altkinds:[...Ss(r,bt.TERRAIN),...Ss(r,bt.BOARD),...Ss(r,bt.PALETTE),...Ss(r,bt.CHARSET),...Ss(r,bt.LOADER)].map(i=>Ue(i)),colors:[...Zn(qo)],dirs:[...Zn(vh).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Zn(pd)],exprs:["aligned","alligned","contact","blocked","any","count","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&hi(Qt,e.player,async()=>{if(ue(e.data)){const[r,i]=e.data,s=await b$(r),o=s.map(a=>a.name);CP(s,i),xe(Qt,e.player,`loading ${o.join(", ")}`),yu(Qt,e.player)}});break;case"search":UP(e.player)||yu(Qt,e.player);break;case"logout":MP(e.player),delete rs[e.player],xe(Qt,t,`player ${e.player} logout`),yu(Qt,e.player);break;case"login":AE(e.player)?(rs[e.player]=0,xe(Qt,cr(),`login from ${e.player}`),Qt.replynext(e,"acklogin",!0)):r0(Qt,e.player);break;case"local":AE(e.player)?(rs[e.player]=0,xe(Qt,cr(),`login from ${e.player}`)):r0(Qt,e.player);break;case"doot":rs[e.player]=0,ou[e.player]=ou[e.player]??0,ou[e.player]%32===0&&xe(Qt,e.player,`$whiteactive $blue${e.player}`),++ou[e.player];break;case"input":{if(e.player.includes("local")&&!vE(e.player)&&kx(Qt,e.player),!e.player.includes("local")||vE(e.player)){const r=xr(e.player),[i=Rn.NONE,s=0]=e.data??[Rn.NONE,0];ue(r.inputqueue)||(r.inputqueue=[]),i!==Rn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ue(e.data)){const[r,i]=e.data,s=Ha(r,i);y(Co[s])||(Co[s]=nm(s,o=>{const[a,c]=i,l=$r(r),u=As(l,a);if(y(u))if(ci(u)===bt.BOARD&&y(c)){const f=Se(u),d=Un(f,c);y(d)&&(d.code=o,Nl(qf(o),d))}else u.code=o,lU(u)})),Io[s]=Io[s]??new Set,Io[s].add(e.player)}break;case"coderelease":if(ue(e.data)){const[r,i]=e.data,[,s]=i,o=Ha(r,i);y(Io[o])&&(Io[o].delete(e.player),Io[o].size===0&&((n=Co[o])==null||n.call(Co),Co[o]=void 0,gt(s)&&$P(s)))}break;case"halt":e.player===t&&Pw(e.data)&&AP(e.data);break;case"tick":jP(SP());break;case"synthsend":if(gt(e.data)){const[r,i]=m$(e.data),s=ce(Dt.MAIN);Ro(r,i,void 0,bo(s))}break;case"second":{FP(rs);const r=Object.keys(rs);for(let i=0;i<r.length;++i)++rs[r[i]];for(let i=0;i<r.length;++i){const s=r[i];rs[s]>=G$&&c0(Qt,s)}++QE>=K$&&(QE=0,hi(Qt,e.player,async()=>{await tw(!0)}));break}case"copyjsonfile":if(e.player===t){const r=ce(Dt.MAIN);if(y(r)&&ue(e.data)){const[i]=e.data,s=As(r,i);y(s)&&ox(Qt,t,s,`${Ue(s)}.${Oi(s)}.json`)}}break;case"refscroll":{Rt(e.player,"stat refs"),Rt(e.player,Ke),Lt(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Lt(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Lt(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=Ye(e.player);r.scrollname="refscroll",r.scroll=An(e.player);break}case"fork":e.player===t&&hi(Qt,e.player,async()=>{await H$()});break;case"itchiopublish":hi(Qt,e.player,async()=>{if(e.player===t){const r=ce(Dt.MAIN);if(y(r)){const i=await Y$();sx(Qt,e.player,r.name,i)}}});break;case"flush":e.player===t&&hi(Qt,e.player,async()=>{await tw()});break;case"cli":OE(e.player,e.data);break;case"clirepeatlast":zP(e.player);break;case"restart":e.player===t&&(DP(),l0(Qt,e.player));break;case"inspect":hi(Qt,e.player,async()=>{if(ue(e.data)){const[r,i]=e.data;await B$(e.player,r,i)}});break;case"loader":if(ue(e.data)){const[r,i,s,o]=e.data;switch(i){case"file":HE(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){xe(Qt,e.player,`loading ${s}`);const a=JSON.parse(o.json);y(a.data)&&gt(a.exported)&&(Xl(a.data),xe(Qt,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){xe(Qt,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ce(Dt.MAIN);y(c)&&y(a.data)&&gt(a.exported)&&(ed(c,a.data),xe(Qt,e.player,`loaded ${a.exported}`))}else Pk(r,i,s,o,e.player);break;default:Pk(r,i,s,o,e.player);break}}break;default:{const{target:r,path:i}=$n(e.target);switch(Ct(r)){case"refscroll":switch(i){case"charscroll":{Lt(e.player,"refscroll","char",["char","charedit"]);const s=Ye(e.player);s.scrollname="chars",s.scroll=An(e.player);break}case"colorscroll":{Lt(e.player,"refscroll","color",["color","coloredit"]);const s=Ye(e.player);s.scrollname="colors",s.scroll=An(e.player);break}case"notesscroll":{Rt(e.player,"duration             cdefgab - notes "),Rt(e.player,"y - 64th note        x - rest"),Rt(e.player,"t - 32nd note        "),Rt(e.player,"s - 16th note.       drums"),Rt(e.player,"i - eight note.      0 - tick"),Rt(e.player,"q - quarter note     1 - tweet"),Rt(e.player,"h - half note        2 - cowbell"),Rt(e.player,"w - whole note       p - clap"),Rt(e.player,"                     4 - high snare"),Rt(e.player,"mods                 5 - high woodblock"),Rt(e.player,"3 - triplet          6 - low snare"),Rt(e.player,". - time and a half  7 - low tom"),Rt(e.player,"# - sharp            8 - low woodblock"),Rt(e.player,"! - flat             9 - bass drum");const s=Ye(e.player);s.scrollname="music notation",s.scroll=An(e.player);break}}break;case"batch":hi(Qt,e.player,async()=>{await $$(i,e.player)});break;case"remix":hi(Qt,e.player,async()=>{await z$(i,e.player)});break;case"empty":{const s=$n(i);switch(s.target){case"copycoords":bu(Qt,cr(),s.path.split(",").join(" "));break}break}case"inspect":P$(i,e.player);break;case"touched":if(ue(e.data)){const[s,o,a]=e.data;SE({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:{const s=$n(i);if(Ct(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),SE(e);else{const o=ce(Dt.MAIN);Ro(s.target,s.path,void 0,bo(o))}break}}break}}},vP());function V$(){nx(Qt)}const{forward:X$}=Rx(e=>{Ox(e)&&postMessage(e)});onmessage=function(t){X$(t.data)},setTimeout(V$,100)})();

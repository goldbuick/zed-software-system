var jP=Object.defineProperty;var zP=(hi,Vn,Nn)=>Vn in hi?jP(hi,Vn,{enumerable:!0,configurable:!0,writable:!0,value:Nn}):hi[Vn]=Nn;var Ut=(hi,Vn,Nn)=>zP(hi,typeof Vn!="symbol"?Vn+"":Vn,Nn);(function(){"use strict";const hi=new Set,Vn={emit(e,t,n,r,i){Vn.invoke(Iw(e,t,n,r,i))},invoke(e){hi.forEach(t=>t.handle(e))},connect(e){hi.add(e)},disconnect(e){hi.delete(e)}};var Nn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Us(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function V1(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Md={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Nn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Md);var X1=Md.exports,Ud=Us(X1),Fd={};(function(e){var t=Nn&&Nn.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,m;d<h;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,b=l.addAdverb,y=b===void 0?!1:b,v=t(t(t([],t([],Array(p),!0).map(function(T){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),y?[n(e.adverbs)]:[],!0);return h&&(v=v.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),v.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return r(e.adjectives).length*f+f*p.length+r(e.nouns).length+p.length+r(e.verbs).length+(h?r(e.adverbs).length+p.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(e.adjectives).length*f+f*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(h?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(Fd);var Pd=Us(Fd);const q1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let J1=e=>crypto.getRandomValues(new Uint8Array(e)),Z1=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Bd=(e,t=21)=>Z1(e,t,J1),Q1=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=q1[n[e]&63];return t};var $d="abcdefghijklmnopqrstuvwxyz",Dd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",jd="0123456789",tw="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",ew="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const nw=jd,rw=$d,iw=Dd;var sw=nw+rw+iw,nu={lowercase:$d,uppercase:Dd,numbers:jd,nolookalikes:tw,nolookalikesSafe:ew,alphanumeric:sw};function Be(){return`sid_${Q1(12).replaceAll("-",".")}`}Bd(nu.numbers,4),Bd(`${nu.numbers}${nu.lowercase}`,16);function mn(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function ow(){return Pd({capitalize:!1,adjectiveCount:1})}function aw(){return Pd({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var cw=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),lw=Object.prototype.hasOwnProperty;function ru(e,t){return lw.call(e,t)}function iu(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)ru(e,i)&&r.push(i);return r}function Cn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function su(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function is(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function zd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ou(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(ou(e[t]))return!0}else if(typeof e=="object"){for(var r=iu(e),i=r.length,s=0;s<i;s++)if(ou(e[r[s]]))return!0}}return!1}function Wd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Gd=function(e){cw(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Wd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Wd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Me=Gd,uw=Cn,Fs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=za(n,this.path);r&&(r=Cn(r));var i=ss(n,{op:"remove",path:this.from}).removed;return ss(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=za(n,this.from);return ss(n,{op:"add",path:this.path,value:Cn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Mo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},hw={add:function(e,t,n){return su(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Fs.move,copy:Fs.copy,test:Fs.test,_get:Fs._get};function za(e,t){if(t=="")return e;var n={op:"_get",path:t};return ss(e,n),n.value}function ss(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Wa(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=za(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Mo(e,t.value),o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Cn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,m=void 0;for(typeof n=="function"?m=n:m=Wa;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=zd(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!su(h))throw new Me("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);su(h)&&(h=~~h)}if(u>=f){if(n&&t.op==="add"&&h>l.length)throw new Me("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=hw[t.op].call(t,l,h,e);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Fs[t.op].call(t,l,h,e);if(o.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Me("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function au(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Cn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=ss(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function fw(e,t,n){var r=ss(e,t);if(r.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Wa(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Me("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Fs[e.op]){if(typeof e.path!="string")throw new Me("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Me('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Me("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&ou(e.value))throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Me("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Me("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Kd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Me("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Kd(e,t,n){try{if(!Array.isArray(e))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)au(Cn(t),Cn(e),n||!0);else{n=n||Wa;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Me)return i;throw i}}function Mo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Mo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Mo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var dw=Object.freeze({__proto__:null,JsonPatchError:Me,_areEquals:Mo,applyOperation:ss,applyPatch:au,applyReducer:fw,deepClone:uw,getValueByPointer:za,validate:Kd,validator:Wa});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var cu=new WeakMap,pw=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),mw=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function gw(e){return cu.get(e)}function _w(e,t){return e.observers.get(t)}function yw(e,t){e.observers.delete(t.callback)}function bw(e,t){t.unobserve()}function ww(e,t){var n=[],r,i=gw(e);if(!i)i=new pw(e),cu.set(e,i);else{var s=_w(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Cn(e),t){r.callback=t,r.next=null;var o=function(){lu(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){lu(r),clearTimeout(r.next),yw(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new mw(t,r)),r}function lu(e,t){t===void 0&&(t=!1);var n=cu.get(e.object);uu(n.value,e.object,e.patches,"",t),e.patches.length&&au(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function uu(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=iu(t),o=iu(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(ru(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?uu(u,f,n,r+"/"+is(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+is(l),value:Cn(u)}),n.push({op:"replace",path:r+"/"+is(l),value:Cn(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+is(l),value:Cn(u)}),n.push({op:"remove",path:r+"/"+is(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!ru(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+is(l),value:Cn(t[l])})}}}function Hd(e,t,n){n===void 0&&(n=!1);var r=[];return uu(e,t,r,"",n),r}var xw=Object.freeze({__proto__:null,compare:Hd,generate:lu,observe:ww,unobserve:bw});Object.assign({},dw,xw,{JsonPatchError:Gd,deepClone:Cn,escapePathComponent:is,unescapePathComponent:zd});var Ew=typeof Element<"u",kw=typeof Map=="function",vw=typeof Set=="function",Tw=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ga(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ga(e[r],t[r]))return!1;return!0}var s;if(kw&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ga(r.value[1],t.get(r.value[0])))return!1;return!0}if(vw&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(Tw&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(Ew&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ga(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var Aw=function(t,n){try{return Ga(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Rw=Us(Aw);function w(e){return e!=null}const Xn=Object.keys;function wr(e){return Cn(e)}function Sw(e){return typeof e=="boolean"}function xt(e){return typeof e=="number"&&isNaN(e)===!1}function _t(e){return typeof e=="string"}function ce(e){return Array.isArray(e)}function hu(e){return e}var Rt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Rt||{}),jt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(jt||{}),Ln=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Ln||{}),pt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e[e.MID=22]="MID",e[e.OVER=23]="OVER",e[e.UNDER=24]="UNDER",e))(pt||{}),vt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.ZSSEDIT=14]="ZSSEDIT",e[e.CHAREDIT=15]="CHAREDIT",e[e.COLOREDIT=16]="COLOREDIT",e))(vt||{});function It(e){return(e==null?void 0:e.toLowerCase().trim())??""}function Iw(e,t,n,r,i){return{session:e,player:t,id:Be(),sender:n,target:r,data:i}}function Mn(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Ps(e,t=[],n=hu,r=""){const i=Be(),s=It(e),o=t.map(It);let a=r;const c={id(){return i},name(){return e},session(l){return w(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,f){Vn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Mn(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&w(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Vn.connect(c),c}function Ow(e){return typeof e=="object"&&_t(e.session)&&_t(e.player)&&_t(e.id)&&_t(e.sender)&&_t(e.target)}function he(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function Nw(e,t,...n){return e.emit(t,"info",n),!0}function xe(e,t,...n){return e.emit(t,"log",n),!0}function Yd(e,t,n){e.emit(t,"toast",n)}function Cw(e,t,n){e.emit(t,"bridge:streamstart",n)}function Lw(e,t){e.emit(t,"bridge:streamstop",void 0)}function Mw(e,t,n){e.emit(t,"bridge:chatstart",n)}function Uw(e,t){e.emit(t,"bridge:chatstop")}function Fw(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function Pw(e,t){e.emit(t,"bridge:talkstart",t)}function Bw(e,t){e.emit(t,"bridge:talkstop",t)}function $w(e,t){e.emit(t,"bridge:mediastart",t)}function Dw(e,t){e.emit(t,"bridge:mediastop",t)}function jw(e,t,n){e.emit(t,"bridge:start",n)}function zw(e,t,n){e.emit(t,"bridge:tab",n)}function Ww(e,t,n){e.emit(t,"gadgetclient:paint",n)}function Gw(e,t,n){e.emit(t,"gadgetclient:patch",n)}function Kw(e,t){e.emit(t,"gadgetserver:clearscroll")}function Hw(e){e.emit("","ready")}function Vd(e,t){e.emit(t,"register:loginfail")}function fu(e,t){e.emit(t,"register:loginready",!0)}function Yw(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function Vw(e,t,n){e.emit(t,"register:forkmem",[n])}function Xw(e,t,n,r){e.emit(t,"register:itchiopublishmem",[n,r])}function du(e,t,n){e.emit(t,"register:copy",n)}function qw(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function Xd(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function Jw(e,t){e.emit(t,"register:dev",void 0)}function Zw(e,t){e.emit(t,"register:share",void 0)}function Qw(e,t){e.emit(t,"register:nuke",void 0)}function tx(e,t){e.emit(t,"register:enterar",void 0)}function ex(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function nx(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function rx(e,t,n){e.emit(t,"synth:focus",n)}function ix(e,t,n){e.emit(t,"synth:bpm",n)}function sx(e,t,n){e.emit(t,"synth:playvolume",n)}function ox(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function ax(e,t,n){e.emit(t,"synth:ttsvolume",n)}function pu(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function qd(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function Jd(e,t,n,r){e.emit(t,"register:config",[n,r])}function cx(e,t){e.emit(t,"register:configshow")}function lx(e,t){e.emit(t,"register:inspector")}function Zd(e,t,n,r,i,s){e.emit(t,"register:editor:open",[n,r,i,s])}function ux(e,t){e.emit(t,"vm:local")}function Qd(e,t){e.emit(t,"vm:logout")}function Ka(e,t){const[n,r]=t;return`${e}:${[n,r].filter(w).join(":")}`}function hx(e,t,n){e.emit(t,"vm:cli",n)}function fx(e,t){e.emit(t,"vm:restart")}function t0(e,t){e.emit(t,"vm:flush")}function dx(e,t){e.emit(t,"vm:fork")}function px(e,t){e.emit(t,"vm:itchiopublish")}function mx(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function gx(e,t){return{filename:e,json:t}}function _x(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function mu(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=mx(i,s);break;case"json":o=gx(i,s);break;case"binary":o=_x(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function yx(e){const t=new Set;function n(s){Ow(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Vn.invoke(s))}const r=Ps("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Vn.disconnect(r)}return{forward:n,disconnect:i}}function bx(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=Mn(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const gu=66.666,Ha=Math.round(1e3/gu),wx=3;function e0(e){return new Promise(t=>setTimeout(t,e))}const _u=Ps("clock");let yu=0,Ya=0,bu=0,n0=performance.now();function r0(){const e=performance.now(),t=e-n0;bu+=t,bu>=gu&&(bu%=gu,_u.emit("","tick",Ya),_u.emit("","tock",Ya),++yu,++Ya,yu>=Ha&&(yu%=Ha,_u.emit("","second",Ya))),n0=e,setTimeout(r0,2)}r0();function xx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i0={exports:{}},$e=i0.exports={},Dr,jr;function wu(){throw new Error("setTimeout has not been defined")}function xu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Dr=setTimeout:Dr=wu}catch{Dr=wu}try{typeof clearTimeout=="function"?jr=clearTimeout:jr=xu}catch{jr=xu}})();function s0(e){if(Dr===setTimeout)return setTimeout(e,0);if((Dr===wu||!Dr)&&setTimeout)return Dr=setTimeout,setTimeout(e,0);try{return Dr(e,0)}catch{try{return Dr.call(null,e,0)}catch{return Dr.call(this,e,0)}}}function Ex(e){if(jr===clearTimeout)return clearTimeout(e);if((jr===xu||!jr)&&clearTimeout)return jr=clearTimeout,clearTimeout(e);try{return jr(e)}catch{try{return jr.call(null,e)}catch{return jr.call(this,e)}}}var fi=[],Bs=!1,os,Va=-1;function kx(){!Bs||!os||(Bs=!1,os.length?fi=os.concat(fi):Va=-1,fi.length&&o0())}function o0(){if(!Bs){var e=s0(kx);Bs=!0;for(var t=fi.length;t;){for(os=fi,fi=[];++Va<t;)os&&os[Va].run();Va=-1,t=fi.length}os=null,Bs=!1,Ex(e)}}$e.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];fi.push(new a0(e,t)),fi.length===1&&!Bs&&s0(o0)};function a0(e,t){this.fun=e,this.array=t}a0.prototype.run=function(){this.fun.apply(null,this.array)},$e.title="browser",$e.browser=!0,$e.env={},$e.argv=[],$e.version="",$e.versions={};function di(){}$e.on=di,$e.addListener=di,$e.once=di,$e.off=di,$e.removeListener=di,$e.removeAllListeners=di,$e.emit=di,$e.prependListener=di,$e.prependOnceListener=di,$e.listeners=function(e){return[]},$e.binding=function(e){throw new Error("process.binding is not supported")},$e.cwd=function(){return"/"},$e.chdir=function(e){throw new Error("process.chdir is not supported")},$e.umask=function(){return 0};var vx=i0.exports;const xr=xx(vx);var Wt={},Eu=Symbol.for("react.transitional.element"),Tx=Symbol.for("react.portal"),Ax=Symbol.for("react.fragment"),Rx=Symbol.for("react.strict_mode"),Sx=Symbol.for("react.profiler"),Ix=Symbol.for("react.consumer"),Ox=Symbol.for("react.context"),Nx=Symbol.for("react.forward_ref"),Cx=Symbol.for("react.suspense"),Lx=Symbol.for("react.memo"),c0=Symbol.for("react.lazy"),l0=Symbol.iterator;function Mx(e){return e===null||typeof e!="object"?null:(e=l0&&e[l0]||e["@@iterator"],typeof e=="function"?e:null)}var u0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h0=Object.assign,f0={};function $s(e,t,n){this.props=e,this.context=t,this.refs=f0,this.updater=n||u0}$s.prototype.isReactComponent={},$s.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},$s.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function d0(){}d0.prototype=$s.prototype;function ku(e,t,n){this.props=e,this.context=t,this.refs=f0,this.updater=n||u0}var vu=ku.prototype=new d0;vu.constructor=ku,h0(vu,$s.prototype),vu.isPureReactComponent=!0;var p0=Array.isArray,Ee={H:null,A:null,T:null,S:null,V:null},m0=Object.prototype.hasOwnProperty;function Tu(e,t,n,r,i,s){return n=s.ref,{$$typeof:Eu,type:e,key:t,ref:n!==void 0?n:null,props:s}}function Ux(e,t){return Tu(e.type,t,void 0,void 0,void 0,e.props)}function Au(e){return typeof e=="object"&&e!==null&&e.$$typeof===Eu}function Fx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var g0=/\/+/g;function Ru(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Fx(""+e.key):t.toString(36)}function _0(){}function Px(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(_0,_0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function Ds(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Eu:case Tx:o=!0;break;case c0:return o=e._init,Ds(o(e._payload),t,n,r,i)}}if(o)return i=i(e),o=r===""?"."+Ru(e,0):r,p0(i)?(n="",o!=null&&(n=o.replace(g0,"$&/")+"/"),Ds(i,t,n,"",function(l){return l})):i!=null&&(Au(i)&&(i=Ux(i,n+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(g0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=r===""?".":r+":";if(p0(e))for(var c=0;c<e.length;c++)r=e[c],s=a+Ru(r,c),o+=Ds(r,t,n,s,i);else if(c=Mx(e),typeof c=="function")for(e=c.call(e),c=0;!(r=e.next()).done;)r=r.value,s=a+Ru(r,c++),o+=Ds(r,t,n,s,i);else if(s==="object"){if(typeof e.then=="function")return Ds(Px(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function Xa(e,t,n){if(e==null)return e;var r=[],i=0;return Ds(e,r,"","",function(s){return t.call(n,s,i++)}),r}function Bx(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var y0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof xr=="object"&&typeof xr.emit=="function"){xr.emit("uncaughtException",e);return}console.error(e)};function $x(){}Wt.Children={map:Xa,forEach:function(e,t,n){Xa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Xa(e,function(){t++}),t},toArray:function(e){return Xa(e,function(t){return t})||[]},only:function(e){if(!Au(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Wt.Component=$s,Wt.Fragment=Ax,Wt.Profiler=Sx,Wt.PureComponent=ku,Wt.StrictMode=Rx,Wt.Suspense=Cx,Wt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ee,Wt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return Ee.H.useMemoCache(e)}},Wt.cache=function(e){return function(){return e.apply(null,arguments)}},Wt.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=h0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!m0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(r[o]=t[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return Tu(e.type,i,void 0,void 0,s,r)},Wt.createContext=function(e){return e={$$typeof:Ox,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:Ix,_context:e},e},Wt.createElement=function(e,t,n){var r,i={},s=null;if(t!=null)for(r in t.key!==void 0&&(s=""+t.key),t)m0.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return Tu(e,s,void 0,void 0,null,i)},Wt.createRef=function(){return{current:null}},Wt.forwardRef=function(e){return{$$typeof:Nx,render:e}},Wt.isValidElement=Au,Wt.lazy=function(e){return{$$typeof:c0,_payload:{_status:-1,_result:e},_init:Bx}},Wt.memo=function(e,t){return{$$typeof:Lx,type:e,compare:t===void 0?null:t}},Wt.startTransition=function(e){var t=Ee.T,n={};Ee.T=n;try{var r=e(),i=Ee.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then($x,y0)}catch(s){y0(s)}finally{Ee.T=t}},Wt.unstable_useCacheRefresh=function(){return Ee.H.useCacheRefresh()},Wt.use=function(e){return Ee.H.use(e)},Wt.useActionState=function(e,t,n){return Ee.H.useActionState(e,t,n)},Wt.useCallback=function(e,t){return Ee.H.useCallback(e,t)},Wt.useContext=function(e){return Ee.H.useContext(e)},Wt.useDebugValue=function(){},Wt.useDeferredValue=function(e,t){return Ee.H.useDeferredValue(e,t)},Wt.useEffect=function(e,t,n){var r=Ee.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Wt.useId=function(){return Ee.H.useId()},Wt.useImperativeHandle=function(e,t,n){return Ee.H.useImperativeHandle(e,t,n)},Wt.useInsertionEffect=function(e,t){return Ee.H.useInsertionEffect(e,t)},Wt.useLayoutEffect=function(e,t){return Ee.H.useLayoutEffect(e,t)},Wt.useMemo=function(e,t){return Ee.H.useMemo(e,t)},Wt.useOptimistic=function(e,t){return Ee.H.useOptimistic(e,t)},Wt.useReducer=function(e,t,n){return Ee.H.useReducer(e,t,n)},Wt.useRef=function(e){return Ee.H.useRef(e)},Wt.useState=function(e){return Ee.H.useState(e)},Wt.useSyncExternalStore=function(e,t,n){return Ee.H.useSyncExternalStore(e,t,n)},Wt.useTransition=function(){return Ee.H.useTransition()},Wt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const b0="0123456789abcdef",w0=[],qa=[];for(let e=0;e<256;e++)w0[e]=b0[e>>4&15]+b0[e&15],e<16&&(e<10?qa[48+e]=e:qa[87+e]=e);const x0=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=w0[e[r++]];return n},Ja=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=qa[e.charCodeAt(s++)]<<4|qa[e.charCodeAt(s++)];return r};for(var E0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Dx=typeof Uint8Array>"u"?[]:new Uint8Array(256),Za=0;Za<E0.length;Za++)Dx[E0.charCodeAt(Za)]=Za;new TextDecoder,new TextEncoder;const k0=typeof window<"u"?window:self,v0=k0.crypto||k0.msCrypto||{};v0.subtle||v0.webkitSubtle;const js=globalThis||void 0||self,Er=()=>new Map,Su=e=>{const t=Er();return e.forEach((n,r)=>{t.set(r,n)}),t},Li=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},jx=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},zx=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},zs=()=>new Set,Iu=e=>e[e.length-1],Wx=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},as=Array.from,Gx=Array.isArray;class Kx{constructor(){this._observers=Er()}on(t,n){return Li(this._observers,t,zs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return as((this._observers.get(t)||Er()).values()).forEach(r=>r(...n))}destroy(){this._observers=Er()}}const Mi=Math.floor,Qa=Math.abs,T0=(e,t)=>e<t?e:t,cs=(e,t)=>e>t?e:t,A0=e=>e!==0?e<0:1/e<0,R0=1,S0=2,Ou=4,Nu=8,Uo=32,pi=64,qn=128,tc=31,Cu=63,ls=127,Hx=2147483647,I0=Number.MAX_SAFE_INTEGER,Yx=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Mi(e)===e),Vx=e=>e.toLowerCase(),Xx=/^\s*/g,qx=e=>e.replace(Xx,""),Jx=/([A-Z])/g,O0=(e,t)=>qx(e.replace(Jx,n=>`${t}${Vx(n)}`)),Zx=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Fo=typeof TextEncoder<"u"?new TextEncoder:null,Qx=Fo?e=>Fo.encode(e):Zx;let Po=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Po&&Po.decode(new Uint8Array).length===1&&(Po=null);class Bo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ec=()=>new Bo,tE=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},zr=e=>{const t=new Uint8Array(tE(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},eE=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(cs(n,t)*2),e.cpos=0)},en=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Lu=en,ie=(e,t)=>{for(;t>ls;)en(e,qn|ls&t),t=Mi(t/128);en(e,ls&t)},Mu=(e,t)=>{const n=A0(t);for(n&&(t=-t),en(e,(t>Cu?qn:0)|(n?pi:0)|Cu&t),t=Mi(t/64);t>0;)en(e,(t>ls?qn:0)|ls&t),t=Mi(t/128)},Uu=new Uint8Array(3e4),nE=Uu.length/3,rE=(e,t)=>{if(t.length<nE){const n=Fo.encodeInto(t,Uu).written||0;ie(e,n);for(let r=0;r<n;r++)en(e,Uu[r])}else Jn(e,Qx(t))},iE=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;ie(e,r);for(let i=0;i<r;i++)en(e,n.codePointAt(i))},Ws=Fo&&Fo.encodeInto?rE:iE,nc=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=T0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(cs(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},Jn=(e,t)=>{ie(e,t.byteLength),nc(e,t)},Fu=(e,t)=>{eE(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},sE=(e,t)=>Fu(e,4).setFloat32(0,t,!1),oE=(e,t)=>Fu(e,8).setFloat64(0,t,!1),aE=(e,t)=>Fu(e,8).setBigInt64(0,t,!1),N0=new DataView(new ArrayBuffer(4)),cE=e=>(N0.setFloat32(0,e),N0.getFloat32(0)===e),$o=(e,t)=>{switch(typeof t){case"string":en(e,119),Ws(e,t);break;case"number":Yx(t)&&Qa(t)<=Hx?(en(e,125),Mu(e,t)):cE(t)?(en(e,124),sE(e,t)):(en(e,123),oE(e,t));break;case"bigint":en(e,122),aE(e,t);break;case"object":if(t===null)en(e,126);else if(Gx(t)){en(e,117),ie(e,t.length);for(let n=0;n<t.length;n++)$o(e,t[n])}else if(t instanceof Uint8Array)en(e,116),Jn(e,t);else{en(e,118);const n=Object.keys(t);ie(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ws(e,i),$o(e,t[i])}}break;case"boolean":en(e,t?120:121);break;default:en(e,127)}};class C0 extends Bo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&ie(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const L0=e=>{e.count>0&&(Mu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&ie(e.encoder,e.count-2))};class rc{constructor(){this.encoder=new Bo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(L0(this),this.count=1,this.s=t)}toUint8Array(){return L0(this),zr(this.encoder)}}const M0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Mu(e.encoder,t),e.count>1&&ie(e.encoder,e.count-2)}};class Pu{constructor(){this.encoder=new Bo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(M0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return M0(this),zr(this.encoder)}}class lE{constructor(){this.sarr=[],this.s="",this.lensE=new rc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Bo;return this.sarr.push(this.s),this.s="",Ws(t,this.sarr.join("")),nc(t,this.lensE.toUint8Array()),zr(t)}}const Ui=e=>new Error(e),Wr=()=>{throw Ui("Method unimplemented")},Gr=()=>{throw Ui("Unexpected case")},U0=Ui("Unexpected end of array"),F0=Ui("Integer out of Range");class ic{constructor(t){this.arr=t,this.pos=0}}const Gs=e=>new ic(e),uE=e=>e.pos!==e.arr.length,hE=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Zn=e=>hE(e,Yt(e)),Ks=e=>e.arr[e.pos++],Yt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&ls)*n,n*=128,i<qn)return t;if(t>I0)throw F0}throw U0},Bu=e=>{let t=e.arr[e.pos++],n=t&Cu,r=64;const i=(t&pi)>0?-1:1;if(!(t&qn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&ls)*r,r*=128,t<qn)return i*n;if(n>I0)throw F0}throw U0},Hs=Po?e=>Po.decode(Zn(e)):e=>{let t=Yt(e);if(t===0)return"";{let n=String.fromCodePoint(Ks(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ks(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},$u=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},fE=[e=>{},e=>null,Bu,e=>$u(e,4).getFloat32(0,!1),e=>$u(e,8).getFloat64(0,!1),e=>$u(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Hs,e=>{const t=Yt(e),n={};for(let r=0;r<t;r++){const i=Hs(e);n[i]=Do(e)}return n},e=>{const t=Yt(e),n=[];for(let r=0;r<t;r++)n.push(Do(e));return n},Zn],Do=e=>fE[127-Ks(e)](e);class P0 extends ic{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),uE(this)?this.count=Yt(this)+1:this.count=-1),this.count--,this.s}}class sc extends ic{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Bu(this);const t=A0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Yt(this)+2)}return this.count--,this.s}}class Du extends ic{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Bu(this),n=t&1;this.diff=Mi(t/2),this.count=1,n&&(this.count=Yt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class dE{constructor(t){this.decoder=new sc(t),this.str=Hs(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const pE=crypto.getRandomValues.bind(crypto),B0=()=>pE(new Uint32Array(1))[0],mE="10000000-1000-4000-8000"+-1e11,gE=()=>mE.replace(/[018]/g,e=>(e^B0()&15>>e/4).toString(16)),$0=e=>new Promise(e);Promise.all.bind(Promise);var D0={},oc={};oc.byteLength=bE,oc.toByteArray=xE,oc.fromByteArray=vE;for(var Kr=[],sr=[],_E=typeof Uint8Array<"u"?Uint8Array:Array,ju="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ys=0,yE=ju.length;Ys<yE;++Ys)Kr[Ys]=ju[Ys],sr[ju.charCodeAt(Ys)]=Ys;sr[45]=62,sr[95]=63;function j0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function bE(e){var t=j0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function wE(e,t,n){return(t+n)*3/4-n}function xE(e){var t,n=j0(e),r=n[0],i=n[1],s=new _E(wE(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=sr[e.charCodeAt(c)]<<18|sr[e.charCodeAt(c+1)]<<12|sr[e.charCodeAt(c+2)]<<6|sr[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=sr[e.charCodeAt(c)]<<2|sr[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=sr[e.charCodeAt(c)]<<10|sr[e.charCodeAt(c+1)]<<4|sr[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function EE(e){return Kr[e>>18&63]+Kr[e>>12&63]+Kr[e>>6&63]+Kr[e&63]}function kE(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(EE(r));return i.join("")}function vE(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(kE(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Kr[t>>2]+Kr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Kr[t>>10]+Kr[t>>4&63]+Kr[t<<2&63]+"=")),i.join("")}var zu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */zu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+e[t+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},zu.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,m=r?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=d/c:t+=d*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(t*c-1)*Math.pow(2,i),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+h]=o&255,h+=m,o/=256,l-=8);e[n+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=oc,n=zu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const S=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(S,g),S.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(S){if(S>i)throw new RangeError('The value "'+S+'" is invalid for option "size"');const g=new s(S);return Object.setPrototypeOf(g,u.prototype),g}function u(S,g,_){if(typeof S=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(S)}return f(S,g,_)}u.poolSize=8192;function f(S,g,_){if(typeof S=="string")return p(S,g);if(o.isView(S))return y(S);if(S==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S);if(mt(S,o)||S&&mt(S.buffer,o)||typeof a<"u"&&(mt(S,a)||S&&mt(S.buffer,a)))return v(S,g,_);if(typeof S=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=S.valueOf&&S.valueOf();if(M!=null&&M!==S)return u.from(M,g,_);const G=T(S);if(G)return G;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof S[Symbol.toPrimitive]=="function")return u.from(S[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S)}u.from=function(S,g,_){return f(S,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(S){if(typeof S!="number")throw new TypeError('"size" argument must be of type number');if(S<0)throw new RangeError('The value "'+S+'" is invalid for option "size"')}function h(S,g,_){return d(S),S<=0?l(S):g!==void 0?typeof _=="string"?l(S).fill(g,_):l(S).fill(g):l(S)}u.alloc=function(S,g,_){return h(S,g,_)};function m(S){return d(S),l(S<0?0:A(S)|0)}u.allocUnsafe=function(S){return m(S)},u.allocUnsafeSlow=function(S){return m(S)};function p(S,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=R(S,g)|0;let M=l(_);const G=M.write(S,g);return G!==_&&(M=M.slice(0,G)),M}function b(S){const g=S.length<0?0:A(S.length)|0,_=l(g);for(let M=0;M<g;M+=1)_[M]=S[M]&255;return _}function y(S){if(mt(S,s)){const g=new s(S);return v(g.buffer,g.byteOffset,g.byteLength)}return b(S)}function v(S,g,_){if(g<0||S.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(S.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&_===void 0?M=new s(S):_===void 0?M=new s(S,g):M=new s(S,g,_),Object.setPrototypeOf(M,u.prototype),M}function T(S){if(u.isBuffer(S)){const g=A(S.length)|0,_=l(g);return _.length===0||S.copy(_,0,0,g),_}if(S.length!==void 0)return typeof S.length!="number"||Ot(S.length)?l(0):b(S);if(S.type==="Buffer"&&Array.isArray(S.data))return b(S.data)}function A(S){if(S>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return S|0}function U(S){return+S!=S&&(S=0),u.alloc(+S)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),mt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let M=g.length,G=_.length;for(let tt=0,ot=Math.min(M,G);tt<ot;++tt)if(g[tt]!==_[tt]){M=g[tt],G=_[tt];break}return M<G?-1:G<M?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let M;if(_===void 0)for(_=0,M=0;M<g.length;++M)_+=g[M].length;const G=u.allocUnsafe(_);let tt=0;for(M=0;M<g.length;++M){let ot=g[M];if(mt(ot,s))tt+ot.length>G.length?(u.isBuffer(ot)||(ot=u.from(ot)),ot.copy(G,tt)):s.prototype.set.call(G,ot,tt);else if(u.isBuffer(ot))ot.copy(G,tt);else throw new TypeError('"list" argument must be an Array of Buffers');tt+=ot.length}return G};function R(S,g){if(u.isBuffer(S))return S.length;if(o.isView(S)||mt(S,o))return S.byteLength;if(typeof S!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof S);const _=S.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&_===0)return 0;let G=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ut(S).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return gt(S).length;default:if(G)return M?-1:ut(S).length;g=(""+g).toLowerCase(),G=!0}}u.byteLength=R;function C(S,g,_){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(S||(S="utf8");;)switch(S){case"hex":return B(this,g,_);case"utf8":case"utf-8":return P(this,g,_);case"ascii":return rt(this,g,_);case"latin1":case"binary":return z(this,g,_);case"base64":return $(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ht(this,g,_);default:if(M)throw new TypeError("Unknown encoding: "+S);S=(S+"").toLowerCase(),M=!0}}u.prototype._isBuffer=!0;function j(S,g,_){const M=S[g];S[g]=S[_],S[_]=M}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)j(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)j(this,_,_+3),j(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)j(this,_,_+7),j(this,_+1,_+6),j(this,_+2,_+5),j(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?P(this,0,g):C.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,M,G,tt){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),M===void 0&&(M=g?g.length:0),G===void 0&&(G=0),tt===void 0&&(tt=this.length),_<0||M>g.length||G<0||tt>this.length)throw new RangeError("out of range index");if(G>=tt&&_>=M)return 0;if(G>=tt)return-1;if(_>=M)return 1;if(_>>>=0,M>>>=0,G>>>=0,tt>>>=0,this===g)return 0;let ot=tt-G,zt=M-_;const Ie=Math.min(ot,zt),be=this.slice(G,tt),Oe=g.slice(_,M);for(let le=0;le<Ie;++le)if(be[le]!==Oe[le]){ot=be[le],zt=Oe[le];break}return ot<zt?-1:zt<ot?1:0};function O(S,g,_,M,G){if(S.length===0)return-1;if(typeof _=="string"?(M=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,Ot(_)&&(_=G?0:S.length-1),_<0&&(_=S.length+_),_>=S.length){if(G)return-1;_=S.length-1}else if(_<0)if(G)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,M)),u.isBuffer(g))return g.length===0?-1:W(S,g,_,M,G);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?G?s.prototype.indexOf.call(S,g,_):s.prototype.lastIndexOf.call(S,g,_):W(S,[g],_,M,G);throw new TypeError("val must be string, number or Buffer")}function W(S,g,_,M,G){let tt=1,ot=S.length,zt=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(S.length<2||g.length<2)return-1;tt=2,ot/=2,zt/=2,_/=2}function Ie(Oe,le){return tt===1?Oe[le]:Oe.readUInt16BE(le*tt)}let be;if(G){let Oe=-1;for(be=_;be<ot;be++)if(Ie(S,be)===Ie(g,Oe===-1?0:be-Oe)){if(Oe===-1&&(Oe=be),be-Oe+1===zt)return Oe*tt}else Oe!==-1&&(be-=be-Oe),Oe=-1}else for(_+zt>ot&&(_=ot-zt),be=_;be>=0;be--){let Oe=!0;for(let le=0;le<zt;le++)if(Ie(S,be+le)!==Ie(g,le)){Oe=!1;break}if(Oe)return be}return-1}u.prototype.includes=function(g,_,M){return this.indexOf(g,_,M)!==-1},u.prototype.indexOf=function(g,_,M){return O(this,g,_,M,!0)},u.prototype.lastIndexOf=function(g,_,M){return O(this,g,_,M,!1)};function q(S,g,_,M){_=Number(_)||0;const G=S.length-_;M?(M=Number(M),M>G&&(M=G)):M=G;const tt=g.length;M>tt/2&&(M=tt/2);let ot;for(ot=0;ot<M;++ot){const zt=parseInt(g.substr(ot*2,2),16);if(Ot(zt))return ot;S[_+ot]=zt}return ot}function L(S,g,_,M){return Et(ut(g,S.length-_),S,_,M)}function I(S,g,_,M){return Et(dt(g),S,_,M)}function x(S,g,_,M){return Et(gt(g),S,_,M)}function N(S,g,_,M){return Et(Z(g,S.length-_),S,_,M)}u.prototype.write=function(g,_,M,G){if(_===void 0)G="utf8",M=this.length,_=0;else if(M===void 0&&typeof _=="string")G=_,M=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(M)?(M=M>>>0,G===void 0&&(G="utf8")):(G=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const tt=this.length-_;if((M===void 0||M>tt)&&(M=tt),g.length>0&&(M<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");G||(G="utf8");let ot=!1;for(;;)switch(G){case"hex":return q(this,g,_,M);case"utf8":case"utf-8":return L(this,g,_,M);case"ascii":case"latin1":case"binary":return I(this,g,_,M);case"base64":return x(this,g,_,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,g,_,M);default:if(ot)throw new TypeError("Unknown encoding: "+G);G=(""+G).toLowerCase(),ot=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function $(S,g,_){return g===0&&_===S.length?t.fromByteArray(S):t.fromByteArray(S.slice(g,_))}function P(S,g,_){_=Math.min(S.length,_);const M=[];let G=g;for(;G<_;){const tt=S[G];let ot=null,zt=tt>239?4:tt>223?3:tt>191?2:1;if(G+zt<=_){let Ie,be,Oe,le;switch(zt){case 1:tt<128&&(ot=tt);break;case 2:Ie=S[G+1],(Ie&192)===128&&(le=(tt&31)<<6|Ie&63,le>127&&(ot=le));break;case 3:Ie=S[G+1],be=S[G+2],(Ie&192)===128&&(be&192)===128&&(le=(tt&15)<<12|(Ie&63)<<6|be&63,le>2047&&(le<55296||le>57343)&&(ot=le));break;case 4:Ie=S[G+1],be=S[G+2],Oe=S[G+3],(Ie&192)===128&&(be&192)===128&&(Oe&192)===128&&(le=(tt&15)<<18|(Ie&63)<<12|(be&63)<<6|Oe&63,le>65535&&le<1114112&&(ot=le))}}ot===null?(ot=65533,zt=1):ot>65535&&(ot-=65536,M.push(ot>>>10&1023|55296),ot=56320|ot&1023),M.push(ot),G+=zt}return Q(M)}const it=4096;function Q(S){const g=S.length;if(g<=it)return String.fromCharCode.apply(String,S);let _="",M=0;for(;M<g;)_+=String.fromCharCode.apply(String,S.slice(M,M+=it));return _}function rt(S,g,_){let M="";_=Math.min(S.length,_);for(let G=g;G<_;++G)M+=String.fromCharCode(S[G]&127);return M}function z(S,g,_){let M="";_=Math.min(S.length,_);for(let G=g;G<_;++G)M+=String.fromCharCode(S[G]);return M}function B(S,g,_){const M=S.length;(!g||g<0)&&(g=0),(!_||_<0||_>M)&&(_=M);let G="";for(let tt=g;tt<_;++tt)G+=ue[S[tt]];return G}function ht(S,g,_){const M=S.slice(g,_);let G="";for(let tt=0;tt<M.length-1;tt+=2)G+=String.fromCharCode(M[tt]+M[tt+1]*256);return G}u.prototype.slice=function(g,_){const M=this.length;g=~~g,_=_===void 0?M:~~_,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),_<0?(_+=M,_<0&&(_=0)):_>M&&(_=M),_<g&&(_=g);const G=this.subarray(g,_);return Object.setPrototypeOf(G,u.prototype),G};function ct(S,g,_){if(S%1!==0||S<0)throw new RangeError("offset is not uint");if(S+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||ct(g,_,this.length);let G=this[g],tt=1,ot=0;for(;++ot<_&&(tt*=256);)G+=this[g+ot]*tt;return G},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||ct(g,_,this.length);let G=this[g+--_],tt=1;for(;_>0&&(tt*=256);)G+=this[g+--_]*tt;return G},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||ct(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||ct(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||ct(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=Dt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&D(g,this.length-8);const G=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,tt=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(G)+(BigInt(tt)<<BigInt(32))}),u.prototype.readBigUInt64BE=Dt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&D(g,this.length-8);const G=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],tt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(G)<<BigInt(32))+BigInt(tt)}),u.prototype.readIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||ct(g,_,this.length);let G=this[g],tt=1,ot=0;for(;++ot<_&&(tt*=256);)G+=this[g+ot]*tt;return tt*=128,G>=tt&&(G-=Math.pow(2,8*_)),G},u.prototype.readIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||ct(g,_,this.length);let G=_,tt=1,ot=this[g+--G];for(;G>0&&(tt*=256);)ot+=this[g+--G]*tt;return tt*=128,ot>=tt&&(ot-=Math.pow(2,8*_)),ot},u.prototype.readInt8=function(g,_){return g=g>>>0,_||ct(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||ct(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||ct(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=Dt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&D(g,this.length-8);const G=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(G)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=Dt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&D(g,this.length-8);const G=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(G)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||ct(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||ct(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||ct(g,8,this.length),n.read(this,g,!1,52,8)};function lt(S,g,_,M,G,tt){if(!u.isBuffer(S))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>G||g<tt)throw new RangeError('"value" argument is out of bounds');if(_+M>S.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,M,G){if(g=+g,_=_>>>0,M=M>>>0,!G){const zt=Math.pow(2,8*M)-1;lt(this,g,_,M,zt,0)}let tt=1,ot=0;for(this[_]=g&255;++ot<M&&(tt*=256);)this[_+ot]=g/tt&255;return _+M},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,M,G){if(g=+g,_=_>>>0,M=M>>>0,!G){const zt=Math.pow(2,8*M)-1;lt(this,g,_,M,zt,0)}let tt=M-1,ot=1;for(this[_+tt]=g&255;--tt>=0&&(ot*=256);)this[_+tt]=g/ot&255;return _+M},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function $t(S,g,_,M,G){at(g,M,G,S,_,7);let tt=Number(g&BigInt(4294967295));S[_++]=tt,tt=tt>>8,S[_++]=tt,tt=tt>>8,S[_++]=tt,tt=tt>>8,S[_++]=tt;let ot=Number(g>>BigInt(32)&BigInt(4294967295));return S[_++]=ot,ot=ot>>8,S[_++]=ot,ot=ot>>8,S[_++]=ot,ot=ot>>8,S[_++]=ot,_}function Jt(S,g,_,M,G){at(g,M,G,S,_,7);let tt=Number(g&BigInt(4294967295));S[_+7]=tt,tt=tt>>8,S[_+6]=tt,tt=tt>>8,S[_+5]=tt,tt=tt>>8,S[_+4]=tt;let ot=Number(g>>BigInt(32)&BigInt(4294967295));return S[_+3]=ot,ot=ot>>8,S[_+2]=ot,ot=ot>>8,S[_+1]=ot,ot=ot>>8,S[_]=ot,_+8}u.prototype.writeBigUInt64LE=Dt(function(g,_=0){return $t(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Dt(function(g,_=0){return Jt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,M,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*M-1);lt(this,g,_,M,Ie-1,-Ie)}let tt=0,ot=1,zt=0;for(this[_]=g&255;++tt<M&&(ot*=256);)g<0&&zt===0&&this[_+tt-1]!==0&&(zt=1),this[_+tt]=(g/ot>>0)-zt&255;return _+M},u.prototype.writeIntBE=function(g,_,M,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*M-1);lt(this,g,_,M,Ie-1,-Ie)}let tt=M-1,ot=1,zt=0;for(this[_+tt]=g&255;--tt>=0&&(ot*=256);)g<0&&zt===0&&this[_+tt+1]!==0&&(zt=1),this[_+tt]=(g/ot>>0)-zt&255;return _+M},u.prototype.writeInt8=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||lt(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=Dt(function(g,_=0){return $t(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Dt(function(g,_=0){return Jt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Bt(S,g,_,M,G,tt){if(_+M>S.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function Ft(S,g,_,M,G){return g=+g,_=_>>>0,G||Bt(S,g,_,4),n.write(S,g,_,M,23,4),_+4}u.prototype.writeFloatLE=function(g,_,M){return Ft(this,g,_,!0,M)},u.prototype.writeFloatBE=function(g,_,M){return Ft(this,g,_,!1,M)};function ae(S,g,_,M,G){return g=+g,_=_>>>0,G||Bt(S,g,_,8),n.write(S,g,_,M,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,M){return ae(this,g,_,!0,M)},u.prototype.writeDoubleBE=function(g,_,M){return ae(this,g,_,!1,M)},u.prototype.copy=function(g,_,M,G){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!G&&G!==0&&(G=this.length),_>=g.length&&(_=g.length),_||(_=0),G>0&&G<M&&(G=M),G===M||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("sourceEnd out of bounds");G>this.length&&(G=this.length),g.length-_<G-M&&(G=g.length-_+M);const tt=G-M;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,M,G):s.prototype.set.call(g,this.subarray(M,G),_),tt},u.prototype.fill=function(g,_,M,G){if(typeof g=="string"){if(typeof _=="string"?(G=_,_=0,M=this.length):typeof M=="string"&&(G=M,M=this.length),G!==void 0&&typeof G!="string")throw new TypeError("encoding must be a string");if(typeof G=="string"&&!u.isEncoding(G))throw new TypeError("Unknown encoding: "+G);if(g.length===1){const ot=g.charCodeAt(0);(G==="utf8"&&ot<128||G==="latin1")&&(g=ot)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<M)throw new RangeError("Out of range index");if(M<=_)return this;_=_>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let tt;if(typeof g=="number")for(tt=_;tt<M;++tt)this[tt]=g;else{const ot=u.isBuffer(g)?g:u.from(g,G),zt=ot.length;if(zt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(tt=0;tt<M-_;++tt)this[tt+_]=ot[tt%zt]}return this};const Vt={};function Se(S,g,_){Vt[S]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${S}]`,this.stack,delete this.name}get code(){return S}set code(G){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:G,writable:!0})}toString(){return`${this.name} [${S}]: ${this.message}`}}}Se("ERR_BUFFER_OUT_OF_BOUNDS",function(S){return S?`${S} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Se("ERR_INVALID_ARG_TYPE",function(S,g){return`The "${S}" argument must be of type number. Received type ${typeof g}`},TypeError),Se("ERR_OUT_OF_RANGE",function(S,g,_){let M=`The value of "${S}" is out of range.`,G=_;return Number.isInteger(_)&&Math.abs(_)>2**32?G=Pe(String(_)):typeof _=="bigint"&&(G=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(G=Pe(G)),G+="n"),M+=` It must be ${g}. Received ${G}`,M},RangeError);function Pe(S){let g="",_=S.length;const M=S[0]==="-"?1:0;for(;_>=M+4;_-=3)g=`_${S.slice(_-3,_)}${g}`;return`${S.slice(0,_)}${g}`}function k(S,g,_){nt(g,"offset"),(S[g]===void 0||S[g+_]===void 0)&&D(g,S.length-(_+1))}function at(S,g,_,M,G,tt){if(S>_||S<g){const ot=typeof g=="bigint"?"n":"";let zt;throw g===0||g===BigInt(0)?zt=`>= 0${ot} and < 2${ot} ** ${(tt+1)*8}${ot}`:zt=`>= -(2${ot} ** ${(tt+1)*8-1}${ot}) and < 2 ** ${(tt+1)*8-1}${ot}`,new Vt.ERR_OUT_OF_RANGE("value",zt,S)}k(M,G,tt)}function nt(S,g){if(typeof S!="number")throw new Vt.ERR_INVALID_ARG_TYPE(g,"number",S)}function D(S,g,_){throw Math.floor(S)!==S?(nt(S,_),new Vt.ERR_OUT_OF_RANGE("offset","an integer",S)):g<0?new Vt.ERR_BUFFER_OUT_OF_BOUNDS:new Vt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,S)}const F=/[^+/0-9A-Za-z-_]/g;function V(S){if(S=S.split("=")[0],S=S.trim().replace(F,""),S.length<2)return"";for(;S.length%4!==0;)S=S+"=";return S}function ut(S,g){g=g||1/0;let _;const M=S.length;let G=null;const tt=[];for(let ot=0;ot<M;++ot){if(_=S.charCodeAt(ot),_>55295&&_<57344){if(!G){if(_>56319){(g-=3)>-1&&tt.push(239,191,189);continue}else if(ot+1===M){(g-=3)>-1&&tt.push(239,191,189);continue}G=_;continue}if(_<56320){(g-=3)>-1&&tt.push(239,191,189),G=_;continue}_=(G-55296<<10|_-56320)+65536}else G&&(g-=3)>-1&&tt.push(239,191,189);if(G=null,_<128){if((g-=1)<0)break;tt.push(_)}else if(_<2048){if((g-=2)<0)break;tt.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;tt.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;tt.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return tt}function dt(S){const g=[];for(let _=0;_<S.length;++_)g.push(S.charCodeAt(_)&255);return g}function Z(S,g){let _,M,G;const tt=[];for(let ot=0;ot<S.length&&!((g-=2)<0);++ot)_=S.charCodeAt(ot),M=_>>8,G=_%256,tt.push(G),tt.push(M);return tt}function gt(S){return t.toByteArray(V(S))}function Et(S,g,_,M){let G;for(G=0;G<M&&!(G+_>=g.length||G>=S.length);++G)g[G+_]=S[G];return G}function mt(S,g){return S instanceof g||S!=null&&S.constructor!=null&&S.constructor.name!=null&&S.constructor.name===g.name}function Ot(S){return S!==S}const ue=function(){const S="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const M=_*16;for(let G=0;G<16;++G)g[M+G]=S[_]+S[G]}return g}();function Dt(S){return typeof BigInt>"u"?Yn:S}function Yn(){throw new Error("BigInt not supported")}})(D0);const un=D0.Buffer,z0=e=>e===void 0?null:e;class TE{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let W0=new TE,AE=!0;try{typeof localStorage<"u"&&localStorage&&(W0=localStorage,AE=!1)}catch{}const RE=W0,SE=Object.assign,IE=Object.keys,OE=(e,t)=>{for(const n in e)t(e[n],n)},G0=e=>IE(e).length,NE=e=>{for(const t in e)return!1;return!0},CE=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},LE=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),ME=(e,t)=>e===t||G0(e)===G0(t)&&CE(e,(n,r)=>(n!==void 0||LE(t,r))&&t[r]===n),UE=Object.freeze,K0=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&K0(e[t])}return UE(e)},Wu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Wu(e,t,n+1)}},FE=e=>e,PE=(e,t)=>t.includes(e);var H0={};const jo=typeof xr<"u"&&xr.release&&/node|io\.js/.test(xr.release.name)&&Object.prototype.toString.call(typeof xr<"u"?xr:0)==="[object process]";let Hr;const BE=()=>{if(Hr===void 0)if(jo){Hr=Er();const e=xr.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Hr.set(t,""),t=r):t!==null&&(Hr.set(t,r),t=null)}t!==null&&Hr.set(t,"")}else typeof location=="object"?(Hr=Er(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Hr.set(`--${O0(t,"-")}`,n),Hr.set(`-${O0(t,"-")}`,n)}})):Hr=Er();return Hr},Gu=e=>BE().has(e),ac=e=>z0(jo?H0[e.toUpperCase().replaceAll("-","_")]:RE.getItem(e)),Y0=e=>Gu("--"+e)||ac(e)!==null;Y0("production");const $E=jo&&PE(H0.FORCE_COLOR,["true","1","2"])||!Gu("--no-colors")&&!Y0("no-color")&&(!jo||xr.stdout.isTTY)&&(!jo||Gu("--color")||ac("COLORTERM")!==null||(ac("TERM")||"").includes("color")),DE=e=>new Uint8Array(e),jE=e=>{const t=DE(e.byteLength);return t.set(e),t};class zE{constructor(t,n){this.left=t,this.right=n}}const mi=(e,t)=>new zE(e,t);typeof DOMParser<"u"&&new DOMParser;const WE=e=>jx(e,(t,n)=>`${n}:${t};`).join(""),gi=Symbol,V0=gi(),X0=gi(),GE=gi(),KE=gi(),HE=gi(),q0=gi(),YE=gi(),Ku=gi(),VE=gi(),XE=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},qE={[V0]:mi("font-weight","bold"),[X0]:mi("font-weight","normal"),[GE]:mi("color","blue"),[HE]:mi("color","green"),[KE]:mi("color","grey"),[q0]:mi("color","red"),[YE]:mi("color","purple"),[Ku]:mi("color","orange"),[VE]:mi("color","black")},J0=$E?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Er();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=qE[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=WE(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:XE,JE=(...e)=>{console.log(...J0(e)),Z0.forEach(t=>t.print(e))},ZE=(...e)=>{console.warn(...J0(e)),e.unshift(Ku),Z0.forEach(t=>t.print(e))},Z0=zs(),Q0=e=>({[Symbol.iterator](){return this},next:e}),QE=(e,t)=>Q0(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Hu=(e,t)=>Q0(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Yu{constructor(t,n){this.clock=t,this.len=n}}class zo{constructor(){this.clients=new Map}}const tp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];gp(e,s,a.clock,a.len,n)}}),tk=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Mi((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},ep=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&tk(n,t.clock)!==null},Vu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=cs(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},ek=e=>{const t=new zo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)Wx(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Vu(t),t},cc=(e,t,n,r)=>{Li(e.clients,t,()=>[]).push(new Yu(n,r))},nk=()=>new zo,rk=e=>{const t=nk();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Yu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Vs=(e,t)=>{ie(e.restEncoder,t.clients.size),as(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),ie(e.restEncoder,n);const i=r.length;ie(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Xu=e=>{const t=new zo,n=Yt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Yt(e.restDecoder),s=Yt(e.restDecoder);if(s>0){const o=Li(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Yu(e.readDsClock(),e.readDsLen()))}}return t},np=(e,t,n)=>{const r=new zo,i=Yt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Yt(e.restDecoder),a=Yt(e.restDecoder),c=n.clients.get(o)||[],l=nn(n,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&cc(r,o,l,d-l);let h=Yr(c,f),m=c[h];for(!m.deleted&&m.id.clock<f&&(c.splice(h+1,0,Ec(t,m,f-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(h,0,Ec(t,m,d-m.id.clock)),m.delete(t))}else cc(r,o,f,d-f)}}if(r.clients.size>0){const s=new us;return ie(s.restEncoder,0),Vs(s,r),s.toUint8Array()}return null},rp=B0;class Xs extends Kx{constructor({guid:t=gE(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=rp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new dp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=$0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>$0(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&fe(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(as(this.subdocs).map(t=>t.guid))}transact(t,n=null){return fe(this,t,n)}get(t,n=hn){const r=Li(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==hn&&i!==n)if(i===hn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Qs)}getText(t=""){return this.get(t,_i)}getMap(t=""){return this.get(t,to)}getXmlElement(t=""){return this.get(t,no)}getXmlFragment(t=""){return this.get(t,hs)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,as(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Xs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,fe(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class ip{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Yt(this.restDecoder)}readDsLen(){return Yt(this.restDecoder)}}class sp extends ip{readLeftID(){return Zt(Yt(this.restDecoder),Yt(this.restDecoder))}readRightID(){return Zt(Yt(this.restDecoder),Yt(this.restDecoder))}readClient(){return Yt(this.restDecoder)}readInfo(){return Ks(this.restDecoder)}readString(){return Hs(this.restDecoder)}readParentInfo(){return Yt(this.restDecoder)===1}readTypeRef(){return Yt(this.restDecoder)}readLen(){return Yt(this.restDecoder)}readAny(){return Do(this.restDecoder)}readBuf(){return jE(Zn(this.restDecoder))}readJSON(){return JSON.parse(Hs(this.restDecoder))}readKey(){return Hs(this.restDecoder)}}class ik{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Yt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Yt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class qs extends ik{constructor(t){super(t),this.keys=[],Yt(t),this.keyClockDecoder=new Du(Zn(t)),this.clientDecoder=new sc(Zn(t)),this.leftClockDecoder=new Du(Zn(t)),this.rightClockDecoder=new Du(Zn(t)),this.infoDecoder=new P0(Zn(t),Ks),this.stringDecoder=new dE(Zn(t)),this.parentInfoDecoder=new P0(Zn(t),Ks),this.typeRefDecoder=new sc(Zn(t)),this.lenDecoder=new sc(Zn(t))}readLeftID(){return new Js(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Js(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Do(this.restDecoder)}readBuf(){return Zn(this.restDecoder)}readJSON(){return Do(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class sk{constructor(){this.restEncoder=ec()}toUint8Array(){return zr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){ie(this.restEncoder,t)}writeDsLen(t){ie(this.restEncoder,t)}}class Wo extends sk{writeLeftID(t){ie(this.restEncoder,t.client),ie(this.restEncoder,t.clock)}writeRightID(t){ie(this.restEncoder,t.client),ie(this.restEncoder,t.clock)}writeClient(t){ie(this.restEncoder,t)}writeInfo(t){Lu(this.restEncoder,t)}writeString(t){Ws(this.restEncoder,t)}writeParentInfo(t){ie(this.restEncoder,t?1:0)}writeTypeRef(t){ie(this.restEncoder,t)}writeLen(t){ie(this.restEncoder,t)}writeAny(t){$o(this.restEncoder,t)}writeBuf(t){Jn(this.restEncoder,t)}writeJSON(t){Ws(this.restEncoder,JSON.stringify(t))}writeKey(t){Ws(this.restEncoder,t)}}class ok{constructor(){this.restEncoder=ec(),this.dsCurrVal=0}toUint8Array(){return zr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,ie(this.restEncoder,n)}writeDsLen(t){t===0&&Gr(),ie(this.restEncoder,t-1),this.dsCurrVal+=t}}class us extends ok{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Pu,this.clientEncoder=new rc,this.leftClockEncoder=new Pu,this.rightClockEncoder=new Pu,this.infoEncoder=new C0(Lu),this.stringEncoder=new lE,this.parentInfoEncoder=new C0(Lu),this.typeRefEncoder=new rc,this.lenEncoder=new rc}toUint8Array(){const t=ec();return ie(t,0),Jn(t,this.keyClockEncoder.toUint8Array()),Jn(t,this.clientEncoder.toUint8Array()),Jn(t,this.leftClockEncoder.toUint8Array()),Jn(t,this.rightClockEncoder.toUint8Array()),Jn(t,zr(this.infoEncoder)),Jn(t,this.stringEncoder.toUint8Array()),Jn(t,zr(this.parentInfoEncoder)),Jn(t,this.typeRefEncoder.toUint8Array()),Jn(t,this.lenEncoder.toUint8Array()),nc(t,zr(this.restEncoder)),zr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){$o(this.restEncoder,t)}writeBuf(t){Jn(this.restEncoder,t)}writeJSON(t){$o(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const ak=(e,t,n,r)=>{r=cs(r,t[0].id.clock);const i=Yr(t,r);ie(e.restEncoder,t.length-i),e.writeClient(n),ie(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},qu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{nn(t,s)>i&&r.set(s,i)}),Zu(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ie(e.restEncoder,r.size),as(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{ak(e,t.clients.get(i),i,s)})},ck=(e,t)=>{const n=Er(),r=Yt(e.restDecoder);for(let i=0;i<r;i++){const s=Yt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Yt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(tc&u){case 0:{const f=e.readLen();o[l]=new or(Zt(a,c),f),c+=f;break}case 10:{const f=Yt(e.restDecoder);o[l]=new ar(Zt(a,c),f),c+=f;break}default:{const f=(u&(pi|qn))===0,d=new Xe(Zt(a,c),null,(u&qn)===qn?e.readLeftID():null,null,(u&pi)===pi?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&Uo)===Uo?e.readString():null,jp(e,u));o[l]=d,c+=d.length}}}}return n},lk=(e,t,n)=>{const r=[];let i=as(n.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new dp,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const m=h.id.client,p=n.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),n.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(b=>b!==m)}r.length=0};for(;;){if(u.constructor!==ar){const m=Li(f,u.id.client,()=>nn(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(e,t);if(p!==null){r.push(u);const b=n.get(p)||{refs:[],i:0};if(b.refs.length===b.i)l(p,nn(t,p)),d();else{u=b.refs[b.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new us;return qu(h,a,new Map),ie(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},uk=(e,t)=>qu(e,t.doc.store,t.beforeState),hk=(e,t,n,r=new qs(e))=>fe(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=ck(r,o),l=lk(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<nn(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const m=u.missing.get(d);(m==null||m>h)&&u.missing.set(d,h)}u.update=hc([u.update,l.update])}}else a.pendingStructs=l;const f=np(r,i,a);if(a.pendingDs){const d=new qs(Gs(a.pendingDs));Yt(d.restDecoder);const h=np(d,i,a);f&&h?a.pendingDs=hc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,op(i.doc,d)}},n,!1),op=(e,t,n,r=qs)=>{const i=Gs(t);hk(i,e,n,new r(i))},ap=(e,t,n)=>op(e,t,n,sp),fk=(e,t,n=new Map)=>{qu(e,t.store,n),Vs(e,rk(t.store))},dk=(e,t=new Uint8Array([0]),n=new us)=>{const r=cp(t);fk(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Tk(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Wo)return kk(i.map((s,o)=>o===0?s:Rk(s)));if(n.constructor===us)return hc(i)}return i[0]},pk=(e,t)=>dk(e,t,new Wo),mk=e=>{const t=new Map,n=Yt(e.restDecoder);for(let r=0;r<n;r++){const i=Yt(e.restDecoder),s=Yt(e.restDecoder);t.set(i,s)}return t},cp=e=>mk(new ip(Gs(e)));class gk{constructor(){this.l=[]}}const lp=()=>new gk,up=(e,t)=>e.l.push(t),hp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},fp=(e,t,n)=>Wu(e.l,[t,n]);class Js{constructor(t,n){this.client=t,this.clock=n}}const lc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Zt=(e,t)=>new Js(e,t),_k=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Gr()},Zs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!ep(t.ds,e.id),Ju=(e,t)=>{const n=Li(e.meta,Ju,zs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<nn(r,s)&&Fi(e,Zt(s,i))}),tp(e,t.ds,i=>{}),n.add(t))};class dp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Zu=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},nn=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},pp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Gr()}n.push(t)},Yr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Mi(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Mi((n+r)/2)}throw Gr()},Qu=(e,t)=>{const n=e.clients.get(t.client);return n[Yr(n,t.clock)]},th=(e,t,n)=>{const r=Yr(t,n),i=t[r];return i.id.clock<n&&i instanceof Xe?(t.splice(r+1,0,Ec(e,i,n-i.id.clock)),r+1):r},Fi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[th(e,n,t.clock)]},mp=(e,t,n)=>{const r=t.clients.get(n.client),i=Yr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==or&&r.splice(i+1,0,Ec(e,s,n.clock-s.id.clock+1)),s},yk=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Yr(r,t.id.clock)]=n},gp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=th(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&th(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class bk{constructor(t,n,r){this.doc=t,this.deleteSet=new zo,this.beforeState=Zu(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const _p=(e,t)=>t.deleteSet.clients.size===0&&!zx(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Vu(t.deleteSet),uk(e,t),Vs(e,t.deleteSet),!0),yp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Li(e.changed,t,zs).add(n)},uc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Xe&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},wk=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Yr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Xe&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},xk=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=T0(i.length-1,1+Yr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+uc(i,c)}})},bp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Vu(s),n.afterState=Zu(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),fp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Wu(a,[]),n._needFormattingCleanup&&jk(n)}finally{r.gc&&wk(s,i,r.gcFilter),xk(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),m=cs(Yr(h,d),1);for(let p=h.length-1;p>=m;)p-=1+uc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),m=Yr(h,d);m+1<h.length&&uc(h,m+1)>1||m>0&&uc(h,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(JE(Ku,V0,"[yjs] ",X0,q0,"Changed the client-id because another client seems to be using it."),r.clientID=rp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Wo;_p(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new us;_p(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):bp(e,t+1)}}},fe=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new bk(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&bp(i,0)}}return o};function*Ek(e){const t=Yt(e.restDecoder);for(let n=0;n<t;n++){const r=Yt(e.restDecoder),i=e.readClient();let s=Yt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Yt(e.restDecoder);yield new ar(Zt(i,s),c),s+=c}else if(tc&a){const c=(a&(pi|qn))===0,l=new Xe(Zt(i,s),null,(a&qn)===qn?e.readLeftID():null,null,(a&pi)===pi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&Uo)===Uo?e.readString():null,jp(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new or(Zt(i,s),c),s+=c}}}}class eh{constructor(t,n){this.gen=Ek(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ar);return this.curr}}class nh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const kk=e=>hc(e,sp,Wo),vk=(e,t)=>{if(e.constructor===or){const{client:n,clock:r}=e.id;return new or(Zt(n,r+t),e.length-t)}else if(e.constructor===ar){const{client:n,clock:r}=e.id;return new ar(Zt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Xe(Zt(r,i+t),null,Zt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},hc=(e,t=qs,n=us)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Gs(u)));let i=r.map(u=>new eh(u,!0)),s=null;const o=new n,a=new nh(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const m=d.curr.id.clock-h.curr.id.clock;return m===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===ar?1:-1:m}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===ar)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ar(Zt(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===ar?s.struct.length-=m:d=vk(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==ar;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),rh(a);const c=r.map(u=>Xu(u)),l=ek(c);return Vs(o,l),o.toUint8Array()},Tk=(e,t,n=qs,r=us)=>{const i=cp(t),s=new r,o=new nh(s),a=new n(Gs(e)),c=new eh(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===ar){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,cs(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}rh(o);const l=Xu(a);return Vs(s,l),s.toUint8Array()},wp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:zr(e.encoder.restEncoder)}),e.encoder.restEncoder=ec(),e.written=0)},Pi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&wp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ie(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},rh=e=>{wp(e);const t=e.encoder.restEncoder;ie(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];ie(t,r.written),nc(t,r.restEncoder)}},Ak=(e,t,n,r)=>{const i=new n(Gs(e)),s=new eh(i,!1),o=new r,a=new nh(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,t(l),0);rh(a);const c=Xu(i);return Vs(o,c),o.toUint8Array()},Rk=e=>Ak(e,FE,qs,Wo),xp="You must not compute changes after the event-handler fired.";class fc{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Sk(this.currentTarget,this.target))}deletes(t){return ep(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ui(xp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Iu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Iu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Iu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ui(xp);const n=this.target,r=zs(),i=zs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const Sk=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},gn=()=>{ZE("Invalid access: Add Yjs type to a document before reading data.")},Ep=80;let ih=0;class Ik{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=ih++}}const Ok=e=>{e.timestamp=ih++},kp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=ih++},Nk=(e,t,n)=>{if(e.length>=Ep){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return kp(r,t,n),r}else{const r=new Ik(t,n);return e.push(r),r}},dc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Qa(t-s.index)<Qa(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Ok(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Qa(n.index-i)<r.parent.length/Ep?(kp(n,r,i),n):Nk(e._searchMarker,r,i)},Go=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=cs(t,i.index+n))}},pc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Li(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;fp(r._eH,n,t)};class hn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=lp(),this._dEH=lp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Wr()}clone(){throw Wr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){up(this._eH,t)}observeDeep(t){up(this._dEH,t)}unobserve(t){hp(this._eH,t)}unobserveDeep(t){hp(this._dEH,t)}toJSON(){}}const vp=(e,t,n)=>{e.doc??gn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Tp=e=>{e.doc??gn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Ko=(e,t)=>{let n=0,r=e._start;for(e.doc??gn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Ap=(e,t)=>{const n=[];return Ko(e,(r,i)=>{n.push(t(r,i,e))}),n},Ck=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Rp=(e,t)=>{e.doc??gn();const n=dc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},mc=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Xe(Zt(o,nn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ds(l)),i.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Xe(Zt(o,nn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ho(new Uint8Array(f))),i.integrate(e,0);break;case Xs:i=new Xe(Zt(o,nn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Vo(f)),i.integrate(e,0);break;default:if(f instanceof hn)i=new Xe(Zt(o,nn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new yi(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Sp=()=>Ui("Length exceeded!"),Ip=(e,t,n,r)=>{if(n>t._length)throw Sp();if(n===0)return t._searchMarker&&Go(t._searchMarker,n,r.length),mc(e,t,null,r);const i=n,s=dc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Fi(e,Zt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Go(t._searchMarker,i,r.length),mc(e,t,o,r)},Lk=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return mc(e,t,i,n)},Op=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=dc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Fi(e,Zt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Fi(e,Zt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Sp();t._searchMarker&&Go(t._searchMarker,i,-s+r)},gc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},sh=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ds([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ds([r]);break;case Uint8Array:a=new Ho(r);break;case Xs:a=new Vo(r);break;default:if(r instanceof hn)a=new yi(r);else throw new Error("Unexpected content type")}new Xe(Zt(o,nn(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},oh=(e,t)=>{e.doc??gn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Np=e=>{const t={};return e.doc??gn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Cp=(e,t)=>{e.doc??gn();const n=e._map.get(t);return n!==void 0&&!n.deleted},Mk=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Zs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},_c=e=>(e.doc??gn(),QE(e._map.entries(),t=>!t[1].deleted));class Uk extends fc{}class Qs extends hn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Qs;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Qs}clone(){const t=new Qs;return t.insert(0,this.toArray().map(n=>n instanceof hn?n.clone():n)),t}get length(){return this.doc??gn(),this._length}_callObserver(t,n){super._callObserver(t,n),pc(this,t,new Uk(this,t))}insert(t,n){this.doc!==null?fe(this.doc,r=>{Ip(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?fe(this.doc,n=>{Lk(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?fe(this.doc,r=>{Op(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Rp(this,t)}toArray(){return Tp(this)}slice(t=0,n=this.length){return vp(this,t,n)}toJSON(){return this.map(t=>t instanceof hn?t.toJSON():t)}map(t){return Ap(this,t)}forEach(t){Ko(this,t)}[Symbol.iterator](){return Ck(this)}_write(t){t.writeTypeRef(ov)}}const Fk=e=>new Qs;class Pk extends fc{constructor(t,n,r){super(t,n),this.keysChanged=r}}class to extends hn{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new to}clone(){const t=new to;return this.forEach((n,r)=>{t.set(r,n instanceof hn?n.clone():n)}),t}_callObserver(t,n){pc(this,t,new Pk(this,t,n))}toJSON(){this.doc??gn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof hn?i.toJSON():i}}),t}get size(){return[..._c(this)].length}keys(){return Hu(_c(this),t=>t[0])}values(){return Hu(_c(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Hu(_c(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??gn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?fe(this.doc,n=>{gc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?fe(this.doc,r=>{sh(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return oh(this,t)}has(t){return Cp(this,t)}clear(){this.doc!==null?fe(this.doc,t=>{this.forEach(function(n,r,i){gc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(av)}}const Bk=e=>new to,Bi=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&ME(e,t);class ah{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Gr(),this.right.content.constructor){case Ve:this.right.deleted||eo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Lp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Ve:t.right.deleted||eo(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Fi(e,Zt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},yc=(e,t,n,r)=>{const i=new Map,s=r?dc(t,n):null;if(s){const o=new ah(s.p.left,s.p,s.index,i);return Lp(e,o,n-s.index)}else{const o=new ah(null,t._start,0,i);return Lp(e,o,n)}},Mp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ve&&Bi(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Xe(Zt(s,nn(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new Ve(a,o));u.integrate(e,0),n.right=u,n.forward()})},eo=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Up=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Ve&&Bi(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Fp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Bi(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Xe(Zt(s,nn(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new Ve(a,c)),n.right.integrate(e,0),n.forward()}}return o},ch=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;Up(n,i);const a=Fp(e,t,n,i),c=r.constructor===String?new Vr(r):r instanceof hn?new yi(r):new fs(r);let{left:l,right:u,index:f}=n;t._searchMarker&&Go(t._searchMarker,n.index,c.getLength()),u=new Xe(Zt(o,nn(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=f,n.forward(),Mp(e,t,n,a)},Pp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Up(n,i);const a=Fp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ve));){if(!n.right.deleted)switch(n.right.content.constructor){case Ve:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Bi(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Fi(e,Zt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Xe(Zt(o,nn(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Vr(c)),n.right.integrate(e,0),n.forward()}Mp(e,t,n,a)},Bp=(e,t,n,r,i)=>{let s=t;const o=Er();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ve){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case Ve:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&eo(i,l);break}}}t=t.right}return a},$k=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Ve){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Dk=e=>{let t=0;return fe(e.doc,n=>{let r=e._start,i=e._start,s=Er();const o=Su(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ve:eo(o,i.content);break;default:t+=Bp(n,r,i,s,o),s=Su(o),r=i;break}i=i.right}}),t},jk=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&gp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ve&&o.constructor!==or&&t.add(o.parent)})}fe(n,r=>{tp(e,e.deleteSet,i=>{if(i instanceof or||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Ve?t.add(s):$k(r,i)});for(const i of t)Dk(i)})},$p=(e,t,n)=>{const r=n,i=Su(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case yi:case fs:case Vr:n<t.right.length&&Fi(e,Zt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Bp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Go(o._searchMarker,t.index,-r+n),t};class zk extends fc{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];fe(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},NE(c)||(h.attributes=SE({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case yi:case fs:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Vr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Ve:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;Bi(p,m)?m!==null&&o.delete(r):(a==="retain"&&d(),Bi(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;Bi(p,m)||(a==="retain"&&d(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&(Bi(p,m)?p!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&d(),eo(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class _i extends hn{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??gn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new _i}clone(){const t=new _i;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new zk(this,t,n);pc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??gn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Vr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?fe(this.doc,r=>{const i=new ah(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ch(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Pp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&$p(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??gn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((m,p)=>{d=!0,f[p]=m});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Zs(c,t)||n!==void 0&&Zs(c,n))switch(c.content.constructor){case Vr:{const f=s.get("ychange");t!==void 0&&!Zs(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Zs(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case yi:case fs:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,m)=>{d[m]=h})}i.push(f);break}case Ve:Zs(c,t)&&(l(),eo(s,c.content));break}c=c.right}l()};return t||n?fe(o,f=>{t&&Ju(f,t),n&&Ju(f,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?fe(i,s=>{const o=yc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),ch(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?fe(i,s=>{const o=yc(s,this,t,!r);ch(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?fe(r,i=>{$p(i,yc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?fe(i,s=>{const o=yc(s,this,t,!1);o.right!==null&&Pp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?fe(this.doc,n=>{gc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?fe(this.doc,r=>{sh(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return oh(this,t)}getAttributes(){return Np(this)}_write(t){t.writeTypeRef(cv)}}const Wk=e=>new _i;class lh{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??gn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===no||n.constructor===hs)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class hs extends hn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new hs}clone(){const t=new hs;return t.insert(0,this.toArray().map(n=>n instanceof hn?n.clone():n)),t}get length(){return this.doc??gn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new lh(this,t)}querySelector(t){t=t.toUpperCase();const r=new lh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),as(new lh(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){pc(this,t,new Hk(this,n,t))}toString(){return Ap(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ko(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?fe(this.doc,r=>{Ip(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)fe(this.doc,r=>{const i=t&&t instanceof hn?t._item:t;mc(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ui("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?fe(this.doc,r=>{Op(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Tp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Rp(this,t)}slice(t=0,n=this.length){return vp(this,t,n)}forEach(t){Ko(this,t)}_write(t){t.writeTypeRef(uv)}}const Gk=e=>new hs;class no extends hs{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new no(this.nodeName)}clone(){const t=new no(this.nodeName),n=this.getAttributes();return OE(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof hn?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?fe(this.doc,n=>{gc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?fe(this.doc,r=>{sh(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return oh(this,t)}hasAttribute(t){return Cp(this,t)}getAttributes(t){return t?Mk(this,t):Np(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ko(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(lv),t.writeKey(this.nodeName)}}const Kk=e=>new no(e.readKey());class Hk extends fc{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class bc extends to{constructor(t){super(),this.hookName=t}_copy(){return new bc(this.hookName)}clone(){const t=new bc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(hv),t.writeKey(this.hookName)}}const Yk=e=>new bc(e.readKey());class wc extends _i{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new wc}clone(){const t=new wc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(fv)}}const Vk=e=>new wc;class uh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Wr()}mergeWith(t){return!1}write(t,n,r){throw Wr()}integrate(t,n){throw Wr()}}const Xk=0;class or extends uh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),pp(t.doc.store,this)}write(t,n){t.writeInfo(Xk),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ho{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ho(this.content)}splice(t){throw Wr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const qk=e=>new Ho(e.readBuf());class Yo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Yo(this.len)}splice(t){const n=new Yo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){cc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Jk=e=>new Yo(e.readLen()),Dp=(e,t)=>new Xs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Vo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Vo(Dp(this.doc.guid,this.opts))}splice(t){throw Wr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Zk=e=>new Vo(Dp(e.readString(),e.readAny()));class fs{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new fs(this.embed)}splice(t){throw Wr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Qk=e=>new fs(e.readJSON());class Ve{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ve(this.key,this.value)}splice(t){throw Wr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const tv=e=>new Ve(e.readKey(),e.readJSON());class xc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xc(this.arr)}splice(t){const n=new xc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const ev=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new xc(n)},nv=ac("node_env")==="development";class ds{constructor(t){this.arr=t,nv&&K0(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ds(this.arr)}splice(t){const n=new ds(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const rv=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ds(n)};class Vr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vr(this.str)}splice(t){const n=new Vr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const iv=e=>new Vr(e.readString()),sv=[Fk,Bk,Wk,Kk,Gk,Yk,Vk],ov=0,av=1,cv=2,lv=3,uv=4,hv=5,fv=6;class yi{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new yi(this.type._copy())}splice(t){throw Wr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const dv=e=>new yi(sv[e.readTypeRef()](e)),Ec=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Xe(Zt(r,i+n),t,Zt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Zt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Xe extends uh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?S0:0}set marker(t){(this.info&Nu)>0!==t&&(this.info^=Nu)}get marker(){return(this.info&Nu)>0}get keep(){return(this.info&R0)>0}set keep(t){this.keep!==t&&(this.info^=R0)}get countable(){return(this.info&S0)>0}get deleted(){return(this.info&Ou)>0}set deleted(t){this.deleted!==t&&(this.info^=Ou)}markDeleted(){this.info|=Ou}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=nn(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=nn(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Js&&this.id.client!==this.parent.client&&this.parent.clock>=nn(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=mp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Fi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===or||this.right&&this.right.constructor===or)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Xe?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Xe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Js){const r=Qu(n,this.parent);r.constructor===or?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=mp(t,t.doc.store,Zt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),lc(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(lc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Qu(t.doc.store,i.origin)))s.has(Qu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),pp(t.doc.store,this),this.content.integrate(t,this),yp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new or(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Zt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&lc(t.origin,this.lastId)&&this.right===t&&lc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),cc(t.deleteSet,this.id.client,this.id.clock,this.length),yp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Gr();this.content.gc(t),n?yk(t,this,new or(this.id,this.length)):this.content=new Yo(this.length)}write(t,n){const r=n>0?Zt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&tc|(r===null?0:qn)|(i===null?0:pi)|(s===null?0:Uo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=_k(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Js?(t.writeParentInfo(!1),t.writeLeftID(a)):Gr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const jp=(e,t)=>pv[t&tc](e),pv=[()=>{Gr()},Jk,ev,qk,iv,Qk,tv,dv,rv,Zk,()=>{Gr()}],mv=10;class ar extends uh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Gr()}write(t,n){t.writeInfo(mv),ie(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const zp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof js<"u"?js:{},Wp="__ $YJS$ __";zp[Wp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),zp[Wp]=!0;let Gp=!1;const Qn=new Xs;function Kp(e,t,n){const r=Qn.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function gv(e,t){Kp(e,0,t)}function hh(e,t){const n=new _i(t);Kp(e,1,n)}function _v(e,t){Qn.getMap().set(e,t)}function yv(e,t){const n=Qn.getMap(),r=new _i(t);n.set(e,r)}function Hp(e,t){const n=Qn.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function bv(e,t){return Hp(e,n=>{xt(n)&&t(n)})}function Yp(e,t){return Hp(e,n=>{n instanceof _i&&t(n.toJSON())})}const ps=Ps("modem",["second"],e=>{if(ps.session(e))switch(e.target){case"second":!Gp&&e.data%2===0&&ps.emit(e.player,"modem:join");break;case"join":e.sender!==ps.id()&&ps.reply(e,"joinack",x0(pk(Qn)));break;case"joinack":e.sender!==ps.id()&&(Gp=!0,ap(Qn,Ja(e.data),Qn));break;case"sync":{e.sender!==ps.id()&&w(e.data)&&ap(Qn,Ja(e.data),Qn);break}}});function Vp(e,t){t!==Qn&&ps.emit("","modem:sync",x0(e))}Qn.on("update",Vp),Qn.on("destroy",()=>{Qn.off("update",Vp)});function wv(e,t){return e%t}function xv(e,t){return Math.floor(e/t)}function Ev(e,t){return{x:wv(e,t),y:xv(e,t)}}function cr(e,t){return e.x+e.y*t}function ro(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function fh(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function Xp(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function qp(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Jp="176",kv="",kr="srgb",Zp="srgb-linear",Qp="linear",dh="srgb";function vr(e,t,n){return Math.max(t,Math.min(n,e))}function vv(e,t){return(e%t+t)%t}function ph(e,t,n){return(1-n)*e+n*t}class Xo{constructor(t=0,n=0){Xo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=vr(this.x,t.x,n.x),this.y=vr(this.y,t.y,n.y),this}clampScalar(t,n){return this.x=vr(this.x,t,n),this.y=vr(this.y,t,n),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(vr(r,t,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(vr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qo{constructor(t,n,r,i,s,o,a,c,l){qo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],m=r[8],p=i[0],b=i[3],y=i[6],v=i[1],T=i[4],A=i[7],U=i[2],R=i[5],C=i[8];return s[0]=o*p+a*v+c*U,s[3]=o*b+a*T+c*R,s[6]=o*y+a*A+c*C,s[1]=l*p+u*v+f*U,s[4]=l*b+u*T+f*R,s[7]=l*y+u*A+f*C,s[2]=d*p+h*v+m*U,s[5]=d*b+h*T+m*R,s[8]=d*y+h*A+m*C,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,m=n*f+r*d+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=f*p,t[1]=(i*l-u*r)*p,t[2]=(a*r-i*o)*p,t[3]=d*p,t[4]=(u*n-i*c)*p,t[5]=(i*s-a*n)*p,t[6]=h*p,t[7]=(r*c-l*n)*p,t[8]=(o*n-r*s)*p,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(mh.makeScale(t,n)),this}rotate(t){return this.premultiply(mh.makeRotation(-t)),this}translate(t,n){return this.premultiply(mh.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const mh=new qo,tm=new qo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),em=new qo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Tv(){const e={enabled:!0,workingColorSpace:Zp,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===dh&&(i.r=io(i.r),i.g=io(i.g),i.b=io(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===dh&&(i.r=so(i.r),i.g=so(i.g),i.b=so(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===kv?Qp:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[Zp]:{primaries:t,whitePoint:r,transfer:Qp,toXYZ:tm,fromXYZ:em,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:kr},outputColorSpaceConfig:{drawingBufferColorSpace:kr}},[kr]:{primaries:t,whitePoint:r,transfer:dh,toXYZ:tm,fromXYZ:em,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:kr}}}),e}const Tr=Tv();function io(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function so(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const nm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$i={h:0,s:0,l:0},kc={h:0,s:0,l:0};function gh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class _h{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=kr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Tr.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Tr.workingColorSpace){return this.r=t,this.g=n,this.b=r,Tr.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Tr.workingColorSpace){if(t=vv(t,1),n=vr(n,0,1),r=vr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=gh(o,s,t+1/3),this.g=gh(o,s,t),this.b=gh(o,s,t-1/3)}return Tr.toWorkingColorSpace(this,i),this}setStyle(t,n=kr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=kr){const r=nm[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=io(t.r),this.g=io(t.g),this.b=io(t.b),this}copyLinearToSRGB(t){return this.r=so(t.r),this.g=so(t.g),this.b=so(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=kr){return Tr.fromWorkingColorSpace(_n.copy(this),t),Math.round(vr(_n.r*255,0,255))*65536+Math.round(vr(_n.g*255,0,255))*256+Math.round(vr(_n.b*255,0,255))}getHexString(t=kr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Tr.workingColorSpace){Tr.fromWorkingColorSpace(_n.copy(this),n);const r=_n.r,i=_n.g,s=_n.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=Tr.workingColorSpace){return Tr.fromWorkingColorSpace(_n.copy(this),n),t.r=_n.r,t.g=_n.g,t.b=_n.b,t}getStyle(t=kr){Tr.fromWorkingColorSpace(_n.copy(this),t);const n=_n.r,r=_n.g,i=_n.b;return t!==kr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL($i),this.setHSL($i.h+t,$i.s+n,$i.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL($i),t.getHSL(kc);const r=ph($i.h,kc.h,n),i=ph($i.s,kc.s,n),s=ph($i.l,kc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _n=new _h;_h.NAMES=nm,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Jp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Jp),new Xo,new Xo;function fn(e,t,n){return Math.max(t,Math.min(n,e))}function rm(e){return e/180*Math.PI}function im(e){return e*180/Math.PI}const Av=Ud("089fad0j9awfem09wavefc09uwaef");function Rv(){return Av()}function Sv(e){return Ud(e)()}function lr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Rv()*i)}function sm(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(Sv(e)*s)}function om(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function Iv(e){return e[lr(0,e.length-1)]}function Ov(e,t){return t[sm(e,0,t.length-1)]}function yn(...e){return Iv(e.flat())}function Nv(e,...t){return Ov(e,t.flat())}function Cv(e){return[...new Set(e)].filter(w)}function ms(e){return w(e)&&w(e.x)&&w(e.y)}function De(e,t){switch(t){case pt.NORTH:--e.y;break;case pt.SOUTH:++e.y;break;case pt.WEST:--e.x;break;case pt.EAST:++e.x;break}return e}function Lv(e,t){return e<0?pt.WEST:e>0?pt.EAST:t<0?pt.NORTH:t>0?pt.SOUTH:pt.IDLE}function Ar(e,t){return Lv(t.x-e.x,t.y-e.y)}const yh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Rr(e){return ce(e)&&am(e[0])}function am(e){return w(pt[e])&&_t(e)}function Mv(e){const t=pt[e];return w(t)?t:pt.IDLE}function bh(e){if(_t(e))return yh[It(e)]}function Uv(e){if(Rr(e))return e;if(am(e))return[e];const t=bh(e);if(w(t))return[t]}function cm(e){const t=E.words[e],n=Uv(t);return Rr(n)?[n,e+1]:[void 0,e]}function lm(e){var i,s;const t=[];let[n,r]=cm(e);for(;Rr(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=st(E.words,r,[H.NUMBER,H.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=st(E.words,r,[H.DIR]);t.push(c.destpt.x,c.destpt.y),r=l;break}case"TO":{const[c,l,u]=st(E.words,r,[H.DIR,H.DIR]),f=((i=E.element)==null?void 0:i.x)??0,d=((s=E.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,t.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,r]}const[o,a]=cm(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function Fv(e){return w(e)&&e<Rt.ONBLACK?e:void 0}function Pv(e){return w(e)&&e>Rt.WHITE&&e<Rt.ONCLEAR?e-Rt.ONBLACK:void 0}const Jo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Xr(e){return ce(e)&&hm(e[0])}function um(e){return Xr(e)&&e[0].startsWith("ON")}function hm(e){return w(Rt[e])&&_t(e)}function vc(e){if(_t(e))return Jo[It(e)]}function fm(e){return e.map(t=>Rt[t]).find(t=>w(t)&&t<Rt.ONBLACK)}function dm(e){return e.map(t=>Rt[t]).find(t=>w(t)&&t>=Rt.ONBLACK)}function Bv(e){if(Xr(e))return e;if(hm(e))return[e];const t=vc(e);if(w(t))return[t]}function pm(e){const t=E.words[e],n=Bv(t);return Xr(n)?[n,e+1]:[void 0,e]}function wh(e){const t=[];let n=e;const[r,i]=pm(e);if(Xr(r)&&(t.push(...r),n=i),Xr(t)&&!um(t)){const[s,o]=pm(i);um(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function mm(e){const t={};for(let n=0;n<e.length;++n){const r=e[n],i=Rt[r];w(i)&&(i<Rt.ONBLACK?t.color=i:t.bg=i-Rt.ONBLACK)}return t}function oo(e){return ce(e)&&typeof e[0]=="string"}function $v(e){const t=E.words[e];return _t(t)?[t,e+1]:[void 0,e]}function gm(e){const t=E.words[e];if(oo(t))return[t,e+1];const[n,r]=wh(e),[i,s]=$v(r);return _t(i)?[[i,n],s]:[void 0,e]}function Tc(e){if(!oo(e))return;const[t]=e;return t}function xh(e){if(!oo(e))return;const[,t]=e,n=w(t)?fm(t):void 0;return w(n)?n:void 0}function _m(e){if(!oo(e))return;const[,t]=e,n=w(t)?dm(t):void 0;return w(n)?n:void 0}const Tt=60,Gt=25,Eh=Tt*Gt;var yt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(yt||{});function Zo(e,t){const n=e??jt.ISWALK,r=t??jt.ISWALK;switch(n){case jt.ISWALK:return r!==jt.ISWALK;case jt.ISSWIM:return r!==jt.ISSWIM;case jt.ISSOLID:return!0;case jt.ISBULLET:return r!==jt.ISWALK&&r!==jt.ISSWIM}}function Qo(e,t,n){const r=e==null?void 0:e.objects[n];if(w(r))return r;const i=ta(e,"player");return w(t)?(t.x<0&&(t.x=lr(0,Tt-1)),t.y<0&&(t.y=lr(0,Gt-1)),bm(t,i)):yn(...i)}function ta(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(w)}function Dv(e){const t=[];for(let n=0;n<Gt;++n)for(let r=0;r<Tt;++r){const i={x:r,y:n},s=ne(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Ac(e,t){const n=Tc(t),r=xh(t),i=_m(t);return ta(e,n??"").filter(s=>{var o,a,c;return!(w(n)&&It((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||w(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Rt.WHITE)!==r||w(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Rt.BLACK)!==i)}).filter(w)}function ym(e,t){return w(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(w(i))return i;const s=ta(e,It(n));if(s.length)return s}else if(ms(n)&&n.x>=0&&n.x<Tt&&n.y>=0&&n.y<Gt){const i=n.x+n.y*Tt,s=(r=e.lookup)==null?void 0:r[i];return w(s)?e.objects[s]:e.terrain[i]}}).flat().filter(w):[]}function bm(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var kh;try{kh=new TextDecoder}catch{}var bt,ur,K=0,de={},Qt,Di,hr=0,qr=0,rn,bi,Un=[],Xt,wm={useRecords:!1,mapsAsObjects:!0};class xm{}const Em=new xm;Em.name="MessagePack 0xC1";var ji=!1,km=2,vm;try{new Function("")}catch{km=1/0}class ea{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(bt)return Pm(()=>(Sh(),this?this.unpack(t,n):ea.prototype.unpack.call(wm,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof un<"u"?un.from(t):new Uint8Array(t)),typeof n=="object"?(ur=n.end||t.length,K=n.start||0):(K=0,ur=n>-1?n:t.length),qr=0,Di=null,rn=null,bt=t;try{Xt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw bt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof ea){if(de=this,this.structures)return Qt=this.structures,Rc(n);(!Qt||Qt.length>0)&&(Qt=[])}else de=wm,(!Qt||Qt.length>0)&&(Qt=[]);return Rc(n)}unpackMultiple(t,n){let r,i=0;try{ji=!0;let s=t.length,o=this?this.unpack(t,s):Sc.unpack(t,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Rc(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Rc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{ji=!1,Sh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Rc(e){try{if(!de.trusted&&!ji){let n=Qt.sharedLength||0;n<Qt.length&&(Qt.length=n)}let t;if(de.randomAccessStructure&&bt[K]<64&&bt[K]>=32&&vm?(t=vm(bt,K,ur,de),bt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),K=ur):t=je(),rn&&(K=rn.postBundlePosition,rn=null),ji&&(Qt.restoreStructures=null),K==ur)Qt&&Qt.restoreStructures&&Tm(),Qt=null,bt=null,bi&&(bi=null);else{if(K>ur)throw new Error("Unexpected end of MessagePack data");if(!ji){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Qt&&Qt.restoreStructures&&Tm(),Sh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||K>ur)&&(t.incomplete=!0),t}}function Tm(){for(let e in Qt.restoreStructures)Qt[e]=Qt.restoreStructures[e];Qt.restoreStructures=null}function je(){let e=bt[K++];if(e<160)if(e<128){if(e<64)return e;{let t=Qt[e&63]||de.getStructures&&Rm()[e&63];return t?(t.read||(t.read=vh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,de.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Lm();r==="__proto__"&&(r="__proto_"),t[r]=je()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(je(),je());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=je();return de.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(qr>=K)return Di.slice(K-hr,(K+=t)-hr);if(qr==0&&ur<140){let n=t<16?Ah(t):Om(t);if(n!=null)return n}return Th(t)}else{let t;switch(e){case 192:return null;case 193:return rn?(t=je(),t>0?rn[1].slice(rn.position1,rn.position1+=t):rn[0].slice(rn.position0,rn.position0-=t)):Em;case 194:return!1;case 195:return!0;case 196:if(t=bt[K++],t===void 0)throw new Error("Unexpected end of buffer");return Rh(t);case 197:return t=Xt.getUint16(K),K+=2,Rh(t);case 198:return t=Xt.getUint32(K),K+=4,Rh(t);case 199:return gs(bt[K++]);case 200:return t=Xt.getUint16(K),K+=2,gs(t);case 201:return t=Xt.getUint32(K),K+=4,gs(t);case 202:if(t=Xt.getFloat32(K),de.useFloat32>2){let n=Ih[(bt[K]&127)<<1|bt[K+1]>>7];return K+=4,(n*t+(t>0?.5:-.5)>>0)/n}return K+=4,t;case 203:return t=Xt.getFloat64(K),K+=8,t;case 204:return bt[K++];case 205:return t=Xt.getUint16(K),K+=2,t;case 206:return t=Xt.getUint32(K),K+=4,t;case 207:return de.int64AsType==="number"?(t=Xt.getUint32(K)*4294967296,t+=Xt.getUint32(K+4)):de.int64AsType==="string"?t=Xt.getBigUint64(K).toString():de.int64AsType==="auto"?(t=Xt.getBigUint64(K),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Xt.getBigUint64(K),K+=8,t;case 208:return Xt.getInt8(K++);case 209:return t=Xt.getInt16(K),K+=2,t;case 210:return t=Xt.getInt32(K),K+=4,t;case 211:return de.int64AsType==="number"?(t=Xt.getInt32(K)*4294967296,t+=Xt.getUint32(K+4)):de.int64AsType==="string"?t=Xt.getBigInt64(K).toString():de.int64AsType==="auto"?(t=Xt.getBigInt64(K),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Xt.getBigInt64(K),K+=8,t;case 212:if(t=bt[K++],t==114)return Um(bt[K++]&63);{let n=Un[t];if(n)return n.read?(K++,n.read(je())):n.noBuffer?(K++,n()):n(bt.subarray(K,++K));throw new Error("Unknown extension "+t)}case 213:return t=bt[K],t==114?(K++,Um(bt[K++]&63,bt[K++])):gs(2);case 214:return gs(4);case 215:return gs(8);case 216:return gs(16);case 217:return t=bt[K++],qr>=K?Di.slice(K-hr,(K+=t)-hr):zv(t);case 218:return t=Xt.getUint16(K),K+=2,qr>=K?Di.slice(K-hr,(K+=t)-hr):Wv(t);case 219:return t=Xt.getUint32(K),K+=4,qr>=K?Di.slice(K-hr,(K+=t)-hr):Gv(t);case 220:return t=Xt.getUint16(K),K+=2,Sm(t);case 221:return t=Xt.getUint32(K),K+=4,Sm(t);case 222:return t=Xt.getUint16(K),K+=2,Im(t);case 223:return t=Xt.getUint32(K),K+=4,Im(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const jv=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function vh(e,t){function n(){if(n.count++>km){let i=e.read=new Function("r","return function(){return "+(de.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":jv.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(je);return e.highByte===0&&(e.read=Am(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=je()}return de.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Am(t,n):n}const Am=(e,t)=>function(){let n=bt[K++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Qt[r]||Rm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=vh(i,e)),i.read()};function Rm(){let e=Pm(()=>(bt=null,de.getStructures()));return Qt=de._mergeStructures(e,Qt)}var Th=na,zv=na,Wv=na,Gv=na;function na(e){let t;if(e<16&&(t=Ah(e)))return t;if(e>64&&kh)return kh.decode(bt.subarray(K,K+=e));const n=K+e,r=[];for(t="";K<n;){const i=bt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=bt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=bt[K++]&63,o=bt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=bt[K++]&63,o=bt[K++]&63,a=bt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=sn.apply(String,r),r.length=0)}return r.length>0&&(t+=sn.apply(String,r)),t}function Sm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=je();return de.freezeData?Object.freeze(t):t}function Im(e){if(de.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Lm();r==="__proto__"&&(r="__proto_"),t[r]=je()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(je(),je());return t}}var sn=String.fromCharCode;function Om(e){let t=K,n=new Array(e);for(let r=0;r<e;r++){const i=bt[K++];if((i&128)>0){K=t;return}n[r]=i}return sn.apply(String,n)}function Ah(e){if(e<4)if(e<2){if(e===0)return"";{let t=bt[K++];if((t&128)>1){K-=1;return}return sn(t)}}else{let t=bt[K++],n=bt[K++];if((t&128)>0||(n&128)>0){K-=2;return}if(e<3)return sn(t,n);let r=bt[K++];if((r&128)>0){K-=3;return}return sn(t,n,r)}else{let t=bt[K++],n=bt[K++],r=bt[K++],i=bt[K++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(e<6){if(e===4)return sn(t,n,r,i);{let s=bt[K++];if((s&128)>0){K-=5;return}return sn(t,n,r,i,s)}}else if(e<8){let s=bt[K++],o=bt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(e<7)return sn(t,n,r,i,s,o);let a=bt[K++];if((a&128)>0){K-=7;return}return sn(t,n,r,i,s,o,a)}else{let s=bt[K++],o=bt[K++],a=bt[K++],c=bt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(e<10){if(e===8)return sn(t,n,r,i,s,o,a,c);{let l=bt[K++];if((l&128)>0){K-=9;return}return sn(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=bt[K++],u=bt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(e<11)return sn(t,n,r,i,s,o,a,c,l,u);let f=bt[K++];if((f&128)>0){K-=11;return}return sn(t,n,r,i,s,o,a,c,l,u,f)}else{let l=bt[K++],u=bt[K++],f=bt[K++],d=bt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(e<14){if(e===12)return sn(t,n,r,i,s,o,a,c,l,u,f,d);{let h=bt[K++];if((h&128)>0){K-=13;return}return sn(t,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=bt[K++],m=bt[K++];if((h&128)>0||(m&128)>0){K-=14;return}if(e<15)return sn(t,n,r,i,s,o,a,c,l,u,f,d,h,m);let p=bt[K++];if((p&128)>0){K-=15;return}return sn(t,n,r,i,s,o,a,c,l,u,f,d,h,m,p)}}}}}function Nm(){let e=bt[K++],t;if(e<192)t=e-160;else switch(e){case 217:t=bt[K++];break;case 218:t=Xt.getUint16(K),K+=2;break;case 219:t=Xt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return na(t)}function Rh(e){return de.copyBuffers?Uint8Array.prototype.slice.call(bt,K,K+=e):bt.subarray(K,K+=e)}function gs(e){let t=bt[K++];if(Un[t]){let n;return Un[t](bt.subarray(K,n=K+=e),r=>{K=r;try{return je()}finally{K=n}})}else throw new Error("Unknown extension type "+t)}var Cm=new Array(4096);function Lm(){let e=bt[K++];if(e>=160&&e<192){if(e=e-160,qr>=K)return Di.slice(K-hr,(K+=e)-hr);if(!(qr==0&&ur<180))return Th(e)}else return K--,Mm(je());let t=(e<<5^(e>1?Xt.getUint16(K):e>0?bt[K]:0))&4095,n=Cm[t],r=K,i=K+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Xt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=bt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],Cm[t]=n,n.bytes=e;r<i;)s=Xt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=bt[r++],n.push(s);let a=e<16?Ah(e):Om(e);return a!=null?n.string=a:n.string=Th(e)}function Mm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const Um=(e,t)=>{let n=je().map(Mm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Qt[e];return i&&(i.isShared||ji)&&((Qt.restoreStructures||(Qt.restoreStructures=[]))[e]=i),Qt[e]=n,n.read=vh(n,r),n.read()};Un[0]=()=>{},Un[0].noBuffer=!0,Un[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let Kv={Error,TypeError,ReferenceError};Un[101]=()=>{let e=je();return(Kv[e[0]]||Error)(e[1],{cause:e[2]})},Un[105]=e=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Xt.getUint32(K-4);bi||(bi=new Map);let n=bt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};bi.set(t,i);let s=je();return i.used?Object.assign(r,s):(i.target=s,s)},Un[112]=e=>{if(de.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Xt.getUint32(K-4),n=bi.get(t);return n.used=!0,n.target},Un[115]=()=>new Set(je());const Fm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let Hv=typeof globalThis=="object"?globalThis:window;Un[116]=e=>{let t=e[0],n=Fm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new Hv[n](Uint8Array.prototype.slice.call(e,1).buffer)},Un[120]=()=>{let e=je();return new RegExp(e[0],e[1])};const Yv=[];Un[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=K;return K+=t-e.length,rn=Yv,rn=[Nm(),Nm()],rn.position0=0,rn.position1=0,rn.postBundlePosition=K,K=n,je()},Un[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Pm(e){let t=ur,n=K,r=hr,i=qr,s=Di,o=bi,a=rn,c=new Uint8Array(bt.slice(0,ur)),l=Qt,u=Qt.slice(0,Qt.length),f=de,d=ji,h=e();return ur=t,K=n,hr=r,qr=i,Di=s,bi=o,rn=a,bt=c,ji=d,Qt=l,Qt.splice(0,Qt.length,...u),de=f,Xt=new DataView(bt.buffer,bt.byteOffset,bt.byteLength),h}function Sh(){bt=null,bi=null,Qt=null}const Ih=new Array(147);for(let e=0;e<256;e++)Ih[e]=+("1e"+Math.floor(45.15-e*.30103));var Sc=new ea({useRecords:!1});const Vv=Sc.unpack;Sc.unpackMultiple,Sc.unpack;let Xv=new Float32Array(1);new Uint8Array(Xv.buffer,0,4);let Ic;try{Ic=new TextEncoder}catch{}let Oh,Bm;const Oc=typeof un<"u",Nc=Oc?function(e){return un.allocUnsafeSlow(e)}:Uint8Array,$m=Oc?un:Uint8Array,Dm=Oc?4294967296:2144337920;let J,ra,pe,Y=0,vn,Ne=null,qv;const Jv=21760,Zv=/[\u0080-\uFFFF]/,ao=Symbol("record-id");class Qv extends ea{constructor(t){super(t),this.offset=0;let n,r,i,s,o=$m.prototype.utf8Write?function(I,x){return J.utf8Write(I,x,J.byteLength-x)}:Ic&&Ic.encodeInto?function(I,x){return Ic.encodeInto(I,J.subarray(x)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,m=u+f+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],b=0,y=0;this.pack=this.encode=function(I,x){if(J||(J=new Nc(8192),pe=J.dataView||(J.dataView=new DataView(J.buffer,0,8192)),Y=0),vn=J.length-10,vn-Y<2048?(J=new Nc(J.length),pe=J.dataView||(J.dataView=new DataView(J.buffer,0,J.length)),vn=J.length-10,Y=0):Y=Y+7&2147483640,n=Y,x&oT&&(Y+=x&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof I!="string"?(Ne=[],Ne.size=1/0):Ne=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let $=i.sharedLength||0;if($>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let P=0;P<$;P++){let it=i[P];if(!it)continue;let Q,rt=i.transitions;for(let z=0,B=it.length;z<B;z++){let ht=it[z];Q=rt[ht],Q||(Q=rt[ht]=Object.create(null)),rt=Q}rt[ao]=P+64}this.lastNamedStructuresLength=$}c||(i.nextId=$+64)}r&&(r=!1);let N;try{a.randomAccessStructure&&I&&I.constructor&&I.constructor===Object?L(I):A(I);let $=Ne;if(Ne&&Wm(n,A,0),s&&s.idsToInsert){let P=s.idsToInsert.sort((z,B)=>z.offset>B.offset?1:-1),it=P.length,Q=-1;for(;$&&it>0;){let z=P[--it].offset+n;z<$.stringsPosition+n&&Q===-1&&(Q=0),z>$.position+n?Q>=0&&(Q+=6):(Q>=0&&(pe.setUint32($.position+n,pe.getUint32($.position+n)+Q),Q=-1),$=$.previous,it++)}Q>=0&&$&&pe.setUint32($.position+n,pe.getUint32($.position+n)+Q),Y+=P.length*6,Y>vn&&O(Y),a.offset=Y;let rt=eT(J.subarray(n,Y),P);return s=null,rt}return a.offset=Y,x&iT?(J.start=n,J.end=Y,J):J.subarray(n,Y)}catch($){throw N=$,$}finally{if(i&&(v(),r&&a.saveStructures)){let $=i.sharedLength||0,P=J.subarray(n,Y),it=nT(i,a);if(!N)return a.saveStructures(it,it.isCompatible)===!1?a.pack(I,x):(a.lastNamedStructuresLength=$,J.length>1073741824&&(J=null),P)}J.length>1073741824&&(J=null),x&sT&&(Y=n)}};const v=()=>{y<10&&y++;let I=i.sharedLength||0;if(i.length>I&&!c&&(i.length=I),b>1e4)i.transitions=null,y=0,b=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let x=0,N=p.length;x<N;x++)p[x][ao]=0;p=[]}},T=I=>{var x=I.length;x<16?J[Y++]=144|x:x<65536?(J[Y++]=220,J[Y++]=x>>8,J[Y++]=x&255):(J[Y++]=221,pe.setUint32(Y,x),Y+=4);for(let N=0;N<x;N++)A(I[N])},A=I=>{Y>vn&&(J=O(Y));var x=typeof I,N;if(x==="string"){let $=I.length;if(Ne&&$>=4&&$<4096){if((Ne.size+=$)>Jv){let rt,z=(Ne[0]?Ne[0].length*3+Ne[1].length:0)+10;Y+z>vn&&(J=O(Y+z));let B;Ne.position?(B=Ne,J[Y]=200,Y+=3,J[Y++]=98,rt=Y-n,Y+=4,Wm(n,A,0),pe.setUint16(rt+n-3,Y-n-rt)):(J[Y++]=214,J[Y++]=98,rt=Y-n,Y+=4),Ne=["",""],Ne.previous=B,Ne.size=0,Ne.position=rt}let Q=Zv.test(I);Ne[Q?0:1]+=I,J[Y++]=193,A(Q?-$:$);return}let P;$<32?P=1:$<256?P=2:$<65536?P=3:P=5;let it=$*3;if(Y+it>vn&&(J=O(Y+it)),$<64||!o){let Q,rt,z,B=Y+P;for(Q=0;Q<$;Q++)rt=I.charCodeAt(Q),rt<128?J[B++]=rt:rt<2048?(J[B++]=rt>>6|192,J[B++]=rt&63|128):(rt&64512)===55296&&((z=I.charCodeAt(Q+1))&64512)===56320?(rt=65536+((rt&1023)<<10)+(z&1023),Q++,J[B++]=rt>>18|240,J[B++]=rt>>12&63|128,J[B++]=rt>>6&63|128,J[B++]=rt&63|128):(J[B++]=rt>>12|224,J[B++]=rt>>6&63|128,J[B++]=rt&63|128);N=B-Y-P}else N=o(I,Y+P);N<32?J[Y++]=160|N:N<256?(P<2&&J.copyWithin(Y+2,Y+1,Y+1+N),J[Y++]=217,J[Y++]=N):N<65536?(P<3&&J.copyWithin(Y+3,Y+2,Y+2+N),J[Y++]=218,J[Y++]=N>>8,J[Y++]=N&255):(P<5&&J.copyWithin(Y+5,Y+3,Y+3+N),J[Y++]=219,pe.setUint32(Y,N),Y+=4),Y+=N}else if(x==="number")if(I>>>0===I)I<32||I<128&&this.useRecords===!1||I<64&&!this.randomAccessStructure?J[Y++]=I:I<256?(J[Y++]=204,J[Y++]=I):I<65536?(J[Y++]=205,J[Y++]=I>>8,J[Y++]=I&255):(J[Y++]=206,pe.setUint32(Y,I),Y+=4);else if(I>>0===I)I>=-32?J[Y++]=256+I:I>=-128?(J[Y++]=208,J[Y++]=I+256):I>=-32768?(J[Y++]=209,pe.setInt16(Y,I),Y+=2):(J[Y++]=210,pe.setInt32(Y,I),Y+=4);else{let $;if(($=this.useFloat32)>0&&I<4294967296&&I>=-2147483648){J[Y++]=202,pe.setFloat32(Y,I);let P;if($<4||(P=I*Ih[(J[Y]&127)<<1|J[Y+1]>>7])>>0===P){Y+=4;return}else Y--}J[Y++]=203,pe.setFloat64(Y,I),Y+=8}else if(x==="object"||x==="function")if(!I)J[Y++]=192;else{if(s){let P=s.get(I);if(P){if(!P.id){let it=s.idsToInsert||(s.idsToInsert=[]);P.id=it.push(P)}J[Y++]=214,J[Y++]=112,pe.setUint32(Y,P.id),Y+=4;return}else s.set(I,{offset:Y-n})}let $=I.constructor;if($===Object)j(I);else if($===Array)T(I);else if($===Map)if(this.mapAsEmptyObject)J[Y++]=128;else{N=I.size,N<16?J[Y++]=128|N:N<65536?(J[Y++]=222,J[Y++]=N>>8,J[Y++]=N&255):(J[Y++]=223,pe.setUint32(Y,N),Y+=4);for(let[P,it]of I)A(P),A(it)}else{for(let P=0,it=Oh.length;P<it;P++){let Q=Bm[P];if(I instanceof Q){let rt=Oh[P];if(rt.write){rt.type&&(J[Y++]=212,J[Y++]=rt.type,J[Y++]=0);let lt=rt.write.call(this,I);lt===I?Array.isArray(I)?T(I):j(I):A(lt);return}let z=J,B=pe,ht=Y;J=null;let ct;try{ct=rt.pack.call(this,I,lt=>(J=z,z=null,Y+=lt,Y>vn&&O(Y),{target:J,targetView:pe,position:Y-lt}),A)}finally{z&&(J=z,pe=B,Y=ht,vn=J.length-10)}ct&&(ct.length+Y>vn&&O(ct.length+Y),Y=tT(ct,J,Y,rt.type));return}}if(Array.isArray(I))T(I);else{if(I.toJSON){const P=I.toJSON();if(P!==I)return A(P)}if(x==="function")return A(this.writeFunction&&this.writeFunction(I));j(I)}}}else if(x==="boolean")J[Y++]=I?195:194;else if(x==="bigint"){if(I<BigInt(1)<<BigInt(63)&&I>=-(BigInt(1)<<BigInt(63)))J[Y++]=211,pe.setBigInt64(Y,I);else if(I<BigInt(1)<<BigInt(64)&&I>0)J[Y++]=207,pe.setBigUint64(Y,I);else if(this.largeBigIntToFloat)J[Y++]=203,pe.setFloat64(Y,Number(I));else{if(this.largeBigIntToString)return A(I.toString());if(this.useBigIntExtension&&I<BigInt(2)**BigInt(1023)&&I>-(BigInt(2)**BigInt(1023))){J[Y++]=199,Y++,J[Y++]=66;let $=[],P;do{let it=I&BigInt(255);P=(it&BigInt(128))===(I<BigInt(0)?BigInt(128):BigInt(0)),$.push(it),I>>=BigInt(8)}while(!((I===BigInt(0)||I===BigInt(-1))&&P));J[Y-2]=$.length;for(let it=$.length;it>0;)J[Y++]=Number($[--it]);return}else throw new RangeError(I+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Y+=8}else if(x==="undefined")this.encodeUndefinedAsNil?J[Y++]=192:(J[Y++]=212,J[Y++]=0,J[Y++]=0);else throw new Error("Unknown type: "+x)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?I=>{let x;if(this.skipValues){x=[];for(let P in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(P))&&!this.skipValues.includes(I[P])&&x.push(P)}else x=Object.keys(I);let N=x.length;N<16?J[Y++]=128|N:N<65536?(J[Y++]=222,J[Y++]=N>>8,J[Y++]=N&255):(J[Y++]=223,pe.setUint32(Y,N),Y+=4);let $;if(this.coercibleKeyAsNumber)for(let P=0;P<N;P++){$=x[P];let it=Number($);A(isNaN(it)?$:it),A(I[$])}else for(let P=0;P<N;P++)A($=x[P]),A(I[$])}:I=>{J[Y++]=222;let x=Y-n;Y+=2;let N=0;for(let $ in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty($))&&(A($),A(I[$]),N++);if(N>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');J[x+++n]=N>>8,J[x+n]=N&255},R=this.useRecords===!1?U:t.progressiveRecords&&!d?I=>{let x,N=i.transitions||(i.transitions=Object.create(null)),$=Y++-n,P;for(let it in I)if(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(it)){if(x=N[it],x)N=x;else{let Q=Object.keys(I),rt=N;N=i.transitions;let z=0;for(let B=0,ht=Q.length;B<ht;B++){let ct=Q[B];x=N[ct],x||(x=N[ct]=Object.create(null),z++),N=x}$+n+1==Y?(Y--,W(N,Q,z)):q(N,Q,$,z),P=!0,N=rt[it]}A(I[it])}if(!P){let it=N[ao];it?J[$+n]=it:q(N,Object.keys(I),$,0)}}:I=>{let x,N=i.transitions||(i.transitions=Object.create(null)),$=0;for(let it in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(it))&&(x=N[it],x||(x=N[it]=Object.create(null),$++),N=x);let P=N[ao];P?P>=96&&d?(J[Y++]=((P-=96)&31)+96,J[Y++]=P>>5):J[Y++]=P:W(N,N.__keys__||Object.keys(I),$);for(let it in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(it))&&A(I[it])},C=typeof this.useRecords=="function"&&this.useRecords,j=C?I=>{C(I)?R(I):U(I)}:R,O=I=>{let x;if(I>16777216){if(I-n>Dm)throw new Error("Packed buffer would be larger than maximum buffer size");x=Math.min(Dm,Math.round(Math.max((I-n)*(I>67108864?1.25:2),4194304)/4096)*4096)}else x=(Math.max(I-n<<2,J.length-1)>>12)+1<<12;let N=new Nc(x);return pe=N.dataView||(N.dataView=new DataView(N.buffer,0,x)),I=Math.min(I,J.length),J.copy?J.copy(N,0,n,I):N.set(J.slice(n,I)),Y-=n,n=0,vn=N.length-10,J=N},W=(I,x,N)=>{let $=i.nextId;$||($=64),$<h&&this.shouldShareStructure&&!this.shouldShareStructure(x)?($=i.nextOwnId,$<m||($=h),i.nextOwnId=$+1):($>=m&&($=h),i.nextId=$+1);let P=x.highByte=$>=96&&d?$-96>>5:-1;I[ao]=$,I.__keys__=x,i[$-64]=x,$<h?(x.isShared=!0,i.sharedLength=$-63,r=!0,P>=0?(J[Y++]=($&31)+96,J[Y++]=P):J[Y++]=$):(P>=0?(J[Y++]=213,J[Y++]=114,J[Y++]=($&31)+96,J[Y++]=P):(J[Y++]=212,J[Y++]=114,J[Y++]=$),N&&(b+=y*N),p.length>=f&&(p.shift()[ao]=0),p.push(I),A(x))},q=(I,x,N,$)=>{let P=J,it=Y,Q=vn,rt=n;J=ra,Y=0,n=0,J||(ra=J=new Nc(8192)),vn=J.length-10,W(I,x,$),ra=J;let z=Y;if(J=P,Y=it,vn=Q,n=rt,z>1){let B=Y+z-1;B>vn&&O(B);let ht=N+n;J.copyWithin(ht+z,ht+1,Y),J.set(ra.slice(0,z),ht),Y=B}else J[N+n]=ra[0]},L=I=>{let x=qv(I,J,n,Y,i,O,(N,$,P)=>{if(P)return r=!0;Y=$;let it=J;return A(N),v(),it!==J?{position:Y,targetView:pe,target:J}:Y},this);if(x===0)return j(I);Y=x}}useBuffer(t){J=t,J.dataView||(J.dataView=new DataView(J.buffer,J.byteOffset,J.byteLength)),Y=0}set position(t){Y=t}get position(){return Y}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Bm=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,xm],Oh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?jm(e,16,t):zm(Oc?un.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==$m&&this.moreTypes?jm(e,Fm.indexOf(n.name),t):zm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function jm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function zm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function tT(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function eT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Wm(e,t,n){if(Ne.length>0){pe.setUint32(Ne.position+e,Y+n-Ne.position-e),Ne.stringsPosition=Y-e;let r=Ne;Ne=null,t(r[0]),t(r[1])}}function nT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Gm=new Qv({useRecords:!1});const rT=Gm.pack;Gm.pack;const iT=512,sT=1024,oT=2048,et=Ps("SOFTWARE");function ke(){return null}function co(e,t,n={}){if(!w(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];w(c)&&(a=c(a));const l=t[o];w(l)&&(o=l),a!==null&&r.push(o,a)}return r}function ia(e,t,n={}){if(w(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];w(a)&&(s=a);const c=n[s];w(c)&&(o=c(o)),r[s]=o}return r}catch(r){he(et,"","binary",r.message)}}function aT(e){try{const t=wr(e);return rT(t)}catch(t){he(et,"","binary",t.message)}}function cT(e){try{return Vv(e)}catch(t){he(et,"","binary",t.message)}}function Km(){return{id:Be()}}var Cc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e))(Cc||{});function Lc(e){return w(e==null?void 0:e.id)?co(e,Cc,{category:ke,kinddata:ke,stopped:ke,removed:ke,bucket:ke}):co(e,Cc,{id:ke,x:ke,y:ke,lx:ke,ly:ke,code:ke,category:ke,kinddata:ke,stopped:ke,removed:ke,bucket:ke})}function Mc(e){return ia(e,Cc)}function ze(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function sa(e,t){if(!w(e)||!Xr(t))return;const{color:n,bg:r}=mm(t);w(n)&&(e.color=n),w(r)&&(e.bg=r)}function Sr(e){var t;return It((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function ve(e){var o;if(!w(e)||w(e.lookup)&&w(e.named))return;const t=new Array(Tt*Gt).fill(void 0),n={},r=Object.values(e.objects);for(let a=0;a<r.length;++a){const c=r[a];if(w(c.x)&&w(c.y)&&w(c.id)&&!w(c.removed)){c.category=Ln.ISOBJECT,t[c.x+c.y*Tt]=c.id;const l=It(c.name??((o=c.kinddata)==null?void 0:o.name)??"");n[l]||(n[l]=new Set),n[l].add(c.id)}}let i=0,s=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(w(c)){c.x=i,c.y=s,c.category=Ln.ISTERRAIN;const l=Sr(c);n[l]||(n[l]=new Set),n[l].add(a)}++i,i>=Tt&&(i=0,++s)}e.lookup=t,e.named=n}function oa(e){w(e)&&(delete e.named,delete e.lookup,ve(e))}function Hm(e,t,n){var i;if(!w(e)||!w(e.named)||!w(t))return;const r=It(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[r]||(e.named[r]=new Set),e.named[r].add((t==null?void 0:t.id)??n??"")}function lT(e,t){if(!(!w(e)||!w(e.lookup)||!w(t==null?void 0:t.id))&&!w(t.removed)){const n=t.x??0,r=t.y??0;e.lookup[n+r*Tt]=t.id}}function uT(e,t){var n;if(w(e)&&w(t==null?void 0:t.x)&&w(t.y)){const r=Sr(t),i=$r(e,t);w((n=e.named)==null?void 0:n[r])&&e.named[r].delete(i)}}function Nh(e,t){var n;if(w(e)&&w(t==null?void 0:t.id)){if(w(e.lookup)&&w(t.x)&&w(t.y)){const i=t.x+t.y*Tt;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const r=Sr(t);w((n=e.named)==null?void 0:n[r])&&w(t.id)&&e.named[r].delete(t.id)}}var Ym={exports:{}},Ch={exports:{}},Vm;function hT(){return Vm||(Vm=1,function(e,t){(function(n,r){e.exports=r()})(Nn,function(){function n(p){return!isNaN(parseFloat(p))&&isFinite(p)}function r(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(p){if(p)for(var b=0;b<u.length;b++)p[u[b]]!==void 0&&this["set"+r(u[b])](p[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof f)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new f(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",b=this.getLineNumber()||"",y=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+b+":"+y+")":"[eval]:"+b+":"+y:v?v+" ("+p+":"+b+":"+y+")":p+":"+b+":"+y}},f.fromString=function(b){var y=b.indexOf("("),v=b.lastIndexOf(")"),T=b.substring(0,y),A=b.substring(y+1,v).split(","),U=b.substring(v+1);if(U.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),C=R[1],j=R[2],O=R[3];return new f({functionName:T,args:A||void 0,fileName:C,lineNumber:j||void 0,columnNumber:O||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(p){return function(b){this[p]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(p){return function(b){if(!n(b))throw new TypeError(p+" must be a Number");this[p]=Number(b)}}(o[h]);for(var m=0;m<a.length;m++)f.prototype["get"+r(a[m])]=i(a[m]),f.prototype["set"+r(a[m])]=function(p){return function(b){this[p]=String(b)}}(a[m]);return f})}(Ch)),Ch.exports}(function(e,t){(function(n,r){e.exports=r(hT())})(Nn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),m=d&&f||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new r({functionName:m,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Ym);var fT=Ym.exports,dT=Us(fT);const Lh=14,Uc=3,zi=8,Wi=14,Fc=16,pT=16,mT=16;var Pc=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(Pc||{});function aa(e,t){return new Array(e).fill(t)}function gT(e,t,n,r,i,s=0){const o=r*i;return{id:`tiles:${e}:${t}`,type:1,tag:n,width:r,height:i,char:aa(o,0),color:aa(o,0),bg:aa(o,s),wall:aa(o,0)}}function _T(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Rt.ONCLEAR}}function yT(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function bT(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:aa(s,i)}}function wT(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function xT(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Xm(e,t){return`${e}:${t}`}const ET=1,kT=16,vT=256;var Tn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Tn||{});const Jr=!!JSON.parse("false"),TT=!!JSON.parse("false");JSON.parse("false");const qm=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const wi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return zi*wi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Wi*wi.DRAW_CHAR_SCALE}};function xi(e){const t={},n={tick(){},everytick(){},listcommands(){return Xn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Te(e){return`${e??""}`}function ca(e,t){const n=parseFloat(Te(e));return isNaN(n)?t:n}function Jm(e,t,n){var i;const[r]=st(t,0,[H.MAYBE_NAME]);nx(et,e,((i=E.board)==null?void 0:i.id)??"",r??"",n)}function Fn(e,t,n,r){const[i,s]=st(r,0,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);qd(et,e,t,n,i,s)}const AT=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Zm(e,t,n){const[r,i]=st(n,0,[H.NUMBER_OR_STRING]);if(xt(r))pu(et,e,t,"volume",r);else if(AT.includes(It(r))){const[s,o]=st(n,i,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);qd(et,e,t,r,s,o)}else{const[s]=st(n,i,[H.MAYBE_NUMBER_OR_STRING]);if(xt(s)){const o=n.length-i,a=new Array(o).fill(H.NUMBER),c=st(n,i,a).slice(0,o),l=c.length===1?c[0]:c;pu(et,e,t,r,l)}else{const[o]=st(n,i,[H.MAYBE_NUMBER_OR_STRING]);pu(et,e,t,r,o)}}}let Qm="en-US-GuyNeural";const Mh=xi().command("talk",(e,t)=>{const[n]=st(t,0,[H.ANY]);switch(It(n)){default:Pw(et,E.elementfocus);break;case"stop":Bw(et,E.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=st(t,0,[H.ANY]);switch(It(n)){default:$w(et,E.elementfocus);break;case"stop":Dw(et,E.elementfocus);break}return 0}).command("tts",(e,t)=>{const n=t.map(Te).join("");return ex(et,E.elementfocus,Qm,n),0}).command("ttsvoice",(e,t)=>(Qm=t.map(Te).join(""),0)).command("bpm",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return ix(et,E.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return sx(et,E.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return ox(et,E.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return ax(et,E.elementfocus,n),0}).command("play",(e,t)=>(Jm(E.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(Jm(E.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)Zm(E.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Fn(E.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Fn(E.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Fn(E.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Fn(E.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Fn(E.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Fn(E.elementfocus,n,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let n=0;n<3;++n)Fn(E.elementfocus,n,"autowah",t);return 0});for(let e=0;e<8;++e)Mh.command(`synth${e+1}`,(t,n)=>(Zm(E.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Mh.command(`echo${t}`,(n,r)=>(Fn(E.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Fn(E.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Fn(E.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Fn(E.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Fn(E.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Fn(E.elementfocus,e,"vibrato",r),0)).command(`autowah${t}`,(n,r)=>(Fn(E.elementfocus,e,"autowah",r),0))}function Uh(e,t,n,r=!1){if(!w(e)||!w(e.lookup)||n.x<0||n.x>=Tt||n.y<0||n.y>=Gt)return!0;const i=n.x+n.y*Tt,s=On(e,e.lookup[i]??"404");if(w(s))return!(r&&mn(s.id));const o=e.terrain[i];return w(o)?Zo(t,Ht(o,"collision")):!1}function RT(e,t,n){const r=On(e,(t==null?void 0:t.id)??""),i=(r==null?void 0:r.x)??-1,s=(r==null?void 0:r.y)??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=Ht(r,"collision");return Uh(e,o,n)}function Fh(e,t,n){var d;const r=On(e,(t==null?void 0:t.id)??"");if(!w(e)||!w(r)||!w(r.x)||!w(r.y)||!w(e.lookup)||n.x<0||n.x>=Tt||n.y<0||n.y>=Gt)return{name:"edge",kind:"edge",collision:jt.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=$r(e,r),s=$r(e,n),o=Ht(r,"collision"),a=mn(r==null?void 0:r.id),c=Ht(r,"collision")===jt.ISBULLET,l=On(e,e.lookup[s]??""),u=mn((l==null?void 0:l.id)??"");if(w(l)&&(!a||!u)){const h=Ht(r,"group"),m=Ht(l,"group");if((h||m)&&h!=m)return{...l};const p=!!Ht(l,"item");if(a&&p)return r.x=n.x,r.y=n.y,{...l};const b=!!Ht(l,"breakable");if(c&&b)return r.x=n.x,r.y=n.y,{...l};if(o===jt.ISBULLET)return{...l};if(!!Ht(l,"pushable")){const v=Ar({x:r.x,y:r.y},n),T=De({x:l.x??0,y:l.y??0},v),A=Fh(e,l,T);if(w(A))return{...l}}else return{...l}}const f=e.terrain[s];if(w(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??jt.ISWALK;if(Zo(o,h))return{...f,x:n.x,y:n.y}}r.x=n.x,r.y=n.y,w(r.removed)||(e.lookup[i]=void 0,e.lookup[s]=r.id??"")}function ST(e,t){const n=[];if(!w(e))return n;const r=Object.values(e.objects);for(let i=0;i<r.length;++i){const s=r[i];w(s.id)&&w(s.removed)&&t-s.removed>Ha*5&&(n.push(s.id),A1(e,s.id))}return n}function IT(e,t){const n=[];if(!w(e))return n;e.lookup=void 0,ve(e);const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const o=r[s];if(!w(o.id))continue;o.lx=o.x,o.ly=o.y;const a=li(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=Ht(o,"cycle");if(l>u)continue}n.push({id:o.id,type:yt.OBJECT,code:c,object:o,terrain:void 0})}}const i=ST(e,t);for(let s=0;s<i.length;++s)n.push({id:i[s],type:yt.ERROR,code:"",object:void 0,terrain:void 0});return n}function tg(e,t,n){const r=[],i=[];if(!w(e))return{objectelements:r,terrainelements:i};function s(a,c){switch(n){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=Ht(a,n);return w(l)||Sr(a)===n||Ht(a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&r.push(c)}for(let a=0;a<Eh;++a){const c=e.terrain[a];w(c)&&s(c,!0)&&i.push(c)}return{objectelements:r,terrainelements:i}}function eg(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function ng(e){const t=Math.floor(e.length/Uc);if(t*Uc!==e.length)return;const n=eg(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function OT(e,t){return e&1<<t?255:0}function rg(e){const t=Math.floor(e.length/Lh);if(t*Lh!==e.length)return;const n=Math.ceil(t/Fc),r=zi*Fc,i=eg(r,Wi*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*Wi+a,u=e[c];for(let f=0;f<zi;++f){const d=s*zi+f;i.bits[d+l*r]=OT(u,7-f)}++a,a===Wi&&(a=0,++s,s===Fc&&(s=0,++o))}return i}const NT=Ja("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),CT=Ja("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ig=typeof js=="object"&&js&&js.Object===Object&&js,LT=typeof self=="object"&&self&&self.Object===Object&&self,Zr=ig||LT||Function("return this")(),fr=Zr.Symbol,sg=Object.prototype,MT=sg.hasOwnProperty,UT=sg.toString,la=fr?fr.toStringTag:void 0;function FT(e){var t=MT.call(e,la),n=e[la];try{e[la]=void 0;var r=!0}catch{}var i=UT.call(e);return r&&(t?e[la]=n:delete e[la]),i}var PT=Object.prototype,BT=PT.toString;function $T(e){return BT.call(e)}var DT="[object Null]",jT="[object Undefined]",og=fr?fr.toStringTag:void 0;function Gi(e){return e==null?e===void 0?jT:DT:og&&og in Object(e)?FT(e):$T(e)}function Ir(e){return e!=null&&typeof e=="object"}var zT="[object Symbol]";function Bc(e){return typeof e=="symbol"||Ir(e)&&Gi(e)==zT}function $c(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var re=Array.isArray,WT=1/0,ag=fr?fr.prototype:void 0,cg=ag?ag.toString:void 0;function lg(e){if(typeof e=="string")return e;if(re(e))return $c(e,lg)+"";if(Bc(e))return cg?cg.call(e):"";var t=e+"";return t=="0"&&1/e==-WT?"-0":t}var GT=/\s/;function KT(e){for(var t=e.length;t--&&GT.test(e.charAt(t)););return t}var HT=/^\s+/;function YT(e){return e&&e.slice(0,KT(e)+1).replace(HT,"")}function dr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var ug=NaN,VT=/^[-+]0x[0-9a-f]+$/i,XT=/^0b[01]+$/i,qT=/^0o[0-7]+$/i,JT=parseInt;function ZT(e){if(typeof e=="number")return e;if(Bc(e))return ug;if(dr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=dr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=YT(e);var n=XT.test(e);return n||qT.test(e)?JT(e.slice(2),n?2:8):VT.test(e)?ug:+e}var hg=1/0,QT=17976931348623157e292;function tA(e){if(!e)return e===0?e:0;if(e=ZT(e),e===hg||e===-hg){var t=e<0?-1:1;return t*QT}return e===e?e:0}function Dc(e){var t=tA(e),n=t%1;return t===t?n?t-n:t:0}function lo(e){return e}var eA="[object AsyncFunction]",nA="[object Function]",rA="[object GeneratorFunction]",iA="[object Proxy]";function Ei(e){if(!dr(e))return!1;var t=Gi(e);return t==nA||t==rA||t==eA||t==iA}var Ph=Zr["__core-js_shared__"],fg=function(){var e=/[^.]+$/.exec(Ph&&Ph.keys&&Ph.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function sA(e){return!!fg&&fg in e}var oA=Function.prototype,aA=oA.toString;function _s(e){if(e!=null){try{return aA.call(e)}catch{}try{return e+""}catch{}}return""}var cA=/[\\^$.*+?()[\]{}|]/g,lA=/^\[object .+?Constructor\]$/,uA=Function.prototype,hA=Object.prototype,fA=uA.toString,dA=hA.hasOwnProperty,pA=RegExp("^"+fA.call(dA).replace(cA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mA(e){if(!dr(e)||sA(e))return!1;var t=Ei(e)?pA:lA;return t.test(_s(e))}function gA(e,t){return e==null?void 0:e[t]}function ys(e,t){var n=gA(e,t);return mA(n)?n:void 0}var Bh=ys(Zr,"WeakMap"),dg=Object.create,_A=function(){function e(){}return function(t){if(!dr(t))return{};if(dg)return dg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function yA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function qe(){}function bA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var wA=800,xA=16,EA=Date.now;function kA(e){var t=0,n=0;return function(){var r=EA(),i=xA-(r-n);if(n=r,i>0){if(++t>=wA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function vA(e){return function(){return e}}var jc=function(){try{var e=ys(Object,"defineProperty");return e({},"",{}),e}catch{}}(),TA=jc?function(e,t){return jc(e,"toString",{configurable:!0,enumerable:!1,value:vA(t),writable:!0})}:lo,AA=kA(TA);function pg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function mg(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function RA(e){return e!==e}function SA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function $h(e,t,n){return t===t?SA(e,t,n):mg(e,RA,n)}function gg(e,t){var n=e==null?0:e.length;return!!n&&$h(e,t,0)>-1}var IA=9007199254740991,OA=/^(?:0|[1-9]\d*)$/;function zc(e,t){var n=typeof e;return t=t??IA,!!t&&(n=="number"||n!="symbol"&&OA.test(e))&&e>-1&&e%1==0&&e<t}function Dh(e,t,n){t=="__proto__"&&jc?jc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ua(e,t){return e===t||e!==e&&t!==t}var NA=Object.prototype,CA=NA.hasOwnProperty;function Wc(e,t,n){var r=e[t];(!(CA.call(e,t)&&ua(r,n))||n===void 0&&!(t in e))&&Dh(e,t,n)}function jh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Dh(n,a,c):Wc(n,a,c)}return n}var _g=Math.max;function LA(e,t,n){return t=_g(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=_g(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),yA(e,this,a)}}function zh(e,t){return AA(LA(e,t,lo),e+"")}var MA=9007199254740991;function Wh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=MA}function Qr(e){return e!=null&&Wh(e.length)&&!Ei(e)}function yg(e,t,n){if(!dr(n))return!1;var r=typeof t;return(r=="number"?Qr(n)&&zc(t,n.length):r=="string"&&t in n)?ua(n[t],e):!1}function UA(e){return zh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&yg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var FA=Object.prototype;function ha(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||FA;return e===n}function PA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var BA="[object Arguments]";function bg(e){return Ir(e)&&Gi(e)==BA}var wg=Object.prototype,$A=wg.hasOwnProperty,DA=wg.propertyIsEnumerable,Gc=bg(function(){return arguments}())?bg:function(e){return Ir(e)&&$A.call(e,"callee")&&!DA.call(e,"callee")};function jA(){return!1}var xg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Eg=xg&&typeof module=="object"&&module&&!module.nodeType&&module,zA=Eg&&Eg.exports===xg,kg=zA?Zr.Buffer:void 0,WA=kg?kg.isBuffer:void 0,fa=WA||jA,GA="[object Arguments]",KA="[object Array]",HA="[object Boolean]",YA="[object Date]",VA="[object Error]",XA="[object Function]",qA="[object Map]",JA="[object Number]",ZA="[object Object]",QA="[object RegExp]",tR="[object Set]",eR="[object String]",nR="[object WeakMap]",rR="[object ArrayBuffer]",iR="[object DataView]",sR="[object Float32Array]",oR="[object Float64Array]",aR="[object Int8Array]",cR="[object Int16Array]",lR="[object Int32Array]",uR="[object Uint8Array]",hR="[object Uint8ClampedArray]",fR="[object Uint16Array]",dR="[object Uint32Array]",we={};we[sR]=we[oR]=we[aR]=we[cR]=we[lR]=we[uR]=we[hR]=we[fR]=we[dR]=!0,we[GA]=we[KA]=we[rR]=we[HA]=we[iR]=we[YA]=we[VA]=we[XA]=we[qA]=we[JA]=we[ZA]=we[QA]=we[tR]=we[eR]=we[nR]=!1;function pR(e){return Ir(e)&&Wh(e.length)&&!!we[Gi(e)]}function Kc(e){return function(t){return e(t)}}var vg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,da=vg&&typeof module=="object"&&module&&!module.nodeType&&module,mR=da&&da.exports===vg,Gh=mR&&ig.process,Ki=function(){try{var e=da&&da.require&&da.require("util").types;return e||Gh&&Gh.binding&&Gh.binding("util")}catch{}}(),Tg=Ki&&Ki.isTypedArray,Kh=Tg?Kc(Tg):pR,gR=Object.prototype,_R=gR.hasOwnProperty;function Ag(e,t){var n=re(e),r=!n&&Gc(e),i=!n&&!r&&fa(e),s=!n&&!r&&!i&&Kh(e),o=n||r||i||s,a=o?PA(e.length,String):[],c=a.length;for(var l in e)(t||_R.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||zc(l,c)))&&a.push(l);return a}function Rg(e,t){return function(n){return e(t(n))}}var yR=Rg(Object.keys,Object),bR=Object.prototype,wR=bR.hasOwnProperty;function Sg(e){if(!ha(e))return yR(e);var t=[];for(var n in Object(e))wR.call(e,n)&&n!="constructor"&&t.push(n);return t}function pr(e){return Qr(e)?Ag(e):Sg(e)}var xR=Object.prototype,ER=xR.hasOwnProperty,Pn=UA(function(e,t){if(ha(t)||Qr(t)){jh(t,pr(t),e);return}for(var n in t)ER.call(t,n)&&Wc(e,n,t[n])});function kR(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var vR=Object.prototype,TR=vR.hasOwnProperty;function AR(e){if(!dr(e))return kR(e);var t=ha(e),n=[];for(var r in e)r=="constructor"&&(t||!TR.call(e,r))||n.push(r);return n}function Ig(e){return Qr(e)?Ag(e,!0):AR(e)}var RR=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,SR=/^\w*$/;function Hh(e,t){if(re(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Bc(e)?!0:SR.test(e)||!RR.test(e)||t!=null&&e in Object(t)}var pa=ys(Object,"create");function IR(){this.__data__=pa?pa(null):{},this.size=0}function OR(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var NR="__lodash_hash_undefined__",CR=Object.prototype,LR=CR.hasOwnProperty;function MR(e){var t=this.__data__;if(pa){var n=t[e];return n===NR?void 0:n}return LR.call(t,e)?t[e]:void 0}var UR=Object.prototype,FR=UR.hasOwnProperty;function PR(e){var t=this.__data__;return pa?t[e]!==void 0:FR.call(t,e)}var BR="__lodash_hash_undefined__";function $R(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=pa&&t===void 0?BR:t,this}function bs(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}bs.prototype.clear=IR,bs.prototype.delete=OR,bs.prototype.get=MR,bs.prototype.has=PR,bs.prototype.set=$R;function DR(){this.__data__=[],this.size=0}function Hc(e,t){for(var n=e.length;n--;)if(ua(e[n][0],t))return n;return-1}var jR=Array.prototype,zR=jR.splice;function WR(e){var t=this.__data__,n=Hc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():zR.call(t,n,1),--this.size,!0}function GR(e){var t=this.__data__,n=Hc(t,e);return n<0?void 0:t[n][1]}function KR(e){return Hc(this.__data__,e)>-1}function HR(e,t){var n=this.__data__,r=Hc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function ki(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ki.prototype.clear=DR,ki.prototype.delete=WR,ki.prototype.get=GR,ki.prototype.has=KR,ki.prototype.set=HR;var ma=ys(Zr,"Map");function YR(){this.size=0,this.__data__={hash:new bs,map:new(ma||ki),string:new bs}}function VR(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Yc(e,t){var n=e.__data__;return VR(t)?n[typeof t=="string"?"string":"hash"]:n.map}function XR(e){var t=Yc(this,e).delete(e);return this.size-=t?1:0,t}function qR(e){return Yc(this,e).get(e)}function JR(e){return Yc(this,e).has(e)}function ZR(e,t){var n=Yc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function vi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vi.prototype.clear=YR,vi.prototype.delete=XR,vi.prototype.get=qR,vi.prototype.has=JR,vi.prototype.set=ZR;var QR="Expected a function";function Yh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(QR);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Yh.Cache||vi),n}Yh.Cache=vi;var tS=500;function eS(e){var t=Yh(e,function(r){return n.size===tS&&n.clear(),r}),n=t.cache;return t}var nS=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rS=/\\(\\)?/g,iS=eS(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(nS,function(n,r,i,s){t.push(i?s.replace(rS,"$1"):r||n)}),t});function Og(e){return e==null?"":lg(e)}function Vc(e,t){return re(e)?e:Hh(e,t)?[e]:iS(Og(e))}var sS=1/0;function ga(e){if(typeof e=="string"||Bc(e))return e;var t=e+"";return t=="0"&&1/e==-sS?"-0":t}function Vh(e,t){t=Vc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ga(t[n++])];return n&&n==r?e:void 0}function oS(e,t,n){var r=e==null?void 0:Vh(e,t);return r===void 0?n:r}function Xh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Ng=fr?fr.isConcatSpreadable:void 0;function aS(e){return re(e)||Gc(e)||!!(Ng&&e&&e[Ng])}function qh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=aS),i||(i=[]);++s<o;){var a=e[s];n(a)?Xh(i,a):r||(i[i.length]=a)}return i}function tr(e){var t=e==null?0:e.length;return t?qh(e):[]}var Cg=Rg(Object.getPrototypeOf,Object);function Jh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function cS(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Jh(e,t,n)}var lS="\\ud800-\\udfff",uS="\\u0300-\\u036f",hS="\\ufe20-\\ufe2f",fS="\\u20d0-\\u20ff",dS=uS+hS+fS,pS="\\ufe0e\\ufe0f",mS="\\u200d",gS=RegExp("["+mS+lS+dS+pS+"]");function Lg(e){return gS.test(e)}function _S(e){return e.split("")}var Mg="\\ud800-\\udfff",yS="\\u0300-\\u036f",bS="\\ufe20-\\ufe2f",wS="\\u20d0-\\u20ff",xS=yS+bS+wS,ES="\\ufe0e\\ufe0f",kS="["+Mg+"]",Zh="["+xS+"]",Qh="\\ud83c[\\udffb-\\udfff]",vS="(?:"+Zh+"|"+Qh+")",Ug="[^"+Mg+"]",Fg="(?:\\ud83c[\\udde6-\\uddff]){2}",Pg="[\\ud800-\\udbff][\\udc00-\\udfff]",TS="\\u200d",Bg=vS+"?",$g="["+ES+"]?",AS="(?:"+TS+"(?:"+[Ug,Fg,Pg].join("|")+")"+$g+Bg+")*",RS=$g+Bg+AS,SS="(?:"+[Ug+Zh+"?",Zh,Fg,Pg,kS].join("|")+")",IS=RegExp(Qh+"(?="+Qh+")|"+SS+RS,"g");function OS(e){return e.match(IS)||[]}function NS(e){return Lg(e)?OS(e):_S(e)}function CS(e){return function(t){t=Og(t);var n=Lg(t)?NS(t):void 0,r=n?n[0]:t.charAt(0),i=n?cS(n,1).join(""):t.slice(1);return r[e]()+i}}var Dg=CS("toUpperCase");function LS(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function MS(){this.__data__=new ki,this.size=0}function US(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function FS(e){return this.__data__.get(e)}function PS(e){return this.__data__.has(e)}var BS=200;function $S(e,t){var n=this.__data__;if(n instanceof ki){var r=n.__data__;if(!ma||r.length<BS-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new vi(r)}return n.set(e,t),this.size=n.size,this}function ti(e){var t=this.__data__=new ki(e);this.size=t.size}ti.prototype.clear=MS,ti.prototype.delete=US,ti.prototype.get=FS,ti.prototype.has=PS,ti.prototype.set=$S;function DS(e,t){return e&&jh(t,pr(t),e)}var jg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zg=jg&&typeof module=="object"&&module&&!module.nodeType&&module,jS=zg&&zg.exports===jg,Wg=jS?Zr.Buffer:void 0,Gg=Wg?Wg.allocUnsafe:void 0;function zS(e,t){var n=e.length,r=Gg?Gg(n):new e.constructor(n);return e.copy(r),r}function tf(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Kg(){return[]}var WS=Object.prototype,GS=WS.propertyIsEnumerable,Hg=Object.getOwnPropertySymbols,ef=Hg?function(e){return e==null?[]:(e=Object(e),tf(Hg(e),function(t){return GS.call(e,t)}))}:Kg;function KS(e,t){return jh(e,ef(e),t)}var HS=Object.getOwnPropertySymbols,YS=HS?function(e){for(var t=[];e;)Xh(t,ef(e)),e=Cg(e);return t}:Kg;function Yg(e,t,n){var r=t(e);return re(e)?r:Xh(r,n(e))}function nf(e){return Yg(e,pr,ef)}function VS(e){return Yg(e,Ig,YS)}var rf=ys(Zr,"DataView"),sf=ys(Zr,"Promise"),uo=ys(Zr,"Set"),Vg="[object Map]",XS="[object Object]",Xg="[object Promise]",qg="[object Set]",Jg="[object WeakMap]",Zg="[object DataView]",qS=_s(rf),JS=_s(ma),ZS=_s(sf),QS=_s(uo),tI=_s(Bh),mr=Gi;(rf&&mr(new rf(new ArrayBuffer(1)))!=Zg||ma&&mr(new ma)!=Vg||sf&&mr(sf.resolve())!=Xg||uo&&mr(new uo)!=qg||Bh&&mr(new Bh)!=Jg)&&(mr=function(e){var t=Gi(e),n=t==XS?e.constructor:void 0,r=n?_s(n):"";if(r)switch(r){case qS:return Zg;case JS:return Vg;case ZS:return Xg;case QS:return qg;case tI:return Jg}return t});var eI=Object.prototype,nI=eI.hasOwnProperty;function rI(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&nI.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Xc=Zr.Uint8Array;function iI(e){var t=new e.constructor(e.byteLength);return new Xc(t).set(new Xc(e)),t}function sI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var oI=/\w*$/;function aI(e){var t=new e.constructor(e.source,oI.exec(e));return t.lastIndex=e.lastIndex,t}var Qg=fr?fr.prototype:void 0,t_=Qg?Qg.valueOf:void 0;function cI(e){return t_?Object(t_.call(e)):{}}function lI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var uI="[object Boolean]",hI="[object Date]",fI="[object Map]",dI="[object Number]",pI="[object RegExp]",mI="[object Set]",gI="[object String]",_I="[object Symbol]",yI="[object ArrayBuffer]",bI="[object DataView]",wI="[object Float32Array]",xI="[object Float64Array]",EI="[object Int8Array]",kI="[object Int16Array]",vI="[object Int32Array]",TI="[object Uint8Array]",AI="[object Uint8ClampedArray]",RI="[object Uint16Array]",SI="[object Uint32Array]";function II(e,t,n){var r=e.constructor;switch(t){case yI:return iI(e);case uI:case hI:return new r(+e);case bI:return sI(e);case wI:case xI:case EI:case kI:case vI:case TI:case AI:case RI:case SI:return lI(e);case fI:return new r;case dI:case gI:return new r(e);case pI:return aI(e);case mI:return new r;case _I:return cI(e)}}function OI(e){return typeof e.constructor=="function"&&!ha(e)?_A(Cg(e)):{}}var NI="[object Map]";function CI(e){return Ir(e)&&mr(e)==NI}var e_=Ki&&Ki.isMap,LI=e_?Kc(e_):CI,MI="[object Set]";function UI(e){return Ir(e)&&mr(e)==MI}var n_=Ki&&Ki.isSet,FI=n_?Kc(n_):UI,r_="[object Arguments]",PI="[object Array]",BI="[object Boolean]",$I="[object Date]",DI="[object Error]",i_="[object Function]",jI="[object GeneratorFunction]",zI="[object Map]",WI="[object Number]",s_="[object Object]",GI="[object RegExp]",KI="[object Set]",HI="[object String]",YI="[object Symbol]",VI="[object WeakMap]",XI="[object ArrayBuffer]",qI="[object DataView]",JI="[object Float32Array]",ZI="[object Float64Array]",QI="[object Int8Array]",tO="[object Int16Array]",eO="[object Int32Array]",nO="[object Uint8Array]",rO="[object Uint8ClampedArray]",iO="[object Uint16Array]",sO="[object Uint32Array]",me={};me[r_]=me[PI]=me[XI]=me[qI]=me[BI]=me[$I]=me[JI]=me[ZI]=me[QI]=me[tO]=me[eO]=me[zI]=me[WI]=me[s_]=me[GI]=me[KI]=me[HI]=me[YI]=me[nO]=me[rO]=me[iO]=me[sO]=!0,me[DI]=me[i_]=me[VI]=!1;function qc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!dr(e))return e;var a=re(e);if(a)return o=rI(e),bA(e,o);var c=mr(e),l=c==i_||c==jI;if(fa(e))return zS(e);if(c==s_||c==r_||l&&!i)return o=l?{}:OI(e),KS(e,DS(o,e));if(!me[c])return i?e:{};o=II(e,c),s||(s=new ti);var u=s.get(e);if(u)return u;s.set(e,o),FI(e)?e.forEach(function(h){o.add(qc(h,t,n,h,e,s))}):LI(e)&&e.forEach(function(h,m){o.set(m,qc(h,t,n,m,e,s))});var f=nf,d=a?void 0:f(e);return pg(d||e,function(h,m){d&&(m=h,h=e[m]),Wc(o,m,qc(h,t,n,m,e,s))}),o}var oO=4;function dn(e){return qc(e,oO)}function _a(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var aO="__lodash_hash_undefined__";function cO(e){return this.__data__.set(e,aO),this}function lO(e){return this.__data__.has(e)}function ho(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new vi;++t<n;)this.add(e[t])}ho.prototype.add=ho.prototype.push=cO,ho.prototype.has=lO;function o_(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function of(e,t){return e.has(t)}var uO=1,hO=2;function a_(e,t,n,r,i,s){var o=n&uO,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=n&hO?new ho:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var m=e[f],p=t[f];if(r)var b=o?r(p,m,f,t,e,s):r(m,p,f,e,t,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!o_(t,function(y,v){if(!of(h,v)&&(m===y||i(m,y,n,r,s)))return h.push(v)})){d=!1;break}}else if(!(m===p||i(m,p,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function fO(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function af(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var dO=1,pO=2,mO="[object Boolean]",gO="[object Date]",_O="[object Error]",yO="[object Map]",bO="[object Number]",wO="[object RegExp]",xO="[object Set]",EO="[object String]",kO="[object Symbol]",vO="[object ArrayBuffer]",TO="[object DataView]",c_=fr?fr.prototype:void 0,cf=c_?c_.valueOf:void 0;function AO(e,t,n,r,i,s,o){switch(n){case TO:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case vO:return!(e.byteLength!=t.byteLength||!s(new Xc(e),new Xc(t)));case mO:case gO:case bO:return ua(+e,+t);case _O:return e.name==t.name&&e.message==t.message;case wO:case EO:return e==t+"";case yO:var a=fO;case xO:var c=r&dO;if(a||(a=af),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=pO,o.set(e,t);var u=a_(a(e),a(t),r,i,s,o);return o.delete(e),u;case kO:if(cf)return cf.call(e)==cf.call(t)}return!1}var RO=1,SO=Object.prototype,IO=SO.hasOwnProperty;function OO(e,t,n,r,i,s){var o=n&RO,a=nf(e),c=a.length,l=nf(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:IO.call(t,d)))return!1}var h=s.get(e),m=s.get(t);if(h&&m)return h==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var b=o;++f<c;){d=a[f];var y=e[d],v=t[d];if(r)var T=o?r(v,y,d,t,e,s):r(y,v,d,e,t,s);if(!(T===void 0?y===v||i(y,v,n,r,s):T)){p=!1;break}b||(b=d=="constructor")}if(p&&!b){var A=e.constructor,U=t.constructor;A!=U&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof U=="function"&&U instanceof U)&&(p=!1)}return s.delete(e),s.delete(t),p}var NO=1,l_="[object Arguments]",u_="[object Array]",Jc="[object Object]",CO=Object.prototype,h_=CO.hasOwnProperty;function LO(e,t,n,r,i,s){var o=re(e),a=re(t),c=o?u_:mr(e),l=a?u_:mr(t);c=c==l_?Jc:c,l=l==l_?Jc:l;var u=c==Jc,f=l==Jc,d=c==l;if(d&&fa(e)){if(!fa(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ti),o||Kh(e)?a_(e,t,n,r,i,s):AO(e,t,c,n,r,i,s);if(!(n&NO)){var h=u&&h_.call(e,"__wrapped__"),m=f&&h_.call(t,"__wrapped__");if(h||m){var p=h?e.value():e,b=m?t.value():t;return s||(s=new ti),i(p,b,n,r,s)}}return d?(s||(s=new ti),OO(e,t,n,r,i,s)):!1}function lf(e,t,n,r,i){return e===t?!0:e==null||t==null||!Ir(e)&&!Ir(t)?e!==e&&t!==t:LO(e,t,n,r,lf,i)}var MO=1,UO=2;function FO(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ti,f;if(!(f===void 0?lf(l,c,MO|UO,r,u):f))return!1}}return!0}function f_(e){return e===e&&!dr(e)}function PO(e){for(var t=pr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,f_(i)]}return t}function d_(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function BO(e){var t=PO(e);return t.length==1&&t[0][2]?d_(t[0][0],t[0][1]):function(n){return n===e||FO(n,e,t)}}function $O(e,t){return e!=null&&t in Object(e)}function p_(e,t,n){t=Vc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ga(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Wh(i)&&zc(o,i)&&(re(e)||Gc(e)))}function DO(e,t){return e!=null&&p_(e,t,$O)}var jO=1,zO=2;function WO(e,t){return Hh(e)&&f_(t)?d_(ga(e),t):function(n){var r=oS(n,e);return r===void 0&&r===t?DO(n,e):lf(t,r,jO|zO)}}function GO(e){return function(t){return t==null?void 0:t[e]}}function KO(e){return function(t){return Vh(t,e)}}function HO(e){return Hh(e)?GO(ga(e)):KO(e)}function ei(e){return typeof e=="function"?e:e==null?lo:typeof e=="object"?re(e)?WO(e[0],e[1]):BO(e):HO(e)}function YO(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function VO(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var XO=VO();function qO(e,t){return e&&XO(e,t,pr)}function JO(e,t){return function(n,r){if(n==null)return n;if(!Qr(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var ws=JO(qO);function ZO(e,t,n,r){return ws(e,function(i,s,o){t(r,i,n(i),o)}),r}function QO(e,t){return function(n,r){var i=re(n)?YO:ZO,s=t?t():{};return i(n,e,ei(r),s)}}var m_=Object.prototype,tN=m_.hasOwnProperty,uf=zh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&yg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Ig(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||ua(u,m_[l])&&!tN.call(e,l))&&(e[l]=s[l])}return e});function g_(e){return Ir(e)&&Qr(e)}var eN=200;function nN(e,t,n,r){var i=-1,s=gg,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=eN&&(s=of,o=!1,t=new ho(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var Zc=zh(function(e,t){return g_(e)?nN(e,qh(t,1,g_,!0)):[]});function fo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function pn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Dc(t),Jh(e,t<0?0:t,r)):[]}function ya(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Dc(t),t=r-t,Jh(e,0,t<0?0:t)):[]}function rN(e){return typeof e=="function"?e:lo}function Lt(e,t){var n=re(e)?pg:ws;return n(e,rN(t))}function iN(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function sN(e,t){var n=!0;return ws(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function Or(e,t,n){var r=re(e)?iN:sN;return r(e,ei(t))}function __(e,t){var n=[];return ws(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function gr(e,t){var n=re(e)?tf:__;return n(e,ei(t))}function oN(e){return function(t,n,r){var i=Object(t);if(!Qr(t)){var s=ei(n);t=pr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var aN=Math.max;function cN(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Dc(n);return i<0&&(i=aN(r+i,0)),mg(e,ei(t),i)}var po=oN(cN);function Nr(e){return e&&e.length?e[0]:void 0}function lN(e,t){var n=-1,r=Qr(e)?Array(e.length):[];return ws(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function kt(e,t){var n=re(e)?$c:lN;return n(e,ei(t))}function _r(e,t){return qh(kt(e,t))}var uN=Object.prototype,hN=uN.hasOwnProperty,y_=QO(function(e,t,n){hN.call(e,n)?e[n].push(t):Dh(e,n,[t])}),fN=Object.prototype,dN=fN.hasOwnProperty;function pN(e,t){return e!=null&&dN.call(e,t)}function Ct(e,t){return e!=null&&p_(e,t,pN)}var mN="[object String]";function Bn(e){return typeof e=="string"||!re(e)&&Ir(e)&&Gi(e)==mN}function gN(e,t){return $c(t,function(n){return e[n]})}function He(e){return e==null?[]:gN(e,pr(e))}var _N=Math.max;function An(e,t,n,r){e=Qr(e)?e:He(e),n=n&&!r?Dc(n):0;var i=e.length;return n<0&&(n=_N(i+n,0)),Bn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&$h(e,t,n)>-1}function b_(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return $h(e,t,i)}var yN="[object Map]",bN="[object Set]",wN=Object.prototype,xN=wN.hasOwnProperty;function ge(e){if(e==null)return!0;if(Qr(e)&&(re(e)||typeof e=="string"||typeof e.splice=="function"||fa(e)||Kh(e)||Gc(e)))return!e.length;var t=mr(e);if(t==yN||t==bN)return!e.size;if(ha(e))return!Sg(e).length;for(var n in e)if(xN.call(e,n))return!1;return!0}var EN="[object RegExp]";function kN(e){return Ir(e)&&Gi(e)==EN}var w_=Ki&&Ki.isRegExp,Ti=w_?Kc(w_):kN;function Ai(e){return e===void 0}var vN="Expected a function";function TN(e){if(typeof e!="function")throw new TypeError(vN);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function AN(e,t,n,r){if(!dr(e))return e;t=Vc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ga(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=dr(u)?u:zc(t[i+1])?[]:{})}Wc(a,c,l),a=a[c]}return e}function RN(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Vh(e,o);n(a,o)&&AN(s,Vc(o,e),a)}return s}function Cr(e,t){if(e==null)return{};var n=$c(VS(e),function(r){return[r]});return t=ei(t),RN(e,n,function(r,i){return t(r,i[0])})}function SN(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function $n(e,t,n){var r=re(e)?LS:SN,i=arguments.length<3;return r(e,ei(t),n,i,ws)}function Qc(e,t){var n=re(e)?tf:__;return n(e,TN(ei(t)))}function IN(e,t){var n;return ws(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function hf(e,t,n){var r=re(e)?o_:IN;return r(e,ei(t))}var ON=1/0,NN=uo&&1/af(new uo([,-0]))[1]==ON?function(e){return new uo(e)}:qe,CN=200;function LN(e,t,n){var r=-1,i=gg,s=e.length,o=!0,a=[],c=a;if(s>=CN){var l=NN(e);if(l)return af(l);o=!1,i=of,c=new ho}else c=a;t:for(;++r<s;){var u=e[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function tl(e){return e&&e.length?LN(e):[]}function ff(e){console&&console.error&&console.error(`Error: ${e}`)}function x_(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function E_(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function k_(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function MN(e){return UN(e)?e.LABEL:e.name}function UN(e){return Bn(e.LABEL)&&e.LABEL!==""}class ni{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Lt(this.definition,n=>{n.accept(t)})}}class Dn extends ni{constructor(t){super([]),this.idx=1,Pn(this,Cr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class mo extends ni{constructor(t){super(t.definition),this.orgText="",Pn(this,Cr(t,n=>n!==void 0))}}class jn extends ni{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Pn(this,Cr(t,n=>n!==void 0))}}class zn extends ni{constructor(t){super(t.definition),this.idx=1,Pn(this,Cr(t,n=>n!==void 0))}}class ri extends ni{constructor(t){super(t.definition),this.idx=1,Pn(this,Cr(t,n=>n!==void 0))}}class ii extends ni{constructor(t){super(t.definition),this.idx=1,Pn(this,Cr(t,n=>n!==void 0))}}class Je extends ni{constructor(t){super(t.definition),this.idx=1,Pn(this,Cr(t,n=>n!==void 0))}}class Lr extends ni{constructor(t){super(t.definition),this.idx=1,Pn(this,Cr(t,n=>n!==void 0))}}class Mr extends ni{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Pn(this,Cr(t,n=>n!==void 0))}}class Ce{constructor(t){this.idx=1,Pn(this,Cr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function FN(e){return kt(e,el)}function el(e){function t(n){return kt(n,el)}if(e instanceof Dn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Bn(e.label)&&(n.label=e.label),n}else{if(e instanceof jn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof zn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof ri)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof ii)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:el(new Ce({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Lr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:el(new Ce({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Je)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Mr)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ce){const n={type:"Terminal",name:e.terminalType.name,label:MN(e.terminalType),idx:e.idx};Bn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ti(r)?r.source:r),n}else{if(e instanceof mo)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class xs{visit(t){const n=t;switch(n.constructor){case Dn:return this.visitNonTerminal(n);case jn:return this.visitAlternative(n);case zn:return this.visitOption(n);case ri:return this.visitRepetitionMandatory(n);case ii:return this.visitRepetitionMandatoryWithSeparator(n);case Lr:return this.visitRepetitionWithSeparator(n);case Je:return this.visitRepetition(n);case Mr:return this.visitAlternation(n);case Ce:return this.visitTerminal(n);case mo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function PN(e){return e instanceof jn||e instanceof zn||e instanceof Je||e instanceof ri||e instanceof ii||e instanceof Lr||e instanceof Ce||e instanceof mo}function nl(e,t=[]){return e instanceof zn||e instanceof Je||e instanceof Lr?!0:e instanceof Mr?hf(e.definition,r=>nl(r,t)):e instanceof Dn&&An(t,e)?!1:e instanceof ni?(e instanceof Dn&&t.push(e),Or(e.definition,r=>nl(r,t))):!1}function BN(e){return e instanceof Mr}function si(e){if(e instanceof Dn)return"SUBRULE";if(e instanceof zn)return"OPTION";if(e instanceof Mr)return"OR";if(e instanceof ri)return"AT_LEAST_ONE";if(e instanceof ii)return"AT_LEAST_ONE_SEP";if(e instanceof Lr)return"MANY_SEP";if(e instanceof Je)return"MANY";if(e instanceof Ce)return"CONSUME";throw Error("non exhaustive match")}class rl{walk(t,n=[]){Lt(t.definition,(r,i)=>{const s=pn(t.definition,i+1);if(r instanceof Dn)this.walkProdRef(r,s,n);else if(r instanceof Ce)this.walkTerminal(r,s,n);else if(r instanceof jn)this.walkFlat(r,s,n);else if(r instanceof zn)this.walkOption(r,s,n);else if(r instanceof ri)this.walkAtLeastOne(r,s,n);else if(r instanceof ii)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Lr)this.walkManySep(r,s,n);else if(r instanceof Je)this.walkMany(r,s,n);else if(r instanceof Mr)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new zn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=v_(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new zn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=v_(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Lt(t.definition,s=>{const o=new jn({definition:[s]});this.walk(o,i)})}}function v_(e,t,n){return[new zn({definition:[new Ce({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function ba(e){if(e instanceof Dn)return ba(e.referencedRule);if(e instanceof Ce)return jN(e);if(PN(e))return $N(e);if(BN(e))return DN(e);throw Error("non exhaustive match")}function $N(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=nl(s),t=t.concat(ba(s)),r=r+1,i=n.length>r;return tl(t)}function DN(e){const t=kt(e.definition,n=>ba(n));return tl(tr(t))}function jN(e){return[e.terminalType]}const T_="_~IN~_";class zN extends rl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=GN(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new jn({definition:s}),a=ba(o);this.follows[i]=a}}function WN(e){const t={};return Lt(e,n=>{const r=new zN(n).startWalking();Pn(t,r)}),t}function GN(e,t){return e.name+t+T_}function Mt(e){return e.charCodeAt(0)}function df(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function wa(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function go(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function KN(){throw Error("Internal Error - Should never get here!")}function A_(e){return e.type==="Character"}const il=[];for(let e=Mt("0");e<=Mt("9");e++)il.push(e);const sl=[Mt("_")].concat(il);for(let e=Mt("a");e<=Mt("z");e++)sl.push(e);for(let e=Mt("A");e<=Mt("Z");e++)sl.push(e);const R_=[Mt(" "),Mt("\f"),Mt(`
`),Mt("\r"),Mt("	"),Mt("\v"),Mt("	"),Mt("Â "),Mt("á"),Mt("â"),Mt("â"),Mt("â"),Mt("â"),Mt("â"),Mt("â"),Mt("â"),Mt("â"),Mt("â"),Mt("â"),Mt("â"),Mt("\u2028"),Mt("\u2029"),Mt("â¯"),Mt("â"),Mt("ã"),Mt("\uFEFF")],HN=/[0-9a-fA-F]/,ol=/[0-9]/,YN=/[1-9]/;class VN{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":wa(r,"global");break;case"i":wa(r,"ignoreCase");break;case"m":wa(r,"multiLine");break;case"u":wa(r,"unicode");break;case"y":wa(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}go(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return KN()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;go(n);break}if(!(t===!0&&n===void 0)&&go(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),go(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Mt(`
`),Mt("\r"),Mt("\u2028"),Mt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=il;break;case"D":t=il,n=!0;break;case"s":t=R_;break;case"S":t=R_,n=!0;break;case"w":t=sl;break;case"W":t=sl,n=!0;break}if(go(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Mt("\f");break;case"n":t=Mt(`
`);break;case"r":t=Mt("\r");break;case"t":t=Mt("	");break;case"v":t=Mt("\v");break}if(go(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Mt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Mt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Mt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,A_(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,A_(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else df(r.value,t),t.push(Mt("-")),df(i.value,t)}else df(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Mt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(YN.test(t)===!1)throw Error("Expecting a positive integer");for(;ol.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(ol.test(t)===!1)throw Error("Expecting an integer");for(;ol.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Mt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return ol.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(HN.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class pf{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let al={};const XN=new VN;function cl(e){const t=e.toString();if(al.hasOwnProperty(t))return al[t];{const n=XN.pattern(t);return al[t]=n,n}}function qN(){al={}}const S_="Complement Sets are not supported for first char optimization",ll=`Unable to use "first char" lexer optimizations:
`;function JN(e,t=!1){try{const n=cl(e);return mf(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===S_)t&&x_(`${ll}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),ff(`${ll}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function mf(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)mf(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":ul(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(S_);Lt(o.value,c=>{if(typeof c=="number")ul(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)ul(u,t,n);else{for(let u=l.from;u<=l.to&&u<Ea;u++)ul(u,t,n);if(l.to>=Ea){const u=l.from>=Ea?l.from:Ea,f=l.to,d=Hi(u),h=Hi(f);for(let m=d;m<=h;m++)t[m]=m}}}});break;case"Group":mf(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&gf(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return He(t)}function ul(e,t,n){const r=Hi(e);t[r]=r,n===!0&&ZN(e,t)}function ZN(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Hi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Hi(i.charCodeAt(0));t[s]=s}}}function I_(e,t){return po(e.value,n=>{if(typeof n=="number")return An(t,n);{const r=n;return po(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function gf(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?re(e.value)?Or(e.value,gf):gf(e.value):!1}class QN extends pf{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){An(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?I_(t,this.targetCharCodes)===void 0&&(this.found=!0):I_(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function _f(e,t){if(t instanceof RegExp){const n=cl(t),r=new QN(e);return r.visit(n),r.found}else return po(t,n=>An(e,n.charCodeAt(0)))!==void 0}const Es="PATTERN",xa="defaultMode",hl="modes";let O_=typeof new RegExp("(?:)").sticky=="boolean";function tC(e,t){t=uf(t,{useSticky:O_,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{kC()});let r;n("Reject Lexer.NA",()=>{r=Qc(e,v=>v[Es]===Ze.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=kt(r,v=>{const T=v[Es];if(Ti(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!An(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:t.useSticky?C_(T):N_(T)}else{if(Ei(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(A);return t.useSticky?C_(U):N_(U)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=kt(r,v=>v.tokenTypeIdx),a=kt(r,v=>{const T=v.GROUP;if(T!==Ze.SKIPPED){if(Bn(T))return T;if(Ai(T))return!1;throw Error("non exhaustive match")}}),c=kt(r,v=>{const T=v.LONGER_ALT;if(T)return re(T)?kt(T,U=>b_(r,U)):[b_(r,T)]}),l=kt(r,v=>v.PUSH_MODE),u=kt(r,v=>Ct(v,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const v=U_(t.lineTerminatorCharacters);f=kt(r,T=>!1),t.positionTracking!=="onlyOffset"&&(f=kt(r,T=>Ct(T,"LINE_BREAKS")?!!T.LINE_BREAKS:M_(T,v)===!1&&_f(v,T.PATTERN)))});let d,h,m,p;n("Misc Mapping #2",()=>{d=kt(r,L_),h=kt(s,wC),m=$n(r,(v,T)=>{const A=T.GROUP;return Bn(A)&&A!==Ze.SKIPPED&&(v[A]=[]),v},{}),p=kt(s,(v,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let b=!0,y=[];return t.safeMode||n("First Char Optimization",()=>{y=$n(r,(v,T,A)=>{if(typeof T.PATTERN=="string"){const U=T.PATTERN.charCodeAt(0),R=Hi(U);yf(v,R,p[A])}else if(re(T.START_CHARS_HINT)){let U;Lt(T.START_CHARS_HINT,R=>{const C=typeof R=="string"?R.charCodeAt(0):R,j=Hi(C);U!==j&&(U=j,yf(v,j,p[A]))})}else if(Ti(T.PATTERN))if(T.PATTERN.unicode)b=!1,t.ensureOptimizations&&ff(`${ll}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=JN(T.PATTERN,t.ensureOptimizations);ge(U)&&(b=!1),Lt(U,R=>{yf(v,R,p[A])})}else t.ensureOptimizations&&ff(`${ll}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return v},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:b}}function eC(e,t){let n=[];const r=rC(e);n=n.concat(r.errors);const i=iC(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(nC(s)),n=n.concat(fC(s)),n=n.concat(dC(s,t)),n=n.concat(pC(s)),n}function nC(e){let t=[];const n=gr(e,r=>Ti(r[Es]));return t=t.concat(oC(n)),t=t.concat(lC(n)),t=t.concat(uC(n)),t=t.concat(hC(n)),t=t.concat(aC(n)),t}function rC(e){const t=gr(e,i=>!Ct(i,Es)),n=kt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ue.MISSING_PATTERN,tokenTypes:[i]})),r=Zc(e,t);return{errors:n,valid:r}}function iC(e){const t=gr(e,i=>{const s=i[Es];return!Ti(s)&&!Ei(s)&&!Ct(s,"exec")&&!Bn(s)}),n=kt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ue.INVALID_PATTERN,tokenTypes:[i]})),r=Zc(e,t);return{errors:n,valid:r}}const sC=/[^\\][$]/;function oC(e){class t extends pf{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=gr(e,i=>{const s=i.PATTERN;try{const o=cl(s),a=new t;return a.visit(o),a.found}catch{return sC.test(s.source)}});return kt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ue.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function aC(e){const t=gr(e,r=>r.PATTERN.test(""));return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ue.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const cC=/[^\\[][\^]|^\^/;function lC(e){class t extends pf{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=gr(e,i=>{const s=i.PATTERN;try{const o=cl(s),a=new t;return a.visit(o),a.found}catch{return cC.test(s.source)}});return kt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ue.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function uC(e){const t=gr(e,r=>{const i=r[Es];return i instanceof RegExp&&(i.multiline||i.global)});return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ue.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function hC(e){const t=[];let n=kt(e,s=>$n(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!An(t,a)&&a.PATTERN!==Ze.NA&&(t.push(a),o.push(a)),o),[]));n=_a(n);const r=gr(n,s=>s.length>1);return kt(r,s=>{const o=kt(s,c=>c.name);return{message:`The same RegExp pattern ->${Nr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ue.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function fC(e){const t=gr(e,r=>{if(!Ct(r,"GROUP"))return!1;const i=r.GROUP;return i!==Ze.SKIPPED&&i!==Ze.NA&&!Bn(i)});return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ue.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function dC(e,t){const n=gr(e,i=>i.PUSH_MODE!==void 0&&!An(t,i.PUSH_MODE));return kt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ue.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function pC(e){const t=[],n=$n(e,(r,i,s)=>{const o=i.PATTERN;return o===Ze.NA||(Bn(o)?r.push({str:o,idx:s,tokenType:i}):Ti(o)&&gC(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Lt(e,(r,i)=>{Lt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&mC(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Ue.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function mC(e,t){if(Ti(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(Ei(t))return t(e,0,[],{});if(Ct(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function gC(e){return po([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function N_(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function C_(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function _C(e,t,n){const r=[];return Ct(e,xa)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+xa+`> property in its definition
`,type:Ue.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ct(e,hl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+hl+`> property in its definition
`,type:Ue.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ct(e,hl)&&Ct(e,xa)&&!Ct(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${xa}: <${e.defaultMode}>which does not exist
`,type:Ue.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ct(e,hl)&&Lt(e.modes,(i,s)=>{Lt(i,(o,a)=>{if(Ai(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ue.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ct(o,"LONGER_ALT")){const c=re(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Lt(c,l=>{!Ai(l)&&!An(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ue.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function yC(e,t,n){const r=[];let i=!1;const s=_a(tr(He(e.modes))),o=Qc(s,c=>c[Es]===Ze.NA),a=U_(n);return t&&Lt(o,c=>{const l=M_(c,a);if(l!==!1){const f={message:EC(c,l),type:l.issue,tokenType:c};r.push(f)}else Ct(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):_f(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ue.NO_LINE_BREAKS_FLAGS}),r}function bC(e){const t={},n=pr(e);return Lt(n,r=>{const i=e[r];if(re(i))t[r]=[];else throw Error("non exhaustive match")}),t}function L_(e){const t=e.PATTERN;if(Ti(t))return!1;if(Ei(t))return!0;if(Ct(t,"exec"))return!0;if(Bn(t))return!1;throw Error("non exhaustive match")}function wC(e){return Bn(e)&&e.length===1?e.charCodeAt(0):!1}const xC={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function M_(e,t){if(Ct(e,"LINE_BREAKS"))return!1;if(Ti(e.PATTERN)){try{_f(t,e.PATTERN)}catch(n){return{issue:Ue.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Bn(e.PATTERN))return!1;if(L_(e))return{issue:Ue.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function EC(e,t){if(t.issue===Ue.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Ue.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function U_(e){return kt(e,n=>Bn(n)?n.charCodeAt(0):n)}function yf(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Ea=256;let fl=[];function Hi(e){return e<Ea?e:fl[e]}function kC(){if(ge(fl)){fl=new Array(65536);for(let e=0;e<65536;e++)fl[e]=e>255?255+~~(e/255):e}}function ka(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function dl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let F_=1;const P_={};function va(e){const t=vC(e);TC(t),RC(t),AC(t),Lt(t,n=>{n.isParent=n.categoryMatches.length>0})}function vC(e){let t=dn(e),n=e,r=!0;for(;r;){n=_a(tr(kt(n,s=>s.CATEGORIES)));const i=Zc(n,t);t=t.concat(i),ge(i)?r=!1:n=i}return t}function TC(e){Lt(e,t=>{$_(t)||(P_[F_]=t,t.tokenTypeIdx=F_++),D_(t)&&!re(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),D_(t)||(t.CATEGORIES=[]),SC(t)||(t.categoryMatches=[]),IC(t)||(t.categoryMatchesMap={})})}function AC(e){Lt(e,t=>{t.categoryMatches=[],Lt(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(P_[r].tokenTypeIdx)})})}function RC(e){Lt(e,t=>{B_([],t)})}function B_(e,t){Lt(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Lt(t.CATEGORIES,n=>{const r=e.concat(t);An(r,n)||B_(r,n)})}function $_(e){return Ct(e,"tokenTypeIdx")}function D_(e){return Ct(e,"CATEGORIES")}function SC(e){return Ct(e,"categoryMatches")}function IC(e){return Ct(e,"categoryMatchesMap")}function OC(e){return Ct(e,"tokenTypeIdx")}const NC={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Ue;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ue||(Ue={}));const Ta={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:NC,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Ta);let Ze=class{constructor(t,n=Ta){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=E_(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Pn({},Ta,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Ta.lineTerminatorsPattern)this.config.lineTerminatorsPattern=xC;else if(this.config.lineTerminatorCharacters===Ta.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),re(t)?i={modes:{defaultMode:dn(t)},defaultMode:xa}:(s=!1,i=dn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(_C(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(yC(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Lt(i.modes,(a,c)=>{i.modes[c]=Qc(a,l=>Ai(l))});const o=pr(i.modes);if(Lt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(eC(a,o))}),ge(this.lexerDefinitionErrors)){va(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=tC(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Pn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ge(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=kt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Lt(this.lexerDefinitionWarning,a=>{x_(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(O_?(this.chopInput=lo,this.match=this.matchWithTest):(this.updateLastIndex=qe,this.match=this.matchWithExec),s&&(this.handleModes=qe),this.trackStartLines===!1&&(this.computeNewColumn=lo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=qe),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=$n(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ge(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{qN()}),this.TRACE_INIT("toFastProperties",()=>{k_(this)})})}tokenize(t,n=this.defaultMode){if(!ge(this.lexerDefinitionErrors)){const i=kt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,f,d,h,m,p,b,y;const v=t,T=v.length;let A=0,U=0;const R=this.hasCustom?0:Math.floor(t.length/10),C=new Array(R),j=[];let O=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const q=bC(this.emptyGroups),L=this.trackStartLines,I=this.config.lineTerminatorsPattern;let x=0,N=[],$=[];const P=[],it=[];Object.freeze(it);let Q;function rt(){return N}function z($t){const Jt=Hi($t),Bt=$[Jt];return Bt===void 0?it:Bt}const B=$t=>{if(P.length===1&&$t.tokenType.PUSH_MODE===void 0){const Jt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage($t);j.push({offset:$t.startOffset,line:$t.startLine,column:$t.startColumn,length:$t.image.length,message:Jt})}else{P.pop();const Jt=fo(P);N=this.patternIdxToConfig[Jt],$=this.charCodeToPatternIdxToConfig[Jt],x=N.length;const Bt=this.canModeBeOptimized[Jt]&&this.config.safeMode===!1;$&&Bt?Q=z:Q=rt}};function ht($t){P.push($t),$=this.charCodeToPatternIdxToConfig[$t],N=this.patternIdxToConfig[$t],x=N.length,x=N.length;const Jt=this.canModeBeOptimized[$t]&&this.config.safeMode===!1;$&&Jt?Q=z:Q=rt}ht.call(this,n);let ct;const lt=this.config.recoveryEnabled;for(;A<T;){c=null;const $t=v.charCodeAt(A),Jt=Q($t),Bt=Jt.length;for(r=0;r<Bt;r++){ct=Jt[r];const Ft=ct.pattern;l=null;const ae=ct.short;if(ae!==!1?$t===ae&&(c=Ft):ct.isCustom===!0?(y=Ft.exec(v,A,C,q),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(Ft,A),c=this.match(Ft,t,A)),c!==null){if(a=ct.longerAlt,a!==void 0){const Vt=a.length;for(s=0;s<Vt;s++){const Se=N[a[s]],Pe=Se.pattern;if(u=null,Se.isCustom===!0?(y=Pe.exec(v,A,C,q),y!==null?(o=y[0],y.payload!==void 0&&(u=y.payload)):o=null):(this.updateLastIndex(Pe,A),o=this.match(Pe,t,A)),o&&o.length>c.length){c=o,l=u,ct=Se;break}}}break}}if(c!==null){if(f=c.length,d=ct.group,d!==void 0&&(h=ct.tokenTypeIdx,m=this.createTokenInstance(c,A,h,ct.tokenType,O,W,f),this.handlePayload(m,l),d===!1?U=this.addToken(C,U,m):q[d].push(m)),t=this.chopInput(t,f),A=A+f,W=this.computeNewColumn(W,f),L===!0&&ct.canLineTerminator===!0){let Ft=0,ae,Vt;I.lastIndex=0;do ae=I.test(c),ae===!0&&(Vt=I.lastIndex-1,Ft++);while(ae===!0);Ft!==0&&(O=O+Ft,W=f-Vt,this.updateTokenEndLineColumnLocation(m,d,Vt,Ft,O,W,f))}this.handleModes(ct,B,ht,m)}else{const Ft=A,ae=O,Vt=W;let Se=lt===!1;for(;Se===!1&&A<T;)for(t=this.chopInput(t,1),A++,i=0;i<x;i++){const Pe=N[i],k=Pe.pattern,at=Pe.short;if(at!==!1?v.charCodeAt(A)===at&&(Se=!0):Pe.isCustom===!0?Se=k.exec(v,A,C,q)!==null:(this.updateLastIndex(k,A),Se=k.exec(t)!==null),Se===!0)break}if(p=A-Ft,W=this.computeNewColumn(W,p),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Ft,p,ae,Vt),j.push({offset:Ft,line:ae,column:Vt,length:p,message:b}),lt===!1)break}}return this.hasCustom||(C.length=U),{tokens:C,groups:q,errors:j}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};Ze.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Ze.NA=/NOT_APPLICABLE/;function Aa(e){return j_(e)?e.LABEL:e.name}function j_(e){return Bn(e.LABEL)&&e.LABEL!==""}const CC="parent",z_="categories",W_="label",G_="group",K_="push_mode",H_="pop_mode",Y_="longer_alt",V_="line_breaks",X_="start_chars_hint";function er(e){return LC(e)}function LC(e){const t=e.pattern,n={};if(n.name=e.name,Ai(t)||(n.PATTERN=t),Ct(e,CC))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ct(e,z_)&&(n.CATEGORIES=e[z_]),va([n]),Ct(e,W_)&&(n.LABEL=e[W_]),Ct(e,G_)&&(n.GROUP=e[G_]),Ct(e,H_)&&(n.POP_MODE=e[H_]),Ct(e,K_)&&(n.PUSH_MODE=e[K_]),Ct(e,Y_)&&(n.LONGER_ALT=e[Y_]),Ct(e,V_)&&(n.LINE_BREAKS=e[V_]),Ct(e,X_)&&(n.START_CHARS_HINT=e[X_]),n}const ks=er({name:"EOF",pattern:Ze.NA});va([ks]);function pl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function MC(e,t){return ka(e,t)}const q_={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${j_(e)?`--> ${Aa(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Nr(t).image+"'";if(r)return s+r+a;{const c=$n(e,(d,h)=>d.concat(h),[]),l=kt(c,d=>`[${kt(d,h=>Aa(h)).join(", ")}]`),f=`one of these possible Token sequences:
${kt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Nr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${kt(e,l=>`[${kt(l,u=>Aa(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(q_);const UC={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},vs={buildDuplicateFoundError(e,t){function n(u){return u instanceof Ce?u.terminalType.name:u instanceof Dn?u.nonTerminalName:""}const r=e.name,i=Nr(t),s=i.idx,o=si(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=kt(e.prefixPath,i=>Aa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=kt(e.prefixPath,i=>Aa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=si(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=kt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof mo?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function FC(e,t){const n=new PC(e,t);return n.resolveRefs(),n.errors}class PC extends xs{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Lt(He(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:Rn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class BC extends rl{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=dn(this.path.ruleStack).reverse(),this.occurrenceStack=dn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){ge(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class $C extends BC{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new jn({definition:i});this.possibleTokTypes=ba(s),this.found=!0}}}class ml extends rl{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class DC extends ml{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Nr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class J_ extends ml{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Nr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class jC extends ml{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Nr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Z_ extends ml{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Nr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ce&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function bf(e,t,n=[]){n=dn(n);let r=[],i=0;function s(a){return a.concat(pn(e,i+1))}function o(a){const c=bf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof jn)return o(a.definition);if(a instanceof Dn)return o(a.definition);if(a instanceof zn)r=o(a.definition);else if(a instanceof ri){const c=a.definition.concat([new Je({definition:a.definition})]);return o(c)}else if(a instanceof ii){const c=[new jn({definition:a.definition}),new Je({definition:[new Ce({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Lr){const c=a.definition.concat([new Je({definition:[new Ce({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Je){const c=a.definition.concat([new Je({definition:a.definition})]);r=o(c)}else{if(a instanceof Mr)return Lt(a.definition,c=>{ge(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ce)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:pn(e,i)}),r}function Q_(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ge(f);){const d=f.pop();if(d===o){a&&fo(f).idx<=l&&f.pop();continue}const h=d.def,m=d.idx,p=d.ruleStack,b=d.occurrenceStack;if(ge(h))continue;const y=h[0];if(y===i){const v={idx:m,def:pn(h),ruleStack:ya(p),occurrenceStack:ya(b)};f.push(v)}else if(y instanceof Ce)if(m<c-1){const v=m+1,T=t[v];if(n(T,y.terminalType)){const A={idx:v,def:pn(h),ruleStack:p,occurrenceStack:b};f.push(A)}}else if(m===c-1)u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:p,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(y instanceof Dn){const v=dn(p);v.push(y.nonTerminalName);const T=dn(b);T.push(y.idx);const A={idx:m,def:y.definition.concat(s,pn(h)),ruleStack:v,occurrenceStack:T};f.push(A)}else if(y instanceof zn){const v={idx:m,def:pn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T={idx:m,def:y.definition.concat(pn(h)),ruleStack:p,occurrenceStack:b};f.push(T)}else if(y instanceof ri){const v=new Je({definition:y.definition,idx:y.idx}),T=y.definition.concat([v],pn(h)),A={idx:m,def:T,ruleStack:p,occurrenceStack:b};f.push(A)}else if(y instanceof ii){const v=new Ce({terminalType:y.separator}),T=new Je({definition:[v].concat(y.definition),idx:y.idx}),A=y.definition.concat([T],pn(h)),U={idx:m,def:A,ruleStack:p,occurrenceStack:b};f.push(U)}else if(y instanceof Lr){const v={idx:m,def:pn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T=new Ce({terminalType:y.separator}),A=new Je({definition:[T].concat(y.definition),idx:y.idx}),U=y.definition.concat([A],pn(h)),R={idx:m,def:U,ruleStack:p,occurrenceStack:b};f.push(R)}else if(y instanceof Je){const v={idx:m,def:pn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T=new Je({definition:y.definition,idx:y.idx}),A=y.definition.concat([T],pn(h)),U={idx:m,def:A,ruleStack:p,occurrenceStack:b};f.push(U)}else if(y instanceof Mr)for(let v=y.definition.length-1;v>=0;v--){const T=y.definition[v],A={idx:m,def:T.definition.concat(pn(h)),ruleStack:p,occurrenceStack:b};f.push(A),f.push(o)}else if(y instanceof jn)f.push({idx:m,def:y.definition.concat(pn(h)),ruleStack:p,occurrenceStack:b});else if(y instanceof mo)f.push(zC(y,m,p,b));else throw Error("non exhaustive match")}return u}function zC(e,t,n,r){const i=dn(n);i.push(e.name);const s=dn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Fe;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Fe||(Fe={}));function ty(e){if(e instanceof zn||e==="Option")return Fe.OPTION;if(e instanceof Je||e==="Repetition")return Fe.REPETITION;if(e instanceof ri||e==="RepetitionMandatory")return Fe.REPETITION_MANDATORY;if(e instanceof ii||e==="RepetitionMandatoryWithSeparator")return Fe.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Lr||e==="RepetitionWithSeparator")return Fe.REPETITION_WITH_SEPARATOR;if(e instanceof Mr||e==="Alternation")return Fe.ALTERNATION;throw Error("non exhaustive match")}function WC(e,t,n,r,i,s){const o=xf(e,t,n),a=iy(o)?dl:ka;return s(o,r,a,i)}function GC(e,t,n,r,i,s){const o=Ef(e,t,i,n),a=iy(o)?dl:ka;return s(o[0],a,r)}function KC(e,t,n,r){const i=e.length,s=Or(e,o=>Or(o,a=>a.length===1));if(t)return function(o){const a=kt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],m=h.length;for(let p=0;p<m;p++){const b=this.LA(p+1);if(n(b,h[p])===!1)continue t}return c}}};if(s&&!r){const o=kt(e,c=>tr(c)),a=$n(o,(c,l,u)=>(Lt(l,f=>{Ct(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Lt(f.categoryMatches,d=>{Ct(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function HC(e,t,n){const r=Or(e,s=>s.length===1),i=e.length;if(r&&!n){const s=tr(e);if(s.length===1&&ge(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=$n(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Lt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class YC extends rl{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Fe.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Fe.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Fe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Fe.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Fe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class ey extends xs{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Fe.OPTION)}visitRepetition(t){this.checkIsTarget(t,Fe.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Fe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Fe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Fe.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Fe.ALTERNATION)}}function ny(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function wf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function VC(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function ry(e,t){const n=kt(e,o=>bf([o],1)),r=ny(n.length),i=kt(n,o=>{const a={};return Lt(o,c=>{const l=wf(c.partialPath);Lt(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=ny(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=wf(f);if(VC(i,h,c)||ge(d)||f.length===t){const p=r[c];if(kf(p,f)===!1){p.push(f);for(let b=0;b<h.length;b++){const y=h[b];i[c][y]=!0}}}else{const p=bf(d,o+1,f);s[c]=s[c].concat(p),Lt(p,b=>{const y=wf(b.partialPath);Lt(y,v=>{i[c][v]=!0})})}}}}return r}function xf(e,t,n,r){const i=new ey(e,Fe.ALTERNATION,r);return t.accept(i),ry(i.result,n)}function Ef(e,t,n,r){const i=new ey(e,n);t.accept(i);const s=i.result,a=new YC(t,e,n).startWalking(),c=new jn({definition:s}),l=new jn({definition:a});return ry([c,l],r)}function kf(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function XC(e,t){return e.length<t.length&&Or(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function iy(e){return Or(e,t=>Or(t,n=>Or(n,r=>ge(r.categoryMatches))))}function qC(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return kt(t,n=>Object.assign({type:Rn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function JC(e,t,n,r){const i=_r(e,c=>ZC(c,n)),s=u6(e,t,n),o=_r(e,c=>o6(c,n)),a=_r(e,c=>e6(c,e,r,n));return i.concat(s,o,a)}function ZC(e,t){const n=new t6;e.accept(n);const r=n.allProductions,i=y_(r,QC),s=Cr(i,a=>a.length>1);return kt(He(s),a=>{const c=Nr(a),l=t.buildDuplicateFoundError(e,a),u=si(c),f={message:l,type:Rn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=sy(c);return d&&(f.parameter=d),f})}function QC(e){return`${si(e)}_#_${e.idx}_#_${sy(e)}`}function sy(e){return e instanceof Ce?e.terminalType.name:e instanceof Dn?e.nonTerminalName:""}class t6 extends xs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function e6(e,t,n,r){const i=[];if($n(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:Rn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function n6(e,t,n){const r=[];let i;return An(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Rn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function oy(e,t,n,r=[]){const i=[],s=gl(t.definition);if(ge(s))return[];{const o=e.name;An(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:Rn.LEFT_RECURSION,ruleName:o});const c=Zc(s,r.concat([e])),l=_r(c,u=>{const f=dn(r);return f.push(u),oy(e,u,n,f)});return i.concat(l)}}function gl(e){let t=[];if(ge(e))return t;const n=Nr(e);if(n instanceof Dn)t.push(n.referencedRule);else if(n instanceof jn||n instanceof zn||n instanceof ri||n instanceof ii||n instanceof Lr||n instanceof Je)t=t.concat(gl(n.definition));else if(n instanceof Mr)t=tr(kt(n.definition,s=>gl(s.definition)));else if(!(n instanceof Ce))throw Error("non exhaustive match");const r=nl(n),i=e.length>1;if(r&&i){const s=pn(e);return t.concat(gl(s))}else return t}class vf extends xs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function r6(e,t){const n=new vf;e.accept(n);const r=n.alternations;return _r(r,s=>{const o=ya(s.definition);return _r(o,(a,c)=>{const l=Q_([a],[],ka,1);return ge(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:Rn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function i6(e,t,n){const r=new vf;e.accept(r);let i=r.alternations;return i=Qc(i,o=>o.ignoreAmbiguities===!0),_r(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=xf(a,e,c,o),u=c6(l,o,e,n),f=l6(l,o,e,n);return u.concat(f)})}class s6 extends xs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function o6(e,t){const n=new vf;e.accept(n);const r=n.alternations;return _r(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:Rn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function a6(e,t,n){const r=[];return Lt(e,i=>{const s=new s6;i.accept(s);const o=s.allProductions;Lt(o,a=>{const c=ty(a),l=a.maxLookahead||t,u=a.idx,d=Ef(u,i,c,l)[0];if(ge(tr(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:Rn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function c6(e,t,n,r){const i=[],s=$n(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Lt(c,u=>{const f=[l];Lt(e,(d,h)=>{l!==h&&kf(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!kf(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return kt(s,a=>{const c=kt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Rn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function l6(e,t,n,r){const i=$n(e,(o,a,c)=>{const l=kt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return _a(_r(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=gr(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&XC(d.path,l));return kt(u,d=>{const h=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:Rn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:h}})}))}function u6(e,t,n){const r=[],i=kt(t,s=>s.name);return Lt(e,s=>{const o=s.name;if(An(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Rn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function h6(e){const t=uf(e,{errMsgProvider:UC}),n={};return Lt(e.rules,r=>{n[r.name]=r}),FC(n,t.errMsgProvider)}function f6(e){return e=uf(e,{errMsgProvider:vs}),JC(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const ay="MismatchedTokenException",cy="NoViableAltException",ly="EarlyExitException",uy="NotAllInputParsedException",hy=[ay,cy,ly,uy];Object.freeze(hy);function _l(e){return An(hy,e.name)}class yl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class fy extends yl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ay}}class d6 extends yl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=cy}}class p6 extends yl{constructor(t,n){super(t,n),this.name=uy}}class m6 extends yl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ly}}const Tf={},dy="InRuleRecoveryException";class g6 extends Error{constructor(t){super(t),this.name=dy}}class _6{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ct(t,"recoveryEnabled")?t.recoveryEnabled:Ri.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=y6)}getTokenToInsert(t){const n=pl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new fy(h,l,this.LA(0));m.resyncedTokens=ya(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new g6("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||ge(n))return!1;const r=this.LA(1);return po(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return An(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=po(t,s=>MC(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Tf;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return kt(t,(r,i)=>i===0?Tf:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=kt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return tr(t)}getFollowSetFromFollowKey(t){if(t===Tf)return[ks];const n=t.ruleName+t.idxInCallingRule+T_+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,ks)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ya(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=dn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return kt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function y6(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=ks,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const b6=4,Yi=8,py=1<<Yi,my=2<<Yi,Af=3<<Yi,Rf=4<<Yi,Sf=5<<Yi,bl=6<<Yi;function If(e,t,n){return n|t|e}class w6{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ri.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(ge(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return _r(t,n=>oy(n,n,vs))}validateEmptyOrAlternatives(t){return _r(t,n=>r6(n,vs))}validateAmbiguousAlternationAlternatives(t,n){return _r(t,r=>i6(r,n,vs))}validateSomeNonEmptyLookaheadPath(t,n){return a6(t,n,vs)}buildLookaheadForAlternation(t){return WC(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,KC)}buildLookaheadForOptional(t){return GC(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,ty(t.prodType),HC)}}class x6{initLooksAhead(t){this.dynamicTokensEnabled=Ct(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ri.dynamicTokensEnabled,this.maxLookahead=Ct(t,"maxLookahead")?t.maxLookahead:Ri.maxLookahead,this.lookaheadStrategy=Ct(t,"lookaheadStrategy")?t.lookaheadStrategy:new w6({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Lt(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=k6(n);Lt(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${si(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=If(this.fullRuleNameToShort[n.name],py,l.idx);this.setLaFuncCache(d,f)})}),Lt(i,l=>{this.computeLookaheadFunc(n,l.idx,Af,"Repetition",l.maxLookahead,si(l))}),Lt(s,l=>{this.computeLookaheadFunc(n,l.idx,my,"Option",l.maxLookahead,si(l))}),Lt(o,l=>{this.computeLookaheadFunc(n,l.idx,Rf,"RepetitionMandatory",l.maxLookahead,si(l))}),Lt(a,l=>{this.computeLookaheadFunc(n,l.idx,bl,"RepetitionMandatoryWithSeparator",l.maxLookahead,si(l))}),Lt(c,l=>{this.computeLookaheadFunc(n,l.idx,Sf,"RepetitionWithSeparator",l.maxLookahead,si(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=If(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return If(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class E6 extends xs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const wl=new E6;function k6(e){wl.reset(),e.accept(wl);const t=wl.dslMethods;return wl.reset(),t}function gy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function _y(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function v6(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function T6(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const A6="name";function yy(e,t){Object.defineProperty(e,A6,{enumerable:!1,configurable:!0,writable:!1,value:t})}function R6(e,t){const n=pr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function S6(e,t){const n=function(){};yy(n,e+"BaseSemantics");const r={visit:function(i,s){if(re(i)&&(i=i[0]),!Ai(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=O6(this,t);if(!ge(i)){const s=kt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function I6(e,t,n){const r=function(){};yy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Lt(t,s=>{i[s]=R6}),r.prototype=i,r.prototype.constructor=r,r}var Of;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Of||(Of={}));function O6(e,t){return N6(e,t)}function N6(e,t){const n=gr(t,i=>Ei(e[i])===!1),r=kt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Of.MISSING_METHOD,methodName:i}));return _a(r)}class C6{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Ct(t,"nodeLocationTracking")?t.nodeLocationTracking:Ri.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=qe,this.cstFinallyStateUpdate=qe,this.cstPostTerminal=qe,this.cstPostNonTerminal=qe,this.cstPostRule=qe;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=_y,this.setNodeLocationFromNode=_y,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=gy,this.setNodeLocationFromNode=gy,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=qe,this.setInitialNodeLocation=qe;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];v6(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];T6(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Ai(this.baseCstVisitorConstructor)){const t=S6(this.className,pr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Ai(this.baseCstVisitorWithDefaultsConstructor)){const t=I6(this.className,pr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class L6{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):kl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?kl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class M6{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=vl){if(An(this.definedRulesNames,t)){const o={message:vs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Rn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=vl){const i=n6(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(_l(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return FN(He(this.gastProductionsCache))}}class U6{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=dl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ct(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(re(t)){if(ge(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(re(t))this.tokensMap=$n(t,(s,o)=>(s[o.name]=o,s),{});else if(Ct(t,"modes")&&Or(tr(He(t.modes)),OC)){const s=tr(He(t.modes)),o=tl(s);this.tokensMap=$n(o,(a,c)=>(a[c.name]=c,a),{})}else if(dr(t))this.tokensMap=dn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=ks;const r=Ct(t,"modes")?tr(He(t.modes)):He(t),i=Or(r,s=>ge(s.categoryMatches));this.tokenMatcher=i?dl:ka,va(He(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ct(r,"resyncEnabled")?r.resyncEnabled:vl.resyncEnabled,s=Ct(r,"recoveryValueFunc")?r.recoveryValueFunc:vl.recoveryValueFunc,o=this.ruleShortNameIdx<<b6+Yi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(_l(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(my,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Rf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Fe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Rf,t,jC)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(bl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Z_],a,bl,t,Z_)}else throw this.raiseEarlyExitException(t,Fe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Af,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Af,t,DC,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Sf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,J_],a,Sf,t,J_)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,bl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(py,n),i=re(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new p6(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw _l(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new fy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===dy?r:s}}else throw r}saveRecogState(){const t=this.errors,n=dn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),ks)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class F6{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Ct(t,"errorMessageProvider")?t.errorMessageProvider:Ri.errorMessageProvider}SAVE_ERROR(t){if(_l(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:dn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return dn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Ef(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new m6(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=xf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new d6(c,this.LA(1),a))}}class P6{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Ai(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Q_([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Nr(t.ruleStack),i=this.getGAstProductions()[n];return new $C(i,t).startWalking()}}const xl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(xl);const by=!0,wy=Math.pow(2,Yi)-1,xy=er({name:"RECORDING_PHASE_TOKEN",pattern:Ze.NA});va([xy]);const Ey=pl(xy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Ey);const B6={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class $6{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return kl}topLevelRuleRecord(t,n){try{const r=new mo({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Ra.call(this,zn,t,n)}atLeastOneInternalRecord(t,n){Ra.call(this,ri,n,t)}atLeastOneSepFirstInternalRecord(t,n){Ra.call(this,ii,n,t,by)}manyInternalRecord(t,n){Ra.call(this,Je,n,t)}manySepFirstInternalRecord(t,n){Ra.call(this,Lr,n,t,by)}orInternalRecord(t,n){return D6.call(this,t,n)}subruleInternalRecord(t,n,r){if(El(n),!t||Ct(t,"ruleName")===!1){const a=new Error(`<SUBRULE${ky(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=fo(this.recordingProdStack),s=t.ruleName,o=new Dn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?B6:xl}consumeInternalRecord(t,n,r){if(El(n),!$_(t)){const o=new Error(`<CONSUME${ky(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=fo(this.recordingProdStack),s=new Ce({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Ey}}function Ra(e,t,n,r=!1){El(n);const i=fo(this.recordingProdStack),s=Ei(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Ct(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),xl}function D6(e,t){El(t);const n=fo(this.recordingProdStack),r=re(e)===!1,i=r===!1?e:e.DEF,s=new Mr({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Ct(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=hf(i,a=>Ei(a.GATE));return s.hasPredicates=o,n.definition.push(s),Lt(i,a=>{const c=new jn({definition:[]});s.definition.push(c),Ct(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ct(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),xl}function ky(e){return e===0?"":`${e}`}function El(e){if(e<0||e>wy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${wy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class j6{initPerformanceTracer(t){if(Ct(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ri.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=E_(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function z6(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const kl=pl(ks,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(kl);const Ri=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:q_,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),vl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Rn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Rn||(Rn={}));let Nf=class K1{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{k_(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Lt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=h6({rules:He(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ge(r)&&this.skipValidations===!1){const i=f6({rules:He(this.gastProductionsCache),tokenTypes:He(this.tokensMap),errMsgProvider:vs,grammarName:n}),s=qC({lookaheadStrategy:this.lookaheadStrategy,rules:He(this.gastProductionsCache),tokenTypes:He(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ge(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=WN(He(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:He(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(He(this.gastProductionsCache))})),!K1.DEFER_DEFINITION_ERRORS_HANDLING&&!ge(this.definitionErrors))throw t=kt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Ct(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ct(n,"skipValidations")?n.skipValidations:Ri.skipValidations}};Nf.DEFER_DEFINITION_ERRORS_HANDLING=!1,z6(Nf,[_6,x6,C6,L6,U6,M6,F6,P6,$6,j6]);class W6 extends Nf{constructor(t,n=Ri){const r=dn(n);r.outputCst=!0,super(t,r)}}function G6(e){const t=new K6,n=He(e);return kt(n,r=>t.visitRule(r))}class K6 extends xs{visitRule(t){const n=this.visitEach(t.definition),r=y_(n,s=>s.propertyName),i=kt(r,(s,o)=>{const a=!hf(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=kt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:Tl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:Tl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:Tl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:Tl(t)}]}visitEachAndOverrideWith(t,n){return kt(this.visitEach(t),r=>Pn({},r,n))}visitEach(t){return tr(kt(t,n=>this.visit(n)))}}function Tl(e){return e instanceof Dn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function H6(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(tr(kt(e,r=>Y6(r)))),t.includeVisitorInterface&&(n=n.concat(J6(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function Y6(e){const t=V6(e),n=X6(e);return[t,n]}function V6(e){const t=Ty(e.name),n=Cf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function X6(e){return`export type ${Cf(e.name)} = {
  ${kt(e.properties,n=>q6(n)).join(`
  `)}
};`}function q6(e){const t=Q6(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function J6(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${kt(t,n=>Z6(n)).join(`
  `)}
}`}function Z6(e){const t=Cf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function Q6(e){if(re(e)){const t=tl(kt(e,r=>vy(r)));return"("+$n(t,(r,i)=>r+" | "+i)+")"}else return vy(e)}function vy(e){return e.kind==="token"?"IToken":Ty(e.name)}function Ty(e){return Dg(e)+"CstNode"}function Cf(e){return Dg(e)+"CstChildren"}const tL={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function eL(e,t){const n=Object.assign(Object.assign({},tL),t),r=G6(e);return H6(r,n)}const Sa=om(32,126).map(e=>String.fromCharCode(e));function Kt(e){return er({...e,name:`token_${e.name}`})}function Vi(e,t=!1){return Kt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on,group:Ze.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on})}const Ia=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),nL=Kt({name:"whitespace",pattern:/ +/,group:Ze.SKIPPED}),rL=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Ze.SKIPPED}),Lf=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),_o=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Ay=!1;function iL(e,t,n){if(!Ay)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Ia)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const Ry=Kt({name:"text",pattern:iL,line_breaks:!1,start_chars_hint:Sa.filter(e=>"@#/?':!".includes(e)===!1)}),Sy=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Mf=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Iy=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Oy=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),on=Kt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Sa}),Ny=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Cy=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Ly=Kt({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:on}),My=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:on}),Uy=Kt({name:"islessthan",pattern:/<|below/i,longer_alt:on}),Fy=Kt({name:"isgreaterthan",pattern:/>|above/i,longer_alt:on}),Py=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:on}),By=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:on}),Uf=Kt({name:"or",pattern:/or/i,longer_alt:on}),Ff=Kt({name:"not",pattern:/not/i,longer_alt:on}),Pf=Kt({name:"and",pattern:/and/i,longer_alt:on}),Bf=Kt({name:"plus",pattern:/\+/}),$f=Kt({name:"minus",pattern:/-/}),$y=Kt({name:"power",pattern:/\*\*/}),Dy=Kt({name:"multiply",pattern:/\*/}),Df=Kt({name:"divide",pattern:/\//}),jy=Kt({name:"moddivide",pattern:/%/}),zy=Kt({name:"floordivide",pattern:/%%/}),Wy=Kt({name:"query",pattern:/\?/}),Gy=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),Ky=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),Hy=Kt({name:"command_play",pattern:/(play|bgplay) .*/i,start_chars_hint:Sa,longer_alt:on}),Yy=Kt({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Sa,longer_alt:on}),Vy=Kt({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Sa,longer_alt:on}),jf=Kt({name:"if",pattern:/if|try|take|give/i,longer_alt:on}),Al=Vi("do"),zf=Vi("done"),Wf=Vi("else"),Xy=Vi("while"),qy=Vi("repeat"),Jy=Vi("waitfor"),Zy=Kt({name:"foreach",pattern:/foreach|for/i,longer_alt:on}),Qy=Vi("break"),tb=Vi("continue");function eb(e){return[...e,Cy,Ly,My,Py,Uy,By,Fy,Uf,Ff,Pf,Bf,$f,$y,Dy,Df,zy,jy,Wy,Gy,Ky,Ny,on]}const nb=eb([Ry,Lf,Hy,Yy,Vy,_o,Sy,Mf,Iy,Oy,Ia,nL,Qy,tb,zf,Al,Wf,Zy,jf,qy,Jy,Xy]),sL=new Ze({defaultMode:"use_newlines",modes:{use_newlines:nb,ignore_newlines:eb([rL])}},{skipValidations:!Jr,ensureOptimizations:Jr,positionTracking:"full"});function rb(e){Ay=!0;const t=sL.tokenize(e||` 
`),[n]=(ce(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(pl(Ia,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function oL(e,t,n=!0){if(n){const[r,...i]=t;switch(It(r??"")){default:return{type:vt.OBJECT,values:t};case"loader":return{type:vt.LOADER,values:i};case"board":return{type:vt.BOARD,values:i};case"object":return{type:vt.OBJECT,values:i};case"terrain":return{type:vt.TERRAIN,values:i};case"charset":return{type:vt.CHARSET,values:i};case"palette":return{type:vt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=It(i??""),a=[r,e,...s];switch(o){default:return{type:vt.CONST,values:t};case"rn":case"range":return{type:vt.RANGE,values:a};case"sl":case"select":return{type:vt.SELECT,values:a};case"nm":case"number":return{type:vt.NUMBER,values:a};case"tx":case"text":return{type:vt.TEXT,values:a};case"hk":case"hotkey":return{type:vt.HOTKEY,values:a};case"copyit":return{type:vt.COPYIT,values:a};case"openit":return{type:vt.OPENIT,values:a};case"zssedit":return{type:vt.ZSSEDIT,values:a};case"charedit":return{type:vt.CHAREDIT,values:a};case"coloredit":return{type:vt.COLOREDIT,values:a}}}}function nr(e){switch(e){case vt.LOADER:return"loader";case vt.BOARD:return"board";case vt.OBJECT:return"object";case vt.TERRAIN:return"terrain";case vt.CHARSET:return"charset";case vt.PALETTE:return"palette";case vt.CONST:return"const";case vt.RANGE:return"range";case vt.SELECT:return"select";case vt.NUMBER:return"number";case vt.TEXT:return"text";case vt.HOTKEY:return"hotkey";case vt.COPYIT:return"copyit";case vt.OPENIT:return"openit";case vt.ZSSEDIT:return"zssedit";case vt.CHAREDIT:return"charedit";case vt.COLOREDIT:return"coloredit"}}var Gf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Gf||{});function ib(e){return co(e,Gf,{bits:t=>Array.from(t)})}function sb(e){return ia(e,Gf,{bits:t=>new Uint8Array(t)})}function ob(e,t){return{id:Be(),code:e,...t}}var Kf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Kf||{});function aL(e){return co(e,Kf,{board:$F,object:Lc,terrain:Lc,charset:ib,palette:ib,stats:ke})}function cL(e){return ia(e,Kf,{board:DF,object:Mc,terrain:Mc,charset:sb,palette:sb})}function Oa(e){const t={...Ts(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function lL(e){return w(e)?(e.stats=void 0,Ts(e)):{}}function ab(e){const t=rb(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Lf){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=oL(_t(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case vt.LOADER:n.type=yt.LOADER,n.name=f;break;case vt.BOARD:n.type=yt.BOARD,n.name=f;break;case vt.OBJECT:n.type=yt.OBJECT,n.name=f||"object";break;case vt.TERRAIN:n.type=yt.TERRAIN,n.name=f;break;case vt.CHARSET:n.type=yt.CHARSET,n.name=f;break;case vt.PALETTE:n.type=yt.PALETTE,n.name=f;break;case vt.CONST:{const[d,h]=u.values;if(_t(d)){const m=It(d);if(_t(h)){const p=parseFloat(h);n[m]=xt(p)?p:h}else xt(h)?n[m]=h:n[m]=1}break}case vt.RANGE:case vt.SELECT:case vt.NUMBER:case vt.TEXT:case vt.HOTKEY:case vt.ZSSEDIT:case vt.CHAREDIT:case vt.COLOREDIT:{const[d,...h]=u.values;if(_t(d)){const m=It(d);n[m]=[nr(u.type),...h]}break}}}}return n}function Ts(e){var t;return w(e)?(w((t=e.stats)==null?void 0:t.type)||(e.stats=ab(e.code),w(e.stats.type)||(e.stats.type=yt.OBJECT)),e.stats):{}}function cb(e){switch(e){default:case yt.ERROR:return"error";case yt.LOADER:return nr(vt.LOADER);case yt.BOARD:return nr(vt.BOARD);case yt.OBJECT:return nr(vt.OBJECT);case yt.TERRAIN:return nr(vt.TERRAIN);case yt.CHARSET:return nr(vt.CHARSET);case yt.PALETTE:return nr(vt.PALETTE)}}function oi(e){return Ts(e).type??yt.ERROR}function Si(e){return cb(oi(e))}function Le(e){return Ts(e).name??""}function Hf(e,t){return Ts(e)[t]}const Rl=new _h;function uL(e){if(!_t(e))return;const t=vc(e);if(w(t)&&w(Rt[t]))return Rt[t];const n=It(e),r=pt[n];if(w(r))return r}function Yf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ce(s))switch(i){case"name":case"char":case"displaychar":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"color":case"bg":case"displaycolor":case"displaybg":case"lightdir":t[i]=uL(e[i])??e[i];break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=1;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=jt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=jt.ISSWIM;break;case"issolid":t.collision=jt.ISSOLID;break;case"isbullet":t.collision=jt.ISBULLET;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Ae(e){var t;if(w(e))switch(oi(e)){default:return;case yt.ERROR:return e.code??"";case yt.LOADER:return e.code??"";case yt.BOARD:{w(e.board)||(e.board=Vl()),e.board.id=e.id;const n=Oa(e);return n.isdark&&(e.board.isdark=1),n.notdark&&(e.board.isdark=0),xt(n.startx)&&(e.board.startx=n.startx),xt(n.starty)&&(e.board.starty=n.starty),_t(n.over)&&(It(n.over)==="empty"?e.board.over=void 0:e.board.over=n.over,e.board.overboard=void 0),_t(n.under)&&(It(n.under)==="empty"?e.board.under=void 0:e.board.under=n.under,e.board.underboard=void 0),_t(n.camera)&&(It(n.camera)==="empty"?e.board.camera=void 0:e.board.camera=n.camera),_t(n.graphics)&&(It(n.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=n.graphics),xt(n.facing)&&(e.board.facing=n.facing),_t(n.facing)&&It(n.facing)==="empty"&&(e.board.facing=void 0),_t(n.exitnorth)&&(e.board.exitnorth=n.exitnorth),_t(n.exitsouth)&&(e.board.exitsouth=n.exitsouth),_t(n.exitwest)&&(e.board.exitwest=n.exitwest),_t(n.exiteast)&&(e.board.exiteast=n.exiteast),xt(n.timelimit)&&(e.board.timelimit=n.timelimit),n.restartonzap&&(e.board.restartonzap=1),n.norestartonzap&&(e.board.restartonzap=0),xt(n.maxplayershots)&&(e.board.maxplayershots=n.maxplayershots),e.board}case yt.OBJECT:return w(e.object)||(e.object=Km()),e.object.id=e.id,e.object.code=e.code,e.object.name=Le(e),e.object.category=Ln.ISOBJECT,Yf(Oa(e),e.object),e.object;case yt.TERRAIN:return w(e.terrain)||(e.terrain=Km()),e.terrain.id=e.id,e.terrain.name=Le(e),e.terrain.category=Ln.ISTERRAIN,Yf(Oa(e),e.terrain),e.terrain;case yt.PALETTE:{if(w(e.palette)||(e.palette=ng(CT)),w((t=e.palette)==null?void 0:t.bits)){const n=Oa(e),r=Xn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&_t(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Rl.set(o);const c=a*Uc,l=Rl.r*63,u=Rl.g*63,f=Rl.b*63;e.palette.bits[c+0]=fn(l,0,63),e.palette.bits[c+1]=fn(u,0,63),e.palette.bits[c+2]=fn(f,0,63)}}}}return e.palette}case yt.CHARSET:return w(e.charset)||(e.charset=rg(NT)),e.charset}}function Vf(e){return{id:Be(),name:ow(),timestamp:0,activelist:[],pages:e,flags:{}}}var Xf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(Xf||{});function hL(e){return co(e,Xf,{pages:t=>t.map(aL),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function fL(e){return ia(e,Xf,{pages:t=>t.map(cL)})}function lb(e){w(e)&&(e.token=`${aw()}${lr(1111,9999)}`)}function As(e,t){if(!w(e))return;const n=It(t);return e.pages.find(i=>i.id===t||n===Le(i))}function Qe(e,t,n){if(!w(e))return;const r=It(n);return e.pages.find(s=>oi(s)===t&&(s.id===n||r===Le(s)))}function qf(e,t,n){let r=Qe(e,t,n);if(!w(r)){const i=cb(t);return r=ob(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),Jf(e,r),[r,!0]}return[r,!1]}function Rs(e,t){return w(e)?e.pages.filter(n=>oi(n)===t):[]}function ub(e,t,n){if(!w(e))return[];const r=It(n);return e.pages.filter(s=>oi(s)===t).filter(s=>{const o=Ts(s),a=It(Le(s));return s.id===n||r===a||w(o[n])})}function Na(e){return w(e)?wr(e.pages).sort((n,r)=>{const i=oi(n),s=oi(r);return i===s?Le(n).localeCompare(Le(r)):s-i}):[]}function hb(e,t){if(w(t)){const n=Qe(e,yt.TERRAIN,t.kind??"");if(w(n))return n;const r=Qe(e,yt.OBJECT,t.kind??"");if(w(r))return r}}function Jf(e,t){if(!w(e)||!w(t))return!1;const n=As(e,t.id);return w(n)?!1:(e.pages.push(t),lb(e),!0)}function fb(e,t){const n=As(e,t);if(w(e)&&w(n)){const r=It(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Le(i)),lb(e),n}}function Ss(e,t,n,r){const i=e==null?void 0:e.kinddata;return{char:(e==null?void 0:e.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??n,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.bg)??r,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function dL(e,t){return!!(e!=null&&e.flags[t])}function Ii(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function db(e,t){e&&delete e.flags[t]}function pb(e,t,n){const r=Ii(e,t);return r==null?void 0:r[n]}function pL(e,t,n,r){const i=Ii(e,t);return i&&(i[n]=r),r}function mb(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ne(t,{x:s,y:i});ze(o)&&xn(t,o,e.timestamp),Re(t,{x:s,y:i})}}function mL(e,t,n){for(let r=t.y;r<=n.y;++r)for(let i=t.x;i<=n.x;++i)Re(e,{x:i,y:r})}function gb(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ne(t,{x:s,y:i});ze(o)&&xn(t,o,e.timestamp),Re(t,{x:s,y:i})}}function yo(e,t){w(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function Sl(e,t,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return gL(e,t,n,"",i)}if(!w(E.book))return;const s=E.book,o=Qe(s,yt.BOARD,e),a=Ae(o);if(!w(a))return;const c=Qe(s,yt.BOARD,t),l=Ae(c);if(!w(l))return;ve(a),ve(l);let u=!1;if(w(a)&&w(l)){switch(i){case"all":mb(s,l,n,r);break;case"object":gb(s,l,n,r);break;case"terrain":mL(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:d,y:f};let b,y=ne(a,p);if(ze(y)?(b=es(a,d,f),mn(y==null?void 0:y.id)&&(y=void 0)):(b=y,y=void 0),w(b)&&(m||u&&Ht(b,"group")===i)){u&&mb(s,l,p,p);const v=Br(l,[b.kind??""],p);yo(v,b)}if(w(y)&&(h||u&&Ht(y,"group")===i)){u&&gb(s,l,p,p);const v=Br(l,[y.kind??""],p);yo(v,y)}}oa(l)}}function gL(e,t,n,r,i){if(!w(E.book))return;const s=E.book,o=Qe(s,yt.BOARD,e),a=Ae(o);if(!w(a))return;const c=Qe(s,yt.BOARD,t),l=Ae(c);if(w(l)&&(ve(a),ve(l),w(a)&&w(l))){const{terrainelements:u,objectelements:f}=tg(a,r,i);if(u.length===0&&f.length===0)return;const d={x:Tt,y:Gt};for(let h=0;h<u.length;++h){const m=u[h];xt(m.x)&&(d.x=Math.min(d.x,m.x)),xt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<f.length;++h){const m=f[h];xt(m.x)&&(d.x=Math.min(d.x,m.x)),xt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},b=ne(l,p);w(b)&&(ze(b)&&xn(l,b,s.timestamp),Re(l,p));const y=Br(l,[m.kind??""],p);yo(y,m)}for(let h=0;h<f.length;++h){const m=f[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},b=Br(l,[m.kind??""],p);yo(b,m)}oa(l)}}function Ca(e,t){const n=pb(e,t,"board"),r=Pr(yt.BOARD,n);return Ae(r)}function _L(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Il(e,t,n){if(!w(e))return;pL(e,t,"board",n);const r=cn(n);w(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function bo(e,t,n,r,i=!1){if(!w(e))return;const s=ln(t);if(!w(s))return;const o=On(s,t);if(!ze(o)||!(o!=null&&o.id))return;const a=cn(n);if(!w(a)||(ve(a),i===!1&&Uh(a,jt.ISWALK,r,!0)))return;delete s.objects[o.id];const c=$r(s,o);s.lookup&&(s.lookup[c]=void 0),o.x=r.x,o.y=r.y,a.objects[o.id]=o;const l=$r(a,o);a.lookup&&(a.lookup[l]=o.id),Il(e,t,a.id)}function yL(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=pb(e,r,"board");return _t(i)?i:""});return Cv(n)}function wo(e){const t=yL(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=cn(t[i]);if(w(s)&&!n.has(s.id)){if(_t(s.over))if(_t(s.overboard)){const o=cn(s.overboard);w(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=cn(s.over);w(o)&&(s.overboard=o.id)}else _t(s.overboard)&&delete s.overboard;if(r.push(s),_t(s.under))if(_t(s.underboard)){const o=cn(s.underboard);w(o)||delete s.underboard}else{const o=cn(s.under);w(o)&&(s.underboard=o.id)}else _t(s.underboard)&&delete s.underboard}}return r}const bL=om(32,126).map(e=>String.fromCharCode(e)),wL=er({name:"Whitespace",pattern:/ +/}),xL=er({name:"WhitespaceSkipped",pattern:/ +/,group:Ze.SKIPPED}),Zf=er({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),_b=er({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:bL}),Qf=er({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),td=er({name:"EscapedDollar",pattern:"$$"}),ed=er({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),nd=er({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),yb=er({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function EL(e,t=""){return er({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const bb=Object.keys(Jo).map(e=>EL(`\\$(${e})`,e)),kL=[wL,Zf,...bb,Qf,_b,nd,td,yb,ed],vL=new Ze(kL,{skipValidations:!Jr,ensureOptimizations:Jr}),TL=new Ze([xL,Zf,...bb,Qf,_b,nd,td,yb,ed],{skipValidations:!Jr,ensureOptimizations:Jr});function rd(e,t=!1){return t?TL.tokenize(e):vL.tokenize(e)}function id(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function wb(e){e.active={...e.reset}}function xb(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case td:s("$");break;case nd:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case Qf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Zf:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=Jo[l],f=Fv(Rt[u]),d=Pv(Rt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):w(f)?t.active.color=f:w(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(w(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){wb(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;RL(u,u+l.length,t.active.color,t.active.bg,t),AL(u,l,t)}}}function Eb(e,t,n){const r=rd(e);r.tokens&&(xb(r.tokens,t),n&&wb(t),t.changed())}function kb(e,t,n){const r=rd(e);if(!r.tokens)return;const i=id(t,n,Rt.WHITE,Rt.BLACK);return i.measureonly=!0,xb(r.tokens,i),i.x>0&&++i.y,i}function AL(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function RL(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Ol(e,t,n){if(!ms(E.element))return 0;const[r,i]=st(t,0,[H.DIR,H.MAYBE_KIND]),s=i??["bullet"],o=kF(E.board,s,{x:E.element.x,y:E.element.y});if(w(o)){w(n)&&(o.arg=n),o.cycle=1,o.party=E.elementid,o.collision=jt.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-E.element.x,o.stepy=r.destpt.y-E.element.y,o.bg=Rt.ONCLEAR;const a=li(o),c=o.code??(a==null?void 0:a.code)??"";E1(E.book,E.board,o,c)}return e.yield(),0}function Nl(e,t,n,r){var l,u;if(!ms(E.element)||!w(E.book)||!w(E.board)||!w(E.element))return 0;ve(E.board);const[i,s]=st(t,0,[H.DIR,H.KIND]),o=ne(E.board,i.destpt);if((o==null?void 0:o.category)===Ln.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((l=E.element)==null?void 0:l.x)??0,y:((u=E.element)==null?void 0:u.y)??0},d=De(i.destpt,Ar(f,i.destpt));Fh(E.board,o,d)}const[a]=s,c=li({kind:a});if(ze(c)||Br(E.board,s,i.destpt,n),ze(c)){const f=Ht(c,"collision");if(!Uh(E.board,f,i.destpt)){const h=Br(E.board,s,i.destpt,n);w(h)&&w(r)&&(h.arg=r)}}return 0}function vb(e,t,n){if(!w(E.book)||!w(E.board))return 0;ve(E.board);const[r,i]=st(t,0,[H.DIR,H.DIR]),s=ne(E.board,r.destpt);return ze(s),0}const SL={x:0,y:0},IL={x:Tt-1,y:Gt-1},OL="all",NL=xi().command("goto",(e,t)=>{var a,c;if(!w(E.book)||!w(E.board))return 0;const[n,r]=st(t,0,[H.STRING]),[i,s]=st(t,r,[H.MAYBE_NUMBER,H.MAYBE_NUMBER]),o=cn(n);if(w(o)){ve(o);const l={x:((a=E.element)==null?void 0:a.x)??i??Math.round(Tt*.5),y:((c=E.element)==null?void 0:c.y)??s??Math.round(Gt*.5)},u=Sr(E.element),{color:f}=Ss(E.element,-1,-1,-1),d=[];f>-1&&d.push(...Ac(o,[u,[Rt[f]]]));const h=yn(d);w(h)&&xt(h.x)&&xt(h.y)&&(l.x=h.x,l.y=h.y),bo(E.book,E.elementfocus,o.id,l,!0)}return 0}).command("build",(e,t)=>{if(!w(E.book)||!w(E.board)||!w(E.element))return 0;const[n,r]=st(t,0,[H.NAME,H.MAYBE_STRING]),i=Vl();if(w(i)){if(_t(r)){const s=cn(r);w(s)&&Sl(s.id,i.id,SL,IL,OL)}e.set(n,i.id)}return 0}).command("shove",(e,t)=>{if(!w(E.book)||!w(E.board))return 0;ve(E.board);const[n,r]=st(t,0,[H.DIR,H.DIR]),i=ne(E.board,n.destpt);return ze(i)&&ts(E.book,E.board,i,r.destpt),0}).command("dupe",vb).command("duplicate",vb).command("write",(e,t)=>{var d;if(!w(E.book)||!w(E.board))return 0;ve(E.board);const[n,r,i]=st(t,0,[H.DIR,H.COLOR]),s=t.slice(i).map(Te).join(" "),{color:o,bg:a}=mm(r),c=((d=kb(s,256,1))==null?void 0:d.measuredwidth)??1,l=id(256,1,o??Rt.WHITE,a??Rt.BLACK);Eb(s,l,!1);const u=c-1;switch(Ar(n.startpt,n.destpt)){case pt.EAST:for(let h=0;h<c;++h)Re(E.board,{x:n.destpt.x+h,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.WEST:for(let h=0;h<c;++h)Re(E.board,{x:n.destpt.x+h-u,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.NORTH:for(let h=0;h<c;++h)Re(E.board,{x:n.destpt.x,y:n.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.SOUTH:for(let h=0;h<c;++h)Re(E.board,{x:n.destpt.x,y:n.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(e,t)=>{if(!w(E.book)||!w(E.board))return 0;ve(E.board);const[n,r]=st(t,0,[H.KIND,H.KIND]);(Tc(n)??"")==="empty"&&Dv(E.board).forEach(c=>{Br(E.board,r,c)});const s=Tc(r),o=xh(r),a=_m(r);return Ac(E.board,n).forEach(c=>{if(Sr(c)===s)w(o)&&(c.color=o),w(a)&&(c.bg=a);else if(xn(E.board,c,E.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};Br(E.board,r,l)}}),0}).command("put",(e,t)=>Nl(e,t)).command("putwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Nl(e,t.slice(r),void 0,n)}).command("oneof",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return w(E.board)&&On(E.board,n)?0:Nl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=st(t,0,[H.ANY,H.ANY]);return w(E.board)&&On(E.board,r)?0:Nl(e,t.slice(i),r,n)}).command("shoot",Ol).command("shootwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Ol(e,t.slice(r),n)}).command("throwstar",(e,t)=>Ol(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Ol(e,[...t.slice(r),"star"],n)}),Xi="$dkpurple",CL="$196",LL="$205",We="$yellow$205$205$205$196";function _e(e,t,n){Nw(e,t,n)}function ML(e,t,n){const r=CL.repeat(n);_e(e,t,`${Xi}${r}`)}function sd(e,t,n){const r=LL.repeat(n);_e(e,t,`${Xi}${r}`)}function od(e,t,n){_e(e,t,`${Xi} ${" ".repeat(n.length)} `),ML(e,t,n.length+2),_e(e,t,`${Xi} $white${n} `),sd(e,t,n.length+2)}function Is(e,t,n){_e(e,t,`${Xi} ${" ".repeat(n.length)} `),_e(e,t,`${Xi} $gray${n} `),sd(e,t,n.length+2)}function Os(e,t,n,r){_e(e,t,`${Xi} $white${n} $blue${r}`)}function Wn(e,t,n){_e(e,t,`${Xi}$blue${n}`)}function UL(e,t,n,r){_e(e,t,`!${n};${r}`)}var FL=`desc;$DKGRAYname and type of codepage
`,PL=Object.freeze({__proto__:null,default:FL}),BL="desc;changes object into specified element",$L=Object.freeze({__proto__:null,default:BL}),DL="desc;like #play but for sound effects",jL=Object.freeze({__proto__:null,default:DL}),zL="",WL=Object.freeze({__proto__:null,default:zL}),GL="",KL=Object.freeze({__proto__:null,default:GL}),HL="",YL=Object.freeze({__proto__:null,default:HL}),VL="",XL=Object.freeze({__proto__:null,default:VL}),qL="",JL=Object.freeze({__proto__:null,default:qL}),ZL="",QL=Object.freeze({__proto__:null,default:ZL}),tM="",eM=Object.freeze({__proto__:null,default:tM}),nM="",rM=Object.freeze({__proto__:null,default:nM}),iM="",sM=Object.freeze({__proto__:null,default:iM}),oM="",aM=Object.freeze({__proto__:null,default:oM}),cM="",lM=Object.freeze({__proto__:null,default:cM}),uM="",hM=Object.freeze({__proto__:null,default:uM}),fM="",dM=Object.freeze({__proto__:null,default:fM}),pM="",mM=Object.freeze({__proto__:null,default:pM}),gM="",_M=Object.freeze({__proto__:null,default:gM}),yM=`desc;$DKGRAYstarts a section of an if-do-done block
`,bM=Object.freeze({__proto__:null,default:yM}),wM=`desc;$DKGRAYcompletes an if-do-done block
`,xM=Object.freeze({__proto__:null,default:wM}),EM="",kM=Object.freeze({__proto__:null,default:EM}),vM="",TM=Object.freeze({__proto__:null,default:vM}),AM="",RM=Object.freeze({__proto__:null,default:AM}),SM=`desc;$DKGRAYelse logic in an if-do-done block
`,IM=Object.freeze({__proto__:null,default:SM}),OM=`desc;$DKGRAYconditional else logic in an if-do-done block
`,NM=Object.freeze({__proto__:null,default:OM}),CM="",LM=Object.freeze({__proto__:null,default:CM}),MM="",UM=Object.freeze({__proto__:null,default:MM}),FM="",PM=Object.freeze({__proto__:null,default:FM}),BM="",$M=Object.freeze({__proto__:null,default:BM}),DM="",jM=Object.freeze({__proto__:null,default:DM}),zM="",WM=Object.freeze({__proto__:null,default:zM}),GM="",KM=Object.freeze({__proto__:null,default:GM}),HM="",YM=Object.freeze({__proto__:null,default:HM}),VM=`desc;$DKGRAYhalt until the next cycle
`,XM=Object.freeze({__proto__:null,default:VM}),qM=`desc;$DKGRAYevals condition for true or false
`,JM=Object.freeze({__proto__:null,default:qM}),ZM="",QM=Object.freeze({__proto__:null,default:ZM}),t3="",e3=Object.freeze({__proto__:null,default:t3}),n3="",r3=Object.freeze({__proto__:null,default:n3}),i3="",s3=Object.freeze({__proto__:null,default:i3}),o3="",a3=Object.freeze({__proto__:null,default:o3}),c3="",l3=Object.freeze({__proto__:null,default:c3}),u3="",h3=Object.freeze({__proto__:null,default:u3}),f3="",d3=Object.freeze({__proto__:null,default:f3}),p3="",m3=Object.freeze({__proto__:null,default:p3}),g3="",_3=Object.freeze({__proto__:null,default:g3}),y3="",b3=Object.freeze({__proto__:null,default:y3}),w3="",x3=Object.freeze({__proto__:null,default:w3}),E3="",k3=Object.freeze({__proto__:null,default:E3}),v3="",T3=Object.freeze({__proto__:null,default:v3}),A3="",R3=Object.freeze({__proto__:null,default:A3}),S3="",I3=Object.freeze({__proto__:null,default:S3}),O3="",N3=Object.freeze({__proto__:null,default:O3}),C3="",L3=Object.freeze({__proto__:null,default:C3}),M3="",U3=Object.freeze({__proto__:null,default:M3}),F3="",P3=Object.freeze({__proto__:null,default:F3}),B3="",$3=Object.freeze({__proto__:null,default:B3}),D3=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,j3=Object.freeze({__proto__:null,default:D3}),z3="",W3=Object.freeze({__proto__:null,default:z3}),G3="",K3=Object.freeze({__proto__:null,default:G3}),H3="",Y3=Object.freeze({__proto__:null,default:H3}),V3="",X3=Object.freeze({__proto__:null,default:V3}),q3="",J3=Object.freeze({__proto__:null,default:q3}),Z3="",Q3=Object.freeze({__proto__:null,default:Z3}),t8="",e8=Object.freeze({__proto__:null,default:t8}),n8="",r8=Object.freeze({__proto__:null,default:n8}),i8="",s8=Object.freeze({__proto__:null,default:i8}),o8="",a8=Object.freeze({__proto__:null,default:o8}),c8="",l8=Object.freeze({__proto__:null,default:c8}),u8="",h8=Object.freeze({__proto__:null,default:u8}),f8="",d8=Object.freeze({__proto__:null,default:f8}),p8="",m8=Object.freeze({__proto__:null,default:p8}),g8="",_8=Object.freeze({__proto__:null,default:g8}),y8="",b8=Object.freeze({__proto__:null,default:y8}),w8="",x8=Object.freeze({__proto__:null,default:w8}),E8="",k8=Object.freeze({__proto__:null,default:E8}),v8="",T8=Object.freeze({__proto__:null,default:v8}),A8=`desc;$DKGRAYdesignates an inactive label or comment
`,R8=Object.freeze({__proto__:null,default:A8}),S8=`desc;$DKGRAYadds hyperlink text

`,I8=Object.freeze({__proto__:null,default:S8}),O8=`desc;$DKGRAYsends the given message when hotkey is pressed

`,N8=Object.freeze({__proto__:null,default:O8}),C8=`desc;$DKGRAYread number input into given stat/flag
`,L8=Object.freeze({__proto__:null,default:C8}),M8=`desc;$DKGRAYa slider input from 1 to 9 

`,U8=Object.freeze({__proto__:null,default:M8}),F8=`desc;$DKGRAYlist with label value pairs to pick from
`,P8=Object.freeze({__proto__:null,default:F8}),B8=`desc;$DKGRAYread text input into given stat/flag
`,$8=Object.freeze({__proto__:null,default:B8}),D8=`desc;$DKGRAYdesignates a starting point for running code
`,j8=Object.freeze({__proto__:null,default:D8}),z8=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,W8=Object.freeze({__proto__:null,default:z8}),G8=`desc;$DKGRAYwill move the object in the given direction
`,K8=Object.freeze({__proto__:null,default:G8}),H8=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,Y8=Object.freeze({__proto__:null,default:H8}),V8=`desc;$DKGRAYcustom 8x14 charset
`,X8=Object.freeze({__proto__:null,default:V8}),q8=`desc;$DKGRAYsets stat to given value

`,J8=Object.freeze({__proto__:null,default:q8}),Z8=`desc;$DKGRAYsends the given message when hotkey is pressed

`,Q8=Object.freeze({__proto__:null,default:Z8}),tU=`desc;$DKGRAYread external content and/or handle events
`,eU=Object.freeze({__proto__:null,default:tU}),nU=`desc;$DKGRAYread number input into given stat/flag
`,rU=Object.freeze({__proto__:null,default:nU}),iU=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,sU=Object.freeze({__proto__:null,default:iU}),oU=`desc;$DKGRAYcustom palette colors
`,aU=Object.freeze({__proto__:null,default:oU}),cU=`desc;$DKGRAYa slider input from 1 to 9 

`,lU=Object.freeze({__proto__:null,default:cU}),uU=`desc;$DKGRAYlist with label value pairs to pick from
`,hU=Object.freeze({__proto__:null,default:uU}),fU=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,dU=Object.freeze({__proto__:null,default:fU}),pU=`desc;$DKGRAYread text input into given stat/flag
`,mU=Object.freeze({__proto__:null,default:pU}),gU=`desc;$DKGRAYadds text
`,_U=Object.freeze({__proto__:null,default:gU}),yU=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,bU=Object.freeze({__proto__:null,default:yU}),wU=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,xU=Object.freeze({__proto__:null,default:wU}),EU=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,kU=Object.freeze({__proto__:null,default:EU}),vU=`header;player settings
#set user "name goes here"
`,TU=Object.freeze({__proto__:null,default:vU}),AU=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,RU=Object.freeze({__proto__:null,default:AU});const Tb=Object.assign({"./editor/codepagename.txt":PL,"./editor/command/become.txt":$L,"./editor/command/bgplay.txt":jL,"./editor/command/bgvol.txt":WL,"./editor/command/bind.txt":KL,"./editor/command/board.txt":YL,"./editor/command/bpm.txt":XL,"./editor/command/break.txt":JL,"./editor/command/change.txt":QL,"./editor/command/char.txt":eM,"./editor/command/charset.txt":rM,"./editor/command/clear.txt":sM,"./editor/command/color.txt":aM,"./editor/command/continue.txt":lM,"./editor/command/copy.txt":hM,"./editor/command/cycle.txt":dM,"./editor/command/die.txt":mM,"./editor/command/distort.txt":_M,"./editor/command/do.txt":bM,"./editor/command/done.txt":xM,"./editor/command/duplicate.txt":kM,"./editor/command/echo.txt":TM,"./editor/command/edge.txt":RM,"./editor/command/else.txt":IM,"./editor/command/elseif.txt":NM,"./editor/command/end.txt":LM,"./editor/command/endgame.txt":UM,"./editor/command/endwith.txt":PM,"./editor/command/fcrush.txt":$M,"./editor/command/fetch.txt":jM,"./editor/command/fetchwith.txt":WM,"./editor/command/foreach.txt":KM,"./editor/command/go.txt":YM,"./editor/command/idle.txt":XM,"./editor/command/if.txt":JM,"./editor/command/lock.txt":QM,"./editor/command/oneof.txt":e3,"./editor/command/oneofwith.txt":r3,"./editor/command/palette.txt":s3,"./editor/command/phaser.txt":a3,"./editor/command/pivot.txt":l3,"./editor/command/play.txt":h3,"./editor/command/put.txt":d3,"./editor/command/putwith.txt":m3,"./editor/command/readbin.txt":_3,"./editor/command/readjson.txt":b3,"./editor/command/readline.txt":x3,"./editor/command/readrexpaint.txt":k3,"./editor/command/remix.txt":T3,"./editor/command/repeat.txt":R3,"./editor/command/restore.txt":I3,"./editor/command/reverb.txt":N3,"./editor/command/revert.txt":L3,"./editor/command/run.txt":U3,"./editor/command/runwith.txt":P3,"./editor/command/set.txt":$3,"./editor/command/shoot.txt":j3,"./editor/command/shootwith.txt":W3,"./editor/command/shove.txt":K3,"./editor/command/snapshot.txt":Y3,"./editor/command/synth.txt":X3,"./editor/command/toast.txt":J3,"./editor/command/tts.txt":Q3,"./editor/command/ttsvol.txt":e8,"./editor/command/twitchbroadcast.txt":r8,"./editor/command/twitchchat.txt":s8,"./editor/command/unlock.txt":a8,"./editor/command/vibrato.txt":l8,"./editor/command/vol.txt":h8,"./editor/command/waitfor.txt":d8,"./editor/command/walk.txt":m8,"./editor/command/weave.txt":_8,"./editor/command/while.txt":b8,"./editor/command/with.txt":x8,"./editor/command/write.txt":k8,"./editor/command/zap.txt":T8,"./editor/comment.txt":R8,"./editor/hyperlink.txt":I8,"./editor/hyperlink/hotkey.txt":N8,"./editor/hyperlink/number.txt":L8,"./editor/hyperlink/range.txt":U8,"./editor/hyperlink/select.txt":P8,"./editor/hyperlink/text.txt":$8,"./editor/label.txt":j8,"./editor/shortgo.txt":W8,"./editor/shorttry.txt":K8,"./editor/stat/board.txt":Y8,"./editor/stat/charset.txt":X8,"./editor/stat/const.txt":J8,"./editor/stat/hotkey.txt":Q8,"./editor/stat/loader.txt":eU,"./editor/stat/number.txt":rU,"./editor/stat/object.txt":sU,"./editor/stat/palette.txt":aU,"./editor/stat/range.txt":lU,"./editor/stat/select.txt":hU,"./editor/stat/terrain.txt":dU,"./editor/stat/text.txt":mU,"./editor/text.txt":_U,"./help/controls.txt":bU,"./help/developer.txt":xU,"./help/menu.txt":kU,"./help/player.txt":TU,"./help/text.txt":RU}),Ab={};Xn(Tb).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");Ab[t]=Tb[e].default});function SU(e){const t=It(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Ab[t];if(w(n))return n;const{target:r,path:i}=Mn(t);switch(r){case"editor":{const s=Mn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function IU(e,t){const n=(e??"").split(`
`);for(let r=0;r<n.length;++r)t(n[r].split(";"))}function OU(e,t){const[n,...r]=t,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":od(et,e,i);break;case"section":Is(et,e,i);break;case"option":Os(et,e,i,s);break;default:n.trimStart().startsWith("!")?UL(et,e,n.trimStart().slice(1),i):_e(et,e,n);break}}function Oi(e){const[t,n]=st(e,0,[H.NAME,H.ANY]);if(It(t)==="send"&&Rr(n)){const[,r,i,s]=st(e,0,[H.NAME,H.DIR,H.MAYBE_NAME]);return _t(i)&&i.startsWith(":")?{targetdir:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:r,label:e.slice(s-1).join(" ")}}else if(_t(t)){const[r,i,s]=st(e,0,[H.NAME,H.MAYBE_NAME]);return _t(i)&&i.startsWith(":")?{targetname:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetname:"self",label:[r,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Ns(){t0(et,ir())}function La(e){IU(SU(`help:${e}`),t=>OU(E.elementfocus,t))}function Rb(e){switch(e.label){case"helpmenu":La("menu");break;case"helpcontrols":La("controls");break;case"helptext":La("text");break;case"helpdeveloper":La("developer");break;case"helpplayer":La("player");break;default:{const t=oe(Pt.MAIN),n=wo(t);w(e.targetname)?Io(e.targetname,e.label,void 0,n):w(e.targetdir)&&Io(e.targetdir.destpt,e.label,void 0,n);break}}}const NU=xi().command("shortsend",(e,t)=>{const n=Oi(t);return Rb(n),0}).command("send",(e,t)=>{const n=Oi(["send",...t]);return Rb(n),0}).command("stat",(e,t)=>{const[n,...r]=t.map(Te),i=r.join(" ");function s(o,a){if(w(o)&&(e.command("pageopen",o.id),a)){const c=Le(o),l=Si(o);_e(et,E.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(It(n)){case nr(vt.LOADER):{const[o,a]=Qi(Pt.MAIN,i,yt.LOADER);s(o,a);break}default:{const[o,a]=Qi(Pt.MAIN,[n,...r].join(" "),yt.OBJECT);s(o,a);break}case nr(vt.BOARD):{const[o,a]=Qi(Pt.MAIN,i,yt.BOARD);s(o,a);break}case nr(vt.OBJECT):{const[o,a]=Qi(Pt.MAIN,i,yt.OBJECT);s(o,a);break}case nr(vt.TERRAIN):{const[o,a]=Qi(Pt.MAIN,i,yt.TERRAIN);s(o,a);break}case nr(vt.CHARSET):{const[o,a]=Qi(Pt.MAIN,i,yt.CHARSET);s(o,a);break}case nr(vt.PALETTE):{const[o,a]=Qi(Pt.MAIN,i,yt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const n=t.map(Te).join(" ");if(w(E.element)&&E.elementisplayer){const{user:r}=yr(E.elementid),i=_t(r)?r:"player";E.element.tickertext=`${i}: ${n}`,E.element.tickertime=E.timestamp;const s=Ss(E.element,1,Rt.WHITE,Rt.BLACK);xe(et,E.elementid,`$${Rt[s.color]}$ON${Rt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),mu(et,E.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Oi(r);if(w(s.targetname)){const{user:o}=yr(E.elementid),a=_t(o)?o:"player",c=Ss(E.element,1,Rt.WHITE,Rt.BLACK),l=`$${Rt[c.color]}$ON${Rt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;xe(et,E.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[n,r]=st(t,0,[H.MAYBE_NAME,H.MAYBE_STRING]);return _t(n)&&_t(r)?Jd(et,E.elementfocus,n,r):cx(et,E.elementfocus),0}).command("bookcreate",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]),r=_1(n);return w(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=Fr(n);return w(r)?(Jd(et,E.elementfocus,"selected",r.id),Ns()):he(et,E.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=oe(Pt.MAIN),i=Fr(n);return w(i)&&(r===i&&g1(Pt.MAIN,""),AF(n),xe(et,E.elementfocus,`trashed [book] ${i.name}`),Ns(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=cn(n);return w(r)&&bo(E.book,E.elementfocus,r.id,{x:lr(0,Tt-1),y:lr(0,Gt-1)},!0),0}).command("pageopen",(e,t)=>{const[n,r]=st(t,0,[H.NAME,H.MAYBE_NAME]);let i,s;const o=Ur();for(let a=0;a<o.length&&(s=o[a],i=As(s,n),!w(i));++a);if(w(i)&&w(s)){const a=Le(i),c=Si(i);xe(et,E.elementfocus,`opened [${c}] ${a}`);const l=[i.id,r];hh(Ka(s.id,l),i.code);const u=Si(i);Zd(et,E.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else he(et,"pageopen",`page ${n} not found`,E.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=an(Pt.MAIN),i=fb(r,n);if(w(n)){const s=Le(i),o=Si(i);xe(et,E.elementfocus,`trashed [${o}] ${s}`),Ns(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Te).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Is(et,E.elementfocus,"books");const e=oe(Pt.MAIN);Os(et,E.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=oe(Pt.MAIN);Os(et,E.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),sd(et,E.elementfocus,7);const n=Ur();return n.length?n.forEach(r=>{_e(et,E.elementfocus,`!bookopen ${r.id};${r.name}`)}):Wn(et,E.elementfocus,"no books found"),_e(et,E.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=an(Pt.MAIN);if(!w(e))return 0;Is(et,E.elementfocus,"pages"),Os(et,E.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Na(e).forEach(r=>{const i=Le(r),s=Si(r);_e(et,E.elementfocus,`!pageopen ${r.id};$blue[${s}]$white ${i}`)}):(_e(et,E.elementfocus,""),Wn(et,E.elementfocus,"$white no pages found"),Wn(et,E.elementfocus,"$white use @ to create a page"),Wn(et,E.elementfocus,"$white @board name of board"),Wn(et,E.elementfocus,"$white @object name of object"),Wn(et,E.elementfocus,"$white @terrain name of terrain"),Wn(et,E.elementfocus,"$white You can omit the type and it will default to object"),Wn(et,E.elementfocus,"$white @object name of object"),Wn(et,E.elementfocus,"$white @name of object"));const t=Ur();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Os(et,E.elementfocus,"content",`${r.name} $GREEN${r.id}`),Na(r).forEach(s=>{const o=Le(s),a=Si(s);_e(et,E.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Is(et,E.elementfocus,"boards");const e=an(Pt.MAIN);if(w(e)){Os(et,E.elementfocus,"main",`${e.name} $GREEN${e.id}`);const n=Na(e);n.filter(r=>oi(r)===yt.BOARD).forEach(r=>{const i=Le(r);_e(et,E.elementfocus,`!boardopen ${r.id};$blue#goto $white $34 ${i} $34`)}),n.length===0&&(_e(et,E.elementfocus,""),Wn(et,E.elementfocus,"$white no boards found"),Wn(et,E.elementfocus,"$white use @ to create a board"),Wn(et,E.elementfocus,"$white @board name of board"))}const t=Ur();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Os(et,E.elementfocus,"content",`${r.name} $GREEN${r.id}`),Na(r).filter(s=>oi(s)===yt.BOARD).forEach(s=>{const o=Le(s);_e(et,E.elementfocus,`!boardopen ${s.id};$blue#goto $white$34 ${o} $34`)}))}return 0}).command("trash",()=>{Is(et,E.elementfocus,"$REDTRASH"),Wn(et,E.elementfocus,"books");const e=Ur();e.length&&(e.forEach(n=>{_e(et,E.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),_e(et,E.elementfocus,""));const t=oe(Pt.MAIN);return w(t)&&(Wn(et,E.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Le(n);_e(et,E.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),_e(et,E.elementfocus,"")),0}).command("dev",()=>(Ns(),Jw(et,E.elementfocus),0)).command("share",()=>(Ns(),Zw(et,E.elementfocus),0)).command("save",()=>(Ns(),0)).command("fork",()=>(dx(et,E.elementfocus),0)).command("itchiopublish",()=>(px(et,E.elementfocus),0)).command("nuke",()=>(Qw(et,E.elementfocus),0)).command("restart",()=>(fx(et,E.elementfocus),Ns(),0)).command("export",()=>{od(et,E.elementfocus,"E X P O R T"),Is(et,E.elementfocus,"books");const e=Ur();return e.length&&e.forEach(t=>_e(et,E.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=Fr(n);return w(r)&&(od(et,E.elementfocus,"E X P O R T"),Is(et,E.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=Na(r);_e(et,E.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Le(s),a=Si(s);_e(et,E.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=Fr(n);return w(r)&&Xd(et,E.elementfocus,wr(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),{target:r,path:i}=Mn(n),s=Fr(r),o=As(s,i);return w(o)&&Xd(et,E.elementfocus,wr(o),`${Le(o)}.${Si(o)}.json`),0}).command("gadget",()=>(lx(et,E.elementfocus),0)).command("joincode",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return jw(et,E.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return zw(et,E.elementfocus,!!n),0}).command("startlookingglass",()=>(tx(et,E.elementfocus),0)),CU=xi().command("toast",(e,t)=>{const n=t.map(Te).join("");return Yd(et,E.elementfocus,n),0}).command("ticker",(e,t)=>{const n=t.map(Te).join("");return w(E.element)&&(E.element.tickertext=n,E.element.tickertime=E.timestamp),0}).command("palette",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=b1(),i=Qe(E.book,yt.PALETTE,n);return w(i)?(r.palette=i.id,xe(et,E.elementfocus,`loaded palette ${n}`)):he(et,E.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=b1(),i=Qe(E.book,yt.CHARSET,n);return w(i)?(r.charset=i.id,xe(et,E.elementfocus,`loaded charset ${n}`)):he(et,E.elementfocus,"not-found",`unabled to find charset ${n}`),0}),ad={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};jt.ISSOLID,jt.ISWALK,jt.ISSWIM,jt.ISBULLET,jt.ISWALK,jt.ISSWIM;function Cl(e){return ce(e)&&cd(e[0])}function cd(e){return w(jt[e])&&_t(e)}function LU(e){if(_t(e))return ad[It(e)]}function MU(e){const t=E.words[e];if(Cl(t))return[t,e+1];if(cd(t))return[[t],e+1];const[n,r]=Gn(e);return Cl(n)?[n,r]:cd(n)?[[n],r]:[void 0,e]}function xo(e,t=0){const n=[];let r=e;for(;r<E.words.length;){const[i,s]=Gn(r);if(ce(i)&&!Rr(i)&&!Ma(i)&&!Cl(i)&&!Xr(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Gn(e){var r,i,s,o,a,c,l,u,f;const t=E.words[e],n=e+1;if(Ib(t)){const[d,h]=UU(e);if(w(d))return[d,h]}if(LU(t)){const[d,h]=MU(e);if(w(d))return[d,h]}if(vc(t)){const[d,h]=wh(e);if(w(d))return[d,h]}if(_t(t)&&It(t)==="rnd"){const[d,h]=Gn(n),[m,p]=Gn(h);return xt(d)&&xt(m)?[lr(d,m),p]:xt(d)?[lr(0,d),h]:[lr(0,1),n]}if(bh(t)){const[d,h]=lm(e);if(w(d))return[d,h]}if(!w(t))return[void 0,e];if(xt(t)||ce(t))return[t,n];if(_t(t)){const d=It(t),h=(r=E.get)==null?void 0:r.call(E,t);if(w(h))return[h,n];switch(d){case"aligned":case"alligned":{const m=Qo(E.board,{x:((i=E.element)==null?void 0:i.x)??-1,y:((s=E.element)==null?void 0:s.y)??-1},E.elementfocus);return!w(E.element)||!w(m)?[0,n]:[E.element.x===m.x||E.element.y===m.y?1:0,n]}case"contact":{const m=Qo(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus);if(!w(E.element)||!w(m))return[0,n];const p=(m.x??0)-(((c=E.element)==null?void 0:c.x)??0),b=(m.y??0)-(((l=E.element)==null?void 0:l.y)??0);return[p===0&&Math.abs(b)<2||b===0&&Math.abs(p)<2?1:0,n]}case"blocked":{const[m,p]=st(E.words,n,[H.DIR]);return[RT(E.board,E.element,m.destpt)?1:0,p]}case"any":{const[m,p]=st(E.words,n,[H.KIND]);return[Ac(E.board,m).length?1:0,p]}case"count":{const[m,p]=st(E.words,n,[H.KIND]);return[Ac(E.board,m).length,p]}case"color":{const[m,p,b]=st(E.words,n,[H.DIR,H.COLOR]),y=m.layer===pt.MID?ne(E.board,m.destpt):es(E.board,m.destpt.x,m.destpt.y);if(w(y)){const v=Ss(y,-1,-1,-1);return[fm(p)===v.color||dm(p)===v.bg?1:0,b]}return[0,b]}case"detect":{const[m,p,b]=st(E.words,n,[H.DIR,H.KIND]),y=m.layer===pt.MID?ne(E.board,m.destpt):es(E.board,m.destpt.x,m.destpt.y);if(w(y)){const v=It(Tc(p)),T=xh(p),A=Ss(y,-1,-1,-1);if(v&&v===It(Sr(y)))return[1,b];if(w(T)&&T===A.color)return[1,b]}return[0,b]}case"rnd":return[lr(0,1),n];case"abs":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,b,y]=st(E.words,n,[H.NUMBER,H.NUMBER,H.NUMBER]);return[fn(m,p,b),y]}case"min":{const[m,p]=xo(n);return[Math.min(...m),p]}case"max":{const[m,p]=xo(n);return[Math.max(...m),p]}case"pick":{const[m,p]=xo(n);return[yn(m),p]}case"pickwith":{const[m,p]=st(E.words,n,[H.NUMBER_OR_STRING]),[b,y]=xo(p);return[Nv(`${m}`,b),y]}case"random":{const[m,p]=xo(n,2),[b,y]=m;return[lr(b,y??0),p]}case"randomwith":{const[m,p]=st(E.words,n,[H.NUMBER_OR_STRING]),[b,y]=xo(p,2),[v,T]=b;return[sm(`${m}`,v,T??0),y]}case"run":{const[m,p]=st(E.words,n,[H.NAME]);return Yl(m),[(u=E.get)==null?void 0:u.call(E,"arg"),p]}case"runwith":{const[m,p,b]=st(E.words,n,[H.ANY,H.NAME]);return w(E.element)&&(E.element.arg=m),Yl(p),[(f=E.get)==null?void 0:f.call(E,"arg"),b]}}}return[t,n]}const ld={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ma(e){return ce(e)&&Sb(e[0])}function Sb(e){return w(Ln[e])&&_t(e)}function Ib(e){if(_t(e))return ld[It(e)]}function Ob(e){if(Ma(e))return e;if(Sb(e))return[e];const t=Ib(e);if(w(t))return[t]}function UU(e){const t=E.words[e],n=Ob(t);if(Ma(n))return[n,e+1];const[r,i]=Gn(e),s=Ob(r);return Ma(s)?[s,i]:[void 0,e]}const FU=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Nb=new Set(["char","color","bg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"]),PU=["NORTH","SOUTH","WEST","EAST"];function BU(e){const t=yr(e);if(xt(t.inputcurrent)||(t.inputcurrent=0),ce(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=Tn.NONE,i=0]=n??[Tn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&ET?1:0,t.inputctrl=i&kT?1:0,t.inputshift=i&vT?1:0,r){case Tn.MOVE_UP:case Tn.MOVE_DOWN:case Tn.MOVE_LEFT:case Tn.MOVE_RIGHT:t.inputmove=[PU[r-Tn.MOVE_UP]];break;case Tn.OK_BUTTON:t.inputok=1;break;case Tn.CANCEL_BUTTON:t.inputcancel=1;break;case Tn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Tn.NONE&&o!==r}),t}function $U(e){const t=ld[e];if(w(t))return t;const n=ad[e];if(w(n))return n;const r=Jo[e];if(w(r))return r;const i=yh[e];if(w(i))return i}const DU=xi({get(e,t){var o,a,c,l,u,f,d,h,m,p,b,y,v,T,A,U,R,C,j,O,W;const n=$U(t);if(w(n))return[!0,n];if(E.elementisplayer&&FU.has(t)){const q=BU(E.elementid)[t];return[w(q),q]}const r=Qo(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus),i=(r==null?void 0:r.id)??E.elementfocus??ir();switch(t){case"camera":case"graphics":case"facing":if(w((c=E.board)==null?void 0:c[t]))return[!0,(l=E.board)==null?void 0:l[t]];break;case"isdark":return[!0,(u=E.board)!=null&&u.isdark?1:0];case"startx":return[!0,((f=E.board)==null?void 0:f.startx)??0];case"starty":return[!0,((d=E.board)==null?void 0:d.starty)??0];case"over":return[!0,((h=E.board)==null?void 0:h.over)??""];case"under":return[!0,((m=E.board)==null?void 0:m.under)??""];case"exitnorth":return[!0,((p=E.board)==null?void 0:p.exitnorth)??""];case"exitsouth":return[!0,((b=E.board)==null?void 0:b.exitsouth)??""];case"exitwest":return[!0,((y=E.board)==null?void 0:y.exitwest)??""];case"exiteast":return[!0,((v=E.board)==null?void 0:v.exiteast)??""];case"timelimit":return[!0,((T=E.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=E.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((U=E.board)==null?void 0:U.maxplayershots)??0];case"currenttick":return[!0,E.timestamp];case"boardid":return[!0,((R=E.board)==null?void 0:R.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((C=E.element)==null?void 0:C.id)??""];case"thisx":return[!0,((j=E.element)==null?void 0:j.x)??-1];case"thisy":return[!0,((O=E.element)==null?void 0:O.y)??-1];default:{const q=(W=E.element)==null?void 0:W[t];if(Nb.has(t))return[!0,q];break}}const s=yr(i)[t];return[w(s),s]},set(e,t,n){var o,a;const r=Qo(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus),i=(r==null?void 0:r.id)??E.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(w(E.board))return E.board.isdark=n?1:0,[!0,E.board.isdark];break;case"startx":if(w(E.board))return E.board.startx=ca(n,0),[!0,E.board.startx];break;case"starty":if(w(E.board))return E.board.starty=ca(n,0),[!0,E.board.starty];break;case"over":if(w(E.board))return E.board.over=Te(n),[!0,E.board.over];break;case"under":if(w(E.board))return[!0,E.board.under=Te(n)];break;case"exitnorth":if(w(E.board))return[!0,E.board.exitnorth=Te(n)];break;case"exitsouth":if(w(E.board))return[!0,E.board.exitsouth=Te(n)];break;case"exitwest":if(w(E.board))return[!0,E.board.exitwest=Te(n)];break;case"exiteast":if(w(E.board))return[!0,E.board.exiteast=Te(n)];break;case"timelimit":if(w(E.board))return[!0,E.board.timelimit=ca(n,0)];break;case"restartonzap":if(w(E.board))return[!0,E.board.restartonzap=n?1:0];break;case"maxplayershots":if(w(E.board))return[!0,E.board.maxplayershots=ca(n,0)];break;case"currenttick":return[!1,n];case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(Nb.has(t))return w(E.element)&&(E.element[t]=n),[!0,n];break}}const s=yr(i);return w(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=E.element)!=null&&e.removed)&&(w((t=E.element)==null?void 0:t.stepx)||w((n=E.element)==null?void 0:n.stepy))){const s={x:((r=E.element)==null?void 0:r.x)??0,y:((i=E.element)==null?void 0:i.y)??0};ts(E.book,E.board,E.element,{x:s.x+(E.element.stepx??0),y:s.y+(E.element.stepy??0)})===!1&&(E.element.stepx=0,E.element.stepy=0,Ht(E.element,"breakable")&&xn(E.board,E.element,E.timestamp))}}}).command("clear",(e,t)=>{for(let n=0;n<t.length;++n)e.set(Te(t[n]),0);return 0}).command("set",(e,t)=>{const[n,r]=st(t,0,[H.NAME,H.ANY]);return e.set(n,r??1),0}).command("become",(e,t)=>{var r,i;const[n]=st(t,0,[H.KIND]);if(ve(E.board),Nh(E.board,E.element),xn(E.board,E.element,E.timestamp)){const s={x:((r=E.element)==null?void 0:r.x)??0,y:((i=E.element)==null?void 0:i.y)??0};Br(E.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=st(t,0,[H.ANY]);if(Rr(n)){const[r,i]=st(t,0,[H.DIR,H.NUMBER]),s=ne(E.board,r.destpt);w(s)&&(s.char=i)}else w(E.element)&&xt(n)&&(E.element.char=n);return 0}).command("color",(e,t)=>{const[n]=st(t,0,[H.ANY]);if(Rr(n)){const[r,i]=st(t,0,[H.DIR,H.COLOR]),s=ne(E.board,r.destpt);w(s)&&sa(E.element,i)}else{const[r]=st(t,0,[H.COLOR]);w(E.element)&&w(r)&&sa(E.element,r)}return 0}).command("go",(e,t)=>{if(w(E.element)){const[n]=st(t,0,[H.DIR]);if(ts(E.book,E.board,E.element,n.destpt),e.yield(),E.element.x===n.destpt.x&&E.element.y===n.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!w(E.element))return 0;const[n]=st(t,0,[H.DIR]),r=E.element.x??0,i=E.element.y??0;return E.element.stepx=n.destpt.x-r,E.element.stepy=n.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=st(t,0,[H.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Te(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Te(t[0])),0)).command("cycle",(e,t)=>{if(w(E.element)){const[n]=st(t,0,[H.NUMBER]);E.element.cycle=fn(Math.round(n),1,255)}return 0}).command("die",e=>(xn(E.board,E.element,E.timestamp),e.endofprogram(),0)).command("endgame",()=>(Qd(et,E.elementfocus),0)).command("run",(e,t)=>{const[n]=st(t,0,[H.NAME]);return Yl(n),0}).command("runwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY,H.NAME]);return e.set("arg",n),Yl(r),0}),Ll={};function jU(e){var t;return(t=Ll[e])==null?void 0:t.arg}function zU(e){var t;return(t=Ll[e])==null?void 0:t.format}function Eo(e){var t;return(t=Ll[e])==null?void 0:t.content}function Cb(e,t,n,r,i){const s=oe(Pt.MAIN);if(!w(s))return;const o=Rs(s,yt.LOADER).filter(a=>{const c=Ts(a),l=c.format,u=_t(l)?new RegExp(l).test(t):!1,f=c.event,d=_t(f)?new RegExp(f).test(n):!1;return _t(l)&&_t(f)?u&&d:_t(l)?u:_t(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${Be()}_loader`;Ll[c]={arg:e,format:t,content:r,player:i},NF(c,o[a].code)}}function Lb(e,t){if(!w(e))return;const n=It(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const WU=(e,t)=>{const n=Eo(e.id());if(!w(n))return 0;const[r,i]=st(t,0,[H.NAME]),s=It(r);switch(s){case"seek":{const[o]=st(t,i,[H.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=st(t,i,[H.NAME]);e.set(o,Lb(n,s));break}case"text":{const[o,a]=st(t,i,[H.NAME,H.NAME]),c=Lb(n,o);if(xt(c)&&_t(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);e.set(a,f),n.cursor+=c}break}case"palette":{const[o]=st(t,i,[H.NAME]),[a]=qf(E.book,yt.PALETTE,o),c=Ae(a);if(w(c)){const l=mT*Uc,u=ng(new Uint8Array(n.bytes.buffer,n.cursor,l));w(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=st(t,i,[H.NAME]),[a]=qf(E.book,yt.CHARSET,o),c=Ae(a);if(w(c)){const l=Fc*pT*Lh,u=rg(new Uint8Array(n.bytes.buffer,n.cursor,l));w(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},ko=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Ml=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Ml(e[n],t[n]))return!1;return!0}if(ko(e)&&ko(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Ml(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Ul=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(ko(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},GU=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Mb=e=>e>="0"&&e<="9"||e==="-",KU=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var X;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(X||(X={}));const Ub={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},HU={"!":!0,"<":!0,"=":!0,">":!0},YU={"	":!0,"\n":!0,"\r":!0," ":!0};class VU{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(GU(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Ub[t[this._current]]!==void 0)n.push({start:this._current,type:Ub[t[this._current]],value:t[this._current]}),this._current+=1;else if(Mb(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(HU[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(YU[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&KU(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Mb(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const XU=new VU,bn={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class qU{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...XU.tokenize(t),{type:X.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<bn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case X.TOK_LITERAL:return{type:"Literal",value:t.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(bn.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(bn.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(t.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(bn.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(bn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(bn.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case X.TOK_DOT:const i=bn.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(bn.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(bn.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(bn.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(bn.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(bn.Flatten);return{type:"Projection",children:[u,f]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,t);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(bn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(bn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(bn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(t);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(bn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const JU=new qU;var ft;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ft||(ft={}));class ZU{constructor(t){this.TYPE_NAME_TABLE={[ft.TYPE_NUMBER]:"number",[ft.TYPE_ANY]:"any",[ft.TYPE_STRING]:"string",[ft.TYPE_ARRAY]:"array",[ft.TYPE_OBJECT]:"object",[ft.TYPE_BOOLEAN]:"boolean",[ft.TYPE_EXPREF]:"expression",[ft.TYPE_NULL]:"null",[ft.TYPE_ARRAY_NUMBER]:"Array<number>",[ft.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>ko(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ft.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ft.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ft.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ft.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ft.TYPE_NUMBER,ft.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ft.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ft.TYPE_NUMBER?n:r===ft.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ft.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ft.TYPE_NUMBER:return"number";case ft.TYPE_STRING:return"string";case ft.TYPE_ARRAY:return"array";case ft.TYPE_OBJECT:return"object";case ft.TYPE_BOOLEAN:return"boolean";case ft.TYPE_EXPREF:return"expref";case ft.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ft.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ft.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]},{types:[ft.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ft.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ft.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY,ft.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ft.TYPE_EXPREF]},{types:[ft.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ft.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ft.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ft.TYPE_ARRAY_STRING,ft.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ft.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ft.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ft.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ft.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ft.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(p=>{var b;return(b=!p.optional)!==null&&b!==void 0?b:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,m;for(let p=0;p<r.length;p+=1){m=!1,d=r[p].types,h=this.getTypeName(n[p]);let b;for(b=0;b<d.length;b+=1)if(h!==void 0&&this.typeMatches(h,d[b],n[p])){m=!0;break}if(!m&&h!==void 0){const y=d.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(t,n,r){if(n===ft.TYPE_ANY)return!0;if(n===ft.TYPE_ARRAY_STRING||n===ft.TYPE_ARRAY_NUMBER||n===ft.TYPE_ARRAY){if(n===ft.TYPE_ARRAY)return t===ft.TYPE_ARRAY;if(t===ft.TYPE_ARRAY){let i;n===ft.TYPE_ARRAY_NUMBER?i=ft.TYPE_NUMBER:n===ft.TYPE_ARRAY_STRING&&(i=ft.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ft.TYPE_STRING;case"[object Number]":return ft.TYPE_NUMBER;case"[object Array]":return ft.TYPE_ARRAY;case"[object Boolean]":return ft.TYPE_BOOLEAN;case"[object Null]":return ft.TYPE_NULL;case"[object Object]":return t.jmespathType===X.TOK_EXPREF?ft.TYPE_EXPREF:ft.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class QU{constructor(){this._rootValue=null,this.runtime=new ZU(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,f,d,h;switch(t.type){case"Field":return n===null?null:ko(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let m=t.value;return m<0&&(m=n.length+m),s=n[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const p=[...t.children],b=this.computeSliceParams(n.length,p),[y,v,T]=b;if(s=[],T>0)for(d=y;d<v;d+=T)s.push(n[d]);else for(d=y;d>v;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(t.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(t.children[0],n),!ko(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(t.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;const U=[],R=[];for(d=0;d<h.length;d+=1)r=this.visit(t.children[2],h[d]),Ul(r)||U.push(h[d]);for(let L=0;L<U.length;L+=1)i=this.visit(t.children[1],U[L]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case X.TOK_EQ:s=Ml(o,a);break;case X.TOK_NE:s=!Ml(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case X.TOK_FLATTEN:const C=this.visit(t.children[0],n);if(!Array.isArray(C))return null;let j=[];for(d=0;d<C.length;d+=1)i=C[d],Array.isArray(i)?j=[...j,...i]:j.push(i);return j;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<t.children.length;d+=1)f.push(this.visit(t.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let O;for(d=0;d<t.children.length;d+=1)O=t.children[d],f[O.name]=this.visit(O.value,n);return f;case"OrExpression":return r=this.visit(t.children[0],n),Ul(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Ul(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Ul(o);case"Literal":return t.value;case X.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const W=[];for(let L=0;L<t.children.length;L+=1)W.push(this.visit(t.children[L],n));return this.runtime.callFunction(t.name,W);case"ExpressionReference":const q=t.children[0];return q.jmespathType=X.TOK_EXPREF,q;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const t2=new QU;ft.TYPE_ANY,ft.TYPE_ARRAY,ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING,ft.TYPE_BOOLEAN,ft.TYPE_EXPREF,ft.TYPE_NULL,ft.TYPE_NUMBER,ft.TYPE_OBJECT,ft.TYPE_STRING;function e2(e,t){const n=JU.parse(t);return t2.search(n,e)}const n2=(e,t)=>{const n=Eo(e.id());if(!w(n))return 0;const[r,i]=st(t,0,[H.NAME,H.NAME]),s=e2(n.json,r);return e.set(i,s),0},r2=(e,t)=>{const n=Eo(e.id());if(!w(n))return 0;const[r,i]=st(t,0,[H.NAME]);switch(It(r)){case"seek":{const[o]=st(t,i,[H.NUMBER]);n.cursor=fn(o,0,n.lines.length-1);break}case"line":n.cursor=fn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[f,d]=st(t,u,[H.NAME]);e.set(f,c[l]??0),++l,u=d}break}}return 0};function Fb(e){const t=oe(Pt.MAIN),n=wo(t);w(e.targetdir)?Io(e.targetdir.destpt,e.label,void 0,n):w(e.targetname)&&Io(e.targetname,e.label,void 0,n)}const i2=xi({get(e,t){const n=zU(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const n=Oi(t);return Fb(n),0}).command("send",(e,t)=>{const n=Oi(["send",...t]);return Fb(n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join(" ");return xe(et,E.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Oi(r);return w(s.targetname)&&xe(et,E.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",r2).command("readjson",n2).command("readbin",WU).command("withboard",(e,t)=>{const[n]=st(t,0,[H.STRING]),r=cn(n);return w(r)&&(E.board=r,E.element={x:-1,y:-1}),0});function Pb(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=st(i,a,[H.ANY]);ce(c)&&!Rr(c)&&!Ma(c)&&!Cl(c)&&!Xr(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":Fw(et,E.elementfocus,e,t,n,r,o);break}return 0}const s2=xi().command("fetch",(e,t)=>{const[n,r,i="get",s]=st(t,0,[H.NAME,H.NAME,H.MAYBE_STRING]);return Pb(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=st(t,0,[H.ANY,H.NAME,H.NAME,H.MAYBE_STRING]);return Pb(n,r,i,s,t,o),0}).command("chat",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return n?Mw(et,E.elementfocus,n):Uw(et,E.elementfocus),0}).command("broadcast",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return n?Cw(et,E.elementfocus,n):Lw(et,E.elementfocus),0});function Bb(e,t){var n,r;if(w(t.targetname))switch(t.targetname){case"all":for(const i of Object.keys(((n=E.board)==null?void 0:n.objects)??{}))e.send(E.elementfocus,i,t.label);break;case"self":e.message({session:et.session(),player:E.elementfocus,id:Be(),sender:e.id(),target:t.label});break;case"others":for(const i of Object.keys(((r=E.board)==null?void 0:r.objects)??{}))i!==e.id()&&e.send(E.elementfocus,i,t.label);break;default:{const i=ym(E.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];w(o.id)&&e.send(E.elementfocus,o.id,t.label)}break}}else if(w(t.targetdir)){const i=ne(E.board,t.targetdir.destpt);w(i==null?void 0:i.id)&&e.send(E.elementfocus,i.id,t.label)}}const o2=xi({set(e,t,n){return qF(e,t,n),[!1,void 0]},everytick(){const e=kn(E.elementid),[t]=e;if(e.length===1&&_t(t)){if(w(E.element))if(t.trim().length===0){const n=Ke(E.elementid);n.sidebar=[]}else E.element.tickertext=t,E.element.tickertime=E.timestamp}else if(e.length>1)if(E.elementisplayer){const n=Ke(E.elementid);n.sidebar=e}else{const n=Ke(E.elementfocus);n.scroll=e}}}).command("shortsend",(e,t)=>{const n=Oi(t);return Bb(e,n),0}).command("send",(e,t)=>{const n=Oi(["send",...t]);return Bb(e,n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join("");return At(E.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Oi(r);return w(s.targetname)&&Nt(E.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function a2(e,t,n,r,i){if(!w(E.book))return;const s=E.book,o=Qe(s,yt.BOARD,e),a=Ae(o);if(!w(a))return;const c=Vl(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";ve(a),ve(c);const f=-Math.tan(t*.5),d=Math.sin(t),h=Math.round(12.5*f),m=Math.round(12.5*d),p=new Array(Gt).fill(0);qp(h,0,-h,Gt-1).forEach(A=>{A.x<0?p[A.y]=Math.min(p[A.y],A.x):p[A.y]=Math.max(p[A.y],A.x)});const y=new Array(Tt).fill(0);qp(0,m,Tt-1,-m).forEach(A=>{A.y<0?y[A.x]=Math.min(y[A.x],A.y):y[A.x]=Math.max(y[A.x],A.y)});const T=[p,y,p];for(let A=0;A<T.length;++A){const U=T[A];if(A!==1){for(let R=0;R<Gt;++R){const C=U[R],j=R*Tt;for(let O=0;O<Tt;O++){const W=(O+C+Tt)%Tt;u&&(c.terrain[W+j]=a.terrain[O+j])}}if(l){const R=Object.keys(a.objects);for(let C=0;C<R.length;++C){const j=R[C],{x:O,y:W}=a.objects[j];if(w(O)&&w(W)){const q=U[W];a.objects[j].x=(O+q+Tt)%Tt,a.objects[j].lx=a.objects[j].x}}}}if(A===1){for(let R=0;R<Tt;++R){const C=U[R];for(let j=0;j<Gt;++j){const O=(j+C+Gt)%Gt;u&&(c.terrain[R+O*Tt]=a.terrain[R+j*Tt])}}if(l){const R=Object.keys(a.objects);for(let C=0;C<R.length;++C){const j=R[C],{x:O,y:W}=a.objects[j];if(w(O)&&w(W)){const q=U[O];a.objects[j].y=(W+q+Gt)%Gt,a.objects[j].ly=a.objects[j].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,ve(c),ve(a)}}function c2(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var l2=c2;const u2=l2,te=function(){};te.prototype.FMX=0,te.prototype.FMY=0,te.prototype.FMXxFMY=0,te.prototype.T=0,te.prototype.N=0,te.prototype.initiliazedField=!1,te.prototype.generationComplete=!1,te.prototype.wave=null,te.prototype.compatible=null,te.prototype.weightLogWeights=null,te.prototype.sumOfWeights=0,te.prototype.sumOfWeightLogWeights=0,te.prototype.startingEntropy=0,te.prototype.sumsOfOnes=null,te.prototype.sumsOfWeights=null,te.prototype.sumsOfWeightLogWeights=null,te.prototype.entropies=null,te.prototype.propagator=null,te.prototype.observed=null,te.prototype.distribution=null,te.prototype.stack=null,te.prototype.stackSize=0,te.prototype.DX=[-1,0,1,0],te.prototype.DY=[0,1,0,-1],te.prototype.opposite=[2,3,0,1],te.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},te.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=u2(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},te.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],m=f[h];m[i]--,m[i]==0&&this.ban(l,h)}}}},te.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},te.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},te.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},te.prototype.isGenerationComplete=function(){return this.generationComplete},te.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},te.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var $b=te;const Db=$b,Ni=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let O=0;O<f;O++)d[O]=new Array(r);this.colors=[];const h={};for(let O=0;O<r;O++)for(let W=0;W<n;W++){const q=(O*n+W)*4,L=[t[q],t[q+1],t[q+2],t[q+3]],I=L.join("-");h.hasOwnProperty(I)||(h[I]=this.colors.length,this.colors.push(L)),d[W][O]=h[I]}const m=this.colors.length,p=Math.pow(m,i*i),b=function(W){let q=new Array(i*i);for(let L=0;L<i;L++)for(let I=0;I<i;I++)q[I+L*i]=W(I,L);return q},y=function(W,q){return b(function(L,I){return d[(W+L)%n][(q+I)%r]})},v=function(W){return b(function(q,L){return W[i-1-L+q*i]})},T=function(W){return b(function(q,L){return W[i-1-q+L*i]})},A=function(W){let q=0,L=1;for(let I=0;I<W.length;I++)q+=W[W.length-1-I]*L,L*=m;return q},U=function(W){let q=W,L=p;const I=new Array(i*i);for(let x=0;x<I.length;x++){L/=m;let N=0;for(;q>=L;)q-=L,N++;I[x]=N}return I},R={},C=[];for(let O=0;O<(a?r:r-i+1);O++)for(let W=0;W<(a?n:n-i+1);W++){const q=new Array(8);q[0]=y(W,O),q[1]=T(q[0]),q[2]=v(q[0]),q[3]=T(q[2]),q[4]=v(q[2]),q[5]=T(q[4]),q[6]=v(q[4]),q[7]=T(q[6]);for(let L=0;L<l;L++){const I=A(q[L]);R[I]?R[I]++:(C.push(I),R[I]=1)}}this.T=C.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let O=0;O<this.T;O++){const W=parseInt(C[O],10);this.patterns[O]=U(W),this.weights[O]=R[W]}const j=function(W,q,L,I){const x=L<0?0:L,N=L<0?L+i:i,$=I<0?0:I,P=I<0?I+i:i;for(let it=$;it<P;it++)for(let Q=x;Q<N;Q++)if(W[Q+i*it]!=q[Q-L+i*(it-I)])return!1;return!0};this.propagator=new Array(4);for(let O=0;O<4;O++){this.propagator[O]=new Array(this.T);for(let W=0;W<this.T;W++){const q=[];for(let L=0;L<this.T;L++)j(this.patterns[W],this.patterns[L],this.DX[O],this.DY[O])&&q.push(L);this.propagator[O][W]=q}}};Ni.prototype=Object.create(Db.prototype),Ni.prototype.constructor=Ni,Ni.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ni.prototype.clear=function(){if(Db.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ni.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ni.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ni.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const m=d+h*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const b=this.colors[this.patterns[p][f+u*this.N]];s+=b[0],o+=b[1],a+=b[2],c+=b[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var h2=Ni;const f2=$b,qi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(A){const U=new Array(o*o);for(let R=0;R<o;R++)for(let C=0;C<o;C++)U[C+R*o]=A(C,R);return U},u=function(A){return l(function(U,R){return A[o-1-R+U*o]})},f=function(A){return l(function(U,R){return A[o-1-U+R*o]})};this.tiles=[];const d=[],h=[],m={};let p,b,y;for(let T=0;T<t.tiles.length;T++){const A=t.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":y=4,p=function(R){return(R+1)%4},b=function(R){return R%2===0?R+1:R-1};break;case"T":y=4,p=function(R){return(R+1)%4},b=function(R){return R%2===0?R:4-R};break;case"I":y=2,p=function(R){return 1-R},b=function(R){return R};break;case"\\":y=2,p=function(R){return 1-R},b=function(R){return 1-R};break;case"F":y=8,p=function(R){return R<4?(R+1)%4:4+(R-1)%4},b=function(R){return R<4?R+4:R-4};break;default:y=1,p=function(R){return R},b=function(R){return R};break}this.T=h.length,m[A.name]=this.T;for(let R=0;R<y;R++)h.push([this.T+R,this.T+p(R),this.T+p(p(R)),this.T+p(p(p(R))),this.T+b(R),this.T+b(p(R)),this.T+b(p(p(R))),this.T+b(p(p(p(R))))]);let U;if(a)for(let R=0;R<y;R++)U=A.bitmap[R],this.tiles.push(l(function(C,j){return[U[(o*j+C)*4],U[(o*j+C)*4+1],U[(o*j+C)*4+2],U[(o*j+C)*4+3]]}));else{U=A.bitmap,this.tiles.push(l(function(R,C){return[U[(o*C+R)*4],U[(o*C+R)*4+1],U[(o*C+R)*4+2],U[(o*C+R)*4+3]]}));for(let R=1;R<y;R++)this.tiles.push(R<4?u(this.tiles[this.T+R-1]):f(this.tiles[this.T+R-4]))}for(let R=0;R<y;R++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const v=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),v[T]=new Array(this.T);for(let A=0;A<this.T;A++){v[T][A]=new Array(this.T);for(let U=0;U<this.T;U++)v[T][A][U]=!1}}for(let T=0;T<t.neighbors.length;T++){const A=t.neighbors[T],U=A.left.split(" ").filter(function(q){return q.length}),R=A.right.split(" ").filter(function(q){return q.length});if(c!==null&&(c.indexOf(U[0])===-1||c.indexOf(R[0])===-1))continue;const C=h[m[U[0]]][U.length==1?0:parseInt(U[1],10)],j=h[C][1],O=h[m[R[0]]][R.length==1?0:parseInt(R[1],10)],W=h[O][1];v[0][O][C]=!0,v[0][h[O][6]][h[C][6]]=!0,v[0][h[C][4]][h[O][4]]=!0,v[0][h[C][2]][h[O][2]]=!0,v[1][W][j]=!0,v[1][h[j][6]][h[W][6]]=!0,v[1][h[W][4]][h[j][4]]=!0,v[1][h[j][2]][h[W][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)v[2][T][A]=v[0][A][T],v[3][T][A]=v[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const U=[],R=v[T][A];for(let C=0;C<this.T;C++)R[C]&&U.push(C);this.propagator[T][A]=U}};qi.prototype=Object.create(f2.prototype),qi.prototype.constructor=qi,qi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},qi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},qi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},qi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let f=0,d=0,h=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const b=this.tiles[p][l+c*this.tilesize],y=this.weights[p]*a;f+=b[0]*y,d+=b[1]*y,h+=b[2]*y,m+=b[3]*y}e[u]=f,e[u+1]=d,e[u+2]=h,e[u+3]=m}}}};var d2=qi,p2={OverlappingModel:h2,SimpleTiledModel:d2},m2=Us(p2);const jb=5;function zb(e,t,n,r,i,s,o){if(!w(E.book))return!1;const a=E.book,c=Qe(a,yt.BOARD,e),l=Qe(a,yt.BOARD,t),u=Ae(c),f=Ae(l);if(!w(u)||!w(f))return!1;ve(u),ve(f);let d=0;const h=new Map,m=new Map;let p=0;const b=32,y=new Uint8Array(Eh*4);for(let C=0;C<Gt;++C)for(let j=0;j<Tt;++j){const O=ne(f,{x:j,y:C}),W=(O==null?void 0:O.char)??0,q=(O==null?void 0:O.color)??b,L=(O==null?void 0:O.bg)??b;y[p++]=W,y[p++]=q,y[p++]=L;const I=li(O),x=It((I==null?void 0:I.name)??"empty"),N=h.get(x);xt(N)?y[p++]=N:(h.set(x,d),m.set(d,x),y[p++]=d++)}const v=s.x-i.x+1,T=s.y-i.y+1,A=new m2.OverlappingModel(y,Tt,Gt,n,v,T,!1,!1,r,0);let U=0;for(;U<jb&&!A.generate();++U);if(U===jb)return!1;p=0;const R=A.graphics();for(let C=i.y;C<=s.y;++C)for(let j=i.x;j<=s.x;++j){const O={x:j,y:C},W=R[p++],q=R[p++],L=R[p++];switch(d=R[p++],o){case"all":{const $=ne(u,{x:j,y:C});ze($)&&xn(u,$,a.timestamp),Re(u,{x:j,y:C});break}case"object":{const $=ne(u,{x:j,y:C});ze($)&&xn(u,$,a.timestamp);break}case"terrain":Re(u,{x:j,y:C});break}let I=m.get(d)??"";const x=li({kind:I});switch(o){case"all":break;case"object":ze(x)||(I="");break;case"terrain":ze(x)&&(I="");break;default:if(Ht(x,"group")!==o&&(I=""),I){const $=ne(u,{x:j,y:C});ze($)&&xn(u,$,a.timestamp),Re(u,{x:j,y:C})}break}const N=I?Br(u,[I],O):void 0;if(!(!w(N)||!w(x))&&(yo(N,x),W>0&&(N.char=W),q<b&&(N.color=q),L<b&&(N.bg=L),ze(N))){const $=yn(ta(f,I));w($)&&(Re(u,{...es(f,$.x??0,$.y??0),x:j,y:C}),yo(N,$))}}return!0}function Wb(e){return`zss_snapshot_${e}`}const Gb={x:0,y:0},Kb={x:Tt-1,y:Gt-1},Hb="all";function g2(e){const t=Qe(E.book,yt.BOARD,e),n=Ae(t);if(!w(n))return;const r=Wb(n.id);fb(E.book,r);const[i]=Qi(Pt.MAIN,r,yt.BOARD),s=Ae(i);if(w(s))return Sl(e,s.id,Gb,Kb,Hb),s}function _2(e){const t=Qe(E.book,yt.BOARD,e),n=Ae(t);if(!w(n))return;const r=Wb(n.id),i=Qe(E.book,yt.BOARD,r),s=Ae(i);if(w(s))return Sl(s.id,e,Gb,Kb,Hb),s}function y2(e,t,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return b2(e,t,i,s)}if(!w(E.book))return;const o=E.book,a=Qe(o,yt.BOARD,e),c=Ae(a);if(!w(c))return;const l=Vl();ve(c);for(let u=n.y;u<=r.y;++u)for(let f=n.x;f<=r.x;++f){let d=!1,h=!1;switch(s){case"all":d=!0,h=!0;break;case"object":d=!0;break;case"terrain":h=!0;break}const m=(f+t.x+Tt)%Tt,p=(u+t.y+Gt)%Gt;if(d){const b=ne(c,{x:f,y:u});ze(b)&&w(b==null?void 0:b.x)&&w(b==null?void 0:b.y)&&(b.x=m,b.lx=m,b.y=p,b.ly=p)}h&&(l.terrain[m+p*Tt]=c.terrain[f+u*Tt])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),oa(c)}function b2(e,t,n,r){if(!w(E.book))return;const i=E.book,s=Qe(i,yt.BOARD,e),o=Ae(s);if(!w(o))return;ve(o);const{terrainelements:a,objectelements:c}=tg(o,n,r);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>cr({x:p.x??0,y:p.y??0},Tt)),f=[],d=[];for(let p=0;p<a.length;++p){const b=a[p],y={x:b.x??-1,y:b.y??-1},v=ne(o,y);w(v)&&ze(v)&&(f.push(v.id??""),f.push(v.id??""),d.push(cr({x:v.x??0,y:v.y??0},Tt)))}let h=!1;for(let p=0;p<a.length;++p){const b=a[p],y=Ht(b,"collision"),v={x:b.x??-1,y:b.y??-1},T=cr(v,Tt),A={x:v.x+t.x,y:v.y+t.y};if(Xl(A)){const U=ne(o,A),R=(U==null?void 0:U.id)??"",C=cr({x:(U==null?void 0:U.x)??0,y:(U==null?void 0:U.y)??0},Tt),j=Ht(U,"collision");if(w(U)&&ze(U)&&f.includes(R)!==!0&&l.includes(R)!==!0){let O=!1;const W=d.includes(T),q=W?ne(o,v):void 0,L=W?Ht(q,"pushable"):!1,I=W&&L;if(Ht(U,"pushable")&&(y!==jt.ISWALK||W)){let x=W;w(q)&&L&&(h=ts(i,o,q,{x:(q.x??0)-t.x,y:(q.y??0)-t.y})!==!0,h||(x=!1)),(x||y!==jt.ISWALK)&&(h=ts(i,o,U,{x:(U.x??0)+t.x,y:(U.y??0)+t.y})!==!0,h&&(O=I))}else(y!==jt.ISWALK||I)&&(h=!0,O=I);O&&w(q)&&(h=ts(i,o,q,{x:(q.x??0)-t.x,y:(q.y??0)-t.y})!==!0)}else j===jt.ISSOLID&&u.includes(C)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const b=c[p],y=Ht(b,"collision"),v={x:b.x??0,y:b.y??0},T={x:v.x+t.x,y:v.y+t.y};if(Xl(T)){const A=ne(o,T),U=(A==null?void 0:A.id)??"",R=Ht(A,"collision"),C=Ht(A,"group");w(A)&&ze(A)&&f.includes(U)&&l.includes(U)!==!0?Ht(A,"pushable")?h=ts(i,o,A,T)!==!0:h=!0:Zo(y,R)&&r!==C&&(h=!0)}else h=!0}if(h)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const b=a[p],y={x:b.x??-1,y:b.y??-1},v={x:y.x+t.x,y:y.y+t.y},T=es(o,v.x,v.y);if(w(b)&&w(T)){Re(o,{...b,x:v.x,y:v.y}),Re(o,{...T,x:y.x,y:y.y});const A=ne(o,y);ze(A)&&w(A)&&(A.x=(A.x??0)+t.x,A.y=(A.y??0)+t.y,A.lx=(A.lx??0)+t.x,A.ly=(A.ly??0)+t.y)}}oa(o);for(let p=0;p<c.length;++p){const b=c[p],y={x:b.x??-1,y:b.y??-1},v={x:y.x+t.x,y:y.y+t.y};if(!ts(i,o,b,v))break}oa(o)}function Fl(e,t){let n="all";const r={x:0,y:0},i={x:Tt-1,y:Gt-1};for(let s=t;s<e.length;){const[o,a]=st(e,s,[H.MAYBE_NUMBER_OR_STRING]);if(_t(o))n=It(o),s=a;else if(xt(o)){const[c,l,u,f]=st(e,a,[H.NUMBER,H.MAYBE_NUMBER,H.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const w2=xi().command("snapshot",()=>(!w(E.book)||!w(E.board)||g2(E.board.id),0)).command("revert",()=>(!w(E.book)||!w(E.board)||_2(E.board.id),0)).command("copy",(e,t)=>{if(!w(E.book)||!w(E.board))return 0;const[n,r]=st(t,0,[H.STRING]),i=bookreadcodepagesbytypeandstat(E.book,yt.BOARD,n),s=yn(...i);if(w(s)){const o=Fl(t,r);Sl(s.id,E.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!w(E.book)||!w(E.board))return 0;const[n,r,i,s]=st(t,0,[H.STRING,H.NUMBER,H.NUMBER]),o=bookreadcodepagesbytypeandstat(E.book,yt.BOARD,n),a=yn(...o);if(w(a)){const c=Fl(t,s);zb(E.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!w(E.book)||!w(E.board))return 0;const[n,r]=st(t,0,[H.DIR]),i={x:n.destpt.x-(((o=E.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=E.element)==null?void 0:a.y)??0)},s=Fl(t,r);return y2(E.board.id,i,s.pt1,s.pt2,E.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!w(E.book)||!w(E.board))return 0;const[n,r]=st(t,0,[H.NUMBER]),i=Fl(t,r);return a2(E.board.id,rm(n),i.pt1,i.pt2,i.targetset),0});var Ji=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Ji||{});const x2={audio:Mh,board:NL,cli:NU,display:CU,element:DU,runtime:o2,loader:i2,network:s2,transform:w2},ud=["audio","board","display","network","transform","element"],E2={0:[],1:["cli",...ud],2:["loader",...ud],3:["runtime",...ud]},k2={0:new Map,1:new Map,2:new Map,3:new Map};function vo(e){return(E2[e]??[]).map(n=>x2[n]).filter(w)}function hd(e){const t=[],n=vo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function v2(e,t){const n=k2[e];if(!n.has(t)){let r;const i=vo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!w(r));++s);n.set(t,r)}return n.get(t)}function T2(e,t,n){const r=vo(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function A2(e,t,n,r){const i=vo(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function R2(e,t){const n=vo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function Yb(e,t){const n=vo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var Vb={},Xb={},qb={};const Jb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");qb.encode=function(e){if(0<=e&&e<Jb.length)return Jb[e];throw new TypeError("Must be between 0 and 63: "+e)};const S2=qb,Zb=5,Qb=1<<Zb,I2=Qb-1,O2=Qb;function N2(e){return e<0?(-e<<1)+1:(e<<1)+0}Xb.encode=function(t){let n="",r,i=N2(t);do r=i&I2,i>>>=Zb,i>0&&(r|=O2),n+=S2.encode(r);while(i>0);return n};var Ua={};(function(e){function t(R,C,j){if(C in R)return R[C];if(arguments.length===3)return j;throw new Error('"'+C+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const C=R.match(n);return C?{scheme:C[1],auth:C[2],host:C[3],port:C[4],path:C[5]}:null}e.urlParse=i;function s(R){let C="";return R.scheme&&(C+=R.scheme+":"),C+="//",R.auth&&(C+=R.auth+"@"),R.host&&(C+=R.host),R.port&&(C+=":"+R.port),R.path&&(C+=R.path),C}e.urlGenerate=s;const o=32;function a(R){const C=[];return function(j){for(let W=0;W<C.length;W++)if(C[W].input===j){const q=C[0];return C[0]=C[W],C[W]=q,C[0].result}const O=R(j);return C.unshift({input:j,result:O}),C.length>o&&C.pop(),O}}const c=a(function(C){let j=C;const O=i(C);if(O){if(!O.path)return C;j=O.path}const W=e.isAbsolute(j),q=[];let L=0,I=0;for(;;)if(L=I,I=j.indexOf("/",L),I===-1){q.push(j.slice(L));break}else for(q.push(j.slice(L,I));I<j.length&&j[I]==="/";)I++;let x=0;for(I=q.length-1;I>=0;I--){const N=q[I];N==="."?q.splice(I,1):N===".."?x++:x>0&&(N===""?(q.splice(I+1,x),x=0):(q.splice(I,2),x--))}return j=q.join("/"),j===""&&(j=W?"/":"."),O?(O.path=j,s(O)):j});e.normalize=c;function l(R,C){R===""&&(R="."),C===""&&(C=".");const j=i(C),O=i(R);if(O&&(R=O.path||"/"),j&&!j.scheme)return O&&(j.scheme=O.scheme),s(j);if(j||C.match(r))return C;if(O&&!O.host&&!O.path)return O.host=C,s(O);const W=C.charAt(0)==="/"?C:c(R.replace(/\/+$/,"")+"/"+C);return O?(O.path=W,s(O)):W}e.join=l,e.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function u(R,C){R===""&&(R="."),R=R.replace(/\/$/,"");let j=0;for(;C.indexOf(R+"/")!==0;){const O=R.lastIndexOf("/");if(O<0||(R=R.slice(0,O),R.match(/^([^\/]+:\/)?\/*$/)))return C;++j}return Array(j+1).join("../")+C.substr(R.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(R){return R}function h(R){return p(R)?"$"+R:R}e.toSetString=f?d:h;function m(R){return p(R)?R.slice(1):R}e.fromSetString=f?d:m;function p(R){if(!R)return!1;const C=R.length;if(C<9||R.charCodeAt(C-1)!==95||R.charCodeAt(C-2)!==95||R.charCodeAt(C-3)!==111||R.charCodeAt(C-4)!==116||R.charCodeAt(C-5)!==111||R.charCodeAt(C-6)!==114||R.charCodeAt(C-7)!==112||R.charCodeAt(C-8)!==95||R.charCodeAt(C-9)!==95)return!1;for(let j=C-10;j>=0;j--)if(R.charCodeAt(j)!==36)return!1;return!0}function b(R,C,j){let O=v(R.source,C.source);return O!==0||(O=R.originalLine-C.originalLine,O!==0)||(O=R.originalColumn-C.originalColumn,O!==0||j)||(O=R.generatedColumn-C.generatedColumn,O!==0)||(O=R.generatedLine-C.generatedLine,O!==0)?O:v(R.name,C.name)}e.compareByOriginalPositions=b;function y(R,C,j){let O=R.generatedLine-C.generatedLine;return O!==0||(O=R.generatedColumn-C.generatedColumn,O!==0||j)||(O=v(R.source,C.source),O!==0)||(O=R.originalLine-C.originalLine,O!==0)||(O=R.originalColumn-C.originalColumn,O!==0)?O:v(R.name,C.name)}e.compareByGeneratedPositionsDeflated=y;function v(R,C){return R===C?0:R===null?1:C===null?-1:R>C?1:-1}function T(R,C){let j=R.generatedLine-C.generatedLine;return j!==0||(j=R.generatedColumn-C.generatedColumn,j!==0)||(j=v(R.source,C.source),j!==0)||(j=R.originalLine-C.originalLine,j!==0)||(j=R.originalColumn-C.originalColumn,j!==0)?j:v(R.name,C.name)}e.compareByGeneratedPositionsInflated=T;function A(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=A;function U(R,C,j){if(C=C||"",R&&(R[R.length-1]!=="/"&&C[0]!=="/"&&(R+="/"),C=R+C),j){const O=i(j);if(!O)throw new Error("sourceMapURL could not be parsed");if(O.path){const W=O.path.lastIndexOf("/");W>=0&&(O.path=O.path.substring(0,W+1))}C=l(s(O),C)}return c(C)}e.computeSourceURL=U})(Ua);var fd={};let C2=class H1{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new H1;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};fd.ArraySet=C2;var t1={};const e1=Ua;function L2(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||e1.compareByGeneratedPositionsInflated(e,t)<=0}let M2=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){L2(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(e1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};t1.MappingList=M2;const Fa=Xb,Ye=Ua,Pl=fd.ArraySet,U2=t1.MappingList;let n1=class Y1{constructor(t){t||(t={}),this._file=Ye.getArg(t,"file",null),this._sourceRoot=Ye.getArg(t,"sourceRoot",null),this._skipValidation=Ye.getArg(t,"skipValidation",!1),this._sources=new Pl,this._names=new Pl,this._mappings=new U2,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new Y1({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ye.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Ye.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Ye.getArg(t,"generated"),r=Ye.getArg(t,"original",null);let i=Ye.getArg(t,"source",null),s=Ye.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Ye.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ye.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ye.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Ye.relative(s,i));const o=this._mappings.toArray().length>0?new Pl:this._sources,a=new Pl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=Ye.join(r,c.source)),s!=null&&(c.source=Ye.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=Ye.join(r,c)),s!=null&&(c=Ye.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,m=d.length;h<m;h++){if(l=d[h],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Ye.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Fa.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Fa.encode(f-o),o=f,c+=Fa.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Fa.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Fa.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ye.relative(n,r));const i=Ye.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};n1.prototype._version=3,Vb.SourceMapGenerator=n1;var r1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(r1);var Pa={exports:{}},F2={},P2=Object.freeze({__proto__:null,default:F2}),i1=V1(P2);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Pa.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Pa.exports.initialize=t=>e=t}else{const e=i1,t=i1;Pa.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Pa.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var s1=Pa.exports;const B2=s1;function $2(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Ba=null;var D2=function(){if(Ba)return Ba;const t=[];return Ba=B2().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new $2;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Ba=null,n}),Ba};const St=Ua,dd=r1,Bl=fd.ArraySet,j2=s1,z2=D2,pd=Symbol("smcInternal");class Ge{constructor(t,n){return t==pd?Promise.resolve(this):G2(t,n)}static initialize(t){j2.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return K2(t,n)}static async with(t,n,r){const i=await new Ge(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Ge.prototype._version=3,Ge.GENERATED_ORDER=1,Ge.ORIGINAL_ORDER=2,Ge.GREATEST_LOWER_BOUND=1,Ge.LEAST_UPPER_BOUND=2;class $a extends Ge{constructor(t,n){return super(pd).then(r=>{let i=t;typeof t=="string"&&(i=St.parseSourceMapInput(t));const s=St.getArg(i,"version");let o=St.getArg(i,"sources");const a=St.getArg(i,"names",[]);let c=St.getArg(i,"sourceRoot",null);const l=St.getArg(i,"sourcesContent",null),u=St.getArg(i,"mappings"),f=St.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=St.normalize(c)),o=o.map(String).map(St.normalize).map(function(d){return c&&St.isAbsolute(c)&&St.isAbsolute(d)?St.relative(c,d):d}),r._names=Bl.fromArray(a.map(String),!0),r._sources=Bl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return St.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,z2().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=St.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new $a(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Ge.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=St.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Ge.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Ge.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=St.getArg(t,"source");const r=St.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:St.getArg(t,"line"),generatedColumn:St.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=St.getArg(t,"bias",Ge.GREATEST_LOWER_BOUND);r==null&&(r=Ge.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=St.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=St.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=St.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:St.getArg(i,"originalLine",null),column:St.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=St.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=St.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=St.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:St.getArg(t,"line"),originalColumn:St.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=St.getArg(t,"bias",Ge.GREATEST_LOWER_BOUND);i==null&&(i=Ge.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:St.getArg(s,"generatedLine",null),column:St.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}$a.prototype.consumer=Ge;class W2 extends Ge{constructor(t,n){return super(pd).then(r=>{let i=t;typeof t=="string"&&(i=St.parseSourceMapInput(t));const s=St.getArg(i,"version"),o=St.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Bl,r._names=new Bl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=St.getArg(c,"offset"),u=St.getArg(l,"line"),f=St.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Ge(St.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(St.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(St.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:St.getArg(t,"line"),generatedColumn:St.getArg(t,"column")},r=dd.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(St.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=St.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||Ge.GENERATED_ORDER;let o;switch(s){case Ge.GENERATED_ORDER:o=this._generatedMappings;break;case Ge.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=St.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return dd.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=St.getArg(t,"line"),r={source:St.getArg(t,"source"),originalLine:n,originalColumn:St.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",St.compareByOriginalPositions,dd.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:St.getArg(o,"generatedLine",null),column:St.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:St.getArg(o,"generatedLine",null),column:St.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function G2(e,t){let n=e;typeof e=="string"&&(n=St.parseSourceMapInput(e));const r=n.sections!=null?new W2(n,t):new $a(n,t);return Promise.resolve(r)}function K2(e,t){return $a.fromSourceMap(e,t)}var o1={};const H2=Vb.SourceMapGenerator,$l=Ua,Y2=/(\r?\n)/,V2=10,To="$$$isSourceNode$$$";let X2=class Ld{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[To]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new Ld,s=t.split(Y2);let o=0;const a=function(){const h=p(),m=p()||"";return h+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const m=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,m),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const m=n.sourceContentFor(h);m!=null&&(r!=null&&(h=$l.join(r,h)),i.setSourceContent(h,m))}),i;function d(h,m){if(h===null||h.source===void 0)i.add(m);else{const p=r?$l.join(r,h.source):h.source;i.add(new Ld(h.originalLine,h.originalColumn,p,m,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[To]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[To]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[To]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[To]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[$l.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][To]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t($l.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new H2(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===V2?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};o1.SourceNode=X2;var q2=o1.SourceNode;let a1=0;const c1=Jr,J2=["Command","lines"];class Z2 extends W6{constructor(){super(nb,{traceInitPerf:Jr,skipValidations:!Jr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ut(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ut(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Ia)}])}));Ut(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ut(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ut(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.commands)}])}));Ut(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Mf)}));Ut(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Lf)}));Ut(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Ry)}])}));Ut(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Sy)}));Ut(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Iy),this.OPTION(()=>{this.SUBRULE(this.words)}),this.CONSUME(Oy)}));Ut(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(_o),this.SUBRULE(this.commands)}));Ut(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ut(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ut(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Df),this.SUBRULE(this.words)}));Ut(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Wy),this.SUBRULE(this.words)}));Ut(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(jf),this.SUBRULE(this.expr),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ut(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Al),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Ia)),this.CONSUME4(_o),this.CONSUME4(zf)}}])}));Ut(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Al),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(_o),this.CONSUME(zf)}}])}));Ut(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Al),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ut(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(_o),this.CONSUME(Wf),this.CONSUME(jf),this.SUBRULE(this.expr),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ut(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(_o),this.CONSUME(Wf),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ut(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(Xy),this.SUBRULE(this.expr),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ut(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(qy),this.SUBRULE(this.expr),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ut(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(Jy),this.SUBRULE(this.expr)}));Ut(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(Zy),this.SUBRULE(this.expr),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ut(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(Qy)}));Ut(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(tb)}));Ut(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Hy)}));Ut(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Yy)}));Ut(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(Vy)}));Ut(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Uf),this.SUBRULE2(this.and_test)})}));Ut(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Pf),this.SUBRULE2(this.not_test)})}));Ut(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Ff),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ut(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ut(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Ly)},{ALT:()=>this.CONSUME(My)},{ALT:()=>this.CONSUME(Uy)},{ALT:()=>this.CONSUME(Fy)},{ALT:()=>this.CONSUME(Py)},{ALT:()=>this.CONSUME(By)}])}));Ut(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Uf),this.SUBRULE2(this.and_test_value)})}));Ut(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Pf),this.SUBRULE2(this.not_test_value)})}));Ut(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Ff),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ut(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ut(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Bf)},{ALT:()=>this.CONSUME($f)}]),this.SUBRULE(this.term)}));Ut(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ut(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Dy)},{ALT:()=>this.CONSUME(Df)},{ALT:()=>this.CONSUME(jy)},{ALT:()=>this.CONSUME(zy)}]),this.SUBRULE(this.factor)}));Ut(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Bf)},{ALT:()=>this.CONSUME($f)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ut(this,"power",this.RULED("power",()=>{this.SUBRULE(this.words),this.OPTION(()=>{this.CONSUME($y),this.SUBRULE(this.factor)})}));Ut(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.token))}));Ut(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Mf)},{ALT:()=>this.CONSUME(Ny)},{ALT:()=>this.CONSUME(on)},{ALT:()=>this.CONSUME(Cy)},{ALT:()=>{this.CONSUME(Gy),this.SUBRULE(this.expr),this.CONSUME(Ky)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=J2.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(a1++).toString().padStart(3),c=s?"font-weight: bold;":"";if(c1&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),c1&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),a1--},i)}}const Ao=new Z2;if(TT){const e=Ao.getGAstProductions(),t=eL(e);console.info(t)}const Q2=Ao.getBaseCstVisitorConstructor();var wt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(wt||{}),Cs=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Cs||{}),ai=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(ai||{}),Dl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Dl||{});function Kn(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class tF extends Q2{constructor(){super();Ut(this,"unique",0);Jr&&this.validateVisitor()}visit(n){if(ce(n)&&(n=n[0]),!!w(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createtemplatenode(n,r){return this.createcodenode(n,{type:12,literal:2,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():w(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Kn(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Kn(n.token_stat,"@").slice(1)}))}stmt_text(n,r){const i=Kn(n.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:i}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Kn(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:Kn(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}commands(n,r){return n.words?this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)})):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.command_ticker?this.go(n.command_ticker):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,Kn(n.token_if,"if"),"",this.go(n.expr)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=Be(),s=Be();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=Be(),s=Be();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,Kn(n.token_if,"if"),i,this.go(n.expr)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){return this.createcodenode(r,{type:17,lines:this.go(n.command_fork)})}command_while(n,r){const i=Be(),s=Be();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.expr)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=Be(),s=Be(),a=[this.createcountnode(r),this.go(n.expr)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=Be(),s=Be(),a=[this.createcountnode(r),this.go(n.expr)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=Be();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.expr))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=Kn(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}))}command_toast(n,r){const s=Kn(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"toast"),this.createtemplatenode(r,s)].flat()}))}command_ticker(n,r){const s=Kn(n.token_command_ticker,"").replace("ticker","").trim();return this.createlinenode(r,this.createcodenode(r,{type:11,words:[this.createstringnode(r,"ticker"),this.createtemplatenode(r,s)].flat()}))}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.words);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.token)}token(n,r){if(n.token_label){const i=Kn(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=Kn(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Kn(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Kn(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return n.token_lparen?this.createcodenode(r,{type:31,words:this.go(n.expr)}):[]}}const eF=new tF,Hn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},jl="zss.js";function ee(e,t){return new q2(e.startLine??1,e.startColumn??1,jl,t)}function md(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function gd(e){return`'${md(e)}'`}function _d(e){const t=rd(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===ed?`', api.get('${md(r.image.substring(1))}'), '`:md(r.image)).join("")}'].join('')`}function Ro(e){return e.filter(t=>t!==void 0).map(se)}function l1(e){return ee(e,"")}function nF(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function tn(e,t,n){return ee(e,[`api.${t}(`,...nF(n,", "),")"])}function rF(e){if(e.type===wt.COMPARE&&e.compare.type===wt.COMPARE_ITEM)switch(e.compare.method){case Cs.IS_EQ:return tn(e,"isEq",[se(e.lhs),se(e.rhs)]);case Cs.IS_NOT_EQ:return tn(e,"isNotEq",[se(e.lhs),se(e.rhs)]);case Cs.IS_LESS_THAN:return tn(e,"isLessThan",[se(e.lhs),se(e.rhs)]);case Cs.IS_GREATER_THAN:return tn(e,"isGreaterThan",[se(e.lhs),se(e.rhs)]);case Cs.IS_LESS_THAN_OR_EQ:return tn(e,"isLessThanOrEq",[se(e.lhs),se(e.rhs)]);case Cs.IS_GREATER_THAN_OR_EQ:return tn(e,"isGreaterThanOrEq",[se(e.lhs),se(e.rhs)])}return ee(e,"")}function Ls(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",se(n),")"])}function u1(e,t,n){return e.prepend(`api.${t}(`),e.add([se(n),")"])}function iF(e,t){if(e.type===wt.OPERATOR_ITEM)switch(e.operator){case ai.PLUS:return Ls(t,"opPlus",e.rhs);case ai.MINUS:return Ls(t,"opMinus",e.rhs);case ai.POWER:return Ls(t,"opPower",e.rhs);case ai.MULTIPLY:return Ls(t,"opMultiply",e.rhs);case ai.DIVIDE:return Ls(t,"opDivide",e.rhs);case ai.MOD_DIVIDE:return Ls(t,"opModDivide",e.rhs);case ai.FLOOR_DIVIDE:return Ls(t,"opFloorDivide",e.rhs);case ai.UNI_PLUS:return u1(t,"opUniPlus",e.rhs);case ai.UNI_MINUS:return u1(t,"opUniMinus",e.rhs)}return ee(e,"")}function sF(e){if(e.type===wt.OPERATOR){const t=e.lhs?se(e.lhs):ee(e,"");return e.items.forEach(n=>iF(n,t)),t}return ee(e,"")}function zl(e,t){return ee(e,[tn(e,"jump",[`${t}`]),"; continue;"])}function Ci(e){return Hn.linelookup[e??""]??-1}function yd(e,t){Hn.linelookup[e]=t}function So(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&(i.done=n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&(i.skip=n);break;case wt.LINE:So(i.stmts,t,n);break}}}function h1(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&yd(i.done,n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&yd(i.skip,n);break;case wt.LINE:h1(i.stmts,t,n);break}}}function se(e){var t;switch(e.type){case wt.PROGRAM:return ee(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(se).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${jl}`]);case wt.API:return ee(e,["  ",tn(e,e.method,Ro(e.words)),`;
`]);case wt.LINE:return ee(e,[`case ${e.lineindex}:
`,...e.stmts.map(se).flat(),`  break;
`]);case wt.MARK:return ee(e,`  // ${e.comment}
`);case wt.GOTO:{const n=Ci(e.id);return ee(e,["  ",zl(e,n),`
`])}case wt.COUNT:return ee(e,`${e.index}`);case wt.LITERAL:switch(e.literal){case Dl.NUMBER:return ee(e,`${e.value}`);case Dl.STRING:return ee(e,gd(e.value));case Dl.TEMPLATE:return ee(e,_d(e.value))}return l1(e);case wt.TEXT:return ee(e,["  ",tn(e,"text",[_d(e.value)]),`;
`]);case wt.STAT:if(Hn.isfirststat){Hn.isfirststat=!1;const n=e.value.trim().split(" ").map(gd);return ee(e,["  ",tn(e,"stat",n),`;
`])}return ee(e,`  // skipped ${e.value}
`);case wt.LABEL:{const n=It(e.name),r=e.active?"label":"comment";Hn.labels[n]||(Hn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Hn.labels[n].push(i),ee(e,`  // ${i} '${n}' ${r}
`)}case wt.HYPERLINK:return ee(e,["  ",tn(e,"hyperlink",[_d(e.text),...Ro(e.link)]),`;
`]);case wt.MOVE:{const n=tn(e,"command",[gd("go"),Ro(e.words)].flat());return e.wait?ee(e,["  if (",n,`) { continue; };
`]):ee(e,["  ",n,`;
`])}case wt.COMMAND:return ee(e,["  if (",tn(e,"command",Ro(e.words)),`) { continue; };
`]);case wt.IF:{const n=((t=e.block)==null?void 0:t.type)===wt.IF_BLOCK?e.block:void 0;if(w(n)){So([e.check],wt.IF_CHECK,n.skip);const r=ee(e,se(e.check));return n.lines.forEach(i=>r.add(se(i))),h1(n.altlines,wt.ELSE_IF,Ci(n.done)),n.altlines.forEach(i=>r.add(se(i))),r}return ee(e,se(e.check))}case wt.IF_CHECK:{const n=Ci(e.skip);return n===-1?ee(e,["  ",tn(e,e.method,Ro(e.words)),`;
`]):ee(e,["  if (!",tn(e,e.method,Ro(e.words)),") { ",zl(e,n),` }
`])}case wt.ELSE_IF:case wt.ELSE:{const n=ee(e,"");return e.lines.forEach(r=>n.add(se(r))),n}case wt.WHILE:{const n=Ci(e.loop),r=Ci(e.done),i=ee(e,"");return So(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case wt.REPEAT:{const n=Ci(e.loop),r=Ci(e.done),i=ee(e,"");return So(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case wt.WAITFOR:{const n=ee(e,"");return So(e.lines,wt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(se(r))}),n}case wt.FOREACH:{const n=Ci(e.loop),r=Ci(e.done),i=ee(e,"");return So(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(se(s))}),i}case wt.BREAK:return ee(e,["  ",zl(e,e.goto),`
`]);case wt.CONTINUE:return ee(e,["  ",zl(e,e.goto),`
`]);case wt.OR:return tn(e,"or",e.items.map(se));case wt.AND:return tn(e,"and",e.items.map(se));case wt.NOT:return tn(e,"not",e.items.map(se));case wt.COMPARE:return rF(e);case wt.OPERATOR:return sF(e);case wt.EXPR:return tn(e,"expr",e.words.map(se));default:return console.error("<unsupported node>",e.type,e),l1(e)}}function ci(e){if(w(e))switch(e.type===wt.LINE&&++Hn.lineindex,e.lineindex=Hn.lineindex,e.type){case wt.PROGRAM:e.lines.forEach(ci);break;case wt.LINE:e.stmts.forEach(ci);break;case wt.MARK:yd(e.id,e.lineindex);break;case wt.IF:ci(e.check),ci(e.block);break;case wt.IF_BLOCK:e.lines.forEach(ci),e.altlines.forEach(ci);break;case wt.ELSE_IF:e.lines.forEach(ci);break;case wt.ELSE:case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.WAITFOR:e.lines.forEach(ci);break;case wt.MOVE:case wt.COMMAND:case wt.IF_CHECK:e.words.forEach(ci);break}}function oF(e){Hn.labels={},Hn.internal=1,Hn.lineindex=0,Hn.isfirststat=!0,ci(e)}function aF(e){return oF(e),{...se(e).toStringWithSourceMap({file:`${jl}.map`}),...Hn}}function f1(e){return ce(e)?e.length>0?1:0:e??0}function cF(e){return`${e}_chip`}function d1(e=""){return`vm:${e??""}`}function lF(e,t,n){var l,u;const r=cF(e),i=yr(r);let s;const o=wr(Object.entries(n.labels??{}));(!ce(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){E.words=d;const h=v2(t,f);return w(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){vF(r)},id(){return e},set(f,d){const[h,m]=A2(t,c,f,d);if(h)return m},get(f){const[d,h]=T2(t,c,f);if(d)return h},tick(f){const d=xt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return Yb(t,c),!1;i.lc=0,i.ys=0,E.get=c.get,R2(t,c);try{const m=s==null?void 0:s.next();m!=null&&m.done&&(i.es=1)}catch(m){he(et,E.elementfocus,"crash",m.message),i.es=1}return Yb(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return xt(i.lc)?++i.lc>wi.HALT_AT_COUNT:!0},hm(){if(ce(i.mg)&&ce(i.lb)){const[f]=i.mg;if(w(f))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return m.find(p=>xt(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,m){et.emit(f,`${d1(d)}:${h}`,m)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ce(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const m=h[1].findIndex(p=>p>0);if(m>=0&&w(h[1])){h[1][m]*=-1;break}}}},restore(f){if(ce(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let m=0;m<h[1].length;m++)h[1][m]=Math.abs(h[1][m])}},getcase(){i.ec=xt(i.ec)?i.ec:1;const f=c.hm();if(f&&ce(i.mg)){const[,d,h,m]=i.mg;c.set("sender",h),w(d)&&c.set("arg",d),m&&(c.set("player",m),E.elementfocus=m),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=xt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=dT.parse(f),[h]=d.filter(m=>m.fileName===jl);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(Te(d)),h)},if(...f){const[d,h]=st(f,0,[H.ANY]),m=f1(d);return m&&h<f.length&&c.command(...f.slice(h)),m?1:0},try(...f){const[,d]=st(f,0,[H.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,m]=st(f,0,[H.NAME,H.ANY]),p=xt(h),b=p?m:1,y=c.get(d),v=p?h:1;if(!xt(y))return b<f.length&&c.command(...f.slice(b)),1;const T=y-v;return T<0?(b<f.length&&c.command(...f.slice(b)),1):(c.set(d,T),0)},give(...f){const[d,h,m]=st(f,0,[H.NAME,H.ANY]),p=xt(h),b=p?m:1,y=c.get(d),v=p?h:1,T=y===void 0?1:0;return T&&b<f.length&&c.command(...f.slice(b)),c.set(d,ca(y,0)+v),T},repeatstart(f,...d){const[h,m]=st(d,0,[H.NUMBER]),p=`repeatcount${f}`,b=`repeatwords${f}`;i[p]=h,i[b]=m<d.length?d.slice(m):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!xt(i[d]))return 0;const m=i[d];i[d]=m-1;const p=m>0,b=i[h];return p&&ce(b)&&c.command(...b),p?1:0},foreachstart(f,...d){const[h,m,p,b]=st(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let y=Math.min(m,p),v=Math.max(m,p);const T=(b??0)||1;if(T<0){const A=y;y=v,v=A}return c.set(h,y-T),0},foreach(f,...d){const[h,m,p,b,y]=st(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let v=Math.min(m,p),T=Math.max(m,p);const A=(b??0)||1;if(A<0){const C=v;v=T,T=C}let U=c.get(h);!xt(U)||U<v||U>T?U=v:U+=A;const R=U<=T?1:0;return R&&(c.set(h,U),y<d.length&&c.command(...d.slice(y))),R},waitfor(...f){const[d]=st(f,0,[H.ANY]),h=f1(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=st(f,h,[H.ANY]);if(d=m,d)break;h=p}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=st(f,h,[H.ANY]);if(d=m,!d)break;h=p}return d},not(...f){const[d]=st(f,0,[H.ANY]);return d?0:1},expr(...f){const[d]=st(f,0,[H.ANY]);return d},isEq(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return typeof h=="object"||typeof m=="object"?Rw(h,m)?1:0:h===m?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h<m?1:0},isGreaterThan(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h>m?1:0},isLessThanOrEq(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h<=m?1:0},isGreaterThanOrEq(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h>=m?1:0},opPlus(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return h+m},opMinus(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return h-m},opPower(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return Math.pow(h,m)},opMultiply(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h*m},opDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h/m},opModDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h%m},opFloorDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return Math.floor(h/m)},opUniPlus(f){const[d]=st([f],0,[H.NUMBER]);return+d},opUniMinus(f){const[d]=st([f],0,[H.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function bd(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ce(r)?r.forEach(i=>{t.push(bd(i))}):t.push(bd(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function uF(e){const t=rb(`${e}
`);if(t.errors.length>0)return t;Ao.input=t.tokens;const n=Ao.program();if(Ao.errors.length>0)return{tokens:t.tokens,errors:Ao.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=eF.go(n);return r?(bd(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const wd=Object.getPrototypeOf(function*(){}).constructor;function hF(e,t){const n=`compile-${e}`;console.time(n);const r=uF(t);if(console.timeEnd(n),qm&&console.info(t,r.errors),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=aF(r.ast);if(i.code){qm&&console.info(i.code);try{return{...r,...i,source:i.code,code:new wd("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new wd("api"," ")}}}return{...r,...i,source:"",code:new wd("api"," ")}}function fF(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=hF(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return w(s)?s.isended():!0},halt(i){const s=t[i];return w(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];w(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!w(t[i])){const f=n(a,c);if(l=t[i]=lF(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((y,v)=>[y,v]);m.slice(h-5,h).forEach(([y,v])=>{he(et,ir(),"build",`$grey${v+1} $grey${y}`)});const[p,b]=m[h]??[];if(_t(p)&&w(b)){const y=(d.column??1)-1,v=y+d.length,T=y<p.length?p:`${p}*`,A=T.substring(0,y),U=T.substring(y,v),R=T.substring(v);he(et,ir(),"build",`$red${b+1} $grey${A}$red${U}$grey${R}`)}return d.message.split(`
`).forEach(y=>{he(et,ir(),"build",y)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Mn(i.target),a=t[s];if(w(a)){const c={...i,target:o};a.message(c)}}};return r}const wn=new Xo,Sn={},Wl={};function p1(e,t,n,r,i,s=0){const o=`tiles:${e}:${t}`;return w(Sn[o])||(Sn[o]=gT(e,t,n,r,i,s)),Sn[o]}function dF(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return w(Wl[s])||(Wl[s]=_T(e,t,n)),Wl[s].id=i,Wl[s]}function pF(e,t){const n=`sprites:${e}:${t}`;return w(Sn[n])||(Sn[n]=yT(e,t)),Sn[n]}function mF(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return w(Sn[s])||(Sn[s]=bT(e,t,n,r,i)),Sn[s]}function Gl(e,t,n,r){const i=`media:${e}:${t}`;w(Sn[i])||(Sn[i]=wT(e,t,n,r));const s=Sn[i];return s.mime=n,s.media=r,s}function gF(e,t){const n=`control:${e}:${t}`;return w(Sn[n])||(Sn[n]=xT(e,t)),Sn[n]}const Zi=3;function m1(e,t){const n=[],r=(e.x+.5)*zi,i=(e.y+.5)*Wi,s=t.x*zi,o=t.y*Wi,a=s-r,c=o-i;wn.x=a-Zi,wn.y=c-Zi,n.push(wn.angle()),wn.x=a+zi+Zi,wn.y=c-Zi,n.push(wn.angle()),wn.x=a-Zi,wn.y=c+Wi+Zi,n.push(wn.angle()),wn.x=a+zi+Zi,wn.y=c+Wi+Zi,n.push(wn.angle());const l=n.map(h=>Math.round(im(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(y=>y<180),m=l.filter(y=>y>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,f]}function Kl(e,t,n,r,i,s,o,a,c){var T;const l={x:a,y:c},u=$r(e,l);if(u===-1)return;wn.x=a-i.x,wn.y=c-i.y;const f=wn.length();if(f>s)return;const d=Math.round(im(wn.angle()));let h=0;for(let A=0;A<n.length;++A){const[U,R,C]=n[A];U>R?(d>=U||d<=R)&&(h=Math.max(h,C)):d>=U&&d<=R&&(h=Math.max(h,C))}const m=s*.5;t[u]=Math.min(t[u],h+(f<m?0:(f-m)*o)),t[u]=fn(t[u],0,1);const p=On(e,((T=e.lookup)==null?void 0:T[u])??"");if(w(p)){const A=[...m1(i,l),.25];r.push(A)}const b=e.terrain[u],y=li(b),v=(b==null?void 0:b.collision)??(y==null?void 0:y.collision);if(Zo(jt.ISBULLET,v)){const A=[...m1(i,l),1];r.push(A)}}function xd(e,t,n,r,i,s){if(!w(n)||!w(n.terrain)||!w(n.objects))return[];const o=[];let a=t;const c=Tt,l=Gt,u=s?Rt.BLACK:Rt.ONCLEAR,f=p1(e,a++,"terrain",c,l,u);o.push(f);const d=a++,h=pF(e,d);h.sprites=[],o.push(h);const m=n.isdark?1:0,p=mF(e,a++,c,l,m);o.push(p),p.alphas.fill(m);const b=p1(e,a++,"tickers",c,l,Rt.ONCLEAR);o.push(b),b.char.fill(0);const y={...id(Tt,Gt,r,Rt.ONCLEAR),...b},v=gF(e,a++);if(i){o.push(v);const{graphics:j,camera:O,facing:W}=yr(e),q=n.graphics??j??"",L=n.camera??O??"",I=n.facing??W??"";if(_t(q)){const x=It(q);switch(x){case"fpv":case"iso":case"mode7":v.graphics=x;break;default:case"flat":v.graphics="flat";break}}if(_t(L))switch(It(L)){default:case"mid":v.viewscale=Pc.MID;break;case"near":v.viewscale=Pc.NEAR;break;case"far":v.viewscale=Pc.FAR;break}xt(I)&&(v.facing=rm(I%360))}for(let j=0;j<n.terrain.length;++j){const O=n.terrain[j],W=Ss(O,0,Rt.WHITE,s?Rt.BLACK:Rt.ONCLEAR),q=Ht(O,"collision");f.char[j]=W.char,f.color[j]=W.color,f.bg[j]=W.bg,f.wall[j]=q===jt.ISSOLID?1:0}const T=Object.values(n.objects??{}),A=new Set;for(let j=0;j<T.length;++j){const O=T[j];mn(O.id)&&xt(O.x)&&xt(O.y)&&A.add(cr(O,Tt))}for(let j=0;j<T.length;++j){const O=T[j];if(_t(O.tickertext)&&xt(O.tickertime)&&O.tickertext.length){const I=Tt,x=kb(O.tickertext,I,Gt-1),N=(x==null?void 0:x.measuredwidth)??1,$=O.x??0,P=O.y??0,it=P<Gt*.5;y.x=$-Math.floor(N*.5),y.y=P+(it?1:-1),y.x+N>Tt&&(y.x=Tt-N),y.x<0&&(y.x=0),Eb(O.tickertext,y,!0)}if(w(O.removed))continue;const W=O.id??"";if(mn(W)===!1&&xt(O.x)&&xt(O.y)&&A.has(cr(O,Tt))===!0)continue;const q=Ss(O,1,Rt.WHITE,Rt.BLACK),L=dF(e,d,W,j);if(L.x=O.x??0,L.y=O.y??0,L.char=q.char,L.color=q.color,L.bg=q.bg,h.sprites.push(L),m){if(q.light>0){const I=$r(n,L),x=fn(Math.round(q.light),1,Gt),N=1/(x*.5);if(p.alphas[I]=0,x>1){const $=[];for(let P=1;P<=x;++P){if(P===2){const rt=Ht(O,"lightdir");if(Rr(rt)){const z=ql(n,O,"",rt,L);switch(Ar(L,z.destpt)){case pt.EAST:$.push([45,315,1]);break;case pt.WEST:$.push([225,135,1]);break;case pt.NORTH:$.push([315,225,1]);break;case pt.SOUTH:$.push([135,45,1]);break}}}const it=[];for(let rt=L.y-P;rt<=L.y+P;++rt)Kl(n,p.alphas,$,it,L,x,N,L.x-P,rt),Kl(n,p.alphas,$,it,L,x,N,L.x+P,rt);const Q=P-1;for(let rt=L.x-Q;rt<=L.x+Q;++rt)Kl(n,p.alphas,$,it,L,x,N,rt,L.y-P),Kl(n,p.alphas,$,it,L,x,N,rt,L.y+P);for(let rt=0;rt<it.length;++rt){const z=it[rt];let B=0;for(B=0;B<$.length;++B){const ht=$[B];if(ht[1]>ht[0]&&z[1]>=ht[0]&&z[0]<=ht[1]&&z[2]>=1&&ht[2]>=1){$[B]=[Math.min(z[0],ht[0]),Math.max(z[1],ht[1]),1];break}}B===$.length&&$.push(z)}}}}else if(mn(W)){const I=$r(n,L);p.alphas[I]=0}}W===e&&(v.focusx=L.x,v.focusy=L.y,v.focusid=W)}o.push(Gl(e,a++,"text/mood",m?"dark":"bright"));const U=oe(Pt.MAIN),R=Ii(U,Pt.MAIN);if(_t(R.palette)){const j=Qe(U,yt.PALETTE,R.palette),O=Ae(j);w(O==null?void 0:O.bits)&&o.push(Gl(e,a++,"image/palette",Array.from(O.bits)))}if(_t(R.charset)){const j=Qe(U,yt.CHARSET,R.charset),O=Ae(j);w(O==null?void 0:O.bits)&&o.push(Gl(e,a++,"image/charset",Array.from(O.bits)))}const C=Object.keys(n.objects).filter(mn);return o.push(Gl(e,a++,"text/players",C.join(","))),o}const rr=fF();var Pt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Pt||{});const ye={halt:!1,session:Be(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function _F(){return ye.session}function ir(){return ye.operator}function yF(e){ye.operator=e}function bF(e){ye.halt=e}function wF(){return ye.halt}function Ur(){return[...ye.books.values()]}function xF(){const[e]=ye.books.values();return e}function Fr(e){const t=It(e);return ye.books.get(e)??Ur().find(n=>n.name===t)}function g1(e,t){w(Fr(t))&&(ye.software[e]=t)}function oe(e){return Fr(ye.software[e])}function _1(e){const t=Vf([]);return _t(e)&&(t.name=e),Hl(t),xe(et,ye.operator,`created [book] ${t.name}`),t}function EF(e){let t=Fr(e);return w(t)||(t=Vf([]),t.name=e),Hl(t),xe(et,ye.operator,`created [book] ${t.name}`),t}function an(e,t){let n=w(t)?EF(t):oe(e);return w(n)||(w(n)||(n=xF()),w(n)||(n=_1(t)),w(n)&&xe(et,ye.operator,`opened [book] ${n.name} for ${e}`)),g1(e,n.id),n}function Qi(e,t,n){return qf(an(e),n,t)}function Pr(e,t){const n=oe("main"),r=yn(ub(n,e,t));if(w(r))return r;const i=Ur();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(n==null?void 0:n.id)){const a=yn(ub(o,e,t));if(w(a))return a}}}function li(e){if(!_t(e==null?void 0:e.kind)||!e.kind)return;const t=Pr(yt.OBJECT,e.kind);if(w(t))return e.kinddata=Ae(t),e.kinddata;const n=Pr(yt.TERRAIN,e.kind);if(w(n))return e.kinddata=Ae(n),e.kinddata}function Ht(e,t){const n=e==null?void 0:e.kinddata,r=(n==null?void 0:n.id)??"",i=e==null?void 0:e[t];if(w(i))return i;const s=n==null?void 0:n[t];if(w(s))return s;const o=Pr(yt.OBJECT,r)??Pr(yt.TERRAIN,r),a=Hf(o,t);if(w(a))return a;switch(t){case"group":return"";case"cycle":return wx;case"item":return 0;case"pushable":return 0;case"breakable":return 0;case"collision":return jt.ISWALK;default:return}}function Br(e,t,n,r){if(!w(e)||!w(t))return;const[i,s]=t,o=Pr(yt.OBJECT,i);if(w(o)){const c=vd(e,n,i,r);if(w(c))return sa(c,s),lT(e,c),li(c),Hm(e,c),c}const a=Pr(yt.TERRAIN,i);if(w(a)){const c=zF(e,n,i);if(w(c)){sa(c,s);const l=cr(n,Tt);return li(c),Hm(e,c,l),c}}}function kF(e,t,n){if(!w(e)||!w(t))return;const[r,i]=t,s=Pr(yt.OBJECT,r);if(w(s)){const o=vd(e,n,r);return sa(o,i),o}}function cn(e){const t=Pr(yt.BOARD,e);return Ae(t)}function yr(e){const t=an("main");return Ii(t,e)}function y1(e){const t=an("main");return dL(t,e)}function b1(){const e=an("main");return Ii(e,"main")}function vF(e){const t=an("main");return db(t,e)}function TF(e,t){ye.books.clear(),e.forEach(r=>{ye.books.set(r.id,r),r.name==="main"&&(ye.software.main=r.id)});const n=Fr(t);if(w(n)&&(ye.software.main=n.id),!ye.software.main){const r=ye.books.values().next();r.value&&(ye.software.main=r.value.id)}}function Hl(e){return ye.books.set(e.id,e),e.id}function AF(e){const t=Fr(e);t&&ye.books.delete(t.id)}function w1(e){if(!_t(e)||!e)return he(et,e,"login",`failed for playerid ==>${e}<==`);const t=oe("main");if(!w(t))return he(et,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);const n=ln(e),r=Pr(yt.BOARD,"title");if(!w(n)&&!w(r))return he(et,e,"login:title","login failed to find board with 'title' stat");const i=Pr(yt.OBJECT,"player");if(!w(i))return he(et,e,"login:player","login failed to find object type 'player'");const s=Ae(r);if(w(s)){const o=Hf(r,"startx"),a=Hf(r,"starty"),c=xt(o)?o:Math.round(Tt*.5),l=xt(a)?a:Math.round(Gt*.5),u=vd(s,{x:c,y:l},"player",e);if(w(u==null?void 0:u.id))return u.player=e,Il(t,e,s.id),!0}return!1}function RF(e){const t=oe("main"),n=Ca(t,e);if(!w(t))return;const r=[e];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Il(t,s,""),Nh(n,On(n,s)),A1(n,s),rr.halt(s),db(t,s)}}function ln(e){const t=oe("main");return Ca(t,e)}function SF(e){const t=oe("main"),n=_L(t,e),r=Ca(t,e),i=On(r,e);return n&&w(i)}function IF(e){const t=oe("main"),n=wo(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;mn(c)&&w(e[c])===!1&&(e[c]=0,Il(t,c,i.id))}}}function x1(e){rr.message(e)}function In(e,t,n,r){const i=Sr(t);_t(n.id)&&et.emit(e,"vm:touched",[n.id,i,r])}function OF(e,t,n,r){const i=n.id??"";if(r.x<0){const s=cn((t==null?void 0:t.exitwest)??"");w(s)&&bo(e,i,s.id,{x:Tt-1,y:r.y})}else if(r.x>=Tt){const s=cn((t==null?void 0:t.exiteast)??"");w(s)&&bo(e,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=cn((t==null?void 0:t.exitnorth)??"");w(s)&&bo(e,i,s.id,{x:r.x,y:Gt-1})}else if(r.y>=Gt){const s=cn((t==null?void 0:t.exitsouth)??"");w(s)&&bo(e,i,s.id,{x:r.x,y:0})}}function ts(e,t,n,r){if(!w(n==null?void 0:n.id))return!1;const i=Fh(t,n,r);if(w(i)){const s=mn(n.id),o=mn(n.party??n.id),a=Ht(n,"collision")===jt.ISBULLET;let c="";n.party&&o&&(c=n.party),s&&(c=n.id);const l=mn(i.id),u=mn(i.party??i.id),f=Ht(i,"collision")===jt.ISBULLET,d=o===u;let h="";if(i.party&&u&&(h=i.party),l&&(h=i.id??""),s&&i.kind==="edge"?OF(e,t,n,r):s?l?(In("",i,n,"bump"),In("",n,i,"bump")):f?(In("",i,n,d?"partyshot":"shot"),In(c,n,i,"touch")):(In("",i,n,"thud"),In(c,n,i,"touch")):a?f?(In("",i,n,"thud"),In("",n,i,"thud")):(In("",i,n,l?"touch":"thud"),In(d?"":c,n,i,d?"partyshot":"shot")):l?In(h,i,n,"touch"):f?(In(d?"":h,i,n,d?"partyshot":"shot"),In("",n,i,d?"thud":"touch")):(In("",i,n,"thud"),In("",n,i,"bump")),s&&Ht(i,"item")||a&&Ht(i,"breakable")){if(w(i==null?void 0:i.id)){const m=ne(t,{x:i.x??-1,y:i.y??-1});w(m)&&xn(E.board,m,E.timestamp)}else Re(t,{x:r.x,y:r.y});return!0}return!1}return!0}function E1(e,t,n,r){var l;if(!w(e)||!w(t)||!w(n))return;const i={...E};E.book=e,E.board=t,E.element=n,E.elementid=n.id??"",E.elementisplayer=mn(E.elementid);const s=E.element.player??ye.operator;E.elementfocus=E.elementisplayer?E.elementid:s;const o=Ht(n,"cycle"),a=n.id??"",c=It(n.name??((l=n.kinddata)==null?void 0:l.name)??"");if(rr.tick(a,Ji.RUNTIME,o,c,r),xt(n==null?void 0:n.tickertime)&&E.timestamp-n.tickertime>Ha*5&&(n.tickertime=0,n.tickertext=""),E.elementisplayer){const u=yr(E.elementid);xt(u.inputcurrent)&&(u.inputcurrent=0)}Xn(i).forEach(u=>{E[u]=i[u]})}function NF(e,t){ye.loaders.set(e,t)}function CF(e){rr.halt(e)}function LF(){const e=rr.ids();for(let n=0;n<e.length;++n)rr.halt(e[n]);const t=oe("main");w(t)&&(t.flags={})}function MF(e=!1){const t=oe("main");if(!w(t))return;const n=t.timestamp+1,r=wi.HALT_AT_COUNT;wi.HALT_AT_COUNT=r*2,ye.loaders.forEach((s,o)=>{const a={...E};E.timestamp=t.timestamp,E.book=t,E.board=void 0,E.element=void 0,E.elementid=o,E.elementisplayer=!1,E.elementfocus=ir();const c=jU(o);w(c)&&rr.arg(o,c),rr.tick(o,Ji.LOADER,1,"loader",s),rr.isended(o)&&(rr.halt(o),ye.loaders.delete(o)),Xn(a).forEach(l=>{E[l]=a[l]})}),wi.HALT_AT_COUNT=r,t.timestamp=n,E.timestamp=n;const i=wo(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)li(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];li(o.objects[u])}const c=IT(o,n);for(let l=0;l<c.length;++l){const{id:u,type:f,code:d,object:h}=c[l];f===yt.ERROR?rr.halt(u):(!e||mn((h==null?void 0:h.id)??""))&&E1(t,o,h,d)}}}function Io(e,t,n,r){const i=oe("main");if(!w(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(w(c.id)){const l=`${d1(c.id)}:${t}`;et.emit("",l,n)}}}if(ms(e)){for(let o=0;o<r.length;++o){const a=r[o],c=ne(a,e);w(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(It(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(ym(a,[e]));break}}}}function UF(e){const t=yr(e),n=t.playbuffer=_t(t.playbuffer)?t.playbuffer:"";n&&k1(e,n,!1)}function k1(e,t,n=!0){var o;const r=an("main");if(!w(r))return;const i=`${e}_cli`;E.timestamp=r.timestamp,E.book=r,E.board=Ca(r,e),E.element=On(E.board,e),E.elementid=((o=E.element)==null?void 0:o.id)??"",E.elementisplayer=!0,E.elementfocus=E.elementid||e;const s=wi.HALT_AT_COUNT;if(wi.HALT_AT_COUNT=s*8,rr.once(i,Ji.CLI,"cli",t),n){const a=yr(e);a.playbuffer=t}wi.HALT_AT_COUNT=s}function Yl(e){var a;const t=an("main"),n=As(t,e);if(!w(t)||!w(n)||!w(E.element))return;const r={...E},i=`${e}_run`,s=It(E.element.name??((a=E.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";rr.once(i,Ji.RUNTIME,s,o),Xn(r).forEach(c=>{E[c]=r[c]})}function FF(e,t){const n=oe("main"),r=Ca(n,e),i=[],s=[],o=[];if(!w(n)||!w(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=cn(r.overboard??""),l=cn(r.underboard??"");return s.push(...xd(e,0,l,t,!1,!0)),o.push(...xd(e,s.length,r,t,!0,a!=="flat")),i.push(...xd(e,s.length+o.length,c,t,!1,!1)),{over:i,under:s,layers:o}}function PF(e,t,n,r){if(!w(e))return;w(e.distmaps)||(e.distmaps={});const i=`${t}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=e.distmaps[i];if(!w(s)){s=new Array(Eh).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(w(c)&&Xl(c)){const l=cr(c,Tt);if(s[l]===-2){const u=es(e,c.x,c.y);Zo(t,Ht(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function v1(e,t){return Xl(e)?t[cr(e,Tt)]:-1}function T1(e,t,n,r,i){if(!w(e))return;const s=PF(e,t,n,r);if(!w(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=v1(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=v1(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function BF(){return new Array(Tt*Gt).map(()=>{})}function Vl(e=hu){const t={terrain:BF(),objects:{},id:""};return e(t)}var Ed=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(Ed||{});function $F(e){return co(e,Ed,{terrain:t=>t.map(Lc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Lc),id:ke,named:ke,lookup:ke,codepage:ke,distmaps:ke,overboard:ke,underboard:ke})}function DF(e){return ia(e,Ed,{terrain:t=>t.map(Mc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Mc(t[r]);w(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Xl(e){return fh(e.x,e.y,0,Tt-1,Gt-1,0)}function $r(e,t){return!w(e)||!w(t==null?void 0:t.x)||!w(t==null?void 0:t.y)||t.x<0||t.x>=Tt||t.y<0||t.y>=Gt?-1:t.x+t.y*Tt}function ne(e,t){const n=$r(e,t);if(n<0||!w(e==null?void 0:e.lookup))return;const r=On(e,e.lookup[n]??"");return w(r)?r:e.terrain[n]}function jF(e,t){const n=On(e,t);if(w(n))return n;const r=parseFloat(t),i=Ev(isNaN(r)?-1:r,Tt);return es(e,i.x,i.y)}function es(e,t,n){return(t>=0&&t<Tt)??(n>=0&&n<Gt)?e==null?void 0:e.terrain[t+n*Tt]:void 0}function Re(e,t){if(!w(e)||!w(t)||!w(t.x)||!w(t.y)||t.x<0||t.x>=Tt||t.y<0||t.y>=Gt)return;const n=wr(t),r=t.x+t.y*Tt;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function kd(e,t){if(!w(e)||!w(t))return;const n=wr(t);return n.id=n.id??Be(),e.objects[n.id]=n,e.objects[n.id]}function zF(e,t,n){return Re(e,{...t,kind:n})}function vd(e,t,n,r){return kd(e,{...t,kind:n,id:r})}function On(e,t){if(e)return e.objects[t]}function WF(e,t){const n=$r(e,t);if(n<0||!w(e==null?void 0:e.lookup))return;const r=On(e,e.lookup[n]??"");if(w(r))return r}function xn(e,t,n){return!w(t)||Sr(t)==="player"?!1:(t.id?(t.removed=n,Nh(e,t)):(Re(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),uT(e,t)),!0)}function A1(e,t){return w(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function GF(e,t,n){if(!w(e)||!w(t))return;const r=e.objects[n];if(w(r))return r;if(ms(t))return bm(t,ta(e,"player"))}function ql(e,t,n,r,i){const s=pt.MID;if(!w(e)||!w(t))return{dir:r,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:t.lx??o.x,y:t.ly??o.y},c=Ar(a,o),l=Tt-1,u=Gt-1;for(let f=0;f<r.length;++f){const d=Mv(r[f]);switch(d){case pt.IDLE:break;case pt.NORTH:case pt.SOUTH:case pt.WEST:case pt.EAST:De(o,d);break;case pt.BY:{const[h,m]=r.slice(f+1);xt(h)&&xt(m)&&(o.x=fn(o.x+h,0,l),o.y=fn(o.y+m,0,u)),f+=2;break}case pt.TO:case pt.AT:{const[h,m]=r.slice(f+1);xt(h)&&xt(m)&&(o.x=fn(h,0,l),o.y=fn(m,0,u)),f+=2;break}case pt.FLOW:De(o,c);break;case pt.SEEK:{const h=GF(e,t,n);ms(h)&&De(o,Ar(i,h));break}case pt.RNDNS:De(o,yn(pt.NORTH,pt.SOUTH));break;case pt.RNDNE:De(o,yn(pt.NORTH,pt.EAST));break;case pt.RND:De(o,yn(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));break;case pt.CW:case pt.CCW:case pt.OPP:case pt.RNDP:{const h=ql(e,t,n,r.slice(f+1),i);switch(o.x=i.x,o.y=i.y,d){case pt.CW:switch(Ar(i,h.destpt)){case pt.NORTH:De(o,pt.EAST);break;case pt.SOUTH:De(o,pt.WEST);break;case pt.EAST:De(o,pt.SOUTH);break;case pt.WEST:De(o,pt.NORTH);break}break;case pt.CCW:switch(Ar(i,h.destpt)){case pt.NORTH:De(o,pt.WEST);break;case pt.SOUTH:De(o,pt.EAST);break;case pt.EAST:De(o,pt.NORTH);break;case pt.WEST:De(o,pt.SOUTH);break}break;case pt.OPP:switch(Ar(i,h.destpt)){case pt.NORTH:De(o,pt.SOUTH);break;case pt.SOUTH:De(o,pt.NORTH);break;case pt.EAST:De(o,pt.WEST);break;case pt.WEST:De(o,pt.EAST);break}break;case pt.RNDP:switch(Ar(i,h.destpt)){case pt.NORTH:case pt.SOUTH:o.x+=yn(-1,1);break;case pt.WEST:case pt.EAST:o.y+=yn(-1,1);break}break}break}case pt.FLEE:case pt.AWAY:{const[h,m]=r.slice(f+1);if(xt(h)&&xt(m)){const p={x:fn(h,0,l),y:fn(m,0,u)},b=Ht(t,"collision"),y=T1(e,b,o,p,!0);w(y)&&(o.x=y.x,o.y=y.y)}f+=2;break}case pt.FIND:case pt.TOWARD:{const[h,m]=r.slice(f+1);if(xt(h)&&xt(m)){const p={x:fn(h,0,l),y:fn(m,0,u)};if(lr(1,100)<5)De(o,yn(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));else{const b=Ht(t,"collision"),y=T1(e,b,o,p,!1);if(w(y))if(y.x!==h&&y.y!==m&&WF(e,y))switch(Ar(i,y)){case pt.EAST:case pt.WEST:o.y+=yn(-1,1);break;case pt.NORTH:case pt.SOUTH:o.x+=yn(-1,1);break}else o.x=y.x,o.y=y.y}}f+=2;break}case pt.PLAYER:{const h=Qo(e,i,n);ms(h)&&(o.x=h.x,o.y=h.y);break}case pt.OVER:case pt.UNDER:{const h=ql(e,t,n,r.slice(f+1),i);return h.layer=d,h}}}return{dir:r,startpt:i,destpt:o,layer:s}}const E={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var H=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.MAYBE_KIND=7]="MAYBE_KIND",e[e.MAYBE_NAME=8]="MAYBE_NAME",e[e.MAYBE_NUMBER=9]="MAYBE_NUMBER",e[e.MAYBE_STRING=10]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",e[e.ANY=12]="ANY",e))(H||{});function En(e,t,n){throw console.info(n,E.element,E.elementid,E.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function R1(e){var n,r;const t={x:((n=E.element)==null?void 0:n.x)??0,y:((r=E.element)==null?void 0:r.y)??0};return ql(E.board,E.element,E.elementfocus,e,t)}function st(e,t,n){const r=E.words;E.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=gm(s);oo(a)?(s=c,i.push(a)):En("kind",a,e);break}case 0:{if(vc(e[s])===void 0){const[a,c]=Gn(s);Xr(a)?(s=c,i.push(a)):En("color",a,e)}else{const[a,c]=wh(s);Xr(a)?(s=c,i.push(a)):En("color",a,e)}break}case 2:{if(bh(e[s])===void 0){const[a,c]=Gn(s);Rr(a)?(s=c,i.push(R1(a))):En("direction",a,e)}else{const[a,c]=lm(s);Rr(a)?(s=c,i.push(R1(a))):En("direction",a,e)}break}case 3:{const a=E.words[s];_t(a)||En("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Gn(s);if(_t(a)){const l=parseFloat(a);xt(l)?i.push(l):En("number",a,e)}else xt(a)?i.push(a):En("number",a,e);s=c;break}case 5:{const[a,c]=Gn(s);_t(a)||En("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Gn(s);let l=a;if(_t(l)){const u=parseFloat(l);xt(u)&&(l=u)}else xt(l)||En("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=gm(s);a!==void 0&&!oo(a)&&En("optional kind",a,e),s=c,i.push(a);break}case 8:{const a=E.words[s];a!==void 0&&!_t(a)&&En("optional string",a,e),++s,i.push(a);break}case 9:{const[a,c]=Gn(s);if(_t(a)){const l=parseFloat(a);xt(l)?i.push(l):En("optional number",a,e)}else xt(a)||a===void 0?i.push(a):En("optional number",a,e);s=c;break}case 10:{const[a,c]=Gn(s);a!==void 0&&!_t(a)&&En("optional string",a,e),s=c,i.push(a);break}case 11:{const[a,c]=Gn(s);let l=a;if(_t(l)){const u=parseFloat(l);xt(u)&&(l=u)}else l!==void 0&&!xt(l)&&En("number or string",l,e);s=c,i.push(l);break}case 12:{const[a,c]=Gn(s);s=c,i.push(a);break}}return E.words=r,[...i,s]}const Jl={},Oo={};function Td(){return{id:Be(),layers:[],scroll:[],sidebar:[]}}const KF=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),HF=new Set(["tx","text"]),YF={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},S1={};let I1=e=>{let t=S1[e];return w(t)||(S1[e]=t=Td()),t};function VF(e){I1=e}function Ke(e){return I1(e)}function Ad(e){return w(Jl[e])||(Jl[e]=[]),Jl[e]}function XF(e){const t=Ke(e);t.scroll=[]}function qF(e,t,n){Object.values(Oo).forEach(r=>{if(r[t]!==void 0){const i=Xm(e.id(),t);xt(n)&&_v(i,n),_t(n)&&yv(i,n)}})}function kn(e){const t=Ad(e);return Jl[e]=[],t}function At(e,t){Ad(e).push(t)}function Nt(e,t,n,r,i=()=>0,s=hu){const o=[t,n,...r],a=It(`${o[3]}`),c={...E};function l(u,f){w(f)&&f!==i(u)&&(E.board=c.board,E.element=c.element,E.elementfocus=c.elementfocus,s(u,f))}if(KF.has(a)){const u=`${o[2]}`;Oo[t]=Oo[t]??{};const f=i(u)??YF[a];if(Oo[t][u]===void 0){const d=Xm(t,u);xt(f)&&gv(d,f),_t(f)&&hh(d,f),HF.has(a)?Oo[t][u]=Yp(d,h=>{l(u,h)}):Oo[t][u]=bv(d,h=>{l(u,h)})}}Ad(e).push(o)}VF(e=>{if(mn(e)){const t=oe(Pt.MAIN),n=Ii(t,Pt.GADGETSTORE);let r=n[e];return w(r)||(n[e]=r=Td()),r}return Td()});let O1=0;function JF(){switch(O1++){case 0:return Rt.BLUE;case 1:return Rt.BLACK;case 2:return Rt.GREEN;case 3:return Rt.BLACK;case 4:return Rt.CYAN;case 5:return Rt.BLACK;case 6:return Rt.RED;case 7:return Rt.BLACK;case 8:return Rt.PURPLE;case 9:return Rt.BLACK;case 10:return Rt.YELLOW;case 11:return Rt.BLACK;case 12:return Rt.WHITE;default:return O1=0,Rt.BLACK}}const Zl=Ps("gadgetserver",["tock","second"],e=>{if(!Zl.session(e))return;const t=oe(Pt.MAIN),n=(t==null?void 0:t.activelist)??[],r=Ii(t,Pt.GADGETSYNC);switch(e.target){case"tock":{const i=JF();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=FF(o,i),u=Ke(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=Hd(f,u);d.length&&(r[o]=wr(u),Gw(Zl,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=ln(s);w(o)&&rx(Zl,s,o.id)}break;case"desync":Ww(Zl,e.player,Ke(e.player));break;case"clearscroll":XF(e.player);break;case"clearplayer":{const i=Ii(t,Pt.GADGETSTORE);delete i[e.player];const s=Ii(t,Pt.GADGETSYNC);delete s[e.player];break}}});function Ql(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var N1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof Ql=="function"&&Ql;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(m){var p=r[l][1][m];return o(p||m)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Ql=="function"&&Ql,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,m,p,b=[],y=0,v=c.length,T=v,A=s.getTypeOf(c)!=="string";y<c.length;)T=v-y,f=A?(l=c[y++],u=y<v?c[y++]:0,y<v?c[y++]:0):(l=c.charCodeAt(y++),u=y<v?c.charCodeAt(y++):0,y<v?c.charCodeAt(y++):0),d=l>>2,h=(3&l)<<4|u>>4,m=1<T?(15&u)<<2|f>>6:64,p=2<T?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(m)+a.charAt(p));return b.join("")},i.decode=function(c){var l,u,f,d,h,m,p=0,b=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|T):new Array(0|T);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(p++)))>>2,f=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),v[b++]=l,h!==64&&(v[b++]=u),m!==64&&(v[b++]=f);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,m){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,m){var p,b="";for(p=0;p<m;p++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,m,p,b,y,v){var T,A,U=h.file,R=h.compression,C=v!==l.utf8encode,j=a.transformTo("string",v(U.name)),O=a.transformTo("string",l.utf8encode(U.name)),W=U.comment,q=a.transformTo("string",v(W)),L=a.transformTo("string",l.utf8encode(W)),I=O.length!==U.name.length,x=L.length!==W.length,N="",$="",P="",it=U.dir,Q=U.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(rt.crc32=h.crc32,rt.compressedSize=h.compressedSize,rt.uncompressedSize=h.uncompressedSize);var z=0;m&&(z|=8),C||!I&&!x||(z|=2048);var B=0,ht=0;it&&(B|=16),y==="UNIX"?(ht=798,B|=function(lt,$t){var Jt=lt;return lt||(Jt=$t?16893:33204),(65535&Jt)<<16}(U.unixPermissions,it)):(ht=20,B|=function(lt){return 63&(lt||0)}(U.dosPermissions)),T=Q.getUTCHours(),T<<=6,T|=Q.getUTCMinutes(),T<<=5,T|=Q.getUTCSeconds()/2,A=Q.getUTCFullYear()-1980,A<<=4,A|=Q.getUTCMonth()+1,A<<=5,A|=Q.getUTCDate(),I&&($=s(1,1)+s(u(j),4)+O,N+="up"+s($.length,2)+$),x&&(P=s(1,1)+s(u(q),4)+L,N+="uc"+s(P.length,2)+P);var ct="";return ct+=`
\0`,ct+=s(z,2),ct+=R.magic,ct+=s(T,2),ct+=s(A,2),ct+=s(rt.crc32,4),ct+=s(rt.compressedSize,4),ct+=s(rt.uncompressedSize,4),ct+=s(j.length,2),ct+=s(N.length,2),{fileRecord:f.LOCAL_FILE_HEADER+ct+j+N,dirRecord:f.CENTRAL_FILE_HEADER+s(ht,2)+ct+s(q.length,2)+"\0\0\0\0"+s(B,4)+s(b,4)+j+N+q}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,m,p,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-b-1))/p:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,b=function(y,v,T,A,U){var R=a.transformTo("string",U(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(v,4)+s(T,4)+s(R.length,2)+R}(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var m=function(v,T){var A=v||T,U=s[A];if(!U)throw new Error(A+" is not a valid compression method !");return U}(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,y=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:d,dir:b,date:y,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(b){m(b)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(p){var b=new c(h);return b.load(p),b}).then(function(p){var b=[o.Promise.resolve(p)],y=p.files;if(h.checkCRC32)for(var v=0;v<y.length;v++)b.push(f(y[v]));return o.Promise.all(b)}).then(function(p){for(var b=p.shift(),y=b.files,v=0;v<y.length;v++){var T=y[v],A=T.fileNameStr,U=s.resolve(T.fileNameStr);m.file(U,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(m.file(U).unsafeOriginalName=A)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof un<"u",newBufferFrom:function(s,o){if(un.from&&un.from!==Uint8Array.from)return un.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new un(s,o)},allocBuffer:function(s){if(un.alloc)return un.alloc(s);var o=new un(s);return o.fill(0),o},isBuffer:function(s){return un.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,R,C){var j,O=a.getTypeOf(R),W=a.extend(C||{},u);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(U=y(U)),W.createFolders&&(j=b(U))&&v.call(this,j,!0);var q=O==="string"&&W.binary===!1&&W.base64===!1;C&&C.binary!==void 0||(W.binary=!q),(R instanceof f&&R.uncompressedSize===0||W.dir||!R||R.length===0)&&(W.base64=!1,W.binary=!0,R="",W.compression="STORE",O="string");var L=null;L=R instanceof f||R instanceof c?R:m.isNode&&m.isStream(R)?new p(U,R):a.prepareContent(U,R,W.binary,W.optimizedBinaryString,W.base64);var I=new d(U,L,W);this.files[U]=I}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),m=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),b=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var R=U.lastIndexOf("/");return 0<R?U.substring(0,R):""},y=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},v=function(U,R){return R=R!==void 0?R:u.createFolders,U=y(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:R}),this.files[U]};function T(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var R,C,j;for(R in this.files)j=this.files[R],(C=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&U(C,j)},filter:function(U){var R=[];return this.forEach(function(C,j){U(C,j)&&R.push(j)}),R},file:function(U,R,C){if(arguments.length!==1)return U=this.root+U,s.call(this,U,R,C),this;if(T(U)){var j=U;return this.filter(function(W,q){return!q.dir&&j.test(W)})}var O=this.files[this.root+U];return O&&!O.dir?O:null},folder:function(U){if(!U)return this;if(T(U))return this.filter(function(O,W){return W.dir&&U.test(O)});var R=this.root+U,C=v.call(this,R),j=this.clone();return j.root=C.name,j},remove:function(U){U=this.root+U;var R=this.files[U];if(R||(U.slice(-1)!=="/"&&(U+="/"),R=this.files[U]),R&&!R.dir)delete this.files[U];else for(var C=this.filter(function(O,W){return W.name.slice(0,U.length)===U}),j=0;j<C.length;j++)delete this.files[C[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var R,C={};try{if((C=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var j=C.comment||this.comment||"";R=h.generateWorker(this,C,j)}catch(O){(R=new c("error")).error(O)}return new l(R,C.type||"string",C.mimeType)},generateAsync:function(U,R){return this.generateInternalStream(U).accumulate(R)},generateNodeStream:function(U,R){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(R)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(b,y){var v=[],T=m._internalType,A=m._outputType,U=m._mimeType;m.on("data",function(R,C){v.push(R),p&&p(C)}).on("error",function(R){v=[],y(R)}).on("end",function(){try{var R=function(C,j,O){switch(C){case"blob":return s.newBlob(s.transformTo("arraybuffer",j),O);case"base64":return c.encode(j);default:return s.transformTo(C,j)}}(A,function(C,j){var O,W=0,q=null,L=0;for(O=0;O<j.length;O++)L+=j[O].length;switch(C){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(q=new Uint8Array(L),O=0;O<j.length;O++)q.set(j[O],W),W+=j[O].length;return q;case"nodebuffer":return un.concat(j);default:throw new Error("concat : unsupported type '"+C+"'")}}(T,v),U);b(R)}catch(C){y(C)}v=[]}).resume()})}function h(m,p,b){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=b,s.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var b=this;return m==="data"?this._worker.on(m,function(y){p.call(b,y.data,y.meta)}):this._worker.on(m,function(){s.delay(p,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof un<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(m){var p,b,y,v,T,A=m.length,U=0;for(v=0;v<A;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),U+=b<128?1:b<2048?2:b<65536?3:4;for(p=o.uint8array?new Uint8Array(U):new Array(U),v=T=0;T<U;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),b<128?p[T++]=b:(b<2048?p[T++]=192|b>>>6:(b<65536?p[T++]=224|b>>>12:(p[T++]=240|b>>>18,p[T++]=128|b>>>12&63),p[T++]=128|b>>>6&63),p[T++]=128|63&b);return p}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(m){var p,b,y,v,T=m.length,A=new Array(2*T);for(p=b=0;p<T;)if((y=m[p++])<128)A[b++]=y;else if(4<(v=l[y]))A[b++]=65533,p+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&p<T;)y=y<<6|63&m[p++],v--;1<v?A[b++]=65533:y<65536?A[b++]=y:(y-=65536,A[b++]=55296|y>>10&1023,A[b++]=56320|1023&y)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(v,T){var A;for((T=T||v.length)>v.length&&(T=v.length),A=T-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?T:A+l[v[A]]>T?A:T}(m),y=m;b!==m.length&&(o.uint8array?(y=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(y=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:i.utf8decode(y),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(p){return p}function u(p,b){for(var y=0;y<p.length;++y)b[y]=255&p.charCodeAt(y);return b}n("setimmediate"),i.newBlob=function(p,b){i.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,b,y){var v=[],T=0,A=p.length;if(A<=y)return String.fromCharCode.apply(null,p);for(;T<A;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(T,Math.min(T+y,A)))):v.push(String.fromCharCode.apply(null,p.subarray(T,Math.min(T+y,A)))),T+=y;return v.join("")},stringifyByChar:function(p){for(var b="",y=0;y<p.length;y++)b+=String.fromCharCode(p[y]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var b=65536,y=i.getTypeOf(p),v=!0;if(y==="uint8array"?v=f.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return f.stringifyByChunk(p,y,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(p)}function h(p,b){for(var y=0;y<p.length;y++)b[y]=p[y];return b}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,b){if(b=b||"",!p)return b;i.checkSupport(p);var y=i.getTypeOf(b);return m[y][p](b)},i.resolve=function(p){for(var b=p.split("/"),y=[],v=0;v<b.length;v++){var T=b[v];T==="."||T===""&&v!==0&&v!==b.length-1||(T===".."?y.pop():y.push(T))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var b,y,v="";for(y=0;y<(p||"").length;y++)v+="\\x"+((b=p.charCodeAt(y))<16?"0":"")+b.toString(16).toUpperCase();return v},i.delay=function(p,b,y){setImmediate(function(){p.apply(y||null,b||[])})},i.inherits=function(p,b){function y(){}y.prototype=b.prototype,p.prototype=new y},i.extend=function(){var p,b,y={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&y[b]===void 0&&(y[b]=arguments[p][b]);return y},i.prepareContent=function(p,b,y,v,T){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,R){var C=new FileReader;C.onload=function(j){U(j.target.result)},C.onerror=function(j){R(j.target.error)},C.readAsArrayBuffer(A)}):A}).then(function(A){var U=i.getTypeOf(A);return U?(U==="arraybuffer"?A=i.transformTo("uint8array",A):U==="string"&&(T?A=o.decode(A):y&&v!==!0&&(A=function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=d-h;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,m){this.options=h,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===b)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,b,y=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<y;)m=h.readInt(2),p=h.readInt(2),b=h.readData(p),this.extraFields[m]={id:m,length:p,value:b};h.setIndex(y)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var y=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(m,p,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,b="string";try{if(!m)throw new Error("No output type specified.");var y=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(p=p.pipe(new c.Utf8EncodeWorker)),!v&&y&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(T){(p=new u("error")).error(T)}return new o(p,b,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var h=[];function m(){var p,b;a=!0;for(var y=h.length;y;){for(b=h,h=[],p=-1;++p<y;)b[p]();y=h.length}a=!1}r.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof Nn<"u"?Nn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function d(y,v,T){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(y,v,T){s(function(){var A;try{A=v(T)}catch(U){return a.reject(y,U)}A===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,A)})}function m(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function p(y,v){var T=!1;function A(C){T||(T=!0,a.reject(y,C))}function U(C){T||(T=!0,a.resolve(y,C))}var R=b(function(){v(U,A)});R.status==="error"&&A(R.value)}function b(y,v){var T={};try{T.value=y(v),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(T){return v.resolve(y()).then(function(){return T})},function(T){return v.resolve(y()).then(function(){throw T})})},f.prototype.catch=function(y){return this.then(null,y)},f.prototype.then=function(y,v){if(typeof y!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?y:v,this.outcome):this.queue.push(new d(T,y,v)),T},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){h(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){h(this.promise,this.onRejected,y)},a.resolve=function(y,v){var T=b(m,v);if(T.status==="error")return a.reject(y,T.value);var A=T.value;if(A)p(y,A);else{y.state=l,y.outcome=v;for(var U=-1,R=y.queue.length;++U<R;)y.queue[U].callFulfilled(v)}return y},a.reject=function(y,v){y.state=c,y.outcome=v;for(var T=-1,A=y.queue.length;++T<A;)y.queue[T].callRejected(v);return y},f.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},f.reject=function(y){var v=new this(o);return a.reject(v,y)},f.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,A=!1;if(!T)return this.resolve([]);for(var U=new Array(T),R=0,C=-1,j=new this(o);++C<T;)O(y[C],C);return j;function O(W,q){v.resolve(W).then(function(L){U[q]=L,++R!==T||A||(A=!0,a.resolve(j,U))},function(L){A||(A=!0,a.reject(j,L))})}},f.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,A=!1;if(!T)return this.resolve([]);for(var U=-1,R=new this(o);++U<T;)C=y[U],v.resolve(C).then(function(j){A||(A=!0,a.resolve(R,j))},function(j){A||(A=!0,a.reject(R,j))});var C;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(T!==f)throw new Error(c[T]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function b(y,v){var T=new p(v);if(T.push(y,!0),T.err)throw T.msg||c[T.err];return T.result}p.prototype.push=function(y,v){var T,A,U=this.strm,R=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof y=="string"?U.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?U.input=new Uint8Array(y):U.input=y,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(R),U.next_out=0,U.avail_out=R),(T=s.deflate(U,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(U.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=b,i.deflateRaw=function(y,v){return(v=v||{}).raw=!0,b(y,v)},i.gzip=function(y,v){return(v=v||{}).gzip=!0,b(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,b.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function m(p,b){var y=new h(b);if(y.push(p,!0),y.err)throw y.msg||l[y.err];return y.result}h.prototype.push=function(p,b){var y,v,T,A,U,R,C=this.strm,j=this.options.chunkSize,O=this.options.dictionary,W=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?C.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?C.input=new Uint8Array(p):C.input=p,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(j),C.next_out=0,C.avail_out=j),(y=s.inflate(C,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&O&&(R=typeof O=="string"?a.string2buf(O):d.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,y=s.inflateSetDictionary(this.strm,R)),y===c.Z_BUF_ERROR&&W===!0&&(y=c.Z_OK,W=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&y!==c.Z_STREAM_END&&(C.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(C.output,C.next_out),A=C.next_out-T,U=a.buf2string(C.output,T),C.next_out=A,C.avail_out=j-A,A&&o.arraySet(C.output,C.output,T,A,0),this.onData(U)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(W=!0)}while((0<C.avail_in||C.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(C.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,b){return(b=b||{}).raw=!0,m(p,b)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,m;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(m=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],m.set(h,d),d+=h.length;return m}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",m=0;m<d;m++)h+=String.fromCharCode(f[m]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,m,p,b,y=f.length,v=0;for(p=0;p<y;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),v+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(v),p=b=0;b<v;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,m=d.length;h<m;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,m,p,b,y=d||f.length,v=new Array(2*y);for(h=m=0;h<y;)if((p=f[h++])<128)v[m++]=p;else if(4<(b=c[p]))v[m++]=65533,h+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&h<y;)p=p<<6|63&f[h++],b--;1<b?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return u(v,m)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,m=-2,p=-1,b=4,y=2,v=8,T=9,A=286,U=30,R=19,C=2*A+1,j=15,O=3,W=258,q=W+O+1,L=42,I=113,x=1,N=2,$=3,P=4;function it(k,at){return k.msg=u[at],at}function Q(k){return(k<<1)-(4<k?9:0)}function rt(k){for(var at=k.length;0<=--at;)k[at]=0}function z(k){var at=k.state,nt=at.pending;nt>k.avail_out&&(nt=k.avail_out),nt!==0&&(o.arraySet(k.output,at.pending_buf,at.pending_out,nt,k.next_out),k.next_out+=nt,at.pending_out+=nt,k.total_out+=nt,k.avail_out-=nt,at.pending-=nt,at.pending===0&&(at.pending_out=0))}function B(k,at){a._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,at),k.block_start=k.strstart,z(k.strm)}function ht(k,at){k.pending_buf[k.pending++]=at}function ct(k,at){k.pending_buf[k.pending++]=at>>>8&255,k.pending_buf[k.pending++]=255&at}function lt(k,at){var nt,D,F=k.max_chain_length,V=k.strstart,ut=k.prev_length,dt=k.nice_match,Z=k.strstart>k.w_size-q?k.strstart-(k.w_size-q):0,gt=k.window,Et=k.w_mask,mt=k.prev,Ot=k.strstart+W,ue=gt[V+ut-1],Dt=gt[V+ut];k.prev_length>=k.good_match&&(F>>=2),dt>k.lookahead&&(dt=k.lookahead);do if(gt[(nt=at)+ut]===Dt&&gt[nt+ut-1]===ue&&gt[nt]===gt[V]&&gt[++nt]===gt[V+1]){V+=2,nt++;do;while(gt[++V]===gt[++nt]&&gt[++V]===gt[++nt]&&gt[++V]===gt[++nt]&&gt[++V]===gt[++nt]&&gt[++V]===gt[++nt]&&gt[++V]===gt[++nt]&&gt[++V]===gt[++nt]&&gt[++V]===gt[++nt]&&V<Ot);if(D=W-(Ot-V),V=Ot-W,ut<D){if(k.match_start=at,dt<=(ut=D))break;ue=gt[V+ut-1],Dt=gt[V+ut]}}while((at=mt[at&Et])>Z&&--F!=0);return ut<=k.lookahead?ut:k.lookahead}function $t(k){var at,nt,D,F,V,ut,dt,Z,gt,Et,mt=k.w_size;do{if(F=k.window_size-k.lookahead-k.strstart,k.strstart>=mt+(mt-q)){for(o.arraySet(k.window,k.window,mt,mt,0),k.match_start-=mt,k.strstart-=mt,k.block_start-=mt,at=nt=k.hash_size;D=k.head[--at],k.head[at]=mt<=D?D-mt:0,--nt;);for(at=nt=mt;D=k.prev[--at],k.prev[at]=mt<=D?D-mt:0,--nt;);F+=mt}if(k.strm.avail_in===0)break;if(ut=k.strm,dt=k.window,Z=k.strstart+k.lookahead,gt=F,Et=void 0,Et=ut.avail_in,gt<Et&&(Et=gt),nt=Et===0?0:(ut.avail_in-=Et,o.arraySet(dt,ut.input,ut.next_in,Et,Z),ut.state.wrap===1?ut.adler=c(ut.adler,dt,Et,Z):ut.state.wrap===2&&(ut.adler=l(ut.adler,dt,Et,Z)),ut.next_in+=Et,ut.total_in+=Et,Et),k.lookahead+=nt,k.lookahead+k.insert>=O)for(V=k.strstart-k.insert,k.ins_h=k.window[V],k.ins_h=(k.ins_h<<k.hash_shift^k.window[V+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[V+O-1])&k.hash_mask,k.prev[V&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=V,V++,k.insert--,!(k.lookahead+k.insert<O)););}while(k.lookahead<q&&k.strm.avail_in!==0)}function Jt(k,at){for(var nt,D;;){if(k.lookahead<q){if($t(k),k.lookahead<q&&at===f)return x;if(k.lookahead===0)break}if(nt=0,k.lookahead>=O&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+O-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),nt!==0&&k.strstart-nt<=k.w_size-q&&(k.match_length=lt(k,nt)),k.match_length>=O)if(D=a._tr_tally(k,k.strstart-k.match_start,k.match_length-O),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=O){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+O-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else D=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(D&&(B(k,!1),k.strm.avail_out===0))return x}return k.insert=k.strstart<O-1?k.strstart:O-1,at===d?(B(k,!0),k.strm.avail_out===0?$:P):k.last_lit&&(B(k,!1),k.strm.avail_out===0)?x:N}function Bt(k,at){for(var nt,D,F;;){if(k.lookahead<q){if($t(k),k.lookahead<q&&at===f)return x;if(k.lookahead===0)break}if(nt=0,k.lookahead>=O&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+O-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=O-1,nt!==0&&k.prev_length<k.max_lazy_match&&k.strstart-nt<=k.w_size-q&&(k.match_length=lt(k,nt),k.match_length<=5&&(k.strategy===1||k.match_length===O&&4096<k.strstart-k.match_start)&&(k.match_length=O-1)),k.prev_length>=O&&k.match_length<=k.prev_length){for(F=k.strstart+k.lookahead-O,D=a._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-O),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=F&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+O-1])&k.hash_mask,nt=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=O-1,k.strstart++,D&&(B(k,!1),k.strm.avail_out===0))return x}else if(k.match_available){if((D=a._tr_tally(k,0,k.window[k.strstart-1]))&&B(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return x}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(D=a._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<O-1?k.strstart:O-1,at===d?(B(k,!0),k.strm.avail_out===0?$:P):k.last_lit&&(B(k,!1),k.strm.avail_out===0)?x:N}function Ft(k,at,nt,D,F){this.good_length=k,this.max_lazy=at,this.nice_length=nt,this.max_chain=D,this.func=F}function ae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(j+1),this.heap=new o.Buf16(2*A+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Vt(k){var at;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=y,(at=k.state).pending=0,at.pending_out=0,at.wrap<0&&(at.wrap=-at.wrap),at.status=at.wrap?L:I,k.adler=at.wrap===2?0:1,at.last_flush=f,a._tr_init(at),h):it(k,m)}function Se(k){var at=Vt(k);return at===h&&function(nt){nt.window_size=2*nt.w_size,rt(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,nt.ins_h=0}(k.state),at}function Pe(k,at,nt,D,F,V){if(!k)return m;var ut=1;if(at===p&&(at=6),D<0?(ut=0,D=-D):15<D&&(ut=2,D-=16),F<1||T<F||nt!==v||D<8||15<D||at<0||9<at||V<0||b<V)return it(k,m);D===8&&(D=9);var dt=new ae;return(k.state=dt).strm=k,dt.wrap=ut,dt.gzhead=null,dt.w_bits=D,dt.w_size=1<<dt.w_bits,dt.w_mask=dt.w_size-1,dt.hash_bits=F+7,dt.hash_size=1<<dt.hash_bits,dt.hash_mask=dt.hash_size-1,dt.hash_shift=~~((dt.hash_bits+O-1)/O),dt.window=new o.Buf8(2*dt.w_size),dt.head=new o.Buf16(dt.hash_size),dt.prev=new o.Buf16(dt.w_size),dt.lit_bufsize=1<<F+6,dt.pending_buf_size=4*dt.lit_bufsize,dt.pending_buf=new o.Buf8(dt.pending_buf_size),dt.d_buf=1*dt.lit_bufsize,dt.l_buf=3*dt.lit_bufsize,dt.level=at,dt.strategy=V,dt.method=nt,Se(k)}s=[new Ft(0,0,0,0,function(k,at){var nt=65535;for(nt>k.pending_buf_size-5&&(nt=k.pending_buf_size-5);;){if(k.lookahead<=1){if($t(k),k.lookahead===0&&at===f)return x;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var D=k.block_start+nt;if((k.strstart===0||k.strstart>=D)&&(k.lookahead=k.strstart-D,k.strstart=D,B(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-q&&(B(k,!1),k.strm.avail_out===0))return x}return k.insert=0,at===d?(B(k,!0),k.strm.avail_out===0?$:P):(k.strstart>k.block_start&&(B(k,!1),k.strm.avail_out),x)}),new Ft(4,4,8,4,Jt),new Ft(4,5,16,8,Jt),new Ft(4,6,32,32,Jt),new Ft(4,4,16,16,Bt),new Ft(8,16,32,32,Bt),new Ft(8,16,128,128,Bt),new Ft(8,32,128,256,Bt),new Ft(32,128,258,1024,Bt),new Ft(32,258,258,4096,Bt)],i.deflateInit=function(k,at){return Pe(k,at,v,15,8,0)},i.deflateInit2=Pe,i.deflateReset=Se,i.deflateResetKeep=Vt,i.deflateSetHeader=function(k,at){return k&&k.state?k.state.wrap!==2?m:(k.state.gzhead=at,h):m},i.deflate=function(k,at){var nt,D,F,V;if(!k||!k.state||5<at||at<0)return k?it(k,m):m;if(D=k.state,!k.output||!k.input&&k.avail_in!==0||D.status===666&&at!==d)return it(k,k.avail_out===0?-5:m);if(D.strm=k,nt=D.last_flush,D.last_flush=at,D.status===L)if(D.wrap===2)k.adler=0,ht(D,31),ht(D,139),ht(D,8),D.gzhead?(ht(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),ht(D,255&D.gzhead.time),ht(D,D.gzhead.time>>8&255),ht(D,D.gzhead.time>>16&255),ht(D,D.gzhead.time>>24&255),ht(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),ht(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(ht(D,255&D.gzhead.extra.length),ht(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(k.adler=l(k.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(ht(D,0),ht(D,0),ht(D,0),ht(D,0),ht(D,0),ht(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),ht(D,3),D.status=I);else{var ut=v+(D.w_bits-8<<4)<<8;ut|=(2<=D.strategy||D.level<2?0:D.level<6?1:D.level===6?2:3)<<6,D.strstart!==0&&(ut|=32),ut+=31-ut%31,D.status=I,ct(D,ut),D.strstart!==0&&(ct(D,k.adler>>>16),ct(D,65535&k.adler)),k.adler=1}if(D.status===69)if(D.gzhead.extra){for(F=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>F&&(k.adler=l(k.adler,D.pending_buf,D.pending-F,F)),z(k),F=D.pending,D.pending!==D.pending_buf_size));)ht(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>F&&(k.adler=l(k.adler,D.pending_buf,D.pending-F,F)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(D.status===73)if(D.gzhead.name){F=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>F&&(k.adler=l(k.adler,D.pending_buf,D.pending-F,F)),z(k),F=D.pending,D.pending===D.pending_buf_size)){V=1;break}V=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,ht(D,V)}while(V!==0);D.gzhead.hcrc&&D.pending>F&&(k.adler=l(k.adler,D.pending_buf,D.pending-F,F)),V===0&&(D.gzindex=0,D.status=91)}else D.status=91;if(D.status===91)if(D.gzhead.comment){F=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>F&&(k.adler=l(k.adler,D.pending_buf,D.pending-F,F)),z(k),F=D.pending,D.pending===D.pending_buf_size)){V=1;break}V=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,ht(D,V)}while(V!==0);D.gzhead.hcrc&&D.pending>F&&(k.adler=l(k.adler,D.pending_buf,D.pending-F,F)),V===0&&(D.status=103)}else D.status=103;if(D.status===103&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&z(k),D.pending+2<=D.pending_buf_size&&(ht(D,255&k.adler),ht(D,k.adler>>8&255),k.adler=0,D.status=I)):D.status=I),D.pending!==0){if(z(k),k.avail_out===0)return D.last_flush=-1,h}else if(k.avail_in===0&&Q(at)<=Q(nt)&&at!==d)return it(k,-5);if(D.status===666&&k.avail_in!==0)return it(k,-5);if(k.avail_in!==0||D.lookahead!==0||at!==f&&D.status!==666){var dt=D.strategy===2?function(Z,gt){for(var Et;;){if(Z.lookahead===0&&($t(Z),Z.lookahead===0)){if(gt===f)return x;break}if(Z.match_length=0,Et=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,Et&&(B(Z,!1),Z.strm.avail_out===0))return x}return Z.insert=0,gt===d?(B(Z,!0),Z.strm.avail_out===0?$:P):Z.last_lit&&(B(Z,!1),Z.strm.avail_out===0)?x:N}(D,at):D.strategy===3?function(Z,gt){for(var Et,mt,Ot,ue,Dt=Z.window;;){if(Z.lookahead<=W){if($t(Z),Z.lookahead<=W&&gt===f)return x;if(Z.lookahead===0)break}if(Z.match_length=0,Z.lookahead>=O&&0<Z.strstart&&(mt=Dt[Ot=Z.strstart-1])===Dt[++Ot]&&mt===Dt[++Ot]&&mt===Dt[++Ot]){ue=Z.strstart+W;do;while(mt===Dt[++Ot]&&mt===Dt[++Ot]&&mt===Dt[++Ot]&&mt===Dt[++Ot]&&mt===Dt[++Ot]&&mt===Dt[++Ot]&&mt===Dt[++Ot]&&mt===Dt[++Ot]&&Ot<ue);Z.match_length=W-(ue-Ot),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=O?(Et=a._tr_tally(Z,1,Z.match_length-O),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(Et=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),Et&&(B(Z,!1),Z.strm.avail_out===0))return x}return Z.insert=0,gt===d?(B(Z,!0),Z.strm.avail_out===0?$:P):Z.last_lit&&(B(Z,!1),Z.strm.avail_out===0)?x:N}(D,at):s[D.level].func(D,at);if(dt!==$&&dt!==P||(D.status=666),dt===x||dt===$)return k.avail_out===0&&(D.last_flush=-1),h;if(dt===N&&(at===1?a._tr_align(D):at!==5&&(a._tr_stored_block(D,0,0,!1),at===3&&(rt(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),z(k),k.avail_out===0))return D.last_flush=-1,h}return at!==d?h:D.wrap<=0?1:(D.wrap===2?(ht(D,255&k.adler),ht(D,k.adler>>8&255),ht(D,k.adler>>16&255),ht(D,k.adler>>24&255),ht(D,255&k.total_in),ht(D,k.total_in>>8&255),ht(D,k.total_in>>16&255),ht(D,k.total_in>>24&255)):(ct(D,k.adler>>>16),ct(D,65535&k.adler)),z(k),0<D.wrap&&(D.wrap=-D.wrap),D.pending!==0?h:1)},i.deflateEnd=function(k){var at;return k&&k.state?(at=k.state.status)!==L&&at!==69&&at!==73&&at!==91&&at!==103&&at!==I&&at!==666?it(k,m):(k.state=null,at===I?it(k,-3):h):m},i.deflateSetDictionary=function(k,at){var nt,D,F,V,ut,dt,Z,gt,Et=at.length;if(!k||!k.state||(V=(nt=k.state).wrap)===2||V===1&&nt.status!==L||nt.lookahead)return m;for(V===1&&(k.adler=c(k.adler,at,Et,0)),nt.wrap=0,Et>=nt.w_size&&(V===0&&(rt(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),gt=new o.Buf8(nt.w_size),o.arraySet(gt,at,Et-nt.w_size,nt.w_size,0),at=gt,Et=nt.w_size),ut=k.avail_in,dt=k.next_in,Z=k.input,k.avail_in=Et,k.next_in=0,k.input=at,$t(nt);nt.lookahead>=O;){for(D=nt.strstart,F=nt.lookahead-(O-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[D+O-1])&nt.hash_mask,nt.prev[D&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=D,D++,--F;);nt.strstart=D,nt.lookahead=O-1,$t(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,k.next_in=dt,k.input=Z,k.avail_in=ut,nt.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,m,p,b,y,v,T,A,U,R,C,j,O,W,q,L,I,x,N;a=s.state,c=s.next_in,x=s.input,l=c+(s.avail_in-5),u=s.next_out,N=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,b=a.wnext,y=a.window,v=a.hold,T=a.bits,A=a.lencode,U=a.distcode,R=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;t:do{T<15&&(v+=x[c++]<<T,T+=8,v+=x[c++]<<T,T+=8),j=A[v&R];e:for(;;){if(v>>>=O=j>>>24,T-=O,(O=j>>>16&255)===0)N[u++]=65535&j;else{if(!(16&O)){if(!(64&O)){j=A[(65535&j)+(v&(1<<O)-1)];continue e}if(32&O){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}W=65535&j,(O&=15)&&(T<O&&(v+=x[c++]<<T,T+=8),W+=v&(1<<O)-1,v>>>=O,T-=O),T<15&&(v+=x[c++]<<T,T+=8,v+=x[c++]<<T,T+=8),j=U[v&C];n:for(;;){if(v>>>=O=j>>>24,T-=O,!(16&(O=j>>>16&255))){if(!(64&O)){j=U[(65535&j)+(v&(1<<O)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(q=65535&j,T<(O&=15)&&(v+=x[c++]<<T,(T+=8)<O&&(v+=x[c++]<<T,T+=8)),h<(q+=v&(1<<O)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=O,T-=O,(O=u-f)<q){if(p<(O=q-O)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(I=y,(L=0)===b){if(L+=m-O,O<W){for(W-=O;N[u++]=y[L++],--O;);L=u-q,I=N}}else if(b<O){if(L+=m+b-O,(O-=b)<W){for(W-=O;N[u++]=y[L++],--O;);if(L=0,b<W){for(W-=O=b;N[u++]=y[L++],--O;);L=u-q,I=N}}}else if(L+=b-O,O<W){for(W-=O;N[u++]=y[L++],--O;);L=u-q,I=N}for(;2<W;)N[u++]=I[L++],N[u++]=I[L++],N[u++]=I[L++],W-=3;W&&(N[u++]=I[L++],1<W&&(N[u++]=I[L++]))}else{for(L=u-q;N[u++]=N[L++],N[u++]=N[L++],N[u++]=N[L++],2<(W-=3););W&&(N[u++]=N[L++],1<W&&(N[u++]=N[L++]))}break}}break}}while(c<l&&u<d);c-=W=T>>3,v&=(1<<(T-=W<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=v,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,m=1,p=852,b=592;function y(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(L){var I;return L&&L.state?(I=L.state,L.total_in=L.total_out=I.total=0,L.msg="",I.wrap&&(L.adler=1&I.wrap),I.mode=m,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new s.Buf32(p),I.distcode=I.distdyn=new s.Buf32(b),I.sane=1,I.back=-1,d):h}function A(L){var I;return L&&L.state?((I=L.state).wsize=0,I.whave=0,I.wnext=0,T(L)):h}function U(L,I){var x,N;return L&&L.state?(N=L.state,I<0?(x=0,I=-I):(x=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?h:(N.window!==null&&N.wbits!==I&&(N.window=null),N.wrap=x,N.wbits=I,A(L))):h}function R(L,I){var x,N;return L?(N=new v,(L.state=N).window=null,(x=U(L,I))!==d&&(L.state=null),x):h}var C,j,O=!0;function W(L){if(O){var I;for(C=new s.Buf32(512),j=new s.Buf32(32),I=0;I<144;)L.lens[I++]=8;for(;I<256;)L.lens[I++]=9;for(;I<280;)L.lens[I++]=7;for(;I<288;)L.lens[I++]=8;for(l(u,L.lens,0,288,C,0,L.work,{bits:9}),I=0;I<32;)L.lens[I++]=5;l(f,L.lens,0,32,j,0,L.work,{bits:5}),O=!1}L.lencode=C,L.lenbits=9,L.distcode=j,L.distbits=5}function q(L,I,x,N){var $,P=L.state;return P.window===null&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new s.Buf8(P.wsize)),N>=P.wsize?(s.arraySet(P.window,I,x-P.wsize,P.wsize,0),P.wnext=0,P.whave=P.wsize):(N<($=P.wsize-P.wnext)&&($=N),s.arraySet(P.window,I,x-N,$,P.wnext),(N-=$)?(s.arraySet(P.window,I,x-N,N,0),P.wnext=N,P.whave=P.wsize):(P.wnext+=$,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=$))),0}i.inflateReset=A,i.inflateReset2=U,i.inflateResetKeep=T,i.inflateInit=function(L){return R(L,15)},i.inflateInit2=R,i.inflate=function(L,I){var x,N,$,P,it,Q,rt,z,B,ht,ct,lt,$t,Jt,Bt,Ft,ae,Vt,Se,Pe,k,at,nt,D,F=0,V=new s.Buf8(4),ut=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(x=L.state).mode===12&&(x.mode=13),it=L.next_out,$=L.output,rt=L.avail_out,P=L.next_in,N=L.input,Q=L.avail_in,z=x.hold,B=x.bits,ht=Q,ct=rt,at=d;t:for(;;)switch(x.mode){case m:if(x.wrap===0){x.mode=13;break}for(;B<16;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(2&x.wrap&&z===35615){V[x.check=0]=255&z,V[1]=z>>>8&255,x.check=a(x.check,V,2,0),B=z=0,x.mode=2;break}if(x.flags=0,x.head&&(x.head.done=!1),!(1&x.wrap)||(((255&z)<<8)+(z>>8))%31){L.msg="incorrect header check",x.mode=30;break}if((15&z)!=8){L.msg="unknown compression method",x.mode=30;break}if(B-=4,k=8+(15&(z>>>=4)),x.wbits===0)x.wbits=k;else if(k>x.wbits){L.msg="invalid window size",x.mode=30;break}x.dmax=1<<k,L.adler=x.check=1,x.mode=512&z?10:12,B=z=0;break;case 2:for(;B<16;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(x.flags=z,(255&x.flags)!=8){L.msg="unknown compression method",x.mode=30;break}if(57344&x.flags){L.msg="unknown header flags set",x.mode=30;break}x.head&&(x.head.text=z>>8&1),512&x.flags&&(V[0]=255&z,V[1]=z>>>8&255,x.check=a(x.check,V,2,0)),B=z=0,x.mode=3;case 3:for(;B<32;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}x.head&&(x.head.time=z),512&x.flags&&(V[0]=255&z,V[1]=z>>>8&255,V[2]=z>>>16&255,V[3]=z>>>24&255,x.check=a(x.check,V,4,0)),B=z=0,x.mode=4;case 4:for(;B<16;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}x.head&&(x.head.xflags=255&z,x.head.os=z>>8),512&x.flags&&(V[0]=255&z,V[1]=z>>>8&255,x.check=a(x.check,V,2,0)),B=z=0,x.mode=5;case 5:if(1024&x.flags){for(;B<16;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}x.length=z,x.head&&(x.head.extra_len=z),512&x.flags&&(V[0]=255&z,V[1]=z>>>8&255,x.check=a(x.check,V,2,0)),B=z=0}else x.head&&(x.head.extra=null);x.mode=6;case 6:if(1024&x.flags&&(Q<(lt=x.length)&&(lt=Q),lt&&(x.head&&(k=x.head.extra_len-x.length,x.head.extra||(x.head.extra=new Array(x.head.extra_len)),s.arraySet(x.head.extra,N,P,lt,k)),512&x.flags&&(x.check=a(x.check,N,lt,P)),Q-=lt,P+=lt,x.length-=lt),x.length))break t;x.length=0,x.mode=7;case 7:if(2048&x.flags){if(Q===0)break t;for(lt=0;k=N[P+lt++],x.head&&k&&x.length<65536&&(x.head.name+=String.fromCharCode(k)),k&&lt<Q;);if(512&x.flags&&(x.check=a(x.check,N,lt,P)),Q-=lt,P+=lt,k)break t}else x.head&&(x.head.name=null);x.length=0,x.mode=8;case 8:if(4096&x.flags){if(Q===0)break t;for(lt=0;k=N[P+lt++],x.head&&k&&x.length<65536&&(x.head.comment+=String.fromCharCode(k)),k&&lt<Q;);if(512&x.flags&&(x.check=a(x.check,N,lt,P)),Q-=lt,P+=lt,k)break t}else x.head&&(x.head.comment=null);x.mode=9;case 9:if(512&x.flags){for(;B<16;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(z!==(65535&x.check)){L.msg="header crc mismatch",x.mode=30;break}B=z=0}x.head&&(x.head.hcrc=x.flags>>9&1,x.head.done=!0),L.adler=x.check=0,x.mode=12;break;case 10:for(;B<32;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}L.adler=x.check=y(z),B=z=0,x.mode=11;case 11:if(x.havedict===0)return L.next_out=it,L.avail_out=rt,L.next_in=P,L.avail_in=Q,x.hold=z,x.bits=B,2;L.adler=x.check=1,x.mode=12;case 12:if(I===5||I===6)break t;case 13:if(x.last){z>>>=7&B,B-=7&B,x.mode=27;break}for(;B<3;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}switch(x.last=1&z,B-=1,3&(z>>>=1)){case 0:x.mode=14;break;case 1:if(W(x),x.mode=20,I!==6)break;z>>>=2,B-=2;break t;case 2:x.mode=17;break;case 3:L.msg="invalid block type",x.mode=30}z>>>=2,B-=2;break;case 14:for(z>>>=7&B,B-=7&B;B<32;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if((65535&z)!=(z>>>16^65535)){L.msg="invalid stored block lengths",x.mode=30;break}if(x.length=65535&z,B=z=0,x.mode=15,I===6)break t;case 15:x.mode=16;case 16:if(lt=x.length){if(Q<lt&&(lt=Q),rt<lt&&(lt=rt),lt===0)break t;s.arraySet($,N,P,lt,it),Q-=lt,P+=lt,rt-=lt,it+=lt,x.length-=lt;break}x.mode=12;break;case 17:for(;B<14;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(x.nlen=257+(31&z),z>>>=5,B-=5,x.ndist=1+(31&z),z>>>=5,B-=5,x.ncode=4+(15&z),z>>>=4,B-=4,286<x.nlen||30<x.ndist){L.msg="too many length or distance symbols",x.mode=30;break}x.have=0,x.mode=18;case 18:for(;x.have<x.ncode;){for(;B<3;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}x.lens[ut[x.have++]]=7&z,z>>>=3,B-=3}for(;x.have<19;)x.lens[ut[x.have++]]=0;if(x.lencode=x.lendyn,x.lenbits=7,nt={bits:x.lenbits},at=l(0,x.lens,0,19,x.lencode,0,x.work,nt),x.lenbits=nt.bits,at){L.msg="invalid code lengths set",x.mode=30;break}x.have=0,x.mode=19;case 19:for(;x.have<x.nlen+x.ndist;){for(;Ft=(F=x.lencode[z&(1<<x.lenbits)-1])>>>16&255,ae=65535&F,!((Bt=F>>>24)<=B);){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(ae<16)z>>>=Bt,B-=Bt,x.lens[x.have++]=ae;else{if(ae===16){for(D=Bt+2;B<D;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(z>>>=Bt,B-=Bt,x.have===0){L.msg="invalid bit length repeat",x.mode=30;break}k=x.lens[x.have-1],lt=3+(3&z),z>>>=2,B-=2}else if(ae===17){for(D=Bt+3;B<D;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}B-=Bt,k=0,lt=3+(7&(z>>>=Bt)),z>>>=3,B-=3}else{for(D=Bt+7;B<D;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}B-=Bt,k=0,lt=11+(127&(z>>>=Bt)),z>>>=7,B-=7}if(x.have+lt>x.nlen+x.ndist){L.msg="invalid bit length repeat",x.mode=30;break}for(;lt--;)x.lens[x.have++]=k}}if(x.mode===30)break;if(x.lens[256]===0){L.msg="invalid code -- missing end-of-block",x.mode=30;break}if(x.lenbits=9,nt={bits:x.lenbits},at=l(u,x.lens,0,x.nlen,x.lencode,0,x.work,nt),x.lenbits=nt.bits,at){L.msg="invalid literal/lengths set",x.mode=30;break}if(x.distbits=6,x.distcode=x.distdyn,nt={bits:x.distbits},at=l(f,x.lens,x.nlen,x.ndist,x.distcode,0,x.work,nt),x.distbits=nt.bits,at){L.msg="invalid distances set",x.mode=30;break}if(x.mode=20,I===6)break t;case 20:x.mode=21;case 21:if(6<=Q&&258<=rt){L.next_out=it,L.avail_out=rt,L.next_in=P,L.avail_in=Q,x.hold=z,x.bits=B,c(L,ct),it=L.next_out,$=L.output,rt=L.avail_out,P=L.next_in,N=L.input,Q=L.avail_in,z=x.hold,B=x.bits,x.mode===12&&(x.back=-1);break}for(x.back=0;Ft=(F=x.lencode[z&(1<<x.lenbits)-1])>>>16&255,ae=65535&F,!((Bt=F>>>24)<=B);){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(Ft&&!(240&Ft)){for(Vt=Bt,Se=Ft,Pe=ae;Ft=(F=x.lencode[Pe+((z&(1<<Vt+Se)-1)>>Vt)])>>>16&255,ae=65535&F,!(Vt+(Bt=F>>>24)<=B);){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}z>>>=Vt,B-=Vt,x.back+=Vt}if(z>>>=Bt,B-=Bt,x.back+=Bt,x.length=ae,Ft===0){x.mode=26;break}if(32&Ft){x.back=-1,x.mode=12;break}if(64&Ft){L.msg="invalid literal/length code",x.mode=30;break}x.extra=15&Ft,x.mode=22;case 22:if(x.extra){for(D=x.extra;B<D;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}x.length+=z&(1<<x.extra)-1,z>>>=x.extra,B-=x.extra,x.back+=x.extra}x.was=x.length,x.mode=23;case 23:for(;Ft=(F=x.distcode[z&(1<<x.distbits)-1])>>>16&255,ae=65535&F,!((Bt=F>>>24)<=B);){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(!(240&Ft)){for(Vt=Bt,Se=Ft,Pe=ae;Ft=(F=x.distcode[Pe+((z&(1<<Vt+Se)-1)>>Vt)])>>>16&255,ae=65535&F,!(Vt+(Bt=F>>>24)<=B);){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}z>>>=Vt,B-=Vt,x.back+=Vt}if(z>>>=Bt,B-=Bt,x.back+=Bt,64&Ft){L.msg="invalid distance code",x.mode=30;break}x.offset=ae,x.extra=15&Ft,x.mode=24;case 24:if(x.extra){for(D=x.extra;B<D;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}x.offset+=z&(1<<x.extra)-1,z>>>=x.extra,B-=x.extra,x.back+=x.extra}if(x.offset>x.dmax){L.msg="invalid distance too far back",x.mode=30;break}x.mode=25;case 25:if(rt===0)break t;if(lt=ct-rt,x.offset>lt){if((lt=x.offset-lt)>x.whave&&x.sane){L.msg="invalid distance too far back",x.mode=30;break}$t=lt>x.wnext?(lt-=x.wnext,x.wsize-lt):x.wnext-lt,lt>x.length&&(lt=x.length),Jt=x.window}else Jt=$,$t=it-x.offset,lt=x.length;for(rt<lt&&(lt=rt),rt-=lt,x.length-=lt;$[it++]=Jt[$t++],--lt;);x.length===0&&(x.mode=21);break;case 26:if(rt===0)break t;$[it++]=x.length,rt--,x.mode=21;break;case 27:if(x.wrap){for(;B<32;){if(Q===0)break t;Q--,z|=N[P++]<<B,B+=8}if(ct-=rt,L.total_out+=ct,x.total+=ct,ct&&(L.adler=x.check=x.flags?a(x.check,$,ct,it-ct):o(x.check,$,ct,it-ct)),ct=rt,(x.flags?z:y(z))!==x.check){L.msg="incorrect data check",x.mode=30;break}B=z=0}x.mode=28;case 28:if(x.wrap&&x.flags){for(;B<32;){if(Q===0)break t;Q--,z+=N[P++]<<B,B+=8}if(z!==(4294967295&x.total)){L.msg="incorrect length check",x.mode=30;break}B=z=0}x.mode=29;case 29:at=1;break t;case 30:at=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=it,L.avail_out=rt,L.next_in=P,L.avail_in=Q,x.hold=z,x.bits=B,(x.wsize||ct!==L.avail_out&&x.mode<30&&(x.mode<27||I!==4))&&q(L,L.output,L.next_out,ct-L.avail_out)?(x.mode=31,-4):(ht-=L.avail_in,ct-=L.avail_out,L.total_in+=ht,L.total_out+=ct,x.total+=ct,x.wrap&&ct&&(L.adler=x.check=x.flags?a(x.check,$,ct,L.next_out-ct):o(x.check,$,ct,L.next_out-ct)),L.data_type=x.bits+(x.last?64:0)+(x.mode===12?128:0)+(x.mode===20||x.mode===15?256:0),(ht==0&&ct===0||I===4)&&at===d&&(at=-5),at)},i.inflateEnd=function(L){if(!L||!L.state)return h;var I=L.state;return I.window&&(I.window=null),L.state=null,d},i.inflateGetHeader=function(L,I){var x;return L&&L.state&&2&(x=L.state).wrap?((x.head=I).done=!1,d):h},i.inflateSetDictionary=function(L,I){var x,N=I.length;return L&&L.state?(x=L.state).wrap!==0&&x.mode!==11?h:x.mode===11&&o(1,I,N,0)!==x.check?-3:q(L,I,N,N)?(x.mode=31,-4):(x.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,m,p,b,y){var v,T,A,U,R,C,j,O,W,q=y.bits,L=0,I=0,x=0,N=0,$=0,P=0,it=0,Q=0,rt=0,z=0,B=null,ht=0,ct=new s.Buf16(16),lt=new s.Buf16(16),$t=null,Jt=0;for(L=0;L<=15;L++)ct[L]=0;for(I=0;I<h;I++)ct[f[d+I]]++;for($=q,N=15;1<=N&&ct[N]===0;N--);if(N<$&&($=N),N===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(x=1;x<N&&ct[x]===0;x++);for($<x&&($=x),L=Q=1;L<=15;L++)if(Q<<=1,(Q-=ct[L])<0)return-1;if(0<Q&&(u===0||N!==1))return-1;for(lt[1]=0,L=1;L<15;L++)lt[L+1]=lt[L]+ct[L];for(I=0;I<h;I++)f[d+I]!==0&&(b[lt[f[d+I]]++]=I);if(C=u===0?(B=$t=b,19):u===1?(B=o,ht-=257,$t=a,Jt-=257,256):(B=c,$t=l,-1),L=x,R=p,it=I=z=0,A=-1,U=(rt=1<<(P=$))-1,u===1&&852<rt||u===2&&592<rt)return 1;for(;;){for(j=L-it,W=b[I]<C?(O=0,b[I]):b[I]>C?(O=$t[Jt+b[I]],B[ht+b[I]]):(O=96,0),v=1<<L-it,x=T=1<<P;m[R+(z>>it)+(T-=v)]=j<<24|O<<16|W|0,T!==0;);for(v=1<<L-1;z&v;)v>>=1;if(v!==0?(z&=v-1,z+=v):z=0,I++,--ct[L]==0){if(L===N)break;L=f[d+b[I]]}if($<L&&(z&U)!==A){for(it===0&&(it=$),R+=x,Q=1<<(P=L-it);P+it<N&&!((Q-=ct[P+it])<=0);)P++,Q<<=1;if(rt+=1<<P,u===1&&852<rt||u===2&&592<rt)return 1;m[A=z&U]=$<<24|P<<16|R-p|0}}return z!==0&&(m[R+z]=L-it<<24|64<<16|0),y.bits=$,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var V=F.length;0<=--V;)F[V]=0}var l=0,u=29,f=256,d=f+1+u,h=30,m=19,p=2*d+1,b=15,y=16,v=7,T=256,A=16,U=17,R=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(d+2));c(q);var L=new Array(2*h);c(L);var I=new Array(512);c(I);var x=new Array(256);c(x);var N=new Array(u);c(N);var $,P,it,Q=new Array(h);function rt(F,V,ut,dt,Z){this.static_tree=F,this.extra_bits=V,this.extra_base=ut,this.elems=dt,this.max_length=Z,this.has_stree=F&&F.length}function z(F,V){this.dyn_tree=F,this.max_code=0,this.stat_desc=V}function B(F){return F<256?I[F]:I[256+(F>>>7)]}function ht(F,V){F.pending_buf[F.pending++]=255&V,F.pending_buf[F.pending++]=V>>>8&255}function ct(F,V,ut){F.bi_valid>y-ut?(F.bi_buf|=V<<F.bi_valid&65535,ht(F,F.bi_buf),F.bi_buf=V>>y-F.bi_valid,F.bi_valid+=ut-y):(F.bi_buf|=V<<F.bi_valid&65535,F.bi_valid+=ut)}function lt(F,V,ut){ct(F,ut[2*V],ut[2*V+1])}function $t(F,V){for(var ut=0;ut|=1&F,F>>>=1,ut<<=1,0<--V;);return ut>>>1}function Jt(F,V,ut){var dt,Z,gt=new Array(b+1),Et=0;for(dt=1;dt<=b;dt++)gt[dt]=Et=Et+ut[dt-1]<<1;for(Z=0;Z<=V;Z++){var mt=F[2*Z+1];mt!==0&&(F[2*Z]=$t(gt[mt]++,mt))}}function Bt(F){var V;for(V=0;V<d;V++)F.dyn_ltree[2*V]=0;for(V=0;V<h;V++)F.dyn_dtree[2*V]=0;for(V=0;V<m;V++)F.bl_tree[2*V]=0;F.dyn_ltree[2*T]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Ft(F){8<F.bi_valid?ht(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function ae(F,V,ut,dt){var Z=2*V,gt=2*ut;return F[Z]<F[gt]||F[Z]===F[gt]&&dt[V]<=dt[ut]}function Vt(F,V,ut){for(var dt=F.heap[ut],Z=ut<<1;Z<=F.heap_len&&(Z<F.heap_len&&ae(V,F.heap[Z+1],F.heap[Z],F.depth)&&Z++,!ae(V,dt,F.heap[Z],F.depth));)F.heap[ut]=F.heap[Z],ut=Z,Z<<=1;F.heap[ut]=dt}function Se(F,V,ut){var dt,Z,gt,Et,mt=0;if(F.last_lit!==0)for(;dt=F.pending_buf[F.d_buf+2*mt]<<8|F.pending_buf[F.d_buf+2*mt+1],Z=F.pending_buf[F.l_buf+mt],mt++,dt===0?lt(F,Z,V):(lt(F,(gt=x[Z])+f+1,V),(Et=C[gt])!==0&&ct(F,Z-=N[gt],Et),lt(F,gt=B(--dt),ut),(Et=j[gt])!==0&&ct(F,dt-=Q[gt],Et)),mt<F.last_lit;);lt(F,T,V)}function Pe(F,V){var ut,dt,Z,gt=V.dyn_tree,Et=V.stat_desc.static_tree,mt=V.stat_desc.has_stree,Ot=V.stat_desc.elems,ue=-1;for(F.heap_len=0,F.heap_max=p,ut=0;ut<Ot;ut++)gt[2*ut]!==0?(F.heap[++F.heap_len]=ue=ut,F.depth[ut]=0):gt[2*ut+1]=0;for(;F.heap_len<2;)gt[2*(Z=F.heap[++F.heap_len]=ue<2?++ue:0)]=1,F.depth[Z]=0,F.opt_len--,mt&&(F.static_len-=Et[2*Z+1]);for(V.max_code=ue,ut=F.heap_len>>1;1<=ut;ut--)Vt(F,gt,ut);for(Z=Ot;ut=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Vt(F,gt,1),dt=F.heap[1],F.heap[--F.heap_max]=ut,F.heap[--F.heap_max]=dt,gt[2*Z]=gt[2*ut]+gt[2*dt],F.depth[Z]=(F.depth[ut]>=F.depth[dt]?F.depth[ut]:F.depth[dt])+1,gt[2*ut+1]=gt[2*dt+1]=Z,F.heap[1]=Z++,Vt(F,gt,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(Dt,Yn){var S,g,_,M,G,tt,ot=Yn.dyn_tree,zt=Yn.max_code,Ie=Yn.stat_desc.static_tree,be=Yn.stat_desc.has_stree,Oe=Yn.stat_desc.extra_bits,le=Yn.stat_desc.extra_base,ja=Yn.stat_desc.max_length,eu=0;for(M=0;M<=b;M++)Dt.bl_count[M]=0;for(ot[2*Dt.heap[Dt.heap_max]+1]=0,S=Dt.heap_max+1;S<p;S++)ja<(M=ot[2*ot[2*(g=Dt.heap[S])+1]+1]+1)&&(M=ja,eu++),ot[2*g+1]=M,zt<g||(Dt.bl_count[M]++,G=0,le<=g&&(G=Oe[g-le]),tt=ot[2*g],Dt.opt_len+=tt*(M+G),be&&(Dt.static_len+=tt*(Ie[2*g+1]+G)));if(eu!==0){do{for(M=ja-1;Dt.bl_count[M]===0;)M--;Dt.bl_count[M]--,Dt.bl_count[M+1]+=2,Dt.bl_count[ja]--,eu-=2}while(0<eu);for(M=ja;M!==0;M--)for(g=Dt.bl_count[M];g!==0;)zt<(_=Dt.heap[--S])||(ot[2*_+1]!==M&&(Dt.opt_len+=(M-ot[2*_+1])*ot[2*_],ot[2*_+1]=M),g--)}}(F,V),Jt(gt,ue,F.bl_count)}function k(F,V,ut){var dt,Z,gt=-1,Et=V[1],mt=0,Ot=7,ue=4;for(Et===0&&(Ot=138,ue=3),V[2*(ut+1)+1]=65535,dt=0;dt<=ut;dt++)Z=Et,Et=V[2*(dt+1)+1],++mt<Ot&&Z===Et||(mt<ue?F.bl_tree[2*Z]+=mt:Z!==0?(Z!==gt&&F.bl_tree[2*Z]++,F.bl_tree[2*A]++):mt<=10?F.bl_tree[2*U]++:F.bl_tree[2*R]++,gt=Z,ue=(mt=0)===Et?(Ot=138,3):Z===Et?(Ot=6,3):(Ot=7,4))}function at(F,V,ut){var dt,Z,gt=-1,Et=V[1],mt=0,Ot=7,ue=4;for(Et===0&&(Ot=138,ue=3),dt=0;dt<=ut;dt++)if(Z=Et,Et=V[2*(dt+1)+1],!(++mt<Ot&&Z===Et)){if(mt<ue)for(;lt(F,Z,F.bl_tree),--mt!=0;);else Z!==0?(Z!==gt&&(lt(F,Z,F.bl_tree),mt--),lt(F,A,F.bl_tree),ct(F,mt-3,2)):mt<=10?(lt(F,U,F.bl_tree),ct(F,mt-3,3)):(lt(F,R,F.bl_tree),ct(F,mt-11,7));gt=Z,ue=(mt=0)===Et?(Ot=138,3):Z===Et?(Ot=6,3):(Ot=7,4)}}c(Q);var nt=!1;function D(F,V,ut,dt){ct(F,(l<<1)+(dt?1:0),3),function(Z,gt,Et,mt){Ft(Z),ht(Z,Et),ht(Z,~Et),s.arraySet(Z.pending_buf,Z.window,gt,Et,Z.pending),Z.pending+=Et}(F,V,ut)}i._tr_init=function(F){nt||(function(){var V,ut,dt,Z,gt,Et=new Array(b+1);for(Z=dt=0;Z<u-1;Z++)for(N[Z]=dt,V=0;V<1<<C[Z];V++)x[dt++]=Z;for(x[dt-1]=Z,Z=gt=0;Z<16;Z++)for(Q[Z]=gt,V=0;V<1<<j[Z];V++)I[gt++]=Z;for(gt>>=7;Z<h;Z++)for(Q[Z]=gt<<7,V=0;V<1<<j[Z]-7;V++)I[256+gt++]=Z;for(ut=0;ut<=b;ut++)Et[ut]=0;for(V=0;V<=143;)q[2*V+1]=8,V++,Et[8]++;for(;V<=255;)q[2*V+1]=9,V++,Et[9]++;for(;V<=279;)q[2*V+1]=7,V++,Et[7]++;for(;V<=287;)q[2*V+1]=8,V++,Et[8]++;for(Jt(q,d+1,Et),V=0;V<h;V++)L[2*V+1]=5,L[2*V]=$t(V,5);$=new rt(q,C,f+1,d,b),P=new rt(L,j,0,h,b),it=new rt(new Array(0),O,0,m,v)}(),nt=!0),F.l_desc=new z(F.dyn_ltree,$),F.d_desc=new z(F.dyn_dtree,P),F.bl_desc=new z(F.bl_tree,it),F.bi_buf=0,F.bi_valid=0,Bt(F)},i._tr_stored_block=D,i._tr_flush_block=function(F,V,ut,dt){var Z,gt,Et=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(mt){var Ot,ue=4093624447;for(Ot=0;Ot<=31;Ot++,ue>>>=1)if(1&ue&&mt.dyn_ltree[2*Ot]!==0)return o;if(mt.dyn_ltree[18]!==0||mt.dyn_ltree[20]!==0||mt.dyn_ltree[26]!==0)return a;for(Ot=32;Ot<f;Ot++)if(mt.dyn_ltree[2*Ot]!==0)return a;return o}(F)),Pe(F,F.l_desc),Pe(F,F.d_desc),Et=function(mt){var Ot;for(k(mt,mt.dyn_ltree,mt.l_desc.max_code),k(mt,mt.dyn_dtree,mt.d_desc.max_code),Pe(mt,mt.bl_desc),Ot=m-1;3<=Ot&&mt.bl_tree[2*W[Ot]+1]===0;Ot--);return mt.opt_len+=3*(Ot+1)+5+5+4,Ot}(F),Z=F.opt_len+3+7>>>3,(gt=F.static_len+3+7>>>3)<=Z&&(Z=gt)):Z=gt=ut+5,ut+4<=Z&&V!==-1?D(F,V,ut,dt):F.strategy===4||gt===Z?(ct(F,2+(dt?1:0),3),Se(F,q,L)):(ct(F,4+(dt?1:0),3),function(mt,Ot,ue,Dt){var Yn;for(ct(mt,Ot-257,5),ct(mt,ue-1,5),ct(mt,Dt-4,4),Yn=0;Yn<Dt;Yn++)ct(mt,mt.bl_tree[2*W[Yn]+1],3);at(mt,mt.dyn_ltree,Ot-1),at(mt,mt.dyn_dtree,ue-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,Et+1),Se(F,F.dyn_ltree,F.dyn_dtree)),Bt(F),dt&&Ft(F)},i._tr_tally=function(F,V,ut){return F.pending_buf[F.d_buf+2*F.last_lit]=V>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&V,F.pending_buf[F.l_buf+F.last_lit]=255&ut,F.last_lit++,V===0?F.dyn_ltree[2*ut]++:(F.matches++,V--,F.dyn_ltree[2*(x[ut]+f+1)]++,F.dyn_dtree[2*B(V)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){ct(F,2,3),lt(F,T,q),function(V){V.bi_valid===16?(ht(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},m=!1,p=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){xr.nextTick(function(){v(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,U=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=U,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){u.port2.postMessage(A)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(A){var U=p.createElement("script");U.onreadystatechange=function(){v(A),U.onreadystatechange=null,l.removeChild(U),U=null},l.appendChild(U)}):function(A){setTimeout(v,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var U=new Array(arguments.length-1),R=0;R<U.length;R++)U[R]=arguments[R+1];var C={callback:A,args:U};return h[d]=C,c(d),d++},b.clearImmediate=y}function y(A){delete h[A]}function v(A){if(m)setTimeout(v,0,A);else{var U=h[A];if(U){m=!0;try{(function(R){var C=R.callback,j=R.args;switch(j.length){case 0:C();break;case 1:C(j[0]);break;case 2:C(j[0],j[1]);break;case 3:C(j[0],j[1],j[2]);break;default:C.apply(a,j)}})(U)}finally{y(A),m=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&v(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Nn<"u"?Nn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(N1);var ZF=N1.exports,Rd=Us(ZF);const C1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(C1);var br=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},No,Da,Ms;class QF{constructor(...t){No.set(this,new Map),Da.set(this,new Map),Ms.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),br(this,Ms,"f").has(r)||br(this,Ms,"f").set(r,new Set);const s=br(this,Ms,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&br(this,Da,"f").set(r,a),o=!1,c)continue;const l=br(this,No,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);br(this,No,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:br(this,No,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&br(this,Da,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:br(this,Ms,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of br(this,Ms,"f").values())Object.freeze(t);return this}_getTestState(){return{types:br(this,No,"f"),extensions:br(this,Da,"f")}}}No=new WeakMap,Da=new WeakMap,Ms=new WeakMap;var tP=new QF(C1)._freeze();function eP(e,t){console.info(t)}function nP(e,t){console.info(t)}const L1=60,rP=L1*25;function iP(e,t){let n=0;const r=new DataView(t.buffer);function i(){const N=r.getUint8(n);return n++,N}function s(){const N=r.getInt16(n,!0);return n+=2,N}function o(){const N=r.getInt32(n,!0);return n+=4,N}function a(N){let $="";const P=t.subarray(n,n+N);for(let it=0;it<P.length;++it)$+=String.fromCharCode(P[it]);return n+=N,$.replace("\r",`
`)}function c(N,$,P,it){const Q=Br(N,$,P);if(w(Q)&&w(it)){const rt=Xn(it);for(let z=0;z<rt.length;++z){const B=rt[z];Q[B]=it[B]}}if(w($)){const[rt]=$;rt==="scroll"&&console.info("writefromkind",rt,"-",Q,"-")}}function l(N){let $="";for(let P=0;P<N.length;++P){const it=N.charCodeAt(P);it<32||it>127?$+=`$${it}`:$+=N[P]}return $}function u(N){return N.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map($=>{if($.includes("$")){const[P,...it]=$.split("$");return`${P??""}"$CENTER ${l(it.join("$"))}"`}return l($)}).join(`
`)}function f(N,$,P,it,Q){const z=[Rt[it.color%16]],B={},ht=Q.find(ct=>ct.x===$&&ct.y===P);switch(w(ht)&&(xt(ht.cycle)&&ht.cycle>0&&(B.cycle=ht.cycle),w(ht.p1)&&(B.p1=ht.p1),w(ht.p2)&&(B.p2=ht.p2),w(ht.p3)&&(B.p3=ht.p3),w(ht.code)&&ht.code&&(B.code=u(ht.code))),it.element){case 0:case 1:case 2:case 3:case 4:break;case 5:c(N,["ammo",z],{x:$,y:P},B);break;case 6:c(N,["torch",z],{x:$,y:P},B);break;case 7:c(N,["gem",z],{x:$,y:P},B);break;case 8:c(N,["key",z],{x:$,y:P},B);break;case 9:c(N,["door",z],{x:$,y:P},B);break;case 10:c(N,["scroll",z],{x:$,y:P},B);break;case 11:c(N,["passage",z],{x:$,y:P},{...B,p3:d(ht==null?void 0:ht.p3)??""});break;case 12:c(N,["duplicator",z],{x:$,y:P},B);break;case 13:c(N,["bomb",z],{x:$,y:P},B);break;case 14:c(N,["energize",z],{x:$,y:P},B);break;case 15:c(N,["star",z],{x:$,y:P},B);break;case 16:c(N,["clockwise",z],{x:$,y:P},B);break;case 17:c(N,["counter",z],{x:$,y:P},B);break;case 18:c(N,["bullet",z],{x:$,y:P},B);break;case 19:c(N,["water",z],{x:$,y:P},B);break;case 20:c(N,["forest",z],{x:$,y:P},B);break;case 21:c(N,["solid",z],{x:$,y:P},B);break;case 22:c(N,["normal",z],{x:$,y:P},B);break;case 23:c(N,["breakable",z],{x:$,y:P},B);break;case 24:c(N,["boulder",z],{x:$,y:P},B);break;case 25:c(N,["sliderns",z],{x:$,y:P},B);break;case 26:c(N,["sliderew",z],{x:$,y:P},B);break;case 27:c(N,["fake",z],{x:$,y:P},B);break;case 28:c(N,["invisible",z],{x:$,y:P},B);break;case 29:c(N,["blinkwall",z],{x:$,y:P},B);break;case 30:c(N,["transporter",z],{x:$,y:P},B);break;case 31:c(N,["line",z],{x:$,y:P},B);break;case 32:c(N,["ricochet",z],{x:$,y:P},B);break;case 33:c(N,["blinkns",z],{x:$,y:P},B);break;case 34:c(N,["bear",z],{x:$,y:P},B);break;case 35:c(N,["ruffian",z],{x:$,y:P},B);break;case 36:c(N,["object",z],{x:$,y:P},{...B,char:(ht==null?void 0:ht.p1)??1});break;case 37:c(N,["slime",z],{x:$,y:P},B);break;case 38:c(N,["shark",z],{x:$,y:P},B);break;case 39:c(N,["spinninggun",z],{x:$,y:P},B);break;case 40:c(N,["pusher",z],{x:$,y:P},B);break;case 41:c(N,["lion",z],{x:$,y:P},B);break;case 42:c(N,["tiger",z],{x:$,y:P},B);break;case 43:c(N,["blinkns",z],{x:$,y:P},B);break;case 44:c(N,["head",z],{x:$,y:P},B);break;case 45:c(N,["segment",z],{x:$,y:P},B);break;case 46:break;case 47:c(N,["text",["WHITE","ONDKBLUE"]],{x:$,y:P},{...B,char:it.color});break;case 48:c(N,["text",["WHITE","ONDKGREEN"]],{x:$,y:P},{...B,char:it.color});break;case 49:c(N,["text",["WHITE","ONDKCYAN"]],{x:$,y:P},{...B,char:it.color});break;case 50:c(N,["text",["WHITE","ONDKRED"]],{x:$,y:P},{...B,char:it.color});break;case 51:c(N,["text",["WHITE","ONDKPURPLE"]],{x:$,y:P},{...B,char:it.color});break;case 52:c(N,["text",["WHITE","ONDKYELLOW"]],{x:$,y:P},{...B,char:it.color});break;case 53:c(N,["text",["WHITE","ONBLACK"]],{x:$,y:P},{...B,char:it.color});break}}function d(N){if(xt(N)&&N>0)return`zztboard${N}`}if(s()!=-1)return;const m=s(),p=s(),b=s(),y=a(7),v=s(),T=s(),A=s(),U=s(),R=s();s();const C=s(),j=i(),O=a(20).slice(0,j);for(let N=0;N<9;N++){const $=i();a(20).slice(0,$)}const W=s(),q=s(),L=i();console.info(p,b,y,v,T,A,U,R,C,W,q,L),n=512;const I=[];for(let N=0;N<m;++N){const $=s(),P=n,it=i(),rt={boardname:a(50).slice(0,it),elements:[],stats:[]};for(;rt.elements.length<rP;){let B=i();B===0&&(B=255);const ht=i(),ct=i();for(let lt=0;lt<B;++lt)rt.elements.push({element:ht,color:ct})}rt.maxplayershots=i(),rt.isdark=i(),rt.exitnorth=i(),rt.exitsouth=i(),rt.exitwest=i(),rt.exiteast=i(),rt.restartonzap=i(),rt.messagelength=i(),rt.message=a(58).slice(0,rt.messagelength),rt.playerenterx=i(),rt.playerentery=i(),rt.timelimit=s(),n+=16;const z=s()+1;for(;rt.stats.length<z;){const B={};B.x=i()-1,B.y=i()-1,B.stepx=s(),B.stepy=s(),B.cycle=s(),B.p1=i(),B.p2=i(),B.p3=i(),B.follower=s(),B.leader=s(),B.underelement=i(),B.undercolor=i(),B.pointer=o(),B.currentinstruction=s();const ht=s();n+=8,ht<0?B.bind=Math.abs(ht):B.code=a(ht),rt.stats.push(B)}I.push(rt),n=P+$}const x=Vf([]);x.name=O;for(let N=0;N<I.length;++N){const $=I[N],P=[`@zztboard${N}`,""];N===T&&P.push("@title"),xt($.maxplayershots)&&P.push(`@maxplayershots ${$.maxplayershots}`),$.isdark&&P.push("@isdark"),$.restartonzap&&P.push("@restartonzap"),xt($.timelimit)&&P.push(`@timelimit ${$.timelimit}`);const it=d($.exitnorth);_t(it)&&P.push(`@exitnorth ${it}`);const Q=d($.exitsouth);_t(Q)&&P.push(`@exitsouth ${Q}`);const rt=d($.exitwest);_t(rt)&&P.push(`@exitwest ${rt}`);const z=d($.exiteast);_t(z)&&P.push(`@exiteast ${z}`);const B=`@board ${String(N).padStart(3,"0")}. ${$.boardname}
${P.join(`
`)}`,ht=ob(B,{});Jf(x,ht);const ct=Ae(ht);if(!w(ct))continue;let lt=0,$t=0;for(let Jt=0;Jt<$.elements.length;++Jt){const Bt=$.elements[Jt];f(ct,lt,$t,Bt,$.stats),++lt,lt===L1&&(lt=0,++$t)}ve(ct)}Hl(x),Yd(et,e,`imported zzt file into ${x.name} book`)}function M1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return tP.getType(e)??"application/octet-stream"}async function sP(e,t,n){try{xe(et,e,"parsezipfile",t.name);const r=await t.arrayBuffer();(await new Rd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=M1(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{he(et,e,"crash",c.message)})})}catch(r){he(et,e,"crash",r.message)}}function U1(e,t,n){if(w(n))switch(t){case"text/plain":n.text().then(r=>mu(et,e,void 0,"text",`file:${n.name}`,r)).catch(r=>he(et,e,"crash",r.message));break;case"application/json":n.text().then(r=>mu(et,e,void 0,"json",`file:${n.name}`,r)).catch(r=>he(et,e,"crash",r.message));break;case"application/zip":sP(e,n,r=>F1(e,r)).catch(r=>he(et,e,"crash",r.message));break;case"application/octet-stream":/.zzt$/i.test(n.name)&&n.arrayBuffer().then(r=>{iP(e,new Uint8Array(r))}).catch(r=>he(et,e,"crash",r.message)),/.zzl$/i.test(n.name)&&n.text().then(r=>{eP(e,r)}).catch(r=>he(et,e,"crash",r.message)),/.zzm$/i.test(n.name)&&n.text().then(r=>{nP(e,r)}).catch(r=>he(et,e,"crash",r.message));break;default:n.arrayBuffer().then(r=>{const i=M1(n.name,new Uint8Array(r));if(i)U1(e,i,n);else return he(et,e,"parsewebfile",`unsupported file ${n.name}`)}).catch(r=>he(et,e,"crash",r.message));return}}function F1(e,t){U1(e,(t==null?void 0:t.type)??"",t)}function ui(e,t,n){n().catch(r=>{console.error(r),he(e,t,"crash",r==null?void 0:r.message)})}function oP(e){const[t,n]=e.split(":"),r=w(n);return[r?t:"self",r?n:e]}function aP(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function cP(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const lP=new Date("1980/09/02");async function Sd(e){return console.info("saved",e),new Promise((t,n)=>{const r=new Rd;for(let i=0;i<e.length;++i){const s=e[i],o=hL(s);if(o){const a=aT(o);w(a)&&r.file(s.id,a,{date:lP})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(cP(i))}).catch(n)})}async function uP(e){return new Promise((t,n)=>{const r=new Rd;r.loadAsync(aP(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=fL(cT(c));w(l)&&i.push(l)}t(i)}).catch(n)})}function hP(e,t,n,r){const i=ln(e);if(!w(i))return;let s=0;function o(){return s}function a(l,u){xt(u)&&(s=u,Xp(t.x,t.y,n.x,n.y).forEach(f=>{const d=ne(i,f);w(d)&&(d[l]=u)}))}At(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We),Nt(e,`batch:${ro(t,n)}`,"char",[r,"charedit"],o,a);const c=Ke(e);c.scroll=kn(e)}function fP(e,t,n,r){const i=ln(e);if(!w(i))return;let s=0;function o(){return s}function a(l,u){if(xt(u)){s=u;for(let f=t.y;f<=n.y;++f)for(let d=t.x;d<=n.x;++d){const h=ne(i,{x:d,y:f});w(h)&&(h[l]=u)}}}At(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We),Nt(e,`batch:${ro(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ke(e);c.scroll=kn(e)}function dP(e,t,n,r){const i=ln(e);if(!w(i))return;let s=0;function o(){return s}function a(l,u){xt(u)&&(s=u,Xp(t.x,t.y,n.x,n.y).forEach(f=>{const d=ne(i,f);w(d)&&(d[l]=u)}))}At(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We),Nt(e,`batch:${ro(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ke(e);c.scroll=kn(e)}function pP(e,t,n,r){const i=an(Pt.MAIN);if(!w(i))return;const s=ln(e);if(!w(s))return;const o=ro(t,n);At(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We),Nt(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Nt(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),r&&Nt(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Nt(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),Nt(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),At(e,We),Nt(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Nt(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Nt(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),At(e,We),Nt(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),At(e,We),At(e,"codepages:"),Nt(e,"batch","edit @board codepage",[`pageopen:${s.id}`]);const a=Math.min(t.x,n.x),c=Math.min(t.y,n.y),l=Math.max(t.x,n.x),u=Math.max(t.y,n.y),f=new Set;for(let d=c;d<=u;++d)for(let h=a;h<=l;++h){const m=ne(s,{x:h,y:d}),p=hb(i,m);w(p)&&!f.has(p.id)&&(f.add(p.id),Nt(e,"batch",`edit @${Le(p)}`,[`pageopen:${p.id}`]))}Nt(e,"batch",`board id ${s.id}`,["","copyit",s.id])}function Id(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function mP(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Id(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let Od;function P1(){return Od||(Od=mP("keyval-store","keyval")),Od}function B1(e,t=P1()){return t("readonly",n=>Id(n.get(e)))}function $1(e,t,n=P1()){return n("readwrite",r=>new Promise((i,s)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),i(Id(r.transaction))}catch(o){s(o)}}}))}function Nd(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function D1(){return B1("secretheap")}async function j1(e){return $1("secretheap",e)}async function gP(){return!!await D1()}function z1(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},m=ne(e,{x:d,y:f});(m==null?void 0:m.category)===Ln.ISOBJECT?(l.push(wr(es(e,d,f))),Sr(m)!=="player"&&u.push({...wr(m),...h,id:"blank"})):l.push({...wr(m),...h})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function _P(e,t,n,r){const i=ln(e);if(!w(i))return;const s=z1(i,t,n);switch(r){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await j1(()=>s)}function yP(e,t,n){const r=Nd(t,n);At(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We),Nt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Nt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Nt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=Ke(e);i.scroll=kn(e)}async function bP(e,t,n,r){const i=an(Pt.MAIN);if(!w(i))return;const s=ln(e);if(!w(s))return;const o=z1(s,t,n);switch(r){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(r){case"cutall":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ne(s,{x:c,y:a});(l==null?void 0:l.category)===Ln.ISOBJECT&&xn(s,l,i.timestamp),Re(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ne(s,{x:c,y:a});(l==null?void 0:l.category)===Ln.ISOBJECT&&xn(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c)Re(s,{x:c,y:a});break}}await j1(()=>o)}function wP(e,t,n){const r=Nd(t,n);At(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We),Nt(e,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Nt(e,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Nt(e,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=Ke(e);i.scroll=kn(e)}async function xP(e,t,n,r){const i=ln(e),s=await D1();if(!w(i)||!w(s))return;const o=Math.min(t.x,n.x),a=Math.min(t.y,n.y),c=Math.max(t.x,n.x),l=Math.max(t.y,n.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(r){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<d;++p){const b=cr({x:p,y:m},s.width);Re(i,{...s.terrain[b],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&fh(p.x,p.y,0,u-1,f-1,0)&&kd(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&fh(p.x,p.y,0,u-1,f-1,0)&&kd(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<d;++p){const b=cr({x:p,y:m},s.width);Re(i,{...s.terrain[b],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const b=(p-o)%s.width,y=(m-a)%s.height,v=cr({x:b,y},s.width);Re(i,{...s.terrain[v],x:p,y:m})}break}}function EP(e,t,n){const r=Nd(t,n);At(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We),Nt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Nt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Nt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Nt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=Ke(e);i.scroll=kn(e)}function Cd(e,t){return`inspect:${t!=null&&t.id?t.id:$r(e,t)}`}function kP(e,t,n){const r=an(Pt.MAIN);if(!w(r))return;const i=ln(e);if(!w(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){w(t)&&(t[d]=h)}const a=t.category===Ln.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Cd(i,t);At(e,`${a}: ${c} ${l}`),At(e,We),Nt(e,u,"color",[n,"coloredit"],s,o);const f=Ke(e);f.scroll=kn(e)}function vP(e,t,n){const r=an(Pt.MAIN);if(!w(r))return;const i=ln(e);if(!w(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){w(t)&&(t[d]=h)}const a=t.category===Ln.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Cd(i,t);At(e,`${a}: ${c} ${l}`),At(e,We),Nt(e,u,"char",[n,"charedit"],s,o);const f=Ke(e);f.scroll=kn(e)}function TP(e,t,n,r,i,s){var h,m,p;const o=an(Pt.MAIN);if(!w(o))return;function a(b){var v;const y=(r==null?void 0:r[b])??((v=r==null?void 0:r.kinddata)==null?void 0:v[b]);if(!w(y))switch(b){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return jt.ISWALK;case"pushable":return 0;case"breakable":return 0}return y}function c(b,y){w(r)&&(r[b]=y)}s?At(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):At(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`);const l=Cd(t,r);switch(s&&At(e,`cycle: ${Ht(r,"cycle")}`),Ht(r,"collision")){case jt.ISWALK:At(e,"collision: iswalk");break;case jt.ISSWIM:At(e,"collision: isswim");break;case jt.ISSOLID:At(e,"collision: issolid");break;case jt.ISBULLET:At(e,"collision: isbullet");break}s&&At(e,`ispushable: ${Ht(r,"pushable")?"yes":"no"}`),At(e,`isbreakable: ${Ht(r,"breakable")?"yes":"no"}`),At(e,We);const f=Oa(n),d=Xn(f);for(let b=0;b<d.length;++b){const y=d[b];switch(y){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ce(f[y])){const[v,T,...A]=f[y];_t(T)&&Nt(e,l,T||y,[y,v,...A],a,c)}break}}Nt(e,l,"copy coords",["copycoords","hk","5"," 5 "]),At(e,We),Nt(e,l,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],a,c),Nt(e,l,`color: ${r.color??((m=r.kinddata)==null?void 0:m.color)??15}`,["color","hk","c"," C ","next"],a,c),Nt(e,l,`bg: ${r.bg??((p=r.kinddata)==null?void 0:p.bg)??0}`,["bg","hk","b"," B ","next"],a,c),At(e,We),Nt(e,l,"make empty",["empty","hk","0"],a,c),At(e,We),Nt(e,"batch","edit @board codepage",[`pageopen:${t.id}`]),Nt(e,"batch",`edit @${Le(n)}`,[`pageopen:${n.id}`]),Nt(e,"batch",`board id ${t.id}`,["","copyit",t.id])}function AP(e,t,n,r){const i=an(Pt.MAIN);if(!w(i))return;const s=ln(e);if(w(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ne(s,{x:a,y:o});(c==null?void 0:c.category)===Ln.ISOBJECT&&xn(s,c,i.timestamp),Re(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ne(s,{x:a,y:o});(c==null?void 0:c.category)===Ln.ISOBJECT&&xn(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Re(s,{x:a,y:o});break}}}function RP(e,t,n){const r=an(Pt.MAIN);if(!w(r))return;const i=ln(e);if(!w(i))return;const s=ro(t,n);At(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We),Nt(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Nt(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Nt(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Ke(e);o.scroll=kn(e)}async function SP(e,t,n){const r=an(Pt.MAIN),i=await gP();if(!w(r))return;const s=ln(e);if(!w(s))return;if(ve(s),t.x===n.x&&t.y===n.y){const a=ne(s,t),c=hb(r,a);w(a)&&w(c)&&TP(e,s,c,a,t,ze(a)),a!=null&&a.kind||(At(e,`empty: ${t.x}, ${t.y}`),At(e,We),Nt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]),Nt(e,"batch","edit @board codepage",[`pageopen:${s.id}`]),Nt(e,"batch",`board id ${s.id}`,["","copyit",s.id]))}else pP(e,t,n,i);const o=Ke(e);o.scroll=kn(e)}function IP(e,t){const n=oe(Pt.MAIN);if(!w(n))return;const r=ln(t);if(!w(r))return;const i=Mn(e),s=jF(r,i.target);if(w(s))switch(i.path){case"copycoords":du(et,ir(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":kP(t,s,i.path);break;case"char":vP(t,s,i.path);break;case"empty":xn(r,s,n.timestamp);break;case"code":ui(et,t,async()=>{const o=Sr(s),a="object";xe(et,t,`opened [${a}] ${o}`);const c=[r.id,s.id];hh(Ka(n.id,c),s.code??""),Kw(et,t),await e0(800),Zd(et,t,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}async function OP(e,t){const n=ln(t);if(!w(n))return;const r=Mn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":yP(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await _P(t,c,l,r.target);break;case"cut":wP(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await bP(t,c,l,r.target);break;case"paste":EP(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await xP(t,c,l,r.target);break;case"empty":RP(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":AP(t,c,l,r.target);break;case"chars":hP(t,c,l,"char");break;case"colors":fP(t,c,l,"color");break;case"bgs":dP(t,c,l,"bg");break;case"copycoords":du(et,t,[i,s,o,a].join(" "));break;case"pageopen":ui(et,t,async()=>{await e0(800),hx(et,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}async function NP(){return B1("remixconfig")}async function CP(e){return $1("remixconfig",e)}let ns={stat:"",patternsize:2,mirror:1};async function LP(e,t){const n=ln(t);if(!w(n))return;const r=Mn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"remix":{await MP(t,c,l);break}case"remixrun":{const u=cn(ns.stat);w(u)&&zb(n.id,u.id,ns.patternsize,ns.mirror,c,l,"all"),await CP(()=>ns);break}default:console.info("unknown remix",r);break}}async function MP(e,t,n){const r=await NP();ns={...ns,...r};const i=ro(t,n);At(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),At(e,We);function s(c){const{target:l}=Mn(c);return ns[l]}function o(c,l){if(xt(l)||_t(l)){const{target:u}=Mn(c);ns[u]=l}}Nt(e,"remix","source board",[`stat:${i}`,"text"],s,o),Nt(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),Nt(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),At(e,We),Nt(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Ke(e);a.scroll=kn(e)}const UP=16,rs={},tu={},FP=60;let W1=0;const Co={},Lo={};async function G1(e){const t=Ur(),n=oe(Pt.MAIN);if(t.length&&w(n)){const r=await Sd(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;Yw(qt,ir(),i,r)}}async function PP(){const e=Ur(),t=oe(Pt.MAIN);if(e.length&&w(t)){const n=await Sd(e);Vw(qt,ir(),n)}}async function BP(){const e=Ur(),t=oe(Pt.MAIN);return e.length&&w(t)?Sd(e):""}const qt=Ps("vm",["tick","second"],e=>{var n;if(!qt.session(e))return;const t=ir();switch(e.target){case"operator":yF(e.player),xe(qt,e.player,`operator set to ${e.player}`),qt.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=oe(Pt.MAIN);qt.replynext(e,"ackzsswords",{cli:hd(Ji.CLI),loader:hd(Ji.LOADER),runtime:hd(Ji.RUNTIME),flags:[...Xn(yr(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...Rs(r,yt.OBJECT).map(i=>Le(i)),...Xn(ld)],altkinds:[...Rs(r,yt.TERRAIN),...Rs(r,yt.BOARD),...Rs(r,yt.PALETTE),...Rs(r,yt.CHARSET),...Rs(r,yt.LOADER)].map(i=>Le(i)),colors:[...Xn(Jo)],dirs:[...Xn(yh).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Xn(ad)],exprs:["aligned","alligned","contact","blocked","any","count","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&ui(qt,e.player,async()=>{if(ce(e.data)){const[r,i]=e.data,s=await uP(r),o=s.map(a=>a.name);TF(s,i),xe(qt,e.player,`loading ${o.join(", ")}`),fu(qt,e.player)}});break;case"search":SF(e.player)||fu(qt,e.player);break;case"logout":RF(e.player),delete rs[e.player],xe(qt,t,`player ${e.player} logout`),fu(qt,e.player);break;case"login":w1(e.player)?(rs[e.player]=0,xe(qt,ir(),`login from ${e.player}`),qt.replynext(e,"acklogin",!0)):Vd(qt,e.player);break;case"local":w1(e.player)?(rs[e.player]=0,xe(qt,ir(),`login from ${e.player}`)):Vd(qt,e.player);break;case"doot":rs[e.player]=0,tu[e.player]=tu[e.player]??0,tu[e.player]%32===0&&xe(qt,e.player,`$whiteactive $blue${e.player}`),++tu[e.player];break;case"input":{if(e.player.includes("local")&&!y1(e.player)&&ux(qt,e.player),!e.player.includes("local")||y1(e.player)){const r=yr(e.player),[i=Tn.NONE,s=0]=e.data??[Tn.NONE,0];ce(r.inputqueue)||(r.inputqueue=[]),i!==Tn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ce(e.data)){const[r,i]=e.data,s=Ka(r,i);w(Lo[s])||(Lo[s]=Yp(s,o=>{const[a,c]=i,l=Fr(r),u=As(l,a);if(w(u))if(oi(u)===yt.BOARD&&w(c)){const f=Ae(u),d=On(f,c);w(d)&&(d.code=o,Yf(ab(o),d))}else u.code=o,lL(u)})),Co[s]=Co[s]??new Set,Co[s].add(e.player)}break;case"coderelease":if(ce(e.data)){const[r,i]=e.data,[,s]=i,o=Ka(r,i);w(Co[o])&&(Co[o].delete(e.player),Co[o].size===0&&((n=Lo[o])==null||n.call(Lo),Lo[o]=void 0,_t(s)&&CF(s)))}break;case"halt":e.player===t&&Sw(e.data)&&bF(e.data);break;case"tick":MF(wF());break;case"synthsend":if(_t(e.data)){const[r,i]=oP(e.data),s=oe(Pt.MAIN);Io(r,i,void 0,wo(s))}break;case"second":{IF(rs);const r=Object.keys(rs);for(let i=0;i<r.length;++i)++rs[r[i]];for(let i=0;i<r.length;++i){const s=r[i];rs[s]>=UP&&Qd(qt,s)}++W1>=FP&&(W1=0,ui(qt,e.player,async()=>{await G1(!0)}));break}case"copyjsonfile":if(e.player===t){const r=oe(Pt.MAIN);if(w(r)&&ce(e.data)){const[i]=e.data,s=As(r,i);w(s)&&qw(qt,t,s,`${Le(s)}.${Si(s)}.json`)}}break;case"refscroll":{At(e.player,"stat refs"),At(e.player,We),Nt(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Nt(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Nt(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=Ke(e.player);r.scroll=kn(e.player);break}case"fork":e.player===t&&ui(qt,e.player,async()=>{await PP()});break;case"itchiopublish":ui(qt,e.player,async()=>{if(e.player===t){const r=oe(Pt.MAIN);if(w(r)){const i=await BP();Xw(qt,e.player,r.name,i)}}});break;case"flush":e.player===t&&ui(qt,e.player,async()=>{await G1()});break;case"cli":k1(e.player,e.data);break;case"clirepeatlast":UF(e.player);break;case"restart":e.player===t&&(LF(),t0(qt,e.player));break;case"inspect":ui(qt,e.player,async()=>{if(ce(e.data)){const[r,i]=e.data;await SP(e.player,r,i)}});break;case"loader":if(ce(e.data)){const[r,i,s,o]=e.data;switch(i){case"file":F1(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){xe(qt,e.player,`loading ${s}`);const a=JSON.parse(o.json);w(a.data)&&_t(a.exported)&&(Hl(a.data),xe(qt,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){xe(qt,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=oe(Pt.MAIN);w(c)&&w(a.data)&&_t(a.exported)&&(Jf(c,a.data),xe(qt,e.player,`loaded ${a.exported}`))}else Cb(r,i,s,o,e.player);break;default:Cb(r,i,s,o,e.player);break}}break;default:{const{target:r,path:i}=Mn(e.target);switch(It(r)){case"refscroll":switch(i){case"charscroll":{Nt(e.player,"refscroll","char",["char","charedit"]);const s=Ke(e.player);s.scroll=kn(e.player);break}case"colorscroll":{Nt(e.player,"refscroll","color",["color","coloredit"]);const s=Ke(e.player);s.scroll=kn(e.player);break}case"notesscroll":{At(e.player,"duration             cdefgab - notes "),At(e.player,"y - 64th note        x - rest"),At(e.player,"t - 32nd note        "),At(e.player,"s - 16th note.       drums"),At(e.player,"i - eight note.      0 - tick"),At(e.player,"q - quarter note     1 - tweet"),At(e.player,"h - half note        2 - cowbell"),At(e.player,"w - whole note       p - clap"),At(e.player,"                     4 - high snare"),At(e.player,"mods                 5 - high woodblock"),At(e.player,"3 - triplet          6 - low snare"),At(e.player,". - time and a half  7 - low tom"),At(e.player,"# - sharp            8 - low woodblock"),At(e.player,"! - flat             9 - bass drum");const s=Ke(e.player);s.scroll=kn(e.player);break}}break;case"batch":ui(qt,e.player,async()=>{await OP(i,e.player)});break;case"remix":ui(qt,e.player,async()=>{await LP(i,e.player)});break;case"empty":{const s=Mn(i);switch(s.target){case"copycoords":du(qt,ir(),s.path.split(",").join(" "));break}break}case"inspect":IP(i,e.player);break;case"touched":if(ce(e.data)){const[s,o,a]=e.data;x1({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:{const s=Mn(i);if(It(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),x1(e);else{const o=oe(Pt.MAIN);Io(s.target,s.path,void 0,wo(o))}break}}break}}},_F());function $P(){Hw(qt)}const{forward:DP}=yx(e=>{bx(e)&&postMessage(e)});onmessage=function(t){DP(t.data)},setTimeout($P,100)})();

var pD=Object.defineProperty;var mD=(fi,tr,Un)=>tr in fi?pD(fi,tr,{enumerable:!0,configurable:!0,writable:!0,value:Un}):fi[tr]=Un;var xt=(fi,tr,Un)=>mD(fi,typeof tr!="symbol"?tr+"":tr,Un);(function(){"use strict";const fi=new Set,tr={emit(e,t,n,r,i){tr.invoke(JE(e,t,n,r,i))},invoke(e){fi.forEach(t=>t.handle(e))},connect(e){fi.add(e)},disconnect(e){fi.delete(e)}};var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Us(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function gE(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var qd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Un,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(qd);var _E=qd.exports,Jd=Us(_E),Zd={};(function(e){var t=Un&&Un.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,m;d<h;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,b=l.addAdverb,k=b===void 0?!1:b,x=t(t(t([],t([],Array(p),!0).map(function(T){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),k?[n(e.adverbs)]:[],!0);return h&&(x=x.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),x.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return r(e.adjectives).length*f+f*p.length+r(e.nouns).length+p.length+r(e.verbs).length+(h?r(e.adverbs).length+p.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(e.adjectives).length*f+f*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(h?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(Zd);var Qd=Us(Zd);const yE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let bE=e=>crypto.getRandomValues(new Uint8Array(e)),kE=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},t0=(e,t=21)=>kE(e,t,bE),wE=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=yE[n[e]&63];return t};var e0="abcdefghijklmnopqrstuvwxyz",n0="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r0="0123456789",EE="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",xE="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const vE=r0,TE=e0,AE=n0;var SE=vE+TE+AE,hu={lowercase:e0,uppercase:n0,numbers:r0,nolookalikes:EE,nolookalikesSafe:xE,alphanumeric:SE};function ze(){return`sid_${wE(12).replaceAll("-",".")}`}t0(hu.numbers,4),t0(`${hu.numbers}${hu.lowercase}`,16);function wn(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function RE(){return Qd({capitalize:!1,adjectiveCount:1})}function OE(){return Qd({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var NE=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),IE=Object.prototype.hasOwnProperty;function fu(e,t){return IE.call(e,t)}function du(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)fu(e,i)&&r.push(i);return r}function Fn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function pu(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function ss(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function i0(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function mu(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(mu(e[t]))return!0}else if(typeof e=="object"){for(var r=du(e),i=r.length,s=0;s<i;s++)if(mu(e[r[s]]))return!0}}return!1}function s0(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var o0=function(e){NE(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,s0(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=s0(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Be=o0,CE=Fn,Fs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Ga(n,this.path);r&&(r=Fn(r));var i=os(n,{op:"remove",path:this.from}).removed;return os(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Ga(n,this.from);return os(n,{op:"add",path:this.path,value:Fn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Lo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},LE={add:function(e,t,n){return pu(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Fs.move,copy:Fs.copy,test:Fs.test,_get:Fs._get};function Ga(e,t){if(t=="")return e;var n={op:"_get",path:t};return os(e,n),n.value}function os(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ka(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Ga(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Lo(e,t.value),o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Fn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,m=void 0;for(typeof n=="function"?m=n:m=Ka;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=i0(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!pu(h))throw new Be("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);pu(h)&&(h=~~h)}if(u>=f){if(n&&t.op==="add"&&h>l.length)throw new Be("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=LE[t.op].call(t,l,h,e);if(o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Fs[t.op].call(t,l,h,e);if(o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Be("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function gu(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Fn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=os(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function ME(e,t,n){var r=os(e,t);if(r.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ka(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Be("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Fs[e.op]){if(typeof e.path!="string")throw new Be("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Be('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Be("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&mu(e.value))throw new Be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Be("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Be("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=a0([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Be("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function a0(e,t,n){try{if(!Array.isArray(e))throw new Be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)gu(Fn(t),Fn(e),n||!0);else{n=n||Ka;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Be)return i;throw i}}function Lo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Lo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Lo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var UE=Object.freeze({__proto__:null,JsonPatchError:Be,_areEquals:Lo,applyOperation:os,applyPatch:gu,applyReducer:ME,deepClone:CE,getValueByPointer:Ga,validate:a0,validator:Ka});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var _u=new WeakMap,FE=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),BE=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function PE(e){return _u.get(e)}function $E(e,t){return e.observers.get(t)}function DE(e,t){e.observers.delete(t.callback)}function jE(e,t){t.unobserve()}function zE(e,t){var n=[],r,i=PE(e);if(!i)i=new FE(e),_u.set(e,i);else{var s=$E(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Fn(e),t){r.callback=t,r.next=null;var o=function(){yu(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){yu(r),clearTimeout(r.next),DE(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new BE(t,r)),r}function yu(e,t){t===void 0&&(t=!1);var n=_u.get(e.object);bu(n.value,e.object,e.patches,"",t),e.patches.length&&gu(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function bu(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=du(t),o=du(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(fu(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?bu(u,f,n,r+"/"+ss(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+ss(l),value:Fn(u)}),n.push({op:"replace",path:r+"/"+ss(l),value:Fn(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+ss(l),value:Fn(u)}),n.push({op:"remove",path:r+"/"+ss(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!fu(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+ss(l),value:Fn(t[l])})}}}function c0(e,t,n){n===void 0&&(n=!1);var r=[];return bu(e,t,r,"",n),r}var WE=Object.freeze({__proto__:null,compare:c0,generate:yu,observe:zE,unobserve:jE});Object.assign({},UE,WE,{JsonPatchError:o0,deepClone:Fn,escapePathComponent:ss,unescapePathComponent:i0});var GE=typeof Element<"u",KE=typeof Map=="function",HE=typeof Set=="function",YE=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ha(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ha(e[r],t[r]))return!1;return!0}var s;if(KE&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ha(r.value[1],t.get(r.value[0])))return!1;return!0}if(HE&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(YE&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(GE&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ha(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var VE=function(t,n){try{return Ha(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},XE=Us(VE);function y(e){return e!=null}const er=Object.keys;function Sr(e){return Fn(e)}function qE(e){return typeof e=="boolean"}function wt(e){return typeof e=="number"&&isNaN(e)===!1}function pt(e){return typeof e=="string"}function ae(e){return Array.isArray(e)}function ku(e){return e}var Lt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Lt||{}),Ft=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e[e.ISGHOST=4]="ISGHOST",e))(Ft||{}),Bn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Bn||{}),_t=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.FIND=18]="FIND",e[e.FLEE=19]="FLEE",e[e.TO=20]="TO",e[e.MID=21]="MID",e[e.OVER=22]="OVER",e[e.UNDER=23]="UNDER",e))(_t||{}),Rt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.ZSSEDIT=14]="ZSSEDIT",e[e.CHAREDIT=15]="CHAREDIT",e[e.COLOREDIT=16]="COLOREDIT",e))(Rt||{});function Nt(e){return(e==null?void 0:e.toLowerCase().trim())??""}function JE(e,t,n,r,i){return{session:e,player:t,id:ze(),sender:n,target:r,data:i}}function Pn(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Bs(e,t=[],n=ku,r=""){const i=ze(),s=Nt(e),o=t.map(Nt);let a=r;const c={id(){return i},name(){return e},session(l){return y(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,f){tr.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Pn(l.target),d=Nt(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&y(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return tr.connect(c),c}function ZE(e){return typeof e=="object"&&pt(e.session)&&pt(e.player)&&pt(e.id)&&pt(e.sender)&&pt(e.target)}function de(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function QE(e,t,...n){return e.emit(t,"info",n),!0}function ve(e,t,...n){return e.emit(t,"log",n),!0}function l0(e,t,n){e.emit(t,"toast",n)}function tx(e,t,n){e.emit(t,"bridge:streamstart",n)}function ex(e,t){e.emit(t,"bridge:streamstop",void 0)}function nx(e,t,n){e.emit(t,"bridge:chatstart",n)}function rx(e,t){e.emit(t,"bridge:chatstop")}function ix(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function sx(e,t){e.emit(t,"bridge:talkstart",t)}function ox(e,t){e.emit(t,"bridge:talkstop",t)}function ax(e,t){e.emit(t,"bridge:mediastart",t)}function cx(e,t){e.emit(t,"bridge:mediastop",t)}function lx(e,t,n){e.emit(t,"bridge:start",n)}function ux(e,t,n){e.emit(t,"bridge:tab",n)}function hx(e,t,n){e.emit(t,"gadgetclient:paint",n)}function fx(e,t,n){e.emit(t,"gadgetclient:patch",n)}function dx(e,t){e.emit(t,"gadgetserver:clearscroll")}function px(e,t){e.emit(t,"gadgetserver:clearplayer")}function mx(e){e.emit("","ready")}function u0(e,t){e.emit(t,"register:loginfail")}function wu(e,t){e.emit(t,"register:loginready",!0)}function gx(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function _x(e,t,n){e.emit(t,"register:forkmem",[n])}function yx(e,t,n,r){e.emit(t,"register:itchiopublishmem",[n,r])}function Eu(e,t,n){e.emit(t,"register:copy",n)}function bx(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function h0(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function kx(e,t){e.emit(t,"register:dev",void 0)}function wx(e,t){e.emit(t,"register:share",void 0)}function Ex(e,t){e.emit(t,"register:nuke",void 0)}function xx(e,t){e.emit(t,"register:enterar",void 0)}function vx(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function Tx(e,t,n,r){e.emit(t,"synth:play",[n,r])}function Ax(e,t,n,r,i){e.emit(t,"synth:bgplay",[n,r,i])}function Sx(e,t,n){e.emit(t,"synth:focus",n)}function Rx(e,t,n){e.emit(t,"synth:bpm",n)}function Ox(e,t,n){e.emit(t,"synth:playvolume",n)}function Nx(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function Ix(e,t,n){e.emit(t,"synth:ttsvolume",n)}function xu(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function f0(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function d0(e,t,n,r){e.emit(t,"register:config",[n,r])}function Cx(e,t){e.emit(t,"register:configshow")}function Lx(e,t){e.emit(t,"register:inspector")}function p0(e,t,n,r,i,s){e.emit(t,"register:editor:open",[n,r,i,s])}function Mx(e,t,n,r){e.emit(t,"vm:zztsearch",[n,r])}function Ux(e,t){e.emit(t,"vm:zztrandom")}function Fx(e,t){e.emit(t,"vm:local")}function vu(e,t){e.emit(t,"vm:logout")}function m0(e,t,n,r,i){e.emit(t,"vm:touched",[n,r,i])}function Ya(e,t){const[n,r]=t;return`${e}:${[n,r].filter(y).join(":")}`}function Bx(e,t,n){e.emit(t,"vm:cli",n)}function Px(e,t){e.emit(t,"vm:restart")}function g0(e,t){e.emit(t,"vm:flush")}function $x(e,t){e.emit(t,"vm:fork")}function Dx(e,t){e.emit(t,"vm:itchiopublish")}function jx(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function zx(e,t){return{filename:e,json:t}}function Wx(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Tu(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=jx(i,s);break;case"json":o=zx(i,s);break;case"binary":o=Wx(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function Gx(e){const t=new Set;function n(s){ZE(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),tr.invoke(s))}const r=Bs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){tr.disconnect(r)}return{forward:n,disconnect:i}}function Kx(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=Pn(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const Au=66.666,Va=Math.round(1e3/Au),_0=3;function Su(e){return new Promise(t=>setTimeout(t,e))}const Ru=Bs("clock");let Ou=0,Xa=0,Nu=0,y0=performance.now();function b0(){const e=performance.now(),t=e-y0;Nu+=t,Nu>=Au&&(Nu%=Au,Ru.emit("","tick",Xa),Ru.emit("","tock",Xa),++Ou,++Xa,Ou>=Va&&(Ou%=Va,Ru.emit("","second",Xa))),y0=e,setTimeout(b0,2)}b0();function Hx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var k0={exports:{}},We=k0.exports={},Gr,Kr;function Iu(){throw new Error("setTimeout has not been defined")}function Cu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Gr=setTimeout:Gr=Iu}catch{Gr=Iu}try{typeof clearTimeout=="function"?Kr=clearTimeout:Kr=Cu}catch{Kr=Cu}})();function w0(e){if(Gr===setTimeout)return setTimeout(e,0);if((Gr===Iu||!Gr)&&setTimeout)return Gr=setTimeout,setTimeout(e,0);try{return Gr(e,0)}catch{try{return Gr.call(null,e,0)}catch{return Gr.call(this,e,0)}}}function Yx(e){if(Kr===clearTimeout)return clearTimeout(e);if((Kr===Cu||!Kr)&&clearTimeout)return Kr=clearTimeout,clearTimeout(e);try{return Kr(e)}catch{try{return Kr.call(null,e)}catch{return Kr.call(this,e)}}}var di=[],Ps=!1,as,qa=-1;function Vx(){!Ps||!as||(Ps=!1,as.length?di=as.concat(di):qa=-1,di.length&&E0())}function E0(){if(!Ps){var e=w0(Vx);Ps=!0;for(var t=di.length;t;){for(as=di,di=[];++qa<t;)as&&as[qa].run();qa=-1,t=di.length}as=null,Ps=!1,Yx(e)}}We.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];di.push(new x0(e,t)),di.length===1&&!Ps&&w0(E0)};function x0(e,t){this.fun=e,this.array=t}x0.prototype.run=function(){this.fun.apply(null,this.array)},We.title="browser",We.browser=!0,We.env={},We.argv=[],We.version="",We.versions={};function pi(){}We.on=pi,We.addListener=pi,We.once=pi,We.off=pi,We.removeListener=pi,We.removeAllListeners=pi,We.emit=pi,We.prependListener=pi,We.prependOnceListener=pi,We.listeners=function(e){return[]},We.binding=function(e){throw new Error("process.binding is not supported")},We.cwd=function(){return"/"},We.chdir=function(e){throw new Error("process.chdir is not supported")},We.umask=function(){return 0};var Xx=k0.exports;const Rr=Hx(Xx);var Xt={},Lu=Symbol.for("react.transitional.element"),qx=Symbol.for("react.portal"),Jx=Symbol.for("react.fragment"),Zx=Symbol.for("react.strict_mode"),Qx=Symbol.for("react.profiler"),tv=Symbol.for("react.consumer"),ev=Symbol.for("react.context"),nv=Symbol.for("react.forward_ref"),rv=Symbol.for("react.suspense"),iv=Symbol.for("react.memo"),v0=Symbol.for("react.lazy"),T0=Symbol.iterator;function sv(e){return e===null||typeof e!="object"?null:(e=T0&&e[T0]||e["@@iterator"],typeof e=="function"?e:null)}var A0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S0=Object.assign,R0={};function $s(e,t,n){this.props=e,this.context=t,this.refs=R0,this.updater=n||A0}$s.prototype.isReactComponent={},$s.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},$s.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function O0(){}O0.prototype=$s.prototype;function Mu(e,t,n){this.props=e,this.context=t,this.refs=R0,this.updater=n||A0}var Uu=Mu.prototype=new O0;Uu.constructor=Mu,S0(Uu,$s.prototype),Uu.isPureReactComponent=!0;var N0=Array.isArray,Te={H:null,A:null,T:null,S:null,V:null},I0=Object.prototype.hasOwnProperty;function Fu(e,t,n,r,i,s){return n=s.ref,{$$typeof:Lu,type:e,key:t,ref:n!==void 0?n:null,props:s}}function ov(e,t){return Fu(e.type,t,void 0,void 0,void 0,e.props)}function Bu(e){return typeof e=="object"&&e!==null&&e.$$typeof===Lu}function av(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var C0=/\/+/g;function Pu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?av(""+e.key):t.toString(36)}function L0(){}function cv(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(L0,L0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function Ds(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Lu:case qx:o=!0;break;case v0:return o=e._init,Ds(o(e._payload),t,n,r,i)}}if(o)return i=i(e),o=r===""?"."+Pu(e,0):r,N0(i)?(n="",o!=null&&(n=o.replace(C0,"$&/")+"/"),Ds(i,t,n,"",function(l){return l})):i!=null&&(Bu(i)&&(i=ov(i,n+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(C0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=r===""?".":r+":";if(N0(e))for(var c=0;c<e.length;c++)r=e[c],s=a+Pu(r,c),o+=Ds(r,t,n,s,i);else if(c=sv(e),typeof c=="function")for(e=c.call(e),c=0;!(r=e.next()).done;)r=r.value,s=a+Pu(r,c++),o+=Ds(r,t,n,s,i);else if(s==="object"){if(typeof e.then=="function")return Ds(cv(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function Ja(e,t,n){if(e==null)return e;var r=[],i=0;return Ds(e,r,"","",function(s){return t.call(n,s,i++)}),r}function lv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var M0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Rr=="object"&&typeof Rr.emit=="function"){Rr.emit("uncaughtException",e);return}console.error(e)};function uv(){}Xt.Children={map:Ja,forEach:function(e,t,n){Ja(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ja(e,function(){t++}),t},toArray:function(e){return Ja(e,function(t){return t})||[]},only:function(e){if(!Bu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Xt.Component=$s,Xt.Fragment=Jx,Xt.Profiler=Qx,Xt.PureComponent=Mu,Xt.StrictMode=Zx,Xt.Suspense=rv,Xt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Te,Xt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return Te.H.useMemoCache(e)}},Xt.cache=function(e){return function(){return e.apply(null,arguments)}},Xt.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=S0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!I0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(r[o]=t[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return Fu(e.type,i,void 0,void 0,s,r)},Xt.createContext=function(e){return e={$$typeof:ev,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:tv,_context:e},e},Xt.createElement=function(e,t,n){var r,i={},s=null;if(t!=null)for(r in t.key!==void 0&&(s=""+t.key),t)I0.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return Fu(e,s,void 0,void 0,null,i)},Xt.createRef=function(){return{current:null}},Xt.forwardRef=function(e){return{$$typeof:nv,render:e}},Xt.isValidElement=Bu,Xt.lazy=function(e){return{$$typeof:v0,_payload:{_status:-1,_result:e},_init:lv}},Xt.memo=function(e,t){return{$$typeof:iv,type:e,compare:t===void 0?null:t}},Xt.startTransition=function(e){var t=Te.T,n={};Te.T=n;try{var r=e(),i=Te.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(uv,M0)}catch(s){M0(s)}finally{Te.T=t}},Xt.unstable_useCacheRefresh=function(){return Te.H.useCacheRefresh()},Xt.use=function(e){return Te.H.use(e)},Xt.useActionState=function(e,t,n){return Te.H.useActionState(e,t,n)},Xt.useCallback=function(e,t){return Te.H.useCallback(e,t)},Xt.useContext=function(e){return Te.H.useContext(e)},Xt.useDebugValue=function(){},Xt.useDeferredValue=function(e,t){return Te.H.useDeferredValue(e,t)},Xt.useEffect=function(e,t,n){var r=Te.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Xt.useId=function(){return Te.H.useId()},Xt.useImperativeHandle=function(e,t,n){return Te.H.useImperativeHandle(e,t,n)},Xt.useInsertionEffect=function(e,t){return Te.H.useInsertionEffect(e,t)},Xt.useLayoutEffect=function(e,t){return Te.H.useLayoutEffect(e,t)},Xt.useMemo=function(e,t){return Te.H.useMemo(e,t)},Xt.useOptimistic=function(e,t){return Te.H.useOptimistic(e,t)},Xt.useReducer=function(e,t,n){return Te.H.useReducer(e,t,n)},Xt.useRef=function(e){return Te.H.useRef(e)},Xt.useState=function(e){return Te.H.useState(e)},Xt.useSyncExternalStore=function(e,t,n){return Te.H.useSyncExternalStore(e,t,n)},Xt.useTransition=function(){return Te.H.useTransition()},Xt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const U0="0123456789abcdef",F0=[],Za=[];for(let e=0;e<256;e++)F0[e]=U0[e>>4&15]+U0[e&15],e<16&&(e<10?Za[48+e]=e:Za[87+e]=e);const B0=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=F0[e[r++]];return n},Qa=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=Za[e.charCodeAt(s++)]<<4|Za[e.charCodeAt(s++)];return r};for(var P0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hv=typeof Uint8Array>"u"?[]:new Uint8Array(256),tc=0;tc<P0.length;tc++)hv[P0.charCodeAt(tc)]=tc;new TextDecoder,new TextEncoder;const $0=typeof window<"u"?window:self,D0=$0.crypto||$0.msCrypto||{};D0.subtle||D0.webkitSubtle;const js=globalThis||void 0||self,Or=()=>new Map,$u=e=>{const t=Or();return e.forEach((n,r)=>{t.set(r,n)}),t},Mi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},fv=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},dv=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},zs=()=>new Set,Du=e=>e[e.length-1],pv=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},cs=Array.from,mv=Array.isArray;class gv{constructor(){this._observers=Or()}on(t,n){return Mi(this._observers,t,zs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return cs((this._observers.get(t)||Or()).values()).forEach(r=>r(...n))}destroy(){this._observers=Or()}}const Ui=Math.floor,ec=Math.abs,j0=(e,t)=>e<t?e:t,ls=(e,t)=>e>t?e:t,z0=e=>e!==0?e<0:1/e<0,W0=1,G0=2,ju=4,zu=8,Mo=32,mi=64,nr=128,nc=31,Wu=63,us=127,_v=2147483647,K0=Number.MAX_SAFE_INTEGER,yv=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ui(e)===e),bv=e=>e.toLowerCase(),kv=/^\s*/g,wv=e=>e.replace(kv,""),Ev=/([A-Z])/g,H0=(e,t)=>wv(e.replace(Ev,n=>`${t}${bv(n)}`)),xv=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Uo=typeof TextEncoder<"u"?new TextEncoder:null,vv=Uo?e=>Uo.encode(e):xv;let Fo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Fo&&Fo.decode(new Uint8Array).length===1&&(Fo=null);class Bo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const rc=()=>new Bo,Tv=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Hr=e=>{const t=new Uint8Array(Tv(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},Av=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(ls(n,t)*2),e.cpos=0)},an=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Gu=an,oe=(e,t)=>{for(;t>us;)an(e,nr|us&t),t=Ui(t/128);an(e,us&t)},Ku=(e,t)=>{const n=z0(t);for(n&&(t=-t),an(e,(t>Wu?nr:0)|(n?mi:0)|Wu&t),t=Ui(t/64);t>0;)an(e,(t>us?nr:0)|us&t),t=Ui(t/128)},Hu=new Uint8Array(3e4),Sv=Hu.length/3,Rv=(e,t)=>{if(t.length<Sv){const n=Uo.encodeInto(t,Hu).written||0;oe(e,n);for(let r=0;r<n;r++)an(e,Hu[r])}else rr(e,vv(t))},Ov=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;oe(e,r);for(let i=0;i<r;i++)an(e,n.codePointAt(i))},Ws=Uo&&Uo.encodeInto?Rv:Ov,ic=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=j0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ls(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},rr=(e,t)=>{oe(e,t.byteLength),ic(e,t)},Yu=(e,t)=>{Av(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Nv=(e,t)=>Yu(e,4).setFloat32(0,t,!1),Iv=(e,t)=>Yu(e,8).setFloat64(0,t,!1),Cv=(e,t)=>Yu(e,8).setBigInt64(0,t,!1),Y0=new DataView(new ArrayBuffer(4)),Lv=e=>(Y0.setFloat32(0,e),Y0.getFloat32(0)===e),Po=(e,t)=>{switch(typeof t){case"string":an(e,119),Ws(e,t);break;case"number":yv(t)&&ec(t)<=_v?(an(e,125),Ku(e,t)):Lv(t)?(an(e,124),Nv(e,t)):(an(e,123),Iv(e,t));break;case"bigint":an(e,122),Cv(e,t);break;case"object":if(t===null)an(e,126);else if(mv(t)){an(e,117),oe(e,t.length);for(let n=0;n<t.length;n++)Po(e,t[n])}else if(t instanceof Uint8Array)an(e,116),rr(e,t);else{an(e,118);const n=Object.keys(t);oe(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ws(e,i),Po(e,t[i])}}break;case"boolean":an(e,t?120:121);break;default:an(e,127)}};class V0 extends Bo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&oe(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const X0=e=>{e.count>0&&(Ku(e.encoder,e.count===1?e.s:-e.s),e.count>1&&oe(e.encoder,e.count-2))};class sc{constructor(){this.encoder=new Bo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(X0(this),this.count=1,this.s=t)}toUint8Array(){return X0(this),Hr(this.encoder)}}const q0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Ku(e.encoder,t),e.count>1&&oe(e.encoder,e.count-2)}};class Vu{constructor(){this.encoder=new Bo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(q0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return q0(this),Hr(this.encoder)}}class Mv{constructor(){this.sarr=[],this.s="",this.lensE=new sc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Bo;return this.sarr.push(this.s),this.s="",Ws(t,this.sarr.join("")),ic(t,this.lensE.toUint8Array()),Hr(t)}}const Fi=e=>new Error(e),Yr=()=>{throw Fi("Method unimplemented")},Vr=()=>{throw Fi("Unexpected case")},J0=Fi("Unexpected end of array"),Z0=Fi("Integer out of Range");class oc{constructor(t){this.arr=t,this.pos=0}}const Gs=e=>new oc(e),Uv=e=>e.pos!==e.arr.length,Fv=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},ir=e=>Fv(e,qt(e)),Ks=e=>e.arr[e.pos++],qt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&us)*n,n*=128,i<nr)return t;if(t>K0)throw Z0}throw J0},Xu=e=>{let t=e.arr[e.pos++],n=t&Wu,r=64;const i=(t&mi)>0?-1:1;if(!(t&nr))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&us)*r,r*=128,t<nr)return i*n;if(n>K0)throw Z0}throw J0},Hs=Fo?e=>Fo.decode(ir(e)):e=>{let t=qt(e);if(t===0)return"";{let n=String.fromCodePoint(Ks(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ks(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},qu=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Bv=[e=>{},e=>null,Xu,e=>qu(e,4).getFloat32(0,!1),e=>qu(e,8).getFloat64(0,!1),e=>qu(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Hs,e=>{const t=qt(e),n={};for(let r=0;r<t;r++){const i=Hs(e);n[i]=$o(e)}return n},e=>{const t=qt(e),n=[];for(let r=0;r<t;r++)n.push($o(e));return n},ir],$o=e=>Bv[127-Ks(e)](e);class Q0 extends oc{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Uv(this)?this.count=qt(this)+1:this.count=-1),this.count--,this.s}}class ac extends oc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Xu(this);const t=z0(this.s);this.count=1,t&&(this.s=-this.s,this.count=qt(this)+2)}return this.count--,this.s}}class Ju extends oc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Xu(this),n=t&1;this.diff=Ui(t/2),this.count=1,n&&(this.count=qt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Pv{constructor(t){this.decoder=new ac(t),this.str=Hs(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const $v=crypto.getRandomValues.bind(crypto),tp=()=>$v(new Uint32Array(1))[0],Dv="10000000-1000-4000-8000"+-1e11,jv=()=>Dv.replace(/[018]/g,e=>(e^tp()&15>>e/4).toString(16)),ep=e=>new Promise(e);Promise.all.bind(Promise);var np={},cc={};cc.byteLength=Gv,cc.toByteArray=Hv,cc.fromByteArray=Xv;for(var Xr=[],fr=[],zv=typeof Uint8Array<"u"?Uint8Array:Array,Zu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ys=0,Wv=Zu.length;Ys<Wv;++Ys)Xr[Ys]=Zu[Ys],fr[Zu.charCodeAt(Ys)]=Ys;fr[45]=62,fr[95]=63;function rp(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Gv(e){var t=rp(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Kv(e,t,n){return(t+n)*3/4-n}function Hv(e){var t,n=rp(e),r=n[0],i=n[1],s=new zv(Kv(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=fr[e.charCodeAt(c)]<<18|fr[e.charCodeAt(c+1)]<<12|fr[e.charCodeAt(c+2)]<<6|fr[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=fr[e.charCodeAt(c)]<<2|fr[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=fr[e.charCodeAt(c)]<<10|fr[e.charCodeAt(c+1)]<<4|fr[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Yv(e){return Xr[e>>18&63]+Xr[e>>12&63]+Xr[e>>6&63]+Xr[e&63]}function Vv(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Yv(r));return i.join("")}function Xv(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Vv(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Xr[t>>2]+Xr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Xr[t>>10]+Xr[t>>4&63]+Xr[t<<2&63]+"=")),i.join("")}var Qu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Qu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+e[t+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Qu.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,m=r?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=d/c:t+=d*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(t*c-1)*Math.pow(2,i),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+h]=o&255,h+=m,o/=256,l-=8);e[n+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=cc,n=Qu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=M,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const R=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(R,g),R.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(R){if(R>i)throw new RangeError('The value "'+R+'" is invalid for option "size"');const g=new s(R);return Object.setPrototypeOf(g,u.prototype),g}function u(R,g,_){if(typeof R=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(R)}return f(R,g,_)}u.poolSize=8192;function f(R,g,_){if(typeof R=="string")return p(R,g);if(o.isView(R))return k(R);if(R==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R);if(mt(R,o)||R&&mt(R.buffer,o)||typeof a<"u"&&(mt(R,a)||R&&mt(R.buffer,a)))return x(R,g,_);if(typeof R=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const U=R.valueOf&&R.valueOf();if(U!=null&&U!==R)return u.from(U,g,_);const G=T(R);if(G)return G;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof R[Symbol.toPrimitive]=="function")return u.from(R[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R)}u.from=function(R,g,_){return f(R,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(R){if(typeof R!="number")throw new TypeError('"size" argument must be of type number');if(R<0)throw new RangeError('The value "'+R+'" is invalid for option "size"')}function h(R,g,_){return d(R),R<=0?l(R):g!==void 0?typeof _=="string"?l(R).fill(g,_):l(R).fill(g):l(R)}u.alloc=function(R,g,_){return h(R,g,_)};function m(R){return d(R),l(R<0?0:A(R)|0)}u.allocUnsafe=function(R){return m(R)},u.allocUnsafeSlow=function(R){return m(R)};function p(R,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=S(R,g)|0;let U=l(_);const G=U.write(R,g);return G!==_&&(U=U.slice(0,G)),U}function b(R){const g=R.length<0?0:A(R.length)|0,_=l(g);for(let U=0;U<g;U+=1)_[U]=R[U]&255;return _}function k(R){if(mt(R,s)){const g=new s(R);return x(g.buffer,g.byteOffset,g.byteLength)}return b(R)}function x(R,g,_){if(g<0||R.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(R.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let U;return g===void 0&&_===void 0?U=new s(R):_===void 0?U=new s(R,g):U=new s(R,g,_),Object.setPrototypeOf(U,u.prototype),U}function T(R){if(u.isBuffer(R)){const g=A(R.length)|0,_=l(g);return _.length===0||R.copy(_,0,0,g),_}if(R.length!==void 0)return typeof R.length!="number"||It(R.length)?l(0):b(R);if(R.type==="Buffer"&&Array.isArray(R.data))return b(R.data)}function A(R){if(R>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return R|0}function M(R){return+R!=R&&(R=0),u.alloc(+R)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),mt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let U=g.length,G=_.length;for(let nt=0,ct=Math.min(U,G);nt<ct;++nt)if(g[nt]!==_[nt]){U=g[nt],G=_[nt];break}return U<G?-1:G<U?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let U;if(_===void 0)for(_=0,U=0;U<g.length;++U)_+=g[U].length;const G=u.allocUnsafe(_);let nt=0;for(U=0;U<g.length;++U){let ct=g[U];if(mt(ct,s))nt+ct.length>G.length?(u.isBuffer(ct)||(ct=u.from(ct)),ct.copy(G,nt)):s.prototype.set.call(G,ct,nt);else if(u.isBuffer(ct))ct.copy(G,nt);else throw new TypeError('"list" argument must be an Array of Buffers');nt+=ct.length}return G};function S(R,g){if(u.isBuffer(R))return R.length;if(o.isView(R)||mt(R,o))return R.byteLength;if(typeof R!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof R);const _=R.length,U=arguments.length>2&&arguments[2]===!0;if(!U&&_===0)return 0;let G=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ht(R).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return gt(R).length;default:if(G)return U?-1:ht(R).length;g=(""+g).toLowerCase(),G=!0}}u.byteLength=S;function I(R,g,_){let U=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(R||(R="utf8");;)switch(R){case"hex":return D(this,g,_);case"utf8":case"utf-8":return F(this,g,_);case"ascii":return ot(this,g,_);case"latin1":case"binary":return W(this,g,_);case"base64":return P(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yt(this,g,_);default:if(U)throw new TypeError("Unknown encoding: "+R);R=(R+"").toLowerCase(),U=!0}}u.prototype._isBuffer=!0;function $(R,g,_){const U=R[g];R[g]=R[_],R[_]=U}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)$(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)$(this,_,_+3),$(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)$(this,_,_+7),$(this,_+1,_+6),$(this,_+2,_+5),$(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?F(this,0,g):I.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,U,G,nt){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),U===void 0&&(U=g?g.length:0),G===void 0&&(G=0),nt===void 0&&(nt=this.length),_<0||U>g.length||G<0||nt>this.length)throw new RangeError("out of range index");if(G>=nt&&_>=U)return 0;if(G>=nt)return-1;if(_>=U)return 1;if(_>>>=0,U>>>=0,G>>>=0,nt>>>=0,this===g)return 0;let ct=nt-G,Vt=U-_;const Ce=Math.min(ct,Vt),Ee=this.slice(G,nt),Le=g.slice(_,U);for(let he=0;he<Ce;++he)if(Ee[he]!==Le[he]){ct=Ee[he],Vt=Le[he];break}return ct<Vt?-1:Vt<ct?1:0};function N(R,g,_,U,G){if(R.length===0)return-1;if(typeof _=="string"?(U=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,It(_)&&(_=G?0:R.length-1),_<0&&(_=R.length+_),_>=R.length){if(G)return-1;_=R.length-1}else if(_<0)if(G)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,U)),u.isBuffer(g))return g.length===0?-1:z(R,g,_,U,G);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?G?s.prototype.indexOf.call(R,g,_):s.prototype.lastIndexOf.call(R,g,_):z(R,[g],_,U,G);throw new TypeError("val must be string, number or Buffer")}function z(R,g,_,U,G){let nt=1,ct=R.length,Vt=g.length;if(U!==void 0&&(U=String(U).toLowerCase(),U==="ucs2"||U==="ucs-2"||U==="utf16le"||U==="utf-16le")){if(R.length<2||g.length<2)return-1;nt=2,ct/=2,Vt/=2,_/=2}function Ce(Le,he){return nt===1?Le[he]:Le.readUInt16BE(he*nt)}let Ee;if(G){let Le=-1;for(Ee=_;Ee<ct;Ee++)if(Ce(R,Ee)===Ce(g,Le===-1?0:Ee-Le)){if(Le===-1&&(Le=Ee),Ee-Le+1===Vt)return Le*nt}else Le!==-1&&(Ee-=Ee-Le),Le=-1}else for(_+Vt>ct&&(_=ct-Vt),Ee=_;Ee>=0;Ee--){let Le=!0;for(let he=0;he<Vt;he++)if(Ce(R,Ee+he)!==Ce(g,he)){Le=!1;break}if(Le)return Ee}return-1}u.prototype.includes=function(g,_,U){return this.indexOf(g,_,U)!==-1},u.prototype.indexOf=function(g,_,U){return N(this,g,_,U,!0)},u.prototype.lastIndexOf=function(g,_,U){return N(this,g,_,U,!1)};function J(R,g,_,U){_=Number(_)||0;const G=R.length-_;U?(U=Number(U),U>G&&(U=G)):U=G;const nt=g.length;U>nt/2&&(U=nt/2);let ct;for(ct=0;ct<U;++ct){const Vt=parseInt(g.substr(ct*2,2),16);if(It(Vt))return ct;R[_+ct]=Vt}return ct}function L(R,g,_,U){return vt(ht(g,R.length-_),R,_,U)}function O(R,g,_,U){return vt(dt(g),R,_,U)}function E(R,g,_,U){return vt(gt(g),R,_,U)}function C(R,g,_,U){return vt(Q(g,R.length-_),R,_,U)}u.prototype.write=function(g,_,U,G){if(_===void 0)G="utf8",U=this.length,_=0;else if(U===void 0&&typeof _=="string")G=_,U=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(U)?(U=U>>>0,G===void 0&&(G="utf8")):(G=U,U=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const nt=this.length-_;if((U===void 0||U>nt)&&(U=nt),g.length>0&&(U<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");G||(G="utf8");let ct=!1;for(;;)switch(G){case"hex":return J(this,g,_,U);case"utf8":case"utf-8":return L(this,g,_,U);case"ascii":case"latin1":case"binary":return O(this,g,_,U);case"base64":return E(this,g,_,U);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,g,_,U);default:if(ct)throw new TypeError("Unknown encoding: "+G);G=(""+G).toLowerCase(),ct=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(R,g,_){return g===0&&_===R.length?t.fromByteArray(R):t.fromByteArray(R.slice(g,_))}function F(R,g,_){_=Math.min(R.length,_);const U=[];let G=g;for(;G<_;){const nt=R[G];let ct=null,Vt=nt>239?4:nt>223?3:nt>191?2:1;if(G+Vt<=_){let Ce,Ee,Le,he;switch(Vt){case 1:nt<128&&(ct=nt);break;case 2:Ce=R[G+1],(Ce&192)===128&&(he=(nt&31)<<6|Ce&63,he>127&&(ct=he));break;case 3:Ce=R[G+1],Ee=R[G+2],(Ce&192)===128&&(Ee&192)===128&&(he=(nt&15)<<12|(Ce&63)<<6|Ee&63,he>2047&&(he<55296||he>57343)&&(ct=he));break;case 4:Ce=R[G+1],Ee=R[G+2],Le=R[G+3],(Ce&192)===128&&(Ee&192)===128&&(Le&192)===128&&(he=(nt&15)<<18|(Ce&63)<<12|(Ee&63)<<6|Le&63,he>65535&&he<1114112&&(ct=he))}}ct===null?(ct=65533,Vt=1):ct>65535&&(ct-=65536,U.push(ct>>>10&1023|55296),ct=56320|ct&1023),U.push(ct),G+=Vt}return et(U)}const st=4096;function et(R){const g=R.length;if(g<=st)return String.fromCharCode.apply(String,R);let _="",U=0;for(;U<g;)_+=String.fromCharCode.apply(String,R.slice(U,U+=st));return _}function ot(R,g,_){let U="";_=Math.min(R.length,_);for(let G=g;G<_;++G)U+=String.fromCharCode(R[G]&127);return U}function W(R,g,_){let U="";_=Math.min(R.length,_);for(let G=g;G<_;++G)U+=String.fromCharCode(R[G]);return U}function D(R,g,_){const U=R.length;(!g||g<0)&&(g=0),(!_||_<0||_>U)&&(_=U);let G="";for(let nt=g;nt<_;++nt)G+=fe[R[nt]];return G}function yt(R,g,_){const U=R.slice(g,_);let G="";for(let nt=0;nt<U.length-1;nt+=2)G+=String.fromCharCode(U[nt]+U[nt+1]*256);return G}u.prototype.slice=function(g,_){const U=this.length;g=~~g,_=_===void 0?U:~~_,g<0?(g+=U,g<0&&(g=0)):g>U&&(g=U),_<0?(_+=U,_<0&&(_=0)):_>U&&(_=U),_<g&&(_=g);const G=this.subarray(g,_);return Object.setPrototypeOf(G,u.prototype),G};function X(R,g,_){if(R%1!==0||R<0)throw new RangeError("offset is not uint");if(R+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g],nt=1,ct=0;for(;++ct<_&&(nt*=256);)G+=this[g+ct]*nt;return G},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g+--_],nt=1;for(;_>0&&(nt*=256);)G+=this[g+--_]*nt;return G},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||X(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||X(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||X(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||X(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=zt(function(g){g=g>>>0,it(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,nt=this[++g]+this[++g]*2**8+this[++g]*2**16+U*2**24;return BigInt(G)+(BigInt(nt)<<BigInt(32))}),u.prototype.readBigUInt64BE=zt(function(g){g=g>>>0,it(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],nt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U;return(BigInt(G)<<BigInt(32))+BigInt(nt)}),u.prototype.readIntLE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g],nt=1,ct=0;for(;++ct<_&&(nt*=256);)G+=this[g+ct]*nt;return nt*=128,G>=nt&&(G-=Math.pow(2,8*_)),G},u.prototype.readIntBE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=_,nt=1,ct=this[g+--G];for(;G>0&&(nt*=256);)ct+=this[g+--G]*nt;return nt*=128,ct>=nt&&(ct-=Math.pow(2,8*_)),ct},u.prototype.readInt8=function(g,_){return g=g>>>0,_||X(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||X(g,2,this.length);const U=this[g]|this[g+1]<<8;return U&32768?U|4294901760:U},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||X(g,2,this.length);const U=this[g+1]|this[g]<<8;return U&32768?U|4294901760:U},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=zt(function(g){g=g>>>0,it(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(U<<24);return(BigInt(G)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=zt(function(g){g=g>>>0,it(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(G)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||X(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||X(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||X(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||X(g,8,this.length),n.read(this,g,!1,52,8)};function at(R,g,_,U,G,nt){if(!u.isBuffer(R))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>G||g<nt)throw new RangeError('"value" argument is out of bounds');if(_+U>R.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,U,G){if(g=+g,_=_>>>0,U=U>>>0,!G){const Vt=Math.pow(2,8*U)-1;at(this,g,_,U,Vt,0)}let nt=1,ct=0;for(this[_]=g&255;++ct<U&&(nt*=256);)this[_+ct]=g/nt&255;return _+U},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,U,G){if(g=+g,_=_>>>0,U=U>>>0,!G){const Vt=Math.pow(2,8*U)-1;at(this,g,_,U,Vt,0)}let nt=U-1,ct=1;for(this[_+nt]=g&255;--nt>=0&&(ct*=256);)this[_+nt]=g/ct&255;return _+U},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function Pt(R,g,_,U,G){ut(g,U,G,R,_,7);let nt=Number(g&BigInt(4294967295));R[_++]=nt,nt=nt>>8,R[_++]=nt,nt=nt>>8,R[_++]=nt,nt=nt>>8,R[_++]=nt;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return R[_++]=ct,ct=ct>>8,R[_++]=ct,ct=ct>>8,R[_++]=ct,ct=ct>>8,R[_++]=ct,_}function Gt(R,g,_,U,G){ut(g,U,G,R,_,7);let nt=Number(g&BigInt(4294967295));R[_+7]=nt,nt=nt>>8,R[_+6]=nt,nt=nt>>8,R[_+5]=nt,nt=nt>>8,R[_+4]=nt;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return R[_+3]=ct,ct=ct>>8,R[_+2]=ct,ct=ct>>8,R[_+1]=ct,ct=ct>>8,R[_]=ct,_+8}u.prototype.writeBigUInt64LE=zt(function(g,_=0){return Pt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=zt(function(g,_=0){return Gt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,U,G){if(g=+g,_=_>>>0,!G){const Ce=Math.pow(2,8*U-1);at(this,g,_,U,Ce-1,-Ce)}let nt=0,ct=1,Vt=0;for(this[_]=g&255;++nt<U&&(ct*=256);)g<0&&Vt===0&&this[_+nt-1]!==0&&(Vt=1),this[_+nt]=(g/ct>>0)-Vt&255;return _+U},u.prototype.writeIntBE=function(g,_,U,G){if(g=+g,_=_>>>0,!G){const Ce=Math.pow(2,8*U-1);at(this,g,_,U,Ce-1,-Ce)}let nt=U-1,ct=1,Vt=0;for(this[_+nt]=g&255;--nt>=0&&(ct*=256);)g<0&&Vt===0&&this[_+nt+1]!==0&&(Vt=1),this[_+nt]=(g/ct>>0)-Vt&255;return _+U},u.prototype.writeInt8=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=zt(function(g,_=0){return Pt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=zt(function(g,_=0){return Gt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function jt(R,g,_,U,G,nt){if(_+U>R.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function $t(R,g,_,U,G){return g=+g,_=_>>>0,G||jt(R,g,_,4),n.write(R,g,_,U,23,4),_+4}u.prototype.writeFloatLE=function(g,_,U){return $t(this,g,_,!0,U)},u.prototype.writeFloatBE=function(g,_,U){return $t(this,g,_,!1,U)};function ue(R,g,_,U,G){return g=+g,_=_>>>0,G||jt(R,g,_,8),n.write(R,g,_,U,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,U){return ue(this,g,_,!0,U)},u.prototype.writeDoubleBE=function(g,_,U){return ue(this,g,_,!1,U)},u.prototype.copy=function(g,_,U,G){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(U||(U=0),!G&&G!==0&&(G=this.length),_>=g.length&&(_=g.length),_||(_=0),G>0&&G<U&&(G=U),G===U||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(U<0||U>=this.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("sourceEnd out of bounds");G>this.length&&(G=this.length),g.length-_<G-U&&(G=g.length-_+U);const nt=G-U;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,U,G):s.prototype.set.call(g,this.subarray(U,G),_),nt},u.prototype.fill=function(g,_,U,G){if(typeof g=="string"){if(typeof _=="string"?(G=_,_=0,U=this.length):typeof U=="string"&&(G=U,U=this.length),G!==void 0&&typeof G!="string")throw new TypeError("encoding must be a string");if(typeof G=="string"&&!u.isEncoding(G))throw new TypeError("Unknown encoding: "+G);if(g.length===1){const ct=g.charCodeAt(0);(G==="utf8"&&ct<128||G==="latin1")&&(g=ct)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<U)throw new RangeError("Out of range index");if(U<=_)return this;_=_>>>0,U=U===void 0?this.length:U>>>0,g||(g=0);let nt;if(typeof g=="number")for(nt=_;nt<U;++nt)this[nt]=g;else{const ct=u.isBuffer(g)?g:u.from(g,G),Vt=ct.length;if(Vt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(nt=0;nt<U-_;++nt)this[nt+_]=ct[nt%Vt]}return this};const Jt={};function Ie(R,g,_){Jt[R]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${R}]`,this.stack,delete this.name}get code(){return R}set code(G){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:G,writable:!0})}toString(){return`${this.name} [${R}]: ${this.message}`}}}Ie("ERR_BUFFER_OUT_OF_BOUNDS",function(R){return R?`${R} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ie("ERR_INVALID_ARG_TYPE",function(R,g){return`The "${R}" argument must be of type number. Received type ${typeof g}`},TypeError),Ie("ERR_OUT_OF_RANGE",function(R,g,_){let U=`The value of "${R}" is out of range.`,G=_;return Number.isInteger(_)&&Math.abs(_)>2**32?G=je(String(_)):typeof _=="bigint"&&(G=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(G=je(G)),G+="n"),U+=` It must be ${g}. Received ${G}`,U},RangeError);function je(R){let g="",_=R.length;const U=R[0]==="-"?1:0;for(;_>=U+4;_-=3)g=`_${R.slice(_-3,_)}${g}`;return`${R.slice(0,_)}${g}`}function v(R,g,_){it(g,"offset"),(R[g]===void 0||R[g+_]===void 0)&&j(g,R.length-(_+1))}function ut(R,g,_,U,G,nt){if(R>_||R<g){const ct=typeof g=="bigint"?"n":"";let Vt;throw g===0||g===BigInt(0)?Vt=`>= 0${ct} and < 2${ct} ** ${(nt+1)*8}${ct}`:Vt=`>= -(2${ct} ** ${(nt+1)*8-1}${ct}) and < 2 ** ${(nt+1)*8-1}${ct}`,new Jt.ERR_OUT_OF_RANGE("value",Vt,R)}v(U,G,nt)}function it(R,g){if(typeof R!="number")throw new Jt.ERR_INVALID_ARG_TYPE(g,"number",R)}function j(R,g,_){throw Math.floor(R)!==R?(it(R,_),new Jt.ERR_OUT_OF_RANGE("offset","an integer",R)):g<0?new Jt.ERR_BUFFER_OUT_OF_BOUNDS:new Jt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,R)}const B=/[^+/0-9A-Za-z-_]/g;function V(R){if(R=R.split("=")[0],R=R.trim().replace(B,""),R.length<2)return"";for(;R.length%4!==0;)R=R+"=";return R}function ht(R,g){g=g||1/0;let _;const U=R.length;let G=null;const nt=[];for(let ct=0;ct<U;++ct){if(_=R.charCodeAt(ct),_>55295&&_<57344){if(!G){if(_>56319){(g-=3)>-1&&nt.push(239,191,189);continue}else if(ct+1===U){(g-=3)>-1&&nt.push(239,191,189);continue}G=_;continue}if(_<56320){(g-=3)>-1&&nt.push(239,191,189),G=_;continue}_=(G-55296<<10|_-56320)+65536}else G&&(g-=3)>-1&&nt.push(239,191,189);if(G=null,_<128){if((g-=1)<0)break;nt.push(_)}else if(_<2048){if((g-=2)<0)break;nt.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;nt.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;nt.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return nt}function dt(R){const g=[];for(let _=0;_<R.length;++_)g.push(R.charCodeAt(_)&255);return g}function Q(R,g){let _,U,G;const nt=[];for(let ct=0;ct<R.length&&!((g-=2)<0);++ct)_=R.charCodeAt(ct),U=_>>8,G=_%256,nt.push(G),nt.push(U);return nt}function gt(R){return t.toByteArray(V(R))}function vt(R,g,_,U){let G;for(G=0;G<U&&!(G+_>=g.length||G>=R.length);++G)g[G+_]=R[G];return G}function mt(R,g){return R instanceof g||R!=null&&R.constructor!=null&&R.constructor.name!=null&&R.constructor.name===g.name}function It(R){return R!==R}const fe=function(){const R="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const U=_*16;for(let G=0;G<16;++G)g[U+G]=R[_]+R[G]}return g}();function zt(R){return typeof BigInt>"u"?Qn:R}function Qn(){throw new Error("BigInt not supported")}})(np);const _n=np.Buffer,ip=e=>e===void 0?null:e;class qv{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let sp=new qv,Jv=!0;try{typeof localStorage<"u"&&localStorage&&(sp=localStorage,Jv=!1)}catch{}const Zv=sp,Qv=Object.assign,tT=Object.keys,eT=(e,t)=>{for(const n in e)t(e[n],n)},op=e=>tT(e).length,nT=e=>{for(const t in e)return!1;return!0},rT=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},iT=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),sT=(e,t)=>e===t||op(e)===op(t)&&rT(e,(n,r)=>(n!==void 0||iT(t,r))&&t[r]===n),oT=Object.freeze,ap=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&ap(e[t])}return oT(e)},th=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&th(e,t,n+1)}},aT=e=>e,cT=(e,t)=>t.includes(e);var cp={};const Do=typeof Rr<"u"&&Rr.release&&/node|io\.js/.test(Rr.release.name)&&Object.prototype.toString.call(typeof Rr<"u"?Rr:0)==="[object process]";let qr;const lT=()=>{if(qr===void 0)if(Do){qr=Or();const e=Rr.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&qr.set(t,""),t=r):t!==null&&(qr.set(t,r),t=null)}t!==null&&qr.set(t,"")}else typeof location=="object"?(qr=Or(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");qr.set(`--${H0(t,"-")}`,n),qr.set(`-${H0(t,"-")}`,n)}})):qr=Or();return qr},eh=e=>lT().has(e),lc=e=>ip(Do?cp[e.toUpperCase().replaceAll("-","_")]:Zv.getItem(e)),lp=e=>eh("--"+e)||lc(e)!==null;lp("production");const uT=Do&&cT(cp.FORCE_COLOR,["true","1","2"])||!eh("--no-colors")&&!lp("no-color")&&(!Do||Rr.stdout.isTTY)&&(!Do||eh("--color")||lc("COLORTERM")!==null||(lc("TERM")||"").includes("color")),hT=e=>new Uint8Array(e),fT=e=>{const t=hT(e.byteLength);return t.set(e),t};class dT{constructor(t,n){this.left=t,this.right=n}}const gi=(e,t)=>new dT(e,t);typeof DOMParser<"u"&&new DOMParser;const pT=e=>fv(e,(t,n)=>`${n}:${t};`).join(""),_i=Symbol,up=_i(),hp=_i(),mT=_i(),gT=_i(),_T=_i(),fp=_i(),yT=_i(),nh=_i(),bT=_i(),kT=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},wT={[up]:gi("font-weight","bold"),[hp]:gi("font-weight","normal"),[mT]:gi("color","blue"),[_T]:gi("color","green"),[gT]:gi("color","grey"),[fp]:gi("color","red"),[yT]:gi("color","purple"),[nh]:gi("color","orange"),[bT]:gi("color","black")},dp=uT?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Or();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=wT[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=pT(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:kT,ET=(...e)=>{console.log(...dp(e)),pp.forEach(t=>t.print(e))},xT=(...e)=>{console.warn(...dp(e)),e.unshift(nh),pp.forEach(t=>t.print(e))},pp=zs(),mp=e=>({[Symbol.iterator](){return this},next:e}),vT=(e,t)=>mp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),rh=(e,t)=>mp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class ih{constructor(t,n){this.clock=t,this.len=n}}class jo{constructor(){this.clients=new Map}}const gp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Cp(e,s,a.clock,a.len,n)}}),TT=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ui((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},_p=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&TT(n,t.clock)!==null},sh=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=ls(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},AT=e=>{const t=new jo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)pv(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return sh(t),t},uc=(e,t,n,r)=>{Mi(e.clients,t,()=>[]).push(new ih(n,r))},ST=()=>new jo,RT=e=>{const t=ST();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new ih(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Vs=(e,t)=>{oe(e.restEncoder,t.clients.size),cs(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),oe(e.restEncoder,n);const i=r.length;oe(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},oh=e=>{const t=new jo,n=qt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=qt(e.restDecoder),s=qt(e.restDecoder);if(s>0){const o=Mi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new ih(e.readDsClock(),e.readDsLen()))}}return t},yp=(e,t,n)=>{const r=new jo,i=qt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=qt(e.restDecoder),a=qt(e.restDecoder),c=n.clients.get(o)||[],l=cn(n,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&uc(r,o,l,d-l);let h=Jr(c,f),m=c[h];for(!m.deleted&&m.id.clock<f&&(c.splice(h+1,0,vc(t,m,f-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(h,0,vc(t,m,d-m.id.clock)),m.delete(t))}else uc(r,o,f,d-f)}}if(r.clients.size>0){const s=new hs;return oe(s.restEncoder,0),Vs(s,r),s.toUint8Array()}return null},bp=tp;class Xs extends gv{constructor({guid:t=jv(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=bp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Op,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=ep(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>ep(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&pe(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(cs(this.subdocs).map(t=>t.guid))}transact(t,n=null){return pe(this,t,n)}get(t,n=yn){const r=Mi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==yn&&i!==n)if(i===yn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Qs)}getText(t=""){return this.get(t,yi)}getMap(t=""){return this.get(t,to)}getXmlElement(t=""){return this.get(t,no)}getXmlFragment(t=""){return this.get(t,fs)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,cs(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Xs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,pe(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class kp{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return qt(this.restDecoder)}readDsLen(){return qt(this.restDecoder)}}class wp extends kp{readLeftID(){return Qt(qt(this.restDecoder),qt(this.restDecoder))}readRightID(){return Qt(qt(this.restDecoder),qt(this.restDecoder))}readClient(){return qt(this.restDecoder)}readInfo(){return Ks(this.restDecoder)}readString(){return Hs(this.restDecoder)}readParentInfo(){return qt(this.restDecoder)===1}readTypeRef(){return qt(this.restDecoder)}readLen(){return qt(this.restDecoder)}readAny(){return $o(this.restDecoder)}readBuf(){return fT(ir(this.restDecoder))}readJSON(){return JSON.parse(Hs(this.restDecoder))}readKey(){return Hs(this.restDecoder)}}class OT{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=qt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=qt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class qs extends OT{constructor(t){super(t),this.keys=[],qt(t),this.keyClockDecoder=new Ju(ir(t)),this.clientDecoder=new ac(ir(t)),this.leftClockDecoder=new Ju(ir(t)),this.rightClockDecoder=new Ju(ir(t)),this.infoDecoder=new Q0(ir(t),Ks),this.stringDecoder=new Pv(ir(t)),this.parentInfoDecoder=new Q0(ir(t),Ks),this.typeRefDecoder=new ac(ir(t)),this.lenDecoder=new ac(ir(t))}readLeftID(){return new Js(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Js(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return $o(this.restDecoder)}readBuf(){return ir(this.restDecoder)}readJSON(){return $o(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class NT{constructor(){this.restEncoder=rc()}toUint8Array(){return Hr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){oe(this.restEncoder,t)}writeDsLen(t){oe(this.restEncoder,t)}}class zo extends NT{writeLeftID(t){oe(this.restEncoder,t.client),oe(this.restEncoder,t.clock)}writeRightID(t){oe(this.restEncoder,t.client),oe(this.restEncoder,t.clock)}writeClient(t){oe(this.restEncoder,t)}writeInfo(t){Gu(this.restEncoder,t)}writeString(t){Ws(this.restEncoder,t)}writeParentInfo(t){oe(this.restEncoder,t?1:0)}writeTypeRef(t){oe(this.restEncoder,t)}writeLen(t){oe(this.restEncoder,t)}writeAny(t){Po(this.restEncoder,t)}writeBuf(t){rr(this.restEncoder,t)}writeJSON(t){Ws(this.restEncoder,JSON.stringify(t))}writeKey(t){Ws(this.restEncoder,t)}}class IT{constructor(){this.restEncoder=rc(),this.dsCurrVal=0}toUint8Array(){return Hr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,oe(this.restEncoder,n)}writeDsLen(t){t===0&&Vr(),oe(this.restEncoder,t-1),this.dsCurrVal+=t}}class hs extends IT{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Vu,this.clientEncoder=new sc,this.leftClockEncoder=new Vu,this.rightClockEncoder=new Vu,this.infoEncoder=new V0(Gu),this.stringEncoder=new Mv,this.parentInfoEncoder=new V0(Gu),this.typeRefEncoder=new sc,this.lenEncoder=new sc}toUint8Array(){const t=rc();return oe(t,0),rr(t,this.keyClockEncoder.toUint8Array()),rr(t,this.clientEncoder.toUint8Array()),rr(t,this.leftClockEncoder.toUint8Array()),rr(t,this.rightClockEncoder.toUint8Array()),rr(t,Hr(this.infoEncoder)),rr(t,this.stringEncoder.toUint8Array()),rr(t,Hr(this.parentInfoEncoder)),rr(t,this.typeRefEncoder.toUint8Array()),rr(t,this.lenEncoder.toUint8Array()),ic(t,Hr(this.restEncoder)),Hr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Po(this.restEncoder,t)}writeBuf(t){rr(this.restEncoder,t)}writeJSON(t){Po(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const CT=(e,t,n,r)=>{r=ls(r,t[0].id.clock);const i=Jr(t,r);oe(e.restEncoder,t.length-i),e.writeClient(n),oe(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},ah=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{cn(t,s)>i&&r.set(s,i)}),lh(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),oe(e.restEncoder,r.size),cs(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{CT(e,t.clients.get(i),i,s)})},LT=(e,t)=>{const n=Or(),r=qt(e.restDecoder);for(let i=0;i<r;i++){const s=qt(e.restDecoder),o=new Array(s),a=e.readClient();let c=qt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(nc&u){case 0:{const f=e.readLen();o[l]=new dr(Qt(a,c),f),c+=f;break}case 10:{const f=qt(e.restDecoder);o[l]=new pr(Qt(a,c),f),c+=f;break}default:{const f=(u&(mi|nr))===0,d=new Qe(Qt(a,c),null,(u&nr)===nr?e.readLeftID():null,null,(u&mi)===mi?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&Mo)===Mo?e.readString():null,rm(e,u));o[l]=d,c+=d.length}}}}return n},MT=(e,t,n)=>{const r=[];let i=cs(n.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new Op,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const m=h.id.client,p=n.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),n.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(b=>b!==m)}r.length=0};for(;;){if(u.constructor!==pr){const m=Mi(f,u.id.client,()=>cn(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(e,t);if(p!==null){r.push(u);const b=n.get(p)||{refs:[],i:0};if(b.refs.length===b.i)l(p,cn(t,p)),d();else{u=b.refs[b.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new hs;return ah(h,a,new Map),oe(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},UT=(e,t)=>ah(e,t.doc.store,t.beforeState),FT=(e,t,n,r=new qs(e))=>pe(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=LT(r,o),l=MT(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<cn(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const m=u.missing.get(d);(m==null||m>h)&&u.missing.set(d,h)}u.update=dc([u.update,l.update])}}else a.pendingStructs=l;const f=yp(r,i,a);if(a.pendingDs){const d=new qs(Gs(a.pendingDs));qt(d.restDecoder);const h=yp(d,i,a);f&&h?a.pendingDs=dc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,Ep(i.doc,d)}},n,!1),Ep=(e,t,n,r=qs)=>{const i=Gs(t);FT(i,e,n,new r(i))},xp=(e,t,n)=>Ep(e,t,n,wp),BT=(e,t,n=new Map)=>{ah(e,t.store,n),Vs(e,RT(t.store))},PT=(e,t=new Uint8Array([0]),n=new hs)=>{const r=vp(t);BT(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(qT(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===zo)return VT(i.map((s,o)=>o===0?s:ZT(s)));if(n.constructor===hs)return dc(i)}return i[0]},$T=(e,t)=>PT(e,t,new zo),DT=e=>{const t=new Map,n=qt(e.restDecoder);for(let r=0;r<n;r++){const i=qt(e.restDecoder),s=qt(e.restDecoder);t.set(i,s)}return t},vp=e=>DT(new kp(Gs(e)));class jT{constructor(){this.l=[]}}const Tp=()=>new jT,Ap=(e,t)=>e.l.push(t),Sp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Rp=(e,t,n)=>th(e.l,[t,n]);class Js{constructor(t,n){this.client=t,this.clock=n}}const hc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Qt=(e,t)=>new Js(e,t),zT=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Vr()},Zs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!_p(t.ds,e.id),ch=(e,t)=>{const n=Mi(e.meta,ch,zs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<cn(r,s)&&Bi(e,Qt(s,i))}),gp(e,t.ds,i=>{}),n.add(t))};class Op{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const lh=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},cn=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Np=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Vr()}n.push(t)},Jr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ui(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ui((n+r)/2)}throw Vr()},uh=(e,t)=>{const n=e.clients.get(t.client);return n[Jr(n,t.clock)]},hh=(e,t,n)=>{const r=Jr(t,n),i=t[r];return i.id.clock<n&&i instanceof Qe?(t.splice(r+1,0,vc(e,i,n-i.id.clock)),r+1):r},Bi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[hh(e,n,t.clock)]},Ip=(e,t,n)=>{const r=t.clients.get(n.client),i=Jr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==dr&&r.splice(i+1,0,vc(e,s,n.clock-s.id.clock+1)),s},WT=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Jr(r,t.id.clock)]=n},Cp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=hh(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&hh(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class GT{constructor(t,n,r){this.doc=t,this.deleteSet=new jo,this.beforeState=lh(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Lp=(e,t)=>t.deleteSet.clients.size===0&&!dv(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(sh(t.deleteSet),UT(e,t),Vs(e,t.deleteSet),!0),Mp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Mi(e.changed,t,zs).add(n)},fc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Qe&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},KT=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Jr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Qe&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},HT=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=j0(i.length-1,1+Jr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+fc(i,c)}})},Up=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{sh(s),n.afterState=lh(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),Rp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),th(a,[]),n._needFormattingCleanup&&fA(n)}finally{r.gc&&KT(s,i,r.gcFilter),HT(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),m=ls(Jr(h,d),1);for(let p=h.length-1;p>=m;)p-=1+fc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),m=Jr(h,d);m+1<h.length&&fc(h,m+1)>1||m>0&&fc(h,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(ET(nh,up,"[yjs] ",hp,fp,"Changed the client-id because another client seems to be using it."),r.clientID=bp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new zo;Lp(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new hs;Lp(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Up(e,t+1)}}},pe=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new GT(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Up(i,0)}}return o};function*YT(e){const t=qt(e.restDecoder);for(let n=0;n<t;n++){const r=qt(e.restDecoder),i=e.readClient();let s=qt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=qt(e.restDecoder);yield new pr(Qt(i,s),c),s+=c}else if(nc&a){const c=(a&(mi|nr))===0,l=new Qe(Qt(i,s),null,(a&nr)===nr?e.readLeftID():null,null,(a&mi)===mi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&Mo)===Mo?e.readString():null,rm(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new dr(Qt(i,s),c),s+=c}}}}class fh{constructor(t,n){this.gen=YT(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===pr);return this.curr}}class dh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const VT=e=>dc(e,wp,zo),XT=(e,t)=>{if(e.constructor===dr){const{client:n,clock:r}=e.id;return new dr(Qt(n,r+t),e.length-t)}else if(e.constructor===pr){const{client:n,clock:r}=e.id;return new pr(Qt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Qe(Qt(r,i+t),null,Qt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},dc=(e,t=qs,n=hs)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Gs(u)));let i=r.map(u=>new fh(u,!0)),s=null;const o=new n,a=new dh(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const m=d.curr.id.clock-h.curr.id.clock;return m===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===pr?1:-1:m}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===pr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new pr(Qt(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===pr?s.struct.length-=m:d=XT(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==pr;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),ph(a);const c=r.map(u=>oh(u)),l=AT(c);return Vs(o,l),o.toUint8Array()},qT=(e,t,n=qs,r=hs)=>{const i=vp(t),s=new r,o=new dh(s),a=new n(Gs(e)),c=new fh(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===pr){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,ls(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}ph(o);const l=oh(a);return Vs(s,l),s.toUint8Array()},Fp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Hr(e.encoder.restEncoder)}),e.encoder.restEncoder=rc(),e.written=0)},Pi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Fp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),oe(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},ph=e=>{Fp(e);const t=e.encoder.restEncoder;oe(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];oe(t,r.written),ic(t,r.restEncoder)}},JT=(e,t,n,r)=>{const i=new n(Gs(e)),s=new fh(i,!1),o=new r,a=new dh(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,t(l),0);ph(a);const c=oh(i);return Vs(o,c),o.toUint8Array()},ZT=e=>JT(e,aT,qs,zo),Bp="You must not compute changes after the event-handler fired.";class pc{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=QT(this.currentTarget,this.target))}deletes(t){return _p(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(Bp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Du(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Du(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Du(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(Bp);const n=this.target,r=zs(),i=zs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const QT=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},En=()=>{xT("Invalid access: Add Yjs type to a document before reading data.")},Pp=80;let mh=0;class tA{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=mh++}}const eA=e=>{e.timestamp=mh++},$p=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=mh++},nA=(e,t,n)=>{if(e.length>=Pp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return $p(r,t,n),r}else{const r=new tA(t,n);return e.push(r),r}},mc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>ec(t-s.index)<ec(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,eA(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ec(n.index-i)<r.parent.length/Pp?($p(n,r,i),n):nA(e._searchMarker,r,i)},Wo=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=ls(t,i.index+n))}},gc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Mi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Rp(r._eH,n,t)};class yn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Tp(),this._dEH=Tp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Yr()}clone(){throw Yr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ap(this._eH,t)}observeDeep(t){Ap(this._dEH,t)}unobserve(t){Sp(this._eH,t)}unobserveDeep(t){Sp(this._dEH,t)}toJSON(){}}const Dp=(e,t,n)=>{e.doc??En(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},jp=e=>{e.doc??En();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Go=(e,t)=>{let n=0,r=e._start;for(e.doc??En();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},zp=(e,t)=>{const n=[];return Go(e,(r,i)=>{n.push(t(r,i,e))}),n},rA=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Wp=(e,t)=>{e.doc??En();const n=mc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},_c=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Qe(Qt(o,cn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ps(l)),i.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Qe(Qt(o,cn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ko(new Uint8Array(f))),i.integrate(e,0);break;case Xs:i=new Qe(Qt(o,cn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Yo(f)),i.integrate(e,0);break;default:if(f instanceof yn)i=new Qe(Qt(o,cn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new bi(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Gp=()=>Fi("Length exceeded!"),Kp=(e,t,n,r)=>{if(n>t._length)throw Gp();if(n===0)return t._searchMarker&&Wo(t._searchMarker,n,r.length),_c(e,t,null,r);const i=n,s=mc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Bi(e,Qt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Wo(t._searchMarker,i,r.length),_c(e,t,o,r)},iA=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return _c(e,t,i,n)},Hp=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=mc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Bi(e,Qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Bi(e,Qt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Gp();t._searchMarker&&Wo(t._searchMarker,i,-s+r)},yc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},gh=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ps([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ps([r]);break;case Uint8Array:a=new Ko(r);break;case Xs:a=new Yo(r);break;default:if(r instanceof yn)a=new bi(r);else throw new Error("Unexpected content type")}new Qe(Qt(o,cn(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},_h=(e,t)=>{e.doc??En();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Yp=e=>{const t={};return e.doc??En(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Vp=(e,t)=>{e.doc??En();const n=e._map.get(t);return n!==void 0&&!n.deleted},sA=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Zs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},bc=e=>(e.doc??En(),vT(e._map.entries(),t=>!t[1].deleted));class oA extends pc{}class Qs extends yn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Qs;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Qs}clone(){const t=new Qs;return t.insert(0,this.toArray().map(n=>n instanceof yn?n.clone():n)),t}get length(){return this.doc??En(),this._length}_callObserver(t,n){super._callObserver(t,n),gc(this,t,new oA(this,t))}insert(t,n){this.doc!==null?pe(this.doc,r=>{Kp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?pe(this.doc,n=>{iA(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{Hp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Wp(this,t)}toArray(){return jp(this)}slice(t=0,n=this.length){return Dp(this,t,n)}toJSON(){return this.map(t=>t instanceof yn?t.toJSON():t)}map(t){return zp(this,t)}forEach(t){Go(this,t)}[Symbol.iterator](){return rA(this)}_write(t){t.writeTypeRef(IA)}}const aA=e=>new Qs;class cA extends pc{constructor(t,n,r){super(t,n),this.keysChanged=r}}class to extends yn{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new to}clone(){const t=new to;return this.forEach((n,r)=>{t.set(r,n instanceof yn?n.clone():n)}),t}_callObserver(t,n){gc(this,t,new cA(this,t,n))}toJSON(){this.doc??En();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof yn?i.toJSON():i}}),t}get size(){return[...bc(this)].length}keys(){return rh(bc(this),t=>t[0])}values(){return rh(bc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return rh(bc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??En(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?pe(this.doc,n=>{yc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?pe(this.doc,r=>{gh(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return _h(this,t)}has(t){return Vp(this,t)}clear(){this.doc!==null?pe(this.doc,t=>{this.forEach(function(n,r,i){yc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(CA)}}const lA=e=>new to,$i=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&sT(e,t);class yh{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Vr(),this.right.content.constructor){case Ze:this.right.deleted||eo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Xp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Ze:t.right.deleted||eo(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Bi(e,Qt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},kc=(e,t,n,r)=>{const i=new Map,s=r?mc(t,n):null;if(s){const o=new yh(s.p.left,s.p,s.index,i);return Xp(e,o,n-s.index)}else{const o=new yh(null,t._start,0,i);return Xp(e,o,n)}},qp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ze&&$i(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Qe(Qt(s,cn(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new Ze(a,o));u.integrate(e,0),n.right=u,n.forward()})},eo=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Jp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Ze&&$i(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Zp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!$i(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Qe(Qt(s,cn(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new Ze(a,c)),n.right.integrate(e,0),n.forward()}}return o},bh=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;Jp(n,i);const a=Zp(e,t,n,i),c=r.constructor===String?new Zr(r):r instanceof yn?new bi(r):new ds(r);let{left:l,right:u,index:f}=n;t._searchMarker&&Wo(t._searchMarker,n.index,c.getLength()),u=new Qe(Qt(o,cn(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=f,n.forward(),qp(e,t,n,a)},Qp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Jp(n,i);const a=Zp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ze));){if(!n.right.deleted)switch(n.right.content.constructor){case Ze:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if($i(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Bi(e,Qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Qe(Qt(o,cn(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Zr(c)),n.right.integrate(e,0),n.forward()}qp(e,t,n,a)},tm=(e,t,n,r,i)=>{let s=t;const o=Or();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ze){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case Ze:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&eo(i,l);break}}}t=t.right}return a},uA=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Ze){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},hA=e=>{let t=0;return pe(e.doc,n=>{let r=e._start,i=e._start,s=Or();const o=$u(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ze:eo(o,i.content);break;default:t+=tm(n,r,i,s,o),s=$u(o),r=i;break}i=i.right}}),t},fA=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Cp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ze&&o.constructor!==dr&&t.add(o.parent)})}pe(n,r=>{gp(e,e.deleteSet,i=>{if(i instanceof dr||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Ze?t.add(s):uA(r,i)});for(const i of t)hA(i)})},em=(e,t,n)=>{const r=n,i=$u(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case bi:case ds:case Zr:n<t.right.length&&Bi(e,Qt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&tm(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Wo(o._searchMarker,t.index,-r+n),t};class dA extends pc{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];pe(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},nT(c)||(h.attributes=Qv({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case bi:case ds:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Zr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Ze:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;$i(p,m)?m!==null&&o.delete(r):(a==="retain"&&d(),$i(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;$i(p,m)||(a==="retain"&&d(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&($i(p,m)?p!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&d(),eo(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class yi extends yn{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??En(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new yi}clone(){const t=new yi;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new dA(this,t,n);gc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??En();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Zr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?pe(this.doc,r=>{const i=new yh(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&bh(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Qp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&em(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??En();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((m,p)=>{d=!0,f[p]=m});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Zs(c,t)||n!==void 0&&Zs(c,n))switch(c.content.constructor){case Zr:{const f=s.get("ychange");t!==void 0&&!Zs(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Zs(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case bi:case ds:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,m)=>{d[m]=h})}i.push(f);break}case Ze:Zs(c,t)&&(l(),eo(s,c.content));break}c=c.right}l()};return t||n?pe(o,f=>{t&&ch(f,t),n&&ch(f,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?pe(i,s=>{const o=kc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),bh(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?pe(i,s=>{const o=kc(s,this,t,!r);bh(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?pe(r,i=>{em(i,kc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?pe(i,s=>{const o=kc(s,this,t,!1);o.right!==null&&Qp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{yc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{gh(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return _h(this,t)}getAttributes(){return Yp(this)}_write(t){t.writeTypeRef(LA)}}const pA=e=>new yi;class kh{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??En()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===no||n.constructor===fs)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class fs extends yn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new fs}clone(){const t=new fs;return t.insert(0,this.toArray().map(n=>n instanceof yn?n.clone():n)),t}get length(){return this.doc??En(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new kh(this,t)}querySelector(t){t=t.toUpperCase();const r=new kh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),cs(new kh(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){gc(this,t,new _A(this,n,t))}toString(){return zp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Go(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?pe(this.doc,r=>{Kp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)pe(this.doc,r=>{const i=t&&t instanceof yn?t._item:t;_c(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Fi("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{Hp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return jp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Wp(this,t)}slice(t=0,n=this.length){return Dp(this,t,n)}forEach(t){Go(this,t)}_write(t){t.writeTypeRef(UA)}}const mA=e=>new fs;class no extends fs{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new no(this.nodeName)}clone(){const t=new no(this.nodeName),n=this.getAttributes();return eT(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof yn?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{yc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{gh(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return _h(this,t)}hasAttribute(t){return Vp(this,t)}getAttributes(t){return t?sA(this,t):Yp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Go(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(MA),t.writeKey(this.nodeName)}}const gA=e=>new no(e.readKey());class _A extends pc{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class wc extends to{constructor(t){super(),this.hookName=t}_copy(){return new wc(this.hookName)}clone(){const t=new wc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(FA),t.writeKey(this.hookName)}}const yA=e=>new wc(e.readKey());class Ec extends yi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Ec}clone(){const t=new Ec;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(BA)}}const bA=e=>new Ec;class wh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Yr()}mergeWith(t){return!1}write(t,n,r){throw Yr()}integrate(t,n){throw Yr()}}const kA=0;class dr extends wh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Np(t.doc.store,this)}write(t,n){t.writeInfo(kA),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ko{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ko(this.content)}splice(t){throw Yr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const wA=e=>new Ko(e.readBuf());class Ho{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ho(this.len)}splice(t){const n=new Ho(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){uc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const EA=e=>new Ho(e.readLen()),nm=(e,t)=>new Xs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Yo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Yo(nm(this.doc.guid,this.opts))}splice(t){throw Yr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const xA=e=>new Yo(nm(e.readString(),e.readAny()));class ds{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ds(this.embed)}splice(t){throw Yr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const vA=e=>new ds(e.readJSON());class Ze{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ze(this.key,this.value)}splice(t){throw Yr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const TA=e=>new Ze(e.readKey(),e.readJSON());class xc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xc(this.arr)}splice(t){const n=new xc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const AA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new xc(n)},SA=lc("node_env")==="development";class ps{constructor(t){this.arr=t,SA&&ap(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ps(this.arr)}splice(t){const n=new ps(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const RA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ps(n)};class Zr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Zr(this.str)}splice(t){const n=new Zr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const OA=e=>new Zr(e.readString()),NA=[aA,lA,pA,gA,mA,yA,bA],IA=0,CA=1,LA=2,MA=3,UA=4,FA=5,BA=6;class bi{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new bi(this.type._copy())}splice(t){throw Yr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const PA=e=>new bi(NA[e.readTypeRef()](e)),vc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Qe(Qt(r,i+n),t,Qt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Qt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Qe extends wh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?G0:0}set marker(t){(this.info&zu)>0!==t&&(this.info^=zu)}get marker(){return(this.info&zu)>0}get keep(){return(this.info&W0)>0}set keep(t){this.keep!==t&&(this.info^=W0)}get countable(){return(this.info&G0)>0}get deleted(){return(this.info&ju)>0}set deleted(t){this.deleted!==t&&(this.info^=ju)}markDeleted(){this.info|=ju}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=cn(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=cn(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Js&&this.id.client!==this.parent.client&&this.parent.clock>=cn(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Ip(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Bi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===dr||this.right&&this.right.constructor===dr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Qe?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Qe&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Js){const r=uh(n,this.parent);r.constructor===dr?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Ip(t,t.doc.store,Qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),hc(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(hc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(uh(t.doc.store,i.origin)))s.has(uh(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Np(t.doc.store,this),this.content.integrate(t,this),Mp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new dr(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Qt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&hc(t.origin,this.lastId)&&this.right===t&&hc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),uc(t.deleteSet,this.id.client,this.id.clock,this.length),Mp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Vr();this.content.gc(t),n?WT(t,this,new dr(this.id,this.length)):this.content=new Ho(this.length)}write(t,n){const r=n>0?Qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&nc|(r===null?0:nr)|(i===null?0:mi)|(s===null?0:Mo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=zT(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Js?(t.writeParentInfo(!1),t.writeLeftID(a)):Vr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const rm=(e,t)=>$A[t&nc](e),$A=[()=>{Vr()},EA,AA,wA,OA,vA,TA,PA,RA,xA,()=>{Vr()}],DA=10;class pr extends wh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Vr()}write(t,n){t.writeInfo(DA),oe(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const im=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof js<"u"?js:{},sm="__ $YJS$ __";im[sm]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),im[sm]=!0;let om=!1;const sr=new Xs;function am(e,t,n){const r=sr.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function jA(e,t){am(e,0,t)}function Eh(e,t){const n=new yi(t);am(e,1,n)}function zA(e,t){sr.getMap().set(e,t)}function WA(e,t){const n=sr.getMap(),r=new yi(t);n.set(e,r)}function cm(e,t){const n=sr.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function GA(e,t){return cm(e,n=>{wt(n)&&t(n)})}function lm(e,t){return cm(e,n=>{n instanceof yi&&t(n.toJSON())})}const ms=Bs("modem",["second"],e=>{if(ms.session(e))switch(e.target){case"second":!om&&e.data%2===0&&ms.emit(e.player,"modem:join");break;case"join":e.sender!==ms.id()&&ms.reply(e,"joinack",B0($T(sr)));break;case"joinack":e.sender!==ms.id()&&(om=!0,xp(sr,Qa(e.data),sr));break;case"sync":{e.sender!==ms.id()&&y(e.data)&&xp(sr,Qa(e.data),sr);break}}});function um(e,t){t!==sr&&ms.emit("","modem:sync",B0(e))}sr.on("update",um),sr.on("destroy",()=>{sr.off("update",um)});function hm(e,t){return e%t}function fm(e,t){return Math.floor(e/t)}function KA(e,t){return{x:hm(e,t),y:fm(e,t)}}function $n(e,t){return e.x+e.y*t}function ro(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function xh(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function dm(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function pm(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const mm="176",HA="",Nr="srgb",gm="srgb-linear",_m="linear",vh="srgb";function Ir(e,t,n){return Math.max(t,Math.min(n,e))}function YA(e,t){return(e%t+t)%t}function Th(e,t,n){return(1-n)*e+n*t}class Vo{constructor(t=0,n=0){Vo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Ir(this.x,t.x,n.x),this.y=Ir(this.y,t.y,n.y),this}clampScalar(t,n){return this.x=Ir(this.x,t,n),this.y=Ir(this.y,t,n),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Ir(r,t,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Ir(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xo{constructor(t,n,r,i,s,o,a,c,l){Xo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],m=r[8],p=i[0],b=i[3],k=i[6],x=i[1],T=i[4],A=i[7],M=i[2],S=i[5],I=i[8];return s[0]=o*p+a*x+c*M,s[3]=o*b+a*T+c*S,s[6]=o*k+a*A+c*I,s[1]=l*p+u*x+f*M,s[4]=l*b+u*T+f*S,s[7]=l*k+u*A+f*I,s[2]=d*p+h*x+m*M,s[5]=d*b+h*T+m*S,s[8]=d*k+h*A+m*I,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,m=n*f+r*d+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=f*p,t[1]=(i*l-u*r)*p,t[2]=(a*r-i*o)*p,t[3]=d*p,t[4]=(u*n-i*c)*p,t[5]=(i*s-a*n)*p,t[6]=h*p,t[7]=(r*c-l*n)*p,t[8]=(o*n-r*s)*p,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(Ah.makeScale(t,n)),this}rotate(t){return this.premultiply(Ah.makeRotation(-t)),this}translate(t,n){return this.premultiply(Ah.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ah=new Xo,ym=new Xo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),bm=new Xo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function VA(){const e={enabled:!0,workingColorSpace:gm,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===vh&&(i.r=io(i.r),i.g=io(i.g),i.b=io(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===vh&&(i.r=so(i.r),i.g=so(i.g),i.b=so(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===HA?_m:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[gm]:{primaries:t,whitePoint:r,transfer:_m,toXYZ:ym,fromXYZ:bm,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Nr},outputColorSpaceConfig:{drawingBufferColorSpace:Nr}},[Nr]:{primaries:t,whitePoint:r,transfer:vh,toXYZ:ym,fromXYZ:bm,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Nr}}}),e}const Cr=VA();function io(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function so(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const km={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Di={h:0,s:0,l:0},Tc={h:0,s:0,l:0};function Sh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class Rh{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=Nr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Cr.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Cr.workingColorSpace){return this.r=t,this.g=n,this.b=r,Cr.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Cr.workingColorSpace){if(t=YA(t,1),n=Ir(n,0,1),r=Ir(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=Sh(o,s,t+1/3),this.g=Sh(o,s,t),this.b=Sh(o,s,t-1/3)}return Cr.toWorkingColorSpace(this,i),this}setStyle(t,n=Nr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=Nr){const r=km[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=io(t.r),this.g=io(t.g),this.b=io(t.b),this}copyLinearToSRGB(t){return this.r=so(t.r),this.g=so(t.g),this.b=so(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Nr){return Cr.fromWorkingColorSpace(xn.copy(this),t),Math.round(Ir(xn.r*255,0,255))*65536+Math.round(Ir(xn.g*255,0,255))*256+Math.round(Ir(xn.b*255,0,255))}getHexString(t=Nr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Cr.workingColorSpace){Cr.fromWorkingColorSpace(xn.copy(this),n);const r=xn.r,i=xn.g,s=xn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=Cr.workingColorSpace){return Cr.fromWorkingColorSpace(xn.copy(this),n),t.r=xn.r,t.g=xn.g,t.b=xn.b,t}getStyle(t=Nr){Cr.fromWorkingColorSpace(xn.copy(this),t);const n=xn.r,r=xn.g,i=xn.b;return t!==Nr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Di),this.setHSL(Di.h+t,Di.s+n,Di.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Di),t.getHSL(Tc);const r=Th(Di.h,Tc.h,n),i=Th(Di.s,Tc.s,n),s=Th(Di.l,Tc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const xn=new Rh;Rh.NAMES=km,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:mm}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=mm),new Vo,new Vo;function Ge(e,t,n){return Math.max(t,Math.min(n,e))}function wm(e){return e/180*Math.PI}function Em(e){return e*180/Math.PI}const XA=Jd("089fad0j9awfem09wavefc09uwaef");function qA(){return XA()}function JA(e){return Jd(e)()}function mr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(qA()*i)}function xm(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(JA(e)*s)}function vm(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function ZA(e){return e[mr(0,e.length-1)]}function QA(e,t){return t[xm(e,0,t.length-1)]}function gr(...e){return ZA(e.flat())}function tS(e,...t){return QA(e,t.flat())}function eS(e){return[...new Set(e)].filter(y)}function qo(e){return y(e)&&y(e.x)&&y(e.y)}function Pe(e,t){switch(t){case _t.NORTH:--e.y;break;case _t.SOUTH:++e.y;break;case _t.WEST:--e.x;break;case _t.EAST:++e.x;break}return e}function Oh(e,t){return e<0?_t.WEST:e>0?_t.EAST:t<0?_t.NORTH:t>0?_t.SOUTH:_t.IDLE}function Lr(e,t){return Oh(t.x-e.x,t.y-e.y)}const Nh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Dn(e){return ae(e)&&Tm(e[0])}function Tm(e){return y(_t[e])&&pt(e)}function Am(e){const t=_t[e];return y(t)?t:_t.IDLE}function Ac(e){if(pt(e))return Nh[Nt(e)]}function nS(e){if(Dn(e))return e;if(Tm(e))return[e];const t=Ac(e);if(y(t))return[t]}function Sm(e){const t=w.words[e],n=nS(t);return Dn(n)?[n,e+1]:[void 0,e]}function Rm(e){var i,s;const t=[];let[n,r]=Sm(e);for(;Dn(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=rt(w.words,r,[K.NUMBER,K.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=rt(w.words,r,[K.KIND]);console.info("kind",c),r=l;break}case"TO":{const[c,l,u]=rt(w.words,r,[K.DIR,K.DIR]),f=((i=w.element)==null?void 0:i.x)??0,d=((s=w.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,t.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,r]}const[o,a]=Sm(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function rS(e){return y(e)&&e<Lt.ONBLACK?e:void 0}function Ih(e){return y(e)&&e>Lt.WHITE&&e<Lt.ONCLEAR?e-Lt.ONBLACK:void 0}const Jo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Sn(e){return ae(e)&&Om(e[0])}function iS(e){return Sn(e)&&e[0].startsWith("ON")}function Om(e){return y(Lt[e])&&pt(e)}function Zo(e){if(pt(e))return Jo[Nt(e)]}function Qo(e,t){return[y(e)?`${Lt[e]}`:void 0,y(t)?`ON${Lt[t]}`:void 0].filter(y)}function Sc(e){return e.map(t=>Lt[t]).find(t=>y(t)&&t<Lt.ONBLACK)}function Rc(e){return e.map(t=>Lt[t]).find(t=>y(t)&&t>=Lt.ONBLACK)}function sS(e){if(Sn(e))return e;if(Om(e))return[e];const t=Zo(e);if(y(t))return[t]}function Nm(e){const t=w.words[e],n=sS(t);return Sn(n)?[n,e+1]:[void 0,e]}function Oc(e){var c;const t=[];let n=e;const r=w.words[e];if(pt(r)&&Nt(r)==="color")return[Qo(((c=w.element)==null?void 0:c.color)??Lt.WHITE,void 0),e+1];const[i,s]=Nm(e);Sn(i)&&(t.push(...i),n=s);const[o,a]=Nm(s);return iS(o)&&(t.push(...o),n=a),t.length?[t,n]:[void 0,e]}function Im(e){const t={};for(let n=0;n<e.length;++n){const r=e[n],i=Lt[r];y(i)&&(i<Lt.ONBLACK?t.color=i:t.bg=Ih(i))}return t}var Cm={exports:{}},Ch={exports:{}},Lm;function oS(){return Lm||(Lm=1,function(e,t){(function(n,r){e.exports=r()})(Un,function(){function n(p){return!isNaN(parseFloat(p))&&isFinite(p)}function r(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(p){if(p)for(var b=0;b<u.length;b++)p[u[b]]!==void 0&&this["set"+r(u[b])](p[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof f)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new f(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",b=this.getLineNumber()||"",k=this.getColumnNumber()||"",x=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+b+":"+k+")":"[eval]:"+b+":"+k:x?x+" ("+p+":"+b+":"+k+")":p+":"+b+":"+k}},f.fromString=function(b){var k=b.indexOf("("),x=b.lastIndexOf(")"),T=b.substring(0,k),A=b.substring(k+1,x).split(","),M=b.substring(x+1);if(M.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(M,""),I=S[1],$=S[2],N=S[3];return new f({functionName:T,args:A||void 0,fileName:I,lineNumber:$||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(p){return function(b){this[p]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(p){return function(b){if(!n(b))throw new TypeError(p+" must be a Number");this[p]=Number(b)}}(o[h]);for(var m=0;m<a.length;m++)f.prototype["get"+r(a[m])]=i(a[m]),f.prototype["set"+r(a[m])]=function(p){return function(b){this[p]=String(b)}}(a[m]);return f})}(Ch)),Ch.exports}(function(e,t){(function(n,r){e.exports=r(oS())})(Un,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),m=d&&f||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new r({functionName:m,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Cm);var aS=Cm.exports,cS=Us(aS);const At=60,Ht=25,Lh=At*Ht;var bt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(bt||{});const Mh=14,Nc=3,ji=8,zi=14,Ic=16,lS=16,uS=16;var Cc=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(Cc||{});function ta(e,t){return new Array(e).fill(t)}function hS(e,t,n,r,i,s=0){const o=r*i;return{id:`tiles:${e}:${t}`,type:1,tag:n,width:r,height:i,char:ta(o,0),color:ta(o,0),bg:ta(o,s),wall:ta(o,0)}}function fS(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Lt.ONCLEAR}}function dS(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function pS(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:ta(s,i)}}function mS(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function gS(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Mm(e,t){return`${e}:${t}`}const _S=1,yS=16,bS=256;var Rn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Rn||{});const Qr=!!JSON.parse("false"),kS=!!JSON.parse("false");JSON.parse("false");const Um=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ki={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return ji*ki.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return zi*ki.DRAW_CHAR_SCALE}},tt=Bs("SOFTWARE");function wi(e){const t={},n={tick(){},everytick(){},listcommands(){return er(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Ae(e){return`${e??""}`}function ea(e,t){const n=parseFloat(Ae(e));return isNaN(n)?t:n}function jn(e,t,n,r){const[i,s]=rt(r,0,[K.NUMBER_OR_STRING,K.MAYBE_NUMBER_OR_STRING]);f0(tt,e,t,n,i,s)}const wS=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Fm(e,t,n){const[r,i]=rt(n,0,[K.NUMBER_OR_STRING]);if(wt(r))xu(tt,e,t,"volume",r);else if(wS.includes(Nt(r))){const[s,o]=rt(n,i,[K.NUMBER_OR_STRING,K.MAYBE_NUMBER_OR_STRING]);f0(tt,e,t,r,s,o)}else{const[s]=rt(n,i,[K.MAYBE_NUMBER_OR_STRING]);if(wt(s)){const o=n.length-i,a=new Array(o).fill(K.NUMBER),c=rt(n,i,a).slice(0,o),l=c.length===1?c[0]:c;xu(tt,e,t,r,l)}else{const[o]=rt(n,i,[K.MAYBE_NUMBER_OR_STRING]);xu(tt,e,t,r,o)}}}let Bm="en-US-GuyNeural";function Wi(e,t){var r;const[n]=rt(e,0,[K.MAYBE_NAME]);Ax(tt,w.elementfocus,((r=w.board)==null?void 0:r.id)??"",n??"",t)}const Uh=wi().command("talk",(e,t)=>{const[n]=rt(t,0,[K.ANY]);switch(Nt(n)){default:sx(tt,w.elementfocus);break;case"stop":ox(tt,w.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=rt(t,0,[K.ANY]);switch(Nt(n)){default:ax(tt,w.elementfocus);break;case"stop":cx(tt,w.elementfocus);break}return 0}).command("tts",(e,t)=>{const n=t.map(Ae).join("");return vx(tt,w.elementfocus,Bm,n),0}).command("ttsvoice",(e,t)=>(Bm=t.map(Ae).join(""),0)).command("bpm",(e,t)=>{const[n]=rt(t,0,[K.NUMBER]);return Rx(tt,w.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=rt(t,0,[K.NUMBER]);return Ox(tt,w.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=rt(t,0,[K.NUMBER]);return Nx(tt,w.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=rt(t,0,[K.NUMBER]);return Ix(tt,w.elementfocus,n),0}).command("play",(e,t)=>{var r;const[n]=rt(t,0,[K.MAYBE_NAME]);return Tx(tt,w.elementfocus,((r=w.board)==null?void 0:r.id)??"",n??""),0}).command("bgplay",(e,t)=>(Wi(t,""),0)).command("bgplayon64n",(e,t)=>(Wi(t,"@64n"),0)).command("bgplayon32n",(e,t)=>(Wi(t,"@32n"),0)).command("bgplayon16n",(e,t)=>(Wi(t,"@16n"),0)).command("bgplayon8n",(e,t)=>(Wi(t,"@8n"),0)).command("bgplayon4n",(e,t)=>(Wi(t,"@4n"),0)).command("bgplayon2n",(e,t)=>(Wi(t,"@2n"),0)).command("bgplayon1n",(e,t)=>(Wi(t,"@1m"),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)Fm(w.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)jn(w.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)jn(w.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)jn(w.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)jn(w.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)jn(w.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)jn(w.elementfocus,n,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let n=0;n<3;++n)jn(w.elementfocus,n,"autowah",t);return 0});for(let e=0;e<8;++e)Uh.command(`synth${e+1}`,(t,n)=>(Fm(w.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Uh.command(`echo${t}`,(n,r)=>(jn(w.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(jn(w.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(jn(w.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(jn(w.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(jn(w.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(jn(w.elementfocus,e,"vibrato",r),0)).command(`autowah${t}`,(n,r)=>(jn(w.elementfocus,e,"autowah",r),0))}var Fh;try{Fh=new TextDecoder}catch{}var kt,_r,H=0,me={},te,Gi,yr=0,ti=0,ln,Ei,zn=[],Zt,Pm={useRecords:!1,mapsAsObjects:!0};class $m{}const Dm=new $m;Dm.name="MessagePack 0xC1";var Ki=!1,jm=2,zm;try{new Function("")}catch{jm=1/0}class na{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(kt)return eg(()=>(jh(),this?this.unpack(t,n):na.prototype.unpack.call(Pm,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof _n<"u"?_n.from(t):new Uint8Array(t)),typeof n=="object"?(_r=n.end||t.length,H=n.start||0):(H=0,_r=n>-1?n:t.length),ti=0,Gi=null,ln=null,kt=t;try{Zt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw kt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof na){if(me=this,this.structures)return te=this.structures,Lc(n);(!te||te.length>0)&&(te=[])}else me=Pm,(!te||te.length>0)&&(te=[]);return Lc(n)}unpackMultiple(t,n){let r,i=0;try{Ki=!0;let s=t.length,o=this?this.unpack(t,s):Mc.unpack(t,s);if(n){if(n(o,i,H)===!1)return;for(;H<s;)if(i=H,n(Lc(),i,H)===!1)return}else{for(r=[o];H<s;)i=H,r.push(Lc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Ki=!1,jh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Lc(e){try{if(!me.trusted&&!Ki){let n=te.sharedLength||0;n<te.length&&(te.length=n)}let t;if(me.randomAccessStructure&&kt[H]<64&&kt[H]>=32&&zm?(t=zm(kt,H,_r,me),kt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),H=_r):t=Ke(),ln&&(H=ln.postBundlePosition,ln=null),Ki&&(te.restoreStructures=null),H==_r)te&&te.restoreStructures&&Wm(),te=null,kt=null,Ei&&(Ei=null);else{if(H>_r)throw new Error("Unexpected end of MessagePack data");if(!Ki){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw te&&te.restoreStructures&&Wm(),jh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||H>_r)&&(t.incomplete=!0),t}}function Wm(){for(let e in te.restoreStructures)te[e]=te.restoreStructures[e];te.restoreStructures=null}function Ke(){let e=kt[H++];if(e<160)if(e<128){if(e<64)return e;{let t=te[e&63]||me.getStructures&&Km()[e&63];return t?(t.read||(t.read=Bh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Jm();r==="__proto__"&&(r="__proto_"),t[r]=Ke()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ke(),Ke());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ke();return me.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(ti>=H)return Gi.slice(H-yr,(H+=t)-yr);if(ti==0&&_r<140){let n=t<16?$h(t):Vm(t);if(n!=null)return n}return Ph(t)}else{let t;switch(e){case 192:return null;case 193:return ln?(t=Ke(),t>0?ln[1].slice(ln.position1,ln.position1+=t):ln[0].slice(ln.position0,ln.position0-=t)):Dm;case 194:return!1;case 195:return!0;case 196:if(t=kt[H++],t===void 0)throw new Error("Unexpected end of buffer");return Dh(t);case 197:return t=Zt.getUint16(H),H+=2,Dh(t);case 198:return t=Zt.getUint32(H),H+=4,Dh(t);case 199:return gs(kt[H++]);case 200:return t=Zt.getUint16(H),H+=2,gs(t);case 201:return t=Zt.getUint32(H),H+=4,gs(t);case 202:if(t=Zt.getFloat32(H),me.useFloat32>2){let n=zh[(kt[H]&127)<<1|kt[H+1]>>7];return H+=4,(n*t+(t>0?.5:-.5)>>0)/n}return H+=4,t;case 203:return t=Zt.getFloat64(H),H+=8,t;case 204:return kt[H++];case 205:return t=Zt.getUint16(H),H+=2,t;case 206:return t=Zt.getUint32(H),H+=4,t;case 207:return me.int64AsType==="number"?(t=Zt.getUint32(H)*4294967296,t+=Zt.getUint32(H+4)):me.int64AsType==="string"?t=Zt.getBigUint64(H).toString():me.int64AsType==="auto"?(t=Zt.getBigUint64(H),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Zt.getBigUint64(H),H+=8,t;case 208:return Zt.getInt8(H++);case 209:return t=Zt.getInt16(H),H+=2,t;case 210:return t=Zt.getInt32(H),H+=4,t;case 211:return me.int64AsType==="number"?(t=Zt.getInt32(H)*4294967296,t+=Zt.getUint32(H+4)):me.int64AsType==="string"?t=Zt.getBigInt64(H).toString():me.int64AsType==="auto"?(t=Zt.getBigInt64(H),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Zt.getBigInt64(H),H+=8,t;case 212:if(t=kt[H++],t==114)return Qm(kt[H++]&63);{let n=zn[t];if(n)return n.read?(H++,n.read(Ke())):n.noBuffer?(H++,n()):n(kt.subarray(H,++H));throw new Error("Unknown extension "+t)}case 213:return t=kt[H],t==114?(H++,Qm(kt[H++]&63,kt[H++])):gs(2);case 214:return gs(4);case 215:return gs(8);case 216:return gs(16);case 217:return t=kt[H++],ti>=H?Gi.slice(H-yr,(H+=t)-yr):xS(t);case 218:return t=Zt.getUint16(H),H+=2,ti>=H?Gi.slice(H-yr,(H+=t)-yr):vS(t);case 219:return t=Zt.getUint32(H),H+=4,ti>=H?Gi.slice(H-yr,(H+=t)-yr):TS(t);case 220:return t=Zt.getUint16(H),H+=2,Hm(t);case 221:return t=Zt.getUint32(H),H+=4,Hm(t);case 222:return t=Zt.getUint16(H),H+=2,Ym(t);case 223:return t=Zt.getUint32(H),H+=4,Ym(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const ES=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Bh(e,t){function n(){if(n.count++>jm){let i=e.read=new Function("r","return function(){return "+(me.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":ES.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ke);return e.highByte===0&&(e.read=Gm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Ke()}return me.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Gm(t,n):n}const Gm=(e,t)=>function(){let n=kt[H++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=te[r]||Km()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Bh(i,e)),i.read()};function Km(){let e=eg(()=>(kt=null,me.getStructures()));return te=me._mergeStructures(e,te)}var Ph=ra,xS=ra,vS=ra,TS=ra;function ra(e){let t;if(e<16&&(t=$h(e)))return t;if(e>64&&Fh)return Fh.decode(kt.subarray(H,H+=e));const n=H+e,r=[];for(t="";H<n;){const i=kt[H++];if(!(i&128))r.push(i);else if((i&224)===192){const s=kt[H++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=kt[H++]&63,o=kt[H++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=kt[H++]&63,o=kt[H++]&63,a=kt[H++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=un.apply(String,r),r.length=0)}return r.length>0&&(t+=un.apply(String,r)),t}function Hm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ke();return me.freezeData?Object.freeze(t):t}function Ym(e){if(me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Jm();r==="__proto__"&&(r="__proto_"),t[r]=Ke()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ke(),Ke());return t}}var un=String.fromCharCode;function Vm(e){let t=H,n=new Array(e);for(let r=0;r<e;r++){const i=kt[H++];if((i&128)>0){H=t;return}n[r]=i}return un.apply(String,n)}function $h(e){if(e<4)if(e<2){if(e===0)return"";{let t=kt[H++];if((t&128)>1){H-=1;return}return un(t)}}else{let t=kt[H++],n=kt[H++];if((t&128)>0||(n&128)>0){H-=2;return}if(e<3)return un(t,n);let r=kt[H++];if((r&128)>0){H-=3;return}return un(t,n,r)}else{let t=kt[H++],n=kt[H++],r=kt[H++],i=kt[H++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){H-=4;return}if(e<6){if(e===4)return un(t,n,r,i);{let s=kt[H++];if((s&128)>0){H-=5;return}return un(t,n,r,i,s)}}else if(e<8){let s=kt[H++],o=kt[H++];if((s&128)>0||(o&128)>0){H-=6;return}if(e<7)return un(t,n,r,i,s,o);let a=kt[H++];if((a&128)>0){H-=7;return}return un(t,n,r,i,s,o,a)}else{let s=kt[H++],o=kt[H++],a=kt[H++],c=kt[H++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){H-=8;return}if(e<10){if(e===8)return un(t,n,r,i,s,o,a,c);{let l=kt[H++];if((l&128)>0){H-=9;return}return un(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=kt[H++],u=kt[H++];if((l&128)>0||(u&128)>0){H-=10;return}if(e<11)return un(t,n,r,i,s,o,a,c,l,u);let f=kt[H++];if((f&128)>0){H-=11;return}return un(t,n,r,i,s,o,a,c,l,u,f)}else{let l=kt[H++],u=kt[H++],f=kt[H++],d=kt[H++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){H-=12;return}if(e<14){if(e===12)return un(t,n,r,i,s,o,a,c,l,u,f,d);{let h=kt[H++];if((h&128)>0){H-=13;return}return un(t,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=kt[H++],m=kt[H++];if((h&128)>0||(m&128)>0){H-=14;return}if(e<15)return un(t,n,r,i,s,o,a,c,l,u,f,d,h,m);let p=kt[H++];if((p&128)>0){H-=15;return}return un(t,n,r,i,s,o,a,c,l,u,f,d,h,m,p)}}}}}function Xm(){let e=kt[H++],t;if(e<192)t=e-160;else switch(e){case 217:t=kt[H++];break;case 218:t=Zt.getUint16(H),H+=2;break;case 219:t=Zt.getUint32(H),H+=4;break;default:throw new Error("Expected string")}return ra(t)}function Dh(e){return me.copyBuffers?Uint8Array.prototype.slice.call(kt,H,H+=e):kt.subarray(H,H+=e)}function gs(e){let t=kt[H++];if(zn[t]){let n;return zn[t](kt.subarray(H,n=H+=e),r=>{H=r;try{return Ke()}finally{H=n}})}else throw new Error("Unknown extension type "+t)}var qm=new Array(4096);function Jm(){let e=kt[H++];if(e>=160&&e<192){if(e=e-160,ti>=H)return Gi.slice(H-yr,(H+=e)-yr);if(!(ti==0&&_r<180))return Ph(e)}else return H--,Zm(Ke());let t=(e<<5^(e>1?Zt.getUint16(H):e>0?kt[H]:0))&4095,n=qm[t],r=H,i=H+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Zt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=kt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return H=r,n.string;i-=3,r=H}for(n=[],qm[t]=n,n.bytes=e;r<i;)s=Zt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=kt[r++],n.push(s);let a=e<16?$h(e):Vm(e);return a!=null?n.string=a:n.string=Ph(e)}function Zm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const Qm=(e,t)=>{let n=Ke().map(Zm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=te[e];return i&&(i.isShared||Ki)&&((te.restoreStructures||(te.restoreStructures=[]))[e]=i),te[e]=n,n.read=Bh(n,r),n.read()};zn[0]=()=>{},zn[0].noBuffer=!0,zn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let AS={Error,TypeError,ReferenceError};zn[101]=()=>{let e=Ke();return(AS[e[0]]||Error)(e[1],{cause:e[2]})},zn[105]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Zt.getUint32(H-4);Ei||(Ei=new Map);let n=kt[H],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Ei.set(t,i);let s=Ke();return i.used?Object.assign(r,s):(i.target=s,s)},zn[112]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Zt.getUint32(H-4),n=Ei.get(t);return n.used=!0,n.target},zn[115]=()=>new Set(Ke());const tg=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let SS=typeof globalThis=="object"?globalThis:window;zn[116]=e=>{let t=e[0],n=tg[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new SS[n](Uint8Array.prototype.slice.call(e,1).buffer)},zn[120]=()=>{let e=Ke();return new RegExp(e[0],e[1])};const RS=[];zn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=H;return H+=t-e.length,ln=RS,ln=[Xm(),Xm()],ln.position0=0,ln.position1=0,ln.postBundlePosition=H,H=n,Ke()},zn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function eg(e){let t=_r,n=H,r=yr,i=ti,s=Gi,o=Ei,a=ln,c=new Uint8Array(kt.slice(0,_r)),l=te,u=te.slice(0,te.length),f=me,d=Ki,h=e();return _r=t,H=n,yr=r,ti=i,Gi=s,Ei=o,ln=a,kt=c,Ki=d,te=l,te.splice(0,te.length,...u),me=f,Zt=new DataView(kt.buffer,kt.byteOffset,kt.byteLength),h}function jh(){kt=null,Ei=null,te=null}const zh=new Array(147);for(let e=0;e<256;e++)zh[e]=+("1e"+Math.floor(45.15-e*.30103));var Mc=new na({useRecords:!1});const OS=Mc.unpack;Mc.unpackMultiple,Mc.unpack;let NS=new Float32Array(1);new Uint8Array(NS.buffer,0,4);let Uc;try{Uc=new TextEncoder}catch{}let Wh,ng;const Fc=typeof _n<"u",Bc=Fc?function(e){return _n.allocUnsafeSlow(e)}:Uint8Array,rg=Fc?_n:Uint8Array,ig=Fc?4294967296:2144337920;let Z,ia,ge,Y=0,On,Me=null,IS;const CS=21760,LS=/[\u0080-\uFFFF]/,oo=Symbol("record-id");class MS extends na{constructor(t){super(t),this.offset=0;let n,r,i,s,o=rg.prototype.utf8Write?function(O,E){return Z.utf8Write(O,E,Z.byteLength-E)}:Uc&&Uc.encodeInto?function(O,E){return Uc.encodeInto(O,Z.subarray(E)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,m=u+f+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],b=0,k=0;this.pack=this.encode=function(O,E){if(Z||(Z=new Bc(8192),ge=Z.dataView||(Z.dataView=new DataView(Z.buffer,0,8192)),Y=0),On=Z.length-10,On-Y<2048?(Z=new Bc(Z.length),ge=Z.dataView||(Z.dataView=new DataView(Z.buffer,0,Z.length)),On=Z.length-10,Y=0):Y=Y+7&2147483640,n=Y,E&jS&&(Y+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof O!="string"?(Me=[],Me.size=1/0):Me=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let P=i.sharedLength||0;if(P>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let F=0;F<P;F++){let st=i[F];if(!st)continue;let et,ot=i.transitions;for(let W=0,D=st.length;W<D;W++){let yt=st[W];et=ot[yt],et||(et=ot[yt]=Object.create(null)),ot=et}ot[oo]=F+64}this.lastNamedStructuresLength=P}c||(i.nextId=P+64)}r&&(r=!1);let C;try{a.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?L(O):A(O);let P=Me;if(Me&&ag(n,A,0),s&&s.idsToInsert){let F=s.idsToInsert.sort((W,D)=>W.offset>D.offset?1:-1),st=F.length,et=-1;for(;P&&st>0;){let W=F[--st].offset+n;W<P.stringsPosition+n&&et===-1&&(et=0),W>P.position+n?et>=0&&(et+=6):(et>=0&&(ge.setUint32(P.position+n,ge.getUint32(P.position+n)+et),et=-1),P=P.previous,st++)}et>=0&&P&&ge.setUint32(P.position+n,ge.getUint32(P.position+n)+et),Y+=F.length*6,Y>On&&N(Y),a.offset=Y;let ot=FS(Z.subarray(n,Y),F);return s=null,ot}return a.offset=Y,E&$S?(Z.start=n,Z.end=Y,Z):Z.subarray(n,Y)}catch(P){throw C=P,P}finally{if(i&&(x(),r&&a.saveStructures)){let P=i.sharedLength||0,F=Z.subarray(n,Y),st=BS(i,a);if(!C)return a.saveStructures(st,st.isCompatible)===!1?a.pack(O,E):(a.lastNamedStructuresLength=P,Z.length>1073741824&&(Z=null),F)}Z.length>1073741824&&(Z=null),E&DS&&(Y=n)}};const x=()=>{k<10&&k++;let O=i.sharedLength||0;if(i.length>O&&!c&&(i.length=O),b>1e4)i.transitions=null,k=0,b=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let E=0,C=p.length;E<C;E++)p[E][oo]=0;p=[]}},T=O=>{var E=O.length;E<16?Z[Y++]=144|E:E<65536?(Z[Y++]=220,Z[Y++]=E>>8,Z[Y++]=E&255):(Z[Y++]=221,ge.setUint32(Y,E),Y+=4);for(let C=0;C<E;C++)A(O[C])},A=O=>{Y>On&&(Z=N(Y));var E=typeof O,C;if(E==="string"){let P=O.length;if(Me&&P>=4&&P<4096){if((Me.size+=P)>CS){let ot,W=(Me[0]?Me[0].length*3+Me[1].length:0)+10;Y+W>On&&(Z=N(Y+W));let D;Me.position?(D=Me,Z[Y]=200,Y+=3,Z[Y++]=98,ot=Y-n,Y+=4,ag(n,A,0),ge.setUint16(ot+n-3,Y-n-ot)):(Z[Y++]=214,Z[Y++]=98,ot=Y-n,Y+=4),Me=["",""],Me.previous=D,Me.size=0,Me.position=ot}let et=LS.test(O);Me[et?0:1]+=O,Z[Y++]=193,A(et?-P:P);return}let F;P<32?F=1:P<256?F=2:P<65536?F=3:F=5;let st=P*3;if(Y+st>On&&(Z=N(Y+st)),P<64||!o){let et,ot,W,D=Y+F;for(et=0;et<P;et++)ot=O.charCodeAt(et),ot<128?Z[D++]=ot:ot<2048?(Z[D++]=ot>>6|192,Z[D++]=ot&63|128):(ot&64512)===55296&&((W=O.charCodeAt(et+1))&64512)===56320?(ot=65536+((ot&1023)<<10)+(W&1023),et++,Z[D++]=ot>>18|240,Z[D++]=ot>>12&63|128,Z[D++]=ot>>6&63|128,Z[D++]=ot&63|128):(Z[D++]=ot>>12|224,Z[D++]=ot>>6&63|128,Z[D++]=ot&63|128);C=D-Y-F}else C=o(O,Y+F);C<32?Z[Y++]=160|C:C<256?(F<2&&Z.copyWithin(Y+2,Y+1,Y+1+C),Z[Y++]=217,Z[Y++]=C):C<65536?(F<3&&Z.copyWithin(Y+3,Y+2,Y+2+C),Z[Y++]=218,Z[Y++]=C>>8,Z[Y++]=C&255):(F<5&&Z.copyWithin(Y+5,Y+3,Y+3+C),Z[Y++]=219,ge.setUint32(Y,C),Y+=4),Y+=C}else if(E==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?Z[Y++]=O:O<256?(Z[Y++]=204,Z[Y++]=O):O<65536?(Z[Y++]=205,Z[Y++]=O>>8,Z[Y++]=O&255):(Z[Y++]=206,ge.setUint32(Y,O),Y+=4);else if(O>>0===O)O>=-32?Z[Y++]=256+O:O>=-128?(Z[Y++]=208,Z[Y++]=O+256):O>=-32768?(Z[Y++]=209,ge.setInt16(Y,O),Y+=2):(Z[Y++]=210,ge.setInt32(Y,O),Y+=4);else{let P;if((P=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){Z[Y++]=202,ge.setFloat32(Y,O);let F;if(P<4||(F=O*zh[(Z[Y]&127)<<1|Z[Y+1]>>7])>>0===F){Y+=4;return}else Y--}Z[Y++]=203,ge.setFloat64(Y,O),Y+=8}else if(E==="object"||E==="function")if(!O)Z[Y++]=192;else{if(s){let F=s.get(O);if(F){if(!F.id){let st=s.idsToInsert||(s.idsToInsert=[]);F.id=st.push(F)}Z[Y++]=214,Z[Y++]=112,ge.setUint32(Y,F.id),Y+=4;return}else s.set(O,{offset:Y-n})}let P=O.constructor;if(P===Object)$(O);else if(P===Array)T(O);else if(P===Map)if(this.mapAsEmptyObject)Z[Y++]=128;else{C=O.size,C<16?Z[Y++]=128|C:C<65536?(Z[Y++]=222,Z[Y++]=C>>8,Z[Y++]=C&255):(Z[Y++]=223,ge.setUint32(Y,C),Y+=4);for(let[F,st]of O)A(F),A(st)}else{for(let F=0,st=Wh.length;F<st;F++){let et=ng[F];if(O instanceof et){let ot=Wh[F];if(ot.write){ot.type&&(Z[Y++]=212,Z[Y++]=ot.type,Z[Y++]=0);let at=ot.write.call(this,O);at===O?Array.isArray(O)?T(O):$(O):A(at);return}let W=Z,D=ge,yt=Y;Z=null;let X;try{X=ot.pack.call(this,O,at=>(Z=W,W=null,Y+=at,Y>On&&N(Y),{target:Z,targetView:ge,position:Y-at}),A)}finally{W&&(Z=W,ge=D,Y=yt,On=Z.length-10)}X&&(X.length+Y>On&&N(X.length+Y),Y=US(X,Z,Y,ot.type));return}}if(Array.isArray(O))T(O);else{if(O.toJSON){const F=O.toJSON();if(F!==O)return A(F)}if(E==="function")return A(this.writeFunction&&this.writeFunction(O));$(O)}}}else if(E==="boolean")Z[Y++]=O?195:194;else if(E==="bigint"){if(O<BigInt(1)<<BigInt(63)&&O>=-(BigInt(1)<<BigInt(63)))Z[Y++]=211,ge.setBigInt64(Y,O);else if(O<BigInt(1)<<BigInt(64)&&O>0)Z[Y++]=207,ge.setBigUint64(Y,O);else if(this.largeBigIntToFloat)Z[Y++]=203,ge.setFloat64(Y,Number(O));else{if(this.largeBigIntToString)return A(O.toString());if(this.useBigIntExtension&&O<BigInt(2)**BigInt(1023)&&O>-(BigInt(2)**BigInt(1023))){Z[Y++]=199,Y++,Z[Y++]=66;let P=[],F;do{let st=O&BigInt(255);F=(st&BigInt(128))===(O<BigInt(0)?BigInt(128):BigInt(0)),P.push(st),O>>=BigInt(8)}while(!((O===BigInt(0)||O===BigInt(-1))&&F));Z[Y-2]=P.length;for(let st=P.length;st>0;)Z[Y++]=Number(P[--st]);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Y+=8}else if(E==="undefined")this.encodeUndefinedAsNil?Z[Y++]=192:(Z[Y++]=212,Z[Y++]=0,Z[Y++]=0);else throw new Error("Unknown type: "+E)},M=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let E;if(this.skipValues){E=[];for(let F in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(F))&&!this.skipValues.includes(O[F])&&E.push(F)}else E=Object.keys(O);let C=E.length;C<16?Z[Y++]=128|C:C<65536?(Z[Y++]=222,Z[Y++]=C>>8,Z[Y++]=C&255):(Z[Y++]=223,ge.setUint32(Y,C),Y+=4);let P;if(this.coercibleKeyAsNumber)for(let F=0;F<C;F++){P=E[F];let st=Number(P);A(isNaN(st)?P:st),A(O[P])}else for(let F=0;F<C;F++)A(P=E[F]),A(O[P])}:O=>{Z[Y++]=222;let E=Y-n;Y+=2;let C=0;for(let P in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(P))&&(A(P),A(O[P]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');Z[E+++n]=C>>8,Z[E+n]=C&255},S=this.useRecords===!1?M:t.progressiveRecords&&!d?O=>{let E,C=i.transitions||(i.transitions=Object.create(null)),P=Y++-n,F;for(let st in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(st)){if(E=C[st],E)C=E;else{let et=Object.keys(O),ot=C;C=i.transitions;let W=0;for(let D=0,yt=et.length;D<yt;D++){let X=et[D];E=C[X],E||(E=C[X]=Object.create(null),W++),C=E}P+n+1==Y?(Y--,z(C,et,W)):J(C,et,P,W),F=!0,C=ot[st]}A(O[st])}if(!F){let st=C[oo];st?Z[P+n]=st:J(C,Object.keys(O),P,0)}}:O=>{let E,C=i.transitions||(i.transitions=Object.create(null)),P=0;for(let st in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(st))&&(E=C[st],E||(E=C[st]=Object.create(null),P++),C=E);let F=C[oo];F?F>=96&&d?(Z[Y++]=((F-=96)&31)+96,Z[Y++]=F>>5):Z[Y++]=F:z(C,C.__keys__||Object.keys(O),P);for(let st in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(st))&&A(O[st])},I=typeof this.useRecords=="function"&&this.useRecords,$=I?O=>{I(O)?S(O):M(O)}:S,N=O=>{let E;if(O>16777216){if(O-n>ig)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(ig,Math.round(Math.max((O-n)*(O>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(O-n<<2,Z.length-1)>>12)+1<<12;let C=new Bc(E);return ge=C.dataView||(C.dataView=new DataView(C.buffer,0,E)),O=Math.min(O,Z.length),Z.copy?Z.copy(C,0,n,O):C.set(Z.slice(n,O)),Y-=n,n=0,On=C.length-10,Z=C},z=(O,E,C)=>{let P=i.nextId;P||(P=64),P<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(P=i.nextOwnId,P<m||(P=h),i.nextOwnId=P+1):(P>=m&&(P=h),i.nextId=P+1);let F=E.highByte=P>=96&&d?P-96>>5:-1;O[oo]=P,O.__keys__=E,i[P-64]=E,P<h?(E.isShared=!0,i.sharedLength=P-63,r=!0,F>=0?(Z[Y++]=(P&31)+96,Z[Y++]=F):Z[Y++]=P):(F>=0?(Z[Y++]=213,Z[Y++]=114,Z[Y++]=(P&31)+96,Z[Y++]=F):(Z[Y++]=212,Z[Y++]=114,Z[Y++]=P),C&&(b+=k*C),p.length>=f&&(p.shift()[oo]=0),p.push(O),A(E))},J=(O,E,C,P)=>{let F=Z,st=Y,et=On,ot=n;Z=ia,Y=0,n=0,Z||(ia=Z=new Bc(8192)),On=Z.length-10,z(O,E,P),ia=Z;let W=Y;if(Z=F,Y=st,On=et,n=ot,W>1){let D=Y+W-1;D>On&&N(D);let yt=C+n;Z.copyWithin(yt+W,yt+1,Y),Z.set(ia.slice(0,W),yt),Y=D}else Z[C+n]=ia[0]},L=O=>{let E=IS(O,Z,n,Y,i,N,(C,P,F)=>{if(F)return r=!0;Y=P;let st=Z;return A(C),x(),st!==Z?{position:Y,targetView:ge,target:Z}:Y},this);if(E===0)return $(O);Y=E}}useBuffer(t){Z=t,Z.dataView||(Z.dataView=new DataView(Z.buffer,Z.byteOffset,Z.byteLength)),Y=0}set position(t){Y=t}get position(){return Y}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ng=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,$m],Wh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?sg(e,16,t):og(Fc?_n.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==rg&&this.moreTypes?sg(e,tg.indexOf(n.name),t):og(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function sg(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function og(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function US(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function FS(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function ag(e,t,n){if(Me.length>0){ge.setUint32(Me.position+e,Y+n-Me.position-e),Me.stringsPosition=Y-e;let r=Me;Me=null,t(r[0]),t(r[1])}}function BS(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let cg=new MS({useRecords:!1});const PS=cg.pack;cg.pack;const $S=512,DS=1024,jS=2048;function Se(){return null}function ao(e,t,n={}){if(!y(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];y(c)&&(a=c(a));const l=t[o];y(l)&&(o=l),a!==null&&r.push(o,a)}return r}function sa(e,t,n={}){if(y(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];y(a)&&(s=a);const c=n[s];y(c)&&(o=c(o)),r[s]=o}return r}catch(r){de(tt,"","binary",r.message)}}function zS(e){try{const t=Sr(e);return PS(t)}catch(t){de(tt,"","binary",t.message)}}function WS(e){try{return OS(e)}catch(t){de(tt,"","binary",t.message)}}function lg(){return{id:ze()}}var Pc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e[e.shootx=39]="shootx",e[e.shooty=40]="shooty",e))(Pc||{});function $c(e){return y(e==null?void 0:e.id)?ao(e,Pc,{category:Se,kinddata:Se,stopped:Se,removed:Se,bucket:Se}):ao(e,Pc,{id:Se,x:Se,y:Se,lx:Se,ly:Se,code:Se,category:Se,kinddata:Se,stopped:Se,removed:Se,bucket:Se})}function Dc(e){return sa(e,Pc)}function He(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function oa(e,t){if(!y(e)||!Sn(t))return;const{color:n,bg:r}=Im(t);y(n)&&(e.color=n),y(r)&&(e.bg=r)}function ug(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function hg(e){const t=Math.floor(e.length/Nc);if(t*Nc!==e.length)return;const n=ug(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function GS(e,t){return e&1<<t?255:0}function fg(e){const t=Math.floor(e.length/Mh);if(t*Mh!==e.length)return;const n=Math.ceil(t/Ic),r=ji*Ic,i=ug(r,zi*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*zi+a,u=e[c];for(let f=0;f<ji;++f){const d=s*ji+f;i.bits[d+l*r]=GS(u,7-f)}++a,a===zi&&(a=0,++s,s===Ic&&(s=0,++o))}return i}const KS=Qa("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),HS=Qa("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var dg=typeof js=="object"&&js&&js.Object===Object&&js,YS=typeof self=="object"&&self&&self.Object===Object&&self,ei=dg||YS||Function("return this")(),br=ei.Symbol,pg=Object.prototype,VS=pg.hasOwnProperty,XS=pg.toString,aa=br?br.toStringTag:void 0;function qS(e){var t=VS.call(e,aa),n=e[aa];try{e[aa]=void 0;var r=!0}catch{}var i=XS.call(e);return r&&(t?e[aa]=n:delete e[aa]),i}var JS=Object.prototype,ZS=JS.toString;function QS(e){return ZS.call(e)}var tR="[object Null]",eR="[object Undefined]",mg=br?br.toStringTag:void 0;function Hi(e){return e==null?e===void 0?eR:tR:mg&&mg in Object(e)?qS(e):QS(e)}function Mr(e){return e!=null&&typeof e=="object"}var nR="[object Symbol]";function jc(e){return typeof e=="symbol"||Mr(e)&&Hi(e)==nR}function zc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var ie=Array.isArray,rR=1/0,gg=br?br.prototype:void 0,_g=gg?gg.toString:void 0;function yg(e){if(typeof e=="string")return e;if(ie(e))return zc(e,yg)+"";if(jc(e))return _g?_g.call(e):"";var t=e+"";return t=="0"&&1/e==-rR?"-0":t}var iR=/\s/;function sR(e){for(var t=e.length;t--&&iR.test(e.charAt(t)););return t}var oR=/^\s+/;function aR(e){return e&&e.slice(0,sR(e)+1).replace(oR,"")}function kr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var bg=NaN,cR=/^[-+]0x[0-9a-f]+$/i,lR=/^0b[01]+$/i,uR=/^0o[0-7]+$/i,hR=parseInt;function fR(e){if(typeof e=="number")return e;if(jc(e))return bg;if(kr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=kr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=aR(e);var n=lR.test(e);return n||uR.test(e)?hR(e.slice(2),n?2:8):cR.test(e)?bg:+e}var kg=1/0,dR=17976931348623157e292;function pR(e){if(!e)return e===0?e:0;if(e=fR(e),e===kg||e===-kg){var t=e<0?-1:1;return t*dR}return e===e?e:0}function Wc(e){var t=pR(e),n=t%1;return t===t?n?t-n:t:0}function co(e){return e}var mR="[object AsyncFunction]",gR="[object Function]",_R="[object GeneratorFunction]",yR="[object Proxy]";function xi(e){if(!kr(e))return!1;var t=Hi(e);return t==gR||t==_R||t==mR||t==yR}var Gh=ei["__core-js_shared__"],wg=function(){var e=/[^.]+$/.exec(Gh&&Gh.keys&&Gh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function bR(e){return!!wg&&wg in e}var kR=Function.prototype,wR=kR.toString;function _s(e){if(e!=null){try{return wR.call(e)}catch{}try{return e+""}catch{}}return""}var ER=/[\\^$.*+?()[\]{}|]/g,xR=/^\[object .+?Constructor\]$/,vR=Function.prototype,TR=Object.prototype,AR=vR.toString,SR=TR.hasOwnProperty,RR=RegExp("^"+AR.call(SR).replace(ER,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function OR(e){if(!kr(e)||bR(e))return!1;var t=xi(e)?RR:xR;return t.test(_s(e))}function NR(e,t){return e==null?void 0:e[t]}function ys(e,t){var n=NR(e,t);return OR(n)?n:void 0}var Kh=ys(ei,"WeakMap"),Eg=Object.create,IR=function(){function e(){}return function(t){if(!kr(t))return{};if(Eg)return Eg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function CR(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function tn(){}function LR(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var MR=800,UR=16,FR=Date.now;function BR(e){var t=0,n=0;return function(){var r=FR(),i=UR-(r-n);if(n=r,i>0){if(++t>=MR)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function PR(e){return function(){return e}}var Gc=function(){try{var e=ys(Object,"defineProperty");return e({},"",{}),e}catch{}}(),$R=Gc?function(e,t){return Gc(e,"toString",{configurable:!0,enumerable:!1,value:PR(t),writable:!0})}:co,DR=BR($R);function xg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function vg(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function jR(e){return e!==e}function zR(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function Hh(e,t,n){return t===t?zR(e,t,n):vg(e,jR,n)}function Tg(e,t){var n=e==null?0:e.length;return!!n&&Hh(e,t,0)>-1}var WR=9007199254740991,GR=/^(?:0|[1-9]\d*)$/;function Kc(e,t){var n=typeof e;return t=t??WR,!!t&&(n=="number"||n!="symbol"&&GR.test(e))&&e>-1&&e%1==0&&e<t}function Yh(e,t,n){t=="__proto__"&&Gc?Gc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ca(e,t){return e===t||e!==e&&t!==t}var KR=Object.prototype,HR=KR.hasOwnProperty;function Hc(e,t,n){var r=e[t];(!(HR.call(e,t)&&ca(r,n))||n===void 0&&!(t in e))&&Yh(e,t,n)}function Vh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Yh(n,a,c):Hc(n,a,c)}return n}var Ag=Math.max;function YR(e,t,n){return t=Ag(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Ag(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),CR(e,this,a)}}function Xh(e,t){return DR(YR(e,t,co),e+"")}var VR=9007199254740991;function qh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=VR}function ni(e){return e!=null&&qh(e.length)&&!xi(e)}function Sg(e,t,n){if(!kr(n))return!1;var r=typeof t;return(r=="number"?ni(n)&&Kc(t,n.length):r=="string"&&t in n)?ca(n[t],e):!1}function XR(e){return Xh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Sg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var qR=Object.prototype;function la(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||qR;return e===n}function JR(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var ZR="[object Arguments]";function Rg(e){return Mr(e)&&Hi(e)==ZR}var Og=Object.prototype,QR=Og.hasOwnProperty,tO=Og.propertyIsEnumerable,Yc=Rg(function(){return arguments}())?Rg:function(e){return Mr(e)&&QR.call(e,"callee")&&!tO.call(e,"callee")};function eO(){return!1}var Ng=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ig=Ng&&typeof module=="object"&&module&&!module.nodeType&&module,nO=Ig&&Ig.exports===Ng,Cg=nO?ei.Buffer:void 0,rO=Cg?Cg.isBuffer:void 0,ua=rO||eO,iO="[object Arguments]",sO="[object Array]",oO="[object Boolean]",aO="[object Date]",cO="[object Error]",lO="[object Function]",uO="[object Map]",hO="[object Number]",fO="[object Object]",dO="[object RegExp]",pO="[object Set]",mO="[object String]",gO="[object WeakMap]",_O="[object ArrayBuffer]",yO="[object DataView]",bO="[object Float32Array]",kO="[object Float64Array]",wO="[object Int8Array]",EO="[object Int16Array]",xO="[object Int32Array]",vO="[object Uint8Array]",TO="[object Uint8ClampedArray]",AO="[object Uint16Array]",SO="[object Uint32Array]",xe={};xe[bO]=xe[kO]=xe[wO]=xe[EO]=xe[xO]=xe[vO]=xe[TO]=xe[AO]=xe[SO]=!0,xe[iO]=xe[sO]=xe[_O]=xe[oO]=xe[yO]=xe[aO]=xe[cO]=xe[lO]=xe[uO]=xe[hO]=xe[fO]=xe[dO]=xe[pO]=xe[mO]=xe[gO]=!1;function RO(e){return Mr(e)&&qh(e.length)&&!!xe[Hi(e)]}function Vc(e){return function(t){return e(t)}}var Lg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ha=Lg&&typeof module=="object"&&module&&!module.nodeType&&module,OO=ha&&ha.exports===Lg,Jh=OO&&dg.process,Yi=function(){try{var e=ha&&ha.require&&ha.require("util").types;return e||Jh&&Jh.binding&&Jh.binding("util")}catch{}}(),Mg=Yi&&Yi.isTypedArray,Zh=Mg?Vc(Mg):RO,NO=Object.prototype,IO=NO.hasOwnProperty;function Ug(e,t){var n=ie(e),r=!n&&Yc(e),i=!n&&!r&&ua(e),s=!n&&!r&&!i&&Zh(e),o=n||r||i||s,a=o?JR(e.length,String):[],c=a.length;for(var l in e)(t||IO.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Kc(l,c)))&&a.push(l);return a}function Fg(e,t){return function(n){return e(t(n))}}var CO=Fg(Object.keys,Object),LO=Object.prototype,MO=LO.hasOwnProperty;function Bg(e){if(!la(e))return CO(e);var t=[];for(var n in Object(e))MO.call(e,n)&&n!="constructor"&&t.push(n);return t}function wr(e){return ni(e)?Ug(e):Bg(e)}var UO=Object.prototype,FO=UO.hasOwnProperty,Wn=XR(function(e,t){if(la(t)||ni(t)){Vh(t,wr(t),e);return}for(var n in t)FO.call(t,n)&&Hc(e,n,t[n])});function BO(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var PO=Object.prototype,$O=PO.hasOwnProperty;function DO(e){if(!kr(e))return BO(e);var t=la(e),n=[];for(var r in e)r=="constructor"&&(t||!$O.call(e,r))||n.push(r);return n}function Pg(e){return ni(e)?Ug(e,!0):DO(e)}var jO=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zO=/^\w*$/;function Qh(e,t){if(ie(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||jc(e)?!0:zO.test(e)||!jO.test(e)||t!=null&&e in Object(t)}var fa=ys(Object,"create");function WO(){this.__data__=fa?fa(null):{},this.size=0}function GO(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var KO="__lodash_hash_undefined__",HO=Object.prototype,YO=HO.hasOwnProperty;function VO(e){var t=this.__data__;if(fa){var n=t[e];return n===KO?void 0:n}return YO.call(t,e)?t[e]:void 0}var XO=Object.prototype,qO=XO.hasOwnProperty;function JO(e){var t=this.__data__;return fa?t[e]!==void 0:qO.call(t,e)}var ZO="__lodash_hash_undefined__";function QO(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=fa&&t===void 0?ZO:t,this}function bs(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}bs.prototype.clear=WO,bs.prototype.delete=GO,bs.prototype.get=VO,bs.prototype.has=JO,bs.prototype.set=QO;function tN(){this.__data__=[],this.size=0}function Xc(e,t){for(var n=e.length;n--;)if(ca(e[n][0],t))return n;return-1}var eN=Array.prototype,nN=eN.splice;function rN(e){var t=this.__data__,n=Xc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():nN.call(t,n,1),--this.size,!0}function iN(e){var t=this.__data__,n=Xc(t,e);return n<0?void 0:t[n][1]}function sN(e){return Xc(this.__data__,e)>-1}function oN(e,t){var n=this.__data__,r=Xc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function vi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vi.prototype.clear=tN,vi.prototype.delete=rN,vi.prototype.get=iN,vi.prototype.has=sN,vi.prototype.set=oN;var da=ys(ei,"Map");function aN(){this.size=0,this.__data__={hash:new bs,map:new(da||vi),string:new bs}}function cN(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function qc(e,t){var n=e.__data__;return cN(t)?n[typeof t=="string"?"string":"hash"]:n.map}function lN(e){var t=qc(this,e).delete(e);return this.size-=t?1:0,t}function uN(e){return qc(this,e).get(e)}function hN(e){return qc(this,e).has(e)}function fN(e,t){var n=qc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Ti(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ti.prototype.clear=aN,Ti.prototype.delete=lN,Ti.prototype.get=uN,Ti.prototype.has=hN,Ti.prototype.set=fN;var dN="Expected a function";function tf(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(dN);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(tf.Cache||Ti),n}tf.Cache=Ti;var pN=500;function mN(e){var t=tf(e,function(r){return n.size===pN&&n.clear(),r}),n=t.cache;return t}var gN=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_N=/\\(\\)?/g,yN=mN(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(gN,function(n,r,i,s){t.push(i?s.replace(_N,"$1"):r||n)}),t});function $g(e){return e==null?"":yg(e)}function Jc(e,t){return ie(e)?e:Qh(e,t)?[e]:yN($g(e))}var bN=1/0;function pa(e){if(typeof e=="string"||jc(e))return e;var t=e+"";return t=="0"&&1/e==-bN?"-0":t}function ef(e,t){t=Jc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[pa(t[n++])];return n&&n==r?e:void 0}function kN(e,t,n){var r=e==null?void 0:ef(e,t);return r===void 0?n:r}function nf(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Dg=br?br.isConcatSpreadable:void 0;function wN(e){return ie(e)||Yc(e)||!!(Dg&&e&&e[Dg])}function rf(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=wN),i||(i=[]);++s<o;){var a=e[s];n(a)?nf(i,a):r||(i[i.length]=a)}return i}function or(e){var t=e==null?0:e.length;return t?rf(e):[]}var jg=Fg(Object.getPrototypeOf,Object);function sf(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function EN(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:sf(e,t,n)}var xN="\\ud800-\\udfff",vN="\\u0300-\\u036f",TN="\\ufe20-\\ufe2f",AN="\\u20d0-\\u20ff",SN=vN+TN+AN,RN="\\ufe0e\\ufe0f",ON="\\u200d",NN=RegExp("["+ON+xN+SN+RN+"]");function zg(e){return NN.test(e)}function IN(e){return e.split("")}var Wg="\\ud800-\\udfff",CN="\\u0300-\\u036f",LN="\\ufe20-\\ufe2f",MN="\\u20d0-\\u20ff",UN=CN+LN+MN,FN="\\ufe0e\\ufe0f",BN="["+Wg+"]",of="["+UN+"]",af="\\ud83c[\\udffb-\\udfff]",PN="(?:"+of+"|"+af+")",Gg="[^"+Wg+"]",Kg="(?:\\ud83c[\\udde6-\\uddff]){2}",Hg="[\\ud800-\\udbff][\\udc00-\\udfff]",$N="\\u200d",Yg=PN+"?",Vg="["+FN+"]?",DN="(?:"+$N+"(?:"+[Gg,Kg,Hg].join("|")+")"+Vg+Yg+")*",jN=Vg+Yg+DN,zN="(?:"+[Gg+of+"?",of,Kg,Hg,BN].join("|")+")",WN=RegExp(af+"(?="+af+")|"+zN+jN,"g");function GN(e){return e.match(WN)||[]}function KN(e){return zg(e)?GN(e):IN(e)}function HN(e){return function(t){t=$g(t);var n=zg(t)?KN(t):void 0,r=n?n[0]:t.charAt(0),i=n?EN(n,1).join(""):t.slice(1);return r[e]()+i}}var Xg=HN("toUpperCase");function YN(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function VN(){this.__data__=new vi,this.size=0}function XN(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function qN(e){return this.__data__.get(e)}function JN(e){return this.__data__.has(e)}var ZN=200;function QN(e,t){var n=this.__data__;if(n instanceof vi){var r=n.__data__;if(!da||r.length<ZN-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ti(r)}return n.set(e,t),this.size=n.size,this}function ri(e){var t=this.__data__=new vi(e);this.size=t.size}ri.prototype.clear=VN,ri.prototype.delete=XN,ri.prototype.get=qN,ri.prototype.has=JN,ri.prototype.set=QN;function tI(e,t){return e&&Vh(t,wr(t),e)}var qg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Jg=qg&&typeof module=="object"&&module&&!module.nodeType&&module,eI=Jg&&Jg.exports===qg,Zg=eI?ei.Buffer:void 0,Qg=Zg?Zg.allocUnsafe:void 0;function nI(e,t){var n=e.length,r=Qg?Qg(n):new e.constructor(n);return e.copy(r),r}function cf(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function t_(){return[]}var rI=Object.prototype,iI=rI.propertyIsEnumerable,e_=Object.getOwnPropertySymbols,lf=e_?function(e){return e==null?[]:(e=Object(e),cf(e_(e),function(t){return iI.call(e,t)}))}:t_;function sI(e,t){return Vh(e,lf(e),t)}var oI=Object.getOwnPropertySymbols,aI=oI?function(e){for(var t=[];e;)nf(t,lf(e)),e=jg(e);return t}:t_;function n_(e,t,n){var r=t(e);return ie(e)?r:nf(r,n(e))}function uf(e){return n_(e,wr,lf)}function cI(e){return n_(e,Pg,aI)}var hf=ys(ei,"DataView"),ff=ys(ei,"Promise"),lo=ys(ei,"Set"),r_="[object Map]",lI="[object Object]",i_="[object Promise]",s_="[object Set]",o_="[object WeakMap]",a_="[object DataView]",uI=_s(hf),hI=_s(da),fI=_s(ff),dI=_s(lo),pI=_s(Kh),Er=Hi;(hf&&Er(new hf(new ArrayBuffer(1)))!=a_||da&&Er(new da)!=r_||ff&&Er(ff.resolve())!=i_||lo&&Er(new lo)!=s_||Kh&&Er(new Kh)!=o_)&&(Er=function(e){var t=Hi(e),n=t==lI?e.constructor:void 0,r=n?_s(n):"";if(r)switch(r){case uI:return a_;case hI:return r_;case fI:return i_;case dI:return s_;case pI:return o_}return t});var mI=Object.prototype,gI=mI.hasOwnProperty;function _I(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&gI.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Zc=ei.Uint8Array;function yI(e){var t=new e.constructor(e.byteLength);return new Zc(t).set(new Zc(e)),t}function bI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var kI=/\w*$/;function wI(e){var t=new e.constructor(e.source,kI.exec(e));return t.lastIndex=e.lastIndex,t}var c_=br?br.prototype:void 0,l_=c_?c_.valueOf:void 0;function EI(e){return l_?Object(l_.call(e)):{}}function xI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var vI="[object Boolean]",TI="[object Date]",AI="[object Map]",SI="[object Number]",RI="[object RegExp]",OI="[object Set]",NI="[object String]",II="[object Symbol]",CI="[object ArrayBuffer]",LI="[object DataView]",MI="[object Float32Array]",UI="[object Float64Array]",FI="[object Int8Array]",BI="[object Int16Array]",PI="[object Int32Array]",$I="[object Uint8Array]",DI="[object Uint8ClampedArray]",jI="[object Uint16Array]",zI="[object Uint32Array]";function WI(e,t,n){var r=e.constructor;switch(t){case CI:return yI(e);case vI:case TI:return new r(+e);case LI:return bI(e);case MI:case UI:case FI:case BI:case PI:case $I:case DI:case jI:case zI:return xI(e);case AI:return new r;case SI:case NI:return new r(e);case RI:return wI(e);case OI:return new r;case II:return EI(e)}}function GI(e){return typeof e.constructor=="function"&&!la(e)?IR(jg(e)):{}}var KI="[object Map]";function HI(e){return Mr(e)&&Er(e)==KI}var u_=Yi&&Yi.isMap,YI=u_?Vc(u_):HI,VI="[object Set]";function XI(e){return Mr(e)&&Er(e)==VI}var h_=Yi&&Yi.isSet,qI=h_?Vc(h_):XI,f_="[object Arguments]",JI="[object Array]",ZI="[object Boolean]",QI="[object Date]",tC="[object Error]",d_="[object Function]",eC="[object GeneratorFunction]",nC="[object Map]",rC="[object Number]",p_="[object Object]",iC="[object RegExp]",sC="[object Set]",oC="[object String]",aC="[object Symbol]",cC="[object WeakMap]",lC="[object ArrayBuffer]",uC="[object DataView]",hC="[object Float32Array]",fC="[object Float64Array]",dC="[object Int8Array]",pC="[object Int16Array]",mC="[object Int32Array]",gC="[object Uint8Array]",_C="[object Uint8ClampedArray]",yC="[object Uint16Array]",bC="[object Uint32Array]",_e={};_e[f_]=_e[JI]=_e[lC]=_e[uC]=_e[ZI]=_e[QI]=_e[hC]=_e[fC]=_e[dC]=_e[pC]=_e[mC]=_e[nC]=_e[rC]=_e[p_]=_e[iC]=_e[sC]=_e[oC]=_e[aC]=_e[gC]=_e[_C]=_e[yC]=_e[bC]=!0,_e[tC]=_e[d_]=_e[cC]=!1;function Qc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!kr(e))return e;var a=ie(e);if(a)return o=_I(e),LR(e,o);var c=Er(e),l=c==d_||c==eC;if(ua(e))return nI(e);if(c==p_||c==f_||l&&!i)return o=l?{}:GI(e),sI(e,tI(o,e));if(!_e[c])return i?e:{};o=WI(e,c),s||(s=new ri);var u=s.get(e);if(u)return u;s.set(e,o),qI(e)?e.forEach(function(h){o.add(Qc(h,t,n,h,e,s))}):YI(e)&&e.forEach(function(h,m){o.set(m,Qc(h,t,n,m,e,s))});var f=uf,d=a?void 0:f(e);return xg(d||e,function(h,m){d&&(m=h,h=e[m]),Hc(o,m,Qc(h,t,n,m,e,s))}),o}var kC=4;function bn(e){return Qc(e,kC)}function ma(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var wC="__lodash_hash_undefined__";function EC(e){return this.__data__.set(e,wC),this}function xC(e){return this.__data__.has(e)}function uo(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Ti;++t<n;)this.add(e[t])}uo.prototype.add=uo.prototype.push=EC,uo.prototype.has=xC;function m_(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function df(e,t){return e.has(t)}var vC=1,TC=2;function g_(e,t,n,r,i,s){var o=n&vC,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=n&TC?new uo:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var m=e[f],p=t[f];if(r)var b=o?r(p,m,f,t,e,s):r(m,p,f,e,t,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!m_(t,function(k,x){if(!df(h,x)&&(m===k||i(m,k,n,r,s)))return h.push(x)})){d=!1;break}}else if(!(m===p||i(m,p,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function AC(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function pf(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var SC=1,RC=2,OC="[object Boolean]",NC="[object Date]",IC="[object Error]",CC="[object Map]",LC="[object Number]",MC="[object RegExp]",UC="[object Set]",FC="[object String]",BC="[object Symbol]",PC="[object ArrayBuffer]",$C="[object DataView]",__=br?br.prototype:void 0,mf=__?__.valueOf:void 0;function DC(e,t,n,r,i,s,o){switch(n){case $C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case PC:return!(e.byteLength!=t.byteLength||!s(new Zc(e),new Zc(t)));case OC:case NC:case LC:return ca(+e,+t);case IC:return e.name==t.name&&e.message==t.message;case MC:case FC:return e==t+"";case CC:var a=AC;case UC:var c=r&SC;if(a||(a=pf),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=RC,o.set(e,t);var u=g_(a(e),a(t),r,i,s,o);return o.delete(e),u;case BC:if(mf)return mf.call(e)==mf.call(t)}return!1}var jC=1,zC=Object.prototype,WC=zC.hasOwnProperty;function GC(e,t,n,r,i,s){var o=n&jC,a=uf(e),c=a.length,l=uf(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:WC.call(t,d)))return!1}var h=s.get(e),m=s.get(t);if(h&&m)return h==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var b=o;++f<c;){d=a[f];var k=e[d],x=t[d];if(r)var T=o?r(x,k,d,t,e,s):r(k,x,d,e,t,s);if(!(T===void 0?k===x||i(k,x,n,r,s):T)){p=!1;break}b||(b=d=="constructor")}if(p&&!b){var A=e.constructor,M=t.constructor;A!=M&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof M=="function"&&M instanceof M)&&(p=!1)}return s.delete(e),s.delete(t),p}var KC=1,y_="[object Arguments]",b_="[object Array]",tl="[object Object]",HC=Object.prototype,k_=HC.hasOwnProperty;function YC(e,t,n,r,i,s){var o=ie(e),a=ie(t),c=o?b_:Er(e),l=a?b_:Er(t);c=c==y_?tl:c,l=l==y_?tl:l;var u=c==tl,f=l==tl,d=c==l;if(d&&ua(e)){if(!ua(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ri),o||Zh(e)?g_(e,t,n,r,i,s):DC(e,t,c,n,r,i,s);if(!(n&KC)){var h=u&&k_.call(e,"__wrapped__"),m=f&&k_.call(t,"__wrapped__");if(h||m){var p=h?e.value():e,b=m?t.value():t;return s||(s=new ri),i(p,b,n,r,s)}}return d?(s||(s=new ri),GC(e,t,n,r,i,s)):!1}function gf(e,t,n,r,i){return e===t?!0:e==null||t==null||!Mr(e)&&!Mr(t)?e!==e&&t!==t:YC(e,t,n,r,gf,i)}var VC=1,XC=2;function qC(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ri,f;if(!(f===void 0?gf(l,c,VC|XC,r,u):f))return!1}}return!0}function w_(e){return e===e&&!kr(e)}function JC(e){for(var t=wr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,w_(i)]}return t}function E_(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function ZC(e){var t=JC(e);return t.length==1&&t[0][2]?E_(t[0][0],t[0][1]):function(n){return n===e||qC(n,e,t)}}function QC(e,t){return e!=null&&t in Object(e)}function x_(e,t,n){t=Jc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=pa(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&qh(i)&&Kc(o,i)&&(ie(e)||Yc(e)))}function tL(e,t){return e!=null&&x_(e,t,QC)}var eL=1,nL=2;function rL(e,t){return Qh(e)&&w_(t)?E_(pa(e),t):function(n){var r=kN(n,e);return r===void 0&&r===t?tL(n,e):gf(t,r,eL|nL)}}function iL(e){return function(t){return t==null?void 0:t[e]}}function sL(e){return function(t){return ef(t,e)}}function oL(e){return Qh(e)?iL(pa(e)):sL(e)}function ii(e){return typeof e=="function"?e:e==null?co:typeof e=="object"?ie(e)?rL(e[0],e[1]):ZC(e):oL(e)}function aL(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function cL(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var lL=cL();function uL(e,t){return e&&lL(e,t,wr)}function hL(e,t){return function(n,r){if(n==null)return n;if(!ni(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var ks=hL(uL);function fL(e,t,n,r){return ks(e,function(i,s,o){t(r,i,n(i),o)}),r}function dL(e,t){return function(n,r){var i=ie(n)?aL:fL,s=t?t():{};return i(n,e,ii(r),s)}}var v_=Object.prototype,pL=v_.hasOwnProperty,_f=Xh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Sg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Pg(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||ca(u,v_[l])&&!pL.call(e,l))&&(e[l]=s[l])}return e});function T_(e){return Mr(e)&&ni(e)}var mL=200;function gL(e,t,n,r){var i=-1,s=Tg,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=mL&&(s=df,o=!1,t=new uo(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var el=Xh(function(e,t){return T_(e)?gL(e,rf(t,1,T_,!0)):[]});function ho(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function kn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Wc(t),sf(e,t<0?0:t,r)):[]}function ga(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Wc(t),t=r-t,sf(e,0,t<0?0:t)):[]}function _L(e){return typeof e=="function"?e:co}function Ut(e,t){var n=ie(e)?xg:ks;return n(e,_L(t))}function yL(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function bL(e,t){var n=!0;return ks(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function Ur(e,t,n){var r=ie(e)?yL:bL;return r(e,ii(t))}function A_(e,t){var n=[];return ks(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function xr(e,t){var n=ie(e)?cf:A_;return n(e,ii(t))}function kL(e){return function(t,n,r){var i=Object(t);if(!ni(t)){var s=ii(n);t=wr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var wL=Math.max;function EL(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Wc(n);return i<0&&(i=wL(r+i,0)),vg(e,ii(t),i)}var fo=kL(EL);function Fr(e){return e&&e.length?e[0]:void 0}function xL(e,t){var n=-1,r=ni(e)?Array(e.length):[];return ks(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function St(e,t){var n=ie(e)?zc:xL;return n(e,ii(t))}function vr(e,t){return rf(St(e,t))}var vL=Object.prototype,TL=vL.hasOwnProperty,S_=dL(function(e,t,n){TL.call(e,n)?e[n].push(t):Yh(e,n,[t])}),AL=Object.prototype,SL=AL.hasOwnProperty;function RL(e,t){return e!=null&&SL.call(e,t)}function Mt(e,t){return e!=null&&x_(e,t,RL)}var OL="[object String]";function Gn(e){return typeof e=="string"||!ie(e)&&Mr(e)&&Hi(e)==OL}function NL(e,t){return zc(t,function(n){return e[n]})}function Xe(e){return e==null?[]:NL(e,wr(e))}var IL=Math.max;function Nn(e,t,n,r){e=ni(e)?e:Xe(e),n=n&&!r?Wc(n):0;var i=e.length;return n<0&&(n=IL(i+n,0)),Gn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Hh(e,t,n)>-1}function R_(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return Hh(e,t,i)}var CL="[object Map]",LL="[object Set]",ML=Object.prototype,UL=ML.hasOwnProperty;function ye(e){if(e==null)return!0;if(ni(e)&&(ie(e)||typeof e=="string"||typeof e.splice=="function"||ua(e)||Zh(e)||Yc(e)))return!e.length;var t=Er(e);if(t==CL||t==LL)return!e.size;if(la(e))return!Bg(e).length;for(var n in e)if(UL.call(e,n))return!1;return!0}var FL="[object RegExp]";function BL(e){return Mr(e)&&Hi(e)==FL}var O_=Yi&&Yi.isRegExp,Ai=O_?Vc(O_):BL;function Si(e){return e===void 0}var PL="Expected a function";function $L(e){if(typeof e!="function")throw new TypeError(PL);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function DL(e,t,n,r){if(!kr(e))return e;t=Jc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=pa(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=kr(u)?u:Kc(t[i+1])?[]:{})}Hc(a,c,l),a=a[c]}return e}function jL(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=ef(e,o);n(a,o)&&DL(s,Jc(o,e),a)}return s}function Br(e,t){if(e==null)return{};var n=zc(cI(e),function(r){return[r]});return t=ii(t),jL(e,n,function(r,i){return t(r,i[0])})}function zL(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Kn(e,t,n){var r=ie(e)?YN:zL,i=arguments.length<3;return r(e,ii(t),n,i,ks)}function nl(e,t){var n=ie(e)?cf:A_;return n(e,$L(ii(t)))}function WL(e,t){var n;return ks(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function yf(e,t,n){var r=ie(e)?m_:WL;return r(e,ii(t))}var GL=1/0,KL=lo&&1/pf(new lo([,-0]))[1]==GL?function(e){return new lo(e)}:tn,HL=200;function YL(e,t,n){var r=-1,i=Tg,s=e.length,o=!0,a=[],c=a;if(s>=HL){var l=KL(e);if(l)return pf(l);o=!1,i=df,c=new uo}else c=a;t:for(;++r<s;){var u=e[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function rl(e){return e&&e.length?YL(e):[]}function bf(e){console&&console.error&&console.error(`Error: ${e}`)}function N_(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function I_(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function C_(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function VL(e){return XL(e)?e.LABEL:e.name}function XL(e){return Gn(e.LABEL)&&e.LABEL!==""}class si{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Ut(this.definition,n=>{n.accept(t)})}}class Hn extends si{constructor(t){super([]),this.idx=1,Wn(this,Br(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class po extends si{constructor(t){super(t.definition),this.orgText="",Wn(this,Br(t,n=>n!==void 0))}}class Yn extends si{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Wn(this,Br(t,n=>n!==void 0))}}class Vn extends si{constructor(t){super(t.definition),this.idx=1,Wn(this,Br(t,n=>n!==void 0))}}class oi extends si{constructor(t){super(t.definition),this.idx=1,Wn(this,Br(t,n=>n!==void 0))}}class ai extends si{constructor(t){super(t.definition),this.idx=1,Wn(this,Br(t,n=>n!==void 0))}}class en extends si{constructor(t){super(t.definition),this.idx=1,Wn(this,Br(t,n=>n!==void 0))}}class Pr extends si{constructor(t){super(t.definition),this.idx=1,Wn(this,Br(t,n=>n!==void 0))}}class $r extends si{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Wn(this,Br(t,n=>n!==void 0))}}class Ue{constructor(t){this.idx=1,Wn(this,Br(t,n=>n!==void 0))}accept(t){t.visit(this)}}function qL(e){return St(e,il)}function il(e){function t(n){return St(n,il)}if(e instanceof Hn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Gn(e.label)&&(n.label=e.label),n}else{if(e instanceof Yn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Vn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof oi)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof ai)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:il(new Ue({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Pr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:il(new Ue({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof en)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof $r)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ue){const n={type:"Terminal",name:e.terminalType.name,label:VL(e.terminalType),idx:e.idx};Gn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ai(r)?r.source:r),n}else{if(e instanceof po)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class ws{visit(t){const n=t;switch(n.constructor){case Hn:return this.visitNonTerminal(n);case Yn:return this.visitAlternative(n);case Vn:return this.visitOption(n);case oi:return this.visitRepetitionMandatory(n);case ai:return this.visitRepetitionMandatoryWithSeparator(n);case Pr:return this.visitRepetitionWithSeparator(n);case en:return this.visitRepetition(n);case $r:return this.visitAlternation(n);case Ue:return this.visitTerminal(n);case po:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function JL(e){return e instanceof Yn||e instanceof Vn||e instanceof en||e instanceof oi||e instanceof ai||e instanceof Pr||e instanceof Ue||e instanceof po}function sl(e,t=[]){return e instanceof Vn||e instanceof en||e instanceof Pr?!0:e instanceof $r?yf(e.definition,r=>sl(r,t)):e instanceof Hn&&Nn(t,e)?!1:e instanceof si?(e instanceof Hn&&t.push(e),Ur(e.definition,r=>sl(r,t))):!1}function ZL(e){return e instanceof $r}function ci(e){if(e instanceof Hn)return"SUBRULE";if(e instanceof Vn)return"OPTION";if(e instanceof $r)return"OR";if(e instanceof oi)return"AT_LEAST_ONE";if(e instanceof ai)return"AT_LEAST_ONE_SEP";if(e instanceof Pr)return"MANY_SEP";if(e instanceof en)return"MANY";if(e instanceof Ue)return"CONSUME";throw Error("non exhaustive match")}class ol{walk(t,n=[]){Ut(t.definition,(r,i)=>{const s=kn(t.definition,i+1);if(r instanceof Hn)this.walkProdRef(r,s,n);else if(r instanceof Ue)this.walkTerminal(r,s,n);else if(r instanceof Yn)this.walkFlat(r,s,n);else if(r instanceof Vn)this.walkOption(r,s,n);else if(r instanceof oi)this.walkAtLeastOne(r,s,n);else if(r instanceof ai)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Pr)this.walkManySep(r,s,n);else if(r instanceof en)this.walkMany(r,s,n);else if(r instanceof $r)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Vn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=L_(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Vn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=L_(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Ut(t.definition,s=>{const o=new Yn({definition:[s]});this.walk(o,i)})}}function L_(e,t,n){return[new Vn({definition:[new Ue({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function _a(e){if(e instanceof Hn)return _a(e.referencedRule);if(e instanceof Ue)return e6(e);if(JL(e))return QL(e);if(ZL(e))return t6(e);throw Error("non exhaustive match")}function QL(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=sl(s),t=t.concat(_a(s)),r=r+1,i=n.length>r;return rl(t)}function t6(e){const t=St(e.definition,n=>_a(n));return rl(or(t))}function e6(e){return[e.terminalType]}const M_="_~IN~_";class n6 extends ol{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=i6(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Yn({definition:s}),a=_a(o);this.follows[i]=a}}function r6(e){const t={};return Ut(e,n=>{const r=new n6(n).startWalking();Wn(t,r)}),t}function i6(e,t){return e.name+t+M_}function Bt(e){return e.charCodeAt(0)}function kf(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ya(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function mo(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function s6(){throw Error("Internal Error - Should never get here!")}function U_(e){return e.type==="Character"}const al=[];for(let e=Bt("0");e<=Bt("9");e++)al.push(e);const cl=[Bt("_")].concat(al);for(let e=Bt("a");e<=Bt("z");e++)cl.push(e);for(let e=Bt("A");e<=Bt("Z");e++)cl.push(e);const F_=[Bt(" "),Bt("\f"),Bt(`
`),Bt("\r"),Bt("	"),Bt("\v"),Bt("	"),Bt("Â "),Bt("á"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("\u2028"),Bt("\u2029"),Bt("â¯"),Bt("â"),Bt("ã"),Bt("\uFEFF")],o6=/[0-9a-fA-F]/,ll=/[0-9]/,a6=/[1-9]/;class c6{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ya(r,"global");break;case"i":ya(r,"ignoreCase");break;case"m":ya(r,"multiLine");break;case"u":ya(r,"unicode");break;case"y":ya(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}mo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return s6()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;mo(n);break}if(!(t===!0&&n===void 0)&&mo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),mo(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Bt(`
`),Bt("\r"),Bt("\u2028"),Bt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=al;break;case"D":t=al,n=!0;break;case"s":t=F_;break;case"S":t=F_,n=!0;break;case"w":t=cl;break;case"W":t=cl,n=!0;break}if(mo(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Bt("\f");break;case"n":t=Bt(`
`);break;case"r":t=Bt("\r");break;case"t":t=Bt("	");break;case"v":t=Bt("\v");break}if(mo(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Bt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Bt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Bt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,U_(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,U_(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else kf(r.value,t),t.push(Bt("-")),kf(i.value,t)}else kf(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Bt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(a6.test(t)===!1)throw Error("Expecting a positive integer");for(;ll.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(ll.test(t)===!1)throw Error("Expecting an integer");for(;ll.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Bt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return ll.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(o6.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class wf{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let ul={};const l6=new c6;function hl(e){const t=e.toString();if(ul.hasOwnProperty(t))return ul[t];{const n=l6.pattern(t);return ul[t]=n,n}}function u6(){ul={}}const B_="Complement Sets are not supported for first char optimization",fl=`Unable to use "first char" lexer optimizations:
`;function h6(e,t=!1){try{const n=hl(e);return Ef(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===B_)t&&N_(`${fl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),bf(`${fl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Ef(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Ef(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":dl(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(B_);Ut(o.value,c=>{if(typeof c=="number")dl(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)dl(u,t,n);else{for(let u=l.from;u<=l.to&&u<ka;u++)dl(u,t,n);if(l.to>=ka){const u=l.from>=ka?l.from:ka,f=l.to,d=Vi(u),h=Vi(f);for(let m=d;m<=h;m++)t[m]=m}}}});break;case"Group":Ef(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&xf(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Xe(t)}function dl(e,t,n){const r=Vi(e);t[r]=r,n===!0&&f6(e,t)}function f6(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Vi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Vi(i.charCodeAt(0));t[s]=s}}}function P_(e,t){return fo(e.value,n=>{if(typeof n=="number")return Nn(t,n);{const r=n;return fo(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function xf(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?ie(e.value)?Ur(e.value,xf):xf(e.value):!1}class d6 extends wf{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Nn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?P_(t,this.targetCharCodes)===void 0&&(this.found=!0):P_(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function vf(e,t){if(t instanceof RegExp){const n=hl(t),r=new d6(e);return r.visit(n),r.found}else return fo(t,n=>Nn(e,n.charCodeAt(0)))!==void 0}const Es="PATTERN",ba="defaultMode",pl="modes";let $_=typeof new RegExp("(?:)").sticky=="boolean";function p6(e,t){t=_f(t,{useSticky:$_,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(x,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{B6()});let r;n("Reject Lexer.NA",()=>{r=nl(e,x=>x[Es]===hn.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=St(r,x=>{const T=x[Es];if(Ai(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!Nn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:t.useSticky?j_(T):D_(T)}else{if(xi(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),M=new RegExp(A);return t.useSticky?j_(M):D_(M)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=St(r,x=>x.tokenTypeIdx),a=St(r,x=>{const T=x.GROUP;if(T!==hn.SKIPPED){if(Gn(T))return T;if(Si(T))return!1;throw Error("non exhaustive match")}}),c=St(r,x=>{const T=x.LONGER_ALT;if(T)return ie(T)?St(T,M=>R_(r,M)):[R_(r,T)]}),l=St(r,x=>x.PUSH_MODE),u=St(r,x=>Mt(x,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const x=G_(t.lineTerminatorCharacters);f=St(r,T=>!1),t.positionTracking!=="onlyOffset"&&(f=St(r,T=>Mt(T,"LINE_BREAKS")?!!T.LINE_BREAKS:W_(T,x)===!1&&vf(x,T.PATTERN)))});let d,h,m,p;n("Misc Mapping #2",()=>{d=St(r,z_),h=St(s,M6),m=Kn(r,(x,T)=>{const A=T.GROUP;return Gn(A)&&A!==hn.SKIPPED&&(x[A]=[]),x},{}),p=St(s,(x,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let b=!0,k=[];return t.safeMode||n("First Char Optimization",()=>{k=Kn(r,(x,T,A)=>{if(typeof T.PATTERN=="string"){const M=T.PATTERN.charCodeAt(0),S=Vi(M);Tf(x,S,p[A])}else if(ie(T.START_CHARS_HINT)){let M;Ut(T.START_CHARS_HINT,S=>{const I=typeof S=="string"?S.charCodeAt(0):S,$=Vi(I);M!==$&&(M=$,Tf(x,$,p[A]))})}else if(Ai(T.PATTERN))if(T.PATTERN.unicode)b=!1,t.ensureOptimizations&&bf(`${fl}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const M=h6(T.PATTERN,t.ensureOptimizations);ye(M)&&(b=!1),Ut(M,S=>{Tf(x,S,p[A])})}else t.ensureOptimizations&&bf(`${fl}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return x},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:k,hasCustom:i,canBeOptimized:b}}function m6(e,t){let n=[];const r=_6(e);n=n.concat(r.errors);const i=y6(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(g6(s)),n=n.concat(A6(s)),n=n.concat(S6(s,t)),n=n.concat(R6(s)),n}function g6(e){let t=[];const n=xr(e,r=>Ai(r[Es]));return t=t.concat(k6(n)),t=t.concat(x6(n)),t=t.concat(v6(n)),t=t.concat(T6(n)),t=t.concat(w6(n)),t}function _6(e){const t=xr(e,i=>!Mt(i,Es)),n=St(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:$e.MISSING_PATTERN,tokenTypes:[i]})),r=el(e,t);return{errors:n,valid:r}}function y6(e){const t=xr(e,i=>{const s=i[Es];return!Ai(s)&&!xi(s)&&!Mt(s,"exec")&&!Gn(s)}),n=St(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:$e.INVALID_PATTERN,tokenTypes:[i]})),r=el(e,t);return{errors:n,valid:r}}const b6=/[^\\][$]/;function k6(e){class t extends wf{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=xr(e,i=>{const s=i.PATTERN;try{const o=hl(s),a=new t;return a.visit(o),a.found}catch{return b6.test(s.source)}});return St(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:$e.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function w6(e){const t=xr(e,r=>r.PATTERN.test(""));return St(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:$e.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const E6=/[^\\[][\^]|^\^/;function x6(e){class t extends wf{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=xr(e,i=>{const s=i.PATTERN;try{const o=hl(s),a=new t;return a.visit(o),a.found}catch{return E6.test(s.source)}});return St(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:$e.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function v6(e){const t=xr(e,r=>{const i=r[Es];return i instanceof RegExp&&(i.multiline||i.global)});return St(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:$e.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function T6(e){const t=[];let n=St(e,s=>Kn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Nn(t,a)&&a.PATTERN!==hn.NA&&(t.push(a),o.push(a)),o),[]));n=ma(n);const r=xr(n,s=>s.length>1);return St(r,s=>{const o=St(s,c=>c.name);return{message:`The same RegExp pattern ->${Fr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:$e.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function A6(e){const t=xr(e,r=>{if(!Mt(r,"GROUP"))return!1;const i=r.GROUP;return i!==hn.SKIPPED&&i!==hn.NA&&!Gn(i)});return St(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:$e.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function S6(e,t){const n=xr(e,i=>i.PUSH_MODE!==void 0&&!Nn(t,i.PUSH_MODE));return St(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:$e.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function R6(e){const t=[],n=Kn(e,(r,i,s)=>{const o=i.PATTERN;return o===hn.NA||(Gn(o)?r.push({str:o,idx:s,tokenType:i}):Ai(o)&&N6(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ut(e,(r,i)=>{Ut(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&O6(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:$e.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function O6(e,t){if(Ai(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(xi(t))return t(e,0,[],{});if(Mt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function N6(e){return fo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function D_(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function j_(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function I6(e,t,n){const r=[];return Mt(e,ba)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ba+`> property in its definition
`,type:$e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Mt(e,pl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+pl+`> property in its definition
`,type:$e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Mt(e,pl)&&Mt(e,ba)&&!Mt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ba}: <${e.defaultMode}>which does not exist
`,type:$e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Mt(e,pl)&&Ut(e.modes,(i,s)=>{Ut(i,(o,a)=>{if(Si(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:$e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Mt(o,"LONGER_ALT")){const c=ie(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ut(c,l=>{!Si(l)&&!Nn(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:$e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function C6(e,t,n){const r=[];let i=!1;const s=ma(or(Xe(e.modes))),o=nl(s,c=>c[Es]===hn.NA),a=G_(n);return t&&Ut(o,c=>{const l=W_(c,a);if(l!==!1){const f={message:F6(c,l),type:l.issue,tokenType:c};r.push(f)}else Mt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):vf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:$e.NO_LINE_BREAKS_FLAGS}),r}function L6(e){const t={},n=wr(e);return Ut(n,r=>{const i=e[r];if(ie(i))t[r]=[];else throw Error("non exhaustive match")}),t}function z_(e){const t=e.PATTERN;if(Ai(t))return!1;if(xi(t))return!0;if(Mt(t,"exec"))return!0;if(Gn(t))return!1;throw Error("non exhaustive match")}function M6(e){return Gn(e)&&e.length===1?e.charCodeAt(0):!1}const U6={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function W_(e,t){if(Mt(e,"LINE_BREAKS"))return!1;if(Ai(e.PATTERN)){try{vf(t,e.PATTERN)}catch(n){return{issue:$e.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Gn(e.PATTERN))return!1;if(z_(e))return{issue:$e.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function F6(e,t){if(t.issue===$e.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===$e.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function G_(e){return St(e,n=>Gn(n)?n.charCodeAt(0):n)}function Tf(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const ka=256;let ml=[];function Vi(e){return e<ka?e:ml[e]}function B6(){if(ye(ml)){ml=new Array(65536);for(let e=0;e<65536;e++)ml[e]=e>255?255+~~(e/255):e}}function wa(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function gl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let K_=1;const H_={};function Ea(e){const t=P6(e);$6(t),j6(t),D6(t),Ut(t,n=>{n.isParent=n.categoryMatches.length>0})}function P6(e){let t=bn(e),n=e,r=!0;for(;r;){n=ma(or(St(n,s=>s.CATEGORIES)));const i=el(n,t);t=t.concat(i),ye(i)?r=!1:n=i}return t}function $6(e){Ut(e,t=>{V_(t)||(H_[K_]=t,t.tokenTypeIdx=K_++),X_(t)&&!ie(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),X_(t)||(t.CATEGORIES=[]),z6(t)||(t.categoryMatches=[]),W6(t)||(t.categoryMatchesMap={})})}function D6(e){Ut(e,t=>{t.categoryMatches=[],Ut(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(H_[r].tokenTypeIdx)})})}function j6(e){Ut(e,t=>{Y_([],t)})}function Y_(e,t){Ut(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ut(t.CATEGORIES,n=>{const r=e.concat(t);Nn(r,n)||Y_(r,n)})}function V_(e){return Mt(e,"tokenTypeIdx")}function X_(e){return Mt(e,"CATEGORIES")}function z6(e){return Mt(e,"categoryMatches")}function W6(e){return Mt(e,"categoryMatchesMap")}function G6(e){return Mt(e,"tokenTypeIdx")}const K6={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var $e;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})($e||($e={}));const xa={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:K6,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(xa);let hn=class{constructor(t,n=xa){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=I_(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Wn({},xa,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===xa.lineTerminatorsPattern)this.config.lineTerminatorsPattern=U6;else if(this.config.lineTerminatorCharacters===xa.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),ie(t)?i={modes:{defaultMode:bn(t)},defaultMode:ba}:(s=!1,i=bn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(I6(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(C6(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ut(i.modes,(a,c)=>{i.modes[c]=nl(a,l=>Si(l))});const o=wr(i.modes);if(Ut(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(m6(a,o))}),ye(this.lexerDefinitionErrors)){Ea(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=p6(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Wn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ye(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=St(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ut(this.lexerDefinitionWarning,a=>{N_(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if($_?(this.chopInput=co,this.match=this.matchWithTest):(this.updateLastIndex=tn,this.match=this.matchWithExec),s&&(this.handleModes=tn),this.trackStartLines===!1&&(this.computeNewColumn=co),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=tn),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Kn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ye(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{u6()}),this.TRACE_INIT("toFastProperties",()=>{C_(this)})})}tokenize(t,n=this.defaultMode){if(!ye(this.lexerDefinitionErrors)){const i=St(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,f,d,h,m,p,b,k;const x=t,T=x.length;let A=0,M=0;const S=this.hasCustom?0:Math.floor(t.length/10),I=new Array(S),$=[];let N=this.trackStartLines?1:void 0,z=this.trackStartLines?1:void 0;const J=L6(this.emptyGroups),L=this.trackStartLines,O=this.config.lineTerminatorsPattern;let E=0,C=[],P=[];const F=[],st=[];Object.freeze(st);let et;function ot(){return C}function W(Pt){const Gt=Vi(Pt),jt=P[Gt];return jt===void 0?st:jt}const D=Pt=>{if(F.length===1&&Pt.tokenType.PUSH_MODE===void 0){const Gt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Pt);$.push({offset:Pt.startOffset,line:Pt.startLine,column:Pt.startColumn,length:Pt.image.length,message:Gt})}else{F.pop();const Gt=ho(F);C=this.patternIdxToConfig[Gt],P=this.charCodeToPatternIdxToConfig[Gt],E=C.length;const jt=this.canModeBeOptimized[Gt]&&this.config.safeMode===!1;P&&jt?et=W:et=ot}};function yt(Pt){F.push(Pt),P=this.charCodeToPatternIdxToConfig[Pt],C=this.patternIdxToConfig[Pt],E=C.length,E=C.length;const Gt=this.canModeBeOptimized[Pt]&&this.config.safeMode===!1;P&&Gt?et=W:et=ot}yt.call(this,n);let X;const at=this.config.recoveryEnabled;for(;A<T;){c=null;const Pt=x.charCodeAt(A),Gt=et(Pt),jt=Gt.length;for(r=0;r<jt;r++){X=Gt[r];const $t=X.pattern;l=null;const ue=X.short;if(ue!==!1?Pt===ue&&(c=$t):X.isCustom===!0?(k=$t.exec(x,A,I,J),k!==null?(c=k[0],k.payload!==void 0&&(l=k.payload)):c=null):(this.updateLastIndex($t,A),c=this.match($t,t,A)),c!==null){if(a=X.longerAlt,a!==void 0){const Jt=a.length;for(s=0;s<Jt;s++){const Ie=C[a[s]],je=Ie.pattern;if(u=null,Ie.isCustom===!0?(k=je.exec(x,A,I,J),k!==null?(o=k[0],k.payload!==void 0&&(u=k.payload)):o=null):(this.updateLastIndex(je,A),o=this.match(je,t,A)),o&&o.length>c.length){c=o,l=u,X=Ie;break}}}break}}if(c!==null){if(f=c.length,d=X.group,d!==void 0&&(h=X.tokenTypeIdx,m=this.createTokenInstance(c,A,h,X.tokenType,N,z,f),this.handlePayload(m,l),d===!1?M=this.addToken(I,M,m):J[d].push(m)),t=this.chopInput(t,f),A=A+f,z=this.computeNewColumn(z,f),L===!0&&X.canLineTerminator===!0){let $t=0,ue,Jt;O.lastIndex=0;do ue=O.test(c),ue===!0&&(Jt=O.lastIndex-1,$t++);while(ue===!0);$t!==0&&(N=N+$t,z=f-Jt,this.updateTokenEndLineColumnLocation(m,d,Jt,$t,N,z,f))}this.handleModes(X,D,yt,m)}else{const $t=A,ue=N,Jt=z;let Ie=at===!1;for(;Ie===!1&&A<T;)for(t=this.chopInput(t,1),A++,i=0;i<E;i++){const je=C[i],v=je.pattern,ut=je.short;if(ut!==!1?x.charCodeAt(A)===ut&&(Ie=!0):je.isCustom===!0?Ie=v.exec(x,A,I,J)!==null:(this.updateLastIndex(v,A),Ie=v.exec(t)!==null),Ie===!0)break}if(p=A-$t,z=this.computeNewColumn(z,p),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(x,$t,p,ue,Jt),$.push({offset:$t,line:ue,column:Jt,length:p,message:b}),at===!1)break}}return this.hasCustom||(I.length=M),{tokens:I,groups:J,errors:$}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};hn.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",hn.NA=/NOT_APPLICABLE/;function va(e){return q_(e)?e.LABEL:e.name}function q_(e){return Gn(e.LABEL)&&e.LABEL!==""}const H6="parent",J_="categories",Z_="label",Q_="group",ty="push_mode",ey="pop_mode",ny="longer_alt",ry="line_breaks",iy="start_chars_hint";function ar(e){return Y6(e)}function Y6(e){const t=e.pattern,n={};if(n.name=e.name,Si(t)||(n.PATTERN=t),Mt(e,H6))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Mt(e,J_)&&(n.CATEGORIES=e[J_]),Ea([n]),Mt(e,Z_)&&(n.LABEL=e[Z_]),Mt(e,Q_)&&(n.GROUP=e[Q_]),Mt(e,ey)&&(n.POP_MODE=e[ey]),Mt(e,ty)&&(n.PUSH_MODE=e[ty]),Mt(e,ny)&&(n.LONGER_ALT=e[ny]),Mt(e,ry)&&(n.LINE_BREAKS=e[ry]),Mt(e,iy)&&(n.START_CHARS_HINT=e[iy]),n}const xs=ar({name:"EOF",pattern:hn.NA});Ea([xs]);function _l(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function V6(e,t){return wa(e,t)}const sy={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${q_(e)?`--> ${va(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Fr(t).image+"'";if(r)return s+r+a;{const c=Kn(e,(d,h)=>d.concat(h),[]),l=St(c,d=>`[${St(d,h=>va(h)).join(", ")}]`),f=`one of these possible Token sequences:
${St(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Fr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${St(e,l=>`[${St(l,u=>va(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(sy);const X6={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},vs={buildDuplicateFoundError(e,t){function n(u){return u instanceof Ue?u.terminalType.name:u instanceof Hn?u.nonTerminalName:""}const r=e.name,i=Fr(t),s=i.idx,o=ci(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=St(e.prefixPath,i=>va(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=St(e.prefixPath,i=>va(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=ci(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=St(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof po?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function q6(e,t){const n=new J6(e,t);return n.resolveRefs(),n.errors}class J6 extends ws{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ut(Xe(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:In.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class Z6 extends ol{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=bn(this.path.ruleStack).reverse(),this.occurrenceStack=bn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){ye(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class Q6 extends Z6{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Yn({definition:i});this.possibleTokTypes=_a(s),this.found=!0}}}class yl extends ol{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class tM extends yl{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Fr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ue&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class oy extends yl{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Fr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ue&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class eM extends yl{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Fr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ue&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class ay extends yl{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Fr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ue&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Af(e,t,n=[]){n=bn(n);let r=[],i=0;function s(a){return a.concat(kn(e,i+1))}function o(a){const c=Af(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Yn)return o(a.definition);if(a instanceof Hn)return o(a.definition);if(a instanceof Vn)r=o(a.definition);else if(a instanceof oi){const c=a.definition.concat([new en({definition:a.definition})]);return o(c)}else if(a instanceof ai){const c=[new Yn({definition:a.definition}),new en({definition:[new Ue({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Pr){const c=a.definition.concat([new en({definition:[new Ue({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof en){const c=a.definition.concat([new en({definition:a.definition})]);r=o(c)}else{if(a instanceof $r)return Ut(a.definition,c=>{ye(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ue)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:kn(e,i)}),r}function cy(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ye(f);){const d=f.pop();if(d===o){a&&ho(f).idx<=l&&f.pop();continue}const h=d.def,m=d.idx,p=d.ruleStack,b=d.occurrenceStack;if(ye(h))continue;const k=h[0];if(k===i){const x={idx:m,def:kn(h),ruleStack:ga(p),occurrenceStack:ga(b)};f.push(x)}else if(k instanceof Ue)if(m<c-1){const x=m+1,T=t[x];if(n(T,k.terminalType)){const A={idx:x,def:kn(h),ruleStack:p,occurrenceStack:b};f.push(A)}}else if(m===c-1)u.push({nextTokenType:k.terminalType,nextTokenOccurrence:k.idx,ruleStack:p,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(k instanceof Hn){const x=bn(p);x.push(k.nonTerminalName);const T=bn(b);T.push(k.idx);const A={idx:m,def:k.definition.concat(s,kn(h)),ruleStack:x,occurrenceStack:T};f.push(A)}else if(k instanceof Vn){const x={idx:m,def:kn(h),ruleStack:p,occurrenceStack:b};f.push(x),f.push(o);const T={idx:m,def:k.definition.concat(kn(h)),ruleStack:p,occurrenceStack:b};f.push(T)}else if(k instanceof oi){const x=new en({definition:k.definition,idx:k.idx}),T=k.definition.concat([x],kn(h)),A={idx:m,def:T,ruleStack:p,occurrenceStack:b};f.push(A)}else if(k instanceof ai){const x=new Ue({terminalType:k.separator}),T=new en({definition:[x].concat(k.definition),idx:k.idx}),A=k.definition.concat([T],kn(h)),M={idx:m,def:A,ruleStack:p,occurrenceStack:b};f.push(M)}else if(k instanceof Pr){const x={idx:m,def:kn(h),ruleStack:p,occurrenceStack:b};f.push(x),f.push(o);const T=new Ue({terminalType:k.separator}),A=new en({definition:[T].concat(k.definition),idx:k.idx}),M=k.definition.concat([A],kn(h)),S={idx:m,def:M,ruleStack:p,occurrenceStack:b};f.push(S)}else if(k instanceof en){const x={idx:m,def:kn(h),ruleStack:p,occurrenceStack:b};f.push(x),f.push(o);const T=new en({definition:k.definition,idx:k.idx}),A=k.definition.concat([T],kn(h)),M={idx:m,def:A,ruleStack:p,occurrenceStack:b};f.push(M)}else if(k instanceof $r)for(let x=k.definition.length-1;x>=0;x--){const T=k.definition[x],A={idx:m,def:T.definition.concat(kn(h)),ruleStack:p,occurrenceStack:b};f.push(A),f.push(o)}else if(k instanceof Yn)f.push({idx:m,def:k.definition.concat(kn(h)),ruleStack:p,occurrenceStack:b});else if(k instanceof po)f.push(nM(k,m,p,b));else throw Error("non exhaustive match")}return u}function nM(e,t,n,r){const i=bn(n);i.push(e.name);const s=bn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var De;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(De||(De={}));function ly(e){if(e instanceof Vn||e==="Option")return De.OPTION;if(e instanceof en||e==="Repetition")return De.REPETITION;if(e instanceof oi||e==="RepetitionMandatory")return De.REPETITION_MANDATORY;if(e instanceof ai||e==="RepetitionMandatoryWithSeparator")return De.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Pr||e==="RepetitionWithSeparator")return De.REPETITION_WITH_SEPARATOR;if(e instanceof $r||e==="Alternation")return De.ALTERNATION;throw Error("non exhaustive match")}function rM(e,t,n,r,i,s){const o=Rf(e,t,n),a=dy(o)?gl:wa;return s(o,r,a,i)}function iM(e,t,n,r,i,s){const o=Of(e,t,i,n),a=dy(o)?gl:wa;return s(o[0],a,r)}function sM(e,t,n,r){const i=e.length,s=Ur(e,o=>Ur(o,a=>a.length===1));if(t)return function(o){const a=St(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],m=h.length;for(let p=0;p<m;p++){const b=this.LA(p+1);if(n(b,h[p])===!1)continue t}return c}}};if(s&&!r){const o=St(e,c=>or(c)),a=Kn(o,(c,l,u)=>(Ut(l,f=>{Mt(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Ut(f.categoryMatches,d=>{Mt(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function oM(e,t,n){const r=Ur(e,s=>s.length===1),i=e.length;if(r&&!n){const s=or(e);if(s.length===1&&ye(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Kn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ut(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class aM extends ol{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,De.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,De.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,De.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,De.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,De.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class uy extends ws{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,De.OPTION)}visitRepetition(t){this.checkIsTarget(t,De.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,De.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,De.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,De.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,De.ALTERNATION)}}function hy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function Sf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function cM(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function fy(e,t){const n=St(e,o=>Af([o],1)),r=hy(n.length),i=St(n,o=>{const a={};return Ut(o,c=>{const l=Sf(c.partialPath);Ut(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=hy(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=Sf(f);if(cM(i,h,c)||ye(d)||f.length===t){const p=r[c];if(Nf(p,f)===!1){p.push(f);for(let b=0;b<h.length;b++){const k=h[b];i[c][k]=!0}}}else{const p=Af(d,o+1,f);s[c]=s[c].concat(p),Ut(p,b=>{const k=Sf(b.partialPath);Ut(k,x=>{i[c][x]=!0})})}}}}return r}function Rf(e,t,n,r){const i=new uy(e,De.ALTERNATION,r);return t.accept(i),fy(i.result,n)}function Of(e,t,n,r){const i=new uy(e,n);t.accept(i);const s=i.result,a=new aM(t,e,n).startWalking(),c=new Yn({definition:s}),l=new Yn({definition:a});return fy([c,l],r)}function Nf(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function lM(e,t){return e.length<t.length&&Ur(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function dy(e){return Ur(e,t=>Ur(t,n=>Ur(n,r=>ye(r.categoryMatches))))}function uM(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return St(t,n=>Object.assign({type:In.CUSTOM_LOOKAHEAD_VALIDATION},n))}function hM(e,t,n,r){const i=vr(e,c=>fM(c,n)),s=vM(e,t,n),o=vr(e,c=>kM(c,n)),a=vr(e,c=>mM(c,e,r,n));return i.concat(s,o,a)}function fM(e,t){const n=new pM;e.accept(n);const r=n.allProductions,i=S_(r,dM),s=Br(i,a=>a.length>1);return St(Xe(s),a=>{const c=Fr(a),l=t.buildDuplicateFoundError(e,a),u=ci(c),f={message:l,type:In.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=py(c);return d&&(f.parameter=d),f})}function dM(e){return`${ci(e)}_#_${e.idx}_#_${py(e)}`}function py(e){return e instanceof Ue?e.terminalType.name:e instanceof Hn?e.nonTerminalName:""}class pM extends ws{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function mM(e,t,n,r){const i=[];if(Kn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:In.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function gM(e,t,n){const r=[];let i;return Nn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:In.INVALID_RULE_OVERRIDE,ruleName:e})),r}function my(e,t,n,r=[]){const i=[],s=bl(t.definition);if(ye(s))return[];{const o=e.name;Nn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:In.LEFT_RECURSION,ruleName:o});const c=el(s,r.concat([e])),l=vr(c,u=>{const f=bn(r);return f.push(u),my(e,u,n,f)});return i.concat(l)}}function bl(e){let t=[];if(ye(e))return t;const n=Fr(e);if(n instanceof Hn)t.push(n.referencedRule);else if(n instanceof Yn||n instanceof Vn||n instanceof oi||n instanceof ai||n instanceof Pr||n instanceof en)t=t.concat(bl(n.definition));else if(n instanceof $r)t=or(St(n.definition,s=>bl(s.definition)));else if(!(n instanceof Ue))throw Error("non exhaustive match");const r=sl(n),i=e.length>1;if(r&&i){const s=kn(e);return t.concat(bl(s))}else return t}class If extends ws{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function _M(e,t){const n=new If;e.accept(n);const r=n.alternations;return vr(r,s=>{const o=ga(s.definition);return vr(o,(a,c)=>{const l=cy([a],[],wa,1);return ye(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:In.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function yM(e,t,n){const r=new If;e.accept(r);let i=r.alternations;return i=nl(i,o=>o.ignoreAmbiguities===!0),vr(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=Rf(a,e,c,o),u=EM(l,o,e,n),f=xM(l,o,e,n);return u.concat(f)})}class bM extends ws{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function kM(e,t){const n=new If;e.accept(n);const r=n.alternations;return vr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:In.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function wM(e,t,n){const r=[];return Ut(e,i=>{const s=new bM;i.accept(s);const o=s.allProductions;Ut(o,a=>{const c=ly(a),l=a.maxLookahead||t,u=a.idx,d=Of(u,i,c,l)[0];if(ye(or(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:In.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function EM(e,t,n,r){const i=[],s=Kn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Ut(c,u=>{const f=[l];Ut(e,(d,h)=>{l!==h&&Nf(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!Nf(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return St(s,a=>{const c=St(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:In.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function xM(e,t,n,r){const i=Kn(e,(o,a,c)=>{const l=St(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return ma(vr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=xr(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&lM(d.path,l));return St(u,d=>{const h=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:In.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:h}})}))}function vM(e,t,n){const r=[],i=St(t,s=>s.name);return Ut(e,s=>{const o=s.name;if(Nn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:In.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function TM(e){const t=_f(e,{errMsgProvider:X6}),n={};return Ut(e.rules,r=>{n[r.name]=r}),q6(n,t.errMsgProvider)}function AM(e){return e=_f(e,{errMsgProvider:vs}),hM(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const gy="MismatchedTokenException",_y="NoViableAltException",yy="EarlyExitException",by="NotAllInputParsedException",ky=[gy,_y,yy,by];Object.freeze(ky);function kl(e){return Nn(ky,e.name)}class wl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class wy extends wl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=gy}}class SM extends wl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=_y}}class RM extends wl{constructor(t,n){super(t,n),this.name=by}}class OM extends wl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=yy}}const Cf={},Ey="InRuleRecoveryException";class NM extends Error{constructor(t){super(t),this.name=Ey}}class IM{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Mt(t,"recoveryEnabled")?t.recoveryEnabled:Ri.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=CM)}getTokenToInsert(t){const n=_l(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new wy(h,l,this.LA(0));m.resyncedTokens=ga(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new NM("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||ye(n))return!1;const r=this.LA(1);return fo(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Nn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=fo(t,s=>V6(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Cf;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return St(t,(r,i)=>i===0?Cf:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=St(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return or(t)}getFollowSetFromFollowKey(t){if(t===Cf)return[xs];const n=t.ruleName+t.idxInCallingRule+M_+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,xs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ga(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=bn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return St(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function CM(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=xs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const LM=4,Xi=8,xy=1<<Xi,vy=2<<Xi,Lf=3<<Xi,Mf=4<<Xi,Uf=5<<Xi,El=6<<Xi;function Ff(e,t,n){return n|t|e}class MM{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ri.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(ye(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return vr(t,n=>my(n,n,vs))}validateEmptyOrAlternatives(t){return vr(t,n=>_M(n,vs))}validateAmbiguousAlternationAlternatives(t,n){return vr(t,r=>yM(r,n,vs))}validateSomeNonEmptyLookaheadPath(t,n){return wM(t,n,vs)}buildLookaheadForAlternation(t){return rM(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,sM)}buildLookaheadForOptional(t){return iM(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,ly(t.prodType),oM)}}class UM{initLooksAhead(t){this.dynamicTokensEnabled=Mt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ri.dynamicTokensEnabled,this.maxLookahead=Mt(t,"maxLookahead")?t.maxLookahead:Ri.maxLookahead,this.lookaheadStrategy=Mt(t,"lookaheadStrategy")?t.lookaheadStrategy:new MM({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Ut(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=BM(n);Ut(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${ci(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Ff(this.fullRuleNameToShort[n.name],xy,l.idx);this.setLaFuncCache(d,f)})}),Ut(i,l=>{this.computeLookaheadFunc(n,l.idx,Lf,"Repetition",l.maxLookahead,ci(l))}),Ut(s,l=>{this.computeLookaheadFunc(n,l.idx,vy,"Option",l.maxLookahead,ci(l))}),Ut(o,l=>{this.computeLookaheadFunc(n,l.idx,Mf,"RepetitionMandatory",l.maxLookahead,ci(l))}),Ut(a,l=>{this.computeLookaheadFunc(n,l.idx,El,"RepetitionMandatoryWithSeparator",l.maxLookahead,ci(l))}),Ut(c,l=>{this.computeLookaheadFunc(n,l.idx,Uf,"RepetitionWithSeparator",l.maxLookahead,ci(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Ff(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return Ff(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class FM extends ws{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const xl=new FM;function BM(e){xl.reset(),e.accept(xl);const t=xl.dslMethods;return xl.reset(),t}function Ty(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Ay(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function PM(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function $M(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const DM="name";function Sy(e,t){Object.defineProperty(e,DM,{enumerable:!1,configurable:!0,writable:!1,value:t})}function jM(e,t){const n=wr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function zM(e,t){const n=function(){};Sy(n,e+"BaseSemantics");const r={visit:function(i,s){if(ie(i)&&(i=i[0]),!Si(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=GM(this,t);if(!ye(i)){const s=St(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function WM(e,t,n){const r=function(){};Sy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ut(t,s=>{i[s]=jM}),r.prototype=i,r.prototype.constructor=r,r}var Bf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Bf||(Bf={}));function GM(e,t){return KM(e,t)}function KM(e,t){const n=xr(t,i=>xi(e[i])===!1),r=St(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Bf.MISSING_METHOD,methodName:i}));return ma(r)}class HM{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Mt(t,"nodeLocationTracking")?t.nodeLocationTracking:Ri.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=tn,this.cstFinallyStateUpdate=tn,this.cstPostTerminal=tn,this.cstPostNonTerminal=tn,this.cstPostRule=tn;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Ay,this.setNodeLocationFromNode=Ay,this.cstPostRule=tn,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=tn,this.setNodeLocationFromNode=tn,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Ty,this.setNodeLocationFromNode=Ty,this.cstPostRule=tn,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=tn,this.setNodeLocationFromNode=tn,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=tn,this.setNodeLocationFromNode=tn,this.cstPostRule=tn,this.setInitialNodeLocation=tn;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];PM(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];$M(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Si(this.baseCstVisitorConstructor)){const t=zM(this.className,wr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Si(this.baseCstVisitorWithDefaultsConstructor)){const t=WM(this.className,wr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class YM{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Al}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?Al:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class VM{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=Sl){if(Nn(this.definedRulesNames,t)){const o={message:vs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:In.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=Sl){const i=gM(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(kl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return qL(Xe(this.gastProductionsCache))}}class XM{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=gl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Mt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(ie(t)){if(ye(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(ie(t))this.tokensMap=Kn(t,(s,o)=>(s[o.name]=o,s),{});else if(Mt(t,"modes")&&Ur(or(Xe(t.modes)),G6)){const s=or(Xe(t.modes)),o=rl(s);this.tokensMap=Kn(o,(a,c)=>(a[c.name]=c,a),{})}else if(kr(t))this.tokensMap=bn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=xs;const r=Mt(t,"modes")?or(Xe(t.modes)):Xe(t),i=Ur(r,s=>ye(s.categoryMatches));this.tokenMatcher=i?gl:wa,Ea(Xe(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Mt(r,"resyncEnabled")?r.resyncEnabled:Sl.resyncEnabled,s=Mt(r,"recoveryValueFunc")?r.recoveryValueFunc:Sl.recoveryValueFunc,o=this.ruleShortNameIdx<<LM+Xi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(kl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(vy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Mf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,De.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Mf,t,eM)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(El,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,ay],a,El,t,ay)}else throw this.raiseEarlyExitException(t,De.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Lf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Lf,t,tM,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Uf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,oy],a,Uf,t,oy)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,El,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(xy,n),i=ie(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new RM(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw kl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new wy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Ey?r:s}}else throw r}saveRecogState(){const t=this.errors,n=bn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),xs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class qM{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Mt(t,"errorMessageProvider")?t.errorMessageProvider:Ri.errorMessageProvider}SAVE_ERROR(t){if(kl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:bn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return bn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Of(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new OM(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Rf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new SM(c,this.LA(1),a))}}class JM{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Si(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return cy([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Fr(t.ruleStack),i=this.getGAstProductions()[n];return new Q6(i,t).startWalking()}}const vl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(vl);const Ry=!0,Oy=Math.pow(2,Xi)-1,Ny=ar({name:"RECORDING_PHASE_TOKEN",pattern:hn.NA});Ea([Ny]);const Iy=_l(Ny,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Iy);const ZM={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class QM{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return Al}topLevelRuleRecord(t,n){try{const r=new po({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Ta.call(this,Vn,t,n)}atLeastOneInternalRecord(t,n){Ta.call(this,oi,n,t)}atLeastOneSepFirstInternalRecord(t,n){Ta.call(this,ai,n,t,Ry)}manyInternalRecord(t,n){Ta.call(this,en,n,t)}manySepFirstInternalRecord(t,n){Ta.call(this,Pr,n,t,Ry)}orInternalRecord(t,n){return tU.call(this,t,n)}subruleInternalRecord(t,n,r){if(Tl(n),!t||Mt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Cy(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=ho(this.recordingProdStack),s=t.ruleName,o=new Hn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?ZM:vl}consumeInternalRecord(t,n,r){if(Tl(n),!V_(t)){const o=new Error(`<CONSUME${Cy(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=ho(this.recordingProdStack),s=new Ue({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Iy}}function Ta(e,t,n,r=!1){Tl(n);const i=ho(this.recordingProdStack),s=xi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Mt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),vl}function tU(e,t){Tl(t);const n=ho(this.recordingProdStack),r=ie(e)===!1,i=r===!1?e:e.DEF,s=new $r({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Mt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=yf(i,a=>xi(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ut(i,a=>{const c=new Yn({definition:[]});s.definition.push(c),Mt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Mt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),vl}function Cy(e){return e===0?"":`${e}`}function Tl(e){if(e<0||e>Oy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Oy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class eU{initPerformanceTracer(t){if(Mt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ri.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=I_(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function nU(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const Al=_l(xs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Al);const Ri=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:sy,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Sl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var In;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(In||(In={}));let Pf=class dE{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{C_(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ut(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=TM({rules:Xe(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ye(r)&&this.skipValidations===!1){const i=AM({rules:Xe(this.gastProductionsCache),tokenTypes:Xe(this.tokensMap),errMsgProvider:vs,grammarName:n}),s=uM({lookaheadStrategy:this.lookaheadStrategy,rules:Xe(this.gastProductionsCache),tokenTypes:Xe(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ye(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=r6(Xe(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Xe(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Xe(this.gastProductionsCache))})),!dE.DEFER_DEFINITION_ERRORS_HANDLING&&!ye(this.definitionErrors))throw t=St(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Mt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Mt(n,"skipValidations")?n.skipValidations:Ri.skipValidations}};Pf.DEFER_DEFINITION_ERRORS_HANDLING=!1,nU(Pf,[IM,UM,HM,YM,XM,VM,qM,JM,QM,eU]);class rU extends Pf{constructor(t,n=Ri){const r=bn(n);r.outputCst=!0,super(t,r)}}function iU(e){const t=new sU,n=Xe(e);return St(n,r=>t.visitRule(r))}class sU extends ws{visitRule(t){const n=this.visitEach(t.definition),r=S_(n,s=>s.propertyName),i=St(r,(s,o)=>{const a=!yf(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=St(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:Rl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:Rl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:Rl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:Rl(t)}]}visitEachAndOverrideWith(t,n){return St(this.visitEach(t),r=>Wn({},r,n))}visitEach(t){return or(St(t,n=>this.visit(n)))}}function Rl(e){return e instanceof Hn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function oU(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(or(St(e,r=>aU(r)))),t.includeVisitorInterface&&(n=n.concat(hU(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function aU(e){const t=cU(e),n=lU(e);return[t,n]}function cU(e){const t=My(e.name),n=$f(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function lU(e){return`export type ${$f(e.name)} = {
  ${St(e.properties,n=>uU(n)).join(`
  `)}
};`}function uU(e){const t=dU(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function hU(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${St(t,n=>fU(n)).join(`
  `)}
}`}function fU(e){const t=$f(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function dU(e){if(ie(e)){const t=rl(St(e,r=>Ly(r)));return"("+Kn(t,(r,i)=>r+" | "+i)+")"}else return Ly(e)}function Ly(e){return e.kind==="token"?"IToken":My(e.name)}function My(e){return Xg(e)+"CstNode"}function $f(e){return Xg(e)+"CstChildren"}const pU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function mU(e,t){const n=Object.assign(Object.assign({},pU),t),r=iU(e);return oU(r,n)}const Aa=vm(32,126).map(e=>String.fromCharCode(e));function Yt(e){return ar({...e,name:`token_${e.name}`})}function lt(e){return Yt({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:qe})}const Ol=Yt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),gU=Yt({name:"whitespace",pattern:/ +/,group:hn.SKIPPED}),_U=Yt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:hn.SKIPPED}),Df=Yt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),go=Yt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Uy=!1;const yU="@#/?':!",bU=/[#\d]+/i,kU=/^[?/](by|at|away|toward|find|flee|to)/i;function wU(e,t){if(!Uy)return null;let n=t;const r=e[n-1];if(n>0&&r!==" "&&r!==`
`)return null;if(e[n]===" "){for(;e[n]===" ";)n++;if(yU.includes(e[n]))return null}for(;n>0&&`@#':!/?
`.includes(e[n])===!1;)n--;switch(e[n]){case"?":case"/":{const o=e.substring(n,t+1).toLowerCase();if(!o.includes(" ")||kU.test(o))return null;break}case"#":{const o=e.substring(n+1,n+4).toLowerCase();if(bU.test(o)===!1)return null;break}case"@":case"'":case":":case"!":return null}let i=t;for(;i<e.length&&e[i]!==`
`;)i++;const s=e.substring(t,i);return s.trim().length===0?null:[s]}const Fy=Yt({name:"text",pattern:wU,line_breaks:!1,start_chars_hint:Aa}),By=Yt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),jf=Yt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Py=Yt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),$y=Yt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),qe=Yt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Aa}),Nl=Yt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),zf=Yt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Dy=lt("isterrain"),jy=lt("isobject"),zy=lt("issolid"),Wy=lt("iswalk"),Gy=lt("isswim"),Ky=lt("isbullet"),Hy=lt("isghost"),Yy=lt("iswalking"),Vy=lt("iswalkable"),Xy=lt("isswimming"),qy=lt("isswimmable"),Jy=lt("black"),Zy=lt("dkblue"),Qy=lt("dkgreen"),tb=lt("dkcyan"),eb=lt("dkred"),nb=lt("dkpurple"),rb=lt("dkyellow"),ib=lt("ltgray"),sb=lt("dkgray"),ob=lt("blue"),ab=lt("green"),cb=lt("cyan"),lb=lt("red"),ub=lt("purple"),hb=lt("yellow"),fb=lt("white"),db=lt("brown"),pb=lt("dkwhite"),mb=lt("ltgrey"),gb=lt("gray"),_b=lt("grey"),yb=lt("dkgrey"),bb=lt("ltblack"),kb=lt("onblack"),wb=lt("ondkblue"),Eb=lt("ondkgreen"),xb=lt("ondkcyan"),vb=lt("ondkred"),Tb=lt("ondkpurple"),Ab=lt("ondkyellow"),Sb=lt("onltgray"),Rb=lt("ondkgray"),Ob=lt("onblue"),Nb=lt("ongreen"),Ib=lt("oncyan"),Cb=lt("onred"),Lb=lt("onpurple"),Mb=lt("onyellow"),Ub=lt("onwhite"),Fb=lt("onbrown"),Bb=lt("ondkwhite"),Pb=lt("onltgrey"),$b=lt("ongray"),Db=lt("ongrey"),jb=lt("ondkgrey"),zb=lt("onltblack"),Wb=lt("onclear"),Gb=lt("idle"),Kb=lt("up"),Hb=lt("down"),Yb=lt("left"),Vb=lt("right"),Xb=lt("by"),qb=lt("at"),Jb=lt("flow"),Zb=lt("seek"),Qb=lt("rndns"),t1=lt("rndne"),e1=lt("rnd"),n1=lt("cw"),r1=lt("ccw"),i1=lt("opp"),s1=lt("rndp"),o1=lt("away"),a1=lt("toward"),c1=lt("find"),l1=lt("flee"),u1=lt("to"),h1=lt("i"),f1=lt("u"),d1=lt("north"),p1=lt("n"),m1=lt("d"),g1=lt("south"),_1=lt("s"),y1=lt("l"),b1=lt("west"),k1=lt("w"),w1=lt("r"),E1=lt("east"),x1=lt("e"),v1=lt("over"),T1=lt("under"),A1=Yt({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:qe}),S1=lt("contact"),R1=lt("blocked"),O1=lt("any"),N1=lt("countof"),I1=lt("abs"),C1=lt("intceil"),L1=lt("intfloor"),M1=lt("intround"),U1=lt("clamp"),F1=lt("min"),B1=lt("max"),P1=lt("pick"),$1=lt("pickwith"),D1=lt("random"),j1=lt("randomwith"),z1=lt("run"),W1=lt("runwith"),G1=Yt({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),K1=Yt({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:qe}),H1=Yt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:qe}),Y1=Yt({name:"islessthan",pattern:/<|below/i,longer_alt:qe}),V1=Yt({name:"isgreaterthan",pattern:/>|above/i,longer_alt:qe}),X1=Yt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:qe}),q1=Yt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:qe}),Wf=Yt({name:"or",pattern:/or/i,longer_alt:qe}),Gf=Yt({name:"not",pattern:/not/i,longer_alt:qe}),Kf=Yt({name:"and",pattern:/and/i,longer_alt:qe}),Hf=Yt({name:"plus",pattern:/\+/}),Yf=Yt({name:"minus",pattern:/-/}),J1=Yt({name:"power",pattern:/\*\*/}),Z1=Yt({name:"multiply",pattern:/\*/}),Vf=Yt({name:"divide",pattern:/\//}),Q1=Yt({name:"moddivide",pattern:/%/}),tk=Yt({name:"floordivide",pattern:/%%/}),ek=Yt({name:"query",pattern:/\?/}),nk=Yt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),rk=Yt({name:"rparen",pattern:/\)/,pop_mode:!0}),ik=Yt({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:Aa,longer_alt:qe}),sk=Yt({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Aa,longer_alt:qe}),ok=Yt({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Aa,longer_alt:qe}),Xf=Yt({name:"if",pattern:/if|try|take|give/i,longer_alt:qe}),Il=lt("do"),qf=lt("done"),Jf=lt("else"),ak=lt("while"),ck=lt("repeat"),lk=lt("waitfor"),uk=Yt({name:"foreach",pattern:/foreach|for/i,longer_alt:qe}),hk=lt("break"),fk=lt("continue");function dk(e){return[Hb,...e,zf,Dy,jy,zy,Vy,Yy,Wy,qy,Xy,Gy,Ky,Hy,Jy,Zy,Qy,tb,eb,nb,rb,ib,sb,ob,ab,cb,lb,ub,hb,fb,db,pb,mb,gb,_b,yb,bb,kb,wb,Eb,xb,vb,Tb,Ab,Sb,Rb,Ob,Nb,Ib,Cb,Lb,Mb,Ub,Fb,Bb,Pb,$b,Db,jb,zb,Wb,Gb,Kb,Yb,Vb,Xb,qb,Jb,Zb,s1,Qb,t1,e1,n1,r1,i1,o1,a1,c1,l1,u1,d1,g1,b1,E1,v1,T1,A1,S1,R1,O1,N1,I1,C1,L1,M1,U1,F1,B1,$1,P1,j1,D1,W1,z1,G1,K1,H1,X1,Y1,q1,V1,Wf,Gf,Kf,Hf,Yf,J1,Z1,Vf,tk,Q1,ek,nk,rk,h1,f1,p1,m1,_1,y1,k1,w1,x1,Nl,qe]}const pk=dk([Fy,Df,ik,sk,ok,go,By,jf,Py,$y,Ol,gU,hk,fk,qf,Il,Jf,uk,Xf,ck,lk,ak]),EU=new hn({defaultMode:"use_newlines",modes:{use_newlines:pk,ignore_newlines:dk([_U])}},{skipValidations:!Qr,ensureOptimizations:Qr,positionTracking:"full"});function mk(e){Uy=!0;const t=EU.tokenize(e||` 
`),[n]=(ae(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(_l(Ol,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function xU(e,t,n=!0){if(n){const[r,...i]=t;switch(Nt(r??"")){default:return{type:Rt.OBJECT,values:t};case"loader":return{type:Rt.LOADER,values:i};case"board":return{type:Rt.BOARD,values:i};case"object":return{type:Rt.OBJECT,values:i};case"terrain":return{type:Rt.TERRAIN,values:i};case"charset":return{type:Rt.CHARSET,values:i};case"palette":return{type:Rt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Nt(i??""),a=[r,e,...s];switch(o){default:return{type:Rt.CONST,values:t};case"rn":case"range":return{type:Rt.RANGE,values:a};case"sl":case"select":return{type:Rt.SELECT,values:a};case"nm":case"number":return{type:Rt.NUMBER,values:a};case"tx":case"text":return{type:Rt.TEXT,values:a};case"hk":case"hotkey":return{type:Rt.HOTKEY,values:a};case"copyit":return{type:Rt.COPYIT,values:a};case"openit":return{type:Rt.OPENIT,values:a};case"zssedit":return{type:Rt.ZSSEDIT,values:a};case"charedit":return{type:Rt.CHAREDIT,values:a};case"coloredit":return{type:Rt.COLOREDIT,values:a}}}}function cr(e){switch(e){case Rt.LOADER:return"loader";case Rt.BOARD:return"board";case Rt.OBJECT:return"object";case Rt.TERRAIN:return"terrain";case Rt.CHARSET:return"charset";case Rt.PALETTE:return"palette";case Rt.CONST:return"const";case Rt.RANGE:return"range";case Rt.SELECT:return"select";case Rt.NUMBER:return"number";case Rt.TEXT:return"text";case Rt.HOTKEY:return"hotkey";case Rt.COPYIT:return"copyit";case Rt.OPENIT:return"openit";case Rt.ZSSEDIT:return"zssedit";case Rt.CHAREDIT:return"charedit";case Rt.COLOREDIT:return"coloredit"}}var Zf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Zf||{});function gk(e){return ao(e,Zf,{bits:t=>Array.from(t)})}function _k(e){return sa(e,Zf,{bits:t=>new Uint8Array(t)})}function yk(e,t){return{id:ze(),code:e,...t}}var Qf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Qf||{});function vU(e){return ao(e,Qf,{board:h$,object:$c,terrain:$c,charset:gk,palette:gk,stats:Se})}function TU(e){return sa(e,Qf,{board:f$,object:Dc,terrain:Dc,charset:_k,palette:_k})}function Sa(e){const t={...Ts(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function AU(e){return y(e)?(e.stats=void 0,Ts(e)):{}}function td(e){const t=mk(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Df){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=xU(pt(c)?c:"",l,r),f=Nt(u.values.join(" "));switch(r=!1,u.type){case Rt.LOADER:n.type=bt.LOADER,n.name=f;break;case Rt.BOARD:n.type=bt.BOARD,n.name=f;break;case Rt.OBJECT:n.type=bt.OBJECT,n.name=f||"object";break;case Rt.TERRAIN:n.type=bt.TERRAIN,n.name=f;break;case Rt.CHARSET:n.type=bt.CHARSET,n.name=f;break;case Rt.PALETTE:n.type=bt.PALETTE,n.name=f;break;case Rt.CONST:{const[d,...h]=u.values;if(pt(d)){const m=Nt(d),p=h.join(" ");if(pt(p)){const b=parseFloat(p);n[m]=wt(b)?b:p}else n[m]=1}break}case Rt.RANGE:case Rt.SELECT:case Rt.NUMBER:case Rt.TEXT:case Rt.HOTKEY:case Rt.ZSSEDIT:case Rt.CHAREDIT:case Rt.COLOREDIT:{const[d,...h]=u.values;if(pt(d)){const m=Nt(d);n[m]=[cr(u.type),...h]}break}}}}return n}function Ts(e){var t;return y(e)?(y((t=e.stats)==null?void 0:t.type)||(e.stats=td(e.code),y(e.stats.type)||(e.stats.type=bt.OBJECT)),e.stats):{}}function bk(e){switch(e){default:case bt.ERROR:return"error";case bt.LOADER:return cr(Rt.LOADER);case bt.BOARD:return cr(Rt.BOARD);case bt.OBJECT:return cr(Rt.OBJECT);case bt.TERRAIN:return cr(Rt.TERRAIN);case bt.CHARSET:return cr(Rt.CHARSET);case bt.PALETTE:return cr(Rt.PALETTE)}}function li(e){return Ts(e).type??bt.ERROR}function Oi(e){return bk(li(e))}function be(e){return Ts(e).name??""}function ed(e,t){return Ts(e)[t]}const Cl=new Rh;function SU(e){if(!pt(e))return;const t=Zo(e);if(y(t)&&y(Lt[t]))return Lt[t];const n=Nt(e),r=_t[n];if(y(r))return r}function Ll(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ae(s))switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":t[i]=e[i];break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":t[i]=SU(e[i])??e[i];break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":{const o=e[i];t.pushable=o===""?1:o;break}case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Ft.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Ft.ISSWIM;break;case"issolid":t.collision=Ft.ISSOLID;break;case"isbullet":t.collision=Ft.ISBULLET;break;case"isghost":t.collision=Ft.ISGHOST;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Re(e){var t;if(y(e))switch(li(e)){default:return;case bt.ERROR:return e.code??"";case bt.LOADER:return e.code??"";case bt.BOARD:{y(e.board)||(e.board=nu()),e.board.id=e.id;const n=Sa(e);return n.isdark&&(e.board.isdark=1),n.notdark&&(e.board.isdark=0),wt(n.startx)&&(e.board.startx=n.startx),wt(n.starty)&&(e.board.starty=n.starty),pt(n.over)&&(Nt(n.over)==="empty"?e.board.over=void 0:e.board.over=n.over,e.board.overboard=void 0),pt(n.under)&&(Nt(n.under)==="empty"?e.board.under=void 0:e.board.under=n.under,e.board.underboard=void 0),pt(n.camera)&&(Nt(n.camera)==="empty"?e.board.camera=void 0:e.board.camera=n.camera),pt(n.graphics)&&(Nt(n.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=n.graphics),wt(n.facing)&&(e.board.facing=n.facing),pt(n.facing)&&Nt(n.facing)==="empty"&&(e.board.facing=void 0),pt(n.exitnorth)&&(e.board.exitnorth=n.exitnorth),pt(n.exitsouth)&&(e.board.exitsouth=n.exitsouth),pt(n.exitwest)&&(e.board.exitwest=n.exitwest),pt(n.exiteast)&&(e.board.exiteast=n.exiteast),wt(n.timelimit)&&(e.board.timelimit=n.timelimit),n.restartonzap&&(e.board.restartonzap=1),n.norestartonzap&&(e.board.restartonzap=0),wt(n.maxplayershots)&&(e.board.maxplayershots=n.maxplayershots),e.board}case bt.OBJECT:return y(e.object)||(e.object=lg()),e.object.id=e.id,e.object.code=e.code,e.object.name=be(e),e.object.category=Bn.ISOBJECT,Ll(Sa(e),e.object),e.object;case bt.TERRAIN:return y(e.terrain)||(e.terrain=lg()),e.terrain.id=e.id,e.terrain.name=be(e),e.terrain.category=Bn.ISTERRAIN,Ll(Sa(e),e.terrain),e.terrain;case bt.PALETTE:{if(y(e.palette)||(e.palette=hg(HS)),y((t=e.palette)==null?void 0:t.bits)){const n=Sa(e),r=er(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&pt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Cl.set(o);const c=a*Nc,l=Cl.r*63,u=Cl.g*63,f=Cl.b*63;e.palette.bits[c+0]=Ge(l,0,63),e.palette.bits[c+1]=Ge(u,0,63),e.palette.bits[c+2]=Ge(f,0,63)}}}}return e.palette}case bt.CHARSET:return y(e.charset)||(e.charset=fg(KS)),e.charset}}function nd(e){return{id:ze(),name:RE(),timestamp:0,activelist:[],pages:e,flags:{}}}var rd=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(rd||{});function RU(e){return ao(e,rd,{pages:t=>t.map(vU),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function OU(e){return sa(e,rd,{pages:t=>t.map(TU)})}function kk(e){y(e)&&(e.token=`${OE()}${mr(1111,9999)}`)}function As(e,t){if(!y(e))return;const n=Nt(t);return e.pages.find(i=>i.id===t||n===be(i))}function nn(e,t,n){if(!y(e))return;const r=Nt(n);return e.pages.find(s=>li(s)===t&&(s.id===n||r===be(s)))}function id(e,t,n){let r=nn(e,t,n);if(!y(r)){const i=bk(t);return r=yk(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),sd(e,r),[r,!0]}return[r,!1]}function Ss(e,t){return y(e)?e.pages.filter(n=>li(n)===t):[]}function wk(e,t,n){if(!y(e))return[];const r=Nt(n);return e.pages.filter(s=>li(s)===t).filter(s=>{const o=Ts(s),a=Nt(be(s));return s.id===n||r===a||y(o[n])})}function Ra(e){return y(e)?Sr(e.pages).sort((n,r)=>{const i=li(n),s=li(r);return i===s?be(n).localeCompare(be(r)):s-i}):[]}function Ek(e,t){if(y(t)){const n=nn(e,bt.TERRAIN,t.kind??"");if(y(n))return n;const r=nn(e,bt.OBJECT,t.kind??"");if(y(r))return r}}function sd(e,t){if(!y(e)||!y(t))return!1;const n=As(e,t.id);return y(n)?!1:(e.pages.push(t),kk(e),!0)}function xk(e,t){const n=As(e,t);if(y(e)&&y(n)){const r=Nt(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==be(i)),kk(e),n}}function rn(e,t=1,n=Lt.WHITE,r=Lt.BLACK){const i=e==null?void 0:e.kinddata;return{name:Nt((e==null?void 0:e.name)??(i==null?void 0:i.name)),char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??n,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??r,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function NU(e,t){return!!(e!=null&&e.flags[t])}function Ni(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function vk(e,t){e&&delete e.flags[t]}function Tk(e,t,n){const r=Ni(e,t);return r==null?void 0:r[n]}function IU(e,t,n,r){const i=Ni(e,t);return i&&(i[n]=r),r}function Oe(e){if(!y(e)||y(e.lookup)&&y(e.named))return;const t=new Array(At*Ht).fill(void 0),n={},r=Object.values(e.objects);for(let o=0;o<r.length;++o){const a=r[o];if(y(a.x)&&y(a.y)&&y(a.id)&&!y(a.removed)){a.category=Bn.ISOBJECT,t[a.x+a.y*At]=a.id,pt(a.code)&&!y(a.name)&&Ll(td(a.code),a);const c=rn(ur(a));n[c.name]||(n[c.name]=new Set),n[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];if(y(a)){a.x=i,a.y=s,a.category=Bn.ISTERRAIN;const c=rn(ur(a));n[c.name]||(n[c.name]=new Set),n[c.name].add(o)}++i,i>=At&&(i=0,++s)}e.lookup=t,e.named=n}function Oa(e){y(e)&&(delete e.named,delete e.lookup,Oe(e))}function Ak(e,t,n){var i;if(!y(e)||!y(e.named)||!y(t))return;const r=Nt(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[r]||(e.named[r]=new Set),e.named[r].add((t==null?void 0:t.id)??n??"")}function CU(e,t){if(!(!y(e)||!y(e.lookup)||!y(t==null?void 0:t.id))&&!y(t.removed)){const n=t.x??0,r=t.y??0;e.lookup[n+r*At]=t.id}}function LU(e,t){var n;if(y(e)&&y(t==null?void 0:t.x)&&y(t.y)){const r=rn(t),i=Wr(e,t);y((n=e.named)==null?void 0:n[r.name])&&e.named[r.name].delete(i)}}function od(e,t){var n;if(y(e)&&y(t==null?void 0:t.id)){if(y(e.lookup)&&y(t.x)&&y(t.y)){const i=t.x+t.y*At;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const r=rn(t);y((n=e.named)==null?void 0:n[r.name])&&y(t.id)&&e.named[r.name].delete(t.id)}}function ad(e,t,n,r=!1){if(!y(e)||!y(e.lookup)||n.x<0||n.x>=At||n.y<0||n.y>=Ht)return;const i=n.x+n.y*At,s=Mn(e,e.lookup[i]??"404");if(y(s))return r&&wn(s.id)?void 0:s;const o=e.terrain[i];if(y(o)&&$a(t,Wt(o,"collision")))return o}function MU(e,t,n){const r=Mn(e,(t==null?void 0:t.id)??""),i=(r==null?void 0:r.x)??-1,s=(r==null?void 0:r.y)??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=Wt(r,"collision");return y(ad(e,o,n))}function cd(e,t,n){var d;const r=Mn(e,(t==null?void 0:t.id)??"");if(!y(e)||!y(r)||!y(r.x)||!y(r.y)||!y(e.lookup)||n.x<0||n.x>=At||n.y<0||n.y>=Ht)return{name:"edge",kind:"edge",collision:Ft.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=Wr(e,r),s=Wr(e,n),o=Wt(r,"collision");if(o===Ft.ISGHOST)return;const a=wn(r==null?void 0:r.id),c=o===Ft.ISBULLET,l=Mn(e,e.lookup[s]??"");if(Wt(l,"collision")===Ft.ISGHOST)return;const u=wn((l==null?void 0:l.id)??"");if(y(l)&&(!a||!u)){const h=Wt(r,"group"),m=Wt(l,"group");if((h||m)&&h!=m)return{...l};const p=!!Wt(l,"breakable");if(c&&p)return r.x=n.x,r.y=n.y,{...l};if(o===Ft.ISBULLET)return{...l};const b=!!Wt(l,"item");if(Ld(r,l)&&(!a||!b)){const x=Lr({x:r.x,y:r.y},n),T=Pe({x:l.x??0,y:l.y??0},x),A=cd(e,l,T);if(y(A))return{...l}}else return{...l}}const f=e.terrain[s];if(y(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??Ft.ISWALK;if($a(o,h))return{...f,x:n.x,y:n.y}}r.x=n.x,r.y=n.y,y(r.removed)||(e.lookup[i]=void 0,e.lookup[s]=r.id??"")}function UU(e,t){const n=[];if(!y(e))return n;const r=Object.values(e.objects);for(let i=0;i<r.length;++i){const s=r[i];y(s.id)&&y(s.removed)&&t-s.removed>Va*5&&(n.push(s.id),Hw(e,s.id))}return n}function FU(e,t){const n=[];if(!y(e))return n;e.lookup=void 0,Oe(e);const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const o=r[s];if(!y(o.id))continue;o.lx=o.x,o.ly=o.y;const a=ur(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=Wt(o,"cycle");if(l>u)continue}n.push({id:o.id,type:bt.OBJECT,code:c,object:o,terrain:void 0})}}const i=UU(e,t);for(let s=0;s<i.length;++s)n.push({id:i[s],type:bt.ERROR,code:"",object:void 0,terrain:void 0});return n}function Sk(e,t,n){const r=[],i=[];if(!y(e))return{objectelements:r,terrainelements:i};function s(a,c){switch(n){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=Wt(a,n);return y(l)||rn(a).name===n||Wt(a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&r.push(c)}for(let a=0;a<Lh;++a){const c=e.terrain[a];y(c)&&s(c,!0)&&i.push(c)}return{objectelements:r,terrainelements:i}}function Rk(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=re(t,{x:s,y:i});He(o)&&An(t,o,e.timestamp),Ne(t,{x:s,y:i})}}function BU(e,t,n){for(let r=t.y;r<=n.y;++r)for(let i=t.x;i<=n.x;++i)Ne(e,{x:i,y:r})}function Ok(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=re(t,{x:s,y:i});He(o)&&An(t,o,e.timestamp),Ne(t,{x:s,y:i})}}function _o(e,t){y(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function Ml(e,t,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return PU(e,t,n,"",i)}if(!y(w.book))return;const s=w.book,o=nn(s,bt.BOARD,e),a=Re(o);if(!y(a))return;const c=nn(s,bt.BOARD,t),l=Re(c);if(!y(l))return;Oe(a),Oe(l);let u=!1;if(y(a)&&y(l)){switch(i){case"all":Rk(s,l,n,r);break;case"object":Ok(s,l,n,r);break;case"terrain":BU(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:d,y:f};let b,k=re(a,p);if(He(k)?(b=ns(a,d,f),wn(k==null?void 0:k.id)&&(k=void 0)):(b=k,k=void 0),y(b)&&(m||u&&Wt(b,"group")===i)){u&&Rk(s,l,p,p);const x=zr(l,[b.kind??""],p);_o(x,b)}if(y(k)&&(h||u&&Wt(k,"group")===i)){u&&Ok(s,l,p,p);const x=zr(l,[k.kind??""],p);_o(x,k)}}Oa(l)}}function PU(e,t,n,r,i){if(!y(w.book))return;const s=w.book,o=nn(s,bt.BOARD,e),a=Re(o);if(!y(a))return;const c=nn(s,bt.BOARD,t),l=Re(c);if(y(l)&&(Oe(a),Oe(l),y(a)&&y(l))){const{terrainelements:u,objectelements:f}=Sk(a,r,i);if(u.length===0&&f.length===0)return;const d={x:At,y:Ht};for(let h=0;h<u.length;++h){const m=u[h];wt(m.x)&&(d.x=Math.min(d.x,m.x)),wt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<f.length;++h){const m=f[h];wt(m.x)&&(d.x=Math.min(d.x,m.x)),wt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},b=re(l,p);y(b)&&(He(b)&&An(l,b,s.timestamp),Ne(l,p));const k=zr(l,[m.kind??""],p);_o(k,m)}for(let h=0;h<f.length;++h){const m=f[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},b=zr(l,[m.kind??""],p);_o(b,m)}Oa(l)}}function Na(e,t){const n=Tk(e,t,"board"),r=Zn(bt.BOARD,n);return Re(r)}function $U(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Ul(e,t,n){if(!y(e))return;IU(e,t,"board",n);const r=dn(n);y(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function yo(e,t,n,r,i=!1){const s=pn(t);if(!y(e)||!y(s))return;const o=Mn(s,t);if(!He(o)||!(o!=null&&o.id))return;const a=dn(n);if(!y(a))return;Oe(a);const c=ad(a,Ft.ISWALK,r,!0);if(i===!1&&y(c))if(Wt(c,"item"))on(t,o,c,"touch");else return;delete s.objects[o.id];const l=Wr(s,o);s.lookup&&(s.lookup[l]=void 0),o.x=r.x,o.y=r.y,a.objects[o.id]=o;const u=Wr(a,o);a.lookup&&(a.lookup[u]=o.id),Ul(e,t,a.id)}function DU(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=Tk(e,r,"board");return pt(i)?i:""});return eS(n)}function bo(e){const t=DU(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=dn(t[i]);if(y(s)&&!n.has(s.id)){if(pt(s.over))if(pt(s.overboard)){const o=dn(s.overboard);y(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=dn(s.over);y(o)&&(s.overboard=o.id)}else pt(s.overboard)&&delete s.overboard;if(r.push(s),pt(s.under))if(pt(s.underboard)){const o=dn(s.underboard);y(o)||delete s.underboard}else{const o=dn(s.under);y(o)&&(s.underboard=o.id)}else pt(s.underboard)&&delete s.underboard}}return r}const jU=vm(32,126).map(e=>String.fromCharCode(e)),zU=ar({name:"Whitespace",pattern:/ +/}),WU=ar({name:"WhitespaceSkipped",pattern:/ +/,group:hn.SKIPPED}),ld=ar({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Nk=ar({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:jU}),ud=ar({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),hd=ar({name:"EscapedDollar",pattern:"$$"}),fd=ar({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),dd=ar({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Ik=ar({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function GU(e,t=""){return ar({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const Ck=Object.keys(Jo).map(e=>GU(`\\$(${e})`,e)),KU=[zU,ld,...Ck,ud,Nk,dd,hd,Ik,fd],HU=new hn(KU,{skipValidations:!Qr,ensureOptimizations:Qr}),YU=new hn([WU,ld,...Ck,ud,Nk,dd,hd,Ik,fd],{skipValidations:!Qr,ensureOptimizations:Qr}),Lk=/\$CENTER/i;function VU(e){if(Lk.test(e))return e.replace(Lk,"")}function pd(e,t=!1){return t?YU.tokenize(e):HU.tokenize(e)}function md(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Mk(e){e.active={...e.reset}}function Uk(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case hd:s("$");break;case dd:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case ud:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case ld:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=Jo[l],f=rS(Lt[u]),d=Ih(Lt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):y(f)?t.active.color=f:y(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(y(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Mk(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;qU(u,u+l.length,t.active.color,t.active.bg,t),XU(u,l,t)}}}function Fk(e,t,n){const r=pd(e);r.tokens&&(Uk(r.tokens,t),n&&Mk(t),t.changed())}function Bk(e,t,n){const r=pd(e);if(!r.tokens)return;const i=md(t,n,Lt.WHITE,Lt.BLACK);return i.measureonly=!0,Uk(r.tokens,i),i.x>0&&++i.y,i}function XU(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function qU(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Fl(e,t,n){var a;if(!y((a=w.element)==null?void 0:a.x)||!y(w.element.y))return 0;const[r,i]=rt(t,0,[K.DIR,K.MAYBE_KIND]);w.element.shootx=Ge(r.destpt.x-r.startpt.x,-1,1),w.element.shooty=Ge(r.destpt.y-r.startpt.y,-1,1);const s=i??["bullet"],o=YP(w.board,s,{x:w.element.x,y:w.element.y});if(y(o)){y(n)&&(o.arg=n),o.cycle=1,o.party=w.elementid,o.collision=Ft.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-w.element.x,o.stepy=r.destpt.y-w.element.y,o.bg=Lt.ONCLEAR;const c=ur(o),l=o.code??(c==null?void 0:c.code)??"";Fw(w.book,w.board,o,l)}return e.yield(),0}function Bl(e,t,n){var i,s;if(!qo(w.element)||!y(w.book)||!y(w.board)||!y(w.element))return 0;Oe(w.board);const[r]=rt(w.words,0,[K.ANY]);if(Dn(r)){const[o,a]=rt(e,0,[K.DIR,K.KIND]),{destpt:c}=o;if(c.x<0||c.x>=At||c.y<0||c.y>=Ht)return 0;const l=re(w.board,o.destpt);if((l==null?void 0:l.category)===Bn.ISOBJECT&&(l!=null&&l.pushable)){const d={x:((i=w.element)==null?void 0:i.x)??0,y:((s=w.element)==null?void 0:s.y)??0},h=Pe(o.destpt,Lr(d,o.destpt));cd(w.board,l,h)}const[u]=a,f=ur({kind:u});if(He(f)||zr(w.board,a,o.destpt,t),He(f)){const d=Wt(f,"collision"),h=ad(w.board,d,o.destpt);if(!y(h)){const m=zr(w.board,a,o.destpt,t);y(m)&&y(n)&&(m.arg=n)}}}return 0}function JU(e,t,n){if(!y(w.book)||!y(w.board))return 0;Oe(w.board);const[r,i]=rt(t,0,[K.DIR,K.DIR]),s=re(w.board,r.destpt);return He(s),0}const ZU={x:0,y:0},QU={x:At-1,y:Ht-1},t3="all",e3=wi().command("goto",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;const[n,r]=rt(t,0,[K.STRING]),[i,s]=rt(t,r,[K.MAYBE_NUMBER,K.MAYBE_NUMBER]),o=dn(n);if(!y(o))return 0;Oe(o);const a={x:i??o.startx??Math.round(At*.5),y:s??o.starty??Math.round(Ht*.5)},c=rn(w.element);if(c.name!=="player"){const l=Wt(w.element,"color"),u=Wt(w.element,"bg"),f=Qo(l,u),d=eu(o,[c.name,f]),[h]=d.sort((m,p)=>{const b=m.y??1e4,k=p.y??1e4,x=b-k;if(x!==0)return x;const T=m.x??1e4,A=p.x??1e4;return T-A});y(h)&&wt(h.x)&&wt(h.y)&&(a.x=h.x,a.y=h.y)}return yo(w.book,w.elementfocus,o.id,a,!0),0}).command("build",(e,t)=>{if(!y(w.book)||!y(w.board)||!y(w.element))return 0;const[n,r]=rt(t,0,[K.NAME,K.MAYBE_STRING]),i=nu();if(y(i)){if(pt(r)){const s=dn(r);y(s)&&Ml(s.id,i.id,ZU,QU,t3)}e.set(n,i.id)}return 0}).command("shove",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;Oe(w.board);const[n,r]=rt(t,0,[K.DIR,K.DIR]),i=re(w.board,n.destpt);return He(i)&&es(w.book,w.board,i,r.destpt),0}).command("duplicate",JU).command("write",(e,t)=>{var d;if(!y(w.book)||!y(w.board))return 0;Oe(w.board);const[n,r,i]=rt(t,0,[K.DIR,K.COLOR]),s=t.slice(i).map(Ae).join(" "),{color:o,bg:a}=Im(r),c=((d=Bk(s,256,1))==null?void 0:d.measuredwidth)??1,l=md(256,1,o??Lt.WHITE,a??Lt.BLACK);Fk(s,l,!1);const u=c-1;switch(Lr(n.startpt,n.destpt)){case _t.EAST:for(let h=0;h<c;++h)Ne(w.board,{x:n.destpt.x+h,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case _t.WEST:for(let h=0;h<c;++h)Ne(w.board,{x:n.destpt.x+h-u,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case _t.NORTH:for(let h=0;h<c;++h)Ne(w.board,{x:n.destpt.x,y:n.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case _t.SOUTH:for(let h=0;h<c;++h)Ne(w.board,{x:n.destpt.x,y:n.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;Oe(w.board);const[n,r]=rt(t,0,[K.KIND,K.KIND]);(Pa(n)??"")==="empty"&&c$(w.board).forEach(c=>{zr(w.board,r,c)});const s=Pa(r),o=tu(r),a=Pw(r);return eu(w.board,n).forEach(c=>{if(y(o)&&(c.color=o),y(a)&&(c.bg=a),rn(c).name!==s){const u=Wt(c,"color"),f=Wt(c,"bg");if(An(w.board,c,w.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},h=zr(w.board,r,d);y(h)&&(h.color=u,h.bg=f)}}}),0}).command("put",(e,t)=>Bl(t)).command("putwith",(e,t)=>{const[n,r]=rt(t,0,[K.ANY]);return Bl(t.slice(r),void 0,n)}).command("oneof",(e,t)=>{const[n,r]=rt(t,0,[K.ANY]);return y(w.board)&&Mn(w.board,n)?0:Bl(t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=rt(t,0,[K.ANY,K.ANY]);return y(w.board)&&Mn(w.board,r)?0:Bl(t.slice(i),r,n)}).command("shoot",Fl).command("shootwith",(e,t)=>{const[n,r]=rt(t,0,[K.ANY]);return Fl(e,t.slice(r),n)}).command("throwstar",(e,t)=>Fl(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[n,r]=rt(t,0,[K.ANY]);return Fl(e,[...t.slice(r),"star"],n)}),qi="$dkpurple",n3="$196",r3="$205",Ye="$yellow$205$205$205$196";function ke(e,t,n){QE(e,t,n)}function i3(e,t,n){const r=n3.repeat(n);ke(e,t,`${qi}${r}`)}function gd(e,t,n){const r=r3.repeat(n);ke(e,t,`${qi}${r}`)}function _d(e,t,n){ke(e,t,`${qi} ${" ".repeat(n.length)} `),i3(e,t,n.length+2),ke(e,t,`${qi} $white${n} `),gd(e,t,n.length+2)}function Rs(e,t,n){ke(e,t,`${qi} ${" ".repeat(n.length)} `),ke(e,t,`${qi} $gray${n} `),gd(e,t,n.length+2)}function Os(e,t,n,r){ke(e,t,`${qi} $white${n} $blue${r}`)}function Xn(e,t,n){ke(e,t,`${qi}$blue${n}`)}function s3(e,t,n,r){ke(e,t,`!${n};${r}`)}var o3=`desc;$DKGRAYname and type of codepage
`,a3=Object.freeze({__proto__:null,default:o3}),c3="desc;changes object into specified element",l3=Object.freeze({__proto__:null,default:c3}),u3="desc;like #play but for sound effects",h3=Object.freeze({__proto__:null,default:u3}),f3="",d3=Object.freeze({__proto__:null,default:f3}),p3="",m3=Object.freeze({__proto__:null,default:p3}),g3="",_3=Object.freeze({__proto__:null,default:g3}),y3="",b3=Object.freeze({__proto__:null,default:y3}),k3="",w3=Object.freeze({__proto__:null,default:k3}),E3="",x3=Object.freeze({__proto__:null,default:E3}),v3="",T3=Object.freeze({__proto__:null,default:v3}),A3="",S3=Object.freeze({__proto__:null,default:A3}),R3="",O3=Object.freeze({__proto__:null,default:R3}),N3="",I3=Object.freeze({__proto__:null,default:N3}),C3="",L3=Object.freeze({__proto__:null,default:C3}),M3="",U3=Object.freeze({__proto__:null,default:M3}),F3="",B3=Object.freeze({__proto__:null,default:F3}),P3="",$3=Object.freeze({__proto__:null,default:P3}),D3="",j3=Object.freeze({__proto__:null,default:D3}),z3=`desc;$DKGRAYstarts a section of an if-do-done block
`,W3=Object.freeze({__proto__:null,default:z3}),G3=`desc;$DKGRAYcompletes an if-do-done block
`,K3=Object.freeze({__proto__:null,default:G3}),H3="",Y3=Object.freeze({__proto__:null,default:H3}),V3="",X3=Object.freeze({__proto__:null,default:V3}),q3="",J3=Object.freeze({__proto__:null,default:q3}),Z3=`desc;$DKGRAYelse logic in an if-do-done block
`,Q3=Object.freeze({__proto__:null,default:Z3}),t8=`desc;$DKGRAYconditional else logic in an if-do-done block
`,e8=Object.freeze({__proto__:null,default:t8}),n8="",r8=Object.freeze({__proto__:null,default:n8}),i8="",s8=Object.freeze({__proto__:null,default:i8}),o8="",a8=Object.freeze({__proto__:null,default:o8}),c8="",l8=Object.freeze({__proto__:null,default:c8}),u8="",h8=Object.freeze({__proto__:null,default:u8}),f8="",d8=Object.freeze({__proto__:null,default:f8}),p8="",m8=Object.freeze({__proto__:null,default:p8}),g8="",_8=Object.freeze({__proto__:null,default:g8}),y8=`desc;$DKGRAYhalt until the next cycle
`,b8=Object.freeze({__proto__:null,default:y8}),k8=`desc;$DKGRAYevals condition for true or false
`,w8=Object.freeze({__proto__:null,default:k8}),E8="",x8=Object.freeze({__proto__:null,default:E8}),v8="",T8=Object.freeze({__proto__:null,default:v8}),A8="",S8=Object.freeze({__proto__:null,default:A8}),R8="",O8=Object.freeze({__proto__:null,default:R8}),N8="",I8=Object.freeze({__proto__:null,default:N8}),C8="",L8=Object.freeze({__proto__:null,default:C8}),M8="",U8=Object.freeze({__proto__:null,default:M8}),F8="",B8=Object.freeze({__proto__:null,default:F8}),P8="",$8=Object.freeze({__proto__:null,default:P8}),D8="",j8=Object.freeze({__proto__:null,default:D8}),z8="",W8=Object.freeze({__proto__:null,default:z8}),G8="",K8=Object.freeze({__proto__:null,default:G8}),H8="",Y8=Object.freeze({__proto__:null,default:H8}),V8="",X8=Object.freeze({__proto__:null,default:V8}),q8="",J8=Object.freeze({__proto__:null,default:q8}),Z8="",Q8=Object.freeze({__proto__:null,default:Z8}),t2="",e2=Object.freeze({__proto__:null,default:t2}),n2="",r2=Object.freeze({__proto__:null,default:n2}),i2="",s2=Object.freeze({__proto__:null,default:i2}),o2="",a2=Object.freeze({__proto__:null,default:o2}),c2="",l2=Object.freeze({__proto__:null,default:c2}),u2=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,h2=Object.freeze({__proto__:null,default:u2}),f2="",d2=Object.freeze({__proto__:null,default:f2}),p2="",m2=Object.freeze({__proto__:null,default:p2}),g2="",_2=Object.freeze({__proto__:null,default:g2}),y2="",b2=Object.freeze({__proto__:null,default:y2}),k2="",w2=Object.freeze({__proto__:null,default:k2}),E2="",x2=Object.freeze({__proto__:null,default:E2}),v2="",T2=Object.freeze({__proto__:null,default:v2}),A2="",S2=Object.freeze({__proto__:null,default:A2}),R2="",O2=Object.freeze({__proto__:null,default:R2}),N2="",I2=Object.freeze({__proto__:null,default:N2}),C2="",L2=Object.freeze({__proto__:null,default:C2}),M2="",U2=Object.freeze({__proto__:null,default:M2}),F2="",B2=Object.freeze({__proto__:null,default:F2}),P2="",$2=Object.freeze({__proto__:null,default:P2}),D2="",j2=Object.freeze({__proto__:null,default:D2}),z2="",W2=Object.freeze({__proto__:null,default:z2}),G2="",K2=Object.freeze({__proto__:null,default:G2}),H2="",Y2=Object.freeze({__proto__:null,default:H2}),V2="",X2=Object.freeze({__proto__:null,default:V2}),q2=`desc;$DKGRAYdesignates an inactive label or comment
`,J2=Object.freeze({__proto__:null,default:q2}),Z2=`desc;$DKGRAYadds hyperlink text

`,Q2=Object.freeze({__proto__:null,default:Z2}),tF=`desc;$DKGRAYsends the given message when hotkey is pressed

`,eF=Object.freeze({__proto__:null,default:tF}),nF=`desc;$DKGRAYread number input into given stat/flag
`,rF=Object.freeze({__proto__:null,default:nF}),iF=`desc;$DKGRAYa slider input from 1 to 9 

`,sF=Object.freeze({__proto__:null,default:iF}),oF=`desc;$DKGRAYlist with label value pairs to pick from
`,aF=Object.freeze({__proto__:null,default:oF}),cF=`desc;$DKGRAYread text input into given stat/flag
`,lF=Object.freeze({__proto__:null,default:cF}),uF=`desc;$DKGRAYdesignates a starting point for running code
`,hF=Object.freeze({__proto__:null,default:uF}),fF=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,dF=Object.freeze({__proto__:null,default:fF}),pF=`desc;$DKGRAYwill move the object in the given direction
`,mF=Object.freeze({__proto__:null,default:pF}),gF=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,_F=Object.freeze({__proto__:null,default:gF}),yF=`desc;$DKGRAYcustom 8x14 charset
`,bF=Object.freeze({__proto__:null,default:yF}),kF=`desc;$DKGRAYsets stat to given value

`,wF=Object.freeze({__proto__:null,default:kF}),EF=`desc;$DKGRAYsends the given message when hotkey is pressed

`,xF=Object.freeze({__proto__:null,default:EF}),vF=`desc;$DKGRAYread external content and/or handle events
`,TF=Object.freeze({__proto__:null,default:vF}),AF=`desc;$DKGRAYread number input into given stat/flag
`,SF=Object.freeze({__proto__:null,default:AF}),RF=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,OF=Object.freeze({__proto__:null,default:RF}),NF=`desc;$DKGRAYcustom palette colors
`,IF=Object.freeze({__proto__:null,default:NF}),CF=`desc;$DKGRAYa slider input from 1 to 9 

`,LF=Object.freeze({__proto__:null,default:CF}),MF=`desc;$DKGRAYlist with label value pairs to pick from
`,UF=Object.freeze({__proto__:null,default:MF}),FF=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,BF=Object.freeze({__proto__:null,default:FF}),PF=`desc;$DKGRAYread text input into given stat/flag
`,$F=Object.freeze({__proto__:null,default:PF}),DF=`desc;$DKGRAYadds text
`,jF=Object.freeze({__proto__:null,default:DF}),zF=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,WF=Object.freeze({__proto__:null,default:zF}),GF=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,KF=Object.freeze({__proto__:null,default:GF}),HF=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,YF=Object.freeze({__proto__:null,default:HF}),VF=`header;player settings
#set user "name goes here"
`,XF=Object.freeze({__proto__:null,default:VF}),qF=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,JF=Object.freeze({__proto__:null,default:qF});const Pk=Object.assign({"./editor/codepagename.txt":a3,"./editor/command/become.txt":l3,"./editor/command/bgplay.txt":h3,"./editor/command/bgvol.txt":d3,"./editor/command/bind.txt":m3,"./editor/command/board.txt":_3,"./editor/command/bpm.txt":b3,"./editor/command/break.txt":w3,"./editor/command/change.txt":x3,"./editor/command/char.txt":T3,"./editor/command/charset.txt":S3,"./editor/command/clear.txt":O3,"./editor/command/color.txt":I3,"./editor/command/continue.txt":L3,"./editor/command/copy.txt":U3,"./editor/command/cycle.txt":B3,"./editor/command/die.txt":$3,"./editor/command/distort.txt":j3,"./editor/command/do.txt":W3,"./editor/command/done.txt":K3,"./editor/command/duplicate.txt":Y3,"./editor/command/echo.txt":X3,"./editor/command/edge.txt":J3,"./editor/command/else.txt":Q3,"./editor/command/elseif.txt":e8,"./editor/command/end.txt":r8,"./editor/command/endgame.txt":s8,"./editor/command/endwith.txt":a8,"./editor/command/fcrush.txt":l8,"./editor/command/fetch.txt":h8,"./editor/command/fetchwith.txt":d8,"./editor/command/foreach.txt":m8,"./editor/command/go.txt":_8,"./editor/command/idle.txt":b8,"./editor/command/if.txt":w8,"./editor/command/lock.txt":x8,"./editor/command/oneof.txt":T8,"./editor/command/oneofwith.txt":S8,"./editor/command/palette.txt":O8,"./editor/command/phaser.txt":I8,"./editor/command/pivot.txt":L8,"./editor/command/play.txt":U8,"./editor/command/put.txt":B8,"./editor/command/putwith.txt":$8,"./editor/command/readbin.txt":j8,"./editor/command/readjson.txt":W8,"./editor/command/readline.txt":K8,"./editor/command/readrexpaint.txt":Y8,"./editor/command/remix.txt":X8,"./editor/command/repeat.txt":J8,"./editor/command/restore.txt":Q8,"./editor/command/reverb.txt":e2,"./editor/command/revert.txt":r2,"./editor/command/run.txt":s2,"./editor/command/runwith.txt":a2,"./editor/command/set.txt":l2,"./editor/command/shoot.txt":h2,"./editor/command/shootwith.txt":d2,"./editor/command/shove.txt":m2,"./editor/command/snapshot.txt":_2,"./editor/command/synth.txt":b2,"./editor/command/toast.txt":w2,"./editor/command/tts.txt":x2,"./editor/command/ttsvol.txt":T2,"./editor/command/twitchbroadcast.txt":S2,"./editor/command/twitchchat.txt":O2,"./editor/command/unlock.txt":I2,"./editor/command/vibrato.txt":L2,"./editor/command/vol.txt":U2,"./editor/command/waitfor.txt":B2,"./editor/command/walk.txt":$2,"./editor/command/weave.txt":j2,"./editor/command/while.txt":W2,"./editor/command/with.txt":K2,"./editor/command/write.txt":Y2,"./editor/command/zap.txt":X2,"./editor/comment.txt":J2,"./editor/hyperlink.txt":Q2,"./editor/hyperlink/hotkey.txt":eF,"./editor/hyperlink/number.txt":rF,"./editor/hyperlink/range.txt":sF,"./editor/hyperlink/select.txt":aF,"./editor/hyperlink/text.txt":lF,"./editor/label.txt":hF,"./editor/shortgo.txt":dF,"./editor/shorttry.txt":mF,"./editor/stat/board.txt":_F,"./editor/stat/charset.txt":bF,"./editor/stat/const.txt":wF,"./editor/stat/hotkey.txt":xF,"./editor/stat/loader.txt":TF,"./editor/stat/number.txt":SF,"./editor/stat/object.txt":OF,"./editor/stat/palette.txt":IF,"./editor/stat/range.txt":LF,"./editor/stat/select.txt":UF,"./editor/stat/terrain.txt":BF,"./editor/stat/text.txt":$F,"./editor/text.txt":jF,"./help/controls.txt":WF,"./help/developer.txt":KF,"./help/menu.txt":YF,"./help/player.txt":XF,"./help/text.txt":JF}),$k={};er(Pk).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");$k[t]=Pk[e].default});function ZF(e){const t=Nt(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=$k[t];if(y(n))return n;const{target:r,path:i}=Pn(t);switch(r){case"editor":{const s=Pn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function QF(e,t){const n=(e??"").split(`
`);for(let r=0;r<n.length;++r)t(n[r].split(";"))}function tB(e,t){const[n,...r]=t,i=r[0]??"",s=r[1]??"";switch(Nt(n.trim())){case"header":_d(tt,e,i);break;case"section":Rs(tt,e,i);break;case"option":Os(tt,e,i,s);break;default:n.trimStart().startsWith("!")?s3(tt,e,n.trimStart().slice(1),i):ke(tt,e,n);break}}function Ii(e){const[t,n]=rt(e,0,[K.NAME,K.ANY]);if(Nt(t)==="send"&&Dn(n)){const[,r,i,s]=rt(e,0,[K.NAME,K.DIR,K.MAYBE_NAME]);return pt(i)&&i.startsWith(":")?{targetdir:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:r,label:e.slice(s-1).join(" ")}}else if(pt(t)){const[r,i,s]=rt(e,0,[K.NAME,K.MAYBE_NAME]);if(pt(i)&&i.startsWith(":")){const a=[i.substring(1).trim(),...e.slice(s)];return{targetname:r,label:a.join(" ")}}return{targetname:"self",label:[r,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Ns(){g0(tt,Jn())}function Ia(e){QF(ZF(`help:${e}`),t=>tB(w.elementfocus,t))}function Dk(e){switch(e.label){case"helpmenu":Ia("menu");break;case"helpcontrols":Ia("controls");break;case"helptext":Ia("text");break;case"helpdeveloper":Ia("developer");break;case"helpplayer":Ia("player");break;default:{const t=le(Dt.MAIN),n=bo(t);y(e.targetname)?Ro(e.targetname,e.label,void 0,n):y(e.targetdir)&&Ro(e.targetdir.destpt,e.label,void 0,n);break}}}const eB=wi().command("shortsend",(e,t)=>{const n=Ii(t);return Dk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Dk(n),0}).command("stat",(e,t)=>{const[n,...r]=t.map(Ae),i=r.join(" ");function s(o,a){if(y(o)&&(e.command("pageopen",o.id),a)){const c=be(o),l=Oi(o);ke(tt,w.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(Nt(n)){case cr(Rt.LOADER):{const[o,a]=ts(Dt.MAIN,i,bt.LOADER);s(o,a);break}default:{const[o,a]=ts(Dt.MAIN,[n,...r].join(" "),bt.OBJECT);s(o,a);break}case cr(Rt.BOARD):{const[o,a]=ts(Dt.MAIN,i,bt.BOARD);s(o,a);break}case cr(Rt.OBJECT):{const[o,a]=ts(Dt.MAIN,i,bt.OBJECT);s(o,a);break}case cr(Rt.TERRAIN):{const[o,a]=ts(Dt.MAIN,i,bt.TERRAIN);s(o,a);break}case cr(Rt.CHARSET):{const[o,a]=ts(Dt.MAIN,i,bt.CHARSET);s(o,a);break}case cr(Rt.PALETTE):{const[o,a]=ts(Dt.MAIN,i,bt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const n=t.map(Ae).join(" ");if(y(w.element)&&w.elementisplayer){const{user:r}=Tr(w.elementid),i=pt(r)?r:"player";w.element.tickertext=`${i}: ${n}`,w.element.tickertime=w.timestamp;const s=rn(w.element);ve(tt,w.elementid,`$${Lt[s.color]}$ON${Lt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),Tu(tt,w.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Ae(n),s=Ii(r);if(y(s.targetname)){const{user:o}=Tr(w.elementid),a=pt(o)?o:"player",c=rn(w.element),l=`$${Lt[c.color]}$ON${Lt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;ve(tt,w.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[n,r]=rt(t,0,[K.MAYBE_NAME,K.MAYBE_STRING]);return pt(n)&&pt(r)?d0(tt,w.elementfocus,n,r):Cx(tt,w.elementfocus),0}).command("bookcreate",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]),r=Iw(n);return y(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=jr(n);return y(r)?(d0(tt,w.elementfocus,"selected",r.id),Ns()):de(tt,w.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=le(Dt.MAIN),i=jr(n);return y(i)&&(r===i&&Nw(Dt.MAIN,""),qP(n),ve(tt,w.elementfocus,`trashed [book] ${i.name}`),Ns(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=dn(n);return y(r)&&yo(w.book,w.elementfocus,r.id,{x:mr(0,At-1),y:mr(0,Ht-1)},!0),0}).command("pageopen",(e,t)=>{const[n,r]=rt(t,0,[K.NAME,K.MAYBE_NAME]);let i,s;const o=Dr();for(let a=0;a<o.length&&(s=o[a],i=As(s,n),!y(i));++a);if(y(i)&&y(s)){const a=be(i),c=Oi(i);ve(tt,w.elementfocus,`opened [${c}] ${a}`);const l=[i.id,r];Eh(Ya(s.id,l),i.code);const u=Oi(i);p0(tt,w.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else de(tt,"pageopen",`page ${n} not found`,w.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=fn(Dt.MAIN),i=xk(r,n);if(y(n)){const s=be(i),o=Oi(i);ve(tt,w.elementfocus,`trashed [${o}] ${s}`),Ns(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Ae).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Rs(tt,w.elementfocus,"books");const e=le(Dt.MAIN);Os(tt,w.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=le(Dt.MAIN);Os(tt,w.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),gd(tt,w.elementfocus,7);const n=Dr();return n.length?n.forEach(r=>{ke(tt,w.elementfocus,`!bookopen ${r.id};${r.name}`)}):Xn(tt,w.elementfocus,"no books found"),ke(tt,w.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=fn(Dt.MAIN);if(!y(e))return 0;Rs(tt,w.elementfocus,"pages"),Os(tt,w.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Ra(e).forEach(r=>{const i=be(r),s=Oi(r);ke(tt,w.elementfocus,`!pageopen ${r.id};$blue[${s}]$white ${i}`)}):(ke(tt,w.elementfocus,""),Xn(tt,w.elementfocus,"$white no pages found"),Xn(tt,w.elementfocus,"$white use @ to create a page"),Xn(tt,w.elementfocus,"$white @board name of board"),Xn(tt,w.elementfocus,"$white @object name of object"),Xn(tt,w.elementfocus,"$white @terrain name of terrain"),Xn(tt,w.elementfocus,"$white You can omit the type and it will default to object"),Xn(tt,w.elementfocus,"$white @object name of object"),Xn(tt,w.elementfocus,"$white @name of object"));const t=Dr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Os(tt,w.elementfocus,"content",`${r.name} $GREEN${r.id}`),Ra(r).forEach(s=>{const o=be(s),a=Oi(s);ke(tt,w.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Rs(tt,w.elementfocus,"boards");const e=fn(Dt.MAIN);if(y(e)){Os(tt,w.elementfocus,"main",`${e.name} $GREEN${e.id}`);const n=Ra(e);n.filter(r=>li(r)===bt.BOARD).forEach(r=>{const i=be(r);ke(tt,w.elementfocus,`!boardopen ${r.id};$blue[#goto]$white ${i}`)}),n.length===0&&(ke(tt,w.elementfocus,""),Xn(tt,w.elementfocus,"$white no boards found"),Xn(tt,w.elementfocus,"$white use @ to create a board"),Xn(tt,w.elementfocus,"$white @board name of board"))}const t=Dr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Os(tt,w.elementfocus,"content",`${r.name} $GREEN${r.id}`),Ra(r).filter(s=>li(s)===bt.BOARD).forEach(s=>{const o=be(s);ke(tt,w.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{Rs(tt,w.elementfocus,"$REDTRASH"),Xn(tt,w.elementfocus,"books");const e=Dr();e.length&&(e.forEach(n=>{ke(tt,w.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),ke(tt,w.elementfocus,""));const t=le(Dt.MAIN);return y(t)&&(Xn(tt,w.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=be(n);ke(tt,w.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),ke(tt,w.elementfocus,"")),0}).command("dev",()=>(Ns(),kx(tt,w.elementfocus),0)).command("share",()=>(Ns(),wx(tt,w.elementfocus),0)).command("save",()=>(Ns(),0)).command("fork",()=>($x(tt,w.elementfocus),0)).command("itchiopublish",()=>(Dx(tt,w.elementfocus),0)).command("nuke",()=>(Ex(tt,w.elementfocus),0)).command("restart",()=>(Px(tt,w.elementfocus),Ns(),0)).command("export",()=>{_d(tt,w.elementfocus,"E X P O R T"),Rs(tt,w.elementfocus,"books");const e=Dr();return e.length&&e.forEach(t=>ke(tt,w.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=jr(n);return y(r)&&(_d(tt,w.elementfocus,"E X P O R T"),Rs(tt,w.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=Ra(r);ke(tt,w.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=be(s),a=Oi(s);ke(tt,w.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=jr(n);return y(r)&&h0(tt,w.elementfocus,Sr(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=rt(t,0,[K.NAME]),{target:r,path:i}=Pn(n),s=jr(r),o=As(s,i);return y(o)&&h0(tt,w.elementfocus,Sr(o),`${be(o)}.${Oi(o)}.json`),0}).command("gadget",()=>(Lx(tt,w.elementfocus),0)).command("zztsearch",(e,t)=>{const[n,r]=rt(t,0,[K.NAME,K.MAYBE_NAME]),i=y(r)?n:"title",s=y(r)?r:n;return Mx(tt,w.elementfocus,i,s),0}).command("zztrandom",()=>(Ux(tt,w.elementfocus),0)).command("joincode",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]);return lx(tt,w.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]);return ux(tt,w.elementfocus,!!n),0}).command("startlookingglass",()=>(xx(tt,w.elementfocus),0)),nB=wi().command("toast",(e,t)=>{const n=t.map(Ae).join("");return l0(tt,w.elementfocus,n),0}).command("ticker",(e,t)=>{const n=t.map(Ae).join("");return y(w.element)&&(w.element.tickertext=n,w.element.tickertime=w.timestamp),0}).command("palette",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=Lw(),i=nn(w.book,bt.PALETTE,n);return y(i)?(r.palette=i.id,ve(tt,w.elementfocus,`loaded palette ${n}`)):de(tt,w.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=rt(t,0,[K.NAME]),r=Lw(),i=nn(w.book,bt.CHARSET,n);return y(i)?(r.charset=i.id,ve(tt,w.elementfocus,`loaded charset ${n}`)):de(tt,w.elementfocus,"not-found",`unabled to find charset ${n}`),0}),yd={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Ft.ISSOLID,Ft.ISWALK,Ft.ISSWIM,Ft.ISBULLET,Ft.ISGHOST,Ft.ISWALK,Ft.ISSWIM;function Pl(e){return ae(e)&&bd(e[0])}function bd(e){return y(Ft[e])&&pt(e)}function rB(e){if(pt(e))return yd[Nt(e)]}function iB(e){const t=w.words[e];if(Pl(t))return[t,e+1];if(bd(t))return[[t],e+1];const[n,r]=Cn(e);return Pl(n)?[n,r]:bd(n)?[[n],r]:[void 0,e]}function ko(e,t=0){const n=[];let r=e;for(;r<w.words.length;){const[i,s]=Cn(r);if(ae(i)&&!Dn(i)&&!Ca(i)&&!Pl(i)&&!Sn(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Cn(e){var r,i,s,o,a,c,l,u,f;const t=w.words[e],n=e+1;if(zk(t)){const[d,h]=sB(e);if(y(d))return[d,h]}if(rB(t)){const[d,h]=iB(e);if(y(d))return[d,h]}if(Zo(t)){const[d,h]=Oc(e);if(y(d))return[d,h]}if(pt(t)&&Nt(t)==="rnd"){const[d,h]=Cn(n),[m,p]=Cn(h);return wt(d)&&wt(m)?[mr(d,m),p]:wt(d)?[mr(0,d),h]:[mr(0,1),n]}if(Ac(t)){const[d,h]=Rm(e);if(y(d))return[d,h]}if(!y(t))return[void 0,e];if(wt(t)||ae(t))return[t,n];if(pt(t)){const d=Nt(t),h=(r=w.get)==null?void 0:r.call(w,t);if(y(h))return[h,n];switch(d){case"aligned":case"alligned":{const m=Da(w.board,{x:((i=w.element)==null?void 0:i.x)??-1,y:((s=w.element)==null?void 0:s.y)??-1},w.elementfocus);return!y(w.element)||!y(m)?[0,n]:[w.element.x===m.x||w.element.y===m.y?1:0,n]}case"contact":{const m=Da(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus);if(!y(w.element)||!y(m))return[0,n];const p=(m.x??0)-(((c=w.element)==null?void 0:c.x)??0),b=(m.y??0)-(((l=w.element)==null?void 0:l.y)??0);return[p===0&&Math.abs(b)<2||b===0&&Math.abs(p)<2?1:0,n]}case"blocked":{const[m,p]=rt(w.words,n,[K.DIR]);return[MU(w.board,w.element,m.destpt)?1:0,p]}case"any":{const[m]=rt(w.words,n,[K.ANY]);if(Dn(m)){const[x,T,A]=rt(w.words,n,[K.DIR,K.COLOR_OR_KIND]),M=x.layer===_t.MID?re(w.board,x.destpt):ns(w.board,x.destpt.x,x.destpt.y);if(y(M)){const S=rn(M);if(Sn(T))return[Sc(T)===S.color||Rc(T)===S.bg?[M]:[],A];const I=Nt(Pa(T)),$=tu(T);if((I.length&&I!==S.name||y($)&&$!==S.color)===!1)return[[M],A]}return[[],A]}const[p,b]=rt(w.words,n,[K.COLOR_OR_KIND]);return Sn(p)?[$w(w.board,p),b]:[eu(w.board,p),b]}case"countof":{const[m]=rt(w.words,n,[K.ANY]);if(Dn(m)){const[x,T,A]=rt(w.words,n,[K.DIR,K.COLOR_OR_KIND]),M=x.layer===_t.MID?re(w.board,x.destpt):ns(w.board,x.destpt.x,x.destpt.y);if(y(M)){const S=rn(M);if(Sn(T))return[Sc(T)===S.color||Rc(T)===S.bg?1:0,A];const I=Nt(Pa(T)),$=tu(T),N=I.length?I===S.name:!0,z=y($)?$===S.color:!0;if(N&&z)return[1,A]}return[0,A]}const[p,b]=rt(w.words,n,[K.COLOR_OR_KIND]);return Sn(p)?[$w(w.board,p).length,b]:[eu(w.board,p).length,b]}case"rnd":return[mr(0,1),n];case"abs":{const[m,p]=rt(w.words,n,[K.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=rt(w.words,n,[K.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=rt(w.words,n,[K.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=rt(w.words,n,[K.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,b,k]=rt(w.words,n,[K.NUMBER,K.NUMBER,K.NUMBER]);return[Ge(m,p,b),k]}case"min":{const[m,p]=ko(n);return[Math.min(...m),p]}case"max":{const[m,p]=ko(n);return[Math.max(...m),p]}case"pick":{const[m,p]=ko(n);return[gr(m),p]}case"pickwith":{const[m,p]=rt(w.words,n,[K.NUMBER_OR_STRING]),[b,k]=ko(p);return[tS(`${m}`,b),k]}case"random":{const[m,p]=ko(n,2),[b,k]=m;return[mr(b,k??0),p]}case"randomwith":{const[m,p]=rt(w.words,n,[K.NUMBER_OR_STRING]),[b,k]=ko(p,2),[x,T]=b;return[xm(`${m}`,x,T??0),k]}case"run":{const[m,p]=rt(w.words,n,[K.NAME]);return Ql(m),[(u=w.get)==null?void 0:u.call(w,"arg"),p]}case"runwith":{const[m,p,b]=rt(w.words,n,[K.ANY,K.NAME]);return y(w.element)&&(w.element.arg=m),Ql(p),[(f=w.get)==null?void 0:f.call(w,"arg"),b]}}}return[t,n]}const kd={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ca(e){return ae(e)&&jk(e[0])}function jk(e){return y(Bn[e])&&pt(e)}function zk(e){if(pt(e))return kd[Nt(e)]}function Wk(e){if(Ca(e))return e;if(jk(e))return[e];const t=zk(e);if(y(t))return[t]}function sB(e){const t=w.words[e],n=Wk(t);if(Ca(n))return[n,e+1];const[r,i]=Cn(e),s=Wk(r);return Ca(s)?[s,i]:[void 0,e]}const oB=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Gk=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"]),aB=["NORTH","SOUTH","WEST","EAST"];function cB(e){const t=Tr(e);if(wt(t.inputcurrent)||(t.inputcurrent=0),ae(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=Rn.NONE,i=0]=n??[Rn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&_S?1:0,t.inputctrl=i&yS?1:0,t.inputshift=i&bS?1:0,r){case Rn.MOVE_UP:case Rn.MOVE_DOWN:case Rn.MOVE_LEFT:case Rn.MOVE_RIGHT:t.inputmove=[aB[r-Rn.MOVE_UP]];break;case Rn.OK_BUTTON:t.inputok=1;break;case Rn.CANCEL_BUTTON:t.inputcancel=1;break;case Rn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Rn.NONE&&o!==r}),t}function lB(e){const t=kd[e];if(y(t))return t;const n=yd[e];if(y(n))return n;const r=Jo[e];if(y(r))return r;const i=Nh[e];if(y(i))return i}function Kk(){var t,n;if(An(w.board,w.element,w.timestamp),!!Wt(w.element,"item")){const r={x:((t=w.element)==null?void 0:t.x)??-1,y:((n=w.element)==null?void 0:n.y)??-1},i=Da(w.board,r,w.elementfocus);y(i)&&(i.x=r.x,i.y=r.y)}}const uB=wi({get(e,t){var l,u,f,d,h,m,p,b,k,x,T,A,M,S,I,$,N,z,J,L,O,E;const n=lB(t);if(y(n))return[!0,n];if(w.elementisplayer&&oB.has(t)){const C=cB(w.elementid)[t];return[y(C),C]}const r=Da(w.board,{x:((l=w.element)==null?void 0:l.x)??-1,y:((u=w.element)==null?void 0:u.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus??Jn(),s=(f=w.element)==null?void 0:f.sender,o=Gw(w.board,pt(s)?s:""),a=(o==null?void 0:o.id)??"";switch(t){case"camera":case"graphics":case"facing":if(y((d=w.board)==null?void 0:d[t]))return[!0,(h=w.board)==null?void 0:h[t]];break;case"isdark":return[!0,(m=w.board)!=null&&m.isdark?1:0];case"startx":return[!0,((p=w.board)==null?void 0:p.startx)??0];case"starty":return[!0,((b=w.board)==null?void 0:b.starty)??0];case"over":return[!0,((k=w.board)==null?void 0:k.over)??""];case"under":return[!0,((x=w.board)==null?void 0:x.under)??""];case"exitnorth":return[!0,((T=w.board)==null?void 0:T.exitnorth)??""];case"exitsouth":return[!0,((A=w.board)==null?void 0:A.exitsouth)??""];case"exitwest":return[!0,((M=w.board)==null?void 0:M.exitwest)??""];case"exiteast":return[!0,((S=w.board)==null?void 0:S.exiteast)??""];case"timelimit":return[!0,((I=w.board)==null?void 0:I.timelimit)??0];case"restartonzap":return[!0,(($=w.board)==null?void 0:$.restartonzap)??0];case"maxplayershots":return[!0,((N=w.board)==null?void 0:N.maxplayershots)??0];case"currenttick":return[!0,w.timestamp];case"boardid":return[!0,((z=w.board)==null?void 0:z.id)??""];case"playerid":return[!0,i];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((J=w.element)==null?void 0:J.id)??""];case"thisx":return[!0,((L=w.element)==null?void 0:L.x)??-1];case"thisy":return[!0,((O=w.element)==null?void 0:O.y)??-1];case"senderid":return[!0,a];case"senderx":return[!0,(o==null?void 0:o.x)??-1];case"sendery":return[!0,(o==null?void 0:o.y)??-1];default:{if(Gk.has(t))return[!0,((E=w.element)==null?void 0:E[t])??0];break}}const c=Tr(i)[t];return[y(c),c]},set(e,t,n){var o,a;const r=Da(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(y(w.board))return w.board.isdark=n?1:0,[!0,w.board.isdark];break;case"startx":if(y(w.board))return w.board.startx=ea(n,0),[!0,w.board.startx];break;case"starty":if(y(w.board))return w.board.starty=ea(n,0),[!0,w.board.starty];break;case"over":if(y(w.board))return w.board.over=Ae(n),[!0,w.board.over];break;case"under":if(y(w.board))return[!0,w.board.under=Ae(n)];break;case"exitnorth":if(y(w.board))return[!0,w.board.exitnorth=Ae(n)];break;case"exitsouth":if(y(w.board))return[!0,w.board.exitsouth=Ae(n)];break;case"exitwest":if(y(w.board))return[!0,w.board.exitwest=Ae(n)];break;case"exiteast":if(y(w.board))return[!0,w.board.exiteast=Ae(n)];break;case"timelimit":if(y(w.board))return[!0,w.board.timelimit=ea(n,0)];break;case"restartonzap":if(y(w.board))return[!0,w.board.restartonzap=n?1:0];break;case"maxplayershots":if(y(w.board))return[!0,w.board.maxplayershots=ea(n,0)];break;case"currenttick":return[!1,n];case"boardid":return[!1,n];case"playerid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];case"senderid":return[!1,n];case"senderx":return[!1,n];case"sendery":return[!1,n];default:{if(Gk.has(t))return y(w.element)&&(w.element[t]=n),[!0,n];break}}const s=Tr(i);return y(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=w.element)!=null&&e.removed)&&(y((t=w.element)==null?void 0:t.stepx)||y((n=w.element)==null?void 0:n.stepy))){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};es(w.book,w.board,w.element,{x:s.x+(w.element.stepx??0),y:s.y+(w.element.stepy??0)})===!1&&Wt(w.element,"breakable")&&An(w.board,w.element,w.timestamp)}}}).command("clear",(e,t)=>{for(let n=0;n<t.length;++n)e.set(Ae(t[n]),0);return 0}).command("set",(e,t)=>{const[n,r]=rt(t,0,[K.NAME,K.ANY]);return e.set(n,r??1),0}).command("become",(e,t)=>{var c,l;const[n]=rt(t,0,[K.KIND]);Oe(w.board);const r=rn(w.element),[i,s]=n,o=[...Qo(r.color,r.bg),...s??[]],a=[i,o];if(od(w.board,w.element),An(w.board,w.element,w.timestamp)){const u={x:((c=w.element)==null?void 0:c.x)??0,y:((l=w.element)==null?void 0:l.y)??0};zr(w.board,a,u)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=rt(t,0,[K.ANY]);if(Dn(n)){const[r,i]=rt(t,0,[K.DIR,K.NUMBER]),s=re(w.board,r.destpt);y(s)&&(s.char=i)}else y(w.element)&&wt(n)&&(w.element.char=n);return 0}).command("color",(e,t)=>{const[n]=rt(t,0,[K.ANY]);if(Dn(n)){const[r,i]=rt(t,0,[K.DIR,K.COLOR]),s=re(w.board,r.destpt);y(s)&&oa(w.element,i)}else{const[r]=rt(t,0,[K.COLOR]);y(w.element)&&y(r)&&oa(w.element,r)}return 0}).command("go",(e,t)=>{if(y(w.element)){const[n]=rt(t,0,[K.DIR]);if(es(w.book,w.board,w.element,n.destpt),e.yield(),w.element.x===n.destpt.x&&w.element.y===n.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!y(w.element))return 0;const[n]=rt(t,0,[K.DIR]),r=w.element.x??0,i=w.element.y??0;return w.element.stepx=n.destpt.x-r,w.element.stepy=n.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=rt(t,0,[K.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Ae(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Ae(t[0])),0)).command("cycle",(e,t)=>{if(y(w.element)){const[n]=rt(t,0,[K.NUMBER]);w.element.cycle=Ge(Math.round(n),1,255)}return 0}).command("die",e=>(Kk(),e.endofprogram(),0)).command("dieonend",()=>(Kk(),0)).command("endgame",()=>(vu(tt,w.elementfocus),0)).command("run",(e,t)=>{const[n]=rt(t,0,[K.NAME]);return Ql(n),0}).command("runwith",(e,t)=>{const[n,r]=rt(t,0,[K.ANY,K.NAME]);return e.set("arg",n),Ql(r),0}),$l={};function hB(e){var t;return(t=$l[e])==null?void 0:t.arg}function fB(e){var t;return(t=$l[e])==null?void 0:t.format}function wo(e){var t;return(t=$l[e])==null?void 0:t.content}function Hk(e,t,n,r,i){const s=le(Dt.MAIN);if(!y(s))return;const o=Ss(s,bt.LOADER).filter(a=>{const c=Ts(a),l=c.format,u=pt(l)?new RegExp(l).test(t):!1,f=c.event,d=pt(f)?new RegExp(f).test(n):!1;return pt(l)&&pt(f)?u&&d:pt(l)?u:pt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${ze()}_loader`;$l[c]={arg:e,format:t,content:r,player:i},e$(c,o[a].code)}}function Yk(e,t){if(!y(e))return;const n=Nt(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const dB=(e,t)=>{const n=wo(e.id());if(!y(n))return 0;const[r,i]=rt(t,0,[K.NAME]),s=Nt(r);switch(s){case"seek":{const[o]=rt(t,i,[K.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(t,i,[K.NAME]);e.set(o,Yk(n,s));break}case"text":{const[o,a]=rt(t,i,[K.NAME,K.NAME]),c=Yk(n,o);if(wt(c)&&pt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);e.set(a,f),n.cursor+=c}break}case"palette":{const[o]=rt(t,i,[K.NAME]),[a]=id(w.book,bt.PALETTE,o),c=Re(a);if(y(c)){const l=uS*Nc,u=hg(new Uint8Array(n.bytes.buffer,n.cursor,l));y(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=rt(t,i,[K.NAME]),[a]=id(w.book,bt.CHARSET,o),c=Re(a);if(y(c)){const l=Ic*lS*Mh,u=fg(new Uint8Array(n.bytes.buffer,n.cursor,l));y(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},Eo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Dl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Dl(e[n],t[n]))return!1;return!0}if(Eo(e)&&Eo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Dl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},jl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(Eo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},pB=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Vk=e=>e>="0"&&e<="9"||e==="-",mB=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var q;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(q||(q={}));const Xk={"(":q.TOK_LPAREN,")":q.TOK_RPAREN,"*":q.TOK_STAR,",":q.TOK_COMMA,".":q.TOK_DOT,":":q.TOK_COLON,"@":q.TOK_CURRENT,$:q.TOK_ROOT,"]":q.TOK_RBRACKET,"{":q.TOK_LBRACE,"}":q.TOK_RBRACE},gB={"!":!0,"<":!0,"=":!0,">":!0},_B={"	":!0,"\n":!0,"\r":!0," ":!0};class yB{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(pB(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:q.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Xk[t[this._current]]!==void 0)n.push({start:this._current,type:Xk[t[this._current]],value:t[this._current]}),this._current+=1;else if(Vk(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:q.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:q.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:q.TOK_LITERAL,value:o})}else if(gB[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(_B[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:q.TOK_AND,value:"&&"})):n.push({start:r,type:q.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:q.TOK_OR,value:"||"})):n.push({start:r,type:q.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&mB(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Vk(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:q.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:q.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:q.TOK_FLATTEN,value:"[]"}):{start:n,type:q.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_NE,value:"!="}):{start:n,type:q.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_LTE,value:"<="}):{start:n,type:q.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_GTE,value:">="}):{start:n,type:q.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:q.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const bB=new yB,vn={[q.TOK_EOF]:0,[q.TOK_UNQUOTEDIDENTIFIER]:0,[q.TOK_QUOTEDIDENTIFIER]:0,[q.TOK_RBRACKET]:0,[q.TOK_RPAREN]:0,[q.TOK_COMMA]:0,[q.TOK_RBRACE]:0,[q.TOK_NUMBER]:0,[q.TOK_CURRENT]:0,[q.TOK_EXPREF]:0,[q.TOK_ROOT]:0,[q.TOK_PIPE]:1,[q.TOK_OR]:2,[q.TOK_AND]:3,[q.TOK_EQ]:5,[q.TOK_GT]:5,[q.TOK_LT]:5,[q.TOK_GTE]:5,[q.TOK_LTE]:5,[q.TOK_NE]:5,[q.TOK_FLATTEN]:9,[q.TOK_STAR]:20,[q.TOK_FILTER]:21,[q.TOK_DOT]:40,[q.TOK_NOT]:45,[q.TOK_LBRACE]:50,[q.TOK_LBRACKET]:55,[q.TOK_LPAREN]:60};class kB{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==q.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...bB.tokenize(t),{type:q.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<vn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case q.TOK_LITERAL:return{type:"Literal",value:t.value};case q.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case q.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===q.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case q.TOK_NOT:return r=this.expression(vn.Not),{type:"NotExpression",children:[r]};case q.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===q.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(vn.Star),{type:"ValueProjection",children:[n,r]};case q.TOK_FILTER:return this.led(t.type,{type:"Identity"});case q.TOK_LBRACE:return this.parseMultiselectHash();case q.TOK_FLATTEN:return n={type:q.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(vn.Flatten),{type:"Projection",children:[n,r]};case q.TOK_LBRACKET:return this.lookahead(0)===q.TOK_NUMBER||this.lookahead(0)===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===q.TOK_STAR&&this.lookahead(1)===q.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(vn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case q.TOK_CURRENT:return{type:q.TOK_CURRENT};case q.TOK_ROOT:return{type:q.TOK_ROOT};case q.TOK_EXPREF:return i=this.expression(vn.Expref),{type:"ExpressionReference",children:[i]};case q.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(i={type:q.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(q.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case q.TOK_DOT:const i=vn.Dot;return this.lookahead(0)!==q.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case q.TOK_PIPE:return r=this.expression(vn.Pipe),{type:q.TOK_PIPE,children:[n,r]};case q.TOK_OR:return r=this.expression(vn.Or),{type:"OrExpression",children:[n,r]};case q.TOK_AND:return r=this.expression(vn.And),{type:"AndExpression",children:[n,r]};case q.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(a={type:q.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===q.TOK_COMMA&&this.match(q.TOK_COMMA),o.push(a);return this.match(q.TOK_RPAREN),{name:s,type:"Function",children:o};case q.TOK_FILTER:const l=this.expression(0);return this.match(q.TOK_RBRACKET),r=this.lookahead(0)===q.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(vn.Filter),{type:"FilterProjection",children:[n,r,l]};case q.TOK_FLATTEN:const u={type:q.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(vn.Flatten);return{type:"Projection",children:[u,f]};case q.TOK_EQ:case q.TOK_NE:case q.TOK_GT:case q.TOK_GTE:case q.TOK_LT:case q.TOK_LTE:return this.parseComparator(n,t);case q.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===q.TOK_NUMBER||d.type===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(q.TOK_STAR),this.match(q.TOK_RBRACKET),r=this.parseProjectionRHS(vn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===q.TOK_COLON||this.lookahead(1)===q.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(q.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(vn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==q.TOK_RBRACKET&&n<3;){if(r===q.TOK_COLON)n+=1,this.advance();else if(r===q.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(q.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(vn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER,q.TOK_STAR].includes(n))return this.expression(t);if(n===q.TOK_LBRACKET)return this.match(q.TOK_LBRACKET),this.parseMultiselectList();if(n===q.TOK_LBRACE)return this.match(q.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(vn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===q.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===q.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===q.TOK_DOT)return this.match(q.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==q.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===q.TOK_COMMA&&(this.match(q.TOK_COMMA),this.lookahead(0)===q.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(q.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(q.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===q.TOK_COMMA)this.match(q.TOK_COMMA);else if(this.lookahead(0)===q.TOK_RBRACE){this.match(q.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const wB=new kB;var ft;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ft||(ft={}));class EB{constructor(t){this.TYPE_NAME_TABLE={[ft.TYPE_NUMBER]:"number",[ft.TYPE_ANY]:"any",[ft.TYPE_STRING]:"string",[ft.TYPE_ARRAY]:"array",[ft.TYPE_OBJECT]:"object",[ft.TYPE_BOOLEAN]:"boolean",[ft.TYPE_EXPREF]:"expression",[ft.TYPE_NULL]:"null",[ft.TYPE_ARRAY_NUMBER]:"Array<number>",[ft.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>Eo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ft.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ft.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ft.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ft.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ft.TYPE_NUMBER,ft.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ft.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ft.TYPE_NUMBER?n:r===ft.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ft.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ft.TYPE_NUMBER:return"number";case ft.TYPE_STRING:return"string";case ft.TYPE_ARRAY:return"array";case ft.TYPE_OBJECT:return"object";case ft.TYPE_BOOLEAN:return"boolean";case ft.TYPE_EXPREF:return"expref";case ft.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ft.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ft.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]},{types:[ft.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ft.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ft.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY,ft.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ft.TYPE_EXPREF]},{types:[ft.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ft.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ft.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ft.TYPE_ARRAY_STRING,ft.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ft.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ft.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ft.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ft.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ft.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(p=>{var b;return(b=!p.optional)!==null&&b!==void 0?b:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,m;for(let p=0;p<r.length;p+=1){m=!1,d=r[p].types,h=this.getTypeName(n[p]);let b;for(b=0;b<d.length;b+=1)if(h!==void 0&&this.typeMatches(h,d[b],n[p])){m=!0;break}if(!m&&h!==void 0){const k=d.map(x=>this.TYPE_NAME_TABLE[x]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${k}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(t,n,r){if(n===ft.TYPE_ANY)return!0;if(n===ft.TYPE_ARRAY_STRING||n===ft.TYPE_ARRAY_NUMBER||n===ft.TYPE_ARRAY){if(n===ft.TYPE_ARRAY)return t===ft.TYPE_ARRAY;if(t===ft.TYPE_ARRAY){let i;n===ft.TYPE_ARRAY_NUMBER?i=ft.TYPE_NUMBER:n===ft.TYPE_ARRAY_STRING&&(i=ft.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ft.TYPE_STRING;case"[object Number]":return ft.TYPE_NUMBER;case"[object Array]":return ft.TYPE_ARRAY;case"[object Boolean]":return ft.TYPE_BOOLEAN;case"[object Null]":return ft.TYPE_NULL;case"[object Object]":return t.jmespathType===q.TOK_EXPREF?ft.TYPE_EXPREF:ft.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class xB{constructor(){this._rootValue=null,this.runtime=new EB(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,f,d,h;switch(t.type){case"Field":return n===null?null:Eo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let m=t.value;return m<0&&(m=n.length+m),s=n[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const p=[...t.children],b=this.computeSliceParams(n.length,p),[k,x,T]=b;if(s=[],T>0)for(d=k;d<x;d+=T)s.push(n[d]);else for(d=k;d>x;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(t.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(t.children[0],n),!Eo(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(t.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;const M=[],S=[];for(d=0;d<h.length;d+=1)r=this.visit(t.children[2],h[d]),jl(r)||M.push(h[d]);for(let L=0;L<M.length;L+=1)i=this.visit(t.children[1],M[L]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case q.TOK_EQ:s=Dl(o,a);break;case q.TOK_NE:s=!Dl(o,a);break;case q.TOK_GT:s=o>a;break;case q.TOK_GTE:s=o>=a;break;case q.TOK_LT:s=o<a;break;case q.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case q.TOK_FLATTEN:const I=this.visit(t.children[0],n);if(!Array.isArray(I))return null;let $=[];for(d=0;d<I.length;d+=1)i=I[d],Array.isArray(i)?$=[...$,...i]:$.push(i);return $;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<t.children.length;d+=1)f.push(this.visit(t.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let N;for(d=0;d<t.children.length;d+=1)N=t.children[d],f[N.name]=this.visit(N.value,n);return f;case"OrExpression":return r=this.visit(t.children[0],n),jl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),jl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),jl(o);case"Literal":return t.value;case q.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case q.TOK_CURRENT:return n;case q.TOK_ROOT:return this._rootValue;case"Function":const z=[];for(let L=0;L<t.children.length;L+=1)z.push(this.visit(t.children[L],n));return this.runtime.callFunction(t.name,z);case"ExpressionReference":const J=t.children[0];return J.jmespathType=q.TOK_EXPREF,J;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const vB=new xB;ft.TYPE_ANY,ft.TYPE_ARRAY,ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING,ft.TYPE_BOOLEAN,ft.TYPE_EXPREF,ft.TYPE_NULL,ft.TYPE_NUMBER,ft.TYPE_OBJECT,ft.TYPE_STRING;function TB(e,t){const n=wB.parse(t);return vB.search(n,e)}const AB=(e,t)=>{const n=wo(e.id());if(!y(n))return 0;const[r,i]=rt(t,0,[K.NAME,K.NAME]),s=TB(n.json,r);return e.set(i,s),0},SB=(e,t)=>{const n=wo(e.id());if(!y(n))return 0;const[r,i]=rt(t,0,[K.NAME]);switch(Nt(r)){case"seek":{const[o]=rt(t,i,[K.NUMBER]);n.cursor=Ge(o,0,n.lines.length-1);break}case"line":n.cursor=Ge(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[f,d]=rt(t,u,[K.NAME]);e.set(f,c[l]??0),++l,u=d}break}}return 0};function qk(e){const t=le(Dt.MAIN),n=bo(t);y(e.targetdir)?Ro(e.targetdir.destpt,e.label,void 0,n):y(e.targetname)&&Ro(e.targetname,e.label,void 0,n)}const RB=wi({get(e,t){const n=fB(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=wo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=wo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=wo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const n=Ii(t);return qk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return qk(n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Ae).join(" ");return ve(tt,w.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Ae(n),s=Ii(r);return y(s.targetname)&&ve(tt,w.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",SB).command("readjson",AB).command("readbin",dB).command("withboard",(e,t)=>{const[n]=rt(t,0,[K.STRING]),r=dn(n);return y(r)&&(w.board=r,w.element={x:-1,y:-1}),0});function Jk(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=rt(i,a,[K.ANY]);ae(c)&&!Dn(c)&&!Ca(c)&&!Pl(c)&&!Sn(c)?o.push(...c):o.push(c),a=l}switch(Nt(r)){case"get":case"post:json":ix(tt,w.elementfocus,e,t,n,r,o);break}return 0}const OB=wi().command("fetch",(e,t)=>{const[n,r,i="get",s]=rt(t,0,[K.NAME,K.NAME,K.MAYBE_STRING]);return Jk(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=rt(t,0,[K.ANY,K.NAME,K.NAME,K.MAYBE_STRING]);return Jk(n,r,i,s,t,o),0}).command("chat",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]);return n?nx(tt,w.elementfocus,n):rx(tt,w.elementfocus),0}).command("broadcast",(e,t)=>{const[n]=rt(t,0,[K.MAYBE_NAME]);return n?tx(tt,w.elementfocus,n):ex(tt,w.elementfocus),0});function Zk(e,t){var n;if(y(t.targetname)){const r=Object.keys(((n=w.board)==null?void 0:n.objects)??{});switch(t.targetname){case"all":for(let i=0;i<r.length;++i){const s=r[i];e.send(w.elementfocus,s,t.label)}break;case"others":for(let i=0;i<r.length;++i){const s=r[i];s!==e.id()&&e.send(w.elementfocus,s,t.label)}break;case"self":e.message({session:tt.session(),player:w.elementfocus,id:ze(),sender:e.id(),target:t.label});break;default:{const i=Dw(w.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];y(o.id)&&e.send(w.elementfocus,o.id,t.label)}break}}}else if(y(t.targetdir)){const r=re(w.board,t.targetdir.destpt);y(r==null?void 0:r.id)&&e.send(w.elementfocus,r.id,t.label)}}const NB=wi({set(e,t,n){return k$(e,t,n),[!1,void 0]},everytick(){const e=gn(w.elementid),[t]=e;if(e.length===1&&pt(t)){if(y(w.element))if(t.trim().length===0){const n=Fe(w.elementid);n.sidebar=[]}else w.element.tickertext=t,w.element.tickertime=w.timestamp}else if(e.length>1)if(w.elementisplayer){const n=Fe(w.elementid);n.sidebar=qw(e)}else{const n=Fe(w.elementfocus);n.scrollname=rn(w.element).name,n.scroll=qw(e)}}}).command("shortsend",(e,t)=>{const n=Ii(t);return Zk(e,n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Zk(e,n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Ae).join("");return Tt(w.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Ae(n),s=Ii(r);return y(s.targetname)&&Ct(w.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function IB(e,t,n,r,i){if(!y(w.book))return;const s=w.book,o=nn(s,bt.BOARD,e),a=Re(o);if(!y(a))return;const c=nu(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Oe(a),Oe(c);const f=-Math.tan(t*.5),d=Math.sin(t),h=Math.round(12.5*f),m=Math.round(12.5*d),p=new Array(Ht).fill(0);pm(h,0,-h,Ht-1).forEach(A=>{A.x<0?p[A.y]=Math.min(p[A.y],A.x):p[A.y]=Math.max(p[A.y],A.x)});const k=new Array(At).fill(0);pm(0,m,At-1,-m).forEach(A=>{A.y<0?k[A.x]=Math.min(k[A.x],A.y):k[A.x]=Math.max(k[A.x],A.y)});const T=[p,k,p];for(let A=0;A<T.length;++A){const M=T[A];if(A!==1){for(let S=0;S<Ht;++S){const I=M[S],$=S*At;for(let N=0;N<At;N++){const z=(N+I+At)%At;u&&(c.terrain[z+$]=a.terrain[N+$])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const $=S[I],{x:N,y:z}=a.objects[$];if(y(N)&&y(z)){const J=M[z];a.objects[$].x=(N+J+At)%At,a.objects[$].lx=a.objects[$].x}}}}if(A===1){for(let S=0;S<At;++S){const I=M[S];for(let $=0;$<Ht;++$){const N=($+I+Ht)%Ht;u&&(c.terrain[S+N*At]=a.terrain[S+$*At])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const $=S[I],{x:N,y:z}=a.objects[$];if(y(N)&&y(z)){const J=M[N];a.objects[$].y=(z+J+Ht)%Ht,a.objects[$].ly=a.objects[$].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Oe(c),Oe(a)}}function CB(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var LB=CB;const MB=LB,ee=function(){};ee.prototype.FMX=0,ee.prototype.FMY=0,ee.prototype.FMXxFMY=0,ee.prototype.T=0,ee.prototype.N=0,ee.prototype.initiliazedField=!1,ee.prototype.generationComplete=!1,ee.prototype.wave=null,ee.prototype.compatible=null,ee.prototype.weightLogWeights=null,ee.prototype.sumOfWeights=0,ee.prototype.sumOfWeightLogWeights=0,ee.prototype.startingEntropy=0,ee.prototype.sumsOfOnes=null,ee.prototype.sumsOfWeights=null,ee.prototype.sumsOfWeightLogWeights=null,ee.prototype.entropies=null,ee.prototype.propagator=null,ee.prototype.observed=null,ee.prototype.distribution=null,ee.prototype.stack=null,ee.prototype.stackSize=0,ee.prototype.DX=[-1,0,1,0],ee.prototype.DY=[0,1,0,-1],ee.prototype.opposite=[2,3,0,1],ee.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},ee.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=MB(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},ee.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],m=f[h];m[i]--,m[i]==0&&this.ban(l,h)}}}},ee.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},ee.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},ee.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},ee.prototype.isGenerationComplete=function(){return this.generationComplete},ee.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},ee.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Qk=ee;const tw=Qk,Ci=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let N=0;N<f;N++)d[N]=new Array(r);this.colors=[];const h={};for(let N=0;N<r;N++)for(let z=0;z<n;z++){const J=(N*n+z)*4,L=[t[J],t[J+1],t[J+2],t[J+3]],O=L.join("-");h.hasOwnProperty(O)||(h[O]=this.colors.length,this.colors.push(L)),d[z][N]=h[O]}const m=this.colors.length,p=Math.pow(m,i*i),b=function(z){let J=new Array(i*i);for(let L=0;L<i;L++)for(let O=0;O<i;O++)J[O+L*i]=z(O,L);return J},k=function(z,J){return b(function(L,O){return d[(z+L)%n][(J+O)%r]})},x=function(z){return b(function(J,L){return z[i-1-L+J*i]})},T=function(z){return b(function(J,L){return z[i-1-J+L*i]})},A=function(z){let J=0,L=1;for(let O=0;O<z.length;O++)J+=z[z.length-1-O]*L,L*=m;return J},M=function(z){let J=z,L=p;const O=new Array(i*i);for(let E=0;E<O.length;E++){L/=m;let C=0;for(;J>=L;)J-=L,C++;O[E]=C}return O},S={},I=[];for(let N=0;N<(a?r:r-i+1);N++)for(let z=0;z<(a?n:n-i+1);z++){const J=new Array(8);J[0]=k(z,N),J[1]=T(J[0]),J[2]=x(J[0]),J[3]=T(J[2]),J[4]=x(J[2]),J[5]=T(J[4]),J[6]=x(J[4]),J[7]=T(J[6]);for(let L=0;L<l;L++){const O=A(J[L]);S[O]?S[O]++:(I.push(O),S[O]=1)}}this.T=I.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const z=parseInt(I[N],10);this.patterns[N]=M(z),this.weights[N]=S[z]}const $=function(z,J,L,O){const E=L<0?0:L,C=L<0?L+i:i,P=O<0?0:O,F=O<0?O+i:i;for(let st=P;st<F;st++)for(let et=E;et<C;et++)if(z[et+i*st]!=J[et-L+i*(st-O)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let z=0;z<this.T;z++){const J=[];for(let L=0;L<this.T;L++)$(this.patterns[z],this.patterns[L],this.DX[N],this.DY[N])&&J.push(L);this.propagator[N][z]=J}}};Ci.prototype=Object.create(tw.prototype),Ci.prototype.constructor=Ci,Ci.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ci.prototype.clear=function(){if(tw.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ci.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ci.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ci.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const m=d+h*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const b=this.colors[this.patterns[p][f+u*this.N]];s+=b[0],o+=b[1],a+=b[2],c+=b[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var UB=Ci;const FB=Qk,Ji=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(A){const M=new Array(o*o);for(let S=0;S<o;S++)for(let I=0;I<o;I++)M[I+S*o]=A(I,S);return M},u=function(A){return l(function(M,S){return A[o-1-S+M*o]})},f=function(A){return l(function(M,S){return A[o-1-M+S*o]})};this.tiles=[];const d=[],h=[],m={};let p,b,k;for(let T=0;T<t.tiles.length;T++){const A=t.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":k=4,p=function(S){return(S+1)%4},b=function(S){return S%2===0?S+1:S-1};break;case"T":k=4,p=function(S){return(S+1)%4},b=function(S){return S%2===0?S:4-S};break;case"I":k=2,p=function(S){return 1-S},b=function(S){return S};break;case"\\":k=2,p=function(S){return 1-S},b=function(S){return 1-S};break;case"F":k=8,p=function(S){return S<4?(S+1)%4:4+(S-1)%4},b=function(S){return S<4?S+4:S-4};break;default:k=1,p=function(S){return S},b=function(S){return S};break}this.T=h.length,m[A.name]=this.T;for(let S=0;S<k;S++)h.push([this.T+S,this.T+p(S),this.T+p(p(S)),this.T+p(p(p(S))),this.T+b(S),this.T+b(p(S)),this.T+b(p(p(S))),this.T+b(p(p(p(S))))]);let M;if(a)for(let S=0;S<k;S++)M=A.bitmap[S],this.tiles.push(l(function(I,$){return[M[(o*$+I)*4],M[(o*$+I)*4+1],M[(o*$+I)*4+2],M[(o*$+I)*4+3]]}));else{M=A.bitmap,this.tiles.push(l(function(S,I){return[M[(o*I+S)*4],M[(o*I+S)*4+1],M[(o*I+S)*4+2],M[(o*I+S)*4+3]]}));for(let S=1;S<k;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):f(this.tiles[this.T+S-4]))}for(let S=0;S<k;S++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const x=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),x[T]=new Array(this.T);for(let A=0;A<this.T;A++){x[T][A]=new Array(this.T);for(let M=0;M<this.T;M++)x[T][A][M]=!1}}for(let T=0;T<t.neighbors.length;T++){const A=t.neighbors[T],M=A.left.split(" ").filter(function(J){return J.length}),S=A.right.split(" ").filter(function(J){return J.length});if(c!==null&&(c.indexOf(M[0])===-1||c.indexOf(S[0])===-1))continue;const I=h[m[M[0]]][M.length==1?0:parseInt(M[1],10)],$=h[I][1],N=h[m[S[0]]][S.length==1?0:parseInt(S[1],10)],z=h[N][1];x[0][N][I]=!0,x[0][h[N][6]][h[I][6]]=!0,x[0][h[I][4]][h[N][4]]=!0,x[0][h[I][2]][h[N][2]]=!0,x[1][z][$]=!0,x[1][h[$][6]][h[z][6]]=!0,x[1][h[z][4]][h[$][4]]=!0,x[1][h[$][2]][h[z][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)x[2][T][A]=x[0][A][T],x[3][T][A]=x[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const M=[],S=x[T][A];for(let I=0;I<this.T;I++)S[I]&&M.push(I);this.propagator[T][A]=M}};Ji.prototype=Object.create(FB.prototype),Ji.prototype.constructor=Ji,Ji.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Ji.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Ji.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Ji.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let f=0,d=0,h=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const b=this.tiles[p][l+c*this.tilesize],k=this.weights[p]*a;f+=b[0]*k,d+=b[1]*k,h+=b[2]*k,m+=b[3]*k}e[u]=f,e[u+1]=d,e[u+2]=h,e[u+3]=m}}}};var BB=Ji,PB={OverlappingModel:UB,SimpleTiledModel:BB},$B=Us(PB);const ew=5;function nw(e,t,n,r,i,s,o){if(!y(w.book))return!1;const a=w.book,c=nn(a,bt.BOARD,e),l=nn(a,bt.BOARD,t),u=Re(c),f=Re(l);if(!y(u)||!y(f))return!1;Oe(u),Oe(f);let d=0;const h=new Map,m=new Map;let p=0;const b=32,k=new Uint8Array(Lh*4);for(let I=0;I<Ht;++I)for(let $=0;$<At;++$){const N=re(f,{x:$,y:I}),z=(N==null?void 0:N.char)??0,J=(N==null?void 0:N.color)??b,L=(N==null?void 0:N.bg)??b;k[p++]=z,k[p++]=J,k[p++]=L;const O=ur(N),E=Nt((O==null?void 0:O.name)??"empty"),C=h.get(E);wt(C)?k[p++]=C:(h.set(E,d),m.set(d,E),k[p++]=d++)}const x=s.x-i.x+1,T=s.y-i.y+1,A=new $B.OverlappingModel(k,At,Ht,n,x,T,!1,!1,r,0);let M=0;for(;M<ew&&!A.generate();++M);if(M===ew)return!1;p=0;const S=A.graphics();for(let I=i.y;I<=s.y;++I)for(let $=i.x;$<=s.x;++$){const N={x:$,y:I},z=S[p++],J=S[p++],L=S[p++];switch(d=S[p++],o){case"all":{const P=re(u,{x:$,y:I});He(P)&&An(u,P,a.timestamp),Ne(u,{x:$,y:I});break}case"object":{const P=re(u,{x:$,y:I});He(P)&&An(u,P,a.timestamp);break}case"terrain":Ne(u,{x:$,y:I});break}let O=m.get(d)??"";const E=ur({kind:O});switch(o){case"all":break;case"object":He(E)||(O="");break;case"terrain":He(E)&&(O="");break;default:if(Wt(E,"group")!==o&&(O=""),O){const P=re(u,{x:$,y:I});He(P)&&An(u,P,a.timestamp),Ne(u,{x:$,y:I})}break}const C=O?zr(u,[O],N):void 0;if(!(!y(C)||!y(E))&&(_o(C,E),z>0&&(C.char=z),J<b&&(C.color=J),L<b&&(C.bg=L),He(C))){const P=gr(ja(f,O));y(P)&&(Ne(u,{...ns(f,P.x??0,P.y??0),x:$,y:I}),_o(C,P))}}return!0}function rw(e){return`zss_snapshot_${e}`}const iw={x:0,y:0},sw={x:At-1,y:Ht-1},ow="all";function DB(e){const t=nn(w.book,bt.BOARD,e),n=Re(t);if(!y(n))return;const r=rw(n.id);xk(w.book,r);const[i]=ts(Dt.MAIN,r,bt.BOARD),s=Re(i);if(y(s))return Ml(e,s.id,iw,sw,ow),s}function jB(e){const t=nn(w.book,bt.BOARD,e),n=Re(t);if(!y(n))return;const r=rw(n.id),i=nn(w.book,bt.BOARD,r),s=Re(i);if(y(s))return Ml(s.id,e,iw,sw,ow),s}function zB(e,t,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return WB(e,t,i,s)}if(!y(w.book))return;const o=w.book,a=nn(o,bt.BOARD,e),c=Re(a);if(!y(c))return;const l=nu();Oe(c);for(let u=n.y;u<=r.y;++u)for(let f=n.x;f<=r.x;++f){let d=!1,h=!1;switch(s){case"all":d=!0,h=!0;break;case"object":d=!0;break;case"terrain":h=!0;break}const m=(f+t.x+At)%At,p=(u+t.y+Ht)%Ht;if(d){const b=re(c,{x:f,y:u});He(b)&&y(b==null?void 0:b.x)&&y(b==null?void 0:b.y)&&(b.x=m,b.lx=m,b.y=p,b.ly=p)}h&&(l.terrain[m+p*At]=c.terrain[f+u*At])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),Oa(c)}function WB(e,t,n,r){if(!y(w.book))return;const i=w.book,s=nn(i,bt.BOARD,e),o=Re(s);if(!y(o))return;Oe(o);const{terrainelements:a,objectelements:c}=Sk(o,n,r);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>$n({x:p.x??0,y:p.y??0},At)),f=[],d=[];for(let p=0;p<a.length;++p){const b=a[p],k={x:b.x??-1,y:b.y??-1},x=re(o,k);y(x)&&He(x)&&(f.push(x.id??""),f.push(x.id??""),d.push($n({x:x.x??0,y:x.y??0},At)))}let h=!1;for(let p=0;p<a.length;++p){const b=a[p],k=Wt(b,"collision"),x={x:b.x??-1,y:b.y??-1},T=$n(x,At),A={x:x.x+t.x,y:x.y+t.y};if(ru(A)){const M=re(o,A),S=(M==null?void 0:M.id)??"",I=$n({x:(M==null?void 0:M.x)??0,y:(M==null?void 0:M.y)??0},At),$=Wt(M,"collision");if(y(M)&&He(M)&&f.includes(S)!==!0&&l.includes(S)!==!0){let N=!1;const z=d.includes(T),J=z?re(o,x):void 0,L=z?Wt(J,"pushable"):!1,O=z&&L;if(Ld(b,M)&&(k!==Ft.ISWALK||z)){let E=z;y(J)&&L&&(h=es(i,o,J,{x:(J.x??0)-t.x,y:(J.y??0)-t.y})!==!0,h||(E=!1)),(E||k!==Ft.ISWALK)&&(h=es(i,o,M,{x:(M.x??0)+t.x,y:(M.y??0)+t.y})!==!0,h&&(N=O))}else(k!==Ft.ISWALK||O)&&(h=!0,N=O);N&&y(J)&&(h=es(i,o,J,{x:(J.x??0)-t.x,y:(J.y??0)-t.y})!==!0)}else $===Ft.ISSOLID&&u.includes(I)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const b=c[p],k=Wt(b,"collision"),x={x:b.x??0,y:b.y??0},T={x:x.x+t.x,y:x.y+t.y};if(ru(T)){const A=re(o,T),M=(A==null?void 0:A.id)??"",S=Wt(A,"collision"),I=Wt(A,"group");y(A)&&He(A)&&f.includes(M)&&l.includes(M)!==!0?Ld(b,A)?h=es(i,o,A,T)!==!0:h=!0:$a(k,S)&&r!==I&&(h=!0)}else h=!0}if(h)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const b=a[p],k={x:b.x??-1,y:b.y??-1},x={x:k.x+t.x,y:k.y+t.y},T=ns(o,x.x,x.y);if(y(b)&&y(T)){Ne(o,{...b,x:x.x,y:x.y}),Ne(o,{...T,x:k.x,y:k.y});const A=re(o,k);He(A)&&y(A)&&(A.x=(A.x??0)+t.x,A.y=(A.y??0)+t.y,A.lx=(A.lx??0)+t.x,A.ly=(A.ly??0)+t.y)}}Oa(o);for(let p=0;p<c.length;++p){const b=c[p],k={x:b.x??-1,y:b.y??-1},x={x:k.x+t.x,y:k.y+t.y};if(!es(i,o,b,x))break}Oa(o)}function zl(e,t){let n="all";const r={x:0,y:0},i={x:At-1,y:Ht-1};for(let s=t;s<e.length;){const[o,a]=rt(e,s,[K.MAYBE_NUMBER_OR_STRING]);if(pt(o))n=Nt(o),s=a;else if(wt(o)){const[c,l,u,f]=rt(e,a,[K.NUMBER,K.MAYBE_NUMBER,K.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const GB=wi().command("snapshot",()=>(!y(w.book)||!y(w.board)||DB(w.board.id),0)).command("revert",()=>(!y(w.book)||!y(w.board)||jB(w.board.id),0)).command("copy",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;const[n,r]=rt(t,0,[K.STRING]),i=bookreadcodepagesbytypeandstat(w.book,bt.BOARD,n),s=gr(...i);if(y(s)){const o=zl(t,r);Ml(s.id,w.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;const[n,r,i,s]=rt(t,0,[K.STRING,K.NUMBER,K.NUMBER]),o=bookreadcodepagesbytypeandstat(w.book,bt.BOARD,n),a=gr(...o);if(y(a)){const c=zl(t,s);nw(w.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!y(w.book)||!y(w.board))return 0;const[n,r]=rt(t,0,[K.DIR]),i={x:n.destpt.x-(((o=w.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=w.element)==null?void 0:a.y)??0)},s=zl(t,r);return zB(w.board.id,i,s.pt1,s.pt2,w.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;const[n,r]=rt(t,0,[K.NUMBER]),i=zl(t,r);return IB(w.board.id,wm(n),i.pt1,i.pt2,i.targetset),0});var Zi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Zi||{});const KB={audio:Uh,board:e3,cli:eB,display:nB,element:uB,runtime:NB,loader:RB,network:OB,transform:GB},wd=["audio","board","display","network","transform","element"],HB={0:[],1:["cli",...wd],2:["loader",...wd],3:["runtime",...wd]},YB={0:new Map,1:new Map,2:new Map,3:new Map};function xo(e){return(HB[e]??[]).map(n=>KB[n]).filter(y)}function Ed(e){const t=[],n=xo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function VB(e,t){const n=YB[e];if(!n.has(t)){let r;const i=xo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!y(r));++s);n.set(t,r)}return n.get(t)}function XB(e,t,n){const r=xo(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function qB(e,t,n,r){const i=xo(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function JB(e,t){const n=xo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function aw(e,t){const n=xo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var cw={},lw={},uw={};const hw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");uw.encode=function(e){if(0<=e&&e<hw.length)return hw[e];throw new TypeError("Must be between 0 and 63: "+e)};const ZB=uw,fw=5,dw=1<<fw,QB=dw-1,tP=dw;function eP(e){return e<0?(-e<<1)+1:(e<<1)+0}lw.encode=function(t){let n="",r,i=eP(t);do r=i&QB,i>>>=fw,i>0&&(r|=tP),n+=ZB.encode(r);while(i>0);return n};var La={};(function(e){function t(S,I,$){if(I in S)return S[I];if(arguments.length===3)return $;throw new Error('"'+I+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const I=S.match(n);return I?{scheme:I[1],auth:I[2],host:I[3],port:I[4],path:I[5]}:null}e.urlParse=i;function s(S){let I="";return S.scheme&&(I+=S.scheme+":"),I+="//",S.auth&&(I+=S.auth+"@"),S.host&&(I+=S.host),S.port&&(I+=":"+S.port),S.path&&(I+=S.path),I}e.urlGenerate=s;const o=32;function a(S){const I=[];return function($){for(let z=0;z<I.length;z++)if(I[z].input===$){const J=I[0];return I[0]=I[z],I[z]=J,I[0].result}const N=S($);return I.unshift({input:$,result:N}),I.length>o&&I.pop(),N}}const c=a(function(I){let $=I;const N=i(I);if(N){if(!N.path)return I;$=N.path}const z=e.isAbsolute($),J=[];let L=0,O=0;for(;;)if(L=O,O=$.indexOf("/",L),O===-1){J.push($.slice(L));break}else for(J.push($.slice(L,O));O<$.length&&$[O]==="/";)O++;let E=0;for(O=J.length-1;O>=0;O--){const C=J[O];C==="."?J.splice(O,1):C===".."?E++:E>0&&(C===""?(J.splice(O+1,E),E=0):(J.splice(O,2),E--))}return $=J.join("/"),$===""&&($=z?"/":"."),N?(N.path=$,s(N)):$});e.normalize=c;function l(S,I){S===""&&(S="."),I===""&&(I=".");const $=i(I),N=i(S);if(N&&(S=N.path||"/"),$&&!$.scheme)return N&&($.scheme=N.scheme),s($);if($||I.match(r))return I;if(N&&!N.host&&!N.path)return N.host=I,s(N);const z=I.charAt(0)==="/"?I:c(S.replace(/\/+$/,"")+"/"+I);return N?(N.path=z,s(N)):z}e.join=l,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function u(S,I){S===""&&(S="."),S=S.replace(/\/$/,"");let $=0;for(;I.indexOf(S+"/")!==0;){const N=S.lastIndexOf("/");if(N<0||(S=S.slice(0,N),S.match(/^([^\/]+:\/)?\/*$/)))return I;++$}return Array($+1).join("../")+I.substr(S.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function h(S){return p(S)?"$"+S:S}e.toSetString=f?d:h;function m(S){return p(S)?S.slice(1):S}e.fromSetString=f?d:m;function p(S){if(!S)return!1;const I=S.length;if(I<9||S.charCodeAt(I-1)!==95||S.charCodeAt(I-2)!==95||S.charCodeAt(I-3)!==111||S.charCodeAt(I-4)!==116||S.charCodeAt(I-5)!==111||S.charCodeAt(I-6)!==114||S.charCodeAt(I-7)!==112||S.charCodeAt(I-8)!==95||S.charCodeAt(I-9)!==95)return!1;for(let $=I-10;$>=0;$--)if(S.charCodeAt($)!==36)return!1;return!0}function b(S,I,$){let N=x(S.source,I.source);return N!==0||(N=S.originalLine-I.originalLine,N!==0)||(N=S.originalColumn-I.originalColumn,N!==0||$)||(N=S.generatedColumn-I.generatedColumn,N!==0)||(N=S.generatedLine-I.generatedLine,N!==0)?N:x(S.name,I.name)}e.compareByOriginalPositions=b;function k(S,I,$){let N=S.generatedLine-I.generatedLine;return N!==0||(N=S.generatedColumn-I.generatedColumn,N!==0||$)||(N=x(S.source,I.source),N!==0)||(N=S.originalLine-I.originalLine,N!==0)||(N=S.originalColumn-I.originalColumn,N!==0)?N:x(S.name,I.name)}e.compareByGeneratedPositionsDeflated=k;function x(S,I){return S===I?0:S===null?1:I===null?-1:S>I?1:-1}function T(S,I){let $=S.generatedLine-I.generatedLine;return $!==0||($=S.generatedColumn-I.generatedColumn,$!==0)||($=x(S.source,I.source),$!==0)||($=S.originalLine-I.originalLine,$!==0)||($=S.originalColumn-I.originalColumn,$!==0)?$:x(S.name,I.name)}e.compareByGeneratedPositionsInflated=T;function A(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=A;function M(S,I,$){if(I=I||"",S&&(S[S.length-1]!=="/"&&I[0]!=="/"&&(S+="/"),I=S+I),$){const N=i($);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const z=N.path.lastIndexOf("/");z>=0&&(N.path=N.path.substring(0,z+1))}I=l(s(N),I)}return c(I)}e.computeSourceURL=M})(La);var xd={};let nP=class pE{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new pE;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};xd.ArraySet=nP;var pw={};const mw=La;function rP(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||mw.compareByGeneratedPositionsInflated(e,t)<=0}let iP=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){rP(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(mw.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};pw.MappingList=iP;const Ma=lw,Je=La,Wl=xd.ArraySet,sP=pw.MappingList;let gw=class mE{constructor(t){t||(t={}),this._file=Je.getArg(t,"file",null),this._sourceRoot=Je.getArg(t,"sourceRoot",null),this._skipValidation=Je.getArg(t,"skipValidation",!1),this._sources=new Wl,this._names=new Wl,this._mappings=new sP,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new mE({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Je.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Je.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Je.getArg(t,"generated"),r=Je.getArg(t,"original",null);let i=Je.getArg(t,"source",null),s=Je.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Je.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Je.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Je.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Je.relative(s,i));const o=this._mappings.toArray().length>0?new Wl:this._sources,a=new Wl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=Je.join(r,c.source)),s!=null&&(c.source=Je.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=Je.join(r,c)),s!=null&&(c=Je.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,m=d.length;h<m;h++){if(l=d[h],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!Je.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Ma.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Ma.encode(f-o),o=f,c+=Ma.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Ma.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Ma.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Je.relative(n,r));const i=Je.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};gw.prototype._version=3,cw.SourceMapGenerator=gw;var _w={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(_w);var Ua={exports:{}},oP={},aP=Object.freeze({__proto__:null,default:oP}),yw=gE(aP);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Ua.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Ua.exports.initialize=t=>e=t}else{const e=yw,t=yw;Ua.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Ua.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var bw=Ua.exports;const cP=bw;function lP(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Fa=null;var uP=function(){if(Fa)return Fa;const t=[];return Fa=cP().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new lP;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Fa=null,n}),Fa};const Ot=La,vd=_w,Gl=xd.ArraySet,hP=bw,fP=uP,Td=Symbol("smcInternal");class Ve{constructor(t,n){return t==Td?Promise.resolve(this):pP(t,n)}static initialize(t){hP.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return mP(t,n)}static async with(t,n,r){const i=await new Ve(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Ve.prototype._version=3,Ve.GENERATED_ORDER=1,Ve.ORIGINAL_ORDER=2,Ve.GREATEST_LOWER_BOUND=1,Ve.LEAST_UPPER_BOUND=2;class Ba extends Ve{constructor(t,n){return super(Td).then(r=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version");let o=Ot.getArg(i,"sources");const a=Ot.getArg(i,"names",[]);let c=Ot.getArg(i,"sourceRoot",null);const l=Ot.getArg(i,"sourcesContent",null),u=Ot.getArg(i,"mappings"),f=Ot.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Ot.normalize(c)),o=o.map(String).map(Ot.normalize).map(function(d){return c&&Ot.isAbsolute(c)&&Ot.isAbsolute(d)?Ot.relative(c,d):d}),r._names=Gl.fromArray(a.map(String),!0),r._sources=Gl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return Ot.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,fP().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Ot.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ba(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Ve.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Ot.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Ve.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Ve.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Ot.getArg(t,"source");const r=Ot.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Ot.getArg(t,"bias",Ve.GREATEST_LOWER_BOUND);r==null&&(r=Ve.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Ot.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Ot.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Ot.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Ot.getArg(i,"originalLine",null),column:Ot.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Ot.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Ot.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Ot.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Ot.getArg(t,"line"),originalColumn:Ot.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Ot.getArg(t,"bias",Ve.GREATEST_LOWER_BOUND);i==null&&(i=Ve.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Ot.getArg(s,"generatedLine",null),column:Ot.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ba.prototype.consumer=Ve;class dP extends Ve{constructor(t,n){return super(Td).then(r=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version"),o=Ot.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Gl,r._names=new Gl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Ot.getArg(c,"offset"),u=Ot.getArg(l,"line"),f=Ot.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Ve(Ot.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Ot.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Ot.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")},r=vd.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Ot.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Ot.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||Ve.GENERATED_ORDER;let o;switch(s){case Ve.GENERATED_ORDER:o=this._generatedMappings;break;case Ve.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Ot.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return vd.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Ot.getArg(t,"line"),r={source:Ot.getArg(t,"source"),originalLine:n,originalColumn:Ot.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Ot.compareByOriginalPositions,vd.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function pP(e,t){let n=e;typeof e=="string"&&(n=Ot.parseSourceMapInput(e));const r=n.sections!=null?new dP(n,t):new Ba(n,t);return Promise.resolve(r)}function mP(e,t){return Ba.fromSourceMap(e,t)}var kw={};const gP=cw.SourceMapGenerator,Kl=La,_P=/(\r?\n)/,yP=10,vo="$$$isSourceNode$$$";let bP=class Xd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[vo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new Xd,s=t.split(_P);let o=0;const a=function(){const h=p(),m=p()||"";return h+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const m=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,m),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const m=n.sourceContentFor(h);m!=null&&(r!=null&&(h=Kl.join(r,h)),i.setSourceContent(h,m))}),i;function d(h,m){if(h===null||h.source===void 0)i.add(m);else{const p=r?Kl.join(r,h.source):h.source;i.add(new Xd(h.originalLine,h.originalColumn,p,m,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[vo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[vo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[vo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[vo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Kl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][vo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Kl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new gP(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===yP?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};kw.SourceNode=bP;var kP=kw.SourceNode;let ww=0;const Ew=Qr,wP=["Command","lines"];class EP extends rU{constructor(){super(pk,{traceInitPerf:Qr,skipValidations:!Qr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});xt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));xt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Ol)}])}));xt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));xt(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));xt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(jf)}));xt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Df)}));xt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Fy)}])}));xt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(By)}));xt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Py),this.OPTION(()=>{this.SUBRULE(this.words)}),this.CONSUME($y)}));xt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(go),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));xt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));xt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Vf),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));xt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(ek),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));xt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Xf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));xt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Il),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Ol)),this.CONSUME4(go),this.CONSUME4(qf)}}])}));xt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Il),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(go),this.CONSUME(qf)}}])}));xt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Il),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));xt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(go),this.CONSUME(Jf),this.CONSUME(Xf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));xt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(go),this.CONSUME(Jf),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));xt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(ak),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(ck),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(lk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(uk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(hk)}));xt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(fk)}));xt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(ik)}));xt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(sk)}));xt(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(ok)}));xt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Wf),this.SUBRULE2(this.and_test)})}));xt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Kf),this.SUBRULE2(this.not_test)})}));xt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Gf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));xt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));xt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(K1)},{ALT:()=>this.CONSUME(H1)},{ALT:()=>this.CONSUME(Y1)},{ALT:()=>this.CONSUME(V1)},{ALT:()=>this.CONSUME(X1)},{ALT:()=>this.CONSUME(q1)}])}));xt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Wf),this.SUBRULE2(this.and_test_value)})}));xt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Kf),this.SUBRULE2(this.not_test_value)})}));xt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Gf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));xt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));xt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Hf)},{ALT:()=>this.CONSUME(Yf)}]),this.SUBRULE(this.term)}));xt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));xt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Z1)},{ALT:()=>this.CONSUME(Vf)},{ALT:()=>this.CONSUME(Q1)},{ALT:()=>this.CONSUME(tk)}]),this.SUBRULE(this.factor)}));xt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Hf)},{ALT:()=>this.CONSUME(Yf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));xt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(J1),this.SUBRULE(this.factor)})}));xt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));xt(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));xt(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(Dy)},{ALT:()=>this.CONSUME(jy)}])}));xt(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(zy)},{ALT:()=>this.CONSUME(Wy)},{ALT:()=>this.CONSUME(Gy)},{ALT:()=>this.CONSUME(Ky)},{ALT:()=>this.CONSUME(Hy)},{ALT:()=>this.CONSUME(Yy)},{ALT:()=>this.CONSUME(Vy)},{ALT:()=>this.CONSUME(Xy)},{ALT:()=>this.CONSUME(qy)}])}));xt(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(Jy)},{ALT:()=>this.CONSUME(Zy)},{ALT:()=>this.CONSUME(Qy)},{ALT:()=>this.CONSUME(tb)},{ALT:()=>this.CONSUME(eb)},{ALT:()=>this.CONSUME(nb)},{ALT:()=>this.CONSUME(rb)},{ALT:()=>this.CONSUME(ib)},{ALT:()=>this.CONSUME(sb)},{ALT:()=>this.CONSUME(ob)},{ALT:()=>this.CONSUME(ab)},{ALT:()=>this.CONSUME(cb)},{ALT:()=>this.CONSUME(lb)},{ALT:()=>this.CONSUME(ub)},{ALT:()=>this.CONSUME(hb)},{ALT:()=>this.CONSUME(fb)},{ALT:()=>this.CONSUME(db)},{ALT:()=>this.CONSUME(pb)},{ALT:()=>this.CONSUME(mb)},{ALT:()=>this.CONSUME(gb)},{ALT:()=>this.CONSUME(_b)},{ALT:()=>this.CONSUME(yb)},{ALT:()=>this.CONSUME(bb)},{ALT:()=>this.CONSUME(kb)},{ALT:()=>this.CONSUME(wb)},{ALT:()=>this.CONSUME(Eb)},{ALT:()=>this.CONSUME(xb)},{ALT:()=>this.CONSUME(vb)},{ALT:()=>this.CONSUME(Tb)},{ALT:()=>this.CONSUME(Ab)},{ALT:()=>this.CONSUME(Sb)},{ALT:()=>this.CONSUME(Rb)},{ALT:()=>this.CONSUME(Ob)},{ALT:()=>this.CONSUME(Nb)},{ALT:()=>this.CONSUME(Ib)},{ALT:()=>this.CONSUME(Cb)},{ALT:()=>this.CONSUME(Lb)},{ALT:()=>this.CONSUME(Mb)},{ALT:()=>this.CONSUME(Ub)},{ALT:()=>this.CONSUME(Fb)},{ALT:()=>this.CONSUME(Bb)},{ALT:()=>this.CONSUME(Pb)},{ALT:()=>this.CONSUME($b)},{ALT:()=>this.CONSUME(Db)},{ALT:()=>this.CONSUME(jb)},{ALT:()=>this.CONSUME(zb)},{ALT:()=>this.CONSUME(Wb)}])}));xt(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(n1)},{ALT:()=>this.CONSUME(r1)},{ALT:()=>this.CONSUME(i1)},{ALT:()=>this.CONSUME(s1)},{ALT:()=>this.CONSUME(v1)},{ALT:()=>this.CONSUME(T1)}])}));xt(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(Gb)},{ALT:()=>this.CONSUME(Kb)},{ALT:()=>this.CONSUME(Hb)},{ALT:()=>this.CONSUME(Yb)},{ALT:()=>this.CONSUME(Vb)},{ALT:()=>{this.CONSUME(Xb),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}},{ALT:()=>{this.CONSUME(qb),this.SUBRULE3(this.simple_token),this.SUBRULE4(this.simple_token)}},{ALT:()=>{this.CONSUME(o1),this.SUBRULE5(this.simple_token),this.SUBRULE6(this.simple_token)}},{ALT:()=>{this.CONSUME(a1),this.SUBRULE7(this.simple_token),this.SUBRULE8(this.simple_token)}},{ALT:()=>this.CONSUME(Jb)},{ALT:()=>this.CONSUME(Zb)},{ALT:()=>this.CONSUME(Qb)},{ALT:()=>this.CONSUME(t1)},{ALT:()=>this.CONSUME(e1)},{ALT:()=>{this.CONSUME(c1),this.SUBRULE1(this.kind)}},{ALT:()=>{this.CONSUME(l1),this.SUBRULE2(this.kind)}},{ALT:()=>{this.CONSUME(u1),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}},{ALT:()=>this.CONSUME(h1)},{ALT:()=>this.CONSUME(f1)},{ALT:()=>this.CONSUME(d1)},{ALT:()=>this.CONSUME(p1)},{ALT:()=>this.CONSUME(m1)},{ALT:()=>this.CONSUME(g1)},{ALT:()=>this.CONSUME(_1)},{ALT:()=>this.CONSUME(y1)},{ALT:()=>this.CONSUME(b1)},{ALT:()=>this.CONSUME(k1)},{ALT:()=>this.CONSUME(w1)},{ALT:()=>this.CONSUME(E1)},{ALT:()=>this.CONSUME(x1)}])}));xt(this,"expr_any",this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])}));xt(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(O1),this.SUBRULE(this.expr_any)}));xt(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(N1),this.SUBRULE(this.expr_any)}));xt(this,"token_expr_blocked",this.RULED("token_expr_blocked",()=>{this.CONSUME(R1),this.SUBRULE(this.dir)}));xt(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(I1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(C1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(L1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(M1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(U1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));xt(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(F1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(B1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(P1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME($1),this.SUBRULE(this.simple_token),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(D1),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));xt(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(j1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));xt(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME(z1),this.SUBRULE(this.string_token)}));xt(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(W1),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));xt(this,"token_expr",this.RULED("token_expr",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(A1)},{ALT:()=>this.CONSUME(S1)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])})}));xt(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(Nl)}])}));xt(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(zf)},{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(Nl)}])}));xt(this,"simple_tokens",this.RULED("simple_tokens",()=>{this.AT_LEAST_ONE(this.simple_token)}));xt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.token_expr)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(jf)},{ALT:()=>this.CONSUME(Nl)},{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(zf)},{ALT:()=>this.CONSUME(G1)},{ALT:()=>{this.CONSUME(nk),this.SUBRULE(this.expr),this.CONSUME(rk)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=wP.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(ww++).toString().padStart(3),c=s?"font-weight: bold;":"";if(Ew&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),Ew&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),ww--},i)}}const To=new EP;if(kS){const e=To.getGAstProductions(),t=mU(e);console.info(t)}const xP=To.getBaseCstVisitorConstructor();var Et=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(Et||{}),Is=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Is||{}),ui=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(ui||{}),Hl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Hl||{});function se(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class vP extends xP{constructor(){super();xt(this,"unique",0);Qr&&this.validateVisitor()}visit(n){if(ae(n)&&(n=n[0]),!!y(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createtemplatenode(n,r){return this.createcodenode(n,{type:12,literal:2,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():y(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.stmt_command?this.go(n.stmt_command):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}inline(n){return n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.stmt_command?this.go(n.stmt_command):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.structured_cmd?this.go(n.structured_cmd):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:se(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:se(n.token_stat,"@").slice(1)}))}stmt_text(n,r){const i=se(n.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:i}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:se(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:se(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n,r){return n.structured_cmd?this.go(n.structured_cmd):this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:[this.go(n.string_token),this.go(n.dir)].flat()})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:[this.go(n.string_token),this.go(n.dir)].flat()})):[]}command_if(n,r){const[i]=this.createlogicnode(r,se(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=ze(),s=ze();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=ze(),s=ze();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,se(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){const i=[];return n.words&&i.push(...this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))),n.command_fork&&i.push(...this.go(n.command_fork)),this.createcodenode(r,{type:17,lines:i})}command_while(n,r){const i=ze(),s=ze();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=ze(),s=ze(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=ze(),s=ze(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=ze();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=se(n.token_command_play,"").trim(),[s,...o]=i.split(" ");return[this.createstringnode(r,s),this.createstringnode(r,o.join(" "))].flat()}command_toast(n,r){const s=se(n.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(r,"toast"),this.createtemplatenode(r,s)].flat()}command_ticker(n,r){const s=se(n.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(r,"ticker"),this.createtemplatenode(r,s)].flat()}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}kind(n){return[this.go(n.color),this.go(n.string_token)].flat()}category(n,r){if(n.token_isterrain){const i=se(n.token_isterrain,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isobject){const i=se(n.token_isobject,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}collision(n,r){if(n.token_iswalkable){const i=se(n.token_iswalkable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalking){const i=se(n.token_iswalking,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalk){const i=se(n.token_iswalk,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimmable){const i=se(n.token_isswimmable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimming){const i=se(n.token_isswimming,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswim){const i=se(n.token_isswim,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_issolid){const i=se(n.token_issolid,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isbullet){const i=se(n.token_isbullet,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isghost){const i=se(n.token_isghost,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}color(n,r){let i="ERROR";return n.token_black&&(i="black"),n.token_dkblue&&(i="dkblue"),n.token_dkgreen&&(i="dkgreen"),n.token_dkcyan&&(i="dkcyan"),n.token_dkred&&(i="dkred"),n.token_dkpurple&&(i="dkpurple"),n.token_dkyellow&&(i="dkyellow"),n.token_ltgray&&(i="ltgray"),n.token_dkgray&&(i="dkgray"),n.token_blue&&(i="blue"),n.token_green&&(i="green"),n.token_cyan&&(i="cyan"),n.token_red&&(i="red"),n.token_purple&&(i="purple"),n.token_yellow&&(i="yellow"),n.token_white&&(i="white"),n.token_brown&&(i="brown"),n.token_dkwhite&&(i="dkwhite"),n.token_ltgrey&&(i="ltgrey"),n.token_gray&&(i="gray"),n.token_grey&&(i="grey"),n.token_dkgrey&&(i="dkgrey"),n.token_ltblack&&(i="ltblack"),n.token_onblack&&(i="onblack"),n.token_ondkblue&&(i="ondkblue"),n.token_ondkgreen&&(i="ondkgreen"),n.token_ondkcyan&&(i="ondkcyan"),n.token_ondkred&&(i="ondkred"),n.token_ondkpurple&&(i="ondkpurple"),n.token_ondkyellow&&(i="ondkyellow"),n.token_onltgray&&(i="onltgray"),n.token_ondkgray&&(i="ondkgray"),n.token_onblue&&(i="onblue"),n.token_ongreen&&(i="ongreen"),n.token_oncyan&&(i="oncyan"),n.token_onred&&(i="onred"),n.token_onpurple&&(i="onpurple"),n.token_onyellow&&(i="onyellow"),n.token_onwhite&&(i="onwhite"),n.token_onbrown&&(i="onbrown"),n.token_ondkwhite&&(i="ondkwhite"),n.token_onltgrey&&(i="onltgrey"),n.token_ongray&&(i="ongray"),n.token_ongrey&&(i="ongrey"),n.token_ondkgrey&&(i="ondkgrey"),n.token_onltblack&&(i="onltblack"),n.token_onclear&&(i="onclear"),this.createcodenode(r,{type:12,literal:1,value:i})}dir_mod(n,r){let i="ERROR";return n.token_cw&&(i="cw"),n.token_ccw&&(i="ccw"),n.token_opp&&(i="opp"),n.token_rndp&&(i="rndp"),n.token_over&&(i="over"),n.token_under&&(i="under"),this.createcodenode(r,{type:12,literal:1,value:i})}dir(n,r){const i=this.go(n.dir_mod)??[];return n.token_i&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"i"})),n.token_idle&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"idle"})),n.token_n&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"n"})),n.token_u&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"u"})),n.token_north&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"north"})),n.token_up&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"up"})),n.token_s&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"s"})),n.token_d&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"d"})),n.token_south&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"south"})),n.token_down&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"down"})),n.token_w&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"w"})),n.token_l&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"l"})),n.token_west&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"west"})),n.token_left&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"left"})),n.token_e&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"e"})),n.token_r&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"r"})),n.token_east&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"east"})),n.token_right&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"right"})),n.token_rnd&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rnd"})),n.token_rndne&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rndne"})),n.token_rndns&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rndns"})),n.token_flow&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"flow"})),n.token_by&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"by"}),...this.go(n.simple_token)),n.token_at&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"at"}),...this.go(n.simple_token)),n.token_away&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"away"}),...this.go(n.simple_token)),n.token_toward&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"toward"}),...this.go(n.simple_token)),n.token_find&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"find"}),...this.go(n.kind)),n.token_flee&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"flee"}),...this.go(n.kind)),n.token_to&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"to"}),...this.go(n.dir)),i.flat()}expr_any(n){return[this.go(n.dir),this.go(n.kind),this.go(n.color)].flat()}token_expr_any(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"any"}),this.go(n.expr_any)].flat()}token_expr_count(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"countof"}),this.go(n.expr_any)].flat()}token_expr_blocked(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"blocked"}),this.go(n.dir)].flat()}token_expr_abs(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"abs"}),...this.go(n.simple_token)]}token_expr_intceil(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intceil"}),...this.go(n.simple_token)]}token_expr_intfloor(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intfloor"}),...this.go(n.simple_token)]}token_expr_intround(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intround"}),...this.go(n.simple_token)]}token_expr_clamp(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"clamp"}),...this.go(n.simple_token)]}token_expr_min(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"min"}),...this.go(n.simple_tokens)]}token_expr_max(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"max"}),...this.go(n.simple_tokens)]}token_expr_pick(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pick"}),...this.go(n.simple_tokens)]}token_expr_pickwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pickwith"}),...this.go(n.simple_tokens)]}token_expr_random(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"random"}),...this.go(n.simple_token)]}token_expr_randomwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"randomwith"}),...this.go(n.simple_token)]}token_expr_run(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"run"}),...this.go(n.string_token)]}token_expr_runwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"runwith"}),...this.go(n.simple_token),...this.go(n.string_token)]}token_expr(n,r){const i=[];return n.token_expr_aligned&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"aligned"})),n.token_contact&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"contact"})),n.token_expr_any?this.go(n.token_expr_any):n.token_expr_count?this.go(n.token_expr_count):n.token_expr_abs?this.go(n.token_expr_abs):n.token_expr_intceil?this.go(n.token_expr_intceil):n.token_expr_intfloor?this.go(n.token_expr_intfloor):n.token_expr_intround?this.go(n.token_expr_intround):n.token_expr_clamp?this.go(n.token_expr_clamp):n.token_expr_min?this.go(n.token_expr_min):n.token_expr_max?this.go(n.token_expr_max):n.token_expr_pick?this.go(n.token_expr_pick):n.token_expr_pickwith?this.go(n.token_expr_pickwith):n.token_expr_random?this.go(n.token_expr_random):n.token_expr_randomwith?this.go(n.token_expr_randomwith):n.token_expr_run?this.go(n.token_expr_run):n.token_expr_runwith?this.go(n.token_expr_runwith):i}string_token(n,r){if(n.token_stringliteraldouble){const i=se(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=se(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}simple_token(n,r){if(n.token_stringliteraldouble){const i=se(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=se(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(se(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return[]}simple_tokens(n,r){if(n.token_stringliteraldouble){const i=se(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=se(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(se(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return[]}token(n,r){if(n.category)return this.go(n.category);if(n.collision)return this.go(n.collision);if(n.color)return this.go(n.color);if(n.dir)return this.go(n.dir);if(n.token_expr)return this.go(n.token_expr);if(n.command_play)return this.go(n.command_play);if(n.command_toast)return this.go(n.command_toast);if(n.command_ticker)return this.go(n.command_ticker);if(n.token_label){const i=se(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=se(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=se(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(se(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}if(n.token_lparen)return this.createcodenode(r,{type:31,words:this.go(n.expr)});if(n.token_stop){const i=se(n.token_stop,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}}const TP=new vP,qn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Yl="zss.js";function ne(e,t){return new kP(e.startLine??1,e.startColumn??1,Yl,t)}function Ad(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Sd(e){return`'${Ad(e)}'`}function Rd(e){const t=pd(e);return t.errors.length?e:`['${t.tokens.map(r=>{if(r.tokenType===fd){const i=Ad(r.image.substring(1));return Nt(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return Ad(r.image)}).join("")}'].join('')`}function Ao(e){return e.filter(t=>t!==void 0).map(ce)}function xw(e){return ne(e,"")}function AP(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function sn(e,t,n){return ne(e,[`api.${t}(`,...AP(n,", "),")"])}function SP(e){if(e.type===Et.COMPARE&&e.compare.type===Et.COMPARE_ITEM)switch(e.compare.method){case Is.IS_EQ:return sn(e,"isEq",[ce(e.lhs),ce(e.rhs)]);case Is.IS_NOT_EQ:return sn(e,"isNotEq",[ce(e.lhs),ce(e.rhs)]);case Is.IS_LESS_THAN:return sn(e,"isLessThan",[ce(e.lhs),ce(e.rhs)]);case Is.IS_GREATER_THAN:return sn(e,"isGreaterThan",[ce(e.lhs),ce(e.rhs)]);case Is.IS_LESS_THAN_OR_EQ:return sn(e,"isLessThanOrEq",[ce(e.lhs),ce(e.rhs)]);case Is.IS_GREATER_THAN_OR_EQ:return sn(e,"isGreaterThanOrEq",[ce(e.lhs),ce(e.rhs)])}return ne(e,"")}function Cs(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ce(n),")"])}function vw(e,t,n){return e.prepend(`api.${t}(`),e.add([ce(n),")"])}function RP(e,t){if(e.type===Et.OPERATOR_ITEM)switch(e.operator){case ui.PLUS:return Cs(t,"opPlus",e.rhs);case ui.MINUS:return Cs(t,"opMinus",e.rhs);case ui.POWER:return Cs(t,"opPower",e.rhs);case ui.MULTIPLY:return Cs(t,"opMultiply",e.rhs);case ui.DIVIDE:return Cs(t,"opDivide",e.rhs);case ui.MOD_DIVIDE:return Cs(t,"opModDivide",e.rhs);case ui.FLOOR_DIVIDE:return Cs(t,"opFloorDivide",e.rhs);case ui.UNI_PLUS:return vw(t,"opUniPlus",e.rhs);case ui.UNI_MINUS:return vw(t,"opUniMinus",e.rhs)}return ne(e,"")}function OP(e){if(e.type===Et.OPERATOR){const t=e.lhs?ce(e.lhs):ne(e,"");return e.items.forEach(n=>RP(n,t)),t}return ne(e,"")}function Vl(e,t){return ne(e,[sn(e,"jump",[`${t}`]),"; continue;"])}function Li(e){return qn.linelookup[e??""]??-1}function Od(e,t){qn.linelookup[e]=t}function So(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case Et.WHILE:case Et.REPEAT:case Et.FOREACH:case Et.ELSE_IF:i.type===t&&(i.done=n);break;case Et.IF_BLOCK:case Et.IF_CHECK:i.type===t&&(i.skip=n);break;case Et.LINE:So(i.stmts,t,n);break}}}function Tw(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case Et.WHILE:case Et.REPEAT:case Et.FOREACH:case Et.ELSE_IF:i.type===t&&Od(i.done,n);break;case Et.IF_BLOCK:case Et.IF_CHECK:i.type===t&&Od(i.skip,n);break;case Et.LINE:Tw(i.stmts,t,n);break}}}function ce(e){var t;switch(e.type){case Et.PROGRAM:return ne(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ce).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Yl}`]);case Et.API:return ne(e,["  ",sn(e,e.method,Ao(e.words)),`;
`]);case Et.LINE:return ne(e,[`case ${e.lineindex}:
`,...e.stmts.map(ce).flat(),`  break;
`]);case Et.MARK:return ne(e,`  // ${e.comment}
`);case Et.GOTO:{const n=Li(e.id);return ne(e,["  ",Vl(e,n),`
`])}case Et.COUNT:return ne(e,`${e.index}`);case Et.LITERAL:switch(e.literal){case Hl.NUMBER:return ne(e,`${e.value}`);case Hl.STRING:return ne(e,Sd(e.value));case Hl.TEMPLATE:return ne(e,Rd(e.value))}return xw(e);case Et.TEXT:return ne(e,["  ",sn(e,"text",[Rd(e.value)]),`;
`]);case Et.STAT:if(qn.isfirststat){qn.isfirststat=!1;const n=e.value.trim().split(" ").map(Sd);return ne(e,["  ",sn(e,"stat",n),`;
`])}return ne(e,`  // skipped ${e.value}
`);case Et.LABEL:{const n=Nt(e.name),r=e.active?"label":"comment";qn.labels[n]||(qn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return qn.labels[n].push(i),ne(e,`  // ${i} '${n}' ${r}
`)}case Et.HYPERLINK:return ne(e,["  ",sn(e,"hyperlink",[Rd(e.text),...Ao(e.link)]),`;
`]);case Et.MOVE:{const n=sn(e,"command",[Sd("go"),Ao(e.words)].flat());return e.wait?ne(e,["  if (",n,`) { continue; };
`]):ne(e,["  ",n,`;
`])}case Et.COMMAND:return ne(e,["  if (",sn(e,"command",Ao(e.words)),`) { continue; };
`]);case Et.IF:{const n=((t=e.block)==null?void 0:t.type)===Et.IF_BLOCK?e.block:void 0;if(y(n)){So([e.check],Et.IF_CHECK,n.skip);const r=ne(e,ce(e.check));return n.lines.forEach(i=>r.add(ce(i))),Tw(n.altlines,Et.ELSE_IF,Li(n.done)),n.altlines.forEach(i=>r.add(ce(i))),r}return ne(e,ce(e.check))}case Et.IF_CHECK:{const n=Li(e.skip);return n===-1?ne(e,["  ",sn(e,e.method,Ao(e.words)),`;
`]):ne(e,["  if (!",sn(e,e.method,Ao(e.words)),") { ",Vl(e,n),` }
`])}case Et.ELSE_IF:case Et.ELSE:{const n=ne(e,"");return e.lines.forEach(r=>n.add(ce(r))),n}case Et.WHILE:{const n=Li(e.loop),r=Li(e.done),i=ne(e,"");return So(e.lines,Et.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case Et.BREAK:s.goto=r;break;case Et.CONTINUE:s.goto=n;break}i.add(ce(s))}),i}case Et.REPEAT:{const n=Li(e.loop),r=Li(e.done),i=ne(e,"");return So(e.lines,Et.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case Et.BREAK:s.goto=r;break;case Et.CONTINUE:s.goto=n;break}i.add(ce(s))}),i}case Et.WAITFOR:{const n=ne(e,"");return So(e.lines,Et.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ce(r))}),n}case Et.FOREACH:{const n=Li(e.loop),r=Li(e.done),i=ne(e,"");return So(e.lines,Et.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case Et.BREAK:s.goto=r;break;case Et.CONTINUE:s.goto=n;break}i.add(ce(s))}),i}case Et.BREAK:return ne(e,["  ",Vl(e,e.goto),`
`]);case Et.CONTINUE:return ne(e,["  ",Vl(e,e.goto),`
`]);case Et.OR:return sn(e,"or",e.items.map(ce));case Et.AND:return sn(e,"and",e.items.map(ce));case Et.NOT:return sn(e,"not",e.items.map(ce));case Et.COMPARE:return SP(e);case Et.OPERATOR:return OP(e);case Et.EXPR:return sn(e,"expr",e.words.map(ce));default:return console.error("<unsupported node>",e.type,e),xw(e)}}function hi(e){if(y(e))switch(e.type===Et.LINE&&++qn.lineindex,e.lineindex=qn.lineindex,e.type){case Et.PROGRAM:e.lines.forEach(hi);break;case Et.LINE:e.stmts.forEach(hi);break;case Et.MARK:Od(e.id,e.lineindex);break;case Et.IF:hi(e.check),hi(e.block);break;case Et.IF_BLOCK:e.lines.forEach(hi),e.altlines.forEach(hi);break;case Et.ELSE_IF:e.lines.forEach(hi);break;case Et.ELSE:case Et.WHILE:case Et.REPEAT:case Et.FOREACH:case Et.WAITFOR:e.lines.forEach(hi);break;case Et.MOVE:case Et.COMMAND:case Et.IF_CHECK:e.words.forEach(hi);break}}function NP(e){qn.labels={},qn.internal=1,qn.lineindex=0,qn.isfirststat=!0,hi(e)}function IP(e){return NP(e),{...ce(e).toStringWithSourceMap({file:`${Yl}.map`}),...qn}}function Aw(e){return ae(e)?e.length>0?1:0:e??0}function CP(e){return`${e}_chip`}function Sw(e=""){return`vm:${e??""}`}function LP(e,t,n){var l,u;const r=CP(e),i=Tr(r);let s;const o=Sr(Object.entries(n.labels??{}));(!ae(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){w.words=d;const h=VB(t,f);return y(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){VP(r)},id(){return e},set(f,d){const[h,m]=qB(t,c,f,d);if(h)return m},get(f){const[d,h]=XB(t,c,f);if(d)return h},tick(f){const d=wt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return aw(t,c),!1;i.lc=0,i.ys=0,w.get=c.get,JB(t,c);try{const m=s==null?void 0:s.next();m!=null&&m.done&&(i.es=1)}catch(m){de(tt,w.elementfocus,"crash",m.message),i.es=1}return aw(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return wt(i.lc)?++i.lc>ki.HALT_AT_COUNT:!0},haslabel(f){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return(m.find(b=>wt(b)&&b>0)??0)>0}return!1},hm(){if(ae(i.mg)&&ae(i.lb)){const[f]=i.mg;if(y(f))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return m.find(p=>wt(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,m){tt.emit(f,`${Sw(d)}:${h}`,m)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||c.haslabel(f.target)&&(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const m=h[1].findIndex(p=>p>0);if(m>=0&&y(h[1])){h[1][m]*=-1;break}}}},restore(f){if(ae(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let m=0;m<h[1].length;m++)h[1][m]=Math.abs(h[1][m])}},getcase(){i.ec=wt(i.ec)?i.ec:1;const f=c.hm();if(f&&ae(i.mg)){const[,d,h,m]=i.mg;c.set("sender",h),y(d)&&c.set("arg",d),m&&(c.set("player",m),w.elementfocus=m),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=wt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=cS.parse(f),[h]=d.filter(m=>m.fileName===Yl);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(Nt(Ae(d)),h)},if(...f){const[d,h]=rt(f,0,[K.ANY]),m=Aw(d);return m&&h<f.length&&c.command(...f.slice(h)),m?1:0},try(...f){const[,d]=rt(f,0,[K.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,m]=rt(f,0,[K.NAME,K.ANY]),p=wt(h),b=p?m:1,k=c.get(d),x=p?h:1;if(!wt(k))return b<f.length&&c.command(...f.slice(b)),1;const T=k-x;return T<0?(b<f.length&&c.command(...f.slice(b)),1):(c.set(d,T),0)},give(...f){const[d,h,m]=rt(f,0,[K.NAME,K.ANY]),p=wt(h),b=p?m:1,k=c.get(d),x=p?h:1,T=k===void 0?1:0;return T&&b<f.length&&c.command(...f.slice(b)),c.set(d,ea(k,0)+x),T},repeatstart(f,...d){const[h,m]=rt(d,0,[K.NUMBER]),p=`repeatcount${f}`,b=`repeatwords${f}`;i[p]=h,i[b]=m<d.length?d.slice(m):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!wt(i[d]))return 0;const m=i[d];i[d]=m-1;const p=m>0,b=i[h];return p&&ae(b)&&c.command(...b),p?1:0},foreachstart(f,...d){const[h,m,p,b]=rt(d,0,[K.NAME,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let k=Math.min(m,p),x=Math.max(m,p);const T=(b??0)||1;if(T<0){const A=k;k=x,x=A}return c.set(h,k-T),0},foreach(f,...d){const[h,m,p,b,k]=rt(d,0,[K.NAME,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let x=Math.min(m,p),T=Math.max(m,p);const A=(b??0)||1;if(A<0){const I=x;x=T,T=I}let M=c.get(h);!wt(M)||M<x||M>T?M=x:M+=A;const S=M<=T?1:0;return S&&(c.set(h,M),k<d.length&&c.command(...d.slice(k))),S},waitfor(...f){const[d]=rt(f,0,[K.ANY]),h=Aw(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=rt(f,h,[K.ANY]);if(d=m,d)break;h=p}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=rt(f,h,[K.ANY]);if(d=m,!d)break;h=p}return d},not(...f){const[d]=rt(f,0,[K.ANY]);return d?0:1},expr(...f){const[d]=rt(f,0,[K.ANY]);return d},isEq(f,d){const[h]=rt([f],0,[K.ANY]),[m]=rt([d],0,[K.ANY]);return typeof h=="object"||typeof m=="object"?XE(h,m)?1:0:h===m?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h<m?1:0},isGreaterThan(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h>m?1:0},isLessThanOrEq(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h<=m?1:0},isGreaterThanOrEq(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h>=m?1:0},opPlus(f,d){const[h]=rt([f],0,[K.ANY]),[m]=rt([d],0,[K.ANY]);return h+m},opMinus(f,d){const[h]=rt([f],0,[K.ANY]),[m]=rt([d],0,[K.ANY]);return h-m},opPower(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return Math.pow(h,m)},opMultiply(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h*m},opDivide(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h/m},opModDivide(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return h%m},opFloorDivide(f,d){const[h]=rt([f],0,[K.NUMBER]),[m]=rt([d],0,[K.NUMBER]);return Math.floor(h/m)},opUniPlus(f){const[d]=rt([f],0,[K.NUMBER]);return+d},opUniMinus(f){const[d]=rt([f],0,[K.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function Nd(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ae(r)?r.forEach(i=>{t.push(Nd(i))}):t.push(Nd(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function MP(e){const t=mk(`${e}
`);if(t.errors.length>0)return t;To.input=t.tokens;const n=To.program();if(To.errors.length>0)return{tokens:t.tokens,errors:To.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=TP.go(n);return r?(Nd(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Id=Object.getPrototypeOf(function*(){}).constructor;function UP(e,t){const n=`compile-${e}`;console.time(n);const r=MP(t);if(console.timeEnd(n),Um&&console.info(t,r.errors),r.errors&&r.errors.length>0)return console.info(t,r.errors),r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=IP(r.ast);if(i.code){Um&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Id("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Id("api"," ")}}}return{...r,...i,source:"",code:new Id("api"," ")}}function FP(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=UP(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return y(s)?s.isended():!0},halt(i){const s=t[i];return y(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];y(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!y(t[i])){const f=n(a,c);if(l=t[i]=LP(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((k,x)=>[k,x]);m.slice(h-5,h).forEach(([k,x])=>{de(tt,Jn(),"build",`$grey${x+1} $grey${k}`)});const[p,b]=m[h]??[];if(pt(p)&&y(b)){const k=(d.column??1)-1,x=k+d.length,T=k<p.length?p:`${p}*`,A=T.substring(0,k),M=T.substring(k,x),S=T.substring(x);de(tt,Jn(),"build",`$red${b+1} $grey${A}$red${M}$grey${S}`)}return d.message.split(`
`).forEach(k=>{de(tt,Jn(),"build",k)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Pn(i.target),a=t[s];if(y(a)){const c={...i,target:o};a.message(c)}}};return r}const Tn=new Vo,Ln={},Xl={};function Rw(e,t,n,r,i,s=0){const o=`tiles:${e}:${t}`;return y(Ln[o])||(Ln[o]=hS(e,t,n,r,i,s)),Ln[o]}function BP(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return y(Xl[s])||(Xl[s]=fS(e,t,n)),Xl[s].id=i,Xl[s]}function PP(e,t){const n=`sprites:${e}:${t}`;return y(Ln[n])||(Ln[n]=dS(e,t)),Ln[n]}function $P(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return y(Ln[s])||(Ln[s]=pS(e,t,n,r,i)),Ln[s]}function ql(e,t,n,r){const i=`media:${e}:${t}`;y(Ln[i])||(Ln[i]=mS(e,t,n,r));const s=Ln[i];return s.mime=n,s.media=r,s}function DP(e,t){const n=`control:${e}:${t}`;return y(Ln[n])||(Ln[n]=gS(e,t)),Ln[n]}const Qi=3;function Ow(e,t){const n=[],r=(e.x+.5)*ji,i=(e.y+.5)*zi,s=t.x*ji,o=t.y*zi,a=s-r,c=o-i;Tn.x=a-Qi,Tn.y=c-Qi,n.push(Tn.angle()),Tn.x=a+ji+Qi,Tn.y=c-Qi,n.push(Tn.angle()),Tn.x=a-Qi,Tn.y=c+zi+Qi,n.push(Tn.angle()),Tn.x=a+ji+Qi,Tn.y=c+zi+Qi,n.push(Tn.angle());const l=n.map(h=>Math.round(Em(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(k=>k<180),m=l.filter(k=>k>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,f]}function Jl(e,t,n,r,i,s,o,a,c){var T;const l={x:a,y:c},u=Wr(e,l);if(u===-1)return;Tn.x=a-i.x,Tn.y=Math.round((c-i.y)*1.333);const f=Tn.length();if(f>s)return;const d=Math.round(Em(Tn.angle()));let h=0;for(let A=0;A<n.length;++A){const[M,S,I]=n[A];M>S?(d>=M||d<=S)&&(h=Math.max(h,I)):d>=M&&d<=S&&(h=Math.max(h,I))}const m=s*.5;t[u]=Math.min(t[u],h+(f<m?0:(f-m)*o)),t[u]=Ge(t[u],0,1);const p=Mn(e,((T=e.lookup)==null?void 0:T[u])??"");if(y(p)){const A=[...Ow(i,l),.25];r.push(A)}const b=e.terrain[u],k=ur(b),x=(b==null?void 0:b.collision)??(k==null?void 0:k.collision);if($a(Ft.ISBULLET,x)){const A=[...Ow(i,l),1];r.push(A)}}function Cd(e,t,n,r,i,s){if(!y(n)||!y(n.terrain)||!y(n.objects))return[];const o=[];let a=t;const c=At,l=Ht,u=s?Lt.BLACK:Lt.ONCLEAR,f=Rw(e,a++,"terrain",c,l,u);o.push(f);const d=a++,h=PP(e,d);h.sprites=[],o.push(h);const m=n.isdark?1:0,p=$P(e,a++,c,l,m);o.push(p),p.alphas.fill(m);const b=Rw(e,a++,"tickers",c,l,Lt.ONCLEAR);o.push(b),b.char.fill(0);const k={...md(At,Ht,r,Lt.ONCLEAR),...b},x=DP(e,a++);if(i){o.push(x);const{graphics:$,camera:N,facing:z}=Tr(e),J=n.graphics??$??"",L=n.camera??N??"",O=n.facing??z??"";if(pt(J)){const E=Nt(J);switch(E){case"fpv":case"iso":case"flat":case"mode7":x.graphics=E;break;default:x.graphics="flat";break}}if(pt(L))switch(Nt(L)){default:case"mid":x.viewscale=Cc.MID;break;case"near":x.viewscale=Cc.NEAR;break;case"far":x.viewscale=Cc.FAR;break}wt(O)&&(x.facing=wm(O%360))}for(let $=0;$<n.terrain.length;++$){const N=n.terrain[$],z=rn(N,0,Lt.WHITE,s?Lt.BLACK:Lt.ONCLEAR),J=Wt(N,"collision");f.char[$]=z.char,f.color[$]=z.color,f.bg[$]=z.bg,f.wall[$]=J===Ft.ISSOLID?1:0}const T=Object.values(n.objects??{}),A=new Set;for(let $=0;$<T.length;++$){const N=T[$];wn(N.id)&&wt(N.x)&&wt(N.y)&&A.add($n(N,At))}for(let $=0;$<T.length;++$){const N=T[$];if(y(N.removed))continue;const z=N.id??"";if(wn(z)===!1&&wt(N.x)&&wt(N.y)&&A.has($n(N,At))===!0)continue;const J=rn(N),L=BP(e,d,z,$);if(L.x=N.x??0,L.y=N.y??0,L.char=J.char,L.color=J.color,L.bg=J.bg,h.sprites.push(L),m){if(J.light>0){const O=Wr(n,L),E=Ge(Math.round(J.light),1,Ht),C=1/(E*.5);if(p.alphas[O]=0,E>1){const P=[];for(let F=1;F<=E;++F){if(F===2){const ot=Wt(N,"lightdir");if(Dn(ot)){const W=iu(n,N,"",ot,L);switch(Lr(L,W.destpt)){case _t.EAST:P.push([45,315,1]);break;case _t.WEST:P.push([225,135,1]);break;case _t.NORTH:P.push([315,225,1]);break;case _t.SOUTH:P.push([135,45,1]);break}}}const st=[];for(let ot=L.y-F;ot<=L.y+F;++ot)Jl(n,p.alphas,P,st,L,E,C,L.x-F,ot),Jl(n,p.alphas,P,st,L,E,C,L.x+F,ot);const et=F-1;for(let ot=L.x-et;ot<=L.x+et;++ot)Jl(n,p.alphas,P,st,L,E,C,ot,L.y-F),Jl(n,p.alphas,P,st,L,E,C,ot,L.y+F);for(let ot=0;ot<st.length;++ot){const W=st[ot];let D=0;for(D=0;D<P.length;++D){const yt=P[D];if(yt[1]>yt[0]&&W[1]>=yt[0]&&W[0]<=yt[1]&&W[2]>=1&&yt[2]>=1){P[D]=[Math.min(W[0],yt[0]),Math.max(W[1],yt[1]),1];break}}D===P.length&&P.push(W)}}}}else if(wn(z)){const O=Wr(n,L);p.alphas[O]=0}}z===e&&(x.focusx=L.x,x.focusy=L.y,x.focusid=z)}for(let $=0;$<T.length;++$){const N=T[$];if(pt(N.tickertext)&&wt(N.tickertime)&&N.tickertext.length){const z=At,J=Bk(N.tickertext,z,Ht-1),L=(J==null?void 0:J.measuredwidth)??1,O=N.x??0,E=N.y??0,C=E<Ht*.5;k.x=O-Math.floor(L*.5),k.y=E+(C?1:-1),k.x+L>At&&(k.x=At-L),k.x<0&&(k.x=0);const P={x:k.x,y:k.y};Fk(N.tickertext,k,!0);for(let F=0;F<L;++F){const st=$n({x:P.x+F,y:P.y},At);p.alphas[st]=Math.max(p.alphas[st],.333)}}}o.push(ql(e,a++,"text/mood",m?"dark":"bright"));const M=le(Dt.MAIN),S=Ni(M,Dt.MAIN);if(pt(S.palette)){const $=nn(M,bt.PALETTE,S.palette),N=Re($);y(N==null?void 0:N.bits)&&o.push(ql(e,a++,"image/palette",Array.from(N.bits)))}if(pt(S.charset)){const $=nn(M,bt.CHARSET,S.charset),N=Re($);y(N==null?void 0:N.bits)&&o.push(ql(e,a++,"image/charset",Array.from(N.bits)))}const I=Object.keys(n.objects).filter(wn);return o.push(ql(e,a++,"text/players",I.join(","))),o}const lr=FP();var Dt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Dt||{});const we={halt:!1,session:ze(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function jP(){return we.session}function Jn(){return we.operator}function zP(e){we.operator=e}function WP(e){we.halt=e}function GP(){return we.halt}function Dr(){return[...we.books.values()]}function KP(){const[e]=we.books.values();return e}function jr(e){const t=Nt(e);return we.books.get(e)??Dr().find(n=>n.name===t)}function Nw(e,t){y(jr(t))&&(we.software[e]=t)}function le(e){return jr(we.software[e])}function Iw(e){const t=nd([]);return pt(e)&&(t.name=e),Zl(t),ve(tt,we.operator,`created [book] ${t.name}`),t}function HP(e){let t=jr(e);return y(t)||(t=nd([]),t.name=e),Zl(t),ve(tt,we.operator,`created [book] ${t.name}`),t}function fn(e,t){let n=y(t)?HP(t):le(e);return y(n)||(y(n)||(n=KP()),y(n)||(n=Iw(t)),y(n)&&ve(tt,we.operator,`opened [book] ${n.name} for ${e}`)),Nw(e,n.id),n}function ts(e,t,n){return id(fn(e),n,t)}function Zn(e,t){const n=le("main"),r=gr(wk(n,e,t));if(y(r))return r;const i=Dr();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(n==null?void 0:n.id)){const a=gr(wk(o,e,t));if(y(a))return a}}}function ur(e){if(y(e==null?void 0:e.kinddata))return e.kinddata;if(!pt(e==null?void 0:e.kind)||!e.kind)return;const t=Zn(bt.OBJECT,e.kind);if(y(t))return e.kinddata=Re(t),e.kinddata;const n=Zn(bt.TERRAIN,e.kind);if(y(n))return e.kinddata=Re(n),e.kinddata}function Wt(e,t){const n=e==null?void 0:e.kinddata,r=(n==null?void 0:n.id)??"",i=e==null?void 0:e[t];if(y(i))return i;const s=n==null?void 0:n[t];if(y(s))return s;const o=Zn(bt.OBJECT,r)??Zn(bt.TERRAIN,r),a=ed(o,t);if(y(a))return a;switch(t){case"group":return"";case"cycle":return _0;case"item":return 0;case"pushable":return 0;case"breakable":return 0;case"collision":return Ft.ISWALK;default:return}}function Ld(e,t){const n={x:(e==null?void 0:e.x)??-1,y:(e==null?void 0:e.y)??-1},r={x:(t==null?void 0:t.x)??-1,y:(t==null?void 0:t.y)??-1},i=Lr(n,r),s=Wt(t,"pushable");return wt(s)?s!==0:pt(s)?s.trim().split(" ").map(o=>Am(Ac(o))).some(o=>o===i):!1}function zr(e,t,n,r){if(!y(e)||!y(t))return;const[i,s]=t,o=Zn(bt.OBJECT,i);if(y(o)){const c=Pd(e,n,i,r);if(y(c))return oa(c,s),CU(e,c),ur(c),Ak(e,c),c}const a=Zn(bt.TERRAIN,i);if(y(a)){const c=d$(e,n,i);if(y(c)){oa(c,s);const l=$n(n,At);return ur(c),Ak(e,c,l),c}}}function YP(e,t,n){if(!y(e)||!y(t))return;const[r,i]=t,s=Zn(bt.OBJECT,r);if(y(s)){const o=Pd(e,n,r);return oa(o,i),o}}function dn(e){const t=Zn(bt.BOARD,e);return Re(t)}function Tr(e){const t=fn("main");return Ni(t,e)}function Cw(e){const t=fn("main");return NU(t,e)}function Lw(){const e=fn("main");return Ni(e,"main")}function VP(e){const t=fn("main");return vk(t,e)}function XP(e,t){we.books.clear(),e.forEach(r=>{we.books.set(r.id,r),r.name==="main"&&(we.software.main=r.id)});const n=jr(t);if(y(n)&&(we.software.main=n.id),!we.software.main){const r=we.books.values().next();r.value&&(we.software.main=r.value.id)}}function Zl(e){return we.books.set(e.id,e),e.id}function qP(e){const t=jr(e);t&&we.books.delete(t.id)}function Mw(e){if(!pt(e)||!e)return de(tt,e,"login",`failed for playerid ==>${e}<==`);const t=le("main");if(!y(t))return de(tt,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);const n=pn(e),r=Zn(bt.BOARD,"title");if(!y(n)&&!y(r))return de(tt,e,"login:title","login failed to find board with 'title' stat");const i=Zn(bt.OBJECT,"player");if(!y(i))return de(tt,e,"login:player","login failed to find object type 'player'");const s=Re(r);if(y(s)){const o=ed(r,"startx"),a=ed(r,"starty"),c=wt(o)?o:Math.round(At*.5),l=wt(a)?a:Math.round(Ht*.5),u=Pd(s,{x:c,y:l},"player",e);if(y(u==null?void 0:u.id))return u.player=e,Ul(t,e,s.id),!0}return!1}function JP(e){const t=le("main"),n=Na(t,e);if(!y(t))return;const r=[e];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Ul(t,s,""),od(n,Mn(n,s)),Hw(n,s),lr.halt(s),vk(t,s)}}function pn(e){const t=le("main");return Na(t,e)}function ZP(e){const t=le("main"),n=$U(t,e),r=Na(t,e),i=Mn(r,e);return n&&y(i)}function QP(e){const t=le("main"),n=bo(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;wn(c)&&y(e[c])===!1&&(e[c]=0,Ul(t,c,i.id))}}}function Uw(e){lr.message(e)}function on(e,t,n,r){if(pt(n.id))if(pt(t.id))m0(tt,e,t.id,n.id,r);else{const i=`${$n({x:t.x??0,y:t.y??0},At)}`;m0(tt,e,i,n.id,r)}}function t$(e,t,n,r){const i=n.id??"";if(r.x<0){const s=dn((t==null?void 0:t.exitwest)??"");y(s)&&yo(e,i,s.id,{x:At-1,y:r.y})}else if(r.x>=At){const s=dn((t==null?void 0:t.exiteast)??"");y(s)&&yo(e,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=dn((t==null?void 0:t.exitnorth)??"");y(s)&&yo(e,i,s.id,{x:r.x,y:Ht-1})}else if(r.y>=Ht){const s=dn((t==null?void 0:t.exitsouth)??"");y(s)&&yo(e,i,s.id,{x:r.x,y:0})}}function es(e,t,n,r){if(!y(n==null?void 0:n.id))return!1;const i=cd(t,n,r);if(y(i)){const s=wn(n.id),o=wn(n.party??n.id),a=Wt(n,"collision")===Ft.ISBULLET;let c="";n.party&&o&&(c=n.party),s&&(c=n.id);const l=wn(i.id),u=wn(i.party??i.id),f=Wt(i,"collision")===Ft.ISBULLET,d=o===u;let h="";if(i.party&&u&&(h=i.party),l&&(h=i.id??""),s&&i.kind==="edge"?t$(e,t,n,r):s?l?(on(d?"":h,i,n,"thud"),on(d?"":c,n,i,"bump")):f?(on(d?"":h,i,n,d?"partyshot":"shot"),on(c,n,i,"thud")):(on(d?"":h,i,n,"thud"),on(d?"":c,n,i,"touch")):a?l?(on(d?"":h,i,n,"thud"),on(d?"":c,n,i,d?"partyshot":"shot")):f?(on(d?"":h,i,n,"thud"),on(d?"":c,n,i,"thud")):(on(d?"":h,i,n,"thud"),on(d?"":c,n,i,d?"partyshot":"shot")):l?(on(d?"":h,i,n,"thud"),on(d?"":c,n,i,"bump")):f?(on(d?"":h,i,n,d?"partyshot":"shot"),on(d?"":c,n,i,"thud")):(on(d?"":h,i,n,"thud"),on(d?"":c,n,i,"bump")),a&&Wt(i,"breakable")){if(y(i==null?void 0:i.id)){const m=re(t,{x:i.x??-1,y:i.y??-1});y(m)&&An(w.board,m,w.timestamp)}else Ne(t,{x:r.x,y:r.y});return!0}return!1}return!0}function Fw(e,t,n,r){var l;if(!y(e)||!y(t)||!y(n))return;const i={...w};w.book=e,w.board=t,w.element=n,w.elementid=n.id??"",w.elementisplayer=wn(w.elementid);const s=w.element.player??we.operator;w.elementfocus=w.elementisplayer?w.elementid:s;const o=Wt(n,"cycle"),a=n.id??"",c=Nt(n.name??((l=n.kinddata)==null?void 0:l.name)??"");if(lr.tick(a,Zi.RUNTIME,o,c,r),wt(n==null?void 0:n.tickertime)&&w.timestamp-n.tickertime>Va*5&&(n.tickertime=0,n.tickertext=""),w.elementisplayer){const u=Tr(w.elementid);wt(u.inputcurrent)&&(u.inputcurrent=0)}er(i).forEach(u=>{w[u]=i[u]})}function e$(e,t){we.loaders.set(e,t)}function n$(e){lr.halt(e)}function r$(){const e=lr.ids();for(let n=0;n<e.length;++n)lr.halt(e[n]);const t=le("main");y(t)&&(t.flags={})}function i$(e=!1){const t=le("main");if(!y(t))return;const n=t.timestamp+1,r=ki.HALT_AT_COUNT;ki.HALT_AT_COUNT=r*2,we.loaders.forEach((s,o)=>{const a={...w};w.timestamp=t.timestamp,w.book=t,w.board=void 0,w.element=void 0,w.elementid=o,w.elementisplayer=!1,w.elementfocus=Jn();const c=hB(o);y(c)&&lr.arg(o,c),lr.tick(o,Zi.LOADER,1,"loader",s),lr.isended(o)&&(lr.halt(o),we.loaders.delete(o)),er(a).forEach(l=>{w[l]=a[l]})}),ki.HALT_AT_COUNT=r,t.timestamp=n,w.timestamp=n;const i=bo(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)ur(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];ur(o.objects[u])}const c=FU(o,n);for(let l=0;l<c.length;++l){const{id:u,type:f,code:d,object:h}=c[l];f===bt.ERROR?lr.halt(u):(!e||wn((h==null?void 0:h.id)??""))&&Fw(t,o,h,d)}}}function Ro(e,t,n,r){const i=le("main");if(!y(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(y(c.id)){const l=`${Sw(c.id)}:${t}`;tt.emit("",l,n)}}}if(qo(e)){for(let o=0;o<r.length;++o){const a=r[o],c=re(a,e);y(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(Nt(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(Dw(a,[e]));break}}}}function s$(e){const t=Tr(e),n=t.playbuffer=pt(t.playbuffer)?t.playbuffer:"";n&&Bw(e,n,!1)}function Bw(e,t,n=!0){var o;const r=fn("main");if(!y(r))return;const i=`${e}_cli`;w.timestamp=r.timestamp,w.book=r,w.board=Na(r,e),w.element=Mn(w.board,e),w.elementid=((o=w.element)==null?void 0:o.id)??"",w.elementisplayer=!0,w.elementfocus=w.elementid||e;const s=ki.HALT_AT_COUNT;if(ki.HALT_AT_COUNT=s*8,lr.once(i,Zi.CLI,"cli",t),n){const a=Tr(e);a.playbuffer=t}ki.HALT_AT_COUNT=s}function Ql(e){var a;const t=fn("main"),n=As(t,e);if(!y(t)||!y(n)||!y(w.element))return;const r={...w},i=`${e}_run`,s=Nt(w.element.name??((a=w.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";lr.once(i,Zi.RUNTIME,s,o),er(r).forEach(c=>{w[c]=r[c]})}function o$(e,t){const n=le("main"),r=Na(n,e),i=[],s=[],o=[];if(!y(n)||!y(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=dn(r.overboard??""),l=dn(r.underboard??"");return s.push(...Cd(e,0,l,t,!1,!0)),o.push(...Cd(e,s.length,r,t,!0,a!=="flat")),i.push(...Cd(e,s.length+o.length,c,t,!1,!1)),{over:i,under:s,layers:o}}function Ls(e){return ae(e)&&typeof e[0]=="string"}function a$(e){const t=w.words[e];return pt(t)?[t,e+1]:[void 0,e]}function Md(e){const t=w.words[e];if(Ls(t))return[t,e+1];const[n,r]=Oc(e),[i,s]=a$(r);return pt(i)&&(i==="empty"||ur({kind:i}))?[[i,n],s]:[void 0,e]}function Pa(e){if(!Ls(e))return;const[t]=e;return t}function tu(e){if(!Ls(e))return;const[,t]=e,n=y(t)?Sc(t):void 0;return y(n)?n:void 0}function Pw(e){if(!Ls(e))return;const[,t]=e,n=y(t)?Rc(t):void 0;return y(n)?Ih(n):void 0}function $a(e,t){const n=e??Ft.ISWALK,r=t??Ft.ISWALK;switch(n){case Ft.ISWALK:return r!==Ft.ISWALK;case Ft.ISSWIM:return r!==Ft.ISSWIM;case Ft.ISSOLID:return!0;case Ft.ISBULLET:return r!==Ft.ISWALK&&r!==Ft.ISSWIM;case Ft.ISGHOST:return!1}}function Da(e,t,n){const r=e==null?void 0:e.objects[n];if(y(r))return r;const i=ja(e,"player");return y(t)?(t.x<0&&(t.x=mr(0,At-1)),t.y<0&&(t.y=mr(0,Ht-1)),jw(t,i)):gr(...i)}function ja(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(y)}function c$(e){const t=[];for(let n=0;n<Ht;++n)for(let r=0;r<At;++r){const i={x:r,y:n},s=re(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Ud(e,t,n,r){if(!y(e))return!1;const i=rn(e);return!(y(t)&&t!==i.name||y(n)&&n!==i.color||y(r)&&r!==i.bg)}function eu(e,t){const n=Pa(t),r=tu(t),i=Pw(t);return ja(e,n??"").filter(s=>Ud(s,n,r,i))}function $w(e,t){const n=y(t)?Sc(t):void 0,r=y(t)?Rc(t):void 0,i=[];if(y(e)){for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];y(a)&&Ud(a,void 0,n,r)&&i.push(a)}const s=Object.values(e.objects);for(let o=0;o<s.length;++o){const a=s[o];Ud(a,void 0,n,r)&&i.push(a)}}return i}function Dw(e,t){return y(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(y(i))return i;const s=ja(e,Nt(n));if(s.length)return s}else if(qo(n)&&n.x>=0&&n.x<At&&n.y>=0&&n.y<Ht){const i=n.x+n.y*At,s=(r=e.lookup)==null?void 0:r[i];return y(s)?e.objects[s]:e.terrain[i]}}).flat().filter(y):[]}function jw(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function l$(e,t,n,r){if(!y(e))return;y(e.distmaps)||(e.distmaps={});const i=`${t}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=e.distmaps[i];if(!y(s)){s=new Array(Lh).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(y(c)&&ru(c)){const l=$n(c,At);if(s[l]===-2){const u=ns(e,c.x,c.y);$a(t,Wt(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function zw(e,t){return ru(e)?t[$n(e,At)]:-1}function Ww(e,t,n,r,i){if(!y(e))return;const s=l$(e,t,n,r);if(!y(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=zw(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=zw(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function u$(){return new Array(At*Ht).map(()=>{})}function nu(e=ku){const t={terrain:u$(),objects:{},id:""};return e(t)}var Fd=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(Fd||{});function h$(e){return ao(e,Fd,{terrain:t=>t.map($c),objects:t=>Object.values(t).filter(n=>!n.removed).map($c),id:Se,named:Se,lookup:Se,codepage:Se,distmaps:Se,overboard:Se,underboard:Se})}function f$(e){return sa(e,Fd,{terrain:t=>t.map(Dc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Dc(t[r]);y(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function ru(e){return xh(e.x,e.y,0,At-1,Ht-1,0)}function Wr(e,t){return!y(e)||!y(t==null?void 0:t.x)||!y(t==null?void 0:t.y)||t.x<0||t.x>=At||t.y<0||t.y>=Ht?-1:t.x+t.y*At}function re(e,t){const n=Wr(e,t);if(n<0||!y(e==null?void 0:e.lookup))return;const r=Mn(e,e.lookup[n]??"");return y(r)?r:e.terrain[n]}function Gw(e,t){const n=Mn(e,t);if(y(n))return n;const r=parseFloat(t),i=KA(isNaN(r)?-1:r,At);return ns(e,i.x,i.y)}function ns(e,t,n){return(t>=0&&t<At)??(n>=0&&n<Ht)?e==null?void 0:e.terrain[t+n*At]:void 0}function Ne(e,t){if(!y(e)||!y(t)||!y(t.x)||!y(t.y)||t.x<0||t.x>=At||t.y<0||t.y>=Ht)return;const n=Sr(t),r=t.x+t.y*At;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function Bd(e,t){if(!y(e)||!y(t))return;const n=Sr(t);return n.id=n.id??ze(),e.objects[n.id]=n,e.objects[n.id]}function d$(e,t,n){return Ne(e,{...t,kind:n})}function Pd(e,t,n,r){return Bd(e,{...t,kind:n,id:r})}function Mn(e,t){if(e)return e.objects[t]}function Kw(e,t){const n=Wr(e,t);if(n<0||!y(e==null?void 0:e.lookup))return;const r=Mn(e,e.lookup[n]??"");if(y(r))return r}function An(e,t,n){return!y(t)||rn(t).name==="player"?!1:(t.id?(t.removed=n,od(e,t)):(Ne(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),LU(e,t)),!0)}function Hw(e,t){return y(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function p$(e,t,n){if(!y(e)||!y(t))return;const r=e.objects[n];if(y(r))return r;if(qo(t))return jw(t,ja(e,"player"))}function iu(e,t,n,r,i){const s=_t.MID;if(!y(e)||!y(t))return{dir:r,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:o.x+(t.stepx??0),y:o.y+(t.stepy??0)},c=Lr(o,a),l=At-1,u=Ht-1;for(let f=0;f<r.length;++f){const d=Am(r[f]);switch(d){case _t.IDLE:break;case _t.NORTH:case _t.SOUTH:case _t.WEST:case _t.EAST:Pe(o,d);break;case _t.BY:{const[h,m]=r.slice(f+1);wt(h)&&wt(m)&&(o.x=Ge(o.x+h,0,l),o.y=Ge(o.y+m,0,u)),f+=2;break}case _t.TO:{const[h,m]=r.slice(f+1);wt(h)&&wt(m)&&(o.x=Ge(h,0,l),o.y=Ge(m,0,u)),f+=2;break}case _t.AT:{const[h,m]=r.slice(f+1);wt(h)&&wt(m)&&(o.x=Ge(h,0,l),o.y=Ge(m,0,u)),f+=2;break}case _t.FLOW:Pe(o,c);break;case _t.SEEK:{const h=p$(e,t,n);qo(h)&&Pe(o,Lr(i,h));break}case _t.RNDNS:Pe(o,gr(_t.NORTH,_t.SOUTH));break;case _t.RNDNE:Pe(o,gr(_t.NORTH,_t.EAST));break;case _t.RND:Pe(o,gr(_t.NORTH,_t.SOUTH,_t.WEST,_t.EAST));break;case _t.CW:case _t.CCW:case _t.OPP:case _t.RNDP:{const h=iu(e,t,n,r.slice(f+1),i);switch(o.x=i.x,o.y=i.y,d){case _t.CW:switch(Lr(i,h.destpt)){case _t.NORTH:Pe(o,_t.EAST);break;case _t.SOUTH:Pe(o,_t.WEST);break;case _t.EAST:Pe(o,_t.SOUTH);break;case _t.WEST:Pe(o,_t.NORTH);break}break;case _t.CCW:switch(Lr(i,h.destpt)){case _t.NORTH:Pe(o,_t.WEST);break;case _t.SOUTH:Pe(o,_t.EAST);break;case _t.EAST:Pe(o,_t.NORTH);break;case _t.WEST:Pe(o,_t.SOUTH);break}break;case _t.OPP:switch(Lr(i,h.destpt)){case _t.NORTH:Pe(o,_t.SOUTH);break;case _t.SOUTH:Pe(o,_t.NORTH);break;case _t.EAST:Pe(o,_t.WEST);break;case _t.WEST:Pe(o,_t.EAST);break}break;case _t.RNDP:switch(Lr(i,h.destpt)){case _t.NORTH:case _t.SOUTH:o.x+=gr(-1,1);break;case _t.WEST:case _t.EAST:o.y+=gr(-1,1);break}break}return{dir:r,startpt:i,destpt:o,layer:s}}case _t.FLEE:break;case _t.AWAY:{const[h,m]=r.slice(f+1);if(wt(h)&&wt(m)){const p={x:Ge(h,0,l),y:Ge(m,0,u)},b=p.x-o.x,k=p.y-o.y;if(Math.abs(b)>1||Math.abs(k)>1){const x=Wt(t,"collision"),T=Ww(e,x,o,p,!0);y(T)&&T.x!==h&&T.y!==m&&!Kw(e,T)&&(o.x=T.x,o.y=T.y)}else{const x=Oh(-b,-k);Pe(o,x)}}f+=2;break}case _t.FIND:break;case _t.TOWARD:{const[h,m]=r.slice(f+1);if(wt(h)&&wt(m)){const p={x:Ge(h,0,l),y:Ge(m,0,u)},b=p.x-o.x,k=p.y-o.y;if(Math.abs(b)>1||Math.abs(k)>1){const x=Wt(t,"collision"),T=Ww(e,x,o,p,!1);y(T)&&T.x!==h&&T.y!==m&&!Kw(e,T)&&(o.x=T.x,o.y=T.y)}else{const x=Oh(b,k);Pe(o,x)}}f+=2;break}case _t.OVER:case _t.UNDER:{const h=iu(e,t,n,r.slice(f+1),i);return h.layer=d,h}}}return{dir:r,startpt:i,destpt:o,layer:s}}const w={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var K=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.COLOR_OR_KIND=7]="COLOR_OR_KIND",e[e.MAYBE_KIND=8]="MAYBE_KIND",e[e.MAYBE_NAME=9]="MAYBE_NAME",e[e.MAYBE_NUMBER=10]="MAYBE_NUMBER",e[e.MAYBE_STRING=11]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",e[e.ANY=13]="ANY",e))(K||{});function mn(e,t,n){throw console.info(n,w.element,w.elementid,w.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function Yw(e){var n,r;const t={x:((n=w.element)==null?void 0:n.x)??0,y:((r=w.element)==null?void 0:r.y)??0};return iu(w.board,w.element,w.elementfocus,e,t)}function rt(e,t,n){const r=w.words;w.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=Md(s);Ls(a)?(s=c,i.push(a)):mn("kind",a,e);break}case 0:{if(Zo(e[s])===void 0){const[a,c]=Cn(s);Sn(a)?(s=c,i.push(a)):mn("color",a,e)}else{const[a,c]=Oc(s);Sn(a)?(s=c,i.push(a)):mn("color",a,e)}break}case 2:{if(Ac(e[s])===void 0){const[a,c]=Cn(s);Dn(a)?(s=c,i.push(Yw(a))):mn("direction",a,e)}else{const[a,c]=Rm(s);Dn(a)?(s=c,i.push(Yw(a))):mn("direction",a,e)}break}case 3:{const a=w.words[s];pt(a)||mn("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Cn(s);if(pt(a)){const l=parseFloat(a);wt(l)?i.push(l):mn("number",a,e)}else wt(a)?i.push(a):mn("number",a,e);s=c;break}case 5:{const[a,c]=Cn(s);pt(a)||mn("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Cn(s);let l=a;if(pt(l)){const u=parseFloat(l);wt(u)&&(l=u)}else wt(l)||mn("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=Md(s);if(Ls(a))s=c,i.push(a);else if(Zo(e[s])===void 0){const[l,u]=Cn(s);Sn(l)?(s=u,i.push(l)):mn("color",l,e)}else{const[l,u]=Oc(s);Sn(l)?(s=u,i.push(l)):mn("color or kind",l,e)}break}case 8:{const[a,c]=Md(s);a!==void 0&&!Ls(a)&&mn("optional kind",a,e),s=c,i.push(a);break}case 9:{const a=w.words[s];a!==void 0&&!pt(a)&&mn("optional string",a,e),++s,i.push(a);break}case 10:{const[a,c]=Cn(s);if(pt(a)){const l=parseFloat(a);wt(l)?i.push(l):mn("optional number",a,e)}else wt(a)||a===void 0?i.push(a):mn("optional number",a,e);s=c;break}case 11:{const[a,c]=Cn(s);a!==void 0&&!pt(a)&&mn("optional string",a,e),s=c,i.push(a);break}case 12:{const[a,c]=Cn(s);let l=a;if(pt(l)){const u=parseFloat(l);wt(u)&&(l=u)}else l!==void 0&&!wt(l)&&mn("number or string",l,e);s=c,i.push(l);break}case 13:{const[a,c]=Cn(s);s=c,i.push(a);break}}return w.words=r,[...i,s]}const su={},Oo={};function $d(){return{id:ze(),layers:[],scroll:[],sidebar:[]}}const m$=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),g$=new Set(["tx","text"]),_$={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Vw={};let Xw=e=>{let t=Vw[e];return y(t)||(Vw[e]=t=$d()),t};function y$(e){Xw=e}function Fe(e){return Xw(e)}function Dd(e){return y(su[e])||(su[e]=[]),su[e]}function b$(e){const t=Fe(e);t.scrollname="",t.scroll=[]}function k$(e,t,n){Object.values(Oo).forEach(r=>{if(r[t]!==void 0){const i=Mm(e.id(),t);wt(n)&&zA(i,n),pt(n)&&WA(i,n)}})}function gn(e){const t=Dd(e);return su[e]=[],t}function qw(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n];pt(r)&&y(VU(r))?t.push(" ",r," "):t.push(r)}return t}function Tt(e,t){Dd(e).push(t)}function Ct(e,t,n,r,i=()=>0,s=ku){const o=[t,n,...r],a=Nt(`${o[3]}`),c={...w};function l(u,f){y(f)&&f!==i(u)&&(w.board=c.board,w.element=c.element,w.elementfocus=c.elementfocus,s(u,f))}if(m$.has(a)){const u=`${o[2]}`;Oo[t]=Oo[t]??{};const f=i(u)??_$[a];if(Oo[t][u]===void 0){const d=Mm(t,u);wt(f)&&jA(d,f),pt(f)&&Eh(d,f),g$.has(a)?Oo[t][u]=lm(d,h=>{l(u,h)}):Oo[t][u]=GA(d,h=>{l(u,h)})}}Dd(e).push(o)}y$(e=>{if(wn(e)){const t=le(Dt.MAIN),n=Ni(t,Dt.GADGETSTORE);let r=n[e];return y(r)||(n[e]=r=$d()),r}return $d()});let Jw=0;function w$(){switch(Jw++){case 0:return Lt.BLUE;case 1:return Lt.BLACK;case 2:return Lt.GREEN;case 3:return Lt.BLACK;case 4:return Lt.CYAN;case 5:return Lt.BLACK;case 6:return Lt.RED;case 7:return Lt.BLACK;case 8:return Lt.PURPLE;case 9:return Lt.BLACK;case 10:return Lt.YELLOW;case 11:return Lt.BLACK;case 12:return Lt.WHITE;default:return Jw=0,Lt.BLACK}}const ou=Bs("gadgetserver",["tock","second"],e=>{if(!ou.session(e))return;const t=le(Dt.MAIN),n=[...(t==null?void 0:t.activelist)??[],Jn()],r=[...new Set(n.values())],i=Ni(t,Dt.GADGETSYNC);switch(e.target){case"tock":{const s=w$();for(let o=0;o<r.length;++o){const a=r[o],{over:c,under:l,layers:u}=o$(a,s),f=Fe(a);f.over=c,f.under=l,f.layers=u;const d=i[a]??{},h=c0(d,f);h.length&&(i[a]=Sr(f),fx(ou,a,h))}break}case"second":for(let s=0;s<r.length;++s){const o=r[s],a=pn(o);y(a)&&Sx(ou,o,a.id)}break;case"desync":hx(ou,e.player,Fe(e.player));break;case"clearscroll":b$(e.player);break;case"clearplayer":{const s=Ni(t,Dt.GADGETSTORE);delete s[e.player];const o=Ni(t,Dt.GADGETSYNC);delete o[e.player];break}}});function au(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Zw={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof au=="function"&&au;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(m){var p=r[l][1][m];return o(p||m)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof au=="function"&&au,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,m,p,b=[],k=0,x=c.length,T=x,A=s.getTypeOf(c)!=="string";k<c.length;)T=x-k,f=A?(l=c[k++],u=k<x?c[k++]:0,k<x?c[k++]:0):(l=c.charCodeAt(k++),u=k<x?c.charCodeAt(k++):0,k<x?c.charCodeAt(k++):0),d=l>>2,h=(3&l)<<4|u>>4,m=1<T?(15&u)<<2|f>>6:64,p=2<T?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(m)+a.charAt(p));return b.join("")},i.decode=function(c){var l,u,f,d,h,m,p=0,b=0,k="data:";if(c.substr(0,k.length)===k)throw new Error("Invalid base64 input, it looks like a data url.");var x,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=o.uint8array?new Uint8Array(0|T):new Array(0|T);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(p++)))>>2,f=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),x[b++]=l,h!==64&&(x[b++]=u),m!==64&&(x[b++]=f);return x}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,m){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,m){var p,b="";for(p=0;p<m;p++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,m,p,b,k,x){var T,A,M=h.file,S=h.compression,I=x!==l.utf8encode,$=a.transformTo("string",x(M.name)),N=a.transformTo("string",l.utf8encode(M.name)),z=M.comment,J=a.transformTo("string",x(z)),L=a.transformTo("string",l.utf8encode(z)),O=N.length!==M.name.length,E=L.length!==z.length,C="",P="",F="",st=M.dir,et=M.date,ot={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(ot.crc32=h.crc32,ot.compressedSize=h.compressedSize,ot.uncompressedSize=h.uncompressedSize);var W=0;m&&(W|=8),I||!O&&!E||(W|=2048);var D=0,yt=0;st&&(D|=16),k==="UNIX"?(yt=798,D|=function(at,Pt){var Gt=at;return at||(Gt=Pt?16893:33204),(65535&Gt)<<16}(M.unixPermissions,st)):(yt=20,D|=function(at){return 63&(at||0)}(M.dosPermissions)),T=et.getUTCHours(),T<<=6,T|=et.getUTCMinutes(),T<<=5,T|=et.getUTCSeconds()/2,A=et.getUTCFullYear()-1980,A<<=4,A|=et.getUTCMonth()+1,A<<=5,A|=et.getUTCDate(),O&&(P=s(1,1)+s(u($),4)+N,C+="up"+s(P.length,2)+P),E&&(F=s(1,1)+s(u(J),4)+L,C+="uc"+s(F.length,2)+F);var X="";return X+=`
\0`,X+=s(W,2),X+=S.magic,X+=s(T,2),X+=s(A,2),X+=s(ot.crc32,4),X+=s(ot.compressedSize,4),X+=s(ot.uncompressedSize,4),X+=s($.length,2),X+=s(C.length,2),{fileRecord:f.LOCAL_FILE_HEADER+X+$+C,dirRecord:f.CENTRAL_FILE_HEADER+s(yt,2)+X+s(J.length,2)+"\0\0\0\0"+s(D,4)+s(b,4)+$+C+J}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,m,p,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-b-1))/p:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,b=function(k,x,T,A,M){var S=a.transformTo("string",M(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(k,2)+s(k,2)+s(x,4)+s(T,4)+s(S.length,2)+S}(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var m=function(x,T){var A=x||T,M=s[A];if(!M)throw new Error(A+" is not a valid compression method !");return M}(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,k=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:d,dir:b,date:k,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(b){m(b)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(p){var b=new c(h);return b.load(p),b}).then(function(p){var b=[o.Promise.resolve(p)],k=p.files;if(h.checkCRC32)for(var x=0;x<k.length;x++)b.push(f(k[x]));return o.Promise.all(b)}).then(function(p){for(var b=p.shift(),k=b.files,x=0;x<k.length;x++){var T=k[x],A=T.fileNameStr,M=s.resolve(T.fileNameStr);m.file(M,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(m.file(M).unsafeOriginalName=A)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof _n<"u",newBufferFrom:function(s,o){if(_n.from&&_n.from!==Uint8Array.from)return _n.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new _n(s,o)},allocBuffer:function(s){if(_n.alloc)return _n.alloc(s);var o=new _n(s);return o.fill(0),o},isBuffer:function(s){return _n.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(M,S,I){var $,N=a.getTypeOf(S),z=a.extend(I||{},u);z.date=z.date||new Date,z.compression!==null&&(z.compression=z.compression.toUpperCase()),typeof z.unixPermissions=="string"&&(z.unixPermissions=parseInt(z.unixPermissions,8)),z.unixPermissions&&16384&z.unixPermissions&&(z.dir=!0),z.dosPermissions&&16&z.dosPermissions&&(z.dir=!0),z.dir&&(M=k(M)),z.createFolders&&($=b(M))&&x.call(this,$,!0);var J=N==="string"&&z.binary===!1&&z.base64===!1;I&&I.binary!==void 0||(z.binary=!J),(S instanceof f&&S.uncompressedSize===0||z.dir||!S||S.length===0)&&(z.base64=!1,z.binary=!0,S="",z.compression="STORE",N="string");var L=null;L=S instanceof f||S instanceof c?S:m.isNode&&m.isStream(S)?new p(M,S):a.prepareContent(M,S,z.binary,z.optimizedBinaryString,z.base64);var O=new d(M,L,z);this.files[M]=O}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),m=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),b=function(M){M.slice(-1)==="/"&&(M=M.substring(0,M.length-1));var S=M.lastIndexOf("/");return 0<S?M.substring(0,S):""},k=function(M){return M.slice(-1)!=="/"&&(M+="/"),M},x=function(M,S){return S=S!==void 0?S:u.createFolders,M=k(M),this.files[M]||s.call(this,M,null,{dir:!0,createFolders:S}),this.files[M]};function T(M){return Object.prototype.toString.call(M)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(M){var S,I,$;for(S in this.files)$=this.files[S],(I=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&M(I,$)},filter:function(M){var S=[];return this.forEach(function(I,$){M(I,$)&&S.push($)}),S},file:function(M,S,I){if(arguments.length!==1)return M=this.root+M,s.call(this,M,S,I),this;if(T(M)){var $=M;return this.filter(function(z,J){return!J.dir&&$.test(z)})}var N=this.files[this.root+M];return N&&!N.dir?N:null},folder:function(M){if(!M)return this;if(T(M))return this.filter(function(N,z){return z.dir&&M.test(N)});var S=this.root+M,I=x.call(this,S),$=this.clone();return $.root=I.name,$},remove:function(M){M=this.root+M;var S=this.files[M];if(S||(M.slice(-1)!=="/"&&(M+="/"),S=this.files[M]),S&&!S.dir)delete this.files[M];else for(var I=this.filter(function(N,z){return z.name.slice(0,M.length)===M}),$=0;$<I.length;$++)delete this.files[I[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(M){var S,I={};try{if((I=a.extend(M||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");a.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var $=I.comment||this.comment||"";S=h.generateWorker(this,I,$)}catch(N){(S=new c("error")).error(N)}return new l(S,I.type||"string",I.mimeType)},generateAsync:function(M,S){return this.generateInternalStream(M).accumulate(S)},generateNodeStream:function(M,S){return(M=M||{}).type||(M.type="nodebuffer"),this.generateInternalStream(M).toNodejsStream(S)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(b,k){var x=[],T=m._internalType,A=m._outputType,M=m._mimeType;m.on("data",function(S,I){x.push(S),p&&p(I)}).on("error",function(S){x=[],k(S)}).on("end",function(){try{var S=function(I,$,N){switch(I){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),N);case"base64":return c.encode($);default:return s.transformTo(I,$)}}(A,function(I,$){var N,z=0,J=null,L=0;for(N=0;N<$.length;N++)L+=$[N].length;switch(I){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(J=new Uint8Array(L),N=0;N<$.length;N++)J.set($[N],z),z+=$[N].length;return J;case"nodebuffer":return _n.concat($);default:throw new Error("concat : unsupported type '"+I+"'")}}(T,x),M);b(S)}catch(I){k(I)}x=[]}).resume()})}function h(m,p,b){var k=p;switch(p){case"blob":case"arraybuffer":k="uint8array";break;case"base64":k="string"}try{this._internalType=k,this._outputType=p,this._mimeType=b,s.checkSupport(k),this._worker=m.pipe(new o(k)),m.lock()}catch(x){this._worker=new a("error"),this._worker.error(x)}}h.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var b=this;return m==="data"?this._worker.on(m,function(k){p.call(b,k.data,k.meta)}):this._worker.on(m,function(){s.delay(p,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof _n<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(m){var p,b,k,x,T,A=m.length,M=0;for(x=0;x<A;x++)(64512&(b=m.charCodeAt(x)))==55296&&x+1<A&&(64512&(k=m.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(k-56320),x++),M+=b<128?1:b<2048?2:b<65536?3:4;for(p=o.uint8array?new Uint8Array(M):new Array(M),x=T=0;T<M;x++)(64512&(b=m.charCodeAt(x)))==55296&&x+1<A&&(64512&(k=m.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(k-56320),x++),b<128?p[T++]=b:(b<2048?p[T++]=192|b>>>6:(b<65536?p[T++]=224|b>>>12:(p[T++]=240|b>>>18,p[T++]=128|b>>>12&63),p[T++]=128|b>>>6&63),p[T++]=128|63&b);return p}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(m){var p,b,k,x,T=m.length,A=new Array(2*T);for(p=b=0;p<T;)if((k=m[p++])<128)A[b++]=k;else if(4<(x=l[k]))A[b++]=65533,p+=x-1;else{for(k&=x===2?31:x===3?15:7;1<x&&p<T;)k=k<<6|63&m[p++],x--;1<x?A[b++]=65533:k<65536?A[b++]=k:(k-=65536,A[b++]=55296|k>>10&1023,A[b++]=56320|1023&k)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(x,T){var A;for((T=T||x.length)>x.length&&(T=x.length),A=T-1;0<=A&&(192&x[A])==128;)A--;return A<0||A===0?T:A+l[x[A]]>T?A:T}(m),k=m;b!==m.length&&(o.uint8array?(k=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(k=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:i.utf8decode(k),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(p){return p}function u(p,b){for(var k=0;k<p.length;++k)b[k]=255&p.charCodeAt(k);return b}n("setimmediate"),i.newBlob=function(p,b){i.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var k=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return k.append(p),k.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,b,k){var x=[],T=0,A=p.length;if(A<=k)return String.fromCharCode.apply(null,p);for(;T<A;)b==="array"||b==="nodebuffer"?x.push(String.fromCharCode.apply(null,p.slice(T,Math.min(T+k,A)))):x.push(String.fromCharCode.apply(null,p.subarray(T,Math.min(T+k,A)))),T+=k;return x.join("")},stringifyByChar:function(p){for(var b="",k=0;k<p.length;k++)b+=String.fromCharCode(p[k]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var b=65536,k=i.getTypeOf(p),x=!0;if(k==="uint8array"?x=f.applyCanBeUsed.uint8array:k==="nodebuffer"&&(x=f.applyCanBeUsed.nodebuffer),x)for(;1<b;)try{return f.stringifyByChunk(p,k,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(p)}function h(p,b){for(var k=0;k<p.length;k++)b[k]=p[k];return b}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,b){if(b=b||"",!p)return b;i.checkSupport(p);var k=i.getTypeOf(b);return m[k][p](b)},i.resolve=function(p){for(var b=p.split("/"),k=[],x=0;x<b.length;x++){var T=b[x];T==="."||T===""&&x!==0&&x!==b.length-1||(T===".."?k.pop():k.push(T))}return k.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var b,k,x="";for(k=0;k<(p||"").length;k++)x+="\\x"+((b=p.charCodeAt(k))<16?"0":"")+b.toString(16).toUpperCase();return x},i.delay=function(p,b,k){setImmediate(function(){p.apply(k||null,b||[])})},i.inherits=function(p,b){function k(){}k.prototype=b.prototype,p.prototype=new k},i.extend=function(){var p,b,k={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&k[b]===void 0&&(k[b]=arguments[p][b]);return k},i.prepareContent=function(p,b,k,x,T){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(M,S){var I=new FileReader;I.onload=function($){M($.target.result)},I.onerror=function($){S($.target.error)},I.readAsArrayBuffer(A)}):A}).then(function(A){var M=i.getTypeOf(A);return M?(M==="arraybuffer"?A=i.transformTo("uint8array",A):M==="string"&&(T?A=o.decode(A):k&&x!==!0&&(A=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=d-h;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,m){this.options=h,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var k in u)if(Object.prototype.hasOwnProperty.call(u,k)&&u[k].magic===b)return u[k];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,b,k=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<k;)m=h.readInt(2),p=h.readInt(2),b=h.readData(p),this.extraFields[m]={id:m,length:p,value:b};h.setIndex(k)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var k=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(k)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(m,p,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,b="string";try{if(!m)throw new Error("No output type specified.");var k=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var x=!this._dataBinary;x&&!k&&(p=p.pipe(new c.Utf8EncodeWorker)),!x&&k&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(T){(p=new u("error")).error(T)}return new o(p,b,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var h=[];function m(){var p,b;a=!0;for(var k=h.length;k;){for(b=h,h=[],p=-1;++p<k;)b[p]();k=h.length}a=!1}r.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof Un<"u"?Un:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(k){if(typeof k!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,k!==o&&p(this,k)}function d(k,x,T){this.promise=k,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(k,x,T){s(function(){var A;try{A=x(T)}catch(M){return a.reject(k,M)}A===k?a.reject(k,new TypeError("Cannot resolve promise with itself")):a.resolve(k,A)})}function m(k){var x=k&&k.then;if(k&&(typeof k=="object"||typeof k=="function")&&typeof x=="function")return function(){x.apply(k,arguments)}}function p(k,x){var T=!1;function A(I){T||(T=!0,a.reject(k,I))}function M(I){T||(T=!0,a.resolve(k,I))}var S=b(function(){x(M,A)});S.status==="error"&&A(S.value)}function b(k,x){var T={};try{T.value=k(x),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(k){if(typeof k!="function")return this;var x=this.constructor;return this.then(function(T){return x.resolve(k()).then(function(){return T})},function(T){return x.resolve(k()).then(function(){throw T})})},f.prototype.catch=function(k){return this.then(null,k)},f.prototype.then=function(k,x){if(typeof k!="function"&&this.state===l||typeof x!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?k:x,this.outcome):this.queue.push(new d(T,k,x)),T},d.prototype.callFulfilled=function(k){a.resolve(this.promise,k)},d.prototype.otherCallFulfilled=function(k){h(this.promise,this.onFulfilled,k)},d.prototype.callRejected=function(k){a.reject(this.promise,k)},d.prototype.otherCallRejected=function(k){h(this.promise,this.onRejected,k)},a.resolve=function(k,x){var T=b(m,x);if(T.status==="error")return a.reject(k,T.value);var A=T.value;if(A)p(k,A);else{k.state=l,k.outcome=x;for(var M=-1,S=k.queue.length;++M<S;)k.queue[M].callFulfilled(x)}return k},a.reject=function(k,x){k.state=c,k.outcome=x;for(var T=-1,A=k.queue.length;++T<A;)k.queue[T].callRejected(x);return k},f.resolve=function(k){return k instanceof this?k:a.resolve(new this(o),k)},f.reject=function(k){var x=new this(o);return a.reject(x,k)},f.all=function(k){var x=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=k.length,A=!1;if(!T)return this.resolve([]);for(var M=new Array(T),S=0,I=-1,$=new this(o);++I<T;)N(k[I],I);return $;function N(z,J){x.resolve(z).then(function(L){M[J]=L,++S!==T||A||(A=!0,a.resolve($,M))},function(L){A||(A=!0,a.reject($,L))})}},f.race=function(k){var x=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=k.length,A=!1;if(!T)return this.resolve([]);for(var M=-1,S=new this(o);++M<T;)I=k[M],x.resolve(I).then(function($){A||(A=!0,a.resolve(S,$))},function($){A||(A=!0,a.reject(S,$))});var I;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,m=8;function p(k){if(!(this instanceof p))return new p(k);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},k||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(T!==f)throw new Error(c[T]);if(x.header&&s.deflateSetHeader(this.strm,x.header),x.dictionary){var A;if(A=typeof x.dictionary=="string"?a.string2buf(x.dictionary):u.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function b(k,x){var T=new p(x);if(T.push(k,!0),T.err)throw T.msg||c[T.err];return T.result}p.prototype.push=function(k,x){var T,A,M=this.strm,S=this.options.chunkSize;if(this.ended)return!1;A=x===~~x?x:x===!0?4:0,typeof k=="string"?M.input=a.string2buf(k):u.call(k)==="[object ArrayBuffer]"?M.input=new Uint8Array(k):M.input=k,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new o.Buf8(S),M.next_out=0,M.avail_out=S),(T=s.deflate(M,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);M.avail_out!==0&&(M.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(M.output,M.next_out))):this.onData(o.shrinkBuf(M.output,M.next_out)))}while((0<M.avail_in||M.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(M.avail_out=0))},p.prototype.onData=function(k){this.chunks.push(k)},p.prototype.onEnd=function(k){k===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.msg=this.strm.msg},i.Deflate=p,i.deflate=b,i.deflateRaw=function(k,x){return(x=x||{}).raw=!0,b(k,x)},i.gzip=function(k,x){return(x=x||{}).gzip=!0,b(k,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var k=s.inflateInit2(this.strm,b.windowBits);if(k!==c.Z_OK)throw new Error(l[k]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function m(p,b){var k=new h(b);if(k.push(p,!0),k.err)throw k.msg||l[k.err];return k.result}h.prototype.push=function(p,b){var k,x,T,A,M,S,I=this.strm,$=this.options.chunkSize,N=this.options.dictionary,z=!1;if(this.ended)return!1;x=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?I.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?I.input=new Uint8Array(p):I.input=p,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8($),I.next_out=0,I.avail_out=$),(k=s.inflate(I,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(S=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,k=s.inflateSetDictionary(this.strm,S)),k===c.Z_BUF_ERROR&&z===!0&&(k=c.Z_OK,z=!1),k!==c.Z_STREAM_END&&k!==c.Z_OK)return this.onEnd(k),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&k!==c.Z_STREAM_END&&(I.avail_in!==0||x!==c.Z_FINISH&&x!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(I.output,I.next_out),A=I.next_out-T,M=a.buf2string(I.output,T),I.next_out=A,I.avail_out=$-A,A&&o.arraySet(I.output,I.output,T,A,0),this.onData(M)):this.onData(o.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(z=!0)}while((0<I.avail_in||I.avail_out===0)&&k!==c.Z_STREAM_END);return k===c.Z_STREAM_END&&(x=c.Z_FINISH),x===c.Z_FINISH?(k=s.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===c.Z_OK):x!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(I.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,b){return(b=b||{}).raw=!0,m(p,b)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,m;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(m=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],m.set(h,d),d+=h.length;return m}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",m=0;m<d;m++)h+=String.fromCharCode(f[m]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,m,p,b,k=f.length,x=0;for(p=0;p<k;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<k&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),x+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(x),p=b=0;b<x;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<k&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,m=d.length;h<m;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,m,p,b,k=d||f.length,x=new Array(2*k);for(h=m=0;h<k;)if((p=f[h++])<128)x[m++]=p;else if(4<(b=c[p]))x[m++]=65533,h+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&h<k;)p=p<<6|63&f[h++],b--;1<b?x[m++]=65533:p<65536?x[m++]=p:(p-=65536,x[m++]=55296|p>>10&1023,x[m++]=56320|1023&p)}return u(x,m)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,m=-2,p=-1,b=4,k=2,x=8,T=9,A=286,M=30,S=19,I=2*A+1,$=15,N=3,z=258,J=z+N+1,L=42,O=113,E=1,C=2,P=3,F=4;function st(v,ut){return v.msg=u[ut],ut}function et(v){return(v<<1)-(4<v?9:0)}function ot(v){for(var ut=v.length;0<=--ut;)v[ut]=0}function W(v){var ut=v.state,it=ut.pending;it>v.avail_out&&(it=v.avail_out),it!==0&&(o.arraySet(v.output,ut.pending_buf,ut.pending_out,it,v.next_out),v.next_out+=it,ut.pending_out+=it,v.total_out+=it,v.avail_out-=it,ut.pending-=it,ut.pending===0&&(ut.pending_out=0))}function D(v,ut){a._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,ut),v.block_start=v.strstart,W(v.strm)}function yt(v,ut){v.pending_buf[v.pending++]=ut}function X(v,ut){v.pending_buf[v.pending++]=ut>>>8&255,v.pending_buf[v.pending++]=255&ut}function at(v,ut){var it,j,B=v.max_chain_length,V=v.strstart,ht=v.prev_length,dt=v.nice_match,Q=v.strstart>v.w_size-J?v.strstart-(v.w_size-J):0,gt=v.window,vt=v.w_mask,mt=v.prev,It=v.strstart+z,fe=gt[V+ht-1],zt=gt[V+ht];v.prev_length>=v.good_match&&(B>>=2),dt>v.lookahead&&(dt=v.lookahead);do if(gt[(it=ut)+ht]===zt&&gt[it+ht-1]===fe&&gt[it]===gt[V]&&gt[++it]===gt[V+1]){V+=2,it++;do;while(gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&gt[++V]===gt[++it]&&V<It);if(j=z-(It-V),V=It-z,ht<j){if(v.match_start=ut,dt<=(ht=j))break;fe=gt[V+ht-1],zt=gt[V+ht]}}while((ut=mt[ut&vt])>Q&&--B!=0);return ht<=v.lookahead?ht:v.lookahead}function Pt(v){var ut,it,j,B,V,ht,dt,Q,gt,vt,mt=v.w_size;do{if(B=v.window_size-v.lookahead-v.strstart,v.strstart>=mt+(mt-J)){for(o.arraySet(v.window,v.window,mt,mt,0),v.match_start-=mt,v.strstart-=mt,v.block_start-=mt,ut=it=v.hash_size;j=v.head[--ut],v.head[ut]=mt<=j?j-mt:0,--it;);for(ut=it=mt;j=v.prev[--ut],v.prev[ut]=mt<=j?j-mt:0,--it;);B+=mt}if(v.strm.avail_in===0)break;if(ht=v.strm,dt=v.window,Q=v.strstart+v.lookahead,gt=B,vt=void 0,vt=ht.avail_in,gt<vt&&(vt=gt),it=vt===0?0:(ht.avail_in-=vt,o.arraySet(dt,ht.input,ht.next_in,vt,Q),ht.state.wrap===1?ht.adler=c(ht.adler,dt,vt,Q):ht.state.wrap===2&&(ht.adler=l(ht.adler,dt,vt,Q)),ht.next_in+=vt,ht.total_in+=vt,vt),v.lookahead+=it,v.lookahead+v.insert>=N)for(V=v.strstart-v.insert,v.ins_h=v.window[V],v.ins_h=(v.ins_h<<v.hash_shift^v.window[V+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[V+N-1])&v.hash_mask,v.prev[V&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=V,V++,v.insert--,!(v.lookahead+v.insert<N)););}while(v.lookahead<J&&v.strm.avail_in!==0)}function Gt(v,ut){for(var it,j;;){if(v.lookahead<J){if(Pt(v),v.lookahead<J&&ut===f)return E;if(v.lookahead===0)break}if(it=0,v.lookahead>=N&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,it=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),it!==0&&v.strstart-it<=v.w_size-J&&(v.match_length=at(v,it)),v.match_length>=N)if(j=a._tr_tally(v,v.strstart-v.match_start,v.match_length-N),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=N){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,it=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else j=a._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(j&&(D(v,!1),v.strm.avail_out===0))return E}return v.insert=v.strstart<N-1?v.strstart:N-1,ut===d?(D(v,!0),v.strm.avail_out===0?P:F):v.last_lit&&(D(v,!1),v.strm.avail_out===0)?E:C}function jt(v,ut){for(var it,j,B;;){if(v.lookahead<J){if(Pt(v),v.lookahead<J&&ut===f)return E;if(v.lookahead===0)break}if(it=0,v.lookahead>=N&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,it=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=N-1,it!==0&&v.prev_length<v.max_lazy_match&&v.strstart-it<=v.w_size-J&&(v.match_length=at(v,it),v.match_length<=5&&(v.strategy===1||v.match_length===N&&4096<v.strstart-v.match_start)&&(v.match_length=N-1)),v.prev_length>=N&&v.match_length<=v.prev_length){for(B=v.strstart+v.lookahead-N,j=a._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-N),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=B&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+N-1])&v.hash_mask,it=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=N-1,v.strstart++,j&&(D(v,!1),v.strm.avail_out===0))return E}else if(v.match_available){if((j=a._tr_tally(v,0,v.window[v.strstart-1]))&&D(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return E}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(j=a._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<N-1?v.strstart:N-1,ut===d?(D(v,!0),v.strm.avail_out===0?P:F):v.last_lit&&(D(v,!1),v.strm.avail_out===0)?E:C}function $t(v,ut,it,j,B){this.good_length=v,this.max_lazy=ut,this.nice_length=it,this.max_chain=j,this.func=B}function ue(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*I),this.dyn_dtree=new o.Buf16(2*(2*M+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),ot(this.dyn_ltree),ot(this.dyn_dtree),ot(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16($+1),this.heap=new o.Buf16(2*A+1),ot(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),ot(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Jt(v){var ut;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=k,(ut=v.state).pending=0,ut.pending_out=0,ut.wrap<0&&(ut.wrap=-ut.wrap),ut.status=ut.wrap?L:O,v.adler=ut.wrap===2?0:1,ut.last_flush=f,a._tr_init(ut),h):st(v,m)}function Ie(v){var ut=Jt(v);return ut===h&&function(it){it.window_size=2*it.w_size,ot(it.head),it.max_lazy_match=s[it.level].max_lazy,it.good_match=s[it.level].good_length,it.nice_match=s[it.level].nice_length,it.max_chain_length=s[it.level].max_chain,it.strstart=0,it.block_start=0,it.lookahead=0,it.insert=0,it.match_length=it.prev_length=N-1,it.match_available=0,it.ins_h=0}(v.state),ut}function je(v,ut,it,j,B,V){if(!v)return m;var ht=1;if(ut===p&&(ut=6),j<0?(ht=0,j=-j):15<j&&(ht=2,j-=16),B<1||T<B||it!==x||j<8||15<j||ut<0||9<ut||V<0||b<V)return st(v,m);j===8&&(j=9);var dt=new ue;return(v.state=dt).strm=v,dt.wrap=ht,dt.gzhead=null,dt.w_bits=j,dt.w_size=1<<dt.w_bits,dt.w_mask=dt.w_size-1,dt.hash_bits=B+7,dt.hash_size=1<<dt.hash_bits,dt.hash_mask=dt.hash_size-1,dt.hash_shift=~~((dt.hash_bits+N-1)/N),dt.window=new o.Buf8(2*dt.w_size),dt.head=new o.Buf16(dt.hash_size),dt.prev=new o.Buf16(dt.w_size),dt.lit_bufsize=1<<B+6,dt.pending_buf_size=4*dt.lit_bufsize,dt.pending_buf=new o.Buf8(dt.pending_buf_size),dt.d_buf=1*dt.lit_bufsize,dt.l_buf=3*dt.lit_bufsize,dt.level=ut,dt.strategy=V,dt.method=it,Ie(v)}s=[new $t(0,0,0,0,function(v,ut){var it=65535;for(it>v.pending_buf_size-5&&(it=v.pending_buf_size-5);;){if(v.lookahead<=1){if(Pt(v),v.lookahead===0&&ut===f)return E;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var j=v.block_start+it;if((v.strstart===0||v.strstart>=j)&&(v.lookahead=v.strstart-j,v.strstart=j,D(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-J&&(D(v,!1),v.strm.avail_out===0))return E}return v.insert=0,ut===d?(D(v,!0),v.strm.avail_out===0?P:F):(v.strstart>v.block_start&&(D(v,!1),v.strm.avail_out),E)}),new $t(4,4,8,4,Gt),new $t(4,5,16,8,Gt),new $t(4,6,32,32,Gt),new $t(4,4,16,16,jt),new $t(8,16,32,32,jt),new $t(8,16,128,128,jt),new $t(8,32,128,256,jt),new $t(32,128,258,1024,jt),new $t(32,258,258,4096,jt)],i.deflateInit=function(v,ut){return je(v,ut,x,15,8,0)},i.deflateInit2=je,i.deflateReset=Ie,i.deflateResetKeep=Jt,i.deflateSetHeader=function(v,ut){return v&&v.state?v.state.wrap!==2?m:(v.state.gzhead=ut,h):m},i.deflate=function(v,ut){var it,j,B,V;if(!v||!v.state||5<ut||ut<0)return v?st(v,m):m;if(j=v.state,!v.output||!v.input&&v.avail_in!==0||j.status===666&&ut!==d)return st(v,v.avail_out===0?-5:m);if(j.strm=v,it=j.last_flush,j.last_flush=ut,j.status===L)if(j.wrap===2)v.adler=0,yt(j,31),yt(j,139),yt(j,8),j.gzhead?(yt(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),yt(j,255&j.gzhead.time),yt(j,j.gzhead.time>>8&255),yt(j,j.gzhead.time>>16&255),yt(j,j.gzhead.time>>24&255),yt(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),yt(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(yt(j,255&j.gzhead.extra.length),yt(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(v.adler=l(v.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(yt(j,0),yt(j,0),yt(j,0),yt(j,0),yt(j,0),yt(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),yt(j,3),j.status=O);else{var ht=x+(j.w_bits-8<<4)<<8;ht|=(2<=j.strategy||j.level<2?0:j.level<6?1:j.level===6?2:3)<<6,j.strstart!==0&&(ht|=32),ht+=31-ht%31,j.status=O,X(j,ht),j.strstart!==0&&(X(j,v.adler>>>16),X(j,65535&v.adler)),v.adler=1}if(j.status===69)if(j.gzhead.extra){for(B=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>B&&(v.adler=l(v.adler,j.pending_buf,j.pending-B,B)),W(v),B=j.pending,j.pending!==j.pending_buf_size));)yt(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>B&&(v.adler=l(v.adler,j.pending_buf,j.pending-B,B)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(j.status===73)if(j.gzhead.name){B=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>B&&(v.adler=l(v.adler,j.pending_buf,j.pending-B,B)),W(v),B=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,yt(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>B&&(v.adler=l(v.adler,j.pending_buf,j.pending-B,B)),V===0&&(j.gzindex=0,j.status=91)}else j.status=91;if(j.status===91)if(j.gzhead.comment){B=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>B&&(v.adler=l(v.adler,j.pending_buf,j.pending-B,B)),W(v),B=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,yt(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>B&&(v.adler=l(v.adler,j.pending_buf,j.pending-B,B)),V===0&&(j.status=103)}else j.status=103;if(j.status===103&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&W(v),j.pending+2<=j.pending_buf_size&&(yt(j,255&v.adler),yt(j,v.adler>>8&255),v.adler=0,j.status=O)):j.status=O),j.pending!==0){if(W(v),v.avail_out===0)return j.last_flush=-1,h}else if(v.avail_in===0&&et(ut)<=et(it)&&ut!==d)return st(v,-5);if(j.status===666&&v.avail_in!==0)return st(v,-5);if(v.avail_in!==0||j.lookahead!==0||ut!==f&&j.status!==666){var dt=j.strategy===2?function(Q,gt){for(var vt;;){if(Q.lookahead===0&&(Pt(Q),Q.lookahead===0)){if(gt===f)return E;break}if(Q.match_length=0,vt=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,vt&&(D(Q,!1),Q.strm.avail_out===0))return E}return Q.insert=0,gt===d?(D(Q,!0),Q.strm.avail_out===0?P:F):Q.last_lit&&(D(Q,!1),Q.strm.avail_out===0)?E:C}(j,ut):j.strategy===3?function(Q,gt){for(var vt,mt,It,fe,zt=Q.window;;){if(Q.lookahead<=z){if(Pt(Q),Q.lookahead<=z&&gt===f)return E;if(Q.lookahead===0)break}if(Q.match_length=0,Q.lookahead>=N&&0<Q.strstart&&(mt=zt[It=Q.strstart-1])===zt[++It]&&mt===zt[++It]&&mt===zt[++It]){fe=Q.strstart+z;do;while(mt===zt[++It]&&mt===zt[++It]&&mt===zt[++It]&&mt===zt[++It]&&mt===zt[++It]&&mt===zt[++It]&&mt===zt[++It]&&mt===zt[++It]&&It<fe);Q.match_length=z-(fe-It),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead)}if(Q.match_length>=N?(vt=a._tr_tally(Q,1,Q.match_length-N),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(vt=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),vt&&(D(Q,!1),Q.strm.avail_out===0))return E}return Q.insert=0,gt===d?(D(Q,!0),Q.strm.avail_out===0?P:F):Q.last_lit&&(D(Q,!1),Q.strm.avail_out===0)?E:C}(j,ut):s[j.level].func(j,ut);if(dt!==P&&dt!==F||(j.status=666),dt===E||dt===P)return v.avail_out===0&&(j.last_flush=-1),h;if(dt===C&&(ut===1?a._tr_align(j):ut!==5&&(a._tr_stored_block(j,0,0,!1),ut===3&&(ot(j.head),j.lookahead===0&&(j.strstart=0,j.block_start=0,j.insert=0))),W(v),v.avail_out===0))return j.last_flush=-1,h}return ut!==d?h:j.wrap<=0?1:(j.wrap===2?(yt(j,255&v.adler),yt(j,v.adler>>8&255),yt(j,v.adler>>16&255),yt(j,v.adler>>24&255),yt(j,255&v.total_in),yt(j,v.total_in>>8&255),yt(j,v.total_in>>16&255),yt(j,v.total_in>>24&255)):(X(j,v.adler>>>16),X(j,65535&v.adler)),W(v),0<j.wrap&&(j.wrap=-j.wrap),j.pending!==0?h:1)},i.deflateEnd=function(v){var ut;return v&&v.state?(ut=v.state.status)!==L&&ut!==69&&ut!==73&&ut!==91&&ut!==103&&ut!==O&&ut!==666?st(v,m):(v.state=null,ut===O?st(v,-3):h):m},i.deflateSetDictionary=function(v,ut){var it,j,B,V,ht,dt,Q,gt,vt=ut.length;if(!v||!v.state||(V=(it=v.state).wrap)===2||V===1&&it.status!==L||it.lookahead)return m;for(V===1&&(v.adler=c(v.adler,ut,vt,0)),it.wrap=0,vt>=it.w_size&&(V===0&&(ot(it.head),it.strstart=0,it.block_start=0,it.insert=0),gt=new o.Buf8(it.w_size),o.arraySet(gt,ut,vt-it.w_size,it.w_size,0),ut=gt,vt=it.w_size),ht=v.avail_in,dt=v.next_in,Q=v.input,v.avail_in=vt,v.next_in=0,v.input=ut,Pt(it);it.lookahead>=N;){for(j=it.strstart,B=it.lookahead-(N-1);it.ins_h=(it.ins_h<<it.hash_shift^it.window[j+N-1])&it.hash_mask,it.prev[j&it.w_mask]=it.head[it.ins_h],it.head[it.ins_h]=j,j++,--B;);it.strstart=j,it.lookahead=N-1,Pt(it)}return it.strstart+=it.lookahead,it.block_start=it.strstart,it.insert=it.lookahead,it.lookahead=0,it.match_length=it.prev_length=N-1,it.match_available=0,v.next_in=dt,v.input=Q,v.avail_in=ht,it.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,m,p,b,k,x,T,A,M,S,I,$,N,z,J,L,O,E,C;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,C=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,b=a.wnext,k=a.window,x=a.hold,T=a.bits,A=a.lencode,M=a.distcode,S=(1<<a.lenbits)-1,I=(1<<a.distbits)-1;t:do{T<15&&(x+=E[c++]<<T,T+=8,x+=E[c++]<<T,T+=8),$=A[x&S];e:for(;;){if(x>>>=N=$>>>24,T-=N,(N=$>>>16&255)===0)C[u++]=65535&$;else{if(!(16&N)){if(!(64&N)){$=A[(65535&$)+(x&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}z=65535&$,(N&=15)&&(T<N&&(x+=E[c++]<<T,T+=8),z+=x&(1<<N)-1,x>>>=N,T-=N),T<15&&(x+=E[c++]<<T,T+=8,x+=E[c++]<<T,T+=8),$=M[x&I];n:for(;;){if(x>>>=N=$>>>24,T-=N,!(16&(N=$>>>16&255))){if(!(64&N)){$=M[(65535&$)+(x&(1<<N)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(J=65535&$,T<(N&=15)&&(x+=E[c++]<<T,(T+=8)<N&&(x+=E[c++]<<T,T+=8)),h<(J+=x&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(x>>>=N,T-=N,(N=u-f)<J){if(p<(N=J-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(O=k,(L=0)===b){if(L+=m-N,N<z){for(z-=N;C[u++]=k[L++],--N;);L=u-J,O=C}}else if(b<N){if(L+=m+b-N,(N-=b)<z){for(z-=N;C[u++]=k[L++],--N;);if(L=0,b<z){for(z-=N=b;C[u++]=k[L++],--N;);L=u-J,O=C}}}else if(L+=b-N,N<z){for(z-=N;C[u++]=k[L++],--N;);L=u-J,O=C}for(;2<z;)C[u++]=O[L++],C[u++]=O[L++],C[u++]=O[L++],z-=3;z&&(C[u++]=O[L++],1<z&&(C[u++]=O[L++]))}else{for(L=u-J;C[u++]=C[L++],C[u++]=C[L++],C[u++]=C[L++],2<(z-=3););z&&(C[u++]=C[L++],1<z&&(C[u++]=C[L++]))}break}}break}}while(c<l&&u<d);c-=z=T>>3,x&=(1<<(T-=z<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=x,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,m=1,p=852,b=592;function k(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(L){var O;return L&&L.state?(O=L.state,L.total_in=L.total_out=O.total=0,L.msg="",O.wrap&&(L.adler=1&O.wrap),O.mode=m,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(p),O.distcode=O.distdyn=new s.Buf32(b),O.sane=1,O.back=-1,d):h}function A(L){var O;return L&&L.state?((O=L.state).wsize=0,O.whave=0,O.wnext=0,T(L)):h}function M(L,O){var E,C;return L&&L.state?(C=L.state,O<0?(E=0,O=-O):(E=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:(C.window!==null&&C.wbits!==O&&(C.window=null),C.wrap=E,C.wbits=O,A(L))):h}function S(L,O){var E,C;return L?(C=new x,(L.state=C).window=null,(E=M(L,O))!==d&&(L.state=null),E):h}var I,$,N=!0;function z(L){if(N){var O;for(I=new s.Buf32(512),$=new s.Buf32(32),O=0;O<144;)L.lens[O++]=8;for(;O<256;)L.lens[O++]=9;for(;O<280;)L.lens[O++]=7;for(;O<288;)L.lens[O++]=8;for(l(u,L.lens,0,288,I,0,L.work,{bits:9}),O=0;O<32;)L.lens[O++]=5;l(f,L.lens,0,32,$,0,L.work,{bits:5}),N=!1}L.lencode=I,L.lenbits=9,L.distcode=$,L.distbits=5}function J(L,O,E,C){var P,F=L.state;return F.window===null&&(F.wsize=1<<F.wbits,F.wnext=0,F.whave=0,F.window=new s.Buf8(F.wsize)),C>=F.wsize?(s.arraySet(F.window,O,E-F.wsize,F.wsize,0),F.wnext=0,F.whave=F.wsize):(C<(P=F.wsize-F.wnext)&&(P=C),s.arraySet(F.window,O,E-C,P,F.wnext),(C-=P)?(s.arraySet(F.window,O,E-C,C,0),F.wnext=C,F.whave=F.wsize):(F.wnext+=P,F.wnext===F.wsize&&(F.wnext=0),F.whave<F.wsize&&(F.whave+=P))),0}i.inflateReset=A,i.inflateReset2=M,i.inflateResetKeep=T,i.inflateInit=function(L){return S(L,15)},i.inflateInit2=S,i.inflate=function(L,O){var E,C,P,F,st,et,ot,W,D,yt,X,at,Pt,Gt,jt,$t,ue,Jt,Ie,je,v,ut,it,j,B=0,V=new s.Buf8(4),ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(E=L.state).mode===12&&(E.mode=13),st=L.next_out,P=L.output,ot=L.avail_out,F=L.next_in,C=L.input,et=L.avail_in,W=E.hold,D=E.bits,yt=et,X=ot,ut=d;t:for(;;)switch(E.mode){case m:if(E.wrap===0){E.mode=13;break}for(;D<16;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if(2&E.wrap&&W===35615){V[E.check=0]=255&W,V[1]=W>>>8&255,E.check=a(E.check,V,2,0),D=W=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&W)<<8)+(W>>8))%31){L.msg="incorrect header check",E.mode=30;break}if((15&W)!=8){L.msg="unknown compression method",E.mode=30;break}if(D-=4,v=8+(15&(W>>>=4)),E.wbits===0)E.wbits=v;else if(v>E.wbits){L.msg="invalid window size",E.mode=30;break}E.dmax=1<<v,L.adler=E.check=1,E.mode=512&W?10:12,D=W=0;break;case 2:for(;D<16;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if(E.flags=W,(255&E.flags)!=8){L.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){L.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=W>>8&1),512&E.flags&&(V[0]=255&W,V[1]=W>>>8&255,E.check=a(E.check,V,2,0)),D=W=0,E.mode=3;case 3:for(;D<32;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}E.head&&(E.head.time=W),512&E.flags&&(V[0]=255&W,V[1]=W>>>8&255,V[2]=W>>>16&255,V[3]=W>>>24&255,E.check=a(E.check,V,4,0)),D=W=0,E.mode=4;case 4:for(;D<16;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}E.head&&(E.head.xflags=255&W,E.head.os=W>>8),512&E.flags&&(V[0]=255&W,V[1]=W>>>8&255,E.check=a(E.check,V,2,0)),D=W=0,E.mode=5;case 5:if(1024&E.flags){for(;D<16;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}E.length=W,E.head&&(E.head.extra_len=W),512&E.flags&&(V[0]=255&W,V[1]=W>>>8&255,E.check=a(E.check,V,2,0)),D=W=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(et<(at=E.length)&&(at=et),at&&(E.head&&(v=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,C,F,at,v)),512&E.flags&&(E.check=a(E.check,C,at,F)),et-=at,F+=at,E.length-=at),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(et===0)break t;for(at=0;v=C[F+at++],E.head&&v&&E.length<65536&&(E.head.name+=String.fromCharCode(v)),v&&at<et;);if(512&E.flags&&(E.check=a(E.check,C,at,F)),et-=at,F+=at,v)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(et===0)break t;for(at=0;v=C[F+at++],E.head&&v&&E.length<65536&&(E.head.comment+=String.fromCharCode(v)),v&&at<et;);if(512&E.flags&&(E.check=a(E.check,C,at,F)),et-=at,F+=at,v)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;D<16;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if(W!==(65535&E.check)){L.msg="header crc mismatch",E.mode=30;break}D=W=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),L.adler=E.check=0,E.mode=12;break;case 10:for(;D<32;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}L.adler=E.check=k(W),D=W=0,E.mode=11;case 11:if(E.havedict===0)return L.next_out=st,L.avail_out=ot,L.next_in=F,L.avail_in=et,E.hold=W,E.bits=D,2;L.adler=E.check=1,E.mode=12;case 12:if(O===5||O===6)break t;case 13:if(E.last){W>>>=7&D,D-=7&D,E.mode=27;break}for(;D<3;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}switch(E.last=1&W,D-=1,3&(W>>>=1)){case 0:E.mode=14;break;case 1:if(z(E),E.mode=20,O!==6)break;W>>>=2,D-=2;break t;case 2:E.mode=17;break;case 3:L.msg="invalid block type",E.mode=30}W>>>=2,D-=2;break;case 14:for(W>>>=7&D,D-=7&D;D<32;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if((65535&W)!=(W>>>16^65535)){L.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&W,D=W=0,E.mode=15,O===6)break t;case 15:E.mode=16;case 16:if(at=E.length){if(et<at&&(at=et),ot<at&&(at=ot),at===0)break t;s.arraySet(P,C,F,at,st),et-=at,F+=at,ot-=at,st+=at,E.length-=at;break}E.mode=12;break;case 17:for(;D<14;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if(E.nlen=257+(31&W),W>>>=5,D-=5,E.ndist=1+(31&W),W>>>=5,D-=5,E.ncode=4+(15&W),W>>>=4,D-=4,286<E.nlen||30<E.ndist){L.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;D<3;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}E.lens[ht[E.have++]]=7&W,W>>>=3,D-=3}for(;E.have<19;)E.lens[ht[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,it={bits:E.lenbits},ut=l(0,E.lens,0,19,E.lencode,0,E.work,it),E.lenbits=it.bits,ut){L.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;$t=(B=E.lencode[W&(1<<E.lenbits)-1])>>>16&255,ue=65535&B,!((jt=B>>>24)<=D);){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if(ue<16)W>>>=jt,D-=jt,E.lens[E.have++]=ue;else{if(ue===16){for(j=jt+2;D<j;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if(W>>>=jt,D-=jt,E.have===0){L.msg="invalid bit length repeat",E.mode=30;break}v=E.lens[E.have-1],at=3+(3&W),W>>>=2,D-=2}else if(ue===17){for(j=jt+3;D<j;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}D-=jt,v=0,at=3+(7&(W>>>=jt)),W>>>=3,D-=3}else{for(j=jt+7;D<j;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}D-=jt,v=0,at=11+(127&(W>>>=jt)),W>>>=7,D-=7}if(E.have+at>E.nlen+E.ndist){L.msg="invalid bit length repeat",E.mode=30;break}for(;at--;)E.lens[E.have++]=v}}if(E.mode===30)break;if(E.lens[256]===0){L.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,it={bits:E.lenbits},ut=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,it),E.lenbits=it.bits,ut){L.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,it={bits:E.distbits},ut=l(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,it),E.distbits=it.bits,ut){L.msg="invalid distances set",E.mode=30;break}if(E.mode=20,O===6)break t;case 20:E.mode=21;case 21:if(6<=et&&258<=ot){L.next_out=st,L.avail_out=ot,L.next_in=F,L.avail_in=et,E.hold=W,E.bits=D,c(L,X),st=L.next_out,P=L.output,ot=L.avail_out,F=L.next_in,C=L.input,et=L.avail_in,W=E.hold,D=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;$t=(B=E.lencode[W&(1<<E.lenbits)-1])>>>16&255,ue=65535&B,!((jt=B>>>24)<=D);){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if($t&&!(240&$t)){for(Jt=jt,Ie=$t,je=ue;$t=(B=E.lencode[je+((W&(1<<Jt+Ie)-1)>>Jt)])>>>16&255,ue=65535&B,!(Jt+(jt=B>>>24)<=D);){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}W>>>=Jt,D-=Jt,E.back+=Jt}if(W>>>=jt,D-=jt,E.back+=jt,E.length=ue,$t===0){E.mode=26;break}if(32&$t){E.back=-1,E.mode=12;break}if(64&$t){L.msg="invalid literal/length code",E.mode=30;break}E.extra=15&$t,E.mode=22;case 22:if(E.extra){for(j=E.extra;D<j;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}E.length+=W&(1<<E.extra)-1,W>>>=E.extra,D-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;$t=(B=E.distcode[W&(1<<E.distbits)-1])>>>16&255,ue=65535&B,!((jt=B>>>24)<=D);){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if(!(240&$t)){for(Jt=jt,Ie=$t,je=ue;$t=(B=E.distcode[je+((W&(1<<Jt+Ie)-1)>>Jt)])>>>16&255,ue=65535&B,!(Jt+(jt=B>>>24)<=D);){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}W>>>=Jt,D-=Jt,E.back+=Jt}if(W>>>=jt,D-=jt,E.back+=jt,64&$t){L.msg="invalid distance code",E.mode=30;break}E.offset=ue,E.extra=15&$t,E.mode=24;case 24:if(E.extra){for(j=E.extra;D<j;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}E.offset+=W&(1<<E.extra)-1,W>>>=E.extra,D-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){L.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(ot===0)break t;if(at=X-ot,E.offset>at){if((at=E.offset-at)>E.whave&&E.sane){L.msg="invalid distance too far back",E.mode=30;break}Pt=at>E.wnext?(at-=E.wnext,E.wsize-at):E.wnext-at,at>E.length&&(at=E.length),Gt=E.window}else Gt=P,Pt=st-E.offset,at=E.length;for(ot<at&&(at=ot),ot-=at,E.length-=at;P[st++]=Gt[Pt++],--at;);E.length===0&&(E.mode=21);break;case 26:if(ot===0)break t;P[st++]=E.length,ot--,E.mode=21;break;case 27:if(E.wrap){for(;D<32;){if(et===0)break t;et--,W|=C[F++]<<D,D+=8}if(X-=ot,L.total_out+=X,E.total+=X,X&&(L.adler=E.check=E.flags?a(E.check,P,X,st-X):o(E.check,P,X,st-X)),X=ot,(E.flags?W:k(W))!==E.check){L.msg="incorrect data check",E.mode=30;break}D=W=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;D<32;){if(et===0)break t;et--,W+=C[F++]<<D,D+=8}if(W!==(4294967295&E.total)){L.msg="incorrect length check",E.mode=30;break}D=W=0}E.mode=29;case 29:ut=1;break t;case 30:ut=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=st,L.avail_out=ot,L.next_in=F,L.avail_in=et,E.hold=W,E.bits=D,(E.wsize||X!==L.avail_out&&E.mode<30&&(E.mode<27||O!==4))&&J(L,L.output,L.next_out,X-L.avail_out)?(E.mode=31,-4):(yt-=L.avail_in,X-=L.avail_out,L.total_in+=yt,L.total_out+=X,E.total+=X,E.wrap&&X&&(L.adler=E.check=E.flags?a(E.check,P,X,L.next_out-X):o(E.check,P,X,L.next_out-X)),L.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(yt==0&&X===0||O===4)&&ut===d&&(ut=-5),ut)},i.inflateEnd=function(L){if(!L||!L.state)return h;var O=L.state;return O.window&&(O.window=null),L.state=null,d},i.inflateGetHeader=function(L,O){var E;return L&&L.state&&2&(E=L.state).wrap?((E.head=O).done=!1,d):h},i.inflateSetDictionary=function(L,O){var E,C=O.length;return L&&L.state?(E=L.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,O,C,0)!==E.check?-3:J(L,O,C,C)?(E.mode=31,-4):(E.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,m,p,b,k){var x,T,A,M,S,I,$,N,z,J=k.bits,L=0,O=0,E=0,C=0,P=0,F=0,st=0,et=0,ot=0,W=0,D=null,yt=0,X=new s.Buf16(16),at=new s.Buf16(16),Pt=null,Gt=0;for(L=0;L<=15;L++)X[L]=0;for(O=0;O<h;O++)X[f[d+O]]++;for(P=J,C=15;1<=C&&X[C]===0;C--);if(C<P&&(P=C),C===0)return m[p++]=20971520,m[p++]=20971520,k.bits=1,0;for(E=1;E<C&&X[E]===0;E++);for(P<E&&(P=E),L=et=1;L<=15;L++)if(et<<=1,(et-=X[L])<0)return-1;if(0<et&&(u===0||C!==1))return-1;for(at[1]=0,L=1;L<15;L++)at[L+1]=at[L]+X[L];for(O=0;O<h;O++)f[d+O]!==0&&(b[at[f[d+O]]++]=O);if(I=u===0?(D=Pt=b,19):u===1?(D=o,yt-=257,Pt=a,Gt-=257,256):(D=c,Pt=l,-1),L=E,S=p,st=O=W=0,A=-1,M=(ot=1<<(F=P))-1,u===1&&852<ot||u===2&&592<ot)return 1;for(;;){for($=L-st,z=b[O]<I?(N=0,b[O]):b[O]>I?(N=Pt[Gt+b[O]],D[yt+b[O]]):(N=96,0),x=1<<L-st,E=T=1<<F;m[S+(W>>st)+(T-=x)]=$<<24|N<<16|z|0,T!==0;);for(x=1<<L-1;W&x;)x>>=1;if(x!==0?(W&=x-1,W+=x):W=0,O++,--X[L]==0){if(L===C)break;L=f[d+b[O]]}if(P<L&&(W&M)!==A){for(st===0&&(st=P),S+=E,et=1<<(F=L-st);F+st<C&&!((et-=X[F+st])<=0);)F++,et<<=1;if(ot+=1<<F,u===1&&852<ot||u===2&&592<ot)return 1;m[A=W&M]=P<<24|F<<16|S-p|0}}return W!==0&&(m[S+W]=L-st<<24|64<<16|0),k.bits=P,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(B){for(var V=B.length;0<=--V;)B[V]=0}var l=0,u=29,f=256,d=f+1+u,h=30,m=19,p=2*d+1,b=15,k=16,x=7,T=256,A=16,M=17,S=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(d+2));c(J);var L=new Array(2*h);c(L);var O=new Array(512);c(O);var E=new Array(256);c(E);var C=new Array(u);c(C);var P,F,st,et=new Array(h);function ot(B,V,ht,dt,Q){this.static_tree=B,this.extra_bits=V,this.extra_base=ht,this.elems=dt,this.max_length=Q,this.has_stree=B&&B.length}function W(B,V){this.dyn_tree=B,this.max_code=0,this.stat_desc=V}function D(B){return B<256?O[B]:O[256+(B>>>7)]}function yt(B,V){B.pending_buf[B.pending++]=255&V,B.pending_buf[B.pending++]=V>>>8&255}function X(B,V,ht){B.bi_valid>k-ht?(B.bi_buf|=V<<B.bi_valid&65535,yt(B,B.bi_buf),B.bi_buf=V>>k-B.bi_valid,B.bi_valid+=ht-k):(B.bi_buf|=V<<B.bi_valid&65535,B.bi_valid+=ht)}function at(B,V,ht){X(B,ht[2*V],ht[2*V+1])}function Pt(B,V){for(var ht=0;ht|=1&B,B>>>=1,ht<<=1,0<--V;);return ht>>>1}function Gt(B,V,ht){var dt,Q,gt=new Array(b+1),vt=0;for(dt=1;dt<=b;dt++)gt[dt]=vt=vt+ht[dt-1]<<1;for(Q=0;Q<=V;Q++){var mt=B[2*Q+1];mt!==0&&(B[2*Q]=Pt(gt[mt]++,mt))}}function jt(B){var V;for(V=0;V<d;V++)B.dyn_ltree[2*V]=0;for(V=0;V<h;V++)B.dyn_dtree[2*V]=0;for(V=0;V<m;V++)B.bl_tree[2*V]=0;B.dyn_ltree[2*T]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0}function $t(B){8<B.bi_valid?yt(B,B.bi_buf):0<B.bi_valid&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0}function ue(B,V,ht,dt){var Q=2*V,gt=2*ht;return B[Q]<B[gt]||B[Q]===B[gt]&&dt[V]<=dt[ht]}function Jt(B,V,ht){for(var dt=B.heap[ht],Q=ht<<1;Q<=B.heap_len&&(Q<B.heap_len&&ue(V,B.heap[Q+1],B.heap[Q],B.depth)&&Q++,!ue(V,dt,B.heap[Q],B.depth));)B.heap[ht]=B.heap[Q],ht=Q,Q<<=1;B.heap[ht]=dt}function Ie(B,V,ht){var dt,Q,gt,vt,mt=0;if(B.last_lit!==0)for(;dt=B.pending_buf[B.d_buf+2*mt]<<8|B.pending_buf[B.d_buf+2*mt+1],Q=B.pending_buf[B.l_buf+mt],mt++,dt===0?at(B,Q,V):(at(B,(gt=E[Q])+f+1,V),(vt=I[gt])!==0&&X(B,Q-=C[gt],vt),at(B,gt=D(--dt),ht),(vt=$[gt])!==0&&X(B,dt-=et[gt],vt)),mt<B.last_lit;);at(B,T,V)}function je(B,V){var ht,dt,Q,gt=V.dyn_tree,vt=V.stat_desc.static_tree,mt=V.stat_desc.has_stree,It=V.stat_desc.elems,fe=-1;for(B.heap_len=0,B.heap_max=p,ht=0;ht<It;ht++)gt[2*ht]!==0?(B.heap[++B.heap_len]=fe=ht,B.depth[ht]=0):gt[2*ht+1]=0;for(;B.heap_len<2;)gt[2*(Q=B.heap[++B.heap_len]=fe<2?++fe:0)]=1,B.depth[Q]=0,B.opt_len--,mt&&(B.static_len-=vt[2*Q+1]);for(V.max_code=fe,ht=B.heap_len>>1;1<=ht;ht--)Jt(B,gt,ht);for(Q=It;ht=B.heap[1],B.heap[1]=B.heap[B.heap_len--],Jt(B,gt,1),dt=B.heap[1],B.heap[--B.heap_max]=ht,B.heap[--B.heap_max]=dt,gt[2*Q]=gt[2*ht]+gt[2*dt],B.depth[Q]=(B.depth[ht]>=B.depth[dt]?B.depth[ht]:B.depth[dt])+1,gt[2*ht+1]=gt[2*dt+1]=Q,B.heap[1]=Q++,Jt(B,gt,1),2<=B.heap_len;);B.heap[--B.heap_max]=B.heap[1],function(zt,Qn){var R,g,_,U,G,nt,ct=Qn.dyn_tree,Vt=Qn.max_code,Ce=Qn.stat_desc.static_tree,Ee=Qn.stat_desc.has_stree,Le=Qn.stat_desc.extra_bits,he=Qn.stat_desc.extra_base,Wa=Qn.stat_desc.max_length,uu=0;for(U=0;U<=b;U++)zt.bl_count[U]=0;for(ct[2*zt.heap[zt.heap_max]+1]=0,R=zt.heap_max+1;R<p;R++)Wa<(U=ct[2*ct[2*(g=zt.heap[R])+1]+1]+1)&&(U=Wa,uu++),ct[2*g+1]=U,Vt<g||(zt.bl_count[U]++,G=0,he<=g&&(G=Le[g-he]),nt=ct[2*g],zt.opt_len+=nt*(U+G),Ee&&(zt.static_len+=nt*(Ce[2*g+1]+G)));if(uu!==0){do{for(U=Wa-1;zt.bl_count[U]===0;)U--;zt.bl_count[U]--,zt.bl_count[U+1]+=2,zt.bl_count[Wa]--,uu-=2}while(0<uu);for(U=Wa;U!==0;U--)for(g=zt.bl_count[U];g!==0;)Vt<(_=zt.heap[--R])||(ct[2*_+1]!==U&&(zt.opt_len+=(U-ct[2*_+1])*ct[2*_],ct[2*_+1]=U),g--)}}(B,V),Gt(gt,fe,B.bl_count)}function v(B,V,ht){var dt,Q,gt=-1,vt=V[1],mt=0,It=7,fe=4;for(vt===0&&(It=138,fe=3),V[2*(ht+1)+1]=65535,dt=0;dt<=ht;dt++)Q=vt,vt=V[2*(dt+1)+1],++mt<It&&Q===vt||(mt<fe?B.bl_tree[2*Q]+=mt:Q!==0?(Q!==gt&&B.bl_tree[2*Q]++,B.bl_tree[2*A]++):mt<=10?B.bl_tree[2*M]++:B.bl_tree[2*S]++,gt=Q,fe=(mt=0)===vt?(It=138,3):Q===vt?(It=6,3):(It=7,4))}function ut(B,V,ht){var dt,Q,gt=-1,vt=V[1],mt=0,It=7,fe=4;for(vt===0&&(It=138,fe=3),dt=0;dt<=ht;dt++)if(Q=vt,vt=V[2*(dt+1)+1],!(++mt<It&&Q===vt)){if(mt<fe)for(;at(B,Q,B.bl_tree),--mt!=0;);else Q!==0?(Q!==gt&&(at(B,Q,B.bl_tree),mt--),at(B,A,B.bl_tree),X(B,mt-3,2)):mt<=10?(at(B,M,B.bl_tree),X(B,mt-3,3)):(at(B,S,B.bl_tree),X(B,mt-11,7));gt=Q,fe=(mt=0)===vt?(It=138,3):Q===vt?(It=6,3):(It=7,4)}}c(et);var it=!1;function j(B,V,ht,dt){X(B,(l<<1)+(dt?1:0),3),function(Q,gt,vt,mt){$t(Q),yt(Q,vt),yt(Q,~vt),s.arraySet(Q.pending_buf,Q.window,gt,vt,Q.pending),Q.pending+=vt}(B,V,ht)}i._tr_init=function(B){it||(function(){var V,ht,dt,Q,gt,vt=new Array(b+1);for(Q=dt=0;Q<u-1;Q++)for(C[Q]=dt,V=0;V<1<<I[Q];V++)E[dt++]=Q;for(E[dt-1]=Q,Q=gt=0;Q<16;Q++)for(et[Q]=gt,V=0;V<1<<$[Q];V++)O[gt++]=Q;for(gt>>=7;Q<h;Q++)for(et[Q]=gt<<7,V=0;V<1<<$[Q]-7;V++)O[256+gt++]=Q;for(ht=0;ht<=b;ht++)vt[ht]=0;for(V=0;V<=143;)J[2*V+1]=8,V++,vt[8]++;for(;V<=255;)J[2*V+1]=9,V++,vt[9]++;for(;V<=279;)J[2*V+1]=7,V++,vt[7]++;for(;V<=287;)J[2*V+1]=8,V++,vt[8]++;for(Gt(J,d+1,vt),V=0;V<h;V++)L[2*V+1]=5,L[2*V]=Pt(V,5);P=new ot(J,I,f+1,d,b),F=new ot(L,$,0,h,b),st=new ot(new Array(0),N,0,m,x)}(),it=!0),B.l_desc=new W(B.dyn_ltree,P),B.d_desc=new W(B.dyn_dtree,F),B.bl_desc=new W(B.bl_tree,st),B.bi_buf=0,B.bi_valid=0,jt(B)},i._tr_stored_block=j,i._tr_flush_block=function(B,V,ht,dt){var Q,gt,vt=0;0<B.level?(B.strm.data_type===2&&(B.strm.data_type=function(mt){var It,fe=4093624447;for(It=0;It<=31;It++,fe>>>=1)if(1&fe&&mt.dyn_ltree[2*It]!==0)return o;if(mt.dyn_ltree[18]!==0||mt.dyn_ltree[20]!==0||mt.dyn_ltree[26]!==0)return a;for(It=32;It<f;It++)if(mt.dyn_ltree[2*It]!==0)return a;return o}(B)),je(B,B.l_desc),je(B,B.d_desc),vt=function(mt){var It;for(v(mt,mt.dyn_ltree,mt.l_desc.max_code),v(mt,mt.dyn_dtree,mt.d_desc.max_code),je(mt,mt.bl_desc),It=m-1;3<=It&&mt.bl_tree[2*z[It]+1]===0;It--);return mt.opt_len+=3*(It+1)+5+5+4,It}(B),Q=B.opt_len+3+7>>>3,(gt=B.static_len+3+7>>>3)<=Q&&(Q=gt)):Q=gt=ht+5,ht+4<=Q&&V!==-1?j(B,V,ht,dt):B.strategy===4||gt===Q?(X(B,2+(dt?1:0),3),Ie(B,J,L)):(X(B,4+(dt?1:0),3),function(mt,It,fe,zt){var Qn;for(X(mt,It-257,5),X(mt,fe-1,5),X(mt,zt-4,4),Qn=0;Qn<zt;Qn++)X(mt,mt.bl_tree[2*z[Qn]+1],3);ut(mt,mt.dyn_ltree,It-1),ut(mt,mt.dyn_dtree,fe-1)}(B,B.l_desc.max_code+1,B.d_desc.max_code+1,vt+1),Ie(B,B.dyn_ltree,B.dyn_dtree)),jt(B),dt&&$t(B)},i._tr_tally=function(B,V,ht){return B.pending_buf[B.d_buf+2*B.last_lit]=V>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&V,B.pending_buf[B.l_buf+B.last_lit]=255&ht,B.last_lit++,V===0?B.dyn_ltree[2*ht]++:(B.matches++,V--,B.dyn_ltree[2*(E[ht]+f+1)]++,B.dyn_dtree[2*D(V)]++),B.last_lit===B.lit_bufsize-1},i._tr_align=function(B){X(B,2,3),at(B,T,J),function(V){V.bi_valid===16?(yt(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(B)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},m=!1,p=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){Rr.nextTick(function(){x(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,M=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=M,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){x(A.data)},function(A){u.port2.postMessage(A)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(A){var M=p.createElement("script");M.onreadystatechange=function(){x(A),M.onreadystatechange=null,l.removeChild(M),M=null},l.appendChild(M)}):function(A){setTimeout(x,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var M=new Array(arguments.length-1),S=0;S<M.length;S++)M[S]=arguments[S+1];var I={callback:A,args:M};return h[d]=I,c(d),d++},b.clearImmediate=k}function k(A){delete h[A]}function x(A){if(m)setTimeout(x,0,A);else{var M=h[A];if(M){m=!0;try{(function(S){var I=S.callback,$=S.args;switch($.length){case 0:I();break;case 1:I($[0]);break;case 2:I($[0],$[1]);break;case 3:I($[0],$[1],$[2]);break;default:I.apply(a,$)}})(M)}finally{k(A),m=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&x(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Un<"u"?Un:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Zw);var E$=Zw.exports,jd=Us(E$);const Qw={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Qw);var Ar=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},No,za,Ms;class x${constructor(...t){No.set(this,new Map),za.set(this,new Map),Ms.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Ar(this,Ms,"f").has(r)||Ar(this,Ms,"f").set(r,new Set);const s=Ar(this,Ms,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Ar(this,za,"f").set(r,a),o=!1,c)continue;const l=Ar(this,No,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Ar(this,No,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:Ar(this,No,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&Ar(this,za,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Ar(this,Ms,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of Ar(this,Ms,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Ar(this,No,"f"),extensions:Ar(this,za,"f")}}}No=new WeakMap,za=new WeakMap,Ms=new WeakMap;var v$=new x$(Qw)._freeze();function T$(e,t){console.info(t)}function A$(e,t){console.info(t)}const cu=60,S$=cu*25;function R$(e,t){let n=0;const r=new DataView(t.buffer);function i(){const C=r.getUint8(n);return n++,C}function s(){const C=r.getInt16(n,!0);return n+=2,C}function o(){const C=r.getInt32(n,!0);return n+=4,C}function a(C){let P="";const F=t.subarray(n,n+C);for(let st=0;st<F.length;++st)P+=String.fromCharCode(F[st]);return n+=C,P.replace("\r",`
`)}function c(C,P,F,st){const et=zr(C,P,F);if(y(et)&&y(st)){const ot=er(st);for(let W=0;W<ot.length;++W){const D=ot[W];et[D]=st[D]}}}function l(C){let P="";for(let F=0;F<C.length;++F){const st=C.charCodeAt(F);st<32||st>127?P+=`$${st}`:P+=C[F]}return P}function u(C){return C.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(P=>{if(P.includes("$")){const[F,...st]=P.split("$");return`${F??""}"$CENTER ${l(st.join("$"))}"`}return l(P)}).join(`
`)}function f(C,P,F,st,et){const ot=st.color%16,W=Math.floor(st.color/16)%8,D=Qo(ot,W),yt=Qo((W+8)%16,ot),X={},at=et.find(Pt=>Pt.x===P&&Pt.y===F);switch(y(at)&&(wt(at.cycle)&&at.cycle>0&&(X.cycle=at.cycle),y(at.p1)&&(X.p1=at.p1),y(at.p2)&&(X.p2=at.p2),y(at.p3)&&(X.p3=at.p3),y(at.code)&&at.code&&(X.code=u(at.code)),y(at.stepx)&&(X.stepx=at.stepx),y(at.stepy)&&(X.stepy=at.stepy)),st.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(C,["ammo",D],{x:P,y:F},X);break;case 6:c(C,["torch",D],{x:P,y:F},X);break;case 7:c(C,["gem",D],{x:P,y:F},X);break;case 8:c(C,["key",D],{x:P,y:F},X);break;case 9:c(C,["door",yt],{x:P,y:F},X);break;case 10:c(C,["scroll",D],{x:P,y:F},X);break;case 11:{X.p3=d(at==null?void 0:at.p3)??"",c(C,["passage",D],{x:P,y:F},X);break}case 12:c(C,["duplicator",D],{x:P,y:F},X);break;case 13:c(C,["bomb",D],{x:P,y:F},X);break;case 14:c(C,["energize",D],{x:P,y:F},X);break;case 15:c(C,["star",D],{x:P,y:F},X);break;case 16:c(C,["clockwise",D],{x:P,y:F},X);break;case 17:c(C,["counter",D],{x:P,y:F},X);break;case 18:c(C,["bullet",D],{x:P,y:F},X);break;case 19:c(C,["water",D],{x:P,y:F},X);break;case 20:c(C,["forest",D],{x:P,y:F},X);break;case 21:c(C,["solid",D],{x:P,y:F},X);break;case 22:c(C,["normal",D],{x:P,y:F},X);break;case 23:c(C,["breakable",D],{x:P,y:F},X);break;case 24:c(C,["boulder",D],{x:P,y:F},X);break;case 25:c(C,["sliderns",D],{x:P,y:F},X);break;case 26:c(C,["sliderew",D],{x:P,y:F},X);break;case 27:c(C,["fake",D],{x:P,y:F},X);break;case 28:c(C,["invisible",D],{x:P,y:F},X);break;case 29:c(C,["blinkwall",D],{x:P,y:F},{...X,stepx:0,stepy:0,shootx:X.stepx??0,shooty:X.stepx??0});break;case 30:c(C,["transporter",D],{x:P,y:F},X);break;case 31:c(C,["line",D],{x:P,y:F},X);break;case 32:c(C,["ricochet",D],{x:P,y:F},X);break;case 33:c(C,["blinkns",D],{x:P,y:F},X);break;case 34:c(C,["bear",D],{x:P,y:F},X);break;case 35:c(C,["ruffian",D],{x:P,y:F},X);break;case 36:c(C,["object",D],{x:P,y:F},{...X,char:(at==null?void 0:at.p1)??1});break;case 37:c(C,["slime",D],{x:P,y:F},X);break;case 38:c(C,["shark",D],{x:P,y:F},X);break;case 39:c(C,["spinninggun",D],{x:P,y:F},X);break;case 40:c(C,["pusher",D],{x:P,y:F},X);break;case 41:c(C,["lion",D],{x:P,y:F},X);break;case 42:c(C,["tiger",D],{x:P,y:F},X);break;case 43:c(C,["blinkns",D],{x:P,y:F},X);break;case 44:c(C,["head",D],{x:P,y:F},X);break;case 45:c(C,["segment",D],{x:P,y:F},X);break;case 46:break;case 47:c(C,["text",["WHITE","ONDKBLUE"]],{x:P,y:F},{...X,char:st.color});break;case 48:c(C,["text",["WHITE","ONDKGREEN"]],{x:P,y:F},{...X,char:st.color});break;case 49:c(C,["text",["WHITE","ONDKCYAN"]],{x:P,y:F},{...X,char:st.color});break;case 50:c(C,["text",["WHITE","ONDKRED"]],{x:P,y:F},{...X,char:st.color});break;case 51:c(C,["text",["WHITE","ONDKPURPLE"]],{x:P,y:F},{...X,char:st.color});break;case 52:c(C,["text",["WHITE","ONDKYELLOW"]],{x:P,y:F},{...X,char:st.color});break;case 53:c(C,["text",["WHITE","ONBLACK"]],{x:P,y:F},{...X,char:st.color});break}}function d(C){if(wt(C)&&C>0)return`zztboard${C}`}if(s()!=-1)return;const m=s(),p=s(),b=s(),k=a(7),x=s(),T=s(),A=s(),M=s(),S=s();s();const I=s(),$=i(),N=a(20).slice(0,$);for(let C=0;C<9;C++){const P=i();a(20).slice(0,P)}const z=s(),J=s(),L=i();console.info(p,b,k,x,T,A,M,S,I,z,J,L),n=512;const O=[];for(let C=0;C<m;++C){const P=s(),F=n,st=i(),ot={boardname:a(50).slice(0,st),elements:[],stats:[]};for(;ot.elements.length<S$;){let D=i();D===0&&(D=255);const yt=i(),X=i();for(let at=0;at<D;++at)ot.elements.push({element:yt,color:X})}ot.maxplayershots=i(),ot.isdark=i(),ot.exitnorth=i(),ot.exitsouth=i(),ot.exitwest=i(),ot.exiteast=i(),ot.restartonzap=i(),ot.messagelength=i(),ot.message=a(58).slice(0,ot.messagelength),ot.playerenterx=i(),ot.playerentery=i(),ot.timelimit=s(),n+=16;const W=s()+1;for(;ot.stats.length<W;){const D={};D.x=i()-1,D.y=i()-1,D.stepx=s(),D.stepy=s(),D.cycle=s(),D.p1=i(),D.p2=i(),D.p3=i(),D.follower=s(),D.leader=s(),D.underelement=i(),D.undercolor=i(),D.pointer=o(),D.currentinstruction=s();const yt=s();n+=8,yt<0?D.bind=Math.abs(yt):D.code=a(yt),ot.stats.push(D)}O.push(ot),n=F+P}const E=nd([]);E.name=N;for(let C=0;C<O.length;++C){const P=O[C],F=[`@zztboard${C}`,""];C===0?F.push("@title"):C===T&&F.push("@zztstartboard");for(let Gt=0;Gt<P.elements.length;++Gt)P.elements[Gt].element===4&&(F.push(`@startx ${hm(Gt,cu)}`),F.push(`@starty ${fm(Gt,cu)}`));wt(P.maxplayershots)&&F.push(`@maxplayershots ${P.maxplayershots}`),wt(P.isdark)&&F.push(`@isdark ${P.isdark}`),wt(P.restartonzap)&&F.push(`@restartonzap ${P.restartonzap}`),wt(P.timelimit)&&F.push(`@timelimit ${P.timelimit}`);const st=d(P.exitnorth);pt(st)&&F.push(`@exitnorth ${st}`);const et=d(P.exitsouth);pt(et)&&F.push(`@exitsouth ${et}`);const ot=d(P.exitwest);pt(ot)&&F.push(`@exitwest ${ot}`);const W=d(P.exiteast);pt(W)&&F.push(`@exiteast ${W}`);const D=`@board ${String(C).padStart(3,"0")}. ${P.boardname}
${F.join(`
`)}`,yt=yk(D,{});sd(E,yt);const X=Re(yt);if(!y(X))continue;let at=0,Pt=0;for(let Gt=0;Gt<P.elements.length;++Gt){const jt=P.elements[Gt];f(X,at,Pt,jt,P.stats),++at,at===cu&&(at=0,++Pt)}Oe(X)}Zl(E),l0(tt,e,`imported zzt file into ${E.name} book`)}function tE(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return v$.getType(e)??"application/octet-stream"}async function O$(e,t,n){try{ve(tt,e,"parsezipfile",t.name);const r=await t.arrayBuffer();(await new jd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=tE(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{de(tt,e,"crash",c.message)})})}catch(r){de(tt,e,"crash",r.message)}}function eE(e,t,n){if(y(n))switch(t){case"text/plain":n.text().then(r=>Tu(tt,e,void 0,"text",`file:${n.name}`,r)).catch(r=>de(tt,e,"crash",r.message));break;case"application/json":n.text().then(r=>Tu(tt,e,void 0,"json",`file:${n.name}`,r)).catch(r=>de(tt,e,"crash",r.message));break;case"application/zip":O$(e,n,r=>zd(e,r)).catch(r=>de(tt,e,"crash",r.message));break;case"application/octet-stream":/.zzt$/i.test(n.name)&&n.arrayBuffer().then(r=>{R$(e,new Uint8Array(r))}).catch(r=>de(tt,e,"crash",r.message)),/.zzl$/i.test(n.name)&&n.text().then(r=>{T$(e,r)}).catch(r=>de(tt,e,"crash",r.message)),/.zzm$/i.test(n.name)&&n.text().then(r=>{A$(e,r)}).catch(r=>de(tt,e,"crash",r.message));break;default:n.arrayBuffer().then(r=>{const i=tE(n.name,new Uint8Array(r));if(i)eE(e,i,n);else return de(tt,e,"parsewebfile",`unsupported file ${n.name}`)}).catch(r=>de(tt,e,"crash",r.message));return}}function zd(e,t){eE(e,(t==null?void 0:t.type)??"",t)}const Wd="https://bridge.zed.cafe";async function N$(e,t,n){const r=`offset=${n}&${e}=${t}`,i=new Request(`${Wd}/api/v1/search/files/?${r}`);return(await(await fetch(i)).json()).data.results}async function I$(){const e=new Request(`${Wd}/api/v1/get/random-file/`);return[(await(await fetch(e)).json()).data]}async function C$(e,t){const r=await(await fetch(`${Wd}/zgames/${t}`)).arrayBuffer(),i=new File([r],t);zd(e,i)}function hr(e,t,n){n().catch(r=>{console.error(r),de(e,t,"crash",r==null?void 0:r.message)})}function L$(e){const[t,n]=e.split(":"),r=y(n);return[r?t:"self",r?n:e]}function M$(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function U$(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const F$=new Date("1980/09/02");async function Gd(e){return console.info("saved",e),new Promise((t,n)=>{const r=new jd;for(let i=0;i<e.length;++i){const s=e[i],o=RU(s);if(o){const a=zS(o);y(a)&&r.file(s.id,a,{date:F$})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(U$(i))}).catch(n)})}async function B$(e){return new Promise((t,n)=>{const r=new jd,i=M$(e);r.loadAsync(i,{base64:!0}).then(async()=>{const s=[],o=[];r.forEach((a,c)=>o.push(c));for(let a=0;a<o.length;++a){const l=await o[a].async("uint8array"),u=OU(WS(l));y(u)&&s.push(u)}t(s)}).catch(n)})}function P$(e,t,n,r){const i=pn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){wt(u)&&(s=u,dm(t.x,t.y,n.x,n.y).forEach(f=>{const d=re(i,f);y(d)&&(d[l]=u)}))}Tt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye),Ct(e,`batch:${ro(t,n)}`,"char",[r,"charedit"],o,a);const c=Fe(e);c.scrollname="bulk set char",c.scroll=gn(e)}function $$(e,t,n,r){const i=pn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){if(wt(u)){s=u;for(let f=t.y;f<=n.y;++f)for(let d=t.x;d<=n.x;++d){const h=re(i,{x:d,y:f});y(h)&&(h[l]=u)}}}Tt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye),Ct(e,`batch:${ro(t,n)}`,"color",[r,"coloredit"],o,a);const c=Fe(e);c.scrollname="bulk set color",c.scroll=gn(e)}function D$(e,t,n,r){const i=pn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){wt(u)&&(s=u,dm(t.x,t.y,n.x,n.y).forEach(f=>{const d=re(i,f);y(d)&&(d[l]=u)}))}Tt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye),Ct(e,`batch:${ro(t,n)}`,"color",[r,"coloredit"],o,a);const c=Fe(e);c.scrollname="bulk set bg",c.scroll=gn(e)}function j$(e,t,n,r){const i=fn(Dt.MAIN);if(!y(i))return;const s=pn(e);if(!y(s))return;const o=ro(t,n);Tt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye),Ct(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Ct(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),r&&Ct(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Ct(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),Ct(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Tt(e,Ye),Ct(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Ct(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Ct(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Tt(e,Ye),Ct(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Tt(e,Ye),Tt(e,"codepages:");const a=Math.min(t.x,n.x),c=Math.min(t.y,n.y),l=Math.max(t.x,n.x),u=Math.max(t.y,n.y),f=new Set;for(let h=c;h<=u;++h)for(let m=a;m<=l;++m){const p=re(s,{x:m,y:h}),b=Ek(i,p);y(b)&&!f.has(b.id)&&(f.add(b.id),Ct(e,"batch",`edit @${be(b)}`,[`pageopen:${b.id}`]))}const d=Zn(bt.BOARD,s.id);Tt(e,be(d)),Ct(e,"batch",`id ${s.id}`,["","copyit",s.id]),Ct(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}function Kd(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function z$(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Kd(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let Hd;function nE(){return Hd||(Hd=z$("keyval-store","keyval")),Hd}function rE(e,t=nE()){return t("readonly",n=>Kd(n.get(e)))}function iE(e,t,n=nE()){return n("readwrite",r=>new Promise((i,s)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),i(Kd(r.transaction))}catch(o){s(o)}}}))}function Yd(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function sE(){return rE("secretheap")}async function oE(e){return iE("secretheap",e)}async function W$(){return!!await sE()}function aE(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},m=re(e,{x:d,y:f});(m==null?void 0:m.category)===Bn.ISOBJECT?(l.push(Sr(ns(e,d,f))),rn(m).name!=="player"&&u.push({...Sr(m),...h,id:"blank"})):l.push({...Sr(m),...h})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function G$(e,t,n,r){const i=pn(e);if(!y(i))return;const s=aE(i,t,n);switch(r){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await oE(()=>s)}function K$(e,t,n){const r=Yd(t,n);Tt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye),Ct(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Ct(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Ct(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=Fe(e);i.scrollname="copy",i.scroll=gn(e)}async function H$(e,t,n,r){const i=fn(Dt.MAIN);if(!y(i))return;const s=pn(e);if(!y(s))return;const o=aE(s,t,n);switch(r){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(r){case"cutall":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=re(s,{x:c,y:a});(l==null?void 0:l.category)===Bn.ISOBJECT&&An(s,l,i.timestamp),Ne(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=re(s,{x:c,y:a});(l==null?void 0:l.category)===Bn.ISOBJECT&&An(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c)Ne(s,{x:c,y:a});break}}await oE(()=>o)}function Y$(e,t,n){const r=Yd(t,n);Tt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye),Ct(e,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Ct(e,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Ct(e,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=Fe(e);i.scrollname="cut",i.scroll=gn(e)}async function V$(e,t,n,r){const i=pn(e),s=await sE();if(!y(i)||!y(s))return;const o=Math.min(t.x,n.x),a=Math.min(t.y,n.y),c=Math.max(t.x,n.x),l=Math.max(t.y,n.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(r){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<d;++p){const b=$n({x:p,y:m},s.width);Ne(i,{...s.terrain[b],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];y(p.x)&&y(p.y)&&xh(p.x,p.y,0,u-1,f-1,0)&&Bd(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];y(p.x)&&y(p.y)&&xh(p.x,p.y,0,u-1,f-1,0)&&Bd(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<d;++p){const b=$n({x:p,y:m},s.width);Ne(i,{...s.terrain[b],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const b=(p-o)%s.width,k=(m-a)%s.height,x=$n({x:b,y:k},s.width);Ne(i,{...s.terrain[x],x:p,y:m})}break}}function X$(e,t,n){const r=Yd(t,n);Tt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye),Ct(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Ct(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Ct(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Ct(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=Fe(e);i.scrollname="paste",i.scroll=gn(e)}function Vd(e,t){return`inspect:${t!=null&&t.id?t.id:Wr(e,t)}`}function q$(e,t,n){const r=fn(Dt.MAIN);if(!y(r))return;const i=pn(e);if(!y(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){y(t)&&(t[d]=h)}const a=t.category===Bn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Vd(i,t);Tt(e,`${a}: ${c} ${l}`),Tt(e,Ye),Ct(e,u,"color",[n,"coloredit"],s,o);const f=Fe(e);f.scrollname="color",f.scroll=gn(e)}function J$(e,t,n){const r=fn(Dt.MAIN);if(!y(r))return;const i=pn(e);if(!y(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){y(t)&&(t[d]=h)}const a=t.category===Bn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Vd(i,t);Tt(e,`${a}: ${c} ${l}`),Tt(e,Ye),Ct(e,u,"char",[n,"charedit"],s,o);const f=Fe(e);f.scrollname="char",f.scroll=gn(e)}function Z$(e,t,n,r,i,s){var m,p,b;const o=fn(Dt.MAIN);if(!y(o))return;function a(k){var T;const x=(r==null?void 0:r[k])??((T=r==null?void 0:r.kinddata)==null?void 0:T[k]);if(!y(x))switch(k){case"color":return 15;case"bg":return 0;case"cycle":return _0;case"collision":return Ft.ISWALK;case"pushable":return 0;case"breakable":return 0}return x}function c(k,x){y(r)&&(r[k]=x)}s?Tt(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):Tt(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`);const l=Vd(t,r);switch(s&&Tt(e,`cycle: ${Wt(r,"cycle")}`),Wt(r,"collision")){case Ft.ISWALK:Tt(e,"collision: iswalk");break;case Ft.ISSWIM:Tt(e,"collision: isswim");break;case Ft.ISSOLID:Tt(e,"collision: issolid");break;case Ft.ISBULLET:Tt(e,"collision: isbullet");break;case Ft.ISGHOST:Tt(e,"collision: isghost");break}if(s){const k=Wt(r,"pushable");Tt(e,`ispushable: ${k||"no"}`)}Tt(e,`isbreakable: ${Wt(r,"breakable")?"yes":"no"}`),Tt(e,Ye);const f=Sa(n),d=er(f);for(let k=0;k<d.length;++k){const x=d[k];switch(x){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ae(f[x])){const[T,A,...M]=f[x];pt(A)&&Ct(e,l,A||x,[x,T,...M],a,c)}break}}Ct(e,l,"copy coords",["copycoords","hk","5"," 5 "]),Tt(e,Ye),Ct(e,l,`char: ${r.char??((m=r.kinddata)==null?void 0:m.char)??1}`,["char","hk","a"," A ","next"],a,c),Ct(e,l,`color: ${r.color??((p=r.kinddata)==null?void 0:p.color)??15}`,["color","hk","c"," C ","next"],a,c),Ct(e,l,`bg: ${r.bg??((b=r.kinddata)==null?void 0:b.bg)??0}`,["bg","hk","b"," B ","next"],a,c),Tt(e,Ye),Ct(e,l,"make empty",["empty","hk","0"],a,c),Tt(e,Ye),Ct(e,"batch",`edit @${be(n)}`,[`pageopen:${n.id}`]);const h=Zn(bt.BOARD,t.id);Tt(e,be(h)),Ct(e,"batch",`id ${t.id}`,["","copyit",t.id]),Ct(e,"batch","edit @board codepage",[`pageopen:${t.id}`])}function Q$(e,t,n,r){const i=fn(Dt.MAIN);if(!y(i))return;const s=pn(e);if(y(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=re(s,{x:a,y:o});(c==null?void 0:c.category)===Bn.ISOBJECT&&An(s,c,i.timestamp),Ne(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=re(s,{x:a,y:o});(c==null?void 0:c.category)===Bn.ISOBJECT&&An(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Ne(s,{x:a,y:o});break}}}function tD(e,t,n){const r=fn(Dt.MAIN);if(!y(r))return;const i=pn(e);if(!y(i))return;const s=ro(t,n);Tt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye),Ct(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Ct(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Ct(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Fe(e);o.scrollname="empty",o.scroll=gn(e)}async function eD(e,t,n){const r=fn(Dt.MAIN),i=await W$();if(!y(r))return;const s=pn(e);if(!y(s))return;if(Oe(s),t.x===n.x&&t.y===n.y){const a=re(s,t),c=Ek(r,a);if(y(a)&&y(c)&&Z$(e,s,c,a,t,He(a)),!(a!=null&&a.kind)){Tt(e,`empty: ${t.x}, ${t.y}`),Tt(e,Ye),Ct(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]);const l=Zn(bt.BOARD,s.id);Tt(e,be(l)),Ct(e,"batch",`id ${s.id}`,["","copyit",s.id]),Ct(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}}else j$(e,t,n,i);const o=Fe(e);o.scrollname="inspect",o.scroll=gn(e)}function nD(e,t){const n=le(Dt.MAIN);if(!y(n))return;const r=pn(t);if(!y(r))return;const i=Pn(e),s=Gw(r,i.target);if(y(s))switch(i.path){case"copycoords":Eu(tt,Jn(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":q$(t,s,i.path);break;case"char":J$(t,s,i.path);break;case"empty":An(r,s,n.timestamp);break;case"code":hr(tt,t,async()=>{const o=rn(s),a="object";ve(tt,t,`opened [${a}] ${o.name}`);const c=[r.id,s.id];Eh(Ya(n.id,c),s.code??""),dx(tt,t),await Su(800),p0(tt,t,n.id,c,a,`${name} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}async function rD(e,t){const n=pn(t);if(!y(n))return;const r=Pn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":K$(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await G$(t,c,l,r.target);break;case"cut":Y$(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await H$(t,c,l,r.target);break;case"paste":X$(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await V$(t,c,l,r.target);break;case"empty":tD(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":Q$(t,c,l,r.target);break;case"chars":P$(t,c,l,"char");break;case"colors":$$(t,c,l,"color");break;case"bgs":D$(t,c,l,"bg");break;case"copycoords":Eu(tt,t,[i,s,o,a].join(" "));break;case"pageopen":hr(tt,t,async()=>{await Su(800),Bx(tt,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}async function iD(){return rE("remixconfig")}async function sD(e){return iE("remixconfig",e)}let rs={stat:"",patternsize:2,mirror:1};async function oD(e,t){const n=pn(t);if(!y(n))return;const r=Pn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"remix":{await aD(t,c,l);break}case"remixrun":{const u=dn(rs.stat);y(u)&&nw(n.id,u.id,rs.patternsize,rs.mirror,c,l,"all"),await sD(()=>rs);break}default:console.info("unknown remix",r);break}}async function aD(e,t,n){const r=await iD();rs={...rs,...r};const i=ro(t,n);Tt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Tt(e,Ye);function s(c){const{target:l}=Pn(c);return rs[l]}function o(c,l){if(wt(l)||pt(l)){const{target:u}=Pn(c);rs[u]=l}}Ct(e,"remix","source board",[`stat:${i}`,"text"],s,o),Ct(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),Ct(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Tt(e,Ye),Ct(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Fe(e);a.scrollname="remix",a.scroll=gn(e)}const cD=16,is={},lu={},lD=60;let cE=0;const Io={},Co={};async function lE(e){const t=Dr(),n=le(Dt.MAIN);if(t.length&&y(n)){const r=await Gd(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;gx(Kt,Jn(),i,r)}}async function uD(){const e=Dr(),t=le(Dt.MAIN);if(e.length&&y(t)){const n=await Gd(e);_x(Kt,Jn(),n)}}async function hD(){const e=Dr(),t=le(Dt.MAIN);return e.length&&y(t)?Gd(e):""}const uE="$176$176$177$177$178 ZZT BRIDGE $178$177$177$176$176";function hE(e){Tt(e,`Searching ${"$6".repeat(mr(1,6))}`);const t=Fe(e);t.scrollname=uE,t.scroll=gn(e)}function fE(e,t){for(let r=0;r<e.length;++r){const i=e[r],s=`pub: ${new Date(i.publish_date).toLocaleDateString()}`;Tt(t,`$white${i.title}`),Tt(t,`$yellow  ${i.author.join(", ")}`),Tt(t,`$dkgreen  ${i.genres.join(", ")}`),Tt(t,`$purple  ${s}`),i.screenshot&&Ct(t,"zztbridge",i.screenshot,["screenshot","openit",`https://museumofzzt.com/static/${i.screenshot}`]),Ct(t,"zztbridge",i.filename,["zztimport","hyperlink",`${i.letter}/${i.filename}`]),Tt(t," ")}const n=Fe(t);n.scrollname=uE,n.scroll=gn(t)}const Kt=Bs("vm",["tick","second"],e=>{var n;if(!Kt.session(e))return;const t=Jn();switch(e.target){case"operator":zP(e.player),ve(Kt,e.player,`operator set to ${e.player}`),Kt.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=le(Dt.MAIN);Kt.replynext(e,"ackzsswords",{cli:Ed(Zi.CLI),loader:Ed(Zi.LOADER),runtime:Ed(Zi.RUNTIME),flags:[...er(Tr(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","playerid","playerx","playery","thisid","thisx","thisy","senderid","senderx","sendery","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isghost","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"],kinds:[...Ss(r,bt.OBJECT).map(i=>be(i)),...er(kd)],altkinds:[...Ss(r,bt.TERRAIN),...Ss(r,bt.BOARD),...Ss(r,bt.PALETTE),...Ss(r,bt.CHARSET),...Ss(r,bt.LOADER)].map(i=>be(i)),colors:[...er(Jo)],dirs:[...er(Nh).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...er(yd)],exprs:["aligned","alligned","contact","blocked","any","countof","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&hr(Kt,e.player,async()=>{if(ae(e.data)){const[r,i]=e.data,s=await B$(r),o=s.map(a=>a.name);XP(s,i),ve(Kt,e.player,`loading ${o.join(", ")}`),wu(Kt,e.player)}});break;case"search":ZP(e.player)||wu(Kt,e.player);break;case"logout":JP(e.player),delete is[e.player],ve(Kt,t,`player ${e.player} logout`),wu(Kt,e.player);break;case"login":Mw(e.player)?(px(Kt,e.player),is[e.player]=0,ve(Kt,Jn(),`login from ${e.player}`),Kt.replynext(e,"acklogin",!0)):u0(Kt,e.player);break;case"local":Mw(e.player)?(is[e.player]=0,ve(Kt,Jn(),`login from ${e.player}`)):u0(Kt,e.player);break;case"doot":is[e.player]=0,lu[e.player]=lu[e.player]??0,lu[e.player]%32===0&&ve(Kt,e.player,`$whiteactive $blue${e.player}`),++lu[e.player];break;case"input":{if(e.player.includes("local")&&!Cw(e.player)&&Fx(Kt,e.player),!e.player.includes("local")||Cw(e.player)){const r=Tr(e.player),[i=Rn.NONE,s=0]=e.data??[Rn.NONE,0];ae(r.inputqueue)||(r.inputqueue=[]),i!==Rn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ae(e.data)){const[r,i]=e.data,s=Ya(r,i);y(Co[s])||(Co[s]=lm(s,o=>{const[a,c]=i,l=jr(r),u=As(l,a);if(y(u))if(li(u)===bt.BOARD&&y(c)){const f=Re(u),d=Mn(f,c);y(d)&&(d.code=o,Ll(td(o),d))}else u.code=o,AU(u)})),Io[s]=Io[s]??new Set,Io[s].add(e.player)}break;case"coderelease":if(ae(e.data)){const[r,i]=e.data,[,s]=i,o=Ya(r,i);y(Io[o])&&(Io[o].delete(e.player),Io[o].size===0&&((n=Co[o])==null||n.call(Co),Co[o]=void 0,pt(s)&&n$(s)))}break;case"halt":e.player===t&&qE(e.data)&&WP(e.data);break;case"tick":i$(GP());break;case"synthsend":if(pt(e.data)){const[r,i]=L$(e.data),s=le(Dt.MAIN);Ro(r,i,void 0,bo(s))}break;case"second":{QP(is);const r=Object.keys(is);for(let i=0;i<r.length;++i)++is[r[i]];for(let i=0;i<r.length;++i){const s=r[i];is[s]>=cD&&vu(Kt,s)}++cE>=lD&&(cE=0,hr(Kt,e.player,async()=>{await lE(!0)}));break}case"copyjsonfile":if(e.player===t){const r=le(Dt.MAIN);if(y(r)&&ae(e.data)){const[i]=e.data,s=As(r,i);y(s)&&bx(Kt,t,s,`${be(s)}.${Oi(s)}.json`)}}break;case"refscroll":{Tt(e.player,"stat refs"),Tt(e.player,Ye),Ct(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Ct(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Ct(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=Fe(e.player);r.scrollname="refscroll",r.scroll=gn(e.player);break}case"fork":e.player===t&&hr(Kt,e.player,async()=>{await uD()});break;case"zztsearch":hr(Kt,e.player,async()=>{if(ae(e.data)){const[r,i]=e.data;let s=0;const o=[];for(;o.length<256;){hE(e.player);const a=await N$(r,i,s);if(s+=a.length,o.push(...a),a.length<25)break}fE(o,e.player)}});break;case"zztrandom":hr(Kt,e.player,async()=>{hE(e.player);const r=await I$();fE(r,e.player)});break;case"itchiopublish":hr(Kt,e.player,async()=>{if(e.player===t){const r=le(Dt.MAIN);if(y(r)){const i=await hD();yx(Kt,e.player,r.name,i)}}});break;case"flush":e.player===t&&hr(Kt,e.player,async()=>{await lE()});break;case"cli":Bw(e.player,e.data);break;case"clirepeatlast":s$(e.player);break;case"restart":e.player===t&&(r$(),g0(Kt,e.player));break;case"inspect":hr(Kt,e.player,async()=>{if(ae(e.data)){const[r,i]=e.data;await eD(e.player,r,i)}});break;case"loader":if(ae(e.data)){const[r,i,s,o]=e.data;switch(i){case"file":zd(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){ve(Kt,e.player,`loading ${s}`);const a=JSON.parse(o.json);y(a.data)&&pt(a.exported)&&(Zl(a.data),ve(Kt,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){ve(Kt,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=le(Dt.MAIN);y(c)&&y(a.data)&&pt(a.exported)&&(sd(c,a.data),ve(Kt,e.player,`loaded ${a.exported}`))}else Hk(r,i,s,o,e.player);break;default:Hk(r,i,s,o,e.player);break}}break;default:{const{target:r,path:i}=Pn(e.target);switch(Nt(r)){case"refscroll":switch(i){case"charscroll":{Ct(e.player,"refscroll","char",["char","charedit"]);const s=Fe(e.player);s.scrollname="chars",s.scroll=gn(e.player);break}case"colorscroll":{Ct(e.player,"refscroll","color",["color","coloredit"]);const s=Fe(e.player);s.scrollname="colors",s.scroll=gn(e.player);break}case"notesscroll":{Tt(e.player,"duration             cdefgab - notes "),Tt(e.player,"y - 64th note        x - rest"),Tt(e.player,"t - 32nd note        "),Tt(e.player,"s - 16th note.       drums"),Tt(e.player,"i - eight note.      0 - tick"),Tt(e.player,"q - quarter note     1 - tweet"),Tt(e.player,"h - half note        2 - cowbell"),Tt(e.player,"w - whole note       p - clap"),Tt(e.player,"                     4 - high snare"),Tt(e.player,"mods                 5 - high woodblock"),Tt(e.player,"3 - triplet          6 - low snare"),Tt(e.player,". - time and a half  7 - low tom"),Tt(e.player,"# - sharp            8 - low woodblock"),Tt(e.player,"! - flat             9 - bass drum");const s=Fe(e.player);s.scrollname="music notation",s.scroll=gn(e.player);break}}break;case"batch":hr(Kt,e.player,async()=>{await rD(i,e.player)});break;case"remix":hr(Kt,e.player,async()=>{await oD(i,e.player)});break;case"empty":{const s=Pn(i);switch(s.target){case"copycoords":Eu(Kt,Jn(),s.path.split(",").join(" "));break}break}case"inspect":nD(i,e.player);break;case"touched":if(ae(e.data)){const[s,o,a]=e.data;Uw({...e,target:`${o}:${a}`,data:void 0,sender:s})}break;case"zztbridge":hr(Kt,e.player,async()=>{pt(e.data)&&(await C$(e.player,e.data),await Su(1e3),vu(Kt,e.player))});break;default:{const s=Pn(i);if(Nt(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),Uw(e);else{const o=le(Dt.MAIN);Ro(s.target,s.path,void 0,bo(o))}break}}break}}},jP());function fD(){mx(Kt)}const{forward:dD}=Gx(e=>{Kx(e)&&postMessage(e)});onmessage=function(t){dD(t.data)},setTimeout(fD,100)})();

var W8=Object.defineProperty;var K8=(Qr,Mn,En)=>Mn in Qr?W8(Qr,Mn,{enumerable:!0,configurable:!0,writable:!0,value:En}):Qr[Mn]=En;var Nt=(Qr,Mn,En)=>K8(Qr,typeof Mn!="symbol"?Mn+"":Mn,En);(function(){"use strict";const Qr=new Set,Mn={emit(e,t,n,r,i){Mn.invoke(G1(e,t,n,r,i))},invoke(e){Qr.forEach(t=>t.handle(e))},connect(e){Qr.add(e)},disconnect(e){Qr.delete(e)}};var En=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ks(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function u1(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var md={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(En,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(md);var h1=md.exports,gd=ks(h1),yd={};(function(e){var t=En&&En.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var f=0,d=l.length,p;f<d;f++)(p||!(f in l))&&(p||(p=Array.prototype.slice.call(l,0,f)),p[f]=l[f]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,f=u.capitalize,d=f===void 0?!0:f,p=u.adjectiveCount,m=p===void 0?1:p,k=u.addAdverb,w=k===void 0?!1:k,T=t(t(t([],t([],Array(m),!0).map(function(v){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),w?[n(e.adverbs)]:[],!0);return d&&(T=T.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),T.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(d?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,m=p===void 0?"":p;return r(e.adjectives).length*h+h*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(d?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(d?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(yd);var _d=ks(yd);const f1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let d1=e=>crypto.getRandomValues(new Uint8Array(e)),p1=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},bd=(e,t=21)=>p1(e,t,d1),m1=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=f1[n[e]&63];return t};var Ed="abcdefghijklmnopqrstuvwxyz",wd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",kd="0123456789",g1="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",y1="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const _1=kd,b1=Ed,E1=wd;var w1=_1+b1+E1,$l={lowercase:Ed,uppercase:wd,numbers:kd,nolookalikes:g1,nolookalikesSafe:y1,alphanumeric:w1};function Ne(){return`sid_${m1(12).replaceAll("-",".")}`}bd($l.numbers,4),bd(`${$l.numbers}${$l.lowercase}`,16);function Ai(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function k1(){return _d({capitalize:!1,adjectiveCount:1})}function x1(){return _d({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var T1=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),A1=Object.prototype.hasOwnProperty;function jl(e,t){return A1.call(e,t)}function zl(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)jl(e,i)&&r.push(i);return r}function wn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Wl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Hi(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function xd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Kl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Kl(e[t]))return!0}else if(typeof e=="object"){for(var r=zl(e),i=r.length,s=0;s<i;s++)if(Kl(e[r[s]]))return!0}}return!1}function Td(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Ad=function(e){T1(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Td(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Td(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),ve=Ad,v1=wn,xs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=va(n,this.path);r&&(r=wn(r));var i=Yi(n,{op:"remove",path:this.from}).removed;return Yi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=va(n,this.from);return Yi(n,{op:"add",path:this.path,value:wn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:wo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},S1={add:function(e,t,n){return Wl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:xs.move,copy:xs.copy,test:xs.test,_get:xs._get};function va(e,t){if(t=="")return e;var n={op:"_get",path:t};return Yi(e,n),n.value}function Yi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Sa(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=va(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=wo(e,t.value),o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=wn(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=Sa;;){if(d=c[l],d&&d.indexOf("~")!=-1&&(d=xd(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=c.slice(0,l).join("/"):l==h-1&&(f=t.path),f!==void 0&&p(t,0,e,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!Wl(d))throw new ve("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Wl(d)&&(d=~~d)}if(l>=h){if(n&&t.op==="add"&&d>u.length)throw new ve("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=S1[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=xs[t.op].call(t,u,d,e);if(o.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[d],n&&l<h&&(!u||typeof u!="object"))throw new ve("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Gl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=wn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Yi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function R1(e,t,n){var r=Yi(e,t);if(r.test===!1)throw new ve("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Sa(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new ve("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(xs[e.op]){if(typeof e.path!="string")throw new ve("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ve('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ve("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Kl(e.value))throw new ve("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ve("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new ve("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=vd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ve("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ve("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function vd(e,t,n){try{if(!Array.isArray(e))throw new ve("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Gl(wn(t),wn(e),n||!0);else{n=n||Sa;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof ve)return i;throw i}}function wo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!wo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!wo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var I1=Object.freeze({__proto__:null,JsonPatchError:ve,_areEquals:wo,applyOperation:Yi,applyPatch:Gl,applyReducer:R1,deepClone:v1,getValueByPointer:va,validate:vd,validator:Sa});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Hl=new WeakMap,N1=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),O1=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function C1(e){return Hl.get(e)}function L1(e,t){return e.observers.get(t)}function M1(e,t){e.observers.delete(t.callback)}function U1(e,t){t.unobserve()}function F1(e,t){var n=[],r,i=C1(e);if(!i)i=new N1(e),Hl.set(e,i);else{var s=L1(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=wn(e),t){r.callback=t,r.next=null;var o=function(){Yl(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Yl(r),clearTimeout(r.next),M1(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new O1(t,r)),r}function Yl(e,t){t===void 0&&(t=!1);var n=Hl.get(e.object);Vl(n.value,e.object,e.patches,"",t),e.patches.length&&Gl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Vl(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=zl(t),o=zl(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(jl(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?Vl(l,h,n,r+"/"+Hi(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+Hi(u),value:wn(l)}),n.push({op:"replace",path:r+"/"+Hi(u),value:wn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Hi(u),value:wn(l)}),n.push({op:"remove",path:r+"/"+Hi(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!jl(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+Hi(u),value:wn(t[u])})}}}function Sd(e,t,n){n===void 0&&(n=!1);var r=[];return Vl(e,t,r,"",n),r}var P1=Object.freeze({__proto__:null,compare:Sd,generate:Yl,observe:F1,unobserve:U1});Object.assign({},I1,P1,{JsonPatchError:Ad,deepClone:wn,escapePathComponent:Hi,unescapePathComponent:xd});var B1=typeof Element<"u",D1=typeof Map=="function",$1=typeof Set=="function",j1=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ra(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ra(e[r],t[r]))return!1;return!0}var s;if(D1&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ra(r.value[1],t.get(r.value[0])))return!1;return!0}if($1&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(j1&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(B1&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ra(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var z1=function(t,n){try{return Ra(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},W1=ks(z1);function x(e){return e!=null}const Hn=Object.keys;function Xe(e){return wn(e)}function K1(e){return typeof e=="boolean"}function Ct(e){return typeof e=="number"&&isNaN(e)===!1}function At(e){return typeof e=="string"}function ne(e){return Array.isArray(e)}function Xl(e){return e}var zt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(zt||{}),Gt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Gt||{}),Yn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Yn||{}),yt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(yt||{}),wt=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(wt||{});function Ot(e){return(e==null?void 0:e.toLowerCase().trim())??""}function G1(e,t,n,r,i){return{session:e,player:t,id:Ne(),sender:n,target:r,data:i}}function lr(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Ts(e,t=[],n=Xl,r=""){const i=Ne(),s=Ot(e),o=t.map(Ot);let a=r;const c={id(){return i},name(){return e},session(u){return x(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){Mn.emit(a,u,i,l,h)},reply(u,l,h){c.emit(u.player,`${u.sender}:${l}`,h)},replynext(u,l,h){setTimeout(()=>c.emit(u.player,`${u.sender}:${l}`,h),64)},handle(u){const{target:l,path:h}=lr(u.target),f=Ot(l);!a&&f==="ready"&&(a=u.session),f==="bridge"&&x(u.session)&&(a=u.session),o.findIndex(d=>d==="all"||d===f)!==-1&&n(u),(i===l||f==="all"||s===f)&&n({...u,target:h})}};return Mn.connect(c),c}function H1(e){return typeof e=="object"&&At(e.session)&&At(e.player)&&At(e.id)&&At(e.sender)&&At(e.target)}function ye(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function ti(e,t,...n){return e.emit(t,"info",n),!0}function Rd(e,t,...n){return e.emit(t,"debug",n),!0}function Y1(e,t,n){e.emit(t,"toast",n)}function V1(e,t,n){e.emit(t,"bridge:streamstart",n)}function X1(e,t){e.emit(t,"bridge:streamstop",void 0)}function q1(e,t,n){e.emit(t,"bridge:chatstart",n)}function J1(e,t){e.emit(t,"bridge:chatstop")}function Z1(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function Q1(e,t){e.emit(t,"bridge:talkstart",t)}function tE(e,t){e.emit(t,"bridge:talkstop",t)}function eE(e,t){e.emit(t,"bridge:mediastart",t)}function nE(e,t){e.emit(t,"bridge:mediastop",t)}function rE(e,t,n){e.emit(t,"bridge:start",n)}function iE(e,t,n){e.emit(t,"bridge:tab",n)}function sE(e,t,n){e.emit(t,"gadgetclient:paint",n)}function oE(e,t,n){e.emit(t,"gadgetclient:patch",n)}function aE(e,t){e.emit(t,"gadgetserver:clearscroll")}function cE(e){e.emit("","ready")}function lE(e,t){e.emit(t,"register:loginfail")}function ql(e,t){e.emit(t,"register:loginready",!0)}function uE(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function hE(e,t,n){e.emit(t,"register:forkmem",[n])}function Jl(e,t,n){e.emit(t,"register:copy",n)}function fE(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function Id(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function dE(e,t){e.emit(t,"register:dev",void 0)}function pE(e,t){e.emit(t,"register:share",void 0)}function mE(e,t){e.emit(t,"register:nuke",void 0)}function gE(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function yE(e,t,n){e.emit(t,"synth:tta",[n])}function _E(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function bE(e,t,n){e.emit(t,"synth:focus",n)}function EE(e,t,n){e.emit(t,"synth:bpm",n)}function wE(e,t,n){e.emit(t,"synth:playvolume",n)}function kE(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function xE(e,t,n){e.emit(t,"synth:ttsvolume",n)}function Zl(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function Nd(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function TE(e,t){e.emit(t,"register:inspector")}function Od(e,t,n,r,i,s,o){e.emit(t,"register:editor:open",[n,r,i,s,o])}function AE(e,t){e.emit(t,"register:editor:close")}function Cd(e,t){e.emit(t,"vm:logout")}function Ia(e,t){const[n,r]=t;return`${e}:${[n,r].filter(x).join(":")}`}function vE(e,t,n){e.emit(t,"vm:cli",n)}function SE(e,t){e.emit(t,"vm:restart")}function Ld(e,t){e.emit(t,"vm:flush")}function RE(e,t){e.emit(t,"vm:fork")}function IE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function NE(e,t){return{filename:e,json:t}}function OE(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Ql(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=IE(i,s);break;case"json":o=NE(i,s);break;case"binary":o=OE(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function CE(e){const t=new Set;function n(s){H1(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Mn.invoke(s))}const r=Ts("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Mn.disconnect(r)}return{forward:n,disconnect:i}}function LE(e){switch(e.target){case"info":case"debug":case"error":case"tick":case"tock":case"ready":case"second":return!0;default:{const t=lr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const tu=66.666,Na=Math.round(1e3/tu),ME=3;function Md(e){return new Promise(t=>setTimeout(t,e))}const eu=Ts("clock");let nu=0,Oa=0,ru=0,Ud=performance.now();function Fd(){const e=performance.now(),t=e-Ud;ru+=t,ru>=tu&&(ru%=tu,eu.emit("","tick",Oa),eu.emit("","tock",Oa),++nu,++Oa,nu>=Na&&(nu%=Na,eu.emit("","second",Oa))),Ud=e,setTimeout(Fd,2)}Fd();var Ht={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ko=Symbol.for("react.element"),UE=Symbol.for("react.portal"),FE=Symbol.for("react.fragment"),PE=Symbol.for("react.strict_mode"),BE=Symbol.for("react.profiler"),DE=Symbol.for("react.provider"),$E=Symbol.for("react.context"),jE=Symbol.for("react.forward_ref"),zE=Symbol.for("react.suspense"),WE=Symbol.for("react.memo"),KE=Symbol.for("react.lazy"),Pd=Symbol.iterator;function GE(e){return e===null||typeof e!="object"?null:(e=Pd&&e[Pd]||e["@@iterator"],typeof e=="function"?e:null)}var Bd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Dd=Object.assign,$d={};function As(e,t,n){this.props=e,this.context=t,this.refs=$d,this.updater=n||Bd}As.prototype.isReactComponent={},As.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},As.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function jd(){}jd.prototype=As.prototype;function iu(e,t,n){this.props=e,this.context=t,this.refs=$d,this.updater=n||Bd}var su=iu.prototype=new jd;su.constructor=iu,Dd(su,As.prototype),su.isPureReactComponent=!0;var zd=Array.isArray,Wd=Object.prototype.hasOwnProperty,ou={current:null},Kd={key:!0,ref:!0,__self:!0,__source:!0};function Gd(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Wd.call(t,r)&&!Kd.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:ko,type:e,key:s,ref:o,props:i,_owner:ou.current}}function HE(e,t){return{$$typeof:ko,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function au(e){return typeof e=="object"&&e!==null&&e.$$typeof===ko}function YE(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Hd=/\/+/g;function cu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?YE(""+e.key):t.toString(36)}function Ca(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case ko:case UE:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+cu(o,0):r,zd(i)?(n="",e!=null&&(n=e.replace(Hd,"$&/")+"/"),Ca(i,t,n,"",function(u){return u})):i!=null&&(au(i)&&(i=HE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Hd,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",zd(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+cu(s,a);o+=Ca(s,t,n,c,i)}else if(c=GE(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+cu(s,a++),o+=Ca(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function La(e,t,n){if(e==null)return e;var r=[],i=0;return Ca(e,r,"","",function(s){return t.call(n,s,i++)}),r}function VE(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var fn={current:null},Ma={transition:null},XE={ReactCurrentDispatcher:fn,ReactCurrentBatchConfig:Ma,ReactCurrentOwner:ou};function Yd(){throw Error("act(...) is not supported in production builds of React.")}Ht.Children={map:La,forEach:function(e,t,n){La(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return La(e,function(){t++}),t},toArray:function(e){return La(e,function(t){return t})||[]},only:function(e){if(!au(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Ht.Component=As,Ht.Fragment=FE,Ht.Profiler=BE,Ht.PureComponent=iu,Ht.StrictMode=PE,Ht.Suspense=zE,Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XE,Ht.act=Yd,Ht.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Dd({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=ou.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Wd.call(t,c)&&!Kd.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:ko,type:e.type,key:i,ref:s,props:r,_owner:o}},Ht.createContext=function(e){return e={$$typeof:$E,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:DE,_context:e},e.Consumer=e},Ht.createElement=Gd,Ht.createFactory=function(e){var t=Gd.bind(null,e);return t.type=e,t},Ht.createRef=function(){return{current:null}},Ht.forwardRef=function(e){return{$$typeof:jE,render:e}},Ht.isValidElement=au,Ht.lazy=function(e){return{$$typeof:KE,_payload:{_status:-1,_result:e},_init:VE}},Ht.memo=function(e,t){return{$$typeof:WE,type:e,compare:t===void 0?null:t}},Ht.startTransition=function(e){var t=Ma.transition;Ma.transition={};try{e()}finally{Ma.transition=t}},Ht.unstable_act=Yd,Ht.useCallback=function(e,t){return fn.current.useCallback(e,t)},Ht.useContext=function(e){return fn.current.useContext(e)},Ht.useDebugValue=function(){},Ht.useDeferredValue=function(e){return fn.current.useDeferredValue(e)},Ht.useEffect=function(e,t){return fn.current.useEffect(e,t)},Ht.useId=function(){return fn.current.useId()},Ht.useImperativeHandle=function(e,t,n){return fn.current.useImperativeHandle(e,t,n)},Ht.useInsertionEffect=function(e,t){return fn.current.useInsertionEffect(e,t)},Ht.useLayoutEffect=function(e,t){return fn.current.useLayoutEffect(e,t)},Ht.useMemo=function(e,t){return fn.current.useMemo(e,t)},Ht.useReducer=function(e,t,n){return fn.current.useReducer(e,t,n)},Ht.useRef=function(e){return fn.current.useRef(e)},Ht.useState=function(e){return fn.current.useState(e)},Ht.useSyncExternalStore=function(e,t,n){return fn.current.useSyncExternalStore(e,t,n)},Ht.useTransition=function(){return fn.current.useTransition()},Ht.version="18.3.1";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Vd="0123456789abcdef",Xd=[],Ua=[];for(let e=0;e<256;e++)Xd[e]=Vd[e>>4&15]+Vd[e&15],e<16&&(e<10?Ua[48+e]=e:Ua[87+e]=e);const qd=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=Xd[e[r++]];return n},Fa=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=Ua[e.charCodeAt(s++)]<<4|Ua[e.charCodeAt(s++)];return r};for(var Jd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qE=typeof Uint8Array>"u"?[]:new Uint8Array(256),Pa=0;Pa<Jd.length;Pa++)qE[Jd.charCodeAt(Pa)]=Pa;new TextDecoder,new TextEncoder;const Zd=typeof window<"u"?window:self,Qd=Zd.crypto||Zd.msCrypto||{};Qd.subtle||Qd.webkitSubtle;const vs=globalThis||void 0||self,ur=()=>new Map,lu=e=>{const t=ur();return e.forEach((n,r)=>{t.set(r,n)}),t},vi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},JE=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},ZE=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Ss=()=>new Set,uu=e=>e[e.length-1],QE=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Vi=Array.from,tw=Array.isArray;class ew{constructor(){this._observers=ur()}on(t,n){return vi(this._observers,t,Ss).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Vi((this._observers.get(t)||ur()).values()).forEach(r=>r(...n))}destroy(){this._observers=ur()}}const Si=Math.floor,Ba=Math.abs,t0=(e,t)=>e<t?e:t,Xi=(e,t)=>e>t?e:t,e0=e=>e!==0?e<0:1/e<0,n0=1,r0=2,hu=4,fu=8,xo=32,ei=64,Un=128,Da=31,du=63,qi=127,nw=2147483647,i0=Number.MAX_SAFE_INTEGER,rw=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Si(e)===e),iw=e=>e.toLowerCase(),sw=/^\s*/g,ow=e=>e.replace(sw,""),aw=/([A-Z])/g,s0=(e,t)=>ow(e.replace(aw,n=>`${t}${iw(n)}`)),cw=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},To=typeof TextEncoder<"u"?new TextEncoder:null,lw=To?e=>To.encode(e):cw;let Ao=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ao&&Ao.decode(new Uint8Array).length===1&&(Ao=null);class vo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const $a=()=>new vo,uw=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Ar=e=>{const t=new Uint8Array(uw(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},hw=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Xi(n,t)*2),e.cpos=0)},qe=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},pu=qe,re=(e,t)=>{for(;t>qi;)qe(e,Un|qi&t),t=Si(t/128);qe(e,qi&t)},mu=(e,t)=>{const n=e0(t);for(n&&(t=-t),qe(e,(t>du?Un:0)|(n?ei:0)|du&t),t=Si(t/64);t>0;)qe(e,(t>qi?Un:0)|qi&t),t=Si(t/128)},gu=new Uint8Array(3e4),fw=gu.length/3,dw=(e,t)=>{if(t.length<fw){const n=To.encodeInto(t,gu).written||0;re(e,n);for(let r=0;r<n;r++)qe(e,gu[r])}else Fn(e,lw(t))},pw=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;re(e,r);for(let i=0;i<r;i++)qe(e,n.codePointAt(i))},Rs=To&&To.encodeInto?dw:pw,ja=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=t0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Xi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},Fn=(e,t)=>{re(e,t.byteLength),ja(e,t)},yu=(e,t)=>{hw(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},mw=(e,t)=>yu(e,4).setFloat32(0,t,!1),gw=(e,t)=>yu(e,8).setFloat64(0,t,!1),yw=(e,t)=>yu(e,8).setBigInt64(0,t,!1),o0=new DataView(new ArrayBuffer(4)),_w=e=>(o0.setFloat32(0,e),o0.getFloat32(0)===e),So=(e,t)=>{switch(typeof t){case"string":qe(e,119),Rs(e,t);break;case"number":rw(t)&&Ba(t)<=nw?(qe(e,125),mu(e,t)):_w(t)?(qe(e,124),mw(e,t)):(qe(e,123),gw(e,t));break;case"bigint":qe(e,122),yw(e,t);break;case"object":if(t===null)qe(e,126);else if(tw(t)){qe(e,117),re(e,t.length);for(let n=0;n<t.length;n++)So(e,t[n])}else if(t instanceof Uint8Array)qe(e,116),Fn(e,t);else{qe(e,118);const n=Object.keys(t);re(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Rs(e,i),So(e,t[i])}}break;case"boolean":qe(e,t?120:121);break;default:qe(e,127)}};class a0 extends vo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&re(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const c0=e=>{e.count>0&&(mu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&re(e.encoder,e.count-2))};class za{constructor(){this.encoder=new vo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(c0(this),this.count=1,this.s=t)}toUint8Array(){return c0(this),Ar(this.encoder)}}const l0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);mu(e.encoder,t),e.count>1&&re(e.encoder,e.count-2)}};class _u{constructor(){this.encoder=new vo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(l0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return l0(this),Ar(this.encoder)}}class bw{constructor(){this.sarr=[],this.s="",this.lensE=new za}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new vo;return this.sarr.push(this.s),this.s="",Rs(t,this.sarr.join("")),ja(t,this.lensE.toUint8Array()),Ar(t)}}const Ri=e=>new Error(e),vr=()=>{throw Ri("Method unimplemented")},Sr=()=>{throw Ri("Unexpected case")},u0=Ri("Unexpected end of array"),h0=Ri("Integer out of Range");class Wa{constructor(t){this.arr=t,this.pos=0}}const Is=e=>new Wa(e),Ew=e=>e.pos!==e.arr.length,ww=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Pn=e=>ww(e,Wt(e)),Ns=e=>e.arr[e.pos++],Wt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&qi)*n,n*=128,i<Un)return t;if(t>i0)throw h0}throw u0},bu=e=>{let t=e.arr[e.pos++],n=t&du,r=64;const i=(t&ei)>0?-1:1;if(!(t&Un))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&qi)*r,r*=128,t<Un)return i*n;if(n>i0)throw h0}throw u0},Os=Ao?e=>Ao.decode(Pn(e)):e=>{let t=Wt(e);if(t===0)return"";{let n=String.fromCodePoint(Ns(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ns(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Eu=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},kw=[e=>{},e=>null,bu,e=>Eu(e,4).getFloat32(0,!1),e=>Eu(e,8).getFloat64(0,!1),e=>Eu(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Os,e=>{const t=Wt(e),n={};for(let r=0;r<t;r++){const i=Os(e);n[i]=Ro(e)}return n},e=>{const t=Wt(e),n=[];for(let r=0;r<t;r++)n.push(Ro(e));return n},Pn],Ro=e=>kw[127-Ns(e)](e);class f0 extends Wa{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Ew(this)?this.count=Wt(this)+1:this.count=-1),this.count--,this.s}}class Ka extends Wa{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=bu(this);const t=e0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Wt(this)+2)}return this.count--,this.s}}class wu extends Wa{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=bu(this),n=t&1;this.diff=Si(t/2),this.count=1,n&&(this.count=Wt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class xw{constructor(t){this.decoder=new Ka(t),this.str=Os(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Tw=crypto.getRandomValues.bind(crypto),d0=()=>Tw(new Uint32Array(1))[0],Aw="10000000-1000-4000-8000"+-1e11,vw=()=>Aw.replace(/[018]/g,e=>(e^d0()&15>>e/4).toString(16)),p0=e=>new Promise(e);Promise.all.bind(Promise);var m0={},Ga={};Ga.byteLength=Iw,Ga.toByteArray=Ow,Ga.fromByteArray=Mw;for(var Rr=[],Vn=[],Sw=typeof Uint8Array<"u"?Uint8Array:Array,ku="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Cs=0,Rw=ku.length;Cs<Rw;++Cs)Rr[Cs]=ku[Cs],Vn[ku.charCodeAt(Cs)]=Cs;Vn[45]=62,Vn[95]=63;function g0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Iw(e){var t=g0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Nw(e,t,n){return(t+n)*3/4-n}function Ow(e){var t,n=g0(e),r=n[0],i=n[1],s=new Sw(Nw(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=Vn[e.charCodeAt(c)]<<18|Vn[e.charCodeAt(c+1)]<<12|Vn[e.charCodeAt(c+2)]<<6|Vn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Vn[e.charCodeAt(c)]<<2|Vn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=Vn[e.charCodeAt(c)]<<10|Vn[e.charCodeAt(c+1)]<<4|Vn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Cw(e){return Rr[e>>18&63]+Rr[e>>12&63]+Rr[e>>6&63]+Rr[e&63]}function Lw(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Cw(r));return i.join("")}function Mw(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Lw(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Rr[t>>2]+Rr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Rr[t>>10]+Rr[t>>4&63]+Rr[t<<2&63]+"=")),i.join("")}var xu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */xu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+e[t+h],h+=f,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(d?-1:1)*o*Math.pow(2,s-r)},xu.write=function(e,t,n,r,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=f/c:t+=f*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+d]=o&255,d+=p,o/=256,u-=8);e[n+d-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Ga,n=xu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const A=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(A,g),A.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(A){if(A>i)throw new RangeError('The value "'+A+'" is invalid for option "size"');const g=new s(A);return Object.setPrototypeOf(g,l.prototype),g}function l(A,g,y){if(typeof A=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(A)}return h(A,g,y)}l.poolSize=8192;function h(A,g,y){if(typeof A=="string")return m(A,g);if(o.isView(A))return w(A);if(A==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(dt(A,o)||A&&dt(A.buffer,o)||typeof a<"u"&&(dt(A,a)||A&&dt(A.buffer,a)))return T(A,g,y);if(typeof A=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const N=A.valueOf&&A.valueOf();if(N!=null&&N!==A)return l.from(N,g,y);const $=v(A);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof A[Symbol.toPrimitive]=="function")return l.from(A[Symbol.toPrimitive]("string"),g,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}l.from=function(A,g,y){return h(A,g,y)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function f(A){if(typeof A!="number")throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function d(A,g,y){return f(A),A<=0?u(A):g!==void 0?typeof y=="string"?u(A).fill(g,y):u(A).fill(g):u(A)}l.alloc=function(A,g,y){return d(A,g,y)};function p(A){return f(A),u(A<0?0:I(A)|0)}l.allocUnsafe=function(A){return p(A)},l.allocUnsafeSlow=function(A){return p(A)};function m(A,g){if((typeof g!="string"||g==="")&&(g="utf8"),!l.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const y=R(A,g)|0;let N=u(y);const $=N.write(A,g);return $!==y&&(N=N.slice(0,$)),N}function k(A){const g=A.length<0?0:I(A.length)|0,y=u(g);for(let N=0;N<g;N+=1)y[N]=A[N]&255;return y}function w(A){if(dt(A,s)){const g=new s(A);return T(g.buffer,g.byteOffset,g.byteLength)}return k(A)}function T(A,g,y){if(g<0||A.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<g+(y||0))throw new RangeError('"length" is outside of buffer bounds');let N;return g===void 0&&y===void 0?N=new s(A):y===void 0?N=new s(A,g):N=new s(A,g,y),Object.setPrototypeOf(N,l.prototype),N}function v(A){if(l.isBuffer(A)){const g=I(A.length)|0,y=u(g);return y.length===0||A.copy(y,0,0,g),y}if(A.length!==void 0)return typeof A.length!="number"||vt(A.length)?u(0):k(A);if(A.type==="Buffer"&&Array.isArray(A.data))return k(A.data)}function I(A){if(A>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return A|0}function U(A){return+A!=A&&(A=0),l.alloc(+A)}l.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==l.prototype},l.compare=function(g,y){if(dt(g,s)&&(g=l.from(g,g.offset,g.byteLength)),dt(y,s)&&(y=l.from(y,y.offset,y.byteLength)),!l.isBuffer(g)||!l.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===y)return 0;let N=g.length,$=y.length;for(let Q=0,it=Math.min(N,$);Q<it;++Q)if(g[Q]!==y[Q]){N=g[Q],$=y[Q];break}return N<$?-1:$<N?1:0},l.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(g,y){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return l.alloc(0);let N;if(y===void 0)for(y=0,N=0;N<g.length;++N)y+=g[N].length;const $=l.allocUnsafe(y);let Q=0;for(N=0;N<g.length;++N){let it=g[N];if(dt(it,s))Q+it.length>$.length?(l.isBuffer(it)||(it=l.from(it)),it.copy($,Q)):s.prototype.set.call($,it,Q);else if(l.isBuffer(it))it.copy($,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return $};function R(A,g){if(l.isBuffer(A))return A.length;if(o.isView(A)||dt(A,o))return A.byteLength;if(typeof A!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);const y=A.length,N=arguments.length>2&&arguments[2]===!0;if(!N&&y===0)return 0;let $=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return at(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return pt(A).length;default:if($)return N?-1:at(A).length;g=(""+g).toLowerCase(),$=!0}}l.byteLength=R;function L(A,g,y){let N=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,g>>>=0,y<=g))return"";for(A||(A="utf8");;)switch(A){case"hex":return z(this,g,y);case"utf8":case"utf-8":return D(this,g,y);case"ascii":return ft(this,g,y);case"latin1":case"binary":return V(this,g,y);case"base64":return X(this,g,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Et(this,g,y);default:if(N)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),N=!0}}l.prototype._isBuffer=!0;function B(A,g,y){const N=A[g];A[g]=A[y],A[y]=N}l.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<g;y+=2)B(this,y,y+1);return this},l.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<g;y+=4)B(this,y,y+3),B(this,y+1,y+2);return this},l.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<g;y+=8)B(this,y,y+7),B(this,y+1,y+6),B(this,y+2,y+5),B(this,y+3,y+4);return this},l.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?D(this,0,g):L.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(g){if(!l.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:l.compare(this,g)===0},l.prototype.inspect=function(){let g="";const y=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(g+=" ... "),"<Buffer "+g+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(g,y,N,$,Q){if(dt(g,s)&&(g=l.from(g,g.offset,g.byteLength)),!l.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(y===void 0&&(y=0),N===void 0&&(N=g?g.length:0),$===void 0&&($=0),Q===void 0&&(Q=this.length),y<0||N>g.length||$<0||Q>this.length)throw new RangeError("out of range index");if($>=Q&&y>=N)return 0;if($>=Q)return-1;if(y>=N)return 1;if(y>>>=0,N>>>=0,$>>>=0,Q>>>=0,this===g)return 0;let it=Q-$,jt=N-y;const ke=Math.min(it,jt),ge=this.slice($,Q),xe=g.slice(y,N);for(let ae=0;ae<ke;++ae)if(ge[ae]!==xe[ae]){it=ge[ae],jt=xe[ae];break}return it<jt?-1:jt<it?1:0};function O(A,g,y,N,$){if(A.length===0)return-1;if(typeof y=="string"?(N=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=$?0:A.length-1),y<0&&(y=A.length+y),y>=A.length){if($)return-1;y=A.length-1}else if(y<0)if($)y=0;else return-1;if(typeof g=="string"&&(g=l.from(g,N)),l.isBuffer(g))return g.length===0?-1:Y(A,g,y,N,$);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?$?s.prototype.indexOf.call(A,g,y):s.prototype.lastIndexOf.call(A,g,y):Y(A,[g],y,N,$);throw new TypeError("val must be string, number or Buffer")}function Y(A,g,y,N,$){let Q=1,it=A.length,jt=g.length;if(N!==void 0&&(N=String(N).toLowerCase(),N==="ucs2"||N==="ucs-2"||N==="utf16le"||N==="utf-16le")){if(A.length<2||g.length<2)return-1;Q=2,it/=2,jt/=2,y/=2}function ke(xe,ae){return Q===1?xe[ae]:xe.readUInt16BE(ae*Q)}let ge;if($){let xe=-1;for(ge=y;ge<it;ge++)if(ke(A,ge)===ke(g,xe===-1?0:ge-xe)){if(xe===-1&&(xe=ge),ge-xe+1===jt)return xe*Q}else xe!==-1&&(ge-=ge-xe),xe=-1}else for(y+jt>it&&(y=it-jt),ge=y;ge>=0;ge--){let xe=!0;for(let ae=0;ae<jt;ae++)if(ke(A,ge+ae)!==ke(g,ae)){xe=!1;break}if(xe)return ge}return-1}l.prototype.includes=function(g,y,N){return this.indexOf(g,y,N)!==-1},l.prototype.indexOf=function(g,y,N){return O(this,g,y,N,!0)},l.prototype.lastIndexOf=function(g,y,N){return O(this,g,y,N,!1)};function et(A,g,y,N){y=Number(y)||0;const $=A.length-y;N?(N=Number(N),N>$&&(N=$)):N=$;const Q=g.length;N>Q/2&&(N=Q/2);let it;for(it=0;it<N;++it){const jt=parseInt(g.substr(it*2,2),16);if(vt(jt))return it;A[y+it]=jt}return it}function C(A,g,y,N){return _t(at(g,A.length-y),A,y,N)}function S(A,g,y,N){return _t(ht(g),A,y,N)}function b(A,g,y,N){return _t(pt(g),A,y,N)}function P(A,g,y,N){return _t(Z(g,A.length-y),A,y,N)}l.prototype.write=function(g,y,N,$){if(y===void 0)$="utf8",N=this.length,y=0;else if(N===void 0&&typeof y=="string")$=y,N=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(N)?(N=N>>>0,$===void 0&&($="utf8")):($=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Q=this.length-y;if((N===void 0||N>Q)&&(N=Q),g.length>0&&(N<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");let it=!1;for(;;)switch($){case"hex":return et(this,g,y,N);case"utf8":case"utf-8":return C(this,g,y,N);case"ascii":case"latin1":case"binary":return S(this,g,y,N);case"base64":return b(this,g,y,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,g,y,N);default:if(it)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),it=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(A,g,y){return g===0&&y===A.length?t.fromByteArray(A):t.fromByteArray(A.slice(g,y))}function D(A,g,y){y=Math.min(A.length,y);const N=[];let $=g;for(;$<y;){const Q=A[$];let it=null,jt=Q>239?4:Q>223?3:Q>191?2:1;if($+jt<=y){let ke,ge,xe,ae;switch(jt){case 1:Q<128&&(it=Q);break;case 2:ke=A[$+1],(ke&192)===128&&(ae=(Q&31)<<6|ke&63,ae>127&&(it=ae));break;case 3:ke=A[$+1],ge=A[$+2],(ke&192)===128&&(ge&192)===128&&(ae=(Q&15)<<12|(ke&63)<<6|ge&63,ae>2047&&(ae<55296||ae>57343)&&(it=ae));break;case 4:ke=A[$+1],ge=A[$+2],xe=A[$+3],(ke&192)===128&&(ge&192)===128&&(xe&192)===128&&(ae=(Q&15)<<18|(ke&63)<<12|(ge&63)<<6|xe&63,ae>65535&&ae<1114112&&(it=ae))}}it===null?(it=65533,jt=1):it>65535&&(it-=65536,N.push(it>>>10&1023|55296),it=56320|it&1023),N.push(it),$+=jt}return tt(N)}const ct=4096;function tt(A){const g=A.length;if(g<=ct)return String.fromCharCode.apply(String,A);let y="",N=0;for(;N<g;)y+=String.fromCharCode.apply(String,A.slice(N,N+=ct));return y}function ft(A,g,y){let N="";y=Math.min(A.length,y);for(let $=g;$<y;++$)N+=String.fromCharCode(A[$]&127);return N}function V(A,g,y){let N="";y=Math.min(A.length,y);for(let $=g;$<y;++$)N+=String.fromCharCode(A[$]);return N}function z(A,g,y){const N=A.length;(!g||g<0)&&(g=0),(!y||y<0||y>N)&&(y=N);let $="";for(let Q=g;Q<y;++Q)$+=ce[A[Q]];return $}function Et(A,g,y){const N=A.slice(g,y);let $="";for(let Q=0;Q<N.length-1;Q+=2)$+=String.fromCharCode(N[Q]+N[Q+1]*256);return $}l.prototype.slice=function(g,y){const N=this.length;g=~~g,y=y===void 0?N:~~y,g<0?(g+=N,g<0&&(g=0)):g>N&&(g=N),y<0?(y+=N,y<0&&(y=0)):y>N&&(y=N),y<g&&(y=g);const $=this.subarray(g,y);return Object.setPrototypeOf($,l.prototype),$};function ot(A,g,y){if(A%1!==0||A<0)throw new RangeError("offset is not uint");if(A+g>y)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let $=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)$+=this[g+it]*Q;return $},l.prototype.readUintBE=l.prototype.readUIntBE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let $=this[g+--y],Q=1;for(;y>0&&(Q*=256);)$+=this[g+--y]*Q;return $},l.prototype.readUint8=l.prototype.readUInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]|this[g+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(g,y){return g=g>>>0,y||ot(g,2,this.length),this[g]<<8|this[g+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},l.prototype.readBigUInt64LE=Ft(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,Q=this[++g]+this[++g]*2**8+this[++g]*2**16+N*2**24;return BigInt($)+(BigInt(Q)<<BigInt(32))}),l.prototype.readBigUInt64BE=Ft(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=y*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],Q=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+N;return(BigInt($)<<BigInt(32))+BigInt(Q)}),l.prototype.readIntLE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let $=this[g],Q=1,it=0;for(;++it<y&&(Q*=256);)$+=this[g+it]*Q;return Q*=128,$>=Q&&($-=Math.pow(2,8*y)),$},l.prototype.readIntBE=function(g,y,N){g=g>>>0,y=y>>>0,N||ot(g,y,this.length);let $=y,Q=1,it=this[g+--$];for(;$>0&&(Q*=256);)it+=this[g+--$]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*y)),it},l.prototype.readInt8=function(g,y){return g=g>>>0,y||ot(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},l.prototype.readInt16LE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const N=this[g]|this[g+1]<<8;return N&32768?N|4294901760:N},l.prototype.readInt16BE=function(g,y){g=g>>>0,y||ot(g,2,this.length);const N=this[g+1]|this[g]<<8;return N&32768?N|4294901760:N},l.prototype.readInt32LE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},l.prototype.readInt32BE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},l.prototype.readBigInt64LE=Ft(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(N<<24);return(BigInt($)<<BigInt(32))+BigInt(y+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),l.prototype.readBigInt64BE=Ft(function(g){g=g>>>0,nt(g,"offset");const y=this[g],N=this[g+7];(y===void 0||N===void 0)&&F(g,this.length-8);const $=(y<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt($)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+N)}),l.prototype.readFloatLE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!0,23,4)},l.prototype.readFloatBE=function(g,y){return g=g>>>0,y||ot(g,4,this.length),n.read(this,g,!1,23,4)},l.prototype.readDoubleLE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!0,52,8)},l.prototype.readDoubleBE=function(g,y){return g=g>>>0,y||ot(g,8,this.length),n.read(this,g,!1,52,8)};function lt(A,g,y,N,$,Q){if(!l.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>$||g<Q)throw new RangeError('"value" argument is out of bounds');if(y+N>A.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(g,y,N,$){if(g=+g,y=y>>>0,N=N>>>0,!$){const jt=Math.pow(2,8*N)-1;lt(this,g,y,N,jt,0)}let Q=1,it=0;for(this[y]=g&255;++it<N&&(Q*=256);)this[y+it]=g/Q&255;return y+N},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(g,y,N,$){if(g=+g,y=y>>>0,N=N>>>0,!$){const jt=Math.pow(2,8*N)-1;lt(this,g,y,N,jt,0)}let Q=N-1,it=1;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)this[y+Q]=g/it&255;return y+N},l.prototype.writeUint8=l.prototype.writeUInt8=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,1,255,0),this[y]=g&255,y+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,65535,0),this[y]=g&255,this[y+1]=g>>>8,y+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,65535,0),this[y]=g>>>8,this[y+1]=g&255,y+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,4294967295,0),this[y+3]=g>>>24,this[y+2]=g>>>16,this[y+1]=g>>>8,this[y]=g&255,y+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,4294967295,0),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4};function Lt(A,g,y,N,$){st(g,N,$,A,y,7);let Q=Number(g&BigInt(4294967295));A[y++]=Q,Q=Q>>8,A[y++]=Q,Q=Q>>8,A[y++]=Q,Q=Q>>8,A[y++]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return A[y++]=it,it=it>>8,A[y++]=it,it=it>>8,A[y++]=it,it=it>>8,A[y++]=it,y}function Xt(A,g,y,N,$){st(g,N,$,A,y,7);let Q=Number(g&BigInt(4294967295));A[y+7]=Q,Q=Q>>8,A[y+6]=Q,Q=Q>>8,A[y+5]=Q,Q=Q>>8,A[y+4]=Q;let it=Number(g>>BigInt(32)&BigInt(4294967295));return A[y+3]=it,it=it>>8,A[y+2]=it,it=it>>8,A[y+1]=it,it=it>>8,A[y]=it,y+8}l.prototype.writeBigUInt64LE=Ft(function(g,y=0){return Lt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Ft(function(g,y=0){return Xt(this,g,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(g,y,N,$){if(g=+g,y=y>>>0,!$){const ke=Math.pow(2,8*N-1);lt(this,g,y,N,ke-1,-ke)}let Q=0,it=1,jt=0;for(this[y]=g&255;++Q<N&&(it*=256);)g<0&&jt===0&&this[y+Q-1]!==0&&(jt=1),this[y+Q]=(g/it>>0)-jt&255;return y+N},l.prototype.writeIntBE=function(g,y,N,$){if(g=+g,y=y>>>0,!$){const ke=Math.pow(2,8*N-1);lt(this,g,y,N,ke-1,-ke)}let Q=N-1,it=1,jt=0;for(this[y+Q]=g&255;--Q>=0&&(it*=256);)g<0&&jt===0&&this[y+Q+1]!==0&&(jt=1),this[y+Q]=(g/it>>0)-jt&255;return y+N},l.prototype.writeInt8=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,1,127,-128),g<0&&(g=255+g+1),this[y]=g&255,y+1},l.prototype.writeInt16LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,32767,-32768),this[y]=g&255,this[y+1]=g>>>8,y+2},l.prototype.writeInt16BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,2,32767,-32768),this[y]=g>>>8,this[y+1]=g&255,y+2},l.prototype.writeInt32LE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,2147483647,-2147483648),this[y]=g&255,this[y+1]=g>>>8,this[y+2]=g>>>16,this[y+3]=g>>>24,y+4},l.prototype.writeInt32BE=function(g,y,N){return g=+g,y=y>>>0,N||lt(this,g,y,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[y]=g>>>24,this[y+1]=g>>>16,this[y+2]=g>>>8,this[y+3]=g&255,y+4},l.prototype.writeBigInt64LE=Ft(function(g,y=0){return Lt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Ft(function(g,y=0){return Xt(this,g,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Mt(A,g,y,N,$,Q){if(y+N>A.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function xt(A,g,y,N,$){return g=+g,y=y>>>0,$||Mt(A,g,y,4),n.write(A,g,y,N,23,4),y+4}l.prototype.writeFloatLE=function(g,y,N){return xt(this,g,y,!0,N)},l.prototype.writeFloatBE=function(g,y,N){return xt(this,g,y,!1,N)};function Bt(A,g,y,N,$){return g=+g,y=y>>>0,$||Mt(A,g,y,8),n.write(A,g,y,N,52,8),y+8}l.prototype.writeDoubleLE=function(g,y,N){return Bt(this,g,y,!0,N)},l.prototype.writeDoubleBE=function(g,y,N){return Bt(this,g,y,!1,N)},l.prototype.copy=function(g,y,N,$){if(!l.isBuffer(g))throw new TypeError("argument should be a Buffer");if(N||(N=0),!$&&$!==0&&($=this.length),y>=g.length&&(y=g.length),y||(y=0),$>0&&$<N&&($=N),$===N||g.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),g.length-y<$-N&&($=g.length-y+N);const Q=$-N;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,N,$):s.prototype.set.call(g,this.subarray(N,$),y),Q},l.prototype.fill=function(g,y,N,$){if(typeof g=="string"){if(typeof y=="string"?($=y,y=0,N=this.length):typeof N=="string"&&($=N,N=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!l.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(g.length===1){const it=g.charCodeAt(0);($==="utf8"&&it<128||$==="latin1")&&(g=it)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(y<0||this.length<y||this.length<N)throw new RangeError("Out of range index");if(N<=y)return this;y=y>>>0,N=N===void 0?this.length:N>>>0,g||(g=0);let Q;if(typeof g=="number")for(Q=y;Q<N;++Q)this[Q]=g;else{const it=l.isBuffer(g)?g:l.from(g,$),jt=it.length;if(jt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(Q=0;Q<N-y;++Q)this[Q+y]=it[Q%jt]}return this};const Ut={};function we(A,g,y){Ut[A]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${A}]`,this.stack,delete this.name}get code(){return A}set code($){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:$,writable:!0})}toString(){return`${this.name} [${A}]: ${this.message}`}}}we("ERR_BUFFER_OUT_OF_BOUNDS",function(A){return A?`${A} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),we("ERR_INVALID_ARG_TYPE",function(A,g){return`The "${A}" argument must be of type number. Received type ${typeof g}`},TypeError),we("ERR_OUT_OF_RANGE",function(A,g,y){let N=`The value of "${A}" is out of range.`,$=y;return Number.isInteger(y)&&Math.abs(y)>2**32?$=Ie(String(y)):typeof y=="bigint"&&($=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&($=Ie($)),$+="n"),N+=` It must be ${g}. Received ${$}`,N},RangeError);function Ie(A){let g="",y=A.length;const N=A[0]==="-"?1:0;for(;y>=N+4;y-=3)g=`_${A.slice(y-3,y)}${g}`;return`${A.slice(0,y)}${g}`}function E(A,g,y){nt(g,"offset"),(A[g]===void 0||A[g+y]===void 0)&&F(g,A.length-(y+1))}function st(A,g,y,N,$,Q){if(A>y||A<g){const it=typeof g=="bigint"?"n":"";let jt;throw g===0||g===BigInt(0)?jt=`>= 0${it} and < 2${it} ** ${(Q+1)*8}${it}`:jt=`>= -(2${it} ** ${(Q+1)*8-1}${it}) and < 2 ** ${(Q+1)*8-1}${it}`,new Ut.ERR_OUT_OF_RANGE("value",jt,A)}E(N,$,Q)}function nt(A,g){if(typeof A!="number")throw new Ut.ERR_INVALID_ARG_TYPE(g,"number",A)}function F(A,g,y){throw Math.floor(A)!==A?(nt(A,y),new Ut.ERR_OUT_OF_RANGE("offset","an integer",A)):g<0?new Ut.ERR_BUFFER_OUT_OF_BOUNDS:new Ut.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,A)}const M=/[^+/0-9A-Za-z-_]/g;function K(A){if(A=A.split("=")[0],A=A.trim().replace(M,""),A.length<2)return"";for(;A.length%4!==0;)A=A+"=";return A}function at(A,g){g=g||1/0;let y;const N=A.length;let $=null;const Q=[];for(let it=0;it<N;++it){if(y=A.charCodeAt(it),y>55295&&y<57344){if(!$){if(y>56319){(g-=3)>-1&&Q.push(239,191,189);continue}else if(it+1===N){(g-=3)>-1&&Q.push(239,191,189);continue}$=y;continue}if(y<56320){(g-=3)>-1&&Q.push(239,191,189),$=y;continue}y=($-55296<<10|y-56320)+65536}else $&&(g-=3)>-1&&Q.push(239,191,189);if($=null,y<128){if((g-=1)<0)break;Q.push(y)}else if(y<2048){if((g-=2)<0)break;Q.push(y>>6|192,y&63|128)}else if(y<65536){if((g-=3)<0)break;Q.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((g-=4)<0)break;Q.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return Q}function ht(A){const g=[];for(let y=0;y<A.length;++y)g.push(A.charCodeAt(y)&255);return g}function Z(A,g){let y,N,$;const Q=[];for(let it=0;it<A.length&&!((g-=2)<0);++it)y=A.charCodeAt(it),N=y>>8,$=y%256,Q.push($),Q.push(N);return Q}function pt(A){return t.toByteArray(K(A))}function _t(A,g,y,N){let $;for($=0;$<N&&!($+y>=g.length||$>=A.length);++$)g[$+y]=A[$];return $}function dt(A,g){return A instanceof g||A!=null&&A.constructor!=null&&A.constructor.name!=null&&A.constructor.name===g.name}function vt(A){return A!==A}const ce=function(){const A="0123456789abcdef",g=new Array(256);for(let y=0;y<16;++y){const N=y*16;for(let $=0;$<16;++$)g[N+$]=A[y]+A[$]}return g}();function Ft(A){return typeof BigInt>"u"?Ln:A}function Ln(){throw new Error("BigInt not supported")}})(m0);const tn=m0.Buffer;function Uw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var y0={exports:{}},Oe=y0.exports={},Ir,Nr;function Tu(){throw new Error("setTimeout has not been defined")}function Au(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Ir=setTimeout:Ir=Tu}catch{Ir=Tu}try{typeof clearTimeout=="function"?Nr=clearTimeout:Nr=Au}catch{Nr=Au}})();function _0(e){if(Ir===setTimeout)return setTimeout(e,0);if((Ir===Tu||!Ir)&&setTimeout)return Ir=setTimeout,setTimeout(e,0);try{return Ir(e,0)}catch{try{return Ir.call(null,e,0)}catch{return Ir.call(this,e,0)}}}function Fw(e){if(Nr===clearTimeout)return clearTimeout(e);if((Nr===Au||!Nr)&&clearTimeout)return Nr=clearTimeout,clearTimeout(e);try{return Nr(e)}catch{try{return Nr.call(null,e)}catch{return Nr.call(this,e)}}}var ni=[],Ls=!1,Ji,Ha=-1;function Pw(){!Ls||!Ji||(Ls=!1,Ji.length?ni=Ji.concat(ni):Ha=-1,ni.length&&b0())}function b0(){if(!Ls){var e=_0(Pw);Ls=!0;for(var t=ni.length;t;){for(Ji=ni,ni=[];++Ha<t;)Ji&&Ji[Ha].run();Ha=-1,t=ni.length}Ji=null,Ls=!1,Fw(e)}}Oe.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ni.push(new E0(e,t)),ni.length===1&&!Ls&&_0(b0)};function E0(e,t){this.fun=e,this.array=t}E0.prototype.run=function(){this.fun.apply(null,this.array)},Oe.title="browser",Oe.browser=!0,Oe.env={},Oe.argv=[],Oe.version="",Oe.versions={};function ri(){}Oe.on=ri,Oe.addListener=ri,Oe.once=ri,Oe.off=ri,Oe.removeListener=ri,Oe.removeAllListeners=ri,Oe.emit=ri,Oe.prependListener=ri,Oe.prependOnceListener=ri,Oe.listeners=function(e){return[]},Oe.binding=function(e){throw new Error("process.binding is not supported")},Oe.cwd=function(){return"/"},Oe.chdir=function(e){throw new Error("process.chdir is not supported")},Oe.umask=function(){return 0};var Bw=y0.exports;const Ii=Uw(Bw),w0=e=>e===void 0?null:e;class Dw{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let k0=new Dw,$w=!0;try{typeof localStorage<"u"&&localStorage&&(k0=localStorage,$w=!1)}catch{}const jw=k0,zw=Object.assign,Ww=Object.keys,Kw=(e,t)=>{for(const n in e)t(e[n],n)},x0=e=>Ww(e).length,Gw=e=>{for(const t in e)return!1;return!0},Hw=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Yw=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Vw=(e,t)=>e===t||x0(e)===x0(t)&&Hw(e,(n,r)=>(n!==void 0||Yw(t,r))&&t[r]===n),Xw=Object.freeze,T0=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&T0(e[t])}return Xw(e)},vu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&vu(e,t,n+1)}},qw=e=>e,Jw=(e,t)=>t.includes(e);var A0={};const Io=typeof Ii<"u"&&Ii.release&&/node|io\.js/.test(Ii.release.name)&&Object.prototype.toString.call(typeof Ii<"u"?Ii:0)==="[object process]";let Or;const Zw=()=>{if(Or===void 0)if(Io){Or=ur();const e=Ii.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Or.set(t,""),t=r):t!==null&&(Or.set(t,r),t=null)}t!==null&&Or.set(t,"")}else typeof location=="object"?(Or=ur(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Or.set(`--${s0(t,"-")}`,n),Or.set(`-${s0(t,"-")}`,n)}})):Or=ur();return Or},Su=e=>Zw().has(e),Ya=e=>w0(Io?A0[e.toUpperCase().replaceAll("-","_")]:jw.getItem(e)),v0=e=>Su("--"+e)||Ya(e)!==null;v0("production");const Qw=Io&&Jw(A0.FORCE_COLOR,["true","1","2"])||!Su("--no-colors")&&!v0("no-color")&&(!Io||Ii.stdout.isTTY)&&(!Io||Su("--color")||Ya("COLORTERM")!==null||(Ya("TERM")||"").includes("color")),tk=e=>new Uint8Array(e),ek=e=>{const t=tk(e.byteLength);return t.set(e),t};class nk{constructor(t,n){this.left=t,this.right=n}}const ii=(e,t)=>new nk(e,t);typeof DOMParser<"u"&&new DOMParser;const rk=e=>JE(e,(t,n)=>`${n}:${t};`).join(""),si=Symbol,S0=si(),R0=si(),ik=si(),sk=si(),ok=si(),I0=si(),ak=si(),Ru=si(),ck=si(),lk=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},uk={[S0]:ii("font-weight","bold"),[R0]:ii("font-weight","normal"),[ik]:ii("color","blue"),[ok]:ii("color","green"),[sk]:ii("color","grey"),[I0]:ii("color","red"),[ak]:ii("color","purple"),[Ru]:ii("color","orange"),[ck]:ii("color","black")},N0=Qw?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=ur();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=uk[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=rk(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:lk,hk=(...e)=>{console.log(...N0(e)),O0.forEach(t=>t.print(e))},fk=(...e)=>{console.warn(...N0(e)),e.unshift(Ru),O0.forEach(t=>t.print(e))},O0=Ss(),C0=e=>({[Symbol.iterator](){return this},next:e}),dk=(e,t)=>C0(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Iu=(e,t)=>C0(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Nu{constructor(t,n){this.clock=t,this.len=n}}class No{constructor(){this.clients=new Map}}const L0=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];X0(e,s,a.clock,a.len,n)}}),pk=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Si((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},M0=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&pk(n,t.clock)!==null},Ou=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Xi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},mk=e=>{const t=new No;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)QE(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Ou(t),t},Va=(e,t,n,r)=>{vi(e.clients,t,()=>[]).push(new Nu(n,r))},gk=()=>new No,yk=e=>{const t=gk();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new Nu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Ms=(e,t)=>{re(e.restEncoder,t.clients.size),Vi(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),re(e.restEncoder,n);const i=r.length;re(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Cu=e=>{const t=new No,n=Wt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Wt(e.restDecoder),s=Wt(e.restDecoder);if(s>0){const o=vi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Nu(e.readDsClock(),e.readDsLen()))}}return t},U0=(e,t,n)=>{const r=new No,i=Wt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Wt(e.restDecoder),a=Wt(e.restDecoder),c=n.clients.get(o)||[],u=Je(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<u){u<f&&Va(r,o,u,f-u);let d=Cr(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,cc(t,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,cc(t,p,f-p.id.clock)),p.delete(t))}else Va(r,o,h,f-h)}}if(r.clients.size>0){const s=new Zi;return re(s.restEncoder,0),Ms(s,r),s.toUint8Array()}return null},F0=d0;class Us extends ew{constructor({guid:t=vw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=F0(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new H0,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=p0(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>p0(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&ue(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Vi(this.subdocs).map(t=>t.guid))}transact(t,n=null){return ue(this,t,n)}get(t,n=en){const r=vi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==en&&i!==n)if(i===en){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Ds)}getText(t=""){return this.get(t,oi)}getMap(t=""){return this.get(t,$s)}getXmlElement(t=""){return this.get(t,zs)}getXmlFragment(t=""){return this.get(t,Qi)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Vi(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Us({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,ue(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class P0{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Wt(this.restDecoder)}readDsLen(){return Wt(this.restDecoder)}}class B0 extends P0{readLeftID(){return qt(Wt(this.restDecoder),Wt(this.restDecoder))}readRightID(){return qt(Wt(this.restDecoder),Wt(this.restDecoder))}readClient(){return Wt(this.restDecoder)}readInfo(){return Ns(this.restDecoder)}readString(){return Os(this.restDecoder)}readParentInfo(){return Wt(this.restDecoder)===1}readTypeRef(){return Wt(this.restDecoder)}readLen(){return Wt(this.restDecoder)}readAny(){return Ro(this.restDecoder)}readBuf(){return ek(Pn(this.restDecoder))}readJSON(){return JSON.parse(Os(this.restDecoder))}readKey(){return Os(this.restDecoder)}}class _k{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Wt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Wt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Fs extends _k{constructor(t){super(t),this.keys=[],Wt(t),this.keyClockDecoder=new wu(Pn(t)),this.clientDecoder=new Ka(Pn(t)),this.leftClockDecoder=new wu(Pn(t)),this.rightClockDecoder=new wu(Pn(t)),this.infoDecoder=new f0(Pn(t),Ns),this.stringDecoder=new xw(Pn(t)),this.parentInfoDecoder=new f0(Pn(t),Ns),this.typeRefDecoder=new Ka(Pn(t)),this.lenDecoder=new Ka(Pn(t))}readLeftID(){return new Ps(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ps(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ro(this.restDecoder)}readBuf(){return Pn(this.restDecoder)}readJSON(){return Ro(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class bk{constructor(){this.restEncoder=$a()}toUint8Array(){return Ar(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){re(this.restEncoder,t)}writeDsLen(t){re(this.restEncoder,t)}}class Oo extends bk{writeLeftID(t){re(this.restEncoder,t.client),re(this.restEncoder,t.clock)}writeRightID(t){re(this.restEncoder,t.client),re(this.restEncoder,t.clock)}writeClient(t){re(this.restEncoder,t)}writeInfo(t){pu(this.restEncoder,t)}writeString(t){Rs(this.restEncoder,t)}writeParentInfo(t){re(this.restEncoder,t?1:0)}writeTypeRef(t){re(this.restEncoder,t)}writeLen(t){re(this.restEncoder,t)}writeAny(t){So(this.restEncoder,t)}writeBuf(t){Fn(this.restEncoder,t)}writeJSON(t){Rs(this.restEncoder,JSON.stringify(t))}writeKey(t){Rs(this.restEncoder,t)}}class Ek{constructor(){this.restEncoder=$a(),this.dsCurrVal=0}toUint8Array(){return Ar(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,re(this.restEncoder,n)}writeDsLen(t){t===0&&Sr(),re(this.restEncoder,t-1),this.dsCurrVal+=t}}class Zi extends Ek{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new _u,this.clientEncoder=new za,this.leftClockEncoder=new _u,this.rightClockEncoder=new _u,this.infoEncoder=new a0(pu),this.stringEncoder=new bw,this.parentInfoEncoder=new a0(pu),this.typeRefEncoder=new za,this.lenEncoder=new za}toUint8Array(){const t=$a();return re(t,0),Fn(t,this.keyClockEncoder.toUint8Array()),Fn(t,this.clientEncoder.toUint8Array()),Fn(t,this.leftClockEncoder.toUint8Array()),Fn(t,this.rightClockEncoder.toUint8Array()),Fn(t,Ar(this.infoEncoder)),Fn(t,this.stringEncoder.toUint8Array()),Fn(t,Ar(this.parentInfoEncoder)),Fn(t,this.typeRefEncoder.toUint8Array()),Fn(t,this.lenEncoder.toUint8Array()),ja(t,Ar(this.restEncoder)),Ar(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){So(this.restEncoder,t)}writeBuf(t){Fn(this.restEncoder,t)}writeJSON(t){So(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const wk=(e,t,n,r)=>{r=Xi(r,t[0].id.clock);const i=Cr(t,r);re(e.restEncoder,t.length-i),e.writeClient(n),re(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Lu=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Je(t,s)>i&&r.set(s,i)}),Uu(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),re(e.restEncoder,r.size),Vi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{wk(e,t.clients.get(i),i,s)})},kk=(e,t)=>{const n=ur(),r=Wt(e.restDecoder);for(let i=0;i<r;i++){const s=Wt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Wt(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Da&l){case 0:{const h=e.readLen();o[u]=new Xn(qt(a,c),h),c+=h;break}case 10:{const h=Wt(e.restDecoder);o[u]=new qn(qt(a,c),h),c+=h;break}default:{const h=(l&(ei|Un))===0,f=new ze(qt(a,c),null,(l&Un)===Un?e.readLeftID():null,null,(l&ei)===ei?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&xo)===xo?e.readString():null,Ep(e,l));o[u]=f,c+=f.length}}}}return n},xk=(e,t,n)=>{const r=[];let i=Vi(n.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=n.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=n.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new H0,c=new Map,u=(d,p)=>{const m=c.get(d);(m==null||m>p)&&c.set(d,p)};let l=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[d]),i=i.filter(k=>k!==p)}r.length=0};for(;;){if(l.constructor!==qn){const p=vi(h,l.id.client,()=>Je(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{const m=l.getMissing(e,t);if(m!==null){r.push(l);const k=n.get(m)||{refs:[],i:0};if(k.refs.length===k.i)u(m,Je(t,m)),f();else{l=k.refs[k.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const d=new Zi;return Lu(d,a,new Map),re(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},Tk=(e,t)=>Lu(e,t.doc.store,t.beforeState),Ak=(e,t,n,r=new Fs(e))=>ue(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=kk(r,o),u=xk(i,a,c),l=a.pendingStructs;if(l){for(const[f,d]of l.missing)if(d<Je(a,f)){s=!0;break}if(u){for(const[f,d]of u.missing){const p=l.missing.get(f);(p==null||p>d)&&l.missing.set(f,d)}l.update=Ja([l.update,u.update])}}else a.pendingStructs=u;const h=U0(r,i,a);if(a.pendingDs){const f=new Fs(Is(a.pendingDs));Wt(f.restDecoder);const d=U0(f,i,a);h&&d?a.pendingDs=Ja([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,D0(i.doc,f)}},n,!1),D0=(e,t,n,r=Fs)=>{const i=Is(t);Ak(i,e,n,new r(i))},$0=(e,t,n)=>D0(e,t,n,B0),vk=(e,t,n=new Map)=>{Lu(e,t.store,n),Ms(e,yk(t.store))},Sk=(e,t=new Uint8Array([0]),n=new Zi)=>{const r=j0(t);vk(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Dk(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Oo)return Pk(i.map((s,o)=>o===0?s:jk(s)));if(n.constructor===Zi)return Ja(i)}return i[0]},Rk=(e,t)=>Sk(e,t,new Oo),Ik=e=>{const t=new Map,n=Wt(e.restDecoder);for(let r=0;r<n;r++){const i=Wt(e.restDecoder),s=Wt(e.restDecoder);t.set(i,s)}return t},j0=e=>Ik(new P0(Is(e)));class Nk{constructor(){this.l=[]}}const z0=()=>new Nk,W0=(e,t)=>e.l.push(t),K0=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},G0=(e,t,n)=>vu(e.l,[t,n]);class Ps{constructor(t,n){this.client=t,this.clock=n}}const Xa=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,qt=(e,t)=>new Ps(e,t),Ok=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Sr()},Bs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!M0(t.ds,e.id),Mu=(e,t)=>{const n=vi(e.meta,Mu,Ss),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Je(r,s)&&Ni(e,qt(s,i))}),L0(e,t.ds,i=>{}),n.add(t))};class H0{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Uu=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Je=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Y0=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Sr()}n.push(t)},Cr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Si(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Si((n+r)/2)}throw Sr()},Fu=(e,t)=>{const n=e.clients.get(t.client);return n[Cr(n,t.clock)]},Pu=(e,t,n)=>{const r=Cr(t,n),i=t[r];return i.id.clock<n&&i instanceof ze?(t.splice(r+1,0,cc(e,i,n-i.id.clock)),r+1):r},Ni=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Pu(e,n,t.clock)]},V0=(e,t,n)=>{const r=t.clients.get(n.client),i=Cr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Xn&&r.splice(i+1,0,cc(e,s,n.clock-s.id.clock+1)),s},Ck=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Cr(r,t.id.clock)]=n},X0=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Pu(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Pu(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class Lk{constructor(t,n,r){this.doc=t,this.deleteSet=new No,this.beforeState=Uu(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const q0=(e,t)=>t.deleteSet.clients.size===0&&!ZE(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Ou(t.deleteSet),Tk(e,t),Ms(e,t.deleteSet),!0),J0=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&vi(e.changed,t,Ss).add(n)},qa=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},Mk=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=Cr(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof ze&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Uk=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=t0(i.length-1,1+Cr(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+qa(i,c)}})},Z0=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Ou(s),n.afterState=Uu(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),G0(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),vu(a,[]),n._needFormattingCleanup&&ex(n)}finally{r.gc&&Mk(s,i,r.gcFilter),Uk(s,i),n.afterState.forEach((l,h)=>{const f=n.beforeState.get(h)||0;if(f!==l){const d=i.clients.get(h),p=Xi(Cr(d,f),1);for(let m=d.length-1;m>=p;)m-=1+qa(d,m)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:f}=o[l].id,d=i.clients.get(h),p=Cr(d,f);p+1<d.length&&qa(d,p+1)>1||p>0&&qa(d,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(hk(Ru,S0,"[yjs] ",R0,I0,"Changed the client-id because another client seems to be using it."),r.clientID=F0()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new Oo;q0(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new Zi;q0(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Z0(e,t+1)}}},ue=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new Lk(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Z0(i,0)}}return o};function*Fk(e){const t=Wt(e.restDecoder);for(let n=0;n<t;n++){const r=Wt(e.restDecoder),i=e.readClient();let s=Wt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Wt(e.restDecoder);yield new qn(qt(i,s),c),s+=c}else if(Da&a){const c=(a&(ei|Un))===0,u=new ze(qt(i,s),null,(a&Un)===Un?e.readLeftID():null,null,(a&ei)===ei?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&xo)===xo?e.readString():null,Ep(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new Xn(qt(i,s),c),s+=c}}}}class Bu{constructor(t,n){this.gen=Fk(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===qn);return this.curr}}class Du{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Pk=e=>Ja(e,B0,Oo),Bk=(e,t)=>{if(e.constructor===Xn){const{client:n,clock:r}=e.id;return new Xn(qt(n,r+t),e.length-t)}else if(e.constructor===qn){const{client:n,clock:r}=e.id;return new qn(qt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new ze(qt(r,i+t),null,qt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Ja=(e,t=Fs,n=Zi)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(Is(l)));let i=r.map(l=>new Bu(l,!0)),s=null;const o=new n,a=new Du(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===qn?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Oi(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===qn)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Oi(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new qn(qt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===qn?s.struct.length-=p:f=Bk(f,p)),s.struct.mergeWith(f)||(Oi(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==qn;f=l.next())Oi(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Oi(a,s.struct,s.offset),s=null),$u(a);const c=r.map(l=>Cu(l)),u=mk(c);return Ms(o,u),o.toUint8Array()},Dk=(e,t,n=Fs,r=Zi)=>{const i=j0(t),s=new r,o=new Du(s),a=new n(Is(e)),c=new Bu(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===qn){c.next();continue}if(l.id.clock+l.length>f)for(Oi(o,l,Xi(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Oi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}$u(o);const u=Cu(a);return Ms(s,u),s.toUint8Array()},Q0=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Ar(e.encoder.restEncoder)}),e.encoder.restEncoder=$a(),e.written=0)},Oi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Q0(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),re(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},$u=e=>{Q0(e);const t=e.encoder.restEncoder;re(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];re(t,r.written),ja(t,r.restEncoder)}},$k=(e,t,n,r)=>{const i=new n(Is(e)),s=new Bu(i,!1),o=new r,a=new Du(o);for(let u=s.curr;u!==null;u=s.next())Oi(a,t(u),0);$u(a);const c=Cu(i);return Ms(o,c),o.toUint8Array()},jk=e=>$k(e,qw,Fs,Oo),tp="You must not compute changes after the event-handler fired.";class Za{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=zk(this.currentTarget,this.target))}deletes(t){return M0(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ri(tp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=uu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=uu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=uu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ri(tp);const n=this.target,r=Ss(),i=Ss(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const zk=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},an=()=>{fk("Invalid access: Add Yjs type to a document before reading data.")},ep=80;let ju=0;class Wk{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=ju++}}const Kk=e=>{e.timestamp=ju++},np=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=ju++},Gk=(e,t,n)=>{if(e.length>=ep){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return np(r,t,n),r}else{const r=new Wk(t,n);return e.push(r),r}},Qa=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Ba(t-s.index)<Ba(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Kk(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Ba(n.index-i)<r.parent.length/ep?(np(n,r,i),n):Gk(e._searchMarker,r,i)},Co=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Xi(t,i.index+n))}},tc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;vi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;G0(r._eH,n,t)};class en{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=z0(),this._dEH=z0(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw vr()}clone(){throw vr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){W0(this._eH,t)}observeDeep(t){W0(this._dEH,t)}unobserve(t){K0(this._eH,t)}unobserveDeep(t){K0(this._dEH,t)}toJSON(){}}const rp=(e,t,n)=>{e.doc??an(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},ip=e=>{e.doc??an();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Lo=(e,t)=>{let n=0,r=e._start;for(e.doc??an();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},sp=(e,t)=>{const n=[];return Lo(e,(r,i)=>{n.push(t(r,i,e))}),n},Hk=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},op=(e,t)=>{e.doc??an();const n=Qa(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},ec=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new es(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Mo(new Uint8Array(h))),i.integrate(e,0);break;case Us:i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Fo(h)),i.integrate(e,0);break;default:if(h instanceof en)i=new ze(qt(o,Je(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ai(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},ap=()=>Ri("Length exceeded!"),cp=(e,t,n,r)=>{if(n>t._length)throw ap();if(n===0)return t._searchMarker&&Co(t._searchMarker,n,r.length),ec(e,t,null,r);const i=n,s=Qa(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ni(e,qt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Co(t._searchMarker,i,r.length),ec(e,t,o,r)},Yk=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return ec(e,t,i,n)},lp=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=Qa(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ni(e,qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ni(e,qt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw ap();t._searchMarker&&Co(t._searchMarker,i,-s+r)},nc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},zu=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new es([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new es([r]);break;case Uint8Array:a=new Mo(r);break;case Us:a=new Fo(r);break;default:if(r instanceof en)a=new ai(r);else throw new Error("Unexpected content type")}new ze(qt(o,Je(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Wu=(e,t)=>{e.doc??an();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},up=e=>{const t={};return e.doc??an(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},hp=(e,t)=>{e.doc??an();const n=e._map.get(t);return n!==void 0&&!n.deleted},Vk=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Bs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},rc=e=>(e.doc??an(),dk(e._map.entries(),t=>!t[1].deleted));class Xk extends Za{}class Ds extends en{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Ds;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ds}clone(){const t=new Ds;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??an(),this._length}_callObserver(t,n){super._callObserver(t,n),tc(this,t,new Xk(this,t))}insert(t,n){this.doc!==null?ue(this.doc,r=>{cp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?ue(this.doc,n=>{Yk(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{lp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return op(this,t)}toArray(){return ip(this)}slice(t=0,n=this.length){return rp(this,t,n)}toJSON(){return this.map(t=>t instanceof en?t.toJSON():t)}map(t){return sp(this,t)}forEach(t){Lo(this,t)}[Symbol.iterator](){return Hk(this)}_write(t){t.writeTypeRef(Ex)}}const qk=e=>new Ds;class Jk extends Za{constructor(t,n,r){super(t,n),this.keysChanged=r}}class $s extends en{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new $s}clone(){const t=new $s;return this.forEach((n,r)=>{t.set(r,n instanceof en?n.clone():n)}),t}_callObserver(t,n){tc(this,t,new Jk(this,t,n))}toJSON(){this.doc??an();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof en?i.toJSON():i}}),t}get size(){return[...rc(this)].length}keys(){return Iu(rc(this),t=>t[0])}values(){return Iu(rc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Iu(rc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??an(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ue(this.doc,n=>{nc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?ue(this.doc,r=>{zu(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Wu(this,t)}has(t){return hp(this,t)}clear(){this.doc!==null?ue(this.doc,t=>{this.forEach(function(n,r,i){nc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(wx)}}const Zk=e=>new $s,Ci=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Vw(e,t);class Ku{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Sr(),this.right.content.constructor){case je:this.right.deleted||js(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const fp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case je:t.right.deleted||js(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Ni(e,qt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},ic=(e,t,n,r)=>{const i=new Map,s=r?Qa(t,n):null;if(s){const o=new Ku(s.p.left,s.p,s.index,i);return fp(e,o,n-s.index)}else{const o=new Ku(null,t._start,0,i);return fp(e,o,n)}},dp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===je&&Ci(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new ze(qt(s,Je(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new je(a,o));l.integrate(e,0),n.right=l,n.forward()})},js=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},pp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===je&&Ci(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},mp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!Ci(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new ze(qt(s,Je(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new je(a,c)),n.right.integrate(e,0),n.forward()}}return o},Gu=(e,t,n,r,i)=>{n.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=e.doc,o=s.clientID;pp(n,i);const a=mp(e,t,n,i),c=r.constructor===String?new Lr(r):r instanceof en?new ai(r):new ts(r);let{left:u,right:l,index:h}=n;t._searchMarker&&Co(t._searchMarker,n.index,c.getLength()),l=new ze(qt(o,Je(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),dp(e,t,n,a)},gp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;pp(n,i);const a=mp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===je));){if(!n.right.deleted)switch(n.right.content.constructor){case je:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(Ci(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Ni(e,qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ze(qt(o,Je(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Lr(c)),n.right.integrate(e,0),n.forward()}dp(e,t,n,a)},yp=(e,t,n,r,i)=>{let s=t;const o=ur();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===je){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case je:{const{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!t.deleted&&js(i,u);break}}}t=t.right}return a},Qk=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===je){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},tx=e=>{let t=0;return ue(e.doc,n=>{let r=e._start,i=e._start,s=ur();const o=lu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case je:js(o,i.content);break;default:t+=yp(n,r,i,s,o),s=lu(o),r=i;break}i=i.right}}),t},ex=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&X0(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===je&&o.constructor!==Xn&&t.add(o.parent)})}ue(n,r=>{L0(e,e.deleteSet,i=>{if(i instanceof Xn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===je?t.add(s):Qk(r,i)});for(const i of t)tx(i)})},_p=(e,t,n)=>{const r=n,i=lu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case ai:case ts:case Lr:n<t.right.length&&Ni(e,qt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&yp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Co(o._searchMarker,t.index,-r+n),t};class nx extends Za{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];ue(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((p,m)=>{p!==null&&(d.attributes[m]=p)}))),u="";break;case"retain":l>0&&(d={retain:l},Gw(c)||(d.attributes=zw({},c))),l=0;break}d&&n.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case ai:case ts:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case Lr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case je:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(d)??null;Ci(m,p)?p!==null&&o.delete(r):(a==="retain"&&f(),Ci(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const m=i.get(d)??null;Ci(m,p)||(a==="retain"&&f(),c[d]=m)}else if(!o.deleted){s.set(d,p);const m=c[d];m!==void 0&&(Ci(m,p)?m!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),js(i,o.content));break}}o=o.right}for(f();n.length>0;){const d=n[n.length-1];if(d.retain!==void 0&&d.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class oi extends en{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??an(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new oi}clone(){const t=new oi;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new nx(this,t,n);tc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??an();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Lr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?ue(this.doc,r=>{const i=new Ku(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Gu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?gp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&_p(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??an();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let f=!1;s.forEach((p,m)=>{f=!0,h[m]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const l=()=>{for(;c!==null;){if(Bs(c,t)||n!==void 0&&Bs(c,n))switch(c.content.constructor){case Lr:{const h=s.get("ychange");t!==void 0&&!Bs(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Bs(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case ai:case ts:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case je:Bs(c,t)&&(u(),js(s,c.content));break}c=c.right}u()};return t||n?ue(o,h=>{t&&Mu(h,t),n&&Mu(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ic(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Gu(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?ue(i,s=>{const o=ic(s,this,t,!r);Gu(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?ue(r,i=>{_p(i,ic(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?ue(i,s=>{const o=ic(s,this,t,!1);o.right!==null&&gp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{nc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{zu(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Wu(this,t)}getAttributes(){return up(this)}_write(t){t.writeTypeRef(kx)}}const rx=e=>new oi;class Hu{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??an()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===zs||n.constructor===Qi)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Qi extends en{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Qi}clone(){const t=new Qi;return t.insert(0,this.toArray().map(n=>n instanceof en?n.clone():n)),t}get length(){return this.doc??an(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Hu(this,t)}querySelector(t){t=t.toUpperCase();const r=new Hu(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Vi(new Hu(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){tc(this,t,new ox(this,n,t))}toString(){return sp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Lo(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?ue(this.doc,r=>{cp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)ue(this.doc,r=>{const i=t&&t instanceof en?t._item:t;ec(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ri("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?ue(this.doc,r=>{lp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return ip(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return op(this,t)}slice(t=0,n=this.length){return rp(this,t,n)}forEach(t){Lo(this,t)}_write(t){t.writeTypeRef(Tx)}}const ix=e=>new Qi;class zs extends Qi{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new zs(this.nodeName)}clone(){const t=new zs(this.nodeName),n=this.getAttributes();return Kw(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof en?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?ue(this.doc,n=>{nc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?ue(this.doc,r=>{zu(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Wu(this,t)}hasAttribute(t){return hp(this,t)}getAttributes(t){return t?Vk(this,t):up(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Lo(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(xx),t.writeKey(this.nodeName)}}const sx=e=>new zs(e.readKey());class ox extends Za{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class sc extends $s{constructor(t){super(),this.hookName=t}_copy(){return new sc(this.hookName)}clone(){const t=new sc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Ax),t.writeKey(this.hookName)}}const ax=e=>new sc(e.readKey());class oc extends oi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new oc}clone(){const t=new oc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(vx)}}const cx=e=>new oc;class Yu{constructor(t,n){this.id=t,this.length=n}get deleted(){throw vr()}mergeWith(t){return!1}write(t,n,r){throw vr()}integrate(t,n){throw vr()}}const lx=0;class Xn extends Yu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Y0(t.doc.store,this)}write(t,n){t.writeInfo(lx),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Mo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Mo(this.content)}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const ux=e=>new Mo(e.readBuf());class Uo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Uo(this.len)}splice(t){const n=new Uo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Va(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const hx=e=>new Uo(e.readLen()),bp=(e,t)=>new Us({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Fo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Fo(bp(this.doc.guid,this.opts))}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const fx=e=>new Fo(bp(e.readString(),e.readAny()));class ts{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ts(this.embed)}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const dx=e=>new ts(e.readJSON());class je{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new je(this.key,this.value)}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const px=e=>new je(e.readKey(),e.readJSON());class ac{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ac(this.arr)}splice(t){const n=new ac(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const mx=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new ac(n)},gx=Ya("node_env")==="development";class es{constructor(t){this.arr=t,gx&&T0(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new es(this.arr)}splice(t){const n=new es(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const yx=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new es(n)};class Lr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Lr(this.str)}splice(t){const n=new Lr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const _x=e=>new Lr(e.readString()),bx=[qk,Zk,rx,sx,ix,ax,cx],Ex=0,wx=1,kx=2,xx=3,Tx=4,Ax=5,vx=6;class ai{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ai(this.type._copy())}splice(t){throw vr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Sx=e=>new ai(bx[e.readTypeRef()](e)),cc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new ze(qt(r,i+n),t,qt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=qt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class ze extends Yu{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?r0:0}set marker(t){(this.info&fu)>0!==t&&(this.info^=fu)}get marker(){return(this.info&fu)>0}get keep(){return(this.info&n0)>0}set keep(t){this.keep!==t&&(this.info^=n0)}get countable(){return(this.info&r0)>0}get deleted(){return(this.info&hu)>0}set deleted(t){this.deleted!==t&&(this.info^=hu)}markDeleted(){this.info|=hu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Je(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Je(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ps&&this.id.client!==this.parent.client&&this.parent.clock>=Je(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=V0(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ni(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Xn||this.right&&this.right.constructor===Xn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ps){const r=Fu(n,this.parent);r.constructor===Xn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=V0(t,t.doc.store,qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Xa(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Xa(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Fu(t.doc.store,i.origin)))s.has(Fu(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Y0(t.doc.store,this),this.content.integrate(t,this),J0(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Xn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:qt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Xa(t.origin,this.lastId)&&this.right===t&&Xa(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Va(t.deleteSet,this.id.client,this.id.clock,this.length),J0(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Sr();this.content.gc(t),n?Ck(t,this,new Xn(this.id,this.length)):this.content=new Uo(this.length)}write(t,n){const r=n>0?qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Da|(r===null?0:Un)|(i===null?0:ei)|(s===null?0:xo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=Ok(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Ps?(t.writeParentInfo(!1),t.writeLeftID(a)):Sr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const Ep=(e,t)=>Rx[t&Da](e),Rx=[()=>{Sr()},hx,mx,ux,_x,dx,px,Sx,yx,fx,()=>{Sr()}],Ix=10;class qn extends Yu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Sr()}write(t,n){t.writeInfo(Ix),re(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const wp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof vs<"u"?vs:{},kp="__ $YJS$ __";wp[kp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),wp[kp]=!0;let xp=!1;const Bn=new Us;function Tp(e,t,n){const r=Bn.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function Nx(e,t){Tp(e,0,t)}function Vu(e,t){const n=new oi(t);Tp(e,1,n)}function Ox(e,t){Bn.getMap().set(e,t)}function Cx(e,t){const n=Bn.getMap(),r=new oi(t);n.set(e,r)}function Ap(e,t){const n=Bn.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function Lx(e,t){return Ap(e,n=>{Ct(n)&&t(n)})}function vp(e,t){return Ap(e,n=>{n instanceof oi&&t(n.toJSON())})}const ns=Ts("modem",["second"],e=>{if(ns.session(e))switch(e.target){case"second":!xp&&e.data%2===0&&ns.emit(e.player,"modem:join");break;case"join":e.sender!==ns.id()&&ns.reply(e,"joinack",qd(Rk(Bn)));break;case"joinack":e.sender!==ns.id()&&(xp=!0,$0(Bn,Fa(e.data),Bn));break;case"sync":{e.sender!==ns.id()&&x(e.data)&&$0(Bn,Fa(e.data),Bn);break}}});function Sp(e,t){t!==Bn&&ns.emit("","modem:sync",qd(e))}Bn.on("update",Sp),Bn.on("destroy",()=>{Bn.off("update",Sp)});function Mx(e,t){return e%t}function Ux(e,t){return Math.floor(e/t)}function Fx(e,t){return{x:Mx(e,t),y:Ux(e,t)}}function lc(e,t){return e.x+e.y*t}function Rp(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function Ip(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Np="170",Px="",hr="srgb",Op="srgb-linear",Cp="linear",Xu="srgb";function Ws(e,t,n){return Math.max(t,Math.min(n,e))}function Bx(e,t){return(e%t+t)%t}function qu(e,t,n){return(1-n)*e+n*t}class Po{constructor(t=0,n=0){Po.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Ws(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Bo{constructor(t,n,r,i,s,o,a,c,u){Bo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],f=r[2],d=r[5],p=r[8],m=i[0],k=i[3],w=i[6],T=i[1],v=i[4],I=i[7],U=i[2],R=i[5],L=i[8];return s[0]=o*m+a*T+c*U,s[3]=o*k+a*v+c*R,s[6]=o*w+a*I+c*L,s[1]=u*m+l*T+h*U,s[4]=u*k+l*v+h*R,s[7]=u*w+l*I+h*L,s[2]=f*m+d*T+p*U,s[5]=f*k+d*v+p*R,s[8]=f*w+d*I+p*L,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=a*c-l*s,d=u*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*u-l*r)*m,t[2]=(a*r-i*o)*m,t[3]=f*m,t[4]=(l*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=d*m,t[7]=(r*c-u*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(Ju.makeScale(t,n)),this}rotate(t){return this.premultiply(Ju.makeRotation(-t)),this}translate(t,n){return this.premultiply(Ju.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ju=new Bo,Jn={enabled:!0,workingColorSpace:Op,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===Xu&&(e.r=Ks(e.r),e.g=Ks(e.g),e.b=Ks(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Xu&&(e.r=Gs(e.r),e.g=Gs(e.g),e.b=Gs(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Px?Cp:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function Ks(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Gs(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const Lp=[.64,.33,.3,.6,.15,.06],Mp=[.2126,.7152,.0722],Up=[.3127,.329],Fp=new Bo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Pp=new Bo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Jn.define({[Op]:{primaries:Lp,whitePoint:Up,transfer:Cp,toXYZ:Fp,fromXYZ:Pp,luminanceCoefficients:Mp,workingColorSpaceConfig:{unpackColorSpace:hr},outputColorSpaceConfig:{drawingBufferColorSpace:hr}},[hr]:{primaries:Lp,whitePoint:Up,transfer:Xu,toXYZ:Fp,fromXYZ:Pp,luminanceCoefficients:Mp,outputColorSpaceConfig:{drawingBufferColorSpace:hr}}});const Bp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Li={h:0,s:0,l:0},uc={h:0,s:0,l:0};function Zu(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class Qu{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=hr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Jn.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Jn.workingColorSpace){return this.r=t,this.g=n,this.b=r,Jn.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Jn.workingColorSpace){if(t=Bx(t,1),n=Ws(n,0,1),r=Ws(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=Zu(o,s,t+1/3),this.g=Zu(o,s,t),this.b=Zu(o,s,t-1/3)}return Jn.toWorkingColorSpace(this,i),this}setStyle(t,n=hr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=hr){const r=Bp[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ks(t.r),this.g=Ks(t.g),this.b=Ks(t.b),this}copyLinearToSRGB(t){return this.r=Gs(t.r),this.g=Gs(t.g),this.b=Gs(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=hr){return Jn.fromWorkingColorSpace(cn.copy(this),t),Math.round(Ws(cn.r*255,0,255))*65536+Math.round(Ws(cn.g*255,0,255))*256+Math.round(Ws(cn.b*255,0,255))}getHexString(t=hr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Jn.workingColorSpace){Jn.fromWorkingColorSpace(cn.copy(this),n);const r=cn.r,i=cn.g,s=cn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,u;const l=(a+o)/2;if(a===o)c=0,u=0;else{const h=o-a;switch(u=l<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return t.h=c,t.s=u,t.l=l,t}getRGB(t,n=Jn.workingColorSpace){return Jn.fromWorkingColorSpace(cn.copy(this),n),t.r=cn.r,t.g=cn.g,t.b=cn.b,t}getStyle(t=hr){Jn.fromWorkingColorSpace(cn.copy(this),t);const n=cn.r,r=cn.g,i=cn.b;return t!==hr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Li),this.setHSL(Li.h+t,Li.s+n,Li.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Li),t.getHSL(uc);const r=qu(Li.h,uc.h,n),i=qu(Li.s,uc.s,n),s=qu(Li.l,uc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const cn=new Qu;Qu.NAMES=Bp,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Np}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Np),new Po,new Po;function Dn(e,t,n){return Math.max(t,Math.min(n,e))}function th(e){return e*180/Math.PI}const Dx=gd("089fad0j9awfem09wavefc09uwaef");function $x(){return Dx()}function jx(e){return gd(e)()}function fr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor($x()*i)}function Dp(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(jx(e)*s)}function $p(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function zx(e){return e[fr(0,e.length-1)]}function Wx(e,t){return t[Dp(e,0,t.length-1)]}function nn(...e){return zx(e.flat())}function jp(e,...t){return Wx(e,t.flat())}function Kx(e){return[...new Set(e)].filter(x)}var zp={exports:{}},eh={exports:{}},Wp;function Gx(){return Wp||(Wp=1,function(e,t){(function(n,r){e.exports=r()})(En,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(m){if(m)for(var k=0;k<l.length;k++)m[l[k]]!==void 0&&this["set"+r(l[k])](m[l[k]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",k=this.getLineNumber()||"",w=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+k+":"+w+")":"[eval]:"+k+":"+w:T?T+" ("+m+":"+k+":"+w+")":m+":"+k+":"+w}},h.fromString=function(k){var w=k.indexOf("("),T=k.lastIndexOf(")"),v=k.substring(0,w),I=k.substring(w+1,T).split(","),U=k.substring(T+1);if(U.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),L=R[1],B=R[2],O=R[3];return new h({functionName:v,args:I||void 0,fileName:L,lineNumber:B||void 0,columnNumber:O||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=function(m){return function(k){this[m]=!!k}}(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=function(m){return function(k){if(!n(k))throw new TypeError(m+" must be a Number");this[m]=Number(k)}}(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(k){this[m]=String(k)}}(a[p]);return h})}(eh)),eh.exports}(function(e,t){(function(n,r){e.exports=r(Gx())})(En,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,m=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:m,lineNumber:d[1],columnNumber:d[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=l.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],f=2,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],f=0,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;d.match(/\(([^)]*)\)/)&&(m=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var k=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:k,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:l})},this)}}})})(zp);var Hx=zp.exports,Yx=ks(Hx);const nh=14,hc=3,fc=8,dc=14,pc=16,Vx=16,Xx=16;function mc(e,t){return new Array(e).fill(t)}function qx(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:mc(s,0),color:mc(s,0),bg:mc(s,i)}}function Jx(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:zt.ONCLEAR}}function Zx(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Qx(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:mc(s,i)}}function tT(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function eT(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function Kp(e,t){return`${e}:${t}`}const nT=1,rT=16,iT=256;var dn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(dn||{});const Mr=!!JSON.parse("false"),sT=!!JSON.parse("false");JSON.parse("false");const oT=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ci={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return fc*ci.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return dc*ci.DRAW_CHAR_SCALE}},G=Ts("SOFTWARE");function li(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},listcommands(){return Hn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function _e(e){return`${e??""}`}function Do(e,t){const n=parseFloat(_e(e));return isNaN(n)?t:n}function Gp(e,t,n){var i;const[r]=rt(t,0,[H.MAYBE_NAME]);_E(G,e,((i=_.board)==null?void 0:i.id)??"",r??"",n)}function Zn(e,t,n,r){const[i,s]=rt(r,0,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);Nd(G,e,t,n,i,s)}const aT=["echo","reverb","phaser","distortion","vibrato","fc"];function Hp(e,t,n){const[r,i]=rt(n,0,[H.NUMBER_OR_STRING]);if(Ct(r))Zl(G,e,t,"volume",r);else if(aT.includes(Ot(r))){const[s,o]=rt(n,i,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);Nd(G,e,t,r,s,o)}else{const[s]=rt(n,i,[H.MAYBE_NUMBER_OR_STRING]);if(Ct(s)){const o=n.length-i,a=new Array(o).fill(H.NUMBER),c=rt(n,i,a).slice(0,o),u=c.length===1?c[0]:c;Zl(G,e,t,r,u)}else{const[o]=rt(n,i,[H.MAYBE_NUMBER_OR_STRING]);Zl(G,e,t,r,o)}}}const rh=li().command("talk",(e,t)=>{const[n]=rt(t,0,[H.ANY]);switch(Ot(n)){default:Q1(G,_.elementfocus);break;case"stop":tE(G,_.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=rt(t,0,[H.ANY]);switch(Ot(n)){default:eE(G,_.elementfocus);break;case"stop":nE(G,_.elementfocus);break}return 0}).command("tts",(e,t)=>{const[n,r]=rt(t,0,[H.STRING]),i=t.slice(r).map(_e).join("");return gE(G,_.elementfocus,n,i),0}).command("tta",(e,t)=>{const n=t.map(_e).join("");return yE(G,_.elementfocus,n),0}).command("bpm",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return EE(G,_.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return wE(G,_.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return kE(G,_.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return xE(G,_.elementfocus,n),0}).command("play",(e,t)=>(Gp(_.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(Gp(_.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)Hp(_.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Zn(_.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Zn(_.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Zn(_.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Zn(_.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Zn(_.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Zn(_.elementfocus,n,"vibrato",t);return 0});for(let e=0;e<8;++e)rh.command(`synth${e+1}`,(t,n)=>(Hp(_.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;rh.command(`echo${t}`,(n,r)=>(Zn(_.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Zn(_.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Zn(_.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Zn(_.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Zn(_.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Zn(_.elementfocus,e,"vibrato",r),0))}function cT(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var lT=cT;const uT=lT,Jt=function(){};Jt.prototype.FMX=0,Jt.prototype.FMY=0,Jt.prototype.FMXxFMY=0,Jt.prototype.T=0,Jt.prototype.N=0,Jt.prototype.initiliazedField=!1,Jt.prototype.generationComplete=!1,Jt.prototype.wave=null,Jt.prototype.compatible=null,Jt.prototype.weightLogWeights=null,Jt.prototype.sumOfWeights=0,Jt.prototype.sumOfWeightLogWeights=0,Jt.prototype.startingEntropy=0,Jt.prototype.sumsOfOnes=null,Jt.prototype.sumsOfWeights=null,Jt.prototype.sumsOfWeightLogWeights=null,Jt.prototype.entropies=null,Jt.prototype.propagator=null,Jt.prototype.observed=null,Jt.prototype.distribution=null,Jt.prototype.stack=null,Jt.prototype.stackSize=0,Jt.prototype.DX=[-1,0,1,0],Jt.prototype.DY=[0,1,0,-1],Jt.prototype.opposite=[2,3,0,1],Jt.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},Jt.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=uT(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},Jt.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const u=a+c*this.FMX,l=this.propagator[i][e[1]],h=this.compatible[u];for(let f=0;f<l.length;f++){const d=l[f],p=h[d];p[i]--,p[i]==0&&this.ban(u,d)}}}},Jt.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},Jt.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},Jt.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},Jt.prototype.isGenerationComplete=function(){return this.generationComplete},Jt.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},Jt.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Yp=Jt;const Vp=Yp,ui=function(t,n,r,i,s,o,a,c,u,l){l=l||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=n,f=new Array(h);for(let O=0;O<h;O++)f[O]=new Array(r);this.colors=[];const d={};for(let O=0;O<r;O++)for(let Y=0;Y<n;Y++){const et=(O*n+Y)*4,C=[t[et],t[et+1],t[et+2],t[et+3]],S=C.join("-");d.hasOwnProperty(S)||(d[S]=this.colors.length,this.colors.push(C)),f[Y][O]=d[S]}const p=this.colors.length,m=Math.pow(p,i*i),k=function(Y){let et=new Array(i*i);for(let C=0;C<i;C++)for(let S=0;S<i;S++)et[S+C*i]=Y(S,C);return et},w=function(Y,et){return k(function(C,S){return f[(Y+C)%n][(et+S)%r]})},T=function(Y){return k(function(et,C){return Y[i-1-C+et*i]})},v=function(Y){return k(function(et,C){return Y[i-1-et+C*i]})},I=function(Y){let et=0,C=1;for(let S=0;S<Y.length;S++)et+=Y[Y.length-1-S]*C,C*=p;return et},U=function(Y){let et=Y,C=m;const S=new Array(i*i);for(let b=0;b<S.length;b++){C/=p;let P=0;for(;et>=C;)et-=C,P++;S[b]=P}return S},R={},L=[];for(let O=0;O<(a?r:r-i+1);O++)for(let Y=0;Y<(a?n:n-i+1);Y++){const et=new Array(8);et[0]=w(Y,O),et[1]=v(et[0]),et[2]=T(et[0]),et[3]=v(et[2]),et[4]=T(et[2]),et[5]=v(et[4]),et[6]=T(et[4]),et[7]=v(et[6]);for(let C=0;C<u;C++){const S=I(et[C]);R[S]?R[S]++:(L.push(S),R[S]=1)}}this.T=L.length,this.ground=(l+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let O=0;O<this.T;O++){const Y=parseInt(L[O],10);this.patterns[O]=U(Y),this.weights[O]=R[Y]}const B=function(Y,et,C,S){const b=C<0?0:C,P=C<0?C+i:i,X=S<0?0:S,D=S<0?S+i:i;for(let ct=X;ct<D;ct++)for(let tt=b;tt<P;tt++)if(Y[tt+i*ct]!=et[tt-C+i*(ct-S)])return!1;return!0};this.propagator=new Array(4);for(let O=0;O<4;O++){this.propagator[O]=new Array(this.T);for(let Y=0;Y<this.T;Y++){const et=[];for(let C=0;C<this.T;C++)B(this.patterns[Y],this.patterns[C],this.DX[O],this.DY[O])&&et.push(C);this.propagator[O][Y]=et}}};ui.prototype=Object.create(Vp.prototype),ui.prototype.constructor=ui,ui.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},ui.prototype.clear=function(){if(Vp.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},ui.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},ui.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},ui.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let l=0;l<this.N;l++)for(let h=0;h<this.N;h++){let f=n-h;f<0&&(f+=this.FMX);let d=r-l;if(d<0&&(d+=this.FMY),this.onBoundary(f,d))continue;const p=f+d*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const k=this.colors[this.patterns[m][h+l*this.N]];s+=k[0],o+=k[1],a+=k[2],c+=k[3]}}const u=t*4;e[u]=s/i,e[u+1]=o/i,e[u+2]=a/i,e[u+3]=c/i}};var hT=ui;const fT=Yp,Mi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const u=function(I){const U=new Array(o*o);for(let R=0;R<o;R++)for(let L=0;L<o;L++)U[L+R*o]=I(L,R);return U},l=function(I){return u(function(U,R){return I[o-1-R+U*o]})},h=function(I){return u(function(U,R){return I[o-1-U+R*o]})};this.tiles=[];const f=[],d=[],p={};let m,k,w;for(let v=0;v<t.tiles.length;v++){const I=t.tiles[v];if(c!==null&&c.indexOf(I.name)===-1)continue;switch(I.symmetry){case"L":w=4,m=function(R){return(R+1)%4},k=function(R){return R%2===0?R+1:R-1};break;case"T":w=4,m=function(R){return(R+1)%4},k=function(R){return R%2===0?R:4-R};break;case"I":w=2,m=function(R){return 1-R},k=function(R){return R};break;case"\\":w=2,m=function(R){return 1-R},k=function(R){return 1-R};break;case"F":w=8,m=function(R){return R<4?(R+1)%4:4+(R-1)%4},k=function(R){return R<4?R+4:R-4};break;default:w=1,m=function(R){return R},k=function(R){return R};break}this.T=d.length,p[I.name]=this.T;for(let R=0;R<w;R++)d.push([this.T+R,this.T+m(R),this.T+m(m(R)),this.T+m(m(m(R))),this.T+k(R),this.T+k(m(R)),this.T+k(m(m(R))),this.T+k(m(m(m(R))))]);let U;if(a)for(let R=0;R<w;R++)U=I.bitmap[R],this.tiles.push(u(function(L,B){return[U[(o*B+L)*4],U[(o*B+L)*4+1],U[(o*B+L)*4+2],U[(o*B+L)*4+3]]}));else{U=I.bitmap,this.tiles.push(u(function(R,L){return[U[(o*L+R)*4],U[(o*L+R)*4+1],U[(o*L+R)*4+2],U[(o*L+R)*4+3]]}));for(let R=1;R<w;R++)this.tiles.push(R<4?l(this.tiles[this.T+R-1]):h(this.tiles[this.T+R-4]))}for(let R=0;R<w;R++)f.push(I.weight||1)}this.T=d.length,this.weights=f,this.propagator=new Array(4);const T=new Array(4);for(let v=0;v<4;v++){this.propagator[v]=new Array(this.T),T[v]=new Array(this.T);for(let I=0;I<this.T;I++){T[v][I]=new Array(this.T);for(let U=0;U<this.T;U++)T[v][I][U]=!1}}for(let v=0;v<t.neighbors.length;v++){const I=t.neighbors[v],U=I.left.split(" ").filter(function(et){return et.length}),R=I.right.split(" ").filter(function(et){return et.length});if(c!==null&&(c.indexOf(U[0])===-1||c.indexOf(R[0])===-1))continue;const L=d[p[U[0]]][U.length==1?0:parseInt(U[1],10)],B=d[L][1],O=d[p[R[0]]][R.length==1?0:parseInt(R[1],10)],Y=d[O][1];T[0][O][L]=!0,T[0][d[O][6]][d[L][6]]=!0,T[0][d[L][4]][d[O][4]]=!0,T[0][d[L][2]][d[O][2]]=!0,T[1][Y][B]=!0,T[1][d[B][6]][d[Y][6]]=!0,T[1][d[Y][4]][d[B][4]]=!0,T[1][d[B][2]][d[Y][2]]=!0}for(let v=0;v<this.T;v++)for(let I=0;I<this.T;I++)T[2][v][I]=T[0][I][v],T[3][v][I]=T[1][I][v];for(let v=0;v<4;v++)for(let I=0;I<this.T;I++){const U=[],R=T[v][I];for(let L=0;L<this.T;L++)R[L]&&U.push(L);this.propagator[v][I]=U}};Mi.prototype=Object.create(fT.prototype),Mi.prototype.constructor=Mi,Mi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Mi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Mi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Mi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let u=0;u<this.tilesize;u++){const l=(n*this.tilesize+u+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];else{let h=0,f=0,d=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const k=this.tiles[m][u+c*this.tilesize],w=this.weights[m]*a;h+=k[0]*w,f+=k[1]*w,d+=k[2]*w,p+=k[3]*w}e[l]=h,e[l+1]=f,e[l+2]=d,e[l+3]=p}}}};var dT=Mi,pT={OverlappingModel:hT,SimpleTiledModel:dT},mT=ks(pT);function gT(e){return x(e)&&e<zt.ONBLACK?e:void 0}function yT(e){return x(e)&&e>zt.WHITE&&e<zt.ONCLEAR?e-zt.ONBLACK:void 0}const $o={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function $n(e){return ne(e)&&qp(e[0])}function Xp(e){return $n(e)&&e[0].startsWith("ON")}function qp(e){return x(zt[e])&&At(e)}function Jp(e){if(At(e))return $o[Ot(e)]}function _T(e){return e.map(t=>zt[t]).find(t=>x(t)&&t<zt.ONBLACK)}function bT(e){return e.map(t=>zt[t]).find(t=>x(t)&&t>=zt.ONBLACK)}function ET(e){if($n(e))return e;if(qp(e))return[e];const t=Jp(e);if(x(t))return[t]}function Zp(e){const t=_.words[e],n=ET(t);return $n(n)?[n,e+1]:[void 0,e]}function gc(e){const t=[];let n=e;const[r,i]=Zp(e);if($n(r)&&(t.push(...r),n=i),$n(t)&&!Xp(t)){const[s,o]=Zp(i);Xp(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function Qp(e){const t={};return e.every(n=>{const r=zt[n];x(r)&&(r<zt.ONBLACK?t.color=r:t.bg=r-zt.ONBLACK)}),t}function Hs(e){return ne(e)&&typeof e[0]=="string"}function wT(e){const t=_.words[e];return At(t)?[t,e+1]:[void 0,e]}function tm(e){const t=_.words[e];if(Hs(t))return[t,e+1];const[n,r]=gc(e),[i,s]=wT(r);return At(i)?[[i,n],s]:[void 0,e]}function ih(e){if(!Hs(e))return;const[t]=e;return t}function em(e){if(!Hs(e))return;const[,t]=e,n=x(t)?_T(t):void 0;return x(n)?n:void 0}function nm(e){if(!Hs(e))return;const[,t]=e,n=x(t)?bT(t):void 0;return x(n)?n:void 0}const Yt=60,Ee=25,kT=Yt*Ee;var bt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(bt||{});function sh(e,t){const n=e??Gt.ISWALK,r=t??Gt.ISWALK;switch(n){case Gt.ISWALK:return r!==Gt.ISWALK;case Gt.ISSWIM:return r!==Gt.ISSWIM;case Gt.ISSOLID:return!0;case Gt.ISBULLET:return r!==Gt.ISWALK&&r!==Gt.ISSWIM}}function yc(e,t,n){const r=e==null?void 0:e.objects[n];if(x(r))return r;if(x(t)){const i=jo(e,"player"),s={x:t.x??0,y:t.y??0};sm(s,i)}}function jo(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(x)}function xT(e){const t=[];for(let n=0;n<Ee;++n)for(let r=0;r<Yt;++r){const i={x:r,y:n},s=On(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function rm(e,t){const n=ih(t),r=em(t),i=nm(t);return jo(e,n??"").filter(s=>{var o,a,c;return!(x(n)&&Ot((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||x(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??zt.WHITE)!==r||x(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??zt.BLACK)!==i)}).filter(x)}function im(e,t){return x(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(x(i))return i;const s=jo(e,Ot(n));if(s.length)return s}else if(ka(n)&&n.x>=0&&n.x<Yt&&n.y>=0&&n.y<Ee){const i=n.x+n.y*Yt,s=(r=e.lookup)==null?void 0:r[i];return x(s)?e.objects[s]:e.terrain[i]}}).flat().filter(x):[]}function sm(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var oh;try{oh=new TextDecoder}catch{}var mt,Qn,j=0,he={},Zt,Ui,tr=0,Ur=0,Ze,hi,kn=[],Vt,om={useRecords:!1,mapsAsObjects:!0};class am{}const cm=new am;cm.name="MessagePack 0xC1";var Fi=!1,lm=2,um;try{new Function("")}catch{lm=1/0}class zo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(mt)return xm(()=>(hh(),this?this.unpack(t,n):zo.prototype.unpack.call(om,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof tn<"u"?tn.from(t):new Uint8Array(t)),typeof n=="object"?(Qn=n.end||t.length,j=n.start||0):(j=0,Qn=n>-1?n:t.length),Ur=0,Ui=null,Ze=null,mt=t;try{Vt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw mt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof zo){if(he=this,this.structures)return Zt=this.structures,_c(n);(!Zt||Zt.length>0)&&(Zt=[])}else he=om,(!Zt||Zt.length>0)&&(Zt=[]);return _c(n)}unpackMultiple(t,n){let r,i=0;try{Fi=!0;let s=t.length,o=this?this.unpack(t,s):bc.unpack(t,s);if(n){if(n(o,i,j)===!1)return;for(;j<s;)if(i=j,n(_c(),i,j)===!1)return}else{for(r=[o];j<s;)i=j,r.push(_c());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Fi=!1,hh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function _c(e){try{if(!he.trusted&&!Fi){let n=Zt.sharedLength||0;n<Zt.length&&(Zt.length=n)}let t;if(he.randomAccessStructure&&mt[j]<64&&mt[j]>=32&&um?(t=um(mt,j,Qn,he),mt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),j=Qn):t=Ce(),Ze&&(j=Ze.postBundlePosition,Ze=null),Fi&&(Zt.restoreStructures=null),j==Qn)Zt&&Zt.restoreStructures&&hm(),Zt=null,mt=null,hi&&(hi=null);else{if(j>Qn)throw new Error("Unexpected end of MessagePack data");if(!Fi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Zt&&Zt.restoreStructures&&hm(),hh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||j>Qn)&&(t.incomplete=!0),t}}function hm(){for(let e in Zt.restoreStructures)Zt[e]=Zt.restoreStructures[e];Zt.restoreStructures=null}function Ce(){let e=mt[j++];if(e<160)if(e<128){if(e<64)return e;{let t=Zt[e&63]||he.getStructures&&dm()[e&63];return t?(t.read||(t.read=ah(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=bm();r==="__proto__"&&(r="__proto_"),t[r]=Ce()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ce(),Ce());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ce();return he.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Ur>=j)return Ui.slice(j-tr,(j+=t)-tr);if(Ur==0&&Qn<140){let n=t<16?lh(t):gm(t);if(n!=null)return n}return ch(t)}else{let t;switch(e){case 192:return null;case 193:return Ze?(t=Ce(),t>0?Ze[1].slice(Ze.position1,Ze.position1+=t):Ze[0].slice(Ze.position0,Ze.position0-=t)):cm;case 194:return!1;case 195:return!0;case 196:if(t=mt[j++],t===void 0)throw new Error("Unexpected end of buffer");return uh(t);case 197:return t=Vt.getUint16(j),j+=2,uh(t);case 198:return t=Vt.getUint32(j),j+=4,uh(t);case 199:return rs(mt[j++]);case 200:return t=Vt.getUint16(j),j+=2,rs(t);case 201:return t=Vt.getUint32(j),j+=4,rs(t);case 202:if(t=Vt.getFloat32(j),he.useFloat32>2){let n=fh[(mt[j]&127)<<1|mt[j+1]>>7];return j+=4,(n*t+(t>0?.5:-.5)>>0)/n}return j+=4,t;case 203:return t=Vt.getFloat64(j),j+=8,t;case 204:return mt[j++];case 205:return t=Vt.getUint16(j),j+=2,t;case 206:return t=Vt.getUint32(j),j+=4,t;case 207:return he.int64AsType==="number"?(t=Vt.getUint32(j)*4294967296,t+=Vt.getUint32(j+4)):he.int64AsType==="string"?t=Vt.getBigUint64(j).toString():he.int64AsType==="auto"?(t=Vt.getBigUint64(j),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigUint64(j),j+=8,t;case 208:return Vt.getInt8(j++);case 209:return t=Vt.getInt16(j),j+=2,t;case 210:return t=Vt.getInt32(j),j+=4,t;case 211:return he.int64AsType==="number"?(t=Vt.getInt32(j)*4294967296,t+=Vt.getUint32(j+4)):he.int64AsType==="string"?t=Vt.getBigInt64(j).toString():he.int64AsType==="auto"?(t=Vt.getBigInt64(j),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Vt.getBigInt64(j),j+=8,t;case 212:if(t=mt[j++],t==114)return wm(mt[j++]&63);{let n=kn[t];if(n)return n.read?(j++,n.read(Ce())):n.noBuffer?(j++,n()):n(mt.subarray(j,++j));throw new Error("Unknown extension "+t)}case 213:return t=mt[j],t==114?(j++,wm(mt[j++]&63,mt[j++])):rs(2);case 214:return rs(4);case 215:return rs(8);case 216:return rs(16);case 217:return t=mt[j++],Ur>=j?Ui.slice(j-tr,(j+=t)-tr):AT(t);case 218:return t=Vt.getUint16(j),j+=2,Ur>=j?Ui.slice(j-tr,(j+=t)-tr):vT(t);case 219:return t=Vt.getUint32(j),j+=4,Ur>=j?Ui.slice(j-tr,(j+=t)-tr):ST(t);case 220:return t=Vt.getUint16(j),j+=2,pm(t);case 221:return t=Vt.getUint32(j),j+=4,pm(t);case 222:return t=Vt.getUint16(j),j+=2,mm(t);case 223:return t=Vt.getUint32(j),j+=4,mm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const TT=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function ah(e,t){function n(){if(n.count++>lm){let i=e.read=new Function("r","return function(){return "+(he.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":TT.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ce);return e.highByte===0&&(e.read=fm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Ce()}return he.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?fm(t,n):n}const fm=(e,t)=>function(){let n=mt[j++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Zt[r]||dm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=ah(i,e)),i.read()};function dm(){let e=xm(()=>(mt=null,he.getStructures()));return Zt=he._mergeStructures(e,Zt)}var ch=Wo,AT=Wo,vT=Wo,ST=Wo;function Wo(e){let t;if(e<16&&(t=lh(e)))return t;if(e>64&&oh)return oh.decode(mt.subarray(j,j+=e));const n=j+e,r=[];for(t="";j<n;){const i=mt[j++];if(!(i&128))r.push(i);else if((i&224)===192){const s=mt[j++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=mt[j++]&63,o=mt[j++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=mt[j++]&63,o=mt[j++]&63,a=mt[j++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Qe.apply(String,r),r.length=0)}return r.length>0&&(t+=Qe.apply(String,r)),t}function pm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Ce();return he.freezeData?Object.freeze(t):t}function mm(e){if(he.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=bm();r==="__proto__"&&(r="__proto_"),t[r]=Ce()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Ce(),Ce());return t}}var Qe=String.fromCharCode;function gm(e){let t=j,n=new Array(e);for(let r=0;r<e;r++){const i=mt[j++];if((i&128)>0){j=t;return}n[r]=i}return Qe.apply(String,n)}function lh(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[j++];if((t&128)>1){j-=1;return}return Qe(t)}}else{let t=mt[j++],n=mt[j++];if((t&128)>0||(n&128)>0){j-=2;return}if(e<3)return Qe(t,n);let r=mt[j++];if((r&128)>0){j-=3;return}return Qe(t,n,r)}else{let t=mt[j++],n=mt[j++],r=mt[j++],i=mt[j++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){j-=4;return}if(e<6){if(e===4)return Qe(t,n,r,i);{let s=mt[j++];if((s&128)>0){j-=5;return}return Qe(t,n,r,i,s)}}else if(e<8){let s=mt[j++],o=mt[j++];if((s&128)>0||(o&128)>0){j-=6;return}if(e<7)return Qe(t,n,r,i,s,o);let a=mt[j++];if((a&128)>0){j-=7;return}return Qe(t,n,r,i,s,o,a)}else{let s=mt[j++],o=mt[j++],a=mt[j++],c=mt[j++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){j-=8;return}if(e<10){if(e===8)return Qe(t,n,r,i,s,o,a,c);{let u=mt[j++];if((u&128)>0){j-=9;return}return Qe(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=mt[j++],l=mt[j++];if((u&128)>0||(l&128)>0){j-=10;return}if(e<11)return Qe(t,n,r,i,s,o,a,c,u,l);let h=mt[j++];if((h&128)>0){j-=11;return}return Qe(t,n,r,i,s,o,a,c,u,l,h)}else{let u=mt[j++],l=mt[j++],h=mt[j++],f=mt[j++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){j-=12;return}if(e<14){if(e===12)return Qe(t,n,r,i,s,o,a,c,u,l,h,f);{let d=mt[j++];if((d&128)>0){j-=13;return}return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=mt[j++],p=mt[j++];if((d&128)>0||(p&128)>0){j-=14;return}if(e<15)return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d,p);let m=mt[j++];if((m&128)>0){j-=15;return}return Qe(t,n,r,i,s,o,a,c,u,l,h,f,d,p,m)}}}}}function ym(){let e=mt[j++],t;if(e<192)t=e-160;else switch(e){case 217:t=mt[j++];break;case 218:t=Vt.getUint16(j),j+=2;break;case 219:t=Vt.getUint32(j),j+=4;break;default:throw new Error("Expected string")}return Wo(t)}function uh(e){return he.copyBuffers?Uint8Array.prototype.slice.call(mt,j,j+=e):mt.subarray(j,j+=e)}function rs(e){let t=mt[j++];if(kn[t]){let n;return kn[t](mt.subarray(j,n=j+=e),r=>{j=r;try{return Ce()}finally{j=n}})}else throw new Error("Unknown extension type "+t)}var _m=new Array(4096);function bm(){let e=mt[j++];if(e>=160&&e<192){if(e=e-160,Ur>=j)return Ui.slice(j-tr,(j+=e)-tr);if(!(Ur==0&&Qn<180))return ch(e)}else return j--,Em(Ce());let t=(e<<5^(e>1?Vt.getUint16(j):e>0?mt[j]:0))&4095,n=_m[t],r=j,i=j+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Vt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=mt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return j=r,n.string;i-=3,r=j}for(n=[],_m[t]=n,n.bytes=e;r<i;)s=Vt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=mt[r++],n.push(s);let a=e<16?lh(e):gm(e);return a!=null?n.string=a:n.string=ch(e)}function Em(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const wm=(e,t)=>{let n=Ce().map(Em),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Zt[e];return i&&(i.isShared||Fi)&&((Zt.restoreStructures||(Zt.restoreStructures=[]))[e]=i),Zt[e]=n,n.read=ah(n,r),n.read()};kn[0]=()=>{},kn[0].noBuffer=!0,kn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let RT={Error,TypeError,ReferenceError};kn[101]=()=>{let e=Ce();return(RT[e[0]]||Error)(e[1],{cause:e[2]})},kn[105]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4);hi||(hi=new Map);let n=mt[j],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};hi.set(t,i);let s=Ce();return i.used?Object.assign(r,s):(i.target=s,s)},kn[112]=e=>{if(he.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Vt.getUint32(j-4),n=hi.get(t);return n.used=!0,n.target},kn[115]=()=>new Set(Ce());const km=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let IT=typeof globalThis=="object"?globalThis:window;kn[116]=e=>{let t=e[0],n=km[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new IT[n](Uint8Array.prototype.slice.call(e,1).buffer)},kn[120]=()=>{let e=Ce();return new RegExp(e[0],e[1])};const NT=[];kn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=j;return j+=t-e.length,Ze=NT,Ze=[ym(),ym()],Ze.position0=0,Ze.position1=0,Ze.postBundlePosition=j,j=n,Ce()},kn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function xm(e){let t=Qn,n=j,r=tr,i=Ur,s=Ui,o=hi,a=Ze,c=new Uint8Array(mt.slice(0,Qn)),u=Zt,l=Zt.slice(0,Zt.length),h=he,f=Fi,d=e();return Qn=t,j=n,tr=r,Ur=i,Ui=s,hi=o,Ze=a,mt=c,Fi=f,Zt=u,Zt.splice(0,Zt.length,...l),he=h,Vt=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),d}function hh(){mt=null,hi=null,Zt=null}const fh=new Array(147);for(let e=0;e<256;e++)fh[e]=+("1e"+Math.floor(45.15-e*.30103));var bc=new zo({useRecords:!1});const OT=bc.unpack;bc.unpackMultiple,bc.unpack;let CT=new Float32Array(1);new Uint8Array(CT.buffer,0,4);let Ec;try{Ec=new TextEncoder}catch{}let dh,Tm;const wc=typeof tn<"u",kc=wc?function(e){return tn.allocUnsafeSlow(e)}:Uint8Array,Am=wc?tn:Uint8Array,vm=wc?4294967296:2144337920;let J,Ko,fe,W=0,pn,Te=null,LT;const MT=21760,UT=/[\u0080-\uFFFF]/,Ys=Symbol("record-id");class FT extends zo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=Am.prototype.utf8Write?function(S,b){return J.utf8Write(S,b,J.byteLength-b)}:Ec&&Ec.encodeInto?function(S,b){return Ec.encodeInto(S,J.subarray(b)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=l>32||h+l>64,d=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],k=0,w=0;this.pack=this.encode=function(S,b){if(J||(J=new kc(8192),fe=J.dataView||(J.dataView=new DataView(J.buffer,0,8192)),W=0),pn=J.length-10,pn-W<2048?(J=new kc(J.length),fe=J.dataView||(J.dataView=new DataView(J.buffer,0,J.length)),pn=J.length-10,W=0):W=W+7&2147483640,n=W,b&WT&&(W+=b&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof S!="string"?(Te=[],Te.size=1/0):Te=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let X=i.sharedLength||0;if(X>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let D=0;D<X;D++){let ct=i[D];if(!ct)continue;let tt,ft=i.transitions;for(let V=0,z=ct.length;V<z;V++){let Et=ct[V];tt=ft[Et],tt||(tt=ft[Et]=Object.create(null)),ft=tt}ft[Ys]=D+64}this.lastNamedStructuresLength=X}c||(i.nextId=X+64)}r&&(r=!1);let P;try{a.randomAccessStructure&&S&&S.constructor&&S.constructor===Object?C(S):I(S);let X=Te;if(Te&&Im(n,I,0),s&&s.idsToInsert){let D=s.idsToInsert.sort((V,z)=>V.offset>z.offset?1:-1),ct=D.length,tt=-1;for(;X&&ct>0;){let V=D[--ct].offset+n;V<X.stringsPosition+n&&tt===-1&&(tt=0),V>X.position+n?tt>=0&&(tt+=6):(tt>=0&&(fe.setUint32(X.position+n,fe.getUint32(X.position+n)+tt),tt=-1),X=X.previous,ct++)}tt>=0&&X&&fe.setUint32(X.position+n,fe.getUint32(X.position+n)+tt),W+=D.length*6,W>pn&&O(W),a.offset=W;let ft=BT(J.subarray(n,W),D);return s=null,ft}return a.offset=W,b&jT?(J.start=n,J.end=W,J):J.subarray(n,W)}catch(X){throw P=X,X}finally{if(i&&(T(),r&&a.saveStructures)){let X=i.sharedLength||0,D=J.subarray(n,W),ct=DT(i,a);if(!P)return a.saveStructures(ct,ct.isCompatible)===!1?a.pack(S,b):(a.lastNamedStructuresLength=X,J.length>1073741824&&(J=null),D)}J.length>1073741824&&(J=null),b&zT&&(W=n)}};const T=()=>{w<10&&w++;let S=i.sharedLength||0;if(i.length>S&&!c&&(i.length=S),k>1e4)i.transitions=null,w=0,k=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let b=0,P=m.length;b<P;b++)m[b][Ys]=0;m=[]}},v=S=>{var b=S.length;b<16?J[W++]=144|b:b<65536?(J[W++]=220,J[W++]=b>>8,J[W++]=b&255):(J[W++]=221,fe.setUint32(W,b),W+=4);for(let P=0;P<b;P++)I(S[P])},I=S=>{W>pn&&(J=O(W));var b=typeof S,P;if(b==="string"){let X=S.length;if(Te&&X>=4&&X<4096){if((Te.size+=X)>MT){let ft,V=(Te[0]?Te[0].length*3+Te[1].length:0)+10;W+V>pn&&(J=O(W+V));let z;Te.position?(z=Te,J[W]=200,W+=3,J[W++]=98,ft=W-n,W+=4,Im(n,I,0),fe.setUint16(ft+n-3,W-n-ft)):(J[W++]=214,J[W++]=98,ft=W-n,W+=4),Te=["",""],Te.previous=z,Te.size=0,Te.position=ft}let tt=UT.test(S);Te[tt?0:1]+=S,J[W++]=193,I(tt?-X:X);return}let D;X<32?D=1:X<256?D=2:X<65536?D=3:D=5;let ct=X*3;if(W+ct>pn&&(J=O(W+ct)),X<64||!o){let tt,ft,V,z=W+D;for(tt=0;tt<X;tt++)ft=S.charCodeAt(tt),ft<128?J[z++]=ft:ft<2048?(J[z++]=ft>>6|192,J[z++]=ft&63|128):(ft&64512)===55296&&((V=S.charCodeAt(tt+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(V&1023),tt++,J[z++]=ft>>18|240,J[z++]=ft>>12&63|128,J[z++]=ft>>6&63|128,J[z++]=ft&63|128):(J[z++]=ft>>12|224,J[z++]=ft>>6&63|128,J[z++]=ft&63|128);P=z-W-D}else P=o(S,W+D);P<32?J[W++]=160|P:P<256?(D<2&&J.copyWithin(W+2,W+1,W+1+P),J[W++]=217,J[W++]=P):P<65536?(D<3&&J.copyWithin(W+3,W+2,W+2+P),J[W++]=218,J[W++]=P>>8,J[W++]=P&255):(D<5&&J.copyWithin(W+5,W+3,W+3+P),J[W++]=219,fe.setUint32(W,P),W+=4),W+=P}else if(b==="number")if(S>>>0===S)S<32||S<128&&this.useRecords===!1||S<64&&!this.randomAccessStructure?J[W++]=S:S<256?(J[W++]=204,J[W++]=S):S<65536?(J[W++]=205,J[W++]=S>>8,J[W++]=S&255):(J[W++]=206,fe.setUint32(W,S),W+=4);else if(S>>0===S)S>=-32?J[W++]=256+S:S>=-128?(J[W++]=208,J[W++]=S+256):S>=-32768?(J[W++]=209,fe.setInt16(W,S),W+=2):(J[W++]=210,fe.setInt32(W,S),W+=4);else{let X;if((X=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){J[W++]=202,fe.setFloat32(W,S);let D;if(X<4||(D=S*fh[(J[W]&127)<<1|J[W+1]>>7])>>0===D){W+=4;return}else W--}J[W++]=203,fe.setFloat64(W,S),W+=8}else if(b==="object"||b==="function")if(!S)J[W++]=192;else{if(s){let D=s.get(S);if(D){if(!D.id){let ct=s.idsToInsert||(s.idsToInsert=[]);D.id=ct.push(D)}J[W++]=214,J[W++]=112,fe.setUint32(W,D.id),W+=4;return}else s.set(S,{offset:W-n})}let X=S.constructor;if(X===Object)B(S);else if(X===Array)v(S);else if(X===Map)if(this.mapAsEmptyObject)J[W++]=128;else{P=S.size,P<16?J[W++]=128|P:P<65536?(J[W++]=222,J[W++]=P>>8,J[W++]=P&255):(J[W++]=223,fe.setUint32(W,P),W+=4);for(let[D,ct]of S)I(D),I(ct)}else{for(let D=0,ct=dh.length;D<ct;D++){let tt=Tm[D];if(S instanceof tt){let ft=dh[D];if(ft.write){ft.type&&(J[W++]=212,J[W++]=ft.type,J[W++]=0);let lt=ft.write.call(this,S);lt===S?Array.isArray(S)?v(S):B(S):I(lt);return}let V=J,z=fe,Et=W;J=null;let ot;try{ot=ft.pack.call(this,S,lt=>(J=V,V=null,W+=lt,W>pn&&O(W),{target:J,targetView:fe,position:W-lt}),I)}finally{V&&(J=V,fe=z,W=Et,pn=J.length-10)}ot&&(ot.length+W>pn&&O(ot.length+W),W=PT(ot,J,W,ft.type));return}}if(Array.isArray(S))v(S);else{if(S.toJSON){const D=S.toJSON();if(D!==S)return I(D)}if(b==="function")return I(this.writeFunction&&this.writeFunction(S));B(S)}}}else if(b==="boolean")J[W++]=S?195:194;else if(b==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))J[W++]=211,fe.setBigInt64(W,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)J[W++]=207,fe.setBigUint64(W,S);else if(this.largeBigIntToFloat)J[W++]=203,fe.setFloat64(W,Number(S));else{if(this.largeBigIntToString)return I(S.toString());if(this.useBigIntExtension&&S<BigInt(2)**BigInt(1023)&&S>-(BigInt(2)**BigInt(1023))){J[W++]=199,W++,J[W++]=66;let X=[],D;do{let ct=S&BigInt(255);D=(ct&BigInt(128))===(S<BigInt(0)?BigInt(128):BigInt(0)),X.push(ct),S>>=BigInt(8)}while(!((S===BigInt(0)||S===BigInt(-1))&&D));J[W-2]=X.length;for(let ct=X.length;ct>0;)J[W++]=Number(X[--ct]);return}else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}W+=8}else if(b==="undefined")this.encodeUndefinedAsNil?J[W++]=192:(J[W++]=212,J[W++]=0,J[W++]=0);else throw new Error("Unknown type: "+b)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?S=>{let b;if(this.skipValues){b=[];for(let D in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(D))&&!this.skipValues.includes(S[D])&&b.push(D)}else b=Object.keys(S);let P=b.length;P<16?J[W++]=128|P:P<65536?(J[W++]=222,J[W++]=P>>8,J[W++]=P&255):(J[W++]=223,fe.setUint32(W,P),W+=4);let X;if(this.coercibleKeyAsNumber)for(let D=0;D<P;D++){X=b[D];let ct=Number(X);I(isNaN(ct)?X:ct),I(S[X])}else for(let D=0;D<P;D++)I(X=b[D]),I(S[X])}:S=>{J[W++]=222;let b=W-n;W+=2;let P=0;for(let X in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(X))&&(I(X),I(S[X]),P++);if(P>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');J[b+++n]=P>>8,J[b+n]=P&255},R=this.useRecords===!1?U:t.progressiveRecords&&!f?S=>{let b,P=i.transitions||(i.transitions=Object.create(null)),X=W++-n,D;for(let ct in S)if(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ct)){if(b=P[ct],b)P=b;else{let tt=Object.keys(S),ft=P;P=i.transitions;let V=0;for(let z=0,Et=tt.length;z<Et;z++){let ot=tt[z];b=P[ot],b||(b=P[ot]=Object.create(null),V++),P=b}X+n+1==W?(W--,Y(P,tt,V)):et(P,tt,X,V),D=!0,P=ft[ct]}I(S[ct])}if(!D){let ct=P[Ys];ct?J[X+n]=ct:et(P,Object.keys(S),X,0)}}:S=>{let b,P=i.transitions||(i.transitions=Object.create(null)),X=0;for(let ct in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ct))&&(b=P[ct],b||(b=P[ct]=Object.create(null),X++),P=b);let D=P[Ys];D?D>=96&&f?(J[W++]=((D-=96)&31)+96,J[W++]=D>>5):J[W++]=D:Y(P,P.__keys__||Object.keys(S),X);for(let ct in S)(typeof S.hasOwnProperty!="function"||S.hasOwnProperty(ct))&&I(S[ct])},L=typeof this.useRecords=="function"&&this.useRecords,B=L?S=>{L(S)?R(S):U(S)}:R,O=S=>{let b;if(S>16777216){if(S-n>vm)throw new Error("Packed buffer would be larger than maximum buffer size");b=Math.min(vm,Math.round(Math.max((S-n)*(S>67108864?1.25:2),4194304)/4096)*4096)}else b=(Math.max(S-n<<2,J.length-1)>>12)+1<<12;let P=new kc(b);return fe=P.dataView||(P.dataView=new DataView(P.buffer,0,b)),S=Math.min(S,J.length),J.copy?J.copy(P,0,n,S):P.set(J.slice(n,S)),W-=n,n=0,pn=P.length-10,J=P},Y=(S,b,P)=>{let X=i.nextId;X||(X=64),X<d&&this.shouldShareStructure&&!this.shouldShareStructure(b)?(X=i.nextOwnId,X<p||(X=d),i.nextOwnId=X+1):(X>=p&&(X=d),i.nextId=X+1);let D=b.highByte=X>=96&&f?X-96>>5:-1;S[Ys]=X,S.__keys__=b,i[X-64]=b,X<d?(b.isShared=!0,i.sharedLength=X-63,r=!0,D>=0?(J[W++]=(X&31)+96,J[W++]=D):J[W++]=X):(D>=0?(J[W++]=213,J[W++]=114,J[W++]=(X&31)+96,J[W++]=D):(J[W++]=212,J[W++]=114,J[W++]=X),P&&(k+=w*P),m.length>=h&&(m.shift()[Ys]=0),m.push(S),I(b))},et=(S,b,P,X)=>{let D=J,ct=W,tt=pn,ft=n;J=Ko,W=0,n=0,J||(Ko=J=new kc(8192)),pn=J.length-10,Y(S,b,X),Ko=J;let V=W;if(J=D,W=ct,pn=tt,n=ft,V>1){let z=W+V-1;z>pn&&O(z);let Et=P+n;J.copyWithin(Et+V,Et+1,W),J.set(Ko.slice(0,V),Et),W=z}else J[P+n]=Ko[0]},C=S=>{let b=LT(S,J,n,W,i,O,(P,X,D)=>{if(D)return r=!0;W=X;let ct=J;return I(P),T(),ct!==J?{position:W,targetView:fe,target:J}:W},this);if(b===0)return B(S);W=b}}useBuffer(t){J=t,J.dataView||(J.dataView=new DataView(J.buffer,J.byteOffset,J.byteLength)),W=0}set position(t){W=t}get position(){return W}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Tm=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,am],dh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Sm(e,16,t):Rm(wc?tn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==Am&&this.moreTypes?Sm(e,km.indexOf(n.name),t):Rm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Sm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Rm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function PT(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function BT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Im(e,t,n){if(Te.length>0){fe.setUint32(Te.position+e,W+n-Te.position-e),Te.stringsPosition=W-e;let r=Te;Te=null,t(r[0]),t(r[1])}}function DT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Nm=new FT({useRecords:!1});const $T=Nm.pack;Nm.pack;const jT=512,zT=1024,WT=2048;function Le(){return null}function Vs(e,t,n={}){if(!x(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];x(c)&&(a=c(a));const u=t[o];x(u)&&(o=u),a!==null&&r.push(o,a)}return r}function Go(e,t,n={}){if(x(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];x(a)&&(s=a);const c=n[s];x(c)&&(o=c(o)),r[s]=o}return r}catch(r){ye(G,"","binary",r.message)}}function KT(e){try{const t=Xe(e);return $T(t)}catch(t){ye(G,"","binary",t.message)}}function GT(e){try{return OT(e)}catch(t){ye(G,"","binary",t.message)}}function Om(){return{id:Ne()}}var xc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(xc||{});function Tc(e){return x(e==null?void 0:e.id)?Vs(e,xc,{category:Le,kinddata:Le,stopped:Le,removed:Le,bucket:Le}):Vs(e,xc,{id:Le,x:Le,y:Le,lx:Le,ly:Le,code:Le,category:Le,kinddata:Le,stopped:Le,removed:Le,bucket:Le})}function Ac(e){return Go(e,xc)}function Ho(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function vc(e,t){if(!x(e)||!$n(t))return;const{color:n,bg:r}=Qp(t);x(n)&&(e.color=n),x(r)&&(e.bg=r)}function Fr(e){var t;return Ot((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function Cm(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function Lm(e){const t=Math.floor(e.length/hc);if(t*hc!==e.length)return;const n=Cm(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function HT(e,t){return e&1<<t?255:0}function Mm(e){const t=Math.floor(e.length/nh);if(t*nh!==e.length)return;const n=Math.ceil(t/pc),r=fc*pc,i=Cm(r,dc*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*dc+a,l=e[c];for(let h=0;h<fc;++h){const f=s*fc+h;i.bits[f+u*r]=HT(l,7-h)}++a,a===dc&&(a=0,++s,s===pc&&(s=0,++o))}return i}const YT=Fa("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),VT=Fa("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var Um=typeof vs=="object"&&vs&&vs.Object===Object&&vs,XT=typeof self=="object"&&self&&self.Object===Object&&self,Pr=Um||XT||Function("return this")(),er=Pr.Symbol,Fm=Object.prototype,qT=Fm.hasOwnProperty,JT=Fm.toString,Yo=er?er.toStringTag:void 0;function ZT(e){var t=qT.call(e,Yo),n=e[Yo];try{e[Yo]=void 0;var r=!0}catch{}var i=JT.call(e);return r&&(t?e[Yo]=n:delete e[Yo]),i}var QT=Object.prototype,tA=QT.toString;function eA(e){return tA.call(e)}var nA="[object Null]",rA="[object Undefined]",Pm=er?er.toStringTag:void 0;function Pi(e){return e==null?e===void 0?rA:nA:Pm&&Pm in Object(e)?ZT(e):eA(e)}function dr(e){return e!=null&&typeof e=="object"}var iA="[object Symbol]";function Sc(e){return typeof e=="symbol"||dr(e)&&Pi(e)==iA}function Rc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var te=Array.isArray,sA=1/0,Bm=er?er.prototype:void 0,Dm=Bm?Bm.toString:void 0;function $m(e){if(typeof e=="string")return e;if(te(e))return Rc(e,$m)+"";if(Sc(e))return Dm?Dm.call(e):"";var t=e+"";return t=="0"&&1/e==-sA?"-0":t}var oA=/\s/;function aA(e){for(var t=e.length;t--&&oA.test(e.charAt(t)););return t}var cA=/^\s+/;function lA(e){return e&&e.slice(0,aA(e)+1).replace(cA,"")}function nr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var jm=NaN,uA=/^[-+]0x[0-9a-f]+$/i,hA=/^0b[01]+$/i,fA=/^0o[0-7]+$/i,dA=parseInt;function pA(e){if(typeof e=="number")return e;if(Sc(e))return jm;if(nr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=nr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=lA(e);var n=hA.test(e);return n||fA.test(e)?dA(e.slice(2),n?2:8):uA.test(e)?jm:+e}var zm=1/0,mA=17976931348623157e292;function gA(e){if(!e)return e===0?e:0;if(e=pA(e),e===zm||e===-zm){var t=e<0?-1:1;return t*mA}return e===e?e:0}function Ic(e){var t=gA(e),n=t%1;return t===t?n?t-n:t:0}function Xs(e){return e}var yA="[object AsyncFunction]",_A="[object Function]",bA="[object GeneratorFunction]",EA="[object Proxy]";function fi(e){if(!nr(e))return!1;var t=Pi(e);return t==_A||t==bA||t==yA||t==EA}var ph=Pr["__core-js_shared__"],Wm=function(){var e=/[^.]+$/.exec(ph&&ph.keys&&ph.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function wA(e){return!!Wm&&Wm in e}var kA=Function.prototype,xA=kA.toString;function is(e){if(e!=null){try{return xA.call(e)}catch{}try{return e+""}catch{}}return""}var TA=/[\\^$.*+?()[\]{}|]/g,AA=/^\[object .+?Constructor\]$/,vA=Function.prototype,SA=Object.prototype,RA=vA.toString,IA=SA.hasOwnProperty,NA=RegExp("^"+RA.call(IA).replace(TA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function OA(e){if(!nr(e)||wA(e))return!1;var t=fi(e)?NA:AA;return t.test(is(e))}function CA(e,t){return e==null?void 0:e[t]}function ss(e,t){var n=CA(e,t);return OA(n)?n:void 0}var mh=ss(Pr,"WeakMap"),Km=Object.create,LA=function(){function e(){}return function(t){if(!nr(t))return{};if(Km)return Km(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function MA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function We(){}function UA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var FA=800,PA=16,BA=Date.now;function DA(e){var t=0,n=0;return function(){var r=BA(),i=PA-(r-n);if(n=r,i>0){if(++t>=FA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function $A(e){return function(){return e}}var Nc=function(){try{var e=ss(Object,"defineProperty");return e({},"",{}),e}catch{}}(),jA=Nc?function(e,t){return Nc(e,"toString",{configurable:!0,enumerable:!1,value:$A(t),writable:!0})}:Xs,zA=DA(jA);function Gm(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Hm(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function WA(e){return e!==e}function KA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function gh(e,t,n){return t===t?KA(e,t,n):Hm(e,WA,n)}function Ym(e,t){var n=e==null?0:e.length;return!!n&&gh(e,t,0)>-1}var GA=9007199254740991,HA=/^(?:0|[1-9]\d*)$/;function Oc(e,t){var n=typeof e;return t=t??GA,!!t&&(n=="number"||n!="symbol"&&HA.test(e))&&e>-1&&e%1==0&&e<t}function yh(e,t,n){t=="__proto__"&&Nc?Nc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Vo(e,t){return e===t||e!==e&&t!==t}var YA=Object.prototype,VA=YA.hasOwnProperty;function Cc(e,t,n){var r=e[t];(!(VA.call(e,t)&&Vo(r,n))||n===void 0&&!(t in e))&&yh(e,t,n)}function _h(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?yh(n,a,c):Cc(n,a,c)}return n}var Vm=Math.max;function XA(e,t,n){return t=Vm(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Vm(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),MA(e,this,a)}}function bh(e,t){return zA(XA(e,t,Xs),e+"")}var qA=9007199254740991;function Eh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=qA}function Br(e){return e!=null&&Eh(e.length)&&!fi(e)}function Xm(e,t,n){if(!nr(n))return!1;var r=typeof t;return(r=="number"?Br(n)&&Oc(t,n.length):r=="string"&&t in n)?Vo(n[t],e):!1}function JA(e){return bh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Xm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var ZA=Object.prototype;function Xo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||ZA;return e===n}function QA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var tv="[object Arguments]";function qm(e){return dr(e)&&Pi(e)==tv}var Jm=Object.prototype,ev=Jm.hasOwnProperty,nv=Jm.propertyIsEnumerable,Lc=qm(function(){return arguments}())?qm:function(e){return dr(e)&&ev.call(e,"callee")&&!nv.call(e,"callee")};function rv(){return!1}var Zm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Qm=Zm&&typeof module=="object"&&module&&!module.nodeType&&module,iv=Qm&&Qm.exports===Zm,tg=iv?Pr.Buffer:void 0,sv=tg?tg.isBuffer:void 0,qo=sv||rv,ov="[object Arguments]",av="[object Array]",cv="[object Boolean]",lv="[object Date]",uv="[object Error]",hv="[object Function]",fv="[object Map]",dv="[object Number]",pv="[object Object]",mv="[object RegExp]",gv="[object Set]",yv="[object String]",_v="[object WeakMap]",bv="[object ArrayBuffer]",Ev="[object DataView]",wv="[object Float32Array]",kv="[object Float64Array]",xv="[object Int8Array]",Tv="[object Int16Array]",Av="[object Int32Array]",vv="[object Uint8Array]",Sv="[object Uint8ClampedArray]",Rv="[object Uint16Array]",Iv="[object Uint32Array]",be={};be[wv]=be[kv]=be[xv]=be[Tv]=be[Av]=be[vv]=be[Sv]=be[Rv]=be[Iv]=!0,be[ov]=be[av]=be[bv]=be[cv]=be[Ev]=be[lv]=be[uv]=be[hv]=be[fv]=be[dv]=be[pv]=be[mv]=be[gv]=be[yv]=be[_v]=!1;function Nv(e){return dr(e)&&Eh(e.length)&&!!be[Pi(e)]}function Mc(e){return function(t){return e(t)}}var eg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Jo=eg&&typeof module=="object"&&module&&!module.nodeType&&module,Ov=Jo&&Jo.exports===eg,wh=Ov&&Um.process,Bi=function(){try{var e=Jo&&Jo.require&&Jo.require("util").types;return e||wh&&wh.binding&&wh.binding("util")}catch{}}(),ng=Bi&&Bi.isTypedArray,kh=ng?Mc(ng):Nv,Cv=Object.prototype,Lv=Cv.hasOwnProperty;function rg(e,t){var n=te(e),r=!n&&Lc(e),i=!n&&!r&&qo(e),s=!n&&!r&&!i&&kh(e),o=n||r||i||s,a=o?QA(e.length,String):[],c=a.length;for(var u in e)(t||Lv.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Oc(u,c)))&&a.push(u);return a}function ig(e,t){return function(n){return e(t(n))}}var Mv=ig(Object.keys,Object),Uv=Object.prototype,Fv=Uv.hasOwnProperty;function sg(e){if(!Xo(e))return Mv(e);var t=[];for(var n in Object(e))Fv.call(e,n)&&n!="constructor"&&t.push(n);return t}function rr(e){return Br(e)?rg(e):sg(e)}var Pv=Object.prototype,Bv=Pv.hasOwnProperty,xn=JA(function(e,t){if(Xo(t)||Br(t)){_h(t,rr(t),e);return}for(var n in t)Bv.call(t,n)&&Cc(e,n,t[n])});function Dv(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var $v=Object.prototype,jv=$v.hasOwnProperty;function zv(e){if(!nr(e))return Dv(e);var t=Xo(e),n=[];for(var r in e)r=="constructor"&&(t||!jv.call(e,r))||n.push(r);return n}function og(e){return Br(e)?rg(e,!0):zv(e)}var Wv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Kv=/^\w*$/;function xh(e,t){if(te(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Sc(e)?!0:Kv.test(e)||!Wv.test(e)||t!=null&&e in Object(t)}var Zo=ss(Object,"create");function Gv(){this.__data__=Zo?Zo(null):{},this.size=0}function Hv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Yv="__lodash_hash_undefined__",Vv=Object.prototype,Xv=Vv.hasOwnProperty;function qv(e){var t=this.__data__;if(Zo){var n=t[e];return n===Yv?void 0:n}return Xv.call(t,e)?t[e]:void 0}var Jv=Object.prototype,Zv=Jv.hasOwnProperty;function Qv(e){var t=this.__data__;return Zo?t[e]!==void 0:Zv.call(t,e)}var tS="__lodash_hash_undefined__";function eS(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Zo&&t===void 0?tS:t,this}function os(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}os.prototype.clear=Gv,os.prototype.delete=Hv,os.prototype.get=qv,os.prototype.has=Qv,os.prototype.set=eS;function nS(){this.__data__=[],this.size=0}function Uc(e,t){for(var n=e.length;n--;)if(Vo(e[n][0],t))return n;return-1}var rS=Array.prototype,iS=rS.splice;function sS(e){var t=this.__data__,n=Uc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():iS.call(t,n,1),--this.size,!0}function oS(e){var t=this.__data__,n=Uc(t,e);return n<0?void 0:t[n][1]}function aS(e){return Uc(this.__data__,e)>-1}function cS(e,t){var n=this.__data__,r=Uc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function di(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}di.prototype.clear=nS,di.prototype.delete=sS,di.prototype.get=oS,di.prototype.has=aS,di.prototype.set=cS;var Qo=ss(Pr,"Map");function lS(){this.size=0,this.__data__={hash:new os,map:new(Qo||di),string:new os}}function uS(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Fc(e,t){var n=e.__data__;return uS(t)?n[typeof t=="string"?"string":"hash"]:n.map}function hS(e){var t=Fc(this,e).delete(e);return this.size-=t?1:0,t}function fS(e){return Fc(this,e).get(e)}function dS(e){return Fc(this,e).has(e)}function pS(e,t){var n=Fc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function pi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}pi.prototype.clear=lS,pi.prototype.delete=hS,pi.prototype.get=fS,pi.prototype.has=dS,pi.prototype.set=pS;var mS="Expected a function";function Th(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(mS);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Th.Cache||pi),n}Th.Cache=pi;var gS=500;function yS(e){var t=Th(e,function(r){return n.size===gS&&n.clear(),r}),n=t.cache;return t}var _S=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bS=/\\(\\)?/g,ES=yS(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(_S,function(n,r,i,s){t.push(i?s.replace(bS,"$1"):r||n)}),t});function ag(e){return e==null?"":$m(e)}function Pc(e,t){return te(e)?e:xh(e,t)?[e]:ES(ag(e))}var wS=1/0;function ta(e){if(typeof e=="string"||Sc(e))return e;var t=e+"";return t=="0"&&1/e==-wS?"-0":t}function Ah(e,t){t=Pc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ta(t[n++])];return n&&n==r?e:void 0}function kS(e,t,n){var r=e==null?void 0:Ah(e,t);return r===void 0?n:r}function vh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var cg=er?er.isConcatSpreadable:void 0;function xS(e){return te(e)||Lc(e)||!!(cg&&e&&e[cg])}function Sh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=xS),i||(i=[]);++s<o;){var a=e[s];n(a)?vh(i,a):r||(i[i.length]=a)}return i}function jn(e){var t=e==null?0:e.length;return t?Sh(e):[]}var lg=ig(Object.getPrototypeOf,Object);function Rh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function TS(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Rh(e,t,n)}var AS="\\ud800-\\udfff",vS="\\u0300-\\u036f",SS="\\ufe20-\\ufe2f",RS="\\u20d0-\\u20ff",IS=vS+SS+RS,NS="\\ufe0e\\ufe0f",OS="\\u200d",CS=RegExp("["+OS+AS+IS+NS+"]");function ug(e){return CS.test(e)}function LS(e){return e.split("")}var hg="\\ud800-\\udfff",MS="\\u0300-\\u036f",US="\\ufe20-\\ufe2f",FS="\\u20d0-\\u20ff",PS=MS+US+FS,BS="\\ufe0e\\ufe0f",DS="["+hg+"]",Ih="["+PS+"]",Nh="\\ud83c[\\udffb-\\udfff]",$S="(?:"+Ih+"|"+Nh+")",fg="[^"+hg+"]",dg="(?:\\ud83c[\\udde6-\\uddff]){2}",pg="[\\ud800-\\udbff][\\udc00-\\udfff]",jS="\\u200d",mg=$S+"?",gg="["+BS+"]?",zS="(?:"+jS+"(?:"+[fg,dg,pg].join("|")+")"+gg+mg+")*",WS=gg+mg+zS,KS="(?:"+[fg+Ih+"?",Ih,dg,pg,DS].join("|")+")",GS=RegExp(Nh+"(?="+Nh+")|"+KS+WS,"g");function HS(e){return e.match(GS)||[]}function YS(e){return ug(e)?HS(e):LS(e)}function VS(e){return function(t){t=ag(t);var n=ug(t)?YS(t):void 0,r=n?n[0]:t.charAt(0),i=n?TS(n,1).join(""):t.slice(1);return r[e]()+i}}var yg=VS("toUpperCase");function XS(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function qS(){this.__data__=new di,this.size=0}function JS(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function ZS(e){return this.__data__.get(e)}function QS(e){return this.__data__.has(e)}var tR=200;function eR(e,t){var n=this.__data__;if(n instanceof di){var r=n.__data__;if(!Qo||r.length<tR-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new pi(r)}return n.set(e,t),this.size=n.size,this}function Dr(e){var t=this.__data__=new di(e);this.size=t.size}Dr.prototype.clear=qS,Dr.prototype.delete=JS,Dr.prototype.get=ZS,Dr.prototype.has=QS,Dr.prototype.set=eR;function nR(e,t){return e&&_h(t,rr(t),e)}var _g=typeof exports=="object"&&exports&&!exports.nodeType&&exports,bg=_g&&typeof module=="object"&&module&&!module.nodeType&&module,rR=bg&&bg.exports===_g,Eg=rR?Pr.Buffer:void 0,wg=Eg?Eg.allocUnsafe:void 0;function iR(e,t){var n=e.length,r=wg?wg(n):new e.constructor(n);return e.copy(r),r}function Oh(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function kg(){return[]}var sR=Object.prototype,oR=sR.propertyIsEnumerable,xg=Object.getOwnPropertySymbols,Ch=xg?function(e){return e==null?[]:(e=Object(e),Oh(xg(e),function(t){return oR.call(e,t)}))}:kg;function aR(e,t){return _h(e,Ch(e),t)}var cR=Object.getOwnPropertySymbols,lR=cR?function(e){for(var t=[];e;)vh(t,Ch(e)),e=lg(e);return t}:kg;function Tg(e,t,n){var r=t(e);return te(e)?r:vh(r,n(e))}function Lh(e){return Tg(e,rr,Ch)}function uR(e){return Tg(e,og,lR)}var Mh=ss(Pr,"DataView"),Uh=ss(Pr,"Promise"),qs=ss(Pr,"Set"),Ag="[object Map]",hR="[object Object]",vg="[object Promise]",Sg="[object Set]",Rg="[object WeakMap]",Ig="[object DataView]",fR=is(Mh),dR=is(Qo),pR=is(Uh),mR=is(qs),gR=is(mh),ir=Pi;(Mh&&ir(new Mh(new ArrayBuffer(1)))!=Ig||Qo&&ir(new Qo)!=Ag||Uh&&ir(Uh.resolve())!=vg||qs&&ir(new qs)!=Sg||mh&&ir(new mh)!=Rg)&&(ir=function(e){var t=Pi(e),n=t==hR?e.constructor:void 0,r=n?is(n):"";if(r)switch(r){case fR:return Ig;case dR:return Ag;case pR:return vg;case mR:return Sg;case gR:return Rg}return t});var yR=Object.prototype,_R=yR.hasOwnProperty;function bR(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&_R.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Bc=Pr.Uint8Array;function ER(e){var t=new e.constructor(e.byteLength);return new Bc(t).set(new Bc(e)),t}function wR(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var kR=/\w*$/;function xR(e){var t=new e.constructor(e.source,kR.exec(e));return t.lastIndex=e.lastIndex,t}var Ng=er?er.prototype:void 0,Og=Ng?Ng.valueOf:void 0;function TR(e){return Og?Object(Og.call(e)):{}}function AR(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var vR="[object Boolean]",SR="[object Date]",RR="[object Map]",IR="[object Number]",NR="[object RegExp]",OR="[object Set]",CR="[object String]",LR="[object Symbol]",MR="[object ArrayBuffer]",UR="[object DataView]",FR="[object Float32Array]",PR="[object Float64Array]",BR="[object Int8Array]",DR="[object Int16Array]",$R="[object Int32Array]",jR="[object Uint8Array]",zR="[object Uint8ClampedArray]",WR="[object Uint16Array]",KR="[object Uint32Array]";function GR(e,t,n){var r=e.constructor;switch(t){case MR:return ER(e);case vR:case SR:return new r(+e);case UR:return wR(e);case FR:case PR:case BR:case DR:case $R:case jR:case zR:case WR:case KR:return AR(e);case RR:return new r;case IR:case CR:return new r(e);case NR:return xR(e);case OR:return new r;case LR:return TR(e)}}function HR(e){return typeof e.constructor=="function"&&!Xo(e)?LA(lg(e)):{}}var YR="[object Map]";function VR(e){return dr(e)&&ir(e)==YR}var Cg=Bi&&Bi.isMap,XR=Cg?Mc(Cg):VR,qR="[object Set]";function JR(e){return dr(e)&&ir(e)==qR}var Lg=Bi&&Bi.isSet,ZR=Lg?Mc(Lg):JR,Mg="[object Arguments]",QR="[object Array]",tI="[object Boolean]",eI="[object Date]",nI="[object Error]",Ug="[object Function]",rI="[object GeneratorFunction]",iI="[object Map]",sI="[object Number]",Fg="[object Object]",oI="[object RegExp]",aI="[object Set]",cI="[object String]",lI="[object Symbol]",uI="[object WeakMap]",hI="[object ArrayBuffer]",fI="[object DataView]",dI="[object Float32Array]",pI="[object Float64Array]",mI="[object Int8Array]",gI="[object Int16Array]",yI="[object Int32Array]",_I="[object Uint8Array]",bI="[object Uint8ClampedArray]",EI="[object Uint16Array]",wI="[object Uint32Array]",de={};de[Mg]=de[QR]=de[hI]=de[fI]=de[tI]=de[eI]=de[dI]=de[pI]=de[mI]=de[gI]=de[yI]=de[iI]=de[sI]=de[Fg]=de[oI]=de[aI]=de[cI]=de[lI]=de[_I]=de[bI]=de[EI]=de[wI]=!0,de[nI]=de[Ug]=de[uI]=!1;function Dc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!nr(e))return e;var a=te(e);if(a)return o=bR(e),UA(e,o);var c=ir(e),u=c==Ug||c==rI;if(qo(e))return iR(e);if(c==Fg||c==Mg||u&&!i)return o=u?{}:HR(e),aR(e,nR(o,e));if(!de[c])return i?e:{};o=GR(e,c),s||(s=new Dr);var l=s.get(e);if(l)return l;s.set(e,o),ZR(e)?e.forEach(function(d){o.add(Dc(d,t,n,d,e,s))}):XR(e)&&e.forEach(function(d,p){o.set(p,Dc(d,t,n,p,e,s))});var h=Lh,f=a?void 0:h(e);return Gm(f||e,function(d,p){f&&(p=d,d=e[p]),Cc(o,p,Dc(d,t,n,p,e,s))}),o}var kI=4;function rn(e){return Dc(e,kI)}function ea(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var xI="__lodash_hash_undefined__";function TI(e){return this.__data__.set(e,xI),this}function AI(e){return this.__data__.has(e)}function Js(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new pi;++t<n;)this.add(e[t])}Js.prototype.add=Js.prototype.push=TI,Js.prototype.has=AI;function Pg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Fh(e,t){return e.has(t)}var vI=1,SI=2;function Bg(e,t,n,r,i,s){var o=n&vI,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,f=!0,d=n&SI?new Js:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(r)var k=o?r(m,p,h,t,e,s):r(p,m,h,e,t,s);if(k!==void 0){if(k)continue;f=!1;break}if(d){if(!Pg(t,function(w,T){if(!Fh(d,T)&&(p===w||i(p,w,n,r,s)))return d.push(T)})){f=!1;break}}else if(!(p===m||i(p,m,n,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}function RI(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Ph(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var II=1,NI=2,OI="[object Boolean]",CI="[object Date]",LI="[object Error]",MI="[object Map]",UI="[object Number]",FI="[object RegExp]",PI="[object Set]",BI="[object String]",DI="[object Symbol]",$I="[object ArrayBuffer]",jI="[object DataView]",Dg=er?er.prototype:void 0,Bh=Dg?Dg.valueOf:void 0;function zI(e,t,n,r,i,s,o){switch(n){case jI:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case $I:return!(e.byteLength!=t.byteLength||!s(new Bc(e),new Bc(t)));case OI:case CI:case UI:return Vo(+e,+t);case LI:return e.name==t.name&&e.message==t.message;case FI:case BI:return e==t+"";case MI:var a=RI;case PI:var c=r&II;if(a||(a=Ph),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=NI,o.set(e,t);var l=Bg(a(e),a(t),r,i,s,o);return o.delete(e),l;case DI:if(Bh)return Bh.call(e)==Bh.call(t)}return!1}var WI=1,KI=Object.prototype,GI=KI.hasOwnProperty;function HI(e,t,n,r,i,s){var o=n&WI,a=Lh(e),c=a.length,u=Lh(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in t:GI.call(t,f)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var k=o;++h<c;){f=a[h];var w=e[f],T=t[f];if(r)var v=o?r(T,w,f,t,e,s):r(w,T,f,e,t,s);if(!(v===void 0?w===T||i(w,T,n,r,s):v)){m=!1;break}k||(k=f=="constructor")}if(m&&!k){var I=e.constructor,U=t.constructor;I!=U&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(m=!1)}return s.delete(e),s.delete(t),m}var YI=1,$g="[object Arguments]",jg="[object Array]",$c="[object Object]",VI=Object.prototype,zg=VI.hasOwnProperty;function XI(e,t,n,r,i,s){var o=te(e),a=te(t),c=o?jg:ir(e),u=a?jg:ir(t);c=c==$g?$c:c,u=u==$g?$c:u;var l=c==$c,h=u==$c,f=c==u;if(f&&qo(e)){if(!qo(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Dr),o||kh(e)?Bg(e,t,n,r,i,s):zI(e,t,c,n,r,i,s);if(!(n&YI)){var d=l&&zg.call(e,"__wrapped__"),p=h&&zg.call(t,"__wrapped__");if(d||p){var m=d?e.value():e,k=p?t.value():t;return s||(s=new Dr),i(m,k,n,r,s)}}return f?(s||(s=new Dr),HI(e,t,n,r,i,s)):!1}function Dh(e,t,n,r,i){return e===t?!0:e==null||t==null||!dr(e)&&!dr(t)?e!==e&&t!==t:XI(e,t,n,r,Dh,i)}var qI=1,JI=2;function ZI(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Dr,h;if(!(h===void 0?Dh(u,c,qI|JI,r,l):h))return!1}}return!0}function Wg(e){return e===e&&!nr(e)}function QI(e){for(var t=rr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Wg(i)]}return t}function Kg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function tN(e){var t=QI(e);return t.length==1&&t[0][2]?Kg(t[0][0],t[0][1]):function(n){return n===e||ZI(n,e,t)}}function eN(e,t){return e!=null&&t in Object(e)}function Gg(e,t,n){t=Pc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ta(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Eh(i)&&Oc(o,i)&&(te(e)||Lc(e)))}function nN(e,t){return e!=null&&Gg(e,t,eN)}var rN=1,iN=2;function sN(e,t){return xh(e)&&Wg(t)?Kg(ta(e),t):function(n){var r=kS(n,e);return r===void 0&&r===t?nN(n,e):Dh(t,r,rN|iN)}}function oN(e){return function(t){return t==null?void 0:t[e]}}function aN(e){return function(t){return Ah(t,e)}}function cN(e){return xh(e)?oN(ta(e)):aN(e)}function $r(e){return typeof e=="function"?e:e==null?Xs:typeof e=="object"?te(e)?sN(e[0],e[1]):tN(e):cN(e)}function lN(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function uN(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var hN=uN();function fN(e,t){return e&&hN(e,t,rr)}function dN(e,t){return function(n,r){if(n==null)return n;if(!Br(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var as=dN(fN);function pN(e,t,n,r){return as(e,function(i,s,o){t(r,i,n(i),o)}),r}function mN(e,t){return function(n,r){var i=te(n)?lN:pN,s=t?t():{};return i(n,e,$r(r),s)}}var Hg=Object.prototype,gN=Hg.hasOwnProperty,$h=bh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Xm(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=og(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Vo(l,Hg[u])&&!gN.call(e,u))&&(e[u]=s[u])}return e});function Yg(e){return dr(e)&&Br(e)}var yN=200;function _N(e,t,n,r){var i=-1,s=Ym,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=yN&&(s=Fh,o=!1,t=new Js(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var jc=bh(function(e,t){return Yg(e)?_N(e,Sh(t,1,Yg,!0)):[]});function Zs(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function sn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ic(t),Rh(e,t<0?0:t,r)):[]}function na(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Ic(t),t=r-t,Rh(e,0,t<0?0:t)):[]}function bN(e){return typeof e=="function"?e:Xs}function Rt(e,t){var n=te(e)?Gm:as;return n(e,bN(t))}function EN(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function wN(e,t){var n=!0;return as(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function pr(e,t,n){var r=te(e)?EN:wN;return r(e,$r(t))}function Vg(e,t){var n=[];return as(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function sr(e,t){var n=te(e)?Oh:Vg;return n(e,$r(t))}function kN(e){return function(t,n,r){var i=Object(t);if(!Br(t)){var s=$r(n);t=rr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var xN=Math.max;function TN(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Ic(n);return i<0&&(i=xN(r+i,0)),Hm(e,$r(t),i)}var Qs=kN(TN);function mr(e){return e&&e.length?e[0]:void 0}function AN(e,t){var n=-1,r=Br(e)?Array(e.length):[];return as(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function kt(e,t){var n=te(e)?Rc:AN;return n(e,$r(t))}function or(e,t){return Sh(kt(e,t))}var vN=Object.prototype,SN=vN.hasOwnProperty,Xg=mN(function(e,t,n){SN.call(e,n)?e[n].push(t):yh(e,n,[t])}),RN=Object.prototype,IN=RN.hasOwnProperty;function NN(e,t){return e!=null&&IN.call(e,t)}function St(e,t){return e!=null&&Gg(e,t,NN)}var ON="[object String]";function Tn(e){return typeof e=="string"||!te(e)&&dr(e)&&Pi(e)==ON}function CN(e,t){return Rc(t,function(n){return e[n]})}function Fe(e){return e==null?[]:CN(e,rr(e))}var LN=Math.max;function mn(e,t,n,r){e=Br(e)?e:Fe(e),n=n&&!r?Ic(n):0;var i=e.length;return n<0&&(n=LN(i+n,0)),Tn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&gh(e,t,n)>-1}function qg(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return gh(e,t,i)}var MN="[object Map]",UN="[object Set]",FN=Object.prototype,PN=FN.hasOwnProperty;function pe(e){if(e==null)return!0;if(Br(e)&&(te(e)||typeof e=="string"||typeof e.splice=="function"||qo(e)||kh(e)||Lc(e)))return!e.length;var t=ir(e);if(t==MN||t==UN)return!e.size;if(Xo(e))return!sg(e).length;for(var n in e)if(PN.call(e,n))return!1;return!0}var BN="[object RegExp]";function DN(e){return dr(e)&&Pi(e)==BN}var Jg=Bi&&Bi.isRegExp,mi=Jg?Mc(Jg):DN;function gi(e){return e===void 0}var $N="Expected a function";function jN(e){if(typeof e!="function")throw new TypeError($N);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function zN(e,t,n,r){if(!nr(e))return e;t=Pc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ta(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=nr(l)?l:Oc(t[i+1])?[]:{})}Cc(a,c,u),a=a[c]}return e}function WN(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Ah(e,o);n(a,o)&&zN(s,Pc(o,e),a)}return s}function gr(e,t){if(e==null)return{};var n=Rc(uR(e),function(r){return[r]});return t=$r(t),WN(e,n,function(r,i){return t(r,i[0])})}function KN(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function An(e,t,n){var r=te(e)?XS:KN,i=arguments.length<3;return r(e,$r(t),n,i,as)}function zc(e,t){var n=te(e)?Oh:Vg;return n(e,jN($r(t)))}function GN(e,t){var n;return as(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function jh(e,t,n){var r=te(e)?Pg:GN;return r(e,$r(t))}var HN=1/0,YN=qs&&1/Ph(new qs([,-0]))[1]==HN?function(e){return new qs(e)}:We,VN=200;function XN(e,t,n){var r=-1,i=Ym,s=e.length,o=!0,a=[],c=a;if(s>=VN){var u=YN(e);if(u)return Ph(u);o=!1,i=Fh,c=new Js}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Wc(e){return e&&e.length?XN(e):[]}function zh(e){console&&console.error&&console.error(`Error: ${e}`)}function Zg(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Qg(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function ty(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function qN(e){return JN(e)?e.LABEL:e.name}function JN(e){return Tn(e.LABEL)&&e.LABEL!==""}class jr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Rt(this.definition,n=>{n.accept(t)})}}class vn extends jr{constructor(t){super([]),this.idx=1,xn(this,gr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class to extends jr{constructor(t){super(t.definition),this.orgText="",xn(this,gr(t,n=>n!==void 0))}}class Sn extends jr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,xn(this,gr(t,n=>n!==void 0))}}class Rn extends jr{constructor(t){super(t.definition),this.idx=1,xn(this,gr(t,n=>n!==void 0))}}class zr extends jr{constructor(t){super(t.definition),this.idx=1,xn(this,gr(t,n=>n!==void 0))}}class Wr extends jr{constructor(t){super(t.definition),this.idx=1,xn(this,gr(t,n=>n!==void 0))}}class Ke extends jr{constructor(t){super(t.definition),this.idx=1,xn(this,gr(t,n=>n!==void 0))}}class yr extends jr{constructor(t){super(t.definition),this.idx=1,xn(this,gr(t,n=>n!==void 0))}}class _r extends jr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,xn(this,gr(t,n=>n!==void 0))}}class Ae{constructor(t){this.idx=1,xn(this,gr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function ZN(e){return kt(e,Kc)}function Kc(e){function t(n){return kt(n,Kc)}if(e instanceof vn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Tn(e.label)&&(n.label=e.label),n}else{if(e instanceof Sn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Rn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof zr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Wr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Kc(new Ae({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof yr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Kc(new Ae({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ke)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof _r)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Ae){const n={type:"Terminal",name:e.terminalType.name,label:qN(e.terminalType),idx:e.idx};Tn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=mi(r)?r.source:r),n}else{if(e instanceof to)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class cs{visit(t){const n=t;switch(n.constructor){case vn:return this.visitNonTerminal(n);case Sn:return this.visitAlternative(n);case Rn:return this.visitOption(n);case zr:return this.visitRepetitionMandatory(n);case Wr:return this.visitRepetitionMandatoryWithSeparator(n);case yr:return this.visitRepetitionWithSeparator(n);case Ke:return this.visitRepetition(n);case _r:return this.visitAlternation(n);case Ae:return this.visitTerminal(n);case to:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function QN(e){return e instanceof Sn||e instanceof Rn||e instanceof Ke||e instanceof zr||e instanceof Wr||e instanceof yr||e instanceof Ae||e instanceof to}function Gc(e,t=[]){return e instanceof Rn||e instanceof Ke||e instanceof yr?!0:e instanceof _r?jh(e.definition,r=>Gc(r,t)):e instanceof vn&&mn(t,e)?!1:e instanceof jr?(e instanceof vn&&t.push(e),pr(e.definition,r=>Gc(r,t))):!1}function tO(e){return e instanceof _r}function Kr(e){if(e instanceof vn)return"SUBRULE";if(e instanceof Rn)return"OPTION";if(e instanceof _r)return"OR";if(e instanceof zr)return"AT_LEAST_ONE";if(e instanceof Wr)return"AT_LEAST_ONE_SEP";if(e instanceof yr)return"MANY_SEP";if(e instanceof Ke)return"MANY";if(e instanceof Ae)return"CONSUME";throw Error("non exhaustive match")}class Hc{walk(t,n=[]){Rt(t.definition,(r,i)=>{const s=sn(t.definition,i+1);if(r instanceof vn)this.walkProdRef(r,s,n);else if(r instanceof Ae)this.walkTerminal(r,s,n);else if(r instanceof Sn)this.walkFlat(r,s,n);else if(r instanceof Rn)this.walkOption(r,s,n);else if(r instanceof zr)this.walkAtLeastOne(r,s,n);else if(r instanceof Wr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof yr)this.walkManySep(r,s,n);else if(r instanceof Ke)this.walkMany(r,s,n);else if(r instanceof _r)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Rn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=ey(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Rn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=ey(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Rt(t.definition,s=>{const o=new Sn({definition:[s]});this.walk(o,i)})}}function ey(e,t,n){return[new Rn({definition:[new Ae({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function ra(e){if(e instanceof vn)return ra(e.referencedRule);if(e instanceof Ae)return rO(e);if(QN(e))return eO(e);if(tO(e))return nO(e);throw Error("non exhaustive match")}function eO(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Gc(s),t=t.concat(ra(s)),r=r+1,i=n.length>r;return Wc(t)}function nO(e){const t=kt(e.definition,n=>ra(n));return Wc(jn(t))}function rO(e){return[e.terminalType]}const ny="_~IN~_";class iO extends Hc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=oO(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Sn({definition:s}),a=ra(o);this.follows[i]=a}}function sO(e){const t={};return Rt(e,n=>{const r=new iO(n).startWalking();xn(t,r)}),t}function oO(e,t){return e.name+t+ny}function It(e){return e.charCodeAt(0)}function Wh(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ia(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function eo(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function aO(){throw Error("Internal Error - Should never get here!")}function ry(e){return e.type==="Character"}const Yc=[];for(let e=It("0");e<=It("9");e++)Yc.push(e);const Vc=[It("_")].concat(Yc);for(let e=It("a");e<=It("z");e++)Vc.push(e);for(let e=It("A");e<=It("Z");e++)Vc.push(e);const iy=[It(" "),It("\f"),It(`
`),It("\r"),It("	"),It("\v"),It("	"),It("Â "),It("á"),It("â"),It("â"),It("â"),It("â"),It("â"),It("â"),It("â"),It("â"),It("â"),It("â"),It("â"),It("\u2028"),It("\u2029"),It("â¯"),It("â"),It("ã"),It("\uFEFF")],cO=/[0-9a-fA-F]/,Xc=/[0-9]/,lO=/[1-9]/;class uO{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ia(r,"global");break;case"i":ia(r,"ignoreCase");break;case"m":ia(r,"multiLine");break;case"u":ia(r,"unicode");break;case"y":ia(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}eo(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return aO()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;eo(n);break}if(!(t===!0&&n===void 0)&&eo(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),eo(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[It(`
`),It("\r"),It("\u2028"),It("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Yc;break;case"D":t=Yc,n=!0;break;case"s":t=iy;break;case"S":t=iy,n=!0;break;case"w":t=Vc;break;case"W":t=Vc,n=!0;break}if(eo(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=It("\f");break;case"n":t=It(`
`);break;case"r":t=It("\r");break;case"t":t=It("	");break;case"v":t=It("\v");break}if(eo(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:It("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:It(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:It(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,ry(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,ry(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else Wh(r.value,t),t.push(It("-")),Wh(i.value,t)}else Wh(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:It("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(lO.test(t)===!1)throw Error("Expecting a positive integer");for(;Xc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Xc.test(t)===!1)throw Error("Expecting an integer");for(;Xc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:It(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Xc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(cO.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Kh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let qc={};const hO=new uO;function Jc(e){const t=e.toString();if(qc.hasOwnProperty(t))return qc[t];{const n=hO.pattern(t);return qc[t]=n,n}}function fO(){qc={}}const sy="Complement Sets are not supported for first char optimization",Zc=`Unable to use "first char" lexer optimizations:
`;function dO(e,t=!1){try{const n=Jc(e);return Gh(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===sy)t&&Zg(`${Zc}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),zh(`${Zc}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Gh(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Gh(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Qc(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(sy);Rt(o.value,c=>{if(typeof c=="number")Qc(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Qc(l,t,n);else{for(let l=u.from;l<=u.to&&l<oa;l++)Qc(l,t,n);if(u.to>=oa){const l=u.from>=oa?u.from:oa,h=u.to,f=Di(l),d=Di(h);for(let p=f;p<=d;p++)t[p]=p}}}});break;case"Group":Gh(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Hh(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Fe(t)}function Qc(e,t,n){const r=Di(e);t[r]=r,n===!0&&pO(e,t)}function pO(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Di(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Di(i.charCodeAt(0));t[s]=s}}}function oy(e,t){return Qs(e.value,n=>{if(typeof n=="number")return mn(t,n);{const r=n;return Qs(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Hh(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?te(e.value)?pr(e.value,Hh):Hh(e.value):!1}class mO extends Kh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){mn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?oy(t,this.targetCharCodes)===void 0&&(this.found=!0):oy(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Yh(e,t){if(t instanceof RegExp){const n=Jc(t),r=new mO(e);return r.visit(n),r.found}else return Qs(t,n=>mn(e,n.charCodeAt(0)))!==void 0}const ls="PATTERN",sa="defaultMode",tl="modes";let ay=typeof new RegExp("(?:)").sticky=="boolean";function gO(e,t){t=$h(t,{useSticky:ay,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,v)=>v()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{DO()});let r;n("Reject Lexer.NA",()=>{r=zc(e,T=>T[ls]===Ge.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=kt(r,T=>{const v=T[ls];if(mi(v)){const I=v.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!v.ignoreCase?I:I.length===2&&I[0]==="\\"&&!mn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:t.useSticky?ly(v):cy(v)}else{if(fi(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const I=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(I);return t.useSticky?ly(U):cy(U)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=kt(r,T=>T.tokenTypeIdx),a=kt(r,T=>{const v=T.GROUP;if(v!==Ge.SKIPPED){if(Tn(v))return v;if(gi(v))return!1;throw Error("non exhaustive match")}}),c=kt(r,T=>{const v=T.LONGER_ALT;if(v)return te(v)?kt(v,U=>qg(r,U)):[qg(r,v)]}),u=kt(r,T=>T.PUSH_MODE),l=kt(r,T=>St(T,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const T=fy(t.lineTerminatorCharacters);h=kt(r,v=>!1),t.positionTracking!=="onlyOffset"&&(h=kt(r,v=>St(v,"LINE_BREAKS")?!!v.LINE_BREAKS:hy(v,T)===!1&&Yh(T,v.PATTERN)))});let f,d,p,m;n("Misc Mapping #2",()=>{f=kt(r,uy),d=kt(s,FO),p=An(r,(T,v)=>{const I=v.GROUP;return Tn(I)&&I!==Ge.SKIPPED&&(T[I]=[]),T},{}),m=kt(s,(T,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:f[v],short:d[v],group:a[v],push:u[v],pop:l[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let k=!0,w=[];return t.safeMode||n("First Char Optimization",()=>{w=An(r,(T,v,I)=>{if(typeof v.PATTERN=="string"){const U=v.PATTERN.charCodeAt(0),R=Di(U);Vh(T,R,m[I])}else if(te(v.START_CHARS_HINT)){let U;Rt(v.START_CHARS_HINT,R=>{const L=typeof R=="string"?R.charCodeAt(0):R,B=Di(L);U!==B&&(U=B,Vh(T,B,m[I]))})}else if(mi(v.PATTERN))if(v.PATTERN.unicode)k=!1,t.ensureOptimizations&&zh(`${Zc}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=dO(v.PATTERN,t.ensureOptimizations);pe(U)&&(k=!1),Rt(U,R=>{Vh(T,R,m[I])})}else t.ensureOptimizations&&zh(`${Zc}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),k=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:w,hasCustom:i,canBeOptimized:k}}function yO(e,t){let n=[];const r=bO(e);n=n.concat(r.errors);const i=EO(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(_O(s)),n=n.concat(RO(s)),n=n.concat(IO(s,t)),n=n.concat(NO(s)),n}function _O(e){let t=[];const n=sr(e,r=>mi(r[ls]));return t=t.concat(kO(n)),t=t.concat(AO(n)),t=t.concat(vO(n)),t=t.concat(SO(n)),t=t.concat(xO(n)),t}function bO(e){const t=sr(e,i=>!St(i,ls)),n=kt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Se.MISSING_PATTERN,tokenTypes:[i]})),r=jc(e,t);return{errors:n,valid:r}}function EO(e){const t=sr(e,i=>{const s=i[ls];return!mi(s)&&!fi(s)&&!St(s,"exec")&&!Tn(s)}),n=kt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Se.INVALID_PATTERN,tokenTypes:[i]})),r=jc(e,t);return{errors:n,valid:r}}const wO=/[^\\][$]/;function kO(e){class t extends Kh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=sr(e,i=>{const s=i.PATTERN;try{const o=Jc(s),a=new t;return a.visit(o),a.found}catch{return wO.test(s.source)}});return kt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Se.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function xO(e){const t=sr(e,r=>r.PATTERN.test(""));return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Se.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const TO=/[^\\[][\^]|^\^/;function AO(e){class t extends Kh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=sr(e,i=>{const s=i.PATTERN;try{const o=Jc(s),a=new t;return a.visit(o),a.found}catch{return TO.test(s.source)}});return kt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Se.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function vO(e){const t=sr(e,r=>{const i=r[ls];return i instanceof RegExp&&(i.multiline||i.global)});return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Se.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function SO(e){const t=[];let n=kt(e,s=>An(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!mn(t,a)&&a.PATTERN!==Ge.NA&&(t.push(a),o.push(a)),o),[]));n=ea(n);const r=sr(n,s=>s.length>1);return kt(r,s=>{const o=kt(s,c=>c.name);return{message:`The same RegExp pattern ->${mr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Se.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function RO(e){const t=sr(e,r=>{if(!St(r,"GROUP"))return!1;const i=r.GROUP;return i!==Ge.SKIPPED&&i!==Ge.NA&&!Tn(i)});return kt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Se.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function IO(e,t){const n=sr(e,i=>i.PUSH_MODE!==void 0&&!mn(t,i.PUSH_MODE));return kt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Se.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function NO(e){const t=[],n=An(e,(r,i,s)=>{const o=i.PATTERN;return o===Ge.NA||(Tn(o)?r.push({str:o,idx:s,tokenType:i}):mi(o)&&CO(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Rt(e,(r,i)=>{Rt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&OO(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Se.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function OO(e,t){if(mi(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(fi(t))return t(e,0,[],{});if(St(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function CO(e){return Qs([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function cy(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function ly(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function LO(e,t,n){const r=[];return St(e,sa)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+sa+`> property in its definition
`,type:Se.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),St(e,tl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+tl+`> property in its definition
`,type:Se.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),St(e,tl)&&St(e,sa)&&!St(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${sa}: <${e.defaultMode}>which does not exist
`,type:Se.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),St(e,tl)&&Rt(e.modes,(i,s)=>{Rt(i,(o,a)=>{if(gi(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Se.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(St(o,"LONGER_ALT")){const c=te(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Rt(c,u=>{!gi(u)&&!mn(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:Se.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function MO(e,t,n){const r=[];let i=!1;const s=ea(jn(Fe(e.modes))),o=zc(s,c=>c[ls]===Ge.NA),a=fy(n);return t&&Rt(o,c=>{const u=hy(c,a);if(u!==!1){const h={message:BO(c,u),type:u.issue,tokenType:c};r.push(h)}else St(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Yh(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Se.NO_LINE_BREAKS_FLAGS}),r}function UO(e){const t={},n=rr(e);return Rt(n,r=>{const i=e[r];if(te(i))t[r]=[];else throw Error("non exhaustive match")}),t}function uy(e){const t=e.PATTERN;if(mi(t))return!1;if(fi(t))return!0;if(St(t,"exec"))return!0;if(Tn(t))return!1;throw Error("non exhaustive match")}function FO(e){return Tn(e)&&e.length===1?e.charCodeAt(0):!1}const PO={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function hy(e,t){if(St(e,"LINE_BREAKS"))return!1;if(mi(e.PATTERN)){try{Yh(t,e.PATTERN)}catch(n){return{issue:Se.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Tn(e.PATTERN))return!1;if(uy(e))return{issue:Se.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function BO(e,t){if(t.issue===Se.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Se.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function fy(e){return kt(e,n=>Tn(n)?n.charCodeAt(0):n)}function Vh(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const oa=256;let el=[];function Di(e){return e<oa?e:el[e]}function DO(){if(pe(el)){el=new Array(65536);for(let e=0;e<65536;e++)el[e]=e>255?255+~~(e/255):e}}function aa(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function nl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let dy=1;const py={};function ca(e){const t=$O(e);jO(t),WO(t),zO(t),Rt(t,n=>{n.isParent=n.categoryMatches.length>0})}function $O(e){let t=rn(e),n=e,r=!0;for(;r;){n=ea(jn(kt(n,s=>s.CATEGORIES)));const i=jc(n,t);t=t.concat(i),pe(i)?r=!1:n=i}return t}function jO(e){Rt(e,t=>{gy(t)||(py[dy]=t,t.tokenTypeIdx=dy++),yy(t)&&!te(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),yy(t)||(t.CATEGORIES=[]),KO(t)||(t.categoryMatches=[]),GO(t)||(t.categoryMatchesMap={})})}function zO(e){Rt(e,t=>{t.categoryMatches=[],Rt(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(py[r].tokenTypeIdx)})})}function WO(e){Rt(e,t=>{my([],t)})}function my(e,t){Rt(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Rt(t.CATEGORIES,n=>{const r=e.concat(t);mn(r,n)||my(r,n)})}function gy(e){return St(e,"tokenTypeIdx")}function yy(e){return St(e,"CATEGORIES")}function KO(e){return St(e,"categoryMatches")}function GO(e){return St(e,"categoryMatchesMap")}function HO(e){return St(e,"tokenTypeIdx")}const YO={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Se;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Se||(Se={}));const la={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:YO,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(la);let Ge=class{constructor(t,n=la){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Qg(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=xn({},la,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===la.lineTerminatorsPattern)this.config.lineTerminatorsPattern=PO;else if(this.config.lineTerminatorCharacters===la.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),te(t)?i={modes:{defaultMode:rn(t)},defaultMode:sa}:(s=!1,i=rn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(LO(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(MO(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Rt(i.modes,(a,c)=>{i.modes[c]=zc(a,u=>gi(u))});const o=rr(i.modes);if(Rt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(yO(a,o))}),pe(this.lexerDefinitionErrors)){ca(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=gO(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=xn({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!pe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=kt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Rt(this.lexerDefinitionWarning,a=>{Zg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(ay?(this.chopInput=Xs,this.match=this.matchWithTest):(this.updateLastIndex=We,this.match=this.matchWithExec),s&&(this.handleModes=We),this.trackStartLines===!1&&(this.computeNewColumn=Xs),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=We),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=An(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!pe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{fO()}),this.TRACE_INIT("toFastProperties",()=>{ty(this)})})}tokenize(t,n=this.defaultMode){if(!pe(this.lexerDefinitionErrors)){const i=kt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,f,d,p,m,k,w;const T=t,v=T.length;let I=0,U=0;const R=this.hasCustom?0:Math.floor(t.length/10),L=new Array(R),B=[];let O=this.trackStartLines?1:void 0,Y=this.trackStartLines?1:void 0;const et=UO(this.emptyGroups),C=this.trackStartLines,S=this.config.lineTerminatorsPattern;let b=0,P=[],X=[];const D=[],ct=[];Object.freeze(ct);let tt;function ft(){return P}function V(Lt){const Xt=Di(Lt),Mt=X[Xt];return Mt===void 0?ct:Mt}const z=Lt=>{if(D.length===1&&Lt.tokenType.PUSH_MODE===void 0){const Xt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Lt);B.push({offset:Lt.startOffset,line:Lt.startLine,column:Lt.startColumn,length:Lt.image.length,message:Xt})}else{D.pop();const Xt=Zs(D);P=this.patternIdxToConfig[Xt],X=this.charCodeToPatternIdxToConfig[Xt],b=P.length;const Mt=this.canModeBeOptimized[Xt]&&this.config.safeMode===!1;X&&Mt?tt=V:tt=ft}};function Et(Lt){D.push(Lt),X=this.charCodeToPatternIdxToConfig[Lt],P=this.patternIdxToConfig[Lt],b=P.length,b=P.length;const Xt=this.canModeBeOptimized[Lt]&&this.config.safeMode===!1;X&&Xt?tt=V:tt=ft}Et.call(this,n);let ot;const lt=this.config.recoveryEnabled;for(;I<v;){c=null;const Lt=T.charCodeAt(I),Xt=tt(Lt),Mt=Xt.length;for(r=0;r<Mt;r++){ot=Xt[r];const xt=ot.pattern;u=null;const Bt=ot.short;if(Bt!==!1?Lt===Bt&&(c=xt):ot.isCustom===!0?(w=xt.exec(T,I,L,et),w!==null?(c=w[0],w.payload!==void 0&&(u=w.payload)):c=null):(this.updateLastIndex(xt,I),c=this.match(xt,t,I)),c!==null){if(a=ot.longerAlt,a!==void 0){const Ut=a.length;for(s=0;s<Ut;s++){const we=P[a[s]],Ie=we.pattern;if(l=null,we.isCustom===!0?(w=Ie.exec(T,I,L,et),w!==null?(o=w[0],w.payload!==void 0&&(l=w.payload)):o=null):(this.updateLastIndex(Ie,I),o=this.match(Ie,t,I)),o&&o.length>c.length){c=o,u=l,ot=we;break}}}break}}if(c!==null){if(h=c.length,f=ot.group,f!==void 0&&(d=ot.tokenTypeIdx,p=this.createTokenInstance(c,I,d,ot.tokenType,O,Y,h),this.handlePayload(p,u),f===!1?U=this.addToken(L,U,p):et[f].push(p)),t=this.chopInput(t,h),I=I+h,Y=this.computeNewColumn(Y,h),C===!0&&ot.canLineTerminator===!0){let xt=0,Bt,Ut;S.lastIndex=0;do Bt=S.test(c),Bt===!0&&(Ut=S.lastIndex-1,xt++);while(Bt===!0);xt!==0&&(O=O+xt,Y=h-Ut,this.updateTokenEndLineColumnLocation(p,f,Ut,xt,O,Y,h))}this.handleModes(ot,z,Et,p)}else{const xt=I,Bt=O,Ut=Y;let we=lt===!1;for(;we===!1&&I<v;)for(t=this.chopInput(t,1),I++,i=0;i<b;i++){const Ie=P[i],E=Ie.pattern,st=Ie.short;if(st!==!1?T.charCodeAt(I)===st&&(we=!0):Ie.isCustom===!0?we=E.exec(T,I,L,et)!==null:(this.updateLastIndex(E,I),we=E.exec(t)!==null),we===!0)break}if(m=I-xt,Y=this.computeNewColumn(Y,m),k=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,xt,m,Bt,Ut),B.push({offset:xt,line:Bt,column:Ut,length:m,message:k}),lt===!1)break}}return this.hasCustom||(L.length=U),{tokens:L,groups:et,errors:B}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};Ge.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Ge.NA=/NOT_APPLICABLE/;function ua(e){return _y(e)?e.LABEL:e.name}function _y(e){return Tn(e.LABEL)&&e.LABEL!==""}const VO="parent",by="categories",Ey="label",wy="group",ky="push_mode",xy="pop_mode",Ty="longer_alt",Ay="line_breaks",vy="start_chars_hint";function zn(e){return XO(e)}function XO(e){const t=e.pattern,n={};if(n.name=e.name,gi(t)||(n.PATTERN=t),St(e,VO))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return St(e,by)&&(n.CATEGORIES=e[by]),ca([n]),St(e,Ey)&&(n.LABEL=e[Ey]),St(e,wy)&&(n.GROUP=e[wy]),St(e,xy)&&(n.POP_MODE=e[xy]),St(e,ky)&&(n.PUSH_MODE=e[ky]),St(e,Ty)&&(n.LONGER_ALT=e[Ty]),St(e,Ay)&&(n.LINE_BREAKS=e[Ay]),St(e,vy)&&(n.START_CHARS_HINT=e[vy]),n}const us=zn({name:"EOF",pattern:Ge.NA});ca([us]);function rl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function qO(e,t){return aa(e,t)}const Sy={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${_y(e)?`--> ${ua(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+mr(t).image+"'";if(r)return s+r+a;{const c=An(e,(f,d)=>f.concat(d),[]),u=kt(c,f=>`[${kt(f,d=>ua(d)).join(", ")}]`),h=`one of these possible Token sequences:
${kt(u,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+mr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${kt(e,u=>`[${kt(u,l=>ua(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Sy);const JO={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},hs={buildDuplicateFoundError(e,t){function n(l){return l instanceof Ae?l.terminalType.name:l instanceof vn?l.nonTerminalName:""}const r=e.name,i=mr(t),s=i.idx,o=Kr(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=kt(e.prefixPath,i=>ua(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=kt(e.prefixPath,i=>ua(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Kr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=kt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof to?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function ZO(e,t){const n=new QO(e,t);return n.resolveRefs(),n.errors}class QO extends cs{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Rt(Fe(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:gn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class tC extends Hc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=rn(this.path.ruleStack).reverse(),this.occurrenceStack=rn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){pe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class eC extends tC{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Sn({definition:i});this.possibleTokTypes=ra(s),this.found=!0}}}class il extends Hc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class nC extends il{walkMany(t,n,r){if(t.idx===this.occurrence){const i=mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class Ry extends il{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class rC extends il{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Iy extends il{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Xh(e,t,n=[]){n=rn(n);let r=[],i=0;function s(a){return a.concat(sn(e,i+1))}function o(a){const c=Xh(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Sn)return o(a.definition);if(a instanceof vn)return o(a.definition);if(a instanceof Rn)r=o(a.definition);else if(a instanceof zr){const c=a.definition.concat([new Ke({definition:a.definition})]);return o(c)}else if(a instanceof Wr){const c=[new Sn({definition:a.definition}),new Ke({definition:[new Ae({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof yr){const c=a.definition.concat([new Ke({definition:[new Ae({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Ke){const c=a.definition.concat([new Ke({definition:a.definition})]);r=o(c)}else{if(a instanceof _r)return Rt(a.definition,c=>{pe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Ae)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:sn(e,i)}),r}function Ny(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!pe(h);){const f=h.pop();if(f===o){a&&Zs(h).idx<=u&&h.pop();continue}const d=f.def,p=f.idx,m=f.ruleStack,k=f.occurrenceStack;if(pe(d))continue;const w=d[0];if(w===i){const T={idx:p,def:sn(d),ruleStack:na(m),occurrenceStack:na(k)};h.push(T)}else if(w instanceof Ae)if(p<c-1){const T=p+1,v=t[T];if(n(v,w.terminalType)){const I={idx:T,def:sn(d),ruleStack:m,occurrenceStack:k};h.push(I)}}else if(p===c-1)l.push({nextTokenType:w.terminalType,nextTokenOccurrence:w.idx,ruleStack:m,occurrenceStack:k}),a=!0;else throw Error("non exhaustive match");else if(w instanceof vn){const T=rn(m);T.push(w.nonTerminalName);const v=rn(k);v.push(w.idx);const I={idx:p,def:w.definition.concat(s,sn(d)),ruleStack:T,occurrenceStack:v};h.push(I)}else if(w instanceof Rn){const T={idx:p,def:sn(d),ruleStack:m,occurrenceStack:k};h.push(T),h.push(o);const v={idx:p,def:w.definition.concat(sn(d)),ruleStack:m,occurrenceStack:k};h.push(v)}else if(w instanceof zr){const T=new Ke({definition:w.definition,idx:w.idx}),v=w.definition.concat([T],sn(d)),I={idx:p,def:v,ruleStack:m,occurrenceStack:k};h.push(I)}else if(w instanceof Wr){const T=new Ae({terminalType:w.separator}),v=new Ke({definition:[T].concat(w.definition),idx:w.idx}),I=w.definition.concat([v],sn(d)),U={idx:p,def:I,ruleStack:m,occurrenceStack:k};h.push(U)}else if(w instanceof yr){const T={idx:p,def:sn(d),ruleStack:m,occurrenceStack:k};h.push(T),h.push(o);const v=new Ae({terminalType:w.separator}),I=new Ke({definition:[v].concat(w.definition),idx:w.idx}),U=w.definition.concat([I],sn(d)),R={idx:p,def:U,ruleStack:m,occurrenceStack:k};h.push(R)}else if(w instanceof Ke){const T={idx:p,def:sn(d),ruleStack:m,occurrenceStack:k};h.push(T),h.push(o);const v=new Ke({definition:w.definition,idx:w.idx}),I=w.definition.concat([v],sn(d)),U={idx:p,def:I,ruleStack:m,occurrenceStack:k};h.push(U)}else if(w instanceof _r)for(let T=w.definition.length-1;T>=0;T--){const v=w.definition[T],I={idx:p,def:v.definition.concat(sn(d)),ruleStack:m,occurrenceStack:k};h.push(I),h.push(o)}else if(w instanceof Sn)h.push({idx:p,def:w.definition.concat(sn(d)),ruleStack:m,occurrenceStack:k});else if(w instanceof to)h.push(iC(w,p,m,k));else throw Error("non exhaustive match")}return l}function iC(e,t,n,r){const i=rn(n);i.push(e.name);const s=rn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Re;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Re||(Re={}));function Oy(e){if(e instanceof Rn||e==="Option")return Re.OPTION;if(e instanceof Ke||e==="Repetition")return Re.REPETITION;if(e instanceof zr||e==="RepetitionMandatory")return Re.REPETITION_MANDATORY;if(e instanceof Wr||e==="RepetitionMandatoryWithSeparator")return Re.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof yr||e==="RepetitionWithSeparator")return Re.REPETITION_WITH_SEPARATOR;if(e instanceof _r||e==="Alternation")return Re.ALTERNATION;throw Error("non exhaustive match")}function sC(e,t,n,r,i,s){const o=Jh(e,t,n),a=Uy(o)?nl:aa;return s(o,r,a,i)}function oC(e,t,n,r,i,s){const o=Zh(e,t,i,n),a=Uy(o)?nl:aa;return s(o[0],a,r)}function aC(e,t,n,r){const i=e.length,s=pr(e,o=>pr(o,a=>a.length===1));if(t)return function(o){const a=kt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let f=0;f<l;f++){const d=u[f],p=d.length;for(let m=0;m<p;m++){const k=this.LA(m+1);if(n(k,d[m])===!1)continue t}return c}}};if(s&&!r){const o=kt(e,c=>jn(c)),a=An(o,(c,u,l)=>(Rt(u,h=>{St(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),Rt(h.categoryMatches,f=>{St(c,f)||(c[f]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,l[f])===!1)continue t}return o}}}}function cC(e,t,n){const r=pr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=jn(e);if(s.length===1&&pe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=An(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,Rt(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class lC extends Hc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Re.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Re.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Re.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Re.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Re.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Cy extends cs{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Re.OPTION)}visitRepetition(t){this.checkIsTarget(t,Re.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Re.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Re.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Re.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Re.ALTERNATION)}}function Ly(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function qh(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function uC(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function My(e,t){const n=kt(e,o=>Xh([o],1)),r=Ly(n.length),i=kt(n,o=>{const a={};return Rt(o,c=>{const u=qh(c.partialPath);Rt(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=Ly(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,f=u[l].suffixDef,d=qh(h);if(uC(i,d,c)||pe(f)||h.length===t){const m=r[c];if(Qh(m,h)===!1){m.push(h);for(let k=0;k<d.length;k++){const w=d[k];i[c][w]=!0}}}else{const m=Xh(f,o+1,h);s[c]=s[c].concat(m),Rt(m,k=>{const w=qh(k.partialPath);Rt(w,T=>{i[c][T]=!0})})}}}}return r}function Jh(e,t,n,r){const i=new Cy(e,Re.ALTERNATION,r);return t.accept(i),My(i.result,n)}function Zh(e,t,n,r){const i=new Cy(e,n);t.accept(i);const s=i.result,a=new lC(t,e,n).startWalking(),c=new Sn({definition:s}),u=new Sn({definition:a});return My([c,u],r)}function Qh(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function hC(e,t){return e.length<t.length&&pr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Uy(e){return pr(e,t=>pr(t,n=>pr(n,r=>pe(r.categoryMatches))))}function fC(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return kt(t,n=>Object.assign({type:gn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function dC(e,t,n,r){const i=or(e,c=>pC(c,n)),s=vC(e,t,n),o=or(e,c=>kC(c,n)),a=or(e,c=>yC(c,e,r,n));return i.concat(s,o,a)}function pC(e,t){const n=new gC;e.accept(n);const r=n.allProductions,i=Xg(r,mC),s=gr(i,a=>a.length>1);return kt(Fe(s),a=>{const c=mr(a),u=t.buildDuplicateFoundError(e,a),l=Kr(c),h={message:u,type:gn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},f=Fy(c);return f&&(h.parameter=f),h})}function mC(e){return`${Kr(e)}_#_${e.idx}_#_${Fy(e)}`}function Fy(e){return e instanceof Ae?e.terminalType.name:e instanceof vn?e.nonTerminalName:""}class gC extends cs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function yC(e,t,n,r){const i=[];if(An(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:gn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function _C(e,t,n){const r=[];let i;return mn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:gn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Py(e,t,n,r=[]){const i=[],s=sl(t.definition);if(pe(s))return[];{const o=e.name;mn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:gn.LEFT_RECURSION,ruleName:o});const c=jc(s,r.concat([e])),u=or(c,l=>{const h=rn(r);return h.push(l),Py(e,l,n,h)});return i.concat(u)}}function sl(e){let t=[];if(pe(e))return t;const n=mr(e);if(n instanceof vn)t.push(n.referencedRule);else if(n instanceof Sn||n instanceof Rn||n instanceof zr||n instanceof Wr||n instanceof yr||n instanceof Ke)t=t.concat(sl(n.definition));else if(n instanceof _r)t=jn(kt(n.definition,s=>sl(s.definition)));else if(!(n instanceof Ae))throw Error("non exhaustive match");const r=Gc(n),i=e.length>1;if(r&&i){const s=sn(e);return t.concat(sl(s))}else return t}class tf extends cs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function bC(e,t){const n=new tf;e.accept(n);const r=n.alternations;return or(r,s=>{const o=na(s.definition);return or(o,(a,c)=>{const u=Ny([a],[],aa,1);return pe(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:gn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function EC(e,t,n){const r=new tf;e.accept(r);let i=r.alternations;return i=zc(i,o=>o.ignoreAmbiguities===!0),or(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=Jh(a,e,c,o),l=TC(u,o,e,n),h=AC(u,o,e,n);return l.concat(h)})}class wC extends cs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function kC(e,t){const n=new tf;e.accept(n);const r=n.alternations;return or(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:gn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function xC(e,t,n){const r=[];return Rt(e,i=>{const s=new wC;i.accept(s);const o=s.allProductions;Rt(o,a=>{const c=Oy(a),u=a.maxLookahead||t,l=a.idx,f=Zh(l,i,c,u)[0];if(pe(jn(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:gn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function TC(e,t,n,r){const i=[],s=An(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||Rt(c,l=>{const h=[u];Rt(e,(f,d)=>{u!==d&&Qh(f,l)&&t.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!Qh(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return kt(s,a=>{const c=kt(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:gn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function AC(e,t,n,r){const i=An(e,(o,a,c)=>{const u=kt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return ea(or(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=sr(i,f=>t.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&hC(f.path,u));return kt(l,f=>{const d=[f.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:d,prefixPath:f.path}),type:gn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function vC(e,t,n){const r=[],i=kt(t,s=>s.name);return Rt(e,s=>{const o=s.name;if(mn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:gn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function SC(e){const t=$h(e,{errMsgProvider:JO}),n={};return Rt(e.rules,r=>{n[r.name]=r}),ZO(n,t.errMsgProvider)}function RC(e){return e=$h(e,{errMsgProvider:hs}),dC(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const By="MismatchedTokenException",Dy="NoViableAltException",$y="EarlyExitException",jy="NotAllInputParsedException",zy=[By,Dy,$y,jy];Object.freeze(zy);function ol(e){return mn(zy,e.name)}class al extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Wy extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=By}}class IC extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Dy}}class NC extends al{constructor(t,n){super(t,n),this.name=jy}}class OC extends al{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=$y}}const ef={},Ky="InRuleRecoveryException";class CC extends Error{constructor(t){super(t),this.name=Ky}}class LC{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=St(t,"recoveryEnabled")?t.recoveryEnabled:yi.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=MC)}getTokenToInsert(t){const n=rl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:f,ruleName:this.getCurrRuleFullName()}),p=new Wy(d,u,this.LA(0));p.resyncedTokens=na(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new CC("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||pe(n))return!1;const r=this.LA(1);return Qs(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return mn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Qs(t,s=>qO(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return ef;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return kt(t,(r,i)=>i===0?ef:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=kt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return jn(t)}getFollowSetFromFollowKey(t){if(t===ef)return[us];const n=t.ruleName+t.idxInCallingRule+ny+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,us)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return na(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=rn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return kt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function MC(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=us,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const UC=4,$i=8,Gy=1<<$i,Hy=2<<$i,nf=3<<$i,rf=4<<$i,sf=5<<$i,cl=6<<$i;function of(e,t,n){return n|t|e}class FC{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:yi.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(pe(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return or(t,n=>Py(n,n,hs))}validateEmptyOrAlternatives(t){return or(t,n=>bC(n,hs))}validateAmbiguousAlternationAlternatives(t,n){return or(t,r=>EC(r,n,hs))}validateSomeNonEmptyLookaheadPath(t,n){return xC(t,n,hs)}buildLookaheadForAlternation(t){return sC(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,aC)}buildLookaheadForOptional(t){return oC(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Oy(t.prodType),cC)}}class PC{initLooksAhead(t){this.dynamicTokensEnabled=St(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:yi.dynamicTokensEnabled,this.maxLookahead=St(t,"maxLookahead")?t.maxLookahead:yi.maxLookahead,this.lookaheadStrategy=St(t,"lookaheadStrategy")?t.lookaheadStrategy:new FC({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Rt(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=DC(n);Rt(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Kr(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=of(this.fullRuleNameToShort[n.name],Gy,u.idx);this.setLaFuncCache(f,h)})}),Rt(i,u=>{this.computeLookaheadFunc(n,u.idx,nf,"Repetition",u.maxLookahead,Kr(u))}),Rt(s,u=>{this.computeLookaheadFunc(n,u.idx,Hy,"Option",u.maxLookahead,Kr(u))}),Rt(o,u=>{this.computeLookaheadFunc(n,u.idx,rf,"RepetitionMandatory",u.maxLookahead,Kr(u))}),Rt(a,u=>{this.computeLookaheadFunc(n,u.idx,cl,"RepetitionMandatoryWithSeparator",u.maxLookahead,Kr(u))}),Rt(c,u=>{this.computeLookaheadFunc(n,u.idx,sf,"RepetitionWithSeparator",u.maxLookahead,Kr(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=of(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return of(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class BC extends cs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const ll=new BC;function DC(e){ll.reset(),e.accept(ll);const t=ll.dslMethods;return ll.reset(),t}function Yy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Vy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function $C(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function jC(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const zC="name";function Xy(e,t){Object.defineProperty(e,zC,{enumerable:!1,configurable:!0,writable:!1,value:t})}function WC(e,t){const n=rr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function KC(e,t){const n=function(){};Xy(n,e+"BaseSemantics");const r={visit:function(i,s){if(te(i)&&(i=i[0]),!gi(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=HC(this,t);if(!pe(i)){const s=kt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function GC(e,t,n){const r=function(){};Xy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Rt(t,s=>{i[s]=WC}),r.prototype=i,r.prototype.constructor=r,r}var af;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(af||(af={}));function HC(e,t){return YC(e,t)}function YC(e,t){const n=sr(t,i=>fi(e[i])===!1),r=kt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:af.MISSING_METHOD,methodName:i}));return ea(r)}class VC{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=St(t,"nodeLocationTracking")?t.nodeLocationTracking:yi.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=We,this.cstFinallyStateUpdate=We,this.cstPostTerminal=We,this.cstPostNonTerminal=We,this.cstPostRule=We;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Vy,this.setNodeLocationFromNode=Vy,this.cstPostRule=We,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Yy,this.setNodeLocationFromNode=Yy,this.cstPostRule=We,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=We,this.setNodeLocationFromNode=We,this.cstPostRule=We,this.setInitialNodeLocation=We;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];$C(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];jC(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(gi(this.baseCstVisitorConstructor)){const t=KC(this.className,rr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(gi(this.baseCstVisitorWithDefaultsConstructor)){const t=GC(this.className,rr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class XC{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):fl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?fl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class qC{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=dl){if(mn(this.definedRulesNames,t)){const o={message:hs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:gn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=dl){const i=_C(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(ol(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return ZN(Fe(this.gastProductionsCache))}}class JC{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=nl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},St(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(te(t)){if(pe(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(te(t))this.tokensMap=An(t,(s,o)=>(s[o.name]=o,s),{});else if(St(t,"modes")&&pr(jn(Fe(t.modes)),HO)){const s=jn(Fe(t.modes)),o=Wc(s);this.tokensMap=An(o,(a,c)=>(a[c.name]=c,a),{})}else if(nr(t))this.tokensMap=rn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=us;const r=St(t,"modes")?jn(Fe(t.modes)):Fe(t),i=pr(r,s=>pe(s.categoryMatches));this.tokenMatcher=i?nl:aa,ca(Fe(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=St(r,"resyncEnabled")?r.resyncEnabled:dl.resyncEnabled,s=St(r,"recoveryValueFunc")?r.recoveryValueFunc:dl.recoveryValueFunc,o=this.ruleShortNameIdx<<UC+$i;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(ol(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Hy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(rf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Re.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,rf,t,rC)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(cl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Iy],a,cl,t,Iy)}else throw this.raiseEarlyExitException(t,Re.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(nf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,nf,t,nC,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(sf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Ry],a,sf,t,Ry)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,cl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Gy,n),i=te(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new NC(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw ol(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Wy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Ky?r:s}}else throw r}saveRecogState(){const t=this.errors,n=rn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),us)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class ZC{initErrorHandler(t){this._errors=[],this.errorMessageProvider=St(t,"errorMessageProvider")?t.errorMessageProvider:yi.errorMessageProvider}SAVE_ERROR(t){if(ol(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:rn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return rn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Zh(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new OC(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Jh(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new IC(c,this.LA(1),a))}}class QC{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(gi(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Ny([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=mr(t.ruleStack),i=this.getGAstProductions()[n];return new eC(i,t).startWalking()}}const ul={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ul);const qy=!0,Jy=Math.pow(2,$i)-1,Zy=zn({name:"RECORDING_PHASE_TOKEN",pattern:Ge.NA});ca([Zy]);const Qy=rl(Zy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Qy);const tL={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class eL{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return fl}topLevelRuleRecord(t,n){try{const r=new to({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return ha.call(this,Rn,t,n)}atLeastOneInternalRecord(t,n){ha.call(this,zr,n,t)}atLeastOneSepFirstInternalRecord(t,n){ha.call(this,Wr,n,t,qy)}manyInternalRecord(t,n){ha.call(this,Ke,n,t)}manySepFirstInternalRecord(t,n){ha.call(this,yr,n,t,qy)}orInternalRecord(t,n){return nL.call(this,t,n)}subruleInternalRecord(t,n,r){if(hl(n),!t||St(t,"ruleName")===!1){const a=new Error(`<SUBRULE${t_(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Zs(this.recordingProdStack),s=t.ruleName,o=new vn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?tL:ul}consumeInternalRecord(t,n,r){if(hl(n),!gy(t)){const o=new Error(`<CONSUME${t_(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Zs(this.recordingProdStack),s=new Ae({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Qy}}function ha(e,t,n,r=!1){hl(n);const i=Zs(this.recordingProdStack),s=fi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),St(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),ul}function nL(e,t){hl(t);const n=Zs(this.recordingProdStack),r=te(e)===!1,i=r===!1?e:e.DEF,s=new _r({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});St(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=jh(i,a=>fi(a.GATE));return s.hasPredicates=o,n.definition.push(s),Rt(i,a=>{const c=new Sn({definition:[]});s.definition.push(c),St(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:St(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),ul}function t_(e){return e===0?"":`${e}`}function hl(e){if(e<0||e>Jy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Jy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class rL{initPerformanceTracer(t){if(St(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=yi.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=Qg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function iL(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const fl=rl(us,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(fl);const yi=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Sy,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),dl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var gn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(gn||(gn={}));let cf=class a1{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{ty(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Rt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=SC({rules:Fe(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(pe(r)&&this.skipValidations===!1){const i=RC({rules:Fe(this.gastProductionsCache),tokenTypes:Fe(this.tokensMap),errMsgProvider:hs,grammarName:n}),s=fC({lookaheadStrategy:this.lookaheadStrategy,rules:Fe(this.gastProductionsCache),tokenTypes:Fe(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),pe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=sO(Fe(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Fe(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Fe(this.gastProductionsCache))})),!a1.DEFER_DEFINITION_ERRORS_HANDLING&&!pe(this.definitionErrors))throw t=kt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),St(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=St(n,"skipValidations")?n.skipValidations:yi.skipValidations}};cf.DEFER_DEFINITION_ERRORS_HANDLING=!1,iL(cf,[LC,PC,VC,XC,JC,qC,ZC,QC,eL,rL]);class sL extends cf{constructor(t,n=yi){const r=rn(n);r.outputCst=!0,super(t,r)}}function oL(e){const t=new aL,n=Fe(e);return kt(n,r=>t.visitRule(r))}class aL extends cs{visitRule(t){const n=this.visitEach(t.definition),r=Xg(n,s=>s.propertyName),i=kt(r,(s,o)=>{const a=!jh(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=kt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:pl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:pl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:pl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:pl(t)}]}visitEachAndOverrideWith(t,n){return kt(this.visitEach(t),r=>xn({},r,n))}visitEach(t){return jn(kt(t,n=>this.visit(n)))}}function pl(e){return e instanceof vn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function cL(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(jn(kt(e,r=>lL(r)))),t.includeVisitorInterface&&(n=n.concat(dL(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function lL(e){const t=uL(e),n=hL(e);return[t,n]}function uL(e){const t=n_(e.name),n=lf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function hL(e){return`export type ${lf(e.name)} = {
  ${kt(e.properties,n=>fL(n)).join(`
  `)}
};`}function fL(e){const t=mL(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function dL(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${kt(t,n=>pL(n)).join(`
  `)}
}`}function pL(e){const t=lf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function mL(e){if(te(e)){const t=Wc(kt(e,r=>e_(r)));return"("+An(t,(r,i)=>r+" | "+i)+")"}else return e_(e)}function e_(e){return e.kind==="token"?"IToken":n_(e.name)}function n_(e){return yg(e)+"CstNode"}function lf(e){return yg(e)+"CstChildren"}const gL={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function yL(e,t){const n=Object.assign(Object.assign({},gL),t),r=oL(e);return cL(r,n)}const ml=$p(32,126).map(e=>String.fromCharCode(e));function Kt(e){return zn({...e,name:`token_${e.name}`})}function Gr(e,t=!1){return Kt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on,group:Ge.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on})}const fa=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),_L=Kt({name:"whitespace",pattern:/ +/,group:Ge.SKIPPED}),bL=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Ge.SKIPPED}),uf=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),no=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let r_=!1;function EL(e,t,n){if(!r_)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==fa)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const hf=Kt({name:"text",pattern:EL,line_breaks:!1,start_chars_hint:ml.filter(e=>"@#/?':!".includes(e)===!1)}),i_=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),s_=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),o_=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),a_=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),on=Kt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:ml}),c_=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),l_=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),u_=Kt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:on}),h_=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:on}),f_=Kt({name:"islessthan",pattern:/<|below/,longer_alt:on}),d_=Kt({name:"isgreaterthan",pattern:/>|above/,longer_alt:on}),p_=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:on}),m_=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:on}),ff=Kt({name:"or",pattern:/or/i,longer_alt:on}),df=Kt({name:"not",pattern:/not/i,longer_alt:on}),pf=Kt({name:"and",pattern:/and/i,longer_alt:on}),mf=Kt({name:"plus",pattern:/\+/}),gf=Kt({name:"minus",pattern:/-/}),g_=Kt({name:"power",pattern:/\*\*/}),y_=Kt({name:"multiply",pattern:/\*/}),yf=Kt({name:"divide",pattern:/\//}),__=Kt({name:"moddivide",pattern:/%/}),b_=Kt({name:"floordivide",pattern:/%%/}),E_=Kt({name:"query",pattern:/\?/}),w_=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),k_=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),x_=Kt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:ml,longer_alt:on}),T_=Kt({name:"command_toast",pattern:/toast .*/,start_chars_hint:ml,longer_alt:on}),_f=Kt({name:"if",pattern:/if|try|take|give/,longer_alt:on}),gl=Gr("do"),wL=Gr("to",!0),bf=Gr("done"),kL=Gr("then",!0),Ef=Gr("else"),A_=Gr("while"),v_=Gr("repeat"),S_=Gr("waitfor"),R_=Kt({name:"foreach",pattern:/foreach|for/,longer_alt:on}),I_=Gr("break"),N_=Gr("continue");function O_(e){return[...e,l_,u_,h_,p_,f_,m_,d_,ff,df,pf,mf,gf,g_,y_,yf,b_,__,E_,w_,k_,c_,on]}const C_=O_([hf,uf,x_,T_,no,i_,s_,o_,a_,fa,_L,I_,N_,bf,gl,Ef,R_,_f,v_,kL,wL,S_,A_]),xL=new Ge({defaultMode:"use_newlines",modes:{use_newlines:C_,ignore_newlines:O_([bL])}},{skipValidations:!Mr,ensureOptimizations:Mr});function wf(e){r_=!0;const t=xL.tokenize(e||` 
`),[n]=(ne(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(rl(fa,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function TL(e,t,n=!0){if(n){const[r,...i]=t;switch(Ot(r??"")){default:return{type:wt.OBJECT,values:t};case"loader":return{type:wt.LOADER,values:i};case"board":return{type:wt.BOARD,values:i};case"object":return{type:wt.OBJECT,values:i};case"terrain":return{type:wt.TERRAIN,values:i};case"charset":return{type:wt.CHARSET,values:i};case"palette":return{type:wt.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Ot(i??""),a=[r,e,...s];switch(o){default:return{type:wt.CONST,values:t};case"rn":case"range":return{type:wt.RANGE,values:a};case"sl":case"select":return{type:wt.SELECT,values:a};case"nm":case"number":return{type:wt.NUMBER,values:a};case"tx":case"text":return{type:wt.TEXT,values:a};case"ln":case"link":return{type:wt.LINK,values:a};case"hk":case"hotkey":return{type:wt.HOTKEY,values:a};case"copyit":return{type:wt.COPYIT,values:a};case"openit":return{type:wt.OPENIT,values:a};case"zssedit":return{type:wt.ZSSEDIT,values:a};case"charedit":return{type:wt.CHAREDIT,values:a};case"coloredit":return{type:wt.COLOREDIT,values:a}}}}function Wn(e){switch(e){case wt.LOADER:return"loader";case wt.BOARD:return"board";case wt.OBJECT:return"object";case wt.TERRAIN:return"terrain";case wt.CHARSET:return"charset";case wt.PALETTE:return"palette";case wt.CONST:return"const";case wt.RANGE:return"range";case wt.SELECT:return"select";case wt.NUMBER:return"number";case wt.TEXT:return"text";case wt.LINK:return"link";case wt.HOTKEY:return"hotkey";case wt.COPYIT:return"copyit";case wt.OPENIT:return"openit";case wt.ZSSEDIT:return"zssedit";case wt.CHAREDIT:return"charedit";case wt.COLOREDIT:return"coloredit"}}var kf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(kf||{});function L_(e){return Vs(e,kf,{bits:t=>Array.from(t)})}function M_(e){return Go(e,kf,{bits:t=>new Uint8Array(t)})}function AL(e,t){return{id:Ne(),code:e,...t}}var xf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(xf||{});function vL(e){return Vs(e,xf,{board:QM,object:Tc,terrain:Tc,charset:L_,palette:L_,stats:Le})}function SL(e){return Go(e,xf,{board:t8,object:Ac,terrain:Ac,charset:M_,palette:M_})}function da(e){const t={...fs(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function RL(e){return x(e)?(e.stats=void 0,fs(e)):{}}function U_(e){const t=wf(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===uf){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),u=a.split(" "),l=TL(At(c)?c:"",u,r),h=Ot(l.values.join(" "));switch(r=!1,l.type){case wt.LOADER:n.type=bt.LOADER,n.name=h;break;case wt.BOARD:n.type=bt.BOARD,n.name=h;break;case wt.OBJECT:n.type=bt.OBJECT,n.name=h||"object";break;case wt.TERRAIN:n.type=bt.TERRAIN,n.name=h;break;case wt.CHARSET:n.type=bt.CHARSET,n.name=h;break;case wt.PALETTE:n.type=bt.PALETTE,n.name=h;break;case wt.CONST:{const[f,d]=l.values;if(At(f)){const p=Ot(f);if(At(d)){const m=parseFloat(d);n[p]=Ct(m)?m:d}else Ct(d)?n[p]=d:n[p]=1}break}case wt.RANGE:case wt.SELECT:case wt.NUMBER:case wt.TEXT:case wt.LINK:case wt.HOTKEY:case wt.ZSSEDIT:case wt.CHAREDIT:case wt.COLOREDIT:{const[f,...d]=l.values;if(At(f)){const p=Ot(f);n[p]=[Wn(l.type),...d]}break}}}}return n}function fs(e){var t;return x(e)?(x((t=e.stats)==null?void 0:t.type)||(e.stats=U_(e.code),x(e.stats.type)||(e.stats.type=bt.OBJECT)),e.stats):{}}function F_(e){switch(e){default:case bt.ERROR:return"error";case bt.LOADER:return Wn(wt.LOADER);case bt.BOARD:return Wn(wt.BOARD);case bt.OBJECT:return Wn(wt.OBJECT);case bt.TERRAIN:return Wn(wt.TERRAIN);case bt.CHARSET:return Wn(wt.CHARSET);case bt.PALETTE:return Wn(wt.PALETTE)}}function _i(e){return fs(e).type??bt.ERROR}function bi(e){return F_(_i(e))}function Me(e){return fs(e).name??""}function P_(e,t){return fs(e)[t]}const yl=new Qu;function Tf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ne(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Gt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Gt.ISSWIM;break;case"issolid":t.collision=Gt.ISSOLID;break;case"isbullet":t.collision=Gt.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function ln(e){var t;if(x(e))switch(_i(e)){default:return;case bt.ERROR:return e.code??"";case bt.LOADER:return e.code??"";case bt.BOARD:{x(e.board)||(e.board=ZM()),e.board.id=e.id;const n=da(e);return e.board.isdark=n.isdark??e.board.isdark?1:0,e.board.startx=n.startx??e.board.startx,e.board.starty=n.starty??e.board.starty,e.board.over=n.over??e.board.over,e.board.under=n.under??e.board.under,e.board.camera=n.camera??e.board.camera,e.board.exitnorth=n.exitnorth??e.board.exitnorth,e.board.exitsouth=n.exitsouth??e.board.exitsouth,e.board.exitwest=n.exitwest??e.board.exitwest,e.board.exiteast=n.exiteast??e.board.exiteast,e.board.timelimit=n.timelimit??e.board.timelimit,e.board.restartonzap=n.restartonzap??e.board.restartonzap,e.board.maxplayershots=n.maxplayershots??e.board.maxplayershots,e.board}case bt.OBJECT:return x(e.object)||(e.object=Om()),e.object.name=Me(e),e.object.category=Yn.ISOBJECT,Tf(da(e),e.object),e.object;case bt.TERRAIN:return x(e.terrain)||(e.terrain=Om()),e.terrain.name=Me(e),e.terrain.category=Yn.ISTERRAIN,Tf(da(e),e.terrain),e.terrain;case bt.PALETTE:{if(x(e.palette)||(e.palette=Lm(VT)),x((t=e.palette)==null?void 0:t.bits)){const n=da(e),r=Hn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&At(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){yl.set(o);const c=a*hc,u=yl.r*63,l=yl.g*63,h=yl.b*63;e.palette.bits[c+0]=Dn(u,0,63),e.palette.bits[c+1]=Dn(l,0,63),e.palette.bits[c+2]=Dn(h,0,63)}}}}return e.palette}case bt.CHARSET:return x(e.charset)||(e.charset=Mm(YT)),e.charset}}function B_(e){return{id:Ne(),name:k1(),timestamp:0,activelist:[],pages:e,flags:{}}}var Af=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(Af||{});function IL(e){return Vs(e,Af,{pages:t=>t.map(vL),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function NL(e){return Go(e,Af,{pages:t=>t.map(SL)})}function D_(e){x(e)&&(e.token=`${x1()}${fr(1111,9999)}`)}function Ei(e,t){if(!x(e))return;const n=Ot(t);return e.pages.find(i=>i.id===t||n===Me(i))}function In(e,t,n){if(!x(e))return;const r=Ot(n);return e.pages.find(s=>_i(s)===t&&(s.id===n||r===Me(s)))}function vf(e,t,n){let r=In(e,t,n);if(!x(r)){const i=F_(t);r=AL(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),j_(e,r)}return r}function ds(e,t){return x(e)?e.pages.filter(n=>_i(n)===t):[]}function br(e,t,n){if(!x(e))return[];const r=Ot(n);return e.pages.filter(s=>_i(s)===t).filter(s=>{const o=fs(s),a=Ot(Me(s));return s.id===n||r===a||x(o[n])})}function _l(e){return x(e)?Xe(e.pages).sort((n,r)=>{const i=_i(n),s=_i(r);return i===s?Me(n).localeCompare(Me(r)):s-i}):[]}function $_(e,t){if(x(t)){const n=In(e,bt.TERRAIN,t.kind??"");if(x(n))return n;const r=In(e,bt.OBJECT,t.kind??"");if(x(r))return r}}function j_(e,t){if(!x(e)||!x(t))return!1;const n=Ei(e,t.id);return x(n)?!1:(e.pages.push(t),D_(e),!0)}function z_(e,t){const n=Ei(e,t);if(x(e)&&x(n)){const r=Ot(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Me(i)),D_(e),n}}function Er(e,t){if(x(t)&&x(t.kind))return x(t.kinddata)||(t.kinddata=x(t.id)?pa(e,t.kind):Sf(e,t.kind)),t.kinddata}function W_(e,t,n){const r=Er(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function K_(e,t,n,r,i){const s=Er(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function pa(e,t){const n=t??"",r=In(e,bt.OBJECT,n);if(x(r)){const i=ln(r);return{...Xe(i),name:n,code:r.code}}}function Sf(e,t){const n=t??"",r=In(e,bt.TERRAIN,n);if(x(r)){const i=ln(r);return{...Xe(i),name:n,code:r.code}}}function ro(e,t){const n=Ei(e,t);return ln(n)}function wi(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function G_(e,t){e&&delete e.flags[t]}function H_(e,t,n){const r=wi(e,t);return r==null?void 0:r[n]}function OL(e,t,n,r){const i=wi(e,t);return i&&(i[n]=r),r}function ps(e,t){const n=H_(e,t,"board");return ro(e,At(n)?n:"")}function CL(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function bl(e,t,n){if(!x(e))return;OL(e,t,"board",n);const r=ro(e,n);x(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function io(e,t,n,r){if(!x(e))return;const i=ps(e,t);if(!x(i))return;const s=Cn(i,t);if(!Ho(s)||!(s!=null&&s.id))return;const o=ro(e,n);if(!x(o)||(wr(e,o),If(e,o,Gt.ISWALK,r)))return;delete i.objects[s.id];const a=Jr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Jr(o,s);o.lookup&&(o.lookup[c]=s.id),bl(e,t,o.id)}function LL(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=H_(e,r,"board");return At(i)?i:""});return Kx(n)}function Rf(e){return LL(e).map(n=>ro(e,n)).filter(x)}function If(e,t,n,r){if(!x(e)||!x(t)||!x(t.lookup)||r.x<0||r.x>=Yt||r.y<0||r.y>=Ee)return!0;const i=r.x+r.y*Yt,s=Cn(t,t.lookup[i]??"404");if(x(s))return!0;const o=t.terrain[i];if(x(o)){const a=Er(e,o),c=o.collision??(a==null?void 0:a.collision);return sh(n,c)}return!1}function ML(e,t,n,r){const i=Cn(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=W_(e,i,"collision");return If(e,t,a,r)}function Y_(e,t,n,r){var l,h;const i=Cn(t,(n==null?void 0:n.id)??"");if(!x(e)||!x(t)||!x(i)||!x(i.x)||!x(i.y)||!x(t.lookup)||r.x<0||r.x>=Yt||r.y<0||r.y>=Ee)return{name:"edge",kind:"edge",collision:Gt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Jr(t,i),o=Jr(t,r),a=i.collision??((l=i==null?void 0:i.kinddata)==null?void 0:l.collision)??Gt.ISWALK,c=Cn(t,t.lookup[o]??"");if(x(c))return{...c};const u=t.terrain[o];if(x(u)){const f=u.collision??((h=u==null?void 0:u.kinddata)==null?void 0:h.collision)??Gt.ISWALK;if(sh(a,f))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,x(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function V_(e,t,n,r){var s;if(!x(e)||!x(t)||!x(t.named)||!x(n))return;const i=Ot(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function UL(e,t,n){if(!(!x(e)||!x(t)||!x(t.lookup)||!x(n==null?void 0:n.id))&&!x(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*Yt]=n.id}}function wr(e,t){var a;if(!x(e)||!x(t)||x(t.lookup)&&x(t.named))return;const n=new Array(Yt*Ee).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const u=i[c];if(x(u.x)&&x(u.y)&&x(u.id)&&!x(u.removed)){u.category=Yn.ISOBJECT,n[u.x+u.y*Yt]=u.id;const l=Ot(u.name??((a=u.kinddata)==null?void 0:a.name)??"");r[l]||(r[l]=new Set),r[l].add(u.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const u=t.terrain[c];if(x(u)){u.x=s,u.y=o,u.category=Yn.ISTERRAIN;const l=Fr(u);r[l]||(r[l]=new Set),r[l].add(c)}++s,s>=Yt&&(s=0,++o)}t.lookup=n,t.named=r}function Hr(e,t,n,r){return!x(n)||Fr(n)==="player"?!1:(n.id?(n.removed=r,Nf(e,t,n)):(Tr(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),FL(e,t,n)),!0)}function FL(e,t,n){var r;if(x(e)&&x(t)&&x(n==null?void 0:n.x)&&x(n.y)){const i=Fr(n),s=Jr(t,n);x((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function Nf(e,t,n){var r;if(x(e)&&x(t)&&x(n==null?void 0:n.id)){if(x(t.lookup)&&x(n.x)&&x(n.y)){const s=n.x+n.y*Yt;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Fr(n);x((r=t.named)==null?void 0:r[i])&&x(n.id)&&t.named[i].delete(n.id)}}function PL(e,t,n){const r=[];if(!x(e)||!x(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];x(o.id)&&x(o.removed)&&n-o.removed>Na*5&&(r.push(o.id),Vb(t,o.id))}return r}function BL(e,t,n){const r=[];if(!x(e)||!x(t))return r;t.lookup=void 0,wr(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!x(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Er(e,a),u=`${(c==null?void 0:c.code)??""}
${a.code??""}`;u&&r.push({id:a.id,type:bt.OBJECT,code:u,object:a,terrain:void 0})}const s=PL(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:bt.ERROR,code:"",object:void 0,terrain:void 0});return r}function DL(e,t,n,r){if(x(e)&&x(t)&&x(n)){const[i,s]=n,o=pa(e,i);if(x(o)&&x(o.name)){const a=cd(t,r,i);return vc(a,s),a}}}function so(e,t,n,r,i){if(x(e)&&x(t)&&x(n)){const[s,o]=n,a=Sf(e,s);if(x(a)){const u=n8(t,r,s);if(x(u)){vc(u,o);const l=lc(r,Yt);return Er(e,u),V_(e,t,u,l),u}}const c=pa(e,s);if(x(c)&&x(c.name)){const u=cd(t,r,s,i);if(x(u))return vc(u,o),UL(e,t,u),Er(e,u),V_(e,t,u),u}}}function X_(e){return`zss_snapshot_${e}`}function q_(e){const t=Hn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Fr(r)==="player"&&delete e[t[n]]}return e}function $L(e){const t=Hn(e);for(let n=0;n<t.length;++n){const r=e[t[n]];Fr(r)!=="player"&&delete e[t[n]]}return e}function jL(e){const t=In(_.book,bt.BOARD,e),n=ln(t);if(!x(n))return;const r=X_(n.id);z_(_.book,r);const i=Ki(Pt.CONTENT,r,bt.BOARD),s=ln(i);if(x(s))return s.terrain=Xe(n.terrain),s.objects=q_(Xe(n.objects)),s}function zL(e){const t=In(_.book,bt.BOARD,e),n=ln(t);if(!x(n))return;const r=X_(n.id),i=In(_.book,bt.BOARD,r),s=ln(i);x(s)&&(n.terrain=Xe(s.terrain),n.objects={...q_(Xe(s.objects)),...$L(Xe(n.objects))})}const J_=5;function Of(e,t,n=2,r=1,i={x:0,y:0},s={x:Yt-1,y:Ee-1}){const o=In(_.book,bt.BOARD,e),a=In(_.book,bt.BOARD,t),c=ln(o),u=ln(a);if(!x(c)||!x(u))return!1;wr(_.book,c),wr(_.book,u);let l=0;const h=new Map,f=new Map;let d=0;const p=32,m=new Uint8Array(kT*4);for(let O=0;O<Ee;++O)for(let Y=0;Y<Yt;++Y){const et=On(u,{x:Y,y:O}),C=(et==null?void 0:et.char)??0,S=(et==null?void 0:et.color)??p,b=(et==null?void 0:et.bg)??p;m[d++]=C,m[d++]=S,m[d++]=b;const P=Er(_.book,et),X=Ot((P==null?void 0:P.name)??"empty"),D=h.get(X);Ct(D)?m[d++]=D:(h.set(X,l),f.set(l,X),m[d++]=l++)}const k=Math.min(i.x,s.x),w=Math.min(i.y,s.y),T=Math.max(i.x,s.x),v=Math.max(i.y,s.y),I=T-k+1,U=v-w+1,R=new mT.OverlappingModel(m,Yt,Ee,n,I,U,!1,!1,r,0);let L=0;for(;L<J_&&!R.generate();++L);if(L===J_)return!1;d=0;const B=R.graphics();for(let O=w;O<=v;++O)for(let Y=k;Y<=T;++Y){const et=B[d++],C=B[d++],S=B[d++];l=B[d++];const b=On(c,{x:Y,y:O});Hr(_.book,c,b,_.timestamp),Tr(c,{x:Y,y:O});const P=f.get(l)??"",X=so(_.book,c,[P],{x:Y,y:O});if(x(X)&&(et>0&&(X.char=et),C<p&&(X.color=C),S<p&&(X.bg=S),Ho(X))){const D=nn(jo(u,P));x(D)&&(Tr(c,{...od(u,D.x??0,D.y??0),x:Y,y:O}),X.p1=D.p1,X.p2=D.p2,X.p3=D.p3,X.code=D.code,X.cycle=D.cycle,X.light=D.light,X.stepx=D.stepx,X.stepy=D.stepy,X.pushable=D.pushable,X.collision=D.collision,X.destructible=D.destructible)}}return!0}const WL=$p(32,126).map(e=>String.fromCharCode(e)),KL=zn({name:"Whitespace",pattern:/ +/}),GL=zn({name:"WhitespaceSkipped",pattern:/ +/,group:Ge.SKIPPED}),Cf=zn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Z_=zn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:WL}),Lf=zn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Mf=zn({name:"EscapedDollar",pattern:"$$"}),Uf=zn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Ff=zn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Q_=zn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function HL(e,t=""){return zn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const tb=Object.keys($o).map(e=>HL(`\\$(${e})`,e)),YL=[KL,Cf,...tb,Lf,Z_,Ff,Mf,Q_,Uf],VL=new Ge(YL,{skipValidations:!Mr,ensureOptimizations:Mr}),XL=new Ge([GL,Cf,...tb,Lf,Z_,Ff,Mf,Q_,Uf],{skipValidations:!Mr,ensureOptimizations:Mr});function Pf(e,t=!1){return t?XL.tokenize(e):VL.tokenize(e)}function Bf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function eb(e){e.active={...e.reset}}function nb(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Mf:s("$");break;case Ff:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case Lf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Cf:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=$o[u],h=gT(zt[l]),f=yT(zt[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):x(h)?t.active.color=h:x(f)?t.active.bg=f:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(x(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){eb(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;JL(l,l+u.length,t.active.color,t.active.bg,t),qL(l,u,t)}}}function rb(e,t,n){const r=Pf(e);r.tokens&&(nb(r.tokens,t),n&&eb(t),t.changed())}function ib(e,t,n){const r=Pf(e);if(!r.tokens)return;const i=Bf(t,n,zt.WHITE,zt.BLACK);return i.measureonly=!0,nb(r.tokens,i),i.x>0&&++i.y,i}function qL(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function JL(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function sb(e,t,n){if(!ka(_.element))return 0;const[r,i]=rt(t,0,[H.DIR,H.MAYBE_KIND]),s=i??["bullet"],o=DL(_.book,_.board,s,{x:_.element.x,y:_.element.y});if(x(o)){x(n)&&(o.arg=n),o.party=_.elementid,o.collision=Gt.ISBULLET,o.destructible=1,o.stepx=r.x-_.element.x,o.stepy=r.y-_.element.y,o.bg=zt.ONCLEAR;const a=Er(_.book,o),c=o.code??(a==null?void 0:a.code)??"";Wb(_.book,_.board,o,c,1)}return e.yield(),0}function El(e,t,n,r){var h,f;if(!ka(_.element)||!x(_.book)||!x(_.board)||!x(_.element))return 0;wr(_.book,_.board);const[i,s]=rt(t,0,[H.DIR,H.KIND]),o=On(_.board,i);if((o==null?void 0:o.category)===Yn.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((h=_.element)==null?void 0:h.x)??0,y:((f=_.element)==null?void 0:f.y)??0},p=Ye(i,Gi(d,i));Y_(_.book,_.board,o,p)}const[a]=s,c=pa(_.book,a)??Sf(_.book,a),u=(c==null?void 0:c.collision)??Gt.ISWALK;if(!If(_.book,_.board,u,i)){const d=so(_.book,_.board,s,i,n);x(d)&&x(r)&&(d.arg=r)}return 0}const ZL=li().command("remix",(e,t)=>{if(!x(_.book)||!x(_.board))return 0;const[n,r,i]=rt(t,0,[H.NAME,H.MAYBE_NUMBER,H.MAYBE_NUMBER]),s=br(_.book,bt.BOARD,n),o=nn(...s);return x(o)&&Of(_.board.id,o.id,r,i),0}).command("remixonly",(e,t)=>{if(!x(_.book)||!x(_.board))return 0;const[n,r,i,s,o,a,c]=rt(t,0,[H.NAME,H.NUMBER,H.NUMBER,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER,H.MAYBE_NUMBER]),u=br(_.book,bt.BOARD,n),l=nn(...u);return x(l)&&Of(_.board.id,l.id,a,c,{x:r,y:i},{x:s,y:o}),0}).command("board",(e,t)=>{if(!x(_.book)||!x(_.board))return 0;const[n,r]=rt(t,0,[H.NAME]);switch(Ot(n)){case"snapshot":jL(_.board.id);break;case"restart":zL(_.board.id);break;default:{const[i,s]=rt(t,r,[H.MAYBE_NUMBER,H.MAYBE_NUMBER]),o=br(_.book,bt.BOARD,n);if(o.length){const a=nn(...o);x(a)&&io(_.book,_.elementfocus,a.id,{x:i??Math.round(Yt*.5),y:s??Math.round(Ee*.5)})}break}}return 0}).command("edge",(e,t)=>{var s,o;if(!x(_.book)||!x(_.board)||!x(_.element))return 0;const[n,r]=rt(t,0,[H.DIR,H.NAME]),i=br(_.book,bt.BOARD,r);if(i.length){const a={x:((s=_.element)==null?void 0:s.x)??0,y:((o=_.element)==null?void 0:o.y)??0},c=Gi(a,n),u=nn(...i);switch(c){case yt.NORTH:_.board.exitnorth=u.id;break;case yt.SOUTH:_.board.exitsouth=u.id;break;case yt.WEST:_.board.exitwest=u.id;break;case yt.EAST:_.board.exiteast=u.id;break}}return 0}).command("shove",(e,t)=>{if(!x(_.book)||!x(_.board))return 0;wr(_.book,_.board);const[n,r]=rt(t,0,[H.DIR,H.DIR]),i=On(_.board,n);return Ho(i)&&ed(_.book,_.board,i,r),0}).command("duplicate",()=>(!x(_.book)||!x(_.board),0)).command("replace",(e,t)=>{if(!x(_.book)||!x(_.board))return 0;wr(_.book,_.board);const[n,r]=rt(t,0,[H.DIR,H.KIND]),i=On(_.board,n);return Ho(i)&&Hr(_.book,_.board,i,_.timestamp),so(_.book,_.board,r,n),0}).command("write",(e,t)=>{var u;if(!x(_.book)||!x(_.board))return 0;wr(_.book,_.board);const[n,r,i]=rt(t,0,[H.DIR,H.COLOR,H.STRING]),{color:s,bg:o}=Qp(r),a=((u=ib(i,256,1))==null?void 0:u.measuredwidth)??1,c=Bf(256,1,s??zt.WHITE,o??zt.BLACK);rb(i,c,!1);for(let l=0;l<a;++l)Tr(_.board,{x:n.x+l,y:n.y,name:"text",char:c.char[l],color:c.color[l],bg:c.bg[l]});return 0}).command("change",(e,t)=>{if(!x(_.book)||!x(_.board))return 0;wr(_.book,_.board);const[n,r]=rt(t,0,[H.KIND,H.KIND]);(ih(n)??"")==="empty"&&xT(_.board).forEach(c=>{so(_.book,_.board,r,c)});const s=ih(r),o=em(r),a=nm(r);return rm(_.board,n).forEach(c=>{if(Fr(c)===s)x(o)&&(c.color=o),x(a)&&(c.bg=a);else if(Hr(_.book,_.board,c,_.timestamp),s!=="empty"){const u={x:c.x??0,y:c.y??0};so(_.book,_.board,r,u)}}),0}).command("putwith",(e,t)=>{const[n,r]=rt(t,0,[H.ANY]);return El(e,t.slice(r),void 0,n)}).command("put",(e,t)=>El(e,t)).command("oneof",(e,t)=>{const[n,r]=rt(t,0,[H.ANY]);return x(_.board)&&Cn(_.board,n)?0:El(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=rt(t,0,[H.ANY,H.ANY]);return x(_.board)&&Cn(_.board,r)?0:El(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=rt(t,0,[H.ANY]);return sb(e,t.slice(r),n)}).command("shoot",sb),ji="$dkpurple",QL="$196",t6="$205";function $t(e,t,n){ti(e,t,n)}function e6(e,t,n){const r=QL.repeat(n);$t(e,t,`${ji}${r}`)}function Df(e,t,n){const r=t6.repeat(n);$t(e,t,`${ji}${r}`)}function ms(e,t,n){$t(e,t,`${ji} ${" ".repeat(n.length)} `),e6(e,t,n.length+2),$t(e,t,`${ji} $white${n} `),Df(e,t,n.length+2)}function ki(e,t,n){$t(e,t,`${ji} ${" ".repeat(n.length)} `),$t(e,t,`${ji} $gray${n} `),Df(e,t,n.length+2)}function ee(e,t,n,r){$t(e,t,`${ji} $white${n} $blue${r}`)}function Pe(e,t,n){$t(e,t,`${ji}$blue${n}`)}function ob(e){const[t,n]=e.split(":"),r=x(n);return[r?t:"self",r?n:e]}const n6=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function ma(){Ld(G,qr())}const r6=li().command("send",(e,t)=>{const[n,r]=rt(t,0,[H.NAME,H.ANY]);switch(Ot(n)){case"helpmenu":ms(G,_.elementfocus,"H E L P"),$t(G,_.elementfocus,""),ee(G,_.elementfocus,"#help controls","zss controls and inputs"),$t(G,_.elementfocus,"!helpcontrols;read help controls"),$t(G,_.elementfocus,""),ee(G,_.elementfocus,"#help text","text formatting"),$t(G,_.elementfocus,"!helptext;read help text"),$t(G,_.elementfocus,""),ee(G,_.elementfocus,"#help developer","developer commands"),$t(G,_.elementfocus,"!helpdeveloper;read help developer"),$t(G,_.elementfocus,""),ee(G,_.elementfocus,"#help player","player settings"),$t(G,_.elementfocus,"!helpplayer;read help player"),ki(G,_.elementfocus,"keyboard input"),ee(G,_.elementfocus,"?","open console"),ee(G,_.elementfocus,"esc","close console"),ee(G,_.elementfocus,"tab","move console"),ee(G,_.elementfocus,"up / down arrow keys","navigate console items"),ee(G,_.elementfocus,"left / right arrow keys","change console items"),ee(G,_.elementfocus,"enter","interact with console items"),ee(G,_.elementfocus,"alt + arrow keys","skip words and console lines"),ee(G,_.elementfocus,`${n6} + up / down arrow keys`,"input history");break;case"helpcontrols":ms(G,_.elementfocus,"zss controls and inputs"),ki(G,_.elementfocus,"keyboard input"),ee(G,_.elementfocus,"arrow keys","move"),ee(G,_.elementfocus,"shift + arrow keys","shoot"),ee(G,_.elementfocus,"enter","ok / accept"),ee(G,_.elementfocus,"escape","cancel / close"),ee(G,_.elementfocus,"tab","menu / action"),ki(G,_.elementfocus,"controller input"),ee(G,_.elementfocus,"left stick","move"),ee(G,_.elementfocus,"right stick","aim"),ee(G,_.elementfocus,"a","ok / accept"),ee(G,_.elementfocus,"b","cancel / close"),ee(G,_.elementfocus,"y","menu / action"),ee(G,_.elementfocus,"x","shoot"),ee(G,_.elementfocus,"triggers","shoot");break;case"helptext":break;case"helpdeveloper":ms(G,_.elementfocus,"developer commands"),ee(G,_.elementfocus,"#books","list books in memory"),ee(G,_.elementfocus,"#pages","list pages in opened book"),ee(G,_.elementfocus,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ee(G,_.elementfocus,"#trash","list books and pages from open book you can delete"),ee(G,_.elementfocus,"#save","flush state to register"),ee(G,_.elementfocus,"#share","creates a click to copy share url and QR code");break;case"helpplayer":ms(G,_.elementfocus,"player settings"),Pe(G,_.elementfocus,"todo");break;default:{const[i,s]=ob(n);nd(i==="self"&&_.elementisplayer?`${_.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(_e),s=i.join(" ");switch(Ot(r)){case Wn(wt.LOADER):n=Ki(Pt.CONTENT,s,bt.LOADER);break;default:n=Ki(Pt.CONTENT,[r,...i].join(" "),bt.OBJECT);break;case Wn(wt.BOARD):n=Ki(Pt.CONTENT,s,bt.BOARD);break;case Wn(wt.OBJECT):n=Ki(Pt.CONTENT,s,bt.OBJECT);break;case Wn(wt.TERRAIN):n=Ki(Pt.CONTENT,s,bt.TERRAIN);break;case Wn(wt.CHARSET):n=Ki(Pt.CONTENT,s,bt.CHARSET);break;case Wn(wt.PALETTE):n=Ki(Pt.CONTENT,s,bt.PALETTE);break}return x(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(_e).join(" ");return x(_.element)&&(_.element.tickertext=n,_.element.tickertime=_.timestamp),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=_e(n),s=r.map(_e).join(" ");return ti(G,_.elementfocus,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=rt(t,0,[H.MAYBE_NAME]),r=$b(n);return x(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=kr(n);return x(r)?(Pe(G,_.elementfocus,`opened [book] ${r.name}`),Ll(Pt.MAIN,r.id),e.command("pages")):ye(G,_.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=le(Pt.MAIN),i=kr(n);return x(i)&&(r===i&&Ll(Pt.MAIN,""),DM(n),Pe(G,_.elementfocus,`trashed [book] ${i.name}`),ma(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=br(_.book,bt.BOARD,n);if(r.length){const i=nn(...r);x(i)&&io(_.book,_.elementfocus,i.id,{x:fr(0,Yt-1),y:fr(0,Ee-1)})}return 0}).command("pageopenwith",(e,t)=>{const[n,r,i]=rt(t,0,[H.NAME,H.MAYBE_NAME,H.MAYBE_NAME]);return e.command("pageopen",r,i,n)}).command("pageopen",(e,t)=>{const[n,r,i]=rt(t,0,[H.NAME,H.MAYBE_NAME,H.MAYBE_NAME]),s=_n(Pt.MAIN);if(!x(s))return 0;const o=Ei(s,n);if(x(o)){const a=Me(o),c=bi(o);Pe(G,_.elementfocus,`opened [${c}] ${a}`);const u=[],l=Ei(s,i??""),h=x(l)?wf(l.code):void 0;if(x(h))for(let p=0;p<h.tokens.length;++p){const m=h.tokens[p];m.tokenType===hf&&u.push(m.image.startsWith('"')?m.image.slice(1):m.image)}const f=[o.id,r];Vu(Ia(s.id,f),o.code);const d=bi(o);Od(G,_.elementfocus,s.id,f,d,`${a} - ${s.name}`,u)}else ye(G,"pageopen",`page ${n} not found`,_.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=_n(Pt.MAIN),i=z_(r,n);if(x(n)){const s=Me(i),o=bi(i);Pe(G,_.elementfocus,`trashed [${o}] ${s}`),ma(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(_e).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{ki(G,_.elementfocus,"books");const e=le(Pt.MAIN);ee(G,_.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=le(Pt.CONTENT);ee(G,_.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Df(G,_.elementfocus,7);const n=po();return n.length?n.forEach(r=>{$t(G,_.elementfocus,`!bookopen ${r.id};${r.name}`)}):Pe(G,_.elementfocus,"no books found"),$t(G,_.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=_n(Pt.MAIN);return x(e)&&(ki(G,_.elementfocus,"pages"),ee(G,_.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?_l(e).forEach(n=>{const r=Me(n),i=bi(n);$t(G,_.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):($t(G,_.elementfocus,""),Pe(G,_.elementfocus,"$white no pages found"),Pe(G,_.elementfocus,"$white use @ to create a page"),Pe(G,_.elementfocus,"$white @board name of board"),Pe(G,_.elementfocus,"$white @object name of object"),Pe(G,_.elementfocus,"$white @terrain name of terrain"),Pe(G,_.elementfocus,"$white You can omit the type and it will default to object"),Pe(G,_.elementfocus,"$white @object name of object"),Pe(G,_.elementfocus,"$white @name of object"))),0}).command("boards",()=>{ki(G,_.elementfocus,"boards");const e=_n(Pt.MAIN);if(x(e)){ee(G,_.elementfocus,"main",`${e.name} $GREEN${e.id}`);const t=_l(e);t.filter(n=>_i(n)===bt.BOARD).forEach(n=>{const r=Me(n),i=bi(n);$t(G,_.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),t.length===0&&($t(G,_.elementfocus,""),Pe(G,_.elementfocus,"$white no boards found"),Pe(G,_.elementfocus,"$white use @ to create a board"),Pe(G,_.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{ki(G,_.elementfocus,"$REDTRASH"),Pe(G,_.elementfocus,"books");const e=po();e.length&&(e.forEach(n=>{$t(G,_.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),$t(G,_.elementfocus,""));const t=le(Pt.MAIN);return x(t)&&(Pe(G,_.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Me(n);$t(G,_.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),$t(G,_.elementfocus,"")),0}).command("dev",()=>(ma(),dE(G,_.elementfocus),0)).command("share",()=>(ma(),pE(G,_.elementfocus),0)).command("save",()=>(ma(),0)).command("fork",()=>(RE(G,_.elementfocus),0)).command("nuke",()=>(mE(G,_.elementfocus),0)).command("restart",()=>(SE(G,_.elementfocus),0)).command("export",()=>{ms(G,_.elementfocus,"E X P O R T"),ki(G,_.elementfocus,"books");const e=po();return e.length&&e.forEach(t=>$t(G,_.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=kr(n);return x(r)&&(ms(G,_.elementfocus,"E X P O R T"),ki(G,_.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=_l(r);$t(G,_.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Me(s),a=bi(s);$t(G,_.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=kr(n);return x(r)&&Id(G,_.elementfocus,Xe(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=rt(t,0,[H.NAME]),{target:r,path:i}=lr(n),s=kr(r),o=Ei(s,i);return x(o)&&Id(G,_.elementfocus,Xe(o),`${Me(o)}.${bi(o)}.json`),0}).command("gadget",()=>(TE(G,_.elementfocus),0)).command("joincode",(e,t)=>{const[n]=rt(t,0,[H.MAYBE_NAME]);return rE(G,_.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=rt(t,0,[H.MAYBE_NAME]);return iE(G,_.elementfocus,!!n),0}),i6=li().command("toast",(e,t)=>{const n=t.map(_e).join("");return Y1(G,_.elementfocus,n),0}).command("palette",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=jb(),i=In(_.book,bt.PALETTE,n);return x(i)?(r.palette=i.id,$t(G,_.elementfocus,`loaded palette ${n}`)):ye(G,_.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=jb(),i=In(_.book,bt.CHARSET,n);return x(i)?(r.charset=i.id,$t(G,_.elementfocus,`loaded charset ${n}`)):ye(G,_.elementfocus,"not-found",`unabled to find charset ${n}`),0}),$f={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Yr(e){return ne(e)&&ab(e[0])}function ab(e){return x(Yn[e])&&At(e)}function cb(e){if(At(e))return $f[Ot(e)]}function lb(e){if(Yr(e))return e;if(ab(e))return[e];const t=cb(e);if(x(t))return[t]}function wl(e){const t=_.words[e],n=lb(t);if(Yr(n))return[n,e+1];const[r,i]=hn(e),s=lb(r);return Yr(s)?[s,i]:[void 0,e]}const jf={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Gt.ISSOLID,Gt.ISWALK,Gt.ISSWIM,Gt.ISBULLET,Gt.ISWALK,Gt.ISSWIM;function xi(e){return ne(e)&&zf(e[0])}function zf(e){return x(Gt[e])&&At(e)}function s6(e){if(At(e))return jf[Ot(e)]}function ub(e){const t=_.words[e];if(xi(t))return[t,e+1];if(zf(t))return[[t],e+1];const[n,r]=hn(e);return xi(n)?[n,r]:zf(n)?[[n],r]:[void 0,e]}const o6=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),hb=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),a6=["NORTH","SOUTH","WEST","EAST"];function c6(e){const t=_s(e);if(Ct(t.inputcurrent)||(t.inputcurrent=0),ne(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=dn.NONE,i=0]=n??[dn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&nT?1:0,t.inputctrl=i&rT?1:0,t.inputshift=i&iT?1:0,r){case dn.MOVE_UP:case dn.MOVE_DOWN:case dn.MOVE_LEFT:case dn.MOVE_RIGHT:t.inputmove=[a6[r-dn.MOVE_UP]];break;case dn.OK_BUTTON:t.inputok=1;break;case dn.CANCEL_BUTTON:t.inputcancel=1;break;case dn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==dn.NONE&&o!==r}),t}function l6(e){const t=$f[e];if(x(t))return t;const n=jf[e];if(x(n))return n;const r=$o[e];if(x(r))return r;const i=rd[e];if(x(i))return i}const u6=li({get(e,t){var o,a,c,u,l,h,f,d,p,m,k,w,T,v,I,U,R,L;const n=l6(t);if(x(n))return[!0,n];if(_.elementisplayer&&o6.has(t)){const B=c6(_.elementid)[t];return[x(B),B]}const r=yc(_.board,_.element,_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus;switch(t){case"isdark":return[!0,(o=_.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=_.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=_.board)==null?void 0:c.starty)??0];case"over":return[!0,((u=_.board)==null?void 0:u.over)??""];case"under":return[!0,((l=_.board)==null?void 0:l.under)??""];case"camera":return[!0,((h=_.board)==null?void 0:h.camera)??""];case"exitnorth":return[!0,((f=_.board)==null?void 0:f.exitnorth)??""];case"exitsouth":return[!0,((d=_.board)==null?void 0:d.exitsouth)??""];case"exitwest":return[!0,((p=_.board)==null?void 0:p.exitwest)??""];case"exiteast":return[!0,((m=_.board)==null?void 0:m.exiteast)??""];case"timelimit":return[!0,((k=_.board)==null?void 0:k.timelimit)??0];case"restartonzap":return[!0,((w=_.board)==null?void 0:w.restartonzap)??0];case"maxplayershots":return[!0,((T=_.board)==null?void 0:T.maxplayershots)??0];case"boardid":return[!0,((v=_.board)==null?void 0:v.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((I=_.element)==null?void 0:I.id)??""];case"thisx":return[!0,((U=_.element)==null?void 0:U.x)??-1];case"thisy":return[!0,((R=_.element)==null?void 0:R.y)??-1];default:{const B=(L=_.element)==null?void 0:L[t];if(hb.has(t))return[!0,B];break}}const s=_s(i)[t];return[x(s),s]},set(e,t,n){const r=yc(_.board,_.element,_.elementfocus),i=(r==null?void 0:r.id)??_.elementfocus;switch(t){case"isdark":x(_.board)&&(_.board.isdark=n?1:0);break;case"startx":x(_.board)&&(_.board.startx=Do(n,0));break;case"starty":x(_.board)&&(_.board.starty=Do(n,0));break;case"over":x(_.board)&&(_.board.over=_e(n));break;case"under":x(_.board)&&(_.board.under=_e(n));break;case"camera":x(_.board)&&(_.board.camera=_e(n));break;case"exitnorth":x(_.board)&&(_.board.exitnorth=_e(n));break;case"exitsouth":x(_.board)&&(_.board.exitsouth=_e(n));break;case"exitwest":x(_.board)&&(_.board.exitwest=_e(n));break;case"exiteast":x(_.board)&&(_.board.exiteast=_e(n));break;case"timelimit":x(_.board)&&(_.board.timelimit=Do(n,0));break;case"restartonzap":x(_.board)&&(_.board.restartonzap=n?1:0);break;case"maxplayershots":x(_.board)&&(_.board.maxplayershots=Do(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(hb.has(t))return x(_.element)&&(_.element[t]=n),[!0,n];break}}const s=_s(i);return x(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=_.element)!=null&&e.removed)&&(x((t=_.element)==null?void 0:t.stepx)||x((n=_.element)==null?void 0:n.stepy))){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};ed(_.book,_.board,_.element,{x:s.x+(_.element.stepx??0),y:s.y+(_.element.stepy??0)})===!1&&(_.element.stepx=0,_.element.stepy=0,W_(_.book,_.element,"destructible")&&Hr(_.book,_.board,_.element,_.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(_e(n),0)),0)).command("set",(e,t)=>{const[n,r]=rt(t,0,[H.NAME,H.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=rt(t,0,[H.KIND]);if(wr(_.book,_.board),Nf(_.book,_.board,_.element),Hr(_.book,_.board,_.element,_.timestamp)){const s={x:((r=_.element)==null?void 0:r.x)??0,y:((i=_.element)==null?void 0:i.y)??0};so(_.book,_.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=rt(t,0,[H.NUMBER]);return x(_.element)&&(_.element.char=n),0}).command("color",(e,t)=>{const[n]=rt(t,0,[H.COLOR]);return x(_.element)&&x(n)&&vc(_.element,n),0}).command("go",(e,t)=>{if(x(_.element)){const[n]=rt(t,0,[H.DIR]);if(ed(_.book,_.board,_.element,n),e.yield(),_.element.x===n.x&&_.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!x(_.element))return 0;const[n]=rt(t,0,[H.DIR]),r=_.element.x??0,i=_.element.y??0;return _.element.stepx=n.x-r,_.element.stepy=n.y-i,0}),h6=li().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=rt(t,0,[H.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(_e(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(_e(t[0])),0)).command("cycle",(e,t)=>{if(x(_.element)){const[n]=rt(t,0,[H.NUMBER]);_.element.cycle=Dn(Math.round(n),1,255)}return 0}).command("die",e=>(Hr(_.book,_.board,_.element,_.timestamp),e.endofprogram(),0)).command("endgame",()=>(Cd(G,_.elementfocus),0)).command("run",(e,t)=>{const[n]=rt(t,0,[H.NAME]);return Ml(n),0}).command("runwith",(e,t)=>{const[n,r]=rt(t,0,[H.ANY,H.NAME]);return e.set("arg",n),Ml(r),0}),kl={};function f6(e){var t;return(t=kl[e])==null?void 0:t.arg}function d6(e){var t;return(t=kl[e])==null?void 0:t.format}function oo(e){var t;return(t=kl[e])==null?void 0:t.content}function p6(e,t,n,r,i){const s=le(Pt.MAIN);if(!x(s))return;const o=ds(s,bt.LOADER).filter(a=>{const c=fs(a),u=c.format,l=At(u)?new RegExp(u).test(t):!1,h=c.event,f=At(h)?new RegExp(h).test(n):!1;return At(u)&&At(h)?l&&f:At(u)?l:At(h)?f:!1});for(let a=0;a<o.length;++a){const c=`${Ne()}_loader`;kl[c]={arg:e,format:t,content:r,player:i},KM(c,o[a].code)}}function fb(e,t){if(!x(e))return;const n=Ot(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const m6=(e,t)=>{const n=oo(e.id());if(!x(n))return 0;const[r,i]=rt(t,0,[H.NAME]),s=Ot(r);switch(s){case"seek":{const[o]=rt(t,i,[H.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=rt(t,i,[H.NAME]);e.set(o,fb(n,s));break}case"text":{const[o,a]=rt(t,i,[H.NAME,H.NAME]),c=fb(n,o);if(Ct(c)&&At(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=rt(t,i,[H.NAME]),a=vf(_.book,bt.PALETTE,o),c=ln(a);if(x(c)){const u=Xx*hc,l=Lm(new Uint8Array(n.bytes.buffer,n.cursor,u));x(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=rt(t,i,[H.NAME]),a=vf(_.book,bt.CHARSET,o),c=ln(a);if(x(c)){const u=pc*Vx*nh,l=Mm(new Uint8Array(n.bytes.buffer,n.cursor,u));x(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},ao=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",xl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!xl(e[n],t[n]))return!1;return!0}if(ao(e)&&ao(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!xl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Tl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(ao(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},g6=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",db=e=>e>="0"&&e<="9"||e==="-",y6=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var q;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(q||(q={}));const pb={"(":q.TOK_LPAREN,")":q.TOK_RPAREN,"*":q.TOK_STAR,",":q.TOK_COMMA,".":q.TOK_DOT,":":q.TOK_COLON,"@":q.TOK_CURRENT,$:q.TOK_ROOT,"]":q.TOK_RBRACKET,"{":q.TOK_LBRACE,"}":q.TOK_RBRACE},_6={"!":!0,"<":!0,"=":!0,">":!0},b6={"	":!0,"\n":!0,"\r":!0," ":!0};class E6{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(g6(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:q.TOK_UNQUOTEDIDENTIFIER,value:i});else if(pb[t[this._current]]!==void 0)n.push({start:this._current,type:pb[t[this._current]],value:t[this._current]}),this._current+=1;else if(db(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:q.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:q.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:q.TOK_LITERAL,value:o})}else if(_6[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(b6[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:q.TOK_AND,value:"&&"})):n.push({start:r,type:q.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:q.TOK_OR,value:"||"})):n.push({start:r,type:q.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&y6(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;db(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:q.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:q.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:q.TOK_FLATTEN,value:"[]"}):{start:n,type:q.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_NE,value:"!="}):{start:n,type:q.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_LTE,value:"<="}):{start:n,type:q.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_GTE,value:">="}):{start:n,type:q.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:q.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const w6=new E6,un={[q.TOK_EOF]:0,[q.TOK_UNQUOTEDIDENTIFIER]:0,[q.TOK_QUOTEDIDENTIFIER]:0,[q.TOK_RBRACKET]:0,[q.TOK_RPAREN]:0,[q.TOK_COMMA]:0,[q.TOK_RBRACE]:0,[q.TOK_NUMBER]:0,[q.TOK_CURRENT]:0,[q.TOK_EXPREF]:0,[q.TOK_ROOT]:0,[q.TOK_PIPE]:1,[q.TOK_OR]:2,[q.TOK_AND]:3,[q.TOK_EQ]:5,[q.TOK_GT]:5,[q.TOK_LT]:5,[q.TOK_GTE]:5,[q.TOK_LTE]:5,[q.TOK_NE]:5,[q.TOK_FLATTEN]:9,[q.TOK_STAR]:20,[q.TOK_FILTER]:21,[q.TOK_DOT]:40,[q.TOK_NOT]:45,[q.TOK_LBRACE]:50,[q.TOK_LBRACKET]:55,[q.TOK_LPAREN]:60};class k6{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==q.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...w6.tokenize(t),{type:q.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<un[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case q.TOK_LITERAL:return{type:"Literal",value:t.value};case q.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case q.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===q.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case q.TOK_NOT:return r=this.expression(un.Not),{type:"NotExpression",children:[r]};case q.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===q.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(un.Star),{type:"ValueProjection",children:[n,r]};case q.TOK_FILTER:return this.led(t.type,{type:"Identity"});case q.TOK_LBRACE:return this.parseMultiselectHash();case q.TOK_FLATTEN:return n={type:q.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(un.Flatten),{type:"Projection",children:[n,r]};case q.TOK_LBRACKET:return this.lookahead(0)===q.TOK_NUMBER||this.lookahead(0)===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===q.TOK_STAR&&this.lookahead(1)===q.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(un.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case q.TOK_CURRENT:return{type:q.TOK_CURRENT};case q.TOK_ROOT:return{type:q.TOK_ROOT};case q.TOK_EXPREF:return i=this.expression(un.Expref),{type:"ExpressionReference",children:[i]};case q.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(i={type:q.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(q.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case q.TOK_DOT:const i=un.Dot;return this.lookahead(0)!==q.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case q.TOK_PIPE:return r=this.expression(un.Pipe),{type:q.TOK_PIPE,children:[n,r]};case q.TOK_OR:return r=this.expression(un.Or),{type:"OrExpression",children:[n,r]};case q.TOK_AND:return r=this.expression(un.And),{type:"AndExpression",children:[n,r]};case q.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(a={type:q.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===q.TOK_COMMA&&this.match(q.TOK_COMMA),o.push(a);return this.match(q.TOK_RPAREN),{name:s,type:"Function",children:o};case q.TOK_FILTER:const u=this.expression(0);return this.match(q.TOK_RBRACKET),r=this.lookahead(0)===q.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(un.Filter),{type:"FilterProjection",children:[n,r,u]};case q.TOK_FLATTEN:const l={type:q.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(un.Flatten);return{type:"Projection",children:[l,h]};case q.TOK_EQ:case q.TOK_NE:case q.TOK_GT:case q.TOK_GTE:case q.TOK_LT:case q.TOK_LTE:return this.parseComparator(n,t);case q.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===q.TOK_NUMBER||f.type===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(q.TOK_STAR),this.match(q.TOK_RBRACKET),r=this.parseProjectionRHS(un.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===q.TOK_COLON||this.lookahead(1)===q.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(q.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(un.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==q.TOK_RBRACKET&&n<3;){if(r===q.TOK_COLON)n+=1,this.advance();else if(r===q.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(q.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(un[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER,q.TOK_STAR].includes(n))return this.expression(t);if(n===q.TOK_LBRACKET)return this.match(q.TOK_LBRACKET),this.parseMultiselectList();if(n===q.TOK_LBRACE)return this.match(q.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(un[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===q.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===q.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===q.TOK_DOT)return this.match(q.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==q.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===q.TOK_COMMA&&(this.match(q.TOK_COMMA),this.lookahead(0)===q.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(q.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(q.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===q.TOK_COMMA)this.match(q.TOK_COMMA);else if(this.lookahead(0)===q.TOK_RBRACE){this.match(q.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const x6=new k6;var ut;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ut||(ut={}));class T6{constructor(t){this.TYPE_NAME_TABLE={[ut.TYPE_NUMBER]:"number",[ut.TYPE_ANY]:"any",[ut.TYPE_STRING]:"string",[ut.TYPE_ARRAY]:"array",[ut.TYPE_OBJECT]:"object",[ut.TYPE_BOOLEAN]:"boolean",[ut.TYPE_EXPREF]:"expression",[ut.TYPE_NULL]:"null",[ut.TYPE_ARRAY_NUMBER]:"Array<number>",[ut.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>ao(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ut.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ut.TYPE_NUMBER,ut.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ut.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ut.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ut.TYPE_NUMBER,ut.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ut.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ut.TYPE_NUMBER?n:r===ut.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ut.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ut.TYPE_NUMBER:return"number";case ut.TYPE_STRING:return"string";case ut.TYPE_ARRAY:return"array";case ut.TYPE_OBJECT:return"object";case ut.TYPE_BOOLEAN:return"boolean";case ut.TYPE_EXPREF:return"expref";case ut.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ut.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ut.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]},{types:[ut.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ut.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ut.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY,ut.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ut.TYPE_EXPREF]},{types:[ut.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ut.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ut.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ut.TYPE_STRING,ut.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ut.TYPE_ARRAY_STRING,ut.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ut.TYPE_ARRAY]},{types:[ut.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ut.TYPE_STRING]},{types:[ut.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ut.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ut.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ut.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ut.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ut.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ut.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(m=>{var k;return(k=!m.optional)!==null&&k!==void 0?k:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=n.length<a,l=n.length>r.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let m=0;m<r.length;m+=1){p=!1,f=r[m].types,d=this.getTypeName(n[m]);let k;for(k=0;k<f.length;k+=1)if(d!==void 0&&this.typeMatches(d,f[k],n[m])){p=!0;break}if(!p&&d!==void 0){const w=f.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${m+1} to be type (${w}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(t,n,r){if(n===ut.TYPE_ANY)return!0;if(n===ut.TYPE_ARRAY_STRING||n===ut.TYPE_ARRAY_NUMBER||n===ut.TYPE_ARRAY){if(n===ut.TYPE_ARRAY)return t===ut.TYPE_ARRAY;if(t===ut.TYPE_ARRAY){let i;n===ut.TYPE_ARRAY_NUMBER?i=ut.TYPE_NUMBER:n===ut.TYPE_ARRAY_STRING&&(i=ut.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ut.TYPE_STRING;case"[object Number]":return ut.TYPE_NUMBER;case"[object Array]":return ut.TYPE_ARRAY;case"[object Boolean]":return ut.TYPE_BOOLEAN;case"[object Null]":return ut.TYPE_NULL;case"[object Object]":return t.jmespathType===q.TOK_EXPREF?ut.TYPE_EXPREF:ut.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class A6{constructor(){this._rootValue=null,this.runtime=new T6(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,u,l,h,f,d;switch(t.type){case"Field":return n===null?null:ao(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),f=1;f<t.children.length;f+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],n),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const m=[...t.children],k=this.computeSliceParams(n.length,m),[w,T,v]=k;if(s=[],v>0)for(f=w;f<T;f+=v)s.push(n[f]);else for(f=w;f>T;f+=v)s.push(n[f]);return s;case"Projection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(t.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(t.children[0],n),!ao(d))return null;h=[];const I=Object.values(d);for(f=0;f<I.length;f+=1)i=this.visit(t.children[1],I[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;const U=[],R=[];for(f=0;f<d.length;f+=1)r=this.visit(t.children[2],d[f]),Tl(r)||U.push(d[f]);for(let C=0;C<U.length;C+=1)i=this.visit(t.children[1],U[C]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case q.TOK_EQ:s=xl(o,a);break;case q.TOK_NE:s=!xl(o,a);break;case q.TOK_GT:s=o>a;break;case q.TOK_GTE:s=o>=a;break;case q.TOK_LT:s=o<a;break;case q.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case q.TOK_FLATTEN:const L=this.visit(t.children[0],n);if(!Array.isArray(L))return null;let B=[];for(f=0;f<L.length;f+=1)i=L[f],Array.isArray(i)?B=[...B,...i]:B.push(i);return B;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<t.children.length;f+=1)h.push(this.visit(t.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let O;for(f=0;f<t.children.length;f+=1)O=t.children[f],h[O.name]=this.visit(O.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),Tl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Tl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Tl(o);case"Literal":return t.value;case q.TOK_PIPE:return u=this.visit(t.children[0],n),this.visit(t.children[1],u);case q.TOK_CURRENT:return n;case q.TOK_ROOT:return this._rootValue;case"Function":const Y=[];for(let C=0;C<t.children.length;C+=1)Y.push(this.visit(t.children[C],n));return this.runtime.callFunction(t.name,Y);case"ExpressionReference":const et=t.children[0];return et.jmespathType=q.TOK_EXPREF,et;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const v6=new A6;ut.TYPE_ANY,ut.TYPE_ARRAY,ut.TYPE_ARRAY_NUMBER,ut.TYPE_ARRAY_STRING,ut.TYPE_BOOLEAN,ut.TYPE_EXPREF,ut.TYPE_NULL,ut.TYPE_NUMBER,ut.TYPE_OBJECT,ut.TYPE_STRING;function S6(e,t){const n=x6.parse(t);return v6.search(n,e)}const R6=(e,t)=>{const n=oo(e.id());if(!x(n))return 0;const[r,i]=rt(t,0,[H.NAME,H.NAME]),s=S6(n.json,r);return e.set(i,s),0},I6=(e,t)=>{const n=oo(e.id());if(!x(n))return 0;const[r,i]=rt(t,0,[H.NAME]);switch(Ot(r)){case"seek":{const[o]=rt(t,i,[H.NUMBER]);n.cursor=Dn(o,0,n.lines.length-1);break}case"line":n.cursor=Dn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,f]=rt(t,l,[H.NAME]);e.set(h,c[u]??0),++u,l=f}break}}return 0},N6=li({get(e,t){const n=d6(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=oo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=oo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=oo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=rt(t,0,[H.NAME,H.ANY]);return nd(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(_e).join(" ");return ti(G,_.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=_e(n),s=r.map(_e).join(" ");return ti(G,_.elementfocus,"$175",`!${s};${i}`),0}).command("readline",I6).command("readjson",R6).command("readbin",m6).command("with",(e,t)=>{const[n]=rt(t,0,[H.NAME]),r=br(_.book,bt.BOARD,n);if(r.length){const i=nn(...r);x(i)&&(_.board=ln(i),_.element={x:fr(0,Yt-1),y:fr(0,Ee-1)})}return 0});function mb(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=rt(i,a,[H.ANY]);ne(c)&&!xr(c)&&!Yr(c)&&!xi(c)&&!$n(c)?o.push(...c):o.push(c),a=u}switch(Ot(r)){case"get":case"post:json":Z1(G,_.elementfocus,e,t,n,r,o);break}return 0}const O6=li().command("fetch",(e,t)=>{const[n,r,i="get",s]=rt(t,0,[H.NAME,H.NAME,H.MAYBE_STRING]);return mb(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=rt(t,0,[H.ANY,H.NAME,H.NAME,H.MAYBE_STRING]);return mb(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=rt(t,0,[H.ANY]);switch(Ot(n)){default:q1(G,_.elementfocus,n);break;case"stop":J1(G,_.elementfocus);break}return 0}).command("twitchbroadcast",(e,t)=>{const[n]=rt(t,0,[H.NAME]);switch(Ot(n)){default:V1(G,_.elementfocus,n);break;case"stop":X1(G,_.elementfocus);break}return 0}),C6=li({set(e,t,n){return l8(e,t,n),[!1,void 0]},everytick(){const e=Zr(_.elementid),[t]=e;if(e.length===1&&At(t)){if(x(_.element))if(t.trim().length===0){const n=bn(_.elementid);n.sidebar=[]}else _.element.tickertext=t,_.element.tickertime=_.timestamp}else if(e.length>1)if(_.elementisplayer){const n=bn(_.elementid);n.sidebar=e}else{const n=bn(_.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,u;const[n,r]=rt(t,0,[H.NAME,H.ANY]),[i,s]=ob(n);function o(l){for(let h=0;h<l.length;++h){const f=l[h];x(f.id)&&e.send(f.id,s,r)}}switch(Ot(i)){case"all":for(const l of Object.keys(((c=_.board)==null?void 0:c.objects)??{}))e.send(l,s,r);break;case"self":e.message({session:G.session(),player:_.elementfocus,id:Ne(),sender:e.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((u=_.board)==null?void 0:u.objects)??{}))l!==e.id()&&e.send(l,s,r);break;default:{o(im(_.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(_e).join("");return se(_.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=_e(n);return Dt(_.elementid,e.id(),i,r,e.get,e.set),0});var zi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(zi||{});const L6={audio:rh,board:ZL,cli:r6,display:i6,element:u6,runtime:C6,lifecycle:h6,loader:N6,network:O6},Wf=["audio","board","display","network","lifecycle","element"],M6={0:[],1:["cli",...Wf],2:["loader",...Wf],3:["runtime",...Wf]},U6={0:new Map,1:new Map,2:new Map,3:new Map};function co(e){return(M6[e]??[]).map(n=>L6[n]).filter(x)}function Kf(e){const t=[],n=co(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function F6(e,t){const n=U6[e];if(!n.has(t)){let r;const i=co(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!x(r));++s);n.set(t,r)}return n.get(t)}function P6(e,t,n){const r=co(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function B6(e,t,n,r){const i=co(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function D6(e,t){const n=co(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function gb(e,t){const n=co(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var yb={},_b={},bb={};const Eb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");bb.encode=function(e){if(0<=e&&e<Eb.length)return Eb[e];throw new TypeError("Must be between 0 and 63: "+e)};const $6=bb,wb=5,kb=1<<wb,j6=kb-1,z6=kb;function W6(e){return e<0?(-e<<1)+1:(e<<1)+0}_b.encode=function(t){let n="",r,i=W6(t);do r=i&j6,i>>>=wb,i>0&&(r|=z6),n+=$6.encode(r);while(i>0);return n};var ga={};(function(e){function t(R,L,B){if(L in R)return R[L];if(arguments.length===3)return B;throw new Error('"'+L+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(R){const L=R.match(n);return L?{scheme:L[1],auth:L[2],host:L[3],port:L[4],path:L[5]}:null}e.urlParse=i;function s(R){let L="";return R.scheme&&(L+=R.scheme+":"),L+="//",R.auth&&(L+=R.auth+"@"),R.host&&(L+=R.host),R.port&&(L+=":"+R.port),R.path&&(L+=R.path),L}e.urlGenerate=s;const o=32;function a(R){const L=[];return function(B){for(let Y=0;Y<L.length;Y++)if(L[Y].input===B){const et=L[0];return L[0]=L[Y],L[Y]=et,L[0].result}const O=R(B);return L.unshift({input:B,result:O}),L.length>o&&L.pop(),O}}const c=a(function(L){let B=L;const O=i(L);if(O){if(!O.path)return L;B=O.path}const Y=e.isAbsolute(B),et=[];let C=0,S=0;for(;;)if(C=S,S=B.indexOf("/",C),S===-1){et.push(B.slice(C));break}else for(et.push(B.slice(C,S));S<B.length&&B[S]==="/";)S++;let b=0;for(S=et.length-1;S>=0;S--){const P=et[S];P==="."?et.splice(S,1):P===".."?b++:b>0&&(P===""?(et.splice(S+1,b),b=0):(et.splice(S,2),b--))}return B=et.join("/"),B===""&&(B=Y?"/":"."),O?(O.path=B,s(O)):B});e.normalize=c;function u(R,L){R===""&&(R="."),L===""&&(L=".");const B=i(L),O=i(R);if(O&&(R=O.path||"/"),B&&!B.scheme)return O&&(B.scheme=O.scheme),s(B);if(B||L.match(r))return L;if(O&&!O.host&&!O.path)return O.host=L,s(O);const Y=L.charAt(0)==="/"?L:c(R.replace(/\/+$/,"")+"/"+L);return O?(O.path=Y,s(O)):Y}e.join=u,e.isAbsolute=function(R){return R.charAt(0)==="/"||n.test(R)};function l(R,L){R===""&&(R="."),R=R.replace(/\/$/,"");let B=0;for(;L.indexOf(R+"/")!==0;){const O=R.lastIndexOf("/");if(O<0||(R=R.slice(0,O),R.match(/^([^\/]+:\/)?\/*$/)))return L;++B}return Array(B+1).join("../")+L.substr(R.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function f(R){return R}function d(R){return m(R)?"$"+R:R}e.toSetString=h?f:d;function p(R){return m(R)?R.slice(1):R}e.fromSetString=h?f:p;function m(R){if(!R)return!1;const L=R.length;if(L<9||R.charCodeAt(L-1)!==95||R.charCodeAt(L-2)!==95||R.charCodeAt(L-3)!==111||R.charCodeAt(L-4)!==116||R.charCodeAt(L-5)!==111||R.charCodeAt(L-6)!==114||R.charCodeAt(L-7)!==112||R.charCodeAt(L-8)!==95||R.charCodeAt(L-9)!==95)return!1;for(let B=L-10;B>=0;B--)if(R.charCodeAt(B)!==36)return!1;return!0}function k(R,L,B){let O=T(R.source,L.source);return O!==0||(O=R.originalLine-L.originalLine,O!==0)||(O=R.originalColumn-L.originalColumn,O!==0||B)||(O=R.generatedColumn-L.generatedColumn,O!==0)||(O=R.generatedLine-L.generatedLine,O!==0)?O:T(R.name,L.name)}e.compareByOriginalPositions=k;function w(R,L,B){let O=R.generatedLine-L.generatedLine;return O!==0||(O=R.generatedColumn-L.generatedColumn,O!==0||B)||(O=T(R.source,L.source),O!==0)||(O=R.originalLine-L.originalLine,O!==0)||(O=R.originalColumn-L.originalColumn,O!==0)?O:T(R.name,L.name)}e.compareByGeneratedPositionsDeflated=w;function T(R,L){return R===L?0:R===null?1:L===null?-1:R>L?1:-1}function v(R,L){let B=R.generatedLine-L.generatedLine;return B!==0||(B=R.generatedColumn-L.generatedColumn,B!==0)||(B=T(R.source,L.source),B!==0)||(B=R.originalLine-L.originalLine,B!==0)||(B=R.originalColumn-L.originalColumn,B!==0)?B:T(R.name,L.name)}e.compareByGeneratedPositionsInflated=v;function I(R){return JSON.parse(R.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=I;function U(R,L,B){if(L=L||"",R&&(R[R.length-1]!=="/"&&L[0]!=="/"&&(R+="/"),L=R+L),B){const O=i(B);if(!O)throw new Error("sourceMapURL could not be parsed");if(O.path){const Y=O.path.lastIndexOf("/");Y>=0&&(O.path=O.path.substring(0,Y+1))}L=u(s(O),L)}return c(L)}e.computeSourceURL=U})(ga);var Gf={};let K6=class c1{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new c1;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Gf.ArraySet=K6;var xb={};const Tb=ga;function G6(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||Tb.compareByGeneratedPositionsInflated(e,t)<=0}let H6=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){G6(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Tb.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};xb.MappingList=H6;const ya=_b,Be=ga,Al=Gf.ArraySet,Y6=xb.MappingList;let Ab=class l1{constructor(t){t||(t={}),this._file=Be.getArg(t,"file",null),this._sourceRoot=Be.getArg(t,"sourceRoot",null),this._skipValidation=Be.getArg(t,"skipValidation",!1),this._sources=new Al,this._names=new Al,this._mappings=new Y6,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new l1({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Be.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Be.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Be.getArg(t,"generated"),r=Be.getArg(t,"original",null);let i=Be.getArg(t,"source",null),s=Be.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Be.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Be.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Be.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Be.relative(s,i));const o=this._mappings.toArray().length>0?new Al:this._sources,a=new Al;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Be.join(r,c.source)),s!=null&&(c.source=Be.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=Be.join(r,c)),s!=null&&(c=Be.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const f=this._mappings.toArray();for(let d=0,p=f.length;d<p;d++){if(u=f[d],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(d>0){if(!Be.compareByGeneratedPositionsInflated(u,f[d-1]))continue;c+=","}c+=ya.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=ya.encode(h-o),o=h,c+=ya.encode(u.originalLine-1-i),i=u.originalLine-1,c+=ya.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=ya.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Be.relative(n,r));const i=Be.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Ab.prototype._version=3,yb.SourceMapGenerator=Ab;var vb={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(vb);var _a={exports:{}},V6={},X6=Object.freeze({__proto__:null,default:V6}),Sb=u1(X6);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;_a.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},_a.exports.initialize=t=>e=t}else{const e=Sb,t=Sb;_a.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},_a.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Rb=_a.exports;const q6=Rb;function J6(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let ba=null;var Z6=function(){if(ba)return ba;const t=[];return ba=q6().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,f){const d=new J6;d.generatedLine=r+1,d.generatedColumn=i,s&&(d.lastGeneratedColumn=o-1),a&&(d.source=c,d.originalLine=u+1,d.originalColumn=l,h&&(d.name=f)),t[t.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw ba=null,n}),ba};const Tt=ga,Hf=vb,vl=Gf.ArraySet,Q6=Rb,tM=Z6,Yf=Symbol("smcInternal");class Ue{constructor(t,n){return t==Yf?Promise.resolve(this):nM(t,n)}static initialize(t){Q6.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return rM(t,n)}static async with(t,n,r){const i=await new Ue(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Ue.prototype._version=3,Ue.GENERATED_ORDER=1,Ue.ORIGINAL_ORDER=2,Ue.GREATEST_LOWER_BOUND=1,Ue.LEAST_UPPER_BOUND=2;class Ea extends Ue{constructor(t,n){return super(Yf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const u=Tt.getArg(i,"sourcesContent",null),l=Tt.getArg(i,"mappings"),h=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(f){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(f)?Tt.relative(c,f):f}),r._names=vl.fromArray(a.map(String),!0),r._sources=vl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return Tt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,tM().then(f=>(r._wasm=f,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ea(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Ue.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Ue.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Ue.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Tt.getArg(t,"source");const r=Tt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(t,"bias",Ue.GREATEST_LOWER_BOUND);r==null&&(r=Ue.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Tt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(t,"line"),originalColumn:Tt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(t,"bias",Ue.GREATEST_LOWER_BOUND);i==null&&(i=Ue.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ea.prototype.consumer=Ue;class eM extends Ue{constructor(t,n){return super(Yf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new vl,r._names=new vl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=Tt.getArg(c,"offset"),l=Tt.getArg(u,"line"),h=Tt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new Ue(Tt.getArg(c,"map"),n).then(d=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:d}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Tt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")},r=Hf.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const f={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(t,n,r){const i=n||null,s=r||Ue.GENERATED_ORDER;let o;switch(s){case Ue.GENERATED_ORDER:o=this._generatedMappings;break;case Ue.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=Tt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return Hf.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Tt.getArg(t,"line"),r={source:Tt.getArg(t,"source"),originalLine:n,originalColumn:Tt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,Hf.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function nM(e,t){let n=e;typeof e=="string"&&(n=Tt.parseSourceMapInput(e));const r=n.sections!=null?new eM(n,t):new Ea(n,t);return Promise.resolve(r)}function rM(e,t){return Ea.fromSourceMap(e,t)}var Ib={};const iM=yb.SourceMapGenerator,Sl=ga,sM=/(\r?\n)/,oM=10,lo="$$$isSourceNode$$$";let aM=class pd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[lo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new pd,s=t.split(sM);let o=0;const a=function(){const d=m(),p=m()||"";return d+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(d){if(l!==null)if(c<d.generatedLine)f(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,d.generatedColumn-u);s[o]=h.substr(d.generatedColumn-u),u=d.generatedColumn,f(l,p),l=d;return}for(;c<d.generatedLine;)i.add(a()),c++;u<d.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,d.generatedColumn)),s[o]=h.substr(d.generatedColumn),u=d.generatedColumn),l=d},this),o<s.length&&(l&&f(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(d){const p=n.sourceContentFor(d);p!=null&&(r!=null&&(d=Sl.join(r,d)),i.setSourceContent(d,p))}),i;function f(d,p){if(d===null||d.source===void 0)i.add(p);else{const m=r?Sl.join(r,d.source):d.source;i.add(new pd(d.originalLine,d.originalColumn,m,p,d.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[lo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[lo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[lo]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[lo]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Sl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][lo]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Sl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new iM(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,f=u.length;h<f;h++)u.charCodeAt(h)===oM?(n.line++,n.column=0,h+1===f?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};Ib.SourceNode=aM;var cM=Ib.SourceNode;let Nb=0;const Ob=Mr,lM=["Command","lines"];class uM extends sL{constructor(){super(C_,{traceInitPerf:Mr,skipValidations:!Mr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Nt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Nt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(fa)}])}));Nt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Nt(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Nt(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Nt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(s_)}));Nt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(uf)}));Nt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(hf)}])}));Nt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(i_)}));Nt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(o_),this.SUBRULE(this.words),this.CONSUME(a_)}));Nt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(no),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Nt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Nt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Nt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Nt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(yf),this.SUBRULE(this.words)}));Nt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(E_),this.SUBRULE(this.words)}));Nt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(_f),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Nt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(fa)),this.CONSUME4(no),this.CONSUME4(bf)}}])}));Nt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(no),this.CONSUME(bf)}}])}));Nt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(gl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Nt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(no),this.CONSUME(Ef),this.CONSUME(_f),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Nt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(no),this.CONSUME(Ef),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Nt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(A_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Nt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(v_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Nt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(S_),this.SUBRULE(this.words)}));Nt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(R_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Nt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(I_)}));Nt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(N_)}));Nt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(x_)}));Nt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(T_)}));Nt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(ff),this.SUBRULE2(this.and_test)})}));Nt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(pf),this.SUBRULE2(this.not_test)})}));Nt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(df),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Nt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Nt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(u_)},{ALT:()=>this.CONSUME(h_)},{ALT:()=>this.CONSUME(f_)},{ALT:()=>this.CONSUME(d_)},{ALT:()=>this.CONSUME(p_)},{ALT:()=>this.CONSUME(m_)}])}));Nt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(ff),this.SUBRULE2(this.and_test_value)})}));Nt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(pf),this.SUBRULE2(this.not_test_value)})}));Nt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(df),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Nt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Nt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(mf)},{ALT:()=>this.CONSUME(gf)}]),this.SUBRULE(this.term)}));Nt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Nt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(y_)},{ALT:()=>this.CONSUME(yf)},{ALT:()=>this.CONSUME(__)},{ALT:()=>this.CONSUME(b_)}]),this.SUBRULE(this.factor)}));Nt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(mf)},{ALT:()=>this.CONSUME(gf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Nt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(g_),this.SUBRULE(this.factor)})}));Nt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Nt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(c_)},{ALT:()=>this.CONSUME(on)},{ALT:()=>this.CONSUME(l_)},{ALT:()=>{this.CONSUME(w_),this.SUBRULE(this.expr),this.CONSUME(k_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=lM.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(Nb++).toString().padStart(3),c=s?"font-weight: bold;":"";if(Ob&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),Ob&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),Nb--},i)}}const uo=new uM;if(sT){const e=uo.getGAstProductions(),t=yL(e);console.info(t)}const hM=uo.getBaseCstVisitorConstructor();var gt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(gt||{}),gs=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(gs||{}),Vr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Vr||{}),Rl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Rl||{});function fM(e){return!!(e!=null&&e.tokenType)}function ar(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class dM extends hM{constructor(){super();Nt(this,"unique",0);Mr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&fM(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():x(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:ar(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:ar(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:ar(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:ar(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:ar(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,ar(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,ar(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Ne(),i=Ne();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Ne(),i=Ne(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Ne(),i=Ne(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Ne();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=ar(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}command_toast(n){const i=ar(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,"toast"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=ar(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=ar(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(ar(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const pM=new dM,Nn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Il="zss.js";function Qt(e,t){return new cM(e.startLine??1,e.startColumn??1,Il,t)}function Vf(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Xf(e){return`'${Vf(e)}'`}function Nl(e){if(e.startsWith('"'))return Nl(e.replaceAll(/(^"|"$)/g,""));const t=Pf(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Uf?`', api.get('${Vf(r.image.substring(1))}'), '`:Vf(r.image)).join("")}'].join('')`}function ho(e){return e.filter(t=>t!==void 0).map(ie)}function Cb(e){return Qt(e,"")}function mM(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function He(e,t,n){return Qt(e,[`api.${t}(`,...mM(n,", "),")"])}function gM(e){if(e.type===gt.COMPARE&&e.compare.type===gt.COMPARE_ITEM)switch(e.compare.method){case gs.IS_EQ:return He(e,"isEq",[ie(e.lhs),ie(e.rhs)]);case gs.IS_NOT_EQ:return He(e,"isNotEq",[ie(e.lhs),ie(e.rhs)]);case gs.IS_LESS_THAN:return He(e,"isLessThan",[ie(e.lhs),ie(e.rhs)]);case gs.IS_GREATER_THAN:return He(e,"isGreaterThan",[ie(e.lhs),ie(e.rhs)]);case gs.IS_LESS_THAN_OR_EQ:return He(e,"isLessThanOrEq",[ie(e.lhs),ie(e.rhs)]);case gs.IS_GREATER_THAN_OR_EQ:return He(e,"isGreaterThanOrEq",[ie(e.lhs),ie(e.rhs)])}return Qt(e,"")}function ys(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ie(n),")"])}function Lb(e,t,n){return e.prepend(`api.${t}(`),e.add([ie(n),")"])}function yM(e,t){if(e.type===gt.OPERATOR_ITEM)switch(e.operator){case Vr.PLUS:return ys(t,"opPlus",e.rhs);case Vr.MINUS:return ys(t,"opMinus",e.rhs);case Vr.POWER:return ys(t,"opPower",e.rhs);case Vr.MULTIPLY:return ys(t,"opMultiply",e.rhs);case Vr.DIVIDE:return ys(t,"opDivide",e.rhs);case Vr.MOD_DIVIDE:return ys(t,"opModDivide",e.rhs);case Vr.FLOOR_DIVIDE:return ys(t,"opFloorDivide",e.rhs);case Vr.UNI_PLUS:return Lb(t,"opUniPlus",e.rhs);case Vr.UNI_MINUS:return Lb(t,"opUniMinus",e.rhs)}return Qt(e,"")}function _M(e){if(e.type===gt.OPERATOR){const t=e.lhs?ie(e.lhs):Qt(e,"");return e.items.forEach(n=>yM(n,t)),t}return Qt(e,"")}function Ol(e,t){return Qt(e,[He(e,"jump",[`${t}`]),"; continue;"])}function Ti(e){return Nn.linelookup[e??""]??-1}function qf(e,t){Nn.linelookup[e]=t}function fo(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&(i.done=n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&(i.skip=n);break;case gt.LINE:fo(i.stmts,t,n);break}}}function Mb(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&qf(i.done,n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&qf(i.skip,n);break;case gt.LINE:Mb(i.stmts,t,n);break}}}function ie(e){var t;switch(e.type){case gt.PROGRAM:return Qt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ie).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Il}`]);case gt.API:return Qt(e,["  ",He(e,e.method,ho(e.words)),`;
`]);case gt.LINE:return Qt(e,[`case ${e.lineindex}:
`,...e.stmts.map(ie).flat(),`  break;
`]);case gt.MARK:return Qt(e,`  // ${e.comment}
`);case gt.GOTO:{const n=Ti(e.id);return Qt(e,["  ",Ol(e,n),`
`])}case gt.COUNT:return Qt(e,`${e.index}`);case gt.LITERAL:switch(e.literal){case Rl.NUMBER:return Qt(e,`${e.value}`);case Rl.STRING:return Qt(e,Xf(e.value));case Rl.TEMPLATE:return Qt(e,Nl(e.value))}return Cb(e);case gt.TEXT:return Qt(e,["  ",He(e,"text",[Nl(e.value)]),`;
`]);case gt.STAT:if(Nn.isfirststat){Nn.isfirststat=!1;const n=e.value.trim().split(" ").map(Xf);return Qt(e,["  ",He(e,"stat",n),`;
`])}return Qt(e,`  // skipped ${e.value}
`);case gt.LABEL:{const n=Ot(e.name),r=e.active?"label":"comment";Nn.labels[n]||(Nn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Nn.labels[n].push(i),Qt(e,`  // ${i} '${n}' ${r}
`)}case gt.HYPERLINK:return Qt(e,["  ",He(e,"hyperlink",[Nl(e.text),...ho(e.link)]),`;
`]);case gt.MOVE:{const n=He(e,"command",[Xf("go"),ho(e.words)].flat());return e.wait?Qt(e,["  if (",n,`) { continue; };
`]):Qt(e,["  ",n,`;
`])}case gt.COMMAND:return Qt(e,["  if (",He(e,"command",ho(e.words)),`) { continue; };
`]);case gt.IF:{const n=((t=e.block)==null?void 0:t.type)===gt.IF_BLOCK?e.block:void 0;if(x(n)){fo([e.check],gt.IF_CHECK,n.skip);const r=Qt(e,ie(e.check));return n.lines.forEach(i=>r.add(ie(i))),Mb(n.altlines,gt.ELSE_IF,Ti(n.done)),n.altlines.forEach(i=>r.add(ie(i))),r}return Qt(e,ie(e.check))}case gt.IF_CHECK:{const n=Ti(e.skip);return n===-1?Qt(e,["  ",He(e,e.method,ho(e.words)),`;
`]):Qt(e,["  if (!",He(e,e.method,ho(e.words)),") { ",Ol(e,n),` }
`])}case gt.ELSE_IF:case gt.ELSE:{const n=Qt(e,"");return e.lines.forEach(r=>n.add(ie(r))),n}case gt.WHILE:{const n=Ti(e.loop),r=Ti(e.done),i=Qt(e,"");return fo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.REPEAT:{const n=Ti(e.loop),r=Ti(e.done),i=Qt(e,"");return fo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.WAITFOR:{const n=Qt(e,"");return fo(e.lines,gt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ie(r))}),n}case gt.FOREACH:{const n=Ti(e.loop),r=Ti(e.done),i=Qt(e,"");return fo(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(ie(s))}),i}case gt.BREAK:return Qt(e,["  ",Ol(e,e.goto),`
`]);case gt.CONTINUE:return Qt(e,["  ",Ol(e,e.goto),`
`]);case gt.OR:return He(e,"or",e.items.map(ie));case gt.AND:return He(e,"and",e.items.map(ie));case gt.NOT:return He(e,"not",e.items.map(ie));case gt.COMPARE:return gM(e);case gt.OPERATOR:return _M(e);case gt.EXPR:return He(e,"expr",e.words.map(ie));default:return console.error("<unsupported node>",e.type,e),Cb(e)}}function Xr(e){if(x(e))switch(e.type===gt.LINE&&++Nn.lineindex,e.lineindex=Nn.lineindex,e.type){case gt.PROGRAM:e.lines.forEach(Xr);break;case gt.LINE:e.stmts.forEach(Xr);break;case gt.MARK:qf(e.id,e.lineindex);break;case gt.IF:Xr(e.check),Xr(e.block);break;case gt.IF_BLOCK:e.lines.forEach(Xr),e.altlines.forEach(Xr);break;case gt.ELSE_IF:e.lines.forEach(Xr);break;case gt.ELSE:case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.WAITFOR:e.lines.forEach(Xr);break;case gt.MOVE:case gt.COMMAND:case gt.IF_CHECK:e.words.forEach(Xr);break}}function bM(e){return Nn.labels={},Nn.internal=1,Nn.lineindex=0,Nn.isfirststat=!0,Xr(e),{...ie(e).toStringWithSourceMap({file:`${Il}.map`}),...Nn}}function Ub(e){return ne(e)?e.length>0?1:0:e??0}function EM(e){return`${e}_chip`}function Fb(e=""){return`vm:${e??""}`}function wM(e,t,n){var u,l;const r=EM(e),i=_s(r);let s;const o=Xe(Object.entries(n.labels??{}));(!ne(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=n.errors)==null?void 0:u.length)??0)!==0?1:0);function a(h,f){_.words=f;const d=F6(t,h);return x(d)?d(c,f):h!=="send"?a("send",[h,...f]):0}const c={halt(){PM(r)},id(){return e},set(h,f){const[d,p]=B6(t,c,h,f);if(d)return p},get(h){const[f,d]=P6(t,c,h);if(f)return d},tick(h){const f=Ct(i.ps)?i.ps:0,d=f%h===0;if(i.ps=f+1,d===!1)return!1;if(c.shouldtick()===!1)return gb(t,c),!1;i.lc=0,i.ys=0,_.get=c.get,D6(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ye(G,_.elementfocus,"crash",p.message),i.es=1}return gb(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Ct(i.lc)?++i.lc>ci.HALT_AT_COUNT:!0},hm(){if(ne(i.mg)&&ne(i.lb)){const[h]=i.mg;if(x(h))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)return p.find(m=>Ct(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,f,d,p){G.emit(h,`${Fb(f)}:${d}`,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(ne(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h){const m=p.findIndex(k=>k>0);m>=0&&(p[m]*=-1)}}},restore(h){if(ne(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)for(let m=0;m<p.length;m++)p[f]=Math.abs(p[f])}},getcase(){i.ec=Ct(i.ec)?i.ec:1;const h=c.hm();if(h&&ne(i.mg)){const[,f,d,p]=i.mg;c.set("sender",d),x(f)&&c.set("arg",f),p&&(c.set("player",p),_.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Ct(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const f=Yx.parse(h),[d]=f.filter(p=>p.fileName===Il);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[f,...d]=h;return a(Ot(_e(f)),d)},if(...h){const[f,d]=rt(h,0,[H.ANY]),p=Ub(f);return p&&d<h.length&&c.command(...h.slice(d)),p?1:0},try(...h){const[,f]=rt(h,0,[H.DIR]),d=c.command("go",...h);return d&&f<h.length&&c.command(...h.slice(f)),d?1:0},take(...h){const[f,d,p]=rt(h,0,[H.NAME,H.ANY]),m=Ct(d),k=m?p:1,w=c.get(f),T=m?d:1;if(!Ct(w))return k<h.length&&c.command(...h.slice(k)),1;const v=w-T;return v<0?(k<h.length&&c.command(...h.slice(k)),1):(c.set(f,v),0)},give(...h){const[f,d,p]=rt(h,0,[H.NAME,H.ANY]),m=Ct(d),k=m?p:1,w=c.get(f),T=m?d:1,v=w===void 0?1:0;return v&&k<h.length&&c.command(...h.slice(k)),c.set(f,Do(w,0)+T),v},repeatstart(h,...f){const[d,p]=rt(f,0,[H.NUMBER]),m=`repeatcount${h}`,k=`repeatwords${h}`;i[m]=d,i[k]=p<f.length?f.slice(p):void 0},repeat(h){const f=`repeatcount${h}`,d=`repeatwords${h}`;if(!Ct(i[f]))return 0;const p=i[f];i[f]=p-1;const m=p>0,k=i[d];return m&&ne(k)&&c.command(...k),m?1:0},foreachstart(h,...f){const[d,p,m,k]=rt(f,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let w=Math.min(p,m),T=Math.max(p,m);const v=(k??0)||1;if(v<0){const I=w;w=T,T=I}return c.set(d,w-v),0},foreach(h,...f){const[d,p,m,k,w]=rt(f,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let T=Math.min(p,m),v=Math.max(p,m);const I=(k??0)||1;if(I<0){const L=T;T=v,v=L}let U=c.get(d);!Ct(U)||U<T||U>v?U=T:U+=I;const R=U<=v?1:0;return R&&(c.set(d,U),w<f.length&&c.command(...f.slice(w))),R},waitfor(...h){const[f]=rt(h,0,[H.ANY]),d=Ub(f);return d||c.yield(),d?1:0},or(...h){let f=0;for(let d=0;d<h.length;){const[p,m]=rt(h,d,[H.ANY]);if(f=p,f)break;d=m}return f},and(...h){let f=0;for(let d=0;d<h.length;){const[p,m]=rt(h,d,[H.ANY]);if(f=p,!f)break;d=m}return f},not(...h){const[f]=rt(h,0,[H.ANY]);return f?0:1},expr(...h){const[f]=rt(h,0,[H.ANY]);return f},isEq(h,f){const[d]=rt([h],0,[H.ANY]),[p]=rt([f],0,[H.ANY]);return typeof d=="object"||typeof p=="object"?W1(d,p)?1:0:d===p?1:0},isNotEq(h,f){return this.isEq(h,f)?0:1},isLessThan(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return d<p?1:0},isGreaterThan(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return d>p?1:0},isLessThanOrEq(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return d>=p?1:0},opPlus(h,f){const[d]=rt([h],0,[H.ANY]),[p]=rt([f],0,[H.ANY]);return d+p},opMinus(h,f){const[d]=rt([h],0,[H.ANY]),[p]=rt([f],0,[H.ANY]);return d-p},opPower(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return Math.pow(d,p)},opMultiply(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return d*p},opDivide(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return d/p},opModDivide(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return d%p},opFloorDivide(h,f){const[d]=rt([h],0,[H.NUMBER]),[p]=rt([f],0,[H.NUMBER]);return Math.floor(d/p)},opUniPlus(h){const[f]=rt([h],0,[H.NUMBER]);return+f},opUniMinus(h){const[f]=rt([h],0,[H.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,c),c}function Jf(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ne(r)?r.forEach(i=>{t.push(Jf(i))}):t.push(Jf(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function kM(e){const t=wf(`${e}
`);if(t.errors.length>0)return t;uo.input=t.tokens;const n=uo.program();if(uo.errors.length>0)return{tokens:t.tokens,errors:uo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=pM.go(n);return r?(Jf(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Zf=Object.getPrototypeOf(function*(){}).constructor;function xM(e,t){const n=`compile-${e}`;console.time(n);const r=kM(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=bM(r.ast);if(i.code){oT&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Zf("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Zf("api"," ")}}}return{...r,...i,source:"",code:new Zf("api"," ")}}function TM(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=xM(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return x(s)?s.isended():!0},halt(i){const s=t[i];return x(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];x(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!x(t[i])){const h=n(a,c);if(u=t[i]=wM(i,s,h),(l=h.errors)!=null&&l.length){const[f]=h.errors,d=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((w,T)=>[w,T]);p.slice(d-5,d).forEach(([w,T])=>{ye(G,qr(),"build",`$grey${T+1} $grey${w}`)});const[m,k]=p[d]??[];if(At(m)&&x(k)){const w=(f.column??1)-1,T=w+f.length,v=w<m.length?m:`${m}*`,I=v.substring(0,w),U=v.substring(w,T),R=v.substring(T);ye(G,qr(),"build",`$red${k+1} $grey${I}$red${U}$grey${R}`)}return f.message.split(`
`).forEach(w=>{ye(G,qr(),"build",w)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=lr(i.target),a=t[s];if(x(a)){const c={...i,target:o};a.message(c)}}};return r}let Pb=0;function AM(){switch(Pb++){case 0:return zt.BLUE;case 1:return zt.GREEN;case 2:return zt.CYAN;case 3:return zt.RED;case 4:return zt.PURPLE;case 5:return zt.YELLOW;default:return Pb=0,zt.WHITE}}const De=new Po,yn={},Cl={};function Bb(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return x(yn[s])||(yn[s]=qx(e,t,n,r,i)),yn[s]}function vM(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return x(Cl[s])||(Cl[s]=Jx(e,t,n)),Cl[s].id=i,Cl[s]}function SM(e,t){const n=`sprites:${e}:${t}`;return x(yn[n])||(yn[n]=Zx(e,t)),yn[n]}function RM(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return x(yn[s])||(yn[s]=Qx(e,t,n,r,i)),yn[s]}function Qf(e,t,n,r){const i=`media:${e}:${t}`;x(yn[i])||(yn[i]=tT(e,t,n,r));const s=yn[i];return s.mime=n,s.media=r,s}function IM(e,t){const n=`control:${e}:${t}`;return x(yn[n])||(yn[n]=eT(e,t)),yn[n]}const Wi=.4;function Db(e,t){const n=[];De.x=e-Wi,De.y=t-Wi,n.push(De.angle()),De.x=e+Wi,De.y=t-Wi,n.push(De.angle()),De.x=e-Wi,De.y=t+Wi,n.push(De.angle()),De.x=e+Wi,De.y=t+Wi,n.push(De.angle());const r=Math.round(th(Math.min(...n))),i=Math.round(th(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function NM(e,t,n,r,i){var L;if(!x(r)||!x(r.terrain)||!x(r.objects))return[];const s=[];let o=t;const a=o===0,c=Yt,u=Ee,l=a?zt.BLACK:zt.ONCLEAR,h=Bb(e,o++,c,u,l);s.push(h);const f=o++,d=SM(e,f);d.sprites=[],s.push(d);const p=r.isdark?1:0,m=RM(e,o++,c,u,p);s.push(m),m.alphas.fill(p);const k=Bb(e,o++,c,u,zt.ONCLEAR);s.push(k),k.char.fill(0);const w={...Bf(Yt,Ee,AM(),zt.ONCLEAR),...k},T=IM(e,o++);if(i&&(s.push(T),At(r.camera)))switch(Ot(r.camera)){default:T.viewscale=1.5;break;case"near":T.viewscale=3;break;case"far":T.viewscale=1;break}for(let B=0;B<r.terrain.length;++B){const O=r.terrain[B],Y=K_(n,O,0,zt.BLACK,zt.ONCLEAR);h.char[B]=Y.char,h.color[B]=Y.color,h.bg[B]=Y.bg}const v=Object.values(r.objects??{});for(let B=0;B<v.length;++B){const O=v[B];if(x(O.removed))continue;const Y=O.id??"",et=K_(n,O,1,zt.WHITE,zt.BLACK),C=vM(e,f,Y,B);if(C.x=O.x??0,C.y=O.y??0,C.char=et.char,C.color=et.color,C.bg=et.bg,d.sprites.push(C),p){if(et.light>0){const S=[],b=Dn(Math.round(et.light),1,10),P=b*.5,X=Jr(r,C),D=1/P;if(m.alphas[X]=0,b>1)for(let ct=1;ct<=b;++ct)for(let tt=C.y-ct;tt<=C.y+ct;++tt)for(let ft=C.x-ct;ft<=C.x+ct;++ft){if(ft===C.x&&tt===C.y)continue;De.x=ft-C.x,De.y=tt-C.y;const V=De.length();if(V>b)continue;const z=Jr(r,{x:ft,y:tt});if(z===-1)continue;const Et=Math.round(th(De.angle()));let ot=0;for(let xt=0;xt<S.length;++xt){const Bt=S[xt];Et>=Bt[0]&&Et<=Bt[1]&&(ot=Math.max(ot,Bt[2]))}m.alphas[z]=Math.min(m.alphas[z],ot+(V<P?0:(V-P)*D)),m.alphas[z]=Dn(m.alphas[z],0,1);const lt=Cn(r,((L=r.lookup)==null?void 0:L[z])??"");if(x(lt)){const xt=[...Db(De.x,De.y),.25];S.push(xt)}const Lt=r.terrain[z],Xt=Er(n,Lt),Mt=(Lt==null?void 0:Lt.collision)??(Xt==null?void 0:Xt.collision);if(sh(Gt.ISBULLET,Mt)){const xt=[...Db(De.x,De.y),1];let Bt=0;for(Bt=0;Bt<S.length;++Bt){const Ut=S[Bt];if(Ut[1]>Ut[0]&&xt[1]>=Ut[0]&&xt[0]<=Ut[1]&&xt[2]>=1&&Ut[2]>=1){S[Bt]=[Math.min(xt[0],Ut[0]),Math.max(xt[1],Ut[1]),1];break}}Bt===S.length&&S.push(xt)}}}else if(Ai(Y)){const S=Jr(r,C);m.alphas[S]=0}}if(At(O.tickertext)&&Ct(O.tickertime)&&O.tickertext.length){const S=Yt,b=ib(O.tickertext,S,Ee-1),P=(b==null?void 0:b.measuredwidth)??1,X=O.x??0,D=O.y??0,ct=D<Ee*.5;w.x=X-Math.floor(P*.5),w.y=D+(ct?1:-1),w.x+P>Yt&&(w.x=Yt-P),w.x<0&&(w.x=0),rb(O.tickertext,w,!0)}Y===e&&(T.focusx=C.x,T.focusy=C.y,T.focusid=Y)}const I=le(Pt.MAIN),U=wi(I,Pt.MAIN);if(At(U.palette)){const B=In(I,bt.PALETTE,U.palette),O=ln(B);x(O==null?void 0:O.bits)&&s.push(Qf(e,o++,"image/palette",Array.from(O.bits)))}if(At(U.charset)){const B=In(I,bt.CHARSET,U.charset),O=ln(B);x(O==null?void 0:O.bits)&&s.push(Qf(e,o++,"image/charset",Array.from(O.bits)))}const R=Object.keys(r.objects).filter(Ai);return s.push(Qf(e,o++,"text/players",R.join(","))),s}const Kn=TM();var Pt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Pt||{});const me={halt:!1,session:Ne(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map,boardruntime:new Map};function OM(){return me.session}function qr(){return me.operator}function CM(e){me.operator=e}function LM(e){me.halt=e}function MM(){return me.halt}function po(){return[...me.books.values()]}function UM(){const[e]=me.books.values();return e}function kr(e){const t=Ot(e);return me.books.get(e)??po().find(n=>n.name===t)}function Ll(e,t){x(kr(t))&&(me.software[e]=t)}function le(e){return kr(me.software[e])}function $b(e){const t=B_([]);return At(e)&&(t.name=e),td(t),ti(G,me.operator,`created [book] ${t.name}`),t}function FM(e){let t=kr(e);return x(t)||(t=B_([]),t.name=e),td(t),ti(G,me.operator,`created [book] ${t.name}`),t}function _n(e,t){let n=x(t)?FM(t):le(e);return x(n)||(x(n)||(n=UM()),x(n)||(n=$b(t)),x(n)&&ti(G,me.operator,`opened [book] ${n.name} for ${e}`)),Ll(e,n.id),n}function Ki(e,t,n){return vf(_n(e),n,t)}function _s(e){const t=_n("main");return wi(t,e)}function jb(){const e=_n("main");return wi(e,"main")}function PM(e){const t=_n("main");return G_(t,e)}function BM(e,t){me.books.clear(),e.forEach(r=>{me.books.set(r.id,r),r.name==="main"&&(me.software.main=r.id)});const n=kr(t);if(x(n)&&Ll("main",n.id),!me.software.main){const r=me.books.values().next();r.value&&(me.software.main=r.value.id)}}function td(e){return me.books.set(e.id,e),e.id}function DM(e){const t=kr(e);t&&me.books.delete(t.id)}function $M(e){if(!At(e)||!e)return ye(G,e,"login",`failed for playerid ==>${e}<==`);const t=le("main");if(!x(t))return ye(G,e,"login:main","login failed to find book 'main'");const n=ps(t,e);if(x(n))return!0;const r=br(t,bt.BOARD,"title");if(r.length===0)return ye(G,e,"login:title","login failed to find board with 'title' stat");const i=pa(t,"player");if(!x(i))return ye(G,e,"login:player","login failed to find object type 'player'");const s=jp(e,r),o=ln(s);if(x(o)){const a=P_(s,"startx"),c=P_(s,"starty"),u=Ct(a)?a:Math.round(Yt*.5),l=Ct(c)?c:Math.round(Ee*.5),h=i.name??"player",f=cd(o,{x:u,y:l},h,e);if(x(f==null?void 0:f.id))return f.player=e,bl(t,e,o.id),!0}return!1}function jM(e){const t=le("main"),n=ps(t,e);bl(t,e,""),Nf(t,n,Cn(n,e)),Vb(n,e),Kn.halt(e),G_(t,e)}function Gn(e){const t=le("main");return ps(t,e)}function zM(e){const t=le("main"),n=CL(t,e),r=ps(t,e),i=Cn(r,e);return n&&x(i)}function WM(e){const t=le("main"),n=Rf(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Ai(c)&&x(e[c])===!1&&(e[c]=0,bl(t,c,i.id))}}}function zb(e){Kn.message(e)}function wa(e,t,n,r){const i=Fr(t);At(n.id)&&G.emit(e,"vm:touched",[n.id,i,r])}function ed(e,t,n,r){if(!x(n==null?void 0:n.id))return!1;const i=Y_(e,t,n,r);if(x(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=br(e,bt.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=nn(o);io(e,n.id,a.id,{x:Yt-1,y:r.y})}}else if(r.x>=Yt){const o=br(e,bt.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=nn(o);io(e,n.id,a.id,{x:0,y:r.y})}}else if(r.y<0){const o=br(e,bt.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=nn(o);io(e,n.id,a.id,{x:r.x,y:Ee-1})}}else if(r.y>=Ee){const o=br(e,bt.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=nn(o);io(e,n.id,a.id,{x:r.x,y:0})}}}else wa("",i,n,"thud");if(n.kind==="player"){const o=Ai(i.id);wa(n.id,n,i,o?"bump":"touch")}else if(n.collision===Gt.ISBULLET){const o=Ai(n.party),a=Ai(i.id);o!==a?wa(n.party??"",n,i,"shot"):wa("",n,i,"thud")}else wa("",n,i,"bump");const s=Er(e,i);return i.destructible??(s==null?void 0:s.destructible)?(x(i==null?void 0:i.id)?Hr(_.book,_.board,i,_.timestamp):Tr(t,{x:r.x,y:r.y}),!0):!1}return!0}function Wb(e,t,n,r,i=ME){var h;if(!x(e)||!x(t)||!x(n))return;const s={..._};_.book=e,_.board=t,_.element=n,_.elementid=n.id??"",_.elementisplayer=Ai(_.elementid);const o=_.element.player??me.operator;_.elementfocus=_.elementisplayer?_.elementid:o;const a=Er(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Ot(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Kn.tick(u,zi.RUNTIME,Ct(c)?c:i,l,r),Ct(n==null?void 0:n.tickertime)&&_.timestamp-n.tickertime>Na*5&&(n.tickertime=0,n.tickertext=""),_.elementisplayer){const f=_s(_.elementid);Ct(f.inputcurrent)&&(f.inputcurrent=0)}Hn(s).forEach(f=>{_[f]=s[f]})}function KM(e,t){me.loaders.set(e,t)}function GM(e){Kn.halt(e)}function HM(){const e=Kn.ids();for(let n=0;n<e.length;++n)Kn.halt(e[n]);const t=le("main");x(t)&&(t.flags={})}function YM(){const e=le("main");if(!x(e))return;const t=e.timestamp+1,n=ci.HALT_AT_COUNT;ci.HALT_AT_COUNT=n*2,me.loaders.forEach((i,s)=>{const o={..._};_.timestamp=e.timestamp,_.book=e,_.board=void 0,_.element=void 0,_.elementid=s,_.elementisplayer=!1,_.elementfocus=me.operator;const a=f6(s);x(a)&&Kn.arg(s,a),Kn.tick(s,zi.LOADER,1,"loader",i),Kn.isended(s)&&(Kn.halt(s),me.loaders.delete(s)),Hn(o).forEach(c=>{_[c]=o[c]})}),ci.HALT_AT_COUNT=n,e.timestamp=t,_.timestamp=t;const r=Rf(e);for(let i=0;i<r.length;++i){const s=r[i],o=BL(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:u,code:l,object:h}=o[a];u===bt.ERROR?Kn.halt(c):Wb(e,s,h,l)}}}function nd(e,t){const n=le("main");if(!x(n))return;function r(a,c){for(let u=0;u<a.length;++u){const l=a[u];if(x(l.id)){const h=`${Fb(l.id)}:${c}`;G.emit("",h,t)}}}const{target:i,path:s}=lr(e),o=Rf(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Ot(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(im(c,[i]),s);break}}}}function VM(e,t=""){var s;const n=_n("main");if(!x(n))return;const r=`${e}_cli`;_.timestamp=n.timestamp,_.book=n,_.board=ps(n,e),_.element=Cn(_.board,e),_.elementid=((s=_.element)==null?void 0:s.id)??"",_.elementisplayer=!0,_.elementfocus=_.elementid||e;const i=ci.HALT_AT_COUNT;ci.HALT_AT_COUNT=i*8,Rd(G,e,"running",n.timestamp,r,t),Kn.once(r,zi.CLI,"cli",t),ci.HALT_AT_COUNT=i}function Ml(e){var o;const t=_n("main"),n=Ei(t,e);if(!x(t)||!x(n)||!x(_.element))return;const r=`${e}_run`,i=Ot(_.element.name??((o=_.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";Kn.once(r,zi.RUNTIME,i,s)}function XM(e){const t=le("main"),n=ps(t,e),r=[];if(!x(t)||!x(n))return r;const i=ro(t,n.over??""),s=ro(t,n.under??""),o=[i,n,s];let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=NM(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}function hn(e){var r,i,s,o,a;const t=_.words[e],n=e+1;if(cb(t)){const[c,u]=wl(e);if(x(c))return[c,u]}if(s6(t)){const[c,u]=ub(e);if(x(c))return[c,u]}if(Jp(t)){const[c,u]=gc(e);if(x(c))return[c,u]}if(At(t)&&Ot(t)==="rnd"){const[c,u]=hn(n),[l,h]=hn(u);return Ct(c)&&Ct(l)?[fr(c,l),h]:Ct(c)?[fr(0,c),u]:[fr(0,1),n]}if(Gb(t)){const[c,u]=id(e);if(x(c))return[c,u]}if(!x(t))return[void 0,e];if(Ct(t)||ne(t))return[t,n];if(At(t)){const c=Ot(t),u=(r=_.get)==null?void 0:r.call(_,t);if(x(u))return[u,n];switch(c){case"aligned":case"alligned":{const l=yc(_.board,_.element,_.elementfocus);return!x(_.element)||!x(l)?[0,n]:[_.element.x===l.x||_.element.y===l.y?1:0,n]}case"contact":{const l=yc(_.board,_.element,_.elementfocus);if(!x(_.element)||!x(l))return[0,n];const h=(l.x??0)-(((i=_.element)==null?void 0:i.x)??0),f=(l.y??0)-(((s=_.element)==null?void 0:s.y)??0);return[h===0&&Math.abs(f)<2||f===0&&Math.abs(h)<2?1:0,n]}case"blocked":{const[l,h]=rt(_.words,n,[H.DIR]);return[ML(_.book,_.board,_.element,l)?1:0,h]}case"any":{const[l,h]=rt(_.words,n,[H.KIND]);return[rm(_.board,l).length?1:0,h]}case"rnd":return[fr(0,1),n];case"abs":{const[l,h]=rt(_.words,n,[H.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=rt(_.words,n,[H.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=rt(_.words,n,[H.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=rt(_.words,n,[H.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,f,d]=rt(_.words,n,[H.NUMBER,H.NUMBER,H.NUMBER]);return[Dn(l,h,f),d]}case"min":{const l=[];for(let h=n;h<_.words.length;){const[f,d]=hn(h);ne(f)&&!xr(f)&&!Yr(f)&&!xi(f)&&!$n(f)&&l.push(...f),h=d,l.push(f)}return[Math.min(...l),_.words.length]}case"max":{const l=[];for(let h=n;h<_.words.length;){const[f,d]=hn(h);ne(f)&&!xr(f)&&!Yr(f)&&!xi(f)&&!$n(f)&&l.push(...f),h=d,l.push(f)}return[Math.max(...l),_.words.length]}case"pick":{const l=[];for(let h=n;h<_.words.length;){const[f,d]=hn(h);ne(f)&&!xr(f)&&!Yr(f)&&!xi(f)&&!$n(f)&&l.push(...f),h=d,l.push(f)}return[nn(l),_.words.length]}case"pickwith":{const l=[],[h,f]=rt(_.words,n,[H.NUMBER_OR_STRING]);for(let d=f;d<_.words.length;){const[p,m]=hn(d);ne(p)&&!xr(p)&&!Yr(p)&&!xi(p)&&!$n(p)&&l.push(...p),d=m,l.push(p)}return[jp(`${h}`,l),_.words.length]}case"random":{const[l,h,f]=rt(_.words,n,[H.NUMBER,H.MAYBE_NUMBER]);return[fr(l,h??0),f]}case"randomwith":{const[l,h,f,d]=rt(_.words,n,[H.NUMBER_OR_STRING,H.NUMBER,H.MAYBE_NUMBER]);return[Dp(`${l}`,h,f??0),d]}case"run":{const[l,h]=rt(_.words,n,[H.NAME]);return Ml(l),[(o=_.get)==null?void 0:o.call(_,"arg"),h]}case"runwith":{const[l,h,f]=rt(_.words,n,[H.ANY,H.NAME]);return x(_.element)&&(_.element.arg=l),Ml(h),[(a=_.get)==null?void 0:a.call(_,"arg"),f]}}}return[t,n]}function ka(e){return x(e)&&x(e.x)&&x(e.y)}function Ye(e,t){switch(t){case yt.NORTH:--e.y;break;case yt.SOUTH:++e.y;break;case yt.WEST:--e.x;break;case yt.EAST:++e.x;break}return e}function Gi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return yt.WEST;if(n>0)return yt.EAST;if(r<0)return yt.NORTH;if(r>0)return yt.SOUTH}const rd={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function xr(e){return ne(e)&&Kb(e[0])}function Kb(e){return x(yt[e])&&At(e)}function qM(e){const t=yt[e];return x(t)?t:yt.IDLE}function Gb(e){if(At(e))return rd[Ot(e)]}function Hb(e){if(xr(e))return e;if(Kb(e))return[e];const t=Gb(e);if(x(t))return[t]}function Yb(e){const t=_.words[e],n=Hb(t);if(xr(n))return[n,e+1];const[r,i]=hn(e),s=Hb(r);return xr(s)?[s,i]:[void 0,e]}function id(e){const t=[];let[n,r]=Yb(e);for(;xr(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=rt(_.words,r,[H.NUMBER,H.NUMBER]);t.push(o,a),r=c}const[i,s]=Yb(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function JM(){return new Array(Yt*Ee).map(()=>{})}function ZM(e=Xl){const t={terrain:JM(),objects:{},id:""};return e(t)}var sd=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e))(sd||{});function QM(e){return Vs(e,sd,{terrain:t=>t.map(Tc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Tc),id:Le,named:Le,lookup:Le,codepage:Le})}function t8(e){return Go(e,sd,{terrain:t=>t.map(Ac),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Ac(t[r]);x(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Jr(e,t){return!x(e)||!x(t==null?void 0:t.x)||!x(t==null?void 0:t.y)||t.x<0||t.x>=Yt||t.y<0||t.y>=Ee?-1:t.x+t.y*Yt}function On(e,t){const n=Jr(e,t);if(n<0||!x(e==null?void 0:e.lookup))return;const r=Cn(e,e.lookup[n]??"");return x(r)?r:e.terrain[n]}function e8(e,t){const n=Cn(e,t);if(x(n))return n;const r=parseFloat(t),i=Fx(isNaN(r)?-1:r,Yt);return od(e,i.x,i.y)}function od(e,t,n){return(t>=0&&t<Yt)??(n>=0&&n<Ee)?e==null?void 0:e.terrain[t+n*Yt]:void 0}function Tr(e,t){if(!x(e)||!x(t)||!x(t.x)||!x(t.y)||t.x<0||t.x>=Yt||t.y<0||t.y>=Ee)return;const n=Xe(t),r=t.x+t.y*Yt;return e.terrain[r]=n,e.terrain[r]}function ad(e,t){if(!x(e)||!x(t))return;const n=Xe(t);return n.id=n.id??Ne(),e.objects[n.id]=n,e.objects[n.id]}function n8(e,t,n){return Tr(e,{...t,kind:n})}function cd(e,t,n,r){return ad(e,{...t,kind:n,id:r})}function Cn(e,t){if(e)return e.objects[t]}function ld(e,t,n,r,i){if(!x(e)||!x(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=Gi(o,s),c=Yt-1,u=Ee-1;for(let l=0;l<r.length;++l){const h=qM(r[l]);switch(h){case yt.IDLE:break;case yt.NORTH:case yt.SOUTH:case yt.WEST:case yt.EAST:Ye(s,h);break;case yt.BY:{const[f,d]=r.slice(l+1);Ct(f)&&Ct(d)&&(s.x=Dn(s.x+f,0,c),s.y=Dn(s.y+d,0,u)),l+=2;break}case yt.AT:{const[f,d]=r.slice(l+1);Ct(f)&&Ct(d)&&(s.x=Dn(f,0,c),s.y=Dn(d,0,u)),l+=2;break}case yt.FLOW:Ye(s,a);break;case yt.SEEK:{const f=r8(e,t,n);ka(f)&&Ye(s,Gi(i,f));break}case yt.RNDNS:Ye(s,nn(yt.NORTH,yt.SOUTH));break;case yt.RNDNE:Ye(s,nn(yt.NORTH,yt.EAST));break;case yt.RND:Ye(s,nn(yt.NORTH,yt.SOUTH,yt.WEST,yt.EAST));break;case yt.CW:case yt.CCW:case yt.OPP:case yt.RNDP:{const f=ld(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case yt.CW:switch(Gi(i,f)){case yt.NORTH:Ye(s,yt.EAST);break;case yt.SOUTH:Ye(s,yt.WEST);break;case yt.EAST:Ye(s,yt.SOUTH);break;case yt.WEST:Ye(s,yt.NORTH);break}break;case yt.CCW:switch(Gi(i,f)){case yt.NORTH:Ye(s,yt.WEST);break;case yt.SOUTH:Ye(s,yt.EAST);break;case yt.EAST:Ye(s,yt.NORTH);break;case yt.WEST:Ye(s,yt.SOUTH);break}break;case yt.OPP:switch(Gi(i,f)){case yt.NORTH:Ye(s,yt.SOUTH);break;case yt.SOUTH:Ye(s,yt.NORTH);break;case yt.EAST:Ye(s,yt.WEST);break;case yt.WEST:Ye(s,yt.EAST);break}break;case yt.RNDP:switch(Gi(i,f)){case yt.NORTH:case yt.SOUTH:s.x+=nn(-1,1);break;case yt.WEST:case yt.EAST:s.y+=nn(-1,1);break}break}break}}}return s}function Vb(e,t){return x(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function r8(e,t,n){if(!x(e)||!x(t))return;const r=e.objects[n];if(x(r))return r;if(ka(t))return sm(t,jo(e,"player"))}const _={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var H=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(H||{});function $e(e,t,n){throw console.info(n,_.element,_.elementid,_.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function rt(e,t,n){var o,a,c,u;const r=_.words;_.words=e;const i=[];let s=t;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,f]=wl(s);Yr(h)||$e("terrain or object",h,e),s=f,i.push(h);break}case 1:{const[h,f]=ub(s);xi(h)||$e("solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 2:{const[h,f]=gc(s);$n(h)||$e("color",h,e),s=f,i.push(h);break}case 3:{const[h,f]=tm(s);Hs(h)?(s=f,i.push(h)):$e("kind",h,e);break}case 4:{const[h,f]=id(s);if(xr(h)){const d={x:((o=_.element)==null?void 0:o.x)??0,y:((a=_.element)==null?void 0:a.y)??0},p=x(_.board)&&x(_.element)?ld(_.board,_.element,_.elementfocus,h,d):d;s=f,i.push(p)}else $e("direction",h,e);break}case 5:{const h=_.words[s];At(h)||$e("string",h,e),++s,i.push(h);break}case 6:{const[h,f]=hn(s);if(At(h)){const d=parseFloat(h);Ct(d)?i.push(d):$e("number",h,e)}else Ct(h)?i.push(h):$e("number",h,e);s=f;break}case 7:{const[h,f]=hn(s);At(h)||$e("string",h,e),s=f,i.push(h);break}case 8:{const[h,f]=hn(s);let d=h;if(At(d)){const p=parseFloat(d);Ct(p)&&(d=p)}else Ct(d)||$e("number or string",d,e);s=f,i.push(d);break}case 9:{const[h,f]=wl(s);h!==void 0&&!Yr(h)&&$e("optional terrain or object",h,e),s=f,i.push(h);break}case 10:{const[h,f]=wl(s);h!==void 0&&!xi(h)&&$e("optional solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 11:{const[h,f]=gc(s);h!==void 0&&!$n(h)&&$e("optional color",h,e),s=f,i.push(h);break}case 12:{const[h,f]=tm(s);h!==void 0&&!Hs(h)&&$e("optional kind",h,e),s=f,i.push(h);break}case 13:{const[h,f]=id(s);if(xr(h)){const d=((c=_.element)==null?void 0:c.x)??0,p=((u=_.element)==null?void 0:u.y)??0,m={x:d,y:p},k=_.board?ld(_.board,_.element,_.elementfocus,h,m):m;s=f,i.push(k)}else h===void 0?(s=f,i.push(void 0)):$e("optional direction",h,e);break}case 14:{const h=_.words[s];h!==void 0&&!At(h)&&$e("optional string",h,e),++s,i.push(h);break}case 15:{const[h,f]=hn(s);if(At(h)){const d=parseFloat(h);Ct(d)?i.push(d):$e("optional number",h,e)}else Ct(h)||h===void 0?i.push(h):$e("optional number",h,e);s=f;break}case 16:{const[h,f]=hn(s);h!==void 0&&!At(h)&&$e("optional string",h,e),s=f,i.push(h);break}case 17:{const[h,f]=hn(s);let d=h;if(At(d)){const p=parseFloat(d);Ct(p)&&(d=p)}else d!==void 0&&!Ct(d)&&$e("number or string",d,e);s=f,i.push(d);break}case 18:{const[h,f]=hn(s);s=f,i.push(h);break}}return _.words=r,[...i,s]}const Ul={},mo={};function ud(){return{id:Ne(),layers:[],scroll:[],sidebar:[]}}const i8=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),s8=new Set(["tx","text"]),o8={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Xb={};let qb=e=>{let t=Xb[e];return x(t)||(Xb[e]=t=ud()),t};function a8(e){qb=e}function bn(e){return qb(e)}function hd(e){return x(Ul[e])||(Ul[e]=[]),Ul[e]}function c8(e){const t=bn(e);t.scroll=[]}function l8(e,t,n){Object.values(mo).forEach(r=>{if(r[t]!==void 0){const i=Kp(e.id(),t);Ct(n)&&Ox(i,n),At(n)&&Cx(i,n)}})}function Zr(e){const t=hd(e);return Ul[e]=[],t}function se(e,t){hd(e).push(t)}function Dt(e,t,n,r,i=()=>0,s=Xl){const o=[t,n,...r],a=Ot(`${o[3]}`),c={..._};function u(l,h){x(h)&&h!==i(l)&&(_.board=c.board,_.element=c.element,_.elementfocus=c.elementfocus,s(l,h))}if(i8.has(a)){const l=`${o[2]}`;mo[t]=mo[t]??{};const h=i(l)??o8[a];if(mo[t][l]===void 0){const f=Kp(t,l);Ct(h)&&Nx(f,h),At(h)&&Vu(f,h),s8.has(a)?mo[t][l]=vp(f,d=>{u(l,d)}):mo[t][l]=Lx(f,d=>{u(l,d)})}}hd(e).push(o)}a8(e=>{if(Ai(e)){const t=le(Pt.MAIN),n=wi(t,Pt.GADGETSTORE);let r=n[e];return x(r)||(n[e]=r=ud()),r}return ud()});const Fl=Ts("gadgetserver",["tock","second"],e=>{if(!Fl.session(e))return;const t=le(Pt.MAIN),n=(t==null?void 0:t.activelist)??[],r=wi(t,Pt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=bn(s);o.layers=XM(s);const a=r[s]??{},c=Sd(a,o);c.length&&(r[s]=Xe(o),oE(Fl,s,c))}break;case"second":{for(let i=0;i<n.length;++i){const s=n[i],o=Gn(s);x(o)&&bE(Fl,s,o.id)}break}case"desync":sE(Fl,e.player,bn(e.player));break;case"clearscroll":c8(e.player);break;case"clearplayer":{const i=le(Pt.MAIN),s=wi(i,Pt.GADGETSTORE);delete s[e.player];const o=wi(i,Pt.GADGETSYNC);delete o[e.player];break}}});function Pl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Jb={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof Pl=="function"&&Pl;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[u]={exports:{}};r[u][0].call(d.exports,function(p){var m=r[u][1][p];return o(m||p)},d,d.exports,n,r,i,s)}return i[u].exports}for(var a=typeof Pl=="function"&&Pl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,f,d,p,m,k=[],w=0,T=c.length,v=T,I=s.getTypeOf(c)!=="string";w<c.length;)v=T-w,h=I?(u=c[w++],l=w<T?c[w++]:0,w<T?c[w++]:0):(u=c.charCodeAt(w++),l=w<T?c.charCodeAt(w++):0,w<T?c.charCodeAt(w++):0),f=u>>2,d=(3&u)<<4|l>>4,p=1<v?(15&l)<<2|h>>6:64,m=2<v?63&h:64,k.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(m));return k.join("")},i.decode=function(c){var u,l,h,f,d,p,m=0,k=0,w="data:";if(c.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var T,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<c.length;)u=a.indexOf(c.charAt(m++))<<2|(f=a.indexOf(c.charAt(m++)))>>4,l=(15&f)<<4|(d=a.indexOf(c.charAt(m++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(m++))),T[k++]=u,d!==64&&(T[k++]=l),p!==64&&(T[k++]=h);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,f,d,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,f){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var m=f;m<p;m++)u=u>>>8^d[255&(u^l[m])];return-1^u}(0|c,a,a.length,0):function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var m=f;m<p;m++)u=u>>>8^d[255&(u^l.charCodeAt(m))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var m,k="";for(m=0;m<p;m++)k+=String.fromCharCode(255&d),d>>>=8;return k}function o(d,p,m,k,w,T){var v,I,U=d.file,R=d.compression,L=T!==u.utf8encode,B=a.transformTo("string",T(U.name)),O=a.transformTo("string",u.utf8encode(U.name)),Y=U.comment,et=a.transformTo("string",T(Y)),C=a.transformTo("string",u.utf8encode(Y)),S=O.length!==U.name.length,b=C.length!==Y.length,P="",X="",D="",ct=U.dir,tt=U.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ft.crc32=d.crc32,ft.compressedSize=d.compressedSize,ft.uncompressedSize=d.uncompressedSize);var V=0;p&&(V|=8),L||!S&&!b||(V|=2048);var z=0,Et=0;ct&&(z|=16),w==="UNIX"?(Et=798,z|=function(lt,Lt){var Xt=lt;return lt||(Xt=Lt?16893:33204),(65535&Xt)<<16}(U.unixPermissions,ct)):(Et=20,z|=function(lt){return 63&(lt||0)}(U.dosPermissions)),v=tt.getUTCHours(),v<<=6,v|=tt.getUTCMinutes(),v<<=5,v|=tt.getUTCSeconds()/2,I=tt.getUTCFullYear()-1980,I<<=4,I|=tt.getUTCMonth()+1,I<<=5,I|=tt.getUTCDate(),S&&(X=s(1,1)+s(l(B),4)+O,P+="up"+s(X.length,2)+X),b&&(D=s(1,1)+s(l(et),4)+C,P+="uc"+s(D.length,2)+D);var ot="";return ot+=`
\0`,ot+=s(V,2),ot+=R.magic,ot+=s(v,2),ot+=s(I,2),ot+=s(ft.crc32,4),ot+=s(ft.compressedSize,4),ot+=s(ft.uncompressedSize,4),ot+=s(B.length,2),ot+=s(P.length,2),{fileRecord:h.LOCAL_FILE_HEADER+ot+B+P,dirRecord:h.CENTRAL_FILE_HEADER+s(Et,2)+ot+s(et.length,2)+"\0\0\0\0"+s(z,4)+s(k,4)+B+P+et}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function f(d,p,m,k){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=k,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,m=this.entriesCount,k=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-k-1))/m:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var m=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,m=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(k){return h.DATA_DESCRIPTOR+s(k.crc32,4)+s(k.compressedSize,4)+s(k.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-d,k=function(w,T,v,I,U){var R=a.transformTo("string",U(I));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(T,4)+s(v,4)+s(R.length,2)+R}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:k,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(m){p.processChunk(m)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(m){p.error(m)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var m=0;m<p.length;m++)try{p[m].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=function(T,v){var I=T||v,U=s[I];if(!U)throw new Error(I+" is not a valid compression method !");return U}(d.options.compression,c.compression),m=d.options.compressionOptions||c.compressionOptions||{},k=d.dir,w=d.date;d._compressWorker(p,m).withStreamInfo("file",{name:f,dir:k,date:w,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(f){l.error(f)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var m=f.decompressed.getContentWorker().pipe(new u);m.on("error",function(k){p(k)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(m){var k=new c(d);return k.load(m),k}).then(function(m){var k=[o.Promise.resolve(m)],w=m.files;if(d.checkCRC32)for(var T=0;T<w.length;T++)k.push(h(w[T]));return o.Promise.all(k)}).then(function(m){for(var k=m.shift(),w=k.files,T=0;T<w.length;T++){var v=w[T],I=v.fileNameStr,U=s.resolve(v.fileNameStr);p.file(U,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:d.createFolders}),v.dir||(p.file(U).unsafeOriginalName=I)}return k.zipComment.length&&(p.comment=k.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,f){l.push(h)||l._helper.pause(),u&&u(f)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof tn<"u",newBufferFrom:function(s,o){if(tn.from&&tn.from!==Uint8Array.from)return tn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new tn(s,o)},allocBuffer:function(s){if(tn.alloc)return tn.alloc(s);var o=new tn(s);return o.fill(0),o},isBuffer:function(s){return tn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,R,L){var B,O=a.getTypeOf(R),Y=a.extend(L||{},l);Y.date=Y.date||new Date,Y.compression!==null&&(Y.compression=Y.compression.toUpperCase()),typeof Y.unixPermissions=="string"&&(Y.unixPermissions=parseInt(Y.unixPermissions,8)),Y.unixPermissions&&16384&Y.unixPermissions&&(Y.dir=!0),Y.dosPermissions&&16&Y.dosPermissions&&(Y.dir=!0),Y.dir&&(U=w(U)),Y.createFolders&&(B=k(U))&&T.call(this,B,!0);var et=O==="string"&&Y.binary===!1&&Y.base64===!1;L&&L.binary!==void 0||(Y.binary=!et),(R instanceof h&&R.uncompressedSize===0||Y.dir||!R||R.length===0)&&(Y.base64=!1,Y.binary=!0,R="",Y.compression="STORE",O="string");var C=null;C=R instanceof h||R instanceof c?R:p.isNode&&p.isStream(R)?new m(U,R):a.prepareContent(U,R,Y.binary,Y.optimizedBinaryString,Y.base64);var S=new f(U,C,Y);this.files[U]=S}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),k=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var R=U.lastIndexOf("/");return 0<R?U.substring(0,R):""},w=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,R){return R=R!==void 0?R:l.createFolders,U=w(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:R}),this.files[U]};function v(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var R,L,B;for(R in this.files)B=this.files[R],(L=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&U(L,B)},filter:function(U){var R=[];return this.forEach(function(L,B){U(L,B)&&R.push(B)}),R},file:function(U,R,L){if(arguments.length!==1)return U=this.root+U,s.call(this,U,R,L),this;if(v(U)){var B=U;return this.filter(function(Y,et){return!et.dir&&B.test(Y)})}var O=this.files[this.root+U];return O&&!O.dir?O:null},folder:function(U){if(!U)return this;if(v(U))return this.filter(function(O,Y){return Y.dir&&U.test(O)});var R=this.root+U,L=T.call(this,R),B=this.clone();return B.root=L.name,B},remove:function(U){U=this.root+U;var R=this.files[U];if(R||(U.slice(-1)!=="/"&&(U+="/"),R=this.files[U]),R&&!R.dir)delete this.files[U];else for(var L=this.filter(function(O,Y){return Y.name.slice(0,U.length)===U}),B=0;B<L.length;B++)delete this.files[L[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var R,L={};try{if((L=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");a.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var B=L.comment||this.comment||"";R=d.generateWorker(this,L,B)}catch(O){(R=new c("error")).error(O)}return new u(R,L.type||"string",L.mimeType)},generateAsync:function(U,R){return this.generateInternalStream(U).accumulate(R)},generateNodeStream:function(U,R){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(R)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===u&&this.data[f+2]===l&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&u===f[1]&&l===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,m){return new l.Promise(function(k,w){var T=[],v=p._internalType,I=p._outputType,U=p._mimeType;p.on("data",function(R,L){T.push(R),m&&m(L)}).on("error",function(R){T=[],w(R)}).on("end",function(){try{var R=function(L,B,O){switch(L){case"blob":return s.newBlob(s.transformTo("arraybuffer",B),O);case"base64":return c.encode(B);default:return s.transformTo(L,B)}}(I,function(L,B){var O,Y=0,et=null,C=0;for(O=0;O<B.length;O++)C+=B[O].length;switch(L){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(et=new Uint8Array(C),O=0;O<B.length;O++)et.set(B[O],Y),Y+=B[O].length;return et;case"nodebuffer":return tn.concat(B);default:throw new Error("concat : unsupported type '"+L+"'")}}(v,T),U);k(R)}catch(L){w(L)}T=[]}).resume()})}function d(p,m,k){var w=m;switch(m){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=m,this._mimeType=k,s.checkSupport(w),this._worker=p.pipe(new o(w)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,m){var k=this;return p==="data"?this._worker.on(p,function(w){m.call(k,w.data,w.meta)}):this._worker.on(p,function(){s.delay(m,arguments,k)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof tn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(p){var m,k,w,T,v,I=p.length,U=0;for(T=0;T<I;T++)(64512&(k=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(w=p.charCodeAt(T+1)))==56320&&(k=65536+(k-55296<<10)+(w-56320),T++),U+=k<128?1:k<2048?2:k<65536?3:4;for(m=o.uint8array?new Uint8Array(U):new Array(U),T=v=0;v<U;T++)(64512&(k=p.charCodeAt(T)))==55296&&T+1<I&&(64512&(w=p.charCodeAt(T+1)))==56320&&(k=65536+(k-55296<<10)+(w-56320),T++),k<128?m[v++]=k:(k<2048?m[v++]=192|k>>>6:(k<65536?m[v++]=224|k>>>12:(m[v++]=240|k>>>18,m[v++]=128|k>>>12&63),m[v++]=128|k>>>6&63),m[v++]=128|63&k);return m}(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(p){var m,k,w,T,v=p.length,I=new Array(2*v);for(m=k=0;m<v;)if((w=p[m++])<128)I[k++]=w;else if(4<(T=u[w]))I[k++]=65533,m+=T-1;else{for(w&=T===2?31:T===3?15:7;1<T&&m<v;)w=w<<6|63&p[m++],T--;1<T?I[k++]=65533:w<65536?I[k++]=w:(w-=65536,I[k++]=55296|w>>10&1023,I[k++]=56320|1023&w)}return I.length!==k&&(I.subarray?I=I.subarray(0,k):I.length=k),s.applyFromCharCode(I)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var k=function(T,v){var I;for((v=v||T.length)>T.length&&(v=T.length),I=v-1;0<=I&&(192&T[I])==128;)I--;return I<0||I===0?v:I+u[T[I]]>v?I:v}(p),w=p;k!==p.length&&(o.uint8array?(w=p.subarray(0,k),this.leftOver=p.subarray(k,p.length)):(w=p.slice(0,k),this.leftOver=p.slice(k,p.length))),this.push({data:i.utf8decode(w),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(m){return m}function l(m,k){for(var w=0;w<m.length;++w)k[w]=255&m.charCodeAt(w);return k}n("setimmediate"),i.newBlob=function(m,k){i.checkSupport("blob");try{return new Blob([m],{type:k})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(m),w.getBlob(k)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,k,w){var T=[],v=0,I=m.length;if(I<=w)return String.fromCharCode.apply(null,m);for(;v<I;)k==="array"||k==="nodebuffer"?T.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+w,I)))):T.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+w,I)))),v+=w;return T.join("")},stringifyByChar:function(m){for(var k="",w=0;w<m.length;w++)k+=String.fromCharCode(m[w]);return k},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var k=65536,w=i.getTypeOf(m),T=!0;if(w==="uint8array"?T=h.applyCanBeUsed.uint8array:w==="nodebuffer"&&(T=h.applyCanBeUsed.nodebuffer),T)for(;1<k;)try{return h.stringifyByChunk(m,w,k)}catch{k=Math.floor(k/2)}return h.stringifyByChar(m)}function d(m,k){for(var w=0;w<m.length;w++)k[w]=m[w];return k}i.applyFromCharCode=f;var p={};p.string={string:u,array:function(m){return l(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return l(m,new Uint8Array(m.length))},nodebuffer:function(m){return l(m,a.allocBuffer(m.length))}},p.array={string:f,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:u},i.transformTo=function(m,k){if(k=k||"",!m)return k;i.checkSupport(m);var w=i.getTypeOf(k);return p[w][m](k)},i.resolve=function(m){for(var k=m.split("/"),w=[],T=0;T<k.length;T++){var v=k[T];v==="."||v===""&&T!==0&&T!==k.length-1||(v===".."?w.pop():w.push(v))}return w.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var k,w,T="";for(w=0;w<(m||"").length;w++)T+="\\x"+((k=m.charCodeAt(w))<16?"0":"")+k.toString(16).toUpperCase();return T},i.delay=function(m,k,w){setImmediate(function(){m.apply(w||null,k||[])})},i.inherits=function(m,k){function w(){}w.prototype=k.prototype,m.prototype=new w},i.extend=function(){var m,k,w={};for(m=0;m<arguments.length;m++)for(k in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],k)&&w[k]===void 0&&(w[k]=arguments[m][k]);return w},i.prepareContent=function(m,k,w,T,v){return c.Promise.resolve(k).then(function(I){return s.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,R){var L=new FileReader;L.onload=function(B){U(B.target.result)},L.onerror=function(B){R(B.target.error)},L.readAsArrayBuffer(I)}):I}).then(function(I){var U=i.getTypeOf(I);return U?(U==="arraybuffer"?I=i.transformTo("uint8array",I):U==="string"&&(v?I=o.decode(I):w&&T!==!0&&(I=function(R){return l(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))}(I))),I):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(k){for(var w in l)if(Object.prototype.hasOwnProperty.call(l,w)&&l[w].magic===k)return l[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,m,k,w=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<w;)p=d.readInt(2),m=d.readInt(2),k=d.readData(m),this.extraFields[p]={id:p,length:m,value:k};d.setIndex(w)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var k=this.findExtraFieldUnicodeComment();if(k!==null)this.fileCommentStr=k;else{var w=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,k){this.name=p,this.dir=k.dir,this.date=k.date,this.comment=k.comment,this.unixPermissions=k.unixPermissions,this.dosPermissions=k.dosPermissions,this._data=m,this._dataBinary=k.binary,this.options={compression:k.compression,compressionOptions:k.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,k="string";try{if(!p)throw new Error("No output type specified.");var w=(k=p.toLowerCase())==="string"||k==="text";k!=="binarystring"&&k!=="text"||(k="string"),m=this._decompressWorker();var T=!this._dataBinary;T&&!w&&(m=m.pipe(new c.Utf8EncodeWorker)),!T&&w&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(v){(m=new l("error")).error(v)}return new o(m,k,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var k=this._decompressWorker();return this._dataBinary||(k=k.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(k,p,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var m,k;a=!0;for(var w=d.length;w;){for(k=d,d=[],m=-1;++m<w;)k[m]();w=d.length}a=!1}r.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof En<"u"?En:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,w!==o&&m(this,w)}function f(w,T,v){this.promise=w,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function d(w,T,v){s(function(){var I;try{I=T(v)}catch(U){return a.reject(w,U)}I===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,I)})}function p(w){var T=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof T=="function")return function(){T.apply(w,arguments)}}function m(w,T){var v=!1;function I(L){v||(v=!0,a.reject(w,L))}function U(L){v||(v=!0,a.resolve(w,L))}var R=k(function(){T(U,I)});R.status==="error"&&I(R.value)}function k(w,T){var v={};try{v.value=w(T),v.status="success"}catch(I){v.status="error",v.value=I}return v}(r.exports=h).prototype.finally=function(w){if(typeof w!="function")return this;var T=this.constructor;return this.then(function(v){return T.resolve(w()).then(function(){return v})},function(v){return T.resolve(w()).then(function(){throw v})})},h.prototype.catch=function(w){return this.then(null,w)},h.prototype.then=function(w,T){if(typeof w!="function"&&this.state===u||typeof T!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==l?d(v,this.state===u?w:T,this.outcome):this.queue.push(new f(v,w,T)),v},f.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},f.prototype.otherCallFulfilled=function(w){d(this.promise,this.onFulfilled,w)},f.prototype.callRejected=function(w){a.reject(this.promise,w)},f.prototype.otherCallRejected=function(w){d(this.promise,this.onRejected,w)},a.resolve=function(w,T){var v=k(p,T);if(v.status==="error")return a.reject(w,v.value);var I=v.value;if(I)m(w,I);else{w.state=u,w.outcome=T;for(var U=-1,R=w.queue.length;++U<R;)w.queue[U].callFulfilled(T)}return w},a.reject=function(w,T){w.state=c,w.outcome=T;for(var v=-1,I=w.queue.length;++v<I;)w.queue[v].callRejected(T);return w},h.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},h.reject=function(w){var T=new this(o);return a.reject(T,w)},h.all=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=w.length,I=!1;if(!v)return this.resolve([]);for(var U=new Array(v),R=0,L=-1,B=new this(o);++L<v;)O(w[L],L);return B;function O(Y,et){T.resolve(Y).then(function(C){U[et]=C,++R!==v||I||(I=!0,a.resolve(B,U))},function(C){I||(I=!0,a.reject(B,C))})}},h.race=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=w.length,I=!1;if(!v)return this.resolve([]);for(var U=-1,R=new this(o);++U<v;)L=w[U],T.resolve(L).then(function(B){I||(I=!0,a.resolve(R,B))},function(B){I||(I=!0,a.reject(R,B))});var L;return R}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,f=-1,d=0,p=8;function m(w){if(!(this instanceof m))return new m(w);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},w||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(v!==h)throw new Error(c[v]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var I;if(I=typeof T.dictionary=="string"?a.string2buf(T.dictionary):l.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(v=s.deflateSetDictionary(this.strm,I))!==h)throw new Error(c[v]);this._dict_set=!0}}function k(w,T){var v=new m(T);if(v.push(w,!0),v.err)throw v.msg||c[v.err];return v.result}m.prototype.push=function(w,T){var v,I,U=this.strm,R=this.options.chunkSize;if(this.ended)return!1;I=T===~~T?T:T===!0?4:0,typeof w=="string"?U.input=a.string2buf(w):l.call(w)==="[object ArrayBuffer]"?U.input=new Uint8Array(w):U.input=w,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(R),U.next_out=0,U.avail_out=R),(v=s.deflate(U,I))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&v!==1);return I===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):I!==2||(this.onEnd(h),!(U.avail_out=0))},m.prototype.onData=function(w){this.chunks.push(w)},m.prototype.onEnd=function(w){w===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=m,i.deflate=k,i.deflateRaw=function(w,T){return(T=T||{}).raw=!0,k(w,T)},i.gzip=function(w,T){return(T=T||{}).gzip=!0,k(w,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var k=this.options;k.raw&&0<=k.windowBits&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15)),!(0<=k.windowBits&&k.windowBits<16)||m&&m.windowBits||(k.windowBits+=32),15<k.windowBits&&k.windowBits<48&&!(15&k.windowBits)&&(k.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,k.windowBits);if(w!==c.Z_OK)throw new Error(u[w]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,k){var w=new d(k);if(w.push(m,!0),w.err)throw w.msg||u[w.err];return w.result}d.prototype.push=function(m,k){var w,T,v,I,U,R,L=this.strm,B=this.options.chunkSize,O=this.options.dictionary,Y=!1;if(this.ended)return!1;T=k===~~k?k:k===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?L.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?L.input=new Uint8Array(m):L.input=m,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new o.Buf8(B),L.next_out=0,L.avail_out=B),(w=s.inflate(L,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&O&&(R=typeof O=="string"?a.string2buf(O):f.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,w=s.inflateSetDictionary(this.strm,R)),w===c.Z_BUF_ERROR&&Y===!0&&(w=c.Z_OK,Y=!1),w!==c.Z_STREAM_END&&w!==c.Z_OK)return this.onEnd(w),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&w!==c.Z_STREAM_END&&(L.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(L.output,L.next_out),I=L.next_out-v,U=a.buf2string(L.output,v),L.next_out=I,L.avail_out=B-I,I&&o.arraySet(L.output,L.output,v,I,0),this.onData(U)):this.onData(o.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(Y=!0)}while((0<L.avail_in||L.avail_out===0)&&w!==c.Z_STREAM_END);return w===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(L.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(m,k){return(k=k||{}).raw=!0,p(m,k)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,f){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),f);else for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){var u,l,h,f,d,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=f=0,l=c.length;u<l;u++)d=c[u],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,u,l,h,f){for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,m,k,w=h.length,T=0;for(m=0;m<w;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),T+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(T),m=k=0;k<T;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),d<128?f[k++]=d:(d<2048?f[k++]=192|d>>>6:(d<65536?f[k++]=224|d>>>12:(f[k++]=240|d>>>18,f[k++]=128|d>>>12&63),f[k++]=128|d>>>6&63),f[k++]=128|63&d);return f},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,m,k,w=f||h.length,T=new Array(2*w);for(d=p=0;d<w;)if((m=h[d++])<128)T[p++]=m;else if(4<(k=c[m]))T[p++]=65533,d+=k-1;else{for(m&=k===2?31:k===3?15:7;1<k&&d<w;)m=m<<6|63&h[d++],k--;1<k?T[p++]=65533:m<65536?T[p++]=m:(m-=65536,T[p++]=55296|m>>10&1023,T[p++]=56320|1023&m)}return l(T,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var f=u;f<h;f++)o=o>>>8^l[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,f=4,d=0,p=-2,m=-1,k=4,w=2,T=8,v=9,I=286,U=30,R=19,L=2*I+1,B=15,O=3,Y=258,et=Y+O+1,C=42,S=113,b=1,P=2,X=3,D=4;function ct(E,st){return E.msg=l[st],st}function tt(E){return(E<<1)-(4<E?9:0)}function ft(E){for(var st=E.length;0<=--st;)E[st]=0}function V(E){var st=E.state,nt=st.pending;nt>E.avail_out&&(nt=E.avail_out),nt!==0&&(o.arraySet(E.output,st.pending_buf,st.pending_out,nt,E.next_out),E.next_out+=nt,st.pending_out+=nt,E.total_out+=nt,E.avail_out-=nt,st.pending-=nt,st.pending===0&&(st.pending_out=0))}function z(E,st){a._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,st),E.block_start=E.strstart,V(E.strm)}function Et(E,st){E.pending_buf[E.pending++]=st}function ot(E,st){E.pending_buf[E.pending++]=st>>>8&255,E.pending_buf[E.pending++]=255&st}function lt(E,st){var nt,F,M=E.max_chain_length,K=E.strstart,at=E.prev_length,ht=E.nice_match,Z=E.strstart>E.w_size-et?E.strstart-(E.w_size-et):0,pt=E.window,_t=E.w_mask,dt=E.prev,vt=E.strstart+Y,ce=pt[K+at-1],Ft=pt[K+at];E.prev_length>=E.good_match&&(M>>=2),ht>E.lookahead&&(ht=E.lookahead);do if(pt[(nt=st)+at]===Ft&&pt[nt+at-1]===ce&&pt[nt]===pt[K]&&pt[++nt]===pt[K+1]){K+=2,nt++;do;while(pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&pt[++K]===pt[++nt]&&K<vt);if(F=Y-(vt-K),K=vt-Y,at<F){if(E.match_start=st,ht<=(at=F))break;ce=pt[K+at-1],Ft=pt[K+at]}}while((st=dt[st&_t])>Z&&--M!=0);return at<=E.lookahead?at:E.lookahead}function Lt(E){var st,nt,F,M,K,at,ht,Z,pt,_t,dt=E.w_size;do{if(M=E.window_size-E.lookahead-E.strstart,E.strstart>=dt+(dt-et)){for(o.arraySet(E.window,E.window,dt,dt,0),E.match_start-=dt,E.strstart-=dt,E.block_start-=dt,st=nt=E.hash_size;F=E.head[--st],E.head[st]=dt<=F?F-dt:0,--nt;);for(st=nt=dt;F=E.prev[--st],E.prev[st]=dt<=F?F-dt:0,--nt;);M+=dt}if(E.strm.avail_in===0)break;if(at=E.strm,ht=E.window,Z=E.strstart+E.lookahead,pt=M,_t=void 0,_t=at.avail_in,pt<_t&&(_t=pt),nt=_t===0?0:(at.avail_in-=_t,o.arraySet(ht,at.input,at.next_in,_t,Z),at.state.wrap===1?at.adler=c(at.adler,ht,_t,Z):at.state.wrap===2&&(at.adler=u(at.adler,ht,_t,Z)),at.next_in+=_t,at.total_in+=_t,_t),E.lookahead+=nt,E.lookahead+E.insert>=O)for(K=E.strstart-E.insert,E.ins_h=E.window[K],E.ins_h=(E.ins_h<<E.hash_shift^E.window[K+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[K+O-1])&E.hash_mask,E.prev[K&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=K,K++,E.insert--,!(E.lookahead+E.insert<O)););}while(E.lookahead<et&&E.strm.avail_in!==0)}function Xt(E,st){for(var nt,F;;){if(E.lookahead<et){if(Lt(E),E.lookahead<et&&st===h)return b;if(E.lookahead===0)break}if(nt=0,E.lookahead>=O&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+O-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),nt!==0&&E.strstart-nt<=E.w_size-et&&(E.match_length=lt(E,nt)),E.match_length>=O)if(F=a._tr_tally(E,E.strstart-E.match_start,E.match_length-O),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=O){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+O-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else F=a._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(F&&(z(E,!1),E.strm.avail_out===0))return b}return E.insert=E.strstart<O-1?E.strstart:O-1,st===f?(z(E,!0),E.strm.avail_out===0?X:D):E.last_lit&&(z(E,!1),E.strm.avail_out===0)?b:P}function Mt(E,st){for(var nt,F,M;;){if(E.lookahead<et){if(Lt(E),E.lookahead<et&&st===h)return b;if(E.lookahead===0)break}if(nt=0,E.lookahead>=O&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+O-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=O-1,nt!==0&&E.prev_length<E.max_lazy_match&&E.strstart-nt<=E.w_size-et&&(E.match_length=lt(E,nt),E.match_length<=5&&(E.strategy===1||E.match_length===O&&4096<E.strstart-E.match_start)&&(E.match_length=O-1)),E.prev_length>=O&&E.match_length<=E.prev_length){for(M=E.strstart+E.lookahead-O,F=a._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-O),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=M&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+O-1])&E.hash_mask,nt=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=O-1,E.strstart++,F&&(z(E,!1),E.strm.avail_out===0))return b}else if(E.match_available){if((F=a._tr_tally(E,0,E.window[E.strstart-1]))&&z(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return b}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(F=a._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<O-1?E.strstart:O-1,st===f?(z(E,!0),E.strm.avail_out===0?X:D):E.last_lit&&(z(E,!1),E.strm.avail_out===0)?b:P}function xt(E,st,nt,F,M){this.good_length=E,this.max_lazy=st,this.nice_length=nt,this.max_chain=F,this.func=M}function Bt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*L),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(B+1),this.heap=new o.Buf16(2*I+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*I+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ut(E){var st;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=w,(st=E.state).pending=0,st.pending_out=0,st.wrap<0&&(st.wrap=-st.wrap),st.status=st.wrap?C:S,E.adler=st.wrap===2?0:1,st.last_flush=h,a._tr_init(st),d):ct(E,p)}function we(E){var st=Ut(E);return st===d&&function(nt){nt.window_size=2*nt.w_size,ft(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,nt.ins_h=0}(E.state),st}function Ie(E,st,nt,F,M,K){if(!E)return p;var at=1;if(st===m&&(st=6),F<0?(at=0,F=-F):15<F&&(at=2,F-=16),M<1||v<M||nt!==T||F<8||15<F||st<0||9<st||K<0||k<K)return ct(E,p);F===8&&(F=9);var ht=new Bt;return(E.state=ht).strm=E,ht.wrap=at,ht.gzhead=null,ht.w_bits=F,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=M+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+O-1)/O),ht.window=new o.Buf8(2*ht.w_size),ht.head=new o.Buf16(ht.hash_size),ht.prev=new o.Buf16(ht.w_size),ht.lit_bufsize=1<<M+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new o.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=st,ht.strategy=K,ht.method=nt,we(E)}s=[new xt(0,0,0,0,function(E,st){var nt=65535;for(nt>E.pending_buf_size-5&&(nt=E.pending_buf_size-5);;){if(E.lookahead<=1){if(Lt(E),E.lookahead===0&&st===h)return b;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var F=E.block_start+nt;if((E.strstart===0||E.strstart>=F)&&(E.lookahead=E.strstart-F,E.strstart=F,z(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-et&&(z(E,!1),E.strm.avail_out===0))return b}return E.insert=0,st===f?(z(E,!0),E.strm.avail_out===0?X:D):(E.strstart>E.block_start&&(z(E,!1),E.strm.avail_out),b)}),new xt(4,4,8,4,Xt),new xt(4,5,16,8,Xt),new xt(4,6,32,32,Xt),new xt(4,4,16,16,Mt),new xt(8,16,32,32,Mt),new xt(8,16,128,128,Mt),new xt(8,32,128,256,Mt),new xt(32,128,258,1024,Mt),new xt(32,258,258,4096,Mt)],i.deflateInit=function(E,st){return Ie(E,st,T,15,8,0)},i.deflateInit2=Ie,i.deflateReset=we,i.deflateResetKeep=Ut,i.deflateSetHeader=function(E,st){return E&&E.state?E.state.wrap!==2?p:(E.state.gzhead=st,d):p},i.deflate=function(E,st){var nt,F,M,K;if(!E||!E.state||5<st||st<0)return E?ct(E,p):p;if(F=E.state,!E.output||!E.input&&E.avail_in!==0||F.status===666&&st!==f)return ct(E,E.avail_out===0?-5:p);if(F.strm=E,nt=F.last_flush,F.last_flush=st,F.status===C)if(F.wrap===2)E.adler=0,Et(F,31),Et(F,139),Et(F,8),F.gzhead?(Et(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),Et(F,255&F.gzhead.time),Et(F,F.gzhead.time>>8&255),Et(F,F.gzhead.time>>16&255),Et(F,F.gzhead.time>>24&255),Et(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),Et(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(Et(F,255&F.gzhead.extra.length),Et(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(E.adler=u(E.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(Et(F,0),Et(F,0),Et(F,0),Et(F,0),Et(F,0),Et(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),Et(F,3),F.status=S);else{var at=T+(F.w_bits-8<<4)<<8;at|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(at|=32),at+=31-at%31,F.status=S,ot(F,at),F.strstart!==0&&(ot(F,E.adler>>>16),ot(F,65535&E.adler)),E.adler=1}if(F.status===69)if(F.gzhead.extra){for(M=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),V(E),M=F.pending,F.pending!==F.pending_buf_size));)Et(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),V(E),M=F.pending,F.pending===F.pending_buf_size)){K=1;break}K=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,Et(F,K)}while(K!==0);F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),K===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){M=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),V(E),M=F.pending,F.pending===F.pending_buf_size)){K=1;break}K=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,Et(F,K)}while(K!==0);F.gzhead.hcrc&&F.pending>M&&(E.adler=u(E.adler,F.pending_buf,F.pending-M,M)),K===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&V(E),F.pending+2<=F.pending_buf_size&&(Et(F,255&E.adler),Et(F,E.adler>>8&255),E.adler=0,F.status=S)):F.status=S),F.pending!==0){if(V(E),E.avail_out===0)return F.last_flush=-1,d}else if(E.avail_in===0&&tt(st)<=tt(nt)&&st!==f)return ct(E,-5);if(F.status===666&&E.avail_in!==0)return ct(E,-5);if(E.avail_in!==0||F.lookahead!==0||st!==h&&F.status!==666){var ht=F.strategy===2?function(Z,pt){for(var _t;;){if(Z.lookahead===0&&(Lt(Z),Z.lookahead===0)){if(pt===h)return b;break}if(Z.match_length=0,_t=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,_t&&(z(Z,!1),Z.strm.avail_out===0))return b}return Z.insert=0,pt===f?(z(Z,!0),Z.strm.avail_out===0?X:D):Z.last_lit&&(z(Z,!1),Z.strm.avail_out===0)?b:P}(F,st):F.strategy===3?function(Z,pt){for(var _t,dt,vt,ce,Ft=Z.window;;){if(Z.lookahead<=Y){if(Lt(Z),Z.lookahead<=Y&&pt===h)return b;if(Z.lookahead===0)break}if(Z.match_length=0,Z.lookahead>=O&&0<Z.strstart&&(dt=Ft[vt=Z.strstart-1])===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]){ce=Z.strstart+Y;do;while(dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&dt===Ft[++vt]&&vt<ce);Z.match_length=Y-(ce-vt),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=O?(_t=a._tr_tally(Z,1,Z.match_length-O),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(_t=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),_t&&(z(Z,!1),Z.strm.avail_out===0))return b}return Z.insert=0,pt===f?(z(Z,!0),Z.strm.avail_out===0?X:D):Z.last_lit&&(z(Z,!1),Z.strm.avail_out===0)?b:P}(F,st):s[F.level].func(F,st);if(ht!==X&&ht!==D||(F.status=666),ht===b||ht===X)return E.avail_out===0&&(F.last_flush=-1),d;if(ht===P&&(st===1?a._tr_align(F):st!==5&&(a._tr_stored_block(F,0,0,!1),st===3&&(ft(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),V(E),E.avail_out===0))return F.last_flush=-1,d}return st!==f?d:F.wrap<=0?1:(F.wrap===2?(Et(F,255&E.adler),Et(F,E.adler>>8&255),Et(F,E.adler>>16&255),Et(F,E.adler>>24&255),Et(F,255&E.total_in),Et(F,E.total_in>>8&255),Et(F,E.total_in>>16&255),Et(F,E.total_in>>24&255)):(ot(F,E.adler>>>16),ot(F,65535&E.adler)),V(E),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?d:1)},i.deflateEnd=function(E){var st;return E&&E.state?(st=E.state.status)!==C&&st!==69&&st!==73&&st!==91&&st!==103&&st!==S&&st!==666?ct(E,p):(E.state=null,st===S?ct(E,-3):d):p},i.deflateSetDictionary=function(E,st){var nt,F,M,K,at,ht,Z,pt,_t=st.length;if(!E||!E.state||(K=(nt=E.state).wrap)===2||K===1&&nt.status!==C||nt.lookahead)return p;for(K===1&&(E.adler=c(E.adler,st,_t,0)),nt.wrap=0,_t>=nt.w_size&&(K===0&&(ft(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),pt=new o.Buf8(nt.w_size),o.arraySet(pt,st,_t-nt.w_size,nt.w_size,0),st=pt,_t=nt.w_size),at=E.avail_in,ht=E.next_in,Z=E.input,E.avail_in=_t,E.next_in=0,E.input=st,Lt(nt);nt.lookahead>=O;){for(F=nt.strstart,M=nt.lookahead-(O-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[F+O-1])&nt.hash_mask,nt.prev[F&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=F,F++,--M;);nt.strstart=F,nt.lookahead=O-1,Lt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=O-1,nt.match_available=0,E.next_in=ht,E.input=Z,E.avail_in=at,nt.wrap=K,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,f,d,p,m,k,w,T,v,I,U,R,L,B,O,Y,et,C,S,b,P;a=s.state,c=s.next_in,b=s.input,u=c+(s.avail_in-5),l=s.next_out,P=s.output,h=l-(o-s.avail_out),f=l+(s.avail_out-257),d=a.dmax,p=a.wsize,m=a.whave,k=a.wnext,w=a.window,T=a.hold,v=a.bits,I=a.lencode,U=a.distcode,R=(1<<a.lenbits)-1,L=(1<<a.distbits)-1;t:do{v<15&&(T+=b[c++]<<v,v+=8,T+=b[c++]<<v,v+=8),B=I[T&R];e:for(;;){if(T>>>=O=B>>>24,v-=O,(O=B>>>16&255)===0)P[l++]=65535&B;else{if(!(16&O)){if(!(64&O)){B=I[(65535&B)+(T&(1<<O)-1)];continue e}if(32&O){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}Y=65535&B,(O&=15)&&(v<O&&(T+=b[c++]<<v,v+=8),Y+=T&(1<<O)-1,T>>>=O,v-=O),v<15&&(T+=b[c++]<<v,v+=8,T+=b[c++]<<v,v+=8),B=U[T&L];n:for(;;){if(T>>>=O=B>>>24,v-=O,!(16&(O=B>>>16&255))){if(!(64&O)){B=U[(65535&B)+(T&(1<<O)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(et=65535&B,v<(O&=15)&&(T+=b[c++]<<v,(v+=8)<O&&(T+=b[c++]<<v,v+=8)),d<(et+=T&(1<<O)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=O,v-=O,(O=l-h)<et){if(m<(O=et-O)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(S=w,(C=0)===k){if(C+=p-O,O<Y){for(Y-=O;P[l++]=w[C++],--O;);C=l-et,S=P}}else if(k<O){if(C+=p+k-O,(O-=k)<Y){for(Y-=O;P[l++]=w[C++],--O;);if(C=0,k<Y){for(Y-=O=k;P[l++]=w[C++],--O;);C=l-et,S=P}}}else if(C+=k-O,O<Y){for(Y-=O;P[l++]=w[C++],--O;);C=l-et,S=P}for(;2<Y;)P[l++]=S[C++],P[l++]=S[C++],P[l++]=S[C++],Y-=3;Y&&(P[l++]=S[C++],1<Y&&(P[l++]=S[C++]))}else{for(C=l-et;P[l++]=P[C++],P[l++]=P[C++],P[l++]=P[C++],2<(Y-=3););Y&&(P[l++]=P[C++],1<Y&&(P[l++]=P[C++]))}break}}break}}while(c<u&&l<f);c-=Y=v>>3,T&=(1<<(v-=Y<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<f?f-l+257:257-(l-f),a.hold=T,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,f=0,d=-2,p=1,m=852,k=592;function w(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(C){var S;return C&&C.state?(S=C.state,C.total_in=C.total_out=S.total=0,C.msg="",S.wrap&&(C.adler=1&S.wrap),S.mode=p,S.last=0,S.havedict=0,S.dmax=32768,S.head=null,S.hold=0,S.bits=0,S.lencode=S.lendyn=new s.Buf32(m),S.distcode=S.distdyn=new s.Buf32(k),S.sane=1,S.back=-1,f):d}function I(C){var S;return C&&C.state?((S=C.state).wsize=0,S.whave=0,S.wnext=0,v(C)):d}function U(C,S){var b,P;return C&&C.state?(P=C.state,S<0?(b=0,S=-S):(b=1+(S>>4),S<48&&(S&=15)),S&&(S<8||15<S)?d:(P.window!==null&&P.wbits!==S&&(P.window=null),P.wrap=b,P.wbits=S,I(C))):d}function R(C,S){var b,P;return C?(P=new T,(C.state=P).window=null,(b=U(C,S))!==f&&(C.state=null),b):d}var L,B,O=!0;function Y(C){if(O){var S;for(L=new s.Buf32(512),B=new s.Buf32(32),S=0;S<144;)C.lens[S++]=8;for(;S<256;)C.lens[S++]=9;for(;S<280;)C.lens[S++]=7;for(;S<288;)C.lens[S++]=8;for(u(l,C.lens,0,288,L,0,C.work,{bits:9}),S=0;S<32;)C.lens[S++]=5;u(h,C.lens,0,32,B,0,C.work,{bits:5}),O=!1}C.lencode=L,C.lenbits=9,C.distcode=B,C.distbits=5}function et(C,S,b,P){var X,D=C.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new s.Buf8(D.wsize)),P>=D.wsize?(s.arraySet(D.window,S,b-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(P<(X=D.wsize-D.wnext)&&(X=P),s.arraySet(D.window,S,b-P,X,D.wnext),(P-=X)?(s.arraySet(D.window,S,b-P,P,0),D.wnext=P,D.whave=D.wsize):(D.wnext+=X,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=X))),0}i.inflateReset=I,i.inflateReset2=U,i.inflateResetKeep=v,i.inflateInit=function(C){return R(C,15)},i.inflateInit2=R,i.inflate=function(C,S){var b,P,X,D,ct,tt,ft,V,z,Et,ot,lt,Lt,Xt,Mt,xt,Bt,Ut,we,Ie,E,st,nt,F,M=0,K=new s.Buf8(4),at=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return d;(b=C.state).mode===12&&(b.mode=13),ct=C.next_out,X=C.output,ft=C.avail_out,D=C.next_in,P=C.input,tt=C.avail_in,V=b.hold,z=b.bits,Et=tt,ot=ft,st=f;t:for(;;)switch(b.mode){case p:if(b.wrap===0){b.mode=13;break}for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(2&b.wrap&&V===35615){K[b.check=0]=255&V,K[1]=V>>>8&255,b.check=a(b.check,K,2,0),z=V=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&V)<<8)+(V>>8))%31){C.msg="incorrect header check",b.mode=30;break}if((15&V)!=8){C.msg="unknown compression method",b.mode=30;break}if(z-=4,E=8+(15&(V>>>=4)),b.wbits===0)b.wbits=E;else if(E>b.wbits){C.msg="invalid window size",b.mode=30;break}b.dmax=1<<E,C.adler=b.check=1,b.mode=512&V?10:12,z=V=0;break;case 2:for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(b.flags=V,(255&b.flags)!=8){C.msg="unknown compression method",b.mode=30;break}if(57344&b.flags){C.msg="unknown header flags set",b.mode=30;break}b.head&&(b.head.text=V>>8&1),512&b.flags&&(K[0]=255&V,K[1]=V>>>8&255,b.check=a(b.check,K,2,0)),z=V=0,b.mode=3;case 3:for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.head&&(b.head.time=V),512&b.flags&&(K[0]=255&V,K[1]=V>>>8&255,K[2]=V>>>16&255,K[3]=V>>>24&255,b.check=a(b.check,K,4,0)),z=V=0,b.mode=4;case 4:for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.head&&(b.head.xflags=255&V,b.head.os=V>>8),512&b.flags&&(K[0]=255&V,K[1]=V>>>8&255,b.check=a(b.check,K,2,0)),z=V=0,b.mode=5;case 5:if(1024&b.flags){for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.length=V,b.head&&(b.head.extra_len=V),512&b.flags&&(K[0]=255&V,K[1]=V>>>8&255,b.check=a(b.check,K,2,0)),z=V=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(tt<(lt=b.length)&&(lt=tt),lt&&(b.head&&(E=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Array(b.head.extra_len)),s.arraySet(b.head.extra,P,D,lt,E)),512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,b.length-=lt),b.length))break t;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(tt===0)break t;for(lt=0;E=P[D+lt++],b.head&&E&&b.length<65536&&(b.head.name+=String.fromCharCode(E)),E&&lt<tt;);if(512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,E)break t}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(tt===0)break t;for(lt=0;E=P[D+lt++],b.head&&E&&b.length<65536&&(b.head.comment+=String.fromCharCode(E)),E&&lt<tt;);if(512&b.flags&&(b.check=a(b.check,P,lt,D)),tt-=lt,D+=lt,E)break t}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;z<16;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V!==(65535&b.check)){C.msg="header crc mismatch",b.mode=30;break}z=V=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),C.adler=b.check=0,b.mode=12;break;case 10:for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}C.adler=b.check=w(V),z=V=0,b.mode=11;case 11:if(b.havedict===0)return C.next_out=ct,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,2;C.adler=b.check=1,b.mode=12;case 12:if(S===5||S===6)break t;case 13:if(b.last){V>>>=7&z,z-=7&z,b.mode=27;break}for(;z<3;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}switch(b.last=1&V,z-=1,3&(V>>>=1)){case 0:b.mode=14;break;case 1:if(Y(b),b.mode=20,S!==6)break;V>>>=2,z-=2;break t;case 2:b.mode=17;break;case 3:C.msg="invalid block type",b.mode=30}V>>>=2,z-=2;break;case 14:for(V>>>=7&z,z-=7&z;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if((65535&V)!=(V>>>16^65535)){C.msg="invalid stored block lengths",b.mode=30;break}if(b.length=65535&V,z=V=0,b.mode=15,S===6)break t;case 15:b.mode=16;case 16:if(lt=b.length){if(tt<lt&&(lt=tt),ft<lt&&(lt=ft),lt===0)break t;s.arraySet(X,P,D,lt,ct),tt-=lt,D+=lt,ft-=lt,ct+=lt,b.length-=lt;break}b.mode=12;break;case 17:for(;z<14;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(b.nlen=257+(31&V),V>>>=5,z-=5,b.ndist=1+(31&V),V>>>=5,z-=5,b.ncode=4+(15&V),V>>>=4,z-=4,286<b.nlen||30<b.ndist){C.msg="too many length or distance symbols",b.mode=30;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;z<3;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.lens[at[b.have++]]=7&V,V>>>=3,z-=3}for(;b.have<19;)b.lens[at[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,nt={bits:b.lenbits},st=u(0,b.lens,0,19,b.lencode,0,b.work,nt),b.lenbits=nt.bits,st){C.msg="invalid code lengths set",b.mode=30;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;xt=(M=b.lencode[V&(1<<b.lenbits)-1])>>>16&255,Bt=65535&M,!((Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(Bt<16)V>>>=Mt,z-=Mt,b.lens[b.have++]=Bt;else{if(Bt===16){for(F=Mt+2;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V>>>=Mt,z-=Mt,b.have===0){C.msg="invalid bit length repeat",b.mode=30;break}E=b.lens[b.have-1],lt=3+(3&V),V>>>=2,z-=2}else if(Bt===17){for(F=Mt+3;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}z-=Mt,E=0,lt=3+(7&(V>>>=Mt)),V>>>=3,z-=3}else{for(F=Mt+7;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}z-=Mt,E=0,lt=11+(127&(V>>>=Mt)),V>>>=7,z-=7}if(b.have+lt>b.nlen+b.ndist){C.msg="invalid bit length repeat",b.mode=30;break}for(;lt--;)b.lens[b.have++]=E}}if(b.mode===30)break;if(b.lens[256]===0){C.msg="invalid code -- missing end-of-block",b.mode=30;break}if(b.lenbits=9,nt={bits:b.lenbits},st=u(l,b.lens,0,b.nlen,b.lencode,0,b.work,nt),b.lenbits=nt.bits,st){C.msg="invalid literal/lengths set",b.mode=30;break}if(b.distbits=6,b.distcode=b.distdyn,nt={bits:b.distbits},st=u(h,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,nt),b.distbits=nt.bits,st){C.msg="invalid distances set",b.mode=30;break}if(b.mode=20,S===6)break t;case 20:b.mode=21;case 21:if(6<=tt&&258<=ft){C.next_out=ct,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,c(C,ot),ct=C.next_out,X=C.output,ft=C.avail_out,D=C.next_in,P=C.input,tt=C.avail_in,V=b.hold,z=b.bits,b.mode===12&&(b.back=-1);break}for(b.back=0;xt=(M=b.lencode[V&(1<<b.lenbits)-1])>>>16&255,Bt=65535&M,!((Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(xt&&!(240&xt)){for(Ut=Mt,we=xt,Ie=Bt;xt=(M=b.lencode[Ie+((V&(1<<Ut+we)-1)>>Ut)])>>>16&255,Bt=65535&M,!(Ut+(Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}V>>>=Ut,z-=Ut,b.back+=Ut}if(V>>>=Mt,z-=Mt,b.back+=Mt,b.length=Bt,xt===0){b.mode=26;break}if(32&xt){b.back=-1,b.mode=12;break}if(64&xt){C.msg="invalid literal/length code",b.mode=30;break}b.extra=15&xt,b.mode=22;case 22:if(b.extra){for(F=b.extra;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.length+=V&(1<<b.extra)-1,V>>>=b.extra,z-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;xt=(M=b.distcode[V&(1<<b.distbits)-1])>>>16&255,Bt=65535&M,!((Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(!(240&xt)){for(Ut=Mt,we=xt,Ie=Bt;xt=(M=b.distcode[Ie+((V&(1<<Ut+we)-1)>>Ut)])>>>16&255,Bt=65535&M,!(Ut+(Mt=M>>>24)<=z);){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}V>>>=Ut,z-=Ut,b.back+=Ut}if(V>>>=Mt,z-=Mt,b.back+=Mt,64&xt){C.msg="invalid distance code",b.mode=30;break}b.offset=Bt,b.extra=15&xt,b.mode=24;case 24:if(b.extra){for(F=b.extra;z<F;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}b.offset+=V&(1<<b.extra)-1,V>>>=b.extra,z-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){C.msg="invalid distance too far back",b.mode=30;break}b.mode=25;case 25:if(ft===0)break t;if(lt=ot-ft,b.offset>lt){if((lt=b.offset-lt)>b.whave&&b.sane){C.msg="invalid distance too far back",b.mode=30;break}Lt=lt>b.wnext?(lt-=b.wnext,b.wsize-lt):b.wnext-lt,lt>b.length&&(lt=b.length),Xt=b.window}else Xt=X,Lt=ct-b.offset,lt=b.length;for(ft<lt&&(lt=ft),ft-=lt,b.length-=lt;X[ct++]=Xt[Lt++],--lt;);b.length===0&&(b.mode=21);break;case 26:if(ft===0)break t;X[ct++]=b.length,ft--,b.mode=21;break;case 27:if(b.wrap){for(;z<32;){if(tt===0)break t;tt--,V|=P[D++]<<z,z+=8}if(ot-=ft,C.total_out+=ot,b.total+=ot,ot&&(C.adler=b.check=b.flags?a(b.check,X,ot,ct-ot):o(b.check,X,ot,ct-ot)),ot=ft,(b.flags?V:w(V))!==b.check){C.msg="incorrect data check",b.mode=30;break}z=V=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;z<32;){if(tt===0)break t;tt--,V+=P[D++]<<z,z+=8}if(V!==(4294967295&b.total)){C.msg="incorrect length check",b.mode=30;break}z=V=0}b.mode=29;case 29:st=1;break t;case 30:st=-3;break t;case 31:return-4;case 32:default:return d}return C.next_out=ct,C.avail_out=ft,C.next_in=D,C.avail_in=tt,b.hold=V,b.bits=z,(b.wsize||ot!==C.avail_out&&b.mode<30&&(b.mode<27||S!==4))&&et(C,C.output,C.next_out,ot-C.avail_out)?(b.mode=31,-4):(Et-=C.avail_in,ot-=C.avail_out,C.total_in+=Et,C.total_out+=ot,b.total+=ot,b.wrap&&ot&&(C.adler=b.check=b.flags?a(b.check,X,ot,C.next_out-ot):o(b.check,X,ot,C.next_out-ot)),C.data_type=b.bits+(b.last?64:0)+(b.mode===12?128:0)+(b.mode===20||b.mode===15?256:0),(Et==0&&ot===0||S===4)&&st===f&&(st=-5),st)},i.inflateEnd=function(C){if(!C||!C.state)return d;var S=C.state;return S.window&&(S.window=null),C.state=null,f},i.inflateGetHeader=function(C,S){var b;return C&&C.state&&2&(b=C.state).wrap?((b.head=S).done=!1,f):d},i.inflateSetDictionary=function(C,S){var b,P=S.length;return C&&C.state?(b=C.state).wrap!==0&&b.mode!==11?d:b.mode===11&&o(1,S,P,0)!==b.check?-3:et(C,S,P,P)?(b.mode=31,-4):(b.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,f,d,p,m,k,w){var T,v,I,U,R,L,B,O,Y,et=w.bits,C=0,S=0,b=0,P=0,X=0,D=0,ct=0,tt=0,ft=0,V=0,z=null,Et=0,ot=new s.Buf16(16),lt=new s.Buf16(16),Lt=null,Xt=0;for(C=0;C<=15;C++)ot[C]=0;for(S=0;S<d;S++)ot[h[f+S]]++;for(X=et,P=15;1<=P&&ot[P]===0;P--);if(P<X&&(X=P),P===0)return p[m++]=20971520,p[m++]=20971520,w.bits=1,0;for(b=1;b<P&&ot[b]===0;b++);for(X<b&&(X=b),C=tt=1;C<=15;C++)if(tt<<=1,(tt-=ot[C])<0)return-1;if(0<tt&&(l===0||P!==1))return-1;for(lt[1]=0,C=1;C<15;C++)lt[C+1]=lt[C]+ot[C];for(S=0;S<d;S++)h[f+S]!==0&&(k[lt[h[f+S]]++]=S);if(L=l===0?(z=Lt=k,19):l===1?(z=o,Et-=257,Lt=a,Xt-=257,256):(z=c,Lt=u,-1),C=b,R=m,ct=S=V=0,I=-1,U=(ft=1<<(D=X))-1,l===1&&852<ft||l===2&&592<ft)return 1;for(;;){for(B=C-ct,Y=k[S]<L?(O=0,k[S]):k[S]>L?(O=Lt[Xt+k[S]],z[Et+k[S]]):(O=96,0),T=1<<C-ct,b=v=1<<D;p[R+(V>>ct)+(v-=T)]=B<<24|O<<16|Y|0,v!==0;);for(T=1<<C-1;V&T;)T>>=1;if(T!==0?(V&=T-1,V+=T):V=0,S++,--ot[C]==0){if(C===P)break;C=h[f+k[S]]}if(X<C&&(V&U)!==I){for(ct===0&&(ct=X),R+=b,tt=1<<(D=C-ct);D+ct<P&&!((tt-=ot[D+ct])<=0);)D++,tt<<=1;if(ft+=1<<D,l===1&&852<ft||l===2&&592<ft)return 1;p[I=V&U]=X<<24|D<<16|R-m|0}}return V!==0&&(p[R+V]=C-ct<<24|64<<16|0),w.bits=X,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(M){for(var K=M.length;0<=--K;)M[K]=0}var u=0,l=29,h=256,f=h+1+l,d=30,p=19,m=2*f+1,k=15,w=16,T=7,v=256,I=16,U=17,R=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],et=new Array(2*(f+2));c(et);var C=new Array(2*d);c(C);var S=new Array(512);c(S);var b=new Array(256);c(b);var P=new Array(l);c(P);var X,D,ct,tt=new Array(d);function ft(M,K,at,ht,Z){this.static_tree=M,this.extra_bits=K,this.extra_base=at,this.elems=ht,this.max_length=Z,this.has_stree=M&&M.length}function V(M,K){this.dyn_tree=M,this.max_code=0,this.stat_desc=K}function z(M){return M<256?S[M]:S[256+(M>>>7)]}function Et(M,K){M.pending_buf[M.pending++]=255&K,M.pending_buf[M.pending++]=K>>>8&255}function ot(M,K,at){M.bi_valid>w-at?(M.bi_buf|=K<<M.bi_valid&65535,Et(M,M.bi_buf),M.bi_buf=K>>w-M.bi_valid,M.bi_valid+=at-w):(M.bi_buf|=K<<M.bi_valid&65535,M.bi_valid+=at)}function lt(M,K,at){ot(M,at[2*K],at[2*K+1])}function Lt(M,K){for(var at=0;at|=1&M,M>>>=1,at<<=1,0<--K;);return at>>>1}function Xt(M,K,at){var ht,Z,pt=new Array(k+1),_t=0;for(ht=1;ht<=k;ht++)pt[ht]=_t=_t+at[ht-1]<<1;for(Z=0;Z<=K;Z++){var dt=M[2*Z+1];dt!==0&&(M[2*Z]=Lt(pt[dt]++,dt))}}function Mt(M){var K;for(K=0;K<f;K++)M.dyn_ltree[2*K]=0;for(K=0;K<d;K++)M.dyn_dtree[2*K]=0;for(K=0;K<p;K++)M.bl_tree[2*K]=0;M.dyn_ltree[2*v]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}function xt(M){8<M.bi_valid?Et(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}function Bt(M,K,at,ht){var Z=2*K,pt=2*at;return M[Z]<M[pt]||M[Z]===M[pt]&&ht[K]<=ht[at]}function Ut(M,K,at){for(var ht=M.heap[at],Z=at<<1;Z<=M.heap_len&&(Z<M.heap_len&&Bt(K,M.heap[Z+1],M.heap[Z],M.depth)&&Z++,!Bt(K,ht,M.heap[Z],M.depth));)M.heap[at]=M.heap[Z],at=Z,Z<<=1;M.heap[at]=ht}function we(M,K,at){var ht,Z,pt,_t,dt=0;if(M.last_lit!==0)for(;ht=M.pending_buf[M.d_buf+2*dt]<<8|M.pending_buf[M.d_buf+2*dt+1],Z=M.pending_buf[M.l_buf+dt],dt++,ht===0?lt(M,Z,K):(lt(M,(pt=b[Z])+h+1,K),(_t=L[pt])!==0&&ot(M,Z-=P[pt],_t),lt(M,pt=z(--ht),at),(_t=B[pt])!==0&&ot(M,ht-=tt[pt],_t)),dt<M.last_lit;);lt(M,v,K)}function Ie(M,K){var at,ht,Z,pt=K.dyn_tree,_t=K.stat_desc.static_tree,dt=K.stat_desc.has_stree,vt=K.stat_desc.elems,ce=-1;for(M.heap_len=0,M.heap_max=m,at=0;at<vt;at++)pt[2*at]!==0?(M.heap[++M.heap_len]=ce=at,M.depth[at]=0):pt[2*at+1]=0;for(;M.heap_len<2;)pt[2*(Z=M.heap[++M.heap_len]=ce<2?++ce:0)]=1,M.depth[Z]=0,M.opt_len--,dt&&(M.static_len-=_t[2*Z+1]);for(K.max_code=ce,at=M.heap_len>>1;1<=at;at--)Ut(M,pt,at);for(Z=vt;at=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Ut(M,pt,1),ht=M.heap[1],M.heap[--M.heap_max]=at,M.heap[--M.heap_max]=ht,pt[2*Z]=pt[2*at]+pt[2*ht],M.depth[Z]=(M.depth[at]>=M.depth[ht]?M.depth[at]:M.depth[ht])+1,pt[2*at+1]=pt[2*ht+1]=Z,M.heap[1]=Z++,Ut(M,pt,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],function(Ft,Ln){var A,g,y,N,$,Q,it=Ln.dyn_tree,jt=Ln.max_code,ke=Ln.stat_desc.static_tree,ge=Ln.stat_desc.has_stree,xe=Ln.stat_desc.extra_bits,ae=Ln.stat_desc.extra_base,Aa=Ln.stat_desc.max_length,Dl=0;for(N=0;N<=k;N++)Ft.bl_count[N]=0;for(it[2*Ft.heap[Ft.heap_max]+1]=0,A=Ft.heap_max+1;A<m;A++)Aa<(N=it[2*it[2*(g=Ft.heap[A])+1]+1]+1)&&(N=Aa,Dl++),it[2*g+1]=N,jt<g||(Ft.bl_count[N]++,$=0,ae<=g&&($=xe[g-ae]),Q=it[2*g],Ft.opt_len+=Q*(N+$),ge&&(Ft.static_len+=Q*(ke[2*g+1]+$)));if(Dl!==0){do{for(N=Aa-1;Ft.bl_count[N]===0;)N--;Ft.bl_count[N]--,Ft.bl_count[N+1]+=2,Ft.bl_count[Aa]--,Dl-=2}while(0<Dl);for(N=Aa;N!==0;N--)for(g=Ft.bl_count[N];g!==0;)jt<(y=Ft.heap[--A])||(it[2*y+1]!==N&&(Ft.opt_len+=(N-it[2*y+1])*it[2*y],it[2*y+1]=N),g--)}}(M,K),Xt(pt,ce,M.bl_count)}function E(M,K,at){var ht,Z,pt=-1,_t=K[1],dt=0,vt=7,ce=4;for(_t===0&&(vt=138,ce=3),K[2*(at+1)+1]=65535,ht=0;ht<=at;ht++)Z=_t,_t=K[2*(ht+1)+1],++dt<vt&&Z===_t||(dt<ce?M.bl_tree[2*Z]+=dt:Z!==0?(Z!==pt&&M.bl_tree[2*Z]++,M.bl_tree[2*I]++):dt<=10?M.bl_tree[2*U]++:M.bl_tree[2*R]++,pt=Z,ce=(dt=0)===_t?(vt=138,3):Z===_t?(vt=6,3):(vt=7,4))}function st(M,K,at){var ht,Z,pt=-1,_t=K[1],dt=0,vt=7,ce=4;for(_t===0&&(vt=138,ce=3),ht=0;ht<=at;ht++)if(Z=_t,_t=K[2*(ht+1)+1],!(++dt<vt&&Z===_t)){if(dt<ce)for(;lt(M,Z,M.bl_tree),--dt!=0;);else Z!==0?(Z!==pt&&(lt(M,Z,M.bl_tree),dt--),lt(M,I,M.bl_tree),ot(M,dt-3,2)):dt<=10?(lt(M,U,M.bl_tree),ot(M,dt-3,3)):(lt(M,R,M.bl_tree),ot(M,dt-11,7));pt=Z,ce=(dt=0)===_t?(vt=138,3):Z===_t?(vt=6,3):(vt=7,4)}}c(tt);var nt=!1;function F(M,K,at,ht){ot(M,(u<<1)+(ht?1:0),3),function(Z,pt,_t,dt){xt(Z),Et(Z,_t),Et(Z,~_t),s.arraySet(Z.pending_buf,Z.window,pt,_t,Z.pending),Z.pending+=_t}(M,K,at)}i._tr_init=function(M){nt||(function(){var K,at,ht,Z,pt,_t=new Array(k+1);for(Z=ht=0;Z<l-1;Z++)for(P[Z]=ht,K=0;K<1<<L[Z];K++)b[ht++]=Z;for(b[ht-1]=Z,Z=pt=0;Z<16;Z++)for(tt[Z]=pt,K=0;K<1<<B[Z];K++)S[pt++]=Z;for(pt>>=7;Z<d;Z++)for(tt[Z]=pt<<7,K=0;K<1<<B[Z]-7;K++)S[256+pt++]=Z;for(at=0;at<=k;at++)_t[at]=0;for(K=0;K<=143;)et[2*K+1]=8,K++,_t[8]++;for(;K<=255;)et[2*K+1]=9,K++,_t[9]++;for(;K<=279;)et[2*K+1]=7,K++,_t[7]++;for(;K<=287;)et[2*K+1]=8,K++,_t[8]++;for(Xt(et,f+1,_t),K=0;K<d;K++)C[2*K+1]=5,C[2*K]=Lt(K,5);X=new ft(et,L,h+1,f,k),D=new ft(C,B,0,d,k),ct=new ft(new Array(0),O,0,p,T)}(),nt=!0),M.l_desc=new V(M.dyn_ltree,X),M.d_desc=new V(M.dyn_dtree,D),M.bl_desc=new V(M.bl_tree,ct),M.bi_buf=0,M.bi_valid=0,Mt(M)},i._tr_stored_block=F,i._tr_flush_block=function(M,K,at,ht){var Z,pt,_t=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=function(dt){var vt,ce=4093624447;for(vt=0;vt<=31;vt++,ce>>>=1)if(1&ce&&dt.dyn_ltree[2*vt]!==0)return o;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(dt.dyn_ltree[2*vt]!==0)return a;return o}(M)),Ie(M,M.l_desc),Ie(M,M.d_desc),_t=function(dt){var vt;for(E(dt,dt.dyn_ltree,dt.l_desc.max_code),E(dt,dt.dyn_dtree,dt.d_desc.max_code),Ie(dt,dt.bl_desc),vt=p-1;3<=vt&&dt.bl_tree[2*Y[vt]+1]===0;vt--);return dt.opt_len+=3*(vt+1)+5+5+4,vt}(M),Z=M.opt_len+3+7>>>3,(pt=M.static_len+3+7>>>3)<=Z&&(Z=pt)):Z=pt=at+5,at+4<=Z&&K!==-1?F(M,K,at,ht):M.strategy===4||pt===Z?(ot(M,2+(ht?1:0),3),we(M,et,C)):(ot(M,4+(ht?1:0),3),function(dt,vt,ce,Ft){var Ln;for(ot(dt,vt-257,5),ot(dt,ce-1,5),ot(dt,Ft-4,4),Ln=0;Ln<Ft;Ln++)ot(dt,dt.bl_tree[2*Y[Ln]+1],3);st(dt,dt.dyn_ltree,vt-1),st(dt,dt.dyn_dtree,ce-1)}(M,M.l_desc.max_code+1,M.d_desc.max_code+1,_t+1),we(M,M.dyn_ltree,M.dyn_dtree)),Mt(M),ht&&xt(M)},i._tr_tally=function(M,K,at){return M.pending_buf[M.d_buf+2*M.last_lit]=K>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&K,M.pending_buf[M.l_buf+M.last_lit]=255&at,M.last_lit++,K===0?M.dyn_ltree[2*at]++:(M.matches++,K--,M.dyn_ltree[2*(b[at]+h+1)]++,M.dyn_dtree[2*z(K)]++),M.last_lit===M.lit_bufsize-1},i._tr_align=function(M){ot(M,2,3),lt(M,v,et),function(K){K.bi_valid===16?(Et(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):8<=K.bi_valid&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)}(M)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,f=1,d={},p=!1,m=o.document,k=Object.getPrototypeOf&&Object.getPrototypeOf(o);k=k&&k.setTimeout?k:o,c={}.toString.call(o.process)==="[object process]"?function(I){Ii.nextTick(function(){T(I)})}:function(){if(o.postMessage&&!o.importScripts){var I=!0,U=o.onmessage;return o.onmessage=function(){I=!1},o.postMessage("","*"),o.onmessage=U,I}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(I){o.postMessage(h+I,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(I){T(I.data)},function(I){l.port2.postMessage(I)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(I){var U=m.createElement("script");U.onreadystatechange=function(){T(I),U.onreadystatechange=null,u.removeChild(U),U=null},u.appendChild(U)}):function(I){setTimeout(T,0,I)},k.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var U=new Array(arguments.length-1),R=0;R<U.length;R++)U[R]=arguments[R+1];var L={callback:I,args:U};return d[f]=L,c(f),f++},k.clearImmediate=w}function w(I){delete d[I]}function T(I){if(p)setTimeout(T,0,I);else{var U=d[I];if(U){p=!0;try{(function(R){var L=R.callback,B=R.args;switch(B.length){case 0:L();break;case 1:L(B[0]);break;case 2:L(B[0],B[1]);break;case 3:L(B[0],B[1],B[2]);break;default:L.apply(a,B)}})(U)}finally{w(I),p=!1}}}}function v(I){I.source===o&&typeof I.data=="string"&&I.data.indexOf(h)===0&&T(+I.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof En<"u"?En:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Jb);var u8=Jb.exports,fd=ks(u8);const Zb={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Zb);var cr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},go,xa,bs;class h8{constructor(...t){go.set(this,new Map),xa.set(this,new Map),bs.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),cr(this,bs,"f").has(r)||cr(this,bs,"f").set(r,new Set);const s=cr(this,bs,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&cr(this,xa,"f").set(r,a),o=!1,c)continue;const u=cr(this,go,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);cr(this,go,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:cr(this,go,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&cr(this,xa,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:cr(this,bs,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of cr(this,bs,"f").values())Object.freeze(t);return this}_getTestState(){return{types:cr(this,go,"f"),extensions:cr(this,xa,"f")}}}go=new WeakMap,xa=new WeakMap,bs=new WeakMap;var f8=new h8(Zb)._freeze();function Qb(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return f8.getType(e)??"application/octet-stream"}async function d8(e,t,n){try{ti(G,e,t.name);const r=await t.arrayBuffer();(await new fd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const u=Qb(o,c),l=new File([c],a.name,{type:u});n(l)}).catch(c=>{ye(G,e,"crash",c.message)})})}catch(r){ye(G,e,"crash",r.message)}}async function p8(e,t,n){try{ti(G,t,e.name);const r=await e.arrayBuffer();n(new Uint8Array(r))}catch(r){ye(G,t,"crash",r.message)}}function t1(e,t){function n(r){if(x(t))switch(r){case"text/plain":t.text().then(i=>Ql(G,e,void 0,"text",`file:${t.name}`,i)).catch(i=>ye(G,e,"crash",i.message));break;case"application/json":t.text().then(i=>Ql(G,e,void 0,"json",`file:${t.name}`,i)).catch(i=>ye(G,e,"crash",i.message));break;case"application/zip":d8(e,t,i=>t1(e,i)).catch(i=>ye(G,e,"crash",i.message));break;case"application/octet-stream":p8(t,e,i=>Ql(G,e,void 0,"binary",`file:${t.name}`,i)).catch(i=>ye(G,e,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=Qb(t.name,new Uint8Array(i));if(s)n(s);else return ye(G,e,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>ye(G,e,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function yo(e,t,n){function r(i){ye(e,t,"crash",i.message)}n().catch(r)}function m8(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function g8(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const y8=new Date("1980/09/02");async function e1(e){return console.info("saved",e),new Promise((t,n)=>{const r=new fd;for(let i=0;i<e.length;++i){const s=e[i],o=IL(s);if(o){const a=KT(o);x(a)&&r.file(s.id,a,{date:y8})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(g8(i))}).catch(n)})}async function _8(e){return new Promise((t,n)=>{const r=new fd;r.loadAsync(m8(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=NL(GT(c));x(u)&&i.push(u)}t(i)}).catch(n)})}const n1="$yellow$205$205$205$196";function r1(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Ve;function b8(){return!!Ve}function E8(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let f=r;f<=s;++f){const d={x:f-r,y:h-i},p=On(e,{x:f,y:h});(p==null?void 0:p.category)===Yn.ISOBJECT?(u.push(Xe(od(e,f,h))),Fr(p)!=="player"&&l.push({...Xe(p),...d,id:"blank"})):u.push({...Xe(p),...d})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}function w8(e,t,n,r){const i=Gn(e);if(x(i))switch(Ve=E8(i,t,n),r){case"copyobjects":Ve.terrain=[];break;case"copyterrain":Ve.objects=[];break}}function k8(e,t,n){const r=r1(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,n1),Dt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Dt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Dt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=bn(e);i.scroll=Zr(e)}function x8(e,t,n,r){const i=Gn(e);if(!x(i)||!x(Ve))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),u=a-s+1,l=c-o+1,h=Math.min(Ve.width,u),f=Math.min(Ve.height,l);switch(r){case"pasteall":{for(let d=0;d<f;++d)for(let p=0;p<h;++p){const m=lc({x:p,y:d},Ve.width);Tr(i,{...Ve.terrain[m],x:s+p,y:o+d})}for(let d=0;d<Ve.objects.length;++d){const p=Ve.objects[d];x(p.x)&&x(p.y)&&Rp(p.x,p.y,0,u-1,l-1,0)&&ad(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let d=0;d<Ve.objects.length;++d){const p=Ve.objects[d];x(p.x)&&x(p.y)&&Rp(p.x,p.y,0,u-1,l-1,0)&&ad(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let d=0;d<f;++d)for(let p=0;p<h;++p){const m=lc({x:p,y:d},Ve.width);Tr(i,{...Ve.terrain[m],x:s+p,y:o+d})}break;case"pasteterraintiled":for(let d=o;d<=c;++d)for(let p=s;p<=a;++p){const m=(p-s)%Ve.width,k=(d-o)%Ve.height,w=lc({x:m,y:k},Ve.width);Tr(i,{...Ve.terrain[w],x:p,y:d})}break}}function T8(e,t,n){const r=r1(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,n1),Dt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Dt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Dt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Dt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=bn(e);i.scroll=Zr(e)}const Es="$yellow$205$205$205$196";function Bl(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function A8(e,t,n,r){const i=Gn(e);if(!x(i))return;let s=0;function o(){return s}function a(u,l){Ct(l)&&(s=l,Ip(t.x,t.y,n.x,n.y).forEach(h=>{const f=On(i,h);x(f)&&(f[u]=l)}))}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,Es),Dt(e,`batch:${Bl(t,n)}`,"char",[r,"charedit"],o,a);const c=bn(e);c.scroll=Zr(e)}function v8(e,t,n,r){const i=Gn(e);if(!x(i))return;let s=0;function o(){return s}function a(u,l){if(Ct(l)){s=l;for(let h=t.y;h<=n.y;++h)for(let f=t.x;f<=n.x;++f){const d=On(i,{x:f,y:h});x(d)&&(d[u]=l)}}}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,Es),Dt(e,`batch:${Bl(t,n)}`,"color",[r,"coloredit"],o,a);const c=bn(e);c.scroll=Zr(e)}function S8(e,t,n,r){const i=Gn(e);if(!x(i))return;let s=0;function o(){return s}function a(u,l){Ct(l)&&(s=l,Ip(t.x,t.y,n.x,n.y).forEach(h=>{const f=On(i,h);x(f)&&(f[u]=l)}))}se(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,Es),Dt(e,`batch:${Bl(t,n)}`,"color",[r,"coloredit"],o,a);const c=bn(e);c.scroll=Zr(e)}const Ta={stat:"",patternsize:2,mirror:1};function R8(e,t,n){const r=_n(Pt.MAIN);if(!x(r))return;const i=Gn(e);if(!x(i))return;const s=Bl(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,Es),Dt(e,"batch","copy elements",[`copy:${s}`,"hk","1"," 1 ","next"]),b8()&&Dt(e,"batch","paste elements",[`paste:${s}`,"hk","2"," 2 ","next"]),Dt(e,"batch","copy coords",[`copycoords:${s}`,"hk","5"," 5 "]);function o(d){const{target:p}=lr(d);return Ta[p]}function a(d,p){if(Ct(p)||At(p)){const{target:m}=lr(d);Ta[m]=p}}Dt(e,"batch","remix",[`stat:${s}`,"text"],o,a),Dt(e,"batch","patternsize",[`patternsize:${s}`,"number","1","5"],o,a),Dt(e,"batch","mirror",[`mirror:${s}`,"number","1","8"],o,a),Dt(e,"batch","run",[`remixrun:${s}`,"hk","r"," R "]),se(e,Es),Dt(e,"batch","set chars:",[`chars:${s}`,"hk","a"," A ","next"]),Dt(e,"batch","set colors:",[`colors:${s}`,"hk","c"," C ","next"]),Dt(e,"batch","set bgs:",[`bgs:${s}`,"hk","b"," B ","next"]),se(e,Es),Dt(e,"batch","make empty",[`empty:${s}`,"hk","0"," 0 ","next"]),se(e,Es),se(e,"codepages:");const c=Math.min(t.x,n.x),u=Math.min(t.y,n.y),l=Math.max(t.x,n.x),h=Math.max(t.y,n.y),f=new Set;for(let d=u;d<=h;++d)for(let p=c;p<=l;++p){const m=On(i,{x:p,y:d}),k=$_(r,m);x(k)&&!f.has(k.id)&&(f.add(k.id),Dt(e,"batch",`edit @${Me(k)}`,[`pageopen:${k.id}`]))}}const _o="$yellow$205$205$205$196";function dd(e,t){return`inspect:${t!=null&&t.id?t.id:Jr(e,t)}`}function I8(e,t,n){const r=_n(Pt.MAIN);if(!x(r))return;const i=Gn(e);if(!x(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){x(t)&&(t[f]=d)}const a=t.category===Yn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=dd(i,t);se(e,`${a}: ${c} ${u}`),se(e,_o),Dt(e,l,"color",[n,"coloredit"],s,o);const h=bn(e);h.scroll=Zr(e)}function N8(e,t,n){const r=_n(Pt.MAIN);if(!x(r))return;const i=Gn(e);if(!x(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){x(t)&&(t[f]=d)}const a=t.category===Yn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=dd(i,t);se(e,`${a}: ${c} ${u}`),se(e,_o),Dt(e,l,"char",[n,"charedit"],s,o);const h=bn(e);h.scroll=Zr(e)}function O8(e,t,n,r,i,s){var h,f,d;function o(p){var k;const m=(r==null?void 0:r[p])??((k=r==null?void 0:r.kinddata)==null?void 0:k[p]);if(!x(m))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Gt.ISWALK;case"pushable":return 0;case"destructible":return 0}return m}function a(p,m){x(r)&&(r[p]=m)}s?se(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):se(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),se(e,_o);const c=dd(t,r);s?(Dt(e,c,"cycle",["cycle","number","1","255"],o,a),Dt(e,c,"collision",["collision","select","iswalking",`${Gt.ISWALK}`,"isswimming",`${Gt.ISSWIM}`],o,a)):Dt(e,c,"collision",["collision","select","iswalkable",`${Gt.ISWALK}`,"isswimable",`${Gt.ISSWIM}`,"issolid",`${Gt.ISSOLID}`],o,a),s&&Dt(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),Dt(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const u=da(n),l=Hn(u);for(let p=0;p<l.length;++p){const m=l[p];switch(m){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ne(u[m])){const[k,w,...T]=u[m];At(w)&&Dt(e,c,w||m,[m,k,...T],o,a)}break}}Dt(e,c,"copy coords",["copycoords","hk","5"," 5 "]),se(e,_o),Dt(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),Dt(e,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),Dt(e,c,`bg: ${r.bg??((d=r.kinddata)==null?void 0:d.bg)??0}`,["bg","hk","b"," B ","next"],o,a),se(e,_o),Dt(e,c,"make empty",["empty","hk","0"],o,a),se(e,_o),Dt(e,"batch",`edit @${Me(n)}`,[`pageopen:${n.id}`])}const i1="$yellow$205$205$205$196";function C8(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function L8(e,t,n,r){const i=_n(Pt.MAIN);if(!x(i))return;const s=Gn(e);if(x(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=On(s,{x:a,y:o});(c==null?void 0:c.category)===Yn.ISOBJECT&&Hr(i,s,c,i.timestamp),Tr(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=On(s,{x:a,y:o});(c==null?void 0:c.category)===Yn.ISOBJECT&&Hr(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Tr(s,{x:a,y:o});break}}}function M8(e,t,n){const r=C8(t,n);se(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),se(e,i1),Dt(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),Dt(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),Dt(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=bn(e);i.scroll=Zr(e)}function U8(e,t,n){const r=_n(Pt.MAIN);if(!x(r))return;const i=Gn(e);if(!x(i))return;if(wr(r,i),t.x===n.x&&t.y===n.y){const o=On(i,t),a=$_(r,o);x(o)&&x(a)&&O8(e,i,a,o,t,Ho(o)),o!=null&&o.kind||(se(e,`empty: ${t.x}, ${t.y}`),se(e,i1),Dt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]))}else R8(e,t,n);const s=bn(e);s.scroll=Zr(e)}function F8(e,t){const n=le(Pt.MAIN);if(!x(n))return;const r=Gn(t);if(!x(r))return;const i=lr(e),s=e8(r,i.target);if(x(s))switch(i.path){case"copycoords":Jl(G,qr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":I8(t,s,i.path);break;case"char":N8(t,s,i.path);break;case"empty":Hr(n,r,s,n.timestamp);break;case"code":yo(G,t,async()=>{const o=Fr(s),a="object";Pe(G,t,`opened [${a}] ${o}`);const c=[r.id,s.id];Vu(Ia(n.id,c),s.code??""),aE(G,t),await Md(800),Od(G,t,n.id,c,a,`${o} - ${n.name}`,[])});break;default:console.info("unknown inspect",i);break}}function P8(e,t){const n=Gn(t);if(!x(n))return;const r=lr(e),[i,s,o,a]=r.path.split(",").map(l=>parseFloat(l)),c={x:i,y:s},u={x:o,y:a};switch(r.target){case"copy":k8(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":w8(t,c,u,r.target);break;case"paste":T8(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":x8(t,c,u,r.target);break;case"empty":M8(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":L8(t,c,u,r.target);break;case"chars":A8(t,c,u,"char");break;case"colors":v8(t,c,u,"color");break;case"bgs":S8(t,c,u,"bg");break;case"copycoords":Jl(G,t,[i,s,o,a].join(" "));break;case"remixrun":Of(n.id,Ta.stat,Ta.patternsize,Ta.mirror,c,u);break;case"pageopen":yo(G,t,async()=>{await Md(800),vE(G,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}const B8=16,ws={},D8=15*60*5;let s1=0;const bo={},Eo={};async function o1(e){const t=po(),n=le(Pt.MAIN);if(t.length&&x(n)){const r=await e1(t),i=e?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;uE(oe,qr(),i,r)}}async function $8(){const e=po(),t=le(Pt.MAIN);if(e.length&&x(t)){const n=await e1(e);hE(oe,qr(),n)}}const oe=Ts("vm",["tick","second"],e=>{var n;if(!oe.session(e))return;const t=qr();switch(e.target){case"operator":CM(e.player),$t(oe,e.player,`operator set to ${e.player}`),oe.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=le(Pt.MAIN);oe.replynext(e,"ackzsswords",{cli:Kf(zi.CLI),loader:Kf(zi.LOADER),runtime:Kf(zi.RUNTIME),flags:[...Hn(_s(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...ds(r,bt.OBJECT).map(i=>Me(i)),...Hn($f)],altkinds:[...ds(r,bt.TERRAIN),...ds(r,bt.BOARD),...ds(r,bt.PALETTE),...ds(r,bt.CHARSET),...ds(r,bt.LOADER)].map(i=>Me(i)),colors:[...Hn($o)],dirs:[...Hn(rd).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Hn(jf)]});break}case"books":e.player===t&&yo(oe,e.player,async()=>{if(ne(e.data)){const[r,i]=e.data,s=await _8(r),o=s.map(a=>a.name);BM(s,i),$t(oe,e.player,`loading ${o.join(", ")}`),ql(oe,e.player)}});break;case"search":zM(e.player)||ql(oe,e.player);break;case"logout":jM(e.player),delete ws[e.player],$t(oe,t,`player ${e.player} logout`),ql(oe,e.player);break;case"login":$M(e.player)?(ws[e.player]=0,$t(oe,qr(),`login from ${e.player}`),oe.replynext(e,"acklogin",!0)):lE(oe,e.player);break;case"doot":ws[e.player]=0,Rd(oe,e.player,"active");break;case"input":{const r=_s(e.player),[i=dn.NONE,s=0]=e.data??[dn.NONE,0];ne(r.inputqueue)||(r.inputqueue=[]),i!==dn.NONE&&r.inputqueue.push([i,s]);break}case"codewatch":if(ne(e.data)){const[r,i]=e.data,s=Ia(r,i);x(Eo[s])||(Eo[s]=vp(s,o=>{const[a,c]=i,u=kr(r),l=Ei(u,a);if(x(l))if(_i(l)===bt.BOARD&&x(c)){const h=ln(l),f=Cn(h,c);x(f)&&(f.code=o,Tf(U_(o),f))}else l.code=o,RL(l)})),bo[s]=bo[s]??new Set,bo[s].add(e.player)}break;case"coderelease":if(ne(e.data)){const[r,i]=e.data,[,s]=i,o=Ia(r,i);x(bo[o])&&(bo[o].delete(e.player),bo[o].size===0&&((n=Eo[o])==null||n.call(Eo),Eo[o]=void 0,At(s)&&GM(s)))}break;case"halt":e.player===t&&K1(e.data)&&LM(e.data);break;case"tick":MM()||YM();break;case"synthsend":At(e.data)&&nd(e.data,void 0);break;case"second":{WM(ws);const r=Object.keys(ws);for(let i=0;i<r.length;++i)++ws[r[i]];for(let i=0;i<r.length;++i){const s=r[i];ws[s]>=B8&&Cd(oe,s)}++s1>=D8&&(s1=0,yo(oe,e.player,async()=>{await o1(!0)}));break}case"copyjsonfile":if(e.player===t){const r=le(Pt.MAIN);if(x(r)&&ne(e.data)){const[i]=e.data,s=Ei(r,i);x(s)&&fE(oe,t,s,`${Me(s)}.${bi(s)}.json`)}}break;case"refsheet":{const r=le(Pt.MAIN),i=_l(r);x(r)&&ne(e.data)&&(AE(oe,e.player),ms(oe,e.player,"use as refsheet"),i.forEach(s=>{const o=Me(s),a=bi(s);$t(oe,e.player,`!pageopenwith ${s.id} ${e.data.join(" ")};$blue[${a}]$white ${o}`)}));break}case"fork":e.player===t&&yo(oe,e.player,async()=>{await $8()});break;case"flush":e.player===t&&yo(oe,e.player,async()=>{await o1()});break;case"cli":VM(e.player,e.data);break;case"restart":e.player===t&&(HM(),Ld(oe,e.player));break;case"inspect":if(ne(e.data)){const[r,i]=e.data;U8(e.player,r,i)}break;case"loader":if(ne(e.data)){const[r,i,s,o]=e.data;if(i==="file")t1(e.player,o);else if(i==="json"&&/file:.*\.book.json/.test(s)){$t(oe,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=le(Pt.MAIN);x(c)&&x(a.data)&&At(a.exported)&&(td(a.data),$t(oe,e.player,`loaded ${a.exported}`))}else if(i==="json"&&/file:.*\..*\.json/.test(s)){$t(oe,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=le(Pt.MAIN);x(c)&&x(a.data)&&At(a.exported)&&(j_(c,a.data),$t(oe,e.player,`loaded ${a.exported}`))}else p6(r,i,s,o,e.player)}break;default:{const{target:r,path:i}=lr(e.target);switch(Ot(r)){case"batch":P8(i,e.player);break;case"empty":{const s=lr(i);switch(s.target){case"copycoords":Jl(oe,qr(),s.path.split(",").join(" "));break}break}case"inspect":F8(i,e.player);break;case"touched":if(ne(e.data)){const[s,o,a]=e.data;zb({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:zb(e);break}break}}},OM());function j8(){cE(oe)}const{forward:z8}=CE(e=>{LE(e)&&postMessage(e)});onmessage=function(t){z8(t.data)},setTimeout(j8,100)})();
